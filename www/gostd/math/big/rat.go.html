<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>math/big</h2>
<ul>
<li><a href="/gostd/math/big/arith.go.html">arith.go</a></li>
<li><a href="/gostd/math/big/arith_decl.go.html">arith_decl.go</a></li>
<li><a href="/gostd/math/big/arith_test.go.html">arith_test.go</a></li>
<li><a href="/gostd/math/big/calibrate_test.go.html">calibrate_test.go</a></li>
<li><a href="/gostd/math/big/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/math/big/gcd_test.go.html">gcd_test.go</a></li>
<li><a href="/gostd/math/big/hilbert_test.go.html">hilbert_test.go</a></li>
<li><a href="/gostd/math/big/int.go.html">int.go</a></li>
<li><a href="/gostd/math/big/int_test.go.html">int_test.go</a></li>
<li><a href="/gostd/math/big/nat.go.html">nat.go</a></li>
<li><a href="/gostd/math/big/nat_test.go.html">nat_test.go</a></li>
<li><a href="/gostd/math/big/rat.go.html" class="current">rat.go</a></li>
<li><a href="/gostd/math/big/rat_test.go.html">rat_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4112926">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4112981">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4113035">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4113086">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;multi-precision&nbsp;rational&nbsp;numbers.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4113145">package</span>&nbsp;<span class="ident" id="4113153">big</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4113158">import</span>&nbsp;<span class="op" id="4113165">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4113168">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4113187">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4113197">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4113204">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4113212">&#34;strings&#34;</span><br>
<span class="lineno">15</span><span class="op" id="4113222">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4113225">//&nbsp;A&nbsp;Rat&nbsp;represents&nbsp;a&nbsp;quotient&nbsp;a/b&nbsp;of&nbsp;arbitrary&nbsp;precision.</span><br>
<span class="lineno"></span><span class="comment" id="4113284">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;a&nbsp;Rat&nbsp;represents&nbsp;the&nbsp;value&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="4113336">type</span>&nbsp;<span class="ident" id="4113341">Rat</span>&nbsp;<span class="keyword" id="4113345">struct</span>&nbsp;<span class="op" id="4113352">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4113355">//&nbsp;To&nbsp;make&nbsp;zero&nbsp;values&nbsp;for&nbsp;Rat&nbsp;work&nbsp;w/o&nbsp;initialization,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4113412">//&nbsp;a&nbsp;zero&nbsp;value&nbsp;of&nbsp;b&nbsp;(len(b)&nbsp;==&nbsp;0)&nbsp;acts&nbsp;like&nbsp;b&nbsp;==&nbsp;1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4113466">//&nbsp;a.neg&nbsp;determines&nbsp;the&nbsp;sign&nbsp;of&nbsp;the&nbsp;Rat,&nbsp;b.neg&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4113526">a</span><span class="op" id="4113527">,</span>&nbsp;<span class="ident" id="4113529">b</span>&nbsp;<span class="ident" id="4113531">Int</span><br>
<span class="lineno"></span><span class="op" id="4113535">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="4113538">//&nbsp;NewRat&nbsp;creates&nbsp;a&nbsp;new&nbsp;Rat&nbsp;with&nbsp;numerator&nbsp;a&nbsp;and&nbsp;denominator&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="4113602">func</span>&nbsp;<span class="ident" id="4113607">NewRat</span><span class="op" id="4113613">(</span><span class="ident" id="4113614">a</span><span class="op" id="4113615">,</span>&nbsp;<span class="ident" id="4113617">b</span>&nbsp;<span class="builtintype" id="4113619">int64</span><span class="op" id="4113624">)</span>&nbsp;<span class="op" id="4113626">*</span><span class="ident" id="4113627">Rat</span>&nbsp;<span class="op" id="4113631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4113634">return</span>&nbsp;<span class="builtinfunc" id="4113641">new</span><span class="op" id="4113644">(</span><span class="ident" id="4113645">Rat</span><span class="op" id="4113648">)</span><span class="op" id="4113649">.</span><span class="ident" id="4113650">SetFrac64</span><span class="op" id="4113659">(</span><span class="ident" id="4113660">a</span><span class="op" id="4113661">,</span>&nbsp;<span class="ident" id="4113663">b</span><span class="op" id="4113664">)</span><br>
<span class="lineno"></span><span class="op" id="4113666">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="4113669">//&nbsp;SetFloat64&nbsp;sets&nbsp;z&nbsp;to&nbsp;exactly&nbsp;f&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="4113718">//&nbsp;If&nbsp;f&nbsp;is&nbsp;not&nbsp;finite,&nbsp;SetFloat&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="4113763">func</span>&nbsp;<span class="op" id="4113768">(</span><span class="ident" id="4113769">z</span>&nbsp;<span class="op" id="4113771">*</span><span class="ident" id="4113772">Rat</span><span class="op" id="4113775">)</span>&nbsp;<span class="ident" id="4113777">SetFloat64</span><span class="op" id="4113787">(</span><span class="ident" id="4113788">f</span>&nbsp;<span class="builtintype" id="4113790">float64</span><span class="op" id="4113797">)</span>&nbsp;<span class="op" id="4113799">*</span><span class="ident" id="4113800">Rat</span>&nbsp;<span class="op" id="4113804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4113807">const</span>&nbsp;<span class="ident" id="4113813">expMask</span>&nbsp;<span class="op" id="4113821">=</span>&nbsp;<span class="num" id="4113823">1</span><span class="op" id="4113824">&lt;&lt;</span><span class="num" id="4113826">11</span>&nbsp;<span class="op" id="4113829">-</span>&nbsp;<span class="num" id="4113831">1</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4113834">bits</span>&nbsp;<span class="op" id="4113839">:=</span>&nbsp;<span class="ident" id="4113842">math</span><span class="op" id="4113846">.</span><span class="ident" id="4113847">Float64bits</span><span class="op" id="4113858">(</span><span class="ident" id="4113859">f</span><span class="op" id="4113860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4113863">mantissa</span>&nbsp;<span class="op" id="4113872">:=</span>&nbsp;<span class="ident" id="4113875">bits</span>&nbsp;<span class="op" id="4113880">&amp;</span>&nbsp;<span class="op" id="4113882">(</span><span class="num" id="4113883">1</span><span class="op" id="4113884">&lt;&lt;</span><span class="num" id="4113886">52</span>&nbsp;<span class="op" id="4113889">-</span>&nbsp;<span class="num" id="4113891">1</span><span class="op" id="4113892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4113895">exp</span>&nbsp;<span class="op" id="4113899">:=</span>&nbsp;<span class="builtintype" id="4113902">int</span><span class="op" id="4113905">(</span><span class="op" id="4113906">(</span><span class="ident" id="4113907">bits</span>&nbsp;<span class="op" id="4113912">&gt;&gt;</span>&nbsp;<span class="num" id="4113915">52</span><span class="op" id="4113917">)</span>&nbsp;<span class="op" id="4113919">&amp;</span>&nbsp;<span class="ident" id="4113921">expMask</span><span class="op" id="4113928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4113931">switch</span>&nbsp;<span class="ident" id="4113938">exp</span>&nbsp;<span class="op" id="4113942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4113945">case</span>&nbsp;<span class="ident" id="4113950">expMask</span><span class="op" id="4113957">:</span>&nbsp;<span class="comment" id="4113959">//&nbsp;non-finite</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4113975">return</span>&nbsp;<span class="builtintype" id="4113982">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4113987">case</span>&nbsp;<span class="num" id="4113992">0</span><span class="op" id="4113993">:</span>&nbsp;<span class="comment" id="4113995">//&nbsp;denormal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4114009">exp</span>&nbsp;<span class="op" id="4114013">-=</span>&nbsp;<span class="num" id="4114016">1022</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4114022">default</span><span class="op" id="4114029">:</span>&nbsp;<span class="comment" id="4114031">//&nbsp;normal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4114043">mantissa</span>&nbsp;<span class="op" id="4114052">|=</span>&nbsp;<span class="num" id="4114055">1</span>&nbsp;<span class="op" id="4114057">&lt;&lt;</span>&nbsp;<span class="num" id="4114060">52</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4114065">exp</span>&nbsp;<span class="op" id="4114069">-=</span>&nbsp;<span class="num" id="4114072">1023</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4114078">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4114082">shift</span>&nbsp;<span class="op" id="4114088">:=</span>&nbsp;<span class="num" id="4114091">52</span>&nbsp;<span class="op" id="4114094">-</span>&nbsp;<span class="ident" id="4114096">exp</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4114102">//&nbsp;Optimization&nbsp;(?):&nbsp;partially&nbsp;pre-normalise.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4114149">for</span>&nbsp;<span class="ident" id="4114153">mantissa</span><span class="op" id="4114161">&amp;</span><span class="num" id="4114162">1</span>&nbsp;<span class="op" id="4114164">==</span>&nbsp;<span class="num" id="4114167">0</span>&nbsp;<span class="op" id="4114169">&amp;&amp;</span>&nbsp;<span class="ident" id="4114172">shift</span>&nbsp;<span class="op" id="4114178">&gt;</span>&nbsp;<span class="num" id="4114180">0</span>&nbsp;<span class="op" id="4114182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4114186">mantissa</span>&nbsp;<span class="op" id="4114195">&gt;&gt;=</span>&nbsp;<span class="num" id="4114199">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4114203">shift</span><span class="op" id="4114208">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4114212">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4114216">z</span><span class="op" id="4114217">.</span><span class="ident" id="4114218">a</span><span class="op" id="4114219">.</span><span class="ident" id="4114220">SetUint64</span><span class="op" id="4114229">(</span><span class="ident" id="4114230">mantissa</span><span class="op" id="4114238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4114241">z</span><span class="op" id="4114242">.</span><span class="ident" id="4114243">a</span><span class="op" id="4114244">.</span><span class="ident" id="4114245">neg</span>&nbsp;<span class="op" id="4114249">=</span>&nbsp;<span class="ident" id="4114251">f</span>&nbsp;<span class="op" id="4114253">&lt;</span>&nbsp;<span class="num" id="4114255">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4114258">z</span><span class="op" id="4114259">.</span><span class="ident" id="4114260">b</span><span class="op" id="4114261">.</span><span class="ident" id="4114262">Set</span><span class="op" id="4114265">(</span><span class="ident" id="4114266">intOne</span><span class="op" id="4114272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4114275">if</span>&nbsp;<span class="ident" id="4114278">shift</span>&nbsp;<span class="op" id="4114284">&gt;</span>&nbsp;<span class="num" id="4114286">0</span>&nbsp;<span class="op" id="4114288">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4114292">z</span><span class="op" id="4114293">.</span><span class="ident" id="4114294">b</span><span class="op" id="4114295">.</span><span class="ident" id="4114296">Lsh</span><span class="op" id="4114299">(</span><span class="op" id="4114300">&amp;</span><span class="ident" id="4114301">z</span><span class="op" id="4114302">.</span><span class="ident" id="4114303">b</span><span class="op" id="4114304">,</span>&nbsp;<span class="builtintype" id="4114306">uint</span><span class="op" id="4114310">(</span><span class="ident" id="4114311">shift</span><span class="op" id="4114316">)</span><span class="op" id="4114317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4114320">}</span>&nbsp;<span class="keyword" id="4114322">else</span>&nbsp;<span class="op" id="4114327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4114331">z</span><span class="op" id="4114332">.</span><span class="ident" id="4114333">a</span><span class="op" id="4114334">.</span><span class="ident" id="4114335">Lsh</span><span class="op" id="4114338">(</span><span class="op" id="4114339">&amp;</span><span class="ident" id="4114340">z</span><span class="op" id="4114341">.</span><span class="ident" id="4114342">a</span><span class="op" id="4114343">,</span>&nbsp;<span class="builtintype" id="4114345">uint</span><span class="op" id="4114349">(</span><span class="op" id="4114350">-</span><span class="ident" id="4114351">shift</span><span class="op" id="4114356">)</span><span class="op" id="4114357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4114360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4114363">return</span>&nbsp;<span class="ident" id="4114370">z</span><span class="op" id="4114371">.</span><span class="ident" id="4114372">norm</span><span class="op" id="4114376">(</span><span class="op" id="4114377">)</span><br>
<span class="lineno">65</span><span class="op" id="4114379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4114382">//&nbsp;quotToFloat32&nbsp;returns&nbsp;the&nbsp;non-negative&nbsp;float32&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="4114438">//&nbsp;nearest&nbsp;to&nbsp;the&nbsp;quotient&nbsp;a/b,&nbsp;using&nbsp;round-to-even&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4114493">//&nbsp;halfway&nbsp;cases.&nbsp;&nbsp;It&nbsp;does&nbsp;not&nbsp;mutate&nbsp;its&nbsp;arguments.</span><br>
<span class="lineno">70</span><span class="comment" id="4114546">//&nbsp;Preconditions:&nbsp;b&nbsp;is&nbsp;non-zero;&nbsp;a&nbsp;and&nbsp;b&nbsp;have&nbsp;no&nbsp;common&nbsp;factors.</span><br>
<span class="lineno"></span><span class="keyword" id="4114611">func</span>&nbsp;<span class="ident" id="4114616">quotToFloat32</span><span class="op" id="4114629">(</span><span class="ident" id="4114630">a</span><span class="op" id="4114631">,</span>&nbsp;<span class="ident" id="4114633">b</span>&nbsp;<span class="ident" id="4114635">nat</span><span class="op" id="4114638">)</span>&nbsp;<span class="op" id="4114640">(</span><span class="ident" id="4114641">f</span>&nbsp;<span class="builtintype" id="4114643">float32</span><span class="op" id="4114650">,</span>&nbsp;<span class="ident" id="4114652">exact</span>&nbsp;<span class="builtintype" id="4114658">bool</span><span class="op" id="4114662">)</span>&nbsp;<span class="op" id="4114664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4114667">const</span>&nbsp;<span class="op" id="4114673">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4114677">//&nbsp;float&nbsp;size&nbsp;in&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4114701">Fsize</span>&nbsp;<span class="op" id="4114707">=</span>&nbsp;<span class="num" id="4114709">32</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4114715">//&nbsp;mantissa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4114729">Msize</span>&nbsp;&nbsp;<span class="op" id="4114736">=</span>&nbsp;<span class="num" id="4114738">23</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4114743">Msize1</span>&nbsp;<span class="op" id="4114750">=</span>&nbsp;<span class="ident" id="4114752">Msize</span>&nbsp;<span class="op" id="4114758">+</span>&nbsp;<span class="num" id="4114760">1</span>&nbsp;<span class="comment" id="4114762">//&nbsp;incl.&nbsp;implicit&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4114784">Msize2</span>&nbsp;<span class="op" id="4114791">=</span>&nbsp;<span class="ident" id="4114793">Msize1</span>&nbsp;<span class="op" id="4114800">+</span>&nbsp;<span class="num" id="4114802">1</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4114807">//&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4114821">Esize</span>&nbsp;<span class="op" id="4114827">=</span>&nbsp;<span class="ident" id="4114829">Fsize</span>&nbsp;<span class="op" id="4114835">-</span>&nbsp;<span class="ident" id="4114837">Msize1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4114846">Ebias</span>&nbsp;<span class="op" id="4114852">=</span>&nbsp;<span class="num" id="4114854">1</span><span class="op" id="4114855">&lt;&lt;</span><span class="op" id="4114857">(</span><span class="ident" id="4114858">Esize</span><span class="op" id="4114863">-</span><span class="num" id="4114864">1</span><span class="op" id="4114865">)</span>&nbsp;<span class="op" id="4114867">-</span>&nbsp;<span class="num" id="4114869">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4114873">Emin</span>&nbsp;&nbsp;<span class="op" id="4114879">=</span>&nbsp;<span class="num" id="4114881">1</span>&nbsp;<span class="op" id="4114883">-</span>&nbsp;<span class="ident" id="4114885">Ebias</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4114893">Emax</span>&nbsp;&nbsp;<span class="op" id="4114899">=</span>&nbsp;<span class="ident" id="4114901">Ebias</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4114908">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4114912">//&nbsp;TODO(adonovan):&nbsp;specialize&nbsp;common&nbsp;degenerate&nbsp;cases:&nbsp;1.0,&nbsp;integers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4114983">alen</span>&nbsp;<span class="op" id="4114988">:=</span>&nbsp;<span class="ident" id="4114991">a</span><span class="op" id="4114992">.</span><span class="ident" id="4114993">bitLen</span><span class="op" id="4114999">(</span><span class="op" id="4115000">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4115003">if</span>&nbsp;<span class="ident" id="4115006">alen</span>&nbsp;<span class="op" id="4115011">==</span>&nbsp;<span class="num" id="4115014">0</span>&nbsp;<span class="op" id="4115016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4115020">return</span>&nbsp;<span class="num" id="4115027">0</span><span class="op" id="4115028">,</span>&nbsp;<span class="builtintype" id="4115030">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4115036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4115039">blen</span>&nbsp;<span class="op" id="4115044">:=</span>&nbsp;<span class="ident" id="4115047">b</span><span class="op" id="4115048">.</span><span class="ident" id="4115049">bitLen</span><span class="op" id="4115055">(</span><span class="op" id="4115056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4115059">if</span>&nbsp;<span class="ident" id="4115062">blen</span>&nbsp;<span class="op" id="4115067">==</span>&nbsp;<span class="num" id="4115070">0</span>&nbsp;<span class="op" id="4115072">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4115076">panic</span><span class="op" id="4115081">(</span><span class="string" id="4115082">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="4115100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4115103">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4115107">//&nbsp;1.&nbsp;Left-shift&nbsp;A&nbsp;or&nbsp;B&nbsp;such&nbsp;that&nbsp;quotient&nbsp;A/B&nbsp;is&nbsp;in&nbsp;[1&lt;&lt;Msize1,&nbsp;1&lt;&lt;(Msize2+1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4115187">//&nbsp;(Msize2&nbsp;bits&nbsp;if&nbsp;A&nbsp;&lt;&nbsp;B&nbsp;when&nbsp;they&nbsp;are&nbsp;left-aligned,&nbsp;Msize2+1&nbsp;bits&nbsp;if&nbsp;A&nbsp;&gt;=&nbsp;B).</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4115267">//&nbsp;This&nbsp;is&nbsp;2&nbsp;or&nbsp;3&nbsp;more&nbsp;than&nbsp;the&nbsp;float32&nbsp;mantissa&nbsp;field&nbsp;width&nbsp;of&nbsp;Msize:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4115339">//&nbsp;-&nbsp;the&nbsp;optional&nbsp;extra&nbsp;bit&nbsp;is&nbsp;shifted&nbsp;away&nbsp;in&nbsp;step&nbsp;3&nbsp;below.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4115401">//&nbsp;-&nbsp;the&nbsp;high-order&nbsp;1&nbsp;is&nbsp;omitted&nbsp;in&nbsp;&#34;normal&#34;&nbsp;representation;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4115463">//&nbsp;-&nbsp;the&nbsp;low-order&nbsp;1&nbsp;will&nbsp;be&nbsp;used&nbsp;during&nbsp;rounding&nbsp;then&nbsp;discarded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4115530">exp</span>&nbsp;<span class="op" id="4115534">:=</span>&nbsp;<span class="ident" id="4115537">alen</span>&nbsp;<span class="op" id="4115542">-</span>&nbsp;<span class="ident" id="4115544">blen</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4115550">var</span>&nbsp;<span class="ident" id="4115554">a2</span><span class="op" id="4115556">,</span>&nbsp;<span class="ident" id="4115558">b2</span>&nbsp;<span class="ident" id="4115561">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4115566">a2</span>&nbsp;<span class="op" id="4115569">=</span>&nbsp;<span class="ident" id="4115571">a2</span><span class="op" id="4115573">.</span><span class="ident" id="4115574">set</span><span class="op" id="4115577">(</span><span class="ident" id="4115578">a</span><span class="op" id="4115579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4115582">b2</span>&nbsp;<span class="op" id="4115585">=</span>&nbsp;<span class="ident" id="4115587">b2</span><span class="op" id="4115589">.</span><span class="ident" id="4115590">set</span><span class="op" id="4115593">(</span><span class="ident" id="4115594">b</span><span class="op" id="4115595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4115598">if</span>&nbsp;<span class="ident" id="4115601">shift</span>&nbsp;<span class="op" id="4115607">:=</span>&nbsp;<span class="ident" id="4115610">Msize2</span>&nbsp;<span class="op" id="4115617">-</span>&nbsp;<span class="ident" id="4115619">exp</span><span class="op" id="4115622">;</span>&nbsp;<span class="ident" id="4115624">shift</span>&nbsp;<span class="op" id="4115630">&gt;</span>&nbsp;<span class="num" id="4115632">0</span>&nbsp;<span class="op" id="4115634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4115638">a2</span>&nbsp;<span class="op" id="4115641">=</span>&nbsp;<span class="ident" id="4115643">a2</span><span class="op" id="4115645">.</span><span class="ident" id="4115646">shl</span><span class="op" id="4115649">(</span><span class="ident" id="4115650">a2</span><span class="op" id="4115652">,</span>&nbsp;<span class="builtintype" id="4115654">uint</span><span class="op" id="4115658">(</span><span class="ident" id="4115659">shift</span><span class="op" id="4115664">)</span><span class="op" id="4115665">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4115668">}</span>&nbsp;<span class="keyword" id="4115670">else</span>&nbsp;<span class="keyword" id="4115675">if</span>&nbsp;<span class="ident" id="4115678">shift</span>&nbsp;<span class="op" id="4115684">&lt;</span>&nbsp;<span class="num" id="4115686">0</span>&nbsp;<span class="op" id="4115688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4115692">b2</span>&nbsp;<span class="op" id="4115695">=</span>&nbsp;<span class="ident" id="4115697">b2</span><span class="op" id="4115699">.</span><span class="ident" id="4115700">shl</span><span class="op" id="4115703">(</span><span class="ident" id="4115704">b2</span><span class="op" id="4115706">,</span>&nbsp;<span class="builtintype" id="4115708">uint</span><span class="op" id="4115712">(</span><span class="op" id="4115713">-</span><span class="ident" id="4115714">shift</span><span class="op" id="4115719">)</span><span class="op" id="4115720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4115723">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4115727">//&nbsp;2.&nbsp;Compute&nbsp;quotient&nbsp;and&nbsp;remainder&nbsp;(q,&nbsp;r).&nbsp;&nbsp;NB:&nbsp;due&nbsp;to&nbsp;the</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4115789">//&nbsp;extra&nbsp;shift,&nbsp;the&nbsp;low-order&nbsp;bit&nbsp;of&nbsp;q&nbsp;is&nbsp;logically&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4115846">//&nbsp;high-order&nbsp;bit&nbsp;of&nbsp;r.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4115871">var</span>&nbsp;<span class="ident" id="4115875">q</span>&nbsp;<span class="ident" id="4115877">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4115882">q</span><span class="op" id="4115883">,</span>&nbsp;<span class="ident" id="4115885">r</span>&nbsp;<span class="op" id="4115887">:=</span>&nbsp;<span class="ident" id="4115890">q</span><span class="op" id="4115891">.</span><span class="ident" id="4115892">div</span><span class="op" id="4115895">(</span><span class="ident" id="4115896">a2</span><span class="op" id="4115898">,</span>&nbsp;<span class="ident" id="4115900">a2</span><span class="op" id="4115902">,</span>&nbsp;<span class="ident" id="4115904">b2</span><span class="op" id="4115906">)</span>&nbsp;<span class="comment" id="4115908">//&nbsp;(recycle&nbsp;a2)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4115925">mantissa</span>&nbsp;<span class="op" id="4115934">:=</span>&nbsp;<span class="ident" id="4115937">low32</span><span class="op" id="4115942">(</span><span class="ident" id="4115943">q</span><span class="op" id="4115944">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4115947">haveRem</span>&nbsp;<span class="op" id="4115955">:=</span>&nbsp;<span class="builtinfunc" id="4115958">len</span><span class="op" id="4115961">(</span><span class="ident" id="4115962">r</span><span class="op" id="4115963">)</span>&nbsp;<span class="op" id="4115965">&gt;</span>&nbsp;<span class="num" id="4115967">0</span>&nbsp;<span class="comment" id="4115969">//&nbsp;mantissa&amp;1&nbsp;&amp;&amp;&nbsp;!haveRem&nbsp;=&gt;&nbsp;remainder&nbsp;is&nbsp;exactly&nbsp;half</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4116026">//&nbsp;3.&nbsp;If&nbsp;quotient&nbsp;didn&#39;t&nbsp;fit&nbsp;in&nbsp;Msize2&nbsp;bits,&nbsp;redo&nbsp;division&nbsp;by&nbsp;b2&lt;&lt;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4116095">//&nbsp;(in&nbsp;effect---we&nbsp;accomplish&nbsp;this&nbsp;incrementally).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4116147">if</span>&nbsp;<span class="ident" id="4116150">mantissa</span><span class="op" id="4116158">&gt;&gt;</span><span class="ident" id="4116160">Msize2</span>&nbsp;<span class="op" id="4116167">==</span>&nbsp;<span class="num" id="4116170">1</span>&nbsp;<span class="op" id="4116172">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4116176">if</span>&nbsp;<span class="ident" id="4116179">mantissa</span><span class="op" id="4116187">&amp;</span><span class="num" id="4116188">1</span>&nbsp;<span class="op" id="4116190">==</span>&nbsp;<span class="num" id="4116193">1</span>&nbsp;<span class="op" id="4116195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4116200">haveRem</span>&nbsp;<span class="op" id="4116208">=</span>&nbsp;<span class="builtintype" id="4116210">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4116217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4116221">mantissa</span>&nbsp;<span class="op" id="4116230">&gt;&gt;=</span>&nbsp;<span class="num" id="4116234">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4116238">exp</span><span class="op" id="4116241">++</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4116245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4116248">if</span>&nbsp;<span class="ident" id="4116251">mantissa</span><span class="op" id="4116259">&gt;&gt;</span><span class="ident" id="4116261">Msize1</span>&nbsp;<span class="op" id="4116268">!=</span>&nbsp;<span class="num" id="4116271">1</span>&nbsp;<span class="op" id="4116273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4116277">panic</span><span class="op" id="4116282">(</span><span class="ident" id="4116283">fmt</span><span class="op" id="4116286">.</span><span class="ident" id="4116287">Sprintf</span><span class="op" id="4116294">(</span><span class="string" id="4116295">&#34;expected&nbsp;exactly&nbsp;%d&nbsp;bits&nbsp;of&nbsp;result&#34;</span><span class="op" id="4116331">,</span>&nbsp;<span class="ident" id="4116333">Msize2</span><span class="op" id="4116339">)</span><span class="op" id="4116340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4116343">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4116347">//&nbsp;4.&nbsp;Rounding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4116364">if</span>&nbsp;<span class="ident" id="4116367">Emin</span><span class="op" id="4116371">-</span><span class="ident" id="4116372">Msize</span>&nbsp;<span class="op" id="4116378">&lt;=</span>&nbsp;<span class="ident" id="4116381">exp</span>&nbsp;<span class="op" id="4116385">&amp;&amp;</span>&nbsp;<span class="ident" id="4116388">exp</span>&nbsp;<span class="op" id="4116392">&lt;=</span>&nbsp;<span class="ident" id="4116395">Emin</span>&nbsp;<span class="op" id="4116400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4116404">//&nbsp;Denormal&nbsp;case;&nbsp;lose&nbsp;&#39;shift&#39;&nbsp;bits&nbsp;of&nbsp;precision.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4116456">shift</span>&nbsp;<span class="op" id="4116462">:=</span>&nbsp;<span class="builtintype" id="4116465">uint</span><span class="op" id="4116469">(</span><span class="ident" id="4116470">Emin</span>&nbsp;<span class="op" id="4116475">-</span>&nbsp;<span class="op" id="4116477">(</span><span class="ident" id="4116478">exp</span>&nbsp;<span class="op" id="4116482">-</span>&nbsp;<span class="num" id="4116484">1</span><span class="op" id="4116485">)</span><span class="op" id="4116486">)</span>&nbsp;<span class="comment" id="4116488">//&nbsp;[1..Esize1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4116505">lostbits</span>&nbsp;<span class="op" id="4116514">:=</span>&nbsp;<span class="ident" id="4116517">mantissa</span>&nbsp;<span class="op" id="4116526">&amp;</span>&nbsp;<span class="op" id="4116528">(</span><span class="num" id="4116529">1</span><span class="op" id="4116530">&lt;&lt;</span><span class="ident" id="4116532">shift</span>&nbsp;<span class="op" id="4116538">-</span>&nbsp;<span class="num" id="4116540">1</span><span class="op" id="4116541">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4116545">haveRem</span>&nbsp;<span class="op" id="4116553">=</span>&nbsp;<span class="ident" id="4116555">haveRem</span>&nbsp;<span class="op" id="4116563">||</span>&nbsp;<span class="ident" id="4116566">lostbits</span>&nbsp;<span class="op" id="4116575">!=</span>&nbsp;<span class="num" id="4116578">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4116582">mantissa</span>&nbsp;<span class="op" id="4116591">&gt;&gt;=</span>&nbsp;<span class="ident" id="4116595">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4116603">exp</span>&nbsp;<span class="op" id="4116607">=</span>&nbsp;<span class="num" id="4116609">2</span>&nbsp;<span class="op" id="4116611">-</span>&nbsp;<span class="ident" id="4116613">Ebias</span>&nbsp;<span class="comment" id="4116619">//&nbsp;==&nbsp;exp&nbsp;+&nbsp;shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4116638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4116641">//&nbsp;Round&nbsp;q&nbsp;using&nbsp;round-half-to-even.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4116679">exact</span>&nbsp;<span class="op" id="4116685">=</span>&nbsp;<span class="op" id="4116687">!</span><span class="ident" id="4116688">haveRem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4116697">if</span>&nbsp;<span class="ident" id="4116700">mantissa</span><span class="op" id="4116708">&amp;</span><span class="num" id="4116709">1</span>&nbsp;<span class="op" id="4116711">!=</span>&nbsp;<span class="num" id="4116714">0</span>&nbsp;<span class="op" id="4116716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4116720">exact</span>&nbsp;<span class="op" id="4116726">=</span>&nbsp;<span class="builtintype" id="4116728">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4116736">if</span>&nbsp;<span class="ident" id="4116739">haveRem</span>&nbsp;<span class="op" id="4116747">||</span>&nbsp;<span class="ident" id="4116750">mantissa</span><span class="op" id="4116758">&amp;</span><span class="num" id="4116759">2</span>&nbsp;<span class="op" id="4116761">!=</span>&nbsp;<span class="num" id="4116764">0</span>&nbsp;<span class="op" id="4116766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4116771">if</span>&nbsp;<span class="ident" id="4116774">mantissa</span><span class="op" id="4116782">++</span><span class="op" id="4116784">;</span>&nbsp;<span class="ident" id="4116786">mantissa</span>&nbsp;<span class="op" id="4116795">&gt;=</span>&nbsp;<span class="num" id="4116798">1</span><span class="op" id="4116799">&lt;&lt;</span><span class="ident" id="4116801">Msize2</span>&nbsp;<span class="op" id="4116808">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4116814">//&nbsp;Complete&nbsp;rollover&nbsp;11...1&nbsp;=&gt;&nbsp;100...0,&nbsp;so&nbsp;shift&nbsp;is&nbsp;safe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4116875">mantissa</span>&nbsp;<span class="op" id="4116884">&gt;&gt;=</span>&nbsp;<span class="num" id="4116888">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4116894">exp</span><span class="op" id="4116897">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4116903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4116907">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4116910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4116913">mantissa</span>&nbsp;<span class="op" id="4116922">&gt;&gt;=</span>&nbsp;<span class="num" id="4116926">1</span>&nbsp;<span class="comment" id="4116928">//&nbsp;discard&nbsp;rounding&nbsp;bit.&nbsp;&nbsp;Mantissa&nbsp;now&nbsp;scaled&nbsp;by&nbsp;1&lt;&lt;Msize1.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4116990">f</span>&nbsp;<span class="op" id="4116992">=</span>&nbsp;<span class="builtintype" id="4116994">float32</span><span class="op" id="4117001">(</span><span class="ident" id="4117002">math</span><span class="op" id="4117006">.</span><span class="ident" id="4117007">Ldexp</span><span class="op" id="4117012">(</span><span class="builtintype" id="4117013">float64</span><span class="op" id="4117020">(</span><span class="ident" id="4117021">mantissa</span><span class="op" id="4117029">)</span><span class="op" id="4117030">,</span>&nbsp;<span class="ident" id="4117032">exp</span><span class="op" id="4117035">-</span><span class="ident" id="4117036">Msize1</span><span class="op" id="4117042">)</span><span class="op" id="4117043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4117046">if</span>&nbsp;<span class="ident" id="4117049">math</span><span class="op" id="4117053">.</span><span class="ident" id="4117054">IsInf</span><span class="op" id="4117059">(</span><span class="builtintype" id="4117060">float64</span><span class="op" id="4117067">(</span><span class="ident" id="4117068">f</span><span class="op" id="4117069">)</span><span class="op" id="4117070">,</span>&nbsp;<span class="num" id="4117072">0</span><span class="op" id="4117073">)</span>&nbsp;<span class="op" id="4117075">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4117079">exact</span>&nbsp;<span class="op" id="4117085">=</span>&nbsp;<span class="builtintype" id="4117087">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4117094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4117097">return</span><br>
<span class="lineno"></span><span class="op" id="4117104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="4117107">//&nbsp;quotToFloat64&nbsp;returns&nbsp;the&nbsp;non-negative&nbsp;float64&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="4117163">//&nbsp;nearest&nbsp;to&nbsp;the&nbsp;quotient&nbsp;a/b,&nbsp;using&nbsp;round-to-even&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4117218">//&nbsp;halfway&nbsp;cases.&nbsp;&nbsp;It&nbsp;does&nbsp;not&nbsp;mutate&nbsp;its&nbsp;arguments.</span><br>
<span class="lineno"></span><span class="comment" id="4117271">//&nbsp;Preconditions:&nbsp;b&nbsp;is&nbsp;non-zero;&nbsp;a&nbsp;and&nbsp;b&nbsp;have&nbsp;no&nbsp;common&nbsp;factors.</span><br>
<span class="lineno"></span><span class="keyword" id="4117336">func</span>&nbsp;<span class="ident" id="4117341">quotToFloat64</span><span class="op" id="4117354">(</span><span class="ident" id="4117355">a</span><span class="op" id="4117356">,</span>&nbsp;<span class="ident" id="4117358">b</span>&nbsp;<span class="ident" id="4117360">nat</span><span class="op" id="4117363">)</span>&nbsp;<span class="op" id="4117365">(</span><span class="ident" id="4117366">f</span>&nbsp;<span class="builtintype" id="4117368">float64</span><span class="op" id="4117375">,</span>&nbsp;<span class="ident" id="4117377">exact</span>&nbsp;<span class="builtintype" id="4117383">bool</span><span class="op" id="4117387">)</span>&nbsp;<span class="op" id="4117389">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4117392">const</span>&nbsp;<span class="op" id="4117398">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4117402">//&nbsp;float&nbsp;size&nbsp;in&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4117426">Fsize</span>&nbsp;<span class="op" id="4117432">=</span>&nbsp;<span class="num" id="4117434">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4117440">//&nbsp;mantissa</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4117454">Msize</span>&nbsp;&nbsp;<span class="op" id="4117461">=</span>&nbsp;<span class="num" id="4117463">52</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4117468">Msize1</span>&nbsp;<span class="op" id="4117475">=</span>&nbsp;<span class="ident" id="4117477">Msize</span>&nbsp;<span class="op" id="4117483">+</span>&nbsp;<span class="num" id="4117485">1</span>&nbsp;<span class="comment" id="4117487">//&nbsp;incl.&nbsp;implicit&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4117509">Msize2</span>&nbsp;<span class="op" id="4117516">=</span>&nbsp;<span class="ident" id="4117518">Msize1</span>&nbsp;<span class="op" id="4117525">+</span>&nbsp;<span class="num" id="4117527">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4117532">//&nbsp;exponent</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4117546">Esize</span>&nbsp;<span class="op" id="4117552">=</span>&nbsp;<span class="ident" id="4117554">Fsize</span>&nbsp;<span class="op" id="4117560">-</span>&nbsp;<span class="ident" id="4117562">Msize1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4117571">Ebias</span>&nbsp;<span class="op" id="4117577">=</span>&nbsp;<span class="num" id="4117579">1</span><span class="op" id="4117580">&lt;&lt;</span><span class="op" id="4117582">(</span><span class="ident" id="4117583">Esize</span><span class="op" id="4117588">-</span><span class="num" id="4117589">1</span><span class="op" id="4117590">)</span>&nbsp;<span class="op" id="4117592">-</span>&nbsp;<span class="num" id="4117594">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4117598">Emin</span>&nbsp;&nbsp;<span class="op" id="4117604">=</span>&nbsp;<span class="num" id="4117606">1</span>&nbsp;<span class="op" id="4117608">-</span>&nbsp;<span class="ident" id="4117610">Ebias</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4117618">Emax</span>&nbsp;&nbsp;<span class="op" id="4117624">=</span>&nbsp;<span class="ident" id="4117626">Ebias</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4117633">)</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4117637">//&nbsp;TODO(adonovan):&nbsp;specialize&nbsp;common&nbsp;degenerate&nbsp;cases:&nbsp;1.0,&nbsp;integers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4117708">alen</span>&nbsp;<span class="op" id="4117713">:=</span>&nbsp;<span class="ident" id="4117716">a</span><span class="op" id="4117717">.</span><span class="ident" id="4117718">bitLen</span><span class="op" id="4117724">(</span><span class="op" id="4117725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4117728">if</span>&nbsp;<span class="ident" id="4117731">alen</span>&nbsp;<span class="op" id="4117736">==</span>&nbsp;<span class="num" id="4117739">0</span>&nbsp;<span class="op" id="4117741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4117745">return</span>&nbsp;<span class="num" id="4117752">0</span><span class="op" id="4117753">,</span>&nbsp;<span class="builtintype" id="4117755">true</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4117761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4117764">blen</span>&nbsp;<span class="op" id="4117769">:=</span>&nbsp;<span class="ident" id="4117772">b</span><span class="op" id="4117773">.</span><span class="ident" id="4117774">bitLen</span><span class="op" id="4117780">(</span><span class="op" id="4117781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4117784">if</span>&nbsp;<span class="ident" id="4117787">blen</span>&nbsp;<span class="op" id="4117792">==</span>&nbsp;<span class="num" id="4117795">0</span>&nbsp;<span class="op" id="4117797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4117801">panic</span><span class="op" id="4117806">(</span><span class="string" id="4117807">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="4117825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4117828">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4117832">//&nbsp;1.&nbsp;Left-shift&nbsp;A&nbsp;or&nbsp;B&nbsp;such&nbsp;that&nbsp;quotient&nbsp;A/B&nbsp;is&nbsp;in&nbsp;[1&lt;&lt;Msize1,&nbsp;1&lt;&lt;(Msize2+1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4117912">//&nbsp;(Msize2&nbsp;bits&nbsp;if&nbsp;A&nbsp;&lt;&nbsp;B&nbsp;when&nbsp;they&nbsp;are&nbsp;left-aligned,&nbsp;Msize2+1&nbsp;bits&nbsp;if&nbsp;A&nbsp;&gt;=&nbsp;B).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4117992">//&nbsp;This&nbsp;is&nbsp;2&nbsp;or&nbsp;3&nbsp;more&nbsp;than&nbsp;the&nbsp;float64&nbsp;mantissa&nbsp;field&nbsp;width&nbsp;of&nbsp;Msize:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4118064">//&nbsp;-&nbsp;the&nbsp;optional&nbsp;extra&nbsp;bit&nbsp;is&nbsp;shifted&nbsp;away&nbsp;in&nbsp;step&nbsp;3&nbsp;below.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4118126">//&nbsp;-&nbsp;the&nbsp;high-order&nbsp;1&nbsp;is&nbsp;omitted&nbsp;in&nbsp;&#34;normal&#34;&nbsp;representation;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4118188">//&nbsp;-&nbsp;the&nbsp;low-order&nbsp;1&nbsp;will&nbsp;be&nbsp;used&nbsp;during&nbsp;rounding&nbsp;then&nbsp;discarded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4118255">exp</span>&nbsp;<span class="op" id="4118259">:=</span>&nbsp;<span class="ident" id="4118262">alen</span>&nbsp;<span class="op" id="4118267">-</span>&nbsp;<span class="ident" id="4118269">blen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4118275">var</span>&nbsp;<span class="ident" id="4118279">a2</span><span class="op" id="4118281">,</span>&nbsp;<span class="ident" id="4118283">b2</span>&nbsp;<span class="ident" id="4118286">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4118291">a2</span>&nbsp;<span class="op" id="4118294">=</span>&nbsp;<span class="ident" id="4118296">a2</span><span class="op" id="4118298">.</span><span class="ident" id="4118299">set</span><span class="op" id="4118302">(</span><span class="ident" id="4118303">a</span><span class="op" id="4118304">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4118307">b2</span>&nbsp;<span class="op" id="4118310">=</span>&nbsp;<span class="ident" id="4118312">b2</span><span class="op" id="4118314">.</span><span class="ident" id="4118315">set</span><span class="op" id="4118318">(</span><span class="ident" id="4118319">b</span><span class="op" id="4118320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4118323">if</span>&nbsp;<span class="ident" id="4118326">shift</span>&nbsp;<span class="op" id="4118332">:=</span>&nbsp;<span class="ident" id="4118335">Msize2</span>&nbsp;<span class="op" id="4118342">-</span>&nbsp;<span class="ident" id="4118344">exp</span><span class="op" id="4118347">;</span>&nbsp;<span class="ident" id="4118349">shift</span>&nbsp;<span class="op" id="4118355">&gt;</span>&nbsp;<span class="num" id="4118357">0</span>&nbsp;<span class="op" id="4118359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4118363">a2</span>&nbsp;<span class="op" id="4118366">=</span>&nbsp;<span class="ident" id="4118368">a2</span><span class="op" id="4118370">.</span><span class="ident" id="4118371">shl</span><span class="op" id="4118374">(</span><span class="ident" id="4118375">a2</span><span class="op" id="4118377">,</span>&nbsp;<span class="builtintype" id="4118379">uint</span><span class="op" id="4118383">(</span><span class="ident" id="4118384">shift</span><span class="op" id="4118389">)</span><span class="op" id="4118390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4118393">}</span>&nbsp;<span class="keyword" id="4118395">else</span>&nbsp;<span class="keyword" id="4118400">if</span>&nbsp;<span class="ident" id="4118403">shift</span>&nbsp;<span class="op" id="4118409">&lt;</span>&nbsp;<span class="num" id="4118411">0</span>&nbsp;<span class="op" id="4118413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4118417">b2</span>&nbsp;<span class="op" id="4118420">=</span>&nbsp;<span class="ident" id="4118422">b2</span><span class="op" id="4118424">.</span><span class="ident" id="4118425">shl</span><span class="op" id="4118428">(</span><span class="ident" id="4118429">b2</span><span class="op" id="4118431">,</span>&nbsp;<span class="builtintype" id="4118433">uint</span><span class="op" id="4118437">(</span><span class="op" id="4118438">-</span><span class="ident" id="4118439">shift</span><span class="op" id="4118444">)</span><span class="op" id="4118445">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4118448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4118452">//&nbsp;2.&nbsp;Compute&nbsp;quotient&nbsp;and&nbsp;remainder&nbsp;(q,&nbsp;r).&nbsp;&nbsp;NB:&nbsp;due&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4118514">//&nbsp;extra&nbsp;shift,&nbsp;the&nbsp;low-order&nbsp;bit&nbsp;of&nbsp;q&nbsp;is&nbsp;logically&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4118571">//&nbsp;high-order&nbsp;bit&nbsp;of&nbsp;r.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4118596">var</span>&nbsp;<span class="ident" id="4118600">q</span>&nbsp;<span class="ident" id="4118602">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4118607">q</span><span class="op" id="4118608">,</span>&nbsp;<span class="ident" id="4118610">r</span>&nbsp;<span class="op" id="4118612">:=</span>&nbsp;<span class="ident" id="4118615">q</span><span class="op" id="4118616">.</span><span class="ident" id="4118617">div</span><span class="op" id="4118620">(</span><span class="ident" id="4118621">a2</span><span class="op" id="4118623">,</span>&nbsp;<span class="ident" id="4118625">a2</span><span class="op" id="4118627">,</span>&nbsp;<span class="ident" id="4118629">b2</span><span class="op" id="4118631">)</span>&nbsp;<span class="comment" id="4118633">//&nbsp;(recycle&nbsp;a2)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4118650">mantissa</span>&nbsp;<span class="op" id="4118659">:=</span>&nbsp;<span class="ident" id="4118662">low64</span><span class="op" id="4118667">(</span><span class="ident" id="4118668">q</span><span class="op" id="4118669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4118672">haveRem</span>&nbsp;<span class="op" id="4118680">:=</span>&nbsp;<span class="builtinfunc" id="4118683">len</span><span class="op" id="4118686">(</span><span class="ident" id="4118687">r</span><span class="op" id="4118688">)</span>&nbsp;<span class="op" id="4118690">&gt;</span>&nbsp;<span class="num" id="4118692">0</span>&nbsp;<span class="comment" id="4118694">//&nbsp;mantissa&amp;1&nbsp;&amp;&amp;&nbsp;!haveRem&nbsp;=&gt;&nbsp;remainder&nbsp;is&nbsp;exactly&nbsp;half</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4118751">//&nbsp;3.&nbsp;If&nbsp;quotient&nbsp;didn&#39;t&nbsp;fit&nbsp;in&nbsp;Msize2&nbsp;bits,&nbsp;redo&nbsp;division&nbsp;by&nbsp;b2&lt;&lt;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4118820">//&nbsp;(in&nbsp;effect---we&nbsp;accomplish&nbsp;this&nbsp;incrementally).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4118872">if</span>&nbsp;<span class="ident" id="4118875">mantissa</span><span class="op" id="4118883">&gt;&gt;</span><span class="ident" id="4118885">Msize2</span>&nbsp;<span class="op" id="4118892">==</span>&nbsp;<span class="num" id="4118895">1</span>&nbsp;<span class="op" id="4118897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4118901">if</span>&nbsp;<span class="ident" id="4118904">mantissa</span><span class="op" id="4118912">&amp;</span><span class="num" id="4118913">1</span>&nbsp;<span class="op" id="4118915">==</span>&nbsp;<span class="num" id="4118918">1</span>&nbsp;<span class="op" id="4118920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4118925">haveRem</span>&nbsp;<span class="op" id="4118933">=</span>&nbsp;<span class="builtintype" id="4118935">true</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4118942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4118946">mantissa</span>&nbsp;<span class="op" id="4118955">&gt;&gt;=</span>&nbsp;<span class="num" id="4118959">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4118963">exp</span><span class="op" id="4118966">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4118970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4118973">if</span>&nbsp;<span class="ident" id="4118976">mantissa</span><span class="op" id="4118984">&gt;&gt;</span><span class="ident" id="4118986">Msize1</span>&nbsp;<span class="op" id="4118993">!=</span>&nbsp;<span class="num" id="4118996">1</span>&nbsp;<span class="op" id="4118998">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4119002">panic</span><span class="op" id="4119007">(</span><span class="ident" id="4119008">fmt</span><span class="op" id="4119011">.</span><span class="ident" id="4119012">Sprintf</span><span class="op" id="4119019">(</span><span class="string" id="4119020">&#34;expected&nbsp;exactly&nbsp;%d&nbsp;bits&nbsp;of&nbsp;result&#34;</span><span class="op" id="4119056">,</span>&nbsp;<span class="ident" id="4119058">Msize2</span><span class="op" id="4119064">)</span><span class="op" id="4119065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4119068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4119072">//&nbsp;4.&nbsp;Rounding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4119089">if</span>&nbsp;<span class="ident" id="4119092">Emin</span><span class="op" id="4119096">-</span><span class="ident" id="4119097">Msize</span>&nbsp;<span class="op" id="4119103">&lt;=</span>&nbsp;<span class="ident" id="4119106">exp</span>&nbsp;<span class="op" id="4119110">&amp;&amp;</span>&nbsp;<span class="ident" id="4119113">exp</span>&nbsp;<span class="op" id="4119117">&lt;=</span>&nbsp;<span class="ident" id="4119120">Emin</span>&nbsp;<span class="op" id="4119125">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4119129">//&nbsp;Denormal&nbsp;case;&nbsp;lose&nbsp;&#39;shift&#39;&nbsp;bits&nbsp;of&nbsp;precision.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4119181">shift</span>&nbsp;<span class="op" id="4119187">:=</span>&nbsp;<span class="builtintype" id="4119190">uint</span><span class="op" id="4119194">(</span><span class="ident" id="4119195">Emin</span>&nbsp;<span class="op" id="4119200">-</span>&nbsp;<span class="op" id="4119202">(</span><span class="ident" id="4119203">exp</span>&nbsp;<span class="op" id="4119207">-</span>&nbsp;<span class="num" id="4119209">1</span><span class="op" id="4119210">)</span><span class="op" id="4119211">)</span>&nbsp;<span class="comment" id="4119213">//&nbsp;[1..Esize1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4119230">lostbits</span>&nbsp;<span class="op" id="4119239">:=</span>&nbsp;<span class="ident" id="4119242">mantissa</span>&nbsp;<span class="op" id="4119251">&amp;</span>&nbsp;<span class="op" id="4119253">(</span><span class="num" id="4119254">1</span><span class="op" id="4119255">&lt;&lt;</span><span class="ident" id="4119257">shift</span>&nbsp;<span class="op" id="4119263">-</span>&nbsp;<span class="num" id="4119265">1</span><span class="op" id="4119266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4119270">haveRem</span>&nbsp;<span class="op" id="4119278">=</span>&nbsp;<span class="ident" id="4119280">haveRem</span>&nbsp;<span class="op" id="4119288">||</span>&nbsp;<span class="ident" id="4119291">lostbits</span>&nbsp;<span class="op" id="4119300">!=</span>&nbsp;<span class="num" id="4119303">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4119307">mantissa</span>&nbsp;<span class="op" id="4119316">&gt;&gt;=</span>&nbsp;<span class="ident" id="4119320">shift</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4119328">exp</span>&nbsp;<span class="op" id="4119332">=</span>&nbsp;<span class="num" id="4119334">2</span>&nbsp;<span class="op" id="4119336">-</span>&nbsp;<span class="ident" id="4119338">Ebias</span>&nbsp;<span class="comment" id="4119344">//&nbsp;==&nbsp;exp&nbsp;+&nbsp;shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4119363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4119366">//&nbsp;Round&nbsp;q&nbsp;using&nbsp;round-half-to-even.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4119404">exact</span>&nbsp;<span class="op" id="4119410">=</span>&nbsp;<span class="op" id="4119412">!</span><span class="ident" id="4119413">haveRem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4119422">if</span>&nbsp;<span class="ident" id="4119425">mantissa</span><span class="op" id="4119433">&amp;</span><span class="num" id="4119434">1</span>&nbsp;<span class="op" id="4119436">!=</span>&nbsp;<span class="num" id="4119439">0</span>&nbsp;<span class="op" id="4119441">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4119445">exact</span>&nbsp;<span class="op" id="4119451">=</span>&nbsp;<span class="builtintype" id="4119453">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4119461">if</span>&nbsp;<span class="ident" id="4119464">haveRem</span>&nbsp;<span class="op" id="4119472">||</span>&nbsp;<span class="ident" id="4119475">mantissa</span><span class="op" id="4119483">&amp;</span><span class="num" id="4119484">2</span>&nbsp;<span class="op" id="4119486">!=</span>&nbsp;<span class="num" id="4119489">0</span>&nbsp;<span class="op" id="4119491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4119496">if</span>&nbsp;<span class="ident" id="4119499">mantissa</span><span class="op" id="4119507">++</span><span class="op" id="4119509">;</span>&nbsp;<span class="ident" id="4119511">mantissa</span>&nbsp;<span class="op" id="4119520">&gt;=</span>&nbsp;<span class="num" id="4119523">1</span><span class="op" id="4119524">&lt;&lt;</span><span class="ident" id="4119526">Msize2</span>&nbsp;<span class="op" id="4119533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4119539">//&nbsp;Complete&nbsp;rollover&nbsp;11...1&nbsp;=&gt;&nbsp;100...0,&nbsp;so&nbsp;shift&nbsp;is&nbsp;safe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4119600">mantissa</span>&nbsp;<span class="op" id="4119609">&gt;&gt;=</span>&nbsp;<span class="num" id="4119613">1</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4119619">exp</span><span class="op" id="4119622">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4119628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4119632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4119635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4119638">mantissa</span>&nbsp;<span class="op" id="4119647">&gt;&gt;=</span>&nbsp;<span class="num" id="4119651">1</span>&nbsp;<span class="comment" id="4119653">//&nbsp;discard&nbsp;rounding&nbsp;bit.&nbsp;&nbsp;Mantissa&nbsp;now&nbsp;scaled&nbsp;by&nbsp;1&lt;&lt;Msize1.</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4119715">f</span>&nbsp;<span class="op" id="4119717">=</span>&nbsp;<span class="ident" id="4119719">math</span><span class="op" id="4119723">.</span><span class="ident" id="4119724">Ldexp</span><span class="op" id="4119729">(</span><span class="builtintype" id="4119730">float64</span><span class="op" id="4119737">(</span><span class="ident" id="4119738">mantissa</span><span class="op" id="4119746">)</span><span class="op" id="4119747">,</span>&nbsp;<span class="ident" id="4119749">exp</span><span class="op" id="4119752">-</span><span class="ident" id="4119753">Msize1</span><span class="op" id="4119759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4119762">if</span>&nbsp;<span class="ident" id="4119765">math</span><span class="op" id="4119769">.</span><span class="ident" id="4119770">IsInf</span><span class="op" id="4119775">(</span><span class="ident" id="4119776">f</span><span class="op" id="4119777">,</span>&nbsp;<span class="num" id="4119779">0</span><span class="op" id="4119780">)</span>&nbsp;<span class="op" id="4119782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4119786">exact</span>&nbsp;<span class="op" id="4119792">=</span>&nbsp;<span class="builtintype" id="4119794">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4119801">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4119804">return</span><br>
<span class="lineno"></span><span class="op" id="4119811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4119814">//&nbsp;Float32&nbsp;returns&nbsp;the&nbsp;nearest&nbsp;float32&nbsp;value&nbsp;for&nbsp;x&nbsp;and&nbsp;a&nbsp;bool&nbsp;indicating</span><br>
<span class="lineno"></span><span class="comment" id="4119887">//&nbsp;whether&nbsp;f&nbsp;represents&nbsp;x&nbsp;exactly.&nbsp;If&nbsp;the&nbsp;magnitude&nbsp;of&nbsp;x&nbsp;is&nbsp;too&nbsp;large&nbsp;to</span><br>
<span class="lineno">265</span><span class="comment" id="4119960">//&nbsp;be&nbsp;represented&nbsp;by&nbsp;a&nbsp;float32,&nbsp;f&nbsp;is&nbsp;an&nbsp;infinity&nbsp;and&nbsp;exact&nbsp;is&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="4120029">//&nbsp;The&nbsp;sign&nbsp;of&nbsp;f&nbsp;always&nbsp;matches&nbsp;the&nbsp;sign&nbsp;of&nbsp;x,&nbsp;even&nbsp;if&nbsp;f&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="4120092">func</span>&nbsp;<span class="op" id="4120097">(</span><span class="ident" id="4120098">x</span>&nbsp;<span class="op" id="4120100">*</span><span class="ident" id="4120101">Rat</span><span class="op" id="4120104">)</span>&nbsp;<span class="ident" id="4120106">Float32</span><span class="op" id="4120113">(</span><span class="op" id="4120114">)</span>&nbsp;<span class="op" id="4120116">(</span><span class="ident" id="4120117">f</span>&nbsp;<span class="builtintype" id="4120119">float32</span><span class="op" id="4120126">,</span>&nbsp;<span class="ident" id="4120128">exact</span>&nbsp;<span class="builtintype" id="4120134">bool</span><span class="op" id="4120138">)</span>&nbsp;<span class="op" id="4120140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4120143">b</span>&nbsp;<span class="op" id="4120145">:=</span>&nbsp;<span class="ident" id="4120148">x</span><span class="op" id="4120149">.</span><span class="ident" id="4120150">b</span><span class="op" id="4120151">.</span><span class="ident" id="4120152">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4120157">if</span>&nbsp;<span class="builtinfunc" id="4120160">len</span><span class="op" id="4120163">(</span><span class="ident" id="4120164">b</span><span class="op" id="4120165">)</span>&nbsp;<span class="op" id="4120167">==</span>&nbsp;<span class="num" id="4120170">0</span>&nbsp;<span class="op" id="4120172">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4120176">b</span>&nbsp;<span class="op" id="4120178">=</span>&nbsp;<span class="ident" id="4120180">b</span><span class="op" id="4120181">.</span><span class="ident" id="4120182">set</span><span class="op" id="4120185">(</span><span class="ident" id="4120186">natOne</span><span class="op" id="4120192">)</span>&nbsp;<span class="comment" id="4120194">//&nbsp;materialize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4120222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4120225">f</span><span class="op" id="4120226">,</span>&nbsp;<span class="ident" id="4120228">exact</span>&nbsp;<span class="op" id="4120234">=</span>&nbsp;<span class="ident" id="4120236">quotToFloat32</span><span class="op" id="4120249">(</span><span class="ident" id="4120250">x</span><span class="op" id="4120251">.</span><span class="ident" id="4120252">a</span><span class="op" id="4120253">.</span><span class="ident" id="4120254">abs</span><span class="op" id="4120257">,</span>&nbsp;<span class="ident" id="4120259">b</span><span class="op" id="4120260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4120263">if</span>&nbsp;<span class="ident" id="4120266">x</span><span class="op" id="4120267">.</span><span class="ident" id="4120268">a</span><span class="op" id="4120269">.</span><span class="ident" id="4120270">neg</span>&nbsp;<span class="op" id="4120274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4120278">f</span>&nbsp;<span class="op" id="4120280">=</span>&nbsp;<span class="op" id="4120282">-</span><span class="ident" id="4120283">f</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4120286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4120289">return</span><br>
<span class="lineno"></span><span class="op" id="4120296">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4120299">//&nbsp;Float64&nbsp;returns&nbsp;the&nbsp;nearest&nbsp;float64&nbsp;value&nbsp;for&nbsp;x&nbsp;and&nbsp;a&nbsp;bool&nbsp;indicating</span><br>
<span class="lineno">280</span><span class="comment" id="4120372">//&nbsp;whether&nbsp;f&nbsp;represents&nbsp;x&nbsp;exactly.&nbsp;If&nbsp;the&nbsp;magnitude&nbsp;of&nbsp;x&nbsp;is&nbsp;too&nbsp;large&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4120445">//&nbsp;be&nbsp;represented&nbsp;by&nbsp;a&nbsp;float64,&nbsp;f&nbsp;is&nbsp;an&nbsp;infinity&nbsp;and&nbsp;exact&nbsp;is&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="4120514">//&nbsp;The&nbsp;sign&nbsp;of&nbsp;f&nbsp;always&nbsp;matches&nbsp;the&nbsp;sign&nbsp;of&nbsp;x,&nbsp;even&nbsp;if&nbsp;f&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="4120577">func</span>&nbsp;<span class="op" id="4120582">(</span><span class="ident" id="4120583">x</span>&nbsp;<span class="op" id="4120585">*</span><span class="ident" id="4120586">Rat</span><span class="op" id="4120589">)</span>&nbsp;<span class="ident" id="4120591">Float64</span><span class="op" id="4120598">(</span><span class="op" id="4120599">)</span>&nbsp;<span class="op" id="4120601">(</span><span class="ident" id="4120602">f</span>&nbsp;<span class="builtintype" id="4120604">float64</span><span class="op" id="4120611">,</span>&nbsp;<span class="ident" id="4120613">exact</span>&nbsp;<span class="builtintype" id="4120619">bool</span><span class="op" id="4120623">)</span>&nbsp;<span class="op" id="4120625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4120628">b</span>&nbsp;<span class="op" id="4120630">:=</span>&nbsp;<span class="ident" id="4120633">x</span><span class="op" id="4120634">.</span><span class="ident" id="4120635">b</span><span class="op" id="4120636">.</span><span class="ident" id="4120637">abs</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4120642">if</span>&nbsp;<span class="builtinfunc" id="4120645">len</span><span class="op" id="4120648">(</span><span class="ident" id="4120649">b</span><span class="op" id="4120650">)</span>&nbsp;<span class="op" id="4120652">==</span>&nbsp;<span class="num" id="4120655">0</span>&nbsp;<span class="op" id="4120657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4120661">b</span>&nbsp;<span class="op" id="4120663">=</span>&nbsp;<span class="ident" id="4120665">b</span><span class="op" id="4120666">.</span><span class="ident" id="4120667">set</span><span class="op" id="4120670">(</span><span class="ident" id="4120671">natOne</span><span class="op" id="4120677">)</span>&nbsp;<span class="comment" id="4120679">//&nbsp;materialize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4120707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4120710">f</span><span class="op" id="4120711">,</span>&nbsp;<span class="ident" id="4120713">exact</span>&nbsp;<span class="op" id="4120719">=</span>&nbsp;<span class="ident" id="4120721">quotToFloat64</span><span class="op" id="4120734">(</span><span class="ident" id="4120735">x</span><span class="op" id="4120736">.</span><span class="ident" id="4120737">a</span><span class="op" id="4120738">.</span><span class="ident" id="4120739">abs</span><span class="op" id="4120742">,</span>&nbsp;<span class="ident" id="4120744">b</span><span class="op" id="4120745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4120748">if</span>&nbsp;<span class="ident" id="4120751">x</span><span class="op" id="4120752">.</span><span class="ident" id="4120753">a</span><span class="op" id="4120754">.</span><span class="ident" id="4120755">neg</span>&nbsp;<span class="op" id="4120759">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4120763">f</span>&nbsp;<span class="op" id="4120765">=</span>&nbsp;<span class="op" id="4120767">-</span><span class="ident" id="4120768">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4120771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4120774">return</span><br>
<span class="lineno"></span><span class="op" id="4120781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span><span class="comment" id="4120784">//&nbsp;SetFrac&nbsp;sets&nbsp;z&nbsp;to&nbsp;a/b&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="4120824">func</span>&nbsp;<span class="op" id="4120829">(</span><span class="ident" id="4120830">z</span>&nbsp;<span class="op" id="4120832">*</span><span class="ident" id="4120833">Rat</span><span class="op" id="4120836">)</span>&nbsp;<span class="ident" id="4120838">SetFrac</span><span class="op" id="4120845">(</span><span class="ident" id="4120846">a</span><span class="op" id="4120847">,</span>&nbsp;<span class="ident" id="4120849">b</span>&nbsp;<span class="op" id="4120851">*</span><span class="ident" id="4120852">Int</span><span class="op" id="4120855">)</span>&nbsp;<span class="op" id="4120857">*</span><span class="ident" id="4120858">Rat</span>&nbsp;<span class="op" id="4120862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4120865">z</span><span class="op" id="4120866">.</span><span class="ident" id="4120867">a</span><span class="op" id="4120868">.</span><span class="ident" id="4120869">neg</span>&nbsp;<span class="op" id="4120873">=</span>&nbsp;<span class="ident" id="4120875">a</span><span class="op" id="4120876">.</span><span class="ident" id="4120877">neg</span>&nbsp;<span class="op" id="4120881">!=</span>&nbsp;<span class="ident" id="4120884">b</span><span class="op" id="4120885">.</span><span class="ident" id="4120886">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4120891">babs</span>&nbsp;<span class="op" id="4120896">:=</span>&nbsp;<span class="ident" id="4120899">b</span><span class="op" id="4120900">.</span><span class="ident" id="4120901">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4120906">if</span>&nbsp;<span class="builtinfunc" id="4120909">len</span><span class="op" id="4120912">(</span><span class="ident" id="4120913">babs</span><span class="op" id="4120917">)</span>&nbsp;<span class="op" id="4120919">==</span>&nbsp;<span class="num" id="4120922">0</span>&nbsp;<span class="op" id="4120924">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4120928">panic</span><span class="op" id="4120933">(</span><span class="string" id="4120934">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="4120952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4120955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4120958">if</span>&nbsp;<span class="op" id="4120961">&amp;</span><span class="ident" id="4120962">z</span><span class="op" id="4120963">.</span><span class="ident" id="4120964">a</span>&nbsp;<span class="op" id="4120966">==</span>&nbsp;<span class="ident" id="4120969">b</span>&nbsp;<span class="op" id="4120971">||</span>&nbsp;<span class="ident" id="4120974">alias</span><span class="op" id="4120979">(</span><span class="ident" id="4120980">z</span><span class="op" id="4120981">.</span><span class="ident" id="4120982">a</span><span class="op" id="4120983">.</span><span class="ident" id="4120984">abs</span><span class="op" id="4120987">,</span>&nbsp;<span class="ident" id="4120989">babs</span><span class="op" id="4120993">)</span>&nbsp;<span class="op" id="4120995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4120999">babs</span>&nbsp;<span class="op" id="4121004">=</span>&nbsp;<span class="ident" id="4121006">nat</span><span class="op" id="4121009">(</span><span class="builtintype" id="4121010">nil</span><span class="op" id="4121013">)</span><span class="op" id="4121014">.</span><span class="ident" id="4121015">set</span><span class="op" id="4121018">(</span><span class="ident" id="4121019">babs</span><span class="op" id="4121023">)</span>&nbsp;<span class="comment" id="4121025">//&nbsp;make&nbsp;a&nbsp;copy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4121041">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4121044">z</span><span class="op" id="4121045">.</span><span class="ident" id="4121046">a</span><span class="op" id="4121047">.</span><span class="ident" id="4121048">abs</span>&nbsp;<span class="op" id="4121052">=</span>&nbsp;<span class="ident" id="4121054">z</span><span class="op" id="4121055">.</span><span class="ident" id="4121056">a</span><span class="op" id="4121057">.</span><span class="ident" id="4121058">abs</span><span class="op" id="4121061">.</span><span class="ident" id="4121062">set</span><span class="op" id="4121065">(</span><span class="ident" id="4121066">a</span><span class="op" id="4121067">.</span><span class="ident" id="4121068">abs</span><span class="op" id="4121071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4121074">z</span><span class="op" id="4121075">.</span><span class="ident" id="4121076">b</span><span class="op" id="4121077">.</span><span class="ident" id="4121078">abs</span>&nbsp;<span class="op" id="4121082">=</span>&nbsp;<span class="ident" id="4121084">z</span><span class="op" id="4121085">.</span><span class="ident" id="4121086">b</span><span class="op" id="4121087">.</span><span class="ident" id="4121088">abs</span><span class="op" id="4121091">.</span><span class="ident" id="4121092">set</span><span class="op" id="4121095">(</span><span class="ident" id="4121096">babs</span><span class="op" id="4121100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4121103">return</span>&nbsp;<span class="ident" id="4121110">z</span><span class="op" id="4121111">.</span><span class="ident" id="4121112">norm</span><span class="op" id="4121116">(</span><span class="op" id="4121117">)</span><br>
<span class="lineno"></span><span class="op" id="4121119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="comment" id="4121122">//&nbsp;SetFrac64&nbsp;sets&nbsp;z&nbsp;to&nbsp;a/b&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="4121164">func</span>&nbsp;<span class="op" id="4121169">(</span><span class="ident" id="4121170">z</span>&nbsp;<span class="op" id="4121172">*</span><span class="ident" id="4121173">Rat</span><span class="op" id="4121176">)</span>&nbsp;<span class="ident" id="4121178">SetFrac64</span><span class="op" id="4121187">(</span><span class="ident" id="4121188">a</span><span class="op" id="4121189">,</span>&nbsp;<span class="ident" id="4121191">b</span>&nbsp;<span class="builtintype" id="4121193">int64</span><span class="op" id="4121198">)</span>&nbsp;<span class="op" id="4121200">*</span><span class="ident" id="4121201">Rat</span>&nbsp;<span class="op" id="4121205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4121208">z</span><span class="op" id="4121209">.</span><span class="ident" id="4121210">a</span><span class="op" id="4121211">.</span><span class="ident" id="4121212">SetInt64</span><span class="op" id="4121220">(</span><span class="ident" id="4121221">a</span><span class="op" id="4121222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4121225">if</span>&nbsp;<span class="ident" id="4121228">b</span>&nbsp;<span class="op" id="4121230">==</span>&nbsp;<span class="num" id="4121233">0</span>&nbsp;<span class="op" id="4121235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4121239">panic</span><span class="op" id="4121244">(</span><span class="string" id="4121245">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="4121263">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4121266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4121269">if</span>&nbsp;<span class="ident" id="4121272">b</span>&nbsp;<span class="op" id="4121274">&lt;</span>&nbsp;<span class="num" id="4121276">0</span>&nbsp;<span class="op" id="4121278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4121282">b</span>&nbsp;<span class="op" id="4121284">=</span>&nbsp;<span class="op" id="4121286">-</span><span class="ident" id="4121287">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4121291">z</span><span class="op" id="4121292">.</span><span class="ident" id="4121293">a</span><span class="op" id="4121294">.</span><span class="ident" id="4121295">neg</span>&nbsp;<span class="op" id="4121299">=</span>&nbsp;<span class="op" id="4121301">!</span><span class="ident" id="4121302">z</span><span class="op" id="4121303">.</span><span class="ident" id="4121304">a</span><span class="op" id="4121305">.</span><span class="ident" id="4121306">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4121311">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4121314">z</span><span class="op" id="4121315">.</span><span class="ident" id="4121316">b</span><span class="op" id="4121317">.</span><span class="ident" id="4121318">abs</span>&nbsp;<span class="op" id="4121322">=</span>&nbsp;<span class="ident" id="4121324">z</span><span class="op" id="4121325">.</span><span class="ident" id="4121326">b</span><span class="op" id="4121327">.</span><span class="ident" id="4121328">abs</span><span class="op" id="4121331">.</span><span class="ident" id="4121332">setUint64</span><span class="op" id="4121341">(</span><span class="builtintype" id="4121342">uint64</span><span class="op" id="4121348">(</span><span class="ident" id="4121349">b</span><span class="op" id="4121350">)</span><span class="op" id="4121351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4121354">return</span>&nbsp;<span class="ident" id="4121361">z</span><span class="op" id="4121362">.</span><span class="ident" id="4121363">norm</span><span class="op" id="4121367">(</span><span class="op" id="4121368">)</span><br>
<span class="lineno"></span><span class="op" id="4121370">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4121373">//&nbsp;SetInt&nbsp;sets&nbsp;z&nbsp;to&nbsp;x&nbsp;(by&nbsp;making&nbsp;a&nbsp;copy&nbsp;of&nbsp;x)&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno">325</span><span class="keyword" id="4121434">func</span>&nbsp;<span class="op" id="4121439">(</span><span class="ident" id="4121440">z</span>&nbsp;<span class="op" id="4121442">*</span><span class="ident" id="4121443">Rat</span><span class="op" id="4121446">)</span>&nbsp;<span class="ident" id="4121448">SetInt</span><span class="op" id="4121454">(</span><span class="ident" id="4121455">x</span>&nbsp;<span class="op" id="4121457">*</span><span class="ident" id="4121458">Int</span><span class="op" id="4121461">)</span>&nbsp;<span class="op" id="4121463">*</span><span class="ident" id="4121464">Rat</span>&nbsp;<span class="op" id="4121468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4121471">z</span><span class="op" id="4121472">.</span><span class="ident" id="4121473">a</span><span class="op" id="4121474">.</span><span class="ident" id="4121475">Set</span><span class="op" id="4121478">(</span><span class="ident" id="4121479">x</span><span class="op" id="4121480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4121483">z</span><span class="op" id="4121484">.</span><span class="ident" id="4121485">b</span><span class="op" id="4121486">.</span><span class="ident" id="4121487">abs</span>&nbsp;<span class="op" id="4121491">=</span>&nbsp;<span class="ident" id="4121493">z</span><span class="op" id="4121494">.</span><span class="ident" id="4121495">b</span><span class="op" id="4121496">.</span><span class="ident" id="4121497">abs</span><span class="op" id="4121500">.</span><span class="builtinfunc" id="4121501">make</span><span class="op" id="4121505">(</span><span class="num" id="4121506">0</span><span class="op" id="4121507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4121510">return</span>&nbsp;<span class="ident" id="4121517">z</span><br>
<span class="lineno"></span><span class="op" id="4121519">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="comment" id="4121522">//&nbsp;SetInt64&nbsp;sets&nbsp;z&nbsp;to&nbsp;x&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="4121561">func</span>&nbsp;<span class="op" id="4121566">(</span><span class="ident" id="4121567">z</span>&nbsp;<span class="op" id="4121569">*</span><span class="ident" id="4121570">Rat</span><span class="op" id="4121573">)</span>&nbsp;<span class="ident" id="4121575">SetInt64</span><span class="op" id="4121583">(</span><span class="ident" id="4121584">x</span>&nbsp;<span class="builtintype" id="4121586">int64</span><span class="op" id="4121591">)</span>&nbsp;<span class="op" id="4121593">*</span><span class="ident" id="4121594">Rat</span>&nbsp;<span class="op" id="4121598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4121601">z</span><span class="op" id="4121602">.</span><span class="ident" id="4121603">a</span><span class="op" id="4121604">.</span><span class="ident" id="4121605">SetInt64</span><span class="op" id="4121613">(</span><span class="ident" id="4121614">x</span><span class="op" id="4121615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4121618">z</span><span class="op" id="4121619">.</span><span class="ident" id="4121620">b</span><span class="op" id="4121621">.</span><span class="ident" id="4121622">abs</span>&nbsp;<span class="op" id="4121626">=</span>&nbsp;<span class="ident" id="4121628">z</span><span class="op" id="4121629">.</span><span class="ident" id="4121630">b</span><span class="op" id="4121631">.</span><span class="ident" id="4121632">abs</span><span class="op" id="4121635">.</span><span class="builtinfunc" id="4121636">make</span><span class="op" id="4121640">(</span><span class="num" id="4121641">0</span><span class="op" id="4121642">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4121645">return</span>&nbsp;<span class="ident" id="4121652">z</span><br>
<span class="lineno"></span><span class="op" id="4121654">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4121657">//&nbsp;Set&nbsp;sets&nbsp;z&nbsp;to&nbsp;x&nbsp;(by&nbsp;making&nbsp;a&nbsp;copy&nbsp;of&nbsp;x)&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="4121715">func</span>&nbsp;<span class="op" id="4121720">(</span><span class="ident" id="4121721">z</span>&nbsp;<span class="op" id="4121723">*</span><span class="ident" id="4121724">Rat</span><span class="op" id="4121727">)</span>&nbsp;<span class="ident" id="4121729">Set</span><span class="op" id="4121732">(</span><span class="ident" id="4121733">x</span>&nbsp;<span class="op" id="4121735">*</span><span class="ident" id="4121736">Rat</span><span class="op" id="4121739">)</span>&nbsp;<span class="op" id="4121741">*</span><span class="ident" id="4121742">Rat</span>&nbsp;<span class="op" id="4121746">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4121749">if</span>&nbsp;<span class="ident" id="4121752">z</span>&nbsp;<span class="op" id="4121754">!=</span>&nbsp;<span class="ident" id="4121757">x</span>&nbsp;<span class="op" id="4121759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4121763">z</span><span class="op" id="4121764">.</span><span class="ident" id="4121765">a</span><span class="op" id="4121766">.</span><span class="ident" id="4121767">Set</span><span class="op" id="4121770">(</span><span class="op" id="4121771">&amp;</span><span class="ident" id="4121772">x</span><span class="op" id="4121773">.</span><span class="ident" id="4121774">a</span><span class="op" id="4121775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4121779">z</span><span class="op" id="4121780">.</span><span class="ident" id="4121781">b</span><span class="op" id="4121782">.</span><span class="ident" id="4121783">Set</span><span class="op" id="4121786">(</span><span class="op" id="4121787">&amp;</span><span class="ident" id="4121788">x</span><span class="op" id="4121789">.</span><span class="ident" id="4121790">b</span><span class="op" id="4121791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4121794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4121797">return</span>&nbsp;<span class="ident" id="4121804">z</span><br>
<span class="lineno">345</span><span class="op" id="4121806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4121809">//&nbsp;Abs&nbsp;sets&nbsp;z&nbsp;to&nbsp;|x|&nbsp;(the&nbsp;absolute&nbsp;value&nbsp;of&nbsp;x)&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="4121871">func</span>&nbsp;<span class="op" id="4121876">(</span><span class="ident" id="4121877">z</span>&nbsp;<span class="op" id="4121879">*</span><span class="ident" id="4121880">Rat</span><span class="op" id="4121883">)</span>&nbsp;<span class="ident" id="4121885">Abs</span><span class="op" id="4121888">(</span><span class="ident" id="4121889">x</span>&nbsp;<span class="op" id="4121891">*</span><span class="ident" id="4121892">Rat</span><span class="op" id="4121895">)</span>&nbsp;<span class="op" id="4121897">*</span><span class="ident" id="4121898">Rat</span>&nbsp;<span class="op" id="4121902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4121905">z</span><span class="op" id="4121906">.</span><span class="ident" id="4121907">Set</span><span class="op" id="4121910">(</span><span class="ident" id="4121911">x</span><span class="op" id="4121912">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4121915">z</span><span class="op" id="4121916">.</span><span class="ident" id="4121917">a</span><span class="op" id="4121918">.</span><span class="ident" id="4121919">neg</span>&nbsp;<span class="op" id="4121923">=</span>&nbsp;<span class="builtintype" id="4121925">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4121932">return</span>&nbsp;<span class="ident" id="4121939">z</span><br>
<span class="lineno"></span><span class="op" id="4121941">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4121944">//&nbsp;Neg&nbsp;sets&nbsp;z&nbsp;to&nbsp;-x&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno">355</span><span class="keyword" id="4121979">func</span>&nbsp;<span class="op" id="4121984">(</span><span class="ident" id="4121985">z</span>&nbsp;<span class="op" id="4121987">*</span><span class="ident" id="4121988">Rat</span><span class="op" id="4121991">)</span>&nbsp;<span class="ident" id="4121993">Neg</span><span class="op" id="4121996">(</span><span class="ident" id="4121997">x</span>&nbsp;<span class="op" id="4121999">*</span><span class="ident" id="4122000">Rat</span><span class="op" id="4122003">)</span>&nbsp;<span class="op" id="4122005">*</span><span class="ident" id="4122006">Rat</span>&nbsp;<span class="op" id="4122010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4122013">z</span><span class="op" id="4122014">.</span><span class="ident" id="4122015">Set</span><span class="op" id="4122018">(</span><span class="ident" id="4122019">x</span><span class="op" id="4122020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4122023">z</span><span class="op" id="4122024">.</span><span class="ident" id="4122025">a</span><span class="op" id="4122026">.</span><span class="ident" id="4122027">neg</span>&nbsp;<span class="op" id="4122031">=</span>&nbsp;<span class="builtinfunc" id="4122033">len</span><span class="op" id="4122036">(</span><span class="ident" id="4122037">z</span><span class="op" id="4122038">.</span><span class="ident" id="4122039">a</span><span class="op" id="4122040">.</span><span class="ident" id="4122041">abs</span><span class="op" id="4122044">)</span>&nbsp;<span class="op" id="4122046">&gt;</span>&nbsp;<span class="num" id="4122048">0</span>&nbsp;<span class="op" id="4122050">&amp;&amp;</span>&nbsp;<span class="op" id="4122053">!</span><span class="ident" id="4122054">z</span><span class="op" id="4122055">.</span><span class="ident" id="4122056">a</span><span class="op" id="4122057">.</span><span class="ident" id="4122058">neg</span>&nbsp;<span class="comment" id="4122062">//&nbsp;0&nbsp;has&nbsp;no&nbsp;sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4122080">return</span>&nbsp;<span class="ident" id="4122087">z</span><br>
<span class="lineno"></span><span class="op" id="4122089">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="comment" id="4122092">//&nbsp;Inv&nbsp;sets&nbsp;z&nbsp;to&nbsp;1/x&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="4122128">func</span>&nbsp;<span class="op" id="4122133">(</span><span class="ident" id="4122134">z</span>&nbsp;<span class="op" id="4122136">*</span><span class="ident" id="4122137">Rat</span><span class="op" id="4122140">)</span>&nbsp;<span class="ident" id="4122142">Inv</span><span class="op" id="4122145">(</span><span class="ident" id="4122146">x</span>&nbsp;<span class="op" id="4122148">*</span><span class="ident" id="4122149">Rat</span><span class="op" id="4122152">)</span>&nbsp;<span class="op" id="4122154">*</span><span class="ident" id="4122155">Rat</span>&nbsp;<span class="op" id="4122159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4122162">if</span>&nbsp;<span class="builtinfunc" id="4122165">len</span><span class="op" id="4122168">(</span><span class="ident" id="4122169">x</span><span class="op" id="4122170">.</span><span class="ident" id="4122171">a</span><span class="op" id="4122172">.</span><span class="ident" id="4122173">abs</span><span class="op" id="4122176">)</span>&nbsp;<span class="op" id="4122178">==</span>&nbsp;<span class="num" id="4122181">0</span>&nbsp;<span class="op" id="4122183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4122187">panic</span><span class="op" id="4122192">(</span><span class="string" id="4122193">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="4122211">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4122214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4122217">z</span><span class="op" id="4122218">.</span><span class="ident" id="4122219">Set</span><span class="op" id="4122222">(</span><span class="ident" id="4122223">x</span><span class="op" id="4122224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4122227">a</span>&nbsp;<span class="op" id="4122229">:=</span>&nbsp;<span class="ident" id="4122232">z</span><span class="op" id="4122233">.</span><span class="ident" id="4122234">b</span><span class="op" id="4122235">.</span><span class="ident" id="4122236">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4122241">if</span>&nbsp;<span class="builtinfunc" id="4122244">len</span><span class="op" id="4122247">(</span><span class="ident" id="4122248">a</span><span class="op" id="4122249">)</span>&nbsp;<span class="op" id="4122251">==</span>&nbsp;<span class="num" id="4122254">0</span>&nbsp;<span class="op" id="4122256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4122260">a</span>&nbsp;<span class="op" id="4122262">=</span>&nbsp;<span class="ident" id="4122264">a</span><span class="op" id="4122265">.</span><span class="ident" id="4122266">set</span><span class="op" id="4122269">(</span><span class="ident" id="4122270">natOne</span><span class="op" id="4122276">)</span>&nbsp;<span class="comment" id="4122278">//&nbsp;materialize&nbsp;numerator</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4122304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4122307">b</span>&nbsp;<span class="op" id="4122309">:=</span>&nbsp;<span class="ident" id="4122312">z</span><span class="op" id="4122313">.</span><span class="ident" id="4122314">a</span><span class="op" id="4122315">.</span><span class="ident" id="4122316">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4122321">if</span>&nbsp;<span class="ident" id="4122324">b</span><span class="op" id="4122325">.</span><span class="ident" id="4122326">cmp</span><span class="op" id="4122329">(</span><span class="ident" id="4122330">natOne</span><span class="op" id="4122336">)</span>&nbsp;<span class="op" id="4122338">==</span>&nbsp;<span class="num" id="4122341">0</span>&nbsp;<span class="op" id="4122343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4122347">b</span>&nbsp;<span class="op" id="4122349">=</span>&nbsp;<span class="ident" id="4122351">b</span><span class="op" id="4122352">.</span><span class="builtinfunc" id="4122353">make</span><span class="op" id="4122357">(</span><span class="num" id="4122358">0</span><span class="op" id="4122359">)</span>&nbsp;<span class="comment" id="4122361">//&nbsp;normalize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4122387">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4122390">z</span><span class="op" id="4122391">.</span><span class="ident" id="4122392">a</span><span class="op" id="4122393">.</span><span class="ident" id="4122394">abs</span><span class="op" id="4122397">,</span>&nbsp;<span class="ident" id="4122399">z</span><span class="op" id="4122400">.</span><span class="ident" id="4122401">b</span><span class="op" id="4122402">.</span><span class="ident" id="4122403">abs</span>&nbsp;<span class="op" id="4122407">=</span>&nbsp;<span class="ident" id="4122409">a</span><span class="op" id="4122410">,</span>&nbsp;<span class="ident" id="4122412">b</span>&nbsp;<span class="comment" id="4122414">//&nbsp;sign&nbsp;doesn&#39;t&nbsp;change</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4122438">return</span>&nbsp;<span class="ident" id="4122445">z</span><br>
<span class="lineno"></span><span class="op" id="4122447">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4122450">//&nbsp;Sign&nbsp;returns:</span><br>
<span class="lineno">380</span><span class="comment" id="4122467">//</span><br>
<span class="lineno"></span><span class="comment" id="4122470">//&nbsp;&nbsp;&nbsp;&nbsp;-1&nbsp;if&nbsp;x&nbsp;&lt;&nbsp;&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="4122486">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;if&nbsp;x&nbsp;==&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="4122502">//&nbsp;&nbsp;&nbsp;&nbsp;+1&nbsp;if&nbsp;x&nbsp;&gt;&nbsp;&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="4122518">//</span><br>
<span class="lineno">385</span><span class="keyword" id="4122521">func</span>&nbsp;<span class="op" id="4122526">(</span><span class="ident" id="4122527">x</span>&nbsp;<span class="op" id="4122529">*</span><span class="ident" id="4122530">Rat</span><span class="op" id="4122533">)</span>&nbsp;<span class="ident" id="4122535">Sign</span><span class="op" id="4122539">(</span><span class="op" id="4122540">)</span>&nbsp;<span class="builtintype" id="4122542">int</span>&nbsp;<span class="op" id="4122546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4122549">return</span>&nbsp;<span class="ident" id="4122556">x</span><span class="op" id="4122557">.</span><span class="ident" id="4122558">a</span><span class="op" id="4122559">.</span><span class="ident" id="4122560">Sign</span><span class="op" id="4122564">(</span><span class="op" id="4122565">)</span><br>
<span class="lineno"></span><span class="op" id="4122567">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4122570">//&nbsp;IsInt&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;denominator&nbsp;of&nbsp;x&nbsp;is&nbsp;1.</span><br>
<span class="lineno">390</span><span class="keyword" id="4122622">func</span>&nbsp;<span class="op" id="4122627">(</span><span class="ident" id="4122628">x</span>&nbsp;<span class="op" id="4122630">*</span><span class="ident" id="4122631">Rat</span><span class="op" id="4122634">)</span>&nbsp;<span class="ident" id="4122636">IsInt</span><span class="op" id="4122641">(</span><span class="op" id="4122642">)</span>&nbsp;<span class="builtintype" id="4122644">bool</span>&nbsp;<span class="op" id="4122649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4122652">return</span>&nbsp;<span class="builtinfunc" id="4122659">len</span><span class="op" id="4122662">(</span><span class="ident" id="4122663">x</span><span class="op" id="4122664">.</span><span class="ident" id="4122665">b</span><span class="op" id="4122666">.</span><span class="ident" id="4122667">abs</span><span class="op" id="4122670">)</span>&nbsp;<span class="op" id="4122672">==</span>&nbsp;<span class="num" id="4122675">0</span>&nbsp;<span class="op" id="4122677">||</span>&nbsp;<span class="ident" id="4122680">x</span><span class="op" id="4122681">.</span><span class="ident" id="4122682">b</span><span class="op" id="4122683">.</span><span class="ident" id="4122684">abs</span><span class="op" id="4122687">.</span><span class="ident" id="4122688">cmp</span><span class="op" id="4122691">(</span><span class="ident" id="4122692">natOne</span><span class="op" id="4122698">)</span>&nbsp;<span class="op" id="4122700">==</span>&nbsp;<span class="num" id="4122703">0</span><br>
<span class="lineno"></span><span class="op" id="4122705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4122708">//&nbsp;Num&nbsp;returns&nbsp;the&nbsp;numerator&nbsp;of&nbsp;x;&nbsp;it&nbsp;may&nbsp;be&nbsp;&lt;=&nbsp;0.</span><br>
<span class="lineno">395</span><span class="comment" id="4122759">//&nbsp;The&nbsp;result&nbsp;is&nbsp;a&nbsp;reference&nbsp;to&nbsp;x&#39;s&nbsp;numerator;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="4122809">//&nbsp;may&nbsp;change&nbsp;if&nbsp;a&nbsp;new&nbsp;value&nbsp;is&nbsp;assigned&nbsp;to&nbsp;x,&nbsp;and&nbsp;vice&nbsp;versa.</span><br>
<span class="lineno"></span><span class="comment" id="4122872">//&nbsp;The&nbsp;sign&nbsp;of&nbsp;the&nbsp;numerator&nbsp;corresponds&nbsp;to&nbsp;the&nbsp;sign&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="4122931">func</span>&nbsp;<span class="op" id="4122936">(</span><span class="ident" id="4122937">x</span>&nbsp;<span class="op" id="4122939">*</span><span class="ident" id="4122940">Rat</span><span class="op" id="4122943">)</span>&nbsp;<span class="ident" id="4122945">Num</span><span class="op" id="4122948">(</span><span class="op" id="4122949">)</span>&nbsp;<span class="op" id="4122951">*</span><span class="ident" id="4122952">Int</span>&nbsp;<span class="op" id="4122956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4122959">return</span>&nbsp;<span class="op" id="4122966">&amp;</span><span class="ident" id="4122967">x</span><span class="op" id="4122968">.</span><span class="ident" id="4122969">a</span><br>
<span class="lineno">400</span><span class="op" id="4122971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4122974">//&nbsp;Denom&nbsp;returns&nbsp;the&nbsp;denominator&nbsp;of&nbsp;x;&nbsp;it&nbsp;is&nbsp;always&nbsp;&gt;&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="4123031">//&nbsp;The&nbsp;result&nbsp;is&nbsp;a&nbsp;reference&nbsp;to&nbsp;x&#39;s&nbsp;denominator;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="4123083">//&nbsp;may&nbsp;change&nbsp;if&nbsp;a&nbsp;new&nbsp;value&nbsp;is&nbsp;assigned&nbsp;to&nbsp;x,&nbsp;and&nbsp;vice&nbsp;versa.</span><br>
<span class="lineno">405</span><span class="keyword" id="4123146">func</span>&nbsp;<span class="op" id="4123151">(</span><span class="ident" id="4123152">x</span>&nbsp;<span class="op" id="4123154">*</span><span class="ident" id="4123155">Rat</span><span class="op" id="4123158">)</span>&nbsp;<span class="ident" id="4123160">Denom</span><span class="op" id="4123165">(</span><span class="op" id="4123166">)</span>&nbsp;<span class="op" id="4123168">*</span><span class="ident" id="4123169">Int</span>&nbsp;<span class="op" id="4123173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4123176">x</span><span class="op" id="4123177">.</span><span class="ident" id="4123178">b</span><span class="op" id="4123179">.</span><span class="ident" id="4123180">neg</span>&nbsp;<span class="op" id="4123184">=</span>&nbsp;<span class="builtintype" id="4123186">false</span>&nbsp;<span class="comment" id="4123192">//&nbsp;the&nbsp;result&nbsp;is&nbsp;always&nbsp;&gt;=&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4123222">if</span>&nbsp;<span class="builtinfunc" id="4123225">len</span><span class="op" id="4123228">(</span><span class="ident" id="4123229">x</span><span class="op" id="4123230">.</span><span class="ident" id="4123231">b</span><span class="op" id="4123232">.</span><span class="ident" id="4123233">abs</span><span class="op" id="4123236">)</span>&nbsp;<span class="op" id="4123238">==</span>&nbsp;<span class="num" id="4123241">0</span>&nbsp;<span class="op" id="4123243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4123247">x</span><span class="op" id="4123248">.</span><span class="ident" id="4123249">b</span><span class="op" id="4123250">.</span><span class="ident" id="4123251">abs</span>&nbsp;<span class="op" id="4123255">=</span>&nbsp;<span class="ident" id="4123257">x</span><span class="op" id="4123258">.</span><span class="ident" id="4123259">b</span><span class="op" id="4123260">.</span><span class="ident" id="4123261">abs</span><span class="op" id="4123264">.</span><span class="ident" id="4123265">set</span><span class="op" id="4123268">(</span><span class="ident" id="4123269">natOne</span><span class="op" id="4123275">)</span>&nbsp;<span class="comment" id="4123277">//&nbsp;materialize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4123305">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4123308">return</span>&nbsp;<span class="op" id="4123315">&amp;</span><span class="ident" id="4123316">x</span><span class="op" id="4123317">.</span><span class="ident" id="4123318">b</span><br>
<span class="lineno"></span><span class="op" id="4123320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4123323">func</span>&nbsp;<span class="op" id="4123328">(</span><span class="ident" id="4123329">z</span>&nbsp;<span class="op" id="4123331">*</span><span class="ident" id="4123332">Rat</span><span class="op" id="4123335">)</span>&nbsp;<span class="ident" id="4123337">norm</span><span class="op" id="4123341">(</span><span class="op" id="4123342">)</span>&nbsp;<span class="op" id="4123344">*</span><span class="ident" id="4123345">Rat</span>&nbsp;<span class="op" id="4123349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4123352">switch</span>&nbsp;<span class="op" id="4123359">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4123362">case</span>&nbsp;<span class="builtinfunc" id="4123367">len</span><span class="op" id="4123370">(</span><span class="ident" id="4123371">z</span><span class="op" id="4123372">.</span><span class="ident" id="4123373">a</span><span class="op" id="4123374">.</span><span class="ident" id="4123375">abs</span><span class="op" id="4123378">)</span>&nbsp;<span class="op" id="4123380">==</span>&nbsp;<span class="num" id="4123383">0</span><span class="op" id="4123384">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4123388">//&nbsp;z&nbsp;==&nbsp;0&nbsp;-&nbsp;normalize&nbsp;sign&nbsp;and&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4123433">z</span><span class="op" id="4123434">.</span><span class="ident" id="4123435">a</span><span class="op" id="4123436">.</span><span class="ident" id="4123437">neg</span>&nbsp;<span class="op" id="4123441">=</span>&nbsp;<span class="builtintype" id="4123443">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4123451">z</span><span class="op" id="4123452">.</span><span class="ident" id="4123453">b</span><span class="op" id="4123454">.</span><span class="ident" id="4123455">abs</span>&nbsp;<span class="op" id="4123459">=</span>&nbsp;<span class="ident" id="4123461">z</span><span class="op" id="4123462">.</span><span class="ident" id="4123463">b</span><span class="op" id="4123464">.</span><span class="ident" id="4123465">abs</span><span class="op" id="4123468">.</span><span class="builtinfunc" id="4123469">make</span><span class="op" id="4123473">(</span><span class="num" id="4123474">0</span><span class="op" id="4123475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4123478">case</span>&nbsp;<span class="builtinfunc" id="4123483">len</span><span class="op" id="4123486">(</span><span class="ident" id="4123487">z</span><span class="op" id="4123488">.</span><span class="ident" id="4123489">b</span><span class="op" id="4123490">.</span><span class="ident" id="4123491">abs</span><span class="op" id="4123494">)</span>&nbsp;<span class="op" id="4123496">==</span>&nbsp;<span class="num" id="4123499">0</span><span class="op" id="4123500">:</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4123504">//&nbsp;z&nbsp;is&nbsp;normalized&nbsp;int&nbsp;-&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4123544">case</span>&nbsp;<span class="ident" id="4123549">z</span><span class="op" id="4123550">.</span><span class="ident" id="4123551">b</span><span class="op" id="4123552">.</span><span class="ident" id="4123553">abs</span><span class="op" id="4123556">.</span><span class="ident" id="4123557">cmp</span><span class="op" id="4123560">(</span><span class="ident" id="4123561">natOne</span><span class="op" id="4123567">)</span>&nbsp;<span class="op" id="4123569">==</span>&nbsp;<span class="num" id="4123572">0</span><span class="op" id="4123573">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4123577">//&nbsp;z&nbsp;is&nbsp;int&nbsp;-&nbsp;normalize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4123615">z</span><span class="op" id="4123616">.</span><span class="ident" id="4123617">b</span><span class="op" id="4123618">.</span><span class="ident" id="4123619">abs</span>&nbsp;<span class="op" id="4123623">=</span>&nbsp;<span class="ident" id="4123625">z</span><span class="op" id="4123626">.</span><span class="ident" id="4123627">b</span><span class="op" id="4123628">.</span><span class="ident" id="4123629">abs</span><span class="op" id="4123632">.</span><span class="builtinfunc" id="4123633">make</span><span class="op" id="4123637">(</span><span class="num" id="4123638">0</span><span class="op" id="4123639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4123642">default</span><span class="op" id="4123649">:</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4123653">neg</span>&nbsp;<span class="op" id="4123657">:=</span>&nbsp;<span class="ident" id="4123660">z</span><span class="op" id="4123661">.</span><span class="ident" id="4123662">a</span><span class="op" id="4123663">.</span><span class="ident" id="4123664">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4123670">z</span><span class="op" id="4123671">.</span><span class="ident" id="4123672">a</span><span class="op" id="4123673">.</span><span class="ident" id="4123674">neg</span>&nbsp;<span class="op" id="4123678">=</span>&nbsp;<span class="builtintype" id="4123680">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4123688">z</span><span class="op" id="4123689">.</span><span class="ident" id="4123690">b</span><span class="op" id="4123691">.</span><span class="ident" id="4123692">neg</span>&nbsp;<span class="op" id="4123696">=</span>&nbsp;<span class="builtintype" id="4123698">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4123706">if</span>&nbsp;<span class="ident" id="4123709">f</span>&nbsp;<span class="op" id="4123711">:=</span>&nbsp;<span class="ident" id="4123714">NewInt</span><span class="op" id="4123720">(</span><span class="num" id="4123721">0</span><span class="op" id="4123722">)</span><span class="op" id="4123723">.</span><span class="ident" id="4123724">binaryGCD</span><span class="op" id="4123733">(</span><span class="op" id="4123734">&amp;</span><span class="ident" id="4123735">z</span><span class="op" id="4123736">.</span><span class="ident" id="4123737">a</span><span class="op" id="4123738">,</span>&nbsp;<span class="op" id="4123740">&amp;</span><span class="ident" id="4123741">z</span><span class="op" id="4123742">.</span><span class="ident" id="4123743">b</span><span class="op" id="4123744">)</span><span class="op" id="4123745">;</span>&nbsp;<span class="ident" id="4123747">f</span><span class="op" id="4123748">.</span><span class="ident" id="4123749">Cmp</span><span class="op" id="4123752">(</span><span class="ident" id="4123753">intOne</span><span class="op" id="4123759">)</span>&nbsp;<span class="op" id="4123761">!=</span>&nbsp;<span class="num" id="4123764">0</span>&nbsp;<span class="op" id="4123766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4123771">z</span><span class="op" id="4123772">.</span><span class="ident" id="4123773">a</span><span class="op" id="4123774">.</span><span class="ident" id="4123775">abs</span><span class="op" id="4123778">,</span>&nbsp;<span class="ident" id="4123780">_</span>&nbsp;<span class="op" id="4123782">=</span>&nbsp;<span class="ident" id="4123784">z</span><span class="op" id="4123785">.</span><span class="ident" id="4123786">a</span><span class="op" id="4123787">.</span><span class="ident" id="4123788">abs</span><span class="op" id="4123791">.</span><span class="ident" id="4123792">div</span><span class="op" id="4123795">(</span><span class="builtintype" id="4123796">nil</span><span class="op" id="4123799">,</span>&nbsp;<span class="ident" id="4123801">z</span><span class="op" id="4123802">.</span><span class="ident" id="4123803">a</span><span class="op" id="4123804">.</span><span class="ident" id="4123805">abs</span><span class="op" id="4123808">,</span>&nbsp;<span class="ident" id="4123810">f</span><span class="op" id="4123811">.</span><span class="ident" id="4123812">abs</span><span class="op" id="4123815">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4123820">z</span><span class="op" id="4123821">.</span><span class="ident" id="4123822">b</span><span class="op" id="4123823">.</span><span class="ident" id="4123824">abs</span><span class="op" id="4123827">,</span>&nbsp;<span class="ident" id="4123829">_</span>&nbsp;<span class="op" id="4123831">=</span>&nbsp;<span class="ident" id="4123833">z</span><span class="op" id="4123834">.</span><span class="ident" id="4123835">b</span><span class="op" id="4123836">.</span><span class="ident" id="4123837">abs</span><span class="op" id="4123840">.</span><span class="ident" id="4123841">div</span><span class="op" id="4123844">(</span><span class="builtintype" id="4123845">nil</span><span class="op" id="4123848">,</span>&nbsp;<span class="ident" id="4123850">z</span><span class="op" id="4123851">.</span><span class="ident" id="4123852">b</span><span class="op" id="4123853">.</span><span class="ident" id="4123854">abs</span><span class="op" id="4123857">,</span>&nbsp;<span class="ident" id="4123859">f</span><span class="op" id="4123860">.</span><span class="ident" id="4123861">abs</span><span class="op" id="4123864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4123869">if</span>&nbsp;<span class="ident" id="4123872">z</span><span class="op" id="4123873">.</span><span class="ident" id="4123874">b</span><span class="op" id="4123875">.</span><span class="ident" id="4123876">abs</span><span class="op" id="4123879">.</span><span class="ident" id="4123880">cmp</span><span class="op" id="4123883">(</span><span class="ident" id="4123884">natOne</span><span class="op" id="4123890">)</span>&nbsp;<span class="op" id="4123892">==</span>&nbsp;<span class="num" id="4123895">0</span>&nbsp;<span class="op" id="4123897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4123903">//&nbsp;z&nbsp;is&nbsp;int&nbsp;-&nbsp;normalize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4123943">z</span><span class="op" id="4123944">.</span><span class="ident" id="4123945">b</span><span class="op" id="4123946">.</span><span class="ident" id="4123947">abs</span>&nbsp;<span class="op" id="4123951">=</span>&nbsp;<span class="ident" id="4123953">z</span><span class="op" id="4123954">.</span><span class="ident" id="4123955">b</span><span class="op" id="4123956">.</span><span class="ident" id="4123957">abs</span><span class="op" id="4123960">.</span><span class="builtinfunc" id="4123961">make</span><span class="op" id="4123965">(</span><span class="num" id="4123966">0</span><span class="op" id="4123967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4123972">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4123976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4123980">z</span><span class="op" id="4123981">.</span><span class="ident" id="4123982">a</span><span class="op" id="4123983">.</span><span class="ident" id="4123984">neg</span>&nbsp;<span class="op" id="4123988">=</span>&nbsp;<span class="ident" id="4123990">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4123995">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4123998">return</span>&nbsp;<span class="ident" id="4124005">z</span><br>
<span class="lineno"></span><span class="op" id="4124007">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span><span class="comment" id="4124010">//&nbsp;mulDenom&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;denominator&nbsp;product&nbsp;x*y&nbsp;(by&nbsp;taking&nbsp;into</span><br>
<span class="lineno"></span><span class="comment" id="4124076">//&nbsp;account&nbsp;that&nbsp;0&nbsp;values&nbsp;for&nbsp;x&nbsp;or&nbsp;y&nbsp;must&nbsp;be&nbsp;interpreted&nbsp;as&nbsp;1)&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4124142">//&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="4124156">func</span>&nbsp;<span class="ident" id="4124161">mulDenom</span><span class="op" id="4124169">(</span><span class="ident" id="4124170">z</span><span class="op" id="4124171">,</span>&nbsp;<span class="ident" id="4124173">x</span><span class="op" id="4124174">,</span>&nbsp;<span class="ident" id="4124176">y</span>&nbsp;<span class="ident" id="4124178">nat</span><span class="op" id="4124181">)</span>&nbsp;<span class="ident" id="4124183">nat</span>&nbsp;<span class="op" id="4124187">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4124190">switch</span>&nbsp;<span class="op" id="4124197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4124200">case</span>&nbsp;<span class="builtinfunc" id="4124205">len</span><span class="op" id="4124208">(</span><span class="ident" id="4124209">x</span><span class="op" id="4124210">)</span>&nbsp;<span class="op" id="4124212">==</span>&nbsp;<span class="num" id="4124215">0</span><span class="op" id="4124216">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4124220">return</span>&nbsp;<span class="ident" id="4124227">z</span><span class="op" id="4124228">.</span><span class="ident" id="4124229">set</span><span class="op" id="4124232">(</span><span class="ident" id="4124233">y</span><span class="op" id="4124234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4124237">case</span>&nbsp;<span class="builtinfunc" id="4124242">len</span><span class="op" id="4124245">(</span><span class="ident" id="4124246">y</span><span class="op" id="4124247">)</span>&nbsp;<span class="op" id="4124249">==</span>&nbsp;<span class="num" id="4124252">0</span><span class="op" id="4124253">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4124257">return</span>&nbsp;<span class="ident" id="4124264">z</span><span class="op" id="4124265">.</span><span class="ident" id="4124266">set</span><span class="op" id="4124269">(</span><span class="ident" id="4124270">x</span><span class="op" id="4124271">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4124274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4124277">return</span>&nbsp;<span class="ident" id="4124284">z</span><span class="op" id="4124285">.</span><span class="ident" id="4124286">mul</span><span class="op" id="4124289">(</span><span class="ident" id="4124290">x</span><span class="op" id="4124291">,</span>&nbsp;<span class="ident" id="4124293">y</span><span class="op" id="4124294">)</span><br>
<span class="lineno"></span><span class="op" id="4124296">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4124299">//&nbsp;scaleDenom&nbsp;computes&nbsp;x*f.</span><br>
<span class="lineno">455</span><span class="comment" id="4124327">//&nbsp;If&nbsp;f&nbsp;==&nbsp;0&nbsp;(zero&nbsp;value&nbsp;of&nbsp;denominator),&nbsp;the&nbsp;result&nbsp;is&nbsp;(a&nbsp;copy&nbsp;of)&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="4124398">func</span>&nbsp;<span class="ident" id="4124403">scaleDenom</span><span class="op" id="4124413">(</span><span class="ident" id="4124414">x</span>&nbsp;<span class="op" id="4124416">*</span><span class="ident" id="4124417">Int</span><span class="op" id="4124420">,</span>&nbsp;<span class="ident" id="4124422">f</span>&nbsp;<span class="ident" id="4124424">nat</span><span class="op" id="4124427">)</span>&nbsp;<span class="op" id="4124429">*</span><span class="ident" id="4124430">Int</span>&nbsp;<span class="op" id="4124434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4124437">var</span>&nbsp;<span class="ident" id="4124441">z</span>&nbsp;<span class="ident" id="4124443">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4124448">if</span>&nbsp;<span class="builtinfunc" id="4124451">len</span><span class="op" id="4124454">(</span><span class="ident" id="4124455">f</span><span class="op" id="4124456">)</span>&nbsp;<span class="op" id="4124458">==</span>&nbsp;<span class="num" id="4124461">0</span>&nbsp;<span class="op" id="4124463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4124467">return</span>&nbsp;<span class="ident" id="4124474">z</span><span class="op" id="4124475">.</span><span class="ident" id="4124476">Set</span><span class="op" id="4124479">(</span><span class="ident" id="4124480">x</span><span class="op" id="4124481">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4124484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4124487">z</span><span class="op" id="4124488">.</span><span class="ident" id="4124489">abs</span>&nbsp;<span class="op" id="4124493">=</span>&nbsp;<span class="ident" id="4124495">z</span><span class="op" id="4124496">.</span><span class="ident" id="4124497">abs</span><span class="op" id="4124500">.</span><span class="ident" id="4124501">mul</span><span class="op" id="4124504">(</span><span class="ident" id="4124505">x</span><span class="op" id="4124506">.</span><span class="ident" id="4124507">abs</span><span class="op" id="4124510">,</span>&nbsp;<span class="ident" id="4124512">f</span><span class="op" id="4124513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4124516">z</span><span class="op" id="4124517">.</span><span class="ident" id="4124518">neg</span>&nbsp;<span class="op" id="4124522">=</span>&nbsp;<span class="ident" id="4124524">x</span><span class="op" id="4124525">.</span><span class="ident" id="4124526">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4124531">return</span>&nbsp;<span class="op" id="4124538">&amp;</span><span class="ident" id="4124539">z</span><br>
<span class="lineno"></span><span class="op" id="4124541">}</span><br>
<span class="lineno">465</span><br>
<span class="lineno"></span><span class="comment" id="4124544">//&nbsp;Cmp&nbsp;compares&nbsp;x&nbsp;and&nbsp;y&nbsp;and&nbsp;returns:</span><br>
<span class="lineno"></span><span class="comment" id="4124581">//</span><br>
<span class="lineno"></span><span class="comment" id="4124584">//&nbsp;&nbsp;&nbsp;-1&nbsp;if&nbsp;x&nbsp;&lt;&nbsp;&nbsp;y</span><br>
<span class="lineno"></span><span class="comment" id="4124602">//&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;if&nbsp;x&nbsp;==&nbsp;y</span><br>
<span class="lineno">470</span><span class="comment" id="4124620">//&nbsp;&nbsp;&nbsp;+1&nbsp;if&nbsp;x&nbsp;&gt;&nbsp;&nbsp;y</span><br>
<span class="lineno"></span><span class="comment" id="4124638">//</span><br>
<span class="lineno"></span><span class="keyword" id="4124641">func</span>&nbsp;<span class="op" id="4124646">(</span><span class="ident" id="4124647">x</span>&nbsp;<span class="op" id="4124649">*</span><span class="ident" id="4124650">Rat</span><span class="op" id="4124653">)</span>&nbsp;<span class="ident" id="4124655">Cmp</span><span class="op" id="4124658">(</span><span class="ident" id="4124659">y</span>&nbsp;<span class="op" id="4124661">*</span><span class="ident" id="4124662">Rat</span><span class="op" id="4124665">)</span>&nbsp;<span class="builtintype" id="4124667">int</span>&nbsp;<span class="op" id="4124671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4124674">return</span>&nbsp;<span class="ident" id="4124681">scaleDenom</span><span class="op" id="4124691">(</span><span class="op" id="4124692">&amp;</span><span class="ident" id="4124693">x</span><span class="op" id="4124694">.</span><span class="ident" id="4124695">a</span><span class="op" id="4124696">,</span>&nbsp;<span class="ident" id="4124698">y</span><span class="op" id="4124699">.</span><span class="ident" id="4124700">b</span><span class="op" id="4124701">.</span><span class="ident" id="4124702">abs</span><span class="op" id="4124705">)</span><span class="op" id="4124706">.</span><span class="ident" id="4124707">Cmp</span><span class="op" id="4124710">(</span><span class="ident" id="4124711">scaleDenom</span><span class="op" id="4124721">(</span><span class="op" id="4124722">&amp;</span><span class="ident" id="4124723">y</span><span class="op" id="4124724">.</span><span class="ident" id="4124725">a</span><span class="op" id="4124726">,</span>&nbsp;<span class="ident" id="4124728">x</span><span class="op" id="4124729">.</span><span class="ident" id="4124730">b</span><span class="op" id="4124731">.</span><span class="ident" id="4124732">abs</span><span class="op" id="4124735">)</span><span class="op" id="4124736">)</span><br>
<span class="lineno"></span><span class="op" id="4124738">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="comment" id="4124741">//&nbsp;Add&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;sum&nbsp;x+y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="4124785">func</span>&nbsp;<span class="op" id="4124790">(</span><span class="ident" id="4124791">z</span>&nbsp;<span class="op" id="4124793">*</span><span class="ident" id="4124794">Rat</span><span class="op" id="4124797">)</span>&nbsp;<span class="ident" id="4124799">Add</span><span class="op" id="4124802">(</span><span class="ident" id="4124803">x</span><span class="op" id="4124804">,</span>&nbsp;<span class="ident" id="4124806">y</span>&nbsp;<span class="op" id="4124808">*</span><span class="ident" id="4124809">Rat</span><span class="op" id="4124812">)</span>&nbsp;<span class="op" id="4124814">*</span><span class="ident" id="4124815">Rat</span>&nbsp;<span class="op" id="4124819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4124822">a1</span>&nbsp;<span class="op" id="4124825">:=</span>&nbsp;<span class="ident" id="4124828">scaleDenom</span><span class="op" id="4124838">(</span><span class="op" id="4124839">&amp;</span><span class="ident" id="4124840">x</span><span class="op" id="4124841">.</span><span class="ident" id="4124842">a</span><span class="op" id="4124843">,</span>&nbsp;<span class="ident" id="4124845">y</span><span class="op" id="4124846">.</span><span class="ident" id="4124847">b</span><span class="op" id="4124848">.</span><span class="ident" id="4124849">abs</span><span class="op" id="4124852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4124855">a2</span>&nbsp;<span class="op" id="4124858">:=</span>&nbsp;<span class="ident" id="4124861">scaleDenom</span><span class="op" id="4124871">(</span><span class="op" id="4124872">&amp;</span><span class="ident" id="4124873">y</span><span class="op" id="4124874">.</span><span class="ident" id="4124875">a</span><span class="op" id="4124876">,</span>&nbsp;<span class="ident" id="4124878">x</span><span class="op" id="4124879">.</span><span class="ident" id="4124880">b</span><span class="op" id="4124881">.</span><span class="ident" id="4124882">abs</span><span class="op" id="4124885">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4124888">z</span><span class="op" id="4124889">.</span><span class="ident" id="4124890">a</span><span class="op" id="4124891">.</span><span class="ident" id="4124892">Add</span><span class="op" id="4124895">(</span><span class="ident" id="4124896">a1</span><span class="op" id="4124898">,</span>&nbsp;<span class="ident" id="4124900">a2</span><span class="op" id="4124902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4124905">z</span><span class="op" id="4124906">.</span><span class="ident" id="4124907">b</span><span class="op" id="4124908">.</span><span class="ident" id="4124909">abs</span>&nbsp;<span class="op" id="4124913">=</span>&nbsp;<span class="ident" id="4124915">mulDenom</span><span class="op" id="4124923">(</span><span class="ident" id="4124924">z</span><span class="op" id="4124925">.</span><span class="ident" id="4124926">b</span><span class="op" id="4124927">.</span><span class="ident" id="4124928">abs</span><span class="op" id="4124931">,</span>&nbsp;<span class="ident" id="4124933">x</span><span class="op" id="4124934">.</span><span class="ident" id="4124935">b</span><span class="op" id="4124936">.</span><span class="ident" id="4124937">abs</span><span class="op" id="4124940">,</span>&nbsp;<span class="ident" id="4124942">y</span><span class="op" id="4124943">.</span><span class="ident" id="4124944">b</span><span class="op" id="4124945">.</span><span class="ident" id="4124946">abs</span><span class="op" id="4124949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4124952">return</span>&nbsp;<span class="ident" id="4124959">z</span><span class="op" id="4124960">.</span><span class="ident" id="4124961">norm</span><span class="op" id="4124965">(</span><span class="op" id="4124966">)</span><br>
<span class="lineno"></span><span class="op" id="4124968">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">485</span><span class="comment" id="4124971">//&nbsp;Sub&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;difference&nbsp;x-y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="4125022">func</span>&nbsp;<span class="op" id="4125027">(</span><span class="ident" id="4125028">z</span>&nbsp;<span class="op" id="4125030">*</span><span class="ident" id="4125031">Rat</span><span class="op" id="4125034">)</span>&nbsp;<span class="ident" id="4125036">Sub</span><span class="op" id="4125039">(</span><span class="ident" id="4125040">x</span><span class="op" id="4125041">,</span>&nbsp;<span class="ident" id="4125043">y</span>&nbsp;<span class="op" id="4125045">*</span><span class="ident" id="4125046">Rat</span><span class="op" id="4125049">)</span>&nbsp;<span class="op" id="4125051">*</span><span class="ident" id="4125052">Rat</span>&nbsp;<span class="op" id="4125056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4125059">a1</span>&nbsp;<span class="op" id="4125062">:=</span>&nbsp;<span class="ident" id="4125065">scaleDenom</span><span class="op" id="4125075">(</span><span class="op" id="4125076">&amp;</span><span class="ident" id="4125077">x</span><span class="op" id="4125078">.</span><span class="ident" id="4125079">a</span><span class="op" id="4125080">,</span>&nbsp;<span class="ident" id="4125082">y</span><span class="op" id="4125083">.</span><span class="ident" id="4125084">b</span><span class="op" id="4125085">.</span><span class="ident" id="4125086">abs</span><span class="op" id="4125089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4125092">a2</span>&nbsp;<span class="op" id="4125095">:=</span>&nbsp;<span class="ident" id="4125098">scaleDenom</span><span class="op" id="4125108">(</span><span class="op" id="4125109">&amp;</span><span class="ident" id="4125110">y</span><span class="op" id="4125111">.</span><span class="ident" id="4125112">a</span><span class="op" id="4125113">,</span>&nbsp;<span class="ident" id="4125115">x</span><span class="op" id="4125116">.</span><span class="ident" id="4125117">b</span><span class="op" id="4125118">.</span><span class="ident" id="4125119">abs</span><span class="op" id="4125122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4125125">z</span><span class="op" id="4125126">.</span><span class="ident" id="4125127">a</span><span class="op" id="4125128">.</span><span class="ident" id="4125129">Sub</span><span class="op" id="4125132">(</span><span class="ident" id="4125133">a1</span><span class="op" id="4125135">,</span>&nbsp;<span class="ident" id="4125137">a2</span><span class="op" id="4125139">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4125142">z</span><span class="op" id="4125143">.</span><span class="ident" id="4125144">b</span><span class="op" id="4125145">.</span><span class="ident" id="4125146">abs</span>&nbsp;<span class="op" id="4125150">=</span>&nbsp;<span class="ident" id="4125152">mulDenom</span><span class="op" id="4125160">(</span><span class="ident" id="4125161">z</span><span class="op" id="4125162">.</span><span class="ident" id="4125163">b</span><span class="op" id="4125164">.</span><span class="ident" id="4125165">abs</span><span class="op" id="4125168">,</span>&nbsp;<span class="ident" id="4125170">x</span><span class="op" id="4125171">.</span><span class="ident" id="4125172">b</span><span class="op" id="4125173">.</span><span class="ident" id="4125174">abs</span><span class="op" id="4125177">,</span>&nbsp;<span class="ident" id="4125179">y</span><span class="op" id="4125180">.</span><span class="ident" id="4125181">b</span><span class="op" id="4125182">.</span><span class="ident" id="4125183">abs</span><span class="op" id="4125186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4125189">return</span>&nbsp;<span class="ident" id="4125196">z</span><span class="op" id="4125197">.</span><span class="ident" id="4125198">norm</span><span class="op" id="4125202">(</span><span class="op" id="4125203">)</span><br>
<span class="lineno"></span><span class="op" id="4125205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4125208">//&nbsp;Mul&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;product&nbsp;x*y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno">495</span><span class="keyword" id="4125256">func</span>&nbsp;<span class="op" id="4125261">(</span><span class="ident" id="4125262">z</span>&nbsp;<span class="op" id="4125264">*</span><span class="ident" id="4125265">Rat</span><span class="op" id="4125268">)</span>&nbsp;<span class="ident" id="4125270">Mul</span><span class="op" id="4125273">(</span><span class="ident" id="4125274">x</span><span class="op" id="4125275">,</span>&nbsp;<span class="ident" id="4125277">y</span>&nbsp;<span class="op" id="4125279">*</span><span class="ident" id="4125280">Rat</span><span class="op" id="4125283">)</span>&nbsp;<span class="op" id="4125285">*</span><span class="ident" id="4125286">Rat</span>&nbsp;<span class="op" id="4125290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4125293">z</span><span class="op" id="4125294">.</span><span class="ident" id="4125295">a</span><span class="op" id="4125296">.</span><span class="ident" id="4125297">Mul</span><span class="op" id="4125300">(</span><span class="op" id="4125301">&amp;</span><span class="ident" id="4125302">x</span><span class="op" id="4125303">.</span><span class="ident" id="4125304">a</span><span class="op" id="4125305">,</span>&nbsp;<span class="op" id="4125307">&amp;</span><span class="ident" id="4125308">y</span><span class="op" id="4125309">.</span><span class="ident" id="4125310">a</span><span class="op" id="4125311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4125314">z</span><span class="op" id="4125315">.</span><span class="ident" id="4125316">b</span><span class="op" id="4125317">.</span><span class="ident" id="4125318">abs</span>&nbsp;<span class="op" id="4125322">=</span>&nbsp;<span class="ident" id="4125324">mulDenom</span><span class="op" id="4125332">(</span><span class="ident" id="4125333">z</span><span class="op" id="4125334">.</span><span class="ident" id="4125335">b</span><span class="op" id="4125336">.</span><span class="ident" id="4125337">abs</span><span class="op" id="4125340">,</span>&nbsp;<span class="ident" id="4125342">x</span><span class="op" id="4125343">.</span><span class="ident" id="4125344">b</span><span class="op" id="4125345">.</span><span class="ident" id="4125346">abs</span><span class="op" id="4125349">,</span>&nbsp;<span class="ident" id="4125351">y</span><span class="op" id="4125352">.</span><span class="ident" id="4125353">b</span><span class="op" id="4125354">.</span><span class="ident" id="4125355">abs</span><span class="op" id="4125358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4125361">return</span>&nbsp;<span class="ident" id="4125368">z</span><span class="op" id="4125369">.</span><span class="ident" id="4125370">norm</span><span class="op" id="4125374">(</span><span class="op" id="4125375">)</span><br>
<span class="lineno"></span><span class="op" id="4125377">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="comment" id="4125380">//&nbsp;Quo&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;quotient&nbsp;x/y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="4125429">//&nbsp;If&nbsp;y&nbsp;==&nbsp;0,&nbsp;a&nbsp;division-by-zero&nbsp;run-time&nbsp;panic&nbsp;occurs.</span><br>
<span class="lineno"></span><span class="keyword" id="4125485">func</span>&nbsp;<span class="op" id="4125490">(</span><span class="ident" id="4125491">z</span>&nbsp;<span class="op" id="4125493">*</span><span class="ident" id="4125494">Rat</span><span class="op" id="4125497">)</span>&nbsp;<span class="ident" id="4125499">Quo</span><span class="op" id="4125502">(</span><span class="ident" id="4125503">x</span><span class="op" id="4125504">,</span>&nbsp;<span class="ident" id="4125506">y</span>&nbsp;<span class="op" id="4125508">*</span><span class="ident" id="4125509">Rat</span><span class="op" id="4125512">)</span>&nbsp;<span class="op" id="4125514">*</span><span class="ident" id="4125515">Rat</span>&nbsp;<span class="op" id="4125519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4125522">if</span>&nbsp;<span class="builtinfunc" id="4125525">len</span><span class="op" id="4125528">(</span><span class="ident" id="4125529">y</span><span class="op" id="4125530">.</span><span class="ident" id="4125531">a</span><span class="op" id="4125532">.</span><span class="ident" id="4125533">abs</span><span class="op" id="4125536">)</span>&nbsp;<span class="op" id="4125538">==</span>&nbsp;<span class="num" id="4125541">0</span>&nbsp;<span class="op" id="4125543">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4125547">panic</span><span class="op" id="4125552">(</span><span class="string" id="4125553">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="4125571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4125574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4125577">a</span>&nbsp;<span class="op" id="4125579">:=</span>&nbsp;<span class="ident" id="4125582">scaleDenom</span><span class="op" id="4125592">(</span><span class="op" id="4125593">&amp;</span><span class="ident" id="4125594">x</span><span class="op" id="4125595">.</span><span class="ident" id="4125596">a</span><span class="op" id="4125597">,</span>&nbsp;<span class="ident" id="4125599">y</span><span class="op" id="4125600">.</span><span class="ident" id="4125601">b</span><span class="op" id="4125602">.</span><span class="ident" id="4125603">abs</span><span class="op" id="4125606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4125609">b</span>&nbsp;<span class="op" id="4125611">:=</span>&nbsp;<span class="ident" id="4125614">scaleDenom</span><span class="op" id="4125624">(</span><span class="op" id="4125625">&amp;</span><span class="ident" id="4125626">y</span><span class="op" id="4125627">.</span><span class="ident" id="4125628">a</span><span class="op" id="4125629">,</span>&nbsp;<span class="ident" id="4125631">x</span><span class="op" id="4125632">.</span><span class="ident" id="4125633">b</span><span class="op" id="4125634">.</span><span class="ident" id="4125635">abs</span><span class="op" id="4125638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4125641">z</span><span class="op" id="4125642">.</span><span class="ident" id="4125643">a</span><span class="op" id="4125644">.</span><span class="ident" id="4125645">abs</span>&nbsp;<span class="op" id="4125649">=</span>&nbsp;<span class="ident" id="4125651">a</span><span class="op" id="4125652">.</span><span class="ident" id="4125653">abs</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4125658">z</span><span class="op" id="4125659">.</span><span class="ident" id="4125660">b</span><span class="op" id="4125661">.</span><span class="ident" id="4125662">abs</span>&nbsp;<span class="op" id="4125666">=</span>&nbsp;<span class="ident" id="4125668">b</span><span class="op" id="4125669">.</span><span class="ident" id="4125670">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4125675">z</span><span class="op" id="4125676">.</span><span class="ident" id="4125677">a</span><span class="op" id="4125678">.</span><span class="ident" id="4125679">neg</span>&nbsp;<span class="op" id="4125683">=</span>&nbsp;<span class="ident" id="4125685">a</span><span class="op" id="4125686">.</span><span class="ident" id="4125687">neg</span>&nbsp;<span class="op" id="4125691">!=</span>&nbsp;<span class="ident" id="4125694">b</span><span class="op" id="4125695">.</span><span class="ident" id="4125696">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4125701">return</span>&nbsp;<span class="ident" id="4125708">z</span><span class="op" id="4125709">.</span><span class="ident" id="4125710">norm</span><span class="op" id="4125714">(</span><span class="op" id="4125715">)</span><br>
<span class="lineno"></span><span class="op" id="4125717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="keyword" id="4125720">func</span>&nbsp;<span class="ident" id="4125725">ratTok</span><span class="op" id="4125731">(</span><span class="ident" id="4125732">ch</span>&nbsp;<span class="builtintype" id="4125735">rune</span><span class="op" id="4125739">)</span>&nbsp;<span class="builtintype" id="4125741">bool</span>&nbsp;<span class="op" id="4125746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4125749">return</span>&nbsp;<span class="ident" id="4125756">strings</span><span class="op" id="4125763">.</span><span class="ident" id="4125764">IndexRune</span><span class="op" id="4125773">(</span><span class="string" id="4125774">&#34;+-/0123456789.eE&#34;</span><span class="op" id="4125792">,</span>&nbsp;<span class="ident" id="4125794">ch</span><span class="op" id="4125796">)</span>&nbsp;<span class="op" id="4125798">&gt;=</span>&nbsp;<span class="num" id="4125801">0</span><br>
<span class="lineno"></span><span class="op" id="4125803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4125806">//&nbsp;Scan&nbsp;is&nbsp;a&nbsp;support&nbsp;routine&nbsp;for&nbsp;fmt.Scanner.&nbsp;It&nbsp;accepts&nbsp;the&nbsp;formats</span><br>
<span class="lineno">520</span><span class="comment" id="4125875">//&nbsp;&#39;e&#39;,&nbsp;&#39;E&#39;,&nbsp;&#39;f&#39;,&nbsp;&#39;F&#39;,&nbsp;&#39;g&#39;,&nbsp;&#39;G&#39;,&nbsp;and&nbsp;&#39;v&#39;.&nbsp;All&nbsp;formats&nbsp;are&nbsp;equivalent.</span><br>
<span class="lineno"></span><span class="keyword" id="4125945">func</span>&nbsp;<span class="op" id="4125950">(</span><span class="ident" id="4125951">z</span>&nbsp;<span class="op" id="4125953">*</span><span class="ident" id="4125954">Rat</span><span class="op" id="4125957">)</span>&nbsp;<span class="ident" id="4125959">Scan</span><span class="op" id="4125963">(</span><span class="ident" id="4125964">s</span>&nbsp;<span class="ident" id="4125966">fmt</span><span class="op" id="4125969">.</span><span class="ident" id="4125970">ScanState</span><span class="op" id="4125979">,</span>&nbsp;<span class="ident" id="4125981">ch</span>&nbsp;<span class="builtintype" id="4125984">rune</span><span class="op" id="4125988">)</span>&nbsp;<span class="builtintype" id="4125990">error</span>&nbsp;<span class="op" id="4125996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4125999">tok</span><span class="op" id="4126002">,</span>&nbsp;<span class="ident" id="4126004">err</span>&nbsp;<span class="op" id="4126008">:=</span>&nbsp;<span class="ident" id="4126011">s</span><span class="op" id="4126012">.</span><span class="ident" id="4126013">Token</span><span class="op" id="4126018">(</span><span class="builtintype" id="4126019">true</span><span class="op" id="4126023">,</span>&nbsp;<span class="ident" id="4126025">ratTok</span><span class="op" id="4126031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4126034">if</span>&nbsp;<span class="ident" id="4126037">err</span>&nbsp;<span class="op" id="4126041">!=</span>&nbsp;<span class="builtintype" id="4126044">nil</span>&nbsp;<span class="op" id="4126048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4126052">return</span>&nbsp;<span class="ident" id="4126059">err</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4126064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4126067">if</span>&nbsp;<span class="ident" id="4126070">strings</span><span class="op" id="4126077">.</span><span class="ident" id="4126078">IndexRune</span><span class="op" id="4126087">(</span><span class="string" id="4126088">&#34;efgEFGv&#34;</span><span class="op" id="4126097">,</span>&nbsp;<span class="ident" id="4126099">ch</span><span class="op" id="4126101">)</span>&nbsp;<span class="op" id="4126103">&lt;</span>&nbsp;<span class="num" id="4126105">0</span>&nbsp;<span class="op" id="4126107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4126111">return</span>&nbsp;<span class="ident" id="4126118">errors</span><span class="op" id="4126124">.</span><span class="ident" id="4126125">New</span><span class="op" id="4126128">(</span><span class="string" id="4126129">&#34;Rat.Scan:&nbsp;invalid&nbsp;verb&#34;</span><span class="op" id="4126153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4126156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4126159">if</span>&nbsp;<span class="ident" id="4126162">_</span><span class="op" id="4126163">,</span>&nbsp;<span class="ident" id="4126165">ok</span>&nbsp;<span class="op" id="4126168">:=</span>&nbsp;<span class="ident" id="4126171">z</span><span class="op" id="4126172">.</span><span class="ident" id="4126173">SetString</span><span class="op" id="4126182">(</span><span class="builtintype" id="4126183">string</span><span class="op" id="4126189">(</span><span class="ident" id="4126190">tok</span><span class="op" id="4126193">)</span><span class="op" id="4126194">)</span><span class="op" id="4126195">;</span>&nbsp;<span class="op" id="4126197">!</span><span class="ident" id="4126198">ok</span>&nbsp;<span class="op" id="4126201">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4126205">return</span>&nbsp;<span class="ident" id="4126212">errors</span><span class="op" id="4126218">.</span><span class="ident" id="4126219">New</span><span class="op" id="4126222">(</span><span class="string" id="4126223">&#34;Rat.Scan:&nbsp;invalid&nbsp;syntax&#34;</span><span class="op" id="4126249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4126252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4126255">return</span>&nbsp;<span class="builtintype" id="4126262">nil</span><br>
<span class="lineno"></span><span class="op" id="4126266">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="comment" id="4126269">//&nbsp;SetString&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;value&nbsp;of&nbsp;s&nbsp;and&nbsp;returns&nbsp;z&nbsp;and&nbsp;a&nbsp;boolean&nbsp;indicating</span><br>
<span class="lineno"></span><span class="comment" id="4126346">//&nbsp;success.&nbsp;s&nbsp;can&nbsp;be&nbsp;given&nbsp;as&nbsp;a&nbsp;fraction&nbsp;&#34;a/b&#34;&nbsp;or&nbsp;as&nbsp;a&nbsp;floating-point&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="4126423">//&nbsp;optionally&nbsp;followed&nbsp;by&nbsp;an&nbsp;exponent.&nbsp;If&nbsp;the&nbsp;operation&nbsp;failed,&nbsp;the&nbsp;value&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4126500">//&nbsp;z&nbsp;is&nbsp;undefined&nbsp;but&nbsp;the&nbsp;returned&nbsp;value&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="4126549">func</span>&nbsp;<span class="op" id="4126554">(</span><span class="ident" id="4126555">z</span>&nbsp;<span class="op" id="4126557">*</span><span class="ident" id="4126558">Rat</span><span class="op" id="4126561">)</span>&nbsp;<span class="ident" id="4126563">SetString</span><span class="op" id="4126572">(</span><span class="ident" id="4126573">s</span>&nbsp;<span class="builtintype" id="4126575">string</span><span class="op" id="4126581">)</span>&nbsp;<span class="op" id="4126583">(</span><span class="op" id="4126584">*</span><span class="ident" id="4126585">Rat</span><span class="op" id="4126588">,</span>&nbsp;<span class="builtintype" id="4126590">bool</span><span class="op" id="4126594">)</span>&nbsp;<span class="op" id="4126596">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4126599">if</span>&nbsp;<span class="builtinfunc" id="4126602">len</span><span class="op" id="4126605">(</span><span class="ident" id="4126606">s</span><span class="op" id="4126607">)</span>&nbsp;<span class="op" id="4126609">==</span>&nbsp;<span class="num" id="4126612">0</span>&nbsp;<span class="op" id="4126614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4126618">return</span>&nbsp;<span class="builtintype" id="4126625">nil</span><span class="op" id="4126628">,</span>&nbsp;<span class="builtintype" id="4126630">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4126637">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4126641">//&nbsp;check&nbsp;for&nbsp;a&nbsp;quotient</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4126666">sep</span>&nbsp;<span class="op" id="4126670">:=</span>&nbsp;<span class="ident" id="4126673">strings</span><span class="op" id="4126680">.</span><span class="ident" id="4126681">Index</span><span class="op" id="4126686">(</span><span class="ident" id="4126687">s</span><span class="op" id="4126688">,</span>&nbsp;<span class="string" id="4126690">&#34;/&#34;</span><span class="op" id="4126693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4126696">if</span>&nbsp;<span class="ident" id="4126699">sep</span>&nbsp;<span class="op" id="4126703">&gt;=</span>&nbsp;<span class="num" id="4126706">0</span>&nbsp;<span class="op" id="4126708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4126712">if</span>&nbsp;<span class="ident" id="4126715">_</span><span class="op" id="4126716">,</span>&nbsp;<span class="ident" id="4126718">ok</span>&nbsp;<span class="op" id="4126721">:=</span>&nbsp;<span class="ident" id="4126724">z</span><span class="op" id="4126725">.</span><span class="ident" id="4126726">a</span><span class="op" id="4126727">.</span><span class="ident" id="4126728">SetString</span><span class="op" id="4126737">(</span><span class="ident" id="4126738">s</span><span class="op" id="4126739">[</span><span class="num" id="4126740">0</span><span class="op" id="4126741">:</span><span class="ident" id="4126742">sep</span><span class="op" id="4126745">]</span><span class="op" id="4126746">,</span>&nbsp;<span class="num" id="4126748">10</span><span class="op" id="4126750">)</span><span class="op" id="4126751">;</span>&nbsp;<span class="op" id="4126753">!</span><span class="ident" id="4126754">ok</span>&nbsp;<span class="op" id="4126757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4126762">return</span>&nbsp;<span class="builtintype" id="4126769">nil</span><span class="op" id="4126772">,</span>&nbsp;<span class="builtintype" id="4126774">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4126782">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4126786">s</span>&nbsp;<span class="op" id="4126788">=</span>&nbsp;<span class="ident" id="4126790">s</span><span class="op" id="4126791">[</span><span class="ident" id="4126792">sep</span><span class="op" id="4126795">+</span><span class="num" id="4126796">1</span><span class="op" id="4126797">:</span><span class="op" id="4126798">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4126802">var</span>&nbsp;<span class="ident" id="4126806">err</span>&nbsp;<span class="builtintype" id="4126810">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4126818">if</span>&nbsp;<span class="ident" id="4126821">z</span><span class="op" id="4126822">.</span><span class="ident" id="4126823">b</span><span class="op" id="4126824">.</span><span class="ident" id="4126825">abs</span><span class="op" id="4126828">,</span>&nbsp;<span class="ident" id="4126830">_</span><span class="op" id="4126831">,</span>&nbsp;<span class="ident" id="4126833">err</span>&nbsp;<span class="op" id="4126837">=</span>&nbsp;<span class="ident" id="4126839">z</span><span class="op" id="4126840">.</span><span class="ident" id="4126841">b</span><span class="op" id="4126842">.</span><span class="ident" id="4126843">abs</span><span class="op" id="4126846">.</span><span class="ident" id="4126847">scan</span><span class="op" id="4126851">(</span><span class="ident" id="4126852">strings</span><span class="op" id="4126859">.</span><span class="ident" id="4126860">NewReader</span><span class="op" id="4126869">(</span><span class="ident" id="4126870">s</span><span class="op" id="4126871">)</span><span class="op" id="4126872">,</span>&nbsp;<span class="num" id="4126874">10</span><span class="op" id="4126876">)</span><span class="op" id="4126877">;</span>&nbsp;<span class="ident" id="4126879">err</span>&nbsp;<span class="op" id="4126883">!=</span>&nbsp;<span class="builtintype" id="4126886">nil</span>&nbsp;<span class="op" id="4126890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4126895">return</span>&nbsp;<span class="builtintype" id="4126902">nil</span><span class="op" id="4126905">,</span>&nbsp;<span class="builtintype" id="4126907">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4126915">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4126919">if</span>&nbsp;<span class="builtinfunc" id="4126922">len</span><span class="op" id="4126925">(</span><span class="ident" id="4126926">z</span><span class="op" id="4126927">.</span><span class="ident" id="4126928">b</span><span class="op" id="4126929">.</span><span class="ident" id="4126930">abs</span><span class="op" id="4126933">)</span>&nbsp;<span class="op" id="4126935">==</span>&nbsp;<span class="num" id="4126938">0</span>&nbsp;<span class="op" id="4126940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4126945">return</span>&nbsp;<span class="builtintype" id="4126952">nil</span><span class="op" id="4126955">,</span>&nbsp;<span class="builtintype" id="4126957">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4126965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4126969">return</span>&nbsp;<span class="ident" id="4126976">z</span><span class="op" id="4126977">.</span><span class="ident" id="4126978">norm</span><span class="op" id="4126982">(</span><span class="op" id="4126983">)</span><span class="op" id="4126984">,</span>&nbsp;<span class="builtintype" id="4126986">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4126992">}</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4126996">//&nbsp;check&nbsp;for&nbsp;a&nbsp;decimal&nbsp;point</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4127026">sep</span>&nbsp;<span class="op" id="4127030">=</span>&nbsp;<span class="ident" id="4127032">strings</span><span class="op" id="4127039">.</span><span class="ident" id="4127040">Index</span><span class="op" id="4127045">(</span><span class="ident" id="4127046">s</span><span class="op" id="4127047">,</span>&nbsp;<span class="string" id="4127049">&#34;.&#34;</span><span class="op" id="4127052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4127055">//&nbsp;check&nbsp;for&nbsp;an&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4127081">e</span>&nbsp;<span class="op" id="4127083">:=</span>&nbsp;<span class="ident" id="4127086">strings</span><span class="op" id="4127093">.</span><span class="ident" id="4127094">IndexAny</span><span class="op" id="4127102">(</span><span class="ident" id="4127103">s</span><span class="op" id="4127104">,</span>&nbsp;<span class="string" id="4127106">&#34;eE&#34;</span><span class="op" id="4127110">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4127113">var</span>&nbsp;<span class="ident" id="4127117">exp</span>&nbsp;<span class="ident" id="4127121">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4127126">if</span>&nbsp;<span class="ident" id="4127129">e</span>&nbsp;<span class="op" id="4127131">&gt;=</span>&nbsp;<span class="num" id="4127134">0</span>&nbsp;<span class="op" id="4127136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4127140">if</span>&nbsp;<span class="ident" id="4127143">e</span>&nbsp;<span class="op" id="4127145">&lt;</span>&nbsp;<span class="ident" id="4127147">sep</span>&nbsp;<span class="op" id="4127151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4127156">//&nbsp;The&nbsp;E&nbsp;must&nbsp;come&nbsp;after&nbsp;the&nbsp;decimal&nbsp;point.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4127203">return</span>&nbsp;<span class="builtintype" id="4127210">nil</span><span class="op" id="4127213">,</span>&nbsp;<span class="builtintype" id="4127215">false</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4127223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4127227">if</span>&nbsp;<span class="ident" id="4127230">_</span><span class="op" id="4127231">,</span>&nbsp;<span class="ident" id="4127233">ok</span>&nbsp;<span class="op" id="4127236">:=</span>&nbsp;<span class="ident" id="4127239">exp</span><span class="op" id="4127242">.</span><span class="ident" id="4127243">SetString</span><span class="op" id="4127252">(</span><span class="ident" id="4127253">s</span><span class="op" id="4127254">[</span><span class="ident" id="4127255">e</span><span class="op" id="4127256">+</span><span class="num" id="4127257">1</span><span class="op" id="4127258">:</span><span class="op" id="4127259">]</span><span class="op" id="4127260">,</span>&nbsp;<span class="num" id="4127262">10</span><span class="op" id="4127264">)</span><span class="op" id="4127265">;</span>&nbsp;<span class="op" id="4127267">!</span><span class="ident" id="4127268">ok</span>&nbsp;<span class="op" id="4127271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4127276">return</span>&nbsp;<span class="builtintype" id="4127283">nil</span><span class="op" id="4127286">,</span>&nbsp;<span class="builtintype" id="4127288">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4127296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4127300">s</span>&nbsp;<span class="op" id="4127302">=</span>&nbsp;<span class="ident" id="4127304">s</span><span class="op" id="4127305">[</span><span class="num" id="4127306">0</span><span class="op" id="4127307">:</span><span class="ident" id="4127308">e</span><span class="op" id="4127309">]</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4127312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4127315">if</span>&nbsp;<span class="ident" id="4127318">sep</span>&nbsp;<span class="op" id="4127322">&gt;=</span>&nbsp;<span class="num" id="4127325">0</span>&nbsp;<span class="op" id="4127327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4127331">s</span>&nbsp;<span class="op" id="4127333">=</span>&nbsp;<span class="ident" id="4127335">s</span><span class="op" id="4127336">[</span><span class="num" id="4127337">0</span><span class="op" id="4127338">:</span><span class="ident" id="4127339">sep</span><span class="op" id="4127342">]</span>&nbsp;<span class="op" id="4127344">+</span>&nbsp;<span class="ident" id="4127346">s</span><span class="op" id="4127347">[</span><span class="ident" id="4127348">sep</span><span class="op" id="4127351">+</span><span class="num" id="4127352">1</span><span class="op" id="4127353">:</span><span class="op" id="4127354">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4127358">exp</span><span class="op" id="4127361">.</span><span class="ident" id="4127362">Sub</span><span class="op" id="4127365">(</span><span class="op" id="4127366">&amp;</span><span class="ident" id="4127367">exp</span><span class="op" id="4127370">,</span>&nbsp;<span class="ident" id="4127372">NewInt</span><span class="op" id="4127378">(</span><span class="builtintype" id="4127379">int64</span><span class="op" id="4127384">(</span><span class="builtinfunc" id="4127385">len</span><span class="op" id="4127388">(</span><span class="ident" id="4127389">s</span><span class="op" id="4127390">)</span><span class="op" id="4127391">-</span><span class="ident" id="4127392">sep</span><span class="op" id="4127395">)</span><span class="op" id="4127396">)</span><span class="op" id="4127397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4127400">}</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4127404">if</span>&nbsp;<span class="ident" id="4127407">_</span><span class="op" id="4127408">,</span>&nbsp;<span class="ident" id="4127410">ok</span>&nbsp;<span class="op" id="4127413">:=</span>&nbsp;<span class="ident" id="4127416">z</span><span class="op" id="4127417">.</span><span class="ident" id="4127418">a</span><span class="op" id="4127419">.</span><span class="ident" id="4127420">SetString</span><span class="op" id="4127429">(</span><span class="ident" id="4127430">s</span><span class="op" id="4127431">,</span>&nbsp;<span class="num" id="4127433">10</span><span class="op" id="4127435">)</span><span class="op" id="4127436">;</span>&nbsp;<span class="op" id="4127438">!</span><span class="ident" id="4127439">ok</span>&nbsp;<span class="op" id="4127442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4127446">return</span>&nbsp;<span class="builtintype" id="4127453">nil</span><span class="op" id="4127456">,</span>&nbsp;<span class="builtintype" id="4127458">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4127465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4127468">powTen</span>&nbsp;<span class="op" id="4127475">:=</span>&nbsp;<span class="ident" id="4127478">nat</span><span class="op" id="4127481">(</span><span class="builtintype" id="4127482">nil</span><span class="op" id="4127485">)</span><span class="op" id="4127486">.</span><span class="ident" id="4127487">expNN</span><span class="op" id="4127492">(</span><span class="ident" id="4127493">natTen</span><span class="op" id="4127499">,</span>&nbsp;<span class="ident" id="4127501">exp</span><span class="op" id="4127504">.</span><span class="ident" id="4127505">abs</span><span class="op" id="4127508">,</span>&nbsp;<span class="builtintype" id="4127510">nil</span><span class="op" id="4127513">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4127516">if</span>&nbsp;<span class="ident" id="4127519">exp</span><span class="op" id="4127522">.</span><span class="ident" id="4127523">neg</span>&nbsp;<span class="op" id="4127527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4127531">z</span><span class="op" id="4127532">.</span><span class="ident" id="4127533">b</span><span class="op" id="4127534">.</span><span class="ident" id="4127535">abs</span>&nbsp;<span class="op" id="4127539">=</span>&nbsp;<span class="ident" id="4127541">powTen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4127550">z</span><span class="op" id="4127551">.</span><span class="ident" id="4127552">norm</span><span class="op" id="4127556">(</span><span class="op" id="4127557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4127560">}</span>&nbsp;<span class="keyword" id="4127562">else</span>&nbsp;<span class="op" id="4127567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4127571">z</span><span class="op" id="4127572">.</span><span class="ident" id="4127573">a</span><span class="op" id="4127574">.</span><span class="ident" id="4127575">abs</span>&nbsp;<span class="op" id="4127579">=</span>&nbsp;<span class="ident" id="4127581">z</span><span class="op" id="4127582">.</span><span class="ident" id="4127583">a</span><span class="op" id="4127584">.</span><span class="ident" id="4127585">abs</span><span class="op" id="4127588">.</span><span class="ident" id="4127589">mul</span><span class="op" id="4127592">(</span><span class="ident" id="4127593">z</span><span class="op" id="4127594">.</span><span class="ident" id="4127595">a</span><span class="op" id="4127596">.</span><span class="ident" id="4127597">abs</span><span class="op" id="4127600">,</span>&nbsp;<span class="ident" id="4127602">powTen</span><span class="op" id="4127608">)</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4127612">z</span><span class="op" id="4127613">.</span><span class="ident" id="4127614">b</span><span class="op" id="4127615">.</span><span class="ident" id="4127616">abs</span>&nbsp;<span class="op" id="4127620">=</span>&nbsp;<span class="ident" id="4127622">z</span><span class="op" id="4127623">.</span><span class="ident" id="4127624">b</span><span class="op" id="4127625">.</span><span class="ident" id="4127626">abs</span><span class="op" id="4127629">.</span><span class="builtinfunc" id="4127630">make</span><span class="op" id="4127634">(</span><span class="num" id="4127635">0</span><span class="op" id="4127636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4127639">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4127643">return</span>&nbsp;<span class="ident" id="4127650">z</span><span class="op" id="4127651">,</span>&nbsp;<span class="builtintype" id="4127653">true</span><br>
<span class="lineno"></span><span class="op" id="4127658">}</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span><span class="comment" id="4127661">//&nbsp;String&nbsp;returns&nbsp;a&nbsp;string&nbsp;representation&nbsp;of&nbsp;x&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;a/b&#34;&nbsp;(even&nbsp;if&nbsp;b&nbsp;==&nbsp;1).</span><br>
<span class="lineno"></span><span class="keyword" id="4127744">func</span>&nbsp;<span class="op" id="4127749">(</span><span class="ident" id="4127750">x</span>&nbsp;<span class="op" id="4127752">*</span><span class="ident" id="4127753">Rat</span><span class="op" id="4127756">)</span>&nbsp;<span class="ident" id="4127758">String</span><span class="op" id="4127764">(</span><span class="op" id="4127765">)</span>&nbsp;<span class="builtintype" id="4127767">string</span>&nbsp;<span class="op" id="4127774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4127777">s</span>&nbsp;<span class="op" id="4127779">:=</span>&nbsp;<span class="string" id="4127782">&#34;/1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4127788">if</span>&nbsp;<span class="builtinfunc" id="4127791">len</span><span class="op" id="4127794">(</span><span class="ident" id="4127795">x</span><span class="op" id="4127796">.</span><span class="ident" id="4127797">b</span><span class="op" id="4127798">.</span><span class="ident" id="4127799">abs</span><span class="op" id="4127802">)</span>&nbsp;<span class="op" id="4127804">!=</span>&nbsp;<span class="num" id="4127807">0</span>&nbsp;<span class="op" id="4127809">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4127813">s</span>&nbsp;<span class="op" id="4127815">=</span>&nbsp;<span class="string" id="4127817">&#34;/&#34;</span>&nbsp;<span class="op" id="4127821">+</span>&nbsp;<span class="ident" id="4127823">x</span><span class="op" id="4127824">.</span><span class="ident" id="4127825">b</span><span class="op" id="4127826">.</span><span class="ident" id="4127827">abs</span><span class="op" id="4127830">.</span><span class="ident" id="4127831">decimalString</span><span class="op" id="4127844">(</span><span class="op" id="4127845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4127848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4127851">return</span>&nbsp;<span class="ident" id="4127858">x</span><span class="op" id="4127859">.</span><span class="ident" id="4127860">a</span><span class="op" id="4127861">.</span><span class="ident" id="4127862">String</span><span class="op" id="4127868">(</span><span class="op" id="4127869">)</span>&nbsp;<span class="op" id="4127871">+</span>&nbsp;<span class="ident" id="4127873">s</span><br>
<span class="lineno"></span><span class="op" id="4127875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">605</span><span class="comment" id="4127878">//&nbsp;RatString&nbsp;returns&nbsp;a&nbsp;string&nbsp;representation&nbsp;of&nbsp;x&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;a/b&#34;&nbsp;if&nbsp;b&nbsp;!=&nbsp;1,</span><br>
<span class="lineno"></span><span class="comment" id="4127957">//&nbsp;and&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;a&#34;&nbsp;if&nbsp;b&nbsp;==&nbsp;1.</span><br>
<span class="lineno"></span><span class="keyword" id="4127991">func</span>&nbsp;<span class="op" id="4127996">(</span><span class="ident" id="4127997">x</span>&nbsp;<span class="op" id="4127999">*</span><span class="ident" id="4128000">Rat</span><span class="op" id="4128003">)</span>&nbsp;<span class="ident" id="4128005">RatString</span><span class="op" id="4128014">(</span><span class="op" id="4128015">)</span>&nbsp;<span class="builtintype" id="4128017">string</span>&nbsp;<span class="op" id="4128024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4128027">if</span>&nbsp;<span class="ident" id="4128030">x</span><span class="op" id="4128031">.</span><span class="ident" id="4128032">IsInt</span><span class="op" id="4128037">(</span><span class="op" id="4128038">)</span>&nbsp;<span class="op" id="4128040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4128044">return</span>&nbsp;<span class="ident" id="4128051">x</span><span class="op" id="4128052">.</span><span class="ident" id="4128053">a</span><span class="op" id="4128054">.</span><span class="ident" id="4128055">String</span><span class="op" id="4128061">(</span><span class="op" id="4128062">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4128065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4128068">return</span>&nbsp;<span class="ident" id="4128075">x</span><span class="op" id="4128076">.</span><span class="ident" id="4128077">String</span><span class="op" id="4128083">(</span><span class="op" id="4128084">)</span><br>
<span class="lineno"></span><span class="op" id="4128086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4128089">//&nbsp;FloatString&nbsp;returns&nbsp;a&nbsp;string&nbsp;representation&nbsp;of&nbsp;x&nbsp;in&nbsp;decimal&nbsp;form&nbsp;with&nbsp;prec</span><br>
<span class="lineno">615</span><span class="comment" id="4128167">//&nbsp;digits&nbsp;of&nbsp;precision&nbsp;after&nbsp;the&nbsp;decimal&nbsp;point&nbsp;and&nbsp;the&nbsp;last&nbsp;digit&nbsp;rounded.</span><br>
<span class="lineno"></span><span class="keyword" id="4128242">func</span>&nbsp;<span class="op" id="4128247">(</span><span class="ident" id="4128248">x</span>&nbsp;<span class="op" id="4128250">*</span><span class="ident" id="4128251">Rat</span><span class="op" id="4128254">)</span>&nbsp;<span class="ident" id="4128256">FloatString</span><span class="op" id="4128267">(</span><span class="ident" id="4128268">prec</span>&nbsp;<span class="builtintype" id="4128273">int</span><span class="op" id="4128276">)</span>&nbsp;<span class="builtintype" id="4128278">string</span>&nbsp;<span class="op" id="4128285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4128288">if</span>&nbsp;<span class="ident" id="4128291">x</span><span class="op" id="4128292">.</span><span class="ident" id="4128293">IsInt</span><span class="op" id="4128298">(</span><span class="op" id="4128299">)</span>&nbsp;<span class="op" id="4128301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4128305">s</span>&nbsp;<span class="op" id="4128307">:=</span>&nbsp;<span class="ident" id="4128310">x</span><span class="op" id="4128311">.</span><span class="ident" id="4128312">a</span><span class="op" id="4128313">.</span><span class="ident" id="4128314">String</span><span class="op" id="4128320">(</span><span class="op" id="4128321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4128325">if</span>&nbsp;<span class="ident" id="4128328">prec</span>&nbsp;<span class="op" id="4128333">&gt;</span>&nbsp;<span class="num" id="4128335">0</span>&nbsp;<span class="op" id="4128337">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4128342">s</span>&nbsp;<span class="op" id="4128344">+=</span>&nbsp;<span class="string" id="4128347">&#34;.&#34;</span>&nbsp;<span class="op" id="4128351">+</span>&nbsp;<span class="ident" id="4128353">strings</span><span class="op" id="4128360">.</span><span class="ident" id="4128361">Repeat</span><span class="op" id="4128367">(</span><span class="string" id="4128368">&#34;0&#34;</span><span class="op" id="4128371">,</span>&nbsp;<span class="ident" id="4128373">prec</span><span class="op" id="4128377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4128381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4128385">return</span>&nbsp;<span class="ident" id="4128392">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4128395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4128398">//&nbsp;x.b.abs&nbsp;!=&nbsp;0</span><br>
<span class="lineno">625</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4128416">q</span><span class="op" id="4128417">,</span>&nbsp;<span class="ident" id="4128419">r</span>&nbsp;<span class="op" id="4128421">:=</span>&nbsp;<span class="ident" id="4128424">nat</span><span class="op" id="4128427">(</span><span class="builtintype" id="4128428">nil</span><span class="op" id="4128431">)</span><span class="op" id="4128432">.</span><span class="ident" id="4128433">div</span><span class="op" id="4128436">(</span><span class="ident" id="4128437">nat</span><span class="op" id="4128440">(</span><span class="builtintype" id="4128441">nil</span><span class="op" id="4128444">)</span><span class="op" id="4128445">,</span>&nbsp;<span class="ident" id="4128447">x</span><span class="op" id="4128448">.</span><span class="ident" id="4128449">a</span><span class="op" id="4128450">.</span><span class="ident" id="4128451">abs</span><span class="op" id="4128454">,</span>&nbsp;<span class="ident" id="4128456">x</span><span class="op" id="4128457">.</span><span class="ident" id="4128458">b</span><span class="op" id="4128459">.</span><span class="ident" id="4128460">abs</span><span class="op" id="4128463">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4128467">p</span>&nbsp;<span class="op" id="4128469">:=</span>&nbsp;<span class="ident" id="4128472">natOne</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4128480">if</span>&nbsp;<span class="ident" id="4128483">prec</span>&nbsp;<span class="op" id="4128488">&gt;</span>&nbsp;<span class="num" id="4128490">0</span>&nbsp;<span class="op" id="4128492">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4128496">p</span>&nbsp;<span class="op" id="4128498">=</span>&nbsp;<span class="ident" id="4128500">nat</span><span class="op" id="4128503">(</span><span class="builtintype" id="4128504">nil</span><span class="op" id="4128507">)</span><span class="op" id="4128508">.</span><span class="ident" id="4128509">expNN</span><span class="op" id="4128514">(</span><span class="ident" id="4128515">natTen</span><span class="op" id="4128521">,</span>&nbsp;<span class="ident" id="4128523">nat</span><span class="op" id="4128526">(</span><span class="builtintype" id="4128527">nil</span><span class="op" id="4128530">)</span><span class="op" id="4128531">.</span><span class="ident" id="4128532">setUint64</span><span class="op" id="4128541">(</span><span class="builtintype" id="4128542">uint64</span><span class="op" id="4128548">(</span><span class="ident" id="4128549">prec</span><span class="op" id="4128553">)</span><span class="op" id="4128554">)</span><span class="op" id="4128555">,</span>&nbsp;<span class="builtintype" id="4128557">nil</span><span class="op" id="4128560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4128563">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4128567">r</span>&nbsp;<span class="op" id="4128569">=</span>&nbsp;<span class="ident" id="4128571">r</span><span class="op" id="4128572">.</span><span class="ident" id="4128573">mul</span><span class="op" id="4128576">(</span><span class="ident" id="4128577">r</span><span class="op" id="4128578">,</span>&nbsp;<span class="ident" id="4128580">p</span><span class="op" id="4128581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4128584">r</span><span class="op" id="4128585">,</span>&nbsp;<span class="ident" id="4128587">r2</span>&nbsp;<span class="op" id="4128590">:=</span>&nbsp;<span class="ident" id="4128593">r</span><span class="op" id="4128594">.</span><span class="ident" id="4128595">div</span><span class="op" id="4128598">(</span><span class="ident" id="4128599">nat</span><span class="op" id="4128602">(</span><span class="builtintype" id="4128603">nil</span><span class="op" id="4128606">)</span><span class="op" id="4128607">,</span>&nbsp;<span class="ident" id="4128609">r</span><span class="op" id="4128610">,</span>&nbsp;<span class="ident" id="4128612">x</span><span class="op" id="4128613">.</span><span class="ident" id="4128614">b</span><span class="op" id="4128615">.</span><span class="ident" id="4128616">abs</span><span class="op" id="4128619">)</span><br>
<span class="lineno">635</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4128623">//&nbsp;see&nbsp;if&nbsp;we&nbsp;need&nbsp;to&nbsp;round&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4128654">r2</span>&nbsp;<span class="op" id="4128657">=</span>&nbsp;<span class="ident" id="4128659">r2</span><span class="op" id="4128661">.</span><span class="ident" id="4128662">add</span><span class="op" id="4128665">(</span><span class="ident" id="4128666">r2</span><span class="op" id="4128668">,</span>&nbsp;<span class="ident" id="4128670">r2</span><span class="op" id="4128672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4128675">if</span>&nbsp;<span class="ident" id="4128678">x</span><span class="op" id="4128679">.</span><span class="ident" id="4128680">b</span><span class="op" id="4128681">.</span><span class="ident" id="4128682">abs</span><span class="op" id="4128685">.</span><span class="ident" id="4128686">cmp</span><span class="op" id="4128689">(</span><span class="ident" id="4128690">r2</span><span class="op" id="4128692">)</span>&nbsp;<span class="op" id="4128694">&lt;=</span>&nbsp;<span class="num" id="4128697">0</span>&nbsp;<span class="op" id="4128699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4128703">r</span>&nbsp;<span class="op" id="4128705">=</span>&nbsp;<span class="ident" id="4128707">r</span><span class="op" id="4128708">.</span><span class="ident" id="4128709">add</span><span class="op" id="4128712">(</span><span class="ident" id="4128713">r</span><span class="op" id="4128714">,</span>&nbsp;<span class="ident" id="4128716">natOne</span><span class="op" id="4128722">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4128726">if</span>&nbsp;<span class="ident" id="4128729">r</span><span class="op" id="4128730">.</span><span class="ident" id="4128731">cmp</span><span class="op" id="4128734">(</span><span class="ident" id="4128735">p</span><span class="op" id="4128736">)</span>&nbsp;<span class="op" id="4128738">&gt;=</span>&nbsp;<span class="num" id="4128741">0</span>&nbsp;<span class="op" id="4128743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4128748">q</span>&nbsp;<span class="op" id="4128750">=</span>&nbsp;<span class="ident" id="4128752">nat</span><span class="op" id="4128755">(</span><span class="builtintype" id="4128756">nil</span><span class="op" id="4128759">)</span><span class="op" id="4128760">.</span><span class="ident" id="4128761">add</span><span class="op" id="4128764">(</span><span class="ident" id="4128765">q</span><span class="op" id="4128766">,</span>&nbsp;<span class="ident" id="4128768">natOne</span><span class="op" id="4128774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4128779">r</span>&nbsp;<span class="op" id="4128781">=</span>&nbsp;<span class="ident" id="4128783">nat</span><span class="op" id="4128786">(</span><span class="builtintype" id="4128787">nil</span><span class="op" id="4128790">)</span><span class="op" id="4128791">.</span><span class="ident" id="4128792">sub</span><span class="op" id="4128795">(</span><span class="ident" id="4128796">r</span><span class="op" id="4128797">,</span>&nbsp;<span class="ident" id="4128799">p</span><span class="op" id="4128800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4128804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4128807">}</span><br>
<span class="lineno">645</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4128811">s</span>&nbsp;<span class="op" id="4128813">:=</span>&nbsp;<span class="ident" id="4128816">q</span><span class="op" id="4128817">.</span><span class="ident" id="4128818">decimalString</span><span class="op" id="4128831">(</span><span class="op" id="4128832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4128835">if</span>&nbsp;<span class="ident" id="4128838">x</span><span class="op" id="4128839">.</span><span class="ident" id="4128840">a</span><span class="op" id="4128841">.</span><span class="ident" id="4128842">neg</span>&nbsp;<span class="op" id="4128846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4128850">s</span>&nbsp;<span class="op" id="4128852">=</span>&nbsp;<span class="string" id="4128854">&#34;-&#34;</span>&nbsp;<span class="op" id="4128858">+</span>&nbsp;<span class="ident" id="4128860">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4128863">}</span><br>
<span class="lineno">650</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4128867">if</span>&nbsp;<span class="ident" id="4128870">prec</span>&nbsp;<span class="op" id="4128875">&gt;</span>&nbsp;<span class="num" id="4128877">0</span>&nbsp;<span class="op" id="4128879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4128883">rs</span>&nbsp;<span class="op" id="4128886">:=</span>&nbsp;<span class="ident" id="4128889">r</span><span class="op" id="4128890">.</span><span class="ident" id="4128891">decimalString</span><span class="op" id="4128904">(</span><span class="op" id="4128905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4128909">leadingZeros</span>&nbsp;<span class="op" id="4128922">:=</span>&nbsp;<span class="ident" id="4128925">prec</span>&nbsp;<span class="op" id="4128930">-</span>&nbsp;<span class="builtinfunc" id="4128932">len</span><span class="op" id="4128935">(</span><span class="ident" id="4128936">rs</span><span class="op" id="4128938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4128942">s</span>&nbsp;<span class="op" id="4128944">+=</span>&nbsp;<span class="string" id="4128947">&#34;.&#34;</span>&nbsp;<span class="op" id="4128951">+</span>&nbsp;<span class="ident" id="4128953">strings</span><span class="op" id="4128960">.</span><span class="ident" id="4128961">Repeat</span><span class="op" id="4128967">(</span><span class="string" id="4128968">&#34;0&#34;</span><span class="op" id="4128971">,</span>&nbsp;<span class="ident" id="4128973">leadingZeros</span><span class="op" id="4128985">)</span>&nbsp;<span class="op" id="4128987">+</span>&nbsp;<span class="ident" id="4128989">rs</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4128993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4128997">return</span>&nbsp;<span class="ident" id="4129004">s</span><br>
<span class="lineno"></span><span class="op" id="4129006">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">660</span><span class="comment" id="4129009">//&nbsp;Gob&nbsp;codec&nbsp;version.&nbsp;Permits&nbsp;backward-compatible&nbsp;changes&nbsp;to&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="4129084">const</span>&nbsp;<span class="ident" id="4129090">ratGobVersion</span>&nbsp;<span class="builtintype" id="4129104">byte</span>&nbsp;<span class="op" id="4129109">=</span>&nbsp;<span class="num" id="4129111">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4129114">//&nbsp;GobEncode&nbsp;implements&nbsp;the&nbsp;gob.GobEncoder&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="4129168">func</span>&nbsp;<span class="op" id="4129173">(</span><span class="ident" id="4129174">x</span>&nbsp;<span class="op" id="4129176">*</span><span class="ident" id="4129177">Rat</span><span class="op" id="4129180">)</span>&nbsp;<span class="ident" id="4129182">GobEncode</span><span class="op" id="4129191">(</span><span class="op" id="4129192">)</span>&nbsp;<span class="op" id="4129194">(</span><span class="op" id="4129195">[</span><span class="op" id="4129196">]</span><span class="builtintype" id="4129197">byte</span><span class="op" id="4129201">,</span>&nbsp;<span class="builtintype" id="4129203">error</span><span class="op" id="4129208">)</span>&nbsp;<span class="op" id="4129210">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4129213">if</span>&nbsp;<span class="ident" id="4129216">x</span>&nbsp;<span class="op" id="4129218">==</span>&nbsp;<span class="builtintype" id="4129221">nil</span>&nbsp;<span class="op" id="4129225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4129229">return</span>&nbsp;<span class="builtintype" id="4129236">nil</span><span class="op" id="4129239">,</span>&nbsp;<span class="builtintype" id="4129241">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4129246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4129249">buf</span>&nbsp;<span class="op" id="4129253">:=</span>&nbsp;<span class="builtinfunc" id="4129256">make</span><span class="op" id="4129260">(</span><span class="op" id="4129261">[</span><span class="op" id="4129262">]</span><span class="builtintype" id="4129263">byte</span><span class="op" id="4129267">,</span>&nbsp;<span class="num" id="4129269">1</span><span class="op" id="4129270">+</span><span class="num" id="4129271">4</span><span class="op" id="4129272">+</span><span class="op" id="4129273">(</span><span class="builtinfunc" id="4129274">len</span><span class="op" id="4129277">(</span><span class="ident" id="4129278">x</span><span class="op" id="4129279">.</span><span class="ident" id="4129280">a</span><span class="op" id="4129281">.</span><span class="ident" id="4129282">abs</span><span class="op" id="4129285">)</span><span class="op" id="4129286">+</span><span class="builtinfunc" id="4129287">len</span><span class="op" id="4129290">(</span><span class="ident" id="4129291">x</span><span class="op" id="4129292">.</span><span class="ident" id="4129293">b</span><span class="op" id="4129294">.</span><span class="ident" id="4129295">abs</span><span class="op" id="4129298">)</span><span class="op" id="4129299">)</span><span class="op" id="4129300">*</span><span class="ident" id="4129301">_S</span><span class="op" id="4129303">)</span>&nbsp;<span class="comment" id="4129305">//&nbsp;extra&nbsp;bytes&nbsp;for&nbsp;version&nbsp;and&nbsp;sign&nbsp;bit&nbsp;(1),&nbsp;and&nbsp;numerator&nbsp;length&nbsp;(4)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4129376">i</span>&nbsp;<span class="op" id="4129378">:=</span>&nbsp;<span class="ident" id="4129381">x</span><span class="op" id="4129382">.</span><span class="ident" id="4129383">b</span><span class="op" id="4129384">.</span><span class="ident" id="4129385">abs</span><span class="op" id="4129388">.</span><span class="ident" id="4129389">bytes</span><span class="op" id="4129394">(</span><span class="ident" id="4129395">buf</span><span class="op" id="4129398">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4129401">j</span>&nbsp;<span class="op" id="4129403">:=</span>&nbsp;<span class="ident" id="4129406">x</span><span class="op" id="4129407">.</span><span class="ident" id="4129408">a</span><span class="op" id="4129409">.</span><span class="ident" id="4129410">abs</span><span class="op" id="4129413">.</span><span class="ident" id="4129414">bytes</span><span class="op" id="4129419">(</span><span class="ident" id="4129420">buf</span><span class="op" id="4129423">[</span><span class="num" id="4129424">0</span><span class="op" id="4129425">:</span><span class="ident" id="4129426">i</span><span class="op" id="4129427">]</span><span class="op" id="4129428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4129431">n</span>&nbsp;<span class="op" id="4129433">:=</span>&nbsp;<span class="ident" id="4129436">i</span>&nbsp;<span class="op" id="4129438">-</span>&nbsp;<span class="ident" id="4129440">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4129443">if</span>&nbsp;<span class="builtintype" id="4129446">int</span><span class="op" id="4129449">(</span><span class="builtintype" id="4129450">uint32</span><span class="op" id="4129456">(</span><span class="ident" id="4129457">n</span><span class="op" id="4129458">)</span><span class="op" id="4129459">)</span>&nbsp;<span class="op" id="4129461">!=</span>&nbsp;<span class="ident" id="4129464">n</span>&nbsp;<span class="op" id="4129466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4129470">//&nbsp;this&nbsp;should&nbsp;never&nbsp;happen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4129500">return</span>&nbsp;<span class="builtintype" id="4129507">nil</span><span class="op" id="4129510">,</span>&nbsp;<span class="ident" id="4129512">errors</span><span class="op" id="4129518">.</span><span class="ident" id="4129519">New</span><span class="op" id="4129522">(</span><span class="string" id="4129523">&#34;Rat.GobEncode:&nbsp;numerator&nbsp;too&nbsp;large&#34;</span><span class="op" id="4129559">)</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4129562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4129565">binary</span><span class="op" id="4129571">.</span><span class="ident" id="4129572">BigEndian</span><span class="op" id="4129581">.</span><span class="ident" id="4129582">PutUint32</span><span class="op" id="4129591">(</span><span class="ident" id="4129592">buf</span><span class="op" id="4129595">[</span><span class="ident" id="4129596">j</span><span class="op" id="4129597">-</span><span class="num" id="4129598">4</span><span class="op" id="4129599">:</span><span class="ident" id="4129600">j</span><span class="op" id="4129601">]</span><span class="op" id="4129602">,</span>&nbsp;<span class="builtintype" id="4129604">uint32</span><span class="op" id="4129610">(</span><span class="ident" id="4129611">n</span><span class="op" id="4129612">)</span><span class="op" id="4129613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4129616">j</span>&nbsp;<span class="op" id="4129618">-=</span>&nbsp;<span class="num" id="4129621">1</span>&nbsp;<span class="op" id="4129623">+</span>&nbsp;<span class="num" id="4129625">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4129628">b</span>&nbsp;<span class="op" id="4129630">:=</span>&nbsp;<span class="ident" id="4129633">ratGobVersion</span>&nbsp;<span class="op" id="4129647">&lt;&lt;</span>&nbsp;<span class="num" id="4129650">1</span>&nbsp;<span class="comment" id="4129652">//&nbsp;make&nbsp;space&nbsp;for&nbsp;sign&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4129680">if</span>&nbsp;<span class="ident" id="4129683">x</span><span class="op" id="4129684">.</span><span class="ident" id="4129685">a</span><span class="op" id="4129686">.</span><span class="ident" id="4129687">neg</span>&nbsp;<span class="op" id="4129691">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4129695">b</span>&nbsp;<span class="op" id="4129697">|=</span>&nbsp;<span class="num" id="4129700">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4129703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4129706">buf</span><span class="op" id="4129709">[</span><span class="ident" id="4129710">j</span><span class="op" id="4129711">]</span>&nbsp;<span class="op" id="4129713">=</span>&nbsp;<span class="ident" id="4129715">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4129718">return</span>&nbsp;<span class="ident" id="4129725">buf</span><span class="op" id="4129728">[</span><span class="ident" id="4129729">j</span><span class="op" id="4129730">:</span><span class="op" id="4129731">]</span><span class="op" id="4129732">,</span>&nbsp;<span class="builtintype" id="4129734">nil</span><br>
<span class="lineno"></span><span class="op" id="4129738">}</span><br>
<span class="lineno">685</span><br>
<span class="lineno"></span><span class="comment" id="4129741">//&nbsp;GobDecode&nbsp;implements&nbsp;the&nbsp;gob.GobDecoder&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="4129795">func</span>&nbsp;<span class="op" id="4129800">(</span><span class="ident" id="4129801">z</span>&nbsp;<span class="op" id="4129803">*</span><span class="ident" id="4129804">Rat</span><span class="op" id="4129807">)</span>&nbsp;<span class="ident" id="4129809">GobDecode</span><span class="op" id="4129818">(</span><span class="ident" id="4129819">buf</span>&nbsp;<span class="op" id="4129823">[</span><span class="op" id="4129824">]</span><span class="builtintype" id="4129825">byte</span><span class="op" id="4129829">)</span>&nbsp;<span class="builtintype" id="4129831">error</span>&nbsp;<span class="op" id="4129837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4129840">if</span>&nbsp;<span class="builtinfunc" id="4129843">len</span><span class="op" id="4129846">(</span><span class="ident" id="4129847">buf</span><span class="op" id="4129850">)</span>&nbsp;<span class="op" id="4129852">==</span>&nbsp;<span class="num" id="4129855">0</span>&nbsp;<span class="op" id="4129857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4129861">//&nbsp;Other&nbsp;side&nbsp;sent&nbsp;a&nbsp;nil&nbsp;or&nbsp;default&nbsp;value.</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4129906">*</span><span class="ident" id="4129907">z</span>&nbsp;<span class="op" id="4129909">=</span>&nbsp;<span class="ident" id="4129911">Rat</span><span class="op" id="4129914">{</span><span class="op" id="4129915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4129919">return</span>&nbsp;<span class="builtintype" id="4129926">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4129931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4129934">b</span>&nbsp;<span class="op" id="4129936">:=</span>&nbsp;<span class="ident" id="4129939">buf</span><span class="op" id="4129942">[</span><span class="num" id="4129943">0</span><span class="op" id="4129944">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4129947">if</span>&nbsp;<span class="ident" id="4129950">b</span><span class="op" id="4129951">&gt;&gt;</span><span class="num" id="4129953">1</span>&nbsp;<span class="op" id="4129955">!=</span>&nbsp;<span class="ident" id="4129958">ratGobVersion</span>&nbsp;<span class="op" id="4129972">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4129976">return</span>&nbsp;<span class="ident" id="4129983">errors</span><span class="op" id="4129989">.</span><span class="ident" id="4129990">New</span><span class="op" id="4129993">(</span><span class="ident" id="4129994">fmt</span><span class="op" id="4129997">.</span><span class="ident" id="4129998">Sprintf</span><span class="op" id="4130005">(</span><span class="string" id="4130006">&#34;Rat.GobDecode:&nbsp;encoding&nbsp;version&nbsp;%d&nbsp;not&nbsp;supported&#34;</span><span class="op" id="4130056">,</span>&nbsp;<span class="ident" id="4130058">b</span><span class="op" id="4130059">&gt;&gt;</span><span class="num" id="4130061">1</span><span class="op" id="4130062">)</span><span class="op" id="4130063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4130066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4130069">const</span>&nbsp;<span class="ident" id="4130075">j</span>&nbsp;<span class="op" id="4130077">=</span>&nbsp;<span class="num" id="4130079">1</span>&nbsp;<span class="op" id="4130081">+</span>&nbsp;<span class="num" id="4130083">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4130086">i</span>&nbsp;<span class="op" id="4130088">:=</span>&nbsp;<span class="ident" id="4130091">j</span>&nbsp;<span class="op" id="4130093">+</span>&nbsp;<span class="ident" id="4130095">binary</span><span class="op" id="4130101">.</span><span class="ident" id="4130102">BigEndian</span><span class="op" id="4130111">.</span><span class="ident" id="4130112">Uint32</span><span class="op" id="4130118">(</span><span class="ident" id="4130119">buf</span><span class="op" id="4130122">[</span><span class="ident" id="4130123">j</span><span class="op" id="4130124">-</span><span class="num" id="4130125">4</span><span class="op" id="4130126">:</span><span class="ident" id="4130127">j</span><span class="op" id="4130128">]</span><span class="op" id="4130129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4130132">z</span><span class="op" id="4130133">.</span><span class="ident" id="4130134">a</span><span class="op" id="4130135">.</span><span class="ident" id="4130136">neg</span>&nbsp;<span class="op" id="4130140">=</span>&nbsp;<span class="ident" id="4130142">b</span><span class="op" id="4130143">&amp;</span><span class="num" id="4130144">1</span>&nbsp;<span class="op" id="4130146">!=</span>&nbsp;<span class="num" id="4130149">0</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4130152">z</span><span class="op" id="4130153">.</span><span class="ident" id="4130154">a</span><span class="op" id="4130155">.</span><span class="ident" id="4130156">abs</span>&nbsp;<span class="op" id="4130160">=</span>&nbsp;<span class="ident" id="4130162">z</span><span class="op" id="4130163">.</span><span class="ident" id="4130164">a</span><span class="op" id="4130165">.</span><span class="ident" id="4130166">abs</span><span class="op" id="4130169">.</span><span class="ident" id="4130170">setBytes</span><span class="op" id="4130178">(</span><span class="ident" id="4130179">buf</span><span class="op" id="4130182">[</span><span class="ident" id="4130183">j</span><span class="op" id="4130184">:</span><span class="ident" id="4130185">i</span><span class="op" id="4130186">]</span><span class="op" id="4130187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4130190">z</span><span class="op" id="4130191">.</span><span class="ident" id="4130192">b</span><span class="op" id="4130193">.</span><span class="ident" id="4130194">abs</span>&nbsp;<span class="op" id="4130198">=</span>&nbsp;<span class="ident" id="4130200">z</span><span class="op" id="4130201">.</span><span class="ident" id="4130202">b</span><span class="op" id="4130203">.</span><span class="ident" id="4130204">abs</span><span class="op" id="4130207">.</span><span class="ident" id="4130208">setBytes</span><span class="op" id="4130216">(</span><span class="ident" id="4130217">buf</span><span class="op" id="4130220">[</span><span class="ident" id="4130221">i</span><span class="op" id="4130222">:</span><span class="op" id="4130223">]</span><span class="op" id="4130224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4130227">return</span>&nbsp;<span class="builtintype" id="4130234">nil</span><br>
<span class="lineno"></span><span class="op" id="4130238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">705</span><span class="comment" id="4130241">//&nbsp;MarshalText&nbsp;implements&nbsp;the&nbsp;encoding.TextMarshaler&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="4130305">func</span>&nbsp;<span class="op" id="4130310">(</span><span class="ident" id="4130311">r</span>&nbsp;<span class="op" id="4130313">*</span><span class="ident" id="4130314">Rat</span><span class="op" id="4130317">)</span>&nbsp;<span class="ident" id="4130319">MarshalText</span><span class="op" id="4130330">(</span><span class="op" id="4130331">)</span>&nbsp;<span class="op" id="4130333">(</span><span class="ident" id="4130334">text</span>&nbsp;<span class="op" id="4130339">[</span><span class="op" id="4130340">]</span><span class="builtintype" id="4130341">byte</span><span class="op" id="4130345">,</span>&nbsp;<span class="ident" id="4130347">err</span>&nbsp;<span class="builtintype" id="4130351">error</span><span class="op" id="4130356">)</span>&nbsp;<span class="op" id="4130358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4130361">return</span>&nbsp;<span class="op" id="4130368">[</span><span class="op" id="4130369">]</span><span class="builtintype" id="4130370">byte</span><span class="op" id="4130374">(</span><span class="ident" id="4130375">r</span><span class="op" id="4130376">.</span><span class="ident" id="4130377">RatString</span><span class="op" id="4130386">(</span><span class="op" id="4130387">)</span><span class="op" id="4130388">)</span><span class="op" id="4130389">,</span>&nbsp;<span class="builtintype" id="4130391">nil</span><br>
<span class="lineno"></span><span class="op" id="4130395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">710</span><span class="comment" id="4130398">//&nbsp;UnmarshalText&nbsp;implements&nbsp;the&nbsp;encoding.TextUnmarshaler&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="4130466">func</span>&nbsp;<span class="op" id="4130471">(</span><span class="ident" id="4130472">r</span>&nbsp;<span class="op" id="4130474">*</span><span class="ident" id="4130475">Rat</span><span class="op" id="4130478">)</span>&nbsp;<span class="ident" id="4130480">UnmarshalText</span><span class="op" id="4130493">(</span><span class="ident" id="4130494">text</span>&nbsp;<span class="op" id="4130499">[</span><span class="op" id="4130500">]</span><span class="builtintype" id="4130501">byte</span><span class="op" id="4130505">)</span>&nbsp;<span class="builtintype" id="4130507">error</span>&nbsp;<span class="op" id="4130513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4130516">if</span>&nbsp;<span class="ident" id="4130519">_</span><span class="op" id="4130520">,</span>&nbsp;<span class="ident" id="4130522">ok</span>&nbsp;<span class="op" id="4130525">:=</span>&nbsp;<span class="ident" id="4130528">r</span><span class="op" id="4130529">.</span><span class="ident" id="4130530">SetString</span><span class="op" id="4130539">(</span><span class="builtintype" id="4130540">string</span><span class="op" id="4130546">(</span><span class="ident" id="4130547">text</span><span class="op" id="4130551">)</span><span class="op" id="4130552">)</span><span class="op" id="4130553">;</span>&nbsp;<span class="op" id="4130555">!</span><span class="ident" id="4130556">ok</span>&nbsp;<span class="op" id="4130559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4130563">return</span>&nbsp;<span class="ident" id="4130570">fmt</span><span class="op" id="4130573">.</span><span class="ident" id="4130574">Errorf</span><span class="op" id="4130580">(</span><span class="string" id="4130581">&#34;math/big:&nbsp;cannot&nbsp;unmarshal&nbsp;%q&nbsp;into&nbsp;a&nbsp;*big.Rat&#34;</span><span class="op" id="4130628">,</span>&nbsp;<span class="ident" id="4130630">text</span><span class="op" id="4130634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4130637">}</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4130640">return</span>&nbsp;<span class="builtintype" id="4130647">nil</span><br>
<span class="lineno"></span><span class="op" id="4130651">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
