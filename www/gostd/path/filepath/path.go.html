<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>path/filepath</h2>
<ul>
<li><a href="/gostd/path/filepath/example_unix_test.go.html">example_unix_test.go</a></li>
<li><a href="/gostd/path/filepath/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/path/filepath/match.go.html">match.go</a></li>
<li><a href="/gostd/path/filepath/match_test.go.html">match_test.go</a></li>
<li><a href="/gostd/path/filepath/path.go.html">path.go</a></li>
<li><a href="/gostd/path/filepath/path_test.go.html">path_test.go</a></li>
<li><a href="/gostd/path/filepath/path_unix.go.html">path_unix.go</a></li>
<li><a href="/gostd/path/filepath/symlink.go.html">symlink.go</a></li>
<li><a href="/gostd/path/filepath/symlink_unix.go.html">symlink_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3038527">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3038582">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3038636">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3038687">//&nbsp;Package&nbsp;filepath&nbsp;implements&nbsp;utility&nbsp;routines&nbsp;for&nbsp;manipulating&nbsp;filename&nbsp;paths</span><br>
<span class="lineno"></span><span class="comment" id="3038767">//&nbsp;in&nbsp;a&nbsp;way&nbsp;compatible&nbsp;with&nbsp;the&nbsp;target&nbsp;operating&nbsp;system-defined&nbsp;file&nbsp;paths.</span><br>
<span class="lineno"></span><span class="keyword" id="3038843">package</span>&nbsp;<span class="ident" id="3038851">filepath</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3038861">import</span>&nbsp;<span class="op" id="3038868">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3038871">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3038881">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3038887">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3038895">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="3038905">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3038908">//&nbsp;A&nbsp;lazybuf&nbsp;is&nbsp;a&nbsp;lazily&nbsp;constructed&nbsp;path&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="3038958">//&nbsp;It&nbsp;supports&nbsp;append,&nbsp;reading&nbsp;previously&nbsp;appended&nbsp;bytes,</span><br>
<span class="lineno"></span><span class="comment" id="3039016">//&nbsp;and&nbsp;retrieving&nbsp;the&nbsp;final&nbsp;string.&nbsp;It&nbsp;does&nbsp;not&nbsp;allocate&nbsp;a&nbsp;buffer</span><br>
<span class="lineno"></span><span class="comment" id="3039082">//&nbsp;to&nbsp;hold&nbsp;the&nbsp;output&nbsp;until&nbsp;that&nbsp;output&nbsp;diverges&nbsp;from&nbsp;s.</span><br>
<span class="lineno">20</span><span class="keyword" id="3039139">type</span>&nbsp;<span class="ident" id="3039144">lazybuf</span>&nbsp;<span class="keyword" id="3039152">struct</span>&nbsp;<span class="op" id="3039159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3039162">path</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3039173">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3039181">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3039192">[</span><span class="op" id="3039193">]</span><span class="builtintype" id="3039194">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3039200">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3039211">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3039216">volAndPath</span>&nbsp;<span class="builtintype" id="3039227">string</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3039235">volLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3039246">int</span><br>
<span class="lineno"></span><span class="op" id="3039250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3039253">func</span>&nbsp;<span class="op" id="3039258">(</span><span class="ident" id="3039259">b</span>&nbsp;<span class="op" id="3039261">*</span><span class="ident" id="3039262">lazybuf</span><span class="op" id="3039269">)</span>&nbsp;<span class="ident" id="3039271">index</span><span class="op" id="3039276">(</span><span class="ident" id="3039277">i</span>&nbsp;<span class="builtintype" id="3039279">int</span><span class="op" id="3039282">)</span>&nbsp;<span class="builtintype" id="3039284">byte</span>&nbsp;<span class="op" id="3039289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3039292">if</span>&nbsp;<span class="ident" id="3039295">b</span><span class="op" id="3039296">.</span><span class="ident" id="3039297">buf</span>&nbsp;<span class="op" id="3039301">!=</span>&nbsp;<span class="ident" id="3039304">nil</span>&nbsp;<span class="op" id="3039308">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3039312">return</span>&nbsp;<span class="ident" id="3039319">b</span><span class="op" id="3039320">.</span><span class="ident" id="3039321">buf</span><span class="op" id="3039324">[</span><span class="ident" id="3039325">i</span><span class="op" id="3039326">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3039329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3039332">return</span>&nbsp;<span class="ident" id="3039339">b</span><span class="op" id="3039340">.</span><span class="ident" id="3039341">path</span><span class="op" id="3039345">[</span><span class="ident" id="3039346">i</span><span class="op" id="3039347">]</span><br>
<span class="lineno"></span><span class="op" id="3039349">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="3039352">func</span>&nbsp;<span class="op" id="3039357">(</span><span class="ident" id="3039358">b</span>&nbsp;<span class="op" id="3039360">*</span><span class="ident" id="3039361">lazybuf</span><span class="op" id="3039368">)</span>&nbsp;<span class="builtinfunc" id="3039370">append</span><span class="op" id="3039376">(</span><span class="ident" id="3039377">c</span>&nbsp;<span class="builtintype" id="3039379">byte</span><span class="op" id="3039383">)</span>&nbsp;<span class="op" id="3039385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3039388">if</span>&nbsp;<span class="ident" id="3039391">b</span><span class="op" id="3039392">.</span><span class="ident" id="3039393">buf</span>&nbsp;<span class="op" id="3039397">==</span>&nbsp;<span class="ident" id="3039400">nil</span>&nbsp;<span class="op" id="3039404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3039408">if</span>&nbsp;<span class="ident" id="3039411">b</span><span class="op" id="3039412">.</span><span class="ident" id="3039413">w</span>&nbsp;<span class="op" id="3039415">&lt;</span>&nbsp;<span class="builtinfunc" id="3039417">len</span><span class="op" id="3039420">(</span><span class="ident" id="3039421">b</span><span class="op" id="3039422">.</span><span class="ident" id="3039423">path</span><span class="op" id="3039427">)</span>&nbsp;<span class="op" id="3039429">&amp;&amp;</span>&nbsp;<span class="ident" id="3039432">b</span><span class="op" id="3039433">.</span><span class="ident" id="3039434">path</span><span class="op" id="3039438">[</span><span class="ident" id="3039439">b</span><span class="op" id="3039440">.</span><span class="ident" id="3039441">w</span><span class="op" id="3039442">]</span>&nbsp;<span class="op" id="3039444">==</span>&nbsp;<span class="ident" id="3039447">c</span>&nbsp;<span class="op" id="3039449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3039454">b</span><span class="op" id="3039455">.</span><span class="ident" id="3039456">w</span><span class="op" id="3039457">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3039463">return</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3039472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3039476">b</span><span class="op" id="3039477">.</span><span class="ident" id="3039478">buf</span>&nbsp;<span class="op" id="3039482">=</span>&nbsp;<span class="builtinfunc" id="3039484">make</span><span class="op" id="3039488">(</span><span class="op" id="3039489">[</span><span class="op" id="3039490">]</span><span class="builtintype" id="3039491">byte</span><span class="op" id="3039495">,</span>&nbsp;<span class="builtinfunc" id="3039497">len</span><span class="op" id="3039500">(</span><span class="ident" id="3039501">b</span><span class="op" id="3039502">.</span><span class="ident" id="3039503">path</span><span class="op" id="3039507">)</span><span class="op" id="3039508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3039512">copy</span><span class="op" id="3039516">(</span><span class="ident" id="3039517">b</span><span class="op" id="3039518">.</span><span class="ident" id="3039519">buf</span><span class="op" id="3039522">,</span>&nbsp;<span class="ident" id="3039524">b</span><span class="op" id="3039525">.</span><span class="ident" id="3039526">path</span><span class="op" id="3039530">[</span><span class="op" id="3039531">:</span><span class="ident" id="3039532">b</span><span class="op" id="3039533">.</span><span class="ident" id="3039534">w</span><span class="op" id="3039535">]</span><span class="op" id="3039536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3039539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3039542">b</span><span class="op" id="3039543">.</span><span class="ident" id="3039544">buf</span><span class="op" id="3039547">[</span><span class="ident" id="3039548">b</span><span class="op" id="3039549">.</span><span class="ident" id="3039550">w</span><span class="op" id="3039551">]</span>&nbsp;<span class="op" id="3039553">=</span>&nbsp;<span class="ident" id="3039555">c</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3039558">b</span><span class="op" id="3039559">.</span><span class="ident" id="3039560">w</span><span class="op" id="3039561">++</span><br>
<span class="lineno"></span><span class="op" id="3039564">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3039567">func</span>&nbsp;<span class="op" id="3039572">(</span><span class="ident" id="3039573">b</span>&nbsp;<span class="op" id="3039575">*</span><span class="ident" id="3039576">lazybuf</span><span class="op" id="3039583">)</span>&nbsp;<span class="builtintype" id="3039585">string</span><span class="op" id="3039591">(</span><span class="op" id="3039592">)</span>&nbsp;<span class="builtintype" id="3039594">string</span>&nbsp;<span class="op" id="3039601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3039604">if</span>&nbsp;<span class="ident" id="3039607">b</span><span class="op" id="3039608">.</span><span class="ident" id="3039609">buf</span>&nbsp;<span class="op" id="3039613">==</span>&nbsp;<span class="ident" id="3039616">nil</span>&nbsp;<span class="op" id="3039620">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3039624">return</span>&nbsp;<span class="ident" id="3039631">b</span><span class="op" id="3039632">.</span><span class="ident" id="3039633">volAndPath</span><span class="op" id="3039643">[</span><span class="op" id="3039644">:</span><span class="ident" id="3039645">b</span><span class="op" id="3039646">.</span><span class="ident" id="3039647">volLen</span><span class="op" id="3039653">+</span><span class="ident" id="3039654">b</span><span class="op" id="3039655">.</span><span class="ident" id="3039656">w</span><span class="op" id="3039657">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3039660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3039663">return</span>&nbsp;<span class="ident" id="3039670">b</span><span class="op" id="3039671">.</span><span class="ident" id="3039672">volAndPath</span><span class="op" id="3039682">[</span><span class="op" id="3039683">:</span><span class="ident" id="3039684">b</span><span class="op" id="3039685">.</span><span class="ident" id="3039686">volLen</span><span class="op" id="3039692">]</span>&nbsp;<span class="op" id="3039694">+</span>&nbsp;<span class="builtintype" id="3039696">string</span><span class="op" id="3039702">(</span><span class="ident" id="3039703">b</span><span class="op" id="3039704">.</span><span class="ident" id="3039705">buf</span><span class="op" id="3039708">[</span><span class="op" id="3039709">:</span><span class="ident" id="3039710">b</span><span class="op" id="3039711">.</span><span class="ident" id="3039712">w</span><span class="op" id="3039713">]</span><span class="op" id="3039714">)</span><br>
<span class="lineno"></span><span class="op" id="3039716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="3039719">const</span>&nbsp;<span class="op" id="3039725">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3039728">Separator</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3039742">=</span>&nbsp;<span class="ident" id="3039744">os</span><span class="op" id="3039746">.</span><span class="ident" id="3039747">PathSeparator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3039762">ListSeparator</span>&nbsp;<span class="op" id="3039776">=</span>&nbsp;<span class="ident" id="3039778">os</span><span class="op" id="3039780">.</span><span class="ident" id="3039781">PathListSeparator</span><br>
<span class="lineno"></span><span class="op" id="3039799">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="3039802">//&nbsp;Clean&nbsp;returns&nbsp;the&nbsp;shortest&nbsp;path&nbsp;name&nbsp;equivalent&nbsp;to&nbsp;path</span><br>
<span class="lineno"></span><span class="comment" id="3039861">//&nbsp;by&nbsp;purely&nbsp;lexical&nbsp;processing.&nbsp;&nbsp;It&nbsp;applies&nbsp;the&nbsp;following&nbsp;rules</span><br>
<span class="lineno"></span><span class="comment" id="3039926">//&nbsp;iteratively&nbsp;until&nbsp;no&nbsp;further&nbsp;processing&nbsp;can&nbsp;be&nbsp;done:</span><br>
<span class="lineno"></span><span class="comment" id="3039982">//</span><br>
<span class="lineno"></span><span class="comment" id="3039985">//&nbsp;&nbsp;&nbsp;&nbsp1.&nbsp;Replace&nbsp;multiple&nbsp;Separator&nbsp;elements&nbsp;with&nbsp;a&nbsp;single&nbsp;one.</span><br>
<span class="lineno">65</span><span class="comment" id="3040046">//&nbsp;&nbsp;&nbsp;&nbsp2.&nbsp;Eliminate&nbsp;each&nbsp;.&nbsp;path&nbsp;name&nbsp;element&nbsp;(the&nbsp;current&nbsp;directory).</span><br>
<span class="lineno"></span><span class="comment" id="3040112">//&nbsp;&nbsp;&nbsp;&nbsp3.&nbsp;Eliminate&nbsp;each&nbsp;inner&nbsp;..&nbsp;path&nbsp;name&nbsp;element&nbsp;(the&nbsp;parent&nbsp;directory)</span><br>
<span class="lineno"></span><span class="comment" id="3040183">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;along&nbsp;with&nbsp;the&nbsp;non-..&nbsp;element&nbsp;that&nbsp;precedes&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="3040237">//&nbsp;&nbsp;&nbsp;&nbsp4.&nbsp;Eliminate&nbsp;..&nbsp;elements&nbsp;that&nbsp;begin&nbsp;a&nbsp;rooted&nbsp;path:</span><br>
<span class="lineno"></span><span class="comment" id="3040291">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;that&nbsp;is,&nbsp;replace&nbsp;&#34;/..&#34;&nbsp;by&nbsp;&#34;/&#34;&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;a&nbsp;path,</span><br>
<span class="lineno">70</span><span class="comment" id="3040355">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;assuming&nbsp;Separator&nbsp;is&nbsp;&#39;/&#39;.</span><br>
<span class="lineno"></span><span class="comment" id="3040388">//</span><br>
<span class="lineno"></span><span class="comment" id="3040391">//&nbsp;The&nbsp;returned&nbsp;path&nbsp;ends&nbsp;in&nbsp;a&nbsp;slash&nbsp;only&nbsp;if&nbsp;it&nbsp;represents&nbsp;a&nbsp;root&nbsp;directory,</span><br>
<span class="lineno"></span><span class="comment" id="3040468">//&nbsp;such&nbsp;as&nbsp;&#34;/&#34;&nbsp;on&nbsp;Unix&nbsp;or&nbsp;`C:\`&nbsp;on&nbsp;Windows.</span><br>
<span class="lineno"></span><span class="comment" id="3040512">//</span><br>
<span class="lineno">75</span><span class="comment" id="3040515">//&nbsp;If&nbsp;the&nbsp;result&nbsp;of&nbsp;this&nbsp;process&nbsp;is&nbsp;an&nbsp;empty&nbsp;string,&nbsp;Clean</span><br>
<span class="lineno"></span><span class="comment" id="3040574">//&nbsp;returns&nbsp;the&nbsp;string&nbsp;&#34;.&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3040601">//</span><br>
<span class="lineno"></span><span class="comment" id="3040604">//&nbsp;See&nbsp;also&nbsp;Rob&nbsp;Pike,&nbsp;``Lexical&nbsp;File&nbsp;Names&nbsp;in&nbsp;Plan&nbsp;9&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="3040660">//&nbsp;Getting&nbsp;Dot-Dot&nbsp;Right,&#39;&#39;</span><br>
<span class="lineno">80</span><span class="comment" id="3040688">//&nbsp;http://plan9.bell-labs.com/sys/doc/lexnames.html</span><br>
<span class="lineno"></span><span class="keyword" id="3040740">func</span>&nbsp;<span class="ident" id="3040745">Clean</span><span class="op" id="3040750">(</span><span class="ident" id="3040751">path</span>&nbsp;<span class="builtintype" id="3040756">string</span><span class="op" id="3040762">)</span>&nbsp;<span class="builtintype" id="3040764">string</span>&nbsp;<span class="op" id="3040771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3040774">originalPath</span>&nbsp;<span class="op" id="3040787">:=</span>&nbsp;<span class="ident" id="3040790">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3040796">volLen</span>&nbsp;<span class="op" id="3040803">:=</span>&nbsp;<span class="ident" id="3040806">volumeNameLen</span><span class="op" id="3040819">(</span><span class="ident" id="3040820">path</span><span class="op" id="3040824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3040827">path</span>&nbsp;<span class="op" id="3040832">=</span>&nbsp;<span class="ident" id="3040834">path</span><span class="op" id="3040838">[</span><span class="ident" id="3040839">volLen</span><span class="op" id="3040845">:</span><span class="op" id="3040846">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3040849">if</span>&nbsp;<span class="ident" id="3040852">path</span>&nbsp;<span class="op" id="3040857">==</span>&nbsp;<span class="string" id="3040860">&#34;&#34;</span>&nbsp;<span class="op" id="3040863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3040867">if</span>&nbsp;<span class="ident" id="3040870">volLen</span>&nbsp;<span class="op" id="3040877">&gt;</span>&nbsp;<span class="num" id="3040879">1</span>&nbsp;<span class="op" id="3040881">&amp;&amp;</span>&nbsp;<span class="ident" id="3040884">originalPath</span><span class="op" id="3040896">[</span><span class="num" id="3040897">1</span><span class="op" id="3040898">]</span>&nbsp;<span class="op" id="3040900">!=</span>&nbsp;<span class="string" id="3040903">&#39;:&#39;</span>&nbsp;<span class="op" id="3040907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3040912">//&nbsp;should&nbsp;be&nbsp;UNC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3040932">return</span>&nbsp;<span class="ident" id="3040939">FromSlash</span><span class="op" id="3040948">(</span><span class="ident" id="3040949">originalPath</span><span class="op" id="3040961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3040965">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3040969">return</span>&nbsp;<span class="ident" id="3040976">originalPath</span>&nbsp;<span class="op" id="3040989">+</span>&nbsp;<span class="string" id="3040991">&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3040996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3040999">rooted</span>&nbsp;<span class="op" id="3041006">:=</span>&nbsp;<span class="ident" id="3041009">os</span><span class="op" id="3041011">.</span><span class="ident" id="3041012">IsPathSeparator</span><span class="op" id="3041027">(</span><span class="ident" id="3041028">path</span><span class="op" id="3041032">[</span><span class="num" id="3041033">0</span><span class="op" id="3041034">]</span><span class="op" id="3041035">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3041039">//&nbsp;Invariants:</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3041055">//&nbsp;&nbsp;&nbsp;&nbspreading&nbsp;from&nbsp;path;&nbsp;r&nbsp;is&nbsp;index&nbsp;of&nbsp;next&nbsp;byte&nbsp;to&nbsp;process.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3041114">//&nbsp;&nbsp;&nbsp;&nbspwriting&nbsp;to&nbsp;buf;&nbsp;w&nbsp;is&nbsp;index&nbsp;of&nbsp;next&nbsp;byte&nbsp;to&nbsp;write.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3041168">//&nbsp;&nbsp;&nbsp;&nbspdotdot&nbsp;is&nbsp;index&nbsp;in&nbsp;buf&nbsp;where&nbsp;..&nbsp;must&nbsp;stop,&nbsp;either&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3041230">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspit&nbsp;is&nbsp;the&nbsp;leading&nbsp;slash&nbsp;or&nbsp;it&nbsp;is&nbsp;a&nbsp;leading&nbsp;../../..&nbsp;prefix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3041295">n</span>&nbsp;<span class="op" id="3041297">:=</span>&nbsp;<span class="builtinfunc" id="3041300">len</span><span class="op" id="3041303">(</span><span class="ident" id="3041304">path</span><span class="op" id="3041308">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3041311">out</span>&nbsp;<span class="op" id="3041315">:=</span>&nbsp;<span class="ident" id="3041318">lazybuf</span><span class="op" id="3041325">{</span><span class="ident" id="3041326">path</span><span class="op" id="3041330">:</span>&nbsp;<span class="ident" id="3041332">path</span><span class="op" id="3041336">,</span>&nbsp;<span class="ident" id="3041338">volAndPath</span><span class="op" id="3041348">:</span>&nbsp;<span class="ident" id="3041350">originalPath</span><span class="op" id="3041362">,</span>&nbsp;<span class="ident" id="3041364">volLen</span><span class="op" id="3041370">:</span>&nbsp;<span class="ident" id="3041372">volLen</span><span class="op" id="3041378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3041381">r</span><span class="op" id="3041382">,</span>&nbsp;<span class="ident" id="3041384">dotdot</span>&nbsp;<span class="op" id="3041391">:=</span>&nbsp;<span class="num" id="3041394">0</span><span class="op" id="3041395">,</span>&nbsp;<span class="num" id="3041397">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3041400">if</span>&nbsp;<span class="ident" id="3041403">rooted</span>&nbsp;<span class="op" id="3041410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3041414">out</span><span class="op" id="3041417">.</span><span class="builtinfunc" id="3041418">append</span><span class="op" id="3041424">(</span><span class="ident" id="3041425">Separator</span><span class="op" id="3041434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3041438">r</span><span class="op" id="3041439">,</span>&nbsp;<span class="ident" id="3041441">dotdot</span>&nbsp;<span class="op" id="3041448">=</span>&nbsp;<span class="num" id="3041450">1</span><span class="op" id="3041451">,</span>&nbsp;<span class="num" id="3041453">1</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3041456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3041460">for</span>&nbsp;<span class="ident" id="3041464">r</span>&nbsp;<span class="op" id="3041466">&lt;</span>&nbsp;<span class="ident" id="3041468">n</span>&nbsp;<span class="op" id="3041470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3041474">switch</span>&nbsp;<span class="op" id="3041481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3041485">case</span>&nbsp;<span class="ident" id="3041490">os</span><span class="op" id="3041492">.</span><span class="ident" id="3041493">IsPathSeparator</span><span class="op" id="3041508">(</span><span class="ident" id="3041509">path</span><span class="op" id="3041513">[</span><span class="ident" id="3041514">r</span><span class="op" id="3041515">]</span><span class="op" id="3041516">)</span><span class="op" id="3041517">:</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3041522">//&nbsp;empty&nbsp;path&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3041547">r</span><span class="op" id="3041548">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3041553">case</span>&nbsp;<span class="ident" id="3041558">path</span><span class="op" id="3041562">[</span><span class="ident" id="3041563">r</span><span class="op" id="3041564">]</span>&nbsp;<span class="op" id="3041566">==</span>&nbsp;<span class="string" id="3041569">&#39;.&#39;</span>&nbsp;<span class="op" id="3041573">&amp;&amp;</span>&nbsp;<span class="op" id="3041576">(</span><span class="ident" id="3041577">r</span><span class="op" id="3041578">+</span><span class="num" id="3041579">1</span>&nbsp;<span class="op" id="3041581">==</span>&nbsp;<span class="ident" id="3041584">n</span>&nbsp;<span class="op" id="3041586">||</span>&nbsp;<span class="ident" id="3041589">os</span><span class="op" id="3041591">.</span><span class="ident" id="3041592">IsPathSeparator</span><span class="op" id="3041607">(</span><span class="ident" id="3041608">path</span><span class="op" id="3041612">[</span><span class="ident" id="3041613">r</span><span class="op" id="3041614">+</span><span class="num" id="3041615">1</span><span class="op" id="3041616">]</span><span class="op" id="3041617">)</span><span class="op" id="3041618">)</span><span class="op" id="3041619">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3041624">//&nbsp;.&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3041640">r</span><span class="op" id="3041641">++</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3041646">case</span>&nbsp;<span class="ident" id="3041651">path</span><span class="op" id="3041655">[</span><span class="ident" id="3041656">r</span><span class="op" id="3041657">]</span>&nbsp;<span class="op" id="3041659">==</span>&nbsp;<span class="string" id="3041662">&#39;.&#39;</span>&nbsp;<span class="op" id="3041666">&amp;&amp;</span>&nbsp;<span class="ident" id="3041669">path</span><span class="op" id="3041673">[</span><span class="ident" id="3041674">r</span><span class="op" id="3041675">+</span><span class="num" id="3041676">1</span><span class="op" id="3041677">]</span>&nbsp;<span class="op" id="3041679">==</span>&nbsp;<span class="string" id="3041682">&#39;.&#39;</span>&nbsp;<span class="op" id="3041686">&amp;&amp;</span>&nbsp;<span class="op" id="3041689">(</span><span class="ident" id="3041690">r</span><span class="op" id="3041691">+</span><span class="num" id="3041692">2</span>&nbsp;<span class="op" id="3041694">==</span>&nbsp;<span class="ident" id="3041697">n</span>&nbsp;<span class="op" id="3041699">||</span>&nbsp;<span class="ident" id="3041702">os</span><span class="op" id="3041704">.</span><span class="ident" id="3041705">IsPathSeparator</span><span class="op" id="3041720">(</span><span class="ident" id="3041721">path</span><span class="op" id="3041725">[</span><span class="ident" id="3041726">r</span><span class="op" id="3041727">+</span><span class="num" id="3041728">2</span><span class="op" id="3041729">]</span><span class="op" id="3041730">)</span><span class="op" id="3041731">)</span><span class="op" id="3041732">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3041737">//&nbsp;..&nbsp;element:&nbsp;remove&nbsp;to&nbsp;last&nbsp;separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3041780">r</span>&nbsp;<span class="op" id="3041782">+=</span>&nbsp;<span class="num" id="3041785">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3041790">switch</span>&nbsp;<span class="op" id="3041797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3041802">case</span>&nbsp;<span class="ident" id="3041807">out</span><span class="op" id="3041810">.</span><span class="ident" id="3041811">w</span>&nbsp;<span class="op" id="3041813">&gt;</span>&nbsp;<span class="ident" id="3041815">dotdot</span><span class="op" id="3041821">:</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3041827">//&nbsp;can&nbsp;backtrack</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3041848">out</span><span class="op" id="3041851">.</span><span class="ident" id="3041852">w</span><span class="op" id="3041853">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3041860">for</span>&nbsp;<span class="ident" id="3041864">out</span><span class="op" id="3041867">.</span><span class="ident" id="3041868">w</span>&nbsp;<span class="op" id="3041870">&gt;</span>&nbsp;<span class="ident" id="3041872">dotdot</span>&nbsp;<span class="op" id="3041879">&amp;&amp;</span>&nbsp;<span class="op" id="3041882">!</span><span class="ident" id="3041883">os</span><span class="op" id="3041885">.</span><span class="ident" id="3041886">IsPathSeparator</span><span class="op" id="3041901">(</span><span class="ident" id="3041902">out</span><span class="op" id="3041905">.</span><span class="ident" id="3041906">index</span><span class="op" id="3041911">(</span><span class="ident" id="3041912">out</span><span class="op" id="3041915">.</span><span class="ident" id="3041916">w</span><span class="op" id="3041917">)</span><span class="op" id="3041918">)</span>&nbsp;<span class="op" id="3041920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3041927">out</span><span class="op" id="3041930">.</span><span class="ident" id="3041931">w</span><span class="op" id="3041932">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3041939">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3041944">case</span>&nbsp;<span class="op" id="3041949">!</span><span class="ident" id="3041950">rooted</span><span class="op" id="3041956">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3041962">//&nbsp;cannot&nbsp;backtrack,&nbsp;but&nbsp;not&nbsp;rooted,&nbsp;so&nbsp;append&nbsp;..&nbsp;element.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3042025">if</span>&nbsp;<span class="ident" id="3042028">out</span><span class="op" id="3042031">.</span><span class="ident" id="3042032">w</span>&nbsp;<span class="op" id="3042034">&gt;</span>&nbsp;<span class="num" id="3042036">0</span>&nbsp;<span class="op" id="3042038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3042045">out</span><span class="op" id="3042048">.</span><span class="builtinfunc" id="3042049">append</span><span class="op" id="3042055">(</span><span class="ident" id="3042056">Separator</span><span class="op" id="3042065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3042071">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3042077">out</span><span class="op" id="3042080">.</span><span class="builtinfunc" id="3042081">append</span><span class="op" id="3042087">(</span><span class="string" id="3042088">&#39;.&#39;</span><span class="op" id="3042091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3042097">out</span><span class="op" id="3042100">.</span><span class="builtinfunc" id="3042101">append</span><span class="op" id="3042107">(</span><span class="string" id="3042108">&#39;.&#39;</span><span class="op" id="3042111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3042117">dotdot</span>&nbsp;<span class="op" id="3042124">=</span>&nbsp;<span class="ident" id="3042126">out</span><span class="op" id="3042129">.</span><span class="ident" id="3042130">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3042135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3042139">default</span><span class="op" id="3042146">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3042151">//&nbsp;real&nbsp;path&nbsp;element.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3042176">//&nbsp;add&nbsp;slash&nbsp;if&nbsp;needed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3042202">if</span>&nbsp;<span class="ident" id="3042205">rooted</span>&nbsp;<span class="op" id="3042212">&amp;&amp;</span>&nbsp;<span class="ident" id="3042215">out</span><span class="op" id="3042218">.</span><span class="ident" id="3042219">w</span>&nbsp;<span class="op" id="3042221">!=</span>&nbsp;<span class="num" id="3042224">1</span>&nbsp;<span class="op" id="3042226">||</span>&nbsp;<span class="op" id="3042229">!</span><span class="ident" id="3042230">rooted</span>&nbsp;<span class="op" id="3042237">&amp;&amp;</span>&nbsp;<span class="ident" id="3042240">out</span><span class="op" id="3042243">.</span><span class="ident" id="3042244">w</span>&nbsp;<span class="op" id="3042246">!=</span>&nbsp;<span class="num" id="3042249">0</span>&nbsp;<span class="op" id="3042251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3042257">out</span><span class="op" id="3042260">.</span><span class="builtinfunc" id="3042261">append</span><span class="op" id="3042267">(</span><span class="ident" id="3042268">Separator</span><span class="op" id="3042277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3042282">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3042287">//&nbsp;copy&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3042306">for</span>&nbsp;<span class="op" id="3042310">;</span>&nbsp;<span class="ident" id="3042312">r</span>&nbsp;<span class="op" id="3042314">&lt;</span>&nbsp;<span class="ident" id="3042316">n</span>&nbsp;<span class="op" id="3042318">&amp;&amp;</span>&nbsp;<span class="op" id="3042321">!</span><span class="ident" id="3042322">os</span><span class="op" id="3042324">.</span><span class="ident" id="3042325">IsPathSeparator</span><span class="op" id="3042340">(</span><span class="ident" id="3042341">path</span><span class="op" id="3042345">[</span><span class="ident" id="3042346">r</span><span class="op" id="3042347">]</span><span class="op" id="3042348">)</span><span class="op" id="3042349">;</span>&nbsp;<span class="ident" id="3042351">r</span><span class="op" id="3042352">++</span>&nbsp;<span class="op" id="3042355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3042361">out</span><span class="op" id="3042364">.</span><span class="builtinfunc" id="3042365">append</span><span class="op" id="3042371">(</span><span class="ident" id="3042372">path</span><span class="op" id="3042376">[</span><span class="ident" id="3042377">r</span><span class="op" id="3042378">]</span><span class="op" id="3042379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3042384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3042388">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3042391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3042395">//&nbsp;Turn&nbsp;empty&nbsp;string&nbsp;into&nbsp;&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3042426">if</span>&nbsp;<span class="ident" id="3042429">out</span><span class="op" id="3042432">.</span><span class="ident" id="3042433">w</span>&nbsp;<span class="op" id="3042435">==</span>&nbsp;<span class="num" id="3042438">0</span>&nbsp;<span class="op" id="3042440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3042444">out</span><span class="op" id="3042447">.</span><span class="builtinfunc" id="3042448">append</span><span class="op" id="3042454">(</span><span class="string" id="3042455">&#39;.&#39;</span><span class="op" id="3042458">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3042461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3042465">return</span>&nbsp;<span class="ident" id="3042472">FromSlash</span><span class="op" id="3042481">(</span><span class="ident" id="3042482">out</span><span class="op" id="3042485">.</span><span class="builtintype" id="3042486">string</span><span class="op" id="3042492">(</span><span class="op" id="3042493">)</span><span class="op" id="3042494">)</span><br>
<span class="lineno"></span><span class="op" id="3042496">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="comment" id="3042499">//&nbsp;ToSlash&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;replacing&nbsp;each&nbsp;separator&nbsp;character</span><br>
<span class="lineno"></span><span class="comment" id="3042567">//&nbsp;in&nbsp;path&nbsp;with&nbsp;a&nbsp;slash&nbsp;(&#39;/&#39;)&nbsp;character.&nbsp;Multiple&nbsp;separators&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="3042632">//&nbsp;replaced&nbsp;by&nbsp;multiple&nbsp;slashes.</span><br>
<span class="lineno"></span><span class="keyword" id="3042665">func</span>&nbsp;<span class="ident" id="3042670">ToSlash</span><span class="op" id="3042677">(</span><span class="ident" id="3042678">path</span>&nbsp;<span class="builtintype" id="3042683">string</span><span class="op" id="3042689">)</span>&nbsp;<span class="builtintype" id="3042691">string</span>&nbsp;<span class="op" id="3042698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3042701">if</span>&nbsp;<span class="ident" id="3042704">Separator</span>&nbsp;<span class="op" id="3042714">==</span>&nbsp;<span class="string" id="3042717">&#39;/&#39;</span>&nbsp;<span class="op" id="3042721">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3042725">return</span>&nbsp;<span class="ident" id="3042732">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3042738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3042741">return</span>&nbsp;<span class="ident" id="3042748">strings</span><span class="op" id="3042755">.</span><span class="ident" id="3042756">Replace</span><span class="op" id="3042763">(</span><span class="ident" id="3042764">path</span><span class="op" id="3042768">,</span>&nbsp;<span class="builtintype" id="3042770">string</span><span class="op" id="3042776">(</span><span class="ident" id="3042777">Separator</span><span class="op" id="3042786">)</span><span class="op" id="3042787">,</span>&nbsp;<span class="string" id="3042789">&#34;/&#34;</span><span class="op" id="3042792">,</span>&nbsp;<span class="op" id="3042794">-</span><span class="num" id="3042795">1</span><span class="op" id="3042796">)</span><br>
<span class="lineno"></span><span class="op" id="3042798">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="3042801">//&nbsp;FromSlash&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;replacing&nbsp;each&nbsp;slash&nbsp;(&#39;/&#39;)&nbsp;character</span><br>
<span class="lineno"></span><span class="comment" id="3042873">//&nbsp;in&nbsp;path&nbsp;with&nbsp;a&nbsp;separator&nbsp;character.&nbsp;Multiple&nbsp;slashes&nbsp;are&nbsp;replaced</span><br>
<span class="lineno"></span><span class="comment" id="3042942">//&nbsp;by&nbsp;multiple&nbsp;separators.</span><br>
<span class="lineno"></span><span class="keyword" id="3042969">func</span>&nbsp;<span class="ident" id="3042974">FromSlash</span><span class="op" id="3042983">(</span><span class="ident" id="3042984">path</span>&nbsp;<span class="builtintype" id="3042989">string</span><span class="op" id="3042995">)</span>&nbsp;<span class="builtintype" id="3042997">string</span>&nbsp;<span class="op" id="3043004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3043007">if</span>&nbsp;<span class="ident" id="3043010">Separator</span>&nbsp;<span class="op" id="3043020">==</span>&nbsp;<span class="string" id="3043023">&#39;/&#39;</span>&nbsp;<span class="op" id="3043027">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3043031">return</span>&nbsp;<span class="ident" id="3043038">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3043044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3043047">return</span>&nbsp;<span class="ident" id="3043054">strings</span><span class="op" id="3043061">.</span><span class="ident" id="3043062">Replace</span><span class="op" id="3043069">(</span><span class="ident" id="3043070">path</span><span class="op" id="3043074">,</span>&nbsp;<span class="string" id="3043076">&#34;/&#34;</span><span class="op" id="3043079">,</span>&nbsp;<span class="builtintype" id="3043081">string</span><span class="op" id="3043087">(</span><span class="ident" id="3043088">Separator</span><span class="op" id="3043097">)</span><span class="op" id="3043098">,</span>&nbsp;<span class="op" id="3043100">-</span><span class="num" id="3043101">1</span><span class="op" id="3043102">)</span><br>
<span class="lineno"></span><span class="op" id="3043104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="3043107">//&nbsp;SplitList&nbsp;splits&nbsp;a&nbsp;list&nbsp;of&nbsp;paths&nbsp;joined&nbsp;by&nbsp;the&nbsp;OS-specific&nbsp;ListSeparator,</span><br>
<span class="lineno"></span><span class="comment" id="3043184">//&nbsp;usually&nbsp;found&nbsp;in&nbsp;PATH&nbsp;or&nbsp;GOPATH&nbsp;environment&nbsp;variables.</span><br>
<span class="lineno"></span><span class="comment" id="3043242">//&nbsp;Unlike&nbsp;strings.Split,&nbsp;SplitList&nbsp;returns&nbsp;an&nbsp;empty&nbsp;slice&nbsp;when&nbsp;passed&nbsp;an&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3043329">func</span>&nbsp;<span class="ident" id="3043334">SplitList</span><span class="op" id="3043343">(</span><span class="ident" id="3043344">path</span>&nbsp;<span class="builtintype" id="3043349">string</span><span class="op" id="3043355">)</span>&nbsp;<span class="op" id="3043357">[</span><span class="op" id="3043358">]</span><span class="builtintype" id="3043359">string</span>&nbsp;<span class="op" id="3043366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3043369">return</span>&nbsp;<span class="ident" id="3043376">splitList</span><span class="op" id="3043385">(</span><span class="ident" id="3043386">path</span><span class="op" id="3043390">)</span><br>
<span class="lineno">180</span><span class="op" id="3043392">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3043395">//&nbsp;Split&nbsp;splits&nbsp;path&nbsp;immediately&nbsp;following&nbsp;the&nbsp;final&nbsp;Separator,</span><br>
<span class="lineno"></span><span class="comment" id="3043459">//&nbsp;separating&nbsp;it&nbsp;into&nbsp;a&nbsp;directory&nbsp;and&nbsp;file&nbsp;name&nbsp;component.</span><br>
<span class="lineno"></span><span class="comment" id="3043518">//&nbsp;If&nbsp;there&nbsp;is&nbsp;no&nbsp;Separator&nbsp;in&nbsp;path,&nbsp;Split&nbsp;returns&nbsp;an&nbsp;empty&nbsp;dir</span><br>
<span class="lineno">185</span><span class="comment" id="3043582">//&nbsp;and&nbsp;file&nbsp;set&nbsp;to&nbsp;path.</span><br>
<span class="lineno"></span><span class="comment" id="3043607">//&nbsp;The&nbsp;returned&nbsp;values&nbsp;have&nbsp;the&nbsp;property&nbsp;that&nbsp;path&nbsp;=&nbsp;dir+file.</span><br>
<span class="lineno"></span><span class="keyword" id="3043670">func</span>&nbsp;<span class="ident" id="3043675">Split</span><span class="op" id="3043680">(</span><span class="ident" id="3043681">path</span>&nbsp;<span class="builtintype" id="3043686">string</span><span class="op" id="3043692">)</span>&nbsp;<span class="op" id="3043694">(</span><span class="ident" id="3043695">dir</span><span class="op" id="3043698">,</span>&nbsp;<span class="ident" id="3043700">file</span>&nbsp;<span class="builtintype" id="3043705">string</span><span class="op" id="3043711">)</span>&nbsp;<span class="op" id="3043713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3043716">vol</span>&nbsp;<span class="op" id="3043720">:=</span>&nbsp;<span class="ident" id="3043723">VolumeName</span><span class="op" id="3043733">(</span><span class="ident" id="3043734">path</span><span class="op" id="3043738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3043741">i</span>&nbsp;<span class="op" id="3043743">:=</span>&nbsp;<span class="builtinfunc" id="3043746">len</span><span class="op" id="3043749">(</span><span class="ident" id="3043750">path</span><span class="op" id="3043754">)</span>&nbsp;<span class="op" id="3043756">-</span>&nbsp;<span class="num" id="3043758">1</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3043761">for</span>&nbsp;<span class="ident" id="3043765">i</span>&nbsp;<span class="op" id="3043767">&gt;=</span>&nbsp;<span class="builtinfunc" id="3043770">len</span><span class="op" id="3043773">(</span><span class="ident" id="3043774">vol</span><span class="op" id="3043777">)</span>&nbsp;<span class="op" id="3043779">&amp;&amp;</span>&nbsp;<span class="op" id="3043782">!</span><span class="ident" id="3043783">os</span><span class="op" id="3043785">.</span><span class="ident" id="3043786">IsPathSeparator</span><span class="op" id="3043801">(</span><span class="ident" id="3043802">path</span><span class="op" id="3043806">[</span><span class="ident" id="3043807">i</span><span class="op" id="3043808">]</span><span class="op" id="3043809">)</span>&nbsp;<span class="op" id="3043811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3043815">i</span><span class="op" id="3043816">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3043820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3043823">return</span>&nbsp;<span class="ident" id="3043830">path</span><span class="op" id="3043834">[</span><span class="op" id="3043835">:</span><span class="ident" id="3043836">i</span><span class="op" id="3043837">+</span><span class="num" id="3043838">1</span><span class="op" id="3043839">]</span><span class="op" id="3043840">,</span>&nbsp;<span class="ident" id="3043842">path</span><span class="op" id="3043846">[</span><span class="ident" id="3043847">i</span><span class="op" id="3043848">+</span><span class="num" id="3043849">1</span><span class="op" id="3043850">:</span><span class="op" id="3043851">]</span><br>
<span class="lineno"></span><span class="op" id="3043853">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="comment" id="3043856">//&nbsp;Join&nbsp;joins&nbsp;any&nbsp;number&nbsp;of&nbsp;path&nbsp;elements&nbsp;into&nbsp;a&nbsp;single&nbsp;path,&nbsp;adding</span><br>
<span class="lineno"></span><span class="comment" id="3043925">//&nbsp;a&nbsp;Separator&nbsp;if&nbsp;necessary.&nbsp;The&nbsp;result&nbsp;is&nbsp;Cleaned,&nbsp;in&nbsp;particular</span><br>
<span class="lineno"></span><span class="comment" id="3043991">//&nbsp;all&nbsp;empty&nbsp;strings&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="keyword" id="3044025">func</span>&nbsp;<span class="ident" id="3044030">Join</span><span class="op" id="3044034">(</span><span class="ident" id="3044035">elem</span>&nbsp;<span class="op" id="3044040">...</span><span class="builtintype" id="3044043">string</span><span class="op" id="3044049">)</span>&nbsp;<span class="builtintype" id="3044051">string</span>&nbsp;<span class="op" id="3044058">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3044061">for</span>&nbsp;<span class="ident" id="3044065">i</span><span class="op" id="3044066">,</span>&nbsp;<span class="ident" id="3044068">e</span>&nbsp;<span class="op" id="3044070">:=</span>&nbsp;<span class="keyword" id="3044073">range</span>&nbsp;<span class="ident" id="3044079">elem</span>&nbsp;<span class="op" id="3044084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3044088">if</span>&nbsp;<span class="ident" id="3044091">e</span>&nbsp;<span class="op" id="3044093">!=</span>&nbsp;<span class="string" id="3044096">&#34;&#34;</span>&nbsp;<span class="op" id="3044099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3044104">return</span>&nbsp;<span class="ident" id="3044111">Clean</span><span class="op" id="3044116">(</span><span class="ident" id="3044117">strings</span><span class="op" id="3044124">.</span><span class="ident" id="3044125">Join</span><span class="op" id="3044129">(</span><span class="ident" id="3044130">elem</span><span class="op" id="3044134">[</span><span class="ident" id="3044135">i</span><span class="op" id="3044136">:</span><span class="op" id="3044137">]</span><span class="op" id="3044138">,</span>&nbsp;<span class="builtintype" id="3044140">string</span><span class="op" id="3044146">(</span><span class="ident" id="3044147">Separator</span><span class="op" id="3044156">)</span><span class="op" id="3044157">)</span><span class="op" id="3044158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3044162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3044165">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3044168">return</span>&nbsp;<span class="string" id="3044175">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="3044178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3044181">//&nbsp;Ext&nbsp;returns&nbsp;the&nbsp;file&nbsp;name&nbsp;extension&nbsp;used&nbsp;by&nbsp;path.</span><br>
<span class="lineno"></span><span class="comment" id="3044234">//&nbsp;The&nbsp;extension&nbsp;is&nbsp;the&nbsp;suffix&nbsp;beginning&nbsp;at&nbsp;the&nbsp;final&nbsp;dot</span><br>
<span class="lineno">210</span><span class="comment" id="3044292">//&nbsp;in&nbsp;the&nbsp;final&nbsp;element&nbsp;of&nbsp;path;&nbsp;it&nbsp;is&nbsp;empty&nbsp;if&nbsp;there&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3044349">//&nbsp;no&nbsp;dot.</span><br>
<span class="lineno"></span><span class="keyword" id="3044360">func</span>&nbsp;<span class="ident" id="3044365">Ext</span><span class="op" id="3044368">(</span><span class="ident" id="3044369">path</span>&nbsp;<span class="builtintype" id="3044374">string</span><span class="op" id="3044380">)</span>&nbsp;<span class="builtintype" id="3044382">string</span>&nbsp;<span class="op" id="3044389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3044392">for</span>&nbsp;<span class="ident" id="3044396">i</span>&nbsp;<span class="op" id="3044398">:=</span>&nbsp;<span class="builtinfunc" id="3044401">len</span><span class="op" id="3044404">(</span><span class="ident" id="3044405">path</span><span class="op" id="3044409">)</span>&nbsp;<span class="op" id="3044411">-</span>&nbsp;<span class="num" id="3044413">1</span><span class="op" id="3044414">;</span>&nbsp;<span class="ident" id="3044416">i</span>&nbsp;<span class="op" id="3044418">&gt;=</span>&nbsp;<span class="num" id="3044421">0</span>&nbsp;<span class="op" id="3044423">&amp;&amp;</span>&nbsp;<span class="op" id="3044426">!</span><span class="ident" id="3044427">os</span><span class="op" id="3044429">.</span><span class="ident" id="3044430">IsPathSeparator</span><span class="op" id="3044445">(</span><span class="ident" id="3044446">path</span><span class="op" id="3044450">[</span><span class="ident" id="3044451">i</span><span class="op" id="3044452">]</span><span class="op" id="3044453">)</span><span class="op" id="3044454">;</span>&nbsp;<span class="ident" id="3044456">i</span><span class="op" id="3044457">--</span>&nbsp;<span class="op" id="3044460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3044464">if</span>&nbsp;<span class="ident" id="3044467">path</span><span class="op" id="3044471">[</span><span class="ident" id="3044472">i</span><span class="op" id="3044473">]</span>&nbsp;<span class="op" id="3044475">==</span>&nbsp;<span class="string" id="3044478">&#39;.&#39;</span>&nbsp;<span class="op" id="3044482">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3044487">return</span>&nbsp;<span class="ident" id="3044494">path</span><span class="op" id="3044498">[</span><span class="ident" id="3044499">i</span><span class="op" id="3044500">:</span><span class="op" id="3044501">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3044505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3044508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3044511">return</span>&nbsp;<span class="string" id="3044518">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="3044521">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="3044524">//&nbsp;EvalSymlinks&nbsp;returns&nbsp;the&nbsp;path&nbsp;name&nbsp;after&nbsp;the&nbsp;evaluation&nbsp;of&nbsp;any&nbsp;symbolic</span><br>
<span class="lineno"></span><span class="comment" id="3044599">//&nbsp;links.</span><br>
<span class="lineno"></span><span class="comment" id="3044609">//&nbsp;If&nbsp;path&nbsp;is&nbsp;relative&nbsp;the&nbsp;result&nbsp;will&nbsp;be&nbsp;relative&nbsp;to&nbsp;the&nbsp;current&nbsp;directory,</span><br>
<span class="lineno"></span><span class="comment" id="3044686">//&nbsp;unless&nbsp;one&nbsp;of&nbsp;the&nbsp;components&nbsp;is&nbsp;an&nbsp;absolute&nbsp;symbolic&nbsp;link.</span><br>
<span class="lineno">225</span><span class="keyword" id="3044748">func</span>&nbsp;<span class="ident" id="3044753">EvalSymlinks</span><span class="op" id="3044765">(</span><span class="ident" id="3044766">path</span>&nbsp;<span class="builtintype" id="3044771">string</span><span class="op" id="3044777">)</span>&nbsp;<span class="op" id="3044779">(</span><span class="builtintype" id="3044780">string</span><span class="op" id="3044786">,</span>&nbsp;<span class="builtintype" id="3044788">error</span><span class="op" id="3044793">)</span>&nbsp;<span class="op" id="3044795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3044798">return</span>&nbsp;<span class="ident" id="3044805">evalSymlinks</span><span class="op" id="3044817">(</span><span class="ident" id="3044818">path</span><span class="op" id="3044822">)</span><br>
<span class="lineno"></span><span class="op" id="3044824">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3044827">//&nbsp;Abs&nbsp;returns&nbsp;an&nbsp;absolute&nbsp;representation&nbsp;of&nbsp;path.</span><br>
<span class="lineno">230</span><span class="comment" id="3044878">//&nbsp;If&nbsp;the&nbsp;path&nbsp;is&nbsp;not&nbsp;absolute&nbsp;it&nbsp;will&nbsp;be&nbsp;joined&nbsp;with&nbsp;the&nbsp;current</span><br>
<span class="lineno"></span><span class="comment" id="3044944">//&nbsp;working&nbsp;directory&nbsp;to&nbsp;turn&nbsp;it&nbsp;into&nbsp;an&nbsp;absolute&nbsp;path.&nbsp;&nbsp;The&nbsp;absolute</span><br>
<span class="lineno"></span><span class="comment" id="3045013">//&nbsp;path&nbsp;name&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;unique.</span><br>
<span class="lineno"></span><span class="keyword" id="3045075">func</span>&nbsp;<span class="ident" id="3045080">Abs</span><span class="op" id="3045083">(</span><span class="ident" id="3045084">path</span>&nbsp;<span class="builtintype" id="3045089">string</span><span class="op" id="3045095">)</span>&nbsp;<span class="op" id="3045097">(</span><span class="builtintype" id="3045098">string</span><span class="op" id="3045104">,</span>&nbsp;<span class="builtintype" id="3045106">error</span><span class="op" id="3045111">)</span>&nbsp;<span class="op" id="3045113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3045116">return</span>&nbsp;<span class="ident" id="3045123">abs</span><span class="op" id="3045126">(</span><span class="ident" id="3045127">path</span><span class="op" id="3045131">)</span><br>
<span class="lineno">235</span><span class="op" id="3045133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3045136">func</span>&nbsp;<span class="ident" id="3045141">unixAbs</span><span class="op" id="3045148">(</span><span class="ident" id="3045149">path</span>&nbsp;<span class="builtintype" id="3045154">string</span><span class="op" id="3045160">)</span>&nbsp;<span class="op" id="3045162">(</span><span class="builtintype" id="3045163">string</span><span class="op" id="3045169">,</span>&nbsp;<span class="builtintype" id="3045171">error</span><span class="op" id="3045176">)</span>&nbsp;<span class="op" id="3045178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3045181">if</span>&nbsp;<span class="ident" id="3045184">IsAbs</span><span class="op" id="3045189">(</span><span class="ident" id="3045190">path</span><span class="op" id="3045194">)</span>&nbsp;<span class="op" id="3045196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3045200">return</span>&nbsp;<span class="ident" id="3045207">Clean</span><span class="op" id="3045212">(</span><span class="ident" id="3045213">path</span><span class="op" id="3045217">)</span><span class="op" id="3045218">,</span>&nbsp;<span class="ident" id="3045220">nil</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3045225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3045228">wd</span><span class="op" id="3045230">,</span>&nbsp;<span class="ident" id="3045232">err</span>&nbsp;<span class="op" id="3045236">:=</span>&nbsp;<span class="ident" id="3045239">os</span><span class="op" id="3045241">.</span><span class="ident" id="3045242">Getwd</span><span class="op" id="3045247">(</span><span class="op" id="3045248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3045251">if</span>&nbsp;<span class="ident" id="3045254">err</span>&nbsp;<span class="op" id="3045258">!=</span>&nbsp;<span class="ident" id="3045261">nil</span>&nbsp;<span class="op" id="3045265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3045269">return</span>&nbsp;<span class="string" id="3045276">&#34;&#34;</span><span class="op" id="3045278">,</span>&nbsp;<span class="ident" id="3045280">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3045285">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3045288">return</span>&nbsp;<span class="ident" id="3045295">Join</span><span class="op" id="3045299">(</span><span class="ident" id="3045300">wd</span><span class="op" id="3045302">,</span>&nbsp;<span class="ident" id="3045304">path</span><span class="op" id="3045308">)</span><span class="op" id="3045309">,</span>&nbsp;<span class="ident" id="3045311">nil</span><br>
<span class="lineno"></span><span class="op" id="3045315">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3045318">//&nbsp;Rel&nbsp;returns&nbsp;a&nbsp;relative&nbsp;path&nbsp;that&nbsp;is&nbsp;lexically&nbsp;equivalent&nbsp;to&nbsp;targpath&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="3045395">//&nbsp;joined&nbsp;to&nbsp;basepath&nbsp;with&nbsp;an&nbsp;intervening&nbsp;separator.&nbsp;That&nbsp;is,</span><br>
<span class="lineno">250</span><span class="comment" id="3045457">//&nbsp;Join(basepath,&nbsp;Rel(basepath,&nbsp;targpath))&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;targpath&nbsp;itself.</span><br>
<span class="lineno"></span><span class="comment" id="3045534">//&nbsp;On&nbsp;success,&nbsp;the&nbsp;returned&nbsp;path&nbsp;will&nbsp;always&nbsp;be&nbsp;relative&nbsp;to&nbsp;basepath,</span><br>
<span class="lineno"></span><span class="comment" id="3045604">//&nbsp;even&nbsp;if&nbsp;basepath&nbsp;and&nbsp;targpath&nbsp;share&nbsp;no&nbsp;elements.</span><br>
<span class="lineno"></span><span class="comment" id="3045656">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;targpath&nbsp;can&#39;t&nbsp;be&nbsp;made&nbsp;relative&nbsp;to&nbsp;basepath&nbsp;or&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="3045733">//&nbsp;knowing&nbsp;the&nbsp;current&nbsp;working&nbsp;directory&nbsp;would&nbsp;be&nbsp;necessary&nbsp;to&nbsp;compute&nbsp;it.</span><br>
<span class="lineno">255</span><span class="keyword" id="3045808">func</span>&nbsp;<span class="ident" id="3045813">Rel</span><span class="op" id="3045816">(</span><span class="ident" id="3045817">basepath</span><span class="op" id="3045825">,</span>&nbsp;<span class="ident" id="3045827">targpath</span>&nbsp;<span class="builtintype" id="3045836">string</span><span class="op" id="3045842">)</span>&nbsp;<span class="op" id="3045844">(</span><span class="builtintype" id="3045845">string</span><span class="op" id="3045851">,</span>&nbsp;<span class="builtintype" id="3045853">error</span><span class="op" id="3045858">)</span>&nbsp;<span class="op" id="3045860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3045863">baseVol</span>&nbsp;<span class="op" id="3045871">:=</span>&nbsp;<span class="ident" id="3045874">VolumeName</span><span class="op" id="3045884">(</span><span class="ident" id="3045885">basepath</span><span class="op" id="3045893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3045896">targVol</span>&nbsp;<span class="op" id="3045904">:=</span>&nbsp;<span class="ident" id="3045907">VolumeName</span><span class="op" id="3045917">(</span><span class="ident" id="3045918">targpath</span><span class="op" id="3045926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3045929">base</span>&nbsp;<span class="op" id="3045934">:=</span>&nbsp;<span class="ident" id="3045937">Clean</span><span class="op" id="3045942">(</span><span class="ident" id="3045943">basepath</span><span class="op" id="3045951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3045954">targ</span>&nbsp;<span class="op" id="3045959">:=</span>&nbsp;<span class="ident" id="3045962">Clean</span><span class="op" id="3045967">(</span><span class="ident" id="3045968">targpath</span><span class="op" id="3045976">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3045979">if</span>&nbsp;<span class="ident" id="3045982">targ</span>&nbsp;<span class="op" id="3045987">==</span>&nbsp;<span class="ident" id="3045990">base</span>&nbsp;<span class="op" id="3045995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3045999">return</span>&nbsp;<span class="string" id="3046006">&#34;.&#34;</span><span class="op" id="3046009">,</span>&nbsp;<span class="ident" id="3046011">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3046016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3046019">base</span>&nbsp;<span class="op" id="3046024">=</span>&nbsp;<span class="ident" id="3046026">base</span><span class="op" id="3046030">[</span><span class="builtinfunc" id="3046031">len</span><span class="op" id="3046034">(</span><span class="ident" id="3046035">baseVol</span><span class="op" id="3046042">)</span><span class="op" id="3046043">:</span><span class="op" id="3046044">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3046047">targ</span>&nbsp;<span class="op" id="3046052">=</span>&nbsp;<span class="ident" id="3046054">targ</span><span class="op" id="3046058">[</span><span class="builtinfunc" id="3046059">len</span><span class="op" id="3046062">(</span><span class="ident" id="3046063">targVol</span><span class="op" id="3046070">)</span><span class="op" id="3046071">:</span><span class="op" id="3046072">]</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3046075">if</span>&nbsp;<span class="ident" id="3046078">base</span>&nbsp;<span class="op" id="3046083">==</span>&nbsp;<span class="string" id="3046086">&#34;.&#34;</span>&nbsp;<span class="op" id="3046090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3046094">base</span>&nbsp;<span class="op" id="3046099">=</span>&nbsp;<span class="string" id="3046101">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3046105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3046108">//&nbsp;Can&#39;t&nbsp;use&nbsp;IsAbs&nbsp;-&nbsp;`\a`&nbsp;and&nbsp;`a`&nbsp;are&nbsp;both&nbsp;relative&nbsp;in&nbsp;Windows.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3046173">baseSlashed</span>&nbsp;<span class="op" id="3046185">:=</span>&nbsp;<span class="builtinfunc" id="3046188">len</span><span class="op" id="3046191">(</span><span class="ident" id="3046192">base</span><span class="op" id="3046196">)</span>&nbsp;<span class="op" id="3046198">&gt;</span>&nbsp;<span class="num" id="3046200">0</span>&nbsp;<span class="op" id="3046202">&amp;&amp;</span>&nbsp;<span class="ident" id="3046205">base</span><span class="op" id="3046209">[</span><span class="num" id="3046210">0</span><span class="op" id="3046211">]</span>&nbsp;<span class="op" id="3046213">==</span>&nbsp;<span class="ident" id="3046216">Separator</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3046227">targSlashed</span>&nbsp;<span class="op" id="3046239">:=</span>&nbsp;<span class="builtinfunc" id="3046242">len</span><span class="op" id="3046245">(</span><span class="ident" id="3046246">targ</span><span class="op" id="3046250">)</span>&nbsp;<span class="op" id="3046252">&gt;</span>&nbsp;<span class="num" id="3046254">0</span>&nbsp;<span class="op" id="3046256">&amp;&amp;</span>&nbsp;<span class="ident" id="3046259">targ</span><span class="op" id="3046263">[</span><span class="num" id="3046264">0</span><span class="op" id="3046265">]</span>&nbsp;<span class="op" id="3046267">==</span>&nbsp;<span class="ident" id="3046270">Separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3046281">if</span>&nbsp;<span class="ident" id="3046284">baseSlashed</span>&nbsp;<span class="op" id="3046296">!=</span>&nbsp;<span class="ident" id="3046299">targSlashed</span>&nbsp;<span class="op" id="3046311">||</span>&nbsp;<span class="ident" id="3046314">baseVol</span>&nbsp;<span class="op" id="3046322">!=</span>&nbsp;<span class="ident" id="3046325">targVol</span>&nbsp;<span class="op" id="3046333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3046337">return</span>&nbsp;<span class="string" id="3046344">&#34;&#34;</span><span class="op" id="3046346">,</span>&nbsp;<span class="ident" id="3046348">errors</span><span class="op" id="3046354">.</span><span class="ident" id="3046355">New</span><span class="op" id="3046358">(</span><span class="string" id="3046359">&#34;Rel:&nbsp;can&#39;t&nbsp;make&nbsp;&#34;</span>&nbsp;<span class="op" id="3046378">+</span>&nbsp;<span class="ident" id="3046380">targ</span>&nbsp;<span class="op" id="3046385">+</span>&nbsp;<span class="string" id="3046387">&#34;&nbsp;relative&nbsp;to&nbsp;&#34;</span>&nbsp;<span class="op" id="3046403">+</span>&nbsp;<span class="ident" id="3046405">base</span><span class="op" id="3046409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3046412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3046415">//&nbsp;Position&nbsp;base[b0:bi]&nbsp;and&nbsp;targ[t0:ti]&nbsp;at&nbsp;the&nbsp;first&nbsp;differing&nbsp;elements.</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3046489">bl</span>&nbsp;<span class="op" id="3046492">:=</span>&nbsp;<span class="builtinfunc" id="3046495">len</span><span class="op" id="3046498">(</span><span class="ident" id="3046499">base</span><span class="op" id="3046503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3046506">tl</span>&nbsp;<span class="op" id="3046509">:=</span>&nbsp;<span class="builtinfunc" id="3046512">len</span><span class="op" id="3046515">(</span><span class="ident" id="3046516">targ</span><span class="op" id="3046520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3046523">var</span>&nbsp;<span class="ident" id="3046527">b0</span><span class="op" id="3046529">,</span>&nbsp;<span class="ident" id="3046531">bi</span><span class="op" id="3046533">,</span>&nbsp;<span class="ident" id="3046535">t0</span><span class="op" id="3046537">,</span>&nbsp;<span class="ident" id="3046539">ti</span>&nbsp;<span class="builtintype" id="3046542">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3046547">for</span>&nbsp;<span class="op" id="3046551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3046555">for</span>&nbsp;<span class="ident" id="3046559">bi</span>&nbsp;<span class="op" id="3046562">&lt;</span>&nbsp;<span class="ident" id="3046564">bl</span>&nbsp;<span class="op" id="3046567">&amp;&amp;</span>&nbsp;<span class="ident" id="3046570">base</span><span class="op" id="3046574">[</span><span class="ident" id="3046575">bi</span><span class="op" id="3046577">]</span>&nbsp;<span class="op" id="3046579">!=</span>&nbsp;<span class="ident" id="3046582">Separator</span>&nbsp;<span class="op" id="3046592">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3046597">bi</span><span class="op" id="3046599">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3046604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3046608">for</span>&nbsp;<span class="ident" id="3046612">ti</span>&nbsp;<span class="op" id="3046615">&lt;</span>&nbsp;<span class="ident" id="3046617">tl</span>&nbsp;<span class="op" id="3046620">&amp;&amp;</span>&nbsp;<span class="ident" id="3046623">targ</span><span class="op" id="3046627">[</span><span class="ident" id="3046628">ti</span><span class="op" id="3046630">]</span>&nbsp;<span class="op" id="3046632">!=</span>&nbsp;<span class="ident" id="3046635">Separator</span>&nbsp;<span class="op" id="3046645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3046650">ti</span><span class="op" id="3046652">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3046657">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3046661">if</span>&nbsp;<span class="ident" id="3046664">targ</span><span class="op" id="3046668">[</span><span class="ident" id="3046669">t0</span><span class="op" id="3046671">:</span><span class="ident" id="3046672">ti</span><span class="op" id="3046674">]</span>&nbsp;<span class="op" id="3046676">!=</span>&nbsp;<span class="ident" id="3046679">base</span><span class="op" id="3046683">[</span><span class="ident" id="3046684">b0</span><span class="op" id="3046686">:</span><span class="ident" id="3046687">bi</span><span class="op" id="3046689">]</span>&nbsp;<span class="op" id="3046691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3046696">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3046704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3046708">if</span>&nbsp;<span class="ident" id="3046711">bi</span>&nbsp;<span class="op" id="3046714">&lt;</span>&nbsp;<span class="ident" id="3046716">bl</span>&nbsp;<span class="op" id="3046719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3046724">bi</span><span class="op" id="3046726">++</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3046731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3046735">if</span>&nbsp;<span class="ident" id="3046738">ti</span>&nbsp;<span class="op" id="3046741">&lt;</span>&nbsp;<span class="ident" id="3046743">tl</span>&nbsp;<span class="op" id="3046746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3046751">ti</span><span class="op" id="3046753">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3046758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3046762">b0</span>&nbsp;<span class="op" id="3046765">=</span>&nbsp;<span class="ident" id="3046767">bi</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3046772">t0</span>&nbsp;<span class="op" id="3046775">=</span>&nbsp;<span class="ident" id="3046777">ti</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3046781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3046784">if</span>&nbsp;<span class="ident" id="3046787">base</span><span class="op" id="3046791">[</span><span class="ident" id="3046792">b0</span><span class="op" id="3046794">:</span><span class="ident" id="3046795">bi</span><span class="op" id="3046797">]</span>&nbsp;<span class="op" id="3046799">==</span>&nbsp;<span class="string" id="3046802">&#34;..&#34;</span>&nbsp;<span class="op" id="3046807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3046811">return</span>&nbsp;<span class="string" id="3046818">&#34;&#34;</span><span class="op" id="3046820">,</span>&nbsp;<span class="ident" id="3046822">errors</span><span class="op" id="3046828">.</span><span class="ident" id="3046829">New</span><span class="op" id="3046832">(</span><span class="string" id="3046833">&#34;Rel:&nbsp;can&#39;t&nbsp;make&nbsp;&#34;</span>&nbsp;<span class="op" id="3046852">+</span>&nbsp;<span class="ident" id="3046854">targ</span>&nbsp;<span class="op" id="3046859">+</span>&nbsp;<span class="string" id="3046861">&#34;&nbsp;relative&nbsp;to&nbsp;&#34;</span>&nbsp;<span class="op" id="3046877">+</span>&nbsp;<span class="ident" id="3046879">base</span><span class="op" id="3046883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3046886">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3046889">if</span>&nbsp;<span class="ident" id="3046892">b0</span>&nbsp;<span class="op" id="3046895">!=</span>&nbsp;<span class="ident" id="3046898">bl</span>&nbsp;<span class="op" id="3046901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3046905">//&nbsp;Base&nbsp;elements&nbsp;left.&nbsp;Must&nbsp;go&nbsp;up&nbsp;before&nbsp;going&nbsp;down.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3046960">seps</span>&nbsp;<span class="op" id="3046965">:=</span>&nbsp;<span class="ident" id="3046968">strings</span><span class="op" id="3046975">.</span><span class="ident" id="3046976">Count</span><span class="op" id="3046981">(</span><span class="ident" id="3046982">base</span><span class="op" id="3046986">[</span><span class="ident" id="3046987">b0</span><span class="op" id="3046989">:</span><span class="ident" id="3046990">bl</span><span class="op" id="3046992">]</span><span class="op" id="3046993">,</span>&nbsp;<span class="builtintype" id="3046995">string</span><span class="op" id="3047001">(</span><span class="ident" id="3047002">Separator</span><span class="op" id="3047011">)</span><span class="op" id="3047012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3047016">size</span>&nbsp;<span class="op" id="3047021">:=</span>&nbsp;<span class="num" id="3047024">2</span>&nbsp;<span class="op" id="3047026">+</span>&nbsp;<span class="ident" id="3047028">seps</span><span class="op" id="3047032">*</span><span class="num" id="3047033">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3047037">if</span>&nbsp;<span class="ident" id="3047040">tl</span>&nbsp;<span class="op" id="3047043">!=</span>&nbsp;<span class="ident" id="3047046">t0</span>&nbsp;<span class="op" id="3047049">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3047054">size</span>&nbsp;<span class="op" id="3047059">+=</span>&nbsp;<span class="num" id="3047062">1</span>&nbsp;<span class="op" id="3047064">+</span>&nbsp;<span class="ident" id="3047066">tl</span>&nbsp;<span class="op" id="3047069">-</span>&nbsp;<span class="ident" id="3047071">t0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3047076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3047080">buf</span>&nbsp;<span class="op" id="3047084">:=</span>&nbsp;<span class="builtinfunc" id="3047087">make</span><span class="op" id="3047091">(</span><span class="op" id="3047092">[</span><span class="op" id="3047093">]</span><span class="builtintype" id="3047094">byte</span><span class="op" id="3047098">,</span>&nbsp;<span class="ident" id="3047100">size</span><span class="op" id="3047104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3047108">n</span>&nbsp;<span class="op" id="3047110">:=</span>&nbsp;<span class="builtinfunc" id="3047113">copy</span><span class="op" id="3047117">(</span><span class="ident" id="3047118">buf</span><span class="op" id="3047121">,</span>&nbsp;<span class="string" id="3047123">&#34;..&#34;</span><span class="op" id="3047127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3047131">for</span>&nbsp;<span class="ident" id="3047135">i</span>&nbsp;<span class="op" id="3047137">:=</span>&nbsp;<span class="num" id="3047140">0</span><span class="op" id="3047141">;</span>&nbsp;<span class="ident" id="3047143">i</span>&nbsp;<span class="op" id="3047145">&lt;</span>&nbsp;<span class="ident" id="3047147">seps</span><span class="op" id="3047151">;</span>&nbsp;<span class="ident" id="3047153">i</span><span class="op" id="3047154">++</span>&nbsp;<span class="op" id="3047157">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3047162">buf</span><span class="op" id="3047165">[</span><span class="ident" id="3047166">n</span><span class="op" id="3047167">]</span>&nbsp;<span class="op" id="3047169">=</span>&nbsp;<span class="ident" id="3047171">Separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3047184">copy</span><span class="op" id="3047188">(</span><span class="ident" id="3047189">buf</span><span class="op" id="3047192">[</span><span class="ident" id="3047193">n</span><span class="op" id="3047194">+</span><span class="num" id="3047195">1</span><span class="op" id="3047196">:</span><span class="op" id="3047197">]</span><span class="op" id="3047198">,</span>&nbsp;<span class="string" id="3047200">&#34;..&#34;</span><span class="op" id="3047204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3047209">n</span>&nbsp;<span class="op" id="3047211">+=</span>&nbsp;<span class="num" id="3047214">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3047218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3047222">if</span>&nbsp;<span class="ident" id="3047225">t0</span>&nbsp;<span class="op" id="3047228">!=</span>&nbsp;<span class="ident" id="3047231">tl</span>&nbsp;<span class="op" id="3047234">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3047239">buf</span><span class="op" id="3047242">[</span><span class="ident" id="3047243">n</span><span class="op" id="3047244">]</span>&nbsp;<span class="op" id="3047246">=</span>&nbsp;<span class="ident" id="3047248">Separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3047261">copy</span><span class="op" id="3047265">(</span><span class="ident" id="3047266">buf</span><span class="op" id="3047269">[</span><span class="ident" id="3047270">n</span><span class="op" id="3047271">+</span><span class="num" id="3047272">1</span><span class="op" id="3047273">:</span><span class="op" id="3047274">]</span><span class="op" id="3047275">,</span>&nbsp;<span class="ident" id="3047277">targ</span><span class="op" id="3047281">[</span><span class="ident" id="3047282">t0</span><span class="op" id="3047284">:</span><span class="op" id="3047285">]</span><span class="op" id="3047286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3047290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3047294">return</span>&nbsp;<span class="builtintype" id="3047301">string</span><span class="op" id="3047307">(</span><span class="ident" id="3047308">buf</span><span class="op" id="3047311">)</span><span class="op" id="3047312">,</span>&nbsp;<span class="ident" id="3047314">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3047319">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3047322">return</span>&nbsp;<span class="ident" id="3047329">targ</span><span class="op" id="3047333">[</span><span class="ident" id="3047334">t0</span><span class="op" id="3047336">:</span><span class="op" id="3047337">]</span><span class="op" id="3047338">,</span>&nbsp;<span class="ident" id="3047340">nil</span><br>
<span class="lineno"></span><span class="op" id="3047344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3047347">//&nbsp;SkipDir&nbsp;is&nbsp;used&nbsp;as&nbsp;a&nbsp;return&nbsp;value&nbsp;from&nbsp;WalkFuncs&nbsp;to&nbsp;indicate&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3047416">//&nbsp;the&nbsp;directory&nbsp;named&nbsp;in&nbsp;the&nbsp;call&nbsp;is&nbsp;to&nbsp;be&nbsp;skipped.&nbsp;It&nbsp;is&nbsp;not&nbsp;returned</span><br>
<span class="lineno">325</span><span class="comment" id="3047488">//&nbsp;as&nbsp;an&nbsp;error&nbsp;by&nbsp;any&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="3047520">var</span>&nbsp;<span class="ident" id="3047524">SkipDir</span>&nbsp;<span class="op" id="3047532">=</span>&nbsp;<span class="ident" id="3047534">errors</span><span class="op" id="3047540">.</span><span class="ident" id="3047541">New</span><span class="op" id="3047544">(</span><span class="string" id="3047545">&#34;skip&nbsp;this&nbsp;directory&#34;</span><span class="op" id="3047566">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3047569">//&nbsp;WalkFunc&nbsp;is&nbsp;the&nbsp;type&nbsp;of&nbsp;the&nbsp;function&nbsp;called&nbsp;for&nbsp;each&nbsp;file&nbsp;or&nbsp;directory</span><br>
<span class="lineno"></span><span class="comment" id="3047643">//&nbsp;visited&nbsp;by&nbsp;Walk.&nbsp;The&nbsp;path&nbsp;argument&nbsp;contains&nbsp;the&nbsp;argument&nbsp;to&nbsp;Walk&nbsp;as&nbsp;a</span><br>
<span class="lineno">330</span><span class="comment" id="3047716">//&nbsp;prefix;&nbsp;that&nbsp;is,&nbsp;if&nbsp;Walk&nbsp;is&nbsp;called&nbsp;with&nbsp;&#34;dir&#34;,&nbsp;which&nbsp;is&nbsp;a&nbsp;directory</span><br>
<span class="lineno"></span><span class="comment" id="3047787">//&nbsp;containing&nbsp;the&nbsp;file&nbsp;&#34;a&#34;,&nbsp;the&nbsp;walk&nbsp;function&nbsp;will&nbsp;be&nbsp;called&nbsp;with&nbsp;argument</span><br>
<span class="lineno"></span><span class="comment" id="3047862">//&nbsp;&#34;dir/a&#34;.&nbsp;The&nbsp;info&nbsp;argument&nbsp;is&nbsp;the&nbsp;os.FileInfo&nbsp;for&nbsp;the&nbsp;named&nbsp;path.</span><br>
<span class="lineno"></span><span class="comment" id="3047931">//</span><br>
<span class="lineno"></span><span class="comment" id="3047934">//&nbsp;If&nbsp;there&nbsp;was&nbsp;a&nbsp;problem&nbsp;walking&nbsp;to&nbsp;the&nbsp;file&nbsp;or&nbsp;directory&nbsp;named&nbsp;by&nbsp;path,&nbsp;the</span><br>
<span class="lineno">335</span><span class="comment" id="3048012">//&nbsp;incoming&nbsp;error&nbsp;will&nbsp;describe&nbsp;the&nbsp;problem&nbsp;and&nbsp;the&nbsp;function&nbsp;can&nbsp;decide&nbsp;how</span><br>
<span class="lineno"></span><span class="comment" id="3048088">//&nbsp;to&nbsp;handle&nbsp;that&nbsp;error&nbsp;(and&nbsp;Walk&nbsp;will&nbsp;not&nbsp;descend&nbsp;into&nbsp;that&nbsp;directory).&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="3048164">//&nbsp;an&nbsp;error&nbsp;is&nbsp;returned,&nbsp;processing&nbsp;stops.&nbsp;The&nbsp;sole&nbsp;exception&nbsp;is&nbsp;that&nbsp;if&nbsp;path</span><br>
<span class="lineno"></span><span class="comment" id="3048242">//&nbsp;is&nbsp;a&nbsp;directory&nbsp;and&nbsp;the&nbsp;function&nbsp;returns&nbsp;the&nbsp;special&nbsp;value&nbsp;SkipDir,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3048316">//&nbsp;contents&nbsp;of&nbsp;the&nbsp;directory&nbsp;are&nbsp;skipped&nbsp;and&nbsp;processing&nbsp;continues&nbsp;as&nbsp;usual&nbsp;on</span><br>
<span class="lineno">340</span><span class="comment" id="3048394">//&nbsp;the&nbsp;next&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="3048412">type</span>&nbsp;<span class="ident" id="3048417">WalkFunc</span>&nbsp;<span class="keyword" id="3048426">func</span><span class="op" id="3048430">(</span><span class="ident" id="3048431">path</span>&nbsp;<span class="builtintype" id="3048436">string</span><span class="op" id="3048442">,</span>&nbsp;<span class="ident" id="3048444">info</span>&nbsp;<span class="ident" id="3048449">os</span><span class="op" id="3048451">.</span><span class="ident" id="3048452">FileInfo</span><span class="op" id="3048460">,</span>&nbsp;<span class="ident" id="3048462">err</span>&nbsp;<span class="builtintype" id="3048466">error</span><span class="op" id="3048471">)</span>&nbsp;<span class="builtintype" id="3048473">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3048480">var</span>&nbsp;<span class="ident" id="3048484">lstat</span>&nbsp;<span class="op" id="3048490">=</span>&nbsp;<span class="ident" id="3048492">os</span><span class="op" id="3048494">.</span><span class="ident" id="3048495">Lstat</span>&nbsp;<span class="comment" id="3048501">//&nbsp;for&nbsp;testing</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="comment" id="3048517">//&nbsp;walk&nbsp;recursively&nbsp;descends&nbsp;path,&nbsp;calling&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="3048563">func</span>&nbsp;<span class="ident" id="3048568">walk</span><span class="op" id="3048572">(</span><span class="ident" id="3048573">path</span>&nbsp;<span class="builtintype" id="3048578">string</span><span class="op" id="3048584">,</span>&nbsp;<span class="ident" id="3048586">info</span>&nbsp;<span class="ident" id="3048591">os</span><span class="op" id="3048593">.</span><span class="ident" id="3048594">FileInfo</span><span class="op" id="3048602">,</span>&nbsp;<span class="ident" id="3048604">walkFn</span>&nbsp;<span class="ident" id="3048611">WalkFunc</span><span class="op" id="3048619">)</span>&nbsp;<span class="builtintype" id="3048621">error</span>&nbsp;<span class="op" id="3048627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3048630">err</span>&nbsp;<span class="op" id="3048634">:=</span>&nbsp;<span class="ident" id="3048637">walkFn</span><span class="op" id="3048643">(</span><span class="ident" id="3048644">path</span><span class="op" id="3048648">,</span>&nbsp;<span class="ident" id="3048650">info</span><span class="op" id="3048654">,</span>&nbsp;<span class="ident" id="3048656">nil</span><span class="op" id="3048659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3048662">if</span>&nbsp;<span class="ident" id="3048665">err</span>&nbsp;<span class="op" id="3048669">!=</span>&nbsp;<span class="ident" id="3048672">nil</span>&nbsp;<span class="op" id="3048676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3048680">if</span>&nbsp;<span class="ident" id="3048683">info</span><span class="op" id="3048687">.</span><span class="ident" id="3048688">IsDir</span><span class="op" id="3048693">(</span><span class="op" id="3048694">)</span>&nbsp;<span class="op" id="3048696">&amp;&amp;</span>&nbsp;<span class="ident" id="3048699">err</span>&nbsp;<span class="op" id="3048703">==</span>&nbsp;<span class="ident" id="3048706">SkipDir</span>&nbsp;<span class="op" id="3048714">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3048719">return</span>&nbsp;<span class="ident" id="3048726">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3048732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3048736">return</span>&nbsp;<span class="ident" id="3048743">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3048748">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3048752">if</span>&nbsp;<span class="op" id="3048755">!</span><span class="ident" id="3048756">info</span><span class="op" id="3048760">.</span><span class="ident" id="3048761">IsDir</span><span class="op" id="3048766">(</span><span class="op" id="3048767">)</span>&nbsp;<span class="op" id="3048769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3048773">return</span>&nbsp;<span class="ident" id="3048780">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3048785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3048789">names</span><span class="op" id="3048794">,</span>&nbsp;<span class="ident" id="3048796">err</span>&nbsp;<span class="op" id="3048800">:=</span>&nbsp;<span class="ident" id="3048803">readDirNames</span><span class="op" id="3048815">(</span><span class="ident" id="3048816">path</span><span class="op" id="3048820">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3048823">if</span>&nbsp;<span class="ident" id="3048826">err</span>&nbsp;<span class="op" id="3048830">!=</span>&nbsp;<span class="ident" id="3048833">nil</span>&nbsp;<span class="op" id="3048837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3048841">return</span>&nbsp;<span class="ident" id="3048848">walkFn</span><span class="op" id="3048854">(</span><span class="ident" id="3048855">path</span><span class="op" id="3048859">,</span>&nbsp;<span class="ident" id="3048861">info</span><span class="op" id="3048865">,</span>&nbsp;<span class="ident" id="3048867">err</span><span class="op" id="3048870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3048873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3048877">for</span>&nbsp;<span class="ident" id="3048881">_</span><span class="op" id="3048882">,</span>&nbsp;<span class="ident" id="3048884">name</span>&nbsp;<span class="op" id="3048889">:=</span>&nbsp;<span class="keyword" id="3048892">range</span>&nbsp;<span class="ident" id="3048898">names</span>&nbsp;<span class="op" id="3048904">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3048908">filename</span>&nbsp;<span class="op" id="3048917">:=</span>&nbsp;<span class="ident" id="3048920">Join</span><span class="op" id="3048924">(</span><span class="ident" id="3048925">path</span><span class="op" id="3048929">,</span>&nbsp;<span class="ident" id="3048931">name</span><span class="op" id="3048935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3048939">fileInfo</span><span class="op" id="3048947">,</span>&nbsp;<span class="ident" id="3048949">err</span>&nbsp;<span class="op" id="3048953">:=</span>&nbsp;<span class="ident" id="3048956">lstat</span><span class="op" id="3048961">(</span><span class="ident" id="3048962">filename</span><span class="op" id="3048970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3048974">if</span>&nbsp;<span class="ident" id="3048977">err</span>&nbsp;<span class="op" id="3048981">!=</span>&nbsp;<span class="ident" id="3048984">nil</span>&nbsp;<span class="op" id="3048988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3048993">if</span>&nbsp;<span class="ident" id="3048996">err</span>&nbsp;<span class="op" id="3049000">:=</span>&nbsp;<span class="ident" id="3049003">walkFn</span><span class="op" id="3049009">(</span><span class="ident" id="3049010">filename</span><span class="op" id="3049018">,</span>&nbsp;<span class="ident" id="3049020">fileInfo</span><span class="op" id="3049028">,</span>&nbsp;<span class="ident" id="3049030">err</span><span class="op" id="3049033">)</span><span class="op" id="3049034">;</span>&nbsp;<span class="ident" id="3049036">err</span>&nbsp;<span class="op" id="3049040">!=</span>&nbsp;<span class="ident" id="3049043">nil</span>&nbsp;<span class="op" id="3049047">&amp;&amp;</span>&nbsp;<span class="ident" id="3049050">err</span>&nbsp;<span class="op" id="3049054">!=</span>&nbsp;<span class="ident" id="3049057">SkipDir</span>&nbsp;<span class="op" id="3049065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3049071">return</span>&nbsp;<span class="ident" id="3049078">err</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3049085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3049089">}</span>&nbsp;<span class="keyword" id="3049091">else</span>&nbsp;<span class="op" id="3049096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3049101">err</span>&nbsp;<span class="op" id="3049105">=</span>&nbsp;<span class="ident" id="3049107">walk</span><span class="op" id="3049111">(</span><span class="ident" id="3049112">filename</span><span class="op" id="3049120">,</span>&nbsp;<span class="ident" id="3049122">fileInfo</span><span class="op" id="3049130">,</span>&nbsp;<span class="ident" id="3049132">walkFn</span><span class="op" id="3049138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3049143">if</span>&nbsp;<span class="ident" id="3049146">err</span>&nbsp;<span class="op" id="3049150">!=</span>&nbsp;<span class="ident" id="3049153">nil</span>&nbsp;<span class="op" id="3049157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3049163">if</span>&nbsp;<span class="op" id="3049166">!</span><span class="ident" id="3049167">fileInfo</span><span class="op" id="3049175">.</span><span class="ident" id="3049176">IsDir</span><span class="op" id="3049181">(</span><span class="op" id="3049182">)</span>&nbsp;<span class="op" id="3049184">||</span>&nbsp;<span class="ident" id="3049187">err</span>&nbsp;<span class="op" id="3049191">!=</span>&nbsp;<span class="ident" id="3049194">SkipDir</span>&nbsp;<span class="op" id="3049202">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3049209">return</span>&nbsp;<span class="ident" id="3049216">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3049224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3049229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3049233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3049236">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3049239">return</span>&nbsp;<span class="ident" id="3049246">nil</span><br>
<span class="lineno"></span><span class="op" id="3049250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3049253">//&nbsp;Walk&nbsp;walks&nbsp;the&nbsp;file&nbsp;tree&nbsp;rooted&nbsp;at&nbsp;root,&nbsp;calling&nbsp;walkFn&nbsp;for&nbsp;each&nbsp;file&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="3049329">//&nbsp;directory&nbsp;in&nbsp;the&nbsp;tree,&nbsp;including&nbsp;root.&nbsp;All&nbsp;errors&nbsp;that&nbsp;arise&nbsp;visiting&nbsp;files</span><br>
<span class="lineno">385</span><span class="comment" id="3049408">//&nbsp;and&nbsp;directories&nbsp;are&nbsp;filtered&nbsp;by&nbsp;walkFn.&nbsp;The&nbsp;files&nbsp;are&nbsp;walked&nbsp;in&nbsp;lexical</span><br>
<span class="lineno"></span><span class="comment" id="3049483">//&nbsp;order,&nbsp;which&nbsp;makes&nbsp;the&nbsp;output&nbsp;deterministic&nbsp;but&nbsp;means&nbsp;that&nbsp;for&nbsp;very</span><br>
<span class="lineno"></span><span class="comment" id="3049554">//&nbsp;large&nbsp;directories&nbsp;Walk&nbsp;can&nbsp;be&nbsp;inefficient.</span><br>
<span class="lineno"></span><span class="comment" id="3049600">//&nbsp;Walk&nbsp;does&nbsp;not&nbsp;follow&nbsp;symbolic&nbsp;links.</span><br>
<span class="lineno"></span><span class="keyword" id="3049640">func</span>&nbsp;<span class="ident" id="3049645">Walk</span><span class="op" id="3049649">(</span><span class="ident" id="3049650">root</span>&nbsp;<span class="builtintype" id="3049655">string</span><span class="op" id="3049661">,</span>&nbsp;<span class="ident" id="3049663">walkFn</span>&nbsp;<span class="ident" id="3049670">WalkFunc</span><span class="op" id="3049678">)</span>&nbsp;<span class="builtintype" id="3049680">error</span>&nbsp;<span class="op" id="3049686">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3049689">info</span><span class="op" id="3049693">,</span>&nbsp;<span class="ident" id="3049695">err</span>&nbsp;<span class="op" id="3049699">:=</span>&nbsp;<span class="ident" id="3049702">os</span><span class="op" id="3049704">.</span><span class="ident" id="3049705">Lstat</span><span class="op" id="3049710">(</span><span class="ident" id="3049711">root</span><span class="op" id="3049715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3049718">if</span>&nbsp;<span class="ident" id="3049721">err</span>&nbsp;<span class="op" id="3049725">!=</span>&nbsp;<span class="ident" id="3049728">nil</span>&nbsp;<span class="op" id="3049732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3049736">return</span>&nbsp;<span class="ident" id="3049743">walkFn</span><span class="op" id="3049749">(</span><span class="ident" id="3049750">root</span><span class="op" id="3049754">,</span>&nbsp;<span class="ident" id="3049756">nil</span><span class="op" id="3049759">,</span>&nbsp;<span class="ident" id="3049761">err</span><span class="op" id="3049764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3049767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3049770">return</span>&nbsp;<span class="ident" id="3049777">walk</span><span class="op" id="3049781">(</span><span class="ident" id="3049782">root</span><span class="op" id="3049786">,</span>&nbsp;<span class="ident" id="3049788">info</span><span class="op" id="3049792">,</span>&nbsp;<span class="ident" id="3049794">walkFn</span><span class="op" id="3049800">)</span><br>
<span class="lineno">395</span><span class="op" id="3049802">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3049805">//&nbsp;readDirNames&nbsp;reads&nbsp;the&nbsp;directory&nbsp;named&nbsp;by&nbsp;dirname&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3049870">//&nbsp;a&nbsp;sorted&nbsp;list&nbsp;of&nbsp;directory&nbsp;entries.</span><br>
<span class="lineno"></span><span class="keyword" id="3049909">func</span>&nbsp;<span class="ident" id="3049914">readDirNames</span><span class="op" id="3049926">(</span><span class="ident" id="3049927">dirname</span>&nbsp;<span class="builtintype" id="3049935">string</span><span class="op" id="3049941">)</span>&nbsp;<span class="op" id="3049943">(</span><span class="op" id="3049944">[</span><span class="op" id="3049945">]</span><span class="builtintype" id="3049946">string</span><span class="op" id="3049952">,</span>&nbsp;<span class="builtintype" id="3049954">error</span><span class="op" id="3049959">)</span>&nbsp;<span class="op" id="3049961">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3049964">f</span><span class="op" id="3049965">,</span>&nbsp;<span class="ident" id="3049967">err</span>&nbsp;<span class="op" id="3049971">:=</span>&nbsp;<span class="ident" id="3049974">os</span><span class="op" id="3049976">.</span><span class="ident" id="3049977">Open</span><span class="op" id="3049981">(</span><span class="ident" id="3049982">dirname</span><span class="op" id="3049989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3049992">if</span>&nbsp;<span class="ident" id="3049995">err</span>&nbsp;<span class="op" id="3049999">!=</span>&nbsp;<span class="ident" id="3050002">nil</span>&nbsp;<span class="op" id="3050006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050010">return</span>&nbsp;<span class="ident" id="3050017">nil</span><span class="op" id="3050020">,</span>&nbsp;<span class="ident" id="3050022">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3050027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3050030">names</span><span class="op" id="3050035">,</span>&nbsp;<span class="ident" id="3050037">err</span>&nbsp;<span class="op" id="3050041">:=</span>&nbsp;<span class="ident" id="3050044">f</span><span class="op" id="3050045">.</span><span class="ident" id="3050046">Readdirnames</span><span class="op" id="3050058">(</span><span class="op" id="3050059">-</span><span class="num" id="3050060">1</span><span class="op" id="3050061">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3050064">f</span><span class="op" id="3050065">.</span><span class="ident" id="3050066">Close</span><span class="op" id="3050071">(</span><span class="op" id="3050072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050075">if</span>&nbsp;<span class="ident" id="3050078">err</span>&nbsp;<span class="op" id="3050082">!=</span>&nbsp;<span class="ident" id="3050085">nil</span>&nbsp;<span class="op" id="3050089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050093">return</span>&nbsp;<span class="ident" id="3050100">nil</span><span class="op" id="3050103">,</span>&nbsp;<span class="ident" id="3050105">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3050110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3050113">sort</span><span class="op" id="3050117">.</span><span class="ident" id="3050118">Strings</span><span class="op" id="3050125">(</span><span class="ident" id="3050126">names</span><span class="op" id="3050131">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050134">return</span>&nbsp;<span class="ident" id="3050141">names</span><span class="op" id="3050146">,</span>&nbsp;<span class="ident" id="3050148">nil</span><br>
<span class="lineno"></span><span class="op" id="3050152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3050155">//&nbsp;Base&nbsp;returns&nbsp;the&nbsp;last&nbsp;element&nbsp;of&nbsp;path.</span><br>
<span class="lineno"></span><span class="comment" id="3050197">//&nbsp;Trailing&nbsp;path&nbsp;separators&nbsp;are&nbsp;removed&nbsp;before&nbsp;extracting&nbsp;the&nbsp;last&nbsp;element.</span><br>
<span class="lineno">415</span><span class="comment" id="3050273">//&nbsp;If&nbsp;the&nbsp;path&nbsp;is&nbsp;empty,&nbsp;Base&nbsp;returns&nbsp;&#34;.&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3050316">//&nbsp;If&nbsp;the&nbsp;path&nbsp;consists&nbsp;entirely&nbsp;of&nbsp;separators,&nbsp;Base&nbsp;returns&nbsp;a&nbsp;single&nbsp;separator.</span><br>
<span class="lineno"></span><span class="keyword" id="3050397">func</span>&nbsp;<span class="ident" id="3050402">Base</span><span class="op" id="3050406">(</span><span class="ident" id="3050407">path</span>&nbsp;<span class="builtintype" id="3050412">string</span><span class="op" id="3050418">)</span>&nbsp;<span class="builtintype" id="3050420">string</span>&nbsp;<span class="op" id="3050427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050430">if</span>&nbsp;<span class="ident" id="3050433">path</span>&nbsp;<span class="op" id="3050438">==</span>&nbsp;<span class="string" id="3050441">&#34;&#34;</span>&nbsp;<span class="op" id="3050444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050448">return</span>&nbsp;<span class="string" id="3050455">&#34;.&#34;</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3050460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3050463">//&nbsp;Strip&nbsp;trailing&nbsp;slashes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050491">for</span>&nbsp;<span class="builtinfunc" id="3050495">len</span><span class="op" id="3050498">(</span><span class="ident" id="3050499">path</span><span class="op" id="3050503">)</span>&nbsp;<span class="op" id="3050505">&gt;</span>&nbsp;<span class="num" id="3050507">0</span>&nbsp;<span class="op" id="3050509">&amp;&amp;</span>&nbsp;<span class="ident" id="3050512">os</span><span class="op" id="3050514">.</span><span class="ident" id="3050515">IsPathSeparator</span><span class="op" id="3050530">(</span><span class="ident" id="3050531">path</span><span class="op" id="3050535">[</span><span class="builtinfunc" id="3050536">len</span><span class="op" id="3050539">(</span><span class="ident" id="3050540">path</span><span class="op" id="3050544">)</span><span class="op" id="3050545">-</span><span class="num" id="3050546">1</span><span class="op" id="3050547">]</span><span class="op" id="3050548">)</span>&nbsp;<span class="op" id="3050550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3050554">path</span>&nbsp;<span class="op" id="3050559">=</span>&nbsp;<span class="ident" id="3050561">path</span><span class="op" id="3050565">[</span><span class="num" id="3050566">0</span>&nbsp;<span class="op" id="3050568">:</span>&nbsp;<span class="builtinfunc" id="3050570">len</span><span class="op" id="3050573">(</span><span class="ident" id="3050574">path</span><span class="op" id="3050578">)</span><span class="op" id="3050579">-</span><span class="num" id="3050580">1</span><span class="op" id="3050581">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3050584">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3050587">//&nbsp;Throw&nbsp;away&nbsp;volume&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3050614">path</span>&nbsp;<span class="op" id="3050619">=</span>&nbsp;<span class="ident" id="3050621">path</span><span class="op" id="3050625">[</span><span class="builtinfunc" id="3050626">len</span><span class="op" id="3050629">(</span><span class="ident" id="3050630">VolumeName</span><span class="op" id="3050640">(</span><span class="ident" id="3050641">path</span><span class="op" id="3050645">)</span><span class="op" id="3050646">)</span><span class="op" id="3050647">:</span><span class="op" id="3050648">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3050651">//&nbsp;Find&nbsp;the&nbsp;last&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3050677">i</span>&nbsp;<span class="op" id="3050679">:=</span>&nbsp;<span class="builtinfunc" id="3050682">len</span><span class="op" id="3050685">(</span><span class="ident" id="3050686">path</span><span class="op" id="3050690">)</span>&nbsp;<span class="op" id="3050692">-</span>&nbsp;<span class="num" id="3050694">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050697">for</span>&nbsp;<span class="ident" id="3050701">i</span>&nbsp;<span class="op" id="3050703">&gt;=</span>&nbsp;<span class="num" id="3050706">0</span>&nbsp;<span class="op" id="3050708">&amp;&amp;</span>&nbsp;<span class="op" id="3050711">!</span><span class="ident" id="3050712">os</span><span class="op" id="3050714">.</span><span class="ident" id="3050715">IsPathSeparator</span><span class="op" id="3050730">(</span><span class="ident" id="3050731">path</span><span class="op" id="3050735">[</span><span class="ident" id="3050736">i</span><span class="op" id="3050737">]</span><span class="op" id="3050738">)</span>&nbsp;<span class="op" id="3050740">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3050744">i</span><span class="op" id="3050745">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3050749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050752">if</span>&nbsp;<span class="ident" id="3050755">i</span>&nbsp;<span class="op" id="3050757">&gt;=</span>&nbsp;<span class="num" id="3050760">0</span>&nbsp;<span class="op" id="3050762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3050766">path</span>&nbsp;<span class="op" id="3050771">=</span>&nbsp;<span class="ident" id="3050773">path</span><span class="op" id="3050777">[</span><span class="ident" id="3050778">i</span><span class="op" id="3050779">+</span><span class="num" id="3050780">1</span><span class="op" id="3050781">:</span><span class="op" id="3050782">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3050785">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3050788">//&nbsp;If&nbsp;empty&nbsp;now,&nbsp;it&nbsp;had&nbsp;only&nbsp;slashes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050827">if</span>&nbsp;<span class="ident" id="3050830">path</span>&nbsp;<span class="op" id="3050835">==</span>&nbsp;<span class="string" id="3050838">&#34;&#34;</span>&nbsp;<span class="op" id="3050841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050845">return</span>&nbsp;<span class="builtintype" id="3050852">string</span><span class="op" id="3050858">(</span><span class="ident" id="3050859">Separator</span><span class="op" id="3050868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3050871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050874">return</span>&nbsp;<span class="ident" id="3050881">path</span><br>
<span class="lineno">440</span><span class="op" id="3050886">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3050889">//&nbsp;Dir&nbsp;returns&nbsp;all&nbsp;but&nbsp;the&nbsp;last&nbsp;element&nbsp;of&nbsp;path,&nbsp;typically&nbsp;the&nbsp;path&#39;s&nbsp;directory.</span><br>
<span class="lineno"></span><span class="comment" id="3050970">//&nbsp;After&nbsp;dropping&nbsp;the&nbsp;final&nbsp;element,&nbsp;the&nbsp;path&nbsp;is&nbsp;Cleaned&nbsp;and&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="3051040">//&nbsp;slashes&nbsp;are&nbsp;removed.</span><br>
<span class="lineno">445</span><span class="comment" id="3051064">//&nbsp;If&nbsp;the&nbsp;path&nbsp;is&nbsp;empty,&nbsp;Dir&nbsp;returns&nbsp;&#34;.&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3051106">//&nbsp;If&nbsp;the&nbsp;path&nbsp;consists&nbsp;entirely&nbsp;of&nbsp;separators,&nbsp;Dir&nbsp;returns&nbsp;a&nbsp;single&nbsp;separator.</span><br>
<span class="lineno"></span><span class="comment" id="3051186">//&nbsp;The&nbsp;returned&nbsp;path&nbsp;does&nbsp;not&nbsp;end&nbsp;in&nbsp;a&nbsp;separator&nbsp;unless&nbsp;it&nbsp;is&nbsp;the&nbsp;root&nbsp;directory.</span><br>
<span class="lineno"></span><span class="keyword" id="3051268">func</span>&nbsp;<span class="ident" id="3051273">Dir</span><span class="op" id="3051276">(</span><span class="ident" id="3051277">path</span>&nbsp;<span class="builtintype" id="3051282">string</span><span class="op" id="3051288">)</span>&nbsp;<span class="builtintype" id="3051290">string</span>&nbsp;<span class="op" id="3051297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3051300">vol</span>&nbsp;<span class="op" id="3051304">:=</span>&nbsp;<span class="ident" id="3051307">VolumeName</span><span class="op" id="3051317">(</span><span class="ident" id="3051318">path</span><span class="op" id="3051322">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3051325">i</span>&nbsp;<span class="op" id="3051327">:=</span>&nbsp;<span class="builtinfunc" id="3051330">len</span><span class="op" id="3051333">(</span><span class="ident" id="3051334">path</span><span class="op" id="3051338">)</span>&nbsp;<span class="op" id="3051340">-</span>&nbsp;<span class="num" id="3051342">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3051345">for</span>&nbsp;<span class="ident" id="3051349">i</span>&nbsp;<span class="op" id="3051351">&gt;=</span>&nbsp;<span class="builtinfunc" id="3051354">len</span><span class="op" id="3051357">(</span><span class="ident" id="3051358">vol</span><span class="op" id="3051361">)</span>&nbsp;<span class="op" id="3051363">&amp;&amp;</span>&nbsp;<span class="op" id="3051366">!</span><span class="ident" id="3051367">os</span><span class="op" id="3051369">.</span><span class="ident" id="3051370">IsPathSeparator</span><span class="op" id="3051385">(</span><span class="ident" id="3051386">path</span><span class="op" id="3051390">[</span><span class="ident" id="3051391">i</span><span class="op" id="3051392">]</span><span class="op" id="3051393">)</span>&nbsp;<span class="op" id="3051395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3051399">i</span><span class="op" id="3051400">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3051404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3051407">dir</span>&nbsp;<span class="op" id="3051411">:=</span>&nbsp;<span class="ident" id="3051414">Clean</span><span class="op" id="3051419">(</span><span class="ident" id="3051420">path</span><span class="op" id="3051424">[</span><span class="builtinfunc" id="3051425">len</span><span class="op" id="3051428">(</span><span class="ident" id="3051429">vol</span><span class="op" id="3051432">)</span>&nbsp;<span class="op" id="3051434">:</span>&nbsp;<span class="ident" id="3051436">i</span><span class="op" id="3051437">+</span><span class="num" id="3051438">1</span><span class="op" id="3051439">]</span><span class="op" id="3051440">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3051443">return</span>&nbsp;<span class="ident" id="3051450">vol</span>&nbsp;<span class="op" id="3051454">+</span>&nbsp;<span class="ident" id="3051456">dir</span><br>
<span class="lineno"></span><span class="op" id="3051460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3051463">//&nbsp;VolumeName&nbsp;returns&nbsp;leading&nbsp;volume&nbsp;name.</span><br>
<span class="lineno"></span><span class="comment" id="3051506">//&nbsp;Given&nbsp;&#34;C:\foo\bar&#34;&nbsp;it&nbsp;returns&nbsp;&#34;C:&#34;&nbsp;under&nbsp;windows.</span><br>
<span class="lineno">460</span><span class="comment" id="3051559">//&nbsp;Given&nbsp;&#34;\\host\share\foo&#34;&nbsp;it&nbsp;returns&nbsp;&#34;\\host\share&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3051614">//&nbsp;On&nbsp;other&nbsp;platforms&nbsp;it&nbsp;returns&nbsp;&#34;&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3051651">func</span>&nbsp;<span class="ident" id="3051656">VolumeName</span><span class="op" id="3051666">(</span><span class="ident" id="3051667">path</span>&nbsp;<span class="builtintype" id="3051672">string</span><span class="op" id="3051678">)</span>&nbsp;<span class="op" id="3051680">(</span><span class="ident" id="3051681">v</span>&nbsp;<span class="builtintype" id="3051683">string</span><span class="op" id="3051689">)</span>&nbsp;<span class="op" id="3051691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3051694">return</span>&nbsp;<span class="ident" id="3051701">path</span><span class="op" id="3051705">[</span><span class="op" id="3051706">:</span><span class="ident" id="3051707">volumeNameLen</span><span class="op" id="3051720">(</span><span class="ident" id="3051721">path</span><span class="op" id="3051725">)</span><span class="op" id="3051726">]</span><br>
<span class="lineno"></span><span class="op" id="3051728">}</span>
</div>
</body>
</html>
