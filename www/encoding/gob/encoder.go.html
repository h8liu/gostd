<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5915629">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5915684">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5915738">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5915789">package</span>&nbsp;<span class="ident" id="5915797">gob</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5915802">import</span>&nbsp;<span class="op" id="5915809">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5915812">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5915818">&#34;reflect&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5915829">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="5915836">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5915839">//&nbsp;An&nbsp;Encoder&nbsp;manages&nbsp;the&nbsp;transmission&nbsp;of&nbsp;type&nbsp;and&nbsp;data&nbsp;information&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5915914">//&nbsp;other&nbsp;side&nbsp;of&nbsp;a&nbsp;connection.</span><br>
<span class="lineno">15</span><span class="keyword" id="5915945">type</span>&nbsp;<span class="ident" id="5915950">Encoder</span>&nbsp;<span class="keyword" id="5915958">struct</span>&nbsp;<span class="op" id="5915965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915968">mutex</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5915979"><a href="/encoding/gob/encoder.go.html#5915829">sync</a></span><span class="op" id="5915983">.</span><span class="ident" id="5915984">Mutex</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5916003">//&nbsp;each&nbsp;item&nbsp;must&nbsp;be&nbsp;sent&nbsp;atomically</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916041">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5916052">[</span><span class="op" id="5916053">]</span><span class="ident" id="5916054"><a href="/encoding/gob/encoder.go.html#5915812">io</a></span><span class="op" id="5916056">.</span><span class="ident" id="5916057">Writer</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5916076">//&nbsp;where&nbsp;to&nbsp;send&nbsp;the&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916103">sent</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5916114">map</span><span class="op" id="5916117">[</span><span class="ident" id="5916118"><a href="/encoding/gob/encoder.go.html#5915818">reflect</a></span><span class="op" id="5916125">.</span><span class="ident" id="5916126">Type</span><span class="op" id="5916130">]</span><span class="ident" id="5916131"><a href="/encoding/gob/type.go.html#5930234">typeId</a></span>&nbsp;<span class="comment" id="5916138">//&nbsp;which&nbsp;types&nbsp;we&#39;ve&nbsp;already&nbsp;sent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916173">countState</span>&nbsp;<span class="op" id="5916184">*</span><span class="ident" id="5916185"><a href="/encoding/gob/encode.go.html#5895985">encoderState</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5916208">//&nbsp;stage&nbsp;for&nbsp;writing&nbsp;counts</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916237">freeList</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5916248">*</span><span class="ident" id="5916249"><a href="/encoding/gob/encode.go.html#5895985">encoderState</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5916272">//&nbsp;list&nbsp;of&nbsp;free&nbsp;encoderStates;&nbsp;avoids&nbsp;reallocation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916324">byteBuf</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5916335"><a href="/encoding/gob/encode.go.html#5896537">encBuffer</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5916359">//&nbsp;buffer&nbsp;for&nbsp;top-level&nbsp;encoderState</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916397">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5916408">error</span><br>
<span class="lineno"></span><span class="op" id="5916414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="5916417">//&nbsp;Before&nbsp;we&nbsp;encode&nbsp;a&nbsp;message,&nbsp;we&nbsp;reserve&nbsp;space&nbsp;at&nbsp;the&nbsp;head&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5916484">//&nbsp;buffer&nbsp;in&nbsp;which&nbsp;to&nbsp;encode&nbsp;its&nbsp;length.&nbsp;This&nbsp;means&nbsp;we&nbsp;can&nbsp;use&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5916551">//&nbsp;buffer&nbsp;to&nbsp;assemble&nbsp;the&nbsp;message&nbsp;without&nbsp;another&nbsp;allocation.</span><br>
<span class="lineno"></span><span class="keyword" id="5916613">const</span>&nbsp;<span class="ident" id="5916619">maxLength</span>&nbsp;<span class="op" id="5916629">=</span>&nbsp;<span class="num" id="5916631">9</span>&nbsp;<span class="comment" id="5916633">//&nbsp;Maximum&nbsp;size&nbsp;of&nbsp;an&nbsp;encoded&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="5916671">var</span>&nbsp;<span class="ident" id="5916675">spaceForLength</span>&nbsp;<span class="op" id="5916690">=</span>&nbsp;<span class="builtinfunc" id="5916692">make</span><span class="op" id="5916696">(</span><span class="op" id="5916697">[</span><span class="op" id="5916698">]</span><span class="builtintype" id="5916699">byte</span><span class="op" id="5916703">,</span>&nbsp;<span class="ident" id="5916705"><a href="/encoding/gob/encoder.go.html#5916619">maxLength</a></span><span class="op" id="5916714">)</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="5916717">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;encoder&nbsp;that&nbsp;will&nbsp;transmit&nbsp;on&nbsp;the&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="5916790">func</span>&nbsp;<span class="ident" id="5916795">NewEncoder</span><span class="op" id="5916805">(</span><span class="ident" id="5916806">w</span>&nbsp;<span class="ident" id="5916808"><a href="/encoding/gob/encoder.go.html#5915812">io</a></span><span class="op" id="5916810">.</span><span class="ident" id="5916811">Writer</span><span class="op" id="5916817">)</span>&nbsp;<span class="op" id="5916819">*</span><span class="ident" id="5916820"><a href="/encoding/gob/encoder.go.html#5915950">Encoder</a></span>&nbsp;<span class="op" id="5916828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916831">enc</span>&nbsp;<span class="op" id="5916835">:=</span>&nbsp;<span class="builtinfunc" id="5916838">new</span><span class="op" id="5916841">(</span><span class="ident" id="5916842"><a href="/encoding/gob/encoder.go.html#5915950">Encoder</a></span><span class="op" id="5916849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916852"><a href="/encoding/gob/encoder.go.html#5916831">enc</a></span><span class="op" id="5916855">.</span><span class="ident" id="5916856">w</span>&nbsp;<span class="op" id="5916858">=</span>&nbsp;<span class="op" id="5916860">[</span><span class="op" id="5916861">]</span><span class="ident" id="5916862"><a href="/encoding/gob/encoder.go.html#5915812">io</a></span><span class="op" id="5916864">.</span><span class="ident" id="5916865">Writer</span><span class="op" id="5916871">{</span><span class="ident" id="5916872"><a href="/encoding/gob/encoder.go.html#5916806">w</a></span><span class="op" id="5916873">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916876"><a href="/encoding/gob/encoder.go.html#5916831">enc</a></span><span class="op" id="5916879">.</span><span class="ident" id="5916880">sent</span>&nbsp;<span class="op" id="5916885">=</span>&nbsp;<span class="builtinfunc" id="5916887">make</span><span class="op" id="5916891">(</span><span class="keyword" id="5916892">map</span><span class="op" id="5916895">[</span><span class="ident" id="5916896"><a href="/encoding/gob/encoder.go.html#5915818">reflect</a></span><span class="op" id="5916903">.</span><span class="ident" id="5916904">Type</span><span class="op" id="5916908">]</span><span class="ident" id="5916909"><a href="/encoding/gob/type.go.html#5930234">typeId</a></span><span class="op" id="5916915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916918"><a href="/encoding/gob/encoder.go.html#5916831">enc</a></span><span class="op" id="5916921">.</span><span class="ident" id="5916922">countState</span>&nbsp;<span class="op" id="5916933">=</span>&nbsp;<span class="ident" id="5916935"><a href="/encoding/gob/encoder.go.html#5916831">enc</a></span><span class="op" id="5916938">.</span><span class="ident" id="5916939">newEncoderState</span><span class="op" id="5916954">(</span><span class="builtinfunc" id="5916955">new</span><span class="op" id="5916958">(</span><span class="ident" id="5916959"><a href="/encoding/gob/encode.go.html#5896537">encBuffer</a></span><span class="op" id="5916968">)</span><span class="op" id="5916969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916972">return</span>&nbsp;<span class="ident" id="5916979"><a href="/encoding/gob/encoder.go.html#5916831">enc</a></span><br>
<span class="lineno"></span><span class="op" id="5916983">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="5916986">//&nbsp;writer()&nbsp;returns&nbsp;the&nbsp;innermost&nbsp;writer&nbsp;the&nbsp;encoder&nbsp;is&nbsp;using</span><br>
<span class="lineno"></span><span class="keyword" id="5917048">func</span>&nbsp;<span class="op" id="5917053">(</span><span class="ident" id="5917054">enc</span>&nbsp;<span class="op" id="5917058">*</span><span class="ident" id="5917059"><a href="/encoding/gob/encoder.go.html#5915950">Encoder</a></span><span class="op" id="5917066">)</span>&nbsp;<span class="ident" id="5917068">writer</span><span class="op" id="5917074">(</span><span class="op" id="5917075">)</span>&nbsp;<span class="ident" id="5917077"><a href="/encoding/gob/encoder.go.html#5915812">io</a></span><span class="op" id="5917079">.</span><span class="ident" id="5917080">Writer</span>&nbsp;<span class="op" id="5917087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917090">return</span>&nbsp;<span class="ident" id="5917097"><a href="/encoding/gob/encoder.go.html#5917054">enc</a></span><span class="op" id="5917100">.</span><span class="ident" id="5917101">w</span><span class="op" id="5917102">[</span><span class="builtinfunc" id="5917103">len</span><span class="op" id="5917106">(</span><span class="ident" id="5917107"><a href="/encoding/gob/encoder.go.html#5917054">enc</a></span><span class="op" id="5917110">.</span><span class="ident" id="5917111">w</span><span class="op" id="5917112">)</span><span class="op" id="5917113">-</span><span class="num" id="5917114">1</span><span class="op" id="5917115">]</span><br>
<span class="lineno"></span><span class="op" id="5917117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="5917120">//&nbsp;pushWriter&nbsp;adds&nbsp;a&nbsp;writer&nbsp;to&nbsp;the&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="keyword" id="5917164">func</span>&nbsp;<span class="op" id="5917169">(</span><span class="ident" id="5917170">enc</span>&nbsp;<span class="op" id="5917174">*</span><span class="ident" id="5917175"><a href="/encoding/gob/encoder.go.html#5915950">Encoder</a></span><span class="op" id="5917182">)</span>&nbsp;<span class="ident" id="5917184">pushWriter</span><span class="op" id="5917194">(</span><span class="ident" id="5917195">w</span>&nbsp;<span class="ident" id="5917197"><a href="/encoding/gob/encoder.go.html#5915812">io</a></span><span class="op" id="5917199">.</span><span class="ident" id="5917200">Writer</span><span class="op" id="5917206">)</span>&nbsp;<span class="op" id="5917208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917211"><a href="/encoding/gob/encoder.go.html#5917170">enc</a></span><span class="op" id="5917214">.</span><span class="ident" id="5917215">w</span>&nbsp;<span class="op" id="5917217">=</span>&nbsp;<span class="builtinfunc" id="5917219">append</span><span class="op" id="5917225">(</span><span class="ident" id="5917226"><a href="/encoding/gob/encoder.go.html#5917170">enc</a></span><span class="op" id="5917229">.</span><span class="ident" id="5917230">w</span><span class="op" id="5917231">,</span>&nbsp;<span class="ident" id="5917233"><a href="/encoding/gob/encoder.go.html#5917195">w</a></span><span class="op" id="5917234">)</span><br>
<span class="lineno"></span><span class="op" id="5917236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="5917239">//&nbsp;popWriter&nbsp;pops&nbsp;the&nbsp;innermost&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="5917279">func</span>&nbsp;<span class="op" id="5917284">(</span><span class="ident" id="5917285">enc</span>&nbsp;<span class="op" id="5917289">*</span><span class="ident" id="5917290"><a href="/encoding/gob/encoder.go.html#5915950">Encoder</a></span><span class="op" id="5917297">)</span>&nbsp;<span class="ident" id="5917299">popWriter</span><span class="op" id="5917308">(</span><span class="op" id="5917309">)</span>&nbsp;<span class="op" id="5917311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917314"><a href="/encoding/gob/encoder.go.html#5917285">enc</a></span><span class="op" id="5917317">.</span><span class="ident" id="5917318">w</span>&nbsp;<span class="op" id="5917320">=</span>&nbsp;<span class="ident" id="5917322"><a href="/encoding/gob/encoder.go.html#5917285">enc</a></span><span class="op" id="5917325">.</span><span class="ident" id="5917326">w</span><span class="op" id="5917327">[</span><span class="num" id="5917328">0</span>&nbsp;<span class="op" id="5917330">:</span>&nbsp;<span class="builtinfunc" id="5917332">len</span><span class="op" id="5917335">(</span><span class="ident" id="5917336"><a href="/encoding/gob/encoder.go.html#5917285">enc</a></span><span class="op" id="5917339">.</span><span class="ident" id="5917340">w</span><span class="op" id="5917341">)</span><span class="op" id="5917342">-</span><span class="num" id="5917343">1</span><span class="op" id="5917344">]</span><br>
<span class="lineno"></span><span class="op" id="5917346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="5917349">func</span>&nbsp;<span class="op" id="5917354">(</span><span class="ident" id="5917355">enc</span>&nbsp;<span class="op" id="5917359">*</span><span class="ident" id="5917360"><a href="/encoding/gob/encoder.go.html#5915950">Encoder</a></span><span class="op" id="5917367">)</span>&nbsp;<span class="ident" id="5917369">setError</span><span class="op" id="5917377">(</span><span class="ident" id="5917378">err</span>&nbsp;<span class="builtintype" id="5917382">error</span><span class="op" id="5917387">)</span>&nbsp;<span class="op" id="5917389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917392">if</span>&nbsp;<span class="ident" id="5917395"><a href="/encoding/gob/encoder.go.html#5917355">enc</a></span><span class="op" id="5917398">.</span><span class="ident" id="5917399">err</span>&nbsp;<span class="op" id="5917403">==</span>&nbsp;<span class="ident" id="5917406">nil</span>&nbsp;<span class="op" id="5917410">{</span>&nbsp;<span class="comment" id="5917412">//&nbsp;remember&nbsp;the&nbsp;first.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917437"><a href="/encoding/gob/encoder.go.html#5917355">enc</a></span><span class="op" id="5917440">.</span><span class="ident" id="5917441">err</span>&nbsp;<span class="op" id="5917445">=</span>&nbsp;<span class="ident" id="5917447"><a href="/encoding/gob/encoder.go.html#5917378">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5917452">}</span><br>
<span class="lineno"></span><span class="op" id="5917454">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="5917457">//&nbsp;writeMessage&nbsp;sends&nbsp;the&nbsp;data&nbsp;item&nbsp;preceded&nbsp;by&nbsp;a&nbsp;unsigned&nbsp;count&nbsp;of&nbsp;its&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="5917537">func</span>&nbsp;<span class="op" id="5917542">(</span><span class="ident" id="5917543">enc</span>&nbsp;<span class="op" id="5917547">*</span><span class="ident" id="5917548"><a href="/encoding/gob/encoder.go.html#5915950">Encoder</a></span><span class="op" id="5917555">)</span>&nbsp;<span class="ident" id="5917557">writeMessage</span><span class="op" id="5917569">(</span><span class="ident" id="5917570">w</span>&nbsp;<span class="ident" id="5917572"><a href="/encoding/gob/encoder.go.html#5915812">io</a></span><span class="op" id="5917574">.</span><span class="ident" id="5917575">Writer</span><span class="op" id="5917581">,</span>&nbsp;<span class="ident" id="5917583">b</span>&nbsp;<span class="op" id="5917585">*</span><span class="ident" id="5917586"><a href="/encoding/gob/encode.go.html#5896537">encBuffer</a></span><span class="op" id="5917595">)</span>&nbsp;<span class="op" id="5917597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5917600">//&nbsp;Space&nbsp;has&nbsp;been&nbsp;reserved&nbsp;for&nbsp;the&nbsp;length&nbsp;at&nbsp;the&nbsp;head&nbsp;of&nbsp;the&nbsp;message.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5917671">//&nbsp;This&nbsp;is&nbsp;a&nbsp;little&nbsp;dirty:&nbsp;we&nbsp;grab&nbsp;the&nbsp;slice&nbsp;from&nbsp;the&nbsp;bytes.Buffer&nbsp;and&nbsp;massage</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5917751">//&nbsp;it&nbsp;by&nbsp;hand.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917767">message</span>&nbsp;<span class="op" id="5917775">:=</span>&nbsp;<span class="ident" id="5917778"><a href="/encoding/gob/encoder.go.html#5917583">b</a></span><span class="op" id="5917779">.</span><span class="ident" id="5917780">Bytes</span><span class="op" id="5917785">(</span><span class="op" id="5917786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917789">messageLen</span>&nbsp;<span class="op" id="5917800">:=</span>&nbsp;<span class="builtinfunc" id="5917803">len</span><span class="op" id="5917806">(</span><span class="ident" id="5917807"><a href="/encoding/gob/encoder.go.html#5917767">message</a></span><span class="op" id="5917814">)</span>&nbsp;<span class="op" id="5917816">-</span>&nbsp;<span class="ident" id="5917818"><a href="/encoding/gob/encoder.go.html#5916619">maxLength</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5917829">//&nbsp;Encode&nbsp;the&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917852"><a href="/encoding/gob/encoder.go.html#5917543">enc</a></span><span class="op" id="5917855">.</span><span class="ident" id="5917856">countState</span><span class="op" id="5917866">.</span><span class="ident" id="5917867">b</span><span class="op" id="5917868">.</span><span class="ident" id="5917869">Reset</span><span class="op" id="5917874">(</span><span class="op" id="5917875">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917878"><a href="/encoding/gob/encoder.go.html#5917543">enc</a></span><span class="op" id="5917881">.</span><span class="ident" id="5917882">countState</span><span class="op" id="5917892">.</span><span class="ident" id="5917893">encodeUint</span><span class="op" id="5917903">(</span><span class="ident" id="5917904">uint64</span><span class="op" id="5917910">(</span><span class="ident" id="5917911"><a href="/encoding/gob/encoder.go.html#5917789">messageLen</a></span><span class="op" id="5917921">)</span><span class="op" id="5917922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5917925">//&nbsp;Copy&nbsp;the&nbsp;length&nbsp;to&nbsp;be&nbsp;a&nbsp;prefix&nbsp;of&nbsp;the&nbsp;message.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917976">offset</span>&nbsp;<span class="op" id="5917983">:=</span>&nbsp;<span class="ident" id="5917986"><a href="/encoding/gob/encoder.go.html#5916619">maxLength</a></span>&nbsp;<span class="op" id="5917996">-</span>&nbsp;<span class="ident" id="5917998"><a href="/encoding/gob/encoder.go.html#5917543">enc</a></span><span class="op" id="5918001">.</span><span class="ident" id="5918002">countState</span><span class="op" id="5918012">.</span><span class="ident" id="5918013">b</span><span class="op" id="5918014">.</span><span class="ident" id="5918015">Len</span><span class="op" id="5918018">(</span><span class="op" id="5918019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5918022">copy</span><span class="op" id="5918026">(</span><span class="ident" id="5918027"><a href="/encoding/gob/encoder.go.html#5917767">message</a></span><span class="op" id="5918034">[</span><span class="ident" id="5918035"><a href="/encoding/gob/encoder.go.html#5917976">offset</a></span><span class="op" id="5918041">:</span><span class="op" id="5918042">]</span><span class="op" id="5918043">,</span>&nbsp;<span class="ident" id="5918045"><a href="/encoding/gob/encoder.go.html#5917543">enc</a></span><span class="op" id="5918048">.</span><span class="ident" id="5918049">countState</span><span class="op" id="5918059">.</span><span class="ident" id="5918060">b</span><span class="op" id="5918061">.</span><span class="ident" id="5918062">Bytes</span><span class="op" id="5918067">(</span><span class="op" id="5918068">)</span><span class="op" id="5918069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5918072">//&nbsp;Write&nbsp;the&nbsp;data.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918092">_</span><span class="op" id="5918093">,</span>&nbsp;<span class="ident" id="5918095">err</span>&nbsp;<span class="op" id="5918099">:=</span>&nbsp;<span class="ident" id="5918102"><a href="/encoding/gob/encoder.go.html#5917570">w</a></span><span class="op" id="5918103">.</span><span class="ident" id="5918104">Write</span><span class="op" id="5918109">(</span><span class="ident" id="5918110"><a href="/encoding/gob/encoder.go.html#5917767">message</a></span><span class="op" id="5918117">[</span><span class="ident" id="5918118"><a href="/encoding/gob/encoder.go.html#5917976">offset</a></span><span class="op" id="5918124">:</span><span class="op" id="5918125">]</span><span class="op" id="5918126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5918129">//&nbsp;Drain&nbsp;the&nbsp;buffer&nbsp;and&nbsp;restore&nbsp;the&nbsp;space&nbsp;at&nbsp;the&nbsp;front&nbsp;for&nbsp;the&nbsp;count&nbsp;of&nbsp;the&nbsp;next&nbsp;message.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918220"><a href="/encoding/gob/encoder.go.html#5917583">b</a></span><span class="op" id="5918221">.</span><span class="ident" id="5918222">Reset</span><span class="op" id="5918227">(</span><span class="op" id="5918228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918231"><a href="/encoding/gob/encoder.go.html#5917583">b</a></span><span class="op" id="5918232">.</span><span class="ident" id="5918233">Write</span><span class="op" id="5918238">(</span><span class="ident" id="5918239"><a href="/encoding/gob/encoder.go.html#5916675">spaceForLength</a></span><span class="op" id="5918253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918256">if</span>&nbsp;<span class="ident" id="5918259"><a href="/encoding/gob/encoder.go.html#5918095">err</a></span>&nbsp;<span class="op" id="5918263">!=</span>&nbsp;<span class="ident" id="5918266">nil</span>&nbsp;<span class="op" id="5918270">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918274"><a href="/encoding/gob/encoder.go.html#5917543">enc</a></span><span class="op" id="5918277">.</span><span class="ident" id="5918278">setError</span><span class="op" id="5918286">(</span><span class="ident" id="5918287"><a href="/encoding/gob/encoder.go.html#5918095">err</a></span><span class="op" id="5918290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918293">}</span><br>
<span class="lineno"></span><span class="op" id="5918295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5918298">//&nbsp;sendActualType&nbsp;sends&nbsp;the&nbsp;requested&nbsp;type,&nbsp;without&nbsp;further&nbsp;investigation,&nbsp;unless</span><br>
<span class="lineno">85</span><span class="comment" id="5918380">//&nbsp;it&#39;s&nbsp;been&nbsp;sent&nbsp;before.</span><br>
<span class="lineno"></span><span class="keyword" id="5918406">func</span>&nbsp;<span class="op" id="5918411">(</span><span class="ident" id="5918412">enc</span>&nbsp;<span class="op" id="5918416">*</span><span class="ident" id="5918417"><a href="/encoding/gob/encoder.go.html#5915950">Encoder</a></span><span class="op" id="5918424">)</span>&nbsp;<span class="ident" id="5918426">sendActualType</span><span class="op" id="5918440">(</span><span class="ident" id="5918441">w</span>&nbsp;<span class="ident" id="5918443"><a href="/encoding/gob/encoder.go.html#5915812">io</a></span><span class="op" id="5918445">.</span><span class="ident" id="5918446">Writer</span><span class="op" id="5918452">,</span>&nbsp;<span class="ident" id="5918454">state</span>&nbsp;<span class="op" id="5918460">*</span><span class="ident" id="5918461"><a href="/encoding/gob/encode.go.html#5895985">encoderState</a></span><span class="op" id="5918473">,</span>&nbsp;<span class="ident" id="5918475">ut</span>&nbsp;<span class="op" id="5918478">*</span><span class="ident" id="5918479"><a href="/encoding/gob/type.go.html#5925033">userTypeInfo</a></span><span class="op" id="5918491">,</span>&nbsp;<span class="ident" id="5918493">actual</span>&nbsp;<span class="ident" id="5918500"><a href="/encoding/gob/encoder.go.html#5915818">reflect</a></span><span class="op" id="5918507">.</span><span class="ident" id="5918508">Type</span><span class="op" id="5918512">)</span>&nbsp;<span class="op" id="5918514">(</span><span class="ident" id="5918515">sent</span>&nbsp;<span class="builtintype" id="5918520">bool</span><span class="op" id="5918524">)</span>&nbsp;<span class="op" id="5918526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918529">if</span>&nbsp;<span class="ident" id="5918532">_</span><span class="op" id="5918533">,</span>&nbsp;<span class="ident" id="5918535">alreadySent</span>&nbsp;<span class="op" id="5918547">:=</span>&nbsp;<span class="ident" id="5918550"><a href="/encoding/gob/encoder.go.html#5918412">enc</a></span><span class="op" id="5918553">.</span><span class="ident" id="5918554">sent</span><span class="op" id="5918558">[</span><span class="ident" id="5918559"><a href="/encoding/gob/encoder.go.html#5918493">actual</a></span><span class="op" id="5918565">]</span><span class="op" id="5918566">;</span>&nbsp;<span class="ident" id="5918568"><a href="/encoding/gob/encoder.go.html#5918535">alreadySent</a></span>&nbsp;<span class="op" id="5918580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918584">return</span>&nbsp;<span class="builtintype" id="5918591">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918598">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918601">info</span><span class="op" id="5918605">,</span>&nbsp;<span class="ident" id="5918607">err</span>&nbsp;<span class="op" id="5918611">:=</span>&nbsp;<span class="ident" id="5918614"><a href="/encoding/gob/type.go.html#5945303">getTypeInfo</a></span><span class="op" id="5918625">(</span><span class="ident" id="5918626"><a href="/encoding/gob/encoder.go.html#5918475">ut</a></span><span class="op" id="5918628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918631">if</span>&nbsp;<span class="ident" id="5918634"><a href="/encoding/gob/encoder.go.html#5918607">err</a></span>&nbsp;<span class="op" id="5918638">!=</span>&nbsp;<span class="ident" id="5918641">nil</span>&nbsp;<span class="op" id="5918645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918649"><a href="/encoding/gob/encoder.go.html#5918412">enc</a></span><span class="op" id="5918652">.</span><span class="ident" id="5918653">setError</span><span class="op" id="5918661">(</span><span class="ident" id="5918662"><a href="/encoding/gob/encoder.go.html#5918607">err</a></span><span class="op" id="5918665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918669">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918677">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5918680">//&nbsp;Send&nbsp;the&nbsp;pair&nbsp;(-id,&nbsp;type)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5918710">//&nbsp;Id:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918718"><a href="/encoding/gob/encoder.go.html#5918454">state</a></span><span class="op" id="5918723">.</span><span class="ident" id="5918724">encodeInt</span><span class="op" id="5918733">(</span><span class="op" id="5918734">-</span><span class="ident" id="5918735">int64</span><span class="op" id="5918740">(</span><span class="ident" id="5918741"><a href="/encoding/gob/encoder.go.html#5918601">info</a></span><span class="op" id="5918745">.</span><span class="ident" id="5918746">id</span><span class="op" id="5918748">)</span><span class="op" id="5918749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5918752">//&nbsp;Type:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918762"><a href="/encoding/gob/encoder.go.html#5918412">enc</a></span><span class="op" id="5918765">.</span><span class="ident" id="5918766">encode</span><span class="op" id="5918772">(</span><span class="ident" id="5918773"><a href="/encoding/gob/encoder.go.html#5918454">state</a></span><span class="op" id="5918778">.</span><span class="ident" id="5918779">b</span><span class="op" id="5918780">,</span>&nbsp;<span class="ident" id="5918782"><a href="/encoding/gob/encoder.go.html#5915818">reflect</a></span><span class="op" id="5918789">.</span><span class="ident" id="5918790">ValueOf</span><span class="op" id="5918797">(</span><span class="ident" id="5918798"><a href="/encoding/gob/encoder.go.html#5918601">info</a></span><span class="op" id="5918802">.</span><span class="ident" id="5918803">wire</span><span class="op" id="5918807">)</span><span class="op" id="5918808">,</span>&nbsp;<span class="ident" id="5918810"><a href="/encoding/gob/type.go.html#5933392">wireTypeUserInfo</a></span><span class="op" id="5918826">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918829"><a href="/encoding/gob/encoder.go.html#5918412">enc</a></span><span class="op" id="5918832">.</span><span class="ident" id="5918833">writeMessage</span><span class="op" id="5918845">(</span><span class="ident" id="5918846"><a href="/encoding/gob/encoder.go.html#5918441">w</a></span><span class="op" id="5918847">,</span>&nbsp;<span class="ident" id="5918849"><a href="/encoding/gob/encoder.go.html#5918454">state</a></span><span class="op" id="5918854">.</span><span class="ident" id="5918855">b</span><span class="op" id="5918856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918859">if</span>&nbsp;<span class="ident" id="5918862"><a href="/encoding/gob/encoder.go.html#5918412">enc</a></span><span class="op" id="5918865">.</span><span class="ident" id="5918866">err</span>&nbsp;<span class="op" id="5918870">!=</span>&nbsp;<span class="ident" id="5918873">nil</span>&nbsp;<span class="op" id="5918877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918881">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918889">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5918893">//&nbsp;Remember&nbsp;we&#39;ve&nbsp;sent&nbsp;this&nbsp;type,&nbsp;both&nbsp;what&nbsp;the&nbsp;user&nbsp;gave&nbsp;us&nbsp;and&nbsp;the&nbsp;base&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918974"><a href="/encoding/gob/encoder.go.html#5918412">enc</a></span><span class="op" id="5918977">.</span><span class="ident" id="5918978">sent</span><span class="op" id="5918982">[</span><span class="ident" id="5918983"><a href="/encoding/gob/encoder.go.html#5918475">ut</a></span><span class="op" id="5918985">.</span><span class="ident" id="5918986">base</span><span class="op" id="5918990">]</span>&nbsp;<span class="op" id="5918992">=</span>&nbsp;<span class="ident" id="5918994"><a href="/encoding/gob/encoder.go.html#5918601">info</a></span><span class="op" id="5918998">.</span><span class="ident" id="5918999">id</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919003">if</span>&nbsp;<span class="ident" id="5919006"><a href="/encoding/gob/encoder.go.html#5918475">ut</a></span><span class="op" id="5919008">.</span><span class="ident" id="5919009">user</span>&nbsp;<span class="op" id="5919014">!=</span>&nbsp;<span class="ident" id="5919017"><a href="/encoding/gob/encoder.go.html#5918475">ut</a></span><span class="op" id="5919019">.</span><span class="ident" id="5919020">base</span>&nbsp;<span class="op" id="5919025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919029"><a href="/encoding/gob/encoder.go.html#5918412">enc</a></span><span class="op" id="5919032">.</span><span class="ident" id="5919033">sent</span><span class="op" id="5919037">[</span><span class="ident" id="5919038"><a href="/encoding/gob/encoder.go.html#5918475">ut</a></span><span class="op" id="5919040">.</span><span class="ident" id="5919041">user</span><span class="op" id="5919045">]</span>&nbsp;<span class="op" id="5919047">=</span>&nbsp;<span class="ident" id="5919049"><a href="/encoding/gob/encoder.go.html#5918601">info</a></span><span class="op" id="5919053">.</span><span class="ident" id="5919054">id</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5919058">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919061">//&nbsp;Now&nbsp;send&nbsp;the&nbsp;inner&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919090">switch</span>&nbsp;<span class="ident" id="5919097">st</span>&nbsp;<span class="op" id="5919100">:=</span>&nbsp;<span class="ident" id="5919103"><a href="/encoding/gob/encoder.go.html#5918493">actual</a></span><span class="op" id="5919109">;</span>&nbsp;<span class="ident" id="5919111"><a href="/encoding/gob/encoder.go.html#5919097">st</a></span><span class="op" id="5919113">.</span><span class="ident" id="5919114">Kind</span><span class="op" id="5919118">(</span><span class="op" id="5919119">)</span>&nbsp;<span class="op" id="5919121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919124">case</span>&nbsp;<span class="ident" id="5919129"><a href="/encoding/gob/encoder.go.html#5915818">reflect</a></span><span class="op" id="5919136">.</span><span class="ident" id="5919137">Struct</span><span class="op" id="5919143">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919147">for</span>&nbsp;<span class="ident" id="5919151">i</span>&nbsp;<span class="op" id="5919153">:=</span>&nbsp;<span class="num" id="5919156">0</span><span class="op" id="5919157">;</span>&nbsp;<span class="ident" id="5919159"><a href="/encoding/gob/encoder.go.html#5919151">i</a></span>&nbsp;<span class="op" id="5919161">&lt;</span>&nbsp;<span class="ident" id="5919163"><a href="/encoding/gob/encoder.go.html#5919097">st</a></span><span class="op" id="5919165">.</span><span class="ident" id="5919166">NumField</span><span class="op" id="5919174">(</span><span class="op" id="5919175">)</span><span class="op" id="5919176">;</span>&nbsp;<span class="ident" id="5919178"><a href="/encoding/gob/encoder.go.html#5919151">i</a></span><span class="op" id="5919179">++</span>&nbsp;<span class="op" id="5919182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919187">if</span>&nbsp;<span class="ident" id="5919190"><a href="/encoding/gob/type.go.html#5941098">isExported</a></span><span class="op" id="5919200">(</span><span class="ident" id="5919201"><a href="/encoding/gob/encoder.go.html#5919097">st</a></span><span class="op" id="5919203">.</span><span class="ident" id="5919204">Field</span><span class="op" id="5919209">(</span><span class="ident" id="5919210"><a href="/encoding/gob/encoder.go.html#5919151">i</a></span><span class="op" id="5919211">)</span><span class="op" id="5919212">.</span><span class="ident" id="5919213">Name</span><span class="op" id="5919217">)</span>&nbsp;<span class="op" id="5919219">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919225"><a href="/encoding/gob/encoder.go.html#5918412">enc</a></span><span class="op" id="5919228">.</span><span class="ident" id="5919229">sendType</span><span class="op" id="5919237">(</span><span class="ident" id="5919238"><a href="/encoding/gob/encoder.go.html#5918441">w</a></span><span class="op" id="5919239">,</span>&nbsp;<span class="ident" id="5919241"><a href="/encoding/gob/encoder.go.html#5918454">state</a></span><span class="op" id="5919246">,</span>&nbsp;<span class="ident" id="5919248"><a href="/encoding/gob/encoder.go.html#5919097">st</a></span><span class="op" id="5919250">.</span><span class="ident" id="5919251">Field</span><span class="op" id="5919256">(</span><span class="ident" id="5919257"><a href="/encoding/gob/encoder.go.html#5919151">i</a></span><span class="op" id="5919258">)</span><span class="op" id="5919259">.</span><span class="ident" id="5919260">Type</span><span class="op" id="5919264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5919269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5919273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919276">case</span>&nbsp;<span class="ident" id="5919281"><a href="/encoding/gob/encoder.go.html#5915818">reflect</a></span><span class="op" id="5919288">.</span><span class="ident" id="5919289">Array</span><span class="op" id="5919294">,</span>&nbsp;<span class="ident" id="5919296"><a href="/encoding/gob/encoder.go.html#5915818">reflect</a></span><span class="op" id="5919303">.</span><span class="ident" id="5919304">Slice</span><span class="op" id="5919309">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919313"><a href="/encoding/gob/encoder.go.html#5918412">enc</a></span><span class="op" id="5919316">.</span><span class="ident" id="5919317">sendType</span><span class="op" id="5919325">(</span><span class="ident" id="5919326"><a href="/encoding/gob/encoder.go.html#5918441">w</a></span><span class="op" id="5919327">,</span>&nbsp;<span class="ident" id="5919329"><a href="/encoding/gob/encoder.go.html#5918454">state</a></span><span class="op" id="5919334">,</span>&nbsp;<span class="ident" id="5919336"><a href="/encoding/gob/encoder.go.html#5919097">st</a></span><span class="op" id="5919338">.</span><span class="ident" id="5919339">Elem</span><span class="op" id="5919343">(</span><span class="op" id="5919344">)</span><span class="op" id="5919345">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919348">case</span>&nbsp;<span class="ident" id="5919353"><a href="/encoding/gob/encoder.go.html#5915818">reflect</a></span><span class="op" id="5919360">.</span><span class="ident" id="5919361">Map</span><span class="op" id="5919364">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919368"><a href="/encoding/gob/encoder.go.html#5918412">enc</a></span><span class="op" id="5919371">.</span><span class="ident" id="5919372">sendType</span><span class="op" id="5919380">(</span><span class="ident" id="5919381"><a href="/encoding/gob/encoder.go.html#5918441">w</a></span><span class="op" id="5919382">,</span>&nbsp;<span class="ident" id="5919384"><a href="/encoding/gob/encoder.go.html#5918454">state</a></span><span class="op" id="5919389">,</span>&nbsp;<span class="ident" id="5919391"><a href="/encoding/gob/encoder.go.html#5919097">st</a></span><span class="op" id="5919393">.</span><span class="ident" id="5919394">Key</span><span class="op" id="5919397">(</span><span class="op" id="5919398">)</span><span class="op" id="5919399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919403"><a href="/encoding/gob/encoder.go.html#5918412">enc</a></span><span class="op" id="5919406">.</span><span class="ident" id="5919407">sendType</span><span class="op" id="5919415">(</span><span class="ident" id="5919416"><a href="/encoding/gob/encoder.go.html#5918441">w</a></span><span class="op" id="5919417">,</span>&nbsp;<span class="ident" id="5919419"><a href="/encoding/gob/encoder.go.html#5918454">state</a></span><span class="op" id="5919424">,</span>&nbsp;<span class="ident" id="5919426"><a href="/encoding/gob/encoder.go.html#5919097">st</a></span><span class="op" id="5919428">.</span><span class="ident" id="5919429">Elem</span><span class="op" id="5919433">(</span><span class="op" id="5919434">)</span><span class="op" id="5919435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5919438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919441">return</span>&nbsp;<span class="builtintype" id="5919448">true</span><br>
<span class="lineno">125</span><span class="op" id="5919453">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5919456">//&nbsp;sendType&nbsp;sends&nbsp;the&nbsp;type&nbsp;info&nbsp;to&nbsp;the&nbsp;other&nbsp;side,&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="keyword" id="5919521">func</span>&nbsp;<span class="op" id="5919526">(</span><span class="ident" id="5919527">enc</span>&nbsp;<span class="op" id="5919531">*</span><span class="ident" id="5919532"><a href="/encoding/gob/encoder.go.html#5915950">Encoder</a></span><span class="op" id="5919539">)</span>&nbsp;<span class="ident" id="5919541">sendType</span><span class="op" id="5919549">(</span><span class="ident" id="5919550">w</span>&nbsp;<span class="ident" id="5919552"><a href="/encoding/gob/encoder.go.html#5915812">io</a></span><span class="op" id="5919554">.</span><span class="ident" id="5919555">Writer</span><span class="op" id="5919561">,</span>&nbsp;<span class="ident" id="5919563">state</span>&nbsp;<span class="op" id="5919569">*</span><span class="ident" id="5919570"><a href="/encoding/gob/encode.go.html#5895985">encoderState</a></span><span class="op" id="5919582">,</span>&nbsp;<span class="ident" id="5919584">origt</span>&nbsp;<span class="ident" id="5919590"><a href="/encoding/gob/encoder.go.html#5915818">reflect</a></span><span class="op" id="5919597">.</span><span class="ident" id="5919598">Type</span><span class="op" id="5919602">)</span>&nbsp;<span class="op" id="5919604">(</span><span class="ident" id="5919605">sent</span>&nbsp;<span class="builtintype" id="5919610">bool</span><span class="op" id="5919614">)</span>&nbsp;<span class="op" id="5919616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919619">ut</span>&nbsp;<span class="op" id="5919622">:=</span>&nbsp;<span class="ident" id="5919625"><a href="/encoding/gob/type.go.html#5929943">userType</a></span><span class="op" id="5919633">(</span><span class="ident" id="5919634"><a href="/encoding/gob/encoder.go.html#5919584">origt</a></span><span class="op" id="5919639">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919642">if</span>&nbsp;<span class="ident" id="5919645"><a href="/encoding/gob/encoder.go.html#5919619">ut</a></span><span class="op" id="5919647">.</span><span class="ident" id="5919648">externalEnc</span>&nbsp;<span class="op" id="5919660">!=</span>&nbsp;<span class="num" id="5919663">0</span>&nbsp;<span class="op" id="5919665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919669">//&nbsp;The&nbsp;rules&nbsp;are&nbsp;different:&nbsp;regardless&nbsp;of&nbsp;the&nbsp;underlying&nbsp;type&#39;s&nbsp;representation,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919751">//&nbsp;we&nbsp;need&nbsp;to&nbsp;tell&nbsp;the&nbsp;other&nbsp;side&nbsp;that&nbsp;the&nbsp;base&nbsp;type&nbsp;is&nbsp;a&nbsp;GobEncoder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919823">return</span>&nbsp;<span class="ident" id="5919830"><a href="/encoding/gob/encoder.go.html#5919527">enc</a></span><span class="op" id="5919833">.</span><span class="ident" id="5919834">sendActualType</span><span class="op" id="5919848">(</span><span class="ident" id="5919849"><a href="/encoding/gob/encoder.go.html#5919550">w</a></span><span class="op" id="5919850">,</span>&nbsp;<span class="ident" id="5919852"><a href="/encoding/gob/encoder.go.html#5919563">state</a></span><span class="op" id="5919857">,</span>&nbsp;<span class="ident" id="5919859"><a href="/encoding/gob/encoder.go.html#5919619">ut</a></span><span class="op" id="5919861">,</span>&nbsp;<span class="ident" id="5919863"><a href="/encoding/gob/encoder.go.html#5919619">ut</a></span><span class="op" id="5919865">.</span><span class="ident" id="5919866">base</span><span class="op" id="5919870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5919873">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919877">//&nbsp;It&#39;s&nbsp;a&nbsp;concrete&nbsp;value,&nbsp;so&nbsp;drill&nbsp;down&nbsp;to&nbsp;the&nbsp;base&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919936">switch</span>&nbsp;<span class="ident" id="5919943">rt</span>&nbsp;<span class="op" id="5919946">:=</span>&nbsp;<span class="ident" id="5919949"><a href="/encoding/gob/encoder.go.html#5919619">ut</a></span><span class="op" id="5919951">.</span><span class="ident" id="5919952">base</span><span class="op" id="5919956">;</span>&nbsp;<span class="ident" id="5919958"><a href="/encoding/gob/encoder.go.html#5919943">rt</a></span><span class="op" id="5919960">.</span><span class="ident" id="5919961">Kind</span><span class="op" id="5919965">(</span><span class="op" id="5919966">)</span>&nbsp;<span class="op" id="5919968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919971">default</span><span class="op" id="5919978">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919982">//&nbsp;Basic&nbsp;types&nbsp;and&nbsp;interfaces&nbsp;do&nbsp;not&nbsp;need&nbsp;to&nbsp;be&nbsp;described.</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920043">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920051">case</span>&nbsp;<span class="ident" id="5920056"><a href="/encoding/gob/encoder.go.html#5915818">reflect</a></span><span class="op" id="5920063">.</span><span class="ident" id="5920064">Slice</span><span class="op" id="5920069">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5920073">//&nbsp;If&nbsp;it&#39;s&nbsp;[]uint8,&nbsp;don&#39;t&nbsp;send;&nbsp;it&#39;s&nbsp;considered&nbsp;basic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920130">if</span>&nbsp;<span class="ident" id="5920133"><a href="/encoding/gob/encoder.go.html#5919943">rt</a></span><span class="op" id="5920135">.</span><span class="ident" id="5920136">Elem</span><span class="op" id="5920140">(</span><span class="op" id="5920141">)</span><span class="op" id="5920142">.</span><span class="ident" id="5920143">Kind</span><span class="op" id="5920147">(</span><span class="op" id="5920148">)</span>&nbsp;<span class="op" id="5920150">==</span>&nbsp;<span class="ident" id="5920153"><a href="/encoding/gob/encoder.go.html#5915818">reflect</a></span><span class="op" id="5920160">.</span><span class="ident" id="5920161">Uint8</span>&nbsp;<span class="op" id="5920167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920172">return</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5920181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5920185">//&nbsp;Otherwise&nbsp;we&nbsp;do&nbsp;send.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920212">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920219">case</span>&nbsp;<span class="ident" id="5920224"><a href="/encoding/gob/encoder.go.html#5915818">reflect</a></span><span class="op" id="5920231">.</span><span class="ident" id="5920232">Array</span><span class="op" id="5920237">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5920241">//&nbsp;arrays&nbsp;must&nbsp;be&nbsp;sent&nbsp;so&nbsp;we&nbsp;know&nbsp;their&nbsp;lengths&nbsp;and&nbsp;element&nbsp;types.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920310">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920317">case</span>&nbsp;<span class="ident" id="5920322"><a href="/encoding/gob/encoder.go.html#5915818">reflect</a></span><span class="op" id="5920329">.</span><span class="ident" id="5920330">Map</span><span class="op" id="5920333">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5920337">//&nbsp;maps&nbsp;must&nbsp;be&nbsp;sent&nbsp;so&nbsp;we&nbsp;know&nbsp;their&nbsp;lengths&nbsp;and&nbsp;key/value&nbsp;types.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920406">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920413">case</span>&nbsp;<span class="ident" id="5920418"><a href="/encoding/gob/encoder.go.html#5915818">reflect</a></span><span class="op" id="5920425">.</span><span class="ident" id="5920426">Struct</span><span class="op" id="5920432">:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5920436">//&nbsp;structs&nbsp;must&nbsp;be&nbsp;sent&nbsp;so&nbsp;we&nbsp;know&nbsp;their&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920487">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920494">case</span>&nbsp;<span class="ident" id="5920499"><a href="/encoding/gob/encoder.go.html#5915818">reflect</a></span><span class="op" id="5920506">.</span><span class="ident" id="5920507">Chan</span><span class="op" id="5920511">,</span>&nbsp;<span class="ident" id="5920513"><a href="/encoding/gob/encoder.go.html#5915818">reflect</a></span><span class="op" id="5920520">.</span><span class="ident" id="5920521">Func</span><span class="op" id="5920525">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5920529">//&nbsp;If&nbsp;we&nbsp;get&nbsp;here,&nbsp;it&#39;s&nbsp;a&nbsp;field&nbsp;of&nbsp;a&nbsp;struct;&nbsp;ignore&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920587">return</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5920595">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920599">return</span>&nbsp;<span class="ident" id="5920606"><a href="/encoding/gob/encoder.go.html#5919527">enc</a></span><span class="op" id="5920609">.</span><span class="ident" id="5920610">sendActualType</span><span class="op" id="5920624">(</span><span class="ident" id="5920625"><a href="/encoding/gob/encoder.go.html#5919550">w</a></span><span class="op" id="5920626">,</span>&nbsp;<span class="ident" id="5920628"><a href="/encoding/gob/encoder.go.html#5919563">state</a></span><span class="op" id="5920633">,</span>&nbsp;<span class="ident" id="5920635"><a href="/encoding/gob/encoder.go.html#5919619">ut</a></span><span class="op" id="5920637">,</span>&nbsp;<span class="ident" id="5920639"><a href="/encoding/gob/encoder.go.html#5919619">ut</a></span><span class="op" id="5920641">.</span><span class="ident" id="5920642">base</span><span class="op" id="5920646">)</span><br>
<span class="lineno"></span><span class="op" id="5920648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="5920651">//&nbsp;Encode&nbsp;transmits&nbsp;the&nbsp;data&nbsp;item&nbsp;represented&nbsp;by&nbsp;the&nbsp;empty&nbsp;interface&nbsp;value,</span><br>
<span class="lineno"></span><span class="comment" id="5920727">//&nbsp;guaranteeing&nbsp;that&nbsp;all&nbsp;necessary&nbsp;type&nbsp;information&nbsp;has&nbsp;been&nbsp;transmitted&nbsp;first.</span><br>
<span class="lineno"></span><span class="keyword" id="5920807">func</span>&nbsp;<span class="op" id="5920812">(</span><span class="ident" id="5920813">enc</span>&nbsp;<span class="op" id="5920817">*</span><span class="ident" id="5920818"><a href="/encoding/gob/encoder.go.html#5915950">Encoder</a></span><span class="op" id="5920825">)</span>&nbsp;<span class="ident" id="5920827">Encode</span><span class="op" id="5920833">(</span><span class="ident" id="5920834">e</span>&nbsp;<span class="keyword" id="5920836">interface</span><span class="op" id="5920845">{</span><span class="op" id="5920846">}</span><span class="op" id="5920847">)</span>&nbsp;<span class="builtintype" id="5920849">error</span>&nbsp;<span class="op" id="5920855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920858">return</span>&nbsp;<span class="ident" id="5920865"><a href="/encoding/gob/encoder.go.html#5920813">enc</a></span><span class="op" id="5920868">.</span><span class="ident" id="5920869">EncodeValue</span><span class="op" id="5920880">(</span><span class="ident" id="5920881"><a href="/encoding/gob/encoder.go.html#5915818">reflect</a></span><span class="op" id="5920888">.</span><span class="ident" id="5920889">ValueOf</span><span class="op" id="5920896">(</span><span class="ident" id="5920897"><a href="/encoding/gob/encoder.go.html#5920834">e</a></span><span class="op" id="5920898">)</span><span class="op" id="5920899">)</span><br>
<span class="lineno"></span><span class="op" id="5920901">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="comment" id="5920904">//&nbsp;sendTypeDescriptor&nbsp;makes&nbsp;sure&nbsp;the&nbsp;remote&nbsp;side&nbsp;knows&nbsp;about&nbsp;this&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="5920976">//&nbsp;It&nbsp;will&nbsp;send&nbsp;a&nbsp;descriptor&nbsp;if&nbsp;this&nbsp;is&nbsp;the&nbsp;first&nbsp;time&nbsp;the&nbsp;type&nbsp;has&nbsp;been</span><br>
<span class="lineno"></span><span class="comment" id="5921049">//&nbsp;sent.</span><br>
<span class="lineno"></span><span class="keyword" id="5921058">func</span>&nbsp;<span class="op" id="5921063">(</span><span class="ident" id="5921064">enc</span>&nbsp;<span class="op" id="5921068">*</span><span class="ident" id="5921069"><a href="/encoding/gob/encoder.go.html#5915950">Encoder</a></span><span class="op" id="5921076">)</span>&nbsp;<span class="ident" id="5921078">sendTypeDescriptor</span><span class="op" id="5921096">(</span><span class="ident" id="5921097">w</span>&nbsp;<span class="ident" id="5921099"><a href="/encoding/gob/encoder.go.html#5915812">io</a></span><span class="op" id="5921101">.</span><span class="ident" id="5921102">Writer</span><span class="op" id="5921108">,</span>&nbsp;<span class="ident" id="5921110">state</span>&nbsp;<span class="op" id="5921116">*</span><span class="ident" id="5921117"><a href="/encoding/gob/encode.go.html#5895985">encoderState</a></span><span class="op" id="5921129">,</span>&nbsp;<span class="ident" id="5921131">ut</span>&nbsp;<span class="op" id="5921134">*</span><span class="ident" id="5921135"><a href="/encoding/gob/type.go.html#5925033">userTypeInfo</a></span><span class="op" id="5921147">)</span>&nbsp;<span class="op" id="5921149">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5921152">//&nbsp;Make&nbsp;sure&nbsp;the&nbsp;type&nbsp;is&nbsp;known&nbsp;to&nbsp;the&nbsp;other&nbsp;side.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5921203">//&nbsp;First,&nbsp;have&nbsp;we&nbsp;already&nbsp;sent&nbsp;this&nbsp;type?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921246">rt</span>&nbsp;<span class="op" id="5921249">:=</span>&nbsp;<span class="ident" id="5921252"><a href="/encoding/gob/encoder.go.html#5921131">ut</a></span><span class="op" id="5921254">.</span><span class="ident" id="5921255">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921261">if</span>&nbsp;<span class="ident" id="5921264"><a href="/encoding/gob/encoder.go.html#5921131">ut</a></span><span class="op" id="5921266">.</span><span class="ident" id="5921267">externalEnc</span>&nbsp;<span class="op" id="5921279">!=</span>&nbsp;<span class="num" id="5921282">0</span>&nbsp;<span class="op" id="5921284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921288"><a href="/encoding/gob/encoder.go.html#5921246">rt</a></span>&nbsp;<span class="op" id="5921291">=</span>&nbsp;<span class="ident" id="5921293"><a href="/encoding/gob/encoder.go.html#5921131">ut</a></span><span class="op" id="5921295">.</span><span class="ident" id="5921296">user</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5921302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921305">if</span>&nbsp;<span class="ident" id="5921308">_</span><span class="op" id="5921309">,</span>&nbsp;<span class="ident" id="5921311">alreadySent</span>&nbsp;<span class="op" id="5921323">:=</span>&nbsp;<span class="ident" id="5921326"><a href="/encoding/gob/encoder.go.html#5921064">enc</a></span><span class="op" id="5921329">.</span><span class="ident" id="5921330">sent</span><span class="op" id="5921334">[</span><span class="ident" id="5921335"><a href="/encoding/gob/encoder.go.html#5921246">rt</a></span><span class="op" id="5921337">]</span><span class="op" id="5921338">;</span>&nbsp;<span class="op" id="5921340">!</span><span class="ident" id="5921341"><a href="/encoding/gob/encoder.go.html#5921311">alreadySent</a></span>&nbsp;<span class="op" id="5921353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5921357">//&nbsp;No,&nbsp;so&nbsp;send&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921378">sent</span>&nbsp;<span class="op" id="5921383">:=</span>&nbsp;<span class="ident" id="5921386"><a href="/encoding/gob/encoder.go.html#5921064">enc</a></span><span class="op" id="5921389">.</span><span class="ident" id="5921390">sendType</span><span class="op" id="5921398">(</span><span class="ident" id="5921399"><a href="/encoding/gob/encoder.go.html#5921097">w</a></span><span class="op" id="5921400">,</span>&nbsp;<span class="ident" id="5921402"><a href="/encoding/gob/encoder.go.html#5921110">state</a></span><span class="op" id="5921407">,</span>&nbsp;<span class="ident" id="5921409"><a href="/encoding/gob/encoder.go.html#5921246">rt</a></span><span class="op" id="5921411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921415">if</span>&nbsp;<span class="ident" id="5921418"><a href="/encoding/gob/encoder.go.html#5921064">enc</a></span><span class="op" id="5921421">.</span><span class="ident" id="5921422">err</span>&nbsp;<span class="op" id="5921426">!=</span>&nbsp;<span class="ident" id="5921429">nil</span>&nbsp;<span class="op" id="5921433">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921438">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5921447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5921451">//&nbsp;If&nbsp;the&nbsp;type&nbsp;info&nbsp;has&nbsp;still&nbsp;not&nbsp;been&nbsp;transmitted,&nbsp;it&nbsp;means&nbsp;we&nbsp;have</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5921522">//&nbsp;a&nbsp;singleton&nbsp;basic&nbsp;type&nbsp;(int,&nbsp;[]byte&nbsp;etc.)&nbsp;at&nbsp;top&nbsp;level.&nbsp;&nbsp;We&nbsp;don&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5921593">//&nbsp;need&nbsp;to&nbsp;send&nbsp;the&nbsp;type&nbsp;info&nbsp;but&nbsp;we&nbsp;do&nbsp;need&nbsp;to&nbsp;update&nbsp;enc.sent.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921660">if</span>&nbsp;<span class="op" id="5921663">!</span><span class="ident" id="5921664"><a href="/encoding/gob/encoder.go.html#5921378">sent</a></span>&nbsp;<span class="op" id="5921669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921674">info</span><span class="op" id="5921678">,</span>&nbsp;<span class="ident" id="5921680">err</span>&nbsp;<span class="op" id="5921684">:=</span>&nbsp;<span class="ident" id="5921687"><a href="/encoding/gob/type.go.html#5945303">getTypeInfo</a></span><span class="op" id="5921698">(</span><span class="ident" id="5921699"><a href="/encoding/gob/encoder.go.html#5921131">ut</a></span><span class="op" id="5921701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921706">if</span>&nbsp;<span class="ident" id="5921709"><a href="/encoding/gob/encoder.go.html#5921680">err</a></span>&nbsp;<span class="op" id="5921713">!=</span>&nbsp;<span class="ident" id="5921716">nil</span>&nbsp;<span class="op" id="5921720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921726"><a href="/encoding/gob/encoder.go.html#5921064">enc</a></span><span class="op" id="5921729">.</span><span class="ident" id="5921730">setError</span><span class="op" id="5921738">(</span><span class="ident" id="5921739"><a href="/encoding/gob/encoder.go.html#5921680">err</a></span><span class="op" id="5921742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921748">return</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5921758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921763"><a href="/encoding/gob/encoder.go.html#5921064">enc</a></span><span class="op" id="5921766">.</span><span class="ident" id="5921767">sent</span><span class="op" id="5921771">[</span><span class="ident" id="5921772"><a href="/encoding/gob/encoder.go.html#5921246">rt</a></span><span class="op" id="5921774">]</span>&nbsp;<span class="op" id="5921776">=</span>&nbsp;<span class="ident" id="5921778"><a href="/encoding/gob/encoder.go.html#5921674">info</a></span><span class="op" id="5921782">.</span><span class="ident" id="5921783">id</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5921788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5921791">}</span><br>
<span class="lineno"></span><span class="op" id="5921793">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="5921796">//&nbsp;sendTypeId&nbsp;sends&nbsp;the&nbsp;id,&nbsp;which&nbsp;must&nbsp;have&nbsp;already&nbsp;been&nbsp;defined.</span><br>
<span class="lineno"></span><span class="keyword" id="5921862">func</span>&nbsp;<span class="op" id="5921867">(</span><span class="ident" id="5921868">enc</span>&nbsp;<span class="op" id="5921872">*</span><span class="ident" id="5921873"><a href="/encoding/gob/encoder.go.html#5915950">Encoder</a></span><span class="op" id="5921880">)</span>&nbsp;<span class="ident" id="5921882">sendTypeId</span><span class="op" id="5921892">(</span><span class="ident" id="5921893">state</span>&nbsp;<span class="op" id="5921899">*</span><span class="ident" id="5921900"><a href="/encoding/gob/encode.go.html#5895985">encoderState</a></span><span class="op" id="5921912">,</span>&nbsp;<span class="ident" id="5921914">ut</span>&nbsp;<span class="op" id="5921917">*</span><span class="ident" id="5921918"><a href="/encoding/gob/type.go.html#5925033">userTypeInfo</a></span><span class="op" id="5921930">)</span>&nbsp;<span class="op" id="5921932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5921935">//&nbsp;Identify&nbsp;the&nbsp;type&nbsp;of&nbsp;this&nbsp;top-level&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921982"><a href="/encoding/gob/encoder.go.html#5921893">state</a></span><span class="op" id="5921987">.</span><span class="ident" id="5921988">encodeInt</span><span class="op" id="5921997">(</span><span class="ident" id="5921998">int64</span><span class="op" id="5922003">(</span><span class="ident" id="5922004"><a href="/encoding/gob/encoder.go.html#5921868">enc</a></span><span class="op" id="5922007">.</span><span class="ident" id="5922008">sent</span><span class="op" id="5922012">[</span><span class="ident" id="5922013"><a href="/encoding/gob/encoder.go.html#5921914">ut</a></span><span class="op" id="5922015">.</span><span class="ident" id="5922016">base</span><span class="op" id="5922020">]</span><span class="op" id="5922021">)</span><span class="op" id="5922022">)</span><br>
<span class="lineno">205</span><span class="op" id="5922024">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5922027">//&nbsp;EncodeValue&nbsp;transmits&nbsp;the&nbsp;data&nbsp;item&nbsp;represented&nbsp;by&nbsp;the&nbsp;reflection&nbsp;value,</span><br>
<span class="lineno"></span><span class="comment" id="5922103">//&nbsp;guaranteeing&nbsp;that&nbsp;all&nbsp;necessary&nbsp;type&nbsp;information&nbsp;has&nbsp;been&nbsp;transmitted&nbsp;first.</span><br>
<span class="lineno"></span><span class="keyword" id="5922183">func</span>&nbsp;<span class="op" id="5922188">(</span><span class="ident" id="5922189">enc</span>&nbsp;<span class="op" id="5922193">*</span><span class="ident" id="5922194"><a href="/encoding/gob/encoder.go.html#5915950">Encoder</a></span><span class="op" id="5922201">)</span>&nbsp;<span class="ident" id="5922203">EncodeValue</span><span class="op" id="5922214">(</span><span class="ident" id="5922215">value</span>&nbsp;<span class="ident" id="5922221"><a href="/encoding/gob/encoder.go.html#5915818">reflect</a></span><span class="op" id="5922228">.</span><span class="ident" id="5922229">Value</span><span class="op" id="5922234">)</span>&nbsp;<span class="builtintype" id="5922236">error</span>&nbsp;<span class="op" id="5922242">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5922245">//&nbsp;Gobs&nbsp;contain&nbsp;values.&nbsp;They&nbsp;cannot&nbsp;represent&nbsp;nil&nbsp;pointers,&nbsp;which</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5922312">//&nbsp;have&nbsp;no&nbsp;value&nbsp;to&nbsp;encode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922341">if</span>&nbsp;<span class="ident" id="5922344"><a href="/encoding/gob/encoder.go.html#5922215">value</a></span><span class="op" id="5922349">.</span><span class="ident" id="5922350">Kind</span><span class="op" id="5922354">(</span><span class="op" id="5922355">)</span>&nbsp;<span class="op" id="5922357">==</span>&nbsp;<span class="ident" id="5922360"><a href="/encoding/gob/encoder.go.html#5915818">reflect</a></span><span class="op" id="5922367">.</span><span class="ident" id="5922368">Ptr</span>&nbsp;<span class="op" id="5922372">&amp;&amp;</span>&nbsp;<span class="ident" id="5922375"><a href="/encoding/gob/encoder.go.html#5922215">value</a></span><span class="op" id="5922380">.</span><span class="ident" id="5922381">IsNil</span><span class="op" id="5922386">(</span><span class="op" id="5922387">)</span>&nbsp;<span class="op" id="5922389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5922393">panic</span><span class="op" id="5922398">(</span><span class="string" id="5922399">&#34;gob:&nbsp;cannot&nbsp;encode&nbsp;nil&nbsp;pointer&nbsp;of&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="5922441">+</span>&nbsp;<span class="ident" id="5922443"><a href="/encoding/gob/encoder.go.html#5922215">value</a></span><span class="op" id="5922448">.</span><span class="ident" id="5922449">Type</span><span class="op" id="5922453">(</span><span class="op" id="5922454">)</span><span class="op" id="5922455">.</span><span class="ident" id="5922456">String</span><span class="op" id="5922462">(</span><span class="op" id="5922463">)</span><span class="op" id="5922464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5922467">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5922471">//&nbsp;Make&nbsp;sure&nbsp;we&#39;re&nbsp;single-threaded&nbsp;through&nbsp;here,&nbsp;so&nbsp;multiple</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5922533">//&nbsp;goroutines&nbsp;can&nbsp;share&nbsp;an&nbsp;encoder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922570"><a href="/encoding/gob/encoder.go.html#5922189">enc</a></span><span class="op" id="5922573">.</span><span class="ident" id="5922574">mutex</span><span class="op" id="5922579">.</span><span class="ident" id="5922580">Lock</span><span class="op" id="5922584">(</span><span class="op" id="5922585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922588">defer</span>&nbsp;<span class="ident" id="5922594"><a href="/encoding/gob/encoder.go.html#5922189">enc</a></span><span class="op" id="5922597">.</span><span class="ident" id="5922598">mutex</span><span class="op" id="5922603">.</span><span class="ident" id="5922604">Unlock</span><span class="op" id="5922610">(</span><span class="op" id="5922611">)</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5922615">//&nbsp;Remove&nbsp;any&nbsp;nested&nbsp;writers&nbsp;remaining&nbsp;due&nbsp;to&nbsp;previous&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922679"><a href="/encoding/gob/encoder.go.html#5922189">enc</a></span><span class="op" id="5922682">.</span><span class="ident" id="5922683">w</span>&nbsp;<span class="op" id="5922685">=</span>&nbsp;<span class="ident" id="5922687"><a href="/encoding/gob/encoder.go.html#5922189">enc</a></span><span class="op" id="5922690">.</span><span class="ident" id="5922691">w</span><span class="op" id="5922692">[</span><span class="num" id="5922693">0</span><span class="op" id="5922694">:</span><span class="num" id="5922695">1</span><span class="op" id="5922696">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922700">ut</span><span class="op" id="5922702">,</span>&nbsp;<span class="ident" id="5922704">err</span>&nbsp;<span class="op" id="5922708">:=</span>&nbsp;<span class="ident" id="5922711"><a href="/encoding/gob/type.go.html#5926206">validUserType</a></span><span class="op" id="5922724">(</span><span class="ident" id="5922725"><a href="/encoding/gob/encoder.go.html#5922215">value</a></span><span class="op" id="5922730">.</span><span class="ident" id="5922731">Type</span><span class="op" id="5922735">(</span><span class="op" id="5922736">)</span><span class="op" id="5922737">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922740">if</span>&nbsp;<span class="ident" id="5922743"><a href="/encoding/gob/encoder.go.html#5922704">err</a></span>&nbsp;<span class="op" id="5922747">!=</span>&nbsp;<span class="ident" id="5922750">nil</span>&nbsp;<span class="op" id="5922754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922758">return</span>&nbsp;<span class="ident" id="5922765"><a href="/encoding/gob/encoder.go.html#5922704">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5922770">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922774"><a href="/encoding/gob/encoder.go.html#5922189">enc</a></span><span class="op" id="5922777">.</span><span class="ident" id="5922778">err</span>&nbsp;<span class="op" id="5922782">=</span>&nbsp;<span class="ident" id="5922784">nil</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922789"><a href="/encoding/gob/encoder.go.html#5922189">enc</a></span><span class="op" id="5922792">.</span><span class="ident" id="5922793">byteBuf</span><span class="op" id="5922800">.</span><span class="ident" id="5922801">Reset</span><span class="op" id="5922806">(</span><span class="op" id="5922807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922810"><a href="/encoding/gob/encoder.go.html#5922189">enc</a></span><span class="op" id="5922813">.</span><span class="ident" id="5922814">byteBuf</span><span class="op" id="5922821">.</span><span class="ident" id="5922822">Write</span><span class="op" id="5922827">(</span><span class="ident" id="5922828"><a href="/encoding/gob/encoder.go.html#5916675">spaceForLength</a></span><span class="op" id="5922842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922845">state</span>&nbsp;<span class="op" id="5922851">:=</span>&nbsp;<span class="ident" id="5922854"><a href="/encoding/gob/encoder.go.html#5922189">enc</a></span><span class="op" id="5922857">.</span><span class="ident" id="5922858">newEncoderState</span><span class="op" id="5922873">(</span><span class="op" id="5922874">&amp;</span><span class="ident" id="5922875"><a href="/encoding/gob/encoder.go.html#5922189">enc</a></span><span class="op" id="5922878">.</span><span class="ident" id="5922879">byteBuf</span><span class="op" id="5922886">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922890"><a href="/encoding/gob/encoder.go.html#5922189">enc</a></span><span class="op" id="5922893">.</span><span class="ident" id="5922894">sendTypeDescriptor</span><span class="op" id="5922912">(</span><span class="ident" id="5922913"><a href="/encoding/gob/encoder.go.html#5922189">enc</a></span><span class="op" id="5922916">.</span><span class="ident" id="5922917">writer</span><span class="op" id="5922923">(</span><span class="op" id="5922924">)</span><span class="op" id="5922925">,</span>&nbsp;<span class="ident" id="5922927"><a href="/encoding/gob/encoder.go.html#5922845">state</a></span><span class="op" id="5922932">,</span>&nbsp;<span class="ident" id="5922934"><a href="/encoding/gob/encoder.go.html#5922700">ut</a></span><span class="op" id="5922936">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922939"><a href="/encoding/gob/encoder.go.html#5922189">enc</a></span><span class="op" id="5922942">.</span><span class="ident" id="5922943">sendTypeId</span><span class="op" id="5922953">(</span><span class="ident" id="5922954"><a href="/encoding/gob/encoder.go.html#5922845">state</a></span><span class="op" id="5922959">,</span>&nbsp;<span class="ident" id="5922961"><a href="/encoding/gob/encoder.go.html#5922700">ut</a></span><span class="op" id="5922963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922966">if</span>&nbsp;<span class="ident" id="5922969"><a href="/encoding/gob/encoder.go.html#5922189">enc</a></span><span class="op" id="5922972">.</span><span class="ident" id="5922973">err</span>&nbsp;<span class="op" id="5922977">!=</span>&nbsp;<span class="ident" id="5922980">nil</span>&nbsp;<span class="op" id="5922984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922988">return</span>&nbsp;<span class="ident" id="5922995"><a href="/encoding/gob/encoder.go.html#5922189">enc</a></span><span class="op" id="5922998">.</span><span class="ident" id="5922999">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5923004">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5923008">//&nbsp;Encode&nbsp;the&nbsp;object.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923031"><a href="/encoding/gob/encoder.go.html#5922189">enc</a></span><span class="op" id="5923034">.</span><span class="ident" id="5923035">encode</span><span class="op" id="5923041">(</span><span class="ident" id="5923042"><a href="/encoding/gob/encoder.go.html#5922845">state</a></span><span class="op" id="5923047">.</span><span class="ident" id="5923048">b</span><span class="op" id="5923049">,</span>&nbsp;<span class="ident" id="5923051"><a href="/encoding/gob/encoder.go.html#5922215">value</a></span><span class="op" id="5923056">,</span>&nbsp;<span class="ident" id="5923058"><a href="/encoding/gob/encoder.go.html#5922700">ut</a></span><span class="op" id="5923060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5923063">if</span>&nbsp;<span class="ident" id="5923066"><a href="/encoding/gob/encoder.go.html#5922189">enc</a></span><span class="op" id="5923069">.</span><span class="ident" id="5923070">err</span>&nbsp;<span class="op" id="5923074">==</span>&nbsp;<span class="ident" id="5923077">nil</span>&nbsp;<span class="op" id="5923081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923085"><a href="/encoding/gob/encoder.go.html#5922189">enc</a></span><span class="op" id="5923088">.</span><span class="ident" id="5923089">writeMessage</span><span class="op" id="5923101">(</span><span class="ident" id="5923102"><a href="/encoding/gob/encoder.go.html#5922189">enc</a></span><span class="op" id="5923105">.</span><span class="ident" id="5923106">writer</span><span class="op" id="5923112">(</span><span class="op" id="5923113">)</span><span class="op" id="5923114">,</span>&nbsp;<span class="ident" id="5923116"><a href="/encoding/gob/encoder.go.html#5922845">state</a></span><span class="op" id="5923121">.</span><span class="ident" id="5923122">b</span><span class="op" id="5923123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5923126">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923130"><a href="/encoding/gob/encoder.go.html#5922189">enc</a></span><span class="op" id="5923133">.</span><span class="ident" id="5923134">freeEncoderState</span><span class="op" id="5923150">(</span><span class="ident" id="5923151"><a href="/encoding/gob/encoder.go.html#5922845">state</a></span><span class="op" id="5923156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5923159">return</span>&nbsp;<span class="ident" id="5923166"><a href="/encoding/gob/encoder.go.html#5922189">enc</a></span><span class="op" id="5923169">.</span><span class="ident" id="5923170">err</span><br>
<span class="lineno"></span><span class="op" id="5923174">}</span>
</div>
</body>
</html>
