<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html</h2>
<ul>
<li><a href="/gostd/html/entity.go.html">entity.go</a></li>
<li><a href="/gostd/html/entity_test.go.html">entity_test.go</a></li>
<li><a href="/gostd/html/escape.go.html">escape.go</a></li>
<li><a href="/gostd/html/escape_test.go.html">escape_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5374064">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5374119">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5374173">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5374224">//&nbsp;Package&nbsp;html&nbsp;provides&nbsp;functions&nbsp;for&nbsp;escaping&nbsp;and&nbsp;unescaping&nbsp;HTML&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="5374298">package</span>&nbsp;<span class="ident" id="5374306">html</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5374312">import</span>&nbsp;<span class="op" id="5374319">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5374322">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5374331">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5374342">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5374357">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5374360">type</span>&nbsp;<span class="ident" id="5374365">writer</span>&nbsp;<span class="keyword" id="5374372">interface</span>&nbsp;<span class="op" id="5374382">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5374385">WriteString</span><span class="op" id="5374396">(</span><span class="builtintype" id="5374397">string</span><span class="op" id="5374403">)</span>&nbsp;<span class="op" id="5374405">(</span><span class="builtintype" id="5374406">int</span><span class="op" id="5374409">,</span>&nbsp;<span class="builtintype" id="5374411">error</span><span class="op" id="5374416">)</span><br>
<span class="lineno"></span><span class="op" id="5374418">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5374421">//&nbsp;These&nbsp;replacements&nbsp;permit&nbsp;compatibility&nbsp;with&nbsp;old&nbsp;numeric&nbsp;entities&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5374495">//&nbsp;assumed&nbsp;Windows-1252&nbsp;encoding.</span><br>
<span class="lineno">20</span><span class="comment" id="5374529">//&nbsp;http://www.whatwg.org/specs/web-apps/current-work/multipage/tokenization.html#consume-a-character-reference</span><br>
<span class="lineno"></span><span class="keyword" id="5374640">var</span>&nbsp;<span class="ident" id="5374644">replacementTable</span>&nbsp;<span class="op" id="5374661">=</span>&nbsp;<span class="op" id="5374663">[</span><span class="op" id="5374664">...</span><span class="op" id="5374667">]</span><span class="builtintype" id="5374668">rune</span><span class="op" id="5374672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5374675">&#39;\u20AC&#39;</span><span class="op" id="5374683">,</span>&nbsp;<span class="comment" id="5374685">//&nbsp;First&nbsp;entry&nbsp;is&nbsp;what&nbsp;0x80&nbsp;should&nbsp;be&nbsp;replaced&nbsp;with.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5374739">&#39;\u0081&#39;</span><span class="op" id="5374747">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5374750">&#39;\u201A&#39;</span><span class="op" id="5374758">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5374761">&#39;\u0192&#39;</span><span class="op" id="5374769">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5374772">&#39;\u201E&#39;</span><span class="op" id="5374780">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5374783">&#39;\u2026&#39;</span><span class="op" id="5374791">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5374794">&#39;\u2020&#39;</span><span class="op" id="5374802">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5374805">&#39;\u2021&#39;</span><span class="op" id="5374813">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5374816">&#39;\u02C6&#39;</span><span class="op" id="5374824">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5374827">&#39;\u2030&#39;</span><span class="op" id="5374835">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5374838">&#39;\u0160&#39;</span><span class="op" id="5374846">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5374849">&#39;\u2039&#39;</span><span class="op" id="5374857">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5374860">&#39;\u0152&#39;</span><span class="op" id="5374868">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5374871">&#39;\u008D&#39;</span><span class="op" id="5374879">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5374882">&#39;\u017D&#39;</span><span class="op" id="5374890">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5374893">&#39;\u008F&#39;</span><span class="op" id="5374901">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5374904">&#39;\u0090&#39;</span><span class="op" id="5374912">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5374915">&#39;\u2018&#39;</span><span class="op" id="5374923">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5374926">&#39;\u2019&#39;</span><span class="op" id="5374934">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5374937">&#39;\u201C&#39;</span><span class="op" id="5374945">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5374948">&#39;\u201D&#39;</span><span class="op" id="5374956">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5374959">&#39;\u2022&#39;</span><span class="op" id="5374967">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5374970">&#39;\u2013&#39;</span><span class="op" id="5374978">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5374981">&#39;\u2014&#39;</span><span class="op" id="5374989">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5374992">&#39;\u02DC&#39;</span><span class="op" id="5375000">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5375003">&#39;\u2122&#39;</span><span class="op" id="5375011">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5375014">&#39;\u0161&#39;</span><span class="op" id="5375022">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5375025">&#39;\u203A&#39;</span><span class="op" id="5375033">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5375036">&#39;\u0153&#39;</span><span class="op" id="5375044">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5375047">&#39;\u009D&#39;</span><span class="op" id="5375055">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5375058">&#39;\u017E&#39;</span><span class="op" id="5375066">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5375069">&#39;\u0178&#39;</span><span class="op" id="5375077">,</span>&nbsp;<span class="comment" id="5375079">//&nbsp;Last&nbsp;entry&nbsp;is&nbsp;0x9F.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5375103">//&nbsp;0x00-&gt;&#39;\uFFFD&#39;&nbsp;is&nbsp;handled&nbsp;programmatically.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5375151">//&nbsp;0x0D-&gt;&#39;\u000D&#39;&nbsp;is&nbsp;a&nbsp;no-op.</span><br>
<span class="lineno"></span><span class="op" id="5375181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5375184">//&nbsp;unescapeEntity&nbsp;reads&nbsp;an&nbsp;entity&nbsp;like&nbsp;&#34;&amp;lt;&#34;&nbsp;from&nbsp;b[src:]&nbsp;and&nbsp;writes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5375258">//&nbsp;corresponding&nbsp;&#34;&lt;&#34;&nbsp;to&nbsp;b[dst:],&nbsp;returning&nbsp;the&nbsp;incremented&nbsp;dst&nbsp;and&nbsp;src&nbsp;cursors.</span><br>
<span class="lineno">60</span><span class="comment" id="5375338">//&nbsp;Precondition:&nbsp;b[src]&nbsp;==&nbsp;&#39;&amp;&#39;&nbsp;&amp;&amp;&nbsp;dst&nbsp;&lt;=&nbsp;src.</span><br>
<span class="lineno"></span><span class="comment" id="5375384">//&nbsp;attribute&nbsp;should&nbsp;be&nbsp;true&nbsp;if&nbsp;parsing&nbsp;an&nbsp;attribute&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5375443">func</span>&nbsp;<span class="ident" id="5375448">unescapeEntity</span><span class="op" id="5375462">(</span><span class="ident" id="5375463">b</span>&nbsp;<span class="op" id="5375465">[</span><span class="op" id="5375466">]</span><span class="builtintype" id="5375467">byte</span><span class="op" id="5375471">,</span>&nbsp;<span class="ident" id="5375473">dst</span><span class="op" id="5375476">,</span>&nbsp;<span class="ident" id="5375478">src</span>&nbsp;<span class="builtintype" id="5375482">int</span><span class="op" id="5375485">,</span>&nbsp;<span class="ident" id="5375487">attribute</span>&nbsp;<span class="builtintype" id="5375497">bool</span><span class="op" id="5375501">)</span>&nbsp;<span class="op" id="5375503">(</span><span class="ident" id="5375504">dst1</span><span class="op" id="5375508">,</span>&nbsp;<span class="ident" id="5375510">src1</span>&nbsp;<span class="builtintype" id="5375515">int</span><span class="op" id="5375518">)</span>&nbsp;<span class="op" id="5375520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5375523">//&nbsp;http://www.whatwg.org/specs/web-apps/current-work/multipage/tokenization.html#consume-a-character-reference</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5375636">//&nbsp;i&nbsp;starts&nbsp;at&nbsp;1&nbsp;because&nbsp;we&nbsp;already&nbsp;know&nbsp;that&nbsp;s[0]&nbsp;==&nbsp;&#39;&amp;&#39;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5375696">i</span><span class="op" id="5375697">,</span>&nbsp;<span class="ident" id="5375699">s</span>&nbsp;<span class="op" id="5375701">:=</span>&nbsp;<span class="num" id="5375704">1</span><span class="op" id="5375705">,</span>&nbsp;<span class="ident" id="5375707">b</span><span class="op" id="5375708">[</span><span class="ident" id="5375709">src</span><span class="op" id="5375712">:</span><span class="op" id="5375713">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5375717">if</span>&nbsp;<span class="builtinfunc" id="5375720">len</span><span class="op" id="5375723">(</span><span class="ident" id="5375724">s</span><span class="op" id="5375725">)</span>&nbsp;<span class="op" id="5375727">&lt;=</span>&nbsp;<span class="num" id="5375730">1</span>&nbsp;<span class="op" id="5375732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5375736">b</span><span class="op" id="5375737">[</span><span class="ident" id="5375738">dst</span><span class="op" id="5375741">]</span>&nbsp;<span class="op" id="5375743">=</span>&nbsp;<span class="ident" id="5375745">b</span><span class="op" id="5375746">[</span><span class="ident" id="5375747">src</span><span class="op" id="5375750">]</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5375754">return</span>&nbsp;<span class="ident" id="5375761">dst</span>&nbsp;<span class="op" id="5375765">+</span>&nbsp;<span class="num" id="5375767">1</span><span class="op" id="5375768">,</span>&nbsp;<span class="ident" id="5375770">src</span>&nbsp;<span class="op" id="5375774">+</span>&nbsp;<span class="num" id="5375776">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5375779">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5375783">if</span>&nbsp;<span class="ident" id="5375786">s</span><span class="op" id="5375787">[</span><span class="ident" id="5375788">i</span><span class="op" id="5375789">]</span>&nbsp;<span class="op" id="5375791">==</span>&nbsp;<span class="string" id="5375794">&#39;#&#39;</span>&nbsp;<span class="op" id="5375798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5375802">if</span>&nbsp;<span class="builtinfunc" id="5375805">len</span><span class="op" id="5375808">(</span><span class="ident" id="5375809">s</span><span class="op" id="5375810">)</span>&nbsp;<span class="op" id="5375812">&lt;=</span>&nbsp;<span class="num" id="5375815">3</span>&nbsp;<span class="op" id="5375817">{</span>&nbsp;<span class="comment" id="5375819">//&nbsp;We&nbsp;need&nbsp;to&nbsp;have&nbsp;at&nbsp;least&nbsp;&#34;&amp;#.&#34;.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5375857">b</span><span class="op" id="5375858">[</span><span class="ident" id="5375859">dst</span><span class="op" id="5375862">]</span>&nbsp;<span class="op" id="5375864">=</span>&nbsp;<span class="ident" id="5375866">b</span><span class="op" id="5375867">[</span><span class="ident" id="5375868">src</span><span class="op" id="5375871">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5375876">return</span>&nbsp;<span class="ident" id="5375883">dst</span>&nbsp;<span class="op" id="5375887">+</span>&nbsp;<span class="num" id="5375889">1</span><span class="op" id="5375890">,</span>&nbsp;<span class="ident" id="5375892">src</span>&nbsp;<span class="op" id="5375896">+</span>&nbsp;<span class="num" id="5375898">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5375902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5375906">i</span><span class="op" id="5375907">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5375912">c</span>&nbsp;<span class="op" id="5375914">:=</span>&nbsp;<span class="ident" id="5375917">s</span><span class="op" id="5375918">[</span><span class="ident" id="5375919">i</span><span class="op" id="5375920">]</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5375924">hex</span>&nbsp;<span class="op" id="5375928">:=</span>&nbsp;<span class="builtintype" id="5375931">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5375939">if</span>&nbsp;<span class="ident" id="5375942">c</span>&nbsp;<span class="op" id="5375944">==</span>&nbsp;<span class="string" id="5375947">&#39;x&#39;</span>&nbsp;<span class="op" id="5375951">||</span>&nbsp;<span class="ident" id="5375954">c</span>&nbsp;<span class="op" id="5375956">==</span>&nbsp;<span class="string" id="5375959">&#39;X&#39;</span>&nbsp;<span class="op" id="5375963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5375968">hex</span>&nbsp;<span class="op" id="5375972">=</span>&nbsp;<span class="builtintype" id="5375974">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5375982">i</span><span class="op" id="5375983">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5375988">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5375993">x</span>&nbsp;<span class="op" id="5375995">:=</span>&nbsp;<span class="string" id="5375998">&#39;\x00&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5376007">for</span>&nbsp;<span class="ident" id="5376011">i</span>&nbsp;<span class="op" id="5376013">&lt;</span>&nbsp;<span class="builtinfunc" id="5376015">len</span><span class="op" id="5376018">(</span><span class="ident" id="5376019">s</span><span class="op" id="5376020">)</span>&nbsp;<span class="op" id="5376022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5376027">c</span>&nbsp;<span class="op" id="5376029">=</span>&nbsp;<span class="ident" id="5376031">s</span><span class="op" id="5376032">[</span><span class="ident" id="5376033">i</span><span class="op" id="5376034">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5376039">i</span><span class="op" id="5376040">++</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5376046">if</span>&nbsp;<span class="ident" id="5376049">hex</span>&nbsp;<span class="op" id="5376053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5376059">if</span>&nbsp;<span class="string" id="5376062">&#39;0&#39;</span>&nbsp;<span class="op" id="5376066">&lt;=</span>&nbsp;<span class="ident" id="5376069">c</span>&nbsp;<span class="op" id="5376071">&amp;&amp;</span>&nbsp;<span class="ident" id="5376074">c</span>&nbsp;<span class="op" id="5376076">&lt;=</span>&nbsp;<span class="string" id="5376079">&#39;9&#39;</span>&nbsp;<span class="op" id="5376083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5376090">x</span>&nbsp;<span class="op" id="5376092">=</span>&nbsp;<span class="num" id="5376094">16</span><span class="op" id="5376096">*</span><span class="ident" id="5376097">x</span>&nbsp;<span class="op" id="5376099">+</span>&nbsp;<span class="builtintype" id="5376101">rune</span><span class="op" id="5376105">(</span><span class="ident" id="5376106">c</span><span class="op" id="5376107">)</span>&nbsp;<span class="op" id="5376109">-</span>&nbsp;<span class="string" id="5376111">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5376120">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5376133">}</span>&nbsp;<span class="keyword" id="5376135">else</span>&nbsp;<span class="keyword" id="5376140">if</span>&nbsp;<span class="string" id="5376143">&#39;a&#39;</span>&nbsp;<span class="op" id="5376147">&lt;=</span>&nbsp;<span class="ident" id="5376150">c</span>&nbsp;<span class="op" id="5376152">&amp;&amp;</span>&nbsp;<span class="ident" id="5376155">c</span>&nbsp;<span class="op" id="5376157">&lt;=</span>&nbsp;<span class="string" id="5376160">&#39;f&#39;</span>&nbsp;<span class="op" id="5376164">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5376171">x</span>&nbsp;<span class="op" id="5376173">=</span>&nbsp;<span class="num" id="5376175">16</span><span class="op" id="5376177">*</span><span class="ident" id="5376178">x</span>&nbsp;<span class="op" id="5376180">+</span>&nbsp;<span class="builtintype" id="5376182">rune</span><span class="op" id="5376186">(</span><span class="ident" id="5376187">c</span><span class="op" id="5376188">)</span>&nbsp;<span class="op" id="5376190">-</span>&nbsp;<span class="string" id="5376192">&#39;a&#39;</span>&nbsp;<span class="op" id="5376196">+</span>&nbsp;<span class="num" id="5376198">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5376206">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5376219">}</span>&nbsp;<span class="keyword" id="5376221">else</span>&nbsp;<span class="keyword" id="5376226">if</span>&nbsp;<span class="string" id="5376229">&#39;A&#39;</span>&nbsp;<span class="op" id="5376233">&lt;=</span>&nbsp;<span class="ident" id="5376236">c</span>&nbsp;<span class="op" id="5376238">&amp;&amp;</span>&nbsp;<span class="ident" id="5376241">c</span>&nbsp;<span class="op" id="5376243">&lt;=</span>&nbsp;<span class="string" id="5376246">&#39;F&#39;</span>&nbsp;<span class="op" id="5376250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5376257">x</span>&nbsp;<span class="op" id="5376259">=</span>&nbsp;<span class="num" id="5376261">16</span><span class="op" id="5376263">*</span><span class="ident" id="5376264">x</span>&nbsp;<span class="op" id="5376266">+</span>&nbsp;<span class="builtintype" id="5376268">rune</span><span class="op" id="5376272">(</span><span class="ident" id="5376273">c</span><span class="op" id="5376274">)</span>&nbsp;<span class="op" id="5376276">-</span>&nbsp;<span class="string" id="5376278">&#39;A&#39;</span>&nbsp;<span class="op" id="5376282">+</span>&nbsp;<span class="num" id="5376284">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5376292">continue</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5376305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5376310">}</span>&nbsp;<span class="keyword" id="5376312">else</span>&nbsp;<span class="keyword" id="5376317">if</span>&nbsp;<span class="string" id="5376320">&#39;0&#39;</span>&nbsp;<span class="op" id="5376324">&lt;=</span>&nbsp;<span class="ident" id="5376327">c</span>&nbsp;<span class="op" id="5376329">&amp;&amp;</span>&nbsp;<span class="ident" id="5376332">c</span>&nbsp;<span class="op" id="5376334">&lt;=</span>&nbsp;<span class="string" id="5376337">&#39;9&#39;</span>&nbsp;<span class="op" id="5376341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5376347">x</span>&nbsp;<span class="op" id="5376349">=</span>&nbsp;<span class="num" id="5376351">10</span><span class="op" id="5376353">*</span><span class="ident" id="5376354">x</span>&nbsp;<span class="op" id="5376356">+</span>&nbsp;<span class="builtintype" id="5376358">rune</span><span class="op" id="5376362">(</span><span class="ident" id="5376363">c</span><span class="op" id="5376364">)</span>&nbsp;<span class="op" id="5376366">-</span>&nbsp;<span class="string" id="5376368">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5376376">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5376388">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5376393">if</span>&nbsp;<span class="ident" id="5376396">c</span>&nbsp;<span class="op" id="5376398">!=</span>&nbsp;<span class="string" id="5376401">&#39;;&#39;</span>&nbsp;<span class="op" id="5376405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5376411">i</span><span class="op" id="5376412">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5376418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5376423">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5376431">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5376436">if</span>&nbsp;<span class="ident" id="5376439">i</span>&nbsp;<span class="op" id="5376441">&lt;=</span>&nbsp;<span class="num" id="5376444">3</span>&nbsp;<span class="op" id="5376446">{</span>&nbsp;<span class="comment" id="5376448">//&nbsp;No&nbsp;characters&nbsp;matched.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5376477">b</span><span class="op" id="5376478">[</span><span class="ident" id="5376479">dst</span><span class="op" id="5376482">]</span>&nbsp;<span class="op" id="5376484">=</span>&nbsp;<span class="ident" id="5376486">b</span><span class="op" id="5376487">[</span><span class="ident" id="5376488">src</span><span class="op" id="5376491">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5376496">return</span>&nbsp;<span class="ident" id="5376503">dst</span>&nbsp;<span class="op" id="5376507">+</span>&nbsp;<span class="num" id="5376509">1</span><span class="op" id="5376510">,</span>&nbsp;<span class="ident" id="5376512">src</span>&nbsp;<span class="op" id="5376516">+</span>&nbsp;<span class="num" id="5376518">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5376522">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5376527">if</span>&nbsp;<span class="num" id="5376530">0x80</span>&nbsp;<span class="op" id="5376535">&lt;=</span>&nbsp;<span class="ident" id="5376538">x</span>&nbsp;<span class="op" id="5376540">&amp;&amp;</span>&nbsp;<span class="ident" id="5376543">x</span>&nbsp;<span class="op" id="5376545">&lt;=</span>&nbsp;<span class="num" id="5376548">0x9F</span>&nbsp;<span class="op" id="5376553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5376558">//&nbsp;Replace&nbsp;characters&nbsp;from&nbsp;Windows-1252&nbsp;with&nbsp;UTF-8&nbsp;equivalents.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5376625">x</span>&nbsp;<span class="op" id="5376627">=</span>&nbsp;<span class="ident" id="5376629">replacementTable</span><span class="op" id="5376645">[</span><span class="ident" id="5376646">x</span><span class="op" id="5376647">-</span><span class="num" id="5376648">0x80</span><span class="op" id="5376652">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5376656">}</span>&nbsp;<span class="keyword" id="5376658">else</span>&nbsp;<span class="keyword" id="5376663">if</span>&nbsp;<span class="ident" id="5376666">x</span>&nbsp;<span class="op" id="5376668">==</span>&nbsp;<span class="num" id="5376671">0</span>&nbsp;<span class="op" id="5376673">||</span>&nbsp;<span class="op" id="5376676">(</span><span class="num" id="5376677">0xD800</span>&nbsp;<span class="op" id="5376684">&lt;=</span>&nbsp;<span class="ident" id="5376687">x</span>&nbsp;<span class="op" id="5376689">&amp;&amp;</span>&nbsp;<span class="ident" id="5376692">x</span>&nbsp;<span class="op" id="5376694">&lt;=</span>&nbsp;<span class="num" id="5376697">0xDFFF</span><span class="op" id="5376703">)</span>&nbsp;<span class="op" id="5376705">||</span>&nbsp;<span class="ident" id="5376708">x</span>&nbsp;<span class="op" id="5376710">&gt;</span>&nbsp;<span class="num" id="5376712">0x10FFFF</span>&nbsp;<span class="op" id="5376721">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5376726">//&nbsp;Replace&nbsp;invalid&nbsp;characters&nbsp;with&nbsp;the&nbsp;replacement&nbsp;character.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5376791">x</span>&nbsp;<span class="op" id="5376793">=</span>&nbsp;<span class="string" id="5376795">&#39;\uFFFD&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5376806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5376811">return</span>&nbsp;<span class="ident" id="5376818">dst</span>&nbsp;<span class="op" id="5376822">+</span>&nbsp;<span class="ident" id="5376824">utf8</span><span class="op" id="5376828">.</span><span class="ident" id="5376829">EncodeRune</span><span class="op" id="5376839">(</span><span class="ident" id="5376840">b</span><span class="op" id="5376841">[</span><span class="ident" id="5376842">dst</span><span class="op" id="5376845">:</span><span class="op" id="5376846">]</span><span class="op" id="5376847">,</span>&nbsp;<span class="ident" id="5376849">x</span><span class="op" id="5376850">)</span><span class="op" id="5376851">,</span>&nbsp;<span class="ident" id="5376853">src</span>&nbsp;<span class="op" id="5376857">+</span>&nbsp;<span class="ident" id="5376859">i</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5376862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5376866">//&nbsp;Consume&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;characters&nbsp;possible,&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5376930">//&nbsp;consumed&nbsp;characters&nbsp;matching&nbsp;one&nbsp;of&nbsp;the&nbsp;named&nbsp;references.</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5376993">for</span>&nbsp;<span class="ident" id="5376997">i</span>&nbsp;<span class="op" id="5376999">&lt;</span>&nbsp;<span class="builtinfunc" id="5377001">len</span><span class="op" id="5377004">(</span><span class="ident" id="5377005">s</span><span class="op" id="5377006">)</span>&nbsp;<span class="op" id="5377008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5377012">c</span>&nbsp;<span class="op" id="5377014">:=</span>&nbsp;<span class="ident" id="5377017">s</span><span class="op" id="5377018">[</span><span class="ident" id="5377019">i</span><span class="op" id="5377020">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5377024">i</span><span class="op" id="5377025">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5377030">//&nbsp;Lower-cased&nbsp;characters&nbsp;are&nbsp;more&nbsp;common&nbsp;in&nbsp;entities,&nbsp;so&nbsp;we&nbsp;check&nbsp;for&nbsp;them&nbsp;first.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5377115">if</span>&nbsp;<span class="string" id="5377118">&#39;a&#39;</span>&nbsp;<span class="op" id="5377122">&lt;=</span>&nbsp;<span class="ident" id="5377125">c</span>&nbsp;<span class="op" id="5377127">&amp;&amp;</span>&nbsp;<span class="ident" id="5377130">c</span>&nbsp;<span class="op" id="5377132">&lt;=</span>&nbsp;<span class="string" id="5377135">&#39;z&#39;</span>&nbsp;<span class="op" id="5377139">||</span>&nbsp;<span class="string" id="5377142">&#39;A&#39;</span>&nbsp;<span class="op" id="5377146">&lt;=</span>&nbsp;<span class="ident" id="5377149">c</span>&nbsp;<span class="op" id="5377151">&amp;&amp;</span>&nbsp;<span class="ident" id="5377154">c</span>&nbsp;<span class="op" id="5377156">&lt;=</span>&nbsp;<span class="string" id="5377159">&#39;Z&#39;</span>&nbsp;<span class="op" id="5377163">||</span>&nbsp;<span class="string" id="5377166">&#39;0&#39;</span>&nbsp;<span class="op" id="5377170">&lt;=</span>&nbsp;<span class="ident" id="5377173">c</span>&nbsp;<span class="op" id="5377175">&amp;&amp;</span>&nbsp;<span class="ident" id="5377178">c</span>&nbsp;<span class="op" id="5377180">&lt;=</span>&nbsp;<span class="string" id="5377183">&#39;9&#39;</span>&nbsp;<span class="op" id="5377187">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5377192">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5377203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5377207">if</span>&nbsp;<span class="ident" id="5377210">c</span>&nbsp;<span class="op" id="5377212">!=</span>&nbsp;<span class="string" id="5377215">&#39;;&#39;</span>&nbsp;<span class="op" id="5377219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5377224">i</span><span class="op" id="5377225">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5377230">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5377234">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5377241">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5377245">entityName</span>&nbsp;<span class="op" id="5377256">:=</span>&nbsp;<span class="builtintype" id="5377259">string</span><span class="op" id="5377265">(</span><span class="ident" id="5377266">s</span><span class="op" id="5377267">[</span><span class="num" id="5377268">1</span><span class="op" id="5377269">:</span><span class="ident" id="5377270">i</span><span class="op" id="5377271">]</span><span class="op" id="5377272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5377275">if</span>&nbsp;<span class="ident" id="5377278">entityName</span>&nbsp;<span class="op" id="5377289">==</span>&nbsp;<span class="string" id="5377292">&#34;&#34;</span>&nbsp;<span class="op" id="5377295">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5377299">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5377310">}</span>&nbsp;<span class="keyword" id="5377312">else</span>&nbsp;<span class="keyword" id="5377317">if</span>&nbsp;<span class="ident" id="5377320">attribute</span>&nbsp;<span class="op" id="5377330">&amp;&amp;</span>&nbsp;<span class="ident" id="5377333">entityName</span><span class="op" id="5377343">[</span><span class="builtinfunc" id="5377344">len</span><span class="op" id="5377347">(</span><span class="ident" id="5377348">entityName</span><span class="op" id="5377358">)</span><span class="op" id="5377359">-</span><span class="num" id="5377360">1</span><span class="op" id="5377361">]</span>&nbsp;<span class="op" id="5377363">!=</span>&nbsp;<span class="string" id="5377366">&#39;;&#39;</span>&nbsp;<span class="op" id="5377370">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5377373">len</span><span class="op" id="5377376">(</span><span class="ident" id="5377377">s</span><span class="op" id="5377378">)</span>&nbsp;<span class="op" id="5377380">&gt;</span>&nbsp;<span class="ident" id="5377382">i</span>&nbsp;<span class="op" id="5377384">&amp;&amp;</span>&nbsp;<span class="ident" id="5377387">s</span><span class="op" id="5377388">[</span><span class="ident" id="5377389">i</span><span class="op" id="5377390">]</span>&nbsp;<span class="op" id="5377392">==</span>&nbsp;<span class="string" id="5377395">&#39;=&#39;</span>&nbsp;<span class="op" id="5377399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5377403">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5377414">}</span>&nbsp;<span class="keyword" id="5377416">else</span>&nbsp;<span class="keyword" id="5377421">if</span>&nbsp;<span class="ident" id="5377424">x</span>&nbsp;<span class="op" id="5377426">:=</span>&nbsp;<span class="ident" id="5377429">entity</span><span class="op" id="5377435">[</span><span class="ident" id="5377436">entityName</span><span class="op" id="5377446">]</span><span class="op" id="5377447">;</span>&nbsp;<span class="ident" id="5377449">x</span>&nbsp;<span class="op" id="5377451">!=</span>&nbsp;<span class="num" id="5377454">0</span>&nbsp;<span class="op" id="5377456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5377460">return</span>&nbsp;<span class="ident" id="5377467">dst</span>&nbsp;<span class="op" id="5377471">+</span>&nbsp;<span class="ident" id="5377473">utf8</span><span class="op" id="5377477">.</span><span class="ident" id="5377478">EncodeRune</span><span class="op" id="5377488">(</span><span class="ident" id="5377489">b</span><span class="op" id="5377490">[</span><span class="ident" id="5377491">dst</span><span class="op" id="5377494">:</span><span class="op" id="5377495">]</span><span class="op" id="5377496">,</span>&nbsp;<span class="ident" id="5377498">x</span><span class="op" id="5377499">)</span><span class="op" id="5377500">,</span>&nbsp;<span class="ident" id="5377502">src</span>&nbsp;<span class="op" id="5377506">+</span>&nbsp;<span class="ident" id="5377508">i</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5377511">}</span>&nbsp;<span class="keyword" id="5377513">else</span>&nbsp;<span class="keyword" id="5377518">if</span>&nbsp;<span class="ident" id="5377521">x</span>&nbsp;<span class="op" id="5377523">:=</span>&nbsp;<span class="ident" id="5377526">entity2</span><span class="op" id="5377533">[</span><span class="ident" id="5377534">entityName</span><span class="op" id="5377544">]</span><span class="op" id="5377545">;</span>&nbsp;<span class="ident" id="5377547">x</span><span class="op" id="5377548">[</span><span class="num" id="5377549">0</span><span class="op" id="5377550">]</span>&nbsp;<span class="op" id="5377552">!=</span>&nbsp;<span class="num" id="5377555">0</span>&nbsp;<span class="op" id="5377557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5377561">dst1</span>&nbsp;<span class="op" id="5377566">:=</span>&nbsp;<span class="ident" id="5377569">dst</span>&nbsp;<span class="op" id="5377573">+</span>&nbsp;<span class="ident" id="5377575">utf8</span><span class="op" id="5377579">.</span><span class="ident" id="5377580">EncodeRune</span><span class="op" id="5377590">(</span><span class="ident" id="5377591">b</span><span class="op" id="5377592">[</span><span class="ident" id="5377593">dst</span><span class="op" id="5377596">:</span><span class="op" id="5377597">]</span><span class="op" id="5377598">,</span>&nbsp;<span class="ident" id="5377600">x</span><span class="op" id="5377601">[</span><span class="num" id="5377602">0</span><span class="op" id="5377603">]</span><span class="op" id="5377604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5377608">return</span>&nbsp;<span class="ident" id="5377615">dst1</span>&nbsp;<span class="op" id="5377620">+</span>&nbsp;<span class="ident" id="5377622">utf8</span><span class="op" id="5377626">.</span><span class="ident" id="5377627">EncodeRune</span><span class="op" id="5377637">(</span><span class="ident" id="5377638">b</span><span class="op" id="5377639">[</span><span class="ident" id="5377640">dst1</span><span class="op" id="5377644">:</span><span class="op" id="5377645">]</span><span class="op" id="5377646">,</span>&nbsp;<span class="ident" id="5377648">x</span><span class="op" id="5377649">[</span><span class="num" id="5377650">1</span><span class="op" id="5377651">]</span><span class="op" id="5377652">)</span><span class="op" id="5377653">,</span>&nbsp;<span class="ident" id="5377655">src</span>&nbsp;<span class="op" id="5377659">+</span>&nbsp;<span class="ident" id="5377661">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5377664">}</span>&nbsp;<span class="keyword" id="5377666">else</span>&nbsp;<span class="keyword" id="5377671">if</span>&nbsp;<span class="op" id="5377674">!</span><span class="ident" id="5377675">attribute</span>&nbsp;<span class="op" id="5377685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5377689">maxLen</span>&nbsp;<span class="op" id="5377696">:=</span>&nbsp;<span class="builtinfunc" id="5377699">len</span><span class="op" id="5377702">(</span><span class="ident" id="5377703">entityName</span><span class="op" id="5377713">)</span>&nbsp;<span class="op" id="5377715">-</span>&nbsp;<span class="num" id="5377717">1</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5377721">if</span>&nbsp;<span class="ident" id="5377724">maxLen</span>&nbsp;<span class="op" id="5377731">&gt;</span>&nbsp;<span class="ident" id="5377733">longestEntityWithoutSemicolon</span>&nbsp;<span class="op" id="5377763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5377768">maxLen</span>&nbsp;<span class="op" id="5377775">=</span>&nbsp;<span class="ident" id="5377777">longestEntityWithoutSemicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5377809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5377813">for</span>&nbsp;<span class="ident" id="5377817">j</span>&nbsp;<span class="op" id="5377819">:=</span>&nbsp;<span class="ident" id="5377822">maxLen</span><span class="op" id="5377828">;</span>&nbsp;<span class="ident" id="5377830">j</span>&nbsp;<span class="op" id="5377832">&gt;</span>&nbsp;<span class="num" id="5377834">1</span><span class="op" id="5377835">;</span>&nbsp;<span class="ident" id="5377837">j</span><span class="op" id="5377838">--</span>&nbsp;<span class="op" id="5377841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5377846">if</span>&nbsp;<span class="ident" id="5377849">x</span>&nbsp;<span class="op" id="5377851">:=</span>&nbsp;<span class="ident" id="5377854">entity</span><span class="op" id="5377860">[</span><span class="ident" id="5377861">entityName</span><span class="op" id="5377871">[</span><span class="op" id="5377872">:</span><span class="ident" id="5377873">j</span><span class="op" id="5377874">]</span><span class="op" id="5377875">]</span><span class="op" id="5377876">;</span>&nbsp;<span class="ident" id="5377878">x</span>&nbsp;<span class="op" id="5377880">!=</span>&nbsp;<span class="num" id="5377883">0</span>&nbsp;<span class="op" id="5377885">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5377891">return</span>&nbsp;<span class="ident" id="5377898">dst</span>&nbsp;<span class="op" id="5377902">+</span>&nbsp;<span class="ident" id="5377904">utf8</span><span class="op" id="5377908">.</span><span class="ident" id="5377909">EncodeRune</span><span class="op" id="5377919">(</span><span class="ident" id="5377920">b</span><span class="op" id="5377921">[</span><span class="ident" id="5377922">dst</span><span class="op" id="5377925">:</span><span class="op" id="5377926">]</span><span class="op" id="5377927">,</span>&nbsp;<span class="ident" id="5377929">x</span><span class="op" id="5377930">)</span><span class="op" id="5377931">,</span>&nbsp;<span class="ident" id="5377933">src</span>&nbsp;<span class="op" id="5377937">+</span>&nbsp;<span class="ident" id="5377939">j</span>&nbsp;<span class="op" id="5377941">+</span>&nbsp;<span class="num" id="5377943">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5377948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5377952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5377955">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5377959">dst1</span><span class="op" id="5377963">,</span>&nbsp;<span class="ident" id="5377965">src1</span>&nbsp;<span class="op" id="5377970">=</span>&nbsp;<span class="ident" id="5377972">dst</span><span class="op" id="5377975">+</span><span class="ident" id="5377976">i</span><span class="op" id="5377977">,</span>&nbsp;<span class="ident" id="5377979">src</span><span class="op" id="5377982">+</span><span class="ident" id="5377983">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5377986">copy</span><span class="op" id="5377990">(</span><span class="ident" id="5377991">b</span><span class="op" id="5377992">[</span><span class="ident" id="5377993">dst</span><span class="op" id="5377996">:</span><span class="ident" id="5377997">dst1</span><span class="op" id="5378001">]</span><span class="op" id="5378002">,</span>&nbsp;<span class="ident" id="5378004">b</span><span class="op" id="5378005">[</span><span class="ident" id="5378006">src</span><span class="op" id="5378009">:</span><span class="ident" id="5378010">src1</span><span class="op" id="5378014">]</span><span class="op" id="5378015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5378018">return</span>&nbsp;<span class="ident" id="5378025">dst1</span><span class="op" id="5378029">,</span>&nbsp;<span class="ident" id="5378031">src1</span><br>
<span class="lineno"></span><span class="op" id="5378036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="comment" id="5378039">//&nbsp;unescape&nbsp;unescapes&nbsp;b&#39;s&nbsp;entities&nbsp;in-place,&nbsp;so&nbsp;that&nbsp;&#34;a&amp;lt;b&#34;&nbsp;becomes&nbsp;&#34;a&lt;b&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="5378116">func</span>&nbsp;<span class="ident" id="5378121">unescape</span><span class="op" id="5378129">(</span><span class="ident" id="5378130">b</span>&nbsp;<span class="op" id="5378132">[</span><span class="op" id="5378133">]</span><span class="builtintype" id="5378134">byte</span><span class="op" id="5378138">)</span>&nbsp;<span class="op" id="5378140">[</span><span class="op" id="5378141">]</span><span class="builtintype" id="5378142">byte</span>&nbsp;<span class="op" id="5378147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5378150">for</span>&nbsp;<span class="ident" id="5378154">i</span><span class="op" id="5378155">,</span>&nbsp;<span class="ident" id="5378157">c</span>&nbsp;<span class="op" id="5378159">:=</span>&nbsp;<span class="keyword" id="5378162">range</span>&nbsp;<span class="ident" id="5378168">b</span>&nbsp;<span class="op" id="5378170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5378174">if</span>&nbsp;<span class="ident" id="5378177">c</span>&nbsp;<span class="op" id="5378179">==</span>&nbsp;<span class="string" id="5378182">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="5378186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5378191">dst</span><span class="op" id="5378194">,</span>&nbsp;<span class="ident" id="5378196">src</span>&nbsp;<span class="op" id="5378200">:=</span>&nbsp;<span class="ident" id="5378203">unescapeEntity</span><span class="op" id="5378217">(</span><span class="ident" id="5378218">b</span><span class="op" id="5378219">,</span>&nbsp;<span class="ident" id="5378221">i</span><span class="op" id="5378222">,</span>&nbsp;<span class="ident" id="5378224">i</span><span class="op" id="5378225">,</span>&nbsp;<span class="builtintype" id="5378227">false</span><span class="op" id="5378232">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5378237">for</span>&nbsp;<span class="ident" id="5378241">src</span>&nbsp;<span class="op" id="5378245">&lt;</span>&nbsp;<span class="builtinfunc" id="5378247">len</span><span class="op" id="5378250">(</span><span class="ident" id="5378251">b</span><span class="op" id="5378252">)</span>&nbsp;<span class="op" id="5378254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5378260">c</span>&nbsp;<span class="op" id="5378262">:=</span>&nbsp;<span class="ident" id="5378265">b</span><span class="op" id="5378266">[</span><span class="ident" id="5378267">src</span><span class="op" id="5378270">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5378276">if</span>&nbsp;<span class="ident" id="5378279">c</span>&nbsp;<span class="op" id="5378281">==</span>&nbsp;<span class="string" id="5378284">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="5378288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5378295">dst</span><span class="op" id="5378298">,</span>&nbsp;<span class="ident" id="5378300">src</span>&nbsp;<span class="op" id="5378304">=</span>&nbsp;<span class="ident" id="5378306">unescapeEntity</span><span class="op" id="5378320">(</span><span class="ident" id="5378321">b</span><span class="op" id="5378322">,</span>&nbsp;<span class="ident" id="5378324">dst</span><span class="op" id="5378327">,</span>&nbsp;<span class="ident" id="5378329">src</span><span class="op" id="5378332">,</span>&nbsp;<span class="builtintype" id="5378334">false</span><span class="op" id="5378339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5378345">}</span>&nbsp;<span class="keyword" id="5378347">else</span>&nbsp;<span class="op" id="5378352">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5378359">b</span><span class="op" id="5378360">[</span><span class="ident" id="5378361">dst</span><span class="op" id="5378364">]</span>&nbsp;<span class="op" id="5378366">=</span>&nbsp;<span class="ident" id="5378368">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5378375">dst</span><span class="op" id="5378378">,</span>&nbsp;<span class="ident" id="5378380">src</span>&nbsp;<span class="op" id="5378384">=</span>&nbsp;<span class="ident" id="5378386">dst</span><span class="op" id="5378389">+</span><span class="num" id="5378390">1</span><span class="op" id="5378391">,</span>&nbsp;<span class="ident" id="5378393">src</span><span class="op" id="5378396">+</span><span class="num" id="5378397">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5378403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5378408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5378413">return</span>&nbsp;<span class="ident" id="5378420">b</span><span class="op" id="5378421">[</span><span class="num" id="5378422">0</span><span class="op" id="5378423">:</span><span class="ident" id="5378424">dst</span><span class="op" id="5378427">]</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5378431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5378434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5378437">return</span>&nbsp;<span class="ident" id="5378444">b</span><br>
<span class="lineno"></span><span class="op" id="5378446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="5378449">const</span>&nbsp;<span class="ident" id="5378455">escapedChars</span>&nbsp;<span class="op" id="5378468">=</span>&nbsp;<span class="string" id="5378470">`&amp;&#39;&lt;&gt;&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5378479">func</span>&nbsp;<span class="ident" id="5378484">escape</span><span class="op" id="5378490">(</span><span class="ident" id="5378491">w</span>&nbsp;<span class="ident" id="5378493">writer</span><span class="op" id="5378499">,</span>&nbsp;<span class="ident" id="5378501">s</span>&nbsp;<span class="builtintype" id="5378503">string</span><span class="op" id="5378509">)</span>&nbsp;<span class="builtintype" id="5378511">error</span>&nbsp;<span class="op" id="5378517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5378520">i</span>&nbsp;<span class="op" id="5378522">:=</span>&nbsp;<span class="ident" id="5378525">strings</span><span class="op" id="5378532">.</span><span class="ident" id="5378533">IndexAny</span><span class="op" id="5378541">(</span><span class="ident" id="5378542">s</span><span class="op" id="5378543">,</span>&nbsp;<span class="ident" id="5378545">escapedChars</span><span class="op" id="5378557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5378560">for</span>&nbsp;<span class="ident" id="5378564">i</span>&nbsp;<span class="op" id="5378566">!=</span>&nbsp;<span class="op" id="5378569">-</span><span class="num" id="5378570">1</span>&nbsp;<span class="op" id="5378572">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5378576">if</span>&nbsp;<span class="ident" id="5378579">_</span><span class="op" id="5378580">,</span>&nbsp;<span class="ident" id="5378582">err</span>&nbsp;<span class="op" id="5378586">:=</span>&nbsp;<span class="ident" id="5378589">w</span><span class="op" id="5378590">.</span><span class="ident" id="5378591">WriteString</span><span class="op" id="5378602">(</span><span class="ident" id="5378603">s</span><span class="op" id="5378604">[</span><span class="op" id="5378605">:</span><span class="ident" id="5378606">i</span><span class="op" id="5378607">]</span><span class="op" id="5378608">)</span><span class="op" id="5378609">;</span>&nbsp;<span class="ident" id="5378611">err</span>&nbsp;<span class="op" id="5378615">!=</span>&nbsp;<span class="ident" id="5378618">nil</span>&nbsp;<span class="op" id="5378622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5378627">return</span>&nbsp;<span class="ident" id="5378634">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5378640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5378644">var</span>&nbsp;<span class="ident" id="5378648">esc</span>&nbsp;<span class="builtintype" id="5378652">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5378661">switch</span>&nbsp;<span class="ident" id="5378668">s</span><span class="op" id="5378669">[</span><span class="ident" id="5378670">i</span><span class="op" id="5378671">]</span>&nbsp;<span class="op" id="5378673">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5378677">case</span>&nbsp;<span class="string" id="5378682">&#39;&amp;&#39;</span><span class="op" id="5378685">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5378690">esc</span>&nbsp;<span class="op" id="5378694">=</span>&nbsp;<span class="string" id="5378696">&#34;&amp;amp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5378706">case</span>&nbsp;<span class="string" id="5378711">&#39;\&#39;&#39;</span><span class="op" id="5378715">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5378720">//&nbsp;&#34;&amp;#39;&#34;&nbsp;is&nbsp;shorter&nbsp;than&nbsp;&#34;&amp;apos;&#34;&nbsp;and&nbsp;apos&nbsp;was&nbsp;not&nbsp;in&nbsp;HTML&nbsp;until&nbsp;HTML5.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5378797">esc</span>&nbsp;<span class="op" id="5378801">=</span>&nbsp;<span class="string" id="5378803">&#34;&amp;#39;&#34;</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5378813">case</span>&nbsp;<span class="string" id="5378818">&#39;&lt;&#39;</span><span class="op" id="5378821">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5378826">esc</span>&nbsp;<span class="op" id="5378830">=</span>&nbsp;<span class="string" id="5378832">&#34;&amp;lt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5378841">case</span>&nbsp;<span class="string" id="5378846">&#39;&gt;&#39;</span><span class="op" id="5378849">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5378854">esc</span>&nbsp;<span class="op" id="5378858">=</span>&nbsp;<span class="string" id="5378860">&#34;&amp;gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5378869">case</span>&nbsp;<span class="string" id="5378874">&#39;&#34;&#39;</span><span class="op" id="5378877">:</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5378882">//&nbsp;&#34;&amp;#34;&#34;&nbsp;is&nbsp;shorter&nbsp;than&nbsp;&#34;&amp;quot;&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5378922">esc</span>&nbsp;<span class="op" id="5378926">=</span>&nbsp;<span class="string" id="5378928">&#34;&amp;#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5378938">default</span><span class="op" id="5378945">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5378950">panic</span><span class="op" id="5378955">(</span><span class="string" id="5378956">&#34;unrecognized&nbsp;escape&nbsp;character&#34;</span><span class="op" id="5378987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5378991">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5378995">s</span>&nbsp;<span class="op" id="5378997">=</span>&nbsp;<span class="ident" id="5378999">s</span><span class="op" id="5379000">[</span><span class="ident" id="5379001">i</span><span class="op" id="5379002">+</span><span class="num" id="5379003">1</span><span class="op" id="5379004">:</span><span class="op" id="5379005">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5379009">if</span>&nbsp;<span class="ident" id="5379012">_</span><span class="op" id="5379013">,</span>&nbsp;<span class="ident" id="5379015">err</span>&nbsp;<span class="op" id="5379019">:=</span>&nbsp;<span class="ident" id="5379022">w</span><span class="op" id="5379023">.</span><span class="ident" id="5379024">WriteString</span><span class="op" id="5379035">(</span><span class="ident" id="5379036">esc</span><span class="op" id="5379039">)</span><span class="op" id="5379040">;</span>&nbsp;<span class="ident" id="5379042">err</span>&nbsp;<span class="op" id="5379046">!=</span>&nbsp;<span class="ident" id="5379049">nil</span>&nbsp;<span class="op" id="5379053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5379058">return</span>&nbsp;<span class="ident" id="5379065">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5379071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5379075">i</span>&nbsp;<span class="op" id="5379077">=</span>&nbsp;<span class="ident" id="5379079">strings</span><span class="op" id="5379086">.</span><span class="ident" id="5379087">IndexAny</span><span class="op" id="5379095">(</span><span class="ident" id="5379096">s</span><span class="op" id="5379097">,</span>&nbsp;<span class="ident" id="5379099">escapedChars</span><span class="op" id="5379111">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5379114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5379117">_</span><span class="op" id="5379118">,</span>&nbsp;<span class="ident" id="5379120">err</span>&nbsp;<span class="op" id="5379124">:=</span>&nbsp;<span class="ident" id="5379127">w</span><span class="op" id="5379128">.</span><span class="ident" id="5379129">WriteString</span><span class="op" id="5379140">(</span><span class="ident" id="5379141">s</span><span class="op" id="5379142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5379145">return</span>&nbsp;<span class="ident" id="5379152">err</span><br>
<span class="lineno"></span><span class="op" id="5379156">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span><span class="comment" id="5379159">//&nbsp;EscapeString&nbsp;escapes&nbsp;special&nbsp;characters&nbsp;like&nbsp;&#34;&lt;&#34;&nbsp;to&nbsp;become&nbsp;&#34;&amp;lt;&#34;.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="5379232">//&nbsp;escapes&nbsp;only&nbsp;five&nbsp;such&nbsp;characters:&nbsp;&lt;,&nbsp;&gt;,&nbsp;&amp;,&nbsp;&#39;&nbsp;and&nbsp;&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="5379288">//&nbsp;UnescapeString(EscapeString(s))&nbsp;==&nbsp;s&nbsp;always&nbsp;holds,&nbsp;but&nbsp;the&nbsp;converse&nbsp;isn&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="5379365">//&nbsp;always&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="5379381">func</span>&nbsp;<span class="ident" id="5379386">EscapeString</span><span class="op" id="5379398">(</span><span class="ident" id="5379399">s</span>&nbsp;<span class="builtintype" id="5379401">string</span><span class="op" id="5379407">)</span>&nbsp;<span class="builtintype" id="5379409">string</span>&nbsp;<span class="op" id="5379416">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5379419">if</span>&nbsp;<span class="ident" id="5379422">strings</span><span class="op" id="5379429">.</span><span class="ident" id="5379430">IndexAny</span><span class="op" id="5379438">(</span><span class="ident" id="5379439">s</span><span class="op" id="5379440">,</span>&nbsp;<span class="ident" id="5379442">escapedChars</span><span class="op" id="5379454">)</span>&nbsp;<span class="op" id="5379456">==</span>&nbsp;<span class="op" id="5379459">-</span><span class="num" id="5379460">1</span>&nbsp;<span class="op" id="5379462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5379466">return</span>&nbsp;<span class="ident" id="5379473">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5379476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5379479">var</span>&nbsp;<span class="ident" id="5379483">buf</span>&nbsp;<span class="ident" id="5379487">bytes</span><span class="op" id="5379492">.</span><span class="ident" id="5379493">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5379501">escape</span><span class="op" id="5379507">(</span><span class="op" id="5379508">&amp;</span><span class="ident" id="5379509">buf</span><span class="op" id="5379512">,</span>&nbsp;<span class="ident" id="5379514">s</span><span class="op" id="5379515">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5379518">return</span>&nbsp;<span class="ident" id="5379525">buf</span><span class="op" id="5379528">.</span><span class="ident" id="5379529">String</span><span class="op" id="5379535">(</span><span class="op" id="5379536">)</span><br>
<span class="lineno"></span><span class="op" id="5379538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5379541">//&nbsp;UnescapeString&nbsp;unescapes&nbsp;entities&nbsp;like&nbsp;&#34;&amp;lt;&#34;&nbsp;to&nbsp;become&nbsp;&#34;&lt;&#34;.&nbsp;It&nbsp;unescapes&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5379620">//&nbsp;larger&nbsp;range&nbsp;of&nbsp;entities&nbsp;than&nbsp;EscapeString&nbsp;escapes.&nbsp;For&nbsp;example,&nbsp;&#34;&amp;aacute;&#34;</span><br>
<span class="lineno">240</span><span class="comment" id="5379699">//&nbsp;unescapes&nbsp;to&nbsp;&#34;á&#34;,&nbsp;as&nbsp;does&nbsp;&#34;&amp;#225;&#34;&nbsp;and&nbsp;&#34;&amp;xE1;&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="5379751">//&nbsp;UnescapeString(EscapeString(s))&nbsp;==&nbsp;s&nbsp;always&nbsp;holds,&nbsp;but&nbsp;the&nbsp;converse&nbsp;isn&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="5379828">//&nbsp;always&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="5379844">func</span>&nbsp;<span class="ident" id="5379849">UnescapeString</span><span class="op" id="5379863">(</span><span class="ident" id="5379864">s</span>&nbsp;<span class="builtintype" id="5379866">string</span><span class="op" id="5379872">)</span>&nbsp;<span class="builtintype" id="5379874">string</span>&nbsp;<span class="op" id="5379881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5379884">for</span>&nbsp;<span class="ident" id="5379888">_</span><span class="op" id="5379889">,</span>&nbsp;<span class="ident" id="5379891">c</span>&nbsp;<span class="op" id="5379893">:=</span>&nbsp;<span class="keyword" id="5379896">range</span>&nbsp;<span class="ident" id="5379902">s</span>&nbsp;<span class="op" id="5379904">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5379908">if</span>&nbsp;<span class="ident" id="5379911">c</span>&nbsp;<span class="op" id="5379913">==</span>&nbsp;<span class="string" id="5379916">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="5379920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5379925">return</span>&nbsp;<span class="builtintype" id="5379932">string</span><span class="op" id="5379938">(</span><span class="ident" id="5379939">unescape</span><span class="op" id="5379947">(</span><span class="op" id="5379948">[</span><span class="op" id="5379949">]</span><span class="builtintype" id="5379950">byte</span><span class="op" id="5379954">(</span><span class="ident" id="5379955">s</span><span class="op" id="5379956">)</span><span class="op" id="5379957">)</span><span class="op" id="5379958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5379962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5379965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5379968">return</span>&nbsp;<span class="ident" id="5379975">s</span><br>
<span class="lineno">250</span><span class="op" id="5379977">}</span>
</div>
</body>
</html>
