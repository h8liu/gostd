<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6354356">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6354411">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6354465">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6354516">package</span>&nbsp;<span class="ident" id="6354524">testing</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6354533">import</span>&nbsp;<span class="op" id="6354540">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6354543">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6354551">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6354558">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6354564">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6354575">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6354583">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6354598">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="6354605">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6354608">var</span>&nbsp;<span class="ident" id="6354612">matchBenchmarks</span>&nbsp;<span class="op" id="6354628">=</span>&nbsp;<span class="ident" id="6354630">flag</span><span class="op" id="6354634">.</span><span class="ident" id="6354635">String</span><span class="op" id="6354641">(</span><span class="string" id="6354642">&#34;test.bench&#34;</span><span class="op" id="6354654">,</span>&nbsp;<span class="string" id="6354656">&#34;&#34;</span><span class="op" id="6354658">,</span>&nbsp;<span class="string" id="6354660">&#34;regular&nbsp;expression&nbsp;to&nbsp;select&nbsp;benchmarks&nbsp;to&nbsp;run&#34;</span><span class="op" id="6354708">)</span><br>
<span class="lineno"></span><span class="keyword" id="6354710">var</span>&nbsp;<span class="ident" id="6354714">benchTime</span>&nbsp;<span class="op" id="6354724">=</span>&nbsp;<span class="ident" id="6354726">flag</span><span class="op" id="6354730">.</span><span class="ident" id="6354731">Duration</span><span class="op" id="6354739">(</span><span class="string" id="6354740">&#34;test.benchtime&#34;</span><span class="op" id="6354756">,</span>&nbsp;<span class="num" id="6354758">1</span><span class="op" id="6354759">*</span><span class="ident" id="6354760">time</span><span class="op" id="6354764">.</span><span class="ident" id="6354765">Second</span><span class="op" id="6354771">,</span>&nbsp;<span class="string" id="6354773">&#34;approximate&nbsp;run&nbsp;time&nbsp;for&nbsp;each&nbsp;benchmark&#34;</span><span class="op" id="6354814">)</span><br>
<span class="lineno"></span><span class="keyword" id="6354816">var</span>&nbsp;<span class="ident" id="6354820">benchmarkMemory</span>&nbsp;<span class="op" id="6354836">=</span>&nbsp;<span class="ident" id="6354838">flag</span><span class="op" id="6354842">.</span><span class="ident" id="6354843">Bool</span><span class="op" id="6354847">(</span><span class="string" id="6354848">&#34;test.benchmem&#34;</span><span class="op" id="6354863">,</span>&nbsp;<span class="builtintype" id="6354865">false</span><span class="op" id="6354870">,</span>&nbsp;<span class="string" id="6354872">&#34;print&nbsp;memory&nbsp;allocations&nbsp;for&nbsp;benchmarks&#34;</span><span class="op" id="6354913">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="6354916">//&nbsp;Global&nbsp;lock&nbsp;to&nbsp;ensure&nbsp;only&nbsp;one&nbsp;benchmark&nbsp;runs&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="6354976">var</span>&nbsp;<span class="ident" id="6354980">benchmarkLock</span>&nbsp;<span class="ident" id="6354994">sync</span><span class="op" id="6354998">.</span><span class="ident" id="6354999">Mutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6355006">//&nbsp;Used&nbsp;for&nbsp;every&nbsp;benchmark&nbsp;for&nbsp;measuring&nbsp;memory.</span><br>
<span class="lineno">25</span><span class="keyword" id="6355056">var</span>&nbsp;<span class="ident" id="6355060">memStats</span>&nbsp;<span class="ident" id="6355069">runtime</span><span class="op" id="6355076">.</span><span class="ident" id="6355077">MemStats</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6355087">//&nbsp;An&nbsp;internal&nbsp;type&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="6355176">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="6355205">type</span>&nbsp;<span class="ident" id="6355210">InternalBenchmark</span>&nbsp;<span class="keyword" id="6355228">struct</span>&nbsp;<span class="op" id="6355235">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6355238">Name</span>&nbsp;<span class="builtintype" id="6355243">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6355251">F</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6355256">func</span><span class="op" id="6355260">(</span><span class="ident" id="6355261">b</span>&nbsp;<span class="op" id="6355263">*</span><span class="ident" id="6355264">B</span><span class="op" id="6355265">)</span><br>
<span class="lineno"></span><span class="op" id="6355267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6355270">//&nbsp;B&nbsp;is&nbsp;a&nbsp;type&nbsp;passed&nbsp;to&nbsp;Benchmark&nbsp;functions&nbsp;to&nbsp;manage&nbsp;benchmark</span><br>
<span class="lineno">35</span><span class="comment" id="6355335">//&nbsp;timing&nbsp;and&nbsp;to&nbsp;specify&nbsp;the&nbsp;number&nbsp;of&nbsp;iterations&nbsp;to&nbsp;run.</span><br>
<span class="lineno"></span><span class="keyword" id="6355393">type</span>&nbsp;<span class="ident" id="6355398">B</span>&nbsp;<span class="keyword" id="6355400">struct</span>&nbsp;<span class="op" id="6355407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6355410">common</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6355418">N</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6355435">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6355440">previousN</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6355457">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6355471">//&nbsp;number&nbsp;of&nbsp;iterations&nbsp;in&nbsp;the&nbsp;previous&nbsp;run</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6355516">previousDuration</span>&nbsp;<span class="ident" id="6355533">time</span><span class="op" id="6355537">.</span><span class="ident" id="6355538">Duration</span>&nbsp;<span class="comment" id="6355547">//&nbsp;total&nbsp;duration&nbsp;of&nbsp;the&nbsp;previous&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6355586">benchmark</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6355603">InternalBenchmark</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6355622">bytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6355639">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6355646">timerOn</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6355663">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6355669">showAllocResult</span>&nbsp;&nbsp;<span class="builtintype" id="6355686">bool</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6355692">result</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6355709">BenchmarkResult</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6355726">parallelism</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6355743">int</span>&nbsp;<span class="comment" id="6355747">//&nbsp;RunParallel&nbsp;creates&nbsp;parallelism*GOMAXPROCS&nbsp;goroutines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6355805">//&nbsp;The&nbsp;initial&nbsp;states&nbsp;of&nbsp;memStats.Mallocs&nbsp;and&nbsp;memStats.TotalAlloc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6355873">startAllocs</span>&nbsp;<span class="ident" id="6355885">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6355893">startBytes</span>&nbsp;&nbsp;<span class="ident" id="6355905">uint64</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6355913">//&nbsp;The&nbsp;net&nbsp;total&nbsp;of&nbsp;this&nbsp;test&nbsp;after&nbsp;being&nbsp;run.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6355961">netAllocs</span>&nbsp;<span class="ident" id="6355971">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6355979">netBytes</span>&nbsp;&nbsp;<span class="ident" id="6355989">uint64</span><br>
<span class="lineno"></span><span class="op" id="6355996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="6355999">//&nbsp;StartTimer&nbsp;starts&nbsp;timing&nbsp;a&nbsp;test.&nbsp;&nbsp;This&nbsp;function&nbsp;is&nbsp;called&nbsp;automatically</span><br>
<span class="lineno"></span><span class="comment" id="6356074">//&nbsp;before&nbsp;a&nbsp;benchmark&nbsp;starts,&nbsp;but&nbsp;it&nbsp;can&nbsp;also&nbsp;used&nbsp;to&nbsp;resume&nbsp;timing&nbsp;after</span><br>
<span class="lineno"></span><span class="comment" id="6356148">//&nbsp;a&nbsp;call&nbsp;to&nbsp;StopTimer.</span><br>
<span class="lineno"></span><span class="keyword" id="6356172">func</span>&nbsp;<span class="op" id="6356177">(</span><span class="ident" id="6356178">b</span>&nbsp;<span class="op" id="6356180">*</span><span class="ident" id="6356181">B</span><span class="op" id="6356182">)</span>&nbsp;<span class="ident" id="6356184">StartTimer</span><span class="op" id="6356194">(</span><span class="op" id="6356195">)</span>&nbsp;<span class="op" id="6356197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6356200">if</span>&nbsp;<span class="op" id="6356203">!</span><span class="ident" id="6356204">b</span><span class="op" id="6356205">.</span><span class="ident" id="6356206">timerOn</span>&nbsp;<span class="op" id="6356214">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6356218">runtime</span><span class="op" id="6356225">.</span><span class="ident" id="6356226">ReadMemStats</span><span class="op" id="6356238">(</span><span class="op" id="6356239">&amp;</span><span class="ident" id="6356240">memStats</span><span class="op" id="6356248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6356252">b</span><span class="op" id="6356253">.</span><span class="ident" id="6356254">startAllocs</span>&nbsp;<span class="op" id="6356266">=</span>&nbsp;<span class="ident" id="6356268">memStats</span><span class="op" id="6356276">.</span><span class="ident" id="6356277">Mallocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6356287">b</span><span class="op" id="6356288">.</span><span class="ident" id="6356289">startBytes</span>&nbsp;<span class="op" id="6356300">=</span>&nbsp;<span class="ident" id="6356302">memStats</span><span class="op" id="6356310">.</span><span class="ident" id="6356311">TotalAlloc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6356324">b</span><span class="op" id="6356325">.</span><span class="ident" id="6356326">start</span>&nbsp;<span class="op" id="6356332">=</span>&nbsp;<span class="ident" id="6356334">time</span><span class="op" id="6356338">.</span><span class="ident" id="6356339">Now</span><span class="op" id="6356342">(</span><span class="op" id="6356343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6356347">b</span><span class="op" id="6356348">.</span><span class="ident" id="6356349">timerOn</span>&nbsp;<span class="op" id="6356357">=</span>&nbsp;<span class="builtintype" id="6356359">true</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6356365">}</span><br>
<span class="lineno"></span><span class="op" id="6356367">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6356370">//&nbsp;StopTimer&nbsp;stops&nbsp;timing&nbsp;a&nbsp;test.&nbsp;&nbsp;This&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;pause&nbsp;the&nbsp;timer</span><br>
<span class="lineno"></span><span class="comment" id="6356441">//&nbsp;while&nbsp;performing&nbsp;complex&nbsp;initialization&nbsp;that&nbsp;you&nbsp;don&#39;t</span><br>
<span class="lineno">70</span><span class="comment" id="6356499">//&nbsp;want&nbsp;to&nbsp;measure.</span><br>
<span class="lineno"></span><span class="keyword" id="6356519">func</span>&nbsp;<span class="op" id="6356524">(</span><span class="ident" id="6356525">b</span>&nbsp;<span class="op" id="6356527">*</span><span class="ident" id="6356528">B</span><span class="op" id="6356529">)</span>&nbsp;<span class="ident" id="6356531">StopTimer</span><span class="op" id="6356540">(</span><span class="op" id="6356541">)</span>&nbsp;<span class="op" id="6356543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6356546">if</span>&nbsp;<span class="ident" id="6356549">b</span><span class="op" id="6356550">.</span><span class="ident" id="6356551">timerOn</span>&nbsp;<span class="op" id="6356559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6356563">b</span><span class="op" id="6356564">.</span><span class="ident" id="6356565">duration</span>&nbsp;<span class="op" id="6356574">+=</span>&nbsp;<span class="ident" id="6356577">time</span><span class="op" id="6356581">.</span><span class="ident" id="6356582">Now</span><span class="op" id="6356585">(</span><span class="op" id="6356586">)</span><span class="op" id="6356587">.</span><span class="ident" id="6356588">Sub</span><span class="op" id="6356591">(</span><span class="ident" id="6356592">b</span><span class="op" id="6356593">.</span><span class="ident" id="6356594">start</span><span class="op" id="6356599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6356603">runtime</span><span class="op" id="6356610">.</span><span class="ident" id="6356611">ReadMemStats</span><span class="op" id="6356623">(</span><span class="op" id="6356624">&amp;</span><span class="ident" id="6356625">memStats</span><span class="op" id="6356633">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6356637">b</span><span class="op" id="6356638">.</span><span class="ident" id="6356639">netAllocs</span>&nbsp;<span class="op" id="6356649">+=</span>&nbsp;<span class="ident" id="6356652">memStats</span><span class="op" id="6356660">.</span><span class="ident" id="6356661">Mallocs</span>&nbsp;<span class="op" id="6356669">-</span>&nbsp;<span class="ident" id="6356671">b</span><span class="op" id="6356672">.</span><span class="ident" id="6356673">startAllocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6356687">b</span><span class="op" id="6356688">.</span><span class="ident" id="6356689">netBytes</span>&nbsp;<span class="op" id="6356698">+=</span>&nbsp;<span class="ident" id="6356701">memStats</span><span class="op" id="6356709">.</span><span class="ident" id="6356710">TotalAlloc</span>&nbsp;<span class="op" id="6356721">-</span>&nbsp;<span class="ident" id="6356723">b</span><span class="op" id="6356724">.</span><span class="ident" id="6356725">startBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6356738">b</span><span class="op" id="6356739">.</span><span class="ident" id="6356740">timerOn</span>&nbsp;<span class="op" id="6356748">=</span>&nbsp;<span class="builtintype" id="6356750">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6356757">}</span><br>
<span class="lineno"></span><span class="op" id="6356759">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="6356762">//&nbsp;ResetTimer&nbsp;zeros&nbsp;the&nbsp;elapsed&nbsp;benchmark&nbsp;time&nbsp;and&nbsp;memory&nbsp;allocation&nbsp;counters.</span><br>
<span class="lineno"></span><span class="comment" id="6356841">//&nbsp;It&nbsp;does&nbsp;not&nbsp;affect&nbsp;whether&nbsp;the&nbsp;timer&nbsp;is&nbsp;running.</span><br>
<span class="lineno"></span><span class="keyword" id="6356893">func</span>&nbsp;<span class="op" id="6356898">(</span><span class="ident" id="6356899">b</span>&nbsp;<span class="op" id="6356901">*</span><span class="ident" id="6356902">B</span><span class="op" id="6356903">)</span>&nbsp;<span class="ident" id="6356905">ResetTimer</span><span class="op" id="6356915">(</span><span class="op" id="6356916">)</span>&nbsp;<span class="op" id="6356918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6356921">if</span>&nbsp;<span class="ident" id="6356924">b</span><span class="op" id="6356925">.</span><span class="ident" id="6356926">timerOn</span>&nbsp;<span class="op" id="6356934">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6356938">runtime</span><span class="op" id="6356945">.</span><span class="ident" id="6356946">ReadMemStats</span><span class="op" id="6356958">(</span><span class="op" id="6356959">&amp;</span><span class="ident" id="6356960">memStats</span><span class="op" id="6356968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6356972">b</span><span class="op" id="6356973">.</span><span class="ident" id="6356974">startAllocs</span>&nbsp;<span class="op" id="6356986">=</span>&nbsp;<span class="ident" id="6356988">memStats</span><span class="op" id="6356996">.</span><span class="ident" id="6356997">Mallocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6357007">b</span><span class="op" id="6357008">.</span><span class="ident" id="6357009">startBytes</span>&nbsp;<span class="op" id="6357020">=</span>&nbsp;<span class="ident" id="6357022">memStats</span><span class="op" id="6357030">.</span><span class="ident" id="6357031">TotalAlloc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6357044">b</span><span class="op" id="6357045">.</span><span class="ident" id="6357046">start</span>&nbsp;<span class="op" id="6357052">=</span>&nbsp;<span class="ident" id="6357054">time</span><span class="op" id="6357058">.</span><span class="ident" id="6357059">Now</span><span class="op" id="6357062">(</span><span class="op" id="6357063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6357066">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6357069">b</span><span class="op" id="6357070">.</span><span class="ident" id="6357071">duration</span>&nbsp;<span class="op" id="6357080">=</span>&nbsp;<span class="num" id="6357082">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6357085">b</span><span class="op" id="6357086">.</span><span class="ident" id="6357087">netAllocs</span>&nbsp;<span class="op" id="6357097">=</span>&nbsp;<span class="num" id="6357099">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6357102">b</span><span class="op" id="6357103">.</span><span class="ident" id="6357104">netBytes</span>&nbsp;<span class="op" id="6357113">=</span>&nbsp;<span class="num" id="6357115">0</span><br>
<span class="lineno"></span><span class="op" id="6357117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="6357120">//&nbsp;SetBytes&nbsp;records&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;processed&nbsp;in&nbsp;a&nbsp;single&nbsp;operation.</span><br>
<span class="lineno"></span><span class="comment" id="6357193">//&nbsp;If&nbsp;this&nbsp;is&nbsp;called,&nbsp;the&nbsp;benchmark&nbsp;will&nbsp;report&nbsp;ns/op&nbsp;and&nbsp;MB/s.</span><br>
<span class="lineno"></span><span class="keyword" id="6357257">func</span>&nbsp;<span class="op" id="6357262">(</span><span class="ident" id="6357263">b</span>&nbsp;<span class="op" id="6357265">*</span><span class="ident" id="6357266">B</span><span class="op" id="6357267">)</span>&nbsp;<span class="ident" id="6357269">SetBytes</span><span class="op" id="6357277">(</span><span class="ident" id="6357278">n</span>&nbsp;<span class="ident" id="6357280">int64</span><span class="op" id="6357285">)</span>&nbsp;<span class="op" id="6357287">{</span>&nbsp;<span class="ident" id="6357289">b</span><span class="op" id="6357290">.</span><span class="ident" id="6357291">bytes</span>&nbsp;<span class="op" id="6357297">=</span>&nbsp;<span class="ident" id="6357299">n</span>&nbsp;<span class="op" id="6357301">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6357304">//&nbsp;ReportAllocs&nbsp;enables&nbsp;malloc&nbsp;statistics&nbsp;for&nbsp;this&nbsp;benchmark.</span><br>
<span class="lineno">100</span><span class="comment" id="6357366">//&nbsp;It&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;setting&nbsp;-test.benchmem,&nbsp;but&nbsp;it&nbsp;only&nbsp;affects&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6357437">//&nbsp;benchmark&nbsp;function&nbsp;that&nbsp;calls&nbsp;ReportAllocs.</span><br>
<span class="lineno"></span><span class="keyword" id="6357484">func</span>&nbsp;<span class="op" id="6357489">(</span><span class="ident" id="6357490">b</span>&nbsp;<span class="op" id="6357492">*</span><span class="ident" id="6357493">B</span><span class="op" id="6357494">)</span>&nbsp;<span class="ident" id="6357496">ReportAllocs</span><span class="op" id="6357508">(</span><span class="op" id="6357509">)</span>&nbsp;<span class="op" id="6357511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6357514">b</span><span class="op" id="6357515">.</span><span class="ident" id="6357516">showAllocResult</span>&nbsp;<span class="op" id="6357532">=</span>&nbsp;<span class="builtintype" id="6357534">true</span><br>
<span class="lineno"></span><span class="op" id="6357539">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="6357542">func</span>&nbsp;<span class="op" id="6357547">(</span><span class="ident" id="6357548">b</span>&nbsp;<span class="op" id="6357550">*</span><span class="ident" id="6357551">B</span><span class="op" id="6357552">)</span>&nbsp;<span class="ident" id="6357554">nsPerOp</span><span class="op" id="6357561">(</span><span class="op" id="6357562">)</span>&nbsp;<span class="ident" id="6357564">int64</span>&nbsp;<span class="op" id="6357570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6357573">if</span>&nbsp;<span class="ident" id="6357576">b</span><span class="op" id="6357577">.</span><span class="ident" id="6357578">N</span>&nbsp;<span class="op" id="6357580">&lt;=</span>&nbsp;<span class="num" id="6357583">0</span>&nbsp;<span class="op" id="6357585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6357589">return</span>&nbsp;<span class="num" id="6357596">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6357599">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6357602">return</span>&nbsp;<span class="ident" id="6357609">b</span><span class="op" id="6357610">.</span><span class="ident" id="6357611">duration</span><span class="op" id="6357619">.</span><span class="ident" id="6357620">Nanoseconds</span><span class="op" id="6357631">(</span><span class="op" id="6357632">)</span>&nbsp;<span class="op" id="6357634">/</span>&nbsp;<span class="ident" id="6357636">int64</span><span class="op" id="6357641">(</span><span class="ident" id="6357642">b</span><span class="op" id="6357643">.</span><span class="ident" id="6357644">N</span><span class="op" id="6357645">)</span><br>
<span class="lineno"></span><span class="op" id="6357647">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6357650">//&nbsp;runN&nbsp;runs&nbsp;a&nbsp;single&nbsp;benchmark&nbsp;for&nbsp;the&nbsp;specified&nbsp;number&nbsp;of&nbsp;iterations.</span><br>
<span class="lineno"></span><span class="keyword" id="6357722">func</span>&nbsp;<span class="op" id="6357727">(</span><span class="ident" id="6357728">b</span>&nbsp;<span class="op" id="6357730">*</span><span class="ident" id="6357731">B</span><span class="op" id="6357732">)</span>&nbsp;<span class="ident" id="6357734">runN</span><span class="op" id="6357738">(</span><span class="ident" id="6357739">n</span>&nbsp;<span class="builtintype" id="6357741">int</span><span class="op" id="6357744">)</span>&nbsp;<span class="op" id="6357746">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6357749">benchmarkLock</span><span class="op" id="6357762">.</span><span class="ident" id="6357763">Lock</span><span class="op" id="6357767">(</span><span class="op" id="6357768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6357771">defer</span>&nbsp;<span class="ident" id="6357777">benchmarkLock</span><span class="op" id="6357790">.</span><span class="ident" id="6357791">Unlock</span><span class="op" id="6357797">(</span><span class="op" id="6357798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6357801">//&nbsp;Try&nbsp;to&nbsp;get&nbsp;a&nbsp;comparable&nbsp;environment&nbsp;for&nbsp;each&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6357854">//&nbsp;by&nbsp;clearing&nbsp;garbage&nbsp;from&nbsp;previous&nbsp;runs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6357898">runtime</span><span class="op" id="6357905">.</span><span class="ident" id="6357906">GC</span><span class="op" id="6357908">(</span><span class="op" id="6357909">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6357912">b</span><span class="op" id="6357913">.</span><span class="ident" id="6357914">N</span>&nbsp;<span class="op" id="6357916">=</span>&nbsp;<span class="ident" id="6357918">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6357921">b</span><span class="op" id="6357922">.</span><span class="ident" id="6357923">parallelism</span>&nbsp;<span class="op" id="6357935">=</span>&nbsp;<span class="num" id="6357937">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6357940">b</span><span class="op" id="6357941">.</span><span class="ident" id="6357942">ResetTimer</span><span class="op" id="6357952">(</span><span class="op" id="6357953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6357956">b</span><span class="op" id="6357957">.</span><span class="ident" id="6357958">StartTimer</span><span class="op" id="6357968">(</span><span class="op" id="6357969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6357972">b</span><span class="op" id="6357973">.</span><span class="ident" id="6357974">benchmark</span><span class="op" id="6357983">.</span><span class="ident" id="6357984">F</span><span class="op" id="6357985">(</span><span class="ident" id="6357986">b</span><span class="op" id="6357987">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6357990">b</span><span class="op" id="6357991">.</span><span class="ident" id="6357992">StopTimer</span><span class="op" id="6358001">(</span><span class="op" id="6358002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6358005">b</span><span class="op" id="6358006">.</span><span class="ident" id="6358007">previousN</span>&nbsp;<span class="op" id="6358017">=</span>&nbsp;<span class="ident" id="6358019">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6358022">b</span><span class="op" id="6358023">.</span><span class="ident" id="6358024">previousDuration</span>&nbsp;<span class="op" id="6358041">=</span>&nbsp;<span class="ident" id="6358043">b</span><span class="op" id="6358044">.</span><span class="ident" id="6358045">duration</span><br>
<span class="lineno"></span><span class="op" id="6358054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="6358057">func</span>&nbsp;<span class="ident" id="6358062">min</span><span class="op" id="6358065">(</span><span class="ident" id="6358066">x</span><span class="op" id="6358067">,</span>&nbsp;<span class="ident" id="6358069">y</span>&nbsp;<span class="builtintype" id="6358071">int</span><span class="op" id="6358074">)</span>&nbsp;<span class="builtintype" id="6358076">int</span>&nbsp;<span class="op" id="6358080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6358083">if</span>&nbsp;<span class="ident" id="6358086">x</span>&nbsp;<span class="op" id="6358088">&gt;</span>&nbsp;<span class="ident" id="6358090">y</span>&nbsp;<span class="op" id="6358092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6358096">return</span>&nbsp;<span class="ident" id="6358103">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6358106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6358109">return</span>&nbsp;<span class="ident" id="6358116">x</span><br>
<span class="lineno">135</span><span class="op" id="6358118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6358121">func</span>&nbsp;<span class="ident" id="6358126">max</span><span class="op" id="6358129">(</span><span class="ident" id="6358130">x</span><span class="op" id="6358131">,</span>&nbsp;<span class="ident" id="6358133">y</span>&nbsp;<span class="builtintype" id="6358135">int</span><span class="op" id="6358138">)</span>&nbsp;<span class="builtintype" id="6358140">int</span>&nbsp;<span class="op" id="6358144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6358147">if</span>&nbsp;<span class="ident" id="6358150">x</span>&nbsp;<span class="op" id="6358152">&lt;</span>&nbsp;<span class="ident" id="6358154">y</span>&nbsp;<span class="op" id="6358156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6358160">return</span>&nbsp;<span class="ident" id="6358167">y</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6358170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6358173">return</span>&nbsp;<span class="ident" id="6358180">x</span><br>
<span class="lineno"></span><span class="op" id="6358182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6358185">//&nbsp;roundDown10&nbsp;rounds&nbsp;a&nbsp;number&nbsp;down&nbsp;to&nbsp;the&nbsp;nearest&nbsp;power&nbsp;of&nbsp;10.</span><br>
<span class="lineno">145</span><span class="keyword" id="6358249">func</span>&nbsp;<span class="ident" id="6358254">roundDown10</span><span class="op" id="6358265">(</span><span class="ident" id="6358266">n</span>&nbsp;<span class="builtintype" id="6358268">int</span><span class="op" id="6358271">)</span>&nbsp;<span class="builtintype" id="6358273">int</span>&nbsp;<span class="op" id="6358277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6358280">var</span>&nbsp;<span class="ident" id="6358284">tens</span>&nbsp;<span class="op" id="6358289">=</span>&nbsp;<span class="num" id="6358291">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6358294">//&nbsp;tens&nbsp;=&nbsp;floor(log_10(n))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6358322">for</span>&nbsp;<span class="ident" id="6358326">n</span>&nbsp;<span class="op" id="6358328">&gt;=</span>&nbsp;<span class="num" id="6358331">10</span>&nbsp;<span class="op" id="6358334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6358338">n</span>&nbsp;<span class="op" id="6358340">=</span>&nbsp;<span class="ident" id="6358342">n</span>&nbsp;<span class="op" id="6358344">/</span>&nbsp;<span class="num" id="6358346">10</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6358351">tens</span><span class="op" id="6358355">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6358359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6358362">//&nbsp;result&nbsp;=&nbsp;10^tens</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6358383">result</span>&nbsp;<span class="op" id="6358390">:=</span>&nbsp;<span class="num" id="6358393">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6358396">for</span>&nbsp;<span class="ident" id="6358400">i</span>&nbsp;<span class="op" id="6358402">:=</span>&nbsp;<span class="num" id="6358405">0</span><span class="op" id="6358406">;</span>&nbsp;<span class="ident" id="6358408">i</span>&nbsp;<span class="op" id="6358410">&lt;</span>&nbsp;<span class="ident" id="6358412">tens</span><span class="op" id="6358416">;</span>&nbsp;<span class="ident" id="6358418">i</span><span class="op" id="6358419">++</span>&nbsp;<span class="op" id="6358422">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6358426">result</span>&nbsp;<span class="op" id="6358433">*=</span>&nbsp;<span class="num" id="6358436">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6358440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6358443">return</span>&nbsp;<span class="ident" id="6358450">result</span><br>
<span class="lineno"></span><span class="op" id="6358457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="6358460">//&nbsp;roundUp&nbsp;rounds&nbsp;x&nbsp;up&nbsp;to&nbsp;a&nbsp;number&nbsp;of&nbsp;the&nbsp;form&nbsp;[1eX,&nbsp;2eX,&nbsp;3eX,&nbsp;5eX].</span><br>
<span class="lineno"></span><span class="keyword" id="6358529">func</span>&nbsp;<span class="ident" id="6358534">roundUp</span><span class="op" id="6358541">(</span><span class="ident" id="6358542">n</span>&nbsp;<span class="builtintype" id="6358544">int</span><span class="op" id="6358547">)</span>&nbsp;<span class="builtintype" id="6358549">int</span>&nbsp;<span class="op" id="6358553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6358556">base</span>&nbsp;<span class="op" id="6358561">:=</span>&nbsp;<span class="ident" id="6358564">roundDown10</span><span class="op" id="6358575">(</span><span class="ident" id="6358576">n</span><span class="op" id="6358577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6358580">switch</span>&nbsp;<span class="op" id="6358587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6358590">case</span>&nbsp;<span class="ident" id="6358595">n</span>&nbsp;<span class="op" id="6358597">&lt;=</span>&nbsp;<span class="ident" id="6358600">base</span><span class="op" id="6358604">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6358608">return</span>&nbsp;<span class="ident" id="6358615">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6358621">case</span>&nbsp;<span class="ident" id="6358626">n</span>&nbsp;<span class="op" id="6358628">&lt;=</span>&nbsp;<span class="op" id="6358631">(</span><span class="num" id="6358632">2</span>&nbsp;<span class="op" id="6358634">*</span>&nbsp;<span class="ident" id="6358636">base</span><span class="op" id="6358640">)</span><span class="op" id="6358641">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6358645">return</span>&nbsp;<span class="num" id="6358652">2</span>&nbsp;<span class="op" id="6358654">*</span>&nbsp;<span class="ident" id="6358656">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6358662">case</span>&nbsp;<span class="ident" id="6358667">n</span>&nbsp;<span class="op" id="6358669">&lt;=</span>&nbsp;<span class="op" id="6358672">(</span><span class="num" id="6358673">3</span>&nbsp;<span class="op" id="6358675">*</span>&nbsp;<span class="ident" id="6358677">base</span><span class="op" id="6358681">)</span><span class="op" id="6358682">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6358686">return</span>&nbsp;<span class="num" id="6358693">3</span>&nbsp;<span class="op" id="6358695">*</span>&nbsp;<span class="ident" id="6358697">base</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6358703">case</span>&nbsp;<span class="ident" id="6358708">n</span>&nbsp;<span class="op" id="6358710">&lt;=</span>&nbsp;<span class="op" id="6358713">(</span><span class="num" id="6358714">5</span>&nbsp;<span class="op" id="6358716">*</span>&nbsp;<span class="ident" id="6358718">base</span><span class="op" id="6358722">)</span><span class="op" id="6358723">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6358727">return</span>&nbsp;<span class="num" id="6358734">5</span>&nbsp;<span class="op" id="6358736">*</span>&nbsp;<span class="ident" id="6358738">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6358744">default</span><span class="op" id="6358751">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6358755">return</span>&nbsp;<span class="num" id="6358762">10</span>&nbsp;<span class="op" id="6358765">*</span>&nbsp;<span class="ident" id="6358767">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6358773">}</span><br>
<span class="lineno">175</span><span class="op" id="6358775">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6358778">//&nbsp;run&nbsp;times&nbsp;the&nbsp;benchmark&nbsp;function&nbsp;in&nbsp;a&nbsp;separate&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="6358839">func</span>&nbsp;<span class="op" id="6358844">(</span><span class="ident" id="6358845">b</span>&nbsp;<span class="op" id="6358847">*</span><span class="ident" id="6358848">B</span><span class="op" id="6358849">)</span>&nbsp;<span class="ident" id="6358851">run</span><span class="op" id="6358854">(</span><span class="op" id="6358855">)</span>&nbsp;<span class="ident" id="6358857">BenchmarkResult</span>&nbsp;<span class="op" id="6358873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6358876">go</span>&nbsp;<span class="ident" id="6358879">b</span><span class="op" id="6358880">.</span><span class="ident" id="6358881">launch</span><span class="op" id="6358887">(</span><span class="op" id="6358888">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6358891">&lt;-</span><span class="ident" id="6358893">b</span><span class="op" id="6358894">.</span><span class="ident" id="6358895">signal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6358903">return</span>&nbsp;<span class="ident" id="6358910">b</span><span class="op" id="6358911">.</span><span class="ident" id="6358912">result</span><br>
<span class="lineno"></span><span class="op" id="6358919">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6358922">//&nbsp;launch&nbsp;launches&nbsp;the&nbsp;benchmark&nbsp;function.&nbsp;&nbsp;It&nbsp;gradually&nbsp;increases&nbsp;the&nbsp;number</span><br>
<span class="lineno">185</span><span class="comment" id="6359000">//&nbsp;of&nbsp;benchmark&nbsp;iterations&nbsp;until&nbsp;the&nbsp;benchmark&nbsp;runs&nbsp;for&nbsp;the&nbsp;requested&nbsp;benchtime.</span><br>
<span class="lineno"></span><span class="comment" id="6359081">//&nbsp;It&nbsp;prints&nbsp;timing&nbsp;information&nbsp;in&nbsp;this&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="6359126">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsptesting.BenchmarkHello&nbsp;&nbsp;&nbsp;&nbsp100000&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp19&nbsp;ns/op</span><br>
<span class="lineno"></span><span class="comment" id="6359170">//&nbsp;launch&nbsp;is&nbsp;run&nbsp;by&nbsp;the&nbsp;run&nbsp;function&nbsp;as&nbsp;a&nbsp;separate&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="6359232">func</span>&nbsp;<span class="op" id="6359237">(</span><span class="ident" id="6359238">b</span>&nbsp;<span class="op" id="6359240">*</span><span class="ident" id="6359241">B</span><span class="op" id="6359242">)</span>&nbsp;<span class="ident" id="6359244">launch</span><span class="op" id="6359250">(</span><span class="op" id="6359251">)</span>&nbsp;<span class="op" id="6359253">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6359256">//&nbsp;Run&nbsp;the&nbsp;benchmark&nbsp;for&nbsp;a&nbsp;single&nbsp;iteration&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;expensive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6359325">n</span>&nbsp;<span class="op" id="6359327">:=</span>&nbsp;<span class="num" id="6359330">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6359334">//&nbsp;Signal&nbsp;that&nbsp;we&#39;re&nbsp;done&nbsp;whether&nbsp;we&nbsp;return&nbsp;normally</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6359388">//&nbsp;or&nbsp;by&nbsp;FailNow&#39;s&nbsp;runtime.Goexit.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6359424">defer</span>&nbsp;<span class="keyword" id="6359430">func</span><span class="op" id="6359434">(</span><span class="op" id="6359435">)</span>&nbsp;<span class="op" id="6359437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6359441">b</span><span class="op" id="6359442">.</span><span class="ident" id="6359443">signal</span>&nbsp;<span class="op" id="6359450">&lt;-</span>&nbsp;<span class="ident" id="6359453">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6359456">}</span><span class="op" id="6359457">(</span><span class="op" id="6359458">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6359462">b</span><span class="op" id="6359463">.</span><span class="ident" id="6359464">runN</span><span class="op" id="6359468">(</span><span class="ident" id="6359469">n</span><span class="op" id="6359470">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6359473">//&nbsp;Run&nbsp;the&nbsp;benchmark&nbsp;for&nbsp;at&nbsp;least&nbsp;the&nbsp;specified&nbsp;amount&nbsp;of&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6359538">d</span>&nbsp;<span class="op" id="6359540">:=</span>&nbsp;<span class="op" id="6359543">*</span><span class="ident" id="6359544">benchTime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6359555">for</span>&nbsp;<span class="op" id="6359559">!</span><span class="ident" id="6359560">b</span><span class="op" id="6359561">.</span><span class="ident" id="6359562">failed</span>&nbsp;<span class="op" id="6359569">&amp;&amp;</span>&nbsp;<span class="ident" id="6359572">b</span><span class="op" id="6359573">.</span><span class="ident" id="6359574">duration</span>&nbsp;<span class="op" id="6359583">&lt;</span>&nbsp;<span class="ident" id="6359585">d</span>&nbsp;<span class="op" id="6359587">&amp;&amp;</span>&nbsp;<span class="ident" id="6359590">n</span>&nbsp;<span class="op" id="6359592">&lt;</span>&nbsp;<span class="num" id="6359594">1e9</span>&nbsp;<span class="op" id="6359598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6359602">last</span>&nbsp;<span class="op" id="6359607">:=</span>&nbsp;<span class="ident" id="6359610">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6359614">//&nbsp;Predict&nbsp;required&nbsp;iterations.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6359648">if</span>&nbsp;<span class="ident" id="6359651">b</span><span class="op" id="6359652">.</span><span class="ident" id="6359653">nsPerOp</span><span class="op" id="6359660">(</span><span class="op" id="6359661">)</span>&nbsp;<span class="op" id="6359663">==</span>&nbsp;<span class="num" id="6359666">0</span>&nbsp;<span class="op" id="6359668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6359673">n</span>&nbsp;<span class="op" id="6359675">=</span>&nbsp;<span class="num" id="6359677">1e9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6359683">}</span>&nbsp;<span class="keyword" id="6359685">else</span>&nbsp;<span class="op" id="6359690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6359695">n</span>&nbsp;<span class="op" id="6359697">=</span>&nbsp;<span class="builtintype" id="6359699">int</span><span class="op" id="6359702">(</span><span class="ident" id="6359703">d</span><span class="op" id="6359704">.</span><span class="ident" id="6359705">Nanoseconds</span><span class="op" id="6359716">(</span><span class="op" id="6359717">)</span>&nbsp;<span class="op" id="6359719">/</span>&nbsp;<span class="ident" id="6359721">b</span><span class="op" id="6359722">.</span><span class="ident" id="6359723">nsPerOp</span><span class="op" id="6359730">(</span><span class="op" id="6359731">)</span><span class="op" id="6359732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6359736">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6359740">//&nbsp;Run&nbsp;more&nbsp;iterations&nbsp;than&nbsp;we&nbsp;think&nbsp;we&#39;ll&nbsp;need&nbsp;(1.2x).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6359798">//&nbsp;Don&#39;t&nbsp;grow&nbsp;too&nbsp;fast&nbsp;in&nbsp;case&nbsp;we&nbsp;had&nbsp;timing&nbsp;errors&nbsp;previously.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6359864">//&nbsp;Be&nbsp;sure&nbsp;to&nbsp;run&nbsp;at&nbsp;least&nbsp;one&nbsp;more&nbsp;than&nbsp;last&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6359918">n</span>&nbsp;<span class="op" id="6359920">=</span>&nbsp;<span class="ident" id="6359922">max</span><span class="op" id="6359925">(</span><span class="ident" id="6359926">min</span><span class="op" id="6359929">(</span><span class="ident" id="6359930">n</span><span class="op" id="6359931">+</span><span class="ident" id="6359932">n</span><span class="op" id="6359933">/</span><span class="num" id="6359934">5</span><span class="op" id="6359935">,</span>&nbsp;<span class="num" id="6359937">100</span><span class="op" id="6359940">*</span><span class="ident" id="6359941">last</span><span class="op" id="6359945">)</span><span class="op" id="6359946">,</span>&nbsp;<span class="ident" id="6359948">last</span><span class="op" id="6359952">+</span><span class="num" id="6359953">1</span><span class="op" id="6359954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6359958">//&nbsp;Round&nbsp;up&nbsp;to&nbsp;something&nbsp;easy&nbsp;to&nbsp;read.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6359999">n</span>&nbsp;<span class="op" id="6360001">=</span>&nbsp;<span class="ident" id="6360003">roundUp</span><span class="op" id="6360010">(</span><span class="ident" id="6360011">n</span><span class="op" id="6360012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360016">b</span><span class="op" id="6360017">.</span><span class="ident" id="6360018">runN</span><span class="op" id="6360022">(</span><span class="ident" id="6360023">n</span><span class="op" id="6360024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6360027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360030">b</span><span class="op" id="6360031">.</span><span class="ident" id="6360032">result</span>&nbsp;<span class="op" id="6360039">=</span>&nbsp;<span class="ident" id="6360041">BenchmarkResult</span><span class="op" id="6360056">{</span><span class="ident" id="6360057">b</span><span class="op" id="6360058">.</span><span class="ident" id="6360059">N</span><span class="op" id="6360060">,</span>&nbsp;<span class="ident" id="6360062">b</span><span class="op" id="6360063">.</span><span class="ident" id="6360064">duration</span><span class="op" id="6360072">,</span>&nbsp;<span class="ident" id="6360074">b</span><span class="op" id="6360075">.</span><span class="ident" id="6360076">bytes</span><span class="op" id="6360081">,</span>&nbsp;<span class="ident" id="6360083">b</span><span class="op" id="6360084">.</span><span class="ident" id="6360085">netAllocs</span><span class="op" id="6360094">,</span>&nbsp;<span class="ident" id="6360096">b</span><span class="op" id="6360097">.</span><span class="ident" id="6360098">netBytes</span><span class="op" id="6360106">}</span><br>
<span class="lineno"></span><span class="op" id="6360108">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="6360111">//&nbsp;The&nbsp;results&nbsp;of&nbsp;a&nbsp;benchmark&nbsp;run.</span><br>
<span class="lineno"></span><span class="keyword" id="6360146">type</span>&nbsp;<span class="ident" id="6360151">BenchmarkResult</span>&nbsp;<span class="keyword" id="6360167">struct</span>&nbsp;<span class="op" id="6360174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360177">N</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6360187">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6360201">//&nbsp;The&nbsp;number&nbsp;of&nbsp;iterations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360231">T</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6360241">time</span><span class="op" id="6360245">.</span><span class="ident" id="6360246">Duration</span>&nbsp;<span class="comment" id="6360255">//&nbsp;The&nbsp;total&nbsp;time&nbsp;taken.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360281">Bytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6360291">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6360305">//&nbsp;Bytes&nbsp;processed&nbsp;in&nbsp;one&nbsp;iteration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360343">MemAllocs</span>&nbsp;<span class="ident" id="6360353">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6360367">//&nbsp;The&nbsp;total&nbsp;number&nbsp;of&nbsp;memory&nbsp;allocations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360411">MemBytes</span>&nbsp;&nbsp;<span class="ident" id="6360421">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6360435">//&nbsp;The&nbsp;total&nbsp;number&nbsp;of&nbsp;bytes&nbsp;allocated.</span><br>
<span class="lineno"></span><span class="op" id="6360475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="6360478">func</span>&nbsp;<span class="op" id="6360483">(</span><span class="ident" id="6360484">r</span>&nbsp;<span class="ident" id="6360486">BenchmarkResult</span><span class="op" id="6360501">)</span>&nbsp;<span class="ident" id="6360503">NsPerOp</span><span class="op" id="6360510">(</span><span class="op" id="6360511">)</span>&nbsp;<span class="ident" id="6360513">int64</span>&nbsp;<span class="op" id="6360519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6360522">if</span>&nbsp;<span class="ident" id="6360525">r</span><span class="op" id="6360526">.</span><span class="ident" id="6360527">N</span>&nbsp;<span class="op" id="6360529">&lt;=</span>&nbsp;<span class="num" id="6360532">0</span>&nbsp;<span class="op" id="6360534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6360538">return</span>&nbsp;<span class="num" id="6360545">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6360548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6360551">return</span>&nbsp;<span class="ident" id="6360558">r</span><span class="op" id="6360559">.</span><span class="ident" id="6360560">T</span><span class="op" id="6360561">.</span><span class="ident" id="6360562">Nanoseconds</span><span class="op" id="6360573">(</span><span class="op" id="6360574">)</span>&nbsp;<span class="op" id="6360576">/</span>&nbsp;<span class="ident" id="6360578">int64</span><span class="op" id="6360583">(</span><span class="ident" id="6360584">r</span><span class="op" id="6360585">.</span><span class="ident" id="6360586">N</span><span class="op" id="6360587">)</span><br>
<span class="lineno">235</span><span class="op" id="6360589">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6360592">func</span>&nbsp;<span class="op" id="6360597">(</span><span class="ident" id="6360598">r</span>&nbsp;<span class="ident" id="6360600">BenchmarkResult</span><span class="op" id="6360615">)</span>&nbsp;<span class="ident" id="6360617">mbPerSec</span><span class="op" id="6360625">(</span><span class="op" id="6360626">)</span>&nbsp;<span class="builtintype" id="6360628">float64</span>&nbsp;<span class="op" id="6360636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6360639">if</span>&nbsp;<span class="ident" id="6360642">r</span><span class="op" id="6360643">.</span><span class="ident" id="6360644">Bytes</span>&nbsp;<span class="op" id="6360650">&lt;=</span>&nbsp;<span class="num" id="6360653">0</span>&nbsp;<span class="op" id="6360655">||</span>&nbsp;<span class="ident" id="6360658">r</span><span class="op" id="6360659">.</span><span class="ident" id="6360660">T</span>&nbsp;<span class="op" id="6360662">&lt;=</span>&nbsp;<span class="num" id="6360665">0</span>&nbsp;<span class="op" id="6360667">||</span>&nbsp;<span class="ident" id="6360670">r</span><span class="op" id="6360671">.</span><span class="ident" id="6360672">N</span>&nbsp;<span class="op" id="6360674">&lt;=</span>&nbsp;<span class="num" id="6360677">0</span>&nbsp;<span class="op" id="6360679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6360683">return</span>&nbsp;<span class="num" id="6360690">0</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6360693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6360696">return</span>&nbsp;<span class="op" id="6360703">(</span><span class="builtintype" id="6360704">float64</span><span class="op" id="6360711">(</span><span class="ident" id="6360712">r</span><span class="op" id="6360713">.</span><span class="ident" id="6360714">Bytes</span><span class="op" id="6360719">)</span>&nbsp;<span class="op" id="6360721">*</span>&nbsp;<span class="builtintype" id="6360723">float64</span><span class="op" id="6360730">(</span><span class="ident" id="6360731">r</span><span class="op" id="6360732">.</span><span class="ident" id="6360733">N</span><span class="op" id="6360734">)</span>&nbsp;<span class="op" id="6360736">/</span>&nbsp;<span class="num" id="6360738">1e6</span><span class="op" id="6360741">)</span>&nbsp;<span class="op" id="6360743">/</span>&nbsp;<span class="ident" id="6360745">r</span><span class="op" id="6360746">.</span><span class="ident" id="6360747">T</span><span class="op" id="6360748">.</span><span class="ident" id="6360749">Seconds</span><span class="op" id="6360756">(</span><span class="op" id="6360757">)</span><br>
<span class="lineno"></span><span class="op" id="6360759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6360762">func</span>&nbsp;<span class="op" id="6360767">(</span><span class="ident" id="6360768">r</span>&nbsp;<span class="ident" id="6360770">BenchmarkResult</span><span class="op" id="6360785">)</span>&nbsp;<span class="ident" id="6360787">AllocsPerOp</span><span class="op" id="6360798">(</span><span class="op" id="6360799">)</span>&nbsp;<span class="ident" id="6360801">int64</span>&nbsp;<span class="op" id="6360807">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6360810">if</span>&nbsp;<span class="ident" id="6360813">r</span><span class="op" id="6360814">.</span><span class="ident" id="6360815">N</span>&nbsp;<span class="op" id="6360817">&lt;=</span>&nbsp;<span class="num" id="6360820">0</span>&nbsp;<span class="op" id="6360822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6360826">return</span>&nbsp;<span class="num" id="6360833">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6360836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6360839">return</span>&nbsp;<span class="ident" id="6360846">int64</span><span class="op" id="6360851">(</span><span class="ident" id="6360852">r</span><span class="op" id="6360853">.</span><span class="ident" id="6360854">MemAllocs</span><span class="op" id="6360863">)</span>&nbsp;<span class="op" id="6360865">/</span>&nbsp;<span class="ident" id="6360867">int64</span><span class="op" id="6360872">(</span><span class="ident" id="6360873">r</span><span class="op" id="6360874">.</span><span class="ident" id="6360875">N</span><span class="op" id="6360876">)</span><br>
<span class="lineno"></span><span class="op" id="6360878">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="keyword" id="6360881">func</span>&nbsp;<span class="op" id="6360886">(</span><span class="ident" id="6360887">r</span>&nbsp;<span class="ident" id="6360889">BenchmarkResult</span><span class="op" id="6360904">)</span>&nbsp;<span class="ident" id="6360906">AllocedBytesPerOp</span><span class="op" id="6360923">(</span><span class="op" id="6360924">)</span>&nbsp;<span class="ident" id="6360926">int64</span>&nbsp;<span class="op" id="6360932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6360935">if</span>&nbsp;<span class="ident" id="6360938">r</span><span class="op" id="6360939">.</span><span class="ident" id="6360940">N</span>&nbsp;<span class="op" id="6360942">&lt;=</span>&nbsp;<span class="num" id="6360945">0</span>&nbsp;<span class="op" id="6360947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6360951">return</span>&nbsp;<span class="num" id="6360958">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6360961">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6360964">return</span>&nbsp;<span class="ident" id="6360971">int64</span><span class="op" id="6360976">(</span><span class="ident" id="6360977">r</span><span class="op" id="6360978">.</span><span class="ident" id="6360979">MemBytes</span><span class="op" id="6360987">)</span>&nbsp;<span class="op" id="6360989">/</span>&nbsp;<span class="ident" id="6360991">int64</span><span class="op" id="6360996">(</span><span class="ident" id="6360997">r</span><span class="op" id="6360998">.</span><span class="ident" id="6360999">N</span><span class="op" id="6361000">)</span><br>
<span class="lineno"></span><span class="op" id="6361002">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6361005">func</span>&nbsp;<span class="op" id="6361010">(</span><span class="ident" id="6361011">r</span>&nbsp;<span class="ident" id="6361013">BenchmarkResult</span><span class="op" id="6361028">)</span>&nbsp;<span class="ident" id="6361030">String</span><span class="op" id="6361036">(</span><span class="op" id="6361037">)</span>&nbsp;<span class="builtintype" id="6361039">string</span>&nbsp;<span class="op" id="6361046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6361049">mbs</span>&nbsp;<span class="op" id="6361053">:=</span>&nbsp;<span class="ident" id="6361056">r</span><span class="op" id="6361057">.</span><span class="ident" id="6361058">mbPerSec</span><span class="op" id="6361066">(</span><span class="op" id="6361067">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6361070">mb</span>&nbsp;<span class="op" id="6361073">:=</span>&nbsp;<span class="string" id="6361076">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6361080">if</span>&nbsp;<span class="ident" id="6361083">mbs</span>&nbsp;<span class="op" id="6361087">!=</span>&nbsp;<span class="num" id="6361090">0</span>&nbsp;<span class="op" id="6361092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6361096">mb</span>&nbsp;<span class="op" id="6361099">=</span>&nbsp;<span class="ident" id="6361101">fmt</span><span class="op" id="6361104">.</span><span class="ident" id="6361105">Sprintf</span><span class="op" id="6361112">(</span><span class="string" id="6361113">&#34;\t%7.2f&nbsp;MB/s&#34;</span><span class="op" id="6361127">,</span>&nbsp;<span class="ident" id="6361129">mbs</span><span class="op" id="6361132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6361135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6361138">nsop</span>&nbsp;<span class="op" id="6361143">:=</span>&nbsp;<span class="ident" id="6361146">r</span><span class="op" id="6361147">.</span><span class="ident" id="6361148">NsPerOp</span><span class="op" id="6361155">(</span><span class="op" id="6361156">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6361159">ns</span>&nbsp;<span class="op" id="6361162">:=</span>&nbsp;<span class="ident" id="6361165">fmt</span><span class="op" id="6361168">.</span><span class="ident" id="6361169">Sprintf</span><span class="op" id="6361176">(</span><span class="string" id="6361177">&#34;%10d&nbsp;ns/op&#34;</span><span class="op" id="6361189">,</span>&nbsp;<span class="ident" id="6361191">nsop</span><span class="op" id="6361195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6361198">if</span>&nbsp;<span class="ident" id="6361201">r</span><span class="op" id="6361202">.</span><span class="ident" id="6361203">N</span>&nbsp;<span class="op" id="6361205">&gt;</span>&nbsp;<span class="num" id="6361207">0</span>&nbsp;<span class="op" id="6361209">&amp;&amp;</span>&nbsp;<span class="ident" id="6361212">nsop</span>&nbsp;<span class="op" id="6361217">&lt;</span>&nbsp;<span class="num" id="6361219">100</span>&nbsp;<span class="op" id="6361223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6361227">//&nbsp;The&nbsp;format&nbsp;specifiers&nbsp;here&nbsp;make&nbsp;sure&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6361274">//&nbsp;the&nbsp;ones&nbsp;digits&nbsp;line&nbsp;up&nbsp;for&nbsp;all&nbsp;three&nbsp;possible&nbsp;formats.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6361335">if</span>&nbsp;<span class="ident" id="6361338">nsop</span>&nbsp;<span class="op" id="6361343">&lt;</span>&nbsp;<span class="num" id="6361345">10</span>&nbsp;<span class="op" id="6361348">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6361353">ns</span>&nbsp;<span class="op" id="6361356">=</span>&nbsp;<span class="ident" id="6361358">fmt</span><span class="op" id="6361361">.</span><span class="ident" id="6361362">Sprintf</span><span class="op" id="6361369">(</span><span class="string" id="6361370">&#34;%13.2f&nbsp;ns/op&#34;</span><span class="op" id="6361384">,</span>&nbsp;<span class="builtintype" id="6361386">float64</span><span class="op" id="6361393">(</span><span class="ident" id="6361394">r</span><span class="op" id="6361395">.</span><span class="ident" id="6361396">T</span><span class="op" id="6361397">.</span><span class="ident" id="6361398">Nanoseconds</span><span class="op" id="6361409">(</span><span class="op" id="6361410">)</span><span class="op" id="6361411">)</span><span class="op" id="6361412">/</span><span class="builtintype" id="6361413">float64</span><span class="op" id="6361420">(</span><span class="ident" id="6361421">r</span><span class="op" id="6361422">.</span><span class="ident" id="6361423">N</span><span class="op" id="6361424">)</span><span class="op" id="6361425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6361429">}</span>&nbsp;<span class="keyword" id="6361431">else</span>&nbsp;<span class="op" id="6361436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6361441">ns</span>&nbsp;<span class="op" id="6361444">=</span>&nbsp;<span class="ident" id="6361446">fmt</span><span class="op" id="6361449">.</span><span class="ident" id="6361450">Sprintf</span><span class="op" id="6361457">(</span><span class="string" id="6361458">&#34;%12.1f&nbsp;ns/op&#34;</span><span class="op" id="6361472">,</span>&nbsp;<span class="builtintype" id="6361474">float64</span><span class="op" id="6361481">(</span><span class="ident" id="6361482">r</span><span class="op" id="6361483">.</span><span class="ident" id="6361484">T</span><span class="op" id="6361485">.</span><span class="ident" id="6361486">Nanoseconds</span><span class="op" id="6361497">(</span><span class="op" id="6361498">)</span><span class="op" id="6361499">)</span><span class="op" id="6361500">/</span><span class="builtintype" id="6361501">float64</span><span class="op" id="6361508">(</span><span class="ident" id="6361509">r</span><span class="op" id="6361510">.</span><span class="ident" id="6361511">N</span><span class="op" id="6361512">)</span><span class="op" id="6361513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6361517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6361520">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6361523">return</span>&nbsp;<span class="ident" id="6361530">fmt</span><span class="op" id="6361533">.</span><span class="ident" id="6361534">Sprintf</span><span class="op" id="6361541">(</span><span class="string" id="6361542">&#34;%8d\t%s%s&#34;</span><span class="op" id="6361553">,</span>&nbsp;<span class="ident" id="6361555">r</span><span class="op" id="6361556">.</span><span class="ident" id="6361557">N</span><span class="op" id="6361558">,</span>&nbsp;<span class="ident" id="6361560">ns</span><span class="op" id="6361562">,</span>&nbsp;<span class="ident" id="6361564">mb</span><span class="op" id="6361566">)</span><br>
<span class="lineno"></span><span class="op" id="6361568">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6361571">func</span>&nbsp;<span class="op" id="6361576">(</span><span class="ident" id="6361577">r</span>&nbsp;<span class="ident" id="6361579">BenchmarkResult</span><span class="op" id="6361594">)</span>&nbsp;<span class="ident" id="6361596">MemString</span><span class="op" id="6361605">(</span><span class="op" id="6361606">)</span>&nbsp;<span class="builtintype" id="6361608">string</span>&nbsp;<span class="op" id="6361615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6361618">return</span>&nbsp;<span class="ident" id="6361625">fmt</span><span class="op" id="6361628">.</span><span class="ident" id="6361629">Sprintf</span><span class="op" id="6361636">(</span><span class="string" id="6361637">&#34;%8d&nbsp;B/op\t%8d&nbsp;allocs/op&#34;</span><span class="op" id="6361662">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6361666">r</span><span class="op" id="6361667">.</span><span class="ident" id="6361668">AllocedBytesPerOp</span><span class="op" id="6361685">(</span><span class="op" id="6361686">)</span><span class="op" id="6361687">,</span>&nbsp;<span class="ident" id="6361689">r</span><span class="op" id="6361690">.</span><span class="ident" id="6361691">AllocsPerOp</span><span class="op" id="6361702">(</span><span class="op" id="6361703">)</span><span class="op" id="6361704">)</span><br>
<span class="lineno"></span><span class="op" id="6361706">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6361709">//&nbsp;An&nbsp;internal&nbsp;function&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="6361802">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno">285</span><span class="keyword" id="6361831">func</span>&nbsp;<span class="ident" id="6361836">RunBenchmarks</span><span class="op" id="6361849">(</span><span class="ident" id="6361850">matchString</span>&nbsp;<span class="keyword" id="6361862">func</span><span class="op" id="6361866">(</span><span class="ident" id="6361867">pat</span><span class="op" id="6361870">,</span>&nbsp;<span class="ident" id="6361872">str</span>&nbsp;<span class="builtintype" id="6361876">string</span><span class="op" id="6361882">)</span>&nbsp;<span class="op" id="6361884">(</span><span class="builtintype" id="6361885">bool</span><span class="op" id="6361889">,</span>&nbsp;<span class="builtintype" id="6361891">error</span><span class="op" id="6361896">)</span><span class="op" id="6361897">,</span>&nbsp;<span class="ident" id="6361899">benchmarks</span>&nbsp;<span class="op" id="6361910">[</span><span class="op" id="6361911">]</span><span class="ident" id="6361912">InternalBenchmark</span><span class="op" id="6361929">)</span>&nbsp;<span class="op" id="6361931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6361934">//&nbsp;If&nbsp;no&nbsp;flag&nbsp;was&nbsp;specified,&nbsp;don&#39;t&nbsp;run&nbsp;benchmarks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6361986">if</span>&nbsp;<span class="builtinfunc" id="6361989">len</span><span class="op" id="6361992">(</span><span class="op" id="6361993">*</span><span class="ident" id="6361994">matchBenchmarks</span><span class="op" id="6362009">)</span>&nbsp;<span class="op" id="6362011">==</span>&nbsp;<span class="num" id="6362014">0</span>&nbsp;<span class="op" id="6362016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362020">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6362028">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362031">for</span>&nbsp;<span class="ident" id="6362035">_</span><span class="op" id="6362036">,</span>&nbsp;<span class="ident" id="6362038">Benchmark</span>&nbsp;<span class="op" id="6362048">:=</span>&nbsp;<span class="keyword" id="6362051">range</span>&nbsp;<span class="ident" id="6362057">benchmarks</span>&nbsp;<span class="op" id="6362068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362072">matched</span><span class="op" id="6362079">,</span>&nbsp;<span class="ident" id="6362081">err</span>&nbsp;<span class="op" id="6362085">:=</span>&nbsp;<span class="ident" id="6362088">matchString</span><span class="op" id="6362099">(</span><span class="op" id="6362100">*</span><span class="ident" id="6362101">matchBenchmarks</span><span class="op" id="6362116">,</span>&nbsp;<span class="ident" id="6362118">Benchmark</span><span class="op" id="6362127">.</span><span class="ident" id="6362128">Name</span><span class="op" id="6362132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362136">if</span>&nbsp;<span class="ident" id="6362139">err</span>&nbsp;<span class="op" id="6362143">!=</span>&nbsp;<span class="ident" id="6362146">nil</span>&nbsp;<span class="op" id="6362150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362155">fmt</span><span class="op" id="6362158">.</span><span class="ident" id="6362159">Fprintf</span><span class="op" id="6362166">(</span><span class="ident" id="6362167">os</span><span class="op" id="6362169">.</span><span class="ident" id="6362170">Stderr</span><span class="op" id="6362176">,</span>&nbsp;<span class="string" id="6362178">&#34;testing:&nbsp;invalid&nbsp;regexp&nbsp;for&nbsp;-test.bench:&nbsp;%s\n&#34;</span><span class="op" id="6362225">,</span>&nbsp;<span class="ident" id="6362227">err</span><span class="op" id="6362230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362235">os</span><span class="op" id="6362237">.</span><span class="ident" id="6362238">Exit</span><span class="op" id="6362242">(</span><span class="num" id="6362243">1</span><span class="op" id="6362244">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6362248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362252">if</span>&nbsp;<span class="op" id="6362255">!</span><span class="ident" id="6362256">matched</span>&nbsp;<span class="op" id="6362264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362269">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6362280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362284">for</span>&nbsp;<span class="ident" id="6362288">_</span><span class="op" id="6362289">,</span>&nbsp;<span class="ident" id="6362291">procs</span>&nbsp;<span class="op" id="6362297">:=</span>&nbsp;<span class="keyword" id="6362300">range</span>&nbsp;<span class="ident" id="6362306">cpuList</span>&nbsp;<span class="op" id="6362314">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362319">runtime</span><span class="op" id="6362326">.</span><span class="ident" id="6362327">GOMAXPROCS</span><span class="op" id="6362337">(</span><span class="ident" id="6362338">procs</span><span class="op" id="6362343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362348">b</span>&nbsp;<span class="op" id="6362350">:=</span>&nbsp;<span class="op" id="6362353">&amp;</span><span class="ident" id="6362354">B</span><span class="op" id="6362355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362361">common</span><span class="op" id="6362367">:</span>&nbsp;<span class="ident" id="6362369">common</span><span class="op" id="6362375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362382">signal</span><span class="op" id="6362388">:</span>&nbsp;<span class="builtinfunc" id="6362390">make</span><span class="op" id="6362394">(</span><span class="keyword" id="6362395">chan</span>&nbsp;<span class="keyword" id="6362400">interface</span><span class="op" id="6362409">{</span><span class="op" id="6362410">}</span><span class="op" id="6362411">)</span><span class="op" id="6362412">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6362418">}</span><span class="op" id="6362419">,</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362425">benchmark</span><span class="op" id="6362434">:</span>&nbsp;<span class="ident" id="6362436">Benchmark</span><span class="op" id="6362445">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6362450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362455">benchName</span>&nbsp;<span class="op" id="6362465">:=</span>&nbsp;<span class="ident" id="6362468">Benchmark</span><span class="op" id="6362477">.</span><span class="ident" id="6362478">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362486">if</span>&nbsp;<span class="ident" id="6362489">procs</span>&nbsp;<span class="op" id="6362495">!=</span>&nbsp;<span class="num" id="6362498">1</span>&nbsp;<span class="op" id="6362500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362506">benchName</span>&nbsp;<span class="op" id="6362516">=</span>&nbsp;<span class="ident" id="6362518">fmt</span><span class="op" id="6362521">.</span><span class="ident" id="6362522">Sprintf</span><span class="op" id="6362529">(</span><span class="string" id="6362530">&#34;%s-%d&#34;</span><span class="op" id="6362537">,</span>&nbsp;<span class="ident" id="6362539">Benchmark</span><span class="op" id="6362548">.</span><span class="ident" id="6362549">Name</span><span class="op" id="6362553">,</span>&nbsp;<span class="ident" id="6362555">procs</span><span class="op" id="6362560">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6362565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362570">fmt</span><span class="op" id="6362573">.</span><span class="ident" id="6362574">Printf</span><span class="op" id="6362580">(</span><span class="string" id="6362581">&#34;%s\t&#34;</span><span class="op" id="6362587">,</span>&nbsp;<span class="ident" id="6362589">benchName</span><span class="op" id="6362598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362603">r</span>&nbsp;<span class="op" id="6362605">:=</span>&nbsp;<span class="ident" id="6362608">b</span><span class="op" id="6362609">.</span><span class="ident" id="6362610">run</span><span class="op" id="6362613">(</span><span class="op" id="6362614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362619">if</span>&nbsp;<span class="ident" id="6362622">b</span><span class="op" id="6362623">.</span><span class="ident" id="6362624">failed</span>&nbsp;<span class="op" id="6362631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6362637">//&nbsp;The&nbsp;output&nbsp;could&nbsp;be&nbsp;very&nbsp;long&nbsp;here,&nbsp;but&nbsp;probably&nbsp;isn&#39;t.</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6362700">//&nbsp;We&nbsp;print&nbsp;it&nbsp;all,&nbsp;regardless,&nbsp;because&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;trim&nbsp;the&nbsp;reason</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6362777">//&nbsp;the&nbsp;benchmark&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362806">fmt</span><span class="op" id="6362809">.</span><span class="ident" id="6362810">Printf</span><span class="op" id="6362816">(</span><span class="string" id="6362817">&#34;---&nbsp;FAIL:&nbsp;%s\n%s&#34;</span><span class="op" id="6362835">,</span>&nbsp;<span class="ident" id="6362837">benchName</span><span class="op" id="6362846">,</span>&nbsp;<span class="ident" id="6362848">b</span><span class="op" id="6362849">.</span><span class="ident" id="6362850">output</span><span class="op" id="6362856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362862">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6362874">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362879">results</span>&nbsp;<span class="op" id="6362887">:=</span>&nbsp;<span class="ident" id="6362890">r</span><span class="op" id="6362891">.</span><span class="ident" id="6362892">String</span><span class="op" id="6362898">(</span><span class="op" id="6362899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362904">if</span>&nbsp;<span class="op" id="6362907">*</span><span class="ident" id="6362908">benchmarkMemory</span>&nbsp;<span class="op" id="6362924">||</span>&nbsp;<span class="ident" id="6362927">b</span><span class="op" id="6362928">.</span><span class="ident" id="6362929">showAllocResult</span>&nbsp;<span class="op" id="6362945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362951">results</span>&nbsp;<span class="op" id="6362959">+=</span>&nbsp;<span class="string" id="6362962">&#34;\t&#34;</span>&nbsp;<span class="op" id="6362967">+</span>&nbsp;<span class="ident" id="6362969">r</span><span class="op" id="6362970">.</span><span class="ident" id="6362971">MemString</span><span class="op" id="6362980">(</span><span class="op" id="6362981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6362986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362991">fmt</span><span class="op" id="6362994">.</span><span class="ident" id="6362995">Println</span><span class="op" id="6363002">(</span><span class="ident" id="6363003">results</span><span class="op" id="6363010">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6363015">//&nbsp;Unlike&nbsp;with&nbsp;tests,&nbsp;we&nbsp;ignore&nbsp;the&nbsp;-chatty&nbsp;flag&nbsp;and&nbsp;always&nbsp;print&nbsp;output&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6363095">//&nbsp;benchmarks&nbsp;since&nbsp;the&nbsp;output&nbsp;generation&nbsp;time&nbsp;will&nbsp;skew&nbsp;the&nbsp;results.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6363168">if</span>&nbsp;<span class="builtinfunc" id="6363171">len</span><span class="op" id="6363174">(</span><span class="ident" id="6363175">b</span><span class="op" id="6363176">.</span><span class="ident" id="6363177">output</span><span class="op" id="6363183">)</span>&nbsp;<span class="op" id="6363185">&gt;</span>&nbsp;<span class="num" id="6363187">0</span>&nbsp;<span class="op" id="6363189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363195">b</span><span class="op" id="6363196">.</span><span class="ident" id="6363197">trimOutput</span><span class="op" id="6363207">(</span><span class="op" id="6363208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363214">fmt</span><span class="op" id="6363217">.</span><span class="ident" id="6363218">Printf</span><span class="op" id="6363224">(</span><span class="string" id="6363225">&#34;---&nbsp;BENCH:&nbsp;%s\n%s&#34;</span><span class="op" id="6363244">,</span>&nbsp;<span class="ident" id="6363246">benchName</span><span class="op" id="6363255">,</span>&nbsp;<span class="ident" id="6363257">b</span><span class="op" id="6363258">.</span><span class="ident" id="6363259">output</span><span class="op" id="6363265">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6363270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6363275">if</span>&nbsp;<span class="ident" id="6363278">p</span>&nbsp;<span class="op" id="6363280">:=</span>&nbsp;<span class="ident" id="6363283">runtime</span><span class="op" id="6363290">.</span><span class="ident" id="6363291">GOMAXPROCS</span><span class="op" id="6363301">(</span><span class="op" id="6363302">-</span><span class="num" id="6363303">1</span><span class="op" id="6363304">)</span><span class="op" id="6363305">;</span>&nbsp;<span class="ident" id="6363307">p</span>&nbsp;<span class="op" id="6363309">!=</span>&nbsp;<span class="ident" id="6363312">procs</span>&nbsp;<span class="op" id="6363318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363324">fmt</span><span class="op" id="6363327">.</span><span class="ident" id="6363328">Fprintf</span><span class="op" id="6363335">(</span><span class="ident" id="6363336">os</span><span class="op" id="6363338">.</span><span class="ident" id="6363339">Stderr</span><span class="op" id="6363345">,</span>&nbsp;<span class="string" id="6363347">&#34;testing:&nbsp;%s&nbsp;left&nbsp;GOMAXPROCS&nbsp;set&nbsp;to&nbsp;%d\n&#34;</span><span class="op" id="6363388">,</span>&nbsp;<span class="ident" id="6363390">benchName</span><span class="op" id="6363399">,</span>&nbsp;<span class="ident" id="6363401">p</span><span class="op" id="6363402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6363407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6363411">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6363414">}</span><br>
<span class="lineno"></span><span class="op" id="6363416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6363419">//&nbsp;trimOutput&nbsp;shortens&nbsp;the&nbsp;output&nbsp;from&nbsp;a&nbsp;benchmark,&nbsp;which&nbsp;can&nbsp;be&nbsp;very&nbsp;long.</span><br>
<span class="lineno"></span><span class="keyword" id="6363495">func</span>&nbsp;<span class="op" id="6363500">(</span><span class="ident" id="6363501">b</span>&nbsp;<span class="op" id="6363503">*</span><span class="ident" id="6363504">B</span><span class="op" id="6363505">)</span>&nbsp;<span class="ident" id="6363507">trimOutput</span><span class="op" id="6363517">(</span><span class="op" id="6363518">)</span>&nbsp;<span class="op" id="6363520">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6363523">//&nbsp;The&nbsp;output&nbsp;is&nbsp;likely&nbsp;to&nbsp;appear&nbsp;multiple&nbsp;times&nbsp;because&nbsp;the&nbsp;benchmark</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6363595">//&nbsp;is&nbsp;run&nbsp;multiple&nbsp;times,&nbsp;but&nbsp;at&nbsp;least&nbsp;it&nbsp;will&nbsp;be&nbsp;seen.&nbsp;This&nbsp;is&nbsp;not&nbsp;a&nbsp;big&nbsp;deal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6363675">//&nbsp;because&nbsp;benchmarks&nbsp;rarely&nbsp;print,&nbsp;but&nbsp;just&nbsp;in&nbsp;case,&nbsp;we&nbsp;trim&nbsp;it&nbsp;if&nbsp;it&#39;s&nbsp;too&nbsp;long.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6363759">const</span>&nbsp;<span class="ident" id="6363765">maxNewlines</span>&nbsp;<span class="op" id="6363777">=</span>&nbsp;<span class="num" id="6363779">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6363783">for</span>&nbsp;<span class="ident" id="6363787">nlCount</span><span class="op" id="6363794">,</span>&nbsp;<span class="ident" id="6363796">j</span>&nbsp;<span class="op" id="6363798">:=</span>&nbsp;<span class="num" id="6363801">0</span><span class="op" id="6363802">,</span>&nbsp;<span class="num" id="6363804">0</span><span class="op" id="6363805">;</span>&nbsp;<span class="ident" id="6363807">j</span>&nbsp;<span class="op" id="6363809">&lt;</span>&nbsp;<span class="builtinfunc" id="6363811">len</span><span class="op" id="6363814">(</span><span class="ident" id="6363815">b</span><span class="op" id="6363816">.</span><span class="ident" id="6363817">output</span><span class="op" id="6363823">)</span><span class="op" id="6363824">;</span>&nbsp;<span class="ident" id="6363826">j</span><span class="op" id="6363827">++</span>&nbsp;<span class="op" id="6363830">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6363834">if</span>&nbsp;<span class="ident" id="6363837">b</span><span class="op" id="6363838">.</span><span class="ident" id="6363839">output</span><span class="op" id="6363845">[</span><span class="ident" id="6363846">j</span><span class="op" id="6363847">]</span>&nbsp;<span class="op" id="6363849">==</span>&nbsp;<span class="string" id="6363852">&#39;\n&#39;</span>&nbsp;<span class="op" id="6363857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363862">nlCount</span><span class="op" id="6363869">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6363875">if</span>&nbsp;<span class="ident" id="6363878">nlCount</span>&nbsp;<span class="op" id="6363886">&gt;=</span>&nbsp;<span class="ident" id="6363889">maxNewlines</span>&nbsp;<span class="op" id="6363901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363907">b</span><span class="op" id="6363908">.</span><span class="ident" id="6363909">output</span>&nbsp;<span class="op" id="6363916">=</span>&nbsp;<span class="builtinfunc" id="6363918">append</span><span class="op" id="6363924">(</span><span class="ident" id="6363925">b</span><span class="op" id="6363926">.</span><span class="ident" id="6363927">output</span><span class="op" id="6363933">[</span><span class="op" id="6363934">:</span><span class="ident" id="6363935">j</span><span class="op" id="6363936">]</span><span class="op" id="6363937">,</span>&nbsp;<span class="string" id="6363939">&#34;\n\t...&nbsp;[output&nbsp;truncated]\n&#34;</span><span class="op" id="6363969">...</span><span class="op" id="6363972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6363978">break</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6363987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6363991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6363994">}</span><br>
<span class="lineno"></span><span class="op" id="6363996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="6363999">//&nbsp;A&nbsp;PB&nbsp;is&nbsp;used&nbsp;by&nbsp;RunParallel&nbsp;for&nbsp;running&nbsp;parallel&nbsp;benchmarks.</span><br>
<span class="lineno"></span><span class="keyword" id="6364063">type</span>&nbsp;<span class="ident" id="6364068">PB</span>&nbsp;<span class="keyword" id="6364071">struct</span>&nbsp;<span class="op" id="6364078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364081">globalN</span>&nbsp;<span class="op" id="6364089">*</span><span class="ident" id="6364090">uint64</span>&nbsp;<span class="comment" id="6364097">//&nbsp;shared&nbsp;between&nbsp;all&nbsp;worker&nbsp;goroutines&nbsp;iteration&nbsp;counter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364156">grain</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6364164">uint64</span>&nbsp;&nbsp;<span class="comment" id="6364172">//&nbsp;acquire&nbsp;that&nbsp;many&nbsp;iterations&nbsp;from&nbsp;globalN&nbsp;at&nbsp;once</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364226">cache</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6364234">uint64</span>&nbsp;&nbsp;<span class="comment" id="6364242">//&nbsp;local&nbsp;cache&nbsp;of&nbsp;acquired&nbsp;iterations</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364281">bN</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6364289">uint64</span>&nbsp;&nbsp;<span class="comment" id="6364297">//&nbsp;total&nbsp;number&nbsp;of&nbsp;iterations&nbsp;to&nbsp;execute&nbsp;(b.N)</span><br>
<span class="lineno"></span><span class="op" id="6364344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6364347">//&nbsp;Next&nbsp;reports&nbsp;whether&nbsp;there&nbsp;are&nbsp;more&nbsp;iterations&nbsp;to&nbsp;execute.</span><br>
<span class="lineno"></span><span class="keyword" id="6364409">func</span>&nbsp;<span class="op" id="6364414">(</span><span class="ident" id="6364415">pb</span>&nbsp;<span class="op" id="6364418">*</span><span class="ident" id="6364419">PB</span><span class="op" id="6364421">)</span>&nbsp;<span class="ident" id="6364423">Next</span><span class="op" id="6364427">(</span><span class="op" id="6364428">)</span>&nbsp;<span class="builtintype" id="6364430">bool</span>&nbsp;<span class="op" id="6364435">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6364438">if</span>&nbsp;<span class="ident" id="6364441">pb</span><span class="op" id="6364443">.</span><span class="ident" id="6364444">cache</span>&nbsp;<span class="op" id="6364450">==</span>&nbsp;<span class="num" id="6364453">0</span>&nbsp;<span class="op" id="6364455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364459">n</span>&nbsp;<span class="op" id="6364461">:=</span>&nbsp;<span class="ident" id="6364464">atomic</span><span class="op" id="6364470">.</span><span class="ident" id="6364471">AddUint64</span><span class="op" id="6364480">(</span><span class="ident" id="6364481">pb</span><span class="op" id="6364483">.</span><span class="ident" id="6364484">globalN</span><span class="op" id="6364491">,</span>&nbsp;<span class="ident" id="6364493">pb</span><span class="op" id="6364495">.</span><span class="ident" id="6364496">grain</span><span class="op" id="6364501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6364505">if</span>&nbsp;<span class="ident" id="6364508">n</span>&nbsp;<span class="op" id="6364510">&lt;=</span>&nbsp;<span class="ident" id="6364513">pb</span><span class="op" id="6364515">.</span><span class="ident" id="6364516">bN</span>&nbsp;<span class="op" id="6364519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364524">pb</span><span class="op" id="6364526">.</span><span class="ident" id="6364527">cache</span>&nbsp;<span class="op" id="6364533">=</span>&nbsp;<span class="ident" id="6364535">pb</span><span class="op" id="6364537">.</span><span class="ident" id="6364538">grain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6364546">}</span>&nbsp;<span class="keyword" id="6364548">else</span>&nbsp;<span class="keyword" id="6364553">if</span>&nbsp;<span class="ident" id="6364556">n</span>&nbsp;<span class="op" id="6364558">&lt;</span>&nbsp;<span class="ident" id="6364560">pb</span><span class="op" id="6364562">.</span><span class="ident" id="6364563">bN</span><span class="op" id="6364565">+</span><span class="ident" id="6364566">pb</span><span class="op" id="6364568">.</span><span class="ident" id="6364569">grain</span>&nbsp;<span class="op" id="6364575">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364580">pb</span><span class="op" id="6364582">.</span><span class="ident" id="6364583">cache</span>&nbsp;<span class="op" id="6364589">=</span>&nbsp;<span class="ident" id="6364591">pb</span><span class="op" id="6364593">.</span><span class="ident" id="6364594">bN</span>&nbsp;<span class="op" id="6364597">+</span>&nbsp;<span class="ident" id="6364599">pb</span><span class="op" id="6364601">.</span><span class="ident" id="6364602">grain</span>&nbsp;<span class="op" id="6364608">-</span>&nbsp;<span class="ident" id="6364610">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6364614">}</span>&nbsp;<span class="keyword" id="6364616">else</span>&nbsp;<span class="op" id="6364621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6364626">return</span>&nbsp;<span class="builtintype" id="6364633">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6364641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6364644">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364647">pb</span><span class="op" id="6364649">.</span><span class="ident" id="6364650">cache</span><span class="op" id="6364655">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6364659">return</span>&nbsp;<span class="builtintype" id="6364666">true</span><br>
<span class="lineno"></span><span class="op" id="6364671">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6364674">//&nbsp;RunParallel&nbsp;runs&nbsp;a&nbsp;benchmark&nbsp;in&nbsp;parallel.</span><br>
<span class="lineno">380</span><span class="comment" id="6364719">//&nbsp;It&nbsp;creates&nbsp;multiple&nbsp;goroutines&nbsp;and&nbsp;distributes&nbsp;b.N&nbsp;iterations&nbsp;among&nbsp;them.</span><br>
<span class="lineno"></span><span class="comment" id="6364796">//&nbsp;The&nbsp;number&nbsp;of&nbsp;goroutines&nbsp;defaults&nbsp;to&nbsp;GOMAXPROCS.&nbsp;To&nbsp;increase&nbsp;parallelism&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="6364876">//&nbsp;non-CPU-bound&nbsp;benchmarks,&nbsp;call&nbsp;SetParallelism&nbsp;before&nbsp;RunParallel.</span><br>
<span class="lineno"></span><span class="comment" id="6364945">//&nbsp;RunParallel&nbsp;is&nbsp;usually&nbsp;used&nbsp;with&nbsp;the&nbsp;go&nbsp;test&nbsp;-cpu&nbsp;flag.</span><br>
<span class="lineno"></span><span class="comment" id="6365004">//</span><br>
<span class="lineno">385</span><span class="comment" id="6365007">//&nbsp;The&nbsp;body&nbsp;function&nbsp;will&nbsp;be&nbsp;run&nbsp;in&nbsp;each&nbsp;goroutine.&nbsp;It&nbsp;should&nbsp;set&nbsp;up&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="6365080">//&nbsp;goroutine-local&nbsp;state&nbsp;and&nbsp;then&nbsp;iterate&nbsp;until&nbsp;pb.Next&nbsp;returns&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="6365151">//&nbsp;It&nbsp;should&nbsp;not&nbsp;use&nbsp;the&nbsp;StartTimer,&nbsp;StopTimer,&nbsp;or&nbsp;ResetTimer&nbsp;functions,</span><br>
<span class="lineno"></span><span class="comment" id="6365224">//&nbsp;because&nbsp;they&nbsp;have&nbsp;global&nbsp;effect.</span><br>
<span class="lineno"></span><span class="keyword" id="6365260">func</span>&nbsp;<span class="op" id="6365265">(</span><span class="ident" id="6365266">b</span>&nbsp;<span class="op" id="6365268">*</span><span class="ident" id="6365269">B</span><span class="op" id="6365270">)</span>&nbsp;<span class="ident" id="6365272">RunParallel</span><span class="op" id="6365283">(</span><span class="ident" id="6365284">body</span>&nbsp;<span class="keyword" id="6365289">func</span><span class="op" id="6365293">(</span><span class="op" id="6365294">*</span><span class="ident" id="6365295">PB</span><span class="op" id="6365297">)</span><span class="op" id="6365298">)</span>&nbsp;<span class="op" id="6365300">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6365303">//&nbsp;Calculate&nbsp;grain&nbsp;size&nbsp;as&nbsp;number&nbsp;of&nbsp;iterations&nbsp;that&nbsp;take&nbsp;~100µs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6365371">//&nbsp;100µs&nbsp;is&nbsp;enough&nbsp;to&nbsp;amortize&nbsp;the&nbsp;overhead&nbsp;and&nbsp;provide&nbsp;sufficient</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6365440">//&nbsp;dynamic&nbsp;load&nbsp;balancing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6365468">grain</span>&nbsp;<span class="op" id="6365474">:=</span>&nbsp;<span class="ident" id="6365477">uint64</span><span class="op" id="6365483">(</span><span class="num" id="6365484">0</span><span class="op" id="6365485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6365488">if</span>&nbsp;<span class="ident" id="6365491">b</span><span class="op" id="6365492">.</span><span class="ident" id="6365493">previousN</span>&nbsp;<span class="op" id="6365503">&gt;</span>&nbsp;<span class="num" id="6365505">0</span>&nbsp;<span class="op" id="6365507">&amp;&amp;</span>&nbsp;<span class="ident" id="6365510">b</span><span class="op" id="6365511">.</span><span class="ident" id="6365512">previousDuration</span>&nbsp;<span class="op" id="6365529">&gt;</span>&nbsp;<span class="num" id="6365531">0</span>&nbsp;<span class="op" id="6365533">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6365537">grain</span>&nbsp;<span class="op" id="6365543">=</span>&nbsp;<span class="num" id="6365545">1e5</span>&nbsp;<span class="op" id="6365549">*</span>&nbsp;<span class="ident" id="6365551">uint64</span><span class="op" id="6365557">(</span><span class="ident" id="6365558">b</span><span class="op" id="6365559">.</span><span class="ident" id="6365560">previousN</span><span class="op" id="6365569">)</span>&nbsp;<span class="op" id="6365571">/</span>&nbsp;<span class="ident" id="6365573">uint64</span><span class="op" id="6365579">(</span><span class="ident" id="6365580">b</span><span class="op" id="6365581">.</span><span class="ident" id="6365582">previousDuration</span><span class="op" id="6365598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6365601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6365604">if</span>&nbsp;<span class="ident" id="6365607">grain</span>&nbsp;<span class="op" id="6365613">&lt;</span>&nbsp;<span class="num" id="6365615">1</span>&nbsp;<span class="op" id="6365617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6365621">grain</span>&nbsp;<span class="op" id="6365627">=</span>&nbsp;<span class="num" id="6365629">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6365632">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6365635">//&nbsp;We&nbsp;expect&nbsp;the&nbsp;inner&nbsp;loop&nbsp;and&nbsp;function&nbsp;call&nbsp;to&nbsp;take&nbsp;at&nbsp;least&nbsp;10ns,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6365705">//&nbsp;so&nbsp;do&nbsp;not&nbsp;do&nbsp;more&nbsp;than&nbsp;100µs/10ns=1e4&nbsp;iterations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6365760">if</span>&nbsp;<span class="ident" id="6365763">grain</span>&nbsp;<span class="op" id="6365769">&gt;</span>&nbsp;<span class="num" id="6365771">1e4</span>&nbsp;<span class="op" id="6365775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6365779">grain</span>&nbsp;<span class="op" id="6365785">=</span>&nbsp;<span class="num" id="6365787">1e4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6365792">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6365796">n</span>&nbsp;<span class="op" id="6365798">:=</span>&nbsp;<span class="ident" id="6365801">uint64</span><span class="op" id="6365807">(</span><span class="num" id="6365808">0</span><span class="op" id="6365809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6365812">numProcs</span>&nbsp;<span class="op" id="6365821">:=</span>&nbsp;<span class="ident" id="6365824">b</span><span class="op" id="6365825">.</span><span class="ident" id="6365826">parallelism</span>&nbsp;<span class="op" id="6365838">*</span>&nbsp;<span class="ident" id="6365840">runtime</span><span class="op" id="6365847">.</span><span class="ident" id="6365848">GOMAXPROCS</span><span class="op" id="6365858">(</span><span class="num" id="6365859">0</span><span class="op" id="6365860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6365863">var</span>&nbsp;<span class="ident" id="6365867">wg</span>&nbsp;<span class="ident" id="6365870">sync</span><span class="op" id="6365874">.</span><span class="ident" id="6365875">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6365886">wg</span><span class="op" id="6365888">.</span><span class="ident" id="6365889">Add</span><span class="op" id="6365892">(</span><span class="ident" id="6365893">numProcs</span><span class="op" id="6365901">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6365904">for</span>&nbsp;<span class="ident" id="6365908">p</span>&nbsp;<span class="op" id="6365910">:=</span>&nbsp;<span class="num" id="6365913">0</span><span class="op" id="6365914">;</span>&nbsp;<span class="ident" id="6365916">p</span>&nbsp;<span class="op" id="6365918">&lt;</span>&nbsp;<span class="ident" id="6365920">numProcs</span><span class="op" id="6365928">;</span>&nbsp;<span class="ident" id="6365930">p</span><span class="op" id="6365931">++</span>&nbsp;<span class="op" id="6365934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6365938">go</span>&nbsp;<span class="keyword" id="6365941">func</span><span class="op" id="6365945">(</span><span class="op" id="6365946">)</span>&nbsp;<span class="op" id="6365948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6365953">defer</span>&nbsp;<span class="ident" id="6365959">wg</span><span class="op" id="6365961">.</span><span class="ident" id="6365962">Done</span><span class="op" id="6365966">(</span><span class="op" id="6365967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6365972">pb</span>&nbsp;<span class="op" id="6365975">:=</span>&nbsp;<span class="op" id="6365978">&amp;</span><span class="ident" id="6365979">PB</span><span class="op" id="6365981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6365987">globalN</span><span class="op" id="6365994">:</span>&nbsp;<span class="op" id="6365996">&amp;</span><span class="ident" id="6365997">n</span><span class="op" id="6365998">,</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366004">grain</span><span class="op" id="6366009">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6366013">grain</span><span class="op" id="6366018">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366024">bN</span><span class="op" id="6366026">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6366033">uint64</span><span class="op" id="6366039">(</span><span class="ident" id="6366040">b</span><span class="op" id="6366041">.</span><span class="ident" id="6366042">N</span><span class="op" id="6366043">)</span><span class="op" id="6366044">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6366049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366054">body</span><span class="op" id="6366058">(</span><span class="ident" id="6366059">pb</span><span class="op" id="6366061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6366065">}</span><span class="op" id="6366066">(</span><span class="op" id="6366067">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6366070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366073">wg</span><span class="op" id="6366075">.</span><span class="ident" id="6366076">Wait</span><span class="op" id="6366080">(</span><span class="op" id="6366081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6366084">if</span>&nbsp;<span class="ident" id="6366087">n</span>&nbsp;<span class="op" id="6366089">&lt;=</span>&nbsp;<span class="ident" id="6366092">uint64</span><span class="op" id="6366098">(</span><span class="ident" id="6366099">b</span><span class="op" id="6366100">.</span><span class="ident" id="6366101">N</span><span class="op" id="6366102">)</span>&nbsp;<span class="op" id="6366104">&amp;&amp;</span>&nbsp;<span class="op" id="6366107">!</span><span class="ident" id="6366108">b</span><span class="op" id="6366109">.</span><span class="ident" id="6366110">Failed</span><span class="op" id="6366116">(</span><span class="op" id="6366117">)</span>&nbsp;<span class="op" id="6366119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366123">b</span><span class="op" id="6366124">.</span><span class="ident" id="6366125">Fatal</span><span class="op" id="6366130">(</span><span class="string" id="6366131">&#34;RunParallel:&nbsp;body&nbsp;exited&nbsp;without&nbsp;pb.Next()&nbsp;==&nbsp;false&#34;</span><span class="op" id="6366184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6366187">}</span><br>
<span class="lineno">425</span><span class="op" id="6366189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6366192">//&nbsp;SetParallelism&nbsp;sets&nbsp;the&nbsp;number&nbsp;of&nbsp;goroutines&nbsp;used&nbsp;by&nbsp;RunParallel&nbsp;to&nbsp;p*GOMAXPROCS.</span><br>
<span class="lineno"></span><span class="comment" id="6366277">//&nbsp;There&nbsp;is&nbsp;usually&nbsp;no&nbsp;need&nbsp;to&nbsp;call&nbsp;SetParallelism&nbsp;for&nbsp;CPU-bound&nbsp;benchmarks.</span><br>
<span class="lineno"></span><span class="comment" id="6366354">//&nbsp;If&nbsp;p&nbsp;is&nbsp;less&nbsp;than&nbsp;1,&nbsp;this&nbsp;call&nbsp;will&nbsp;have&nbsp;no&nbsp;effect.</span><br>
<span class="lineno">430</span><span class="keyword" id="6366409">func</span>&nbsp;<span class="op" id="6366414">(</span><span class="ident" id="6366415">b</span>&nbsp;<span class="op" id="6366417">*</span><span class="ident" id="6366418">B</span><span class="op" id="6366419">)</span>&nbsp;<span class="ident" id="6366421">SetParallelism</span><span class="op" id="6366435">(</span><span class="ident" id="6366436">p</span>&nbsp;<span class="builtintype" id="6366438">int</span><span class="op" id="6366441">)</span>&nbsp;<span class="op" id="6366443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6366446">if</span>&nbsp;<span class="ident" id="6366449">p</span>&nbsp;<span class="op" id="6366451">&gt;=</span>&nbsp;<span class="num" id="6366454">1</span>&nbsp;<span class="op" id="6366456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366460">b</span><span class="op" id="6366461">.</span><span class="ident" id="6366462">parallelism</span>&nbsp;<span class="op" id="6366474">=</span>&nbsp;<span class="ident" id="6366476">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6366479">}</span><br>
<span class="lineno"></span><span class="op" id="6366481">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span><span class="comment" id="6366484">//&nbsp;Benchmark&nbsp;benchmarks&nbsp;a&nbsp;single&nbsp;function.&nbsp;Useful&nbsp;for&nbsp;creating</span><br>
<span class="lineno"></span><span class="comment" id="6366547">//&nbsp;custom&nbsp;benchmarks&nbsp;that&nbsp;do&nbsp;not&nbsp;use&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="6366607">func</span>&nbsp;<span class="ident" id="6366612">Benchmark</span><span class="op" id="6366621">(</span><span class="ident" id="6366622">f</span>&nbsp;<span class="keyword" id="6366624">func</span><span class="op" id="6366628">(</span><span class="ident" id="6366629">b</span>&nbsp;<span class="op" id="6366631">*</span><span class="ident" id="6366632">B</span><span class="op" id="6366633">)</span><span class="op" id="6366634">)</span>&nbsp;<span class="ident" id="6366636">BenchmarkResult</span>&nbsp;<span class="op" id="6366652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366655">b</span>&nbsp;<span class="op" id="6366657">:=</span>&nbsp;<span class="op" id="6366660">&amp;</span><span class="ident" id="6366661">B</span><span class="op" id="6366662">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366666">common</span><span class="op" id="6366672">:</span>&nbsp;<span class="ident" id="6366674">common</span><span class="op" id="6366680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366685">signal</span><span class="op" id="6366691">:</span>&nbsp;<span class="builtinfunc" id="6366693">make</span><span class="op" id="6366697">(</span><span class="keyword" id="6366698">chan</span>&nbsp;<span class="keyword" id="6366703">interface</span><span class="op" id="6366712">{</span><span class="op" id="6366713">}</span><span class="op" id="6366714">)</span><span class="op" id="6366715">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6366719">}</span><span class="op" id="6366720">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366724">benchmark</span><span class="op" id="6366733">:</span>&nbsp;<span class="ident" id="6366735">InternalBenchmark</span><span class="op" id="6366752">{</span><span class="string" id="6366753">&#34;&#34;</span><span class="op" id="6366755">,</span>&nbsp;<span class="ident" id="6366757">f</span><span class="op" id="6366758">}</span><span class="op" id="6366759">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6366762">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6366765">return</span>&nbsp;<span class="ident" id="6366772">b</span><span class="op" id="6366773">.</span><span class="ident" id="6366774">run</span><span class="op" id="6366777">(</span><span class="op" id="6366778">)</span><br>
<span class="lineno"></span><span class="op" id="6366780">}</span>
</div>
</body>
</html>
