<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4769836">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4769892">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4769946">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4769997">package</span>&nbsp;<span class="ident" id="4770005">json</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4770011">import</span>&nbsp;<span class="string" id="4770018">&#34;bytes&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4770027">//&nbsp;Compact&nbsp;appends&nbsp;to&nbsp;dst&nbsp;the&nbsp;JSON-encoded&nbsp;src&nbsp;with</span><br>
<span class="lineno">10</span><span class="comment" id="4770079">//&nbsp;insignificant&nbsp;space&nbsp;characters&nbsp;elided.</span><br>
<span class="lineno"></span><span class="keyword" id="4770121">func</span>&nbsp;<span class="ident" id="4770126">Compact</span><span class="op" id="4770133">(</span><span class="ident" id="4770134">dst</span>&nbsp;<span class="op" id="4770138">*</span><span class="ident" id="4770139">bytes</span><span class="op" id="4770144">.</span><span class="ident" id="4770145">Buffer</span><span class="op" id="4770151">,</span>&nbsp;<span class="ident" id="4770153">src</span>&nbsp;<span class="op" id="4770157">[</span><span class="op" id="4770158">]</span><span class="builtintype" id="4770159">byte</span><span class="op" id="4770163">)</span>&nbsp;<span class="builtintype" id="4770165">error</span>&nbsp;<span class="op" id="4770171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4770174">return</span>&nbsp;<span class="ident" id="4770181">compact</span><span class="op" id="4770188">(</span><span class="ident" id="4770189">dst</span><span class="op" id="4770192">,</span>&nbsp;<span class="ident" id="4770194">src</span><span class="op" id="4770197">,</span>&nbsp;<span class="ident" id="4770199">false</span><span class="op" id="4770204">)</span><br>
<span class="lineno"></span><span class="op" id="4770206">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="4770209">func</span>&nbsp;<span class="ident" id="4770214">compact</span><span class="op" id="4770221">(</span><span class="ident" id="4770222">dst</span>&nbsp;<span class="op" id="4770226">*</span><span class="ident" id="4770227">bytes</span><span class="op" id="4770232">.</span><span class="ident" id="4770233">Buffer</span><span class="op" id="4770239">,</span>&nbsp;<span class="ident" id="4770241">src</span>&nbsp;<span class="op" id="4770245">[</span><span class="op" id="4770246">]</span><span class="builtintype" id="4770247">byte</span><span class="op" id="4770251">,</span>&nbsp;<span class="ident" id="4770253">escape</span>&nbsp;<span class="builtintype" id="4770260">bool</span><span class="op" id="4770264">)</span>&nbsp;<span class="builtintype" id="4770266">error</span>&nbsp;<span class="op" id="4770272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4770275">origLen</span>&nbsp;<span class="op" id="4770283">:=</span>&nbsp;<span class="ident" id="4770286">dst</span><span class="op" id="4770289">.</span><span class="ident" id="4770290">Len</span><span class="op" id="4770293">(</span><span class="op" id="4770294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4770297">var</span>&nbsp;<span class="ident" id="4770301">scan</span>&nbsp;<span class="ident" id="4770306">scanner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4770315">scan</span><span class="op" id="4770319">.</span><span class="ident" id="4770320">reset</span><span class="op" id="4770325">(</span><span class="op" id="4770326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4770329">start</span>&nbsp;<span class="op" id="4770335">:=</span>&nbsp;<span class="num" id="4770338">0</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4770341">for</span>&nbsp;<span class="ident" id="4770345">i</span><span class="op" id="4770346">,</span>&nbsp;<span class="ident" id="4770348">c</span>&nbsp;<span class="op" id="4770350">:=</span>&nbsp;<span class="keyword" id="4770353">range</span>&nbsp;<span class="ident" id="4770359">src</span>&nbsp;<span class="op" id="4770363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4770367">if</span>&nbsp;<span class="ident" id="4770370">escape</span>&nbsp;<span class="op" id="4770377">&amp;&amp;</span>&nbsp;<span class="op" id="4770380">(</span><span class="ident" id="4770381">c</span>&nbsp;<span class="op" id="4770383">==</span>&nbsp;<span class="string" id="4770386">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="4770390">||</span>&nbsp;<span class="ident" id="4770393">c</span>&nbsp;<span class="op" id="4770395">==</span>&nbsp;<span class="string" id="4770398">&#39;&gt;&#39;</span>&nbsp;<span class="op" id="4770402">||</span>&nbsp;<span class="ident" id="4770405">c</span>&nbsp;<span class="op" id="4770407">==</span>&nbsp;<span class="string" id="4770410">&#39;&amp;&#39;</span><span class="op" id="4770413">)</span>&nbsp;<span class="op" id="4770415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4770420">if</span>&nbsp;<span class="ident" id="4770423">start</span>&nbsp;<span class="op" id="4770429">&lt;</span>&nbsp;<span class="ident" id="4770431">i</span>&nbsp;<span class="op" id="4770433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4770439">dst</span><span class="op" id="4770442">.</span><span class="ident" id="4770443">Write</span><span class="op" id="4770448">(</span><span class="ident" id="4770449">src</span><span class="op" id="4770452">[</span><span class="ident" id="4770453">start</span><span class="op" id="4770458">:</span><span class="ident" id="4770459">i</span><span class="op" id="4770460">]</span><span class="op" id="4770461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4770466">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4770471">dst</span><span class="op" id="4770474">.</span><span class="ident" id="4770475">WriteString</span><span class="op" id="4770486">(</span><span class="string" id="4770487">`\u00`</span><span class="op" id="4770493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4770498">dst</span><span class="op" id="4770501">.</span><span class="ident" id="4770502">WriteByte</span><span class="op" id="4770511">(</span><span class="ident" id="4770512">hex</span><span class="op" id="4770515">[</span><span class="ident" id="4770516">c</span><span class="op" id="4770517">&gt;&gt;</span><span class="num" id="4770519">4</span><span class="op" id="4770520">]</span><span class="op" id="4770521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4770526">dst</span><span class="op" id="4770529">.</span><span class="ident" id="4770530">WriteByte</span><span class="op" id="4770539">(</span><span class="ident" id="4770540">hex</span><span class="op" id="4770543">[</span><span class="ident" id="4770544">c</span><span class="op" id="4770545">&amp;</span><span class="num" id="4770546">0xF</span><span class="op" id="4770549">]</span><span class="op" id="4770550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4770555">start</span>&nbsp;<span class="op" id="4770561">=</span>&nbsp;<span class="ident" id="4770563">i</span>&nbsp;<span class="op" id="4770565">+</span>&nbsp;<span class="num" id="4770567">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4770571">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4770575">//&nbsp;Convert&nbsp;U+2028&nbsp;and&nbsp;U+2029&nbsp;(E2&nbsp;80&nbsp;A8&nbsp;and&nbsp;E2&nbsp;80&nbsp;A9).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4770631">if</span>&nbsp;<span class="ident" id="4770634">c</span>&nbsp;<span class="op" id="4770636">==</span>&nbsp;<span class="num" id="4770639">0xE2</span>&nbsp;<span class="op" id="4770644">&amp;&amp;</span>&nbsp;<span class="ident" id="4770647">i</span><span class="op" id="4770648">+</span><span class="num" id="4770649">2</span>&nbsp;<span class="op" id="4770651">&lt;</span>&nbsp;<span class="builtinfunc" id="4770653">len</span><span class="op" id="4770656">(</span><span class="ident" id="4770657">src</span><span class="op" id="4770660">)</span>&nbsp;<span class="op" id="4770662">&amp;&amp;</span>&nbsp;<span class="ident" id="4770665">src</span><span class="op" id="4770668">[</span><span class="ident" id="4770669">i</span><span class="op" id="4770670">+</span><span class="num" id="4770671">1</span><span class="op" id="4770672">]</span>&nbsp;<span class="op" id="4770674">==</span>&nbsp;<span class="num" id="4770677">0x80</span>&nbsp;<span class="op" id="4770682">&amp;&amp;</span>&nbsp;<span class="ident" id="4770685">src</span><span class="op" id="4770688">[</span><span class="ident" id="4770689">i</span><span class="op" id="4770690">+</span><span class="num" id="4770691">2</span><span class="op" id="4770692">]</span><span class="op" id="4770693">&amp;^</span><span class="num" id="4770695">1</span>&nbsp;<span class="op" id="4770697">==</span>&nbsp;<span class="num" id="4770700">0xA8</span>&nbsp;<span class="op" id="4770705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4770710">if</span>&nbsp;<span class="ident" id="4770713">start</span>&nbsp;<span class="op" id="4770719">&lt;</span>&nbsp;<span class="ident" id="4770721">i</span>&nbsp;<span class="op" id="4770723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4770729">dst</span><span class="op" id="4770732">.</span><span class="ident" id="4770733">Write</span><span class="op" id="4770738">(</span><span class="ident" id="4770739">src</span><span class="op" id="4770742">[</span><span class="ident" id="4770743">start</span><span class="op" id="4770748">:</span><span class="ident" id="4770749">i</span><span class="op" id="4770750">]</span><span class="op" id="4770751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4770756">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4770761">dst</span><span class="op" id="4770764">.</span><span class="ident" id="4770765">WriteString</span><span class="op" id="4770776">(</span><span class="string" id="4770777">`\u202`</span><span class="op" id="4770784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4770789">dst</span><span class="op" id="4770792">.</span><span class="ident" id="4770793">WriteByte</span><span class="op" id="4770802">(</span><span class="ident" id="4770803">hex</span><span class="op" id="4770806">[</span><span class="ident" id="4770807">src</span><span class="op" id="4770810">[</span><span class="ident" id="4770811">i</span><span class="op" id="4770812">+</span><span class="num" id="4770813">2</span><span class="op" id="4770814">]</span><span class="op" id="4770815">&amp;</span><span class="num" id="4770816">0xF</span><span class="op" id="4770819">]</span><span class="op" id="4770820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4770825">start</span>&nbsp;<span class="op" id="4770831">=</span>&nbsp;<span class="ident" id="4770833">i</span>&nbsp;<span class="op" id="4770835">+</span>&nbsp;<span class="num" id="4770837">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4770841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4770845">v</span>&nbsp;<span class="op" id="4770847">:=</span>&nbsp;<span class="ident" id="4770850">scan</span><span class="op" id="4770854">.</span><span class="ident" id="4770855">step</span><span class="op" id="4770859">(</span><span class="op" id="4770860">&amp;</span><span class="ident" id="4770861">scan</span><span class="op" id="4770865">,</span>&nbsp;<span class="builtintype" id="4770867">int</span><span class="op" id="4770870">(</span><span class="ident" id="4770871">c</span><span class="op" id="4770872">)</span><span class="op" id="4770873">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4770877">if</span>&nbsp;<span class="ident" id="4770880">v</span>&nbsp;<span class="op" id="4770882">&gt;=</span>&nbsp;<span class="ident" id="4770885">scanSkipSpace</span>&nbsp;<span class="op" id="4770899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4770904">if</span>&nbsp;<span class="ident" id="4770907">v</span>&nbsp;<span class="op" id="4770909">==</span>&nbsp;<span class="ident" id="4770912">scanError</span>&nbsp;<span class="op" id="4770922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4770928">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4770937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4770942">if</span>&nbsp;<span class="ident" id="4770945">start</span>&nbsp;<span class="op" id="4770951">&lt;</span>&nbsp;<span class="ident" id="4770953">i</span>&nbsp;<span class="op" id="4770955">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4770961">dst</span><span class="op" id="4770964">.</span><span class="ident" id="4770965">Write</span><span class="op" id="4770970">(</span><span class="ident" id="4770971">src</span><span class="op" id="4770974">[</span><span class="ident" id="4770975">start</span><span class="op" id="4770980">:</span><span class="ident" id="4770981">i</span><span class="op" id="4770982">]</span><span class="op" id="4770983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4770988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4770993">start</span>&nbsp;<span class="op" id="4770999">=</span>&nbsp;<span class="ident" id="4771001">i</span>&nbsp;<span class="op" id="4771003">+</span>&nbsp;<span class="num" id="4771005">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4771009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4771012">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4771015">if</span>&nbsp;<span class="ident" id="4771018">scan</span><span class="op" id="4771022">.</span><span class="ident" id="4771023">eof</span><span class="op" id="4771026">(</span><span class="op" id="4771027">)</span>&nbsp;<span class="op" id="4771029">==</span>&nbsp;<span class="ident" id="4771032">scanError</span>&nbsp;<span class="op" id="4771042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4771046">dst</span><span class="op" id="4771049">.</span><span class="ident" id="4771050">Truncate</span><span class="op" id="4771058">(</span><span class="ident" id="4771059">origLen</span><span class="op" id="4771066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4771070">return</span>&nbsp;<span class="ident" id="4771077">scan</span><span class="op" id="4771081">.</span><span class="ident" id="4771082">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4771087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4771090">if</span>&nbsp;<span class="ident" id="4771093">start</span>&nbsp;<span class="op" id="4771099">&lt;</span>&nbsp;<span class="builtinfunc" id="4771101">len</span><span class="op" id="4771104">(</span><span class="ident" id="4771105">src</span><span class="op" id="4771108">)</span>&nbsp;<span class="op" id="4771110">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4771114">dst</span><span class="op" id="4771117">.</span><span class="ident" id="4771118">Write</span><span class="op" id="4771123">(</span><span class="ident" id="4771124">src</span><span class="op" id="4771127">[</span><span class="ident" id="4771128">start</span><span class="op" id="4771133">:</span><span class="op" id="4771134">]</span><span class="op" id="4771135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4771138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4771141">return</span>&nbsp;<span class="ident" id="4771148">nil</span><br>
<span class="lineno"></span><span class="op" id="4771152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="keyword" id="4771155">func</span>&nbsp;<span class="ident" id="4771160">newline</span><span class="op" id="4771167">(</span><span class="ident" id="4771168">dst</span>&nbsp;<span class="op" id="4771172">*</span><span class="ident" id="4771173">bytes</span><span class="op" id="4771178">.</span><span class="ident" id="4771179">Buffer</span><span class="op" id="4771185">,</span>&nbsp;<span class="ident" id="4771187">prefix</span><span class="op" id="4771193">,</span>&nbsp;<span class="ident" id="4771195">indent</span>&nbsp;<span class="builtintype" id="4771202">string</span><span class="op" id="4771208">,</span>&nbsp;<span class="ident" id="4771210">depth</span>&nbsp;<span class="builtintype" id="4771216">int</span><span class="op" id="4771219">)</span>&nbsp;<span class="op" id="4771221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4771224">dst</span><span class="op" id="4771227">.</span><span class="ident" id="4771228">WriteByte</span><span class="op" id="4771237">(</span><span class="string" id="4771238">&#39;\n&#39;</span><span class="op" id="4771242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4771245">dst</span><span class="op" id="4771248">.</span><span class="ident" id="4771249">WriteString</span><span class="op" id="4771260">(</span><span class="ident" id="4771261">prefix</span><span class="op" id="4771267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4771270">for</span>&nbsp;<span class="ident" id="4771274">i</span>&nbsp;<span class="op" id="4771276">:=</span>&nbsp;<span class="num" id="4771279">0</span><span class="op" id="4771280">;</span>&nbsp;<span class="ident" id="4771282">i</span>&nbsp;<span class="op" id="4771284">&lt;</span>&nbsp;<span class="ident" id="4771286">depth</span><span class="op" id="4771291">;</span>&nbsp;<span class="ident" id="4771293">i</span><span class="op" id="4771294">++</span>&nbsp;<span class="op" id="4771297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4771301">dst</span><span class="op" id="4771304">.</span><span class="ident" id="4771305">WriteString</span><span class="op" id="4771316">(</span><span class="ident" id="4771317">indent</span><span class="op" id="4771323">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4771326">}</span><br>
<span class="lineno"></span><span class="op" id="4771328">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4771331">//&nbsp;Indent&nbsp;appends&nbsp;to&nbsp;dst&nbsp;an&nbsp;indented&nbsp;form&nbsp;of&nbsp;the&nbsp;JSON-encoded&nbsp;src.</span><br>
<span class="lineno"></span><span class="comment" id="4771398">//&nbsp;Each&nbsp;element&nbsp;in&nbsp;a&nbsp;JSON&nbsp;object&nbsp;or&nbsp;array&nbsp;begins&nbsp;on&nbsp;a&nbsp;new,</span><br>
<span class="lineno">70</span><span class="comment" id="4771457">//&nbsp;indented&nbsp;line&nbsp;beginning&nbsp;with&nbsp;prefix&nbsp;followed&nbsp;by&nbsp;one&nbsp;or&nbsp;more</span><br>
<span class="lineno"></span><span class="comment" id="4771520">//&nbsp;copies&nbsp;of&nbsp;indent&nbsp;according&nbsp;to&nbsp;the&nbsp;indentation&nbsp;nesting.</span><br>
<span class="lineno"></span><span class="comment" id="4771578">//&nbsp;The&nbsp;data&nbsp;appended&nbsp;to&nbsp;dst&nbsp;does&nbsp;not&nbsp;begin&nbsp;with&nbsp;the&nbsp;prefix&nbsp;nor</span><br>
<span class="lineno"></span><span class="comment" id="4771641">//&nbsp;any&nbsp;indentation,&nbsp;and&nbsp;has&nbsp;no&nbsp;trailing&nbsp;newline,&nbsp;to&nbsp;make&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="4771701">//&nbsp;easier&nbsp;to&nbsp;embed&nbsp;inside&nbsp;other&nbsp;formatted&nbsp;JSON&nbsp;data.</span><br>
<span class="lineno">75</span><span class="keyword" id="4771754">func</span>&nbsp;<span class="ident" id="4771759">Indent</span><span class="op" id="4771765">(</span><span class="ident" id="4771766">dst</span>&nbsp;<span class="op" id="4771770">*</span><span class="ident" id="4771771">bytes</span><span class="op" id="4771776">.</span><span class="ident" id="4771777">Buffer</span><span class="op" id="4771783">,</span>&nbsp;<span class="ident" id="4771785">src</span>&nbsp;<span class="op" id="4771789">[</span><span class="op" id="4771790">]</span><span class="builtintype" id="4771791">byte</span><span class="op" id="4771795">,</span>&nbsp;<span class="ident" id="4771797">prefix</span><span class="op" id="4771803">,</span>&nbsp;<span class="ident" id="4771805">indent</span>&nbsp;<span class="builtintype" id="4771812">string</span><span class="op" id="4771818">)</span>&nbsp;<span class="builtintype" id="4771820">error</span>&nbsp;<span class="op" id="4771826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4771829">origLen</span>&nbsp;<span class="op" id="4771837">:=</span>&nbsp;<span class="ident" id="4771840">dst</span><span class="op" id="4771843">.</span><span class="ident" id="4771844">Len</span><span class="op" id="4771847">(</span><span class="op" id="4771848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4771851">var</span>&nbsp;<span class="ident" id="4771855">scan</span>&nbsp;<span class="ident" id="4771860">scanner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4771869">scan</span><span class="op" id="4771873">.</span><span class="ident" id="4771874">reset</span><span class="op" id="4771879">(</span><span class="op" id="4771880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4771883">needIndent</span>&nbsp;<span class="op" id="4771894">:=</span>&nbsp;<span class="ident" id="4771897">false</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4771904">depth</span>&nbsp;<span class="op" id="4771910">:=</span>&nbsp;<span class="num" id="4771913">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4771916">for</span>&nbsp;<span class="ident" id="4771920">_</span><span class="op" id="4771921">,</span>&nbsp;<span class="ident" id="4771923">c</span>&nbsp;<span class="op" id="4771925">:=</span>&nbsp;<span class="keyword" id="4771928">range</span>&nbsp;<span class="ident" id="4771934">src</span>&nbsp;<span class="op" id="4771938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4771942">scan</span><span class="op" id="4771946">.</span><span class="ident" id="4771947">bytes</span><span class="op" id="4771952">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4771957">v</span>&nbsp;<span class="op" id="4771959">:=</span>&nbsp;<span class="ident" id="4771962">scan</span><span class="op" id="4771966">.</span><span class="ident" id="4771967">step</span><span class="op" id="4771971">(</span><span class="op" id="4771972">&amp;</span><span class="ident" id="4771973">scan</span><span class="op" id="4771977">,</span>&nbsp;<span class="builtintype" id="4771979">int</span><span class="op" id="4771982">(</span><span class="ident" id="4771983">c</span><span class="op" id="4771984">)</span><span class="op" id="4771985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4771989">if</span>&nbsp;<span class="ident" id="4771992">v</span>&nbsp;<span class="op" id="4771994">==</span>&nbsp;<span class="ident" id="4771997">scanSkipSpace</span>&nbsp;<span class="op" id="4772011">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4772016">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4772027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4772031">if</span>&nbsp;<span class="ident" id="4772034">v</span>&nbsp;<span class="op" id="4772036">==</span>&nbsp;<span class="ident" id="4772039">scanError</span>&nbsp;<span class="op" id="4772049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4772054">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4772062">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4772066">if</span>&nbsp;<span class="ident" id="4772069">needIndent</span>&nbsp;<span class="op" id="4772080">&amp;&amp;</span>&nbsp;<span class="ident" id="4772083">v</span>&nbsp;<span class="op" id="4772085">!=</span>&nbsp;<span class="ident" id="4772088">scanEndObject</span>&nbsp;<span class="op" id="4772102">&amp;&amp;</span>&nbsp;<span class="ident" id="4772105">v</span>&nbsp;<span class="op" id="4772107">!=</span>&nbsp;<span class="ident" id="4772110">scanEndArray</span>&nbsp;<span class="op" id="4772123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4772128">needIndent</span>&nbsp;<span class="op" id="4772139">=</span>&nbsp;<span class="ident" id="4772141">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4772150">depth</span><span class="op" id="4772155">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4772161">newline</span><span class="op" id="4772168">(</span><span class="ident" id="4772169">dst</span><span class="op" id="4772172">,</span>&nbsp;<span class="ident" id="4772174">prefix</span><span class="op" id="4772180">,</span>&nbsp;<span class="ident" id="4772182">indent</span><span class="op" id="4772188">,</span>&nbsp;<span class="ident" id="4772190">depth</span><span class="op" id="4772195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4772199">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4772204">//&nbsp;Emit&nbsp;semantically&nbsp;uninteresting&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4772247">//&nbsp;(in&nbsp;particular,&nbsp;punctuation&nbsp;in&nbsp;strings)&nbsp;unmodified.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4772304">if</span>&nbsp;<span class="ident" id="4772307">v</span>&nbsp;<span class="op" id="4772309">==</span>&nbsp;<span class="ident" id="4772312">scanContinue</span>&nbsp;<span class="op" id="4772325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4772330">dst</span><span class="op" id="4772333">.</span><span class="ident" id="4772334">WriteByte</span><span class="op" id="4772343">(</span><span class="ident" id="4772344">c</span><span class="op" id="4772345">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4772350">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4772361">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4772366">//&nbsp;Add&nbsp;spacing&nbsp;around&nbsp;real&nbsp;punctuation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4772408">switch</span>&nbsp;<span class="ident" id="4772415">c</span>&nbsp;<span class="op" id="4772417">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4772421">case</span>&nbsp;<span class="string" id="4772426">&#39;{&#39;</span><span class="op" id="4772429">,</span>&nbsp;<span class="string" id="4772431">&#39;[&#39;</span><span class="op" id="4772434">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4772439">//&nbsp;delay&nbsp;indent&nbsp;so&nbsp;that&nbsp;empty&nbsp;object&nbsp;and&nbsp;array&nbsp;are&nbsp;formatted&nbsp;as&nbsp;{}&nbsp;and&nbsp;[].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4772517">needIndent</span>&nbsp;<span class="op" id="4772528">=</span>&nbsp;<span class="ident" id="4772530">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4772538">dst</span><span class="op" id="4772541">.</span><span class="ident" id="4772542">WriteByte</span><span class="op" id="4772551">(</span><span class="ident" id="4772552">c</span><span class="op" id="4772553">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4772558">case</span>&nbsp;<span class="string" id="4772563">&#39;,&#39;</span><span class="op" id="4772566">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4772571">dst</span><span class="op" id="4772574">.</span><span class="ident" id="4772575">WriteByte</span><span class="op" id="4772584">(</span><span class="ident" id="4772585">c</span><span class="op" id="4772586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4772591">newline</span><span class="op" id="4772598">(</span><span class="ident" id="4772599">dst</span><span class="op" id="4772602">,</span>&nbsp;<span class="ident" id="4772604">prefix</span><span class="op" id="4772610">,</span>&nbsp;<span class="ident" id="4772612">indent</span><span class="op" id="4772618">,</span>&nbsp;<span class="ident" id="4772620">depth</span><span class="op" id="4772625">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4772630">case</span>&nbsp;<span class="string" id="4772635">&#39;:&#39;</span><span class="op" id="4772638">:</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4772643">dst</span><span class="op" id="4772646">.</span><span class="ident" id="4772647">WriteByte</span><span class="op" id="4772656">(</span><span class="ident" id="4772657">c</span><span class="op" id="4772658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4772663">dst</span><span class="op" id="4772666">.</span><span class="ident" id="4772667">WriteByte</span><span class="op" id="4772676">(</span><span class="string" id="4772677">&#39;&nbsp;&#39;</span><span class="op" id="4772680">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4772685">case</span>&nbsp;<span class="string" id="4772690">&#39;}&#39;</span><span class="op" id="4772693">,</span>&nbsp;<span class="string" id="4772695">&#39;]&#39;</span><span class="op" id="4772698">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4772703">if</span>&nbsp;<span class="ident" id="4772706">needIndent</span>&nbsp;<span class="op" id="4772717">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4772723">//&nbsp;suppress&nbsp;indent&nbsp;in&nbsp;empty&nbsp;object/array</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4772768">needIndent</span>&nbsp;<span class="op" id="4772779">=</span>&nbsp;<span class="ident" id="4772781">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4772790">}</span>&nbsp;<span class="keyword" id="4772792">else</span>&nbsp;<span class="op" id="4772797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4772803">depth</span><span class="op" id="4772808">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4772815">newline</span><span class="op" id="4772822">(</span><span class="ident" id="4772823">dst</span><span class="op" id="4772826">,</span>&nbsp;<span class="ident" id="4772828">prefix</span><span class="op" id="4772834">,</span>&nbsp;<span class="ident" id="4772836">indent</span><span class="op" id="4772842">,</span>&nbsp;<span class="ident" id="4772844">depth</span><span class="op" id="4772849">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4772854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4772859">dst</span><span class="op" id="4772862">.</span><span class="ident" id="4772863">WriteByte</span><span class="op" id="4772872">(</span><span class="ident" id="4772873">c</span><span class="op" id="4772874">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4772879">default</span><span class="op" id="4772886">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4772891">dst</span><span class="op" id="4772894">.</span><span class="ident" id="4772895">WriteByte</span><span class="op" id="4772904">(</span><span class="ident" id="4772905">c</span><span class="op" id="4772906">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4772910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4772913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4772916">if</span>&nbsp;<span class="ident" id="4772919">scan</span><span class="op" id="4772923">.</span><span class="ident" id="4772924">eof</span><span class="op" id="4772927">(</span><span class="op" id="4772928">)</span>&nbsp;<span class="op" id="4772930">==</span>&nbsp;<span class="ident" id="4772933">scanError</span>&nbsp;<span class="op" id="4772943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4772947">dst</span><span class="op" id="4772950">.</span><span class="ident" id="4772951">Truncate</span><span class="op" id="4772959">(</span><span class="ident" id="4772960">origLen</span><span class="op" id="4772967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4772971">return</span>&nbsp;<span class="ident" id="4772978">scan</span><span class="op" id="4772982">.</span><span class="ident" id="4772983">err</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4772988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4772991">return</span>&nbsp;<span class="ident" id="4772998">nil</span><br>
<span class="lineno"></span><span class="op" id="4773002">}</span>
</div>
</body>
</html>
