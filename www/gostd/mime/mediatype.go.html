<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime</h2>
<ul>
<li><a href="/gostd/mime/grammar.go.html">grammar.go</a></li>
<li><a href="/gostd/mime/mediatype.go.html" class="current">mediatype.go</a></li>
<li><a href="/gostd/mime/mediatype_test.go.html">mediatype_test.go</a></li>
<li><a href="/gostd/mime/type.go.html">type.go</a></li>
<li><a href="/gostd/mime/type_test.go.html">type_test.go</a></li>
<li><a href="/gostd/mime/type_unix.go.html">type_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4252568">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4252623">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4252677">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4252728">package</span>&nbsp;<span class="ident" id="4252736">mime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4252742">import</span>&nbsp;<span class="op" id="4252749">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4252752">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4252761">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4252771">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4252778">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4252786">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4252797">&#34;unicode&#34;</span><br>
<span class="lineno"></span><span class="op" id="4252807">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="4252810">//&nbsp;FormatMediaType&nbsp;serializes&nbsp;mediatype&nbsp;t&nbsp;and&nbsp;the&nbsp;parameters</span><br>
<span class="lineno"></span><span class="comment" id="4252871">//&nbsp;param&nbsp;as&nbsp;a&nbsp;media&nbsp;type&nbsp;conforming&nbsp;to&nbsp;RFC&nbsp;2045&nbsp;and&nbsp;RFC&nbsp;2616.</span><br>
<span class="lineno"></span><span class="comment" id="4252933">//&nbsp;The&nbsp;type&nbsp;and&nbsp;parameter&nbsp;names&nbsp;are&nbsp;written&nbsp;in&nbsp;lower-case.</span><br>
<span class="lineno"></span><span class="comment" id="4252992">//&nbsp;When&nbsp;any&nbsp;of&nbsp;the&nbsp;arguments&nbsp;result&nbsp;in&nbsp;a&nbsp;standard&nbsp;violation&nbsp;then</span><br>
<span class="lineno">20</span><span class="comment" id="4253057">//&nbsp;FormatMediaType&nbsp;returns&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="4253102">func</span>&nbsp;<span class="ident" id="4253107">FormatMediaType</span><span class="op" id="4253122">(</span><span class="ident" id="4253123">t</span>&nbsp;<span class="builtintype" id="4253125">string</span><span class="op" id="4253131">,</span>&nbsp;<span class="ident" id="4253133">param</span>&nbsp;<span class="keyword" id="4253139">map</span><span class="op" id="4253142">[</span><span class="builtintype" id="4253143">string</span><span class="op" id="4253149">]</span><span class="builtintype" id="4253150">string</span><span class="op" id="4253156">)</span>&nbsp;<span class="builtintype" id="4253158">string</span>&nbsp;<span class="op" id="4253165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4253168">slash</span>&nbsp;<span class="op" id="4253174">:=</span>&nbsp;<span class="ident" id="4253177">strings</span><span class="op" id="4253184">.</span><span class="ident" id="4253185">Index</span><span class="op" id="4253190">(</span><span class="ident" id="4253191">t</span><span class="op" id="4253192">,</span>&nbsp;<span class="string" id="4253194">&#34;/&#34;</span><span class="op" id="4253197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4253200">if</span>&nbsp;<span class="ident" id="4253203">slash</span>&nbsp;<span class="op" id="4253209">==</span>&nbsp;<span class="op" id="4253212">-</span><span class="num" id="4253213">1</span>&nbsp;<span class="op" id="4253215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4253219">return</span>&nbsp;<span class="string" id="4253226">&#34;&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4253230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4253233">major</span><span class="op" id="4253238">,</span>&nbsp;<span class="ident" id="4253240">sub</span>&nbsp;<span class="op" id="4253244">:=</span>&nbsp;<span class="ident" id="4253247">t</span><span class="op" id="4253248">[</span><span class="op" id="4253249">:</span><span class="ident" id="4253250">slash</span><span class="op" id="4253255">]</span><span class="op" id="4253256">,</span>&nbsp;<span class="ident" id="4253258">t</span><span class="op" id="4253259">[</span><span class="ident" id="4253260">slash</span><span class="op" id="4253265">+</span><span class="num" id="4253266">1</span><span class="op" id="4253267">:</span><span class="op" id="4253268">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4253271">if</span>&nbsp;<span class="op" id="4253274">!</span><span class="ident" id="4253275">isToken</span><span class="op" id="4253282">(</span><span class="ident" id="4253283">major</span><span class="op" id="4253288">)</span>&nbsp;<span class="op" id="4253290">||</span>&nbsp;<span class="op" id="4253293">!</span><span class="ident" id="4253294">isToken</span><span class="op" id="4253301">(</span><span class="ident" id="4253302">sub</span><span class="op" id="4253305">)</span>&nbsp;<span class="op" id="4253307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4253311">return</span>&nbsp;<span class="string" id="4253318">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4253322">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4253325">var</span>&nbsp;<span class="ident" id="4253329">b</span>&nbsp;<span class="ident" id="4253331">bytes</span><span class="op" id="4253336">.</span><span class="ident" id="4253337">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4253345">b</span><span class="op" id="4253346">.</span><span class="ident" id="4253347">WriteString</span><span class="op" id="4253358">(</span><span class="ident" id="4253359">strings</span><span class="op" id="4253366">.</span><span class="ident" id="4253367">ToLower</span><span class="op" id="4253374">(</span><span class="ident" id="4253375">major</span><span class="op" id="4253380">)</span><span class="op" id="4253381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4253384">b</span><span class="op" id="4253385">.</span><span class="ident" id="4253386">WriteByte</span><span class="op" id="4253395">(</span><span class="string" id="4253396">&#39;/&#39;</span><span class="op" id="4253399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4253402">b</span><span class="op" id="4253403">.</span><span class="ident" id="4253404">WriteString</span><span class="op" id="4253415">(</span><span class="ident" id="4253416">strings</span><span class="op" id="4253423">.</span><span class="ident" id="4253424">ToLower</span><span class="op" id="4253431">(</span><span class="ident" id="4253432">sub</span><span class="op" id="4253435">)</span><span class="op" id="4253436">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4253440">attrs</span>&nbsp;<span class="op" id="4253446">:=</span>&nbsp;<span class="builtinfunc" id="4253449">make</span><span class="op" id="4253453">(</span><span class="op" id="4253454">[</span><span class="op" id="4253455">]</span><span class="builtintype" id="4253456">string</span><span class="op" id="4253462">,</span>&nbsp;<span class="num" id="4253464">0</span><span class="op" id="4253465">,</span>&nbsp;<span class="builtinfunc" id="4253467">len</span><span class="op" id="4253470">(</span><span class="ident" id="4253471">param</span><span class="op" id="4253476">)</span><span class="op" id="4253477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4253480">for</span>&nbsp;<span class="ident" id="4253484">a</span>&nbsp;<span class="op" id="4253486">:=</span>&nbsp;<span class="keyword" id="4253489">range</span>&nbsp;<span class="ident" id="4253495">param</span>&nbsp;<span class="op" id="4253501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4253505">attrs</span>&nbsp;<span class="op" id="4253511">=</span>&nbsp;<span class="builtinfunc" id="4253513">append</span><span class="op" id="4253519">(</span><span class="ident" id="4253520">attrs</span><span class="op" id="4253525">,</span>&nbsp;<span class="ident" id="4253527">a</span><span class="op" id="4253528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4253531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4253534">sort</span><span class="op" id="4253538">.</span><span class="ident" id="4253539">Strings</span><span class="op" id="4253546">(</span><span class="ident" id="4253547">attrs</span><span class="op" id="4253552">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4253556">for</span>&nbsp;<span class="ident" id="4253560">_</span><span class="op" id="4253561">,</span>&nbsp;<span class="ident" id="4253563">attribute</span>&nbsp;<span class="op" id="4253573">:=</span>&nbsp;<span class="keyword" id="4253576">range</span>&nbsp;<span class="ident" id="4253582">attrs</span>&nbsp;<span class="op" id="4253588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4253592">value</span>&nbsp;<span class="op" id="4253598">:=</span>&nbsp;<span class="ident" id="4253601">param</span><span class="op" id="4253606">[</span><span class="ident" id="4253607">attribute</span><span class="op" id="4253616">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4253620">b</span><span class="op" id="4253621">.</span><span class="ident" id="4253622">WriteByte</span><span class="op" id="4253631">(</span><span class="string" id="4253632">&#39;;&#39;</span><span class="op" id="4253635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4253639">b</span><span class="op" id="4253640">.</span><span class="ident" id="4253641">WriteByte</span><span class="op" id="4253650">(</span><span class="string" id="4253651">&#39;&nbsp;&#39;</span><span class="op" id="4253654">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4253658">if</span>&nbsp;<span class="op" id="4253661">!</span><span class="ident" id="4253662">isToken</span><span class="op" id="4253669">(</span><span class="ident" id="4253670">attribute</span><span class="op" id="4253679">)</span>&nbsp;<span class="op" id="4253681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4253686">return</span>&nbsp;<span class="string" id="4253693">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4253698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4253702">b</span><span class="op" id="4253703">.</span><span class="ident" id="4253704">WriteString</span><span class="op" id="4253715">(</span><span class="ident" id="4253716">strings</span><span class="op" id="4253723">.</span><span class="ident" id="4253724">ToLower</span><span class="op" id="4253731">(</span><span class="ident" id="4253732">attribute</span><span class="op" id="4253741">)</span><span class="op" id="4253742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4253746">b</span><span class="op" id="4253747">.</span><span class="ident" id="4253748">WriteByte</span><span class="op" id="4253757">(</span><span class="string" id="4253758">&#39;=&#39;</span><span class="op" id="4253761">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4253765">if</span>&nbsp;<span class="ident" id="4253768">isToken</span><span class="op" id="4253775">(</span><span class="ident" id="4253776">value</span><span class="op" id="4253781">)</span>&nbsp;<span class="op" id="4253783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4253788">b</span><span class="op" id="4253789">.</span><span class="ident" id="4253790">WriteString</span><span class="op" id="4253801">(</span><span class="ident" id="4253802">value</span><span class="op" id="4253807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4253812">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4253823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4253828">b</span><span class="op" id="4253829">.</span><span class="ident" id="4253830">WriteByte</span><span class="op" id="4253839">(</span><span class="string" id="4253840">&#39;&#34;&#39;</span><span class="op" id="4253843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4253847">offset</span>&nbsp;<span class="op" id="4253854">:=</span>&nbsp;<span class="num" id="4253857">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4253861">for</span>&nbsp;<span class="ident" id="4253865">index</span><span class="op" id="4253870">,</span>&nbsp;<span class="ident" id="4253872">character</span>&nbsp;<span class="op" id="4253882">:=</span>&nbsp;<span class="keyword" id="4253885">range</span>&nbsp;<span class="ident" id="4253891">value</span>&nbsp;<span class="op" id="4253897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4253902">if</span>&nbsp;<span class="ident" id="4253905">character</span>&nbsp;<span class="op" id="4253915">==</span>&nbsp;<span class="string" id="4253918">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="4253922">||</span>&nbsp;<span class="ident" id="4253925">character</span>&nbsp;<span class="op" id="4253935">==</span>&nbsp;<span class="string" id="4253938">&#39;\\&#39;</span>&nbsp;<span class="op" id="4253943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4253949">b</span><span class="op" id="4253950">.</span><span class="ident" id="4253951">WriteString</span><span class="op" id="4253962">(</span><span class="ident" id="4253963">value</span><span class="op" id="4253968">[</span><span class="ident" id="4253969">offset</span><span class="op" id="4253975">:</span><span class="ident" id="4253976">index</span><span class="op" id="4253981">]</span><span class="op" id="4253982">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4253988">offset</span>&nbsp;<span class="op" id="4253995">=</span>&nbsp;<span class="ident" id="4253997">index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4254007">b</span><span class="op" id="4254008">.</span><span class="ident" id="4254009">WriteByte</span><span class="op" id="4254018">(</span><span class="string" id="4254019">&#39;\\&#39;</span><span class="op" id="4254023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4254028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4254033">if</span>&nbsp;<span class="ident" id="4254036">character</span><span class="op" id="4254045">&amp;</span><span class="num" id="4254046">0x80</span>&nbsp;<span class="op" id="4254051">!=</span>&nbsp;<span class="num" id="4254054">0</span>&nbsp;<span class="op" id="4254056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4254062">return</span>&nbsp;<span class="string" id="4254069">&#34;&#34;</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4254075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4254079">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4254083">b</span><span class="op" id="4254084">.</span><span class="ident" id="4254085">WriteString</span><span class="op" id="4254096">(</span><span class="ident" id="4254097">value</span><span class="op" id="4254102">[</span><span class="ident" id="4254103">offset</span><span class="op" id="4254109">:</span><span class="op" id="4254110">]</span><span class="op" id="4254111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4254115">b</span><span class="op" id="4254116">.</span><span class="ident" id="4254117">WriteByte</span><span class="op" id="4254126">(</span><span class="string" id="4254127">&#39;&#34;&#39;</span><span class="op" id="4254130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4254133">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4254136">return</span>&nbsp;<span class="ident" id="4254143">b</span><span class="op" id="4254144">.</span><span class="ident" id="4254145">String</span><span class="op" id="4254151">(</span><span class="op" id="4254152">)</span><br>
<span class="lineno"></span><span class="op" id="4254154">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4254157">func</span>&nbsp;<span class="ident" id="4254162">checkMediaTypeDisposition</span><span class="op" id="4254187">(</span><span class="ident" id="4254188">s</span>&nbsp;<span class="builtintype" id="4254190">string</span><span class="op" id="4254196">)</span>&nbsp;<span class="builtintype" id="4254198">error</span>&nbsp;<span class="op" id="4254204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4254207">typ</span><span class="op" id="4254210">,</span>&nbsp;<span class="ident" id="4254212">rest</span>&nbsp;<span class="op" id="4254217">:=</span>&nbsp;<span class="ident" id="4254220">consumeToken</span><span class="op" id="4254232">(</span><span class="ident" id="4254233">s</span><span class="op" id="4254234">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4254237">if</span>&nbsp;<span class="ident" id="4254240">typ</span>&nbsp;<span class="op" id="4254244">==</span>&nbsp;<span class="string" id="4254247">&#34;&#34;</span>&nbsp;<span class="op" id="4254250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4254254">return</span>&nbsp;<span class="ident" id="4254261">errors</span><span class="op" id="4254267">.</span><span class="ident" id="4254268">New</span><span class="op" id="4254271">(</span><span class="string" id="4254272">&#34;mime:&nbsp;no&nbsp;media&nbsp;type&#34;</span><span class="op" id="4254293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4254296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4254299">if</span>&nbsp;<span class="ident" id="4254302">rest</span>&nbsp;<span class="op" id="4254307">==</span>&nbsp;<span class="string" id="4254310">&#34;&#34;</span>&nbsp;<span class="op" id="4254313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4254317">return</span>&nbsp;<span class="ident" id="4254324">nil</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4254329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4254332">if</span>&nbsp;<span class="op" id="4254335">!</span><span class="ident" id="4254336">strings</span><span class="op" id="4254343">.</span><span class="ident" id="4254344">HasPrefix</span><span class="op" id="4254353">(</span><span class="ident" id="4254354">rest</span><span class="op" id="4254358">,</span>&nbsp;<span class="string" id="4254360">&#34;/&#34;</span><span class="op" id="4254363">)</span>&nbsp;<span class="op" id="4254365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4254369">return</span>&nbsp;<span class="ident" id="4254376">errors</span><span class="op" id="4254382">.</span><span class="ident" id="4254383">New</span><span class="op" id="4254386">(</span><span class="string" id="4254387">&#34;mime:&nbsp;expected&nbsp;slash&nbsp;after&nbsp;first&nbsp;token&#34;</span><span class="op" id="4254427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4254430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4254433">subtype</span><span class="op" id="4254440">,</span>&nbsp;<span class="ident" id="4254442">rest</span>&nbsp;<span class="op" id="4254447">:=</span>&nbsp;<span class="ident" id="4254450">consumeToken</span><span class="op" id="4254462">(</span><span class="ident" id="4254463">rest</span><span class="op" id="4254467">[</span><span class="num" id="4254468">1</span><span class="op" id="4254469">:</span><span class="op" id="4254470">]</span><span class="op" id="4254471">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4254474">if</span>&nbsp;<span class="ident" id="4254477">subtype</span>&nbsp;<span class="op" id="4254485">==</span>&nbsp;<span class="string" id="4254488">&#34;&#34;</span>&nbsp;<span class="op" id="4254491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4254495">return</span>&nbsp;<span class="ident" id="4254502">errors</span><span class="op" id="4254508">.</span><span class="ident" id="4254509">New</span><span class="op" id="4254512">(</span><span class="string" id="4254513">&#34;mime:&nbsp;expected&nbsp;token&nbsp;after&nbsp;slash&#34;</span><span class="op" id="4254547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4254550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4254553">if</span>&nbsp;<span class="ident" id="4254556">rest</span>&nbsp;<span class="op" id="4254561">!=</span>&nbsp;<span class="string" id="4254564">&#34;&#34;</span>&nbsp;<span class="op" id="4254567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4254571">return</span>&nbsp;<span class="ident" id="4254578">errors</span><span class="op" id="4254584">.</span><span class="ident" id="4254585">New</span><span class="op" id="4254588">(</span><span class="string" id="4254589">&#34;mime:&nbsp;unexpected&nbsp;content&nbsp;after&nbsp;media&nbsp;subtype&#34;</span><span class="op" id="4254635">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4254638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4254641">return</span>&nbsp;<span class="ident" id="4254648">nil</span><br>
<span class="lineno"></span><span class="op" id="4254652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4254655">//&nbsp;ParseMediaType&nbsp;parses&nbsp;a&nbsp;media&nbsp;type&nbsp;value&nbsp;and&nbsp;any&nbsp;optional</span><br>
<span class="lineno">95</span><span class="comment" id="4254716">//&nbsp;parameters,&nbsp;per&nbsp;RFC&nbsp;1521.&nbsp;&nbsp;Media&nbsp;types&nbsp;are&nbsp;the&nbsp;values&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4254776">//&nbsp;Content-Type&nbsp;and&nbsp;Content-Disposition&nbsp;headers&nbsp;(RFC&nbsp;2183).</span><br>
<span class="lineno"></span><span class="comment" id="4254836">//&nbsp;On&nbsp;success,&nbsp;ParseMediaType&nbsp;returns&nbsp;the&nbsp;media&nbsp;type&nbsp;converted</span><br>
<span class="lineno"></span><span class="comment" id="4254899">//&nbsp;to&nbsp;lowercase&nbsp;and&nbsp;trimmed&nbsp;of&nbsp;white&nbsp;space&nbsp;and&nbsp;a&nbsp;non-nil&nbsp;map.</span><br>
<span class="lineno"></span><span class="comment" id="4254961">//&nbsp;The&nbsp;returned&nbsp;map,&nbsp;params,&nbsp;maps&nbsp;from&nbsp;the&nbsp;lowercase</span><br>
<span class="lineno">100</span><span class="comment" id="4255014">//&nbsp;attribute&nbsp;to&nbsp;the&nbsp;attribute&nbsp;value&nbsp;with&nbsp;its&nbsp;case&nbsp;preserved.</span><br>
<span class="lineno"></span><span class="keyword" id="4255075">func</span>&nbsp;<span class="ident" id="4255080">ParseMediaType</span><span class="op" id="4255094">(</span><span class="ident" id="4255095">v</span>&nbsp;<span class="builtintype" id="4255097">string</span><span class="op" id="4255103">)</span>&nbsp;<span class="op" id="4255105">(</span><span class="ident" id="4255106">mediatype</span>&nbsp;<span class="builtintype" id="4255116">string</span><span class="op" id="4255122">,</span>&nbsp;<span class="ident" id="4255124">params</span>&nbsp;<span class="keyword" id="4255131">map</span><span class="op" id="4255134">[</span><span class="builtintype" id="4255135">string</span><span class="op" id="4255141">]</span><span class="builtintype" id="4255142">string</span><span class="op" id="4255148">,</span>&nbsp;<span class="ident" id="4255150">err</span>&nbsp;<span class="builtintype" id="4255154">error</span><span class="op" id="4255159">)</span>&nbsp;<span class="op" id="4255161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4255164">i</span>&nbsp;<span class="op" id="4255166">:=</span>&nbsp;<span class="ident" id="4255169">strings</span><span class="op" id="4255176">.</span><span class="ident" id="4255177">Index</span><span class="op" id="4255182">(</span><span class="ident" id="4255183">v</span><span class="op" id="4255184">,</span>&nbsp;<span class="string" id="4255186">&#34;;&#34;</span><span class="op" id="4255189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4255192">if</span>&nbsp;<span class="ident" id="4255195">i</span>&nbsp;<span class="op" id="4255197">==</span>&nbsp;<span class="op" id="4255200">-</span><span class="num" id="4255201">1</span>&nbsp;<span class="op" id="4255203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4255207">i</span>&nbsp;<span class="op" id="4255209">=</span>&nbsp;<span class="builtinfunc" id="4255211">len</span><span class="op" id="4255214">(</span><span class="ident" id="4255215">v</span><span class="op" id="4255216">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4255219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4255222">mediatype</span>&nbsp;<span class="op" id="4255232">=</span>&nbsp;<span class="ident" id="4255234">strings</span><span class="op" id="4255241">.</span><span class="ident" id="4255242">TrimSpace</span><span class="op" id="4255251">(</span><span class="ident" id="4255252">strings</span><span class="op" id="4255259">.</span><span class="ident" id="4255260">ToLower</span><span class="op" id="4255267">(</span><span class="ident" id="4255268">v</span><span class="op" id="4255269">[</span><span class="num" id="4255270">0</span><span class="op" id="4255271">:</span><span class="ident" id="4255272">i</span><span class="op" id="4255273">]</span><span class="op" id="4255274">)</span><span class="op" id="4255275">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4255279">err</span>&nbsp;<span class="op" id="4255283">=</span>&nbsp;<span class="ident" id="4255285">checkMediaTypeDisposition</span><span class="op" id="4255310">(</span><span class="ident" id="4255311">mediatype</span><span class="op" id="4255320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4255323">if</span>&nbsp;<span class="ident" id="4255326">err</span>&nbsp;<span class="op" id="4255330">!=</span>&nbsp;<span class="ident" id="4255333">nil</span>&nbsp;<span class="op" id="4255337">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4255341">return</span>&nbsp;<span class="string" id="4255348">&#34;&#34;</span><span class="op" id="4255350">,</span>&nbsp;<span class="ident" id="4255352">nil</span><span class="op" id="4255355">,</span>&nbsp;<span class="ident" id="4255357">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4255362">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4255366">params</span>&nbsp;<span class="op" id="4255373">=</span>&nbsp;<span class="builtinfunc" id="4255375">make</span><span class="op" id="4255379">(</span><span class="keyword" id="4255380">map</span><span class="op" id="4255383">[</span><span class="builtintype" id="4255384">string</span><span class="op" id="4255390">]</span><span class="builtintype" id="4255391">string</span><span class="op" id="4255397">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4255401">//&nbsp;Map&nbsp;of&nbsp;base&nbsp;parameter&nbsp;name&nbsp;-&gt;&nbsp;parameter&nbsp;name&nbsp;-&gt;&nbsp;value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4255459">//&nbsp;for&nbsp;parameters&nbsp;containing&nbsp;a&nbsp;&#39;*&#39;&nbsp;character.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4255506">//&nbsp;Lazily&nbsp;initialized.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4255530">var</span>&nbsp;<span class="ident" id="4255534">continuation</span>&nbsp;<span class="keyword" id="4255547">map</span><span class="op" id="4255550">[</span><span class="builtintype" id="4255551">string</span><span class="op" id="4255557">]</span><span class="keyword" id="4255558">map</span><span class="op" id="4255561">[</span><span class="builtintype" id="4255562">string</span><span class="op" id="4255568">]</span><span class="builtintype" id="4255569">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4255578">v</span>&nbsp;<span class="op" id="4255580">=</span>&nbsp;<span class="ident" id="4255582">v</span><span class="op" id="4255583">[</span><span class="ident" id="4255584">i</span><span class="op" id="4255585">:</span><span class="op" id="4255586">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4255589">for</span>&nbsp;<span class="builtinfunc" id="4255593">len</span><span class="op" id="4255596">(</span><span class="ident" id="4255597">v</span><span class="op" id="4255598">)</span>&nbsp;<span class="op" id="4255600">&gt;</span>&nbsp;<span class="num" id="4255602">0</span>&nbsp;<span class="op" id="4255604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4255608">v</span>&nbsp;<span class="op" id="4255610">=</span>&nbsp;<span class="ident" id="4255612">strings</span><span class="op" id="4255619">.</span><span class="ident" id="4255620">TrimLeftFunc</span><span class="op" id="4255632">(</span><span class="ident" id="4255633">v</span><span class="op" id="4255634">,</span>&nbsp;<span class="ident" id="4255636">unicode</span><span class="op" id="4255643">.</span><span class="ident" id="4255644">IsSpace</span><span class="op" id="4255651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4255655">if</span>&nbsp;<span class="builtinfunc" id="4255658">len</span><span class="op" id="4255661">(</span><span class="ident" id="4255662">v</span><span class="op" id="4255663">)</span>&nbsp;<span class="op" id="4255665">==</span>&nbsp;<span class="num" id="4255668">0</span>&nbsp;<span class="op" id="4255670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4255675">break</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4255683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4255687">key</span><span class="op" id="4255690">,</span>&nbsp;<span class="ident" id="4255692">value</span><span class="op" id="4255697">,</span>&nbsp;<span class="ident" id="4255699">rest</span>&nbsp;<span class="op" id="4255704">:=</span>&nbsp;<span class="ident" id="4255707">consumeMediaParam</span><span class="op" id="4255724">(</span><span class="ident" id="4255725">v</span><span class="op" id="4255726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4255730">if</span>&nbsp;<span class="ident" id="4255733">key</span>&nbsp;<span class="op" id="4255737">==</span>&nbsp;<span class="string" id="4255740">&#34;&#34;</span>&nbsp;<span class="op" id="4255743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4255748">if</span>&nbsp;<span class="ident" id="4255751">strings</span><span class="op" id="4255758">.</span><span class="ident" id="4255759">TrimSpace</span><span class="op" id="4255768">(</span><span class="ident" id="4255769">rest</span><span class="op" id="4255773">)</span>&nbsp;<span class="op" id="4255775">==</span>&nbsp;<span class="string" id="4255778">&#34;;&#34;</span>&nbsp;<span class="op" id="4255782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4255788">//&nbsp;Ignore&nbsp;trailing&nbsp;semicolons.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4255823">//&nbsp;Not&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4255844">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4255854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4255859">//&nbsp;Parse&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4255878">return</span>&nbsp;<span class="string" id="4255885">&#34;&#34;</span><span class="op" id="4255887">,</span>&nbsp;<span class="ident" id="4255889">nil</span><span class="op" id="4255892">,</span>&nbsp;<span class="ident" id="4255894">errors</span><span class="op" id="4255900">.</span><span class="ident" id="4255901">New</span><span class="op" id="4255904">(</span><span class="string" id="4255905">&#34;mime:&nbsp;invalid&nbsp;media&nbsp;parameter&#34;</span><span class="op" id="4255936">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4255940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4255945">pmap</span>&nbsp;<span class="op" id="4255950">:=</span>&nbsp;<span class="ident" id="4255953">params</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4255962">if</span>&nbsp;<span class="ident" id="4255965">idx</span>&nbsp;<span class="op" id="4255969">:=</span>&nbsp;<span class="ident" id="4255972">strings</span><span class="op" id="4255979">.</span><span class="ident" id="4255980">Index</span><span class="op" id="4255985">(</span><span class="ident" id="4255986">key</span><span class="op" id="4255989">,</span>&nbsp;<span class="string" id="4255991">&#34;*&#34;</span><span class="op" id="4255994">)</span><span class="op" id="4255995">;</span>&nbsp;<span class="ident" id="4255997">idx</span>&nbsp;<span class="op" id="4256001">!=</span>&nbsp;<span class="op" id="4256004">-</span><span class="num" id="4256005">1</span>&nbsp;<span class="op" id="4256007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4256012">baseName</span>&nbsp;<span class="op" id="4256021">:=</span>&nbsp;<span class="ident" id="4256024">key</span><span class="op" id="4256027">[</span><span class="op" id="4256028">:</span><span class="ident" id="4256029">idx</span><span class="op" id="4256032">]</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4256037">if</span>&nbsp;<span class="ident" id="4256040">continuation</span>&nbsp;<span class="op" id="4256053">==</span>&nbsp;<span class="ident" id="4256056">nil</span>&nbsp;<span class="op" id="4256060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4256066">continuation</span>&nbsp;<span class="op" id="4256079">=</span>&nbsp;<span class="builtinfunc" id="4256081">make</span><span class="op" id="4256085">(</span><span class="keyword" id="4256086">map</span><span class="op" id="4256089">[</span><span class="builtintype" id="4256090">string</span><span class="op" id="4256096">]</span><span class="keyword" id="4256097">map</span><span class="op" id="4256100">[</span><span class="builtintype" id="4256101">string</span><span class="op" id="4256107">]</span><span class="builtintype" id="4256108">string</span><span class="op" id="4256114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4256119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4256124">var</span>&nbsp;<span class="ident" id="4256128">ok</span>&nbsp;<span class="builtintype" id="4256131">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4256139">if</span>&nbsp;<span class="ident" id="4256142">pmap</span><span class="op" id="4256146">,</span>&nbsp;<span class="ident" id="4256148">ok</span>&nbsp;<span class="op" id="4256151">=</span>&nbsp;<span class="ident" id="4256153">continuation</span><span class="op" id="4256165">[</span><span class="ident" id="4256166">baseName</span><span class="op" id="4256174">]</span><span class="op" id="4256175">;</span>&nbsp;<span class="op" id="4256177">!</span><span class="ident" id="4256178">ok</span>&nbsp;<span class="op" id="4256181">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4256187">continuation</span><span class="op" id="4256199">[</span><span class="ident" id="4256200">baseName</span><span class="op" id="4256208">]</span>&nbsp;<span class="op" id="4256210">=</span>&nbsp;<span class="builtinfunc" id="4256212">make</span><span class="op" id="4256216">(</span><span class="keyword" id="4256217">map</span><span class="op" id="4256220">[</span><span class="builtintype" id="4256221">string</span><span class="op" id="4256227">]</span><span class="builtintype" id="4256228">string</span><span class="op" id="4256234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4256240">pmap</span>&nbsp;<span class="op" id="4256245">=</span>&nbsp;<span class="ident" id="4256247">continuation</span><span class="op" id="4256259">[</span><span class="ident" id="4256260">baseName</span><span class="op" id="4256268">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4256273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4256277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4256281">if</span>&nbsp;<span class="ident" id="4256284">_</span><span class="op" id="4256285">,</span>&nbsp;<span class="ident" id="4256287">exists</span>&nbsp;<span class="op" id="4256294">:=</span>&nbsp;<span class="ident" id="4256297">pmap</span><span class="op" id="4256301">[</span><span class="ident" id="4256302">key</span><span class="op" id="4256305">]</span><span class="op" id="4256306">;</span>&nbsp;<span class="ident" id="4256308">exists</span>&nbsp;<span class="op" id="4256315">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4256320">//&nbsp;Duplicate&nbsp;parameter&nbsp;name&nbsp;is&nbsp;bogus.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4256361">return</span>&nbsp;<span class="string" id="4256368">&#34;&#34;</span><span class="op" id="4256370">,</span>&nbsp;<span class="ident" id="4256372">nil</span><span class="op" id="4256375">,</span>&nbsp;<span class="ident" id="4256377">errors</span><span class="op" id="4256383">.</span><span class="ident" id="4256384">New</span><span class="op" id="4256387">(</span><span class="string" id="4256388">&#34;mime:&nbsp;duplicate&nbsp;parameter&nbsp;name&#34;</span><span class="op" id="4256420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4256424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4256428">pmap</span><span class="op" id="4256432">[</span><span class="ident" id="4256433">key</span><span class="op" id="4256436">]</span>&nbsp;<span class="op" id="4256438">=</span>&nbsp;<span class="ident" id="4256440">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4256448">v</span>&nbsp;<span class="op" id="4256450">=</span>&nbsp;<span class="ident" id="4256452">rest</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4256458">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4256462">//&nbsp;Stitch&nbsp;together&nbsp;any&nbsp;continuations&nbsp;or&nbsp;things&nbsp;with&nbsp;stars</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4256521">//&nbsp;(i.e.&nbsp;RFC&nbsp;2231&nbsp;things&nbsp;with&nbsp;stars:&nbsp;&#34;foo*0&#34;&nbsp;or&nbsp;&#34;foo*&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4256578">var</span>&nbsp;<span class="ident" id="4256582">buf</span>&nbsp;<span class="ident" id="4256586">bytes</span><span class="op" id="4256591">.</span><span class="ident" id="4256592">Buffer</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4256600">for</span>&nbsp;<span class="ident" id="4256604">key</span><span class="op" id="4256607">,</span>&nbsp;<span class="ident" id="4256609">pieceMap</span>&nbsp;<span class="op" id="4256618">:=</span>&nbsp;<span class="keyword" id="4256621">range</span>&nbsp;<span class="ident" id="4256627">continuation</span>&nbsp;<span class="op" id="4256640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4256644">singlePartKey</span>&nbsp;<span class="op" id="4256658">:=</span>&nbsp;<span class="ident" id="4256661">key</span>&nbsp;<span class="op" id="4256665">+</span>&nbsp;<span class="string" id="4256667">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4256673">if</span>&nbsp;<span class="ident" id="4256676">v</span><span class="op" id="4256677">,</span>&nbsp;<span class="ident" id="4256679">ok</span>&nbsp;<span class="op" id="4256682">:=</span>&nbsp;<span class="ident" id="4256685">pieceMap</span><span class="op" id="4256693">[</span><span class="ident" id="4256694">singlePartKey</span><span class="op" id="4256707">]</span><span class="op" id="4256708">;</span>&nbsp;<span class="ident" id="4256710">ok</span>&nbsp;<span class="op" id="4256713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4256718">decv</span>&nbsp;<span class="op" id="4256723">:=</span>&nbsp;<span class="ident" id="4256726">decode2231Enc</span><span class="op" id="4256739">(</span><span class="ident" id="4256740">v</span><span class="op" id="4256741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4256746">params</span><span class="op" id="4256752">[</span><span class="ident" id="4256753">key</span><span class="op" id="4256756">]</span>&nbsp;<span class="op" id="4256758">=</span>&nbsp;<span class="ident" id="4256760">decv</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4256768">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4256779">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4256784">buf</span><span class="op" id="4256787">.</span><span class="ident" id="4256788">Reset</span><span class="op" id="4256793">(</span><span class="op" id="4256794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4256798">valid</span>&nbsp;<span class="op" id="4256804">:=</span>&nbsp;<span class="builtintype" id="4256807">false</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4256815">for</span>&nbsp;<span class="ident" id="4256819">n</span>&nbsp;<span class="op" id="4256821">:=</span>&nbsp;<span class="num" id="4256824">0</span><span class="op" id="4256825">;</span>&nbsp;<span class="op" id="4256827">;</span>&nbsp;<span class="ident" id="4256829">n</span><span class="op" id="4256830">++</span>&nbsp;<span class="op" id="4256833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4256838">simplePart</span>&nbsp;<span class="op" id="4256849">:=</span>&nbsp;<span class="ident" id="4256852">fmt</span><span class="op" id="4256855">.</span><span class="ident" id="4256856">Sprintf</span><span class="op" id="4256863">(</span><span class="string" id="4256864">&#34;%s*%d&#34;</span><span class="op" id="4256871">,</span>&nbsp;<span class="ident" id="4256873">key</span><span class="op" id="4256876">,</span>&nbsp;<span class="ident" id="4256878">n</span><span class="op" id="4256879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4256884">if</span>&nbsp;<span class="ident" id="4256887">v</span><span class="op" id="4256888">,</span>&nbsp;<span class="ident" id="4256890">ok</span>&nbsp;<span class="op" id="4256893">:=</span>&nbsp;<span class="ident" id="4256896">pieceMap</span><span class="op" id="4256904">[</span><span class="ident" id="4256905">simplePart</span><span class="op" id="4256915">]</span><span class="op" id="4256916">;</span>&nbsp;<span class="ident" id="4256918">ok</span>&nbsp;<span class="op" id="4256921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4256927">valid</span>&nbsp;<span class="op" id="4256933">=</span>&nbsp;<span class="builtintype" id="4256935">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4256944">buf</span><span class="op" id="4256947">.</span><span class="ident" id="4256948">WriteString</span><span class="op" id="4256959">(</span><span class="ident" id="4256960">v</span><span class="op" id="4256961">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4256967">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4256979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4256984">encodedPart</span>&nbsp;<span class="op" id="4256996">:=</span>&nbsp;<span class="ident" id="4256999">simplePart</span>&nbsp;<span class="op" id="4257010">+</span>&nbsp;<span class="string" id="4257012">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4257019">if</span>&nbsp;<span class="ident" id="4257022">v</span><span class="op" id="4257023">,</span>&nbsp;<span class="ident" id="4257025">ok</span>&nbsp;<span class="op" id="4257028">:=</span>&nbsp;<span class="ident" id="4257031">pieceMap</span><span class="op" id="4257039">[</span><span class="ident" id="4257040">encodedPart</span><span class="op" id="4257051">]</span><span class="op" id="4257052">;</span>&nbsp;<span class="ident" id="4257054">ok</span>&nbsp;<span class="op" id="4257057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4257063">valid</span>&nbsp;<span class="op" id="4257069">=</span>&nbsp;<span class="builtintype" id="4257071">true</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4257080">if</span>&nbsp;<span class="ident" id="4257083">n</span>&nbsp;<span class="op" id="4257085">==</span>&nbsp;<span class="num" id="4257088">0</span>&nbsp;<span class="op" id="4257090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4257097">buf</span><span class="op" id="4257100">.</span><span class="ident" id="4257101">WriteString</span><span class="op" id="4257112">(</span><span class="ident" id="4257113">decode2231Enc</span><span class="op" id="4257126">(</span><span class="ident" id="4257127">v</span><span class="op" id="4257128">)</span><span class="op" id="4257129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4257135">}</span>&nbsp;<span class="keyword" id="4257137">else</span>&nbsp;<span class="op" id="4257142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4257149">decv</span><span class="op" id="4257153">,</span>&nbsp;<span class="ident" id="4257155">_</span>&nbsp;<span class="op" id="4257157">:=</span>&nbsp;<span class="ident" id="4257160">percentHexUnescape</span><span class="op" id="4257178">(</span><span class="ident" id="4257179">v</span><span class="op" id="4257180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4257187">buf</span><span class="op" id="4257190">.</span><span class="ident" id="4257191">WriteString</span><span class="op" id="4257202">(</span><span class="ident" id="4257203">decv</span><span class="op" id="4257207">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4257213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4257218">}</span>&nbsp;<span class="keyword" id="4257220">else</span>&nbsp;<span class="op" id="4257225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4257231">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4257240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4257244">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4257248">if</span>&nbsp;<span class="ident" id="4257251">valid</span>&nbsp;<span class="op" id="4257257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4257262">params</span><span class="op" id="4257268">[</span><span class="ident" id="4257269">key</span><span class="op" id="4257272">]</span>&nbsp;<span class="op" id="4257274">=</span>&nbsp;<span class="ident" id="4257276">buf</span><span class="op" id="4257279">.</span><span class="ident" id="4257280">String</span><span class="op" id="4257286">(</span><span class="op" id="4257287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4257291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4257294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4257298">return</span><br>
<span class="lineno"></span><span class="op" id="4257305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4257308">func</span>&nbsp;<span class="ident" id="4257313">decode2231Enc</span><span class="op" id="4257326">(</span><span class="ident" id="4257327">v</span>&nbsp;<span class="builtintype" id="4257329">string</span><span class="op" id="4257335">)</span>&nbsp;<span class="builtintype" id="4257337">string</span>&nbsp;<span class="op" id="4257344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4257347">sv</span>&nbsp;<span class="op" id="4257350">:=</span>&nbsp;<span class="ident" id="4257353">strings</span><span class="op" id="4257360">.</span><span class="ident" id="4257361">SplitN</span><span class="op" id="4257367">(</span><span class="ident" id="4257368">v</span><span class="op" id="4257369">,</span>&nbsp;<span class="string" id="4257371">&#34;&#39;&#34;</span><span class="op" id="4257374">,</span>&nbsp;<span class="num" id="4257376">3</span><span class="op" id="4257377">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4257380">if</span>&nbsp;<span class="builtinfunc" id="4257383">len</span><span class="op" id="4257386">(</span><span class="ident" id="4257387">sv</span><span class="op" id="4257389">)</span>&nbsp;<span class="op" id="4257391">!=</span>&nbsp;<span class="num" id="4257394">3</span>&nbsp;<span class="op" id="4257396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4257400">return</span>&nbsp;<span class="string" id="4257407">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4257411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4257414">//&nbsp;TODO:&nbsp;ignoring&nbsp;lang&nbsp;in&nbsp;sv[1]&nbsp;for&nbsp;now.&nbsp;If&nbsp;anybody&nbsp;needs&nbsp;it&nbsp;we&#39;ll</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4257482">//&nbsp;need&nbsp;to&nbsp;decide&nbsp;how&nbsp;to&nbsp;expose&nbsp;it&nbsp;in&nbsp;the&nbsp;API.&nbsp;But&nbsp;I&#39;m&nbsp;not&nbsp;sure</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4257547">//&nbsp;anybody&nbsp;uses&nbsp;it&nbsp;in&nbsp;practice.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4257580">charset</span>&nbsp;<span class="op" id="4257588">:=</span>&nbsp;<span class="ident" id="4257591">strings</span><span class="op" id="4257598">.</span><span class="ident" id="4257599">ToLower</span><span class="op" id="4257606">(</span><span class="ident" id="4257607">sv</span><span class="op" id="4257609">[</span><span class="num" id="4257610">0</span><span class="op" id="4257611">]</span><span class="op" id="4257612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4257615">if</span>&nbsp;<span class="ident" id="4257618">charset</span>&nbsp;<span class="op" id="4257626">!=</span>&nbsp;<span class="string" id="4257629">&#34;us-ascii&#34;</span>&nbsp;<span class="op" id="4257640">&amp;&amp;</span>&nbsp;<span class="ident" id="4257643">charset</span>&nbsp;<span class="op" id="4257651">!=</span>&nbsp;<span class="string" id="4257654">&#34;utf-8&#34;</span>&nbsp;<span class="op" id="4257662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4257666">//&nbsp;TODO:&nbsp;unsupported&nbsp;encoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4257698">return</span>&nbsp;<span class="string" id="4257705">&#34;&#34;</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4257709">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4257712">encv</span><span class="op" id="4257716">,</span>&nbsp;<span class="ident" id="4257718">_</span>&nbsp;<span class="op" id="4257720">:=</span>&nbsp;<span class="ident" id="4257723">percentHexUnescape</span><span class="op" id="4257741">(</span><span class="ident" id="4257742">sv</span><span class="op" id="4257744">[</span><span class="num" id="4257745">2</span><span class="op" id="4257746">]</span><span class="op" id="4257747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4257750">return</span>&nbsp;<span class="ident" id="4257757">encv</span><br>
<span class="lineno"></span><span class="op" id="4257762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="4257765">func</span>&nbsp;<span class="ident" id="4257770">isNotTokenChar</span><span class="op" id="4257784">(</span><span class="ident" id="4257785">r</span>&nbsp;<span class="builtintype" id="4257787">rune</span><span class="op" id="4257791">)</span>&nbsp;<span class="builtintype" id="4257793">bool</span>&nbsp;<span class="op" id="4257798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4257801">return</span>&nbsp;<span class="op" id="4257808">!</span><span class="ident" id="4257809">isTokenChar</span><span class="op" id="4257820">(</span><span class="ident" id="4257821">r</span><span class="op" id="4257822">)</span><br>
<span class="lineno"></span><span class="op" id="4257824">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4257827">//&nbsp;consumeToken&nbsp;consumes&nbsp;a&nbsp;token&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;provided</span><br>
<span class="lineno">220</span><span class="comment" id="4257891">//&nbsp;string,&nbsp;per&nbsp;RFC&nbsp;2045&nbsp;section&nbsp;5.1&nbsp;(referenced&nbsp;from&nbsp;2183),&nbsp;and&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="4257962">//&nbsp;the&nbsp;token&nbsp;consumed&nbsp;and&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;string.&nbsp;&nbsp;Returns&nbsp;(&#34;&#34;,&nbsp;v)&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="4258032">//&nbsp;failure&nbsp;to&nbsp;consume&nbsp;at&nbsp;least&nbsp;one&nbsp;character.</span><br>
<span class="lineno"></span><span class="keyword" id="4258078">func</span>&nbsp;<span class="ident" id="4258083">consumeToken</span><span class="op" id="4258095">(</span><span class="ident" id="4258096">v</span>&nbsp;<span class="builtintype" id="4258098">string</span><span class="op" id="4258104">)</span>&nbsp;<span class="op" id="4258106">(</span><span class="ident" id="4258107">token</span><span class="op" id="4258112">,</span>&nbsp;<span class="ident" id="4258114">rest</span>&nbsp;<span class="builtintype" id="4258119">string</span><span class="op" id="4258125">)</span>&nbsp;<span class="op" id="4258127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4258130">notPos</span>&nbsp;<span class="op" id="4258137">:=</span>&nbsp;<span class="ident" id="4258140">strings</span><span class="op" id="4258147">.</span><span class="ident" id="4258148">IndexFunc</span><span class="op" id="4258157">(</span><span class="ident" id="4258158">v</span><span class="op" id="4258159">,</span>&nbsp;<span class="ident" id="4258161">isNotTokenChar</span><span class="op" id="4258175">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4258178">if</span>&nbsp;<span class="ident" id="4258181">notPos</span>&nbsp;<span class="op" id="4258188">==</span>&nbsp;<span class="op" id="4258191">-</span><span class="num" id="4258192">1</span>&nbsp;<span class="op" id="4258194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4258198">return</span>&nbsp;<span class="ident" id="4258205">v</span><span class="op" id="4258206">,</span>&nbsp;<span class="string" id="4258208">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4258212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4258215">if</span>&nbsp;<span class="ident" id="4258218">notPos</span>&nbsp;<span class="op" id="4258225">==</span>&nbsp;<span class="num" id="4258228">0</span>&nbsp;<span class="op" id="4258230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4258234">return</span>&nbsp;<span class="string" id="4258241">&#34;&#34;</span><span class="op" id="4258243">,</span>&nbsp;<span class="ident" id="4258245">v</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4258248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4258251">return</span>&nbsp;<span class="ident" id="4258258">v</span><span class="op" id="4258259">[</span><span class="num" id="4258260">0</span><span class="op" id="4258261">:</span><span class="ident" id="4258262">notPos</span><span class="op" id="4258268">]</span><span class="op" id="4258269">,</span>&nbsp;<span class="ident" id="4258271">v</span><span class="op" id="4258272">[</span><span class="ident" id="4258273">notPos</span><span class="op" id="4258279">:</span><span class="op" id="4258280">]</span><br>
<span class="lineno"></span><span class="op" id="4258282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4258285">//&nbsp;consumeValue&nbsp;consumes&nbsp;a&nbsp;&#34;value&#34;&nbsp;per&nbsp;RFC&nbsp;2045,&nbsp;where&nbsp;a&nbsp;value&nbsp;is</span><br>
<span class="lineno">235</span><span class="comment" id="4258351">//&nbsp;either&nbsp;a&nbsp;&#39;token&#39;&nbsp;or&nbsp;a&nbsp;&#39;quoted-string&#39;.&nbsp;&nbsp;On&nbsp;success,&nbsp;consumeValue</span><br>
<span class="lineno"></span><span class="comment" id="4258419">//&nbsp;returns&nbsp;the&nbsp;value&nbsp;consumed&nbsp;(and&nbsp;de-quoted/escaped,&nbsp;if&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4258478">//&nbsp;quoted-string)&nbsp;and&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;string.&nbsp;&nbsp;On&nbsp;failure,&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="4258545">//&nbsp;(&#34;&#34;,&nbsp;v).</span><br>
<span class="lineno"></span><span class="keyword" id="4258557">func</span>&nbsp;<span class="ident" id="4258562">consumeValue</span><span class="op" id="4258574">(</span><span class="ident" id="4258575">v</span>&nbsp;<span class="builtintype" id="4258577">string</span><span class="op" id="4258583">)</span>&nbsp;<span class="op" id="4258585">(</span><span class="ident" id="4258586">value</span><span class="op" id="4258591">,</span>&nbsp;<span class="ident" id="4258593">rest</span>&nbsp;<span class="builtintype" id="4258598">string</span><span class="op" id="4258604">)</span>&nbsp;<span class="op" id="4258606">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4258609">if</span>&nbsp;<span class="op" id="4258612">!</span><span class="ident" id="4258613">strings</span><span class="op" id="4258620">.</span><span class="ident" id="4258621">HasPrefix</span><span class="op" id="4258630">(</span><span class="ident" id="4258631">v</span><span class="op" id="4258632">,</span>&nbsp;<span class="string" id="4258634">`&#34;`</span><span class="op" id="4258637">)</span>&nbsp;<span class="op" id="4258639">&amp;&amp;</span>&nbsp;<span class="op" id="4258642">!</span><span class="ident" id="4258643">strings</span><span class="op" id="4258650">.</span><span class="ident" id="4258651">HasPrefix</span><span class="op" id="4258660">(</span><span class="ident" id="4258661">v</span><span class="op" id="4258662">,</span>&nbsp;<span class="string" id="4258664">`&#39;`</span><span class="op" id="4258667">)</span>&nbsp;<span class="op" id="4258669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4258673">return</span>&nbsp;<span class="ident" id="4258680">consumeToken</span><span class="op" id="4258692">(</span><span class="ident" id="4258693">v</span><span class="op" id="4258694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4258697">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4258701">leadQuote</span>&nbsp;<span class="op" id="4258711">:=</span>&nbsp;<span class="builtintype" id="4258714">rune</span><span class="op" id="4258718">(</span><span class="ident" id="4258719">v</span><span class="op" id="4258720">[</span><span class="num" id="4258721">0</span><span class="op" id="4258722">]</span><span class="op" id="4258723">)</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4258727">//&nbsp;parse&nbsp;a&nbsp;quoted-string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4258753">rest</span>&nbsp;<span class="op" id="4258758">=</span>&nbsp;<span class="ident" id="4258760">v</span><span class="op" id="4258761">[</span><span class="num" id="4258762">1</span><span class="op" id="4258763">:</span><span class="op" id="4258764">]</span>&nbsp;<span class="comment" id="4258766">//&nbsp;consume&nbsp;the&nbsp;leading&nbsp;quote</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4258796">buffer</span>&nbsp;<span class="op" id="4258803">:=</span>&nbsp;<span class="builtinfunc" id="4258806">new</span><span class="op" id="4258809">(</span><span class="ident" id="4258810">bytes</span><span class="op" id="4258815">.</span><span class="ident" id="4258816">Buffer</span><span class="op" id="4258822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4258825">var</span>&nbsp;<span class="ident" id="4258829">idx</span>&nbsp;<span class="builtintype" id="4258833">int</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4258838">var</span>&nbsp;<span class="ident" id="4258842">r</span>&nbsp;<span class="builtintype" id="4258844">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4258850">var</span>&nbsp;<span class="ident" id="4258854">nextIsLiteral</span>&nbsp;<span class="builtintype" id="4258868">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4258874">for</span>&nbsp;<span class="ident" id="4258878">idx</span><span class="op" id="4258881">,</span>&nbsp;<span class="ident" id="4258883">r</span>&nbsp;<span class="op" id="4258885">=</span>&nbsp;<span class="keyword" id="4258887">range</span>&nbsp;<span class="ident" id="4258893">rest</span>&nbsp;<span class="op" id="4258898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4258902">switch</span>&nbsp;<span class="op" id="4258909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4258913">case</span>&nbsp;<span class="ident" id="4258918">nextIsLiteral</span><span class="op" id="4258931">:</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4258936">buffer</span><span class="op" id="4258942">.</span><span class="ident" id="4258943">WriteRune</span><span class="op" id="4258952">(</span><span class="ident" id="4258953">r</span><span class="op" id="4258954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4258959">nextIsLiteral</span>&nbsp;<span class="op" id="4258973">=</span>&nbsp;<span class="builtintype" id="4258975">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4258983">case</span>&nbsp;<span class="ident" id="4258988">r</span>&nbsp;<span class="op" id="4258990">==</span>&nbsp;<span class="ident" id="4258993">leadQuote</span><span class="op" id="4259002">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4259007">return</span>&nbsp;<span class="ident" id="4259014">buffer</span><span class="op" id="4259020">.</span><span class="ident" id="4259021">String</span><span class="op" id="4259027">(</span><span class="op" id="4259028">)</span><span class="op" id="4259029">,</span>&nbsp;<span class="ident" id="4259031">rest</span><span class="op" id="4259035">[</span><span class="ident" id="4259036">idx</span><span class="op" id="4259039">+</span><span class="num" id="4259040">1</span><span class="op" id="4259041">:</span><span class="op" id="4259042">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4259046">case</span>&nbsp;<span class="ident" id="4259051">r</span>&nbsp;<span class="op" id="4259053">==</span>&nbsp;<span class="string" id="4259056">&#39;\\&#39;</span><span class="op" id="4259060">:</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4259065">nextIsLiteral</span>&nbsp;<span class="op" id="4259079">=</span>&nbsp;<span class="builtintype" id="4259081">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4259088">case</span>&nbsp;<span class="ident" id="4259093">r</span>&nbsp;<span class="op" id="4259095">!=</span>&nbsp;<span class="string" id="4259098">&#39;\r&#39;</span>&nbsp;<span class="op" id="4259103">&amp;&amp;</span>&nbsp;<span class="ident" id="4259106">r</span>&nbsp;<span class="op" id="4259108">!=</span>&nbsp;<span class="string" id="4259111">&#39;\n&#39;</span><span class="op" id="4259115">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4259120">buffer</span><span class="op" id="4259126">.</span><span class="ident" id="4259127">WriteRune</span><span class="op" id="4259136">(</span><span class="ident" id="4259137">r</span><span class="op" id="4259138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4259142">default</span><span class="op" id="4259149">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4259154">return</span>&nbsp;<span class="string" id="4259161">&#34;&#34;</span><span class="op" id="4259163">,</span>&nbsp;<span class="ident" id="4259165">v</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4259169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4259172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4259175">return</span>&nbsp;<span class="string" id="4259182">&#34;&#34;</span><span class="op" id="4259184">,</span>&nbsp;<span class="ident" id="4259186">v</span><br>
<span class="lineno"></span><span class="op" id="4259188">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="keyword" id="4259191">func</span>&nbsp;<span class="ident" id="4259196">consumeMediaParam</span><span class="op" id="4259213">(</span><span class="ident" id="4259214">v</span>&nbsp;<span class="builtintype" id="4259216">string</span><span class="op" id="4259222">)</span>&nbsp;<span class="op" id="4259224">(</span><span class="ident" id="4259225">param</span><span class="op" id="4259230">,</span>&nbsp;<span class="ident" id="4259232">value</span><span class="op" id="4259237">,</span>&nbsp;<span class="ident" id="4259239">rest</span>&nbsp;<span class="builtintype" id="4259244">string</span><span class="op" id="4259250">)</span>&nbsp;<span class="op" id="4259252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4259255">rest</span>&nbsp;<span class="op" id="4259260">=</span>&nbsp;<span class="ident" id="4259262">strings</span><span class="op" id="4259269">.</span><span class="ident" id="4259270">TrimLeftFunc</span><span class="op" id="4259282">(</span><span class="ident" id="4259283">v</span><span class="op" id="4259284">,</span>&nbsp;<span class="ident" id="4259286">unicode</span><span class="op" id="4259293">.</span><span class="ident" id="4259294">IsSpace</span><span class="op" id="4259301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4259304">if</span>&nbsp;<span class="op" id="4259307">!</span><span class="ident" id="4259308">strings</span><span class="op" id="4259315">.</span><span class="ident" id="4259316">HasPrefix</span><span class="op" id="4259325">(</span><span class="ident" id="4259326">rest</span><span class="op" id="4259330">,</span>&nbsp;<span class="string" id="4259332">&#34;;&#34;</span><span class="op" id="4259335">)</span>&nbsp;<span class="op" id="4259337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4259341">return</span>&nbsp;<span class="string" id="4259348">&#34;&#34;</span><span class="op" id="4259350">,</span>&nbsp;<span class="string" id="4259352">&#34;&#34;</span><span class="op" id="4259354">,</span>&nbsp;<span class="ident" id="4259356">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4259359">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4259363">rest</span>&nbsp;<span class="op" id="4259368">=</span>&nbsp;<span class="ident" id="4259370">rest</span><span class="op" id="4259374">[</span><span class="num" id="4259375">1</span><span class="op" id="4259376">:</span><span class="op" id="4259377">]</span>&nbsp;<span class="comment" id="4259379">//&nbsp;consume&nbsp;semicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4259401">rest</span>&nbsp;<span class="op" id="4259406">=</span>&nbsp;<span class="ident" id="4259408">strings</span><span class="op" id="4259415">.</span><span class="ident" id="4259416">TrimLeftFunc</span><span class="op" id="4259428">(</span><span class="ident" id="4259429">rest</span><span class="op" id="4259433">,</span>&nbsp;<span class="ident" id="4259435">unicode</span><span class="op" id="4259442">.</span><span class="ident" id="4259443">IsSpace</span><span class="op" id="4259450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4259453">param</span><span class="op" id="4259458">,</span>&nbsp;<span class="ident" id="4259460">rest</span>&nbsp;<span class="op" id="4259465">=</span>&nbsp;<span class="ident" id="4259467">consumeToken</span><span class="op" id="4259479">(</span><span class="ident" id="4259480">rest</span><span class="op" id="4259484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4259487">param</span>&nbsp;<span class="op" id="4259493">=</span>&nbsp;<span class="ident" id="4259495">strings</span><span class="op" id="4259502">.</span><span class="ident" id="4259503">ToLower</span><span class="op" id="4259510">(</span><span class="ident" id="4259511">param</span><span class="op" id="4259516">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4259519">if</span>&nbsp;<span class="ident" id="4259522">param</span>&nbsp;<span class="op" id="4259528">==</span>&nbsp;<span class="string" id="4259531">&#34;&#34;</span>&nbsp;<span class="op" id="4259534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4259538">return</span>&nbsp;<span class="string" id="4259545">&#34;&#34;</span><span class="op" id="4259547">,</span>&nbsp;<span class="string" id="4259549">&#34;&#34;</span><span class="op" id="4259551">,</span>&nbsp;<span class="ident" id="4259553">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4259556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4259560">rest</span>&nbsp;<span class="op" id="4259565">=</span>&nbsp;<span class="ident" id="4259567">strings</span><span class="op" id="4259574">.</span><span class="ident" id="4259575">TrimLeftFunc</span><span class="op" id="4259587">(</span><span class="ident" id="4259588">rest</span><span class="op" id="4259592">,</span>&nbsp;<span class="ident" id="4259594">unicode</span><span class="op" id="4259601">.</span><span class="ident" id="4259602">IsSpace</span><span class="op" id="4259609">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4259612">if</span>&nbsp;<span class="op" id="4259615">!</span><span class="ident" id="4259616">strings</span><span class="op" id="4259623">.</span><span class="ident" id="4259624">HasPrefix</span><span class="op" id="4259633">(</span><span class="ident" id="4259634">rest</span><span class="op" id="4259638">,</span>&nbsp;<span class="string" id="4259640">&#34;=&#34;</span><span class="op" id="4259643">)</span>&nbsp;<span class="op" id="4259645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4259649">return</span>&nbsp;<span class="string" id="4259656">&#34;&#34;</span><span class="op" id="4259658">,</span>&nbsp;<span class="string" id="4259660">&#34;&#34;</span><span class="op" id="4259662">,</span>&nbsp;<span class="ident" id="4259664">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4259667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4259670">rest</span>&nbsp;<span class="op" id="4259675">=</span>&nbsp;<span class="ident" id="4259677">rest</span><span class="op" id="4259681">[</span><span class="num" id="4259682">1</span><span class="op" id="4259683">:</span><span class="op" id="4259684">]</span>&nbsp;<span class="comment" id="4259686">//&nbsp;consume&nbsp;equals&nbsp;sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4259710">rest</span>&nbsp;<span class="op" id="4259715">=</span>&nbsp;<span class="ident" id="4259717">strings</span><span class="op" id="4259724">.</span><span class="ident" id="4259725">TrimLeftFunc</span><span class="op" id="4259737">(</span><span class="ident" id="4259738">rest</span><span class="op" id="4259742">,</span>&nbsp;<span class="ident" id="4259744">unicode</span><span class="op" id="4259751">.</span><span class="ident" id="4259752">IsSpace</span><span class="op" id="4259759">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4259762">value</span><span class="op" id="4259767">,</span>&nbsp;<span class="ident" id="4259769">rest</span>&nbsp;<span class="op" id="4259774">=</span>&nbsp;<span class="ident" id="4259776">consumeValue</span><span class="op" id="4259788">(</span><span class="ident" id="4259789">rest</span><span class="op" id="4259793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4259796">if</span>&nbsp;<span class="ident" id="4259799">value</span>&nbsp;<span class="op" id="4259805">==</span>&nbsp;<span class="string" id="4259808">&#34;&#34;</span>&nbsp;<span class="op" id="4259811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4259815">return</span>&nbsp;<span class="string" id="4259822">&#34;&#34;</span><span class="op" id="4259824">,</span>&nbsp;<span class="string" id="4259826">&#34;&#34;</span><span class="op" id="4259828">,</span>&nbsp;<span class="ident" id="4259830">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4259833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4259836">return</span>&nbsp;<span class="ident" id="4259843">param</span><span class="op" id="4259848">,</span>&nbsp;<span class="ident" id="4259850">value</span><span class="op" id="4259855">,</span>&nbsp;<span class="ident" id="4259857">rest</span><br>
<span class="lineno">295</span><span class="op" id="4259862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4259865">func</span>&nbsp;<span class="ident" id="4259870">percentHexUnescape</span><span class="op" id="4259888">(</span><span class="ident" id="4259889">s</span>&nbsp;<span class="builtintype" id="4259891">string</span><span class="op" id="4259897">)</span>&nbsp;<span class="op" id="4259899">(</span><span class="builtintype" id="4259900">string</span><span class="op" id="4259906">,</span>&nbsp;<span class="builtintype" id="4259908">error</span><span class="op" id="4259913">)</span>&nbsp;<span class="op" id="4259915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4259918">//&nbsp;Count&nbsp;%,&nbsp;check&nbsp;that&nbsp;they&#39;re&nbsp;well-formed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4259963">percents</span>&nbsp;<span class="op" id="4259972">:=</span>&nbsp;<span class="num" id="4259975">0</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4259978">for</span>&nbsp;<span class="ident" id="4259982">i</span>&nbsp;<span class="op" id="4259984">:=</span>&nbsp;<span class="num" id="4259987">0</span><span class="op" id="4259988">;</span>&nbsp;<span class="ident" id="4259990">i</span>&nbsp;<span class="op" id="4259992">&lt;</span>&nbsp;<span class="builtinfunc" id="4259994">len</span><span class="op" id="4259997">(</span><span class="ident" id="4259998">s</span><span class="op" id="4259999">)</span><span class="op" id="4260000">;</span>&nbsp;<span class="op" id="4260002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4260006">if</span>&nbsp;<span class="ident" id="4260009">s</span><span class="op" id="4260010">[</span><span class="ident" id="4260011">i</span><span class="op" id="4260012">]</span>&nbsp;<span class="op" id="4260014">!=</span>&nbsp;<span class="string" id="4260017">&#39;%&#39;</span>&nbsp;<span class="op" id="4260021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4260026">i</span><span class="op" id="4260027">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4260033">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4260044">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4260048">percents</span><span class="op" id="4260056">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4260061">if</span>&nbsp;<span class="ident" id="4260064">i</span><span class="op" id="4260065">+</span><span class="num" id="4260066">2</span>&nbsp;<span class="op" id="4260068">&gt;=</span>&nbsp;<span class="builtinfunc" id="4260071">len</span><span class="op" id="4260074">(</span><span class="ident" id="4260075">s</span><span class="op" id="4260076">)</span>&nbsp;<span class="op" id="4260078">||</span>&nbsp;<span class="op" id="4260081">!</span><span class="ident" id="4260082">ishex</span><span class="op" id="4260087">(</span><span class="ident" id="4260088">s</span><span class="op" id="4260089">[</span><span class="ident" id="4260090">i</span><span class="op" id="4260091">+</span><span class="num" id="4260092">1</span><span class="op" id="4260093">]</span><span class="op" id="4260094">)</span>&nbsp;<span class="op" id="4260096">||</span>&nbsp;<span class="op" id="4260099">!</span><span class="ident" id="4260100">ishex</span><span class="op" id="4260105">(</span><span class="ident" id="4260106">s</span><span class="op" id="4260107">[</span><span class="ident" id="4260108">i</span><span class="op" id="4260109">+</span><span class="num" id="4260110">2</span><span class="op" id="4260111">]</span><span class="op" id="4260112">)</span>&nbsp;<span class="op" id="4260114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4260119">s</span>&nbsp;<span class="op" id="4260121">=</span>&nbsp;<span class="ident" id="4260123">s</span><span class="op" id="4260124">[</span><span class="ident" id="4260125">i</span><span class="op" id="4260126">:</span><span class="op" id="4260127">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4260132">if</span>&nbsp;<span class="builtinfunc" id="4260135">len</span><span class="op" id="4260138">(</span><span class="ident" id="4260139">s</span><span class="op" id="4260140">)</span>&nbsp;<span class="op" id="4260142">&gt;</span>&nbsp;<span class="num" id="4260144">3</span>&nbsp;<span class="op" id="4260146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4260152">s</span>&nbsp;<span class="op" id="4260154">=</span>&nbsp;<span class="ident" id="4260156">s</span><span class="op" id="4260157">[</span><span class="num" id="4260158">0</span><span class="op" id="4260159">:</span><span class="num" id="4260160">3</span><span class="op" id="4260161">]</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4260166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4260171">return</span>&nbsp;<span class="string" id="4260178">&#34;&#34;</span><span class="op" id="4260180">,</span>&nbsp;<span class="ident" id="4260182">fmt</span><span class="op" id="4260185">.</span><span class="ident" id="4260186">Errorf</span><span class="op" id="4260192">(</span><span class="string" id="4260193">&#34;mime:&nbsp;bogus&nbsp;characters&nbsp;after&nbsp;%%:&nbsp;%q&#34;</span><span class="op" id="4260230">,</span>&nbsp;<span class="ident" id="4260232">s</span><span class="op" id="4260233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4260237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4260241">i</span>&nbsp;<span class="op" id="4260243">+=</span>&nbsp;<span class="num" id="4260246">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4260249">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4260252">if</span>&nbsp;<span class="ident" id="4260255">percents</span>&nbsp;<span class="op" id="4260264">==</span>&nbsp;<span class="num" id="4260267">0</span>&nbsp;<span class="op" id="4260269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4260273">return</span>&nbsp;<span class="ident" id="4260280">s</span><span class="op" id="4260281">,</span>&nbsp;<span class="ident" id="4260283">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4260288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4260292">t</span>&nbsp;<span class="op" id="4260294">:=</span>&nbsp;<span class="builtinfunc" id="4260297">make</span><span class="op" id="4260301">(</span><span class="op" id="4260302">[</span><span class="op" id="4260303">]</span><span class="builtintype" id="4260304">byte</span><span class="op" id="4260308">,</span>&nbsp;<span class="builtinfunc" id="4260310">len</span><span class="op" id="4260313">(</span><span class="ident" id="4260314">s</span><span class="op" id="4260315">)</span><span class="op" id="4260316">-</span><span class="num" id="4260317">2</span><span class="op" id="4260318">*</span><span class="ident" id="4260319">percents</span><span class="op" id="4260327">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4260330">j</span>&nbsp;<span class="op" id="4260332">:=</span>&nbsp;<span class="num" id="4260335">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4260338">for</span>&nbsp;<span class="ident" id="4260342">i</span>&nbsp;<span class="op" id="4260344">:=</span>&nbsp;<span class="num" id="4260347">0</span><span class="op" id="4260348">;</span>&nbsp;<span class="ident" id="4260350">i</span>&nbsp;<span class="op" id="4260352">&lt;</span>&nbsp;<span class="builtinfunc" id="4260354">len</span><span class="op" id="4260357">(</span><span class="ident" id="4260358">s</span><span class="op" id="4260359">)</span><span class="op" id="4260360">;</span>&nbsp;<span class="op" id="4260362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4260366">switch</span>&nbsp;<span class="ident" id="4260373">s</span><span class="op" id="4260374">[</span><span class="ident" id="4260375">i</span><span class="op" id="4260376">]</span>&nbsp;<span class="op" id="4260378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4260382">case</span>&nbsp;<span class="string" id="4260387">&#39;%&#39;</span><span class="op" id="4260390">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4260395">t</span><span class="op" id="4260396">[</span><span class="ident" id="4260397">j</span><span class="op" id="4260398">]</span>&nbsp;<span class="op" id="4260400">=</span>&nbsp;<span class="ident" id="4260402">unhex</span><span class="op" id="4260407">(</span><span class="ident" id="4260408">s</span><span class="op" id="4260409">[</span><span class="ident" id="4260410">i</span><span class="op" id="4260411">+</span><span class="num" id="4260412">1</span><span class="op" id="4260413">]</span><span class="op" id="4260414">)</span><span class="op" id="4260415">&lt;&lt;</span><span class="num" id="4260417">4</span>&nbsp;<span class="op" id="4260419">|</span>&nbsp;<span class="ident" id="4260421">unhex</span><span class="op" id="4260426">(</span><span class="ident" id="4260427">s</span><span class="op" id="4260428">[</span><span class="ident" id="4260429">i</span><span class="op" id="4260430">+</span><span class="num" id="4260431">2</span><span class="op" id="4260432">]</span><span class="op" id="4260433">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4260438">j</span><span class="op" id="4260439">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4260445">i</span>&nbsp;<span class="op" id="4260447">+=</span>&nbsp;<span class="num" id="4260450">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4260454">default</span><span class="op" id="4260461">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4260466">t</span><span class="op" id="4260467">[</span><span class="ident" id="4260468">j</span><span class="op" id="4260469">]</span>&nbsp;<span class="op" id="4260471">=</span>&nbsp;<span class="ident" id="4260473">s</span><span class="op" id="4260474">[</span><span class="ident" id="4260475">i</span><span class="op" id="4260476">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4260481">j</span><span class="op" id="4260482">++</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4260488">i</span><span class="op" id="4260489">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4260494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4260497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4260500">return</span>&nbsp;<span class="builtintype" id="4260507">string</span><span class="op" id="4260513">(</span><span class="ident" id="4260514">t</span><span class="op" id="4260515">)</span><span class="op" id="4260516">,</span>&nbsp;<span class="ident" id="4260518">nil</span><br>
<span class="lineno"></span><span class="op" id="4260522">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span><span class="keyword" id="4260525">func</span>&nbsp;<span class="ident" id="4260530">ishex</span><span class="op" id="4260535">(</span><span class="ident" id="4260536">c</span>&nbsp;<span class="builtintype" id="4260538">byte</span><span class="op" id="4260542">)</span>&nbsp;<span class="builtintype" id="4260544">bool</span>&nbsp;<span class="op" id="4260549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4260552">switch</span>&nbsp;<span class="op" id="4260559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4260562">case</span>&nbsp;<span class="string" id="4260567">&#39;0&#39;</span>&nbsp;<span class="op" id="4260571">&lt;=</span>&nbsp;<span class="ident" id="4260574">c</span>&nbsp;<span class="op" id="4260576">&amp;&amp;</span>&nbsp;<span class="ident" id="4260579">c</span>&nbsp;<span class="op" id="4260581">&lt;=</span>&nbsp;<span class="string" id="4260584">&#39;9&#39;</span><span class="op" id="4260587">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4260591">return</span>&nbsp;<span class="builtintype" id="4260598">true</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4260604">case</span>&nbsp;<span class="string" id="4260609">&#39;a&#39;</span>&nbsp;<span class="op" id="4260613">&lt;=</span>&nbsp;<span class="ident" id="4260616">c</span>&nbsp;<span class="op" id="4260618">&amp;&amp;</span>&nbsp;<span class="ident" id="4260621">c</span>&nbsp;<span class="op" id="4260623">&lt;=</span>&nbsp;<span class="string" id="4260626">&#39;f&#39;</span><span class="op" id="4260629">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4260633">return</span>&nbsp;<span class="builtintype" id="4260640">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4260646">case</span>&nbsp;<span class="string" id="4260651">&#39;A&#39;</span>&nbsp;<span class="op" id="4260655">&lt;=</span>&nbsp;<span class="ident" id="4260658">c</span>&nbsp;<span class="op" id="4260660">&amp;&amp;</span>&nbsp;<span class="ident" id="4260663">c</span>&nbsp;<span class="op" id="4260665">&lt;=</span>&nbsp;<span class="string" id="4260668">&#39;F&#39;</span><span class="op" id="4260671">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4260675">return</span>&nbsp;<span class="builtintype" id="4260682">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4260688">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4260691">return</span>&nbsp;<span class="builtintype" id="4260698">false</span><br>
<span class="lineno"></span><span class="op" id="4260704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4260707">func</span>&nbsp;<span class="ident" id="4260712">unhex</span><span class="op" id="4260717">(</span><span class="ident" id="4260718">c</span>&nbsp;<span class="builtintype" id="4260720">byte</span><span class="op" id="4260724">)</span>&nbsp;<span class="builtintype" id="4260726">byte</span>&nbsp;<span class="op" id="4260731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4260734">switch</span>&nbsp;<span class="op" id="4260741">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4260744">case</span>&nbsp;<span class="string" id="4260749">&#39;0&#39;</span>&nbsp;<span class="op" id="4260753">&lt;=</span>&nbsp;<span class="ident" id="4260756">c</span>&nbsp;<span class="op" id="4260758">&amp;&amp;</span>&nbsp;<span class="ident" id="4260761">c</span>&nbsp;<span class="op" id="4260763">&lt;=</span>&nbsp;<span class="string" id="4260766">&#39;9&#39;</span><span class="op" id="4260769">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4260773">return</span>&nbsp;<span class="ident" id="4260780">c</span>&nbsp;<span class="op" id="4260782">-</span>&nbsp;<span class="string" id="4260784">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4260789">case</span>&nbsp;<span class="string" id="4260794">&#39;a&#39;</span>&nbsp;<span class="op" id="4260798">&lt;=</span>&nbsp;<span class="ident" id="4260801">c</span>&nbsp;<span class="op" id="4260803">&amp;&amp;</span>&nbsp;<span class="ident" id="4260806">c</span>&nbsp;<span class="op" id="4260808">&lt;=</span>&nbsp;<span class="string" id="4260811">&#39;f&#39;</span><span class="op" id="4260814">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4260818">return</span>&nbsp;<span class="ident" id="4260825">c</span>&nbsp;<span class="op" id="4260827">-</span>&nbsp;<span class="string" id="4260829">&#39;a&#39;</span>&nbsp;<span class="op" id="4260833">+</span>&nbsp;<span class="num" id="4260835">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4260839">case</span>&nbsp;<span class="string" id="4260844">&#39;A&#39;</span>&nbsp;<span class="op" id="4260848">&lt;=</span>&nbsp;<span class="ident" id="4260851">c</span>&nbsp;<span class="op" id="4260853">&amp;&amp;</span>&nbsp;<span class="ident" id="4260856">c</span>&nbsp;<span class="op" id="4260858">&lt;=</span>&nbsp;<span class="string" id="4260861">&#39;F&#39;</span><span class="op" id="4260864">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4260868">return</span>&nbsp;<span class="ident" id="4260875">c</span>&nbsp;<span class="op" id="4260877">-</span>&nbsp;<span class="string" id="4260879">&#39;A&#39;</span>&nbsp;<span class="op" id="4260883">+</span>&nbsp;<span class="num" id="4260885">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4260889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4260892">return</span>&nbsp;<span class="num" id="4260899">0</span><br>
<span class="lineno"></span><span class="op" id="4260901">}</span>
</div>
</body>
</html>
