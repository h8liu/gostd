<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/token</h2>
<ul>
<li><a href="/gostd/go/token/position.go.html" class="current">position.go</a></li>
<li><a href="/gostd/go/token/position_test.go.html">position_test.go</a></li>
<li><a href="/gostd/go/token/serialize.go.html">serialize.go</a></li>
<li><a href="/gostd/go/token/serialize_test.go.html">serialize_test.go</a></li>
<li><a href="/gostd/go/token/token.go.html">token.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3269141">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3269196">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3269250">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3269301">package</span>&nbsp;<span class="ident" id="3269309">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3269316">import</span>&nbsp;<span class="op" id="3269323">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3269326">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3269333">&#34;sort&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3269341">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="3269348">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3269351">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="3269432">//&nbsp;Positions</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3269446">//&nbsp;Position&nbsp;describes&nbsp;an&nbsp;arbitrary&nbsp;source&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="3269497">//&nbsp;including&nbsp;the&nbsp;file,&nbsp;line,&nbsp;and&nbsp;column&nbsp;location.</span><br>
<span class="lineno"></span><span class="comment" id="3269547">//&nbsp;A&nbsp;Position&nbsp;is&nbsp;valid&nbsp;if&nbsp;the&nbsp;line&nbsp;number&nbsp;is&nbsp;&gt;&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="3269597">//</span><br>
<span class="lineno">20</span><span class="keyword" id="3269600">type</span>&nbsp;<span class="ident" id="3269605">Position</span>&nbsp;<span class="keyword" id="3269614">struct</span>&nbsp;<span class="op" id="3269621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3269624">Filename</span>&nbsp;<span class="builtintype" id="3269633">string</span>&nbsp;<span class="comment" id="3269640">//&nbsp;filename,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3269661">Offset</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3269670">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3269677">//&nbsp;offset,&nbsp;starting&nbsp;at&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3269703">Line</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3269712">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3269719">//&nbsp;line&nbsp;number,&nbsp;starting&nbsp;at&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3269750">Column</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3269759">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3269766">//&nbsp;column&nbsp;number,&nbsp;starting&nbsp;at&nbsp;1&nbsp;(character&nbsp;count)</span><br>
<span class="lineno">25</span><span class="op" id="3269816">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3269819">//&nbsp;IsValid&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;position&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="3269869">func</span>&nbsp;<span class="op" id="3269874">(</span><span class="ident" id="3269875">pos</span>&nbsp;<span class="op" id="3269879">*</span><span class="ident" id="3269880">Position</span><span class="op" id="3269888">)</span>&nbsp;<span class="ident" id="3269890">IsValid</span><span class="op" id="3269897">(</span><span class="op" id="3269898">)</span>&nbsp;<span class="builtintype" id="3269900">bool</span>&nbsp;<span class="op" id="3269905">{</span>&nbsp;<span class="keyword" id="3269907">return</span>&nbsp;<span class="ident" id="3269914">pos</span><span class="op" id="3269917">.</span><span class="ident" id="3269918">Line</span>&nbsp;<span class="op" id="3269923">&gt;</span>&nbsp;<span class="num" id="3269925">0</span>&nbsp;<span class="op" id="3269927">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="3269930">//&nbsp;String&nbsp;returns&nbsp;a&nbsp;string&nbsp;in&nbsp;one&nbsp;of&nbsp;several&nbsp;forms:</span><br>
<span class="lineno"></span><span class="comment" id="3269982">//</span><br>
<span class="lineno"></span><span class="comment" id="3269985">//&nbsp;&nbsp;&nbsp;&nbsp;file:line:column&nbsp;&nbsp;&nbsp;&nbsp;valid&nbsp;position&nbsp;with&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="3270038">//&nbsp;&nbsp;&nbsp;&nbsp;line:column&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;valid&nbsp;position&nbsp;without&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="3270094">//&nbsp;&nbsp;&nbsp;&nbsp;file&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invalid&nbsp;position&nbsp;with&nbsp;file&nbsp;name</span><br>
<span class="lineno">35</span><span class="comment" id="3270149">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invalid&nbsp;position&nbsp;without&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="3270207">//</span><br>
<span class="lineno"></span><span class="keyword" id="3270210">func</span>&nbsp;<span class="op" id="3270215">(</span><span class="ident" id="3270216">pos</span>&nbsp;<span class="ident" id="3270220">Position</span><span class="op" id="3270228">)</span>&nbsp;<span class="ident" id="3270230">String</span><span class="op" id="3270236">(</span><span class="op" id="3270237">)</span>&nbsp;<span class="builtintype" id="3270239">string</span>&nbsp;<span class="op" id="3270246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3270249">s</span>&nbsp;<span class="op" id="3270251">:=</span>&nbsp;<span class="ident" id="3270254">pos</span><span class="op" id="3270257">.</span><span class="ident" id="3270258">Filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3270268">if</span>&nbsp;<span class="ident" id="3270271">pos</span><span class="op" id="3270274">.</span><span class="ident" id="3270275">IsValid</span><span class="op" id="3270282">(</span><span class="op" id="3270283">)</span>&nbsp;<span class="op" id="3270285">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3270289">if</span>&nbsp;<span class="ident" id="3270292">s</span>&nbsp;<span class="op" id="3270294">!=</span>&nbsp;<span class="string" id="3270297">&#34;&#34;</span>&nbsp;<span class="op" id="3270300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3270305">s</span>&nbsp;<span class="op" id="3270307">+=</span>&nbsp;<span class="string" id="3270310">&#34;:&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3270316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3270320">s</span>&nbsp;<span class="op" id="3270322">+=</span>&nbsp;<span class="ident" id="3270325">fmt</span><span class="op" id="3270328">.</span><span class="ident" id="3270329">Sprintf</span><span class="op" id="3270336">(</span><span class="string" id="3270337">&#34;%d:%d&#34;</span><span class="op" id="3270344">,</span>&nbsp;<span class="ident" id="3270346">pos</span><span class="op" id="3270349">.</span><span class="ident" id="3270350">Line</span><span class="op" id="3270354">,</span>&nbsp;<span class="ident" id="3270356">pos</span><span class="op" id="3270359">.</span><span class="ident" id="3270360">Column</span><span class="op" id="3270366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3270369">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3270372">if</span>&nbsp;<span class="ident" id="3270375">s</span>&nbsp;<span class="op" id="3270377">==</span>&nbsp;<span class="string" id="3270380">&#34;&#34;</span>&nbsp;<span class="op" id="3270383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3270387">s</span>&nbsp;<span class="op" id="3270389">=</span>&nbsp;<span class="string" id="3270391">&#34;-&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3270396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3270399">return</span>&nbsp;<span class="ident" id="3270406">s</span><br>
<span class="lineno"></span><span class="op" id="3270408">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="3270411">//&nbsp;Pos&nbsp;is&nbsp;a&nbsp;compact&nbsp;encoding&nbsp;of&nbsp;a&nbsp;source&nbsp;position&nbsp;within&nbsp;a&nbsp;file&nbsp;set.</span><br>
<span class="lineno"></span><span class="comment" id="3270480">//&nbsp;It&nbsp;can&nbsp;be&nbsp;converted&nbsp;into&nbsp;a&nbsp;Position&nbsp;for&nbsp;a&nbsp;more&nbsp;convenient,&nbsp;but&nbsp;much</span><br>
<span class="lineno"></span><span class="comment" id="3270551">//&nbsp;larger,&nbsp;representation.</span><br>
<span class="lineno"></span><span class="comment" id="3270578">//</span><br>
<span class="lineno">55</span><span class="comment" id="3270581">//&nbsp;The&nbsp;Pos&nbsp;value&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;is&nbsp;a&nbsp;number&nbsp;in&nbsp;the&nbsp;range&nbsp;[base,&nbsp;base+size],</span><br>
<span class="lineno"></span><span class="comment" id="3270659">//&nbsp;where&nbsp;base&nbsp;and&nbsp;size&nbsp;are&nbsp;specified&nbsp;when&nbsp;adding&nbsp;the&nbsp;file&nbsp;to&nbsp;the&nbsp;file&nbsp;set&nbsp;via</span><br>
<span class="lineno"></span><span class="comment" id="3270737">//&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="comment" id="3270749">//</span><br>
<span class="lineno"></span><span class="comment" id="3270752">//&nbsp;To&nbsp;create&nbsp;the&nbsp;Pos&nbsp;value&nbsp;for&nbsp;a&nbsp;specific&nbsp;source&nbsp;offset,&nbsp;first&nbsp;add</span><br>
<span class="lineno">60</span><span class="comment" id="3270819">//&nbsp;the&nbsp;respective&nbsp;file&nbsp;to&nbsp;the&nbsp;current&nbsp;file&nbsp;set&nbsp;(via&nbsp;FileSet.AddFile)</span><br>
<span class="lineno"></span><span class="comment" id="3270888">//&nbsp;and&nbsp;then&nbsp;call&nbsp;File.Pos(offset)&nbsp;for&nbsp;that&nbsp;file.&nbsp;Given&nbsp;a&nbsp;Pos&nbsp;value&nbsp;p</span><br>
<span class="lineno"></span><span class="comment" id="3270957">//&nbsp;for&nbsp;a&nbsp;specific&nbsp;file&nbsp;set&nbsp;fset,&nbsp;the&nbsp;corresponding&nbsp;Position&nbsp;value&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3271026">//&nbsp;obtained&nbsp;by&nbsp;calling&nbsp;fset.Position(p).</span><br>
<span class="lineno"></span><span class="comment" id="3271067">//</span><br>
<span class="lineno">65</span><span class="comment" id="3271070">//&nbsp;Pos&nbsp;values&nbsp;can&nbsp;be&nbsp;compared&nbsp;directly&nbsp;with&nbsp;the&nbsp;usual&nbsp;comparison&nbsp;operators:</span><br>
<span class="lineno"></span><span class="comment" id="3271146">//&nbsp;If&nbsp;two&nbsp;Pos&nbsp;values&nbsp;p&nbsp;and&nbsp;q&nbsp;are&nbsp;in&nbsp;the&nbsp;same&nbsp;file,&nbsp;comparing&nbsp;p&nbsp;and&nbsp;q&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3271218">//&nbsp;equivalent&nbsp;to&nbsp;comparing&nbsp;the&nbsp;respective&nbsp;source&nbsp;file&nbsp;offsets.&nbsp;If&nbsp;p&nbsp;and&nbsp;q</span><br>
<span class="lineno"></span><span class="comment" id="3271292">//&nbsp;are&nbsp;in&nbsp;different&nbsp;files,&nbsp;p&nbsp;&lt;&nbsp;q&nbsp;is&nbsp;true&nbsp;if&nbsp;the&nbsp;file&nbsp;implied&nbsp;by&nbsp;p&nbsp;was&nbsp;added</span><br>
<span class="lineno"></span><span class="comment" id="3271368">//&nbsp;to&nbsp;the&nbsp;respective&nbsp;file&nbsp;set&nbsp;before&nbsp;the&nbsp;file&nbsp;implied&nbsp;by&nbsp;q.</span><br>
<span class="lineno">70</span><span class="comment" id="3271428">//</span><br>
<span class="lineno"></span><span class="keyword" id="3271431">type</span>&nbsp;<span class="ident" id="3271436">Pos</span>&nbsp;<span class="builtintype" id="3271440">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3271445">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;Pos&nbsp;is&nbsp;NoPos;&nbsp;there&nbsp;is&nbsp;no&nbsp;file&nbsp;and&nbsp;line&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="3271519">//&nbsp;associated&nbsp;with&nbsp;it,&nbsp;and&nbsp;NoPos().IsValid()&nbsp;is&nbsp;false.&nbsp;NoPos&nbsp;is&nbsp;always</span><br>
<span class="lineno">75</span><span class="comment" id="3271590">//&nbsp;smaller&nbsp;than&nbsp;any&nbsp;other&nbsp;Pos&nbsp;value.&nbsp;The&nbsp;corresponding&nbsp;Position&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="3271660">//&nbsp;for&nbsp;NoPos&nbsp;is&nbsp;the&nbsp;zero&nbsp;value&nbsp;for&nbsp;Position.</span><br>
<span class="lineno"></span><span class="comment" id="3271705">//</span><br>
<span class="lineno"></span><span class="keyword" id="3271708">const</span>&nbsp;<span class="ident" id="3271714">NoPos</span>&nbsp;<span class="ident" id="3271720">Pos</span>&nbsp;<span class="op" id="3271724">=</span>&nbsp;<span class="num" id="3271726">0</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="3271729">//&nbsp;IsValid&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;position&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="3271779">func</span>&nbsp;<span class="op" id="3271784">(</span><span class="ident" id="3271785">p</span>&nbsp;<span class="ident" id="3271787">Pos</span><span class="op" id="3271790">)</span>&nbsp;<span class="ident" id="3271792">IsValid</span><span class="op" id="3271799">(</span><span class="op" id="3271800">)</span>&nbsp;<span class="builtintype" id="3271802">bool</span>&nbsp;<span class="op" id="3271807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3271810">return</span>&nbsp;<span class="ident" id="3271817">p</span>&nbsp;<span class="op" id="3271819">!=</span>&nbsp;<span class="ident" id="3271822">NoPos</span><br>
<span class="lineno"></span><span class="op" id="3271828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="3271831">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="3271912">//&nbsp;File</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3271921">//&nbsp;A&nbsp;File&nbsp;is&nbsp;a&nbsp;handle&nbsp;for&nbsp;a&nbsp;file&nbsp;belonging&nbsp;to&nbsp;a&nbsp;FileSet.</span><br>
<span class="lineno"></span><span class="comment" id="3271978">//&nbsp;A&nbsp;File&nbsp;has&nbsp;a&nbsp;name,&nbsp;size,&nbsp;and&nbsp;line&nbsp;offset&nbsp;table.</span><br>
<span class="lineno">90</span><span class="comment" id="3272029">//</span><br>
<span class="lineno"></span><span class="keyword" id="3272032">type</span>&nbsp;<span class="ident" id="3272037">File</span>&nbsp;<span class="keyword" id="3272042">struct</span>&nbsp;<span class="op" id="3272049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3272052">set</span>&nbsp;&nbsp;<span class="op" id="3272057">*</span><span class="ident" id="3272058">FileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3272067">name</span>&nbsp;<span class="builtintype" id="3272072">string</span>&nbsp;<span class="comment" id="3272079">//&nbsp;file&nbsp;name&nbsp;as&nbsp;provided&nbsp;to&nbsp;AddFile</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3272116">base</span>&nbsp;<span class="builtintype" id="3272121">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3272128">//&nbsp;Pos&nbsp;value&nbsp;range&nbsp;for&nbsp;this&nbsp;file&nbsp;is&nbsp;[base...base+size]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3272184">size</span>&nbsp;<span class="builtintype" id="3272189">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3272196">//&nbsp;file&nbsp;size&nbsp;as&nbsp;provided&nbsp;to&nbsp;AddFile</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3272234">//&nbsp;lines&nbsp;and&nbsp;infos&nbsp;are&nbsp;protected&nbsp;by&nbsp;set.mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3272281">lines</span>&nbsp;<span class="op" id="3272287">[</span><span class="op" id="3272288">]</span><span class="builtintype" id="3272289">int</span>&nbsp;<span class="comment" id="3272293">//&nbsp;lines&nbsp;contains&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;first&nbsp;character&nbsp;for&nbsp;each&nbsp;line&nbsp;(the&nbsp;first&nbsp;entry&nbsp;is&nbsp;always&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3272390">infos</span>&nbsp;<span class="op" id="3272396">[</span><span class="op" id="3272397">]</span><span class="ident" id="3272398">lineInfo</span><br>
<span class="lineno">100</span><span class="op" id="3272407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3272410">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;file&nbsp;name&nbsp;of&nbsp;file&nbsp;f&nbsp;as&nbsp;registered&nbsp;with&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="keyword" id="3272478">func</span>&nbsp;<span class="op" id="3272483">(</span><span class="ident" id="3272484">f</span>&nbsp;<span class="op" id="3272486">*</span><span class="ident" id="3272487">File</span><span class="op" id="3272491">)</span>&nbsp;<span class="ident" id="3272493">Name</span><span class="op" id="3272497">(</span><span class="op" id="3272498">)</span>&nbsp;<span class="builtintype" id="3272500">string</span>&nbsp;<span class="op" id="3272507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3272510">return</span>&nbsp;<span class="ident" id="3272517">f</span><span class="op" id="3272518">.</span><span class="ident" id="3272519">name</span><br>
<span class="lineno">105</span><span class="op" id="3272524">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3272527">//&nbsp;Base&nbsp;returns&nbsp;the&nbsp;base&nbsp;offset&nbsp;of&nbsp;file&nbsp;f&nbsp;as&nbsp;registered&nbsp;with&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="keyword" id="3272597">func</span>&nbsp;<span class="op" id="3272602">(</span><span class="ident" id="3272603">f</span>&nbsp;<span class="op" id="3272605">*</span><span class="ident" id="3272606">File</span><span class="op" id="3272610">)</span>&nbsp;<span class="ident" id="3272612">Base</span><span class="op" id="3272616">(</span><span class="op" id="3272617">)</span>&nbsp;<span class="builtintype" id="3272619">int</span>&nbsp;<span class="op" id="3272623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3272626">return</span>&nbsp;<span class="ident" id="3272633">f</span><span class="op" id="3272634">.</span><span class="ident" id="3272635">base</span><br>
<span class="lineno">110</span><span class="op" id="3272640">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3272643">//&nbsp;Size&nbsp;returns&nbsp;the&nbsp;size&nbsp;of&nbsp;file&nbsp;f&nbsp;as&nbsp;registered&nbsp;with&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="keyword" id="3272706">func</span>&nbsp;<span class="op" id="3272711">(</span><span class="ident" id="3272712">f</span>&nbsp;<span class="op" id="3272714">*</span><span class="ident" id="3272715">File</span><span class="op" id="3272719">)</span>&nbsp;<span class="ident" id="3272721">Size</span><span class="op" id="3272725">(</span><span class="op" id="3272726">)</span>&nbsp;<span class="builtintype" id="3272728">int</span>&nbsp;<span class="op" id="3272732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3272735">return</span>&nbsp;<span class="ident" id="3272742">f</span><span class="op" id="3272743">.</span><span class="ident" id="3272744">size</span><br>
<span class="lineno">115</span><span class="op" id="3272749">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3272752">//&nbsp;LineCount&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;lines&nbsp;in&nbsp;file&nbsp;f.</span><br>
<span class="lineno"></span><span class="keyword" id="3272804">func</span>&nbsp;<span class="op" id="3272809">(</span><span class="ident" id="3272810">f</span>&nbsp;<span class="op" id="3272812">*</span><span class="ident" id="3272813">File</span><span class="op" id="3272817">)</span>&nbsp;<span class="ident" id="3272819">LineCount</span><span class="op" id="3272828">(</span><span class="op" id="3272829">)</span>&nbsp;<span class="builtintype" id="3272831">int</span>&nbsp;<span class="op" id="3272835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3272838">f</span><span class="op" id="3272839">.</span><span class="ident" id="3272840">set</span><span class="op" id="3272843">.</span><span class="ident" id="3272844">mutex</span><span class="op" id="3272849">.</span><span class="ident" id="3272850">RLock</span><span class="op" id="3272855">(</span><span class="op" id="3272856">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3272859">n</span>&nbsp;<span class="op" id="3272861">:=</span>&nbsp;<span class="builtinfunc" id="3272864">len</span><span class="op" id="3272867">(</span><span class="ident" id="3272868">f</span><span class="op" id="3272869">.</span><span class="ident" id="3272870">lines</span><span class="op" id="3272875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3272878">f</span><span class="op" id="3272879">.</span><span class="ident" id="3272880">set</span><span class="op" id="3272883">.</span><span class="ident" id="3272884">mutex</span><span class="op" id="3272889">.</span><span class="ident" id="3272890">RUnlock</span><span class="op" id="3272897">(</span><span class="op" id="3272898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3272901">return</span>&nbsp;<span class="ident" id="3272908">n</span><br>
<span class="lineno"></span><span class="op" id="3272910">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="3272913">//&nbsp;AddLine&nbsp;adds&nbsp;the&nbsp;line&nbsp;offset&nbsp;for&nbsp;a&nbsp;new&nbsp;line.</span><br>
<span class="lineno"></span><span class="comment" id="3272961">//&nbsp;The&nbsp;line&nbsp;offset&nbsp;must&nbsp;be&nbsp;larger&nbsp;than&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="3273033">//&nbsp;and&nbsp;smaller&nbsp;than&nbsp;the&nbsp;file&nbsp;size;&nbsp;otherwise&nbsp;the&nbsp;line&nbsp;offset&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="3273106">//</span><br>
<span class="lineno"></span><span class="keyword" id="3273109">func</span>&nbsp;<span class="op" id="3273114">(</span><span class="ident" id="3273115">f</span>&nbsp;<span class="op" id="3273117">*</span><span class="ident" id="3273118">File</span><span class="op" id="3273122">)</span>&nbsp;<span class="ident" id="3273124">AddLine</span><span class="op" id="3273131">(</span><span class="ident" id="3273132">offset</span>&nbsp;<span class="builtintype" id="3273139">int</span><span class="op" id="3273142">)</span>&nbsp;<span class="op" id="3273144">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3273147">f</span><span class="op" id="3273148">.</span><span class="ident" id="3273149">set</span><span class="op" id="3273152">.</span><span class="ident" id="3273153">mutex</span><span class="op" id="3273158">.</span><span class="ident" id="3273159">Lock</span><span class="op" id="3273163">(</span><span class="op" id="3273164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3273167">if</span>&nbsp;<span class="ident" id="3273170">i</span>&nbsp;<span class="op" id="3273172">:=</span>&nbsp;<span class="builtinfunc" id="3273175">len</span><span class="op" id="3273178">(</span><span class="ident" id="3273179">f</span><span class="op" id="3273180">.</span><span class="ident" id="3273181">lines</span><span class="op" id="3273186">)</span><span class="op" id="3273187">;</span>&nbsp;<span class="op" id="3273189">(</span><span class="ident" id="3273190">i</span>&nbsp;<span class="op" id="3273192">==</span>&nbsp;<span class="num" id="3273195">0</span>&nbsp;<span class="op" id="3273197">||</span>&nbsp;<span class="ident" id="3273200">f</span><span class="op" id="3273201">.</span><span class="ident" id="3273202">lines</span><span class="op" id="3273207">[</span><span class="ident" id="3273208">i</span><span class="op" id="3273209">-</span><span class="num" id="3273210">1</span><span class="op" id="3273211">]</span>&nbsp;<span class="op" id="3273213">&lt;</span>&nbsp;<span class="ident" id="3273215">offset</span><span class="op" id="3273221">)</span>&nbsp;<span class="op" id="3273223">&amp;&amp;</span>&nbsp;<span class="ident" id="3273226">offset</span>&nbsp;<span class="op" id="3273233">&lt;</span>&nbsp;<span class="ident" id="3273235">f</span><span class="op" id="3273236">.</span><span class="ident" id="3273237">size</span>&nbsp;<span class="op" id="3273242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3273246">f</span><span class="op" id="3273247">.</span><span class="ident" id="3273248">lines</span>&nbsp;<span class="op" id="3273254">=</span>&nbsp;<span class="builtinfunc" id="3273256">append</span><span class="op" id="3273262">(</span><span class="ident" id="3273263">f</span><span class="op" id="3273264">.</span><span class="ident" id="3273265">lines</span><span class="op" id="3273270">,</span>&nbsp;<span class="ident" id="3273272">offset</span><span class="op" id="3273278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3273281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3273284">f</span><span class="op" id="3273285">.</span><span class="ident" id="3273286">set</span><span class="op" id="3273289">.</span><span class="ident" id="3273290">mutex</span><span class="op" id="3273295">.</span><span class="ident" id="3273296">Unlock</span><span class="op" id="3273302">(</span><span class="op" id="3273303">)</span><br>
<span class="lineno">135</span><span class="op" id="3273305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3273308">//&nbsp;MergeLine&nbsp;merges&nbsp;a&nbsp;line&nbsp;with&nbsp;the&nbsp;following&nbsp;line.&nbsp;It&nbsp;is&nbsp;akin&nbsp;to&nbsp;replacing</span><br>
<span class="lineno"></span><span class="comment" id="3273384">//&nbsp;the&nbsp;newline&nbsp;character&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;line&nbsp;with&nbsp;a&nbsp;space&nbsp;(to&nbsp;not&nbsp;change&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3273464">//&nbsp;remaining&nbsp;offsets).&nbsp;To&nbsp;obtain&nbsp;the&nbsp;line&nbsp;number,&nbsp;consult&nbsp;e.g.&nbsp;Position.Line.</span><br>
<span class="lineno">140</span><span class="comment" id="3273542">//&nbsp;MergeLine&nbsp;will&nbsp;panic&nbsp;if&nbsp;given&nbsp;an&nbsp;invalid&nbsp;line&nbsp;number.</span><br>
<span class="lineno"></span><span class="comment" id="3273599">//</span><br>
<span class="lineno"></span><span class="keyword" id="3273602">func</span>&nbsp;<span class="op" id="3273607">(</span><span class="ident" id="3273608">f</span>&nbsp;<span class="op" id="3273610">*</span><span class="ident" id="3273611">File</span><span class="op" id="3273615">)</span>&nbsp;<span class="ident" id="3273617">MergeLine</span><span class="op" id="3273626">(</span><span class="ident" id="3273627">line</span>&nbsp;<span class="builtintype" id="3273632">int</span><span class="op" id="3273635">)</span>&nbsp;<span class="op" id="3273637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3273640">if</span>&nbsp;<span class="ident" id="3273643">line</span>&nbsp;<span class="op" id="3273648">&lt;=</span>&nbsp;<span class="num" id="3273651">0</span>&nbsp;<span class="op" id="3273653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3273657">panic</span><span class="op" id="3273662">(</span><span class="string" id="3273663">&#34;illegal&nbsp;line&nbsp;number&nbsp;(line&nbsp;numbering&nbsp;starts&nbsp;at&nbsp;1)&#34;</span><span class="op" id="3273713">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3273716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3273719">f</span><span class="op" id="3273720">.</span><span class="ident" id="3273721">set</span><span class="op" id="3273724">.</span><span class="ident" id="3273725">mutex</span><span class="op" id="3273730">.</span><span class="ident" id="3273731">Lock</span><span class="op" id="3273735">(</span><span class="op" id="3273736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3273739">defer</span>&nbsp;<span class="ident" id="3273745">f</span><span class="op" id="3273746">.</span><span class="ident" id="3273747">set</span><span class="op" id="3273750">.</span><span class="ident" id="3273751">mutex</span><span class="op" id="3273756">.</span><span class="ident" id="3273757">Unlock</span><span class="op" id="3273763">(</span><span class="op" id="3273764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3273767">if</span>&nbsp;<span class="ident" id="3273770">line</span>&nbsp;<span class="op" id="3273775">&gt;=</span>&nbsp;<span class="builtinfunc" id="3273778">len</span><span class="op" id="3273781">(</span><span class="ident" id="3273782">f</span><span class="op" id="3273783">.</span><span class="ident" id="3273784">lines</span><span class="op" id="3273789">)</span>&nbsp;<span class="op" id="3273791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3273795">panic</span><span class="op" id="3273800">(</span><span class="string" id="3273801">&#34;illegal&nbsp;line&nbsp;number&#34;</span><span class="op" id="3273822">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3273825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3273828">//&nbsp;To&nbsp;merge&nbsp;the&nbsp;line&nbsp;numbered&nbsp;&lt;line&gt;&nbsp;with&nbsp;the&nbsp;line&nbsp;numbered&nbsp;&lt;line+1&gt;,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3273899">//&nbsp;we&nbsp;need&nbsp;to&nbsp;remove&nbsp;the&nbsp;entry&nbsp;in&nbsp;lines&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3273966">//&nbsp;numbered&nbsp;&lt;line+1&gt;.&nbsp;The&nbsp;entry&nbsp;in&nbsp;lines&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3274034">//&nbsp;numbered&nbsp;&lt;line+1&gt;&nbsp;is&nbsp;located&nbsp;at&nbsp;index&nbsp;&lt;line&gt;,&nbsp;since&nbsp;indices&nbsp;in&nbsp;lines</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3274107">//&nbsp;are&nbsp;0-based&nbsp;and&nbsp;line&nbsp;numbers&nbsp;are&nbsp;1-based.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3274153">copy</span><span class="op" id="3274157">(</span><span class="ident" id="3274158">f</span><span class="op" id="3274159">.</span><span class="ident" id="3274160">lines</span><span class="op" id="3274165">[</span><span class="ident" id="3274166">line</span><span class="op" id="3274170">:</span><span class="op" id="3274171">]</span><span class="op" id="3274172">,</span>&nbsp;<span class="ident" id="3274174">f</span><span class="op" id="3274175">.</span><span class="ident" id="3274176">lines</span><span class="op" id="3274181">[</span><span class="ident" id="3274182">line</span><span class="op" id="3274186">+</span><span class="num" id="3274187">1</span><span class="op" id="3274188">:</span><span class="op" id="3274189">]</span><span class="op" id="3274190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3274193">f</span><span class="op" id="3274194">.</span><span class="ident" id="3274195">lines</span>&nbsp;<span class="op" id="3274201">=</span>&nbsp;<span class="ident" id="3274203">f</span><span class="op" id="3274204">.</span><span class="ident" id="3274205">lines</span><span class="op" id="3274210">[</span><span class="op" id="3274211">:</span><span class="builtinfunc" id="3274212">len</span><span class="op" id="3274215">(</span><span class="ident" id="3274216">f</span><span class="op" id="3274217">.</span><span class="ident" id="3274218">lines</span><span class="op" id="3274223">)</span><span class="op" id="3274224">-</span><span class="num" id="3274225">1</span><span class="op" id="3274226">]</span><br>
<span class="lineno"></span><span class="op" id="3274228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="3274231">//&nbsp;SetLines&nbsp;sets&nbsp;the&nbsp;line&nbsp;offsets&nbsp;for&nbsp;a&nbsp;file&nbsp;and&nbsp;returns&nbsp;true&nbsp;if&nbsp;successful.</span><br>
<span class="lineno"></span><span class="comment" id="3274308">//&nbsp;The&nbsp;line&nbsp;offsets&nbsp;are&nbsp;the&nbsp;offsets&nbsp;of&nbsp;the&nbsp;first&nbsp;character&nbsp;of&nbsp;each&nbsp;line;</span><br>
<span class="lineno"></span><span class="comment" id="3274381">//&nbsp;for&nbsp;instance&nbsp;for&nbsp;the&nbsp;content&nbsp;&#34;ab\nc\n&#34;&nbsp;the&nbsp;line&nbsp;offsets&nbsp;are&nbsp;{0,&nbsp;3}.</span><br>
<span class="lineno"></span><span class="comment" id="3274452">//&nbsp;An&nbsp;empty&nbsp;file&nbsp;has&nbsp;an&nbsp;empty&nbsp;line&nbsp;offset&nbsp;table.</span><br>
<span class="lineno"></span><span class="comment" id="3274501">//&nbsp;Each&nbsp;line&nbsp;offset&nbsp;must&nbsp;be&nbsp;larger&nbsp;than&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno">165</span><span class="comment" id="3274574">//&nbsp;and&nbsp;smaller&nbsp;than&nbsp;the&nbsp;file&nbsp;size;&nbsp;otherwise&nbsp;SetLines&nbsp;fails&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3274646">//&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="3274656">//</span><br>
<span class="lineno"></span><span class="keyword" id="3274659">func</span>&nbsp;<span class="op" id="3274664">(</span><span class="ident" id="3274665">f</span>&nbsp;<span class="op" id="3274667">*</span><span class="ident" id="3274668">File</span><span class="op" id="3274672">)</span>&nbsp;<span class="ident" id="3274674">SetLines</span><span class="op" id="3274682">(</span><span class="ident" id="3274683">lines</span>&nbsp;<span class="op" id="3274689">[</span><span class="op" id="3274690">]</span><span class="builtintype" id="3274691">int</span><span class="op" id="3274694">)</span>&nbsp;<span class="builtintype" id="3274696">bool</span>&nbsp;<span class="op" id="3274701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3274704">//&nbsp;verify&nbsp;validity&nbsp;of&nbsp;lines&nbsp;table</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3274739">size</span>&nbsp;<span class="op" id="3274744">:=</span>&nbsp;<span class="ident" id="3274747">f</span><span class="op" id="3274748">.</span><span class="ident" id="3274749">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3274755">for</span>&nbsp;<span class="ident" id="3274759">i</span><span class="op" id="3274760">,</span>&nbsp;<span class="ident" id="3274762">offset</span>&nbsp;<span class="op" id="3274769">:=</span>&nbsp;<span class="keyword" id="3274772">range</span>&nbsp;<span class="ident" id="3274778">lines</span>&nbsp;<span class="op" id="3274784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3274788">if</span>&nbsp;<span class="ident" id="3274791">i</span>&nbsp;<span class="op" id="3274793">&gt;</span>&nbsp;<span class="num" id="3274795">0</span>&nbsp;<span class="op" id="3274797">&amp;&amp;</span>&nbsp;<span class="ident" id="3274800">offset</span>&nbsp;<span class="op" id="3274807">&lt;=</span>&nbsp;<span class="ident" id="3274810">lines</span><span class="op" id="3274815">[</span><span class="ident" id="3274816">i</span><span class="op" id="3274817">-</span><span class="num" id="3274818">1</span><span class="op" id="3274819">]</span>&nbsp;<span class="op" id="3274821">||</span>&nbsp;<span class="ident" id="3274824">size</span>&nbsp;<span class="op" id="3274829">&lt;=</span>&nbsp;<span class="ident" id="3274832">offset</span>&nbsp;<span class="op" id="3274839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3274844">return</span>&nbsp;<span class="builtintype" id="3274851">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3274859">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3274862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3274866">//&nbsp;set&nbsp;lines&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3274886">f</span><span class="op" id="3274887">.</span><span class="ident" id="3274888">set</span><span class="op" id="3274891">.</span><span class="ident" id="3274892">mutex</span><span class="op" id="3274897">.</span><span class="ident" id="3274898">Lock</span><span class="op" id="3274902">(</span><span class="op" id="3274903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3274906">f</span><span class="op" id="3274907">.</span><span class="ident" id="3274908">lines</span>&nbsp;<span class="op" id="3274914">=</span>&nbsp;<span class="ident" id="3274916">lines</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3274923">f</span><span class="op" id="3274924">.</span><span class="ident" id="3274925">set</span><span class="op" id="3274928">.</span><span class="ident" id="3274929">mutex</span><span class="op" id="3274934">.</span><span class="ident" id="3274935">Unlock</span><span class="op" id="3274941">(</span><span class="op" id="3274942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3274945">return</span>&nbsp;<span class="builtintype" id="3274952">true</span><br>
<span class="lineno"></span><span class="op" id="3274957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3274960">//&nbsp;SetLinesForContent&nbsp;sets&nbsp;the&nbsp;line&nbsp;offsets&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;content.</span><br>
<span class="lineno">185</span><span class="comment" id="3275032">//&nbsp;It&nbsp;ignores&nbsp;position-altering&nbsp;//line&nbsp;comments.</span><br>
<span class="lineno"></span><span class="keyword" id="3275081">func</span>&nbsp;<span class="op" id="3275086">(</span><span class="ident" id="3275087">f</span>&nbsp;<span class="op" id="3275089">*</span><span class="ident" id="3275090">File</span><span class="op" id="3275094">)</span>&nbsp;<span class="ident" id="3275096">SetLinesForContent</span><span class="op" id="3275114">(</span><span class="ident" id="3275115">content</span>&nbsp;<span class="op" id="3275123">[</span><span class="op" id="3275124">]</span><span class="builtintype" id="3275125">byte</span><span class="op" id="3275129">)</span>&nbsp;<span class="op" id="3275131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3275134">var</span>&nbsp;<span class="ident" id="3275138">lines</span>&nbsp;<span class="op" id="3275144">[</span><span class="op" id="3275145">]</span><span class="builtintype" id="3275146">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3275151">line</span>&nbsp;<span class="op" id="3275156">:=</span>&nbsp;<span class="num" id="3275159">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3275162">for</span>&nbsp;<span class="ident" id="3275166">offset</span><span class="op" id="3275172">,</span>&nbsp;<span class="ident" id="3275174">b</span>&nbsp;<span class="op" id="3275176">:=</span>&nbsp;<span class="keyword" id="3275179">range</span>&nbsp;<span class="ident" id="3275185">content</span>&nbsp;<span class="op" id="3275193">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3275197">if</span>&nbsp;<span class="ident" id="3275200">line</span>&nbsp;<span class="op" id="3275205">&gt;=</span>&nbsp;<span class="num" id="3275208">0</span>&nbsp;<span class="op" id="3275210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3275215">lines</span>&nbsp;<span class="op" id="3275221">=</span>&nbsp;<span class="builtinfunc" id="3275223">append</span><span class="op" id="3275229">(</span><span class="ident" id="3275230">lines</span><span class="op" id="3275235">,</span>&nbsp;<span class="ident" id="3275237">line</span><span class="op" id="3275241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3275245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3275249">line</span>&nbsp;<span class="op" id="3275254">=</span>&nbsp;<span class="op" id="3275256">-</span><span class="num" id="3275257">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3275261">if</span>&nbsp;<span class="ident" id="3275264">b</span>&nbsp;<span class="op" id="3275266">==</span>&nbsp;<span class="string" id="3275269">&#39;\n&#39;</span>&nbsp;<span class="op" id="3275274">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3275279">line</span>&nbsp;<span class="op" id="3275284">=</span>&nbsp;<span class="ident" id="3275286">offset</span>&nbsp;<span class="op" id="3275293">+</span>&nbsp;<span class="num" id="3275295">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3275299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3275302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3275306">//&nbsp;set&nbsp;lines&nbsp;table</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3275326">f</span><span class="op" id="3275327">.</span><span class="ident" id="3275328">set</span><span class="op" id="3275331">.</span><span class="ident" id="3275332">mutex</span><span class="op" id="3275337">.</span><span class="ident" id="3275338">Lock</span><span class="op" id="3275342">(</span><span class="op" id="3275343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3275346">f</span><span class="op" id="3275347">.</span><span class="ident" id="3275348">lines</span>&nbsp;<span class="op" id="3275354">=</span>&nbsp;<span class="ident" id="3275356">lines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3275363">f</span><span class="op" id="3275364">.</span><span class="ident" id="3275365">set</span><span class="op" id="3275368">.</span><span class="ident" id="3275369">mutex</span><span class="op" id="3275374">.</span><span class="ident" id="3275375">Unlock</span><span class="op" id="3275381">(</span><span class="op" id="3275382">)</span><br>
<span class="lineno"></span><span class="op" id="3275384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="3275387">//&nbsp;A&nbsp;lineInfo&nbsp;object&nbsp;describes&nbsp;alternative&nbsp;file&nbsp;and&nbsp;line&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="3275451">//&nbsp;information&nbsp;(such&nbsp;as&nbsp;provided&nbsp;via&nbsp;a&nbsp;//line&nbsp;comment&nbsp;in&nbsp;a&nbsp;.go</span><br>
<span class="lineno"></span><span class="comment" id="3275514">//&nbsp;file)&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="3275548">type</span>&nbsp;<span class="ident" id="3275553">lineInfo</span>&nbsp;<span class="keyword" id="3275562">struct</span>&nbsp;<span class="op" id="3275569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3275572">//&nbsp;fields&nbsp;are&nbsp;exported&nbsp;to&nbsp;make&nbsp;them&nbsp;accessible&nbsp;to&nbsp;gob</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3275627">Offset</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3275636">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3275641">Filename</span>&nbsp;<span class="builtintype" id="3275650">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3275658">Line</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3275667">int</span><br>
<span class="lineno"></span><span class="op" id="3275671">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="3275674">//&nbsp;AddLineInfo&nbsp;adds&nbsp;alternative&nbsp;file&nbsp;and&nbsp;line&nbsp;number&nbsp;information&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="3275743">//&nbsp;a&nbsp;given&nbsp;file&nbsp;offset.&nbsp;The&nbsp;offset&nbsp;must&nbsp;be&nbsp;larger&nbsp;than&nbsp;the&nbsp;offset&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="3275813">//&nbsp;the&nbsp;previously&nbsp;added&nbsp;alternative&nbsp;line&nbsp;info&nbsp;and&nbsp;smaller&nbsp;than&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3275880">//&nbsp;file&nbsp;size;&nbsp;otherwise&nbsp;the&nbsp;information&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="3275932">//</span><br>
<span class="lineno">220</span><span class="comment" id="3275935">//&nbsp;AddLineInfo&nbsp;is&nbsp;typically&nbsp;used&nbsp;to&nbsp;register&nbsp;alternative&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="3276001">//&nbsp;information&nbsp;for&nbsp;//line&nbsp;filename:line&nbsp;comments&nbsp;in&nbsp;source&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="3276067">//</span><br>
<span class="lineno"></span><span class="keyword" id="3276070">func</span>&nbsp;<span class="op" id="3276075">(</span><span class="ident" id="3276076">f</span>&nbsp;<span class="op" id="3276078">*</span><span class="ident" id="3276079">File</span><span class="op" id="3276083">)</span>&nbsp;<span class="ident" id="3276085">AddLineInfo</span><span class="op" id="3276096">(</span><span class="ident" id="3276097">offset</span>&nbsp;<span class="builtintype" id="3276104">int</span><span class="op" id="3276107">,</span>&nbsp;<span class="ident" id="3276109">filename</span>&nbsp;<span class="builtintype" id="3276118">string</span><span class="op" id="3276124">,</span>&nbsp;<span class="ident" id="3276126">line</span>&nbsp;<span class="builtintype" id="3276131">int</span><span class="op" id="3276134">)</span>&nbsp;<span class="op" id="3276136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3276139">f</span><span class="op" id="3276140">.</span><span class="ident" id="3276141">set</span><span class="op" id="3276144">.</span><span class="ident" id="3276145">mutex</span><span class="op" id="3276150">.</span><span class="ident" id="3276151">Lock</span><span class="op" id="3276155">(</span><span class="op" id="3276156">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3276159">if</span>&nbsp;<span class="ident" id="3276162">i</span>&nbsp;<span class="op" id="3276164">:=</span>&nbsp;<span class="builtinfunc" id="3276167">len</span><span class="op" id="3276170">(</span><span class="ident" id="3276171">f</span><span class="op" id="3276172">.</span><span class="ident" id="3276173">infos</span><span class="op" id="3276178">)</span><span class="op" id="3276179">;</span>&nbsp;<span class="ident" id="3276181">i</span>&nbsp;<span class="op" id="3276183">==</span>&nbsp;<span class="num" id="3276186">0</span>&nbsp;<span class="op" id="3276188">||</span>&nbsp;<span class="ident" id="3276191">f</span><span class="op" id="3276192">.</span><span class="ident" id="3276193">infos</span><span class="op" id="3276198">[</span><span class="ident" id="3276199">i</span><span class="op" id="3276200">-</span><span class="num" id="3276201">1</span><span class="op" id="3276202">]</span><span class="op" id="3276203">.</span><span class="ident" id="3276204">Offset</span>&nbsp;<span class="op" id="3276211">&lt;</span>&nbsp;<span class="ident" id="3276213">offset</span>&nbsp;<span class="op" id="3276220">&amp;&amp;</span>&nbsp;<span class="ident" id="3276223">offset</span>&nbsp;<span class="op" id="3276230">&lt;</span>&nbsp;<span class="ident" id="3276232">f</span><span class="op" id="3276233">.</span><span class="ident" id="3276234">size</span>&nbsp;<span class="op" id="3276239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3276243">f</span><span class="op" id="3276244">.</span><span class="ident" id="3276245">infos</span>&nbsp;<span class="op" id="3276251">=</span>&nbsp;<span class="builtinfunc" id="3276253">append</span><span class="op" id="3276259">(</span><span class="ident" id="3276260">f</span><span class="op" id="3276261">.</span><span class="ident" id="3276262">infos</span><span class="op" id="3276267">,</span>&nbsp;<span class="ident" id="3276269">lineInfo</span><span class="op" id="3276277">{</span><span class="ident" id="3276278">offset</span><span class="op" id="3276284">,</span>&nbsp;<span class="ident" id="3276286">filename</span><span class="op" id="3276294">,</span>&nbsp;<span class="ident" id="3276296">line</span><span class="op" id="3276300">}</span><span class="op" id="3276301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3276304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3276307">f</span><span class="op" id="3276308">.</span><span class="ident" id="3276309">set</span><span class="op" id="3276312">.</span><span class="ident" id="3276313">mutex</span><span class="op" id="3276318">.</span><span class="ident" id="3276319">Unlock</span><span class="op" id="3276325">(</span><span class="op" id="3276326">)</span><br>
<span class="lineno"></span><span class="op" id="3276328">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="3276331">//&nbsp;Pos&nbsp;returns&nbsp;the&nbsp;Pos&nbsp;value&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;offset;</span><br>
<span class="lineno"></span><span class="comment" id="3276387">//&nbsp;the&nbsp;offset&nbsp;must&nbsp;be&nbsp;&lt;=&nbsp;f.Size().</span><br>
<span class="lineno"></span><span class="comment" id="3276422">//&nbsp;f.Pos(f.Offset(p))&nbsp;==&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="3276450">//</span><br>
<span class="lineno">235</span><span class="keyword" id="3276453">func</span>&nbsp;<span class="op" id="3276458">(</span><span class="ident" id="3276459">f</span>&nbsp;<span class="op" id="3276461">*</span><span class="ident" id="3276462">File</span><span class="op" id="3276466">)</span>&nbsp;<span class="ident" id="3276468">Pos</span><span class="op" id="3276471">(</span><span class="ident" id="3276472">offset</span>&nbsp;<span class="builtintype" id="3276479">int</span><span class="op" id="3276482">)</span>&nbsp;<span class="ident" id="3276484">Pos</span>&nbsp;<span class="op" id="3276488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3276491">if</span>&nbsp;<span class="ident" id="3276494">offset</span>&nbsp;<span class="op" id="3276501">&gt;</span>&nbsp;<span class="ident" id="3276503">f</span><span class="op" id="3276504">.</span><span class="ident" id="3276505">size</span>&nbsp;<span class="op" id="3276510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3276514">panic</span><span class="op" id="3276519">(</span><span class="string" id="3276520">&#34;illegal&nbsp;file&nbsp;offset&#34;</span><span class="op" id="3276541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3276544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3276547">return</span>&nbsp;<span class="ident" id="3276554">Pos</span><span class="op" id="3276557">(</span><span class="ident" id="3276558">f</span><span class="op" id="3276559">.</span><span class="ident" id="3276560">base</span>&nbsp;<span class="op" id="3276565">+</span>&nbsp;<span class="ident" id="3276567">offset</span><span class="op" id="3276573">)</span><br>
<span class="lineno">240</span><span class="op" id="3276575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3276578">//&nbsp;Offset&nbsp;returns&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p;</span><br>
<span class="lineno"></span><span class="comment" id="3276638">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;valid&nbsp;Pos&nbsp;value&nbsp;in&nbsp;that&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="3276683">//&nbsp;f.Offset(f.Pos(offset))&nbsp;==&nbsp;offset.</span><br>
<span class="lineno">245</span><span class="comment" id="3276721">//</span><br>
<span class="lineno"></span><span class="keyword" id="3276724">func</span>&nbsp;<span class="op" id="3276729">(</span><span class="ident" id="3276730">f</span>&nbsp;<span class="op" id="3276732">*</span><span class="ident" id="3276733">File</span><span class="op" id="3276737">)</span>&nbsp;<span class="ident" id="3276739">Offset</span><span class="op" id="3276745">(</span><span class="ident" id="3276746">p</span>&nbsp;<span class="ident" id="3276748">Pos</span><span class="op" id="3276751">)</span>&nbsp;<span class="builtintype" id="3276753">int</span>&nbsp;<span class="op" id="3276757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3276760">if</span>&nbsp;<span class="builtintype" id="3276763">int</span><span class="op" id="3276766">(</span><span class="ident" id="3276767">p</span><span class="op" id="3276768">)</span>&nbsp;<span class="op" id="3276770">&lt;</span>&nbsp;<span class="ident" id="3276772">f</span><span class="op" id="3276773">.</span><span class="ident" id="3276774">base</span>&nbsp;<span class="op" id="3276779">||</span>&nbsp;<span class="builtintype" id="3276782">int</span><span class="op" id="3276785">(</span><span class="ident" id="3276786">p</span><span class="op" id="3276787">)</span>&nbsp;<span class="op" id="3276789">&gt;</span>&nbsp;<span class="ident" id="3276791">f</span><span class="op" id="3276792">.</span><span class="ident" id="3276793">base</span><span class="op" id="3276797">+</span><span class="ident" id="3276798">f</span><span class="op" id="3276799">.</span><span class="ident" id="3276800">size</span>&nbsp;<span class="op" id="3276805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3276809">panic</span><span class="op" id="3276814">(</span><span class="string" id="3276815">&#34;illegal&nbsp;Pos&nbsp;value&#34;</span><span class="op" id="3276834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3276837">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3276840">return</span>&nbsp;<span class="builtintype" id="3276847">int</span><span class="op" id="3276850">(</span><span class="ident" id="3276851">p</span><span class="op" id="3276852">)</span>&nbsp;<span class="op" id="3276854">-</span>&nbsp;<span class="ident" id="3276856">f</span><span class="op" id="3276857">.</span><span class="ident" id="3276858">base</span><br>
<span class="lineno"></span><span class="op" id="3276863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3276866">//&nbsp;Line&nbsp;returns&nbsp;the&nbsp;line&nbsp;number&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p;</span><br>
<span class="lineno"></span><span class="comment" id="3276929">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;Pos&nbsp;value&nbsp;in&nbsp;that&nbsp;file&nbsp;or&nbsp;NoPos.</span><br>
<span class="lineno">255</span><span class="comment" id="3276977">//</span><br>
<span class="lineno"></span><span class="keyword" id="3276980">func</span>&nbsp;<span class="op" id="3276985">(</span><span class="ident" id="3276986">f</span>&nbsp;<span class="op" id="3276988">*</span><span class="ident" id="3276989">File</span><span class="op" id="3276993">)</span>&nbsp;<span class="ident" id="3276995">Line</span><span class="op" id="3276999">(</span><span class="ident" id="3277000">p</span>&nbsp;<span class="ident" id="3277002">Pos</span><span class="op" id="3277005">)</span>&nbsp;<span class="builtintype" id="3277007">int</span>&nbsp;<span class="op" id="3277011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3277014">return</span>&nbsp;<span class="ident" id="3277021">f</span><span class="op" id="3277022">.</span><span class="ident" id="3277023">Position</span><span class="op" id="3277031">(</span><span class="ident" id="3277032">p</span><span class="op" id="3277033">)</span><span class="op" id="3277034">.</span><span class="ident" id="3277035">Line</span><br>
<span class="lineno"></span><span class="op" id="3277040">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="keyword" id="3277043">func</span>&nbsp;<span class="ident" id="3277048">searchLineInfos</span><span class="op" id="3277063">(</span><span class="ident" id="3277064">a</span>&nbsp;<span class="op" id="3277066">[</span><span class="op" id="3277067">]</span><span class="ident" id="3277068">lineInfo</span><span class="op" id="3277076">,</span>&nbsp;<span class="ident" id="3277078">x</span>&nbsp;<span class="builtintype" id="3277080">int</span><span class="op" id="3277083">)</span>&nbsp;<span class="builtintype" id="3277085">int</span>&nbsp;<span class="op" id="3277089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3277092">return</span>&nbsp;<span class="ident" id="3277099">sort</span><span class="op" id="3277103">.</span><span class="ident" id="3277104">Search</span><span class="op" id="3277110">(</span><span class="builtinfunc" id="3277111">len</span><span class="op" id="3277114">(</span><span class="ident" id="3277115">a</span><span class="op" id="3277116">)</span><span class="op" id="3277117">,</span>&nbsp;<span class="keyword" id="3277119">func</span><span class="op" id="3277123">(</span><span class="ident" id="3277124">i</span>&nbsp;<span class="builtintype" id="3277126">int</span><span class="op" id="3277129">)</span>&nbsp;<span class="builtintype" id="3277131">bool</span>&nbsp;<span class="op" id="3277136">{</span>&nbsp;<span class="keyword" id="3277138">return</span>&nbsp;<span class="ident" id="3277145">a</span><span class="op" id="3277146">[</span><span class="ident" id="3277147">i</span><span class="op" id="3277148">]</span><span class="op" id="3277149">.</span><span class="ident" id="3277150">Offset</span>&nbsp;<span class="op" id="3277157">&gt;</span>&nbsp;<span class="ident" id="3277159">x</span>&nbsp;<span class="op" id="3277161">}</span><span class="op" id="3277162">)</span>&nbsp;<span class="op" id="3277164">-</span>&nbsp;<span class="num" id="3277166">1</span><br>
<span class="lineno"></span><span class="op" id="3277168">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3277171">//&nbsp;unpack&nbsp;returns&nbsp;the&nbsp;filename&nbsp;and&nbsp;line&nbsp;and&nbsp;column&nbsp;number&nbsp;for&nbsp;a&nbsp;file&nbsp;offset.</span><br>
<span class="lineno">265</span><span class="comment" id="3277248">//&nbsp;If&nbsp;adjusted&nbsp;is&nbsp;set,&nbsp;unpack&nbsp;will&nbsp;return&nbsp;the&nbsp;filename&nbsp;and&nbsp;line&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="3277324">//&nbsp;possibly&nbsp;adjusted&nbsp;by&nbsp;//line&nbsp;comments;&nbsp;otherwise&nbsp;those&nbsp;comments&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="3277403">//</span><br>
<span class="lineno"></span><span class="keyword" id="3277406">func</span>&nbsp;<span class="op" id="3277411">(</span><span class="ident" id="3277412">f</span>&nbsp;<span class="op" id="3277414">*</span><span class="ident" id="3277415">File</span><span class="op" id="3277419">)</span>&nbsp;<span class="ident" id="3277421">unpack</span><span class="op" id="3277427">(</span><span class="ident" id="3277428">offset</span>&nbsp;<span class="builtintype" id="3277435">int</span><span class="op" id="3277438">,</span>&nbsp;<span class="ident" id="3277440">adjusted</span>&nbsp;<span class="builtintype" id="3277449">bool</span><span class="op" id="3277453">)</span>&nbsp;<span class="op" id="3277455">(</span><span class="ident" id="3277456">filename</span>&nbsp;<span class="builtintype" id="3277465">string</span><span class="op" id="3277471">,</span>&nbsp;<span class="ident" id="3277473">line</span><span class="op" id="3277477">,</span>&nbsp;<span class="ident" id="3277479">column</span>&nbsp;<span class="builtintype" id="3277486">int</span><span class="op" id="3277489">)</span>&nbsp;<span class="op" id="3277491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3277494">filename</span>&nbsp;<span class="op" id="3277503">=</span>&nbsp;<span class="ident" id="3277505">f</span><span class="op" id="3277506">.</span><span class="ident" id="3277507">name</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3277513">if</span>&nbsp;<span class="ident" id="3277516">i</span>&nbsp;<span class="op" id="3277518">:=</span>&nbsp;<span class="ident" id="3277521">searchInts</span><span class="op" id="3277531">(</span><span class="ident" id="3277532">f</span><span class="op" id="3277533">.</span><span class="ident" id="3277534">lines</span><span class="op" id="3277539">,</span>&nbsp;<span class="ident" id="3277541">offset</span><span class="op" id="3277547">)</span><span class="op" id="3277548">;</span>&nbsp;<span class="ident" id="3277550">i</span>&nbsp;<span class="op" id="3277552">&gt;=</span>&nbsp;<span class="num" id="3277555">0</span>&nbsp;<span class="op" id="3277557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3277561">line</span><span class="op" id="3277565">,</span>&nbsp;<span class="ident" id="3277567">column</span>&nbsp;<span class="op" id="3277574">=</span>&nbsp;<span class="ident" id="3277576">i</span><span class="op" id="3277577">+</span><span class="num" id="3277578">1</span><span class="op" id="3277579">,</span>&nbsp;<span class="ident" id="3277581">offset</span><span class="op" id="3277587">-</span><span class="ident" id="3277588">f</span><span class="op" id="3277589">.</span><span class="ident" id="3277590">lines</span><span class="op" id="3277595">[</span><span class="ident" id="3277596">i</span><span class="op" id="3277597">]</span><span class="op" id="3277598">+</span><span class="num" id="3277599">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3277602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3277605">if</span>&nbsp;<span class="ident" id="3277608">adjusted</span>&nbsp;<span class="op" id="3277617">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3277620">len</span><span class="op" id="3277623">(</span><span class="ident" id="3277624">f</span><span class="op" id="3277625">.</span><span class="ident" id="3277626">infos</span><span class="op" id="3277631">)</span>&nbsp;<span class="op" id="3277633">&gt;</span>&nbsp;<span class="num" id="3277635">0</span>&nbsp;<span class="op" id="3277637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3277641">//&nbsp;almost&nbsp;no&nbsp;files&nbsp;have&nbsp;extra&nbsp;line&nbsp;infos</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3277684">if</span>&nbsp;<span class="ident" id="3277687">i</span>&nbsp;<span class="op" id="3277689">:=</span>&nbsp;<span class="ident" id="3277692">searchLineInfos</span><span class="op" id="3277707">(</span><span class="ident" id="3277708">f</span><span class="op" id="3277709">.</span><span class="ident" id="3277710">infos</span><span class="op" id="3277715">,</span>&nbsp;<span class="ident" id="3277717">offset</span><span class="op" id="3277723">)</span><span class="op" id="3277724">;</span>&nbsp;<span class="ident" id="3277726">i</span>&nbsp;<span class="op" id="3277728">&gt;=</span>&nbsp;<span class="num" id="3277731">0</span>&nbsp;<span class="op" id="3277733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3277738">alt</span>&nbsp;<span class="op" id="3277742">:=</span>&nbsp;<span class="op" id="3277745">&amp;</span><span class="ident" id="3277746">f</span><span class="op" id="3277747">.</span><span class="ident" id="3277748">infos</span><span class="op" id="3277753">[</span><span class="ident" id="3277754">i</span><span class="op" id="3277755">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3277760">filename</span>&nbsp;<span class="op" id="3277769">=</span>&nbsp;<span class="ident" id="3277771">alt</span><span class="op" id="3277774">.</span><span class="ident" id="3277775">Filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3277787">if</span>&nbsp;<span class="ident" id="3277790">i</span>&nbsp;<span class="op" id="3277792">:=</span>&nbsp;<span class="ident" id="3277795">searchInts</span><span class="op" id="3277805">(</span><span class="ident" id="3277806">f</span><span class="op" id="3277807">.</span><span class="ident" id="3277808">lines</span><span class="op" id="3277813">,</span>&nbsp;<span class="ident" id="3277815">alt</span><span class="op" id="3277818">.</span><span class="ident" id="3277819">Offset</span><span class="op" id="3277825">)</span><span class="op" id="3277826">;</span>&nbsp;<span class="ident" id="3277828">i</span>&nbsp;<span class="op" id="3277830">&gt;=</span>&nbsp;<span class="num" id="3277833">0</span>&nbsp;<span class="op" id="3277835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3277841">line</span>&nbsp;<span class="op" id="3277846">+=</span>&nbsp;<span class="ident" id="3277849">alt</span><span class="op" id="3277852">.</span><span class="ident" id="3277853">Line</span>&nbsp;<span class="op" id="3277858">-</span>&nbsp;<span class="ident" id="3277860">i</span>&nbsp;<span class="op" id="3277862">-</span>&nbsp;<span class="num" id="3277864">1</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3277869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3277873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3277876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3277879">return</span><br>
<span class="lineno"></span><span class="op" id="3277886">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="keyword" id="3277889">func</span>&nbsp;<span class="op" id="3277894">(</span><span class="ident" id="3277895">f</span>&nbsp;<span class="op" id="3277897">*</span><span class="ident" id="3277898">File</span><span class="op" id="3277902">)</span>&nbsp;<span class="ident" id="3277904">position</span><span class="op" id="3277912">(</span><span class="ident" id="3277913">p</span>&nbsp;<span class="ident" id="3277915">Pos</span><span class="op" id="3277918">,</span>&nbsp;<span class="ident" id="3277920">adjusted</span>&nbsp;<span class="builtintype" id="3277929">bool</span><span class="op" id="3277933">)</span>&nbsp;<span class="op" id="3277935">(</span><span class="ident" id="3277936">pos</span>&nbsp;<span class="ident" id="3277940">Position</span><span class="op" id="3277948">)</span>&nbsp;<span class="op" id="3277950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3277953">offset</span>&nbsp;<span class="op" id="3277960">:=</span>&nbsp;<span class="builtintype" id="3277963">int</span><span class="op" id="3277966">(</span><span class="ident" id="3277967">p</span><span class="op" id="3277968">)</span>&nbsp;<span class="op" id="3277970">-</span>&nbsp;<span class="ident" id="3277972">f</span><span class="op" id="3277973">.</span><span class="ident" id="3277974">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3277980">pos</span><span class="op" id="3277983">.</span><span class="ident" id="3277984">Offset</span>&nbsp;<span class="op" id="3277991">=</span>&nbsp;<span class="ident" id="3277993">offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3278001">pos</span><span class="op" id="3278004">.</span><span class="ident" id="3278005">Filename</span><span class="op" id="3278013">,</span>&nbsp;<span class="ident" id="3278015">pos</span><span class="op" id="3278018">.</span><span class="ident" id="3278019">Line</span><span class="op" id="3278023">,</span>&nbsp;<span class="ident" id="3278025">pos</span><span class="op" id="3278028">.</span><span class="ident" id="3278029">Column</span>&nbsp;<span class="op" id="3278036">=</span>&nbsp;<span class="ident" id="3278038">f</span><span class="op" id="3278039">.</span><span class="ident" id="3278040">unpack</span><span class="op" id="3278046">(</span><span class="ident" id="3278047">offset</span><span class="op" id="3278053">,</span>&nbsp;<span class="ident" id="3278055">adjusted</span><span class="op" id="3278063">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3278066">return</span><br>
<span class="lineno"></span><span class="op" id="3278073">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3278076">//&nbsp;PositionFor&nbsp;returns&nbsp;the&nbsp;Position&nbsp;value&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="3278149">//&nbsp;If&nbsp;adjusted&nbsp;is&nbsp;set,&nbsp;the&nbsp;position&nbsp;may&nbsp;be&nbsp;adjusted&nbsp;by&nbsp;position-altering</span><br>
<span class="lineno">295</span><span class="comment" id="3278222">//&nbsp;//line&nbsp;comments;&nbsp;otherwise&nbsp;those&nbsp;comments&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="3278280">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;Pos&nbsp;value&nbsp;in&nbsp;f&nbsp;or&nbsp;NoPos.</span><br>
<span class="lineno"></span><span class="comment" id="3278320">//</span><br>
<span class="lineno"></span><span class="keyword" id="3278323">func</span>&nbsp;<span class="op" id="3278328">(</span><span class="ident" id="3278329">f</span>&nbsp;<span class="op" id="3278331">*</span><span class="ident" id="3278332">File</span><span class="op" id="3278336">)</span>&nbsp;<span class="ident" id="3278338">PositionFor</span><span class="op" id="3278349">(</span><span class="ident" id="3278350">p</span>&nbsp;<span class="ident" id="3278352">Pos</span><span class="op" id="3278355">,</span>&nbsp;<span class="ident" id="3278357">adjusted</span>&nbsp;<span class="builtintype" id="3278366">bool</span><span class="op" id="3278370">)</span>&nbsp;<span class="op" id="3278372">(</span><span class="ident" id="3278373">pos</span>&nbsp;<span class="ident" id="3278377">Position</span><span class="op" id="3278385">)</span>&nbsp;<span class="op" id="3278387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3278390">if</span>&nbsp;<span class="ident" id="3278393">p</span>&nbsp;<span class="op" id="3278395">!=</span>&nbsp;<span class="ident" id="3278398">NoPos</span>&nbsp;<span class="op" id="3278404">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3278408">if</span>&nbsp;<span class="builtintype" id="3278411">int</span><span class="op" id="3278414">(</span><span class="ident" id="3278415">p</span><span class="op" id="3278416">)</span>&nbsp;<span class="op" id="3278418">&lt;</span>&nbsp;<span class="ident" id="3278420">f</span><span class="op" id="3278421">.</span><span class="ident" id="3278422">base</span>&nbsp;<span class="op" id="3278427">||</span>&nbsp;<span class="builtintype" id="3278430">int</span><span class="op" id="3278433">(</span><span class="ident" id="3278434">p</span><span class="op" id="3278435">)</span>&nbsp;<span class="op" id="3278437">&gt;</span>&nbsp;<span class="ident" id="3278439">f</span><span class="op" id="3278440">.</span><span class="ident" id="3278441">base</span><span class="op" id="3278445">+</span><span class="ident" id="3278446">f</span><span class="op" id="3278447">.</span><span class="ident" id="3278448">size</span>&nbsp;<span class="op" id="3278453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3278458">panic</span><span class="op" id="3278463">(</span><span class="string" id="3278464">&#34;illegal&nbsp;Pos&nbsp;value&#34;</span><span class="op" id="3278483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3278487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3278491">pos</span>&nbsp;<span class="op" id="3278495">=</span>&nbsp;<span class="ident" id="3278497">f</span><span class="op" id="3278498">.</span><span class="ident" id="3278499">position</span><span class="op" id="3278507">(</span><span class="ident" id="3278508">p</span><span class="op" id="3278509">,</span>&nbsp;<span class="ident" id="3278511">adjusted</span><span class="op" id="3278519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3278522">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3278525">return</span><br>
<span class="lineno"></span><span class="op" id="3278532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3278535">//&nbsp;Position&nbsp;returns&nbsp;the&nbsp;Position&nbsp;value&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="3278605">//&nbsp;Calling&nbsp;f.Position(p)&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;calling&nbsp;f.PositionFor(p,&nbsp;true).</span><br>
<span class="lineno">310</span><span class="comment" id="3278679">//</span><br>
<span class="lineno"></span><span class="keyword" id="3278682">func</span>&nbsp;<span class="op" id="3278687">(</span><span class="ident" id="3278688">f</span>&nbsp;<span class="op" id="3278690">*</span><span class="ident" id="3278691">File</span><span class="op" id="3278695">)</span>&nbsp;<span class="ident" id="3278697">Position</span><span class="op" id="3278705">(</span><span class="ident" id="3278706">p</span>&nbsp;<span class="ident" id="3278708">Pos</span><span class="op" id="3278711">)</span>&nbsp;<span class="op" id="3278713">(</span><span class="ident" id="3278714">pos</span>&nbsp;<span class="ident" id="3278718">Position</span><span class="op" id="3278726">)</span>&nbsp;<span class="op" id="3278728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3278731">return</span>&nbsp;<span class="ident" id="3278738">f</span><span class="op" id="3278739">.</span><span class="ident" id="3278740">PositionFor</span><span class="op" id="3278751">(</span><span class="ident" id="3278752">p</span><span class="op" id="3278753">,</span>&nbsp;<span class="builtintype" id="3278755">true</span><span class="op" id="3278759">)</span><br>
<span class="lineno"></span><span class="op" id="3278761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="comment" id="3278764">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="3278845">//&nbsp;FileSet</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3278857">//&nbsp;A&nbsp;FileSet&nbsp;represents&nbsp;a&nbsp;set&nbsp;of&nbsp;source&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="3278904">//&nbsp;Methods&nbsp;of&nbsp;file&nbsp;sets&nbsp;are&nbsp;synchronized;&nbsp;multiple&nbsp;goroutines</span><br>
<span class="lineno">320</span><span class="comment" id="3278966">//&nbsp;may&nbsp;invoke&nbsp;them&nbsp;concurrently.</span><br>
<span class="lineno"></span><span class="comment" id="3278999">//</span><br>
<span class="lineno"></span><span class="keyword" id="3279002">type</span>&nbsp;<span class="ident" id="3279007">FileSet</span>&nbsp;<span class="keyword" id="3279015">struct</span>&nbsp;<span class="op" id="3279022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3279025">mutex</span>&nbsp;<span class="ident" id="3279031">sync</span><span class="op" id="3279035">.</span><span class="ident" id="3279036">RWMutex</span>&nbsp;<span class="comment" id="3279044">//&nbsp;protects&nbsp;the&nbsp;file&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3279070">base</span>&nbsp;&nbsp;<span class="builtintype" id="3279076">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3279089">//&nbsp;base&nbsp;offset&nbsp;for&nbsp;the&nbsp;next&nbsp;file</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3279123">files</span>&nbsp;<span class="op" id="3279129">[</span><span class="op" id="3279130">]</span><span class="op" id="3279131">*</span><span class="ident" id="3279132">File</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3279142">//&nbsp;list&nbsp;of&nbsp;files&nbsp;in&nbsp;the&nbsp;order&nbsp;added&nbsp;to&nbsp;the&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3279190">last</span>&nbsp;&nbsp;<span class="op" id="3279196">*</span><span class="ident" id="3279197">File</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3279209">//&nbsp;cache&nbsp;of&nbsp;last&nbsp;file&nbsp;looked&nbsp;up</span><br>
<span class="lineno"></span><span class="op" id="3279241">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3279244">//&nbsp;NewFileSet&nbsp;creates&nbsp;a&nbsp;new&nbsp;file&nbsp;set.</span><br>
<span class="lineno">330</span><span class="keyword" id="3279282">func</span>&nbsp;<span class="ident" id="3279287">NewFileSet</span><span class="op" id="3279297">(</span><span class="op" id="3279298">)</span>&nbsp;<span class="op" id="3279300">*</span><span class="ident" id="3279301">FileSet</span>&nbsp;<span class="op" id="3279309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3279312">return</span>&nbsp;<span class="op" id="3279319">&amp;</span><span class="ident" id="3279320">FileSet</span><span class="op" id="3279327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3279331">base</span><span class="op" id="3279335">:</span>&nbsp;<span class="num" id="3279337">1</span><span class="op" id="3279338">,</span>&nbsp;<span class="comment" id="3279340">//&nbsp;0&nbsp;==&nbsp;NoPos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3279355">}</span><br>
<span class="lineno"></span><span class="op" id="3279357">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span><span class="comment" id="3279360">//&nbsp;Base&nbsp;returns&nbsp;the&nbsp;minimum&nbsp;base&nbsp;offset&nbsp;that&nbsp;must&nbsp;be&nbsp;provided&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3279425">//&nbsp;AddFile&nbsp;when&nbsp;adding&nbsp;the&nbsp;next&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="3279463">//</span><br>
<span class="lineno"></span><span class="keyword" id="3279466">func</span>&nbsp;<span class="op" id="3279471">(</span><span class="ident" id="3279472">s</span>&nbsp;<span class="op" id="3279474">*</span><span class="ident" id="3279475">FileSet</span><span class="op" id="3279482">)</span>&nbsp;<span class="ident" id="3279484">Base</span><span class="op" id="3279488">(</span><span class="op" id="3279489">)</span>&nbsp;<span class="builtintype" id="3279491">int</span>&nbsp;<span class="op" id="3279495">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3279498">s</span><span class="op" id="3279499">.</span><span class="ident" id="3279500">mutex</span><span class="op" id="3279505">.</span><span class="ident" id="3279506">RLock</span><span class="op" id="3279511">(</span><span class="op" id="3279512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3279515">b</span>&nbsp;<span class="op" id="3279517">:=</span>&nbsp;<span class="ident" id="3279520">s</span><span class="op" id="3279521">.</span><span class="ident" id="3279522">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3279528">s</span><span class="op" id="3279529">.</span><span class="ident" id="3279530">mutex</span><span class="op" id="3279535">.</span><span class="ident" id="3279536">RUnlock</span><span class="op" id="3279543">(</span><span class="op" id="3279544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3279547">return</span>&nbsp;<span class="ident" id="3279554">b</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="op" id="3279557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3279560">//&nbsp;AddFile&nbsp;adds&nbsp;a&nbsp;new&nbsp;file&nbsp;with&nbsp;a&nbsp;given&nbsp;filename,&nbsp;base&nbsp;offset,&nbsp;and&nbsp;file&nbsp;size</span><br>
<span class="lineno"></span><span class="comment" id="3279637">//&nbsp;to&nbsp;the&nbsp;file&nbsp;set&nbsp;s&nbsp;and&nbsp;returns&nbsp;the&nbsp;file.&nbsp;Multiple&nbsp;files&nbsp;may&nbsp;have&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="3279713">//&nbsp;name.&nbsp;The&nbsp;base&nbsp;offset&nbsp;must&nbsp;not&nbsp;be&nbsp;smaller&nbsp;than&nbsp;the&nbsp;FileSet&#39;s&nbsp;Base(),&nbsp;and</span><br>
<span class="lineno">350</span><span class="comment" id="3279789">//&nbsp;size&nbsp;must&nbsp;not&nbsp;be&nbsp;negative.&nbsp;As&nbsp;a&nbsp;special&nbsp;case,&nbsp;if&nbsp;a&nbsp;negative&nbsp;base&nbsp;is&nbsp;provided,</span><br>
<span class="lineno"></span><span class="comment" id="3279870">//&nbsp;the&nbsp;current&nbsp;value&nbsp;of&nbsp;the&nbsp;FileSet&#39;s&nbsp;Base()&nbsp;is&nbsp;used&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="3279932">//</span><br>
<span class="lineno"></span><span class="comment" id="3279935">//&nbsp;Adding&nbsp;the&nbsp;file&nbsp;will&nbsp;set&nbsp;the&nbsp;file&nbsp;set&#39;s&nbsp;Base()&nbsp;value&nbsp;to&nbsp;base&nbsp;+&nbsp;size&nbsp;+&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="3280010">//&nbsp;as&nbsp;the&nbsp;minimum&nbsp;base&nbsp;value&nbsp;for&nbsp;the&nbsp;next&nbsp;file.&nbsp;The&nbsp;following&nbsp;relationship</span><br>
<span class="lineno">355</span><span class="comment" id="3280085">//&nbsp;exists&nbsp;between&nbsp;a&nbsp;Pos&nbsp;value&nbsp;p&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;offset&nbsp;offs:</span><br>
<span class="lineno"></span><span class="comment" id="3280147">//</span><br>
<span class="lineno"></span><span class="comment" id="3280150">//&nbsp;&nbsp;&nbsp;&nbsp;int(p)&nbsp;=&nbsp;base&nbsp;+&nbsp;offs</span><br>
<span class="lineno"></span><span class="comment" id="3280174">//</span><br>
<span class="lineno"></span><span class="comment" id="3280177">//&nbsp;with&nbsp;offs&nbsp;in&nbsp;the&nbsp;range&nbsp;[0,&nbsp;size]&nbsp;and&nbsp;thus&nbsp;p&nbsp;in&nbsp;the&nbsp;range&nbsp;[base,&nbsp;base+size].</span><br>
<span class="lineno">360</span><span class="comment" id="3280256">//&nbsp;For&nbsp;convenience,&nbsp;File.Pos&nbsp;may&nbsp;be&nbsp;used&nbsp;to&nbsp;create&nbsp;file-specific&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="3280330">//&nbsp;values&nbsp;from&nbsp;a&nbsp;file&nbsp;offset.</span><br>
<span class="lineno"></span><span class="comment" id="3280360">//</span><br>
<span class="lineno"></span><span class="keyword" id="3280363">func</span>&nbsp;<span class="op" id="3280368">(</span><span class="ident" id="3280369">s</span>&nbsp;<span class="op" id="3280371">*</span><span class="ident" id="3280372">FileSet</span><span class="op" id="3280379">)</span>&nbsp;<span class="ident" id="3280381">AddFile</span><span class="op" id="3280388">(</span><span class="ident" id="3280389">filename</span>&nbsp;<span class="builtintype" id="3280398">string</span><span class="op" id="3280404">,</span>&nbsp;<span class="ident" id="3280406">base</span><span class="op" id="3280410">,</span>&nbsp;<span class="ident" id="3280412">size</span>&nbsp;<span class="builtintype" id="3280417">int</span><span class="op" id="3280420">)</span>&nbsp;<span class="op" id="3280422">*</span><span class="ident" id="3280423">File</span>&nbsp;<span class="op" id="3280428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3280431">s</span><span class="op" id="3280432">.</span><span class="ident" id="3280433">mutex</span><span class="op" id="3280438">.</span><span class="ident" id="3280439">Lock</span><span class="op" id="3280443">(</span><span class="op" id="3280444">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3280447">defer</span>&nbsp;<span class="ident" id="3280453">s</span><span class="op" id="3280454">.</span><span class="ident" id="3280455">mutex</span><span class="op" id="3280460">.</span><span class="ident" id="3280461">Unlock</span><span class="op" id="3280467">(</span><span class="op" id="3280468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3280471">if</span>&nbsp;<span class="ident" id="3280474">base</span>&nbsp;<span class="op" id="3280479">&lt;</span>&nbsp;<span class="num" id="3280481">0</span>&nbsp;<span class="op" id="3280483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3280487">base</span>&nbsp;<span class="op" id="3280492">=</span>&nbsp;<span class="ident" id="3280494">s</span><span class="op" id="3280495">.</span><span class="ident" id="3280496">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3280502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3280505">if</span>&nbsp;<span class="ident" id="3280508">base</span>&nbsp;<span class="op" id="3280513">&lt;</span>&nbsp;<span class="ident" id="3280515">s</span><span class="op" id="3280516">.</span><span class="ident" id="3280517">base</span>&nbsp;<span class="op" id="3280522">||</span>&nbsp;<span class="ident" id="3280525">size</span>&nbsp;<span class="op" id="3280530">&lt;</span>&nbsp;<span class="num" id="3280532">0</span>&nbsp;<span class="op" id="3280534">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3280538">panic</span><span class="op" id="3280543">(</span><span class="string" id="3280544">&#34;illegal&nbsp;base&nbsp;or&nbsp;size&#34;</span><span class="op" id="3280566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3280569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3280572">//&nbsp;base&nbsp;&gt;=&nbsp;s.base&nbsp;&amp;&amp;&nbsp;size&nbsp;&gt;=&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3280604">f</span>&nbsp;<span class="op" id="3280606">:=</span>&nbsp;<span class="op" id="3280609">&amp;</span><span class="ident" id="3280610">File</span><span class="op" id="3280614">{</span><span class="ident" id="3280615">s</span><span class="op" id="3280616">,</span>&nbsp;<span class="ident" id="3280618">filename</span><span class="op" id="3280626">,</span>&nbsp;<span class="ident" id="3280628">base</span><span class="op" id="3280632">,</span>&nbsp;<span class="ident" id="3280634">size</span><span class="op" id="3280638">,</span>&nbsp;<span class="op" id="3280640">[</span><span class="op" id="3280641">]</span><span class="builtintype" id="3280642">int</span><span class="op" id="3280645">{</span><span class="num" id="3280646">0</span><span class="op" id="3280647">}</span><span class="op" id="3280648">,</span>&nbsp;<span class="builtintype" id="3280650">nil</span><span class="op" id="3280653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3280656">base</span>&nbsp;<span class="op" id="3280661">+=</span>&nbsp;<span class="ident" id="3280664">size</span>&nbsp;<span class="op" id="3280669">+</span>&nbsp;<span class="num" id="3280671">1</span>&nbsp;<span class="comment" id="3280673">//&nbsp;+1&nbsp;because&nbsp;EOF&nbsp;also&nbsp;has&nbsp;a&nbsp;position</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3280712">if</span>&nbsp;<span class="ident" id="3280715">base</span>&nbsp;<span class="op" id="3280720">&lt;</span>&nbsp;<span class="num" id="3280722">0</span>&nbsp;<span class="op" id="3280724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3280728">panic</span><span class="op" id="3280733">(</span><span class="string" id="3280734">&#34;token.Pos&nbsp;offset&nbsp;overflow&nbsp;(&gt;&nbsp;2G&nbsp;of&nbsp;source&nbsp;code&nbsp;in&nbsp;file&nbsp;set)&#34;</span><span class="op" id="3280795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3280798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3280801">//&nbsp;add&nbsp;the&nbsp;file&nbsp;to&nbsp;the&nbsp;file&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3280834">s</span><span class="op" id="3280835">.</span><span class="ident" id="3280836">base</span>&nbsp;<span class="op" id="3280841">=</span>&nbsp;<span class="ident" id="3280843">base</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3280849">s</span><span class="op" id="3280850">.</span><span class="ident" id="3280851">files</span>&nbsp;<span class="op" id="3280857">=</span>&nbsp;<span class="builtinfunc" id="3280859">append</span><span class="op" id="3280865">(</span><span class="ident" id="3280866">s</span><span class="op" id="3280867">.</span><span class="ident" id="3280868">files</span><span class="op" id="3280873">,</span>&nbsp;<span class="ident" id="3280875">f</span><span class="op" id="3280876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3280879">s</span><span class="op" id="3280880">.</span><span class="ident" id="3280881">last</span>&nbsp;<span class="op" id="3280886">=</span>&nbsp;<span class="ident" id="3280888">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3280891">return</span>&nbsp;<span class="ident" id="3280898">f</span><br>
<span class="lineno"></span><span class="op" id="3280900">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="3280903">//&nbsp;Iterate&nbsp;calls&nbsp;f&nbsp;for&nbsp;the&nbsp;files&nbsp;in&nbsp;the&nbsp;file&nbsp;set&nbsp;in&nbsp;the&nbsp;order&nbsp;they&nbsp;were&nbsp;added</span><br>
<span class="lineno"></span><span class="comment" id="3280981">//&nbsp;until&nbsp;f&nbsp;returns&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="3281007">//</span><br>
<span class="lineno"></span><span class="keyword" id="3281010">func</span>&nbsp;<span class="op" id="3281015">(</span><span class="ident" id="3281016">s</span>&nbsp;<span class="op" id="3281018">*</span><span class="ident" id="3281019">FileSet</span><span class="op" id="3281026">)</span>&nbsp;<span class="ident" id="3281028">Iterate</span><span class="op" id="3281035">(</span><span class="ident" id="3281036">f</span>&nbsp;<span class="keyword" id="3281038">func</span><span class="op" id="3281042">(</span><span class="op" id="3281043">*</span><span class="ident" id="3281044">File</span><span class="op" id="3281048">)</span>&nbsp;<span class="builtintype" id="3281050">bool</span><span class="op" id="3281054">)</span>&nbsp;<span class="op" id="3281056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3281059">for</span>&nbsp;<span class="ident" id="3281063">i</span>&nbsp;<span class="op" id="3281065">:=</span>&nbsp;<span class="num" id="3281068">0</span><span class="op" id="3281069">;</span>&nbsp;<span class="op" id="3281071">;</span>&nbsp;<span class="ident" id="3281073">i</span><span class="op" id="3281074">++</span>&nbsp;<span class="op" id="3281077">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3281081">var</span>&nbsp;<span class="ident" id="3281085">file</span>&nbsp;<span class="op" id="3281090">*</span><span class="ident" id="3281091">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3281098">s</span><span class="op" id="3281099">.</span><span class="ident" id="3281100">mutex</span><span class="op" id="3281105">.</span><span class="ident" id="3281106">RLock</span><span class="op" id="3281111">(</span><span class="op" id="3281112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3281116">if</span>&nbsp;<span class="ident" id="3281119">i</span>&nbsp;<span class="op" id="3281121">&lt;</span>&nbsp;<span class="builtinfunc" id="3281123">len</span><span class="op" id="3281126">(</span><span class="ident" id="3281127">s</span><span class="op" id="3281128">.</span><span class="ident" id="3281129">files</span><span class="op" id="3281134">)</span>&nbsp;<span class="op" id="3281136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3281141">file</span>&nbsp;<span class="op" id="3281146">=</span>&nbsp;<span class="ident" id="3281148">s</span><span class="op" id="3281149">.</span><span class="ident" id="3281150">files</span><span class="op" id="3281155">[</span><span class="ident" id="3281156">i</span><span class="op" id="3281157">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3281161">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3281165">s</span><span class="op" id="3281166">.</span><span class="ident" id="3281167">mutex</span><span class="op" id="3281172">.</span><span class="ident" id="3281173">RUnlock</span><span class="op" id="3281180">(</span><span class="op" id="3281181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3281185">if</span>&nbsp;<span class="ident" id="3281188">file</span>&nbsp;<span class="op" id="3281193">==</span>&nbsp;<span class="builtintype" id="3281196">nil</span>&nbsp;<span class="op" id="3281200">||</span>&nbsp;<span class="op" id="3281203">!</span><span class="ident" id="3281204">f</span><span class="op" id="3281205">(</span><span class="ident" id="3281206">file</span><span class="op" id="3281210">)</span>&nbsp;<span class="op" id="3281212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3281217">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3281225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3281228">}</span><br>
<span class="lineno">400</span><span class="op" id="3281230">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3281233">func</span>&nbsp;<span class="ident" id="3281238">searchFiles</span><span class="op" id="3281249">(</span><span class="ident" id="3281250">a</span>&nbsp;<span class="op" id="3281252">[</span><span class="op" id="3281253">]</span><span class="op" id="3281254">*</span><span class="ident" id="3281255">File</span><span class="op" id="3281259">,</span>&nbsp;<span class="ident" id="3281261">x</span>&nbsp;<span class="builtintype" id="3281263">int</span><span class="op" id="3281266">)</span>&nbsp;<span class="builtintype" id="3281268">int</span>&nbsp;<span class="op" id="3281272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3281275">return</span>&nbsp;<span class="ident" id="3281282">sort</span><span class="op" id="3281286">.</span><span class="ident" id="3281287">Search</span><span class="op" id="3281293">(</span><span class="builtinfunc" id="3281294">len</span><span class="op" id="3281297">(</span><span class="ident" id="3281298">a</span><span class="op" id="3281299">)</span><span class="op" id="3281300">,</span>&nbsp;<span class="keyword" id="3281302">func</span><span class="op" id="3281306">(</span><span class="ident" id="3281307">i</span>&nbsp;<span class="builtintype" id="3281309">int</span><span class="op" id="3281312">)</span>&nbsp;<span class="builtintype" id="3281314">bool</span>&nbsp;<span class="op" id="3281319">{</span>&nbsp;<span class="keyword" id="3281321">return</span>&nbsp;<span class="ident" id="3281328">a</span><span class="op" id="3281329">[</span><span class="ident" id="3281330">i</span><span class="op" id="3281331">]</span><span class="op" id="3281332">.</span><span class="ident" id="3281333">base</span>&nbsp;<span class="op" id="3281338">&gt;</span>&nbsp;<span class="ident" id="3281340">x</span>&nbsp;<span class="op" id="3281342">}</span><span class="op" id="3281343">)</span>&nbsp;<span class="op" id="3281345">-</span>&nbsp;<span class="num" id="3281347">1</span><br>
<span class="lineno"></span><span class="op" id="3281349">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="keyword" id="3281352">func</span>&nbsp;<span class="op" id="3281357">(</span><span class="ident" id="3281358">s</span>&nbsp;<span class="op" id="3281360">*</span><span class="ident" id="3281361">FileSet</span><span class="op" id="3281368">)</span>&nbsp;<span class="ident" id="3281370">file</span><span class="op" id="3281374">(</span><span class="ident" id="3281375">p</span>&nbsp;<span class="ident" id="3281377">Pos</span><span class="op" id="3281380">)</span>&nbsp;<span class="op" id="3281382">*</span><span class="ident" id="3281383">File</span>&nbsp;<span class="op" id="3281388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3281391">s</span><span class="op" id="3281392">.</span><span class="ident" id="3281393">mutex</span><span class="op" id="3281398">.</span><span class="ident" id="3281399">RLock</span><span class="op" id="3281404">(</span><span class="op" id="3281405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3281408">//&nbsp;common&nbsp;case:&nbsp;p&nbsp;is&nbsp;in&nbsp;last&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3281443">if</span>&nbsp;<span class="ident" id="3281446">f</span>&nbsp;<span class="op" id="3281448">:=</span>&nbsp;<span class="ident" id="3281451">s</span><span class="op" id="3281452">.</span><span class="ident" id="3281453">last</span><span class="op" id="3281457">;</span>&nbsp;<span class="ident" id="3281459">f</span>&nbsp;<span class="op" id="3281461">!=</span>&nbsp;<span class="builtintype" id="3281464">nil</span>&nbsp;<span class="op" id="3281468">&amp;&amp;</span>&nbsp;<span class="ident" id="3281471">f</span><span class="op" id="3281472">.</span><span class="ident" id="3281473">base</span>&nbsp;<span class="op" id="3281478">&lt;=</span>&nbsp;<span class="builtintype" id="3281481">int</span><span class="op" id="3281484">(</span><span class="ident" id="3281485">p</span><span class="op" id="3281486">)</span>&nbsp;<span class="op" id="3281488">&amp;&amp;</span>&nbsp;<span class="builtintype" id="3281491">int</span><span class="op" id="3281494">(</span><span class="ident" id="3281495">p</span><span class="op" id="3281496">)</span>&nbsp;<span class="op" id="3281498">&lt;=</span>&nbsp;<span class="ident" id="3281501">f</span><span class="op" id="3281502">.</span><span class="ident" id="3281503">base</span><span class="op" id="3281507">+</span><span class="ident" id="3281508">f</span><span class="op" id="3281509">.</span><span class="ident" id="3281510">size</span>&nbsp;<span class="op" id="3281515">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3281519">s</span><span class="op" id="3281520">.</span><span class="ident" id="3281521">mutex</span><span class="op" id="3281526">.</span><span class="ident" id="3281527">RUnlock</span><span class="op" id="3281534">(</span><span class="op" id="3281535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3281539">return</span>&nbsp;<span class="ident" id="3281546">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3281549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3281552">//&nbsp;p&nbsp;is&nbsp;not&nbsp;in&nbsp;last&nbsp;file&nbsp;-&nbsp;search&nbsp;all&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3281597">if</span>&nbsp;<span class="ident" id="3281600">i</span>&nbsp;<span class="op" id="3281602">:=</span>&nbsp;<span class="ident" id="3281605">searchFiles</span><span class="op" id="3281616">(</span><span class="ident" id="3281617">s</span><span class="op" id="3281618">.</span><span class="ident" id="3281619">files</span><span class="op" id="3281624">,</span>&nbsp;<span class="builtintype" id="3281626">int</span><span class="op" id="3281629">(</span><span class="ident" id="3281630">p</span><span class="op" id="3281631">)</span><span class="op" id="3281632">)</span><span class="op" id="3281633">;</span>&nbsp;<span class="ident" id="3281635">i</span>&nbsp;<span class="op" id="3281637">&gt;=</span>&nbsp;<span class="num" id="3281640">0</span>&nbsp;<span class="op" id="3281642">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3281646">f</span>&nbsp;<span class="op" id="3281648">:=</span>&nbsp;<span class="ident" id="3281651">s</span><span class="op" id="3281652">.</span><span class="ident" id="3281653">files</span><span class="op" id="3281658">[</span><span class="ident" id="3281659">i</span><span class="op" id="3281660">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3281664">//&nbsp;f.base&nbsp;&lt;=&nbsp;int(p)&nbsp;by&nbsp;definition&nbsp;of&nbsp;searchFiles</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3281715">if</span>&nbsp;<span class="builtintype" id="3281718">int</span><span class="op" id="3281721">(</span><span class="ident" id="3281722">p</span><span class="op" id="3281723">)</span>&nbsp;<span class="op" id="3281725">&lt;=</span>&nbsp;<span class="ident" id="3281728">f</span><span class="op" id="3281729">.</span><span class="ident" id="3281730">base</span><span class="op" id="3281734">+</span><span class="ident" id="3281735">f</span><span class="op" id="3281736">.</span><span class="ident" id="3281737">size</span>&nbsp;<span class="op" id="3281742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3281747">s</span><span class="op" id="3281748">.</span><span class="ident" id="3281749">mutex</span><span class="op" id="3281754">.</span><span class="ident" id="3281755">RUnlock</span><span class="op" id="3281762">(</span><span class="op" id="3281763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3281768">s</span><span class="op" id="3281769">.</span><span class="ident" id="3281770">mutex</span><span class="op" id="3281775">.</span><span class="ident" id="3281776">Lock</span><span class="op" id="3281780">(</span><span class="op" id="3281781">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3281786">s</span><span class="op" id="3281787">.</span><span class="ident" id="3281788">last</span>&nbsp;<span class="op" id="3281793">=</span>&nbsp;<span class="ident" id="3281795">f</span>&nbsp;<span class="comment" id="3281797">//&nbsp;race&nbsp;is&nbsp;ok&nbsp;-&nbsp;s.last&nbsp;is&nbsp;only&nbsp;a&nbsp;cache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3281839">s</span><span class="op" id="3281840">.</span><span class="ident" id="3281841">mutex</span><span class="op" id="3281846">.</span><span class="ident" id="3281847">Unlock</span><span class="op" id="3281853">(</span><span class="op" id="3281854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3281859">return</span>&nbsp;<span class="ident" id="3281866">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3281870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3281873">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3281876">s</span><span class="op" id="3281877">.</span><span class="ident" id="3281878">mutex</span><span class="op" id="3281883">.</span><span class="ident" id="3281884">RUnlock</span><span class="op" id="3281891">(</span><span class="op" id="3281892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3281895">return</span>&nbsp;<span class="builtintype" id="3281902">nil</span><br>
<span class="lineno"></span><span class="op" id="3281906">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3281909">//&nbsp;File&nbsp;returns&nbsp;the&nbsp;file&nbsp;that&nbsp;contains&nbsp;the&nbsp;position&nbsp;p.</span><br>
<span class="lineno">430</span><span class="comment" id="3281964">//&nbsp;If&nbsp;no&nbsp;such&nbsp;file&nbsp;is&nbsp;found&nbsp;(for&nbsp;instance&nbsp;for&nbsp;p&nbsp;==&nbsp;NoPos),</span><br>
<span class="lineno"></span><span class="comment" id="3282023">//&nbsp;the&nbsp;result&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="3282045">//</span><br>
<span class="lineno"></span><span class="keyword" id="3282048">func</span>&nbsp;<span class="op" id="3282053">(</span><span class="ident" id="3282054">s</span>&nbsp;<span class="op" id="3282056">*</span><span class="ident" id="3282057">FileSet</span><span class="op" id="3282064">)</span>&nbsp;<span class="ident" id="3282066">File</span><span class="op" id="3282070">(</span><span class="ident" id="3282071">p</span>&nbsp;<span class="ident" id="3282073">Pos</span><span class="op" id="3282076">)</span>&nbsp;<span class="op" id="3282078">(</span><span class="ident" id="3282079">f</span>&nbsp;<span class="op" id="3282081">*</span><span class="ident" id="3282082">File</span><span class="op" id="3282086">)</span>&nbsp;<span class="op" id="3282088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3282091">if</span>&nbsp;<span class="ident" id="3282094">p</span>&nbsp;<span class="op" id="3282096">!=</span>&nbsp;<span class="ident" id="3282099">NoPos</span>&nbsp;<span class="op" id="3282105">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3282109">f</span>&nbsp;<span class="op" id="3282111">=</span>&nbsp;<span class="ident" id="3282113">s</span><span class="op" id="3282114">.</span><span class="ident" id="3282115">file</span><span class="op" id="3282119">(</span><span class="ident" id="3282120">p</span><span class="op" id="3282121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3282124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3282127">return</span><br>
<span class="lineno"></span><span class="op" id="3282134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span><span class="comment" id="3282137">//&nbsp;PositionFor&nbsp;converts&nbsp;a&nbsp;Pos&nbsp;p&nbsp;in&nbsp;the&nbsp;fileset&nbsp;into&nbsp;a&nbsp;Position&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="3282207">//&nbsp;If&nbsp;adjusted&nbsp;is&nbsp;set,&nbsp;the&nbsp;position&nbsp;may&nbsp;be&nbsp;adjusted&nbsp;by&nbsp;position-altering</span><br>
<span class="lineno"></span><span class="comment" id="3282280">//&nbsp;//line&nbsp;comments;&nbsp;otherwise&nbsp;those&nbsp;comments&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="3282338">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;Pos&nbsp;value&nbsp;in&nbsp;s&nbsp;or&nbsp;NoPos.</span><br>
<span class="lineno"></span><span class="comment" id="3282378">//</span><br>
<span class="lineno">445</span><span class="keyword" id="3282381">func</span>&nbsp;<span class="op" id="3282386">(</span><span class="ident" id="3282387">s</span>&nbsp;<span class="op" id="3282389">*</span><span class="ident" id="3282390">FileSet</span><span class="op" id="3282397">)</span>&nbsp;<span class="ident" id="3282399">PositionFor</span><span class="op" id="3282410">(</span><span class="ident" id="3282411">p</span>&nbsp;<span class="ident" id="3282413">Pos</span><span class="op" id="3282416">,</span>&nbsp;<span class="ident" id="3282418">adjusted</span>&nbsp;<span class="builtintype" id="3282427">bool</span><span class="op" id="3282431">)</span>&nbsp;<span class="op" id="3282433">(</span><span class="ident" id="3282434">pos</span>&nbsp;<span class="ident" id="3282438">Position</span><span class="op" id="3282446">)</span>&nbsp;<span class="op" id="3282448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3282451">if</span>&nbsp;<span class="ident" id="3282454">p</span>&nbsp;<span class="op" id="3282456">!=</span>&nbsp;<span class="ident" id="3282459">NoPos</span>&nbsp;<span class="op" id="3282465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3282469">if</span>&nbsp;<span class="ident" id="3282472">f</span>&nbsp;<span class="op" id="3282474">:=</span>&nbsp;<span class="ident" id="3282477">s</span><span class="op" id="3282478">.</span><span class="ident" id="3282479">file</span><span class="op" id="3282483">(</span><span class="ident" id="3282484">p</span><span class="op" id="3282485">)</span><span class="op" id="3282486">;</span>&nbsp;<span class="ident" id="3282488">f</span>&nbsp;<span class="op" id="3282490">!=</span>&nbsp;<span class="builtintype" id="3282493">nil</span>&nbsp;<span class="op" id="3282497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3282502">pos</span>&nbsp;<span class="op" id="3282506">=</span>&nbsp;<span class="ident" id="3282508">f</span><span class="op" id="3282509">.</span><span class="ident" id="3282510">position</span><span class="op" id="3282518">(</span><span class="ident" id="3282519">p</span><span class="op" id="3282520">,</span>&nbsp;<span class="ident" id="3282522">adjusted</span><span class="op" id="3282530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3282534">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3282537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3282540">return</span><br>
<span class="lineno"></span><span class="op" id="3282547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3282550">//&nbsp;Position&nbsp;converts&nbsp;a&nbsp;Pos&nbsp;p&nbsp;in&nbsp;the&nbsp;fileset&nbsp;into&nbsp;a&nbsp;Position&nbsp;value.</span><br>
<span class="lineno">455</span><span class="comment" id="3282617">//&nbsp;Calling&nbsp;s.Position(p)&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;calling&nbsp;s.PositionFor(p,&nbsp;true).</span><br>
<span class="lineno"></span><span class="comment" id="3282691">//</span><br>
<span class="lineno"></span><span class="keyword" id="3282694">func</span>&nbsp;<span class="op" id="3282699">(</span><span class="ident" id="3282700">s</span>&nbsp;<span class="op" id="3282702">*</span><span class="ident" id="3282703">FileSet</span><span class="op" id="3282710">)</span>&nbsp;<span class="ident" id="3282712">Position</span><span class="op" id="3282720">(</span><span class="ident" id="3282721">p</span>&nbsp;<span class="ident" id="3282723">Pos</span><span class="op" id="3282726">)</span>&nbsp;<span class="op" id="3282728">(</span><span class="ident" id="3282729">pos</span>&nbsp;<span class="ident" id="3282733">Position</span><span class="op" id="3282741">)</span>&nbsp;<span class="op" id="3282743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3282746">return</span>&nbsp;<span class="ident" id="3282753">s</span><span class="op" id="3282754">.</span><span class="ident" id="3282755">PositionFor</span><span class="op" id="3282766">(</span><span class="ident" id="3282767">p</span><span class="op" id="3282768">,</span>&nbsp;<span class="builtintype" id="3282770">true</span><span class="op" id="3282774">)</span><br>
<span class="lineno"></span><span class="op" id="3282776">}</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span><span class="comment" id="3282779">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="3282860">//&nbsp;Helper&nbsp;functions</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3282881">func</span>&nbsp;<span class="ident" id="3282886">searchInts</span><span class="op" id="3282896">(</span><span class="ident" id="3282897">a</span>&nbsp;<span class="op" id="3282899">[</span><span class="op" id="3282900">]</span><span class="builtintype" id="3282901">int</span><span class="op" id="3282904">,</span>&nbsp;<span class="ident" id="3282906">x</span>&nbsp;<span class="builtintype" id="3282908">int</span><span class="op" id="3282911">)</span>&nbsp;<span class="builtintype" id="3282913">int</span>&nbsp;<span class="op" id="3282917">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3282920">//&nbsp;This&nbsp;function&nbsp;body&nbsp;is&nbsp;a&nbsp;manually&nbsp;inlined&nbsp;version&nbsp;of:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3282977">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3282981">//&nbsp;&nbsp;&nbsp;return&nbsp;sort.Search(len(a),&nbsp;func(i&nbsp;int)&nbsp;bool&nbsp;{&nbsp;return&nbsp;a[i]&nbsp;&gt;&nbsp;x&nbsp;})&nbsp;-&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3283056">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3283060">//&nbsp;With&nbsp;better&nbsp;compiler&nbsp;optimizations,&nbsp;this&nbsp;may&nbsp;not&nbsp;be&nbsp;needed&nbsp;in&nbsp;the</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3283130">//&nbsp;future,&nbsp;but&nbsp;at&nbsp;the&nbsp;moment&nbsp;this&nbsp;change&nbsp;improves&nbsp;the&nbsp;go/printer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3283196">//&nbsp;benchmark&nbsp;performance&nbsp;by&nbsp;~30%.&nbsp;This&nbsp;has&nbsp;a&nbsp;direct&nbsp;impact&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3283263">//&nbsp;speed&nbsp;of&nbsp;gofmt&nbsp;and&nbsp;thus&nbsp;seems&nbsp;worthwhile&nbsp;(2011-04-29).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3283322">//&nbsp;TODO(gri):&nbsp;Remove&nbsp;this&nbsp;when&nbsp;compilers&nbsp;have&nbsp;caught&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3283380">i</span><span class="op" id="3283381">,</span>&nbsp;<span class="ident" id="3283383">j</span>&nbsp;<span class="op" id="3283385">:=</span>&nbsp;<span class="num" id="3283388">0</span><span class="op" id="3283389">,</span>&nbsp;<span class="builtinfunc" id="3283391">len</span><span class="op" id="3283394">(</span><span class="ident" id="3283395">a</span><span class="op" id="3283396">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3283399">for</span>&nbsp;<span class="ident" id="3283403">i</span>&nbsp;<span class="op" id="3283405">&lt;</span>&nbsp;<span class="ident" id="3283407">j</span>&nbsp;<span class="op" id="3283409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3283413">h</span>&nbsp;<span class="op" id="3283415">:=</span>&nbsp;<span class="ident" id="3283418">i</span>&nbsp;<span class="op" id="3283420">+</span>&nbsp;<span class="op" id="3283422">(</span><span class="ident" id="3283423">j</span><span class="op" id="3283424">-</span><span class="ident" id="3283425">i</span><span class="op" id="3283426">)</span><span class="op" id="3283427">/</span><span class="num" id="3283428">2</span>&nbsp;<span class="comment" id="3283430">//&nbsp;avoid&nbsp;overflow&nbsp;when&nbsp;computing&nbsp;h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3283467">//&nbsp;i&nbsp;&nbsp;h&nbsp;&lt;&nbsp;j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3283484">if</span>&nbsp;<span class="ident" id="3283487">a</span><span class="op" id="3283488">[</span><span class="ident" id="3283489">h</span><span class="op" id="3283490">]</span>&nbsp;<span class="op" id="3283492">&lt;=</span>&nbsp;<span class="ident" id="3283495">x</span>&nbsp;<span class="op" id="3283497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3283502">i</span>&nbsp;<span class="op" id="3283504">=</span>&nbsp;<span class="ident" id="3283506">h</span>&nbsp;<span class="op" id="3283508">+</span>&nbsp;<span class="num" id="3283510">1</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3283514">}</span>&nbsp;<span class="keyword" id="3283516">else</span>&nbsp;<span class="op" id="3283521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3283526">j</span>&nbsp;<span class="op" id="3283528">=</span>&nbsp;<span class="ident" id="3283530">h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3283534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3283537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3283540">return</span>&nbsp;<span class="ident" id="3283547">i</span>&nbsp;<span class="op" id="3283549">-</span>&nbsp;<span class="num" id="3283551">1</span><br>
<span class="lineno">485</span><span class="op" id="3283553">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
