<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http</h2>
<ul>
<li><a href="/gostd/net/http/client.go.html">client.go</a></li>
<li><a href="/gostd/net/http/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/http/cookie.go.html">cookie.go</a></li>
<li><a href="/gostd/net/http/cookie_test.go.html">cookie_test.go</a></li>
<li><a href="/gostd/net/http/doc.go.html">doc.go</a></li>
<li><a href="/gostd/net/http/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/net/http/filetransport.go.html">filetransport.go</a></li>
<li><a href="/gostd/net/http/filetransport_test.go.html">filetransport_test.go</a></li>
<li><a href="/gostd/net/http/fs.go.html">fs.go</a></li>
<li><a href="/gostd/net/http/fs_test.go.html">fs_test.go</a></li>
<li><a href="/gostd/net/http/header.go.html">header.go</a></li>
<li><a href="/gostd/net/http/header_test.go.html">header_test.go</a></li>
<li><a href="/gostd/net/http/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/lex.go.html">lex.go</a></li>
<li><a href="/gostd/net/http/lex_test.go.html">lex_test.go</a></li>
<li><a href="/gostd/net/http/main_test.go.html">main_test.go</a></li>
<li><a href="/gostd/net/http/npn_test.go.html">npn_test.go</a></li>
<li><a href="/gostd/net/http/proxy_test.go.html">proxy_test.go</a></li>
<li><a href="/gostd/net/http/range_test.go.html">range_test.go</a></li>
<li><a href="/gostd/net/http/readrequest_test.go.html">readrequest_test.go</a></li>
<li><a href="/gostd/net/http/request.go.html">request.go</a></li>
<li><a href="/gostd/net/http/request_test.go.html">request_test.go</a></li>
<li><a href="/gostd/net/http/requestwrite_test.go.html">requestwrite_test.go</a></li>
<li><a href="/gostd/net/http/response.go.html">response.go</a></li>
<li><a href="/gostd/net/http/response_test.go.html">response_test.go</a></li>
<li><a href="/gostd/net/http/responsewrite_test.go.html">responsewrite_test.go</a></li>
<li><a href="/gostd/net/http/serve_test.go.html">serve_test.go</a></li>
<li><a href="/gostd/net/http/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/sniff.go.html">sniff.go</a></li>
<li><a href="/gostd/net/http/sniff_test.go.html">sniff_test.go</a></li>
<li><a href="/gostd/net/http/status.go.html">status.go</a></li>
<li><a href="/gostd/net/http/transfer.go.html">transfer.go</a></li>
<li><a href="/gostd/net/http/transfer_test.go.html">transfer_test.go</a></li>
<li><a href="/gostd/net/http/transport.go.html">transport.go</a></li>
<li><a href="/gostd/net/http/transport_test.go.html">transport_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1410629">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1410684">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1410738">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1410789">//&nbsp;HTTP&nbsp;Response&nbsp;reading&nbsp;and&nbsp;parsing.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1410828">package</span>&nbsp;<span class="ident" id="1410836">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1410842">import</span>&nbsp;<span class="op" id="1410849">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1410852">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1410861">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1410870">&#34;crypto/tls&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1410884">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1410894">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1410900">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1410917">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1410928">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1410939">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="1410949">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="1410952">var</span>&nbsp;<span class="ident" id="1410956">respExcludeHeader</span>&nbsp;<span class="op" id="1410974">=</span>&nbsp;<span class="keyword" id="1410976">map</span><span class="op" id="1410979">[</span><span class="builtintype" id="1410980">string</span><span class="op" id="1410986">]</span><span class="builtintype" id="1410987">bool</span><span class="op" id="1410991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1410994">&#34;Content-Length&#34;</span><span class="op" id="1411010">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1411015">true</span><span class="op" id="1411019">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1411022">&#34;Transfer-Encoding&#34;</span><span class="op" id="1411041">:</span>&nbsp;<span class="builtintype" id="1411043">true</span><span class="op" id="1411047">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1411050">&#34;Trailer&#34;</span><span class="op" id="1411059">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1411071">true</span><span class="op" id="1411075">,</span><br>
<span class="lineno">25</span><span class="op" id="1411077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1411080">//&nbsp;Response&nbsp;represents&nbsp;the&nbsp;response&nbsp;from&nbsp;an&nbsp;HTTP&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="1411138">//</span><br>
<span class="lineno"></span><span class="keyword" id="1411141">type</span>&nbsp;<span class="ident" id="1411146">Response</span>&nbsp;<span class="keyword" id="1411155">struct</span>&nbsp;<span class="op" id="1411162">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1411165">Status</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1411176">string</span>&nbsp;<span class="comment" id="1411183">//&nbsp;e.g.&nbsp;&#34;200&nbsp;OK&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1411201">StatusCode</span>&nbsp;<span class="builtintype" id="1411212">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1411219">//&nbsp;e.g.&nbsp;200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1411232">Proto</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1411243">string</span>&nbsp;<span class="comment" id="1411250">//&nbsp;e.g.&nbsp;&#34;HTTP/1.0&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1411270">ProtoMajor</span>&nbsp;<span class="builtintype" id="1411281">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1411288">//&nbsp;e.g.&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1411299">ProtoMinor</span>&nbsp;<span class="builtintype" id="1411310">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1411317">//&nbsp;e.g.&nbsp;0</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1411329">//&nbsp;Header&nbsp;maps&nbsp;header&nbsp;keys&nbsp;to&nbsp;values.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;had&nbsp;multiple</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1411398">//&nbsp;headers&nbsp;with&nbsp;the&nbsp;same&nbsp;key,&nbsp;they&nbsp;may&nbsp;be&nbsp;concatenated,&nbsp;with&nbsp;comma</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1411466">//&nbsp;delimiters.&nbsp;&nbsp;(Section&nbsp;4.2&nbsp;of&nbsp;RFC&nbsp;2616&nbsp;requires&nbsp;that&nbsp;multiple&nbsp;headers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1411539">//&nbsp;be&nbsp;semantically&nbsp;equivalent&nbsp;to&nbsp;a&nbsp;comma-delimited&nbsp;sequence.)&nbsp;Values</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1411609">//&nbsp;duplicated&nbsp;by&nbsp;other&nbsp;fields&nbsp;in&nbsp;this&nbsp;struct&nbsp;(e.g.,&nbsp;ContentLength)&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1411681">//&nbsp;omitted&nbsp;from&nbsp;Header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1411706">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1411710">//&nbsp;Keys&nbsp;in&nbsp;the&nbsp;map&nbsp;are&nbsp;canonicalized&nbsp;(see&nbsp;CanonicalHeaderKey).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1411774">Header</span>&nbsp;<span class="ident" id="1411781">Header</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1411790">//&nbsp;Body&nbsp;represents&nbsp;the&nbsp;response&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1411829">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1411833">//&nbsp;The&nbsp;http&nbsp;Client&nbsp;and&nbsp;Transport&nbsp;guarantee&nbsp;that&nbsp;Body&nbsp;is&nbsp;always</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1411897">//&nbsp;non-nil,&nbsp;even&nbsp;on&nbsp;responses&nbsp;without&nbsp;a&nbsp;body&nbsp;or&nbsp;responses&nbsp;with</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1411961">//&nbsp;a&nbsp;zero-length&nbsp;body.&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1412022">//&nbsp;close&nbsp;Body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1412038">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1412042">//&nbsp;The&nbsp;Body&nbsp;is&nbsp;automatically&nbsp;dechunked&nbsp;if&nbsp;the&nbsp;server&nbsp;replied</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1412104">//&nbsp;with&nbsp;a&nbsp;&#34;chunked&#34;&nbsp;Transfer-Encoding.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1412144">Body</span>&nbsp;<span class="ident" id="1412149">io</span><span class="op" id="1412151">.</span><span class="ident" id="1412152">ReadCloser</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1412165">//&nbsp;ContentLength&nbsp;records&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;associated&nbsp;content.&nbsp;&nbsp;The</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1412234">//&nbsp;value&nbsp;-1&nbsp;indicates&nbsp;that&nbsp;the&nbsp;length&nbsp;is&nbsp;unknown.&nbsp;&nbsp;Unless&nbsp;Request.Method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1412308">//&nbsp;is&nbsp;&#34;HEAD&#34;,&nbsp;values&nbsp;&gt;=&nbsp;0&nbsp;indicate&nbsp;that&nbsp;the&nbsp;given&nbsp;number&nbsp;of&nbsp;bytes&nbsp;may</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1412379">//&nbsp;be&nbsp;read&nbsp;from&nbsp;Body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1412402">ContentLength</span>&nbsp;<span class="ident" id="1412416">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1412424">//&nbsp;Contains&nbsp;transfer&nbsp;encodings&nbsp;from&nbsp;outer-most&nbsp;to&nbsp;inner-most.&nbsp;Value&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1412496">//&nbsp;nil,&nbsp;means&nbsp;that&nbsp;&#34;identity&#34;&nbsp;encoding&nbsp;is&nbsp;used.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1412545">TransferEncoding</span>&nbsp;<span class="op" id="1412562">[</span><span class="op" id="1412563">]</span><span class="builtintype" id="1412564">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1412573">//&nbsp;Close&nbsp;records&nbsp;whether&nbsp;the&nbsp;header&nbsp;directed&nbsp;that&nbsp;the&nbsp;connection&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1412642">//&nbsp;closed&nbsp;after&nbsp;reading&nbsp;Body.&nbsp;&nbsp;The&nbsp;value&nbsp;is&nbsp;advice&nbsp;for&nbsp;clients:&nbsp;neither</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1412715">//&nbsp;ReadResponse&nbsp;nor&nbsp;Response.Write&nbsp;ever&nbsp;closes&nbsp;a&nbsp;connection.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1412777">Close</span>&nbsp;<span class="builtintype" id="1412783">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1412790">//&nbsp;Trailer&nbsp;maps&nbsp;trailer&nbsp;keys&nbsp;to&nbsp;values,&nbsp;in&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1412843">//&nbsp;format&nbsp;as&nbsp;the&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1412869">Trailer</span>&nbsp;<span class="ident" id="1412877">Header</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1412886">//&nbsp;The&nbsp;Request&nbsp;that&nbsp;was&nbsp;sent&nbsp;to&nbsp;obtain&nbsp;this&nbsp;Response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1412941">//&nbsp;Request&#39;s&nbsp;Body&nbsp;is&nbsp;nil&nbsp;(having&nbsp;already&nbsp;been&nbsp;consumed).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1412999">//&nbsp;This&nbsp;is&nbsp;only&nbsp;populated&nbsp;for&nbsp;Client&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1413047">Request</span>&nbsp;<span class="op" id="1413055">*</span><span class="ident" id="1413056">Request</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1413066">//&nbsp;TLS&nbsp;contains&nbsp;information&nbsp;about&nbsp;the&nbsp;TLS&nbsp;connection&nbsp;on&nbsp;which&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1413133">//&nbsp;response&nbsp;was&nbsp;received.&nbsp;It&nbsp;is&nbsp;nil&nbsp;for&nbsp;unencrypted&nbsp;responses.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1413197">//&nbsp;The&nbsp;pointer&nbsp;is&nbsp;shared&nbsp;between&nbsp;responses&nbsp;and&nbsp;should&nbsp;not&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1413259">//&nbsp;modified.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1413273">TLS</span>&nbsp;<span class="op" id="1413277">*</span><span class="ident" id="1413278">tls</span><span class="op" id="1413281">.</span><span class="ident" id="1413282">ConnectionState</span><br>
<span class="lineno"></span><span class="op" id="1413298">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1413301">//&nbsp;Cookies&nbsp;parses&nbsp;and&nbsp;returns&nbsp;the&nbsp;cookies&nbsp;set&nbsp;in&nbsp;the&nbsp;Set-Cookie&nbsp;headers.</span><br>
<span class="lineno"></span><span class="keyword" id="1413374">func</span>&nbsp;<span class="op" id="1413379">(</span><span class="ident" id="1413380">r</span>&nbsp;<span class="op" id="1413382">*</span><span class="ident" id="1413383">Response</span><span class="op" id="1413391">)</span>&nbsp;<span class="ident" id="1413393">Cookies</span><span class="op" id="1413400">(</span><span class="op" id="1413401">)</span>&nbsp;<span class="op" id="1413403">[</span><span class="op" id="1413404">]</span><span class="op" id="1413405">*</span><span class="ident" id="1413406">Cookie</span>&nbsp;<span class="op" id="1413413">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1413416">return</span>&nbsp;<span class="ident" id="1413423">readSetCookies</span><span class="op" id="1413437">(</span><span class="ident" id="1413438">r</span><span class="op" id="1413439">.</span><span class="ident" id="1413440">Header</span><span class="op" id="1413446">)</span><br>
<span class="lineno"></span><span class="op" id="1413448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1413451">var</span>&nbsp;<span class="ident" id="1413455">ErrNoLocation</span>&nbsp;<span class="op" id="1413469">=</span>&nbsp;<span class="ident" id="1413471">errors</span><span class="op" id="1413477">.</span><span class="ident" id="1413478">New</span><span class="op" id="1413481">(</span><span class="string" id="1413482">&#34;http:&nbsp;no&nbsp;Location&nbsp;header&nbsp;in&nbsp;response&#34;</span><span class="op" id="1413520">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="1413523">//&nbsp;Location&nbsp;returns&nbsp;the&nbsp;URL&nbsp;of&nbsp;the&nbsp;response&#39;s&nbsp;&#34;Location&#34;&nbsp;header,</span><br>
<span class="lineno"></span><span class="comment" id="1413588">//&nbsp;if&nbsp;present.&nbsp;&nbsp;Relative&nbsp;redirects&nbsp;are&nbsp;resolved&nbsp;relative&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1413648">//&nbsp;the&nbsp;Response&#39;s&nbsp;Request.&nbsp;&nbsp;ErrNoLocation&nbsp;is&nbsp;returned&nbsp;if&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="1413708">//&nbsp;Location&nbsp;header&nbsp;is&nbsp;present.</span><br>
<span class="lineno"></span><span class="keyword" id="1413739">func</span>&nbsp;<span class="op" id="1413744">(</span><span class="ident" id="1413745">r</span>&nbsp;<span class="op" id="1413747">*</span><span class="ident" id="1413748">Response</span><span class="op" id="1413756">)</span>&nbsp;<span class="ident" id="1413758">Location</span><span class="op" id="1413766">(</span><span class="op" id="1413767">)</span>&nbsp;<span class="op" id="1413769">(</span><span class="op" id="1413770">*</span><span class="ident" id="1413771">url</span><span class="op" id="1413774">.</span><span class="ident" id="1413775">URL</span><span class="op" id="1413778">,</span>&nbsp;<span class="builtintype" id="1413780">error</span><span class="op" id="1413785">)</span>&nbsp;<span class="op" id="1413787">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1413790">lv</span>&nbsp;<span class="op" id="1413793">:=</span>&nbsp;<span class="ident" id="1413796">r</span><span class="op" id="1413797">.</span><span class="ident" id="1413798">Header</span><span class="op" id="1413804">.</span><span class="ident" id="1413805">Get</span><span class="op" id="1413808">(</span><span class="string" id="1413809">&#34;Location&#34;</span><span class="op" id="1413819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1413822">if</span>&nbsp;<span class="ident" id="1413825">lv</span>&nbsp;<span class="op" id="1413828">==</span>&nbsp;<span class="string" id="1413831">&#34;&#34;</span>&nbsp;<span class="op" id="1413834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1413838">return</span>&nbsp;<span class="ident" id="1413845">nil</span><span class="op" id="1413848">,</span>&nbsp;<span class="ident" id="1413850">ErrNoLocation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1413865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1413868">if</span>&nbsp;<span class="ident" id="1413871">r</span><span class="op" id="1413872">.</span><span class="ident" id="1413873">Request</span>&nbsp;<span class="op" id="1413881">!=</span>&nbsp;<span class="ident" id="1413884">nil</span>&nbsp;<span class="op" id="1413888">&amp;&amp;</span>&nbsp;<span class="ident" id="1413891">r</span><span class="op" id="1413892">.</span><span class="ident" id="1413893">Request</span><span class="op" id="1413900">.</span><span class="ident" id="1413901">URL</span>&nbsp;<span class="op" id="1413905">!=</span>&nbsp;<span class="ident" id="1413908">nil</span>&nbsp;<span class="op" id="1413912">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1413916">return</span>&nbsp;<span class="ident" id="1413923">r</span><span class="op" id="1413924">.</span><span class="ident" id="1413925">Request</span><span class="op" id="1413932">.</span><span class="ident" id="1413933">URL</span><span class="op" id="1413936">.</span><span class="ident" id="1413937">Parse</span><span class="op" id="1413942">(</span><span class="ident" id="1413943">lv</span><span class="op" id="1413945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1413948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1413951">return</span>&nbsp;<span class="ident" id="1413958">url</span><span class="op" id="1413961">.</span><span class="ident" id="1413962">Parse</span><span class="op" id="1413967">(</span><span class="ident" id="1413968">lv</span><span class="op" id="1413970">)</span><br>
<span class="lineno"></span><span class="op" id="1413972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="1413975">//&nbsp;ReadResponse&nbsp;reads&nbsp;and&nbsp;returns&nbsp;an&nbsp;HTTP&nbsp;response&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="1414034">//&nbsp;The&nbsp;req&nbsp;parameter&nbsp;optionally&nbsp;specifies&nbsp;the&nbsp;Request&nbsp;that&nbsp;corresponds</span><br>
<span class="lineno"></span><span class="comment" id="1414105">//&nbsp;to&nbsp;this&nbsp;Response.&nbsp;If&nbsp;nil,&nbsp;a&nbsp;GET&nbsp;request&nbsp;is&nbsp;assumed.</span><br>
<span class="lineno"></span><span class="comment" id="1414160">//&nbsp;Clients&nbsp;must&nbsp;call&nbsp;resp.Body.Close&nbsp;when&nbsp;finished&nbsp;reading&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="1414230">//&nbsp;After&nbsp;that&nbsp;call,&nbsp;clients&nbsp;can&nbsp;inspect&nbsp;resp.Trailer&nbsp;to&nbsp;find&nbsp;key/value</span><br>
<span class="lineno">115</span><span class="comment" id="1414301">//&nbsp;pairs&nbsp;included&nbsp;in&nbsp;the&nbsp;response&nbsp;trailer.</span><br>
<span class="lineno"></span><span class="keyword" id="1414344">func</span>&nbsp;<span class="ident" id="1414349">ReadResponse</span><span class="op" id="1414361">(</span><span class="ident" id="1414362">r</span>&nbsp;<span class="op" id="1414364">*</span><span class="ident" id="1414365">bufio</span><span class="op" id="1414370">.</span><span class="ident" id="1414371">Reader</span><span class="op" id="1414377">,</span>&nbsp;<span class="ident" id="1414379">req</span>&nbsp;<span class="op" id="1414383">*</span><span class="ident" id="1414384">Request</span><span class="op" id="1414391">)</span>&nbsp;<span class="op" id="1414393">(</span><span class="op" id="1414394">*</span><span class="ident" id="1414395">Response</span><span class="op" id="1414403">,</span>&nbsp;<span class="builtintype" id="1414405">error</span><span class="op" id="1414410">)</span>&nbsp;<span class="op" id="1414412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1414415">tp</span>&nbsp;<span class="op" id="1414418">:=</span>&nbsp;<span class="ident" id="1414421">textproto</span><span class="op" id="1414430">.</span><span class="ident" id="1414431">NewReader</span><span class="op" id="1414440">(</span><span class="ident" id="1414441">r</span><span class="op" id="1414442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1414445">resp</span>&nbsp;<span class="op" id="1414450">:=</span>&nbsp;<span class="op" id="1414453">&amp;</span><span class="ident" id="1414454">Response</span><span class="op" id="1414462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1414466">Request</span><span class="op" id="1414473">:</span>&nbsp;<span class="ident" id="1414475">req</span><span class="op" id="1414478">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1414481">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1414485">//&nbsp;Parse&nbsp;the&nbsp;first&nbsp;line&nbsp;of&nbsp;the&nbsp;response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1414527">line</span><span class="op" id="1414531">,</span>&nbsp;<span class="ident" id="1414533">err</span>&nbsp;<span class="op" id="1414537">:=</span>&nbsp;<span class="ident" id="1414540">tp</span><span class="op" id="1414542">.</span><span class="ident" id="1414543">ReadLine</span><span class="op" id="1414551">(</span><span class="op" id="1414552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1414555">if</span>&nbsp;<span class="ident" id="1414558">err</span>&nbsp;<span class="op" id="1414562">!=</span>&nbsp;<span class="ident" id="1414565">nil</span>&nbsp;<span class="op" id="1414569">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1414573">if</span>&nbsp;<span class="ident" id="1414576">err</span>&nbsp;<span class="op" id="1414580">==</span>&nbsp;<span class="ident" id="1414583">io</span><span class="op" id="1414585">.</span><span class="ident" id="1414586">EOF</span>&nbsp;<span class="op" id="1414590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1414595">err</span>&nbsp;<span class="op" id="1414599">=</span>&nbsp;<span class="ident" id="1414601">io</span><span class="op" id="1414603">.</span><span class="ident" id="1414604">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1414623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1414627">return</span>&nbsp;<span class="ident" id="1414634">nil</span><span class="op" id="1414637">,</span>&nbsp;<span class="ident" id="1414639">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1414644">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1414647">f</span>&nbsp;<span class="op" id="1414649">:=</span>&nbsp;<span class="ident" id="1414652">strings</span><span class="op" id="1414659">.</span><span class="ident" id="1414660">SplitN</span><span class="op" id="1414666">(</span><span class="ident" id="1414667">line</span><span class="op" id="1414671">,</span>&nbsp;<span class="string" id="1414673">&#34;&nbsp;&#34;</span><span class="op" id="1414676">,</span>&nbsp;<span class="num" id="1414678">3</span><span class="op" id="1414679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1414682">if</span>&nbsp;<span class="builtinfunc" id="1414685">len</span><span class="op" id="1414688">(</span><span class="ident" id="1414689">f</span><span class="op" id="1414690">)</span>&nbsp;<span class="op" id="1414692">&lt;</span>&nbsp;<span class="num" id="1414694">2</span>&nbsp;<span class="op" id="1414696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1414700">return</span>&nbsp;<span class="ident" id="1414707">nil</span><span class="op" id="1414710">,</span>&nbsp;<span class="op" id="1414712">&amp;</span><span class="ident" id="1414713">badStringError</span><span class="op" id="1414727">{</span><span class="string" id="1414728">&#34;malformed&nbsp;HTTP&nbsp;response&#34;</span><span class="op" id="1414753">,</span>&nbsp;<span class="ident" id="1414755">line</span><span class="op" id="1414759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1414762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1414765">reasonPhrase</span>&nbsp;<span class="op" id="1414778">:=</span>&nbsp;<span class="string" id="1414781">&#34;&#34;</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1414785">if</span>&nbsp;<span class="builtinfunc" id="1414788">len</span><span class="op" id="1414791">(</span><span class="ident" id="1414792">f</span><span class="op" id="1414793">)</span>&nbsp;<span class="op" id="1414795">&gt;</span>&nbsp;<span class="num" id="1414797">2</span>&nbsp;<span class="op" id="1414799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1414803">reasonPhrase</span>&nbsp;<span class="op" id="1414816">=</span>&nbsp;<span class="ident" id="1414818">f</span><span class="op" id="1414819">[</span><span class="num" id="1414820">2</span><span class="op" id="1414821">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1414824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1414827">resp</span><span class="op" id="1414831">.</span><span class="ident" id="1414832">Status</span>&nbsp;<span class="op" id="1414839">=</span>&nbsp;<span class="ident" id="1414841">f</span><span class="op" id="1414842">[</span><span class="num" id="1414843">1</span><span class="op" id="1414844">]</span>&nbsp;<span class="op" id="1414846">+</span>&nbsp;<span class="string" id="1414848">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="1414852">+</span>&nbsp;<span class="ident" id="1414854">reasonPhrase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1414868">resp</span><span class="op" id="1414872">.</span><span class="ident" id="1414873">StatusCode</span><span class="op" id="1414883">,</span>&nbsp;<span class="ident" id="1414885">err</span>&nbsp;<span class="op" id="1414889">=</span>&nbsp;<span class="ident" id="1414891">strconv</span><span class="op" id="1414898">.</span><span class="ident" id="1414899">Atoi</span><span class="op" id="1414903">(</span><span class="ident" id="1414904">f</span><span class="op" id="1414905">[</span><span class="num" id="1414906">1</span><span class="op" id="1414907">]</span><span class="op" id="1414908">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1414911">if</span>&nbsp;<span class="ident" id="1414914">err</span>&nbsp;<span class="op" id="1414918">!=</span>&nbsp;<span class="ident" id="1414921">nil</span>&nbsp;<span class="op" id="1414925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1414929">return</span>&nbsp;<span class="ident" id="1414936">nil</span><span class="op" id="1414939">,</span>&nbsp;<span class="op" id="1414941">&amp;</span><span class="ident" id="1414942">badStringError</span><span class="op" id="1414956">{</span><span class="string" id="1414957">&#34;malformed&nbsp;HTTP&nbsp;status&nbsp;code&#34;</span><span class="op" id="1414985">,</span>&nbsp;<span class="ident" id="1414987">f</span><span class="op" id="1414988">[</span><span class="num" id="1414989">1</span><span class="op" id="1414990">]</span><span class="op" id="1414991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1414994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1414998">resp</span><span class="op" id="1415002">.</span><span class="ident" id="1415003">Proto</span>&nbsp;<span class="op" id="1415009">=</span>&nbsp;<span class="ident" id="1415011">f</span><span class="op" id="1415012">[</span><span class="num" id="1415013">0</span><span class="op" id="1415014">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1415017">var</span>&nbsp;<span class="ident" id="1415021">ok</span>&nbsp;<span class="builtintype" id="1415024">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1415030">if</span>&nbsp;<span class="ident" id="1415033">resp</span><span class="op" id="1415037">.</span><span class="ident" id="1415038">ProtoMajor</span><span class="op" id="1415048">,</span>&nbsp;<span class="ident" id="1415050">resp</span><span class="op" id="1415054">.</span><span class="ident" id="1415055">ProtoMinor</span><span class="op" id="1415065">,</span>&nbsp;<span class="ident" id="1415067">ok</span>&nbsp;<span class="op" id="1415070">=</span>&nbsp;<span class="ident" id="1415072">ParseHTTPVersion</span><span class="op" id="1415088">(</span><span class="ident" id="1415089">resp</span><span class="op" id="1415093">.</span><span class="ident" id="1415094">Proto</span><span class="op" id="1415099">)</span><span class="op" id="1415100">;</span>&nbsp;<span class="op" id="1415102">!</span><span class="ident" id="1415103">ok</span>&nbsp;<span class="op" id="1415106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1415110">return</span>&nbsp;<span class="ident" id="1415117">nil</span><span class="op" id="1415120">,</span>&nbsp;<span class="op" id="1415122">&amp;</span><span class="ident" id="1415123">badStringError</span><span class="op" id="1415137">{</span><span class="string" id="1415138">&#34;malformed&nbsp;HTTP&nbsp;version&#34;</span><span class="op" id="1415162">,</span>&nbsp;<span class="ident" id="1415164">resp</span><span class="op" id="1415168">.</span><span class="ident" id="1415169">Proto</span><span class="op" id="1415174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1415177">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1415181">//&nbsp;Parse&nbsp;the&nbsp;response&nbsp;headers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1415213">mimeHeader</span><span class="op" id="1415223">,</span>&nbsp;<span class="ident" id="1415225">err</span>&nbsp;<span class="op" id="1415229">:=</span>&nbsp;<span class="ident" id="1415232">tp</span><span class="op" id="1415234">.</span><span class="ident" id="1415235">ReadMIMEHeader</span><span class="op" id="1415249">(</span><span class="op" id="1415250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1415253">if</span>&nbsp;<span class="ident" id="1415256">err</span>&nbsp;<span class="op" id="1415260">!=</span>&nbsp;<span class="ident" id="1415263">nil</span>&nbsp;<span class="op" id="1415267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1415271">if</span>&nbsp;<span class="ident" id="1415274">err</span>&nbsp;<span class="op" id="1415278">==</span>&nbsp;<span class="ident" id="1415281">io</span><span class="op" id="1415283">.</span><span class="ident" id="1415284">EOF</span>&nbsp;<span class="op" id="1415288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1415293">err</span>&nbsp;<span class="op" id="1415297">=</span>&nbsp;<span class="ident" id="1415299">io</span><span class="op" id="1415301">.</span><span class="ident" id="1415302">ErrUnexpectedEOF</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1415321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1415325">return</span>&nbsp;<span class="ident" id="1415332">nil</span><span class="op" id="1415335">,</span>&nbsp;<span class="ident" id="1415337">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1415342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1415345">resp</span><span class="op" id="1415349">.</span><span class="ident" id="1415350">Header</span>&nbsp;<span class="op" id="1415357">=</span>&nbsp;<span class="ident" id="1415359">Header</span><span class="op" id="1415365">(</span><span class="ident" id="1415366">mimeHeader</span><span class="op" id="1415376">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1415380">fixPragmaCacheControl</span><span class="op" id="1415401">(</span><span class="ident" id="1415402">resp</span><span class="op" id="1415406">.</span><span class="ident" id="1415407">Header</span><span class="op" id="1415413">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1415417">err</span>&nbsp;<span class="op" id="1415421">=</span>&nbsp;<span class="ident" id="1415423">readTransfer</span><span class="op" id="1415435">(</span><span class="ident" id="1415436">resp</span><span class="op" id="1415440">,</span>&nbsp;<span class="ident" id="1415442">r</span><span class="op" id="1415443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1415446">if</span>&nbsp;<span class="ident" id="1415449">err</span>&nbsp;<span class="op" id="1415453">!=</span>&nbsp;<span class="ident" id="1415456">nil</span>&nbsp;<span class="op" id="1415460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1415464">return</span>&nbsp;<span class="ident" id="1415471">nil</span><span class="op" id="1415474">,</span>&nbsp;<span class="ident" id="1415476">err</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1415481">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1415485">return</span>&nbsp;<span class="ident" id="1415492">resp</span><span class="op" id="1415496">,</span>&nbsp;<span class="ident" id="1415498">nil</span><br>
<span class="lineno"></span><span class="op" id="1415502">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="comment" id="1415505">//&nbsp;RFC2616:&nbsp;Should&nbsp;treat</span><br>
<span class="lineno"></span><span class="comment" id="1415530">//&nbsp;&nbsp;&nbsp;&nbspPragma:&nbsp;no-cache</span><br>
<span class="lineno"></span><span class="comment" id="1415550">//&nbsp;like</span><br>
<span class="lineno"></span><span class="comment" id="1415558">//&nbsp;&nbsp;&nbsp;&nbspCache-Control:&nbsp;no-cache</span><br>
<span class="lineno"></span><span class="keyword" id="1415585">func</span>&nbsp;<span class="ident" id="1415590">fixPragmaCacheControl</span><span class="op" id="1415611">(</span><span class="ident" id="1415612">header</span>&nbsp;<span class="ident" id="1415619">Header</span><span class="op" id="1415625">)</span>&nbsp;<span class="op" id="1415627">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1415630">if</span>&nbsp;<span class="ident" id="1415633">hp</span><span class="op" id="1415635">,</span>&nbsp;<span class="ident" id="1415637">ok</span>&nbsp;<span class="op" id="1415640">:=</span>&nbsp;<span class="ident" id="1415643">header</span><span class="op" id="1415649">[</span><span class="string" id="1415650">&#34;Pragma&#34;</span><span class="op" id="1415658">]</span><span class="op" id="1415659">;</span>&nbsp;<span class="ident" id="1415661">ok</span>&nbsp;<span class="op" id="1415664">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="1415667">len</span><span class="op" id="1415670">(</span><span class="ident" id="1415671">hp</span><span class="op" id="1415673">)</span>&nbsp;<span class="op" id="1415675">&gt;</span>&nbsp;<span class="num" id="1415677">0</span>&nbsp;<span class="op" id="1415679">&amp;&amp;</span>&nbsp;<span class="ident" id="1415682">hp</span><span class="op" id="1415684">[</span><span class="num" id="1415685">0</span><span class="op" id="1415686">]</span>&nbsp;<span class="op" id="1415688">==</span>&nbsp;<span class="string" id="1415691">&#34;no-cache&#34;</span>&nbsp;<span class="op" id="1415702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1415706">if</span>&nbsp;<span class="ident" id="1415709">_</span><span class="op" id="1415710">,</span>&nbsp;<span class="ident" id="1415712">presentcc</span>&nbsp;<span class="op" id="1415722">:=</span>&nbsp;<span class="ident" id="1415725">header</span><span class="op" id="1415731">[</span><span class="string" id="1415732">&#34;Cache-Control&#34;</span><span class="op" id="1415747">]</span><span class="op" id="1415748">;</span>&nbsp;<span class="op" id="1415750">!</span><span class="ident" id="1415751">presentcc</span>&nbsp;<span class="op" id="1415761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1415766">header</span><span class="op" id="1415772">[</span><span class="string" id="1415773">&#34;Cache-Control&#34;</span><span class="op" id="1415788">]</span>&nbsp;<span class="op" id="1415790">=</span>&nbsp;<span class="op" id="1415792">[</span><span class="op" id="1415793">]</span><span class="builtintype" id="1415794">string</span><span class="op" id="1415800">{</span><span class="string" id="1415801">&#34;no-cache&#34;</span><span class="op" id="1415811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1415815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1415818">}</span><br>
<span class="lineno">180</span><span class="op" id="1415820">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1415823">//&nbsp;ProtoAtLeast&nbsp;reports&nbsp;whether&nbsp;the&nbsp;HTTP&nbsp;protocol&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="1415878">//&nbsp;in&nbsp;the&nbsp;response&nbsp;is&nbsp;at&nbsp;least&nbsp;major.minor.</span><br>
<span class="lineno"></span><span class="keyword" id="1415922">func</span>&nbsp;<span class="op" id="1415927">(</span><span class="ident" id="1415928">r</span>&nbsp;<span class="op" id="1415930">*</span><span class="ident" id="1415931">Response</span><span class="op" id="1415939">)</span>&nbsp;<span class="ident" id="1415941">ProtoAtLeast</span><span class="op" id="1415953">(</span><span class="ident" id="1415954">major</span><span class="op" id="1415959">,</span>&nbsp;<span class="ident" id="1415961">minor</span>&nbsp;<span class="builtintype" id="1415967">int</span><span class="op" id="1415970">)</span>&nbsp;<span class="builtintype" id="1415972">bool</span>&nbsp;<span class="op" id="1415977">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1415980">return</span>&nbsp;<span class="ident" id="1415987">r</span><span class="op" id="1415988">.</span><span class="ident" id="1415989">ProtoMajor</span>&nbsp;<span class="op" id="1416000">&gt;</span>&nbsp;<span class="ident" id="1416002">major</span>&nbsp;<span class="op" id="1416008">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1416013">r</span><span class="op" id="1416014">.</span><span class="ident" id="1416015">ProtoMajor</span>&nbsp;<span class="op" id="1416026">==</span>&nbsp;<span class="ident" id="1416029">major</span>&nbsp;<span class="op" id="1416035">&amp;&amp;</span>&nbsp;<span class="ident" id="1416038">r</span><span class="op" id="1416039">.</span><span class="ident" id="1416040">ProtoMinor</span>&nbsp;<span class="op" id="1416051">&gt;=</span>&nbsp;<span class="ident" id="1416054">minor</span><br>
<span class="lineno"></span><span class="op" id="1416060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1416063">//&nbsp;Writes&nbsp;the&nbsp;response&nbsp;(header,&nbsp;body&nbsp;and&nbsp;trailer)&nbsp;in&nbsp;wire&nbsp;format.&nbsp;This&nbsp;method</span><br>
<span class="lineno">190</span><span class="comment" id="1416141">//&nbsp;consults&nbsp;the&nbsp;following&nbsp;fields&nbsp;of&nbsp;the&nbsp;response:</span><br>
<span class="lineno"></span><span class="comment" id="1416191">//</span><br>
<span class="lineno"></span><span class="comment" id="1416194">//&nbsp;&nbsp;StatusCode</span><br>
<span class="lineno"></span><span class="comment" id="1416209">//&nbsp;&nbsp;ProtoMajor</span><br>
<span class="lineno"></span><span class="comment" id="1416224">//&nbsp;&nbsp;ProtoMinor</span><br>
<span class="lineno">195</span><span class="comment" id="1416239">//&nbsp;&nbsp;Request.Method</span><br>
<span class="lineno"></span><span class="comment" id="1416258">//&nbsp;&nbsp;TransferEncoding</span><br>
<span class="lineno"></span><span class="comment" id="1416279">//&nbsp;&nbsp;Trailer</span><br>
<span class="lineno"></span><span class="comment" id="1416291">//&nbsp;&nbsp;Body</span><br>
<span class="lineno"></span><span class="comment" id="1416300">//&nbsp;&nbsp;ContentLength</span><br>
<span class="lineno">200</span><span class="comment" id="1416318">//&nbsp;&nbsp;Header,&nbsp;values&nbsp;for&nbsp;non-canonical&nbsp;keys&nbsp;will&nbsp;have&nbsp;unpredictable&nbsp;behavior</span><br>
<span class="lineno"></span><span class="comment" id="1416393">//</span><br>
<span class="lineno"></span><span class="comment" id="1416396">//&nbsp;Body&nbsp;is&nbsp;closed&nbsp;after&nbsp;it&nbsp;is&nbsp;sent.</span><br>
<span class="lineno"></span><span class="keyword" id="1416432">func</span>&nbsp;<span class="op" id="1416437">(</span><span class="ident" id="1416438">r</span>&nbsp;<span class="op" id="1416440">*</span><span class="ident" id="1416441">Response</span><span class="op" id="1416449">)</span>&nbsp;<span class="ident" id="1416451">Write</span><span class="op" id="1416456">(</span><span class="ident" id="1416457">w</span>&nbsp;<span class="ident" id="1416459">io</span><span class="op" id="1416461">.</span><span class="ident" id="1416462">Writer</span><span class="op" id="1416468">)</span>&nbsp;<span class="builtintype" id="1416470">error</span>&nbsp;<span class="op" id="1416476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1416479">//&nbsp;Status&nbsp;line</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1416495">text</span>&nbsp;<span class="op" id="1416500">:=</span>&nbsp;<span class="ident" id="1416503">r</span><span class="op" id="1416504">.</span><span class="ident" id="1416505">Status</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1416513">if</span>&nbsp;<span class="ident" id="1416516">text</span>&nbsp;<span class="op" id="1416521">==</span>&nbsp;<span class="string" id="1416524">&#34;&#34;</span>&nbsp;<span class="op" id="1416527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1416531">var</span>&nbsp;<span class="ident" id="1416535">ok</span>&nbsp;<span class="builtintype" id="1416538">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1416545">text</span><span class="op" id="1416549">,</span>&nbsp;<span class="ident" id="1416551">ok</span>&nbsp;<span class="op" id="1416554">=</span>&nbsp;<span class="ident" id="1416556">statusText</span><span class="op" id="1416566">[</span><span class="ident" id="1416567">r</span><span class="op" id="1416568">.</span><span class="ident" id="1416569">StatusCode</span><span class="op" id="1416579">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1416583">if</span>&nbsp;<span class="op" id="1416586">!</span><span class="ident" id="1416587">ok</span>&nbsp;<span class="op" id="1416590">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1416595">text</span>&nbsp;<span class="op" id="1416600">=</span>&nbsp;<span class="string" id="1416602">&#34;status&nbsp;code&nbsp;&#34;</span>&nbsp;<span class="op" id="1416617">+</span>&nbsp;<span class="ident" id="1416619">strconv</span><span class="op" id="1416626">.</span><span class="ident" id="1416627">Itoa</span><span class="op" id="1416631">(</span><span class="ident" id="1416632">r</span><span class="op" id="1416633">.</span><span class="ident" id="1416634">StatusCode</span><span class="op" id="1416644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1416648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1416651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1416654">protoMajor</span><span class="op" id="1416664">,</span>&nbsp;<span class="ident" id="1416666">protoMinor</span>&nbsp;<span class="op" id="1416677">:=</span>&nbsp;<span class="ident" id="1416680">strconv</span><span class="op" id="1416687">.</span><span class="ident" id="1416688">Itoa</span><span class="op" id="1416692">(</span><span class="ident" id="1416693">r</span><span class="op" id="1416694">.</span><span class="ident" id="1416695">ProtoMajor</span><span class="op" id="1416705">)</span><span class="op" id="1416706">,</span>&nbsp;<span class="ident" id="1416708">strconv</span><span class="op" id="1416715">.</span><span class="ident" id="1416716">Itoa</span><span class="op" id="1416720">(</span><span class="ident" id="1416721">r</span><span class="op" id="1416722">.</span><span class="ident" id="1416723">ProtoMinor</span><span class="op" id="1416733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1416736">statusCode</span>&nbsp;<span class="op" id="1416747">:=</span>&nbsp;<span class="ident" id="1416750">strconv</span><span class="op" id="1416757">.</span><span class="ident" id="1416758">Itoa</span><span class="op" id="1416762">(</span><span class="ident" id="1416763">r</span><span class="op" id="1416764">.</span><span class="ident" id="1416765">StatusCode</span><span class="op" id="1416775">)</span>&nbsp;<span class="op" id="1416777">+</span>&nbsp;<span class="string" id="1416779">&#34;&nbsp;&#34;</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1416784">text</span>&nbsp;<span class="op" id="1416789">=</span>&nbsp;<span class="ident" id="1416791">strings</span><span class="op" id="1416798">.</span><span class="ident" id="1416799">TrimPrefix</span><span class="op" id="1416809">(</span><span class="ident" id="1416810">text</span><span class="op" id="1416814">,</span>&nbsp;<span class="ident" id="1416816">statusCode</span><span class="op" id="1416826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1416829">if</span>&nbsp;<span class="ident" id="1416832">_</span><span class="op" id="1416833">,</span>&nbsp;<span class="ident" id="1416835">err</span>&nbsp;<span class="op" id="1416839">:=</span>&nbsp;<span class="ident" id="1416842">io</span><span class="op" id="1416844">.</span><span class="ident" id="1416845">WriteString</span><span class="op" id="1416856">(</span><span class="ident" id="1416857">w</span><span class="op" id="1416858">,</span>&nbsp;<span class="string" id="1416860">&#34;HTTP/&#34;</span><span class="op" id="1416867">+</span><span class="ident" id="1416868">protoMajor</span><span class="op" id="1416878">+</span><span class="string" id="1416879">&#34;.&#34;</span><span class="op" id="1416882">+</span><span class="ident" id="1416883">protoMinor</span><span class="op" id="1416893">+</span><span class="string" id="1416894">&#34;&nbsp;&#34;</span><span class="op" id="1416897">+</span><span class="ident" id="1416898">statusCode</span><span class="op" id="1416908">+</span><span class="ident" id="1416909">text</span><span class="op" id="1416913">+</span><span class="string" id="1416914">&#34;\r\n&#34;</span><span class="op" id="1416920">)</span><span class="op" id="1416921">;</span>&nbsp;<span class="ident" id="1416923">err</span>&nbsp;<span class="op" id="1416927">!=</span>&nbsp;<span class="ident" id="1416930">nil</span>&nbsp;<span class="op" id="1416934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1416938">return</span>&nbsp;<span class="ident" id="1416945">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1416950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1416954">//&nbsp;Clone&nbsp;it,&nbsp;so&nbsp;we&nbsp;can&nbsp;modify&nbsp;r1&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1416999">r1</span>&nbsp;<span class="op" id="1417002">:=</span>&nbsp;<span class="builtinfunc" id="1417005">new</span><span class="op" id="1417008">(</span><span class="ident" id="1417009">Response</span><span class="op" id="1417017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1417020">*</span><span class="ident" id="1417021">r1</span>&nbsp;<span class="op" id="1417024">=</span>&nbsp;<span class="op" id="1417026">*</span><span class="ident" id="1417027">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1417030">if</span>&nbsp;<span class="ident" id="1417033">r1</span><span class="op" id="1417035">.</span><span class="ident" id="1417036">ContentLength</span>&nbsp;<span class="op" id="1417050">==</span>&nbsp;<span class="num" id="1417053">0</span>&nbsp;<span class="op" id="1417055">&amp;&amp;</span>&nbsp;<span class="ident" id="1417058">r1</span><span class="op" id="1417060">.</span><span class="ident" id="1417061">Body</span>&nbsp;<span class="op" id="1417066">!=</span>&nbsp;<span class="ident" id="1417069">nil</span>&nbsp;<span class="op" id="1417073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1417077">//&nbsp;Is&nbsp;it&nbsp;actually&nbsp;0&nbsp;length?&nbsp;Or&nbsp;just&nbsp;unknown?</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1417124">var</span>&nbsp;<span class="ident" id="1417128">buf</span>&nbsp;<span class="op" id="1417132">[</span><span class="num" id="1417133">1</span><span class="op" id="1417134">]</span><span class="builtintype" id="1417135">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1417142">n</span><span class="op" id="1417143">,</span>&nbsp;<span class="ident" id="1417145">err</span>&nbsp;<span class="op" id="1417149">:=</span>&nbsp;<span class="ident" id="1417152">r1</span><span class="op" id="1417154">.</span><span class="ident" id="1417155">Body</span><span class="op" id="1417159">.</span><span class="ident" id="1417160">Read</span><span class="op" id="1417164">(</span><span class="ident" id="1417165">buf</span><span class="op" id="1417168">[</span><span class="op" id="1417169">:</span><span class="op" id="1417170">]</span><span class="op" id="1417171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1417175">if</span>&nbsp;<span class="ident" id="1417178">err</span>&nbsp;<span class="op" id="1417182">!=</span>&nbsp;<span class="ident" id="1417185">nil</span>&nbsp;<span class="op" id="1417189">&amp;&amp;</span>&nbsp;<span class="ident" id="1417192">err</span>&nbsp;<span class="op" id="1417196">!=</span>&nbsp;<span class="ident" id="1417199">io</span><span class="op" id="1417201">.</span><span class="ident" id="1417202">EOF</span>&nbsp;<span class="op" id="1417206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1417211">return</span>&nbsp;<span class="ident" id="1417218">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1417224">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1417228">if</span>&nbsp;<span class="ident" id="1417231">n</span>&nbsp;<span class="op" id="1417233">==</span>&nbsp;<span class="num" id="1417236">0</span>&nbsp;<span class="op" id="1417238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1417243">//&nbsp;Reset&nbsp;it&nbsp;to&nbsp;a&nbsp;known&nbsp;zero&nbsp;reader,&nbsp;in&nbsp;case&nbsp;underlying&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1417305">//&nbsp;is&nbsp;unhappy&nbsp;being&nbsp;read&nbsp;repeatedly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1417345">r1</span><span class="op" id="1417347">.</span><span class="ident" id="1417348">Body</span>&nbsp;<span class="op" id="1417353">=</span>&nbsp;<span class="ident" id="1417355">eofReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1417367">}</span>&nbsp;<span class="keyword" id="1417369">else</span>&nbsp;<span class="op" id="1417374">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1417379">r1</span><span class="op" id="1417381">.</span><span class="ident" id="1417382">ContentLength</span>&nbsp;<span class="op" id="1417396">=</span>&nbsp;<span class="op" id="1417398">-</span><span class="num" id="1417399">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1417404">r1</span><span class="op" id="1417406">.</span><span class="ident" id="1417407">Body</span>&nbsp;<span class="op" id="1417412">=</span>&nbsp;<span class="keyword" id="1417414">struct</span>&nbsp;<span class="op" id="1417421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1417427">io</span><span class="op" id="1417429">.</span><span class="ident" id="1417430">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1417441">io</span><span class="op" id="1417443">.</span><span class="ident" id="1417444">Closer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1417454">}</span><span class="op" id="1417455">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1417461">io</span><span class="op" id="1417463">.</span><span class="ident" id="1417464">MultiReader</span><span class="op" id="1417475">(</span><span class="ident" id="1417476">bytes</span><span class="op" id="1417481">.</span><span class="ident" id="1417482">NewReader</span><span class="op" id="1417491">(</span><span class="ident" id="1417492">buf</span><span class="op" id="1417495">[</span><span class="op" id="1417496">:</span><span class="num" id="1417497">1</span><span class="op" id="1417498">]</span><span class="op" id="1417499">)</span><span class="op" id="1417500">,</span>&nbsp;<span class="ident" id="1417502">r</span><span class="op" id="1417503">.</span><span class="ident" id="1417504">Body</span><span class="op" id="1417508">)</span><span class="op" id="1417509">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1417515">r</span><span class="op" id="1417516">.</span><span class="ident" id="1417517">Body</span><span class="op" id="1417521">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1417526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1417530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1417533">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1417536">//&nbsp;If&nbsp;we&#39;re&nbsp;sending&nbsp;a&nbsp;non-chunked&nbsp;HTTP/1.1&nbsp;response&nbsp;without&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1417599">//&nbsp;content-length,&nbsp;the&nbsp;only&nbsp;way&nbsp;to&nbsp;do&nbsp;that&nbsp;is&nbsp;the&nbsp;old&nbsp;HTTP/1.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1417663">//&nbsp;way,&nbsp;by&nbsp;noting&nbsp;the&nbsp;EOF&nbsp;with&nbsp;a&nbsp;connection&nbsp;close,&nbsp;so&nbsp;we&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1417726">//&nbsp;to&nbsp;set&nbsp;Close.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1417744">if</span>&nbsp;<span class="ident" id="1417747">r1</span><span class="op" id="1417749">.</span><span class="ident" id="1417750">ContentLength</span>&nbsp;<span class="op" id="1417764">==</span>&nbsp;<span class="op" id="1417767">-</span><span class="num" id="1417768">1</span>&nbsp;<span class="op" id="1417770">&amp;&amp;</span>&nbsp;<span class="op" id="1417773">!</span><span class="ident" id="1417774">r1</span><span class="op" id="1417776">.</span><span class="ident" id="1417777">Close</span>&nbsp;<span class="op" id="1417783">&amp;&amp;</span>&nbsp;<span class="ident" id="1417786">r1</span><span class="op" id="1417788">.</span><span class="ident" id="1417789">ProtoAtLeast</span><span class="op" id="1417801">(</span><span class="num" id="1417802">1</span><span class="op" id="1417803">,</span>&nbsp;<span class="num" id="1417805">1</span><span class="op" id="1417806">)</span>&nbsp;<span class="op" id="1417808">&amp;&amp;</span>&nbsp;<span class="op" id="1417811">!</span><span class="ident" id="1417812">chunked</span><span class="op" id="1417819">(</span><span class="ident" id="1417820">r1</span><span class="op" id="1417822">.</span><span class="ident" id="1417823">TransferEncoding</span><span class="op" id="1417839">)</span>&nbsp;<span class="op" id="1417841">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1417845">r1</span><span class="op" id="1417847">.</span><span class="ident" id="1417848">Close</span>&nbsp;<span class="op" id="1417854">=</span>&nbsp;<span class="builtintype" id="1417856">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1417862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1417866">//&nbsp;Process&nbsp;Body,ContentLength,Close,Trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1417911">tw</span><span class="op" id="1417913">,</span>&nbsp;<span class="ident" id="1417915">err</span>&nbsp;<span class="op" id="1417919">:=</span>&nbsp;<span class="ident" id="1417922">newTransferWriter</span><span class="op" id="1417939">(</span><span class="ident" id="1417940">r1</span><span class="op" id="1417942">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1417945">if</span>&nbsp;<span class="ident" id="1417948">err</span>&nbsp;<span class="op" id="1417952">!=</span>&nbsp;<span class="ident" id="1417955">nil</span>&nbsp;<span class="op" id="1417959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1417963">return</span>&nbsp;<span class="ident" id="1417970">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1417975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1417978">err</span>&nbsp;<span class="op" id="1417982">=</span>&nbsp;<span class="ident" id="1417984">tw</span><span class="op" id="1417986">.</span><span class="ident" id="1417987">WriteHeader</span><span class="op" id="1417998">(</span><span class="ident" id="1417999">w</span><span class="op" id="1418000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1418003">if</span>&nbsp;<span class="ident" id="1418006">err</span>&nbsp;<span class="op" id="1418010">!=</span>&nbsp;<span class="ident" id="1418013">nil</span>&nbsp;<span class="op" id="1418017">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1418021">return</span>&nbsp;<span class="ident" id="1418028">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1418033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1418037">//&nbsp;Rest&nbsp;of&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1418056">err</span>&nbsp;<span class="op" id="1418060">=</span>&nbsp;<span class="ident" id="1418062">r</span><span class="op" id="1418063">.</span><span class="ident" id="1418064">Header</span><span class="op" id="1418070">.</span><span class="ident" id="1418071">WriteSubset</span><span class="op" id="1418082">(</span><span class="ident" id="1418083">w</span><span class="op" id="1418084">,</span>&nbsp;<span class="ident" id="1418086">respExcludeHeader</span><span class="op" id="1418103">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1418106">if</span>&nbsp;<span class="ident" id="1418109">err</span>&nbsp;<span class="op" id="1418113">!=</span>&nbsp;<span class="ident" id="1418116">nil</span>&nbsp;<span class="op" id="1418120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1418124">return</span>&nbsp;<span class="ident" id="1418131">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1418136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1418140">//&nbsp;contentLengthAlreadySent&nbsp;may&nbsp;have&nbsp;been&nbsp;already&nbsp;sent&nbsp;for</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1418200">//&nbsp;POST/PUT&nbsp;requests,&nbsp;even&nbsp;if&nbsp;zero&nbsp;length.&nbsp;See&nbsp;Issue&nbsp;8180.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1418260">contentLengthAlreadySent</span>&nbsp;<span class="op" id="1418285">:=</span>&nbsp;<span class="ident" id="1418288">tw</span><span class="op" id="1418290">.</span><span class="ident" id="1418291">shouldSendContentLength</span><span class="op" id="1418314">(</span><span class="op" id="1418315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1418318">if</span>&nbsp;<span class="ident" id="1418321">r1</span><span class="op" id="1418323">.</span><span class="ident" id="1418324">ContentLength</span>&nbsp;<span class="op" id="1418338">==</span>&nbsp;<span class="num" id="1418341">0</span>&nbsp;<span class="op" id="1418343">&amp;&amp;</span>&nbsp;<span class="op" id="1418346">!</span><span class="ident" id="1418347">chunked</span><span class="op" id="1418354">(</span><span class="ident" id="1418355">r1</span><span class="op" id="1418357">.</span><span class="ident" id="1418358">TransferEncoding</span><span class="op" id="1418374">)</span>&nbsp;<span class="op" id="1418376">&amp;&amp;</span>&nbsp;<span class="op" id="1418379">!</span><span class="ident" id="1418380">contentLengthAlreadySent</span>&nbsp;<span class="op" id="1418405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1418409">if</span>&nbsp;<span class="ident" id="1418412">_</span><span class="op" id="1418413">,</span>&nbsp;<span class="ident" id="1418415">err</span>&nbsp;<span class="op" id="1418419">:=</span>&nbsp;<span class="ident" id="1418422">io</span><span class="op" id="1418424">.</span><span class="ident" id="1418425">WriteString</span><span class="op" id="1418436">(</span><span class="ident" id="1418437">w</span><span class="op" id="1418438">,</span>&nbsp;<span class="string" id="1418440">&#34;Content-Length:&nbsp;0\r\n&#34;</span><span class="op" id="1418463">)</span><span class="op" id="1418464">;</span>&nbsp;<span class="ident" id="1418466">err</span>&nbsp;<span class="op" id="1418470">!=</span>&nbsp;<span class="ident" id="1418473">nil</span>&nbsp;<span class="op" id="1418477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1418482">return</span>&nbsp;<span class="ident" id="1418489">err</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1418495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1418498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1418502">//&nbsp;End-of-header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1418520">if</span>&nbsp;<span class="ident" id="1418523">_</span><span class="op" id="1418524">,</span>&nbsp;<span class="ident" id="1418526">err</span>&nbsp;<span class="op" id="1418530">:=</span>&nbsp;<span class="ident" id="1418533">io</span><span class="op" id="1418535">.</span><span class="ident" id="1418536">WriteString</span><span class="op" id="1418547">(</span><span class="ident" id="1418548">w</span><span class="op" id="1418549">,</span>&nbsp;<span class="string" id="1418551">&#34;\r\n&#34;</span><span class="op" id="1418557">)</span><span class="op" id="1418558">;</span>&nbsp;<span class="ident" id="1418560">err</span>&nbsp;<span class="op" id="1418564">!=</span>&nbsp;<span class="ident" id="1418567">nil</span>&nbsp;<span class="op" id="1418571">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1418575">return</span>&nbsp;<span class="ident" id="1418582">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1418587">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1418591">//&nbsp;Write&nbsp;body&nbsp;and&nbsp;trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1418618">err</span>&nbsp;<span class="op" id="1418622">=</span>&nbsp;<span class="ident" id="1418624">tw</span><span class="op" id="1418626">.</span><span class="ident" id="1418627">WriteBody</span><span class="op" id="1418636">(</span><span class="ident" id="1418637">w</span><span class="op" id="1418638">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1418641">if</span>&nbsp;<span class="ident" id="1418644">err</span>&nbsp;<span class="op" id="1418648">!=</span>&nbsp;<span class="ident" id="1418651">nil</span>&nbsp;<span class="op" id="1418655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1418659">return</span>&nbsp;<span class="ident" id="1418666">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1418671">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1418675">//&nbsp;Success</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1418687">return</span>&nbsp;<span class="ident" id="1418694">nil</span><br>
<span class="lineno"></span><span class="op" id="1418698">}</span>
</div>
</body>
</html>
