<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="449873">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="449928">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="449982">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="450033">package</span>&nbsp;<span class="ident" id="450041">http_test</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="450052">import</span>&nbsp;<span class="op" id="450059">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="450062">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="450069">&#34;net/http&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="450081">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="450087">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="450098">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="450106">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="450117">&#34;testing&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="450128">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="450135">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="450138">func</span>&nbsp;<span class="ident" id="450143">TestMain</span><span class="op" id="450151">(</span><span class="ident" id="450152">m</span>&nbsp;<span class="op" id="450154">*</span><span class="ident" id="450155"><a href="/net/http/main_test.go.html#450117">testing</a></span><span class="op" id="450162">.</span><span class="ident" id="450163">M</span><span class="op" id="450164">)</span>&nbsp;<span class="op" id="450166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="450169">v</span>&nbsp;<span class="op" id="450171">:=</span>&nbsp;<span class="ident" id="450174"><a href="/net/http/main_test.go.html#450152">m</a></span><span class="op" id="450175">.</span><span class="ident" id="450176">Run</span><span class="op" id="450179">(</span><span class="op" id="450180">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="450183">if</span>&nbsp;<span class="ident" id="450186"><a href="/net/http/main_test.go.html#450169">v</a></span>&nbsp;<span class="op" id="450188">==</span>&nbsp;<span class="num" id="450191">0</span>&nbsp;<span class="op" id="450193">&amp;&amp;</span>&nbsp;<span class="ident" id="450196"><a href="/net/http/main_test.go.html#451198">goroutineLeaked</a></span><span class="op" id="450211">(</span><span class="op" id="450212">)</span>&nbsp;<span class="op" id="450214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="450218"><a href="/net/http/main_test.go.html#450081">os</a></span><span class="op" id="450220">.</span><span class="ident" id="450221">Exit</span><span class="op" id="450225">(</span><span class="num" id="450226">1</span><span class="op" id="450227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="450230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="450233"><a href="/net/http/main_test.go.html#450081">os</a></span><span class="op" id="450235">.</span><span class="ident" id="450236">Exit</span><span class="op" id="450240">(</span><span class="ident" id="450241"><a href="/net/http/main_test.go.html#450169">v</a></span><span class="op" id="450242">)</span><br>
<span class="lineno"></span><span class="op" id="450244">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="450247">func</span>&nbsp;<span class="ident" id="450252">interestingGoroutines</span><span class="op" id="450273">(</span><span class="op" id="450274">)</span>&nbsp;<span class="op" id="450276">(</span><span class="ident" id="450277">gs</span>&nbsp;<span class="op" id="450280">[</span><span class="op" id="450281">]</span><span class="builtintype" id="450282">string</span><span class="op" id="450288">)</span>&nbsp;<span class="op" id="450290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="450293">buf</span>&nbsp;<span class="op" id="450297">:=</span>&nbsp;<span class="builtinfunc" id="450300">make</span><span class="op" id="450304">(</span><span class="op" id="450305">[</span><span class="op" id="450306">]</span><span class="builtintype" id="450307">byte</span><span class="op" id="450311">,</span>&nbsp;<span class="num" id="450313">2</span><span class="op" id="450314">&lt;&lt;</span><span class="num" id="450316">20</span><span class="op" id="450318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="450321"><a href="/net/http/main_test.go.html#450293">buf</a></span>&nbsp;<span class="op" id="450325">=</span>&nbsp;<span class="ident" id="450327"><a href="/net/http/main_test.go.html#450293">buf</a></span><span class="op" id="450330">[</span><span class="op" id="450331">:</span><span class="ident" id="450332"><a href="/net/http/main_test.go.html#450087">runtime</a></span><span class="op" id="450339">.</span><span class="ident" id="450340">Stack</span><span class="op" id="450345">(</span><span class="ident" id="450346"><a href="/net/http/main_test.go.html#450293">buf</a></span><span class="op" id="450349">,</span>&nbsp;<span class="ident" id="450351">true</span><span class="op" id="450355">)</span><span class="op" id="450356">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="450359">for</span>&nbsp;<span class="ident" id="450363">_</span><span class="op" id="450364">,</span>&nbsp;<span class="ident" id="450366">g</span>&nbsp;<span class="op" id="450368">:=</span>&nbsp;<span class="keyword" id="450371">range</span>&nbsp;<span class="ident" id="450377"><a href="/net/http/main_test.go.html#450106">strings</a></span><span class="op" id="450384">.</span><span class="ident" id="450385">Split</span><span class="op" id="450390">(</span><span class="builtintype" id="450391">string</span><span class="op" id="450397">(</span><span class="ident" id="450398"><a href="/net/http/main_test.go.html#450293">buf</a></span><span class="op" id="450401">)</span><span class="op" id="450402">,</span>&nbsp;<span class="string" id="450404">&#34;\n\n&#34;</span><span class="op" id="450410">)</span>&nbsp;<span class="op" id="450412">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="450416">sl</span>&nbsp;<span class="op" id="450419">:=</span>&nbsp;<span class="ident" id="450422"><a href="/net/http/main_test.go.html#450106">strings</a></span><span class="op" id="450429">.</span><span class="ident" id="450430">SplitN</span><span class="op" id="450436">(</span><span class="ident" id="450437"><a href="/net/http/main_test.go.html#450366">g</a></span><span class="op" id="450438">,</span>&nbsp;<span class="string" id="450440">&#34;\n&#34;</span><span class="op" id="450444">,</span>&nbsp;<span class="num" id="450446">2</span><span class="op" id="450447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="450451">if</span>&nbsp;<span class="builtinfunc" id="450454">len</span><span class="op" id="450457">(</span><span class="ident" id="450458"><a href="/net/http/main_test.go.html#450416">sl</a></span><span class="op" id="450460">)</span>&nbsp;<span class="op" id="450462">!=</span>&nbsp;<span class="num" id="450465">2</span>&nbsp;<span class="op" id="450467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="450472">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="450483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="450487">stack</span>&nbsp;<span class="op" id="450493">:=</span>&nbsp;<span class="ident" id="450496"><a href="/net/http/main_test.go.html#450106">strings</a></span><span class="op" id="450503">.</span><span class="ident" id="450504">TrimSpace</span><span class="op" id="450513">(</span><span class="ident" id="450514"><a href="/net/http/main_test.go.html#450416">sl</a></span><span class="op" id="450516">[</span><span class="num" id="450517">1</span><span class="op" id="450518">]</span><span class="op" id="450519">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="450523">if</span>&nbsp;<span class="ident" id="450526"><a href="/net/http/main_test.go.html#450487">stack</a></span>&nbsp;<span class="op" id="450532">==</span>&nbsp;<span class="string" id="450535">&#34;&#34;</span>&nbsp;<span class="op" id="450538">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="450544"><a href="/net/http/main_test.go.html#450106">strings</a></span><span class="op" id="450551">.</span><span class="ident" id="450552">Contains</span><span class="op" id="450560">(</span><span class="ident" id="450561"><a href="/net/http/main_test.go.html#450487">stack</a></span><span class="op" id="450566">,</span>&nbsp;<span class="string" id="450568">&#34;created&nbsp;by&nbsp;net.startServer&#34;</span><span class="op" id="450596">)</span>&nbsp;<span class="op" id="450598">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="450604"><a href="/net/http/main_test.go.html#450106">strings</a></span><span class="op" id="450611">.</span><span class="ident" id="450612">Contains</span><span class="op" id="450620">(</span><span class="ident" id="450621"><a href="/net/http/main_test.go.html#450487">stack</a></span><span class="op" id="450626">,</span>&nbsp;<span class="string" id="450628">&#34;created&nbsp;by&nbsp;testing.RunTests&#34;</span><span class="op" id="450657">)</span>&nbsp;<span class="op" id="450659">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="450665"><a href="/net/http/main_test.go.html#450106">strings</a></span><span class="op" id="450672">.</span><span class="ident" id="450673">Contains</span><span class="op" id="450681">(</span><span class="ident" id="450682"><a href="/net/http/main_test.go.html#450487">stack</a></span><span class="op" id="450687">,</span>&nbsp;<span class="string" id="450689">&#34;closeWriteAndWait&#34;</span><span class="op" id="450708">)</span>&nbsp;<span class="op" id="450710">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="450716"><a href="/net/http/main_test.go.html#450106">strings</a></span><span class="op" id="450723">.</span><span class="ident" id="450724">Contains</span><span class="op" id="450732">(</span><span class="ident" id="450733"><a href="/net/http/main_test.go.html#450487">stack</a></span><span class="op" id="450738">,</span>&nbsp;<span class="string" id="450740">&#34;testing.Main(&#34;</span><span class="op" id="450755">)</span>&nbsp;<span class="op" id="450757">||</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="450763">//&nbsp;These&nbsp;only&nbsp;show&nbsp;up&nbsp;with&nbsp;GOTRACEBACK=2;&nbsp;Issue&nbsp;5005&nbsp;(comment&nbsp;28)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="450832"><a href="/net/http/main_test.go.html#450106">strings</a></span><span class="op" id="450839">.</span><span class="ident" id="450840">Contains</span><span class="op" id="450848">(</span><span class="ident" id="450849"><a href="/net/http/main_test.go.html#450487">stack</a></span><span class="op" id="450854">,</span>&nbsp;<span class="string" id="450856">&#34;runtime.goexit&#34;</span><span class="op" id="450872">)</span>&nbsp;<span class="op" id="450874">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="450880"><a href="/net/http/main_test.go.html#450106">strings</a></span><span class="op" id="450887">.</span><span class="ident" id="450888">Contains</span><span class="op" id="450896">(</span><span class="ident" id="450897"><a href="/net/http/main_test.go.html#450487">stack</a></span><span class="op" id="450902">,</span>&nbsp;<span class="string" id="450904">&#34;created&nbsp;by&nbsp;runtime.gc&#34;</span><span class="op" id="450927">)</span>&nbsp;<span class="op" id="450929">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="450935"><a href="/net/http/main_test.go.html#450106">strings</a></span><span class="op" id="450942">.</span><span class="ident" id="450943">Contains</span><span class="op" id="450951">(</span><span class="ident" id="450952"><a href="/net/http/main_test.go.html#450487">stack</a></span><span class="op" id="450957">,</span>&nbsp;<span class="string" id="450959">&#34;net/http_test.interestingGoroutines&#34;</span><span class="op" id="450996">)</span>&nbsp;<span class="op" id="450998">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="451004"><a href="/net/http/main_test.go.html#450106">strings</a></span><span class="op" id="451011">.</span><span class="ident" id="451012">Contains</span><span class="op" id="451020">(</span><span class="ident" id="451021"><a href="/net/http/main_test.go.html#450487">stack</a></span><span class="op" id="451026">,</span>&nbsp;<span class="string" id="451028">&#34;runtime.MHeap_Scavenger&#34;</span><span class="op" id="451053">)</span>&nbsp;<span class="op" id="451055">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="451060">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="451071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="451075"><a href="/net/http/main_test.go.html#450277">gs</a></span>&nbsp;<span class="op" id="451078">=</span>&nbsp;<span class="builtinfunc" id="451080">append</span><span class="op" id="451086">(</span><span class="ident" id="451087"><a href="/net/http/main_test.go.html#450277">gs</a></span><span class="op" id="451089">,</span>&nbsp;<span class="ident" id="451091"><a href="/net/http/main_test.go.html#450487">stack</a></span><span class="op" id="451096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="451099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="451102"><a href="/net/http/main_test.go.html#450098">sort</a></span><span class="op" id="451106">.</span><span class="ident" id="451107">Strings</span><span class="op" id="451114">(</span><span class="ident" id="451115"><a href="/net/http/main_test.go.html#450277">gs</a></span><span class="op" id="451117">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="451120">return</span><br>
<span class="lineno"></span><span class="op" id="451127">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="451130">//&nbsp;Verify&nbsp;the&nbsp;other&nbsp;tests&nbsp;didn&#39;t&nbsp;leave&nbsp;any&nbsp;goroutines&nbsp;running.</span><br>
<span class="lineno"></span><span class="keyword" id="451193">func</span>&nbsp;<span class="ident" id="451198">goroutineLeaked</span><span class="op" id="451213">(</span><span class="op" id="451214">)</span>&nbsp;<span class="builtintype" id="451216">bool</span>&nbsp;<span class="op" id="451221">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="451224">if</span>&nbsp;<span class="ident" id="451227"><a href="/net/http/main_test.go.html#450117">testing</a></span><span class="op" id="451234">.</span><span class="ident" id="451235">Short</span><span class="op" id="451240">(</span><span class="op" id="451241">)</span>&nbsp;<span class="op" id="451243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="451247">//&nbsp;not&nbsp;counting&nbsp;goroutines&nbsp;for&nbsp;leakage&nbsp;in&nbsp;-short&nbsp;mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="451303">return</span>&nbsp;<span class="ident" id="451310">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="451317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="451320">gs</span>&nbsp;<span class="op" id="451323">:=</span>&nbsp;<span class="ident" id="451326"><a href="/net/http/main_test.go.html#450252">interestingGoroutines</a></span><span class="op" id="451347">(</span><span class="op" id="451348">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="451352">n</span>&nbsp;<span class="op" id="451354">:=</span>&nbsp;<span class="num" id="451357">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="451360">stackCount</span>&nbsp;<span class="op" id="451371">:=</span>&nbsp;<span class="builtinfunc" id="451374">make</span><span class="op" id="451378">(</span><span class="keyword" id="451379">map</span><span class="op" id="451382">[</span><span class="builtintype" id="451383">string</span><span class="op" id="451389">]</span><span class="builtintype" id="451390">int</span><span class="op" id="451393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="451396">for</span>&nbsp;<span class="ident" id="451400">_</span><span class="op" id="451401">,</span>&nbsp;<span class="ident" id="451403">g</span>&nbsp;<span class="op" id="451405">:=</span>&nbsp;<span class="keyword" id="451408">range</span>&nbsp;<span class="ident" id="451414"><a href="/net/http/main_test.go.html#451320">gs</a></span>&nbsp;<span class="op" id="451417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="451421"><a href="/net/http/main_test.go.html#451360">stackCount</a></span><span class="op" id="451431">[</span><span class="ident" id="451432"><a href="/net/http/main_test.go.html#451403">g</a></span><span class="op" id="451433">]</span><span class="op" id="451434">++</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="451439"><a href="/net/http/main_test.go.html#451352">n</a></span><span class="op" id="451440">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="451444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="451448">if</span>&nbsp;<span class="ident" id="451451"><a href="/net/http/main_test.go.html#451352">n</a></span>&nbsp;<span class="op" id="451453">==</span>&nbsp;<span class="num" id="451456">0</span>&nbsp;<span class="op" id="451458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="451462">return</span>&nbsp;<span class="ident" id="451469">false</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="451476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="451479"><a href="/net/http/main_test.go.html#450062">fmt</a></span><span class="op" id="451482">.</span><span class="ident" id="451483">Fprintf</span><span class="op" id="451490">(</span><span class="ident" id="451491"><a href="/net/http/main_test.go.html#450081">os</a></span><span class="op" id="451493">.</span><span class="ident" id="451494">Stderr</span><span class="op" id="451500">,</span>&nbsp;<span class="string" id="451502">&#34;Too&nbsp;many&nbsp;goroutines&nbsp;running&nbsp;after&nbsp;net/http&nbsp;test(s).\n&#34;</span><span class="op" id="451557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="451560">for</span>&nbsp;<span class="ident" id="451564">stack</span><span class="op" id="451569">,</span>&nbsp;<span class="ident" id="451571">count</span>&nbsp;<span class="op" id="451577">:=</span>&nbsp;<span class="keyword" id="451580">range</span>&nbsp;<span class="ident" id="451586"><a href="/net/http/main_test.go.html#451360">stackCount</a></span>&nbsp;<span class="op" id="451597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="451601"><a href="/net/http/main_test.go.html#450062">fmt</a></span><span class="op" id="451604">.</span><span class="ident" id="451605">Fprintf</span><span class="op" id="451612">(</span><span class="ident" id="451613"><a href="/net/http/main_test.go.html#450081">os</a></span><span class="op" id="451615">.</span><span class="ident" id="451616">Stderr</span><span class="op" id="451622">,</span>&nbsp;<span class="string" id="451624">&#34;%d&nbsp;instances&nbsp;of:\n%s\n&#34;</span><span class="op" id="451648">,</span>&nbsp;<span class="ident" id="451650"><a href="/net/http/main_test.go.html#451571">count</a></span><span class="op" id="451655">,</span>&nbsp;<span class="ident" id="451657"><a href="/net/http/main_test.go.html#451564">stack</a></span><span class="op" id="451662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="451665">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="451668">return</span>&nbsp;<span class="ident" id="451675">true</span><br>
<span class="lineno"></span><span class="op" id="451680">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="451683">func</span>&nbsp;<span class="ident" id="451688">afterTest</span><span class="op" id="451697">(</span><span class="ident" id="451698">t</span>&nbsp;<span class="op" id="451700">*</span><span class="ident" id="451701"><a href="/net/http/main_test.go.html#450117">testing</a></span><span class="op" id="451708">.</span><span class="ident" id="451709">T</span><span class="op" id="451710">)</span>&nbsp;<span class="op" id="451712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="451715"><a href="/net/http/main_test.go.html#450069">http</a></span><span class="op" id="451719">.</span><span class="ident" id="451720">DefaultTransport</span><span class="op" id="451736">.</span><span class="op" id="451737">(</span><span class="op" id="451738">*</span><span class="ident" id="451739"><a href="/net/http/main_test.go.html#450069">http</a></span><span class="op" id="451743">.</span><span class="ident" id="451744">Transport</span><span class="op" id="451753">)</span><span class="op" id="451754">.</span><span class="ident" id="451755">CloseIdleConnections</span><span class="op" id="451775">(</span><span class="op" id="451776">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="451779">if</span>&nbsp;<span class="ident" id="451782"><a href="/net/http/main_test.go.html#450117">testing</a></span><span class="op" id="451789">.</span><span class="ident" id="451790">Short</span><span class="op" id="451795">(</span><span class="op" id="451796">)</span>&nbsp;<span class="op" id="451798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="451802">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="451810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="451813">var</span>&nbsp;<span class="ident" id="451817">bad</span>&nbsp;<span class="builtintype" id="451821">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="451829">badSubstring</span>&nbsp;<span class="op" id="451842">:=</span>&nbsp;<span class="keyword" id="451845">map</span><span class="op" id="451848">[</span><span class="builtintype" id="451849">string</span><span class="op" id="451855">]</span><span class="builtintype" id="451856">string</span><span class="op" id="451862">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="451866">&#34;).readLoop(&#34;</span><span class="op" id="451879">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="451914">&#34;a&nbsp;Transport&#34;</span><span class="op" id="451927">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="451931">&#34;).writeLoop(&#34;</span><span class="op" id="451945">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="451979">&#34;a&nbsp;Transport&#34;</span><span class="op" id="451992">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="451996">&#34;created&nbsp;by&nbsp;net/http/httptest.(*Server).Start&#34;</span><span class="op" id="452042">:</span>&nbsp;<span class="string" id="452044">&#34;an&nbsp;httptest.Server&#34;</span><span class="op" id="452064">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="452068">&#34;timeoutHandler&#34;</span><span class="op" id="452084">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="452116">&#34;a&nbsp;TimeoutHandler&#34;</span><span class="op" id="452134">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="452138">&#34;net.(*netFD).connect(&#34;</span><span class="op" id="452161">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="452186">&#34;a&nbsp;timing&nbsp;out&nbsp;dial&#34;</span><span class="op" id="452205">,</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="452209">&#34;).noteClientGone(&#34;</span><span class="op" id="452228">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="452257">&#34;a&nbsp;closenotifier&nbsp;sender&#34;</span><span class="op" id="452281">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="452284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="452287">var</span>&nbsp;<span class="ident" id="452291">stacks</span>&nbsp;<span class="builtintype" id="452298">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="452306">for</span>&nbsp;<span class="ident" id="452310">i</span>&nbsp;<span class="op" id="452312">:=</span>&nbsp;<span class="num" id="452315">0</span><span class="op" id="452316">;</span>&nbsp;<span class="ident" id="452318"><a href="/net/http/main_test.go.html#452310">i</a></span>&nbsp;<span class="op" id="452320">&lt;</span>&nbsp;<span class="num" id="452322">4</span><span class="op" id="452323">;</span>&nbsp;<span class="ident" id="452325"><a href="/net/http/main_test.go.html#452310">i</a></span><span class="op" id="452326">++</span>&nbsp;<span class="op" id="452329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="452333"><a href="/net/http/main_test.go.html#451817">bad</a></span>&nbsp;<span class="op" id="452337">=</span>&nbsp;<span class="string" id="452339">&#34;&#34;</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="452344"><a href="/net/http/main_test.go.html#452291">stacks</a></span>&nbsp;<span class="op" id="452351">=</span>&nbsp;<span class="ident" id="452353"><a href="/net/http/main_test.go.html#450106">strings</a></span><span class="op" id="452360">.</span><span class="ident" id="452361">Join</span><span class="op" id="452365">(</span><span class="ident" id="452366"><a href="/net/http/main_test.go.html#450252">interestingGoroutines</a></span><span class="op" id="452387">(</span><span class="op" id="452388">)</span><span class="op" id="452389">,</span>&nbsp;<span class="string" id="452391">&#34;\n\n&#34;</span><span class="op" id="452397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="452401">for</span>&nbsp;<span class="ident" id="452405">substr</span><span class="op" id="452411">,</span>&nbsp;<span class="ident" id="452413">what</span>&nbsp;<span class="op" id="452418">:=</span>&nbsp;<span class="keyword" id="452421">range</span>&nbsp;<span class="ident" id="452427"><a href="/net/http/main_test.go.html#451829">badSubstring</a></span>&nbsp;<span class="op" id="452440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="452445">if</span>&nbsp;<span class="ident" id="452448"><a href="/net/http/main_test.go.html#450106">strings</a></span><span class="op" id="452455">.</span><span class="ident" id="452456">Contains</span><span class="op" id="452464">(</span><span class="ident" id="452465"><a href="/net/http/main_test.go.html#452291">stacks</a></span><span class="op" id="452471">,</span>&nbsp;<span class="ident" id="452473"><a href="/net/http/main_test.go.html#452405">substr</a></span><span class="op" id="452479">)</span>&nbsp;<span class="op" id="452481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="452487"><a href="/net/http/main_test.go.html#451817">bad</a></span>&nbsp;<span class="op" id="452491">=</span>&nbsp;<span class="ident" id="452493"><a href="/net/http/main_test.go.html#452413">what</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="452501">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="452505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="452509">if</span>&nbsp;<span class="ident" id="452512"><a href="/net/http/main_test.go.html#451817">bad</a></span>&nbsp;<span class="op" id="452516">==</span>&nbsp;<span class="string" id="452519">&#34;&#34;</span>&nbsp;<span class="op" id="452522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="452527">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="452536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="452540">//&nbsp;Bad&nbsp;stuff&nbsp;found,&nbsp;but&nbsp;goroutines&nbsp;might&nbsp;just&nbsp;still&nbsp;be</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="452597">//&nbsp;shutting&nbsp;down,&nbsp;so&nbsp;give&nbsp;it&nbsp;some&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="452639"><a href="/net/http/main_test.go.html#450128">time</a></span><span class="op" id="452643">.</span><span class="ident" id="452644">Sleep</span><span class="op" id="452649">(</span><span class="num" id="452650">250</span>&nbsp;<span class="op" id="452654">*</span>&nbsp;<span class="ident" id="452656"><a href="/net/http/main_test.go.html#450128">time</a></span><span class="op" id="452660">.</span><span class="ident" id="452661">Millisecond</span><span class="op" id="452672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="452675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="452678"><a href="/net/http/main_test.go.html#451698">t</a></span><span class="op" id="452679">.</span><span class="ident" id="452680">Errorf</span><span class="op" id="452686">(</span><span class="string" id="452687">&#34;Test&nbsp;appears&nbsp;to&nbsp;have&nbsp;leaked&nbsp;%s:\n%s&#34;</span><span class="op" id="452724">,</span>&nbsp;<span class="ident" id="452726"><a href="/net/http/main_test.go.html#451817">bad</a></span><span class="op" id="452729">,</span>&nbsp;<span class="ident" id="452731"><a href="/net/http/main_test.go.html#452291">stacks</a></span><span class="op" id="452737">)</span><br>
<span class="lineno"></span><span class="op" id="452739">}</span>
</div>
</body>
</html>
