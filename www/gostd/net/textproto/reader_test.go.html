<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/textproto</h2>
<ul>
<li><a href="/gostd/net/textproto/header.go.html">header.go</a></li>
<li><a href="/gostd/net/textproto/pipeline.go.html">pipeline.go</a></li>
<li><a href="/gostd/net/textproto/reader.go.html">reader.go</a></li>
<li><a href="/gostd/net/textproto/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/net/textproto/textproto.go.html">textproto.go</a></li>
<li><a href="/gostd/net/textproto/writer.go.html">writer.go</a></li>
<li><a href="/gostd/net/textproto/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7071348">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7071404">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7071458">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7071509">package</span>&nbsp;<span class="ident" id="7071517">textproto</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7071528">import</span>&nbsp;<span class="op" id="7071535">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7071538">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7071547">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7071556">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7071562">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7071573">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7071584">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7071594">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="7071597">type</span>&nbsp;<span class="ident" id="7071602">canonicalHeaderKeyTest</span>&nbsp;<span class="keyword" id="7071625">struct</span>&nbsp;<span class="op" id="7071632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7071635">in</span><span class="op" id="7071637">,</span>&nbsp;<span class="ident" id="7071639">out</span>&nbsp;<span class="builtintype" id="7071643">string</span><br>
<span class="lineno"></span><span class="op" id="7071650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="7071653">var</span>&nbsp;<span class="ident" id="7071657">canonicalHeaderKeyTests</span>&nbsp;<span class="op" id="7071681">=</span>&nbsp;<span class="op" id="7071683">[</span><span class="op" id="7071684">]</span><span class="ident" id="7071685">canonicalHeaderKeyTest</span><span class="op" id="7071707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7071710">{</span><span class="string" id="7071711">&#34;a-b-c&#34;</span><span class="op" id="7071718">,</span>&nbsp;<span class="string" id="7071720">&#34;A-B-C&#34;</span><span class="op" id="7071727">}</span><span class="op" id="7071728">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7071731">{</span><span class="string" id="7071732">&#34;a-1-c&#34;</span><span class="op" id="7071739">,</span>&nbsp;<span class="string" id="7071741">&#34;A-1-C&#34;</span><span class="op" id="7071748">}</span><span class="op" id="7071749">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7071752">{</span><span class="string" id="7071753">&#34;User-Agent&#34;</span><span class="op" id="7071765">,</span>&nbsp;<span class="string" id="7071767">&#34;User-Agent&#34;</span><span class="op" id="7071779">}</span><span class="op" id="7071780">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7071783">{</span><span class="string" id="7071784">&#34;uSER-aGENT&#34;</span><span class="op" id="7071796">,</span>&nbsp;<span class="string" id="7071798">&#34;User-Agent&#34;</span><span class="op" id="7071810">}</span><span class="op" id="7071811">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7071814">{</span><span class="string" id="7071815">&#34;user-agent&#34;</span><span class="op" id="7071827">,</span>&nbsp;<span class="string" id="7071829">&#34;User-Agent&#34;</span><span class="op" id="7071841">}</span><span class="op" id="7071842">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7071845">{</span><span class="string" id="7071846">&#34;USER-AGENT&#34;</span><span class="op" id="7071858">,</span>&nbsp;<span class="string" id="7071860">&#34;User-Agent&#34;</span><span class="op" id="7071872">}</span><span class="op" id="7071873">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7071876">{</span><span class="string" id="7071877">&#34;üser-agenT&#34;</span><span class="op" id="7071890">,</span>&nbsp;<span class="string" id="7071892">&#34;üser-Agent&#34;</span><span class="op" id="7071905">}</span><span class="op" id="7071906">,</span>&nbsp;<span class="comment" id="7071908">//&nbsp;non-ASCII&nbsp;unchanged</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7071933">//&nbsp;This&nbsp;caused&nbsp;a&nbsp;panic&nbsp;due&nbsp;to&nbsp;mishandling&nbsp;of&nbsp;a&nbsp;space:</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7071988">{</span><span class="string" id="7071989">&#34;C&nbsp;Ontent-Transfer-Encoding&#34;</span><span class="op" id="7072017">,</span>&nbsp;<span class="string" id="7072019">&#34;C-Ontent-Transfer-Encoding&#34;</span><span class="op" id="7072047">}</span><span class="op" id="7072048">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7072051">{</span><span class="string" id="7072052">&#34;foo&nbsp;bar&#34;</span><span class="op" id="7072061">,</span>&nbsp;<span class="string" id="7072063">&#34;Foo-Bar&#34;</span><span class="op" id="7072072">}</span><span class="op" id="7072073">,</span><br>
<span class="lineno"></span><span class="op" id="7072075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7072078">func</span>&nbsp;<span class="ident" id="7072083">TestCanonicalMIMEHeaderKey</span><span class="op" id="7072109">(</span><span class="ident" id="7072110">t</span>&nbsp;<span class="op" id="7072112">*</span><span class="ident" id="7072113">testing</span><span class="op" id="7072120">.</span><span class="ident" id="7072121">T</span><span class="op" id="7072122">)</span>&nbsp;<span class="op" id="7072124">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7072127">for</span>&nbsp;<span class="ident" id="7072131">_</span><span class="op" id="7072132">,</span>&nbsp;<span class="ident" id="7072134">tt</span>&nbsp;<span class="op" id="7072137">:=</span>&nbsp;<span class="keyword" id="7072140">range</span>&nbsp;<span class="ident" id="7072146">canonicalHeaderKeyTests</span>&nbsp;<span class="op" id="7072170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7072174">if</span>&nbsp;<span class="ident" id="7072177">s</span>&nbsp;<span class="op" id="7072179">:=</span>&nbsp;<span class="ident" id="7072182">CanonicalMIMEHeaderKey</span><span class="op" id="7072204">(</span><span class="ident" id="7072205">tt</span><span class="op" id="7072207">.</span><span class="ident" id="7072208">in</span><span class="op" id="7072210">)</span><span class="op" id="7072211">;</span>&nbsp;<span class="ident" id="7072213">s</span>&nbsp;<span class="op" id="7072215">!=</span>&nbsp;<span class="ident" id="7072218">tt</span><span class="op" id="7072220">.</span><span class="ident" id="7072221">out</span>&nbsp;<span class="op" id="7072225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7072230">t</span><span class="op" id="7072231">.</span><span class="ident" id="7072232">Errorf</span><span class="op" id="7072238">(</span><span class="string" id="7072239">&#34;CanonicalMIMEHeaderKey(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7072281">,</span>&nbsp;<span class="ident" id="7072283">tt</span><span class="op" id="7072285">.</span><span class="ident" id="7072286">in</span><span class="op" id="7072288">,</span>&nbsp;<span class="ident" id="7072290">s</span><span class="op" id="7072291">,</span>&nbsp;<span class="ident" id="7072293">tt</span><span class="op" id="7072295">.</span><span class="ident" id="7072296">out</span><span class="op" id="7072299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7072303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7072306">}</span><br>
<span class="lineno">40</span><span class="op" id="7072308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7072311">func</span>&nbsp;<span class="ident" id="7072316">reader</span><span class="op" id="7072322">(</span><span class="ident" id="7072323">s</span>&nbsp;<span class="builtintype" id="7072325">string</span><span class="op" id="7072331">)</span>&nbsp;<span class="op" id="7072333">*</span><span class="ident" id="7072334">Reader</span>&nbsp;<span class="op" id="7072341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7072344">return</span>&nbsp;<span class="ident" id="7072351">NewReader</span><span class="op" id="7072360">(</span><span class="ident" id="7072361">bufio</span><span class="op" id="7072366">.</span><span class="ident" id="7072367">NewReader</span><span class="op" id="7072376">(</span><span class="ident" id="7072377">strings</span><span class="op" id="7072384">.</span><span class="ident" id="7072385">NewReader</span><span class="op" id="7072394">(</span><span class="ident" id="7072395">s</span><span class="op" id="7072396">)</span><span class="op" id="7072397">)</span><span class="op" id="7072398">)</span><br>
<span class="lineno"></span><span class="op" id="7072400">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="7072403">func</span>&nbsp;<span class="ident" id="7072408">TestReadLine</span><span class="op" id="7072420">(</span><span class="ident" id="7072421">t</span>&nbsp;<span class="op" id="7072423">*</span><span class="ident" id="7072424">testing</span><span class="op" id="7072431">.</span><span class="ident" id="7072432">T</span><span class="op" id="7072433">)</span>&nbsp;<span class="op" id="7072435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7072438">r</span>&nbsp;<span class="op" id="7072440">:=</span>&nbsp;<span class="ident" id="7072443">reader</span><span class="op" id="7072449">(</span><span class="string" id="7072450">&#34;line1\nline2\n&#34;</span><span class="op" id="7072466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7072469">s</span><span class="op" id="7072470">,</span>&nbsp;<span class="ident" id="7072472">err</span>&nbsp;<span class="op" id="7072476">:=</span>&nbsp;<span class="ident" id="7072479">r</span><span class="op" id="7072480">.</span><span class="ident" id="7072481">ReadLine</span><span class="op" id="7072489">(</span><span class="op" id="7072490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7072493">if</span>&nbsp;<span class="ident" id="7072496">s</span>&nbsp;<span class="op" id="7072498">!=</span>&nbsp;<span class="string" id="7072501">&#34;line1&#34;</span>&nbsp;<span class="op" id="7072509">||</span>&nbsp;<span class="ident" id="7072512">err</span>&nbsp;<span class="op" id="7072516">!=</span>&nbsp;<span class="ident" id="7072519">nil</span>&nbsp;<span class="op" id="7072523">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7072527">t</span><span class="op" id="7072528">.</span><span class="ident" id="7072529">Fatalf</span><span class="op" id="7072535">(</span><span class="string" id="7072536">&#34;Line&nbsp;1:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7072552">,</span>&nbsp;<span class="ident" id="7072554">s</span><span class="op" id="7072555">,</span>&nbsp;<span class="ident" id="7072557">err</span><span class="op" id="7072560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7072563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7072566">s</span><span class="op" id="7072567">,</span>&nbsp;<span class="ident" id="7072569">err</span>&nbsp;<span class="op" id="7072573">=</span>&nbsp;<span class="ident" id="7072575">r</span><span class="op" id="7072576">.</span><span class="ident" id="7072577">ReadLine</span><span class="op" id="7072585">(</span><span class="op" id="7072586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7072589">if</span>&nbsp;<span class="ident" id="7072592">s</span>&nbsp;<span class="op" id="7072594">!=</span>&nbsp;<span class="string" id="7072597">&#34;line2&#34;</span>&nbsp;<span class="op" id="7072605">||</span>&nbsp;<span class="ident" id="7072608">err</span>&nbsp;<span class="op" id="7072612">!=</span>&nbsp;<span class="ident" id="7072615">nil</span>&nbsp;<span class="op" id="7072619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7072623">t</span><span class="op" id="7072624">.</span><span class="ident" id="7072625">Fatalf</span><span class="op" id="7072631">(</span><span class="string" id="7072632">&#34;Line&nbsp;2:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7072648">,</span>&nbsp;<span class="ident" id="7072650">s</span><span class="op" id="7072651">,</span>&nbsp;<span class="ident" id="7072653">err</span><span class="op" id="7072656">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7072659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7072662">s</span><span class="op" id="7072663">,</span>&nbsp;<span class="ident" id="7072665">err</span>&nbsp;<span class="op" id="7072669">=</span>&nbsp;<span class="ident" id="7072671">r</span><span class="op" id="7072672">.</span><span class="ident" id="7072673">ReadLine</span><span class="op" id="7072681">(</span><span class="op" id="7072682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7072685">if</span>&nbsp;<span class="ident" id="7072688">s</span>&nbsp;<span class="op" id="7072690">!=</span>&nbsp;<span class="string" id="7072693">&#34;&#34;</span>&nbsp;<span class="op" id="7072696">||</span>&nbsp;<span class="ident" id="7072699">err</span>&nbsp;<span class="op" id="7072703">!=</span>&nbsp;<span class="ident" id="7072706">io</span><span class="op" id="7072708">.</span><span class="ident" id="7072709">EOF</span>&nbsp;<span class="op" id="7072713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7072717">t</span><span class="op" id="7072718">.</span><span class="ident" id="7072719">Fatalf</span><span class="op" id="7072725">(</span><span class="string" id="7072726">&#34;EOF:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7072739">,</span>&nbsp;<span class="ident" id="7072741">s</span><span class="op" id="7072742">,</span>&nbsp;<span class="ident" id="7072744">err</span><span class="op" id="7072747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7072750">}</span><br>
<span class="lineno">60</span><span class="op" id="7072752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7072755">func</span>&nbsp;<span class="ident" id="7072760">TestReadContinuedLine</span><span class="op" id="7072781">(</span><span class="ident" id="7072782">t</span>&nbsp;<span class="op" id="7072784">*</span><span class="ident" id="7072785">testing</span><span class="op" id="7072792">.</span><span class="ident" id="7072793">T</span><span class="op" id="7072794">)</span>&nbsp;<span class="op" id="7072796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7072799">r</span>&nbsp;<span class="op" id="7072801">:=</span>&nbsp;<span class="ident" id="7072804">reader</span><span class="op" id="7072810">(</span><span class="string" id="7072811">&#34;line1\nline\n&nbsp;2\nline3\n&#34;</span><span class="op" id="7072837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7072840">s</span><span class="op" id="7072841">,</span>&nbsp;<span class="ident" id="7072843">err</span>&nbsp;<span class="op" id="7072847">:=</span>&nbsp;<span class="ident" id="7072850">r</span><span class="op" id="7072851">.</span><span class="ident" id="7072852">ReadContinuedLine</span><span class="op" id="7072869">(</span><span class="op" id="7072870">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7072873">if</span>&nbsp;<span class="ident" id="7072876">s</span>&nbsp;<span class="op" id="7072878">!=</span>&nbsp;<span class="string" id="7072881">&#34;line1&#34;</span>&nbsp;<span class="op" id="7072889">||</span>&nbsp;<span class="ident" id="7072892">err</span>&nbsp;<span class="op" id="7072896">!=</span>&nbsp;<span class="ident" id="7072899">nil</span>&nbsp;<span class="op" id="7072903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7072907">t</span><span class="op" id="7072908">.</span><span class="ident" id="7072909">Fatalf</span><span class="op" id="7072915">(</span><span class="string" id="7072916">&#34;Line&nbsp;1:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7072932">,</span>&nbsp;<span class="ident" id="7072934">s</span><span class="op" id="7072935">,</span>&nbsp;<span class="ident" id="7072937">err</span><span class="op" id="7072940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7072943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7072946">s</span><span class="op" id="7072947">,</span>&nbsp;<span class="ident" id="7072949">err</span>&nbsp;<span class="op" id="7072953">=</span>&nbsp;<span class="ident" id="7072955">r</span><span class="op" id="7072956">.</span><span class="ident" id="7072957">ReadContinuedLine</span><span class="op" id="7072974">(</span><span class="op" id="7072975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7072978">if</span>&nbsp;<span class="ident" id="7072981">s</span>&nbsp;<span class="op" id="7072983">!=</span>&nbsp;<span class="string" id="7072986">&#34;line&nbsp;2&#34;</span>&nbsp;<span class="op" id="7072995">||</span>&nbsp;<span class="ident" id="7072998">err</span>&nbsp;<span class="op" id="7073002">!=</span>&nbsp;<span class="ident" id="7073005">nil</span>&nbsp;<span class="op" id="7073009">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7073013">t</span><span class="op" id="7073014">.</span><span class="ident" id="7073015">Fatalf</span><span class="op" id="7073021">(</span><span class="string" id="7073022">&#34;Line&nbsp;2:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7073038">,</span>&nbsp;<span class="ident" id="7073040">s</span><span class="op" id="7073041">,</span>&nbsp;<span class="ident" id="7073043">err</span><span class="op" id="7073046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7073049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7073052">s</span><span class="op" id="7073053">,</span>&nbsp;<span class="ident" id="7073055">err</span>&nbsp;<span class="op" id="7073059">=</span>&nbsp;<span class="ident" id="7073061">r</span><span class="op" id="7073062">.</span><span class="ident" id="7073063">ReadContinuedLine</span><span class="op" id="7073080">(</span><span class="op" id="7073081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7073084">if</span>&nbsp;<span class="ident" id="7073087">s</span>&nbsp;<span class="op" id="7073089">!=</span>&nbsp;<span class="string" id="7073092">&#34;line3&#34;</span>&nbsp;<span class="op" id="7073100">||</span>&nbsp;<span class="ident" id="7073103">err</span>&nbsp;<span class="op" id="7073107">!=</span>&nbsp;<span class="ident" id="7073110">nil</span>&nbsp;<span class="op" id="7073114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7073118">t</span><span class="op" id="7073119">.</span><span class="ident" id="7073120">Fatalf</span><span class="op" id="7073126">(</span><span class="string" id="7073127">&#34;Line&nbsp;3:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7073143">,</span>&nbsp;<span class="ident" id="7073145">s</span><span class="op" id="7073146">,</span>&nbsp;<span class="ident" id="7073148">err</span><span class="op" id="7073151">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7073154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7073157">s</span><span class="op" id="7073158">,</span>&nbsp;<span class="ident" id="7073160">err</span>&nbsp;<span class="op" id="7073164">=</span>&nbsp;<span class="ident" id="7073166">r</span><span class="op" id="7073167">.</span><span class="ident" id="7073168">ReadContinuedLine</span><span class="op" id="7073185">(</span><span class="op" id="7073186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7073189">if</span>&nbsp;<span class="ident" id="7073192">s</span>&nbsp;<span class="op" id="7073194">!=</span>&nbsp;<span class="string" id="7073197">&#34;&#34;</span>&nbsp;<span class="op" id="7073200">||</span>&nbsp;<span class="ident" id="7073203">err</span>&nbsp;<span class="op" id="7073207">!=</span>&nbsp;<span class="ident" id="7073210">io</span><span class="op" id="7073212">.</span><span class="ident" id="7073213">EOF</span>&nbsp;<span class="op" id="7073217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7073221">t</span><span class="op" id="7073222">.</span><span class="ident" id="7073223">Fatalf</span><span class="op" id="7073229">(</span><span class="string" id="7073230">&#34;EOF:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7073243">,</span>&nbsp;<span class="ident" id="7073245">s</span><span class="op" id="7073246">,</span>&nbsp;<span class="ident" id="7073248">err</span><span class="op" id="7073251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7073254">}</span><br>
<span class="lineno">80</span><span class="op" id="7073256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7073259">func</span>&nbsp;<span class="ident" id="7073264">TestReadCodeLine</span><span class="op" id="7073280">(</span><span class="ident" id="7073281">t</span>&nbsp;<span class="op" id="7073283">*</span><span class="ident" id="7073284">testing</span><span class="op" id="7073291">.</span><span class="ident" id="7073292">T</span><span class="op" id="7073293">)</span>&nbsp;<span class="op" id="7073295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7073298">r</span>&nbsp;<span class="op" id="7073300">:=</span>&nbsp;<span class="ident" id="7073303">reader</span><span class="op" id="7073309">(</span><span class="string" id="7073310">&#34;123&nbsp;hi\n234&nbsp;bye\n345&nbsp;no&nbsp;way\n&#34;</span><span class="op" id="7073341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7073344">code</span><span class="op" id="7073348">,</span>&nbsp;<span class="ident" id="7073350">msg</span><span class="op" id="7073353">,</span>&nbsp;<span class="ident" id="7073355">err</span>&nbsp;<span class="op" id="7073359">:=</span>&nbsp;<span class="ident" id="7073362">r</span><span class="op" id="7073363">.</span><span class="ident" id="7073364">ReadCodeLine</span><span class="op" id="7073376">(</span><span class="num" id="7073377">0</span><span class="op" id="7073378">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7073381">if</span>&nbsp;<span class="ident" id="7073384">code</span>&nbsp;<span class="op" id="7073389">!=</span>&nbsp;<span class="num" id="7073392">123</span>&nbsp;<span class="op" id="7073396">||</span>&nbsp;<span class="ident" id="7073399">msg</span>&nbsp;<span class="op" id="7073403">!=</span>&nbsp;<span class="string" id="7073406">&#34;hi&#34;</span>&nbsp;<span class="op" id="7073411">||</span>&nbsp;<span class="ident" id="7073414">err</span>&nbsp;<span class="op" id="7073418">!=</span>&nbsp;<span class="ident" id="7073421">nil</span>&nbsp;<span class="op" id="7073425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7073429">t</span><span class="op" id="7073430">.</span><span class="ident" id="7073431">Fatalf</span><span class="op" id="7073437">(</span><span class="string" id="7073438">&#34;Line&nbsp;1:&nbsp;%d,&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7073458">,</span>&nbsp;<span class="ident" id="7073460">code</span><span class="op" id="7073464">,</span>&nbsp;<span class="ident" id="7073466">msg</span><span class="op" id="7073469">,</span>&nbsp;<span class="ident" id="7073471">err</span><span class="op" id="7073474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7073477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7073480">code</span><span class="op" id="7073484">,</span>&nbsp;<span class="ident" id="7073486">msg</span><span class="op" id="7073489">,</span>&nbsp;<span class="ident" id="7073491">err</span>&nbsp;<span class="op" id="7073495">=</span>&nbsp;<span class="ident" id="7073497">r</span><span class="op" id="7073498">.</span><span class="ident" id="7073499">ReadCodeLine</span><span class="op" id="7073511">(</span><span class="num" id="7073512">23</span><span class="op" id="7073514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7073517">if</span>&nbsp;<span class="ident" id="7073520">code</span>&nbsp;<span class="op" id="7073525">!=</span>&nbsp;<span class="num" id="7073528">234</span>&nbsp;<span class="op" id="7073532">||</span>&nbsp;<span class="ident" id="7073535">msg</span>&nbsp;<span class="op" id="7073539">!=</span>&nbsp;<span class="string" id="7073542">&#34;bye&#34;</span>&nbsp;<span class="op" id="7073548">||</span>&nbsp;<span class="ident" id="7073551">err</span>&nbsp;<span class="op" id="7073555">!=</span>&nbsp;<span class="ident" id="7073558">nil</span>&nbsp;<span class="op" id="7073562">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7073566">t</span><span class="op" id="7073567">.</span><span class="ident" id="7073568">Fatalf</span><span class="op" id="7073574">(</span><span class="string" id="7073575">&#34;Line&nbsp;2:&nbsp;%d,&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7073595">,</span>&nbsp;<span class="ident" id="7073597">code</span><span class="op" id="7073601">,</span>&nbsp;<span class="ident" id="7073603">msg</span><span class="op" id="7073606">,</span>&nbsp;<span class="ident" id="7073608">err</span><span class="op" id="7073611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7073614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7073617">code</span><span class="op" id="7073621">,</span>&nbsp;<span class="ident" id="7073623">msg</span><span class="op" id="7073626">,</span>&nbsp;<span class="ident" id="7073628">err</span>&nbsp;<span class="op" id="7073632">=</span>&nbsp;<span class="ident" id="7073634">r</span><span class="op" id="7073635">.</span><span class="ident" id="7073636">ReadCodeLine</span><span class="op" id="7073648">(</span><span class="num" id="7073649">346</span><span class="op" id="7073652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7073655">if</span>&nbsp;<span class="ident" id="7073658">code</span>&nbsp;<span class="op" id="7073663">!=</span>&nbsp;<span class="num" id="7073666">345</span>&nbsp;<span class="op" id="7073670">||</span>&nbsp;<span class="ident" id="7073673">msg</span>&nbsp;<span class="op" id="7073677">!=</span>&nbsp;<span class="string" id="7073680">&#34;no&nbsp;way&#34;</span>&nbsp;<span class="op" id="7073689">||</span>&nbsp;<span class="ident" id="7073692">err</span>&nbsp;<span class="op" id="7073696">==</span>&nbsp;<span class="ident" id="7073699">nil</span>&nbsp;<span class="op" id="7073703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7073707">t</span><span class="op" id="7073708">.</span><span class="ident" id="7073709">Fatalf</span><span class="op" id="7073715">(</span><span class="string" id="7073716">&#34;Line&nbsp;3:&nbsp;%d,&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7073736">,</span>&nbsp;<span class="ident" id="7073738">code</span><span class="op" id="7073742">,</span>&nbsp;<span class="ident" id="7073744">msg</span><span class="op" id="7073747">,</span>&nbsp;<span class="ident" id="7073749">err</span><span class="op" id="7073752">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7073755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7073758">if</span>&nbsp;<span class="ident" id="7073761">e</span><span class="op" id="7073762">,</span>&nbsp;<span class="ident" id="7073764">ok</span>&nbsp;<span class="op" id="7073767">:=</span>&nbsp;<span class="ident" id="7073770">err</span><span class="op" id="7073773">.</span><span class="op" id="7073774">(</span><span class="op" id="7073775">*</span><span class="ident" id="7073776">Error</span><span class="op" id="7073781">)</span><span class="op" id="7073782">;</span>&nbsp;<span class="op" id="7073784">!</span><span class="ident" id="7073785">ok</span>&nbsp;<span class="op" id="7073788">||</span>&nbsp;<span class="ident" id="7073791">e</span><span class="op" id="7073792">.</span><span class="ident" id="7073793">Code</span>&nbsp;<span class="op" id="7073798">!=</span>&nbsp;<span class="ident" id="7073801">code</span>&nbsp;<span class="op" id="7073806">||</span>&nbsp;<span class="ident" id="7073809">e</span><span class="op" id="7073810">.</span><span class="ident" id="7073811">Msg</span>&nbsp;<span class="op" id="7073815">!=</span>&nbsp;<span class="ident" id="7073818">msg</span>&nbsp;<span class="op" id="7073822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7073826">t</span><span class="op" id="7073827">.</span><span class="ident" id="7073828">Fatalf</span><span class="op" id="7073834">(</span><span class="string" id="7073835">&#34;Line&nbsp;3:&nbsp;wrong&nbsp;error&nbsp;%v\n&#34;</span><span class="op" id="7073861">,</span>&nbsp;<span class="ident" id="7073863">err</span><span class="op" id="7073866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7073869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7073872">code</span><span class="op" id="7073876">,</span>&nbsp;<span class="ident" id="7073878">msg</span><span class="op" id="7073881">,</span>&nbsp;<span class="ident" id="7073883">err</span>&nbsp;<span class="op" id="7073887">=</span>&nbsp;<span class="ident" id="7073889">r</span><span class="op" id="7073890">.</span><span class="ident" id="7073891">ReadCodeLine</span><span class="op" id="7073903">(</span><span class="num" id="7073904">1</span><span class="op" id="7073905">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7073908">if</span>&nbsp;<span class="ident" id="7073911">code</span>&nbsp;<span class="op" id="7073916">!=</span>&nbsp;<span class="num" id="7073919">0</span>&nbsp;<span class="op" id="7073921">||</span>&nbsp;<span class="ident" id="7073924">msg</span>&nbsp;<span class="op" id="7073928">!=</span>&nbsp;<span class="string" id="7073931">&#34;&#34;</span>&nbsp;<span class="op" id="7073934">||</span>&nbsp;<span class="ident" id="7073937">err</span>&nbsp;<span class="op" id="7073941">!=</span>&nbsp;<span class="ident" id="7073944">io</span><span class="op" id="7073946">.</span><span class="ident" id="7073947">EOF</span>&nbsp;<span class="op" id="7073951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7073955">t</span><span class="op" id="7073956">.</span><span class="ident" id="7073957">Fatalf</span><span class="op" id="7073963">(</span><span class="string" id="7073964">&#34;EOF:&nbsp;%d,&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7073981">,</span>&nbsp;<span class="ident" id="7073983">code</span><span class="op" id="7073987">,</span>&nbsp;<span class="ident" id="7073989">msg</span><span class="op" id="7073992">,</span>&nbsp;<span class="ident" id="7073994">err</span><span class="op" id="7073997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7074000">}</span><br>
<span class="lineno"></span><span class="op" id="7074002">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="7074005">func</span>&nbsp;<span class="ident" id="7074010">TestReadDotLines</span><span class="op" id="7074026">(</span><span class="ident" id="7074027">t</span>&nbsp;<span class="op" id="7074029">*</span><span class="ident" id="7074030">testing</span><span class="op" id="7074037">.</span><span class="ident" id="7074038">T</span><span class="op" id="7074039">)</span>&nbsp;<span class="op" id="7074041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7074044">r</span>&nbsp;<span class="op" id="7074046">:=</span>&nbsp;<span class="ident" id="7074049">reader</span><span class="op" id="7074055">(</span><span class="string" id="7074056">&#34;dotlines\r\n.foo\r\n..bar\n...baz\nquux\r\n\r\n.\r\nanother\n&#34;</span><span class="op" id="7074119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7074122">s</span><span class="op" id="7074123">,</span>&nbsp;<span class="ident" id="7074125">err</span>&nbsp;<span class="op" id="7074129">:=</span>&nbsp;<span class="ident" id="7074132">r</span><span class="op" id="7074133">.</span><span class="ident" id="7074134">ReadDotLines</span><span class="op" id="7074146">(</span><span class="op" id="7074147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7074150">want</span>&nbsp;<span class="op" id="7074155">:=</span>&nbsp;<span class="op" id="7074158">[</span><span class="op" id="7074159">]</span><span class="builtintype" id="7074160">string</span><span class="op" id="7074166">{</span><span class="string" id="7074167">&#34;dotlines&#34;</span><span class="op" id="7074177">,</span>&nbsp;<span class="string" id="7074179">&#34;foo&#34;</span><span class="op" id="7074184">,</span>&nbsp;<span class="string" id="7074186">&#34;.bar&#34;</span><span class="op" id="7074192">,</span>&nbsp;<span class="string" id="7074194">&#34;..baz&#34;</span><span class="op" id="7074201">,</span>&nbsp;<span class="string" id="7074203">&#34;quux&#34;</span><span class="op" id="7074209">,</span>&nbsp;<span class="string" id="7074211">&#34;&#34;</span><span class="op" id="7074213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7074216">if</span>&nbsp;<span class="op" id="7074219">!</span><span class="ident" id="7074220">reflect</span><span class="op" id="7074227">.</span><span class="ident" id="7074228">DeepEqual</span><span class="op" id="7074237">(</span><span class="ident" id="7074238">s</span><span class="op" id="7074239">,</span>&nbsp;<span class="ident" id="7074241">want</span><span class="op" id="7074245">)</span>&nbsp;<span class="op" id="7074247">||</span>&nbsp;<span class="ident" id="7074250">err</span>&nbsp;<span class="op" id="7074254">!=</span>&nbsp;<span class="ident" id="7074257">nil</span>&nbsp;<span class="op" id="7074261">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7074265">t</span><span class="op" id="7074266">.</span><span class="ident" id="7074267">Fatalf</span><span class="op" id="7074273">(</span><span class="string" id="7074274">&#34;ReadDotLines:&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="7074296">,</span>&nbsp;<span class="ident" id="7074298">s</span><span class="op" id="7074299">,</span>&nbsp;<span class="ident" id="7074301">err</span><span class="op" id="7074304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7074307">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7074311">s</span><span class="op" id="7074312">,</span>&nbsp;<span class="ident" id="7074314">err</span>&nbsp;<span class="op" id="7074318">=</span>&nbsp;<span class="ident" id="7074320">r</span><span class="op" id="7074321">.</span><span class="ident" id="7074322">ReadDotLines</span><span class="op" id="7074334">(</span><span class="op" id="7074335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7074338">want</span>&nbsp;<span class="op" id="7074343">=</span>&nbsp;<span class="op" id="7074345">[</span><span class="op" id="7074346">]</span><span class="builtintype" id="7074347">string</span><span class="op" id="7074353">{</span><span class="string" id="7074354">&#34;another&#34;</span><span class="op" id="7074363">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7074366">if</span>&nbsp;<span class="op" id="7074369">!</span><span class="ident" id="7074370">reflect</span><span class="op" id="7074377">.</span><span class="ident" id="7074378">DeepEqual</span><span class="op" id="7074387">(</span><span class="ident" id="7074388">s</span><span class="op" id="7074389">,</span>&nbsp;<span class="ident" id="7074391">want</span><span class="op" id="7074395">)</span>&nbsp;<span class="op" id="7074397">||</span>&nbsp;<span class="ident" id="7074400">err</span>&nbsp;<span class="op" id="7074404">!=</span>&nbsp;<span class="ident" id="7074407">io</span><span class="op" id="7074409">.</span><span class="ident" id="7074410">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="7074427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7074431">t</span><span class="op" id="7074432">.</span><span class="ident" id="7074433">Fatalf</span><span class="op" id="7074439">(</span><span class="string" id="7074440">&#34;ReadDotLines2:&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="7074463">,</span>&nbsp;<span class="ident" id="7074465">s</span><span class="op" id="7074466">,</span>&nbsp;<span class="ident" id="7074468">err</span><span class="op" id="7074471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7074474">}</span><br>
<span class="lineno"></span><span class="op" id="7074476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="7074479">func</span>&nbsp;<span class="ident" id="7074484">TestReadDotBytes</span><span class="op" id="7074500">(</span><span class="ident" id="7074501">t</span>&nbsp;<span class="op" id="7074503">*</span><span class="ident" id="7074504">testing</span><span class="op" id="7074511">.</span><span class="ident" id="7074512">T</span><span class="op" id="7074513">)</span>&nbsp;<span class="op" id="7074515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7074518">r</span>&nbsp;<span class="op" id="7074520">:=</span>&nbsp;<span class="ident" id="7074523">reader</span><span class="op" id="7074529">(</span><span class="string" id="7074530">&#34;dotlines\r\n.foo\r\n..bar\n...baz\nquux\r\n\r\n.\r\nanot.her\r\n&#34;</span><span class="op" id="7074596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7074599">b</span><span class="op" id="7074600">,</span>&nbsp;<span class="ident" id="7074602">err</span>&nbsp;<span class="op" id="7074606">:=</span>&nbsp;<span class="ident" id="7074609">r</span><span class="op" id="7074610">.</span><span class="ident" id="7074611">ReadDotBytes</span><span class="op" id="7074623">(</span><span class="op" id="7074624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7074627">want</span>&nbsp;<span class="op" id="7074632">:=</span>&nbsp;<span class="op" id="7074635">[</span><span class="op" id="7074636">]</span><span class="builtintype" id="7074637">byte</span><span class="op" id="7074641">(</span><span class="string" id="7074642">&#34;dotlines\nfoo\n.bar\n..baz\nquux\n\n&#34;</span><span class="op" id="7074680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7074683">if</span>&nbsp;<span class="op" id="7074686">!</span><span class="ident" id="7074687">reflect</span><span class="op" id="7074694">.</span><span class="ident" id="7074695">DeepEqual</span><span class="op" id="7074704">(</span><span class="ident" id="7074705">b</span><span class="op" id="7074706">,</span>&nbsp;<span class="ident" id="7074708">want</span><span class="op" id="7074712">)</span>&nbsp;<span class="op" id="7074714">||</span>&nbsp;<span class="ident" id="7074717">err</span>&nbsp;<span class="op" id="7074721">!=</span>&nbsp;<span class="ident" id="7074724">nil</span>&nbsp;<span class="op" id="7074728">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7074732">t</span><span class="op" id="7074733">.</span><span class="ident" id="7074734">Fatalf</span><span class="op" id="7074740">(</span><span class="string" id="7074741">&#34;ReadDotBytes:&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="7074763">,</span>&nbsp;<span class="ident" id="7074765">b</span><span class="op" id="7074766">,</span>&nbsp;<span class="ident" id="7074768">err</span><span class="op" id="7074771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7074774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7074778">b</span><span class="op" id="7074779">,</span>&nbsp;<span class="ident" id="7074781">err</span>&nbsp;<span class="op" id="7074785">=</span>&nbsp;<span class="ident" id="7074787">r</span><span class="op" id="7074788">.</span><span class="ident" id="7074789">ReadDotBytes</span><span class="op" id="7074801">(</span><span class="op" id="7074802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7074805">want</span>&nbsp;<span class="op" id="7074810">=</span>&nbsp;<span class="op" id="7074812">[</span><span class="op" id="7074813">]</span><span class="builtintype" id="7074814">byte</span><span class="op" id="7074818">(</span><span class="string" id="7074819">&#34;anot.her\n&#34;</span><span class="op" id="7074831">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7074834">if</span>&nbsp;<span class="op" id="7074837">!</span><span class="ident" id="7074838">reflect</span><span class="op" id="7074845">.</span><span class="ident" id="7074846">DeepEqual</span><span class="op" id="7074855">(</span><span class="ident" id="7074856">b</span><span class="op" id="7074857">,</span>&nbsp;<span class="ident" id="7074859">want</span><span class="op" id="7074863">)</span>&nbsp;<span class="op" id="7074865">||</span>&nbsp;<span class="ident" id="7074868">err</span>&nbsp;<span class="op" id="7074872">!=</span>&nbsp;<span class="ident" id="7074875">io</span><span class="op" id="7074877">.</span><span class="ident" id="7074878">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="7074895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7074899">t</span><span class="op" id="7074900">.</span><span class="ident" id="7074901">Fatalf</span><span class="op" id="7074907">(</span><span class="string" id="7074908">&#34;ReadDotBytes2:&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="7074931">,</span>&nbsp;<span class="ident" id="7074933">b</span><span class="op" id="7074934">,</span>&nbsp;<span class="ident" id="7074936">err</span><span class="op" id="7074939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7074942">}</span><br>
<span class="lineno"></span><span class="op" id="7074944">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="keyword" id="7074947">func</span>&nbsp;<span class="ident" id="7074952">TestReadMIMEHeader</span><span class="op" id="7074970">(</span><span class="ident" id="7074971">t</span>&nbsp;<span class="op" id="7074973">*</span><span class="ident" id="7074974">testing</span><span class="op" id="7074981">.</span><span class="ident" id="7074982">T</span><span class="op" id="7074983">)</span>&nbsp;<span class="op" id="7074985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7074988">r</span>&nbsp;<span class="op" id="7074990">:=</span>&nbsp;<span class="ident" id="7074993">reader</span><span class="op" id="7074999">(</span><span class="string" id="7075000">&#34;my-key:&nbsp;Value&nbsp;1&nbsp;&nbsp;\r\nLong-key:&nbsp;Even&nbsp;\n&nbsp;Longer&nbsp;Value\r\nmy-Key:&nbsp;Value&nbsp;2\r\n\n&#34;</span><span class="op" id="7075078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7075081">m</span><span class="op" id="7075082">,</span>&nbsp;<span class="ident" id="7075084">err</span>&nbsp;<span class="op" id="7075088">:=</span>&nbsp;<span class="ident" id="7075091">r</span><span class="op" id="7075092">.</span><span class="ident" id="7075093">ReadMIMEHeader</span><span class="op" id="7075107">(</span><span class="op" id="7075108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7075111">want</span>&nbsp;<span class="op" id="7075116">:=</span>&nbsp;<span class="ident" id="7075119">MIMEHeader</span><span class="op" id="7075129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7075133">&#34;My-Key&#34;</span><span class="op" id="7075141">:</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7075145">{</span><span class="string" id="7075146">&#34;Value&nbsp;1&#34;</span><span class="op" id="7075155">,</span>&nbsp;<span class="string" id="7075157">&#34;Value&nbsp;2&#34;</span><span class="op" id="7075166">}</span><span class="op" id="7075167">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7075171">&#34;Long-Key&#34;</span><span class="op" id="7075181">:</span>&nbsp;<span class="op" id="7075183">{</span><span class="string" id="7075184">&#34;Even&nbsp;Longer&nbsp;Value&#34;</span><span class="op" id="7075203">}</span><span class="op" id="7075204">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7075207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7075210">if</span>&nbsp;<span class="op" id="7075213">!</span><span class="ident" id="7075214">reflect</span><span class="op" id="7075221">.</span><span class="ident" id="7075222">DeepEqual</span><span class="op" id="7075231">(</span><span class="ident" id="7075232">m</span><span class="op" id="7075233">,</span>&nbsp;<span class="ident" id="7075235">want</span><span class="op" id="7075239">)</span>&nbsp;<span class="op" id="7075241">||</span>&nbsp;<span class="ident" id="7075244">err</span>&nbsp;<span class="op" id="7075248">!=</span>&nbsp;<span class="ident" id="7075251">nil</span>&nbsp;<span class="op" id="7075255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7075259">t</span><span class="op" id="7075260">.</span><span class="ident" id="7075261">Fatalf</span><span class="op" id="7075267">(</span><span class="string" id="7075268">&#34;ReadMIMEHeader:&nbsp;%v,&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7075301">,</span>&nbsp;<span class="ident" id="7075303">m</span><span class="op" id="7075304">,</span>&nbsp;<span class="ident" id="7075306">err</span><span class="op" id="7075309">,</span>&nbsp;<span class="ident" id="7075311">want</span><span class="op" id="7075315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7075318">}</span><br>
<span class="lineno">145</span><span class="op" id="7075320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7075323">func</span>&nbsp;<span class="ident" id="7075328">TestReadMIMEHeaderSingle</span><span class="op" id="7075352">(</span><span class="ident" id="7075353">t</span>&nbsp;<span class="op" id="7075355">*</span><span class="ident" id="7075356">testing</span><span class="op" id="7075363">.</span><span class="ident" id="7075364">T</span><span class="op" id="7075365">)</span>&nbsp;<span class="op" id="7075367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7075370">r</span>&nbsp;<span class="op" id="7075372">:=</span>&nbsp;<span class="ident" id="7075375">reader</span><span class="op" id="7075381">(</span><span class="string" id="7075382">&#34;Foo:&nbsp;bar\n\n&#34;</span><span class="op" id="7075396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7075399">m</span><span class="op" id="7075400">,</span>&nbsp;<span class="ident" id="7075402">err</span>&nbsp;<span class="op" id="7075406">:=</span>&nbsp;<span class="ident" id="7075409">r</span><span class="op" id="7075410">.</span><span class="ident" id="7075411">ReadMIMEHeader</span><span class="op" id="7075425">(</span><span class="op" id="7075426">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7075429">want</span>&nbsp;<span class="op" id="7075434">:=</span>&nbsp;<span class="ident" id="7075437">MIMEHeader</span><span class="op" id="7075447">{</span><span class="string" id="7075448">&#34;Foo&#34;</span><span class="op" id="7075453">:</span>&nbsp;<span class="op" id="7075455">{</span><span class="string" id="7075456">&#34;bar&#34;</span><span class="op" id="7075461">}</span><span class="op" id="7075462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7075465">if</span>&nbsp;<span class="op" id="7075468">!</span><span class="ident" id="7075469">reflect</span><span class="op" id="7075476">.</span><span class="ident" id="7075477">DeepEqual</span><span class="op" id="7075486">(</span><span class="ident" id="7075487">m</span><span class="op" id="7075488">,</span>&nbsp;<span class="ident" id="7075490">want</span><span class="op" id="7075494">)</span>&nbsp;<span class="op" id="7075496">||</span>&nbsp;<span class="ident" id="7075499">err</span>&nbsp;<span class="op" id="7075503">!=</span>&nbsp;<span class="ident" id="7075506">nil</span>&nbsp;<span class="op" id="7075510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7075514">t</span><span class="op" id="7075515">.</span><span class="ident" id="7075516">Fatalf</span><span class="op" id="7075522">(</span><span class="string" id="7075523">&#34;ReadMIMEHeader:&nbsp;%v,&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7075556">,</span>&nbsp;<span class="ident" id="7075558">m</span><span class="op" id="7075559">,</span>&nbsp;<span class="ident" id="7075561">err</span><span class="op" id="7075564">,</span>&nbsp;<span class="ident" id="7075566">want</span><span class="op" id="7075570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7075573">}</span><br>
<span class="lineno"></span><span class="op" id="7075575">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="7075578">func</span>&nbsp;<span class="ident" id="7075583">TestLargeReadMIMEHeader</span><span class="op" id="7075606">(</span><span class="ident" id="7075607">t</span>&nbsp;<span class="op" id="7075609">*</span><span class="ident" id="7075610">testing</span><span class="op" id="7075617">.</span><span class="ident" id="7075618">T</span><span class="op" id="7075619">)</span>&nbsp;<span class="op" id="7075621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7075624">data</span>&nbsp;<span class="op" id="7075629">:=</span>&nbsp;<span class="builtinfunc" id="7075632">make</span><span class="op" id="7075636">(</span><span class="op" id="7075637">[</span><span class="op" id="7075638">]</span><span class="builtintype" id="7075639">byte</span><span class="op" id="7075643">,</span>&nbsp;<span class="num" id="7075645">16</span><span class="op" id="7075647">*</span><span class="num" id="7075648">1024</span><span class="op" id="7075652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7075655">for</span>&nbsp;<span class="ident" id="7075659">i</span>&nbsp;<span class="op" id="7075661">:=</span>&nbsp;<span class="num" id="7075664">0</span><span class="op" id="7075665">;</span>&nbsp;<span class="ident" id="7075667">i</span>&nbsp;<span class="op" id="7075669">&lt;</span>&nbsp;<span class="builtinfunc" id="7075671">len</span><span class="op" id="7075674">(</span><span class="ident" id="7075675">data</span><span class="op" id="7075679">)</span><span class="op" id="7075680">;</span>&nbsp;<span class="ident" id="7075682">i</span><span class="op" id="7075683">++</span>&nbsp;<span class="op" id="7075686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7075690">data</span><span class="op" id="7075694">[</span><span class="ident" id="7075695">i</span><span class="op" id="7075696">]</span>&nbsp;<span class="op" id="7075698">=</span>&nbsp;<span class="string" id="7075700">&#39;x&#39;</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7075705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7075708">sdata</span>&nbsp;<span class="op" id="7075714">:=</span>&nbsp;<span class="builtintype" id="7075717">string</span><span class="op" id="7075723">(</span><span class="ident" id="7075724">data</span><span class="op" id="7075728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7075731">r</span>&nbsp;<span class="op" id="7075733">:=</span>&nbsp;<span class="ident" id="7075736">reader</span><span class="op" id="7075742">(</span><span class="string" id="7075743">&#34;Cookie:&nbsp;&#34;</span>&nbsp;<span class="op" id="7075754">+</span>&nbsp;<span class="ident" id="7075756">sdata</span>&nbsp;<span class="op" id="7075762">+</span>&nbsp;<span class="string" id="7075764">&#34;\r\n\n&#34;</span><span class="op" id="7075772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7075775">m</span><span class="op" id="7075776">,</span>&nbsp;<span class="ident" id="7075778">err</span>&nbsp;<span class="op" id="7075782">:=</span>&nbsp;<span class="ident" id="7075785">r</span><span class="op" id="7075786">.</span><span class="ident" id="7075787">ReadMIMEHeader</span><span class="op" id="7075801">(</span><span class="op" id="7075802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7075805">if</span>&nbsp;<span class="ident" id="7075808">err</span>&nbsp;<span class="op" id="7075812">!=</span>&nbsp;<span class="ident" id="7075815">nil</span>&nbsp;<span class="op" id="7075819">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7075823">t</span><span class="op" id="7075824">.</span><span class="ident" id="7075825">Fatalf</span><span class="op" id="7075831">(</span><span class="string" id="7075832">&#34;ReadMIMEHeader:&nbsp;%v&#34;</span><span class="op" id="7075852">,</span>&nbsp;<span class="ident" id="7075854">err</span><span class="op" id="7075857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7075860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7075863">cookie</span>&nbsp;<span class="op" id="7075870">:=</span>&nbsp;<span class="ident" id="7075873">m</span><span class="op" id="7075874">.</span><span class="ident" id="7075875">Get</span><span class="op" id="7075878">(</span><span class="string" id="7075879">&#34;Cookie&#34;</span><span class="op" id="7075887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7075890">if</span>&nbsp;<span class="ident" id="7075893">cookie</span>&nbsp;<span class="op" id="7075900">!=</span>&nbsp;<span class="ident" id="7075903">sdata</span>&nbsp;<span class="op" id="7075909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7075913">t</span><span class="op" id="7075914">.</span><span class="ident" id="7075915">Fatalf</span><span class="op" id="7075921">(</span><span class="string" id="7075922">&#34;ReadMIMEHeader:&nbsp;%v&nbsp;bytes,&nbsp;want&nbsp;%v&nbsp;bytes&#34;</span><span class="op" id="7075963">,</span>&nbsp;<span class="builtinfunc" id="7075965">len</span><span class="op" id="7075968">(</span><span class="ident" id="7075969">cookie</span><span class="op" id="7075975">)</span><span class="op" id="7075976">,</span>&nbsp;<span class="builtinfunc" id="7075978">len</span><span class="op" id="7075981">(</span><span class="ident" id="7075982">sdata</span><span class="op" id="7075987">)</span><span class="op" id="7075988">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7075991">}</span><br>
<span class="lineno"></span><span class="op" id="7075993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7075996">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;read&nbsp;slightly-bogus&nbsp;MIME&nbsp;headers&nbsp;seen&nbsp;in&nbsp;the&nbsp;wild,</span><br>
<span class="lineno"></span><span class="comment" id="7076063">//&nbsp;with&nbsp;spaces&nbsp;before&nbsp;colons,&nbsp;and&nbsp;spaces&nbsp;in&nbsp;keys.</span><br>
<span class="lineno">175</span><span class="keyword" id="7076113">func</span>&nbsp;<span class="ident" id="7076118">TestReadMIMEHeaderNonCompliant</span><span class="op" id="7076148">(</span><span class="ident" id="7076149">t</span>&nbsp;<span class="op" id="7076151">*</span><span class="ident" id="7076152">testing</span><span class="op" id="7076159">.</span><span class="ident" id="7076160">T</span><span class="op" id="7076161">)</span>&nbsp;<span class="op" id="7076163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7076166">//&nbsp;Invalid&nbsp;HTTP&nbsp;response&nbsp;header&nbsp;as&nbsp;sent&nbsp;by&nbsp;an&nbsp;Axis&nbsp;security</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7076227">//&nbsp;camera:&nbsp;(this&nbsp;is&nbsp;handled&nbsp;by&nbsp;IE,&nbsp;Firefox,&nbsp;Chrome,&nbsp;curl,&nbsp;etc.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7076292">r</span>&nbsp;<span class="op" id="7076294">:=</span>&nbsp;<span class="ident" id="7076297">reader</span><span class="op" id="7076303">(</span><span class="string" id="7076304">&#34;Foo:&nbsp;bar\r\n&#34;</span>&nbsp;<span class="op" id="7076319">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7076323">&#34;Content-Language:&nbsp;en\r\n&#34;</span>&nbsp;<span class="op" id="7076350">+</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7076354">&#34;SID&nbsp;:&nbsp;0\r\n&#34;</span>&nbsp;<span class="op" id="7076368">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7076372">&#34;Audio&nbsp;Mode&nbsp;:&nbsp;None\r\n&#34;</span>&nbsp;<span class="op" id="7076396">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7076400">&#34;Privilege&nbsp;:&nbsp;127\r\n\r\n&#34;</span><span class="op" id="7076425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7076428">m</span><span class="op" id="7076429">,</span>&nbsp;<span class="ident" id="7076431">err</span>&nbsp;<span class="op" id="7076435">:=</span>&nbsp;<span class="ident" id="7076438">r</span><span class="op" id="7076439">.</span><span class="ident" id="7076440">ReadMIMEHeader</span><span class="op" id="7076454">(</span><span class="op" id="7076455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7076458">want</span>&nbsp;<span class="op" id="7076463">:=</span>&nbsp;<span class="ident" id="7076466">MIMEHeader</span><span class="op" id="7076476">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7076480">&#34;Foo&#34;</span><span class="op" id="7076485">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7076500">{</span><span class="string" id="7076501">&#34;bar&#34;</span><span class="op" id="7076506">}</span><span class="op" id="7076507">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7076511">&#34;Content-Language&#34;</span><span class="op" id="7076529">:</span>&nbsp;<span class="op" id="7076531">{</span><span class="string" id="7076532">&#34;en&#34;</span><span class="op" id="7076536">}</span><span class="op" id="7076537">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7076541">&#34;Sid&#34;</span><span class="op" id="7076546">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7076561">{</span><span class="string" id="7076562">&#34;0&#34;</span><span class="op" id="7076565">}</span><span class="op" id="7076566">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7076570">&#34;Audio-Mode&#34;</span><span class="op" id="7076582">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7076590">{</span><span class="string" id="7076591">&#34;None&#34;</span><span class="op" id="7076597">}</span><span class="op" id="7076598">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7076602">&#34;Privilege&#34;</span><span class="op" id="7076613">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7076622">{</span><span class="string" id="7076623">&#34;127&#34;</span><span class="op" id="7076628">}</span><span class="op" id="7076629">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7076632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7076635">if</span>&nbsp;<span class="op" id="7076638">!</span><span class="ident" id="7076639">reflect</span><span class="op" id="7076646">.</span><span class="ident" id="7076647">DeepEqual</span><span class="op" id="7076656">(</span><span class="ident" id="7076657">m</span><span class="op" id="7076658">,</span>&nbsp;<span class="ident" id="7076660">want</span><span class="op" id="7076664">)</span>&nbsp;<span class="op" id="7076666">||</span>&nbsp;<span class="ident" id="7076669">err</span>&nbsp;<span class="op" id="7076673">!=</span>&nbsp;<span class="ident" id="7076676">nil</span>&nbsp;<span class="op" id="7076680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7076684">t</span><span class="op" id="7076685">.</span><span class="ident" id="7076686">Fatalf</span><span class="op" id="7076692">(</span><span class="string" id="7076693">&#34;ReadMIMEHeader&nbsp;=\n%v,&nbsp;%v;&nbsp;want:\n%v&#34;</span><span class="op" id="7076730">,</span>&nbsp;<span class="ident" id="7076732">m</span><span class="op" id="7076733">,</span>&nbsp;<span class="ident" id="7076735">err</span><span class="op" id="7076738">,</span>&nbsp;<span class="ident" id="7076740">want</span><span class="op" id="7076744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7076747">}</span><br>
<span class="lineno"></span><span class="op" id="7076749">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="keyword" id="7076752">type</span>&nbsp;<span class="ident" id="7076757">readResponseTest</span>&nbsp;<span class="keyword" id="7076774">struct</span>&nbsp;<span class="op" id="7076781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7076784">in</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7076793">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7076801">inCode</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7076810">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7076815">wantCode</span>&nbsp;<span class="builtintype" id="7076824">int</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7076829">wantMsg</span>&nbsp;&nbsp;<span class="builtintype" id="7076838">string</span><br>
<span class="lineno"></span><span class="op" id="7076845">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7076848">var</span>&nbsp;<span class="ident" id="7076852">readResponseTests</span>&nbsp;<span class="op" id="7076870">=</span>&nbsp;<span class="op" id="7076872">[</span><span class="op" id="7076873">]</span><span class="ident" id="7076874">readResponseTest</span><span class="op" id="7076890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7076893">{</span><span class="string" id="7076894">&#34;230-Anonymous&nbsp;access&nbsp;granted,&nbsp;restrictions&nbsp;apply\n&#34;</span>&nbsp;<span class="op" id="7076947">+</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7076951">&#34;Read&nbsp;the&nbsp;file&nbsp;README.txt,\n&#34;</span>&nbsp;<span class="op" id="7076981">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7076985">&#34;230&nbsp;&nbsp;please&#34;</span><span class="op" id="7076998">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7077002">23</span><span class="op" id="7077004">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7077008">230</span><span class="op" id="7077011">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7077015">&#34;Anonymous&nbsp;access&nbsp;granted,&nbsp;restrictions&nbsp;apply\nRead&nbsp;the&nbsp;file&nbsp;README.txt,\n&nbsp;please&#34;</span><span class="op" id="7077097">,</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7077100">}</span><span class="op" id="7077101">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7077105">{</span><span class="string" id="7077106">&#34;230&nbsp;Anonymous&nbsp;access&nbsp;granted,&nbsp;restrictions&nbsp;apply\n&#34;</span><span class="op" id="7077158">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7077162">23</span><span class="op" id="7077164">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7077168">230</span><span class="op" id="7077171">,</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7077175">&#34;Anonymous&nbsp;access&nbsp;granted,&nbsp;restrictions&nbsp;apply&#34;</span><span class="op" id="7077221">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7077224">}</span><span class="op" id="7077225">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7077229">{</span><span class="string" id="7077230">&#34;400-A\n400-B\n400&nbsp;C&#34;</span><span class="op" id="7077251">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7077255">4</span><span class="op" id="7077256">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7077260">400</span><span class="op" id="7077263">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7077267">&#34;A\nB\nC&#34;</span><span class="op" id="7077276">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7077279">}</span><span class="op" id="7077280">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7077284">{</span><span class="string" id="7077285">&#34;400-A\r\n400-B\r\n400&nbsp;C\r\n&#34;</span><span class="op" id="7077314">,</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7077318">4</span><span class="op" id="7077319">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7077323">400</span><span class="op" id="7077326">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7077330">&#34;A\nB\nC&#34;</span><span class="op" id="7077339">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7077342">}</span><span class="op" id="7077343">,</span><br>
<span class="lineno"></span><span class="op" id="7077345">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="7077348">//&nbsp;See&nbsp;http://www.ietf.org/rfc/rfc959.txt&nbsp;page&nbsp;36.</span><br>
<span class="lineno"></span><span class="keyword" id="7077399">func</span>&nbsp;<span class="ident" id="7077404">TestRFC959Lines</span><span class="op" id="7077419">(</span><span class="ident" id="7077420">t</span>&nbsp;<span class="op" id="7077422">*</span><span class="ident" id="7077423">testing</span><span class="op" id="7077430">.</span><span class="ident" id="7077431">T</span><span class="op" id="7077432">)</span>&nbsp;<span class="op" id="7077434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7077437">for</span>&nbsp;<span class="ident" id="7077441">i</span><span class="op" id="7077442">,</span>&nbsp;<span class="ident" id="7077444">tt</span>&nbsp;<span class="op" id="7077447">:=</span>&nbsp;<span class="keyword" id="7077450">range</span>&nbsp;<span class="ident" id="7077456">readResponseTests</span>&nbsp;<span class="op" id="7077474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7077478">r</span>&nbsp;<span class="op" id="7077480">:=</span>&nbsp;<span class="ident" id="7077483">reader</span><span class="op" id="7077489">(</span><span class="ident" id="7077490">tt</span><span class="op" id="7077492">.</span><span class="ident" id="7077493">in</span>&nbsp;<span class="op" id="7077496">+</span>&nbsp;<span class="string" id="7077498">&#34;\nFOLLOWING&nbsp;DATA&#34;</span><span class="op" id="7077516">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7077520">code</span><span class="op" id="7077524">,</span>&nbsp;<span class="ident" id="7077526">msg</span><span class="op" id="7077529">,</span>&nbsp;<span class="ident" id="7077531">err</span>&nbsp;<span class="op" id="7077535">:=</span>&nbsp;<span class="ident" id="7077538">r</span><span class="op" id="7077539">.</span><span class="ident" id="7077540">ReadResponse</span><span class="op" id="7077552">(</span><span class="ident" id="7077553">tt</span><span class="op" id="7077555">.</span><span class="ident" id="7077556">inCode</span><span class="op" id="7077562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7077566">if</span>&nbsp;<span class="ident" id="7077569">err</span>&nbsp;<span class="op" id="7077573">!=</span>&nbsp;<span class="ident" id="7077576">nil</span>&nbsp;<span class="op" id="7077580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7077585">t</span><span class="op" id="7077586">.</span><span class="ident" id="7077587">Errorf</span><span class="op" id="7077593">(</span><span class="string" id="7077594">&#34;#%d:&nbsp;ReadResponse:&nbsp;%v&#34;</span><span class="op" id="7077617">,</span>&nbsp;<span class="ident" id="7077619">i</span><span class="op" id="7077620">,</span>&nbsp;<span class="ident" id="7077622">err</span><span class="op" id="7077625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7077630">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7077641">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7077645">if</span>&nbsp;<span class="ident" id="7077648">code</span>&nbsp;<span class="op" id="7077653">!=</span>&nbsp;<span class="ident" id="7077656">tt</span><span class="op" id="7077658">.</span><span class="ident" id="7077659">wantCode</span>&nbsp;<span class="op" id="7077668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7077673">t</span><span class="op" id="7077674">.</span><span class="ident" id="7077675">Errorf</span><span class="op" id="7077681">(</span><span class="string" id="7077682">&#34;#%d:&nbsp;code=%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7077705">,</span>&nbsp;<span class="ident" id="7077707">i</span><span class="op" id="7077708">,</span>&nbsp;<span class="ident" id="7077710">code</span><span class="op" id="7077714">,</span>&nbsp;<span class="ident" id="7077716">tt</span><span class="op" id="7077718">.</span><span class="ident" id="7077719">wantCode</span><span class="op" id="7077727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7077731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7077735">if</span>&nbsp;<span class="ident" id="7077738">msg</span>&nbsp;<span class="op" id="7077742">!=</span>&nbsp;<span class="ident" id="7077745">tt</span><span class="op" id="7077747">.</span><span class="ident" id="7077748">wantMsg</span>&nbsp;<span class="op" id="7077756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7077761">t</span><span class="op" id="7077762">.</span><span class="ident" id="7077763">Errorf</span><span class="op" id="7077769">(</span><span class="string" id="7077770">&#34;#%d:&nbsp;msg=%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7077792">,</span>&nbsp;<span class="ident" id="7077794">i</span><span class="op" id="7077795">,</span>&nbsp;<span class="ident" id="7077797">msg</span><span class="op" id="7077800">,</span>&nbsp;<span class="ident" id="7077802">tt</span><span class="op" id="7077804">.</span><span class="ident" id="7077805">wantMsg</span><span class="op" id="7077812">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7077816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7077819">}</span><br>
<span class="lineno"></span><span class="op" id="7077821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7077824">func</span>&nbsp;<span class="ident" id="7077829">TestCommonHeaders</span><span class="op" id="7077846">(</span><span class="ident" id="7077847">t</span>&nbsp;<span class="op" id="7077849">*</span><span class="ident" id="7077850">testing</span><span class="op" id="7077857">.</span><span class="ident" id="7077858">T</span><span class="op" id="7077859">)</span>&nbsp;<span class="op" id="7077861">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7077864">for</span>&nbsp;<span class="ident" id="7077868">h</span>&nbsp;<span class="op" id="7077870">:=</span>&nbsp;<span class="keyword" id="7077873">range</span>&nbsp;<span class="ident" id="7077879">commonHeader</span>&nbsp;<span class="op" id="7077892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7077896">if</span>&nbsp;<span class="ident" id="7077899">h</span>&nbsp;<span class="op" id="7077901">!=</span>&nbsp;<span class="ident" id="7077904">CanonicalMIMEHeaderKey</span><span class="op" id="7077926">(</span><span class="ident" id="7077927">h</span><span class="op" id="7077928">)</span>&nbsp;<span class="op" id="7077930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7077935">t</span><span class="op" id="7077936">.</span><span class="ident" id="7077937">Errorf</span><span class="op" id="7077943">(</span><span class="string" id="7077944">&#34;Non-canonical&nbsp;header&nbsp;%q&nbsp;in&nbsp;commonHeader&#34;</span><span class="op" id="7077985">,</span>&nbsp;<span class="ident" id="7077987">h</span><span class="op" id="7077988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7077992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7077995">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7077998">b</span>&nbsp;<span class="op" id="7078000">:=</span>&nbsp;<span class="op" id="7078003">[</span><span class="op" id="7078004">]</span><span class="builtintype" id="7078005">byte</span><span class="op" id="7078009">(</span><span class="string" id="7078010">&#34;content-Length&#34;</span><span class="op" id="7078026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7078029">want</span>&nbsp;<span class="op" id="7078034">:=</span>&nbsp;<span class="string" id="7078037">&#34;Content-Length&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7078055">n</span>&nbsp;<span class="op" id="7078057">:=</span>&nbsp;<span class="ident" id="7078060">testing</span><span class="op" id="7078067">.</span><span class="ident" id="7078068">AllocsPerRun</span><span class="op" id="7078080">(</span><span class="num" id="7078081">200</span><span class="op" id="7078084">,</span>&nbsp;<span class="keyword" id="7078086">func</span><span class="op" id="7078090">(</span><span class="op" id="7078091">)</span>&nbsp;<span class="op" id="7078093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7078097">if</span>&nbsp;<span class="ident" id="7078100">x</span>&nbsp;<span class="op" id="7078102">:=</span>&nbsp;<span class="ident" id="7078105">canonicalMIMEHeaderKey</span><span class="op" id="7078127">(</span><span class="ident" id="7078128">b</span><span class="op" id="7078129">)</span><span class="op" id="7078130">;</span>&nbsp;<span class="ident" id="7078132">x</span>&nbsp;<span class="op" id="7078134">!=</span>&nbsp;<span class="ident" id="7078137">want</span>&nbsp;<span class="op" id="7078142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7078147">t</span><span class="op" id="7078148">.</span><span class="ident" id="7078149">Fatalf</span><span class="op" id="7078155">(</span><span class="string" id="7078156">&#34;canonicalMIMEHeaderKey(%q)&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7078198">,</span>&nbsp;<span class="ident" id="7078200">b</span><span class="op" id="7078201">,</span>&nbsp;<span class="ident" id="7078203">x</span><span class="op" id="7078204">,</span>&nbsp;<span class="ident" id="7078206">want</span><span class="op" id="7078210">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7078214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7078217">}</span><span class="op" id="7078218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7078221">if</span>&nbsp;<span class="ident" id="7078224">n</span>&nbsp;<span class="op" id="7078226">&gt;</span>&nbsp;<span class="num" id="7078228">0</span>&nbsp;<span class="op" id="7078230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7078234">t</span><span class="op" id="7078235">.</span><span class="ident" id="7078236">Errorf</span><span class="op" id="7078242">(</span><span class="string" id="7078243">&#34;canonicalMIMEHeaderKey&nbsp;allocs&nbsp;=&nbsp;%v;&nbsp;want&nbsp;0&#34;</span><span class="op" id="7078287">,</span>&nbsp;<span class="ident" id="7078289">n</span><span class="op" id="7078290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7078293">}</span><br>
<span class="lineno">265</span><span class="op" id="7078295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7078298">var</span>&nbsp;<span class="ident" id="7078302">clientHeaders</span>&nbsp;<span class="op" id="7078316">=</span>&nbsp;<span class="ident" id="7078318">strings</span><span class="op" id="7078325">.</span><span class="ident" id="7078326">Replace</span><span class="op" id="7078333">(</span><span class="string" id="7078334">`Host:&nbsp;golang.org<br>
<span class="lineno"></span>Connection:&nbsp;keep-alive<br>
<span class="lineno"></span>Cache-Control:&nbsp;max-age=0<br>
<span class="lineno">270</span>Accept:&nbsp;application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5<br>
<span class="lineno"></span>User-Agent:&nbsp;Mozilla/5.0&nbsp;(X11;&nbsp;U;&nbsp;Linux&nbsp;x86_64;&nbsp;en-US)&nbsp;AppleWebKit/534.3&nbsp;(KHTML,&nbsp;like&nbsp;Gecko)&nbsp;Chrome/6.0.472.63&nbsp;Safari/534.3<br>
<span class="lineno"></span>Accept-Encoding:&nbsp;gzip,deflate,sdch<br>
<span class="lineno"></span>Accept-Language:&nbsp;en-US,en;q=0.8,fr-CH;q=0.6<br>
<span class="lineno"></span>Accept-Charset:&nbsp;ISO-8859-1,utf-8;q=0.7,*;q=0.3<br>
<span class="lineno">275</span>COOKIE:&nbsp;__utma=000000000.0000000000.0000000000.0000000000.0000000000.00;&nbsp;__utmb=000000000.0.00.0000000000;&nbsp;__utmc=000000000;&nbsp;__utmz=000000000.0000000000.00.0.utmcsr=code.google.com|utmccn=(referral)|utmcmd=referral|utmcct=/p/go/issues/detail<br>
<span class="lineno"></span>Non-Interned:&nbsp;test<br>
<span class="lineno"></span><br>
<span class="lineno"></span>`</span><span class="op" id="7079011">,</span>&nbsp;<span class="string" id="7079013">&#34;\n&#34;</span><span class="op" id="7079017">,</span>&nbsp;<span class="string" id="7079019">&#34;\r\n&#34;</span><span class="op" id="7079025">,</span>&nbsp;<span class="op" id="7079027">-</span><span class="num" id="7079028">1</span><span class="op" id="7079029">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="7079032">var</span>&nbsp;<span class="ident" id="7079036">serverHeaders</span>&nbsp;<span class="op" id="7079050">=</span>&nbsp;<span class="ident" id="7079052">strings</span><span class="op" id="7079059">.</span><span class="ident" id="7079060">Replace</span><span class="op" id="7079067">(</span><span class="string" id="7079068">`Content-Type:&nbsp;text/html;&nbsp;charset=utf-8<br>
<span class="lineno"></span>Content-Encoding:&nbsp;gzip<br>
<span class="lineno"></span>Date:&nbsp;Thu,&nbsp;27&nbsp;Sep&nbsp;2012&nbsp;09:03:33&nbsp;GMT<br>
<span class="lineno"></span>Server:&nbsp;Google&nbsp;Frontend<br>
<span class="lineno"></span>Cache-Control:&nbsp;private<br>
<span class="lineno">285</span>Content-Length:&nbsp;2298<br>
<span class="lineno"></span>VIA:&nbsp;1.1&nbsp;proxy.example.com:80&nbsp;(XXX/n.n.n-nnn)<br>
<span class="lineno"></span>Connection:&nbsp;Close<br>
<span class="lineno"></span>Non-Interned:&nbsp;test<br>
<span class="lineno"></span><br>
<span class="lineno">290</span>`</span><span class="op" id="7079320">,</span>&nbsp;<span class="string" id="7079322">&#34;\n&#34;</span><span class="op" id="7079326">,</span>&nbsp;<span class="string" id="7079328">&#34;\r\n&#34;</span><span class="op" id="7079334">,</span>&nbsp;<span class="op" id="7079336">-</span><span class="num" id="7079337">1</span><span class="op" id="7079338">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7079341">func</span>&nbsp;<span class="ident" id="7079346">BenchmarkReadMIMEHeader</span><span class="op" id="7079369">(</span><span class="ident" id="7079370">b</span>&nbsp;<span class="op" id="7079372">*</span><span class="ident" id="7079373">testing</span><span class="op" id="7079380">.</span><span class="ident" id="7079381">B</span><span class="op" id="7079382">)</span>&nbsp;<span class="op" id="7079384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7079387">b</span><span class="op" id="7079388">.</span><span class="ident" id="7079389">ReportAllocs</span><span class="op" id="7079401">(</span><span class="op" id="7079402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7079405">var</span>&nbsp;<span class="ident" id="7079409">buf</span>&nbsp;<span class="ident" id="7079413">bytes</span><span class="op" id="7079418">.</span><span class="ident" id="7079419">Buffer</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7079427">br</span>&nbsp;<span class="op" id="7079430">:=</span>&nbsp;<span class="ident" id="7079433">bufio</span><span class="op" id="7079438">.</span><span class="ident" id="7079439">NewReader</span><span class="op" id="7079448">(</span><span class="op" id="7079449">&amp;</span><span class="ident" id="7079450">buf</span><span class="op" id="7079453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7079456">r</span>&nbsp;<span class="op" id="7079458">:=</span>&nbsp;<span class="ident" id="7079461">NewReader</span><span class="op" id="7079470">(</span><span class="ident" id="7079471">br</span><span class="op" id="7079473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7079476">for</span>&nbsp;<span class="ident" id="7079480">i</span>&nbsp;<span class="op" id="7079482">:=</span>&nbsp;<span class="num" id="7079485">0</span><span class="op" id="7079486">;</span>&nbsp;<span class="ident" id="7079488">i</span>&nbsp;<span class="op" id="7079490">&lt;</span>&nbsp;<span class="ident" id="7079492">b</span><span class="op" id="7079493">.</span><span class="ident" id="7079494">N</span><span class="op" id="7079495">;</span>&nbsp;<span class="ident" id="7079497">i</span><span class="op" id="7079498">++</span>&nbsp;<span class="op" id="7079501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7079505">var</span>&nbsp;<span class="ident" id="7079509">want</span>&nbsp;<span class="builtintype" id="7079514">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7079520">var</span>&nbsp;<span class="ident" id="7079524">find</span>&nbsp;<span class="builtintype" id="7079529">string</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7079538">if</span>&nbsp;<span class="op" id="7079541">(</span><span class="ident" id="7079542">i</span>&nbsp;<span class="op" id="7079544">&amp;</span>&nbsp;<span class="num" id="7079546">1</span><span class="op" id="7079547">)</span>&nbsp;<span class="op" id="7079549">==</span>&nbsp;<span class="num" id="7079552">1</span>&nbsp;<span class="op" id="7079554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7079559">buf</span><span class="op" id="7079562">.</span><span class="ident" id="7079563">WriteString</span><span class="op" id="7079574">(</span><span class="ident" id="7079575">clientHeaders</span><span class="op" id="7079588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7079593">want</span>&nbsp;<span class="op" id="7079598">=</span>&nbsp;<span class="num" id="7079600">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7079606">find</span>&nbsp;<span class="op" id="7079611">=</span>&nbsp;<span class="string" id="7079613">&#34;Cookie&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7079624">}</span>&nbsp;<span class="keyword" id="7079626">else</span>&nbsp;<span class="op" id="7079631">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7079636">buf</span><span class="op" id="7079639">.</span><span class="ident" id="7079640">WriteString</span><span class="op" id="7079651">(</span><span class="ident" id="7079652">serverHeaders</span><span class="op" id="7079665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7079670">want</span>&nbsp;<span class="op" id="7079675">=</span>&nbsp;<span class="num" id="7079677">9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7079682">find</span>&nbsp;<span class="op" id="7079687">=</span>&nbsp;<span class="string" id="7079689">&#34;Via&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7079697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7079701">h</span><span class="op" id="7079702">,</span>&nbsp;<span class="ident" id="7079704">err</span>&nbsp;<span class="op" id="7079708">:=</span>&nbsp;<span class="ident" id="7079711">r</span><span class="op" id="7079712">.</span><span class="ident" id="7079713">ReadMIMEHeader</span><span class="op" id="7079727">(</span><span class="op" id="7079728">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7079732">if</span>&nbsp;<span class="ident" id="7079735">err</span>&nbsp;<span class="op" id="7079739">!=</span>&nbsp;<span class="ident" id="7079742">nil</span>&nbsp;<span class="op" id="7079746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7079751">b</span><span class="op" id="7079752">.</span><span class="ident" id="7079753">Fatal</span><span class="op" id="7079758">(</span><span class="ident" id="7079759">err</span><span class="op" id="7079762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7079766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7079770">if</span>&nbsp;<span class="builtinfunc" id="7079773">len</span><span class="op" id="7079776">(</span><span class="ident" id="7079777">h</span><span class="op" id="7079778">)</span>&nbsp;<span class="op" id="7079780">!=</span>&nbsp;<span class="ident" id="7079783">want</span>&nbsp;<span class="op" id="7079788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7079793">b</span><span class="op" id="7079794">.</span><span class="ident" id="7079795">Fatalf</span><span class="op" id="7079801">(</span><span class="string" id="7079802">&#34;wrong&nbsp;number&nbsp;of&nbsp;headers:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7079844">,</span>&nbsp;<span class="builtinfunc" id="7079846">len</span><span class="op" id="7079849">(</span><span class="ident" id="7079850">h</span><span class="op" id="7079851">)</span><span class="op" id="7079852">,</span>&nbsp;<span class="ident" id="7079854">want</span><span class="op" id="7079858">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7079862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7079866">if</span>&nbsp;<span class="ident" id="7079869">_</span><span class="op" id="7079870">,</span>&nbsp;<span class="ident" id="7079872">ok</span>&nbsp;<span class="op" id="7079875">:=</span>&nbsp;<span class="ident" id="7079878">h</span><span class="op" id="7079879">[</span><span class="ident" id="7079880">find</span><span class="op" id="7079884">]</span><span class="op" id="7079885">;</span>&nbsp;<span class="op" id="7079887">!</span><span class="ident" id="7079888">ok</span>&nbsp;<span class="op" id="7079891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7079896">b</span><span class="op" id="7079897">.</span><span class="ident" id="7079898">Fatalf</span><span class="op" id="7079904">(</span><span class="string" id="7079905">&#34;did&nbsp;not&nbsp;find&nbsp;key&nbsp;%s&#34;</span><span class="op" id="7079926">,</span>&nbsp;<span class="ident" id="7079928">find</span><span class="op" id="7079932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7079936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7079939">}</span><br>
<span class="lineno">320</span><span class="op" id="7079941">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7079944">func</span>&nbsp;<span class="ident" id="7079949">BenchmarkUncommon</span><span class="op" id="7079966">(</span><span class="ident" id="7079967">b</span>&nbsp;<span class="op" id="7079969">*</span><span class="ident" id="7079970">testing</span><span class="op" id="7079977">.</span><span class="ident" id="7079978">B</span><span class="op" id="7079979">)</span>&nbsp;<span class="op" id="7079981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7079984">b</span><span class="op" id="7079985">.</span><span class="ident" id="7079986">ReportAllocs</span><span class="op" id="7079998">(</span><span class="op" id="7079999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7080002">var</span>&nbsp;<span class="ident" id="7080006">buf</span>&nbsp;<span class="ident" id="7080010">bytes</span><span class="op" id="7080015">.</span><span class="ident" id="7080016">Buffer</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7080024">br</span>&nbsp;<span class="op" id="7080027">:=</span>&nbsp;<span class="ident" id="7080030">bufio</span><span class="op" id="7080035">.</span><span class="ident" id="7080036">NewReader</span><span class="op" id="7080045">(</span><span class="op" id="7080046">&amp;</span><span class="ident" id="7080047">buf</span><span class="op" id="7080050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7080053">r</span>&nbsp;<span class="op" id="7080055">:=</span>&nbsp;<span class="ident" id="7080058">NewReader</span><span class="op" id="7080067">(</span><span class="ident" id="7080068">br</span><span class="op" id="7080070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7080073">for</span>&nbsp;<span class="ident" id="7080077">i</span>&nbsp;<span class="op" id="7080079">:=</span>&nbsp;<span class="num" id="7080082">0</span><span class="op" id="7080083">;</span>&nbsp;<span class="ident" id="7080085">i</span>&nbsp;<span class="op" id="7080087">&lt;</span>&nbsp;<span class="ident" id="7080089">b</span><span class="op" id="7080090">.</span><span class="ident" id="7080091">N</span><span class="op" id="7080092">;</span>&nbsp;<span class="ident" id="7080094">i</span><span class="op" id="7080095">++</span>&nbsp;<span class="op" id="7080098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7080102">buf</span><span class="op" id="7080105">.</span><span class="ident" id="7080106">WriteString</span><span class="op" id="7080117">(</span><span class="string" id="7080118">&#34;uncommon-header-for-benchmark:&nbsp;foo\r\n\r\n&#34;</span><span class="op" id="7080162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7080166">h</span><span class="op" id="7080167">,</span>&nbsp;<span class="ident" id="7080169">err</span>&nbsp;<span class="op" id="7080173">:=</span>&nbsp;<span class="ident" id="7080176">r</span><span class="op" id="7080177">.</span><span class="ident" id="7080178">ReadMIMEHeader</span><span class="op" id="7080192">(</span><span class="op" id="7080193">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7080197">if</span>&nbsp;<span class="ident" id="7080200">err</span>&nbsp;<span class="op" id="7080204">!=</span>&nbsp;<span class="ident" id="7080207">nil</span>&nbsp;<span class="op" id="7080211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7080216">b</span><span class="op" id="7080217">.</span><span class="ident" id="7080218">Fatal</span><span class="op" id="7080223">(</span><span class="ident" id="7080224">err</span><span class="op" id="7080227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7080231">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7080235">if</span>&nbsp;<span class="ident" id="7080238">_</span><span class="op" id="7080239">,</span>&nbsp;<span class="ident" id="7080241">ok</span>&nbsp;<span class="op" id="7080244">:=</span>&nbsp;<span class="ident" id="7080247">h</span><span class="op" id="7080248">[</span><span class="string" id="7080249">&#34;Uncommon-Header-For-Benchmark&#34;</span><span class="op" id="7080280">]</span><span class="op" id="7080281">;</span>&nbsp;<span class="op" id="7080283">!</span><span class="ident" id="7080284">ok</span>&nbsp;<span class="op" id="7080287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7080292">b</span><span class="op" id="7080293">.</span><span class="ident" id="7080294">Fatal</span><span class="op" id="7080299">(</span><span class="string" id="7080300">&#34;Missing&nbsp;result&nbsp;header.&#34;</span><span class="op" id="7080324">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7080328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7080331">}</span><br>
<span class="lineno"></span><span class="op" id="7080333">}</span>
</div>
</body>
</html>
