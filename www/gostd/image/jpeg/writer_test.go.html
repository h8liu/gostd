<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/jpeg</h2>
<ul>
<li><a href="/gostd/image/jpeg/dct_test.go.html">dct_test.go</a></li>
<li><a href="/gostd/image/jpeg/fdct.go.html">fdct.go</a></li>
<li><a href="/gostd/image/jpeg/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/image/jpeg/idct.go.html">idct.go</a></li>
<li><a href="/gostd/image/jpeg/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/jpeg/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/jpeg/scan.go.html">scan.go</a></li>
<li><a href="/gostd/image/jpeg/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/jpeg/writer_test.go.html" class="current">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7832725">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7832780">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7832834">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7832885">package</span>&nbsp;<span class="ident" id="7832893">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7832899">import</span>&nbsp;<span class="op" id="7832906">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7832909">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7832918">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7832925">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7832934">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7832949">&#34;image/png&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7832962">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7832975">&#34;math/rand&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7832988">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7832994">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7833004">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7833007">//&nbsp;zigzag&nbsp;maps&nbsp;from&nbsp;the&nbsp;natural&nbsp;ordering&nbsp;to&nbsp;the&nbsp;zig-zag&nbsp;ordering.&nbsp;For&nbsp;example,</span><br>
<span class="lineno">20</span><span class="comment" id="7833086">//&nbsp;zigzag[0*8&nbsp;+&nbsp;3]&nbsp;is&nbsp;the&nbsp;zig-zag&nbsp;sequence&nbsp;number&nbsp;of&nbsp;the&nbsp;element&nbsp;in&nbsp;the&nbsp;fourth</span><br>
<span class="lineno"></span><span class="comment" id="7833165">//&nbsp;column&nbsp;and&nbsp;first&nbsp;row.</span><br>
<span class="lineno"></span><span class="keyword" id="7833190">var</span>&nbsp;<span class="ident" id="7833194">zigzag</span>&nbsp;<span class="op" id="7833201">=</span>&nbsp;<span class="op" id="7833203">[</span><span class="ident" id="7833204">blockSize</span><span class="op" id="7833213">]</span><span class="builtintype" id="7833214">int</span><span class="op" id="7833217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7833220">0</span><span class="op" id="7833221">,</span>&nbsp;<span class="num" id="7833223">1</span><span class="op" id="7833224">,</span>&nbsp;<span class="num" id="7833226">5</span><span class="op" id="7833227">,</span>&nbsp;<span class="num" id="7833229">6</span><span class="op" id="7833230">,</span>&nbsp;<span class="num" id="7833232">14</span><span class="op" id="7833234">,</span>&nbsp;<span class="num" id="7833236">15</span><span class="op" id="7833238">,</span>&nbsp;<span class="num" id="7833240">27</span><span class="op" id="7833242">,</span>&nbsp;<span class="num" id="7833244">28</span><span class="op" id="7833246">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7833249">2</span><span class="op" id="7833250">,</span>&nbsp;<span class="num" id="7833252">4</span><span class="op" id="7833253">,</span>&nbsp;<span class="num" id="7833255">7</span><span class="op" id="7833256">,</span>&nbsp;<span class="num" id="7833258">13</span><span class="op" id="7833260">,</span>&nbsp;<span class="num" id="7833262">16</span><span class="op" id="7833264">,</span>&nbsp;<span class="num" id="7833266">26</span><span class="op" id="7833268">,</span>&nbsp;<span class="num" id="7833270">29</span><span class="op" id="7833272">,</span>&nbsp;<span class="num" id="7833274">42</span><span class="op" id="7833276">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7833279">3</span><span class="op" id="7833280">,</span>&nbsp;<span class="num" id="7833282">8</span><span class="op" id="7833283">,</span>&nbsp;<span class="num" id="7833285">12</span><span class="op" id="7833287">,</span>&nbsp;<span class="num" id="7833289">17</span><span class="op" id="7833291">,</span>&nbsp;<span class="num" id="7833293">25</span><span class="op" id="7833295">,</span>&nbsp;<span class="num" id="7833297">30</span><span class="op" id="7833299">,</span>&nbsp;<span class="num" id="7833301">41</span><span class="op" id="7833303">,</span>&nbsp;<span class="num" id="7833305">43</span><span class="op" id="7833307">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7833310">9</span><span class="op" id="7833311">,</span>&nbsp;<span class="num" id="7833313">11</span><span class="op" id="7833315">,</span>&nbsp;<span class="num" id="7833317">18</span><span class="op" id="7833319">,</span>&nbsp;<span class="num" id="7833321">24</span><span class="op" id="7833323">,</span>&nbsp;<span class="num" id="7833325">31</span><span class="op" id="7833327">,</span>&nbsp;<span class="num" id="7833329">40</span><span class="op" id="7833331">,</span>&nbsp;<span class="num" id="7833333">44</span><span class="op" id="7833335">,</span>&nbsp;<span class="num" id="7833337">53</span><span class="op" id="7833339">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7833342">10</span><span class="op" id="7833344">,</span>&nbsp;<span class="num" id="7833346">19</span><span class="op" id="7833348">,</span>&nbsp;<span class="num" id="7833350">23</span><span class="op" id="7833352">,</span>&nbsp;<span class="num" id="7833354">32</span><span class="op" id="7833356">,</span>&nbsp;<span class="num" id="7833358">39</span><span class="op" id="7833360">,</span>&nbsp;<span class="num" id="7833362">45</span><span class="op" id="7833364">,</span>&nbsp;<span class="num" id="7833366">52</span><span class="op" id="7833368">,</span>&nbsp;<span class="num" id="7833370">54</span><span class="op" id="7833372">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7833375">20</span><span class="op" id="7833377">,</span>&nbsp;<span class="num" id="7833379">22</span><span class="op" id="7833381">,</span>&nbsp;<span class="num" id="7833383">33</span><span class="op" id="7833385">,</span>&nbsp;<span class="num" id="7833387">38</span><span class="op" id="7833389">,</span>&nbsp;<span class="num" id="7833391">46</span><span class="op" id="7833393">,</span>&nbsp;<span class="num" id="7833395">51</span><span class="op" id="7833397">,</span>&nbsp;<span class="num" id="7833399">55</span><span class="op" id="7833401">,</span>&nbsp;<span class="num" id="7833403">60</span><span class="op" id="7833405">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7833408">21</span><span class="op" id="7833410">,</span>&nbsp;<span class="num" id="7833412">34</span><span class="op" id="7833414">,</span>&nbsp;<span class="num" id="7833416">37</span><span class="op" id="7833418">,</span>&nbsp;<span class="num" id="7833420">47</span><span class="op" id="7833422">,</span>&nbsp;<span class="num" id="7833424">50</span><span class="op" id="7833426">,</span>&nbsp;<span class="num" id="7833428">56</span><span class="op" id="7833430">,</span>&nbsp;<span class="num" id="7833432">59</span><span class="op" id="7833434">,</span>&nbsp;<span class="num" id="7833436">61</span><span class="op" id="7833438">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7833441">35</span><span class="op" id="7833443">,</span>&nbsp;<span class="num" id="7833445">36</span><span class="op" id="7833447">,</span>&nbsp;<span class="num" id="7833449">48</span><span class="op" id="7833451">,</span>&nbsp;<span class="num" id="7833453">49</span><span class="op" id="7833455">,</span>&nbsp;<span class="num" id="7833457">57</span><span class="op" id="7833459">,</span>&nbsp;<span class="num" id="7833461">58</span><span class="op" id="7833463">,</span>&nbsp;<span class="num" id="7833465">62</span><span class="op" id="7833467">,</span>&nbsp;<span class="num" id="7833469">63</span><span class="op" id="7833471">,</span><br>
<span class="lineno"></span><span class="op" id="7833473">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7833476">func</span>&nbsp;<span class="ident" id="7833481">TestZigUnzig</span><span class="op" id="7833493">(</span><span class="ident" id="7833494">t</span>&nbsp;<span class="op" id="7833496">*</span><span class="ident" id="7833497">testing</span><span class="op" id="7833504">.</span><span class="ident" id="7833505">T</span><span class="op" id="7833506">)</span>&nbsp;<span class="op" id="7833508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7833511">for</span>&nbsp;<span class="ident" id="7833515">i</span>&nbsp;<span class="op" id="7833517">:=</span>&nbsp;<span class="num" id="7833520">0</span><span class="op" id="7833521">;</span>&nbsp;<span class="ident" id="7833523">i</span>&nbsp;<span class="op" id="7833525">&lt;</span>&nbsp;<span class="ident" id="7833527">blockSize</span><span class="op" id="7833536">;</span>&nbsp;<span class="ident" id="7833538">i</span><span class="op" id="7833539">++</span>&nbsp;<span class="op" id="7833542">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7833546">if</span>&nbsp;<span class="ident" id="7833549">unzig</span><span class="op" id="7833554">[</span><span class="ident" id="7833555">zigzag</span><span class="op" id="7833561">[</span><span class="ident" id="7833562">i</span><span class="op" id="7833563">]</span><span class="op" id="7833564">]</span>&nbsp;<span class="op" id="7833566">!=</span>&nbsp;<span class="ident" id="7833569">i</span>&nbsp;<span class="op" id="7833571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7833576">t</span><span class="op" id="7833577">.</span><span class="ident" id="7833578">Errorf</span><span class="op" id="7833584">(</span><span class="string" id="7833585">&#34;unzig[zigzag[%d]]&nbsp;==&nbsp;%d&#34;</span><span class="op" id="7833610">,</span>&nbsp;<span class="ident" id="7833612">i</span><span class="op" id="7833613">,</span>&nbsp;<span class="ident" id="7833615">unzig</span><span class="op" id="7833620">[</span><span class="ident" id="7833621">zigzag</span><span class="op" id="7833627">[</span><span class="ident" id="7833628">i</span><span class="op" id="7833629">]</span><span class="op" id="7833630">]</span><span class="op" id="7833631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7833635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7833639">if</span>&nbsp;<span class="ident" id="7833642">zigzag</span><span class="op" id="7833648">[</span><span class="ident" id="7833649">unzig</span><span class="op" id="7833654">[</span><span class="ident" id="7833655">i</span><span class="op" id="7833656">]</span><span class="op" id="7833657">]</span>&nbsp;<span class="op" id="7833659">!=</span>&nbsp;<span class="ident" id="7833662">i</span>&nbsp;<span class="op" id="7833664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7833669">t</span><span class="op" id="7833670">.</span><span class="ident" id="7833671">Errorf</span><span class="op" id="7833677">(</span><span class="string" id="7833678">&#34;zigzag[unzig[%d]]&nbsp;==&nbsp;%d&#34;</span><span class="op" id="7833703">,</span>&nbsp;<span class="ident" id="7833705">i</span><span class="op" id="7833706">,</span>&nbsp;<span class="ident" id="7833708">zigzag</span><span class="op" id="7833714">[</span><span class="ident" id="7833715">unzig</span><span class="op" id="7833720">[</span><span class="ident" id="7833721">i</span><span class="op" id="7833722">]</span><span class="op" id="7833723">]</span><span class="op" id="7833724">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7833728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7833731">}</span><br>
<span class="lineno"></span><span class="op" id="7833733">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7833736">//&nbsp;unscaledQuantInNaturalOrder&nbsp;are&nbsp;the&nbsp;unscaled&nbsp;quantization&nbsp;tables&nbsp;in</span><br>
<span class="lineno">45</span><span class="comment" id="7833807">//&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order,&nbsp;as&nbsp;specified&nbsp;in&nbsp;section&nbsp;K.1.</span><br>
<span class="lineno"></span><span class="keyword" id="7833868">var</span>&nbsp;<span class="ident" id="7833872">unscaledQuantInNaturalOrder</span>&nbsp;<span class="op" id="7833900">=</span>&nbsp;<span class="op" id="7833902">[</span><span class="ident" id="7833903">nQuantIndex</span><span class="op" id="7833914">]</span><span class="op" id="7833915">[</span><span class="ident" id="7833916">blockSize</span><span class="op" id="7833925">]</span><span class="builtintype" id="7833926">byte</span><span class="op" id="7833930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7833933">//&nbsp;Luminance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7833948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7833952">16</span><span class="op" id="7833954">,</span>&nbsp;<span class="num" id="7833956">11</span><span class="op" id="7833958">,</span>&nbsp;<span class="num" id="7833960">10</span><span class="op" id="7833962">,</span>&nbsp;<span class="num" id="7833964">16</span><span class="op" id="7833966">,</span>&nbsp;<span class="num" id="7833968">24</span><span class="op" id="7833970">,</span>&nbsp;<span class="num" id="7833972">40</span><span class="op" id="7833974">,</span>&nbsp;<span class="num" id="7833976">51</span><span class="op" id="7833978">,</span>&nbsp;<span class="num" id="7833980">61</span><span class="op" id="7833982">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7833986">12</span><span class="op" id="7833988">,</span>&nbsp;<span class="num" id="7833990">12</span><span class="op" id="7833992">,</span>&nbsp;<span class="num" id="7833994">14</span><span class="op" id="7833996">,</span>&nbsp;<span class="num" id="7833998">19</span><span class="op" id="7834000">,</span>&nbsp;<span class="num" id="7834002">26</span><span class="op" id="7834004">,</span>&nbsp;<span class="num" id="7834006">58</span><span class="op" id="7834008">,</span>&nbsp;<span class="num" id="7834010">60</span><span class="op" id="7834012">,</span>&nbsp;<span class="num" id="7834014">55</span><span class="op" id="7834016">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7834020">14</span><span class="op" id="7834022">,</span>&nbsp;<span class="num" id="7834024">13</span><span class="op" id="7834026">,</span>&nbsp;<span class="num" id="7834028">16</span><span class="op" id="7834030">,</span>&nbsp;<span class="num" id="7834032">24</span><span class="op" id="7834034">,</span>&nbsp;<span class="num" id="7834036">40</span><span class="op" id="7834038">,</span>&nbsp;<span class="num" id="7834040">57</span><span class="op" id="7834042">,</span>&nbsp;<span class="num" id="7834044">69</span><span class="op" id="7834046">,</span>&nbsp;<span class="num" id="7834048">56</span><span class="op" id="7834050">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7834054">14</span><span class="op" id="7834056">,</span>&nbsp;<span class="num" id="7834058">17</span><span class="op" id="7834060">,</span>&nbsp;<span class="num" id="7834062">22</span><span class="op" id="7834064">,</span>&nbsp;<span class="num" id="7834066">29</span><span class="op" id="7834068">,</span>&nbsp;<span class="num" id="7834070">51</span><span class="op" id="7834072">,</span>&nbsp;<span class="num" id="7834074">87</span><span class="op" id="7834076">,</span>&nbsp;<span class="num" id="7834078">80</span><span class="op" id="7834080">,</span>&nbsp;<span class="num" id="7834082">62</span><span class="op" id="7834084">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7834088">18</span><span class="op" id="7834090">,</span>&nbsp;<span class="num" id="7834092">22</span><span class="op" id="7834094">,</span>&nbsp;<span class="num" id="7834096">37</span><span class="op" id="7834098">,</span>&nbsp;<span class="num" id="7834100">56</span><span class="op" id="7834102">,</span>&nbsp;<span class="num" id="7834104">68</span><span class="op" id="7834106">,</span>&nbsp;<span class="num" id="7834108">109</span><span class="op" id="7834111">,</span>&nbsp;<span class="num" id="7834113">103</span><span class="op" id="7834116">,</span>&nbsp;<span class="num" id="7834118">77</span><span class="op" id="7834120">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7834124">24</span><span class="op" id="7834126">,</span>&nbsp;<span class="num" id="7834128">35</span><span class="op" id="7834130">,</span>&nbsp;<span class="num" id="7834132">55</span><span class="op" id="7834134">,</span>&nbsp;<span class="num" id="7834136">64</span><span class="op" id="7834138">,</span>&nbsp;<span class="num" id="7834140">81</span><span class="op" id="7834142">,</span>&nbsp;<span class="num" id="7834144">104</span><span class="op" id="7834147">,</span>&nbsp;<span class="num" id="7834149">113</span><span class="op" id="7834152">,</span>&nbsp;<span class="num" id="7834154">92</span><span class="op" id="7834156">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7834160">49</span><span class="op" id="7834162">,</span>&nbsp;<span class="num" id="7834164">64</span><span class="op" id="7834166">,</span>&nbsp;<span class="num" id="7834168">78</span><span class="op" id="7834170">,</span>&nbsp;<span class="num" id="7834172">87</span><span class="op" id="7834174">,</span>&nbsp;<span class="num" id="7834176">103</span><span class="op" id="7834179">,</span>&nbsp;<span class="num" id="7834181">121</span><span class="op" id="7834184">,</span>&nbsp;<span class="num" id="7834186">120</span><span class="op" id="7834189">,</span>&nbsp;<span class="num" id="7834191">101</span><span class="op" id="7834194">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7834198">72</span><span class="op" id="7834200">,</span>&nbsp;<span class="num" id="7834202">92</span><span class="op" id="7834204">,</span>&nbsp;<span class="num" id="7834206">95</span><span class="op" id="7834208">,</span>&nbsp;<span class="num" id="7834210">98</span><span class="op" id="7834212">,</span>&nbsp;<span class="num" id="7834214">112</span><span class="op" id="7834217">,</span>&nbsp;<span class="num" id="7834219">100</span><span class="op" id="7834222">,</span>&nbsp;<span class="num" id="7834224">103</span><span class="op" id="7834227">,</span>&nbsp;<span class="num" id="7834229">99</span><span class="op" id="7834231">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7834234">}</span><span class="op" id="7834235">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7834238">//&nbsp;Chrominance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7834255">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7834259">17</span><span class="op" id="7834261">,</span>&nbsp;<span class="num" id="7834263">18</span><span class="op" id="7834265">,</span>&nbsp;<span class="num" id="7834267">24</span><span class="op" id="7834269">,</span>&nbsp;<span class="num" id="7834271">47</span><span class="op" id="7834273">,</span>&nbsp;<span class="num" id="7834275">99</span><span class="op" id="7834277">,</span>&nbsp;<span class="num" id="7834279">99</span><span class="op" id="7834281">,</span>&nbsp;<span class="num" id="7834283">99</span><span class="op" id="7834285">,</span>&nbsp;<span class="num" id="7834287">99</span><span class="op" id="7834289">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7834293">18</span><span class="op" id="7834295">,</span>&nbsp;<span class="num" id="7834297">21</span><span class="op" id="7834299">,</span>&nbsp;<span class="num" id="7834301">26</span><span class="op" id="7834303">,</span>&nbsp;<span class="num" id="7834305">66</span><span class="op" id="7834307">,</span>&nbsp;<span class="num" id="7834309">99</span><span class="op" id="7834311">,</span>&nbsp;<span class="num" id="7834313">99</span><span class="op" id="7834315">,</span>&nbsp;<span class="num" id="7834317">99</span><span class="op" id="7834319">,</span>&nbsp;<span class="num" id="7834321">99</span><span class="op" id="7834323">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7834327">24</span><span class="op" id="7834329">,</span>&nbsp;<span class="num" id="7834331">26</span><span class="op" id="7834333">,</span>&nbsp;<span class="num" id="7834335">56</span><span class="op" id="7834337">,</span>&nbsp;<span class="num" id="7834339">99</span><span class="op" id="7834341">,</span>&nbsp;<span class="num" id="7834343">99</span><span class="op" id="7834345">,</span>&nbsp;<span class="num" id="7834347">99</span><span class="op" id="7834349">,</span>&nbsp;<span class="num" id="7834351">99</span><span class="op" id="7834353">,</span>&nbsp;<span class="num" id="7834355">99</span><span class="op" id="7834357">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7834361">47</span><span class="op" id="7834363">,</span>&nbsp;<span class="num" id="7834365">66</span><span class="op" id="7834367">,</span>&nbsp;<span class="num" id="7834369">99</span><span class="op" id="7834371">,</span>&nbsp;<span class="num" id="7834373">99</span><span class="op" id="7834375">,</span>&nbsp;<span class="num" id="7834377">99</span><span class="op" id="7834379">,</span>&nbsp;<span class="num" id="7834381">99</span><span class="op" id="7834383">,</span>&nbsp;<span class="num" id="7834385">99</span><span class="op" id="7834387">,</span>&nbsp;<span class="num" id="7834389">99</span><span class="op" id="7834391">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7834395">99</span><span class="op" id="7834397">,</span>&nbsp;<span class="num" id="7834399">99</span><span class="op" id="7834401">,</span>&nbsp;<span class="num" id="7834403">99</span><span class="op" id="7834405">,</span>&nbsp;<span class="num" id="7834407">99</span><span class="op" id="7834409">,</span>&nbsp;<span class="num" id="7834411">99</span><span class="op" id="7834413">,</span>&nbsp;<span class="num" id="7834415">99</span><span class="op" id="7834417">,</span>&nbsp;<span class="num" id="7834419">99</span><span class="op" id="7834421">,</span>&nbsp;<span class="num" id="7834423">99</span><span class="op" id="7834425">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7834429">99</span><span class="op" id="7834431">,</span>&nbsp;<span class="num" id="7834433">99</span><span class="op" id="7834435">,</span>&nbsp;<span class="num" id="7834437">99</span><span class="op" id="7834439">,</span>&nbsp;<span class="num" id="7834441">99</span><span class="op" id="7834443">,</span>&nbsp;<span class="num" id="7834445">99</span><span class="op" id="7834447">,</span>&nbsp;<span class="num" id="7834449">99</span><span class="op" id="7834451">,</span>&nbsp;<span class="num" id="7834453">99</span><span class="op" id="7834455">,</span>&nbsp;<span class="num" id="7834457">99</span><span class="op" id="7834459">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7834463">99</span><span class="op" id="7834465">,</span>&nbsp;<span class="num" id="7834467">99</span><span class="op" id="7834469">,</span>&nbsp;<span class="num" id="7834471">99</span><span class="op" id="7834473">,</span>&nbsp;<span class="num" id="7834475">99</span><span class="op" id="7834477">,</span>&nbsp;<span class="num" id="7834479">99</span><span class="op" id="7834481">,</span>&nbsp;<span class="num" id="7834483">99</span><span class="op" id="7834485">,</span>&nbsp;<span class="num" id="7834487">99</span><span class="op" id="7834489">,</span>&nbsp;<span class="num" id="7834491">99</span><span class="op" id="7834493">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7834497">99</span><span class="op" id="7834499">,</span>&nbsp;<span class="num" id="7834501">99</span><span class="op" id="7834503">,</span>&nbsp;<span class="num" id="7834505">99</span><span class="op" id="7834507">,</span>&nbsp;<span class="num" id="7834509">99</span><span class="op" id="7834511">,</span>&nbsp;<span class="num" id="7834513">99</span><span class="op" id="7834515">,</span>&nbsp;<span class="num" id="7834517">99</span><span class="op" id="7834519">,</span>&nbsp;<span class="num" id="7834521">99</span><span class="op" id="7834523">,</span>&nbsp;<span class="num" id="7834525">99</span><span class="op" id="7834527">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7834530">}</span><span class="op" id="7834531">,</span><br>
<span class="lineno"></span><span class="op" id="7834533">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="7834536">func</span>&nbsp;<span class="ident" id="7834541">TestUnscaledQuant</span><span class="op" id="7834558">(</span><span class="ident" id="7834559">t</span>&nbsp;<span class="op" id="7834561">*</span><span class="ident" id="7834562">testing</span><span class="op" id="7834569">.</span><span class="ident" id="7834570">T</span><span class="op" id="7834571">)</span>&nbsp;<span class="op" id="7834573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7834576">bad</span>&nbsp;<span class="op" id="7834580">:=</span>&nbsp;<span class="builtintype" id="7834583">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7834590">for</span>&nbsp;<span class="ident" id="7834594">i</span>&nbsp;<span class="op" id="7834596">:=</span>&nbsp;<span class="ident" id="7834599">quantIndex</span><span class="op" id="7834609">(</span><span class="num" id="7834610">0</span><span class="op" id="7834611">)</span><span class="op" id="7834612">;</span>&nbsp;<span class="ident" id="7834614">i</span>&nbsp;<span class="op" id="7834616">&lt;</span>&nbsp;<span class="ident" id="7834618">nQuantIndex</span><span class="op" id="7834629">;</span>&nbsp;<span class="ident" id="7834631">i</span><span class="op" id="7834632">++</span>&nbsp;<span class="op" id="7834635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7834639">for</span>&nbsp;<span class="ident" id="7834643">zig</span>&nbsp;<span class="op" id="7834647">:=</span>&nbsp;<span class="num" id="7834650">0</span><span class="op" id="7834651">;</span>&nbsp;<span class="ident" id="7834653">zig</span>&nbsp;<span class="op" id="7834657">&lt;</span>&nbsp;<span class="ident" id="7834659">blockSize</span><span class="op" id="7834668">;</span>&nbsp;<span class="ident" id="7834670">zig</span><span class="op" id="7834673">++</span>&nbsp;<span class="op" id="7834676">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7834681">got</span>&nbsp;<span class="op" id="7834685">:=</span>&nbsp;<span class="ident" id="7834688">unscaledQuant</span><span class="op" id="7834701">[</span><span class="ident" id="7834702">i</span><span class="op" id="7834703">]</span><span class="op" id="7834704">[</span><span class="ident" id="7834705">zig</span><span class="op" id="7834708">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7834713">want</span>&nbsp;<span class="op" id="7834718">:=</span>&nbsp;<span class="ident" id="7834721">unscaledQuantInNaturalOrder</span><span class="op" id="7834748">[</span><span class="ident" id="7834749">i</span><span class="op" id="7834750">]</span><span class="op" id="7834751">[</span><span class="ident" id="7834752">unzig</span><span class="op" id="7834757">[</span><span class="ident" id="7834758">zig</span><span class="op" id="7834761">]</span><span class="op" id="7834762">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7834767">if</span>&nbsp;<span class="ident" id="7834770">got</span>&nbsp;<span class="op" id="7834774">!=</span>&nbsp;<span class="ident" id="7834777">want</span>&nbsp;<span class="op" id="7834782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7834788">t</span><span class="op" id="7834789">.</span><span class="ident" id="7834790">Errorf</span><span class="op" id="7834796">(</span><span class="string" id="7834797">&#34;i=%d,&nbsp;zig=%d:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7834828">,</span>&nbsp;<span class="ident" id="7834830">i</span><span class="op" id="7834831">,</span>&nbsp;<span class="ident" id="7834833">zig</span><span class="op" id="7834836">,</span>&nbsp;<span class="ident" id="7834838">got</span><span class="op" id="7834841">,</span>&nbsp;<span class="ident" id="7834843">want</span><span class="op" id="7834847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7834853">bad</span>&nbsp;<span class="op" id="7834857">=</span>&nbsp;<span class="builtintype" id="7834859">true</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7834867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7834871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7834874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7834877">if</span>&nbsp;<span class="ident" id="7834880">bad</span>&nbsp;<span class="op" id="7834884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7834888">names</span>&nbsp;<span class="op" id="7834894">:=</span>&nbsp;<span class="op" id="7834897">[</span><span class="ident" id="7834898">nQuantIndex</span><span class="op" id="7834909">]</span><span class="builtintype" id="7834910">string</span><span class="op" id="7834916">{</span><span class="string" id="7834917">&#34;Luminance&#34;</span><span class="op" id="7834928">,</span>&nbsp;<span class="string" id="7834930">&#34;Chrominance&#34;</span><span class="op" id="7834943">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7834947">buf</span>&nbsp;<span class="op" id="7834951">:=</span>&nbsp;<span class="op" id="7834954">&amp;</span><span class="ident" id="7834955">bytes</span><span class="op" id="7834960">.</span><span class="ident" id="7834961">Buffer</span><span class="op" id="7834967">{</span><span class="op" id="7834968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7834972">for</span>&nbsp;<span class="ident" id="7834976">i</span><span class="op" id="7834977">,</span>&nbsp;<span class="ident" id="7834979">name</span>&nbsp;<span class="op" id="7834984">:=</span>&nbsp;<span class="keyword" id="7834987">range</span>&nbsp;<span class="ident" id="7834993">names</span>&nbsp;<span class="op" id="7834999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7835004">fmt</span><span class="op" id="7835007">.</span><span class="ident" id="7835008">Fprintf</span><span class="op" id="7835015">(</span><span class="ident" id="7835016">buf</span><span class="op" id="7835019">,</span>&nbsp;<span class="string" id="7835021">&#34;//&nbsp;%s.\n{\n&#34;</span><span class="op" id="7835034">,</span>&nbsp;<span class="ident" id="7835036">name</span><span class="op" id="7835040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7835045">for</span>&nbsp;<span class="ident" id="7835049">zig</span>&nbsp;<span class="op" id="7835053">:=</span>&nbsp;<span class="num" id="7835056">0</span><span class="op" id="7835057">;</span>&nbsp;<span class="ident" id="7835059">zig</span>&nbsp;<span class="op" id="7835063">&lt;</span>&nbsp;<span class="ident" id="7835065">blockSize</span><span class="op" id="7835074">;</span>&nbsp;<span class="ident" id="7835076">zig</span><span class="op" id="7835079">++</span>&nbsp;<span class="op" id="7835082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7835088">fmt</span><span class="op" id="7835091">.</span><span class="ident" id="7835092">Fprintf</span><span class="op" id="7835099">(</span><span class="ident" id="7835100">buf</span><span class="op" id="7835103">,</span>&nbsp;<span class="string" id="7835105">&#34;%d,&nbsp;&#34;</span><span class="op" id="7835111">,</span>&nbsp;<span class="ident" id="7835113">unscaledQuantInNaturalOrder</span><span class="op" id="7835140">[</span><span class="ident" id="7835141">i</span><span class="op" id="7835142">]</span><span class="op" id="7835143">[</span><span class="ident" id="7835144">unzig</span><span class="op" id="7835149">[</span><span class="ident" id="7835150">zig</span><span class="op" id="7835153">]</span><span class="op" id="7835154">]</span><span class="op" id="7835155">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7835161">if</span>&nbsp;<span class="ident" id="7835164">zig</span><span class="op" id="7835167">%</span><span class="num" id="7835168">8</span>&nbsp;<span class="op" id="7835170">==</span>&nbsp;<span class="num" id="7835173">7</span>&nbsp;<span class="op" id="7835175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7835182">buf</span><span class="op" id="7835185">.</span><span class="ident" id="7835186">WriteString</span><span class="op" id="7835197">(</span><span class="string" id="7835198">&#34;\n&#34;</span><span class="op" id="7835202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7835208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7835213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7835218">buf</span><span class="op" id="7835221">.</span><span class="ident" id="7835222">WriteString</span><span class="op" id="7835233">(</span><span class="string" id="7835234">&#34;},\n&#34;</span><span class="op" id="7835240">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7835244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7835248">t</span><span class="op" id="7835249">.</span><span class="ident" id="7835250">Logf</span><span class="op" id="7835254">(</span><span class="string" id="7835255">&#34;expected&nbsp;unscaledQuant&nbsp;values:\n%s&#34;</span><span class="op" id="7835291">,</span>&nbsp;<span class="ident" id="7835293">buf</span><span class="op" id="7835296">.</span><span class="ident" id="7835297">String</span><span class="op" id="7835303">(</span><span class="op" id="7835304">)</span><span class="op" id="7835305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7835308">}</span><br>
<span class="lineno"></span><span class="op" id="7835310">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="7835313">var</span>&nbsp;<span class="ident" id="7835317">testCase</span>&nbsp;<span class="op" id="7835326">=</span>&nbsp;<span class="op" id="7835328">[</span><span class="op" id="7835329">]</span><span class="keyword" id="7835330">struct</span>&nbsp;<span class="op" id="7835337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7835340">filename</span>&nbsp;&nbsp;<span class="builtintype" id="7835350">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7835358">quality</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7835368">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7835373">tolerance</span>&nbsp;<span class="ident" id="7835383">int64</span><br>
<span class="lineno"></span><span class="op" id="7835389">}</span><span class="op" id="7835390">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7835393">{</span><span class="string" id="7835394">&#34;../testdata/video-001.png&#34;</span><span class="op" id="7835421">,</span>&nbsp;<span class="num" id="7835423">1</span><span class="op" id="7835424">,</span>&nbsp;<span class="num" id="7835426">24</span>&nbsp;<span class="op" id="7835429">&lt;&lt;</span>&nbsp;<span class="num" id="7835432">8</span><span class="op" id="7835433">}</span><span class="op" id="7835434">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7835437">{</span><span class="string" id="7835438">&#34;../testdata/video-001.png&#34;</span><span class="op" id="7835465">,</span>&nbsp;<span class="num" id="7835467">20</span><span class="op" id="7835469">,</span>&nbsp;<span class="num" id="7835471">12</span>&nbsp;<span class="op" id="7835474">&lt;&lt;</span>&nbsp;<span class="num" id="7835477">8</span><span class="op" id="7835478">}</span><span class="op" id="7835479">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7835482">{</span><span class="string" id="7835483">&#34;../testdata/video-001.png&#34;</span><span class="op" id="7835510">,</span>&nbsp;<span class="num" id="7835512">60</span><span class="op" id="7835514">,</span>&nbsp;<span class="num" id="7835516">8</span>&nbsp;<span class="op" id="7835518">&lt;&lt;</span>&nbsp;<span class="num" id="7835521">8</span><span class="op" id="7835522">}</span><span class="op" id="7835523">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7835526">{</span><span class="string" id="7835527">&#34;../testdata/video-001.png&#34;</span><span class="op" id="7835554">,</span>&nbsp;<span class="num" id="7835556">80</span><span class="op" id="7835558">,</span>&nbsp;<span class="num" id="7835560">6</span>&nbsp;<span class="op" id="7835562">&lt;&lt;</span>&nbsp;<span class="num" id="7835565">8</span><span class="op" id="7835566">}</span><span class="op" id="7835567">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7835570">{</span><span class="string" id="7835571">&#34;../testdata/video-001.png&#34;</span><span class="op" id="7835598">,</span>&nbsp;<span class="num" id="7835600">90</span><span class="op" id="7835602">,</span>&nbsp;<span class="num" id="7835604">4</span>&nbsp;<span class="op" id="7835606">&lt;&lt;</span>&nbsp;<span class="num" id="7835609">8</span><span class="op" id="7835610">}</span><span class="op" id="7835611">,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7835614">{</span><span class="string" id="7835615">&#34;../testdata/video-001.png&#34;</span><span class="op" id="7835642">,</span>&nbsp;<span class="num" id="7835644">100</span><span class="op" id="7835647">,</span>&nbsp;<span class="num" id="7835649">2</span>&nbsp;<span class="op" id="7835651">&lt;&lt;</span>&nbsp;<span class="num" id="7835654">8</span><span class="op" id="7835655">}</span><span class="op" id="7835656">,</span><br>
<span class="lineno"></span><span class="op" id="7835658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7835661">func</span>&nbsp;<span class="ident" id="7835666">delta</span><span class="op" id="7835671">(</span><span class="ident" id="7835672">u0</span><span class="op" id="7835674">,</span>&nbsp;<span class="ident" id="7835676">u1</span>&nbsp;<span class="builtintype" id="7835679">uint32</span><span class="op" id="7835685">)</span>&nbsp;<span class="ident" id="7835687">int64</span>&nbsp;<span class="op" id="7835693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7835696">d</span>&nbsp;<span class="op" id="7835698">:=</span>&nbsp;<span class="ident" id="7835701">int64</span><span class="op" id="7835706">(</span><span class="ident" id="7835707">u0</span><span class="op" id="7835709">)</span>&nbsp;<span class="op" id="7835711">-</span>&nbsp;<span class="ident" id="7835713">int64</span><span class="op" id="7835718">(</span><span class="ident" id="7835719">u1</span><span class="op" id="7835721">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7835724">if</span>&nbsp;<span class="ident" id="7835727">d</span>&nbsp;<span class="op" id="7835729">&lt;</span>&nbsp;<span class="num" id="7835731">0</span>&nbsp;<span class="op" id="7835733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7835737">return</span>&nbsp;<span class="op" id="7835744">-</span><span class="ident" id="7835745">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7835748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7835751">return</span>&nbsp;<span class="ident" id="7835758">d</span><br>
<span class="lineno"></span><span class="op" id="7835760">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="7835763">func</span>&nbsp;<span class="ident" id="7835768">readPng</span><span class="op" id="7835775">(</span><span class="ident" id="7835776">filename</span>&nbsp;<span class="builtintype" id="7835785">string</span><span class="op" id="7835791">)</span>&nbsp;<span class="op" id="7835793">(</span><span class="ident" id="7835794">image</span><span class="op" id="7835799">.</span><span class="ident" id="7835800">Image</span><span class="op" id="7835805">,</span>&nbsp;<span class="builtintype" id="7835807">error</span><span class="op" id="7835812">)</span>&nbsp;<span class="op" id="7835814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7835817">f</span><span class="op" id="7835818">,</span>&nbsp;<span class="ident" id="7835820">err</span>&nbsp;<span class="op" id="7835824">:=</span>&nbsp;<span class="ident" id="7835827">os</span><span class="op" id="7835829">.</span><span class="ident" id="7835830">Open</span><span class="op" id="7835834">(</span><span class="ident" id="7835835">filename</span><span class="op" id="7835843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7835846">if</span>&nbsp;<span class="ident" id="7835849">err</span>&nbsp;<span class="op" id="7835853">!=</span>&nbsp;<span class="builtintype" id="7835856">nil</span>&nbsp;<span class="op" id="7835860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7835864">return</span>&nbsp;<span class="builtintype" id="7835871">nil</span><span class="op" id="7835874">,</span>&nbsp;<span class="ident" id="7835876">err</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7835881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7835884">defer</span>&nbsp;<span class="ident" id="7835890">f</span><span class="op" id="7835891">.</span><span class="ident" id="7835892">Close</span><span class="op" id="7835897">(</span><span class="op" id="7835898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7835901">return</span>&nbsp;<span class="ident" id="7835908">png</span><span class="op" id="7835911">.</span><span class="ident" id="7835912">Decode</span><span class="op" id="7835918">(</span><span class="ident" id="7835919">f</span><span class="op" id="7835920">)</span><br>
<span class="lineno"></span><span class="op" id="7835922">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="7835925">func</span>&nbsp;<span class="ident" id="7835930">TestWriter</span><span class="op" id="7835940">(</span><span class="ident" id="7835941">t</span>&nbsp;<span class="op" id="7835943">*</span><span class="ident" id="7835944">testing</span><span class="op" id="7835951">.</span><span class="ident" id="7835952">T</span><span class="op" id="7835953">)</span>&nbsp;<span class="op" id="7835955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7835958">for</span>&nbsp;<span class="ident" id="7835962">_</span><span class="op" id="7835963">,</span>&nbsp;<span class="ident" id="7835965">tc</span>&nbsp;<span class="op" id="7835968">:=</span>&nbsp;<span class="keyword" id="7835971">range</span>&nbsp;<span class="ident" id="7835977">testCase</span>&nbsp;<span class="op" id="7835986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7835990">//&nbsp;Read&nbsp;the&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7836011">m0</span><span class="op" id="7836013">,</span>&nbsp;<span class="ident" id="7836015">err</span>&nbsp;<span class="op" id="7836019">:=</span>&nbsp;<span class="ident" id="7836022">readPng</span><span class="op" id="7836029">(</span><span class="ident" id="7836030">tc</span><span class="op" id="7836032">.</span><span class="ident" id="7836033">filename</span><span class="op" id="7836041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7836045">if</span>&nbsp;<span class="ident" id="7836048">err</span>&nbsp;<span class="op" id="7836052">!=</span>&nbsp;<span class="builtintype" id="7836055">nil</span>&nbsp;<span class="op" id="7836059">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7836064">t</span><span class="op" id="7836065">.</span><span class="ident" id="7836066">Error</span><span class="op" id="7836071">(</span><span class="ident" id="7836072">tc</span><span class="op" id="7836074">.</span><span class="ident" id="7836075">filename</span><span class="op" id="7836083">,</span>&nbsp;<span class="ident" id="7836085">err</span><span class="op" id="7836088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7836093">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7836104">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7836108">//&nbsp;Encode&nbsp;that&nbsp;image&nbsp;as&nbsp;JPEG.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7836140">var</span>&nbsp;<span class="ident" id="7836144">buf</span>&nbsp;<span class="ident" id="7836148">bytes</span><span class="op" id="7836153">.</span><span class="ident" id="7836154">Buffer</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7836163">err</span>&nbsp;<span class="op" id="7836167">=</span>&nbsp;<span class="ident" id="7836169">Encode</span><span class="op" id="7836175">(</span><span class="op" id="7836176">&amp;</span><span class="ident" id="7836177">buf</span><span class="op" id="7836180">,</span>&nbsp;<span class="ident" id="7836182">m0</span><span class="op" id="7836184">,</span>&nbsp;<span class="op" id="7836186">&amp;</span><span class="ident" id="7836187">Options</span><span class="op" id="7836194">{</span><span class="ident" id="7836195">Quality</span><span class="op" id="7836202">:</span>&nbsp;<span class="ident" id="7836204">tc</span><span class="op" id="7836206">.</span><span class="ident" id="7836207">quality</span><span class="op" id="7836214">}</span><span class="op" id="7836215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7836219">if</span>&nbsp;<span class="ident" id="7836222">err</span>&nbsp;<span class="op" id="7836226">!=</span>&nbsp;<span class="builtintype" id="7836229">nil</span>&nbsp;<span class="op" id="7836233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7836238">t</span><span class="op" id="7836239">.</span><span class="ident" id="7836240">Error</span><span class="op" id="7836245">(</span><span class="ident" id="7836246">tc</span><span class="op" id="7836248">.</span><span class="ident" id="7836249">filename</span><span class="op" id="7836257">,</span>&nbsp;<span class="ident" id="7836259">err</span><span class="op" id="7836262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7836267">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7836278">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7836282">//&nbsp;Decode&nbsp;that&nbsp;JPEG.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7836305">m1</span><span class="op" id="7836307">,</span>&nbsp;<span class="ident" id="7836309">err</span>&nbsp;<span class="op" id="7836313">:=</span>&nbsp;<span class="ident" id="7836316">Decode</span><span class="op" id="7836322">(</span><span class="op" id="7836323">&amp;</span><span class="ident" id="7836324">buf</span><span class="op" id="7836327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7836331">if</span>&nbsp;<span class="ident" id="7836334">err</span>&nbsp;<span class="op" id="7836338">!=</span>&nbsp;<span class="builtintype" id="7836341">nil</span>&nbsp;<span class="op" id="7836345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7836350">t</span><span class="op" id="7836351">.</span><span class="ident" id="7836352">Error</span><span class="op" id="7836357">(</span><span class="ident" id="7836358">tc</span><span class="op" id="7836360">.</span><span class="ident" id="7836361">filename</span><span class="op" id="7836369">,</span>&nbsp;<span class="ident" id="7836371">err</span><span class="op" id="7836374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7836379">continue</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7836390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7836394">if</span>&nbsp;<span class="ident" id="7836397">m0</span><span class="op" id="7836399">.</span><span class="ident" id="7836400">Bounds</span><span class="op" id="7836406">(</span><span class="op" id="7836407">)</span>&nbsp;<span class="op" id="7836409">!=</span>&nbsp;<span class="ident" id="7836412">m1</span><span class="op" id="7836414">.</span><span class="ident" id="7836415">Bounds</span><span class="op" id="7836421">(</span><span class="op" id="7836422">)</span>&nbsp;<span class="op" id="7836424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7836429">t</span><span class="op" id="7836430">.</span><span class="ident" id="7836431">Errorf</span><span class="op" id="7836437">(</span><span class="string" id="7836438">&#34;%s,&nbsp;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="7836468">,</span>&nbsp;<span class="ident" id="7836470">tc</span><span class="op" id="7836472">.</span><span class="ident" id="7836473">filename</span><span class="op" id="7836481">,</span>&nbsp;<span class="ident" id="7836483">m0</span><span class="op" id="7836485">.</span><span class="ident" id="7836486">Bounds</span><span class="op" id="7836492">(</span><span class="op" id="7836493">)</span><span class="op" id="7836494">,</span>&nbsp;<span class="ident" id="7836496">m1</span><span class="op" id="7836498">.</span><span class="ident" id="7836499">Bounds</span><span class="op" id="7836505">(</span><span class="op" id="7836506">)</span><span class="op" id="7836507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7836512">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7836523">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7836527">//&nbsp;Compare&nbsp;the&nbsp;average&nbsp;delta&nbsp;to&nbsp;the&nbsp;tolerance&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7836582">if</span>&nbsp;<span class="ident" id="7836585">averageDelta</span><span class="op" id="7836597">(</span><span class="ident" id="7836598">m0</span><span class="op" id="7836600">,</span>&nbsp;<span class="ident" id="7836602">m1</span><span class="op" id="7836604">)</span>&nbsp;<span class="op" id="7836606">&gt;</span>&nbsp;<span class="ident" id="7836608">tc</span><span class="op" id="7836610">.</span><span class="ident" id="7836611">tolerance</span>&nbsp;<span class="op" id="7836621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7836626">t</span><span class="op" id="7836627">.</span><span class="ident" id="7836628">Errorf</span><span class="op" id="7836634">(</span><span class="string" id="7836635">&#34;%s,&nbsp;quality=%d:&nbsp;average&nbsp;delta&nbsp;is&nbsp;too&nbsp;high&#34;</span><span class="op" id="7836678">,</span>&nbsp;<span class="ident" id="7836680">tc</span><span class="op" id="7836682">.</span><span class="ident" id="7836683">filename</span><span class="op" id="7836691">,</span>&nbsp;<span class="ident" id="7836693">tc</span><span class="op" id="7836695">.</span><span class="ident" id="7836696">quality</span><span class="op" id="7836703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7836708">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7836719">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7836722">}</span><br>
<span class="lineno"></span><span class="op" id="7836724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7836727">//&nbsp;TestWriteGrayscale&nbsp;tests&nbsp;that&nbsp;a&nbsp;grayscale&nbsp;images&nbsp;survives&nbsp;a&nbsp;round-trip</span><br>
<span class="lineno"></span><span class="comment" id="7836801">//&nbsp;through&nbsp;encode/decode&nbsp;cycle.</span><br>
<span class="lineno">165</span><span class="keyword" id="7836833">func</span>&nbsp;<span class="ident" id="7836838">TestWriteGrayscale</span><span class="op" id="7836856">(</span><span class="ident" id="7836857">t</span>&nbsp;<span class="op" id="7836859">*</span><span class="ident" id="7836860">testing</span><span class="op" id="7836867">.</span><span class="ident" id="7836868">T</span><span class="op" id="7836869">)</span>&nbsp;<span class="op" id="7836871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7836874">m0</span>&nbsp;<span class="op" id="7836877">:=</span>&nbsp;<span class="ident" id="7836880">image</span><span class="op" id="7836885">.</span><span class="ident" id="7836886">NewGray</span><span class="op" id="7836893">(</span><span class="ident" id="7836894">image</span><span class="op" id="7836899">.</span><span class="ident" id="7836900">Rect</span><span class="op" id="7836904">(</span><span class="num" id="7836905">0</span><span class="op" id="7836906">,</span>&nbsp;<span class="num" id="7836908">0</span><span class="op" id="7836909">,</span>&nbsp;<span class="num" id="7836911">32</span><span class="op" id="7836913">,</span>&nbsp;<span class="num" id="7836915">32</span><span class="op" id="7836917">)</span><span class="op" id="7836918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7836921">for</span>&nbsp;<span class="ident" id="7836925">i</span>&nbsp;<span class="op" id="7836927">:=</span>&nbsp;<span class="keyword" id="7836930">range</span>&nbsp;<span class="ident" id="7836936">m0</span><span class="op" id="7836938">.</span><span class="ident" id="7836939">Pix</span>&nbsp;<span class="op" id="7836943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7836947">m0</span><span class="op" id="7836949">.</span><span class="ident" id="7836950">Pix</span><span class="op" id="7836953">[</span><span class="ident" id="7836954">i</span><span class="op" id="7836955">]</span>&nbsp;<span class="op" id="7836957">=</span>&nbsp;<span class="builtintype" id="7836959">uint8</span><span class="op" id="7836964">(</span><span class="ident" id="7836965">i</span><span class="op" id="7836966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7836969">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7836972">var</span>&nbsp;<span class="ident" id="7836976">buf</span>&nbsp;<span class="ident" id="7836980">bytes</span><span class="op" id="7836985">.</span><span class="ident" id="7836986">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7836994">if</span>&nbsp;<span class="ident" id="7836997">err</span>&nbsp;<span class="op" id="7837001">:=</span>&nbsp;<span class="ident" id="7837004">Encode</span><span class="op" id="7837010">(</span><span class="op" id="7837011">&amp;</span><span class="ident" id="7837012">buf</span><span class="op" id="7837015">,</span>&nbsp;<span class="ident" id="7837017">m0</span><span class="op" id="7837019">,</span>&nbsp;<span class="builtintype" id="7837021">nil</span><span class="op" id="7837024">)</span><span class="op" id="7837025">;</span>&nbsp;<span class="ident" id="7837027">err</span>&nbsp;<span class="op" id="7837031">!=</span>&nbsp;<span class="builtintype" id="7837034">nil</span>&nbsp;<span class="op" id="7837038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7837042">t</span><span class="op" id="7837043">.</span><span class="ident" id="7837044">Fatal</span><span class="op" id="7837049">(</span><span class="ident" id="7837050">err</span><span class="op" id="7837053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7837056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7837059">m1</span><span class="op" id="7837061">,</span>&nbsp;<span class="ident" id="7837063">err</span>&nbsp;<span class="op" id="7837067">:=</span>&nbsp;<span class="ident" id="7837070">Decode</span><span class="op" id="7837076">(</span><span class="op" id="7837077">&amp;</span><span class="ident" id="7837078">buf</span><span class="op" id="7837081">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7837084">if</span>&nbsp;<span class="ident" id="7837087">err</span>&nbsp;<span class="op" id="7837091">!=</span>&nbsp;<span class="builtintype" id="7837094">nil</span>&nbsp;<span class="op" id="7837098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7837102">t</span><span class="op" id="7837103">.</span><span class="ident" id="7837104">Fatal</span><span class="op" id="7837109">(</span><span class="ident" id="7837110">err</span><span class="op" id="7837113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7837116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7837119">if</span>&nbsp;<span class="ident" id="7837122">m0</span><span class="op" id="7837124">.</span><span class="ident" id="7837125">Bounds</span><span class="op" id="7837131">(</span><span class="op" id="7837132">)</span>&nbsp;<span class="op" id="7837134">!=</span>&nbsp;<span class="ident" id="7837137">m1</span><span class="op" id="7837139">.</span><span class="ident" id="7837140">Bounds</span><span class="op" id="7837146">(</span><span class="op" id="7837147">)</span>&nbsp;<span class="op" id="7837149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7837153">t</span><span class="op" id="7837154">.</span><span class="ident" id="7837155">Fatalf</span><span class="op" id="7837161">(</span><span class="string" id="7837162">&#34;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="7837188">,</span>&nbsp;<span class="ident" id="7837190">m0</span><span class="op" id="7837192">.</span><span class="ident" id="7837193">Bounds</span><span class="op" id="7837199">(</span><span class="op" id="7837200">)</span><span class="op" id="7837201">,</span>&nbsp;<span class="ident" id="7837203">m1</span><span class="op" id="7837205">.</span><span class="ident" id="7837206">Bounds</span><span class="op" id="7837212">(</span><span class="op" id="7837213">)</span><span class="op" id="7837214">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7837217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7837220">if</span>&nbsp;<span class="ident" id="7837223">_</span><span class="op" id="7837224">,</span>&nbsp;<span class="ident" id="7837226">ok</span>&nbsp;<span class="op" id="7837229">:=</span>&nbsp;<span class="ident" id="7837232">m1</span><span class="op" id="7837234">.</span><span class="op" id="7837235">(</span><span class="op" id="7837236">*</span><span class="ident" id="7837237">image</span><span class="op" id="7837242">.</span><span class="ident" id="7837243">Gray</span><span class="op" id="7837247">)</span><span class="op" id="7837248">;</span>&nbsp;<span class="op" id="7837250">!</span><span class="ident" id="7837251">ok</span>&nbsp;<span class="op" id="7837254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7837258">t</span><span class="op" id="7837259">.</span><span class="ident" id="7837260">Errorf</span><span class="op" id="7837266">(</span><span class="string" id="7837267">&#34;got&nbsp;%T,&nbsp;want&nbsp;*image.Gray&#34;</span><span class="op" id="7837293">,</span>&nbsp;<span class="ident" id="7837295">m1</span><span class="op" id="7837297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7837300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7837303">//&nbsp;Compare&nbsp;the&nbsp;average&nbsp;delta&nbsp;to&nbsp;the&nbsp;tolerance&nbsp;level.</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7837357">want</span>&nbsp;<span class="op" id="7837362">:=</span>&nbsp;<span class="ident" id="7837365">int64</span><span class="op" id="7837370">(</span><span class="num" id="7837371">2</span>&nbsp;<span class="op" id="7837373">&lt;&lt;</span>&nbsp;<span class="num" id="7837376">8</span><span class="op" id="7837377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7837380">if</span>&nbsp;<span class="ident" id="7837383">got</span>&nbsp;<span class="op" id="7837387">:=</span>&nbsp;<span class="ident" id="7837390">averageDelta</span><span class="op" id="7837402">(</span><span class="ident" id="7837403">m0</span><span class="op" id="7837405">,</span>&nbsp;<span class="ident" id="7837407">m1</span><span class="op" id="7837409">)</span><span class="op" id="7837410">;</span>&nbsp;<span class="ident" id="7837412">got</span>&nbsp;<span class="op" id="7837416">&gt;</span>&nbsp;<span class="ident" id="7837418">want</span>&nbsp;<span class="op" id="7837423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7837427">t</span><span class="op" id="7837428">.</span><span class="ident" id="7837429">Errorf</span><span class="op" id="7837435">(</span><span class="string" id="7837436">&#34;average&nbsp;delta&nbsp;too&nbsp;high;&nbsp;got&nbsp;%d,&nbsp;want&nbsp;&lt;=&nbsp;%d&#34;</span><span class="op" id="7837480">,</span>&nbsp;<span class="ident" id="7837482">got</span><span class="op" id="7837485">,</span>&nbsp;<span class="ident" id="7837487">want</span><span class="op" id="7837491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7837494">}</span><br>
<span class="lineno"></span><span class="op" id="7837496">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment" id="7837499">//&nbsp;averageDelta&nbsp;returns&nbsp;the&nbsp;average&nbsp;delta&nbsp;in&nbsp;RGB&nbsp;space.&nbsp;The&nbsp;two&nbsp;images&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="7837575">//&nbsp;have&nbsp;the&nbsp;same&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="7837600">func</span>&nbsp;<span class="ident" id="7837605">averageDelta</span><span class="op" id="7837617">(</span><span class="ident" id="7837618">m0</span><span class="op" id="7837620">,</span>&nbsp;<span class="ident" id="7837622">m1</span>&nbsp;<span class="ident" id="7837625">image</span><span class="op" id="7837630">.</span><span class="ident" id="7837631">Image</span><span class="op" id="7837636">)</span>&nbsp;<span class="ident" id="7837638">int64</span>&nbsp;<span class="op" id="7837644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7837647">b</span>&nbsp;<span class="op" id="7837649">:=</span>&nbsp;<span class="ident" id="7837652">m0</span><span class="op" id="7837654">.</span><span class="ident" id="7837655">Bounds</span><span class="op" id="7837661">(</span><span class="op" id="7837662">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7837665">var</span>&nbsp;<span class="ident" id="7837669">sum</span><span class="op" id="7837672">,</span>&nbsp;<span class="ident" id="7837674">n</span>&nbsp;<span class="ident" id="7837676">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7837683">for</span>&nbsp;<span class="ident" id="7837687">y</span>&nbsp;<span class="op" id="7837689">:=</span>&nbsp;<span class="ident" id="7837692">b</span><span class="op" id="7837693">.</span><span class="ident" id="7837694">Min</span><span class="op" id="7837697">.</span><span class="ident" id="7837698">Y</span><span class="op" id="7837699">;</span>&nbsp;<span class="ident" id="7837701">y</span>&nbsp;<span class="op" id="7837703">&lt;</span>&nbsp;<span class="ident" id="7837705">b</span><span class="op" id="7837706">.</span><span class="ident" id="7837707">Max</span><span class="op" id="7837710">.</span><span class="ident" id="7837711">Y</span><span class="op" id="7837712">;</span>&nbsp;<span class="ident" id="7837714">y</span><span class="op" id="7837715">++</span>&nbsp;<span class="op" id="7837718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7837722">for</span>&nbsp;<span class="ident" id="7837726">x</span>&nbsp;<span class="op" id="7837728">:=</span>&nbsp;<span class="ident" id="7837731">b</span><span class="op" id="7837732">.</span><span class="ident" id="7837733">Min</span><span class="op" id="7837736">.</span><span class="ident" id="7837737">X</span><span class="op" id="7837738">;</span>&nbsp;<span class="ident" id="7837740">x</span>&nbsp;<span class="op" id="7837742">&lt;</span>&nbsp;<span class="ident" id="7837744">b</span><span class="op" id="7837745">.</span><span class="ident" id="7837746">Max</span><span class="op" id="7837749">.</span><span class="ident" id="7837750">X</span><span class="op" id="7837751">;</span>&nbsp;<span class="ident" id="7837753">x</span><span class="op" id="7837754">++</span>&nbsp;<span class="op" id="7837757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7837762">c0</span>&nbsp;<span class="op" id="7837765">:=</span>&nbsp;<span class="ident" id="7837768">m0</span><span class="op" id="7837770">.</span><span class="ident" id="7837771">At</span><span class="op" id="7837773">(</span><span class="ident" id="7837774">x</span><span class="op" id="7837775">,</span>&nbsp;<span class="ident" id="7837777">y</span><span class="op" id="7837778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7837783">c1</span>&nbsp;<span class="op" id="7837786">:=</span>&nbsp;<span class="ident" id="7837789">m1</span><span class="op" id="7837791">.</span><span class="ident" id="7837792">At</span><span class="op" id="7837794">(</span><span class="ident" id="7837795">x</span><span class="op" id="7837796">,</span>&nbsp;<span class="ident" id="7837798">y</span><span class="op" id="7837799">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7837804">r0</span><span class="op" id="7837806">,</span>&nbsp;<span class="ident" id="7837808">g0</span><span class="op" id="7837810">,</span>&nbsp;<span class="ident" id="7837812">b0</span><span class="op" id="7837814">,</span>&nbsp;<span class="ident" id="7837816">_</span>&nbsp;<span class="op" id="7837818">:=</span>&nbsp;<span class="ident" id="7837821">c0</span><span class="op" id="7837823">.</span><span class="ident" id="7837824">RGBA</span><span class="op" id="7837828">(</span><span class="op" id="7837829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7837834">r1</span><span class="op" id="7837836">,</span>&nbsp;<span class="ident" id="7837838">g1</span><span class="op" id="7837840">,</span>&nbsp;<span class="ident" id="7837842">b1</span><span class="op" id="7837844">,</span>&nbsp;<span class="ident" id="7837846">_</span>&nbsp;<span class="op" id="7837848">:=</span>&nbsp;<span class="ident" id="7837851">c1</span><span class="op" id="7837853">.</span><span class="ident" id="7837854">RGBA</span><span class="op" id="7837858">(</span><span class="op" id="7837859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7837864">sum</span>&nbsp;<span class="op" id="7837868">+=</span>&nbsp;<span class="ident" id="7837871">delta</span><span class="op" id="7837876">(</span><span class="ident" id="7837877">r0</span><span class="op" id="7837879">,</span>&nbsp;<span class="ident" id="7837881">r1</span><span class="op" id="7837883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7837888">sum</span>&nbsp;<span class="op" id="7837892">+=</span>&nbsp;<span class="ident" id="7837895">delta</span><span class="op" id="7837900">(</span><span class="ident" id="7837901">g0</span><span class="op" id="7837903">,</span>&nbsp;<span class="ident" id="7837905">g1</span><span class="op" id="7837907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7837912">sum</span>&nbsp;<span class="op" id="7837916">+=</span>&nbsp;<span class="ident" id="7837919">delta</span><span class="op" id="7837924">(</span><span class="ident" id="7837925">b0</span><span class="op" id="7837927">,</span>&nbsp;<span class="ident" id="7837929">b1</span><span class="op" id="7837931">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7837936">n</span>&nbsp;<span class="op" id="7837938">+=</span>&nbsp;<span class="num" id="7837941">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7837945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7837948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7837951">return</span>&nbsp;<span class="ident" id="7837958">sum</span>&nbsp;<span class="op" id="7837962">/</span>&nbsp;<span class="ident" id="7837964">n</span><br>
<span class="lineno"></span><span class="op" id="7837966">}</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span><span class="keyword" id="7837969">func</span>&nbsp;<span class="ident" id="7837974">BenchmarkEncode</span><span class="op" id="7837989">(</span><span class="ident" id="7837990">b</span>&nbsp;<span class="op" id="7837992">*</span><span class="ident" id="7837993">testing</span><span class="op" id="7838000">.</span><span class="ident" id="7838001">B</span><span class="op" id="7838002">)</span>&nbsp;<span class="op" id="7838004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7838007">b</span><span class="op" id="7838008">.</span><span class="ident" id="7838009">StopTimer</span><span class="op" id="7838018">(</span><span class="op" id="7838019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7838022">img</span>&nbsp;<span class="op" id="7838026">:=</span>&nbsp;<span class="ident" id="7838029">image</span><span class="op" id="7838034">.</span><span class="ident" id="7838035">NewRGBA</span><span class="op" id="7838042">(</span><span class="ident" id="7838043">image</span><span class="op" id="7838048">.</span><span class="ident" id="7838049">Rect</span><span class="op" id="7838053">(</span><span class="num" id="7838054">0</span><span class="op" id="7838055">,</span>&nbsp;<span class="num" id="7838057">0</span><span class="op" id="7838058">,</span>&nbsp;<span class="num" id="7838060">640</span><span class="op" id="7838063">,</span>&nbsp;<span class="num" id="7838065">480</span><span class="op" id="7838068">)</span><span class="op" id="7838069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7838072">bo</span>&nbsp;<span class="op" id="7838075">:=</span>&nbsp;<span class="ident" id="7838078">img</span><span class="op" id="7838081">.</span><span class="ident" id="7838082">Bounds</span><span class="op" id="7838088">(</span><span class="op" id="7838089">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7838092">rnd</span>&nbsp;<span class="op" id="7838096">:=</span>&nbsp;<span class="ident" id="7838099">rand</span><span class="op" id="7838103">.</span><span class="ident" id="7838104">New</span><span class="op" id="7838107">(</span><span class="ident" id="7838108">rand</span><span class="op" id="7838112">.</span><span class="ident" id="7838113">NewSource</span><span class="op" id="7838122">(</span><span class="num" id="7838123">123</span><span class="op" id="7838126">)</span><span class="op" id="7838127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7838130">for</span>&nbsp;<span class="ident" id="7838134">y</span>&nbsp;<span class="op" id="7838136">:=</span>&nbsp;<span class="ident" id="7838139">bo</span><span class="op" id="7838141">.</span><span class="ident" id="7838142">Min</span><span class="op" id="7838145">.</span><span class="ident" id="7838146">Y</span><span class="op" id="7838147">;</span>&nbsp;<span class="ident" id="7838149">y</span>&nbsp;<span class="op" id="7838151">&lt;</span>&nbsp;<span class="ident" id="7838153">bo</span><span class="op" id="7838155">.</span><span class="ident" id="7838156">Max</span><span class="op" id="7838159">.</span><span class="ident" id="7838160">Y</span><span class="op" id="7838161">;</span>&nbsp;<span class="ident" id="7838163">y</span><span class="op" id="7838164">++</span>&nbsp;<span class="op" id="7838167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7838171">for</span>&nbsp;<span class="ident" id="7838175">x</span>&nbsp;<span class="op" id="7838177">:=</span>&nbsp;<span class="ident" id="7838180">bo</span><span class="op" id="7838182">.</span><span class="ident" id="7838183">Min</span><span class="op" id="7838186">.</span><span class="ident" id="7838187">X</span><span class="op" id="7838188">;</span>&nbsp;<span class="ident" id="7838190">x</span>&nbsp;<span class="op" id="7838192">&lt;</span>&nbsp;<span class="ident" id="7838194">bo</span><span class="op" id="7838196">.</span><span class="ident" id="7838197">Max</span><span class="op" id="7838200">.</span><span class="ident" id="7838201">X</span><span class="op" id="7838202">;</span>&nbsp;<span class="ident" id="7838204">x</span><span class="op" id="7838205">++</span>&nbsp;<span class="op" id="7838208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7838213">img</span><span class="op" id="7838216">.</span><span class="ident" id="7838217">SetRGBA</span><span class="op" id="7838224">(</span><span class="ident" id="7838225">x</span><span class="op" id="7838226">,</span>&nbsp;<span class="ident" id="7838228">y</span><span class="op" id="7838229">,</span>&nbsp;<span class="ident" id="7838231">color</span><span class="op" id="7838236">.</span><span class="ident" id="7838237">RGBA</span><span class="op" id="7838241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7838247">uint8</span><span class="op" id="7838252">(</span><span class="ident" id="7838253">rnd</span><span class="op" id="7838256">.</span><span class="ident" id="7838257">Intn</span><span class="op" id="7838261">(</span><span class="num" id="7838262">256</span><span class="op" id="7838265">)</span><span class="op" id="7838266">)</span><span class="op" id="7838267">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7838273">uint8</span><span class="op" id="7838278">(</span><span class="ident" id="7838279">rnd</span><span class="op" id="7838282">.</span><span class="ident" id="7838283">Intn</span><span class="op" id="7838287">(</span><span class="num" id="7838288">256</span><span class="op" id="7838291">)</span><span class="op" id="7838292">)</span><span class="op" id="7838293">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7838299">uint8</span><span class="op" id="7838304">(</span><span class="ident" id="7838305">rnd</span><span class="op" id="7838308">.</span><span class="ident" id="7838309">Intn</span><span class="op" id="7838313">(</span><span class="num" id="7838314">256</span><span class="op" id="7838317">)</span><span class="op" id="7838318">)</span><span class="op" id="7838319">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7838325">255</span><span class="op" id="7838328">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7838333">}</span><span class="op" id="7838334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7838338">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7838341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7838344">b</span><span class="op" id="7838345">.</span><span class="ident" id="7838346">SetBytes</span><span class="op" id="7838354">(</span><span class="num" id="7838355">640</span>&nbsp;<span class="op" id="7838359">*</span>&nbsp;<span class="num" id="7838361">480</span>&nbsp;<span class="op" id="7838365">*</span>&nbsp;<span class="num" id="7838367">4</span><span class="op" id="7838368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7838371">b</span><span class="op" id="7838372">.</span><span class="ident" id="7838373">StartTimer</span><span class="op" id="7838383">(</span><span class="op" id="7838384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7838387">options</span>&nbsp;<span class="op" id="7838395">:=</span>&nbsp;<span class="op" id="7838398">&amp;</span><span class="ident" id="7838399">Options</span><span class="op" id="7838406">{</span><span class="ident" id="7838407">Quality</span><span class="op" id="7838414">:</span>&nbsp;<span class="num" id="7838416">90</span><span class="op" id="7838418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7838421">for</span>&nbsp;<span class="ident" id="7838425">i</span>&nbsp;<span class="op" id="7838427">:=</span>&nbsp;<span class="num" id="7838430">0</span><span class="op" id="7838431">;</span>&nbsp;<span class="ident" id="7838433">i</span>&nbsp;<span class="op" id="7838435">&lt;</span>&nbsp;<span class="ident" id="7838437">b</span><span class="op" id="7838438">.</span><span class="ident" id="7838439">N</span><span class="op" id="7838440">;</span>&nbsp;<span class="ident" id="7838442">i</span><span class="op" id="7838443">++</span>&nbsp;<span class="op" id="7838446">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7838450">Encode</span><span class="op" id="7838456">(</span><span class="ident" id="7838457">ioutil</span><span class="op" id="7838463">.</span><span class="ident" id="7838464">Discard</span><span class="op" id="7838471">,</span>&nbsp;<span class="ident" id="7838473">img</span><span class="op" id="7838476">,</span>&nbsp;<span class="ident" id="7838478">options</span><span class="op" id="7838485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7838488">}</span><br>
<span class="lineno"></span><span class="op" id="7838490">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
