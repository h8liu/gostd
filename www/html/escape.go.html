<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4635901">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4635956">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4636010">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4636061">//&nbsp;Package&nbsp;html&nbsp;provides&nbsp;functions&nbsp;for&nbsp;escaping&nbsp;and&nbsp;unescaping&nbsp;HTML&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="4636135">package</span>&nbsp;<span class="ident" id="4636143">html</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4636149">import</span>&nbsp;<span class="op" id="4636156">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4636159">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4636168">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4636179">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="4636194">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4636197">type</span>&nbsp;<span class="ident" id="4636202">writer</span>&nbsp;<span class="keyword" id="4636209">interface</span>&nbsp;<span class="op" id="4636219">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636222">WriteString</span><span class="op" id="4636233">(</span><span class="builtintype" id="4636234">string</span><span class="op" id="4636240">)</span>&nbsp;<span class="op" id="4636242">(</span><span class="builtintype" id="4636243">int</span><span class="op" id="4636246">,</span>&nbsp;<span class="builtintype" id="4636248">error</span><span class="op" id="4636253">)</span><br>
<span class="lineno"></span><span class="op" id="4636255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4636258">//&nbsp;These&nbsp;replacements&nbsp;permit&nbsp;compatibility&nbsp;with&nbsp;old&nbsp;numeric&nbsp;entities&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4636332">//&nbsp;assumed&nbsp;Windows-1252&nbsp;encoding.</span><br>
<span class="lineno">20</span><span class="comment" id="4636366">//&nbsp;http://www.whatwg.org/specs/web-apps/current-work/multipage/tokenization.html#consume-a-character-reference</span><br>
<span class="lineno"></span><span class="keyword" id="4636477">var</span>&nbsp;<span class="ident" id="4636481">replacementTable</span>&nbsp;<span class="op" id="4636498">=</span>&nbsp;<span class="op" id="4636500">[</span><span class="op" id="4636501">...</span><span class="op" id="4636504">]</span><span class="builtintype" id="4636505">rune</span><span class="op" id="4636509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4636512">&#39;\u20AC&#39;</span><span class="op" id="4636520">,</span>&nbsp;<span class="comment" id="4636522">//&nbsp;First&nbsp;entry&nbsp;is&nbsp;what&nbsp;0x80&nbsp;should&nbsp;be&nbsp;replaced&nbsp;with.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4636576">&#39;\u0081&#39;</span><span class="op" id="4636584">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4636587">&#39;\u201A&#39;</span><span class="op" id="4636595">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4636598">&#39;\u0192&#39;</span><span class="op" id="4636606">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4636609">&#39;\u201E&#39;</span><span class="op" id="4636617">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4636620">&#39;\u2026&#39;</span><span class="op" id="4636628">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4636631">&#39;\u2020&#39;</span><span class="op" id="4636639">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4636642">&#39;\u2021&#39;</span><span class="op" id="4636650">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4636653">&#39;\u02C6&#39;</span><span class="op" id="4636661">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4636664">&#39;\u2030&#39;</span><span class="op" id="4636672">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4636675">&#39;\u0160&#39;</span><span class="op" id="4636683">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4636686">&#39;\u2039&#39;</span><span class="op" id="4636694">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4636697">&#39;\u0152&#39;</span><span class="op" id="4636705">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4636708">&#39;\u008D&#39;</span><span class="op" id="4636716">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4636719">&#39;\u017D&#39;</span><span class="op" id="4636727">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4636730">&#39;\u008F&#39;</span><span class="op" id="4636738">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4636741">&#39;\u0090&#39;</span><span class="op" id="4636749">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4636752">&#39;\u2018&#39;</span><span class="op" id="4636760">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4636763">&#39;\u2019&#39;</span><span class="op" id="4636771">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4636774">&#39;\u201C&#39;</span><span class="op" id="4636782">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4636785">&#39;\u201D&#39;</span><span class="op" id="4636793">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4636796">&#39;\u2022&#39;</span><span class="op" id="4636804">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4636807">&#39;\u2013&#39;</span><span class="op" id="4636815">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4636818">&#39;\u2014&#39;</span><span class="op" id="4636826">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4636829">&#39;\u02DC&#39;</span><span class="op" id="4636837">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4636840">&#39;\u2122&#39;</span><span class="op" id="4636848">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4636851">&#39;\u0161&#39;</span><span class="op" id="4636859">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4636862">&#39;\u203A&#39;</span><span class="op" id="4636870">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4636873">&#39;\u0153&#39;</span><span class="op" id="4636881">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4636884">&#39;\u009D&#39;</span><span class="op" id="4636892">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4636895">&#39;\u017E&#39;</span><span class="op" id="4636903">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4636906">&#39;\u0178&#39;</span><span class="op" id="4636914">,</span>&nbsp;<span class="comment" id="4636916">//&nbsp;Last&nbsp;entry&nbsp;is&nbsp;0x9F.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4636940">//&nbsp;0x00-&gt;&#39;\uFFFD&#39;&nbsp;is&nbsp;handled&nbsp;programmatically.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4636988">//&nbsp;0x0D-&gt;&#39;\u000D&#39;&nbsp;is&nbsp;a&nbsp;no-op.</span><br>
<span class="lineno"></span><span class="op" id="4637018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4637021">//&nbsp;unescapeEntity&nbsp;reads&nbsp;an&nbsp;entity&nbsp;like&nbsp;&#34;&amp;lt;&#34;&nbsp;from&nbsp;b[src:]&nbsp;and&nbsp;writes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4637095">//&nbsp;corresponding&nbsp;&#34;&lt;&#34;&nbsp;to&nbsp;b[dst:],&nbsp;returning&nbsp;the&nbsp;incremented&nbsp;dst&nbsp;and&nbsp;src&nbsp;cursors.</span><br>
<span class="lineno">60</span><span class="comment" id="4637175">//&nbsp;Precondition:&nbsp;b[src]&nbsp;==&nbsp;&#39;&amp;&#39;&nbsp;&amp;&amp;&nbsp;dst&nbsp;&lt;=&nbsp;src.</span><br>
<span class="lineno"></span><span class="comment" id="4637221">//&nbsp;attribute&nbsp;should&nbsp;be&nbsp;true&nbsp;if&nbsp;parsing&nbsp;an&nbsp;attribute&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4637280">func</span>&nbsp;<span class="ident" id="4637285">unescapeEntity</span><span class="op" id="4637299">(</span><span class="ident" id="4637300">b</span>&nbsp;<span class="op" id="4637302">[</span><span class="op" id="4637303">]</span><span class="builtintype" id="4637304">byte</span><span class="op" id="4637308">,</span>&nbsp;<span class="ident" id="4637310">dst</span><span class="op" id="4637313">,</span>&nbsp;<span class="ident" id="4637315">src</span>&nbsp;<span class="builtintype" id="4637319">int</span><span class="op" id="4637322">,</span>&nbsp;<span class="ident" id="4637324">attribute</span>&nbsp;<span class="builtintype" id="4637334">bool</span><span class="op" id="4637338">)</span>&nbsp;<span class="op" id="4637340">(</span><span class="ident" id="4637341">dst1</span><span class="op" id="4637345">,</span>&nbsp;<span class="ident" id="4637347">src1</span>&nbsp;<span class="builtintype" id="4637352">int</span><span class="op" id="4637355">)</span>&nbsp;<span class="op" id="4637357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4637360">//&nbsp;http://www.whatwg.org/specs/web-apps/current-work/multipage/tokenization.html#consume-a-character-reference</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4637473">//&nbsp;i&nbsp;starts&nbsp;at&nbsp;1&nbsp;because&nbsp;we&nbsp;already&nbsp;know&nbsp;that&nbsp;s[0]&nbsp;==&nbsp;&#39;&amp;&#39;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637533">i</span><span class="op" id="4637534">,</span>&nbsp;<span class="ident" id="4637536">s</span>&nbsp;<span class="op" id="4637538">:=</span>&nbsp;<span class="num" id="4637541">1</span><span class="op" id="4637542">,</span>&nbsp;<span class="ident" id="4637544">b</span><span class="op" id="4637545">[</span><span class="ident" id="4637546">src</span><span class="op" id="4637549">:</span><span class="op" id="4637550">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637554">if</span>&nbsp;<span class="builtinfunc" id="4637557">len</span><span class="op" id="4637560">(</span><span class="ident" id="4637561">s</span><span class="op" id="4637562">)</span>&nbsp;<span class="op" id="4637564">&lt;=</span>&nbsp;<span class="num" id="4637567">1</span>&nbsp;<span class="op" id="4637569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637573">b</span><span class="op" id="4637574">[</span><span class="ident" id="4637575">dst</span><span class="op" id="4637578">]</span>&nbsp;<span class="op" id="4637580">=</span>&nbsp;<span class="ident" id="4637582">b</span><span class="op" id="4637583">[</span><span class="ident" id="4637584">src</span><span class="op" id="4637587">]</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637591">return</span>&nbsp;<span class="ident" id="4637598">dst</span>&nbsp;<span class="op" id="4637602">+</span>&nbsp;<span class="num" id="4637604">1</span><span class="op" id="4637605">,</span>&nbsp;<span class="ident" id="4637607">src</span>&nbsp;<span class="op" id="4637611">+</span>&nbsp;<span class="num" id="4637613">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4637616">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637620">if</span>&nbsp;<span class="ident" id="4637623">s</span><span class="op" id="4637624">[</span><span class="ident" id="4637625">i</span><span class="op" id="4637626">]</span>&nbsp;<span class="op" id="4637628">==</span>&nbsp;<span class="string" id="4637631">&#39;#&#39;</span>&nbsp;<span class="op" id="4637635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637639">if</span>&nbsp;<span class="builtinfunc" id="4637642">len</span><span class="op" id="4637645">(</span><span class="ident" id="4637646">s</span><span class="op" id="4637647">)</span>&nbsp;<span class="op" id="4637649">&lt;=</span>&nbsp;<span class="num" id="4637652">3</span>&nbsp;<span class="op" id="4637654">{</span>&nbsp;<span class="comment" id="4637656">//&nbsp;We&nbsp;need&nbsp;to&nbsp;have&nbsp;at&nbsp;least&nbsp;&#34;&amp;#.&#34;.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637694">b</span><span class="op" id="4637695">[</span><span class="ident" id="4637696">dst</span><span class="op" id="4637699">]</span>&nbsp;<span class="op" id="4637701">=</span>&nbsp;<span class="ident" id="4637703">b</span><span class="op" id="4637704">[</span><span class="ident" id="4637705">src</span><span class="op" id="4637708">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637713">return</span>&nbsp;<span class="ident" id="4637720">dst</span>&nbsp;<span class="op" id="4637724">+</span>&nbsp;<span class="num" id="4637726">1</span><span class="op" id="4637727">,</span>&nbsp;<span class="ident" id="4637729">src</span>&nbsp;<span class="op" id="4637733">+</span>&nbsp;<span class="num" id="4637735">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4637739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637743">i</span><span class="op" id="4637744">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637749">c</span>&nbsp;<span class="op" id="4637751">:=</span>&nbsp;<span class="ident" id="4637754">s</span><span class="op" id="4637755">[</span><span class="ident" id="4637756">i</span><span class="op" id="4637757">]</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637761">hex</span>&nbsp;<span class="op" id="4637765">:=</span>&nbsp;<span class="ident" id="4637768">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637776">if</span>&nbsp;<span class="ident" id="4637779">c</span>&nbsp;<span class="op" id="4637781">==</span>&nbsp;<span class="string" id="4637784">&#39;x&#39;</span>&nbsp;<span class="op" id="4637788">||</span>&nbsp;<span class="ident" id="4637791">c</span>&nbsp;<span class="op" id="4637793">==</span>&nbsp;<span class="string" id="4637796">&#39;X&#39;</span>&nbsp;<span class="op" id="4637800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637805">hex</span>&nbsp;<span class="op" id="4637809">=</span>&nbsp;<span class="ident" id="4637811">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637819">i</span><span class="op" id="4637820">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4637825">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637830">x</span>&nbsp;<span class="op" id="4637832">:=</span>&nbsp;<span class="string" id="4637835">&#39;\x00&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637844">for</span>&nbsp;<span class="ident" id="4637848">i</span>&nbsp;<span class="op" id="4637850">&lt;</span>&nbsp;<span class="builtinfunc" id="4637852">len</span><span class="op" id="4637855">(</span><span class="ident" id="4637856">s</span><span class="op" id="4637857">)</span>&nbsp;<span class="op" id="4637859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637864">c</span>&nbsp;<span class="op" id="4637866">=</span>&nbsp;<span class="ident" id="4637868">s</span><span class="op" id="4637869">[</span><span class="ident" id="4637870">i</span><span class="op" id="4637871">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637876">i</span><span class="op" id="4637877">++</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637883">if</span>&nbsp;<span class="ident" id="4637886">hex</span>&nbsp;<span class="op" id="4637890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637896">if</span>&nbsp;<span class="string" id="4637899">&#39;0&#39;</span>&nbsp;<span class="op" id="4637903">&lt;=</span>&nbsp;<span class="ident" id="4637906">c</span>&nbsp;<span class="op" id="4637908">&amp;&amp;</span>&nbsp;<span class="ident" id="4637911">c</span>&nbsp;<span class="op" id="4637913">&lt;=</span>&nbsp;<span class="string" id="4637916">&#39;9&#39;</span>&nbsp;<span class="op" id="4637920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637927">x</span>&nbsp;<span class="op" id="4637929">=</span>&nbsp;<span class="num" id="4637931">16</span><span class="op" id="4637933">*</span><span class="ident" id="4637934">x</span>&nbsp;<span class="op" id="4637936">+</span>&nbsp;<span class="builtintype" id="4637938">rune</span><span class="op" id="4637942">(</span><span class="ident" id="4637943">c</span><span class="op" id="4637944">)</span>&nbsp;<span class="op" id="4637946">-</span>&nbsp;<span class="string" id="4637948">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637957">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4637970">}</span>&nbsp;<span class="keyword" id="4637972">else</span>&nbsp;<span class="keyword" id="4637977">if</span>&nbsp;<span class="string" id="4637980">&#39;a&#39;</span>&nbsp;<span class="op" id="4637984">&lt;=</span>&nbsp;<span class="ident" id="4637987">c</span>&nbsp;<span class="op" id="4637989">&amp;&amp;</span>&nbsp;<span class="ident" id="4637992">c</span>&nbsp;<span class="op" id="4637994">&lt;=</span>&nbsp;<span class="string" id="4637997">&#39;f&#39;</span>&nbsp;<span class="op" id="4638001">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4638008">x</span>&nbsp;<span class="op" id="4638010">=</span>&nbsp;<span class="num" id="4638012">16</span><span class="op" id="4638014">*</span><span class="ident" id="4638015">x</span>&nbsp;<span class="op" id="4638017">+</span>&nbsp;<span class="builtintype" id="4638019">rune</span><span class="op" id="4638023">(</span><span class="ident" id="4638024">c</span><span class="op" id="4638025">)</span>&nbsp;<span class="op" id="4638027">-</span>&nbsp;<span class="string" id="4638029">&#39;a&#39;</span>&nbsp;<span class="op" id="4638033">+</span>&nbsp;<span class="num" id="4638035">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638043">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4638056">}</span>&nbsp;<span class="keyword" id="4638058">else</span>&nbsp;<span class="keyword" id="4638063">if</span>&nbsp;<span class="string" id="4638066">&#39;A&#39;</span>&nbsp;<span class="op" id="4638070">&lt;=</span>&nbsp;<span class="ident" id="4638073">c</span>&nbsp;<span class="op" id="4638075">&amp;&amp;</span>&nbsp;<span class="ident" id="4638078">c</span>&nbsp;<span class="op" id="4638080">&lt;=</span>&nbsp;<span class="string" id="4638083">&#39;F&#39;</span>&nbsp;<span class="op" id="4638087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4638094">x</span>&nbsp;<span class="op" id="4638096">=</span>&nbsp;<span class="num" id="4638098">16</span><span class="op" id="4638100">*</span><span class="ident" id="4638101">x</span>&nbsp;<span class="op" id="4638103">+</span>&nbsp;<span class="builtintype" id="4638105">rune</span><span class="op" id="4638109">(</span><span class="ident" id="4638110">c</span><span class="op" id="4638111">)</span>&nbsp;<span class="op" id="4638113">-</span>&nbsp;<span class="string" id="4638115">&#39;A&#39;</span>&nbsp;<span class="op" id="4638119">+</span>&nbsp;<span class="num" id="4638121">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638129">continue</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4638142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4638147">}</span>&nbsp;<span class="keyword" id="4638149">else</span>&nbsp;<span class="keyword" id="4638154">if</span>&nbsp;<span class="string" id="4638157">&#39;0&#39;</span>&nbsp;<span class="op" id="4638161">&lt;=</span>&nbsp;<span class="ident" id="4638164">c</span>&nbsp;<span class="op" id="4638166">&amp;&amp;</span>&nbsp;<span class="ident" id="4638169">c</span>&nbsp;<span class="op" id="4638171">&lt;=</span>&nbsp;<span class="string" id="4638174">&#39;9&#39;</span>&nbsp;<span class="op" id="4638178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4638184">x</span>&nbsp;<span class="op" id="4638186">=</span>&nbsp;<span class="num" id="4638188">10</span><span class="op" id="4638190">*</span><span class="ident" id="4638191">x</span>&nbsp;<span class="op" id="4638193">+</span>&nbsp;<span class="builtintype" id="4638195">rune</span><span class="op" id="4638199">(</span><span class="ident" id="4638200">c</span><span class="op" id="4638201">)</span>&nbsp;<span class="op" id="4638203">-</span>&nbsp;<span class="string" id="4638205">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638213">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4638225">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638230">if</span>&nbsp;<span class="ident" id="4638233">c</span>&nbsp;<span class="op" id="4638235">!=</span>&nbsp;<span class="string" id="4638238">&#39;;&#39;</span>&nbsp;<span class="op" id="4638242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4638248">i</span><span class="op" id="4638249">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4638255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638260">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4638268">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638273">if</span>&nbsp;<span class="ident" id="4638276">i</span>&nbsp;<span class="op" id="4638278">&lt;=</span>&nbsp;<span class="num" id="4638281">3</span>&nbsp;<span class="op" id="4638283">{</span>&nbsp;<span class="comment" id="4638285">//&nbsp;No&nbsp;characters&nbsp;matched.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4638314">b</span><span class="op" id="4638315">[</span><span class="ident" id="4638316">dst</span><span class="op" id="4638319">]</span>&nbsp;<span class="op" id="4638321">=</span>&nbsp;<span class="ident" id="4638323">b</span><span class="op" id="4638324">[</span><span class="ident" id="4638325">src</span><span class="op" id="4638328">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638333">return</span>&nbsp;<span class="ident" id="4638340">dst</span>&nbsp;<span class="op" id="4638344">+</span>&nbsp;<span class="num" id="4638346">1</span><span class="op" id="4638347">,</span>&nbsp;<span class="ident" id="4638349">src</span>&nbsp;<span class="op" id="4638353">+</span>&nbsp;<span class="num" id="4638355">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4638359">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638364">if</span>&nbsp;<span class="num" id="4638367">0x80</span>&nbsp;<span class="op" id="4638372">&lt;=</span>&nbsp;<span class="ident" id="4638375">x</span>&nbsp;<span class="op" id="4638377">&amp;&amp;</span>&nbsp;<span class="ident" id="4638380">x</span>&nbsp;<span class="op" id="4638382">&lt;=</span>&nbsp;<span class="num" id="4638385">0x9F</span>&nbsp;<span class="op" id="4638390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4638395">//&nbsp;Replace&nbsp;characters&nbsp;from&nbsp;Windows-1252&nbsp;with&nbsp;UTF-8&nbsp;equivalents.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4638462">x</span>&nbsp;<span class="op" id="4638464">=</span>&nbsp;<span class="ident" id="4638466">replacementTable</span><span class="op" id="4638482">[</span><span class="ident" id="4638483">x</span><span class="op" id="4638484">-</span><span class="num" id="4638485">0x80</span><span class="op" id="4638489">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4638493">}</span>&nbsp;<span class="keyword" id="4638495">else</span>&nbsp;<span class="keyword" id="4638500">if</span>&nbsp;<span class="ident" id="4638503">x</span>&nbsp;<span class="op" id="4638505">==</span>&nbsp;<span class="num" id="4638508">0</span>&nbsp;<span class="op" id="4638510">||</span>&nbsp;<span class="op" id="4638513">(</span><span class="num" id="4638514">0xD800</span>&nbsp;<span class="op" id="4638521">&lt;=</span>&nbsp;<span class="ident" id="4638524">x</span>&nbsp;<span class="op" id="4638526">&amp;&amp;</span>&nbsp;<span class="ident" id="4638529">x</span>&nbsp;<span class="op" id="4638531">&lt;=</span>&nbsp;<span class="num" id="4638534">0xDFFF</span><span class="op" id="4638540">)</span>&nbsp;<span class="op" id="4638542">||</span>&nbsp;<span class="ident" id="4638545">x</span>&nbsp;<span class="op" id="4638547">&gt;</span>&nbsp;<span class="num" id="4638549">0x10FFFF</span>&nbsp;<span class="op" id="4638558">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4638563">//&nbsp;Replace&nbsp;invalid&nbsp;characters&nbsp;with&nbsp;the&nbsp;replacement&nbsp;character.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4638628">x</span>&nbsp;<span class="op" id="4638630">=</span>&nbsp;<span class="string" id="4638632">&#39;\uFFFD&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4638643">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638648">return</span>&nbsp;<span class="ident" id="4638655">dst</span>&nbsp;<span class="op" id="4638659">+</span>&nbsp;<span class="ident" id="4638661">utf8</span><span class="op" id="4638665">.</span><span class="ident" id="4638666">EncodeRune</span><span class="op" id="4638676">(</span><span class="ident" id="4638677">b</span><span class="op" id="4638678">[</span><span class="ident" id="4638679">dst</span><span class="op" id="4638682">:</span><span class="op" id="4638683">]</span><span class="op" id="4638684">,</span>&nbsp;<span class="ident" id="4638686">x</span><span class="op" id="4638687">)</span><span class="op" id="4638688">,</span>&nbsp;<span class="ident" id="4638690">src</span>&nbsp;<span class="op" id="4638694">+</span>&nbsp;<span class="ident" id="4638696">i</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4638699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4638703">//&nbsp;Consume&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;characters&nbsp;possible,&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4638767">//&nbsp;consumed&nbsp;characters&nbsp;matching&nbsp;one&nbsp;of&nbsp;the&nbsp;named&nbsp;references.</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638830">for</span>&nbsp;<span class="ident" id="4638834">i</span>&nbsp;<span class="op" id="4638836">&lt;</span>&nbsp;<span class="builtinfunc" id="4638838">len</span><span class="op" id="4638841">(</span><span class="ident" id="4638842">s</span><span class="op" id="4638843">)</span>&nbsp;<span class="op" id="4638845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4638849">c</span>&nbsp;<span class="op" id="4638851">:=</span>&nbsp;<span class="ident" id="4638854">s</span><span class="op" id="4638855">[</span><span class="ident" id="4638856">i</span><span class="op" id="4638857">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4638861">i</span><span class="op" id="4638862">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4638867">//&nbsp;Lower-cased&nbsp;characters&nbsp;are&nbsp;more&nbsp;common&nbsp;in&nbsp;entities,&nbsp;so&nbsp;we&nbsp;check&nbsp;for&nbsp;them&nbsp;first.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638952">if</span>&nbsp;<span class="string" id="4638955">&#39;a&#39;</span>&nbsp;<span class="op" id="4638959">&lt;=</span>&nbsp;<span class="ident" id="4638962">c</span>&nbsp;<span class="op" id="4638964">&amp;&amp;</span>&nbsp;<span class="ident" id="4638967">c</span>&nbsp;<span class="op" id="4638969">&lt;=</span>&nbsp;<span class="string" id="4638972">&#39;z&#39;</span>&nbsp;<span class="op" id="4638976">||</span>&nbsp;<span class="string" id="4638979">&#39;A&#39;</span>&nbsp;<span class="op" id="4638983">&lt;=</span>&nbsp;<span class="ident" id="4638986">c</span>&nbsp;<span class="op" id="4638988">&amp;&amp;</span>&nbsp;<span class="ident" id="4638991">c</span>&nbsp;<span class="op" id="4638993">&lt;=</span>&nbsp;<span class="string" id="4638996">&#39;Z&#39;</span>&nbsp;<span class="op" id="4639000">||</span>&nbsp;<span class="string" id="4639003">&#39;0&#39;</span>&nbsp;<span class="op" id="4639007">&lt;=</span>&nbsp;<span class="ident" id="4639010">c</span>&nbsp;<span class="op" id="4639012">&amp;&amp;</span>&nbsp;<span class="ident" id="4639015">c</span>&nbsp;<span class="op" id="4639017">&lt;=</span>&nbsp;<span class="string" id="4639020">&#39;9&#39;</span>&nbsp;<span class="op" id="4639024">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639029">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4639040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639044">if</span>&nbsp;<span class="ident" id="4639047">c</span>&nbsp;<span class="op" id="4639049">!=</span>&nbsp;<span class="string" id="4639052">&#39;;&#39;</span>&nbsp;<span class="op" id="4639056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4639061">i</span><span class="op" id="4639062">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4639067">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639071">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4639078">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4639082">entityName</span>&nbsp;<span class="op" id="4639093">:=</span>&nbsp;<span class="builtintype" id="4639096">string</span><span class="op" id="4639102">(</span><span class="ident" id="4639103">s</span><span class="op" id="4639104">[</span><span class="num" id="4639105">1</span><span class="op" id="4639106">:</span><span class="ident" id="4639107">i</span><span class="op" id="4639108">]</span><span class="op" id="4639109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639112">if</span>&nbsp;<span class="ident" id="4639115">entityName</span>&nbsp;<span class="op" id="4639126">==</span>&nbsp;<span class="string" id="4639129">&#34;&#34;</span>&nbsp;<span class="op" id="4639132">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4639136">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4639147">}</span>&nbsp;<span class="keyword" id="4639149">else</span>&nbsp;<span class="keyword" id="4639154">if</span>&nbsp;<span class="ident" id="4639157">attribute</span>&nbsp;<span class="op" id="4639167">&amp;&amp;</span>&nbsp;<span class="ident" id="4639170">entityName</span><span class="op" id="4639180">[</span><span class="builtinfunc" id="4639181">len</span><span class="op" id="4639184">(</span><span class="ident" id="4639185">entityName</span><span class="op" id="4639195">)</span><span class="op" id="4639196">-</span><span class="num" id="4639197">1</span><span class="op" id="4639198">]</span>&nbsp;<span class="op" id="4639200">!=</span>&nbsp;<span class="string" id="4639203">&#39;;&#39;</span>&nbsp;<span class="op" id="4639207">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4639210">len</span><span class="op" id="4639213">(</span><span class="ident" id="4639214">s</span><span class="op" id="4639215">)</span>&nbsp;<span class="op" id="4639217">&gt;</span>&nbsp;<span class="ident" id="4639219">i</span>&nbsp;<span class="op" id="4639221">&amp;&amp;</span>&nbsp;<span class="ident" id="4639224">s</span><span class="op" id="4639225">[</span><span class="ident" id="4639226">i</span><span class="op" id="4639227">]</span>&nbsp;<span class="op" id="4639229">==</span>&nbsp;<span class="string" id="4639232">&#39;=&#39;</span>&nbsp;<span class="op" id="4639236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4639240">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4639251">}</span>&nbsp;<span class="keyword" id="4639253">else</span>&nbsp;<span class="keyword" id="4639258">if</span>&nbsp;<span class="ident" id="4639261">x</span>&nbsp;<span class="op" id="4639263">:=</span>&nbsp;<span class="ident" id="4639266">entity</span><span class="op" id="4639272">[</span><span class="ident" id="4639273">entityName</span><span class="op" id="4639283">]</span><span class="op" id="4639284">;</span>&nbsp;<span class="ident" id="4639286">x</span>&nbsp;<span class="op" id="4639288">!=</span>&nbsp;<span class="num" id="4639291">0</span>&nbsp;<span class="op" id="4639293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639297">return</span>&nbsp;<span class="ident" id="4639304">dst</span>&nbsp;<span class="op" id="4639308">+</span>&nbsp;<span class="ident" id="4639310">utf8</span><span class="op" id="4639314">.</span><span class="ident" id="4639315">EncodeRune</span><span class="op" id="4639325">(</span><span class="ident" id="4639326">b</span><span class="op" id="4639327">[</span><span class="ident" id="4639328">dst</span><span class="op" id="4639331">:</span><span class="op" id="4639332">]</span><span class="op" id="4639333">,</span>&nbsp;<span class="ident" id="4639335">x</span><span class="op" id="4639336">)</span><span class="op" id="4639337">,</span>&nbsp;<span class="ident" id="4639339">src</span>&nbsp;<span class="op" id="4639343">+</span>&nbsp;<span class="ident" id="4639345">i</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4639348">}</span>&nbsp;<span class="keyword" id="4639350">else</span>&nbsp;<span class="keyword" id="4639355">if</span>&nbsp;<span class="ident" id="4639358">x</span>&nbsp;<span class="op" id="4639360">:=</span>&nbsp;<span class="ident" id="4639363">entity2</span><span class="op" id="4639370">[</span><span class="ident" id="4639371">entityName</span><span class="op" id="4639381">]</span><span class="op" id="4639382">;</span>&nbsp;<span class="ident" id="4639384">x</span><span class="op" id="4639385">[</span><span class="num" id="4639386">0</span><span class="op" id="4639387">]</span>&nbsp;<span class="op" id="4639389">!=</span>&nbsp;<span class="num" id="4639392">0</span>&nbsp;<span class="op" id="4639394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4639398">dst1</span>&nbsp;<span class="op" id="4639403">:=</span>&nbsp;<span class="ident" id="4639406">dst</span>&nbsp;<span class="op" id="4639410">+</span>&nbsp;<span class="ident" id="4639412">utf8</span><span class="op" id="4639416">.</span><span class="ident" id="4639417">EncodeRune</span><span class="op" id="4639427">(</span><span class="ident" id="4639428">b</span><span class="op" id="4639429">[</span><span class="ident" id="4639430">dst</span><span class="op" id="4639433">:</span><span class="op" id="4639434">]</span><span class="op" id="4639435">,</span>&nbsp;<span class="ident" id="4639437">x</span><span class="op" id="4639438">[</span><span class="num" id="4639439">0</span><span class="op" id="4639440">]</span><span class="op" id="4639441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639445">return</span>&nbsp;<span class="ident" id="4639452">dst1</span>&nbsp;<span class="op" id="4639457">+</span>&nbsp;<span class="ident" id="4639459">utf8</span><span class="op" id="4639463">.</span><span class="ident" id="4639464">EncodeRune</span><span class="op" id="4639474">(</span><span class="ident" id="4639475">b</span><span class="op" id="4639476">[</span><span class="ident" id="4639477">dst1</span><span class="op" id="4639481">:</span><span class="op" id="4639482">]</span><span class="op" id="4639483">,</span>&nbsp;<span class="ident" id="4639485">x</span><span class="op" id="4639486">[</span><span class="num" id="4639487">1</span><span class="op" id="4639488">]</span><span class="op" id="4639489">)</span><span class="op" id="4639490">,</span>&nbsp;<span class="ident" id="4639492">src</span>&nbsp;<span class="op" id="4639496">+</span>&nbsp;<span class="ident" id="4639498">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4639501">}</span>&nbsp;<span class="keyword" id="4639503">else</span>&nbsp;<span class="keyword" id="4639508">if</span>&nbsp;<span class="op" id="4639511">!</span><span class="ident" id="4639512">attribute</span>&nbsp;<span class="op" id="4639522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4639526">maxLen</span>&nbsp;<span class="op" id="4639533">:=</span>&nbsp;<span class="builtinfunc" id="4639536">len</span><span class="op" id="4639539">(</span><span class="ident" id="4639540">entityName</span><span class="op" id="4639550">)</span>&nbsp;<span class="op" id="4639552">-</span>&nbsp;<span class="num" id="4639554">1</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639558">if</span>&nbsp;<span class="ident" id="4639561">maxLen</span>&nbsp;<span class="op" id="4639568">&gt;</span>&nbsp;<span class="ident" id="4639570">longestEntityWithoutSemicolon</span>&nbsp;<span class="op" id="4639600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4639605">maxLen</span>&nbsp;<span class="op" id="4639612">=</span>&nbsp;<span class="ident" id="4639614">longestEntityWithoutSemicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4639646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639650">for</span>&nbsp;<span class="ident" id="4639654">j</span>&nbsp;<span class="op" id="4639656">:=</span>&nbsp;<span class="ident" id="4639659">maxLen</span><span class="op" id="4639665">;</span>&nbsp;<span class="ident" id="4639667">j</span>&nbsp;<span class="op" id="4639669">&gt;</span>&nbsp;<span class="num" id="4639671">1</span><span class="op" id="4639672">;</span>&nbsp;<span class="ident" id="4639674">j</span><span class="op" id="4639675">--</span>&nbsp;<span class="op" id="4639678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639683">if</span>&nbsp;<span class="ident" id="4639686">x</span>&nbsp;<span class="op" id="4639688">:=</span>&nbsp;<span class="ident" id="4639691">entity</span><span class="op" id="4639697">[</span><span class="ident" id="4639698">entityName</span><span class="op" id="4639708">[</span><span class="op" id="4639709">:</span><span class="ident" id="4639710">j</span><span class="op" id="4639711">]</span><span class="op" id="4639712">]</span><span class="op" id="4639713">;</span>&nbsp;<span class="ident" id="4639715">x</span>&nbsp;<span class="op" id="4639717">!=</span>&nbsp;<span class="num" id="4639720">0</span>&nbsp;<span class="op" id="4639722">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639728">return</span>&nbsp;<span class="ident" id="4639735">dst</span>&nbsp;<span class="op" id="4639739">+</span>&nbsp;<span class="ident" id="4639741">utf8</span><span class="op" id="4639745">.</span><span class="ident" id="4639746">EncodeRune</span><span class="op" id="4639756">(</span><span class="ident" id="4639757">b</span><span class="op" id="4639758">[</span><span class="ident" id="4639759">dst</span><span class="op" id="4639762">:</span><span class="op" id="4639763">]</span><span class="op" id="4639764">,</span>&nbsp;<span class="ident" id="4639766">x</span><span class="op" id="4639767">)</span><span class="op" id="4639768">,</span>&nbsp;<span class="ident" id="4639770">src</span>&nbsp;<span class="op" id="4639774">+</span>&nbsp;<span class="ident" id="4639776">j</span>&nbsp;<span class="op" id="4639778">+</span>&nbsp;<span class="num" id="4639780">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4639785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4639789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4639792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4639796">dst1</span><span class="op" id="4639800">,</span>&nbsp;<span class="ident" id="4639802">src1</span>&nbsp;<span class="op" id="4639807">=</span>&nbsp;<span class="ident" id="4639809">dst</span><span class="op" id="4639812">+</span><span class="ident" id="4639813">i</span><span class="op" id="4639814">,</span>&nbsp;<span class="ident" id="4639816">src</span><span class="op" id="4639819">+</span><span class="ident" id="4639820">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4639823">copy</span><span class="op" id="4639827">(</span><span class="ident" id="4639828">b</span><span class="op" id="4639829">[</span><span class="ident" id="4639830">dst</span><span class="op" id="4639833">:</span><span class="ident" id="4639834">dst1</span><span class="op" id="4639838">]</span><span class="op" id="4639839">,</span>&nbsp;<span class="ident" id="4639841">b</span><span class="op" id="4639842">[</span><span class="ident" id="4639843">src</span><span class="op" id="4639846">:</span><span class="ident" id="4639847">src1</span><span class="op" id="4639851">]</span><span class="op" id="4639852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639855">return</span>&nbsp;<span class="ident" id="4639862">dst1</span><span class="op" id="4639866">,</span>&nbsp;<span class="ident" id="4639868">src1</span><br>
<span class="lineno"></span><span class="op" id="4639873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="comment" id="4639876">//&nbsp;unescape&nbsp;unescapes&nbsp;b&#39;s&nbsp;entities&nbsp;in-place,&nbsp;so&nbsp;that&nbsp;&#34;a&amp;lt;b&#34;&nbsp;becomes&nbsp;&#34;a&lt;b&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="4639953">func</span>&nbsp;<span class="ident" id="4639958">unescape</span><span class="op" id="4639966">(</span><span class="ident" id="4639967">b</span>&nbsp;<span class="op" id="4639969">[</span><span class="op" id="4639970">]</span><span class="builtintype" id="4639971">byte</span><span class="op" id="4639975">)</span>&nbsp;<span class="op" id="4639977">[</span><span class="op" id="4639978">]</span><span class="builtintype" id="4639979">byte</span>&nbsp;<span class="op" id="4639984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639987">for</span>&nbsp;<span class="ident" id="4639991">i</span><span class="op" id="4639992">,</span>&nbsp;<span class="ident" id="4639994">c</span>&nbsp;<span class="op" id="4639996">:=</span>&nbsp;<span class="keyword" id="4639999">range</span>&nbsp;<span class="ident" id="4640005">b</span>&nbsp;<span class="op" id="4640007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640011">if</span>&nbsp;<span class="ident" id="4640014">c</span>&nbsp;<span class="op" id="4640016">==</span>&nbsp;<span class="string" id="4640019">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="4640023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640028">dst</span><span class="op" id="4640031">,</span>&nbsp;<span class="ident" id="4640033">src</span>&nbsp;<span class="op" id="4640037">:=</span>&nbsp;<span class="ident" id="4640040">unescapeEntity</span><span class="op" id="4640054">(</span><span class="ident" id="4640055">b</span><span class="op" id="4640056">,</span>&nbsp;<span class="ident" id="4640058">i</span><span class="op" id="4640059">,</span>&nbsp;<span class="ident" id="4640061">i</span><span class="op" id="4640062">,</span>&nbsp;<span class="ident" id="4640064">false</span><span class="op" id="4640069">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640074">for</span>&nbsp;<span class="ident" id="4640078">src</span>&nbsp;<span class="op" id="4640082">&lt;</span>&nbsp;<span class="builtinfunc" id="4640084">len</span><span class="op" id="4640087">(</span><span class="ident" id="4640088">b</span><span class="op" id="4640089">)</span>&nbsp;<span class="op" id="4640091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640097">c</span>&nbsp;<span class="op" id="4640099">:=</span>&nbsp;<span class="ident" id="4640102">b</span><span class="op" id="4640103">[</span><span class="ident" id="4640104">src</span><span class="op" id="4640107">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640113">if</span>&nbsp;<span class="ident" id="4640116">c</span>&nbsp;<span class="op" id="4640118">==</span>&nbsp;<span class="string" id="4640121">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="4640125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640132">dst</span><span class="op" id="4640135">,</span>&nbsp;<span class="ident" id="4640137">src</span>&nbsp;<span class="op" id="4640141">=</span>&nbsp;<span class="ident" id="4640143">unescapeEntity</span><span class="op" id="4640157">(</span><span class="ident" id="4640158">b</span><span class="op" id="4640159">,</span>&nbsp;<span class="ident" id="4640161">dst</span><span class="op" id="4640164">,</span>&nbsp;<span class="ident" id="4640166">src</span><span class="op" id="4640169">,</span>&nbsp;<span class="ident" id="4640171">false</span><span class="op" id="4640176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4640182">}</span>&nbsp;<span class="keyword" id="4640184">else</span>&nbsp;<span class="op" id="4640189">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640196">b</span><span class="op" id="4640197">[</span><span class="ident" id="4640198">dst</span><span class="op" id="4640201">]</span>&nbsp;<span class="op" id="4640203">=</span>&nbsp;<span class="ident" id="4640205">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640212">dst</span><span class="op" id="4640215">,</span>&nbsp;<span class="ident" id="4640217">src</span>&nbsp;<span class="op" id="4640221">=</span>&nbsp;<span class="ident" id="4640223">dst</span><span class="op" id="4640226">+</span><span class="num" id="4640227">1</span><span class="op" id="4640228">,</span>&nbsp;<span class="ident" id="4640230">src</span><span class="op" id="4640233">+</span><span class="num" id="4640234">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4640240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4640245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640250">return</span>&nbsp;<span class="ident" id="4640257">b</span><span class="op" id="4640258">[</span><span class="num" id="4640259">0</span><span class="op" id="4640260">:</span><span class="ident" id="4640261">dst</span><span class="op" id="4640264">]</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4640268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4640271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640274">return</span>&nbsp;<span class="ident" id="4640281">b</span><br>
<span class="lineno"></span><span class="op" id="4640283">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="4640286">const</span>&nbsp;<span class="ident" id="4640292">escapedChars</span>&nbsp;<span class="op" id="4640305">=</span>&nbsp;<span class="string" id="4640307">`&amp;&#39;&lt;&gt;&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4640316">func</span>&nbsp;<span class="ident" id="4640321">escape</span><span class="op" id="4640327">(</span><span class="ident" id="4640328">w</span>&nbsp;<span class="ident" id="4640330">writer</span><span class="op" id="4640336">,</span>&nbsp;<span class="ident" id="4640338">s</span>&nbsp;<span class="builtintype" id="4640340">string</span><span class="op" id="4640346">)</span>&nbsp;<span class="builtintype" id="4640348">error</span>&nbsp;<span class="op" id="4640354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640357">i</span>&nbsp;<span class="op" id="4640359">:=</span>&nbsp;<span class="ident" id="4640362">strings</span><span class="op" id="4640369">.</span><span class="ident" id="4640370">IndexAny</span><span class="op" id="4640378">(</span><span class="ident" id="4640379">s</span><span class="op" id="4640380">,</span>&nbsp;<span class="ident" id="4640382">escapedChars</span><span class="op" id="4640394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640397">for</span>&nbsp;<span class="ident" id="4640401">i</span>&nbsp;<span class="op" id="4640403">!=</span>&nbsp;<span class="op" id="4640406">-</span><span class="num" id="4640407">1</span>&nbsp;<span class="op" id="4640409">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640413">if</span>&nbsp;<span class="ident" id="4640416">_</span><span class="op" id="4640417">,</span>&nbsp;<span class="ident" id="4640419">err</span>&nbsp;<span class="op" id="4640423">:=</span>&nbsp;<span class="ident" id="4640426">w</span><span class="op" id="4640427">.</span><span class="ident" id="4640428">WriteString</span><span class="op" id="4640439">(</span><span class="ident" id="4640440">s</span><span class="op" id="4640441">[</span><span class="op" id="4640442">:</span><span class="ident" id="4640443">i</span><span class="op" id="4640444">]</span><span class="op" id="4640445">)</span><span class="op" id="4640446">;</span>&nbsp;<span class="ident" id="4640448">err</span>&nbsp;<span class="op" id="4640452">!=</span>&nbsp;<span class="ident" id="4640455">nil</span>&nbsp;<span class="op" id="4640459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640464">return</span>&nbsp;<span class="ident" id="4640471">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4640477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640481">var</span>&nbsp;<span class="ident" id="4640485">esc</span>&nbsp;<span class="builtintype" id="4640489">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640498">switch</span>&nbsp;<span class="ident" id="4640505">s</span><span class="op" id="4640506">[</span><span class="ident" id="4640507">i</span><span class="op" id="4640508">]</span>&nbsp;<span class="op" id="4640510">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640514">case</span>&nbsp;<span class="string" id="4640519">&#39;&amp;&#39;</span><span class="op" id="4640522">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640527">esc</span>&nbsp;<span class="op" id="4640531">=</span>&nbsp;<span class="string" id="4640533">&#34;&amp;amp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640543">case</span>&nbsp;<span class="string" id="4640548">&#39;\&#39;&#39;</span><span class="op" id="4640552">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4640557">//&nbsp;&#34;&amp;#39;&#34;&nbsp;is&nbsp;shorter&nbsp;than&nbsp;&#34;&amp;apos;&#34;&nbsp;and&nbsp;apos&nbsp;was&nbsp;not&nbsp;in&nbsp;HTML&nbsp;until&nbsp;HTML5.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640634">esc</span>&nbsp;<span class="op" id="4640638">=</span>&nbsp;<span class="string" id="4640640">&#34;&amp;#39;&#34;</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640650">case</span>&nbsp;<span class="string" id="4640655">&#39;&lt;&#39;</span><span class="op" id="4640658">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640663">esc</span>&nbsp;<span class="op" id="4640667">=</span>&nbsp;<span class="string" id="4640669">&#34;&amp;lt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640678">case</span>&nbsp;<span class="string" id="4640683">&#39;&gt;&#39;</span><span class="op" id="4640686">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640691">esc</span>&nbsp;<span class="op" id="4640695">=</span>&nbsp;<span class="string" id="4640697">&#34;&amp;gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640706">case</span>&nbsp;<span class="string" id="4640711">&#39;&#34;&#39;</span><span class="op" id="4640714">:</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4640719">//&nbsp;&#34;&amp;#34;&#34;&nbsp;is&nbsp;shorter&nbsp;than&nbsp;&#34;&amp;quot;&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640759">esc</span>&nbsp;<span class="op" id="4640763">=</span>&nbsp;<span class="string" id="4640765">&#34;&amp;#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640775">default</span><span class="op" id="4640782">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4640787">panic</span><span class="op" id="4640792">(</span><span class="string" id="4640793">&#34;unrecognized&nbsp;escape&nbsp;character&#34;</span><span class="op" id="4640824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4640828">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640832">s</span>&nbsp;<span class="op" id="4640834">=</span>&nbsp;<span class="ident" id="4640836">s</span><span class="op" id="4640837">[</span><span class="ident" id="4640838">i</span><span class="op" id="4640839">+</span><span class="num" id="4640840">1</span><span class="op" id="4640841">:</span><span class="op" id="4640842">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640846">if</span>&nbsp;<span class="ident" id="4640849">_</span><span class="op" id="4640850">,</span>&nbsp;<span class="ident" id="4640852">err</span>&nbsp;<span class="op" id="4640856">:=</span>&nbsp;<span class="ident" id="4640859">w</span><span class="op" id="4640860">.</span><span class="ident" id="4640861">WriteString</span><span class="op" id="4640872">(</span><span class="ident" id="4640873">esc</span><span class="op" id="4640876">)</span><span class="op" id="4640877">;</span>&nbsp;<span class="ident" id="4640879">err</span>&nbsp;<span class="op" id="4640883">!=</span>&nbsp;<span class="ident" id="4640886">nil</span>&nbsp;<span class="op" id="4640890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640895">return</span>&nbsp;<span class="ident" id="4640902">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4640908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640912">i</span>&nbsp;<span class="op" id="4640914">=</span>&nbsp;<span class="ident" id="4640916">strings</span><span class="op" id="4640923">.</span><span class="ident" id="4640924">IndexAny</span><span class="op" id="4640932">(</span><span class="ident" id="4640933">s</span><span class="op" id="4640934">,</span>&nbsp;<span class="ident" id="4640936">escapedChars</span><span class="op" id="4640948">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4640951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640954">_</span><span class="op" id="4640955">,</span>&nbsp;<span class="ident" id="4640957">err</span>&nbsp;<span class="op" id="4640961">:=</span>&nbsp;<span class="ident" id="4640964">w</span><span class="op" id="4640965">.</span><span class="ident" id="4640966">WriteString</span><span class="op" id="4640977">(</span><span class="ident" id="4640978">s</span><span class="op" id="4640979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640982">return</span>&nbsp;<span class="ident" id="4640989">err</span><br>
<span class="lineno"></span><span class="op" id="4640993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span><span class="comment" id="4640996">//&nbsp;EscapeString&nbsp;escapes&nbsp;special&nbsp;characters&nbsp;like&nbsp;&#34;&lt;&#34;&nbsp;to&nbsp;become&nbsp;&#34;&amp;lt;&#34;.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="4641069">//&nbsp;escapes&nbsp;only&nbsp;five&nbsp;such&nbsp;characters:&nbsp;&lt;,&nbsp;&gt;,&nbsp;&amp;,&nbsp;&#39;&nbsp;and&nbsp;&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="4641125">//&nbsp;UnescapeString(EscapeString(s))&nbsp;==&nbsp;s&nbsp;always&nbsp;holds,&nbsp;but&nbsp;the&nbsp;converse&nbsp;isn&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="4641202">//&nbsp;always&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="4641218">func</span>&nbsp;<span class="ident" id="4641223">EscapeString</span><span class="op" id="4641235">(</span><span class="ident" id="4641236">s</span>&nbsp;<span class="builtintype" id="4641238">string</span><span class="op" id="4641244">)</span>&nbsp;<span class="builtintype" id="4641246">string</span>&nbsp;<span class="op" id="4641253">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4641256">if</span>&nbsp;<span class="ident" id="4641259">strings</span><span class="op" id="4641266">.</span><span class="ident" id="4641267">IndexAny</span><span class="op" id="4641275">(</span><span class="ident" id="4641276">s</span><span class="op" id="4641277">,</span>&nbsp;<span class="ident" id="4641279">escapedChars</span><span class="op" id="4641291">)</span>&nbsp;<span class="op" id="4641293">==</span>&nbsp;<span class="op" id="4641296">-</span><span class="num" id="4641297">1</span>&nbsp;<span class="op" id="4641299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4641303">return</span>&nbsp;<span class="ident" id="4641310">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4641313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4641316">var</span>&nbsp;<span class="ident" id="4641320">buf</span>&nbsp;<span class="ident" id="4641324">bytes</span><span class="op" id="4641329">.</span><span class="ident" id="4641330">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4641338">escape</span><span class="op" id="4641344">(</span><span class="op" id="4641345">&amp;</span><span class="ident" id="4641346">buf</span><span class="op" id="4641349">,</span>&nbsp;<span class="ident" id="4641351">s</span><span class="op" id="4641352">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4641355">return</span>&nbsp;<span class="ident" id="4641362">buf</span><span class="op" id="4641365">.</span><span class="ident" id="4641366">String</span><span class="op" id="4641372">(</span><span class="op" id="4641373">)</span><br>
<span class="lineno"></span><span class="op" id="4641375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4641378">//&nbsp;UnescapeString&nbsp;unescapes&nbsp;entities&nbsp;like&nbsp;&#34;&amp;lt;&#34;&nbsp;to&nbsp;become&nbsp;&#34;&lt;&#34;.&nbsp;It&nbsp;unescapes&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4641457">//&nbsp;larger&nbsp;range&nbsp;of&nbsp;entities&nbsp;than&nbsp;EscapeString&nbsp;escapes.&nbsp;For&nbsp;example,&nbsp;&#34;&amp;aacute;&#34;</span><br>
<span class="lineno">240</span><span class="comment" id="4641536">//&nbsp;unescapes&nbsp;to&nbsp;&#34;á&#34;,&nbsp;as&nbsp;does&nbsp;&#34;&amp;#225;&#34;&nbsp;and&nbsp;&#34;&amp;xE1;&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="4641588">//&nbsp;UnescapeString(EscapeString(s))&nbsp;==&nbsp;s&nbsp;always&nbsp;holds,&nbsp;but&nbsp;the&nbsp;converse&nbsp;isn&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="4641665">//&nbsp;always&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="4641681">func</span>&nbsp;<span class="ident" id="4641686">UnescapeString</span><span class="op" id="4641700">(</span><span class="ident" id="4641701">s</span>&nbsp;<span class="builtintype" id="4641703">string</span><span class="op" id="4641709">)</span>&nbsp;<span class="builtintype" id="4641711">string</span>&nbsp;<span class="op" id="4641718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4641721">for</span>&nbsp;<span class="ident" id="4641725">_</span><span class="op" id="4641726">,</span>&nbsp;<span class="ident" id="4641728">c</span>&nbsp;<span class="op" id="4641730">:=</span>&nbsp;<span class="keyword" id="4641733">range</span>&nbsp;<span class="ident" id="4641739">s</span>&nbsp;<span class="op" id="4641741">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4641745">if</span>&nbsp;<span class="ident" id="4641748">c</span>&nbsp;<span class="op" id="4641750">==</span>&nbsp;<span class="string" id="4641753">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="4641757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4641762">return</span>&nbsp;<span class="builtintype" id="4641769">string</span><span class="op" id="4641775">(</span><span class="ident" id="4641776">unescape</span><span class="op" id="4641784">(</span><span class="op" id="4641785">[</span><span class="op" id="4641786">]</span><span class="builtintype" id="4641787">byte</span><span class="op" id="4641791">(</span><span class="ident" id="4641792">s</span><span class="op" id="4641793">)</span><span class="op" id="4641794">)</span><span class="op" id="4641795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4641799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4641802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4641805">return</span>&nbsp;<span class="ident" id="4641812">s</span><br>
<span class="lineno">250</span><span class="op" id="4641814">}</span>
</div>
</body>
</html>
