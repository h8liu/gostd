<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3277319">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3277375">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3277429">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3277480">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3277558">package</span>&nbsp;<span class="ident" id="3277566">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3277571">import</span>&nbsp;<span class="op" id="3277578">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3277581">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3277587">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3277598">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3277605">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="3277608">//&nbsp;A&nbsp;sockaddr&nbsp;represents&nbsp;a&nbsp;TCP,&nbsp;UDP,&nbsp;IP&nbsp;or&nbsp;Unix&nbsp;network&nbsp;endpoint</span><br>
<span class="lineno"></span><span class="comment" id="3277673">//&nbsp;address&nbsp;that&nbsp;can&nbsp;be&nbsp;converted&nbsp;into&nbsp;a&nbsp;syscall.Sockaddr.</span><br>
<span class="lineno"></span><span class="keyword" id="3277731">type</span>&nbsp;<span class="ident" id="3277736">sockaddr</span>&nbsp;<span class="keyword" id="3277745">interface</span>&nbsp;<span class="op" id="3277755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3277758">Addr</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3277765">netaddr</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3277775">//&nbsp;family&nbsp;returns&nbsp;the&nbsp;platform-dependent&nbsp;address&nbsp;family</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3277832">//&nbsp;identifier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3277848">family</span><span class="op" id="3277854">(</span><span class="op" id="3277855">)</span>&nbsp;<span class="builtintype" id="3277857">int</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3277863">//&nbsp;isWildcard&nbsp;reports&nbsp;whether&nbsp;the&nbsp;address&nbsp;is&nbsp;a&nbsp;wildcard</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3277920">//&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3277933">isWildcard</span><span class="op" id="3277943">(</span><span class="op" id="3277944">)</span>&nbsp;<span class="builtintype" id="3277946">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3277953">//&nbsp;sockaddr&nbsp;returns&nbsp;the&nbsp;address&nbsp;converted&nbsp;into&nbsp;a&nbsp;syscall</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3278011">//&nbsp;sockaddr&nbsp;type&nbsp;that&nbsp;implements&nbsp;syscall.Sockaddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3278062">//&nbsp;interface.&nbsp;It&nbsp;returns&nbsp;a&nbsp;nil&nbsp;interface&nbsp;when&nbsp;the&nbsp;address&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3278124">//&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3278133">sockaddr</span><span class="op" id="3278141">(</span><span class="ident" id="3278142">family</span>&nbsp;<span class="builtintype" id="3278149">int</span><span class="op" id="3278152">)</span>&nbsp;<span class="op" id="3278154">(</span><span class="ident" id="3278155">syscall</span><span class="op" id="3278162">.</span><span class="ident" id="3278163">Sockaddr</span><span class="op" id="3278171">,</span>&nbsp;<span class="builtintype" id="3278173">error</span><span class="op" id="3278178">)</span><br>
<span class="lineno">35</span><span class="op" id="3278180">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3278183">//&nbsp;socket&nbsp;returns&nbsp;a&nbsp;network&nbsp;file&nbsp;descriptor&nbsp;that&nbsp;is&nbsp;ready&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="3278245">//&nbsp;asynchronous&nbsp;I/O&nbsp;using&nbsp;the&nbsp;network&nbsp;poller.</span><br>
<span class="lineno"></span><span class="keyword" id="3278291">func</span>&nbsp;<span class="ident" id="3278296">socket</span><span class="op" id="3278302">(</span><span class="ident" id="3278303">net</span>&nbsp;<span class="builtintype" id="3278307">string</span><span class="op" id="3278313">,</span>&nbsp;<span class="ident" id="3278315">family</span><span class="op" id="3278321">,</span>&nbsp;<span class="ident" id="3278323">sotype</span><span class="op" id="3278329">,</span>&nbsp;<span class="ident" id="3278331">proto</span>&nbsp;<span class="builtintype" id="3278337">int</span><span class="op" id="3278340">,</span>&nbsp;<span class="ident" id="3278342">ipv6only</span>&nbsp;<span class="builtintype" id="3278351">bool</span><span class="op" id="3278355">,</span>&nbsp;<span class="ident" id="3278357">laddr</span><span class="op" id="3278362">,</span>&nbsp;<span class="ident" id="3278364">raddr</span>&nbsp;<span class="ident" id="3278370">sockaddr</span><span class="op" id="3278378">,</span>&nbsp;<span class="ident" id="3278380">deadline</span>&nbsp;<span class="ident" id="3278389">time</span><span class="op" id="3278393">.</span><span class="ident" id="3278394">Time</span><span class="op" id="3278398">)</span>&nbsp;<span class="op" id="3278400">(</span><span class="ident" id="3278401">fd</span>&nbsp;<span class="op" id="3278404">*</span><span class="ident" id="3278405">netFD</span><span class="op" id="3278410">,</span>&nbsp;<span class="ident" id="3278412">err</span>&nbsp;<span class="builtintype" id="3278416">error</span><span class="op" id="3278421">)</span>&nbsp;<span class="op" id="3278423">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3278426">s</span><span class="op" id="3278427">,</span>&nbsp;<span class="ident" id="3278429">err</span>&nbsp;<span class="op" id="3278433">:=</span>&nbsp;<span class="ident" id="3278436">sysSocket</span><span class="op" id="3278445">(</span><span class="ident" id="3278446">family</span><span class="op" id="3278452">,</span>&nbsp;<span class="ident" id="3278454">sotype</span><span class="op" id="3278460">,</span>&nbsp;<span class="ident" id="3278462">proto</span><span class="op" id="3278467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3278470">if</span>&nbsp;<span class="ident" id="3278473">err</span>&nbsp;<span class="op" id="3278477">!=</span>&nbsp;<span class="ident" id="3278480">nil</span>&nbsp;<span class="op" id="3278484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3278488">return</span>&nbsp;<span class="ident" id="3278495">nil</span><span class="op" id="3278498">,</span>&nbsp;<span class="ident" id="3278500">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3278505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3278508">if</span>&nbsp;<span class="ident" id="3278511">err</span>&nbsp;<span class="op" id="3278515">=</span>&nbsp;<span class="ident" id="3278517">setDefaultSockopts</span><span class="op" id="3278535">(</span><span class="ident" id="3278536">s</span><span class="op" id="3278537">,</span>&nbsp;<span class="ident" id="3278539">family</span><span class="op" id="3278545">,</span>&nbsp;<span class="ident" id="3278547">sotype</span><span class="op" id="3278553">,</span>&nbsp;<span class="ident" id="3278555">ipv6only</span><span class="op" id="3278563">)</span><span class="op" id="3278564">;</span>&nbsp;<span class="ident" id="3278566">err</span>&nbsp;<span class="op" id="3278570">!=</span>&nbsp;<span class="ident" id="3278573">nil</span>&nbsp;<span class="op" id="3278577">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3278581">closesocket</span><span class="op" id="3278592">(</span><span class="ident" id="3278593">s</span><span class="op" id="3278594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3278598">return</span>&nbsp;<span class="ident" id="3278605">nil</span><span class="op" id="3278608">,</span>&nbsp;<span class="ident" id="3278610">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3278615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3278618">if</span>&nbsp;<span class="ident" id="3278621">fd</span><span class="op" id="3278623">,</span>&nbsp;<span class="ident" id="3278625">err</span>&nbsp;<span class="op" id="3278629">=</span>&nbsp;<span class="ident" id="3278631">newFD</span><span class="op" id="3278636">(</span><span class="ident" id="3278637">s</span><span class="op" id="3278638">,</span>&nbsp;<span class="ident" id="3278640">family</span><span class="op" id="3278646">,</span>&nbsp;<span class="ident" id="3278648">sotype</span><span class="op" id="3278654">,</span>&nbsp;<span class="ident" id="3278656">net</span><span class="op" id="3278659">)</span><span class="op" id="3278660">;</span>&nbsp;<span class="ident" id="3278662">err</span>&nbsp;<span class="op" id="3278666">!=</span>&nbsp;<span class="ident" id="3278669">nil</span>&nbsp;<span class="op" id="3278673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3278677">closesocket</span><span class="op" id="3278688">(</span><span class="ident" id="3278689">s</span><span class="op" id="3278690">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3278694">return</span>&nbsp;<span class="ident" id="3278701">nil</span><span class="op" id="3278704">,</span>&nbsp;<span class="ident" id="3278706">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3278711">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3278715">//&nbsp;This&nbsp;function&nbsp;makes&nbsp;a&nbsp;network&nbsp;file&nbsp;descriptor&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3278773">//&nbsp;following&nbsp;applications:</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3278801">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3278805">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;a&nbsp;passive&nbsp;stream</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3278858">//&nbsp;&nbsp;&nbsp;connenction,&nbsp;known&nbsp;as&nbsp;a&nbsp;stream&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3278904">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3278908">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;a&nbsp;destination-unspecific</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3278969">//&nbsp;&nbsp;&nbsp;datagram&nbsp;connection,&nbsp;known&nbsp;as&nbsp;a&nbsp;datagram&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3279025">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3279029">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;an&nbsp;active&nbsp;stream&nbsp;or&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3279087">//&nbsp;&nbsp;&nbsp;destination-specific&nbsp;datagram&nbsp;connection,&nbsp;known&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3279146">//&nbsp;&nbsp;&nbsp;dialer</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3279159">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3279163">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;the&nbsp;other&nbsp;connection,&nbsp;such</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3279226">//&nbsp;&nbsp;&nbsp;as&nbsp;talking&nbsp;to&nbsp;the&nbsp;protocol&nbsp;stack&nbsp;inside&nbsp;the&nbsp;kernel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3279283">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3279287">//&nbsp;For&nbsp;stream&nbsp;and&nbsp;datagram&nbsp;listeners,&nbsp;they&nbsp;will&nbsp;only&nbsp;require</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3279349">//&nbsp;named&nbsp;sockets,&nbsp;so&nbsp;we&nbsp;can&nbsp;assume&nbsp;that&nbsp;it&#39;s&nbsp;just&nbsp;a&nbsp;request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3279410">//&nbsp;from&nbsp;stream&nbsp;or&nbsp;datagram&nbsp;listeners&nbsp;when&nbsp;laddr&nbsp;is&nbsp;not&nbsp;nil&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3279474">//&nbsp;raddr&nbsp;is&nbsp;nil.&nbsp;Otherwise&nbsp;we&nbsp;assume&nbsp;it&#39;s&nbsp;just&nbsp;for&nbsp;dialers&nbsp;or</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3279537">//&nbsp;the&nbsp;other&nbsp;connection&nbsp;holders.</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3279572">if</span>&nbsp;<span class="ident" id="3279575">laddr</span>&nbsp;<span class="op" id="3279581">!=</span>&nbsp;<span class="ident" id="3279584">nil</span>&nbsp;<span class="op" id="3279588">&amp;&amp;</span>&nbsp;<span class="ident" id="3279591">raddr</span>&nbsp;<span class="op" id="3279597">==</span>&nbsp;<span class="ident" id="3279600">nil</span>&nbsp;<span class="op" id="3279604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3279608">switch</span>&nbsp;<span class="ident" id="3279615">sotype</span>&nbsp;<span class="op" id="3279622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3279626">case</span>&nbsp;<span class="ident" id="3279631">syscall</span><span class="op" id="3279638">.</span><span class="ident" id="3279639">SOCK_STREAM</span><span class="op" id="3279650">,</span>&nbsp;<span class="ident" id="3279652">syscall</span><span class="op" id="3279659">.</span><span class="ident" id="3279660">SOCK_SEQPACKET</span><span class="op" id="3279674">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3279679">if</span>&nbsp;<span class="ident" id="3279682">err</span>&nbsp;<span class="op" id="3279686">:=</span>&nbsp;<span class="ident" id="3279689">fd</span><span class="op" id="3279691">.</span><span class="ident" id="3279692">listenStream</span><span class="op" id="3279704">(</span><span class="ident" id="3279705">laddr</span><span class="op" id="3279710">,</span>&nbsp;<span class="ident" id="3279712">listenerBacklog</span><span class="op" id="3279727">)</span><span class="op" id="3279728">;</span>&nbsp;<span class="ident" id="3279730">err</span>&nbsp;<span class="op" id="3279734">!=</span>&nbsp;<span class="ident" id="3279737">nil</span>&nbsp;<span class="op" id="3279741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3279747">fd</span><span class="op" id="3279749">.</span><span class="ident" id="3279750">Close</span><span class="op" id="3279755">(</span><span class="op" id="3279756">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3279762">return</span>&nbsp;<span class="ident" id="3279769">nil</span><span class="op" id="3279772">,</span>&nbsp;<span class="ident" id="3279774">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3279781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3279786">return</span>&nbsp;<span class="ident" id="3279793">fd</span><span class="op" id="3279795">,</span>&nbsp;<span class="ident" id="3279797">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3279803">case</span>&nbsp;<span class="ident" id="3279808">syscall</span><span class="op" id="3279815">.</span><span class="ident" id="3279816">SOCK_DGRAM</span><span class="op" id="3279826">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3279831">if</span>&nbsp;<span class="ident" id="3279834">err</span>&nbsp;<span class="op" id="3279838">:=</span>&nbsp;<span class="ident" id="3279841">fd</span><span class="op" id="3279843">.</span><span class="ident" id="3279844">listenDatagram</span><span class="op" id="3279858">(</span><span class="ident" id="3279859">laddr</span><span class="op" id="3279864">)</span><span class="op" id="3279865">;</span>&nbsp;<span class="ident" id="3279867">err</span>&nbsp;<span class="op" id="3279871">!=</span>&nbsp;<span class="ident" id="3279874">nil</span>&nbsp;<span class="op" id="3279878">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3279884">fd</span><span class="op" id="3279886">.</span><span class="ident" id="3279887">Close</span><span class="op" id="3279892">(</span><span class="op" id="3279893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3279899">return</span>&nbsp;<span class="ident" id="3279906">nil</span><span class="op" id="3279909">,</span>&nbsp;<span class="ident" id="3279911">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3279918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3279923">return</span>&nbsp;<span class="ident" id="3279930">fd</span><span class="op" id="3279932">,</span>&nbsp;<span class="ident" id="3279934">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3279940">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3279943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3279946">if</span>&nbsp;<span class="ident" id="3279949">err</span>&nbsp;<span class="op" id="3279953">:=</span>&nbsp;<span class="ident" id="3279956">fd</span><span class="op" id="3279958">.</span><span class="ident" id="3279959">dial</span><span class="op" id="3279963">(</span><span class="ident" id="3279964">laddr</span><span class="op" id="3279969">,</span>&nbsp;<span class="ident" id="3279971">raddr</span><span class="op" id="3279976">,</span>&nbsp;<span class="ident" id="3279978">deadline</span><span class="op" id="3279986">)</span><span class="op" id="3279987">;</span>&nbsp;<span class="ident" id="3279989">err</span>&nbsp;<span class="op" id="3279993">!=</span>&nbsp;<span class="ident" id="3279996">nil</span>&nbsp;<span class="op" id="3280000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3280004">fd</span><span class="op" id="3280006">.</span><span class="ident" id="3280007">Close</span><span class="op" id="3280012">(</span><span class="op" id="3280013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280017">return</span>&nbsp;<span class="ident" id="3280024">nil</span><span class="op" id="3280027">,</span>&nbsp;<span class="ident" id="3280029">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3280034">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280037">return</span>&nbsp;<span class="ident" id="3280044">fd</span><span class="op" id="3280046">,</span>&nbsp;<span class="ident" id="3280048">nil</span><br>
<span class="lineno"></span><span class="op" id="3280052">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3280055">func</span>&nbsp;<span class="op" id="3280060">(</span><span class="ident" id="3280061">fd</span>&nbsp;<span class="op" id="3280064">*</span><span class="ident" id="3280065">netFD</span><span class="op" id="3280070">)</span>&nbsp;<span class="ident" id="3280072">addrFunc</span><span class="op" id="3280080">(</span><span class="op" id="3280081">)</span>&nbsp;<span class="keyword" id="3280083">func</span><span class="op" id="3280087">(</span><span class="ident" id="3280088">syscall</span><span class="op" id="3280095">.</span><span class="ident" id="3280096">Sockaddr</span><span class="op" id="3280104">)</span>&nbsp;<span class="ident" id="3280106">Addr</span>&nbsp;<span class="op" id="3280111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280114">switch</span>&nbsp;<span class="ident" id="3280121">fd</span><span class="op" id="3280123">.</span><span class="ident" id="3280124">family</span>&nbsp;<span class="op" id="3280131">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280134">case</span>&nbsp;<span class="ident" id="3280139">syscall</span><span class="op" id="3280146">.</span><span class="ident" id="3280147">AF_INET</span><span class="op" id="3280154">,</span>&nbsp;<span class="ident" id="3280156">syscall</span><span class="op" id="3280163">.</span><span class="ident" id="3280164">AF_INET6</span><span class="op" id="3280172">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280176">switch</span>&nbsp;<span class="ident" id="3280183">fd</span><span class="op" id="3280185">.</span><span class="ident" id="3280186">sotype</span>&nbsp;<span class="op" id="3280193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280197">case</span>&nbsp;<span class="ident" id="3280202">syscall</span><span class="op" id="3280209">.</span><span class="ident" id="3280210">SOCK_STREAM</span><span class="op" id="3280221">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280226">return</span>&nbsp;<span class="ident" id="3280233">sockaddrToTCP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280249">case</span>&nbsp;<span class="ident" id="3280254">syscall</span><span class="op" id="3280261">.</span><span class="ident" id="3280262">SOCK_DGRAM</span><span class="op" id="3280272">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280277">return</span>&nbsp;<span class="ident" id="3280284">sockaddrToUDP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280300">case</span>&nbsp;<span class="ident" id="3280305">syscall</span><span class="op" id="3280312">.</span><span class="ident" id="3280313">SOCK_RAW</span><span class="op" id="3280321">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280326">return</span>&nbsp;<span class="ident" id="3280333">sockaddrToIP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3280348">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280351">case</span>&nbsp;<span class="ident" id="3280356">syscall</span><span class="op" id="3280363">.</span><span class="ident" id="3280364">AF_UNIX</span><span class="op" id="3280371">:</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280375">switch</span>&nbsp;<span class="ident" id="3280382">fd</span><span class="op" id="3280384">.</span><span class="ident" id="3280385">sotype</span>&nbsp;<span class="op" id="3280392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280396">case</span>&nbsp;<span class="ident" id="3280401">syscall</span><span class="op" id="3280408">.</span><span class="ident" id="3280409">SOCK_STREAM</span><span class="op" id="3280420">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280425">return</span>&nbsp;<span class="ident" id="3280432">sockaddrToUnix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280449">case</span>&nbsp;<span class="ident" id="3280454">syscall</span><span class="op" id="3280461">.</span><span class="ident" id="3280462">SOCK_DGRAM</span><span class="op" id="3280472">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280477">return</span>&nbsp;<span class="ident" id="3280484">sockaddrToUnixgram</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280505">case</span>&nbsp;<span class="ident" id="3280510">syscall</span><span class="op" id="3280517">.</span><span class="ident" id="3280518">SOCK_SEQPACKET</span><span class="op" id="3280532">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280537">return</span>&nbsp;<span class="ident" id="3280544">sockaddrToUnixpacket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3280567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3280570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280573">return</span>&nbsp;<span class="keyword" id="3280580">func</span><span class="op" id="3280584">(</span><span class="ident" id="3280585">syscall</span><span class="op" id="3280592">.</span><span class="ident" id="3280593">Sockaddr</span><span class="op" id="3280601">)</span>&nbsp;<span class="ident" id="3280603">Addr</span>&nbsp;<span class="op" id="3280608">{</span>&nbsp;<span class="keyword" id="3280610">return</span>&nbsp;<span class="ident" id="3280617">nil</span>&nbsp;<span class="op" id="3280621">}</span><br>
<span class="lineno">120</span><span class="op" id="3280623">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3280626">func</span>&nbsp;<span class="op" id="3280631">(</span><span class="ident" id="3280632">fd</span>&nbsp;<span class="op" id="3280635">*</span><span class="ident" id="3280636">netFD</span><span class="op" id="3280641">)</span>&nbsp;<span class="ident" id="3280643">dial</span><span class="op" id="3280647">(</span><span class="ident" id="3280648">laddr</span><span class="op" id="3280653">,</span>&nbsp;<span class="ident" id="3280655">raddr</span>&nbsp;<span class="ident" id="3280661">sockaddr</span><span class="op" id="3280669">,</span>&nbsp;<span class="ident" id="3280671">deadline</span>&nbsp;<span class="ident" id="3280680">time</span><span class="op" id="3280684">.</span><span class="ident" id="3280685">Time</span><span class="op" id="3280689">)</span>&nbsp;<span class="builtintype" id="3280691">error</span>&nbsp;<span class="op" id="3280697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280700">var</span>&nbsp;<span class="ident" id="3280704">err</span>&nbsp;<span class="builtintype" id="3280708">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280715">var</span>&nbsp;<span class="ident" id="3280719">lsa</span>&nbsp;<span class="ident" id="3280723">syscall</span><span class="op" id="3280730">.</span><span class="ident" id="3280731">Sockaddr</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280741">if</span>&nbsp;<span class="ident" id="3280744">laddr</span>&nbsp;<span class="op" id="3280750">!=</span>&nbsp;<span class="ident" id="3280753">nil</span>&nbsp;<span class="op" id="3280757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280761">if</span>&nbsp;<span class="ident" id="3280764">lsa</span><span class="op" id="3280767">,</span>&nbsp;<span class="ident" id="3280769">err</span>&nbsp;<span class="op" id="3280773">=</span>&nbsp;<span class="ident" id="3280775">laddr</span><span class="op" id="3280780">.</span><span class="ident" id="3280781">sockaddr</span><span class="op" id="3280789">(</span><span class="ident" id="3280790">fd</span><span class="op" id="3280792">.</span><span class="ident" id="3280793">family</span><span class="op" id="3280799">)</span><span class="op" id="3280800">;</span>&nbsp;<span class="ident" id="3280802">err</span>&nbsp;<span class="op" id="3280806">!=</span>&nbsp;<span class="ident" id="3280809">nil</span>&nbsp;<span class="op" id="3280813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280818">return</span>&nbsp;<span class="ident" id="3280825">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3280831">}</span>&nbsp;<span class="keyword" id="3280833">else</span>&nbsp;<span class="keyword" id="3280838">if</span>&nbsp;<span class="ident" id="3280841">lsa</span>&nbsp;<span class="op" id="3280845">!=</span>&nbsp;<span class="ident" id="3280848">nil</span>&nbsp;<span class="op" id="3280852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280857">if</span>&nbsp;<span class="ident" id="3280860">err</span>&nbsp;<span class="op" id="3280864">:=</span>&nbsp;<span class="ident" id="3280867">syscall</span><span class="op" id="3280874">.</span><span class="ident" id="3280875">Bind</span><span class="op" id="3280879">(</span><span class="ident" id="3280880">fd</span><span class="op" id="3280882">.</span><span class="ident" id="3280883">sysfd</span><span class="op" id="3280888">,</span>&nbsp;<span class="ident" id="3280890">lsa</span><span class="op" id="3280893">)</span><span class="op" id="3280894">;</span>&nbsp;<span class="ident" id="3280896">err</span>&nbsp;<span class="op" id="3280900">!=</span>&nbsp;<span class="ident" id="3280903">nil</span>&nbsp;<span class="op" id="3280907">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280913">return</span>&nbsp;<span class="ident" id="3280920">os</span><span class="op" id="3280922">.</span><span class="ident" id="3280923">NewSyscallError</span><span class="op" id="3280938">(</span><span class="string" id="3280939">&#34;bind&#34;</span><span class="op" id="3280945">,</span>&nbsp;<span class="ident" id="3280947">err</span><span class="op" id="3280950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3280955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3280959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3280962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280965">var</span>&nbsp;<span class="ident" id="3280969">rsa</span>&nbsp;<span class="ident" id="3280973">syscall</span><span class="op" id="3280980">.</span><span class="ident" id="3280981">Sockaddr</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280991">if</span>&nbsp;<span class="ident" id="3280994">raddr</span>&nbsp;<span class="op" id="3281000">!=</span>&nbsp;<span class="ident" id="3281003">nil</span>&nbsp;<span class="op" id="3281007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281011">if</span>&nbsp;<span class="ident" id="3281014">rsa</span><span class="op" id="3281017">,</span>&nbsp;<span class="ident" id="3281019">err</span>&nbsp;<span class="op" id="3281023">=</span>&nbsp;<span class="ident" id="3281025">raddr</span><span class="op" id="3281030">.</span><span class="ident" id="3281031">sockaddr</span><span class="op" id="3281039">(</span><span class="ident" id="3281040">fd</span><span class="op" id="3281042">.</span><span class="ident" id="3281043">family</span><span class="op" id="3281049">)</span><span class="op" id="3281050">;</span>&nbsp;<span class="ident" id="3281052">err</span>&nbsp;<span class="op" id="3281056">!=</span>&nbsp;<span class="ident" id="3281059">nil</span>&nbsp;<span class="op" id="3281063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281068">return</span>&nbsp;<span class="ident" id="3281075">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3281081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281085">if</span>&nbsp;<span class="ident" id="3281088">err</span>&nbsp;<span class="op" id="3281092">:=</span>&nbsp;<span class="ident" id="3281095">fd</span><span class="op" id="3281097">.</span><span class="ident" id="3281098">connect</span><span class="op" id="3281105">(</span><span class="ident" id="3281106">lsa</span><span class="op" id="3281109">,</span>&nbsp;<span class="ident" id="3281111">rsa</span><span class="op" id="3281114">,</span>&nbsp;<span class="ident" id="3281116">deadline</span><span class="op" id="3281124">)</span><span class="op" id="3281125">;</span>&nbsp;<span class="ident" id="3281127">err</span>&nbsp;<span class="op" id="3281131">!=</span>&nbsp;<span class="ident" id="3281134">nil</span>&nbsp;<span class="op" id="3281138">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281143">return</span>&nbsp;<span class="ident" id="3281150">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3281156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3281160">fd</span><span class="op" id="3281162">.</span><span class="ident" id="3281163">isConnected</span>&nbsp;<span class="op" id="3281175">=</span>&nbsp;<span class="builtintype" id="3281177">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3281183">}</span>&nbsp;<span class="keyword" id="3281185">else</span>&nbsp;<span class="op" id="3281190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281194">if</span>&nbsp;<span class="ident" id="3281197">err</span>&nbsp;<span class="op" id="3281201">:=</span>&nbsp;<span class="ident" id="3281204">fd</span><span class="op" id="3281206">.</span><span class="ident" id="3281207">init</span><span class="op" id="3281211">(</span><span class="op" id="3281212">)</span><span class="op" id="3281213">;</span>&nbsp;<span class="ident" id="3281215">err</span>&nbsp;<span class="op" id="3281219">!=</span>&nbsp;<span class="ident" id="3281222">nil</span>&nbsp;<span class="op" id="3281226">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281231">return</span>&nbsp;<span class="ident" id="3281238">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3281244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3281247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3281250">lsa</span><span class="op" id="3281253">,</span>&nbsp;<span class="ident" id="3281255">_</span>&nbsp;<span class="op" id="3281257">=</span>&nbsp;<span class="ident" id="3281259">syscall</span><span class="op" id="3281266">.</span><span class="ident" id="3281267">Getsockname</span><span class="op" id="3281278">(</span><span class="ident" id="3281279">fd</span><span class="op" id="3281281">.</span><span class="ident" id="3281282">sysfd</span><span class="op" id="3281287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281290">if</span>&nbsp;<span class="ident" id="3281293">rsa</span><span class="op" id="3281296">,</span>&nbsp;<span class="ident" id="3281298">_</span>&nbsp;<span class="op" id="3281300">=</span>&nbsp;<span class="ident" id="3281302">syscall</span><span class="op" id="3281309">.</span><span class="ident" id="3281310">Getpeername</span><span class="op" id="3281321">(</span><span class="ident" id="3281322">fd</span><span class="op" id="3281324">.</span><span class="ident" id="3281325">sysfd</span><span class="op" id="3281330">)</span><span class="op" id="3281331">;</span>&nbsp;<span class="ident" id="3281333">rsa</span>&nbsp;<span class="op" id="3281337">!=</span>&nbsp;<span class="ident" id="3281340">nil</span>&nbsp;<span class="op" id="3281344">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3281348">fd</span><span class="op" id="3281350">.</span><span class="ident" id="3281351">setAddr</span><span class="op" id="3281358">(</span><span class="ident" id="3281359">fd</span><span class="op" id="3281361">.</span><span class="ident" id="3281362">addrFunc</span><span class="op" id="3281370">(</span><span class="op" id="3281371">)</span><span class="op" id="3281372">(</span><span class="ident" id="3281373">lsa</span><span class="op" id="3281376">)</span><span class="op" id="3281377">,</span>&nbsp;<span class="ident" id="3281379">fd</span><span class="op" id="3281381">.</span><span class="ident" id="3281382">addrFunc</span><span class="op" id="3281390">(</span><span class="op" id="3281391">)</span><span class="op" id="3281392">(</span><span class="ident" id="3281393">rsa</span><span class="op" id="3281396">)</span><span class="op" id="3281397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3281400">}</span>&nbsp;<span class="keyword" id="3281402">else</span>&nbsp;<span class="op" id="3281407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3281411">fd</span><span class="op" id="3281413">.</span><span class="ident" id="3281414">setAddr</span><span class="op" id="3281421">(</span><span class="ident" id="3281422">fd</span><span class="op" id="3281424">.</span><span class="ident" id="3281425">addrFunc</span><span class="op" id="3281433">(</span><span class="op" id="3281434">)</span><span class="op" id="3281435">(</span><span class="ident" id="3281436">lsa</span><span class="op" id="3281439">)</span><span class="op" id="3281440">,</span>&nbsp;<span class="ident" id="3281442">raddr</span><span class="op" id="3281447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3281450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281453">return</span>&nbsp;<span class="ident" id="3281460">nil</span><br>
<span class="lineno">155</span><span class="op" id="3281464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3281467">func</span>&nbsp;<span class="op" id="3281472">(</span><span class="ident" id="3281473">fd</span>&nbsp;<span class="op" id="3281476">*</span><span class="ident" id="3281477">netFD</span><span class="op" id="3281482">)</span>&nbsp;<span class="ident" id="3281484">listenStream</span><span class="op" id="3281496">(</span><span class="ident" id="3281497">laddr</span>&nbsp;<span class="ident" id="3281503">sockaddr</span><span class="op" id="3281511">,</span>&nbsp;<span class="ident" id="3281513">backlog</span>&nbsp;<span class="builtintype" id="3281521">int</span><span class="op" id="3281524">)</span>&nbsp;<span class="builtintype" id="3281526">error</span>&nbsp;<span class="op" id="3281532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281535">if</span>&nbsp;<span class="ident" id="3281538">err</span>&nbsp;<span class="op" id="3281542">:=</span>&nbsp;<span class="ident" id="3281545">setDefaultListenerSockopts</span><span class="op" id="3281571">(</span><span class="ident" id="3281572">fd</span><span class="op" id="3281574">.</span><span class="ident" id="3281575">sysfd</span><span class="op" id="3281580">)</span><span class="op" id="3281581">;</span>&nbsp;<span class="ident" id="3281583">err</span>&nbsp;<span class="op" id="3281587">!=</span>&nbsp;<span class="ident" id="3281590">nil</span>&nbsp;<span class="op" id="3281594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281598">return</span>&nbsp;<span class="ident" id="3281605">err</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3281610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281613">if</span>&nbsp;<span class="ident" id="3281616">lsa</span><span class="op" id="3281619">,</span>&nbsp;<span class="ident" id="3281621">err</span>&nbsp;<span class="op" id="3281625">:=</span>&nbsp;<span class="ident" id="3281628">laddr</span><span class="op" id="3281633">.</span><span class="ident" id="3281634">sockaddr</span><span class="op" id="3281642">(</span><span class="ident" id="3281643">fd</span><span class="op" id="3281645">.</span><span class="ident" id="3281646">family</span><span class="op" id="3281652">)</span><span class="op" id="3281653">;</span>&nbsp;<span class="ident" id="3281655">err</span>&nbsp;<span class="op" id="3281659">!=</span>&nbsp;<span class="ident" id="3281662">nil</span>&nbsp;<span class="op" id="3281666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281670">return</span>&nbsp;<span class="ident" id="3281677">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3281682">}</span>&nbsp;<span class="keyword" id="3281684">else</span>&nbsp;<span class="keyword" id="3281689">if</span>&nbsp;<span class="ident" id="3281692">lsa</span>&nbsp;<span class="op" id="3281696">!=</span>&nbsp;<span class="ident" id="3281699">nil</span>&nbsp;<span class="op" id="3281703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281707">if</span>&nbsp;<span class="ident" id="3281710">err</span>&nbsp;<span class="op" id="3281714">:=</span>&nbsp;<span class="ident" id="3281717">syscall</span><span class="op" id="3281724">.</span><span class="ident" id="3281725">Bind</span><span class="op" id="3281729">(</span><span class="ident" id="3281730">fd</span><span class="op" id="3281732">.</span><span class="ident" id="3281733">sysfd</span><span class="op" id="3281738">,</span>&nbsp;<span class="ident" id="3281740">lsa</span><span class="op" id="3281743">)</span><span class="op" id="3281744">;</span>&nbsp;<span class="ident" id="3281746">err</span>&nbsp;<span class="op" id="3281750">!=</span>&nbsp;<span class="ident" id="3281753">nil</span>&nbsp;<span class="op" id="3281757">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281762">return</span>&nbsp;<span class="ident" id="3281769">os</span><span class="op" id="3281771">.</span><span class="ident" id="3281772">NewSyscallError</span><span class="op" id="3281787">(</span><span class="string" id="3281788">&#34;bind&#34;</span><span class="op" id="3281794">,</span>&nbsp;<span class="ident" id="3281796">err</span><span class="op" id="3281799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3281803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3281806">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281809">if</span>&nbsp;<span class="ident" id="3281812">err</span>&nbsp;<span class="op" id="3281816">:=</span>&nbsp;<span class="ident" id="3281819">syscall</span><span class="op" id="3281826">.</span><span class="ident" id="3281827">Listen</span><span class="op" id="3281833">(</span><span class="ident" id="3281834">fd</span><span class="op" id="3281836">.</span><span class="ident" id="3281837">sysfd</span><span class="op" id="3281842">,</span>&nbsp;<span class="ident" id="3281844">backlog</span><span class="op" id="3281851">)</span><span class="op" id="3281852">;</span>&nbsp;<span class="ident" id="3281854">err</span>&nbsp;<span class="op" id="3281858">!=</span>&nbsp;<span class="ident" id="3281861">nil</span>&nbsp;<span class="op" id="3281865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281869">return</span>&nbsp;<span class="ident" id="3281876">os</span><span class="op" id="3281878">.</span><span class="ident" id="3281879">NewSyscallError</span><span class="op" id="3281894">(</span><span class="string" id="3281895">&#34;listen&#34;</span><span class="op" id="3281903">,</span>&nbsp;<span class="ident" id="3281905">err</span><span class="op" id="3281908">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3281911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281914">if</span>&nbsp;<span class="ident" id="3281917">err</span>&nbsp;<span class="op" id="3281921">:=</span>&nbsp;<span class="ident" id="3281924">fd</span><span class="op" id="3281926">.</span><span class="ident" id="3281927">init</span><span class="op" id="3281931">(</span><span class="op" id="3281932">)</span><span class="op" id="3281933">;</span>&nbsp;<span class="ident" id="3281935">err</span>&nbsp;<span class="op" id="3281939">!=</span>&nbsp;<span class="ident" id="3281942">nil</span>&nbsp;<span class="op" id="3281946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281950">return</span>&nbsp;<span class="ident" id="3281957">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3281962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3281965">lsa</span><span class="op" id="3281968">,</span>&nbsp;<span class="ident" id="3281970">_</span>&nbsp;<span class="op" id="3281972">:=</span>&nbsp;<span class="ident" id="3281975">syscall</span><span class="op" id="3281982">.</span><span class="ident" id="3281983">Getsockname</span><span class="op" id="3281994">(</span><span class="ident" id="3281995">fd</span><span class="op" id="3281997">.</span><span class="ident" id="3281998">sysfd</span><span class="op" id="3282003">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3282006">fd</span><span class="op" id="3282008">.</span><span class="ident" id="3282009">setAddr</span><span class="op" id="3282016">(</span><span class="ident" id="3282017">fd</span><span class="op" id="3282019">.</span><span class="ident" id="3282020">addrFunc</span><span class="op" id="3282028">(</span><span class="op" id="3282029">)</span><span class="op" id="3282030">(</span><span class="ident" id="3282031">lsa</span><span class="op" id="3282034">)</span><span class="op" id="3282035">,</span>&nbsp;<span class="ident" id="3282037">nil</span><span class="op" id="3282040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3282043">return</span>&nbsp;<span class="ident" id="3282050">nil</span><br>
<span class="lineno"></span><span class="op" id="3282054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3282057">func</span>&nbsp;<span class="op" id="3282062">(</span><span class="ident" id="3282063">fd</span>&nbsp;<span class="op" id="3282066">*</span><span class="ident" id="3282067">netFD</span><span class="op" id="3282072">)</span>&nbsp;<span class="ident" id="3282074">listenDatagram</span><span class="op" id="3282088">(</span><span class="ident" id="3282089">laddr</span>&nbsp;<span class="ident" id="3282095">sockaddr</span><span class="op" id="3282103">)</span>&nbsp;<span class="builtintype" id="3282105">error</span>&nbsp;<span class="op" id="3282111">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3282114">switch</span>&nbsp;<span class="ident" id="3282121">addr</span>&nbsp;<span class="op" id="3282126">:=</span>&nbsp;<span class="ident" id="3282129">laddr</span><span class="op" id="3282134">.</span><span class="op" id="3282135">(</span><span class="keyword" id="3282136">type</span><span class="op" id="3282140">)</span>&nbsp;<span class="op" id="3282142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3282145">case</span>&nbsp;<span class="op" id="3282150">*</span><span class="ident" id="3282151">UDPAddr</span><span class="op" id="3282158">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3282162">//&nbsp;We&nbsp;provide&nbsp;a&nbsp;socket&nbsp;that&nbsp;listens&nbsp;to&nbsp;a&nbsp;wildcard</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3282214">//&nbsp;address&nbsp;with&nbsp;reusable&nbsp;UDP&nbsp;port&nbsp;when&nbsp;the&nbsp;given&nbsp;laddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3282271">//&nbsp;is&nbsp;an&nbsp;appropriate&nbsp;UDP&nbsp;multicast&nbsp;address&nbsp;prefix.</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3282324">//&nbsp;This&nbsp;makes&nbsp;it&nbsp;possible&nbsp;for&nbsp;a&nbsp;single&nbsp;UDP&nbsp;listener&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3282381">//&nbsp;join&nbsp;multiple&nbsp;different&nbsp;group&nbsp;addresses,&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3282431">//&nbsp;multiple&nbsp;UDP&nbsp;listeners&nbsp;that&nbsp;listen&nbsp;on&nbsp;the&nbsp;same&nbsp;UDP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3282487">//&nbsp;port&nbsp;to&nbsp;join&nbsp;the&nbsp;same&nbsp;group&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3282529">if</span>&nbsp;<span class="ident" id="3282532">addr</span><span class="op" id="3282536">.</span><span class="ident" id="3282537">IP</span>&nbsp;<span class="op" id="3282540">!=</span>&nbsp;<span class="ident" id="3282543">nil</span>&nbsp;<span class="op" id="3282547">&amp;&amp;</span>&nbsp;<span class="ident" id="3282550">addr</span><span class="op" id="3282554">.</span><span class="ident" id="3282555">IP</span><span class="op" id="3282557">.</span><span class="ident" id="3282558">IsMulticast</span><span class="op" id="3282569">(</span><span class="op" id="3282570">)</span>&nbsp;<span class="op" id="3282572">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3282577">if</span>&nbsp;<span class="ident" id="3282580">err</span>&nbsp;<span class="op" id="3282584">:=</span>&nbsp;<span class="ident" id="3282587">setDefaultMulticastSockopts</span><span class="op" id="3282614">(</span><span class="ident" id="3282615">fd</span><span class="op" id="3282617">.</span><span class="ident" id="3282618">sysfd</span><span class="op" id="3282623">)</span><span class="op" id="3282624">;</span>&nbsp;<span class="ident" id="3282626">err</span>&nbsp;<span class="op" id="3282630">!=</span>&nbsp;<span class="ident" id="3282633">nil</span>&nbsp;<span class="op" id="3282637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3282643">return</span>&nbsp;<span class="ident" id="3282650">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3282657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3282662">addr</span>&nbsp;<span class="op" id="3282667">:=</span>&nbsp;<span class="op" id="3282670">*</span><span class="ident" id="3282671">addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3282679">switch</span>&nbsp;<span class="ident" id="3282686">fd</span><span class="op" id="3282688">.</span><span class="ident" id="3282689">family</span>&nbsp;<span class="op" id="3282696">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3282701">case</span>&nbsp;<span class="ident" id="3282706">syscall</span><span class="op" id="3282713">.</span><span class="ident" id="3282714">AF_INET</span><span class="op" id="3282721">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3282727">addr</span><span class="op" id="3282731">.</span><span class="ident" id="3282732">IP</span>&nbsp;<span class="op" id="3282735">=</span>&nbsp;<span class="ident" id="3282737">IPv4zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3282749">case</span>&nbsp;<span class="ident" id="3282754">syscall</span><span class="op" id="3282761">.</span><span class="ident" id="3282762">AF_INET6</span><span class="op" id="3282770">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3282776">addr</span><span class="op" id="3282780">.</span><span class="ident" id="3282781">IP</span>&nbsp;<span class="op" id="3282784">=</span>&nbsp;<span class="ident" id="3282786">IPv6unspecified</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3282805">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3282810">laddr</span>&nbsp;<span class="op" id="3282816">=</span>&nbsp;<span class="op" id="3282818">&amp;</span><span class="ident" id="3282819">addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3282826">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3282829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3282832">if</span>&nbsp;<span class="ident" id="3282835">lsa</span><span class="op" id="3282838">,</span>&nbsp;<span class="ident" id="3282840">err</span>&nbsp;<span class="op" id="3282844">:=</span>&nbsp;<span class="ident" id="3282847">laddr</span><span class="op" id="3282852">.</span><span class="ident" id="3282853">sockaddr</span><span class="op" id="3282861">(</span><span class="ident" id="3282862">fd</span><span class="op" id="3282864">.</span><span class="ident" id="3282865">family</span><span class="op" id="3282871">)</span><span class="op" id="3282872">;</span>&nbsp;<span class="ident" id="3282874">err</span>&nbsp;<span class="op" id="3282878">!=</span>&nbsp;<span class="ident" id="3282881">nil</span>&nbsp;<span class="op" id="3282885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3282889">return</span>&nbsp;<span class="ident" id="3282896">err</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3282901">}</span>&nbsp;<span class="keyword" id="3282903">else</span>&nbsp;<span class="keyword" id="3282908">if</span>&nbsp;<span class="ident" id="3282911">lsa</span>&nbsp;<span class="op" id="3282915">!=</span>&nbsp;<span class="ident" id="3282918">nil</span>&nbsp;<span class="op" id="3282922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3282926">if</span>&nbsp;<span class="ident" id="3282929">err</span>&nbsp;<span class="op" id="3282933">:=</span>&nbsp;<span class="ident" id="3282936">syscall</span><span class="op" id="3282943">.</span><span class="ident" id="3282944">Bind</span><span class="op" id="3282948">(</span><span class="ident" id="3282949">fd</span><span class="op" id="3282951">.</span><span class="ident" id="3282952">sysfd</span><span class="op" id="3282957">,</span>&nbsp;<span class="ident" id="3282959">lsa</span><span class="op" id="3282962">)</span><span class="op" id="3282963">;</span>&nbsp;<span class="ident" id="3282965">err</span>&nbsp;<span class="op" id="3282969">!=</span>&nbsp;<span class="ident" id="3282972">nil</span>&nbsp;<span class="op" id="3282976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3282981">return</span>&nbsp;<span class="ident" id="3282988">os</span><span class="op" id="3282990">.</span><span class="ident" id="3282991">NewSyscallError</span><span class="op" id="3283006">(</span><span class="string" id="3283007">&#34;bind&#34;</span><span class="op" id="3283013">,</span>&nbsp;<span class="ident" id="3283015">err</span><span class="op" id="3283018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3283022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3283025">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3283028">if</span>&nbsp;<span class="ident" id="3283031">err</span>&nbsp;<span class="op" id="3283035">:=</span>&nbsp;<span class="ident" id="3283038">fd</span><span class="op" id="3283040">.</span><span class="ident" id="3283041">init</span><span class="op" id="3283045">(</span><span class="op" id="3283046">)</span><span class="op" id="3283047">;</span>&nbsp;<span class="ident" id="3283049">err</span>&nbsp;<span class="op" id="3283053">!=</span>&nbsp;<span class="ident" id="3283056">nil</span>&nbsp;<span class="op" id="3283060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3283064">return</span>&nbsp;<span class="ident" id="3283071">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3283076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3283079">lsa</span><span class="op" id="3283082">,</span>&nbsp;<span class="ident" id="3283084">_</span>&nbsp;<span class="op" id="3283086">:=</span>&nbsp;<span class="ident" id="3283089">syscall</span><span class="op" id="3283096">.</span><span class="ident" id="3283097">Getsockname</span><span class="op" id="3283108">(</span><span class="ident" id="3283109">fd</span><span class="op" id="3283111">.</span><span class="ident" id="3283112">sysfd</span><span class="op" id="3283117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3283120">fd</span><span class="op" id="3283122">.</span><span class="ident" id="3283123">setAddr</span><span class="op" id="3283130">(</span><span class="ident" id="3283131">fd</span><span class="op" id="3283133">.</span><span class="ident" id="3283134">addrFunc</span><span class="op" id="3283142">(</span><span class="op" id="3283143">)</span><span class="op" id="3283144">(</span><span class="ident" id="3283145">lsa</span><span class="op" id="3283148">)</span><span class="op" id="3283149">,</span>&nbsp;<span class="ident" id="3283151">nil</span><span class="op" id="3283154">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3283157">return</span>&nbsp;<span class="ident" id="3283164">nil</span><br>
<span class="lineno"></span><span class="op" id="3283168">}</span>
</div>
</body>
</html>
