<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>database/sql</h2>
<ul>
<li><a href="/gostd/database/sql/convert.go.html">convert.go</a></li>
<li><a href="/gostd/database/sql/convert_test.go.html">convert_test.go</a></li>
<li><a href="/gostd/database/sql/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/database/sql/fakedb_test.go.html">fakedb_test.go</a></li>
<li><a href="/gostd/database/sql/sql.go.html">sql.go</a></li>
<li><a href="/gostd/database/sql/sql_test.go.html" class="current">sql_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7168856">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7168911">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7168965">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7169016">package</span>&nbsp;<span class="ident" id="7169024">sql</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7169029">import</span>&nbsp;<span class="op" id="7169036">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7169039">&#34;database/sql/driver&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7169062">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7169072">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7169079">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7169092">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7169103">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7169114">&#34;strings&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7169125">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7169133">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7169144">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7169151">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="7169154">func</span>&nbsp;<span class="ident" id="7169159">init</span><span class="op" id="7169163">(</span><span class="op" id="7169164">)</span>&nbsp;<span class="op" id="7169166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7169169">type</span>&nbsp;<span class="ident" id="7169174">dbConn</span>&nbsp;<span class="keyword" id="7169181">struct</span>&nbsp;<span class="op" id="7169188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7169192">db</span>&nbsp;<span class="op" id="7169195">*</span><span class="ident" id="7169196"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7169201">c</span>&nbsp;&nbsp;<span class="op" id="7169204">*</span><span class="ident" id="7169205"><a href="/gostd/database/sql/sql.go.html#5208150">driverConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7169217">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7169220">freedFrom</span>&nbsp;<span class="op" id="7169230">:=</span>&nbsp;<span class="builtinfunc" id="7169233">make</span><span class="op" id="7169237">(</span><span class="keyword" id="7169238">map</span><span class="op" id="7169241">[</span><span class="ident" id="7169242"><a href="/gostd/database/sql/sql_test.go.html#7169174">dbConn</a></span><span class="op" id="7169248">]</span><span class="builtintype" id="7169249">string</span><span class="op" id="7169255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7169258"><a href="/gostd/database/sql/sql.go.html#5220819">putConnHook</a></span>&nbsp;<span class="op" id="7169270">=</span>&nbsp;<span class="keyword" id="7169272">func</span><span class="op" id="7169276">(</span><span class="ident" id="7169277">db</span>&nbsp;<span class="op" id="7169280">*</span><span class="ident" id="7169281"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="7169283">,</span>&nbsp;<span class="ident" id="7169285">c</span>&nbsp;<span class="op" id="7169287">*</span><span class="ident" id="7169288"><a href="/gostd/database/sql/sql.go.html#5208150">driverConn</a></span><span class="op" id="7169298">)</span>&nbsp;<span class="op" id="7169300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7169304">idx</span>&nbsp;<span class="op" id="7169308">:=</span>&nbsp;<span class="op" id="7169311">-</span><span class="num" id="7169312">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7169316">for</span>&nbsp;<span class="ident" id="7169320">i</span><span class="op" id="7169321">,</span>&nbsp;<span class="ident" id="7169323">v</span>&nbsp;<span class="op" id="7169325">:=</span>&nbsp;<span class="keyword" id="7169328">range</span>&nbsp;<span class="ident" id="7169334"><a href="/gostd/database/sql/sql_test.go.html#7169277">db</a></span><span class="op" id="7169336">.</span><span class="ident" id="7169337"><a href="/gostd/database/sql/sql.go.html#5207263">freeConn</a></span>&nbsp;<span class="op" id="7169346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7169351">if</span>&nbsp;<span class="ident" id="7169354"><a href="/gostd/database/sql/sql_test.go.html#7169323">v</a></span>&nbsp;<span class="op" id="7169356">==</span>&nbsp;<span class="ident" id="7169359"><a href="/gostd/database/sql/sql_test.go.html#7169285">c</a></span>&nbsp;<span class="op" id="7169361">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7169367"><a href="/gostd/database/sql/sql_test.go.html#7169304">idx</a></span>&nbsp;<span class="op" id="7169371">=</span>&nbsp;<span class="ident" id="7169373"><a href="/gostd/database/sql/sql_test.go.html#7169320">i</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7169379">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7169388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7169392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7169396">if</span>&nbsp;<span class="ident" id="7169399"><a href="/gostd/database/sql/sql_test.go.html#7169304">idx</a></span>&nbsp;<span class="op" id="7169403">&gt;=</span>&nbsp;<span class="num" id="7169406">0</span>&nbsp;<span class="op" id="7169408">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7169413">//&nbsp;print&nbsp;before&nbsp;panic,&nbsp;as&nbsp;panic&nbsp;may&nbsp;get&nbsp;lost&nbsp;due&nbsp;to&nbsp;conflicting&nbsp;panic</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7169486">//&nbsp;(all&nbsp;goroutines&nbsp;asleep)&nbsp;elsewhere,&nbsp;since&nbsp;we&nbsp;might&nbsp;not&nbsp;unlock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7169553">//&nbsp;the&nbsp;mutex&nbsp;in&nbsp;freeConn&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7169587">println</span><span class="op" id="7169594">(</span><span class="string" id="7169595">&#34;double&nbsp;free&nbsp;of&nbsp;conn.&nbsp;conflicts&nbsp;are:\nA)&nbsp;&#34;</span>&nbsp;<span class="op" id="7169638">+</span>&nbsp;<span class="ident" id="7169640"><a href="/gostd/database/sql/sql_test.go.html#7169220">freedFrom</a></span><span class="op" id="7169649">[</span><span class="ident" id="7169650"><a href="/gostd/database/sql/sql_test.go.html#7169174">dbConn</a></span><span class="op" id="7169656">{</span><span class="ident" id="7169657"><a href="/gostd/database/sql/sql_test.go.html#7169277">db</a></span><span class="op" id="7169659">,</span>&nbsp;<span class="ident" id="7169661"><a href="/gostd/database/sql/sql_test.go.html#7169285">c</a></span><span class="op" id="7169662">}</span><span class="op" id="7169663">]</span>&nbsp;<span class="op" id="7169665">+</span>&nbsp;<span class="string" id="7169667">&#34;\n\nand\nB)&nbsp;&#34;</span>&nbsp;<span class="op" id="7169682">+</span>&nbsp;<span class="ident" id="7169684"><a href="/gostd/database/sql/sql.go.html#5247274">stack</a></span><span class="op" id="7169689">(</span><span class="op" id="7169690">)</span><span class="op" id="7169691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7169696">panic</span><span class="op" id="7169701">(</span><span class="string" id="7169702">&#34;double&nbsp;free&nbsp;of&nbsp;conn.&#34;</span><span class="op" id="7169724">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7169728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7169732"><a href="/gostd/database/sql/sql_test.go.html#7169220">freedFrom</a></span><span class="op" id="7169741">[</span><span class="ident" id="7169742"><a href="/gostd/database/sql/sql_test.go.html#7169174">dbConn</a></span><span class="op" id="7169748">{</span><span class="ident" id="7169749"><a href="/gostd/database/sql/sql_test.go.html#7169277">db</a></span><span class="op" id="7169751">,</span>&nbsp;<span class="ident" id="7169753"><a href="/gostd/database/sql/sql_test.go.html#7169285">c</a></span><span class="op" id="7169754">}</span><span class="op" id="7169755">]</span>&nbsp;<span class="op" id="7169757">=</span>&nbsp;<span class="ident" id="7169759"><a href="/gostd/database/sql/sql.go.html#5247274">stack</a></span><span class="op" id="7169764">(</span><span class="op" id="7169765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7169768">}</span><br>
<span class="lineno"></span><span class="op" id="7169770">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="7169773">const</span>&nbsp;<span class="ident" id="7169779">fakeDBName</span>&nbsp;<span class="op" id="7169790">=</span>&nbsp;<span class="string" id="7169792">&#34;foo&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7169799">var</span>&nbsp;<span class="ident" id="7169803">chrisBirthday</span>&nbsp;<span class="op" id="7169817">=</span>&nbsp;<span class="ident" id="7169819"><a href="/gostd/database/sql/sql_test.go.html#7169144">time</a></span><span class="op" id="7169823">.</span><span class="ident" id="7169824"><a href="/gostd/time/time.go.html#2748704">Unix</a></span><span class="op" id="7169828">(</span><span class="num" id="7169829">123456789</span><span class="op" id="7169838">,</span>&nbsp;<span class="num" id="7169840">0</span><span class="op" id="7169841">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7169844">func</span>&nbsp;<span class="ident" id="7169849">newTestDB</span><span class="op" id="7169858">(</span><span class="ident" id="7169859">t</span>&nbsp;<span class="ident" id="7169861"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7169868">.</span><span class="ident" id="7169869"><a href="/gostd/testing/testing.go.html#5476676">TB</a></span><span class="op" id="7169871">,</span>&nbsp;<span class="ident" id="7169873">name</span>&nbsp;<span class="builtintype" id="7169878">string</span><span class="op" id="7169884">)</span>&nbsp;<span class="op" id="7169886">*</span><span class="ident" id="7169887"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span>&nbsp;<span class="op" id="7169890">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7169893">db</span><span class="op" id="7169895">,</span>&nbsp;<span class="ident" id="7169897">err</span>&nbsp;<span class="op" id="7169901">:=</span>&nbsp;<span class="ident" id="7169904"><a href="/gostd/database/sql/sql.go.html#5213876">Open</a></span><span class="op" id="7169908">(</span><span class="string" id="7169909">&#34;test&#34;</span><span class="op" id="7169915">,</span>&nbsp;<span class="ident" id="7169917"><a href="/gostd/database/sql/sql_test.go.html#7169779">fakeDBName</a></span><span class="op" id="7169927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7169930">if</span>&nbsp;<span class="ident" id="7169933"><a href="/gostd/database/sql/sql_test.go.html#7169897">err</a></span>&nbsp;<span class="op" id="7169937">!=</span>&nbsp;<span class="builtintype" id="7169940">nil</span>&nbsp;<span class="op" id="7169944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7169948"><a href="/gostd/database/sql/sql_test.go.html#7169859">t</a></span><span class="op" id="7169949">.</span><span class="ident" id="7169950"><a href="/gostd/testing/testing.go.html#5476826">Fatalf</a></span><span class="op" id="7169956">(</span><span class="string" id="7169957">&#34;Open:&nbsp;%v&#34;</span><span class="op" id="7169967">,</span>&nbsp;<span class="ident" id="7169969"><a href="/gostd/database/sql/sql_test.go.html#7169897">err</a></span><span class="op" id="7169972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7169975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7169978">if</span>&nbsp;<span class="ident" id="7169981">_</span><span class="op" id="7169982">,</span>&nbsp;<span class="ident" id="7169984">err</span>&nbsp;<span class="op" id="7169988">:=</span>&nbsp;<span class="ident" id="7169991"><a href="/gostd/database/sql/sql_test.go.html#7169893">db</a></span><span class="op" id="7169993">.</span><span class="ident" id="7169994"><a href="/gostd/database/sql/sql.go.html#5224928">Exec</a></span><span class="op" id="7169998">(</span><span class="string" id="7169999">&#34;WIPE&#34;</span><span class="op" id="7170005">)</span><span class="op" id="7170006">;</span>&nbsp;<span class="ident" id="7170008"><a href="/gostd/database/sql/sql_test.go.html#7169984">err</a></span>&nbsp;<span class="op" id="7170012">!=</span>&nbsp;<span class="builtintype" id="7170015">nil</span>&nbsp;<span class="op" id="7170019">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7170023"><a href="/gostd/database/sql/sql_test.go.html#7169859">t</a></span><span class="op" id="7170024">.</span><span class="ident" id="7170025"><a href="/gostd/testing/testing.go.html#5476826">Fatalf</a></span><span class="op" id="7170031">(</span><span class="string" id="7170032">&#34;exec&nbsp;wipe:&nbsp;%v&#34;</span><span class="op" id="7170047">,</span>&nbsp;<span class="ident" id="7170049"><a href="/gostd/database/sql/sql_test.go.html#7169984">err</a></span><span class="op" id="7170052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7170055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7170058">if</span>&nbsp;<span class="ident" id="7170061"><a href="/gostd/database/sql/sql_test.go.html#7169873">name</a></span>&nbsp;<span class="op" id="7170066">==</span>&nbsp;<span class="string" id="7170069">&#34;people&#34;</span>&nbsp;<span class="op" id="7170078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7170082"><a href="/gostd/database/sql/sql_test.go.html#7170605">exec</a></span><span class="op" id="7170086">(</span><span class="ident" id="7170087"><a href="/gostd/database/sql/sql_test.go.html#7169859">t</a></span><span class="op" id="7170088">,</span>&nbsp;<span class="ident" id="7170090"><a href="/gostd/database/sql/sql_test.go.html#7169893">db</a></span><span class="op" id="7170092">,</span>&nbsp;<span class="string" id="7170094">&#34;CREATE|people|name=string,age=int32,photo=blob,dead=bool,bdate=datetime&#34;</span><span class="op" id="7170167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7170171"><a href="/gostd/database/sql/sql_test.go.html#7170605">exec</a></span><span class="op" id="7170175">(</span><span class="ident" id="7170176"><a href="/gostd/database/sql/sql_test.go.html#7169859">t</a></span><span class="op" id="7170177">,</span>&nbsp;<span class="ident" id="7170179"><a href="/gostd/database/sql/sql_test.go.html#7169893">db</a></span><span class="op" id="7170181">,</span>&nbsp;<span class="string" id="7170183">&#34;INSERT|people|name=Alice,age=?,photo=APHOTO&#34;</span><span class="op" id="7170228">,</span>&nbsp;<span class="num" id="7170230">1</span><span class="op" id="7170231">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7170235"><a href="/gostd/database/sql/sql_test.go.html#7170605">exec</a></span><span class="op" id="7170239">(</span><span class="ident" id="7170240"><a href="/gostd/database/sql/sql_test.go.html#7169859">t</a></span><span class="op" id="7170241">,</span>&nbsp;<span class="ident" id="7170243"><a href="/gostd/database/sql/sql_test.go.html#7169893">db</a></span><span class="op" id="7170245">,</span>&nbsp;<span class="string" id="7170247">&#34;INSERT|people|name=Bob,age=?,photo=BPHOTO&#34;</span><span class="op" id="7170290">,</span>&nbsp;<span class="num" id="7170292">2</span><span class="op" id="7170293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7170297"><a href="/gostd/database/sql/sql_test.go.html#7170605">exec</a></span><span class="op" id="7170301">(</span><span class="ident" id="7170302"><a href="/gostd/database/sql/sql_test.go.html#7169859">t</a></span><span class="op" id="7170303">,</span>&nbsp;<span class="ident" id="7170305"><a href="/gostd/database/sql/sql_test.go.html#7169893">db</a></span><span class="op" id="7170307">,</span>&nbsp;<span class="string" id="7170309">&#34;INSERT|people|name=Chris,age=?,photo=CPHOTO,bdate=?&#34;</span><span class="op" id="7170362">,</span>&nbsp;<span class="num" id="7170364">3</span><span class="op" id="7170365">,</span>&nbsp;<span class="ident" id="7170367"><a href="/gostd/database/sql/sql_test.go.html#7169803">chrisBirthday</a></span><span class="op" id="7170380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7170383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7170386">if</span>&nbsp;<span class="ident" id="7170389"><a href="/gostd/database/sql/sql_test.go.html#7169873">name</a></span>&nbsp;<span class="op" id="7170394">==</span>&nbsp;<span class="string" id="7170397">&#34;magicquery&#34;</span>&nbsp;<span class="op" id="7170410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7170414">//&nbsp;Magic&nbsp;table&nbsp;name&nbsp;and&nbsp;column,&nbsp;known&nbsp;by&nbsp;fakedb_test.go.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7170473"><a href="/gostd/database/sql/sql_test.go.html#7170605">exec</a></span><span class="op" id="7170477">(</span><span class="ident" id="7170478"><a href="/gostd/database/sql/sql_test.go.html#7169859">t</a></span><span class="op" id="7170479">,</span>&nbsp;<span class="ident" id="7170481"><a href="/gostd/database/sql/sql_test.go.html#7169893">db</a></span><span class="op" id="7170483">,</span>&nbsp;<span class="string" id="7170485">&#34;CREATE|magicquery|op=string,millis=int32&#34;</span><span class="op" id="7170527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7170531"><a href="/gostd/database/sql/sql_test.go.html#7170605">exec</a></span><span class="op" id="7170535">(</span><span class="ident" id="7170536"><a href="/gostd/database/sql/sql_test.go.html#7169859">t</a></span><span class="op" id="7170537">,</span>&nbsp;<span class="ident" id="7170539"><a href="/gostd/database/sql/sql_test.go.html#7169893">db</a></span><span class="op" id="7170541">,</span>&nbsp;<span class="string" id="7170543">&#34;INSERT|magicquery|op=sleep,millis=10&#34;</span><span class="op" id="7170581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7170584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7170587">return</span>&nbsp;<span class="ident" id="7170594"><a href="/gostd/database/sql/sql_test.go.html#7169893">db</a></span><br>
<span class="lineno"></span><span class="op" id="7170597">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="7170600">func</span>&nbsp;<span class="ident" id="7170605">exec</span><span class="op" id="7170609">(</span><span class="ident" id="7170610">t</span>&nbsp;<span class="ident" id="7170612"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7170619">.</span><span class="ident" id="7170620"><a href="/gostd/testing/testing.go.html#5476676">TB</a></span><span class="op" id="7170622">,</span>&nbsp;<span class="ident" id="7170624">db</span>&nbsp;<span class="op" id="7170627">*</span><span class="ident" id="7170628"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="7170630">,</span>&nbsp;<span class="ident" id="7170632">query</span>&nbsp;<span class="builtintype" id="7170638">string</span><span class="op" id="7170644">,</span>&nbsp;<span class="ident" id="7170646">args</span>&nbsp;<span class="op" id="7170651">...</span><span class="keyword" id="7170654">interface</span><span class="op" id="7170663">{</span><span class="op" id="7170664">}</span><span class="op" id="7170665">)</span>&nbsp;<span class="op" id="7170667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7170670">_</span><span class="op" id="7170671">,</span>&nbsp;<span class="ident" id="7170673">err</span>&nbsp;<span class="op" id="7170677">:=</span>&nbsp;<span class="ident" id="7170680"><a href="/gostd/database/sql/sql_test.go.html#7170624">db</a></span><span class="op" id="7170682">.</span><span class="ident" id="7170683"><a href="/gostd/database/sql/sql.go.html#5224928">Exec</a></span><span class="op" id="7170687">(</span><span class="ident" id="7170688"><a href="/gostd/database/sql/sql_test.go.html#7170632">query</a></span><span class="op" id="7170693">,</span>&nbsp;<span class="ident" id="7170695"><a href="/gostd/database/sql/sql_test.go.html#7170646">args</a></span><span class="op" id="7170699">...</span><span class="op" id="7170702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7170705">if</span>&nbsp;<span class="ident" id="7170708"><a href="/gostd/database/sql/sql_test.go.html#7170673">err</a></span>&nbsp;<span class="op" id="7170712">!=</span>&nbsp;<span class="builtintype" id="7170715">nil</span>&nbsp;<span class="op" id="7170719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7170723"><a href="/gostd/database/sql/sql_test.go.html#7170610">t</a></span><span class="op" id="7170724">.</span><span class="ident" id="7170725"><a href="/gostd/testing/testing.go.html#5476826">Fatalf</a></span><span class="op" id="7170731">(</span><span class="string" id="7170732">&#34;Exec&nbsp;of&nbsp;%q:&nbsp;%v&#34;</span><span class="op" id="7170748">,</span>&nbsp;<span class="ident" id="7170750"><a href="/gostd/database/sql/sql_test.go.html#7170632">query</a></span><span class="op" id="7170755">,</span>&nbsp;<span class="ident" id="7170757"><a href="/gostd/database/sql/sql_test.go.html#7170673">err</a></span><span class="op" id="7170760">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7170763">}</span><br>
<span class="lineno"></span><span class="op" id="7170765">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7170768">func</span>&nbsp;<span class="ident" id="7170773">closeDB</span><span class="op" id="7170780">(</span><span class="ident" id="7170781">t</span>&nbsp;<span class="ident" id="7170783"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7170790">.</span><span class="ident" id="7170791"><a href="/gostd/testing/testing.go.html#5476676">TB</a></span><span class="op" id="7170793">,</span>&nbsp;<span class="ident" id="7170795">db</span>&nbsp;<span class="op" id="7170798">*</span><span class="ident" id="7170799"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="7170801">)</span>&nbsp;<span class="op" id="7170803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7170806">if</span>&nbsp;<span class="ident" id="7170809">e</span>&nbsp;<span class="op" id="7170811">:=</span>&nbsp;<span class="builtinfunc" id="7170814">recover</span><span class="op" id="7170821">(</span><span class="op" id="7170822">)</span><span class="op" id="7170823">;</span>&nbsp;<span class="ident" id="7170825"><a href="/gostd/database/sql/sql_test.go.html#7170809">e</a></span>&nbsp;<span class="op" id="7170827">!=</span>&nbsp;<span class="builtintype" id="7170830">nil</span>&nbsp;<span class="op" id="7170834">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7170838"><a href="/gostd/database/sql/sql_test.go.html#7169072">fmt</a></span><span class="op" id="7170841">.</span><span class="ident" id="7170842"><a href="/gostd/fmt/print.go.html#2143442">Printf</a></span><span class="op" id="7170848">(</span><span class="string" id="7170849">&#34;Panic:&nbsp;%v\n&#34;</span><span class="op" id="7170862">,</span>&nbsp;<span class="ident" id="7170864"><a href="/gostd/database/sql/sql_test.go.html#7170809">e</a></span><span class="op" id="7170865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7170869">panic</span><span class="op" id="7170874">(</span><span class="ident" id="7170875"><a href="/gostd/database/sql/sql_test.go.html#7170809">e</a></span><span class="op" id="7170876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7170879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7170882">defer</span>&nbsp;<span class="ident" id="7170888"><a href="/gostd/database/sql/fakedb_test.go.html#7154130">setHookpostCloseConn</a></span><span class="op" id="7170908">(</span><span class="builtintype" id="7170909">nil</span><span class="op" id="7170912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7170915"><a href="/gostd/database/sql/fakedb_test.go.html#7154130">setHookpostCloseConn</a></span><span class="op" id="7170935">(</span><span class="keyword" id="7170936">func</span><span class="op" id="7170940">(</span><span class="ident" id="7170941">_</span>&nbsp;<span class="op" id="7170943">*</span><span class="ident" id="7170944"><a href="/gostd/database/sql/fakedb_test.go.html#7150186">fakeConn</a></span><span class="op" id="7170952">,</span>&nbsp;<span class="ident" id="7170954">err</span>&nbsp;<span class="builtintype" id="7170958">error</span><span class="op" id="7170963">)</span>&nbsp;<span class="op" id="7170965">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7170969">if</span>&nbsp;<span class="ident" id="7170972"><a href="/gostd/database/sql/sql_test.go.html#7170954">err</a></span>&nbsp;<span class="op" id="7170976">!=</span>&nbsp;<span class="builtintype" id="7170979">nil</span>&nbsp;<span class="op" id="7170983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7170988"><a href="/gostd/database/sql/sql_test.go.html#7170781">t</a></span><span class="op" id="7170989">.</span><span class="ident" id="7170990"><a href="/gostd/testing/testing.go.html#5476720">Errorf</a></span><span class="op" id="7170996">(</span><span class="string" id="7170997">&#34;Error&nbsp;closing&nbsp;fakeConn:&nbsp;%v&#34;</span><span class="op" id="7171025">,</span>&nbsp;<span class="ident" id="7171027"><a href="/gostd/database/sql/sql_test.go.html#7170954">err</a></span><span class="op" id="7171030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7171034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7171037">}</span><span class="op" id="7171038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7171041">for</span>&nbsp;<span class="ident" id="7171045">i</span><span class="op" id="7171046">,</span>&nbsp;<span class="ident" id="7171048">dc</span>&nbsp;<span class="op" id="7171051">:=</span>&nbsp;<span class="keyword" id="7171054">range</span>&nbsp;<span class="ident" id="7171060"><a href="/gostd/database/sql/sql_test.go.html#7170795">db</a></span><span class="op" id="7171062">.</span><span class="ident" id="7171063"><a href="/gostd/database/sql/sql.go.html#5207263">freeConn</a></span>&nbsp;<span class="op" id="7171072">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7171076">if</span>&nbsp;<span class="ident" id="7171079">n</span>&nbsp;<span class="op" id="7171081">:=</span>&nbsp;<span class="builtinfunc" id="7171084">len</span><span class="op" id="7171087">(</span><span class="ident" id="7171088"><a href="/gostd/database/sql/sql_test.go.html#7171048">dc</a></span><span class="op" id="7171090">.</span><span class="ident" id="7171091"><a href="/gostd/database/sql/sql.go.html#5208302">openStmt</a></span><span class="op" id="7171099">)</span><span class="op" id="7171100">;</span>&nbsp;<span class="ident" id="7171102"><a href="/gostd/database/sql/sql_test.go.html#7171079">n</a></span>&nbsp;<span class="op" id="7171104">&gt;</span>&nbsp;<span class="num" id="7171106">0</span>&nbsp;<span class="op" id="7171108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7171113">//&nbsp;Just&nbsp;a&nbsp;sanity&nbsp;check.&nbsp;This&nbsp;is&nbsp;legal&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7171157">//&nbsp;general,&nbsp;but&nbsp;if&nbsp;we&nbsp;make&nbsp;the&nbsp;tests&nbsp;clean&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7171206">//&nbsp;their&nbsp;statements&nbsp;first,&nbsp;then&nbsp;we&nbsp;can&nbsp;safely</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7171255">//&nbsp;verify&nbsp;this&nbsp;is&nbsp;always&nbsp;zero&nbsp;here,&nbsp;and&nbsp;any</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7171302">//&nbsp;other&nbsp;value&nbsp;is&nbsp;a&nbsp;leak.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7171331"><a href="/gostd/database/sql/sql_test.go.html#7170781">t</a></span><span class="op" id="7171332">.</span><span class="ident" id="7171333"><a href="/gostd/testing/testing.go.html#5476720">Errorf</a></span><span class="op" id="7171339">(</span><span class="string" id="7171340">&#34;while&nbsp;closing&nbsp;db,&nbsp;freeConn&nbsp;%d/%d&nbsp;had&nbsp;%d&nbsp;open&nbsp;stmts;&nbsp;want&nbsp;0&#34;</span><span class="op" id="7171400">,</span>&nbsp;<span class="ident" id="7171402"><a href="/gostd/database/sql/sql_test.go.html#7171045">i</a></span><span class="op" id="7171403">,</span>&nbsp;<span class="builtinfunc" id="7171405">len</span><span class="op" id="7171408">(</span><span class="ident" id="7171409"><a href="/gostd/database/sql/sql_test.go.html#7170795">db</a></span><span class="op" id="7171411">.</span><span class="ident" id="7171412"><a href="/gostd/database/sql/sql.go.html#5207263">freeConn</a></span><span class="op" id="7171420">)</span><span class="op" id="7171421">,</span>&nbsp;<span class="ident" id="7171423"><a href="/gostd/database/sql/sql_test.go.html#7171079">n</a></span><span class="op" id="7171424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7171428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7171431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7171434">err</span>&nbsp;<span class="op" id="7171438">:=</span>&nbsp;<span class="ident" id="7171441"><a href="/gostd/database/sql/sql_test.go.html#7170795">db</a></span><span class="op" id="7171443">.</span><span class="ident" id="7171444"><a href="/gostd/database/sql/sql.go.html#5214824">Close</a></span><span class="op" id="7171449">(</span><span class="op" id="7171450">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7171453">if</span>&nbsp;<span class="ident" id="7171456"><a href="/gostd/database/sql/sql_test.go.html#7171434">err</a></span>&nbsp;<span class="op" id="7171460">!=</span>&nbsp;<span class="builtintype" id="7171463">nil</span>&nbsp;<span class="op" id="7171467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7171471"><a href="/gostd/database/sql/sql_test.go.html#7170781">t</a></span><span class="op" id="7171472">.</span><span class="ident" id="7171473"><a href="/gostd/testing/testing.go.html#5476826">Fatalf</a></span><span class="op" id="7171479">(</span><span class="string" id="7171480">&#34;error&nbsp;closing&nbsp;DB:&nbsp;%v&#34;</span><span class="op" id="7171502">,</span>&nbsp;<span class="ident" id="7171504"><a href="/gostd/database/sql/sql_test.go.html#7171434">err</a></span><span class="op" id="7171507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7171510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7171513"><a href="/gostd/database/sql/sql_test.go.html#7170795">db</a></span><span class="op" id="7171515">.</span><span class="ident" id="7171516"><a href="/gostd/database/sql/sql.go.html#5207209">mu</a></span><span class="op" id="7171518">.</span><span class="ident" id="7171519"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="7171523">(</span><span class="op" id="7171524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7171527">count</span>&nbsp;<span class="op" id="7171533">:=</span>&nbsp;<span class="ident" id="7171536"><a href="/gostd/database/sql/sql_test.go.html#7170795">db</a></span><span class="op" id="7171538">.</span><span class="ident" id="7171539"><a href="/gostd/database/sql/sql.go.html#5207324">numOpen</a></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7171548"><a href="/gostd/database/sql/sql_test.go.html#7170795">db</a></span><span class="op" id="7171550">.</span><span class="ident" id="7171551"><a href="/gostd/database/sql/sql.go.html#5207209">mu</a></span><span class="op" id="7171553">.</span><span class="ident" id="7171554"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="7171560">(</span><span class="op" id="7171561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7171564">if</span>&nbsp;<span class="ident" id="7171567"><a href="/gostd/database/sql/sql_test.go.html#7171527">count</a></span>&nbsp;<span class="op" id="7171573">!=</span>&nbsp;<span class="num" id="7171576">0</span>&nbsp;<span class="op" id="7171578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7171582"><a href="/gostd/database/sql/sql_test.go.html#7170781">t</a></span><span class="op" id="7171583">.</span><span class="ident" id="7171584"><a href="/gostd/testing/testing.go.html#5476826">Fatalf</a></span><span class="op" id="7171590">(</span><span class="string" id="7171591">&#34;%d&nbsp;connections&nbsp;still&nbsp;open&nbsp;after&nbsp;closing&nbsp;DB&#34;</span><span class="op" id="7171635">,</span>&nbsp;<span class="ident" id="7171637"><a href="/gostd/database/sql/sql_test.go.html#7170795">db</a></span><span class="op" id="7171639">.</span><span class="ident" id="7171640"><a href="/gostd/database/sql/sql.go.html#5207324">numOpen</a></span><span class="op" id="7171647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7171650">}</span><br>
<span class="lineno"></span><span class="op" id="7171652">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="7171655">//&nbsp;numPrepares&nbsp;assumes&nbsp;that&nbsp;db&nbsp;has&nbsp;exactly&nbsp;1&nbsp;idle&nbsp;conn&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="7171722">//&nbsp;its&nbsp;count&nbsp;of&nbsp;calls&nbsp;to&nbsp;Prepare</span><br>
<span class="lineno"></span><span class="keyword" id="7171755">func</span>&nbsp;<span class="ident" id="7171760">numPrepares</span><span class="op" id="7171771">(</span><span class="ident" id="7171772">t</span>&nbsp;<span class="op" id="7171774">*</span><span class="ident" id="7171775"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7171782">.</span><span class="ident" id="7171783"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7171784">,</span>&nbsp;<span class="ident" id="7171786">db</span>&nbsp;<span class="op" id="7171789">*</span><span class="ident" id="7171790"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="7171792">)</span>&nbsp;<span class="builtintype" id="7171794">int</span>&nbsp;<span class="op" id="7171798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7171801">if</span>&nbsp;<span class="ident" id="7171804">n</span>&nbsp;<span class="op" id="7171806">:=</span>&nbsp;<span class="builtinfunc" id="7171809">len</span><span class="op" id="7171812">(</span><span class="ident" id="7171813"><a href="/gostd/database/sql/sql_test.go.html#7171786">db</a></span><span class="op" id="7171815">.</span><span class="ident" id="7171816"><a href="/gostd/database/sql/sql.go.html#5207263">freeConn</a></span><span class="op" id="7171824">)</span><span class="op" id="7171825">;</span>&nbsp;<span class="ident" id="7171827"><a href="/gostd/database/sql/sql_test.go.html#7171804">n</a></span>&nbsp;<span class="op" id="7171829">!=</span>&nbsp;<span class="num" id="7171832">1</span>&nbsp;<span class="op" id="7171834">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7171838"><a href="/gostd/database/sql/sql_test.go.html#7171772">t</a></span><span class="op" id="7171839">.</span><span class="ident" id="7171840"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7171846">(</span><span class="string" id="7171847">&#34;free&nbsp;conns&nbsp;=&nbsp;%d;&nbsp;want&nbsp;1&#34;</span><span class="op" id="7171872">,</span>&nbsp;<span class="ident" id="7171874"><a href="/gostd/database/sql/sql_test.go.html#7171804">n</a></span><span class="op" id="7171875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7171878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7171881">return</span>&nbsp;<span class="ident" id="7171888"><a href="/gostd/database/sql/sql_test.go.html#7171786">db</a></span><span class="op" id="7171890">.</span><span class="ident" id="7171891"><a href="/gostd/database/sql/sql.go.html#5207263">freeConn</a></span><span class="op" id="7171899">[</span><span class="num" id="7171900">0</span><span class="op" id="7171901">]</span><span class="op" id="7171902">.</span><span class="ident" id="7171903"><a href="/gostd/database/sql/sql.go.html#5208213">ci</a></span><span class="op" id="7171905">.</span><span class="op" id="7171906">(</span><span class="op" id="7171907">*</span><span class="ident" id="7171908"><a href="/gostd/database/sql/fakedb_test.go.html#7150186">fakeConn</a></span><span class="op" id="7171916">)</span><span class="op" id="7171917">.</span><span class="ident" id="7171918"><a href="/gostd/database/sql/fakedb_test.go.html#7150346">numPrepare</a></span><br>
<span class="lineno"></span><span class="op" id="7171929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="7171932">func</span>&nbsp;<span class="op" id="7171937">(</span><span class="ident" id="7171938">db</span>&nbsp;<span class="op" id="7171941">*</span><span class="ident" id="7171942"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="7171944">)</span>&nbsp;<span class="ident" id="7171946">numDeps</span><span class="op" id="7171953">(</span><span class="op" id="7171954">)</span>&nbsp;<span class="builtintype" id="7171956">int</span>&nbsp;<span class="op" id="7171960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7171963"><a href="/gostd/database/sql/sql_test.go.html#7171938">db</a></span><span class="op" id="7171965">.</span><span class="ident" id="7171966"><a href="/gostd/database/sql/sql.go.html#5207209">mu</a></span><span class="op" id="7171968">.</span><span class="ident" id="7171969"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="7171973">(</span><span class="op" id="7171974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7171977">defer</span>&nbsp;<span class="ident" id="7171983"><a href="/gostd/database/sql/sql_test.go.html#7171938">db</a></span><span class="op" id="7171985">.</span><span class="ident" id="7171986"><a href="/gostd/database/sql/sql.go.html#5207209">mu</a></span><span class="op" id="7171988">.</span><span class="ident" id="7171989"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="7171995">(</span><span class="op" id="7171996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7171999">return</span>&nbsp;<span class="builtinfunc" id="7172006">len</span><span class="op" id="7172009">(</span><span class="ident" id="7172010"><a href="/gostd/database/sql/sql_test.go.html#7171938">db</a></span><span class="op" id="7172012">.</span><span class="ident" id="7172013"><a href="/gostd/database/sql/sql.go.html#5207688">dep</a></span><span class="op" id="7172016">)</span><br>
<span class="lineno"></span><span class="op" id="7172018">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="comment" id="7172021">//&nbsp;Dependencies&nbsp;are&nbsp;closed&nbsp;via&nbsp;a&nbsp;goroutine,&nbsp;so&nbsp;this&nbsp;polls&nbsp;waiting&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="7172091">//&nbsp;numDeps&nbsp;to&nbsp;fall&nbsp;to&nbsp;want,&nbsp;waiting&nbsp;up&nbsp;to&nbsp;d.</span><br>
<span class="lineno"></span><span class="keyword" id="7172136">func</span>&nbsp;<span class="op" id="7172141">(</span><span class="ident" id="7172142">db</span>&nbsp;<span class="op" id="7172145">*</span><span class="ident" id="7172146"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="7172148">)</span>&nbsp;<span class="ident" id="7172150">numDepsPollUntil</span><span class="op" id="7172166">(</span><span class="ident" id="7172167">want</span>&nbsp;<span class="builtintype" id="7172172">int</span><span class="op" id="7172175">,</span>&nbsp;<span class="ident" id="7172177">d</span>&nbsp;<span class="ident" id="7172179"><a href="/gostd/database/sql/sql_test.go.html#7169144">time</a></span><span class="op" id="7172183">.</span><span class="ident" id="7172184"><a href="/gostd/time/time.go.html#2734212">Duration</a></span><span class="op" id="7172192">)</span>&nbsp;<span class="builtintype" id="7172194">int</span>&nbsp;<span class="op" id="7172198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7172201">deadline</span>&nbsp;<span class="op" id="7172210">:=</span>&nbsp;<span class="ident" id="7172213"><a href="/gostd/database/sql/sql_test.go.html#7169144">time</a></span><span class="op" id="7172217">.</span><span class="ident" id="7172218"><a href="/gostd/time/time.go.html#2743088">Now</a></span><span class="op" id="7172221">(</span><span class="op" id="7172222">)</span><span class="op" id="7172223">.</span><span class="ident" id="7172224"><a href="/gostd/time/time.go.html#2738615">Add</a></span><span class="op" id="7172227">(</span><span class="ident" id="7172228"><a href="/gostd/database/sql/sql_test.go.html#7172177">d</a></span><span class="op" id="7172229">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7172232">for</span>&nbsp;<span class="op" id="7172236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7172240">n</span>&nbsp;<span class="op" id="7172242">:=</span>&nbsp;<span class="ident" id="7172245"><a href="/gostd/database/sql/sql_test.go.html#7172142">db</a></span><span class="op" id="7172247">.</span><span class="ident" id="7172248"><a href="/gostd/database/sql/sql_test.go.html#7171946">numDeps</a></span><span class="op" id="7172255">(</span><span class="op" id="7172256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7172260">if</span>&nbsp;<span class="ident" id="7172263"><a href="/gostd/database/sql/sql_test.go.html#7172240">n</a></span>&nbsp;<span class="op" id="7172265">&lt;=</span>&nbsp;<span class="ident" id="7172268"><a href="/gostd/database/sql/sql_test.go.html#7172167">want</a></span>&nbsp;<span class="op" id="7172273">||</span>&nbsp;<span class="ident" id="7172276"><a href="/gostd/database/sql/sql_test.go.html#7169144">time</a></span><span class="op" id="7172280">.</span><span class="ident" id="7172281"><a href="/gostd/time/time.go.html#2743088">Now</a></span><span class="op" id="7172284">(</span><span class="op" id="7172285">)</span><span class="op" id="7172286">.</span><span class="ident" id="7172287"><a href="/gostd/time/time.go.html#2722668">After</a></span><span class="op" id="7172292">(</span><span class="ident" id="7172293"><a href="/gostd/database/sql/sql_test.go.html#7172201">deadline</a></span><span class="op" id="7172301">)</span>&nbsp;<span class="op" id="7172303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7172308">return</span>&nbsp;<span class="ident" id="7172315"><a href="/gostd/database/sql/sql_test.go.html#7172240">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7172319">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7172323"><a href="/gostd/database/sql/sql_test.go.html#7169144">time</a></span><span class="op" id="7172327">.</span><span class="ident" id="7172328"><a href="/gostd/time/sleep.go.html#2713940">Sleep</a></span><span class="op" id="7172333">(</span><span class="num" id="7172334">50</span>&nbsp;<span class="op" id="7172337">*</span>&nbsp;<span class="ident" id="7172339"><a href="/gostd/database/sql/sql_test.go.html#7169144">time</a></span><span class="op" id="7172343">.</span><span class="ident" id="7172344"><a href="/gostd/time/time.go.html#2734819">Millisecond</a></span><span class="op" id="7172355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7172358">}</span><br>
<span class="lineno"></span><span class="op" id="7172360">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7172363">func</span>&nbsp;<span class="op" id="7172368">(</span><span class="ident" id="7172369">db</span>&nbsp;<span class="op" id="7172372">*</span><span class="ident" id="7172373"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="7172375">)</span>&nbsp;<span class="ident" id="7172377">numFreeConns</span><span class="op" id="7172389">(</span><span class="op" id="7172390">)</span>&nbsp;<span class="builtintype" id="7172392">int</span>&nbsp;<span class="op" id="7172396">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7172399"><a href="/gostd/database/sql/sql_test.go.html#7172369">db</a></span><span class="op" id="7172401">.</span><span class="ident" id="7172402"><a href="/gostd/database/sql/sql.go.html#5207209">mu</a></span><span class="op" id="7172404">.</span><span class="ident" id="7172405"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="7172409">(</span><span class="op" id="7172410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7172413">defer</span>&nbsp;<span class="ident" id="7172419"><a href="/gostd/database/sql/sql_test.go.html#7172369">db</a></span><span class="op" id="7172421">.</span><span class="ident" id="7172422"><a href="/gostd/database/sql/sql.go.html#5207209">mu</a></span><span class="op" id="7172424">.</span><span class="ident" id="7172425"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="7172431">(</span><span class="op" id="7172432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7172435">return</span>&nbsp;<span class="builtinfunc" id="7172442">len</span><span class="op" id="7172445">(</span><span class="ident" id="7172446"><a href="/gostd/database/sql/sql_test.go.html#7172369">db</a></span><span class="op" id="7172448">.</span><span class="ident" id="7172449"><a href="/gostd/database/sql/sql.go.html#5207263">freeConn</a></span><span class="op" id="7172457">)</span><br>
<span class="lineno"></span><span class="op" id="7172459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="keyword" id="7172462">func</span>&nbsp;<span class="op" id="7172467">(</span><span class="ident" id="7172468">db</span>&nbsp;<span class="op" id="7172471">*</span><span class="ident" id="7172472"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="7172474">)</span>&nbsp;<span class="ident" id="7172476">dumpDeps</span><span class="op" id="7172484">(</span><span class="ident" id="7172485">t</span>&nbsp;<span class="op" id="7172487">*</span><span class="ident" id="7172488"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7172495">.</span><span class="ident" id="7172496"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7172497">)</span>&nbsp;<span class="op" id="7172499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7172502">for</span>&nbsp;<span class="ident" id="7172506">fc</span>&nbsp;<span class="op" id="7172509">:=</span>&nbsp;<span class="keyword" id="7172512">range</span>&nbsp;<span class="ident" id="7172518"><a href="/gostd/database/sql/sql_test.go.html#7172468">db</a></span><span class="op" id="7172520">.</span><span class="ident" id="7172521"><a href="/gostd/database/sql/sql.go.html#5207688">dep</a></span>&nbsp;<span class="op" id="7172525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7172529"><a href="/gostd/database/sql/sql_test.go.html#7172468">db</a></span><span class="op" id="7172531">.</span><span class="ident" id="7172532"><a href="/gostd/database/sql/sql_test.go.html#7172594">dumpDep</a></span><span class="op" id="7172539">(</span><span class="ident" id="7172540"><a href="/gostd/database/sql/sql_test.go.html#7172485">t</a></span><span class="op" id="7172541">,</span>&nbsp;<span class="num" id="7172543">0</span><span class="op" id="7172544">,</span>&nbsp;<span class="ident" id="7172546"><a href="/gostd/database/sql/sql_test.go.html#7172506">fc</a></span><span class="op" id="7172548">,</span>&nbsp;<span class="keyword" id="7172550">map</span><span class="op" id="7172553">[</span><span class="ident" id="7172554"><a href="/gostd/database/sql/sql.go.html#5211021">finalCloser</a></span><span class="op" id="7172565">]</span><span class="builtintype" id="7172566">bool</span><span class="op" id="7172570">{</span><span class="op" id="7172571">}</span><span class="op" id="7172572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7172575">}</span><br>
<span class="lineno"></span><span class="op" id="7172577">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="keyword" id="7172580">func</span>&nbsp;<span class="op" id="7172585">(</span><span class="ident" id="7172586">db</span>&nbsp;<span class="op" id="7172589">*</span><span class="ident" id="7172590"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="7172592">)</span>&nbsp;<span class="ident" id="7172594">dumpDep</span><span class="op" id="7172601">(</span><span class="ident" id="7172602">t</span>&nbsp;<span class="op" id="7172604">*</span><span class="ident" id="7172605"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7172612">.</span><span class="ident" id="7172613"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7172614">,</span>&nbsp;<span class="ident" id="7172616">depth</span>&nbsp;<span class="builtintype" id="7172622">int</span><span class="op" id="7172625">,</span>&nbsp;<span class="ident" id="7172627">dep</span>&nbsp;<span class="ident" id="7172631"><a href="/gostd/database/sql/sql.go.html#5211021">finalCloser</a></span><span class="op" id="7172642">,</span>&nbsp;<span class="ident" id="7172644">seen</span>&nbsp;<span class="keyword" id="7172649">map</span><span class="op" id="7172652">[</span><span class="ident" id="7172653"><a href="/gostd/database/sql/sql.go.html#5211021">finalCloser</a></span><span class="op" id="7172664">]</span><span class="builtintype" id="7172665">bool</span><span class="op" id="7172669">)</span>&nbsp;<span class="op" id="7172671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7172674"><a href="/gostd/database/sql/sql_test.go.html#7172644">seen</a></span><span class="op" id="7172678">[</span><span class="ident" id="7172679"><a href="/gostd/database/sql/sql_test.go.html#7172627">dep</a></span><span class="op" id="7172682">]</span>&nbsp;<span class="op" id="7172684">=</span>&nbsp;<span class="builtintype" id="7172686">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7172692">indent</span>&nbsp;<span class="op" id="7172699">:=</span>&nbsp;<span class="ident" id="7172702"><a href="/gostd/database/sql/sql_test.go.html#7169114">strings</a></span><span class="op" id="7172709">.</span><span class="ident" id="7172710"><a href="/gostd/strings/strings.go.html#2976882">Repeat</a></span><span class="op" id="7172716">(</span><span class="string" id="7172717">&#34;&nbsp;&nbsp;&#34;</span><span class="op" id="7172721">,</span>&nbsp;<span class="ident" id="7172723"><a href="/gostd/database/sql/sql_test.go.html#7172616">depth</a></span><span class="op" id="7172728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7172731">ds</span>&nbsp;<span class="op" id="7172734">:=</span>&nbsp;<span class="ident" id="7172737"><a href="/gostd/database/sql/sql_test.go.html#7172586">db</a></span><span class="op" id="7172739">.</span><span class="ident" id="7172740"><a href="/gostd/database/sql/sql.go.html#5207688">dep</a></span><span class="op" id="7172743">[</span><span class="ident" id="7172744"><a href="/gostd/database/sql/sql_test.go.html#7172627">dep</a></span><span class="op" id="7172747">]</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7172750">for</span>&nbsp;<span class="ident" id="7172754">k</span>&nbsp;<span class="op" id="7172756">:=</span>&nbsp;<span class="keyword" id="7172759">range</span>&nbsp;<span class="ident" id="7172765"><a href="/gostd/database/sql/sql_test.go.html#7172731">ds</a></span>&nbsp;<span class="op" id="7172768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7172772"><a href="/gostd/database/sql/sql_test.go.html#7172602">t</a></span><span class="op" id="7172773">.</span><span class="ident" id="7172774"><a href="/gostd/testing/testing.go.html#5479816">Logf</a></span><span class="op" id="7172778">(</span><span class="string" id="7172779">&#34;%s%T&nbsp;(%p)&nbsp;waiting&nbsp;for&nbsp;-&gt;&nbsp;%T&nbsp;(%p)&#34;</span><span class="op" id="7172813">,</span>&nbsp;<span class="ident" id="7172815"><a href="/gostd/database/sql/sql_test.go.html#7172692">indent</a></span><span class="op" id="7172821">,</span>&nbsp;<span class="ident" id="7172823"><a href="/gostd/database/sql/sql_test.go.html#7172627">dep</a></span><span class="op" id="7172826">,</span>&nbsp;<span class="ident" id="7172828"><a href="/gostd/database/sql/sql_test.go.html#7172627">dep</a></span><span class="op" id="7172831">,</span>&nbsp;<span class="ident" id="7172833"><a href="/gostd/database/sql/sql_test.go.html#7172754">k</a></span><span class="op" id="7172834">,</span>&nbsp;<span class="ident" id="7172836"><a href="/gostd/database/sql/sql_test.go.html#7172754">k</a></span><span class="op" id="7172837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7172841">if</span>&nbsp;<span class="ident" id="7172844">fc</span><span class="op" id="7172846">,</span>&nbsp;<span class="ident" id="7172848">ok</span>&nbsp;<span class="op" id="7172851">:=</span>&nbsp;<span class="ident" id="7172854"><a href="/gostd/database/sql/sql_test.go.html#7172754">k</a></span><span class="op" id="7172855">.</span><span class="op" id="7172856">(</span><span class="ident" id="7172857"><a href="/gostd/database/sql/sql.go.html#5211021">finalCloser</a></span><span class="op" id="7172868">)</span><span class="op" id="7172869">;</span>&nbsp;<span class="ident" id="7172871"><a href="/gostd/database/sql/sql_test.go.html#7172848">ok</a></span>&nbsp;<span class="op" id="7172874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7172879">if</span>&nbsp;<span class="op" id="7172882">!</span><span class="ident" id="7172883"><a href="/gostd/database/sql/sql_test.go.html#7172644">seen</a></span><span class="op" id="7172887">[</span><span class="ident" id="7172888"><a href="/gostd/database/sql/sql_test.go.html#7172844">fc</a></span><span class="op" id="7172890">]</span>&nbsp;<span class="op" id="7172892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7172898"><a href="/gostd/database/sql/sql_test.go.html#7172586">db</a></span><span class="op" id="7172900">.</span><span class="ident" id="7172901"><a href="/gostd/database/sql/sql_test.go.html#7172594">dumpDep</a></span><span class="op" id="7172908">(</span><span class="ident" id="7172909"><a href="/gostd/database/sql/sql_test.go.html#7172602">t</a></span><span class="op" id="7172910">,</span>&nbsp;<span class="ident" id="7172912"><a href="/gostd/database/sql/sql_test.go.html#7172616">depth</a></span><span class="op" id="7172917">+</span><span class="num" id="7172918">1</span><span class="op" id="7172919">,</span>&nbsp;<span class="ident" id="7172921"><a href="/gostd/database/sql/sql_test.go.html#7172844">fc</a></span><span class="op" id="7172923">,</span>&nbsp;<span class="ident" id="7172925"><a href="/gostd/database/sql/sql_test.go.html#7172644">seen</a></span><span class="op" id="7172929">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7172934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7172938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7172941">}</span><br>
<span class="lineno"></span><span class="op" id="7172943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="keyword" id="7172946">func</span>&nbsp;<span class="ident" id="7172951">TestQuery</span><span class="op" id="7172960">(</span><span class="ident" id="7172961">t</span>&nbsp;<span class="op" id="7172963">*</span><span class="ident" id="7172964"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7172971">.</span><span class="ident" id="7172972"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7172973">)</span>&nbsp;<span class="op" id="7172975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7172978">db</span>&nbsp;<span class="op" id="7172981">:=</span>&nbsp;<span class="ident" id="7172984"><a href="/gostd/database/sql/sql_test.go.html#7169849">newTestDB</a></span><span class="op" id="7172993">(</span><span class="ident" id="7172994"><a href="/gostd/database/sql/sql_test.go.html#7172961">t</a></span><span class="op" id="7172995">,</span>&nbsp;<span class="string" id="7172997">&#34;people&#34;</span><span class="op" id="7173005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7173008">defer</span>&nbsp;<span class="ident" id="7173014"><a href="/gostd/database/sql/sql_test.go.html#7170773">closeDB</a></span><span class="op" id="7173021">(</span><span class="ident" id="7173022"><a href="/gostd/database/sql/sql_test.go.html#7172961">t</a></span><span class="op" id="7173023">,</span>&nbsp;<span class="ident" id="7173025"><a href="/gostd/database/sql/sql_test.go.html#7172978">db</a></span><span class="op" id="7173027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7173030">prepares0</span>&nbsp;<span class="op" id="7173040">:=</span>&nbsp;<span class="ident" id="7173043"><a href="/gostd/database/sql/sql_test.go.html#7171760">numPrepares</a></span><span class="op" id="7173054">(</span><span class="ident" id="7173055"><a href="/gostd/database/sql/sql_test.go.html#7172961">t</a></span><span class="op" id="7173056">,</span>&nbsp;<span class="ident" id="7173058"><a href="/gostd/database/sql/sql_test.go.html#7172978">db</a></span><span class="op" id="7173060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7173063">rows</span><span class="op" id="7173067">,</span>&nbsp;<span class="ident" id="7173069">err</span>&nbsp;<span class="op" id="7173073">:=</span>&nbsp;<span class="ident" id="7173076"><a href="/gostd/database/sql/sql_test.go.html#7172978">db</a></span><span class="op" id="7173078">.</span><span class="ident" id="7173079"><a href="/gostd/database/sql/sql.go.html#5225993">Query</a></span><span class="op" id="7173084">(</span><span class="string" id="7173085">&#34;SELECT|people|age,name|&#34;</span><span class="op" id="7173110">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7173113">if</span>&nbsp;<span class="ident" id="7173116"><a href="/gostd/database/sql/sql_test.go.html#7173069">err</a></span>&nbsp;<span class="op" id="7173120">!=</span>&nbsp;<span class="builtintype" id="7173123">nil</span>&nbsp;<span class="op" id="7173127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7173131"><a href="/gostd/database/sql/sql_test.go.html#7172961">t</a></span><span class="op" id="7173132">.</span><span class="ident" id="7173133"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7173139">(</span><span class="string" id="7173140">&#34;Query:&nbsp;%v&#34;</span><span class="op" id="7173151">,</span>&nbsp;<span class="ident" id="7173153"><a href="/gostd/database/sql/sql_test.go.html#7173069">err</a></span><span class="op" id="7173156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7173159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7173162">type</span>&nbsp;<span class="ident" id="7173167">row</span>&nbsp;<span class="keyword" id="7173171">struct</span>&nbsp;<span class="op" id="7173178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7173182">age</span>&nbsp;&nbsp;<span class="builtintype" id="7173187">int</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7173193">name</span>&nbsp;<span class="builtintype" id="7173198">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7173206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7173209">got</span>&nbsp;<span class="op" id="7173213">:=</span>&nbsp;<span class="op" id="7173216">[</span><span class="op" id="7173217">]</span><span class="ident" id="7173218"><a href="/gostd/database/sql/sql_test.go.html#7173167">row</a></span><span class="op" id="7173221">{</span><span class="op" id="7173222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7173225">for</span>&nbsp;<span class="ident" id="7173229"><a href="/gostd/database/sql/sql_test.go.html#7173063">rows</a></span><span class="op" id="7173233">.</span><span class="ident" id="7173234"><a href="/gostd/database/sql/sql.go.html#5242163">Next</a></span><span class="op" id="7173238">(</span><span class="op" id="7173239">)</span>&nbsp;<span class="op" id="7173241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7173245">var</span>&nbsp;<span class="ident" id="7173249">r</span>&nbsp;<span class="ident" id="7173251"><a href="/gostd/database/sql/sql_test.go.html#7173167">row</a></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7173257"><a href="/gostd/database/sql/sql_test.go.html#7173069">err</a></span>&nbsp;<span class="op" id="7173261">=</span>&nbsp;<span class="ident" id="7173263"><a href="/gostd/database/sql/sql_test.go.html#7173063">rows</a></span><span class="op" id="7173267">.</span><span class="ident" id="7173268"><a href="/gostd/database/sql/sql.go.html#5243651">Scan</a></span><span class="op" id="7173272">(</span><span class="op" id="7173273">&amp;</span><span class="ident" id="7173274"><a href="/gostd/database/sql/sql_test.go.html#7173249">r</a></span><span class="op" id="7173275">.</span><span class="ident" id="7173276"><a href="/gostd/database/sql/sql_test.go.html#7173182">age</a></span><span class="op" id="7173279">,</span>&nbsp;<span class="op" id="7173281">&amp;</span><span class="ident" id="7173282"><a href="/gostd/database/sql/sql_test.go.html#7173249">r</a></span><span class="op" id="7173283">.</span><span class="ident" id="7173284"><a href="/gostd/database/sql/sql_test.go.html#7173193">name</a></span><span class="op" id="7173288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7173292">if</span>&nbsp;<span class="ident" id="7173295"><a href="/gostd/database/sql/sql_test.go.html#7173069">err</a></span>&nbsp;<span class="op" id="7173299">!=</span>&nbsp;<span class="builtintype" id="7173302">nil</span>&nbsp;<span class="op" id="7173306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7173311"><a href="/gostd/database/sql/sql_test.go.html#7172961">t</a></span><span class="op" id="7173312">.</span><span class="ident" id="7173313"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7173319">(</span><span class="string" id="7173320">&#34;Scan:&nbsp;%v&#34;</span><span class="op" id="7173330">,</span>&nbsp;<span class="ident" id="7173332"><a href="/gostd/database/sql/sql_test.go.html#7173069">err</a></span><span class="op" id="7173335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7173339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7173343"><a href="/gostd/database/sql/sql_test.go.html#7173209">got</a></span>&nbsp;<span class="op" id="7173347">=</span>&nbsp;<span class="builtinfunc" id="7173349">append</span><span class="op" id="7173355">(</span><span class="ident" id="7173356"><a href="/gostd/database/sql/sql_test.go.html#7173209">got</a></span><span class="op" id="7173359">,</span>&nbsp;<span class="ident" id="7173361"><a href="/gostd/database/sql/sql_test.go.html#7173249">r</a></span><span class="op" id="7173362">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7173365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7173368"><a href="/gostd/database/sql/sql_test.go.html#7173069">err</a></span>&nbsp;<span class="op" id="7173372">=</span>&nbsp;<span class="ident" id="7173374"><a href="/gostd/database/sql/sql_test.go.html#7173063">rows</a></span><span class="op" id="7173378">.</span><span class="ident" id="7173379"><a href="/gostd/database/sql/sql.go.html#5242560">Err</a></span><span class="op" id="7173382">(</span><span class="op" id="7173383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7173386">if</span>&nbsp;<span class="ident" id="7173389"><a href="/gostd/database/sql/sql_test.go.html#7173069">err</a></span>&nbsp;<span class="op" id="7173393">!=</span>&nbsp;<span class="builtintype" id="7173396">nil</span>&nbsp;<span class="op" id="7173400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7173404"><a href="/gostd/database/sql/sql_test.go.html#7172961">t</a></span><span class="op" id="7173405">.</span><span class="ident" id="7173406"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7173412">(</span><span class="string" id="7173413">&#34;Err:&nbsp;%v&#34;</span><span class="op" id="7173422">,</span>&nbsp;<span class="ident" id="7173424"><a href="/gostd/database/sql/sql_test.go.html#7173069">err</a></span><span class="op" id="7173427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7173430">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7173433">want</span>&nbsp;<span class="op" id="7173438">:=</span>&nbsp;<span class="op" id="7173441">[</span><span class="op" id="7173442">]</span><span class="ident" id="7173443"><a href="/gostd/database/sql/sql_test.go.html#7173167">row</a></span><span class="op" id="7173446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7173450">{</span><span class="ident" id="7173451"><a href="/gostd/database/sql/sql_test.go.html#7173182">age</a></span><span class="op" id="7173454">:</span>&nbsp;<span class="num" id="7173456">1</span><span class="op" id="7173457">,</span>&nbsp;<span class="ident" id="7173459"><a href="/gostd/database/sql/sql_test.go.html#7173193">name</a></span><span class="op" id="7173463">:</span>&nbsp;<span class="string" id="7173465">&#34;Alice&#34;</span><span class="op" id="7173472">}</span><span class="op" id="7173473">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7173477">{</span><span class="ident" id="7173478"><a href="/gostd/database/sql/sql_test.go.html#7173182">age</a></span><span class="op" id="7173481">:</span>&nbsp;<span class="num" id="7173483">2</span><span class="op" id="7173484">,</span>&nbsp;<span class="ident" id="7173486"><a href="/gostd/database/sql/sql_test.go.html#7173193">name</a></span><span class="op" id="7173490">:</span>&nbsp;<span class="string" id="7173492">&#34;Bob&#34;</span><span class="op" id="7173497">}</span><span class="op" id="7173498">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7173502">{</span><span class="ident" id="7173503"><a href="/gostd/database/sql/sql_test.go.html#7173182">age</a></span><span class="op" id="7173506">:</span>&nbsp;<span class="num" id="7173508">3</span><span class="op" id="7173509">,</span>&nbsp;<span class="ident" id="7173511"><a href="/gostd/database/sql/sql_test.go.html#7173193">name</a></span><span class="op" id="7173515">:</span>&nbsp;<span class="string" id="7173517">&#34;Chris&#34;</span><span class="op" id="7173524">}</span><span class="op" id="7173525">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7173528">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7173531">if</span>&nbsp;<span class="op" id="7173534">!</span><span class="ident" id="7173535"><a href="/gostd/database/sql/sql_test.go.html#7169092">reflect</a></span><span class="op" id="7173542">.</span><span class="ident" id="7173543"><a href="/gostd/reflect/deepequal.go.html#2775472">DeepEqual</a></span><span class="op" id="7173552">(</span><span class="ident" id="7173553"><a href="/gostd/database/sql/sql_test.go.html#7173209">got</a></span><span class="op" id="7173556">,</span>&nbsp;<span class="ident" id="7173558"><a href="/gostd/database/sql/sql_test.go.html#7173433">want</a></span><span class="op" id="7173562">)</span>&nbsp;<span class="op" id="7173564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7173568"><a href="/gostd/database/sql/sql_test.go.html#7172961">t</a></span><span class="op" id="7173569">.</span><span class="ident" id="7173570"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7173576">(</span><span class="string" id="7173577">&#34;mismatch.\n&nbsp;got:&nbsp;%#v\nwant:&nbsp;%#v&#34;</span><span class="op" id="7173610">,</span>&nbsp;<span class="ident" id="7173612"><a href="/gostd/database/sql/sql_test.go.html#7173209">got</a></span><span class="op" id="7173615">,</span>&nbsp;<span class="ident" id="7173617"><a href="/gostd/database/sql/sql_test.go.html#7173433">want</a></span><span class="op" id="7173621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7173624">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7173628">//&nbsp;And&nbsp;verify&nbsp;that&nbsp;the&nbsp;final&nbsp;rows.Next()&nbsp;call,&nbsp;which&nbsp;hit&nbsp;EOF,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7173691">//&nbsp;also&nbsp;closed&nbsp;the&nbsp;rows&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7173728">if</span>&nbsp;<span class="ident" id="7173731">n</span>&nbsp;<span class="op" id="7173733">:=</span>&nbsp;<span class="ident" id="7173736"><a href="/gostd/database/sql/sql_test.go.html#7172978">db</a></span><span class="op" id="7173738">.</span><span class="ident" id="7173739"><a href="/gostd/database/sql/sql_test.go.html#7172377">numFreeConns</a></span><span class="op" id="7173751">(</span><span class="op" id="7173752">)</span><span class="op" id="7173753">;</span>&nbsp;<span class="ident" id="7173755"><a href="/gostd/database/sql/sql_test.go.html#7173731">n</a></span>&nbsp;<span class="op" id="7173757">!=</span>&nbsp;<span class="num" id="7173760">1</span>&nbsp;<span class="op" id="7173762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7173766"><a href="/gostd/database/sql/sql_test.go.html#7172961">t</a></span><span class="op" id="7173767">.</span><span class="ident" id="7173768"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7173774">(</span><span class="string" id="7173775">&#34;free&nbsp;conns&nbsp;after&nbsp;query&nbsp;hitting&nbsp;EOF&nbsp;=&nbsp;%d;&nbsp;want&nbsp;1&#34;</span><span class="op" id="7173824">,</span>&nbsp;<span class="ident" id="7173826"><a href="/gostd/database/sql/sql_test.go.html#7173731">n</a></span><span class="op" id="7173827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7173830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7173833">if</span>&nbsp;<span class="ident" id="7173836">prepares</span>&nbsp;<span class="op" id="7173845">:=</span>&nbsp;<span class="ident" id="7173848"><a href="/gostd/database/sql/sql_test.go.html#7171760">numPrepares</a></span><span class="op" id="7173859">(</span><span class="ident" id="7173860"><a href="/gostd/database/sql/sql_test.go.html#7172961">t</a></span><span class="op" id="7173861">,</span>&nbsp;<span class="ident" id="7173863"><a href="/gostd/database/sql/sql_test.go.html#7172978">db</a></span><span class="op" id="7173865">)</span>&nbsp;<span class="op" id="7173867">-</span>&nbsp;<span class="ident" id="7173869"><a href="/gostd/database/sql/sql_test.go.html#7173030">prepares0</a></span><span class="op" id="7173878">;</span>&nbsp;<span class="ident" id="7173880"><a href="/gostd/database/sql/sql_test.go.html#7173836">prepares</a></span>&nbsp;<span class="op" id="7173889">!=</span>&nbsp;<span class="num" id="7173892">1</span>&nbsp;<span class="op" id="7173894">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7173898"><a href="/gostd/database/sql/sql_test.go.html#7172961">t</a></span><span class="op" id="7173899">.</span><span class="ident" id="7173900"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7173906">(</span><span class="string" id="7173907">&#34;executed&nbsp;%d&nbsp;Prepare&nbsp;statements;&nbsp;want&nbsp;1&#34;</span><span class="op" id="7173947">,</span>&nbsp;<span class="ident" id="7173949"><a href="/gostd/database/sql/sql_test.go.html#7173836">prepares</a></span><span class="op" id="7173957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7173960">}</span><br>
<span class="lineno"></span><span class="op" id="7173962">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7173965">func</span>&nbsp;<span class="ident" id="7173970">TestByteOwnership</span><span class="op" id="7173987">(</span><span class="ident" id="7173988">t</span>&nbsp;<span class="op" id="7173990">*</span><span class="ident" id="7173991"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7173998">.</span><span class="ident" id="7173999"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7174000">)</span>&nbsp;<span class="op" id="7174002">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7174005">db</span>&nbsp;<span class="op" id="7174008">:=</span>&nbsp;<span class="ident" id="7174011"><a href="/gostd/database/sql/sql_test.go.html#7169849">newTestDB</a></span><span class="op" id="7174020">(</span><span class="ident" id="7174021"><a href="/gostd/database/sql/sql_test.go.html#7173988">t</a></span><span class="op" id="7174022">,</span>&nbsp;<span class="string" id="7174024">&#34;people&#34;</span><span class="op" id="7174032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7174035">defer</span>&nbsp;<span class="ident" id="7174041"><a href="/gostd/database/sql/sql_test.go.html#7170773">closeDB</a></span><span class="op" id="7174048">(</span><span class="ident" id="7174049"><a href="/gostd/database/sql/sql_test.go.html#7173988">t</a></span><span class="op" id="7174050">,</span>&nbsp;<span class="ident" id="7174052"><a href="/gostd/database/sql/sql_test.go.html#7174005">db</a></span><span class="op" id="7174054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7174057">rows</span><span class="op" id="7174061">,</span>&nbsp;<span class="ident" id="7174063">err</span>&nbsp;<span class="op" id="7174067">:=</span>&nbsp;<span class="ident" id="7174070"><a href="/gostd/database/sql/sql_test.go.html#7174005">db</a></span><span class="op" id="7174072">.</span><span class="ident" id="7174073"><a href="/gostd/database/sql/sql.go.html#5225993">Query</a></span><span class="op" id="7174078">(</span><span class="string" id="7174079">&#34;SELECT|people|name,photo|&#34;</span><span class="op" id="7174106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7174109">if</span>&nbsp;<span class="ident" id="7174112"><a href="/gostd/database/sql/sql_test.go.html#7174063">err</a></span>&nbsp;<span class="op" id="7174116">!=</span>&nbsp;<span class="builtintype" id="7174119">nil</span>&nbsp;<span class="op" id="7174123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7174127"><a href="/gostd/database/sql/sql_test.go.html#7173988">t</a></span><span class="op" id="7174128">.</span><span class="ident" id="7174129"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7174135">(</span><span class="string" id="7174136">&#34;Query:&nbsp;%v&#34;</span><span class="op" id="7174147">,</span>&nbsp;<span class="ident" id="7174149"><a href="/gostd/database/sql/sql_test.go.html#7174063">err</a></span><span class="op" id="7174152">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7174155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7174158">type</span>&nbsp;<span class="ident" id="7174163">row</span>&nbsp;<span class="keyword" id="7174167">struct</span>&nbsp;<span class="op" id="7174174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7174178">name</span>&nbsp;&nbsp;<span class="op" id="7174184">[</span><span class="op" id="7174185">]</span><span class="builtintype" id="7174186">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7174193">photo</span>&nbsp;<span class="ident" id="7174199"><a href="/gostd/database/sql/sql.go.html#5203078">RawBytes</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7174209">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7174212">got</span>&nbsp;<span class="op" id="7174216">:=</span>&nbsp;<span class="op" id="7174219">[</span><span class="op" id="7174220">]</span><span class="ident" id="7174221"><a href="/gostd/database/sql/sql_test.go.html#7174163">row</a></span><span class="op" id="7174224">{</span><span class="op" id="7174225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7174228">for</span>&nbsp;<span class="ident" id="7174232"><a href="/gostd/database/sql/sql_test.go.html#7174057">rows</a></span><span class="op" id="7174236">.</span><span class="ident" id="7174237"><a href="/gostd/database/sql/sql.go.html#5242163">Next</a></span><span class="op" id="7174241">(</span><span class="op" id="7174242">)</span>&nbsp;<span class="op" id="7174244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7174248">var</span>&nbsp;<span class="ident" id="7174252">r</span>&nbsp;<span class="ident" id="7174254"><a href="/gostd/database/sql/sql_test.go.html#7174163">row</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7174260"><a href="/gostd/database/sql/sql_test.go.html#7174063">err</a></span>&nbsp;<span class="op" id="7174264">=</span>&nbsp;<span class="ident" id="7174266"><a href="/gostd/database/sql/sql_test.go.html#7174057">rows</a></span><span class="op" id="7174270">.</span><span class="ident" id="7174271"><a href="/gostd/database/sql/sql.go.html#5243651">Scan</a></span><span class="op" id="7174275">(</span><span class="op" id="7174276">&amp;</span><span class="ident" id="7174277"><a href="/gostd/database/sql/sql_test.go.html#7174252">r</a></span><span class="op" id="7174278">.</span><span class="ident" id="7174279"><a href="/gostd/database/sql/sql_test.go.html#7174178">name</a></span><span class="op" id="7174283">,</span>&nbsp;<span class="op" id="7174285">&amp;</span><span class="ident" id="7174286"><a href="/gostd/database/sql/sql_test.go.html#7174252">r</a></span><span class="op" id="7174287">.</span><span class="ident" id="7174288"><a href="/gostd/database/sql/sql_test.go.html#7174193">photo</a></span><span class="op" id="7174293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7174297">if</span>&nbsp;<span class="ident" id="7174300"><a href="/gostd/database/sql/sql_test.go.html#7174063">err</a></span>&nbsp;<span class="op" id="7174304">!=</span>&nbsp;<span class="builtintype" id="7174307">nil</span>&nbsp;<span class="op" id="7174311">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7174316"><a href="/gostd/database/sql/sql_test.go.html#7173988">t</a></span><span class="op" id="7174317">.</span><span class="ident" id="7174318"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7174324">(</span><span class="string" id="7174325">&#34;Scan:&nbsp;%v&#34;</span><span class="op" id="7174335">,</span>&nbsp;<span class="ident" id="7174337"><a href="/gostd/database/sql/sql_test.go.html#7174063">err</a></span><span class="op" id="7174340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7174344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7174348"><a href="/gostd/database/sql/sql_test.go.html#7174212">got</a></span>&nbsp;<span class="op" id="7174352">=</span>&nbsp;<span class="builtinfunc" id="7174354">append</span><span class="op" id="7174360">(</span><span class="ident" id="7174361"><a href="/gostd/database/sql/sql_test.go.html#7174212">got</a></span><span class="op" id="7174364">,</span>&nbsp;<span class="ident" id="7174366"><a href="/gostd/database/sql/sql_test.go.html#7174252">r</a></span><span class="op" id="7174367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7174370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7174373">corruptMemory</span>&nbsp;<span class="op" id="7174387">:=</span>&nbsp;<span class="op" id="7174390">[</span><span class="op" id="7174391">]</span><span class="builtintype" id="7174392">byte</span><span class="op" id="7174396">(</span><span class="string" id="7174397">&#34;\xffPHOTO&#34;</span><span class="op" id="7174408">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7174411">want</span>&nbsp;<span class="op" id="7174416">:=</span>&nbsp;<span class="op" id="7174419">[</span><span class="op" id="7174420">]</span><span class="ident" id="7174421"><a href="/gostd/database/sql/sql_test.go.html#7174163">row</a></span><span class="op" id="7174424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7174428">{</span><span class="ident" id="7174429"><a href="/gostd/database/sql/sql_test.go.html#7174178">name</a></span><span class="op" id="7174433">:</span>&nbsp;<span class="op" id="7174435">[</span><span class="op" id="7174436">]</span><span class="builtintype" id="7174437">byte</span><span class="op" id="7174441">(</span><span class="string" id="7174442">&#34;Alice&#34;</span><span class="op" id="7174449">)</span><span class="op" id="7174450">,</span>&nbsp;<span class="ident" id="7174452"><a href="/gostd/database/sql/sql_test.go.html#7174193">photo</a></span><span class="op" id="7174457">:</span>&nbsp;<span class="ident" id="7174459"><a href="/gostd/database/sql/sql_test.go.html#7174373">corruptMemory</a></span><span class="op" id="7174472">}</span><span class="op" id="7174473">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7174477">{</span><span class="ident" id="7174478"><a href="/gostd/database/sql/sql_test.go.html#7174178">name</a></span><span class="op" id="7174482">:</span>&nbsp;<span class="op" id="7174484">[</span><span class="op" id="7174485">]</span><span class="builtintype" id="7174486">byte</span><span class="op" id="7174490">(</span><span class="string" id="7174491">&#34;Bob&#34;</span><span class="op" id="7174496">)</span><span class="op" id="7174497">,</span>&nbsp;<span class="ident" id="7174499"><a href="/gostd/database/sql/sql_test.go.html#7174193">photo</a></span><span class="op" id="7174504">:</span>&nbsp;<span class="ident" id="7174506"><a href="/gostd/database/sql/sql_test.go.html#7174373">corruptMemory</a></span><span class="op" id="7174519">}</span><span class="op" id="7174520">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7174524">{</span><span class="ident" id="7174525"><a href="/gostd/database/sql/sql_test.go.html#7174178">name</a></span><span class="op" id="7174529">:</span>&nbsp;<span class="op" id="7174531">[</span><span class="op" id="7174532">]</span><span class="builtintype" id="7174533">byte</span><span class="op" id="7174537">(</span><span class="string" id="7174538">&#34;Chris&#34;</span><span class="op" id="7174545">)</span><span class="op" id="7174546">,</span>&nbsp;<span class="ident" id="7174548"><a href="/gostd/database/sql/sql_test.go.html#7174193">photo</a></span><span class="op" id="7174553">:</span>&nbsp;<span class="ident" id="7174555"><a href="/gostd/database/sql/sql_test.go.html#7174373">corruptMemory</a></span><span class="op" id="7174568">}</span><span class="op" id="7174569">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7174572">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7174575">if</span>&nbsp;<span class="op" id="7174578">!</span><span class="ident" id="7174579"><a href="/gostd/database/sql/sql_test.go.html#7169092">reflect</a></span><span class="op" id="7174586">.</span><span class="ident" id="7174587"><a href="/gostd/reflect/deepequal.go.html#2775472">DeepEqual</a></span><span class="op" id="7174596">(</span><span class="ident" id="7174597"><a href="/gostd/database/sql/sql_test.go.html#7174212">got</a></span><span class="op" id="7174600">,</span>&nbsp;<span class="ident" id="7174602"><a href="/gostd/database/sql/sql_test.go.html#7174411">want</a></span><span class="op" id="7174606">)</span>&nbsp;<span class="op" id="7174608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7174612"><a href="/gostd/database/sql/sql_test.go.html#7173988">t</a></span><span class="op" id="7174613">.</span><span class="ident" id="7174614"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7174620">(</span><span class="string" id="7174621">&#34;mismatch.\n&nbsp;got:&nbsp;%#v\nwant:&nbsp;%#v&#34;</span><span class="op" id="7174654">,</span>&nbsp;<span class="ident" id="7174656"><a href="/gostd/database/sql/sql_test.go.html#7174212">got</a></span><span class="op" id="7174659">,</span>&nbsp;<span class="ident" id="7174661"><a href="/gostd/database/sql/sql_test.go.html#7174411">want</a></span><span class="op" id="7174665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7174668">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7174672">var</span>&nbsp;<span class="ident" id="7174676">photo</span>&nbsp;<span class="ident" id="7174682"><a href="/gostd/database/sql/sql.go.html#5203078">RawBytes</a></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7174692"><a href="/gostd/database/sql/sql_test.go.html#7174063">err</a></span>&nbsp;<span class="op" id="7174696">=</span>&nbsp;<span class="ident" id="7174698"><a href="/gostd/database/sql/sql_test.go.html#7174005">db</a></span><span class="op" id="7174700">.</span><span class="ident" id="7174701"><a href="/gostd/database/sql/sql.go.html#5227854">QueryRow</a></span><span class="op" id="7174709">(</span><span class="string" id="7174710">&#34;SELECT|people|photo|name=?&#34;</span><span class="op" id="7174738">,</span>&nbsp;<span class="string" id="7174740">&#34;Alice&#34;</span><span class="op" id="7174747">)</span><span class="op" id="7174748">.</span><span class="ident" id="7174749"><a href="/gostd/database/sql/sql.go.html#5245114">Scan</a></span><span class="op" id="7174753">(</span><span class="op" id="7174754">&amp;</span><span class="ident" id="7174755"><a href="/gostd/database/sql/sql_test.go.html#7174676">photo</a></span><span class="op" id="7174760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7174763">if</span>&nbsp;<span class="ident" id="7174766"><a href="/gostd/database/sql/sql_test.go.html#7174063">err</a></span>&nbsp;<span class="op" id="7174770">==</span>&nbsp;<span class="builtintype" id="7174773">nil</span>&nbsp;<span class="op" id="7174777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7174781"><a href="/gostd/database/sql/sql_test.go.html#7173988">t</a></span><span class="op" id="7174782">.</span><span class="ident" id="7174783"><a href="/gostd/testing/testing.go.html#5479963">Error</a></span><span class="op" id="7174788">(</span><span class="string" id="7174789">&#34;want&nbsp;error&nbsp;scanning&nbsp;into&nbsp;RawBytes&nbsp;from&nbsp;QueryRow&#34;</span><span class="op" id="7174838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7174841">}</span><br>
<span class="lineno"></span><span class="op" id="7174843">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="keyword" id="7174846">func</span>&nbsp;<span class="ident" id="7174851">TestRowsColumns</span><span class="op" id="7174866">(</span><span class="ident" id="7174867">t</span>&nbsp;<span class="op" id="7174869">*</span><span class="ident" id="7174870"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7174877">.</span><span class="ident" id="7174878"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7174879">)</span>&nbsp;<span class="op" id="7174881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7174884">db</span>&nbsp;<span class="op" id="7174887">:=</span>&nbsp;<span class="ident" id="7174890"><a href="/gostd/database/sql/sql_test.go.html#7169849">newTestDB</a></span><span class="op" id="7174899">(</span><span class="ident" id="7174900"><a href="/gostd/database/sql/sql_test.go.html#7174867">t</a></span><span class="op" id="7174901">,</span>&nbsp;<span class="string" id="7174903">&#34;people&#34;</span><span class="op" id="7174911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7174914">defer</span>&nbsp;<span class="ident" id="7174920"><a href="/gostd/database/sql/sql_test.go.html#7170773">closeDB</a></span><span class="op" id="7174927">(</span><span class="ident" id="7174928"><a href="/gostd/database/sql/sql_test.go.html#7174867">t</a></span><span class="op" id="7174929">,</span>&nbsp;<span class="ident" id="7174931"><a href="/gostd/database/sql/sql_test.go.html#7174884">db</a></span><span class="op" id="7174933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7174936">rows</span><span class="op" id="7174940">,</span>&nbsp;<span class="ident" id="7174942">err</span>&nbsp;<span class="op" id="7174946">:=</span>&nbsp;<span class="ident" id="7174949"><a href="/gostd/database/sql/sql_test.go.html#7174884">db</a></span><span class="op" id="7174951">.</span><span class="ident" id="7174952"><a href="/gostd/database/sql/sql.go.html#5225993">Query</a></span><span class="op" id="7174957">(</span><span class="string" id="7174958">&#34;SELECT|people|age,name|&#34;</span><span class="op" id="7174983">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7174986">if</span>&nbsp;<span class="ident" id="7174989"><a href="/gostd/database/sql/sql_test.go.html#7174942">err</a></span>&nbsp;<span class="op" id="7174993">!=</span>&nbsp;<span class="builtintype" id="7174996">nil</span>&nbsp;<span class="op" id="7175000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7175004"><a href="/gostd/database/sql/sql_test.go.html#7174867">t</a></span><span class="op" id="7175005">.</span><span class="ident" id="7175006"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7175012">(</span><span class="string" id="7175013">&#34;Query:&nbsp;%v&#34;</span><span class="op" id="7175024">,</span>&nbsp;<span class="ident" id="7175026"><a href="/gostd/database/sql/sql_test.go.html#7174942">err</a></span><span class="op" id="7175029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7175032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7175035">cols</span><span class="op" id="7175039">,</span>&nbsp;<span class="ident" id="7175041"><a href="/gostd/database/sql/sql_test.go.html#7174942">err</a></span>&nbsp;<span class="op" id="7175045">:=</span>&nbsp;<span class="ident" id="7175048"><a href="/gostd/database/sql/sql_test.go.html#7174936">rows</a></span><span class="op" id="7175052">.</span><span class="ident" id="7175053"><a href="/gostd/database/sql/sql.go.html#5242812">Columns</a></span><span class="op" id="7175060">(</span><span class="op" id="7175061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7175064">if</span>&nbsp;<span class="ident" id="7175067"><a href="/gostd/database/sql/sql_test.go.html#7174942">err</a></span>&nbsp;<span class="op" id="7175071">!=</span>&nbsp;<span class="builtintype" id="7175074">nil</span>&nbsp;<span class="op" id="7175078">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7175082"><a href="/gostd/database/sql/sql_test.go.html#7174867">t</a></span><span class="op" id="7175083">.</span><span class="ident" id="7175084"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7175090">(</span><span class="string" id="7175091">&#34;Columns:&nbsp;%v&#34;</span><span class="op" id="7175104">,</span>&nbsp;<span class="ident" id="7175106"><a href="/gostd/database/sql/sql_test.go.html#7174942">err</a></span><span class="op" id="7175109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7175112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7175115">want</span>&nbsp;<span class="op" id="7175120">:=</span>&nbsp;<span class="op" id="7175123">[</span><span class="op" id="7175124">]</span><span class="builtintype" id="7175125">string</span><span class="op" id="7175131">{</span><span class="string" id="7175132">&#34;age&#34;</span><span class="op" id="7175137">,</span>&nbsp;<span class="string" id="7175139">&#34;name&#34;</span><span class="op" id="7175145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7175148">if</span>&nbsp;<span class="op" id="7175151">!</span><span class="ident" id="7175152"><a href="/gostd/database/sql/sql_test.go.html#7169092">reflect</a></span><span class="op" id="7175159">.</span><span class="ident" id="7175160"><a href="/gostd/reflect/deepequal.go.html#2775472">DeepEqual</a></span><span class="op" id="7175169">(</span><span class="ident" id="7175170"><a href="/gostd/database/sql/sql_test.go.html#7175035">cols</a></span><span class="op" id="7175174">,</span>&nbsp;<span class="ident" id="7175176"><a href="/gostd/database/sql/sql_test.go.html#7175115">want</a></span><span class="op" id="7175180">)</span>&nbsp;<span class="op" id="7175182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7175186"><a href="/gostd/database/sql/sql_test.go.html#7174867">t</a></span><span class="op" id="7175187">.</span><span class="ident" id="7175188"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7175194">(</span><span class="string" id="7175195">&#34;got&nbsp;%#v;&nbsp;want&nbsp;%#v&#34;</span><span class="op" id="7175214">,</span>&nbsp;<span class="ident" id="7175216"><a href="/gostd/database/sql/sql_test.go.html#7175035">cols</a></span><span class="op" id="7175220">,</span>&nbsp;<span class="ident" id="7175222"><a href="/gostd/database/sql/sql_test.go.html#7175115">want</a></span><span class="op" id="7175226">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7175229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7175232">if</span>&nbsp;<span class="ident" id="7175235">err</span>&nbsp;<span class="op" id="7175239">:=</span>&nbsp;<span class="ident" id="7175242"><a href="/gostd/database/sql/sql_test.go.html#7174936">rows</a></span><span class="op" id="7175246">.</span><span class="ident" id="7175247"><a href="/gostd/database/sql/sql.go.html#5244447">Close</a></span><span class="op" id="7175252">(</span><span class="op" id="7175253">)</span><span class="op" id="7175254">;</span>&nbsp;<span class="ident" id="7175256"><a href="/gostd/database/sql/sql_test.go.html#7175235">err</a></span>&nbsp;<span class="op" id="7175260">!=</span>&nbsp;<span class="builtintype" id="7175263">nil</span>&nbsp;<span class="op" id="7175267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7175271"><a href="/gostd/database/sql/sql_test.go.html#7174867">t</a></span><span class="op" id="7175272">.</span><span class="ident" id="7175273"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7175279">(</span><span class="string" id="7175280">&#34;error&nbsp;closing&nbsp;rows:&nbsp;%s&#34;</span><span class="op" id="7175304">,</span>&nbsp;<span class="ident" id="7175306"><a href="/gostd/database/sql/sql_test.go.html#7175235">err</a></span><span class="op" id="7175309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7175312">}</span><br>
<span class="lineno"></span><span class="op" id="7175314">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="7175317">func</span>&nbsp;<span class="ident" id="7175322">TestQueryRow</span><span class="op" id="7175334">(</span><span class="ident" id="7175335">t</span>&nbsp;<span class="op" id="7175337">*</span><span class="ident" id="7175338"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7175345">.</span><span class="ident" id="7175346"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7175347">)</span>&nbsp;<span class="op" id="7175349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7175352">db</span>&nbsp;<span class="op" id="7175355">:=</span>&nbsp;<span class="ident" id="7175358"><a href="/gostd/database/sql/sql_test.go.html#7169849">newTestDB</a></span><span class="op" id="7175367">(</span><span class="ident" id="7175368"><a href="/gostd/database/sql/sql_test.go.html#7175335">t</a></span><span class="op" id="7175369">,</span>&nbsp;<span class="string" id="7175371">&#34;people&#34;</span><span class="op" id="7175379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7175382">defer</span>&nbsp;<span class="ident" id="7175388"><a href="/gostd/database/sql/sql_test.go.html#7170773">closeDB</a></span><span class="op" id="7175395">(</span><span class="ident" id="7175396"><a href="/gostd/database/sql/sql_test.go.html#7175335">t</a></span><span class="op" id="7175397">,</span>&nbsp;<span class="ident" id="7175399"><a href="/gostd/database/sql/sql_test.go.html#7175352">db</a></span><span class="op" id="7175401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7175404">var</span>&nbsp;<span class="ident" id="7175408">name</span>&nbsp;<span class="builtintype" id="7175413">string</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7175421">var</span>&nbsp;<span class="ident" id="7175425">age</span>&nbsp;<span class="builtintype" id="7175429">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7175434">var</span>&nbsp;<span class="ident" id="7175438">birthday</span>&nbsp;<span class="ident" id="7175447"><a href="/gostd/database/sql/sql_test.go.html#7169144">time</a></span><span class="op" id="7175451">.</span><span class="ident" id="7175452"><a href="/gostd/time/time.go.html#2722087">Time</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7175459">err</span>&nbsp;<span class="op" id="7175463">:=</span>&nbsp;<span class="ident" id="7175466"><a href="/gostd/database/sql/sql_test.go.html#7175352">db</a></span><span class="op" id="7175468">.</span><span class="ident" id="7175469"><a href="/gostd/database/sql/sql.go.html#5227854">QueryRow</a></span><span class="op" id="7175477">(</span><span class="string" id="7175478">&#34;SELECT|people|age,name|age=?&#34;</span><span class="op" id="7175508">,</span>&nbsp;<span class="num" id="7175510">3</span><span class="op" id="7175511">)</span><span class="op" id="7175512">.</span><span class="ident" id="7175513"><a href="/gostd/database/sql/sql.go.html#5245114">Scan</a></span><span class="op" id="7175517">(</span><span class="op" id="7175518">&amp;</span><span class="ident" id="7175519"><a href="/gostd/database/sql/sql_test.go.html#7175425">age</a></span><span class="op" id="7175522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7175525">if</span>&nbsp;<span class="ident" id="7175528"><a href="/gostd/database/sql/sql_test.go.html#7175459">err</a></span>&nbsp;<span class="op" id="7175532">==</span>&nbsp;<span class="builtintype" id="7175535">nil</span>&nbsp;<span class="op" id="7175539">||</span>&nbsp;<span class="op" id="7175542">!</span><span class="ident" id="7175543"><a href="/gostd/database/sql/sql_test.go.html#7169114">strings</a></span><span class="op" id="7175550">.</span><span class="ident" id="7175551"><a href="/gostd/strings/strings.go.html#2968416">Contains</a></span><span class="op" id="7175559">(</span><span class="ident" id="7175560"><a href="/gostd/database/sql/sql_test.go.html#7175459">err</a></span><span class="op" id="7175563">.</span><span class="ident" id="7175564">Error</span><span class="op" id="7175569">(</span><span class="op" id="7175570">)</span><span class="op" id="7175571">,</span>&nbsp;<span class="string" id="7175573">&#34;expected&nbsp;2&nbsp;destination&nbsp;arguments&#34;</span><span class="op" id="7175607">)</span>&nbsp;<span class="op" id="7175609">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7175613"><a href="/gostd/database/sql/sql_test.go.html#7175335">t</a></span><span class="op" id="7175614">.</span><span class="ident" id="7175615"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7175621">(</span><span class="string" id="7175622">&#34;expected&nbsp;error&nbsp;from&nbsp;wrong&nbsp;number&nbsp;of&nbsp;arguments;&nbsp;actually&nbsp;got:&nbsp;%v&#34;</span><span class="op" id="7175687">,</span>&nbsp;<span class="ident" id="7175689"><a href="/gostd/database/sql/sql_test.go.html#7175459">err</a></span><span class="op" id="7175692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7175695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7175699"><a href="/gostd/database/sql/sql_test.go.html#7175459">err</a></span>&nbsp;<span class="op" id="7175703">=</span>&nbsp;<span class="ident" id="7175705"><a href="/gostd/database/sql/sql_test.go.html#7175352">db</a></span><span class="op" id="7175707">.</span><span class="ident" id="7175708"><a href="/gostd/database/sql/sql.go.html#5227854">QueryRow</a></span><span class="op" id="7175716">(</span><span class="string" id="7175717">&#34;SELECT|people|bdate|age=?&#34;</span><span class="op" id="7175744">,</span>&nbsp;<span class="num" id="7175746">3</span><span class="op" id="7175747">)</span><span class="op" id="7175748">.</span><span class="ident" id="7175749"><a href="/gostd/database/sql/sql.go.html#5245114">Scan</a></span><span class="op" id="7175753">(</span><span class="op" id="7175754">&amp;</span><span class="ident" id="7175755"><a href="/gostd/database/sql/sql_test.go.html#7175438">birthday</a></span><span class="op" id="7175763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7175766">if</span>&nbsp;<span class="ident" id="7175769"><a href="/gostd/database/sql/sql_test.go.html#7175459">err</a></span>&nbsp;<span class="op" id="7175773">!=</span>&nbsp;<span class="builtintype" id="7175776">nil</span>&nbsp;<span class="op" id="7175780">||</span>&nbsp;<span class="op" id="7175783">!</span><span class="ident" id="7175784"><a href="/gostd/database/sql/sql_test.go.html#7175438">birthday</a></span><span class="op" id="7175792">.</span><span class="ident" id="7175793"><a href="/gostd/time/time.go.html#2723199">Equal</a></span><span class="op" id="7175798">(</span><span class="ident" id="7175799"><a href="/gostd/database/sql/sql_test.go.html#7169803">chrisBirthday</a></span><span class="op" id="7175812">)</span>&nbsp;<span class="op" id="7175814">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7175818"><a href="/gostd/database/sql/sql_test.go.html#7175335">t</a></span><span class="op" id="7175819">.</span><span class="ident" id="7175820"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7175826">(</span><span class="string" id="7175827">&#34;chris&nbsp;birthday&nbsp;=&nbsp;%v,&nbsp;err&nbsp;=&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7175867">,</span>&nbsp;<span class="ident" id="7175869"><a href="/gostd/database/sql/sql_test.go.html#7175438">birthday</a></span><span class="op" id="7175877">,</span>&nbsp;<span class="ident" id="7175879"><a href="/gostd/database/sql/sql_test.go.html#7175459">err</a></span><span class="op" id="7175882">,</span>&nbsp;<span class="ident" id="7175884"><a href="/gostd/database/sql/sql_test.go.html#7169803">chrisBirthday</a></span><span class="op" id="7175897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7175900">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7175904"><a href="/gostd/database/sql/sql_test.go.html#7175459">err</a></span>&nbsp;<span class="op" id="7175908">=</span>&nbsp;<span class="ident" id="7175910"><a href="/gostd/database/sql/sql_test.go.html#7175352">db</a></span><span class="op" id="7175912">.</span><span class="ident" id="7175913"><a href="/gostd/database/sql/sql.go.html#5227854">QueryRow</a></span><span class="op" id="7175921">(</span><span class="string" id="7175922">&#34;SELECT|people|age,name|age=?&#34;</span><span class="op" id="7175952">,</span>&nbsp;<span class="num" id="7175954">2</span><span class="op" id="7175955">)</span><span class="op" id="7175956">.</span><span class="ident" id="7175957"><a href="/gostd/database/sql/sql.go.html#5245114">Scan</a></span><span class="op" id="7175961">(</span><span class="op" id="7175962">&amp;</span><span class="ident" id="7175963"><a href="/gostd/database/sql/sql_test.go.html#7175425">age</a></span><span class="op" id="7175966">,</span>&nbsp;<span class="op" id="7175968">&amp;</span><span class="ident" id="7175969"><a href="/gostd/database/sql/sql_test.go.html#7175408">name</a></span><span class="op" id="7175973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7175976">if</span>&nbsp;<span class="ident" id="7175979"><a href="/gostd/database/sql/sql_test.go.html#7175459">err</a></span>&nbsp;<span class="op" id="7175983">!=</span>&nbsp;<span class="builtintype" id="7175986">nil</span>&nbsp;<span class="op" id="7175990">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7175994"><a href="/gostd/database/sql/sql_test.go.html#7175335">t</a></span><span class="op" id="7175995">.</span><span class="ident" id="7175996"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7176002">(</span><span class="string" id="7176003">&#34;age&nbsp;QueryRow+Scan:&nbsp;%v&#34;</span><span class="op" id="7176026">,</span>&nbsp;<span class="ident" id="7176028"><a href="/gostd/database/sql/sql_test.go.html#7175459">err</a></span><span class="op" id="7176031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7176034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7176037">if</span>&nbsp;<span class="ident" id="7176040"><a href="/gostd/database/sql/sql_test.go.html#7175408">name</a></span>&nbsp;<span class="op" id="7176045">!=</span>&nbsp;<span class="string" id="7176048">&#34;Bob&#34;</span>&nbsp;<span class="op" id="7176054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7176058"><a href="/gostd/database/sql/sql_test.go.html#7175335">t</a></span><span class="op" id="7176059">.</span><span class="ident" id="7176060"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7176066">(</span><span class="string" id="7176067">&#34;expected&nbsp;name&nbsp;Bob,&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7176094">,</span>&nbsp;<span class="ident" id="7176096"><a href="/gostd/database/sql/sql_test.go.html#7175408">name</a></span><span class="op" id="7176100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7176103">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7176106">if</span>&nbsp;<span class="ident" id="7176109"><a href="/gostd/database/sql/sql_test.go.html#7175425">age</a></span>&nbsp;<span class="op" id="7176113">!=</span>&nbsp;<span class="num" id="7176116">2</span>&nbsp;<span class="op" id="7176118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7176122"><a href="/gostd/database/sql/sql_test.go.html#7175335">t</a></span><span class="op" id="7176123">.</span><span class="ident" id="7176124"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7176130">(</span><span class="string" id="7176131">&#34;expected&nbsp;age&nbsp;2,&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7176155">,</span>&nbsp;<span class="ident" id="7176157"><a href="/gostd/database/sql/sql_test.go.html#7175425">age</a></span><span class="op" id="7176160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7176163">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7176167"><a href="/gostd/database/sql/sql_test.go.html#7175459">err</a></span>&nbsp;<span class="op" id="7176171">=</span>&nbsp;<span class="ident" id="7176173"><a href="/gostd/database/sql/sql_test.go.html#7175352">db</a></span><span class="op" id="7176175">.</span><span class="ident" id="7176176"><a href="/gostd/database/sql/sql.go.html#5227854">QueryRow</a></span><span class="op" id="7176184">(</span><span class="string" id="7176185">&#34;SELECT|people|age,name|name=?&#34;</span><span class="op" id="7176216">,</span>&nbsp;<span class="string" id="7176218">&#34;Alice&#34;</span><span class="op" id="7176225">)</span><span class="op" id="7176226">.</span><span class="ident" id="7176227"><a href="/gostd/database/sql/sql.go.html#5245114">Scan</a></span><span class="op" id="7176231">(</span><span class="op" id="7176232">&amp;</span><span class="ident" id="7176233"><a href="/gostd/database/sql/sql_test.go.html#7175425">age</a></span><span class="op" id="7176236">,</span>&nbsp;<span class="op" id="7176238">&amp;</span><span class="ident" id="7176239"><a href="/gostd/database/sql/sql_test.go.html#7175408">name</a></span><span class="op" id="7176243">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7176246">if</span>&nbsp;<span class="ident" id="7176249"><a href="/gostd/database/sql/sql_test.go.html#7175459">err</a></span>&nbsp;<span class="op" id="7176253">!=</span>&nbsp;<span class="builtintype" id="7176256">nil</span>&nbsp;<span class="op" id="7176260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7176264"><a href="/gostd/database/sql/sql_test.go.html#7175335">t</a></span><span class="op" id="7176265">.</span><span class="ident" id="7176266"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7176272">(</span><span class="string" id="7176273">&#34;name&nbsp;QueryRow+Scan:&nbsp;%v&#34;</span><span class="op" id="7176297">,</span>&nbsp;<span class="ident" id="7176299"><a href="/gostd/database/sql/sql_test.go.html#7175459">err</a></span><span class="op" id="7176302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7176305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7176308">if</span>&nbsp;<span class="ident" id="7176311"><a href="/gostd/database/sql/sql_test.go.html#7175408">name</a></span>&nbsp;<span class="op" id="7176316">!=</span>&nbsp;<span class="string" id="7176319">&#34;Alice&#34;</span>&nbsp;<span class="op" id="7176327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7176331"><a href="/gostd/database/sql/sql_test.go.html#7175335">t</a></span><span class="op" id="7176332">.</span><span class="ident" id="7176333"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7176339">(</span><span class="string" id="7176340">&#34;expected&nbsp;name&nbsp;Alice,&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7176369">,</span>&nbsp;<span class="ident" id="7176371"><a href="/gostd/database/sql/sql_test.go.html#7175408">name</a></span><span class="op" id="7176375">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7176378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7176381">if</span>&nbsp;<span class="ident" id="7176384"><a href="/gostd/database/sql/sql_test.go.html#7175425">age</a></span>&nbsp;<span class="op" id="7176388">!=</span>&nbsp;<span class="num" id="7176391">1</span>&nbsp;<span class="op" id="7176393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7176397"><a href="/gostd/database/sql/sql_test.go.html#7175335">t</a></span><span class="op" id="7176398">.</span><span class="ident" id="7176399"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7176405">(</span><span class="string" id="7176406">&#34;expected&nbsp;age&nbsp;1,&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7176430">,</span>&nbsp;<span class="ident" id="7176432"><a href="/gostd/database/sql/sql_test.go.html#7175425">age</a></span><span class="op" id="7176435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7176438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7176442">var</span>&nbsp;<span class="ident" id="7176446">photo</span>&nbsp;<span class="op" id="7176452">[</span><span class="op" id="7176453">]</span><span class="builtintype" id="7176454">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7176460"><a href="/gostd/database/sql/sql_test.go.html#7175459">err</a></span>&nbsp;<span class="op" id="7176464">=</span>&nbsp;<span class="ident" id="7176466"><a href="/gostd/database/sql/sql_test.go.html#7175352">db</a></span><span class="op" id="7176468">.</span><span class="ident" id="7176469"><a href="/gostd/database/sql/sql.go.html#5227854">QueryRow</a></span><span class="op" id="7176477">(</span><span class="string" id="7176478">&#34;SELECT|people|photo|name=?&#34;</span><span class="op" id="7176506">,</span>&nbsp;<span class="string" id="7176508">&#34;Alice&#34;</span><span class="op" id="7176515">)</span><span class="op" id="7176516">.</span><span class="ident" id="7176517"><a href="/gostd/database/sql/sql.go.html#5245114">Scan</a></span><span class="op" id="7176521">(</span><span class="op" id="7176522">&amp;</span><span class="ident" id="7176523"><a href="/gostd/database/sql/sql_test.go.html#7176446">photo</a></span><span class="op" id="7176528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7176531">if</span>&nbsp;<span class="ident" id="7176534"><a href="/gostd/database/sql/sql_test.go.html#7175459">err</a></span>&nbsp;<span class="op" id="7176538">!=</span>&nbsp;<span class="builtintype" id="7176541">nil</span>&nbsp;<span class="op" id="7176545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7176549"><a href="/gostd/database/sql/sql_test.go.html#7175335">t</a></span><span class="op" id="7176550">.</span><span class="ident" id="7176551"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7176557">(</span><span class="string" id="7176558">&#34;photo&nbsp;QueryRow+Scan:&nbsp;%v&#34;</span><span class="op" id="7176583">,</span>&nbsp;<span class="ident" id="7176585"><a href="/gostd/database/sql/sql_test.go.html#7175459">err</a></span><span class="op" id="7176588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7176591">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7176594">want</span>&nbsp;<span class="op" id="7176599">:=</span>&nbsp;<span class="op" id="7176602">[</span><span class="op" id="7176603">]</span><span class="builtintype" id="7176604">byte</span><span class="op" id="7176608">(</span><span class="string" id="7176609">&#34;APHOTO&#34;</span><span class="op" id="7176617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7176620">if</span>&nbsp;<span class="op" id="7176623">!</span><span class="ident" id="7176624"><a href="/gostd/database/sql/sql_test.go.html#7169092">reflect</a></span><span class="op" id="7176631">.</span><span class="ident" id="7176632"><a href="/gostd/reflect/deepequal.go.html#2775472">DeepEqual</a></span><span class="op" id="7176641">(</span><span class="ident" id="7176642"><a href="/gostd/database/sql/sql_test.go.html#7176446">photo</a></span><span class="op" id="7176647">,</span>&nbsp;<span class="ident" id="7176649"><a href="/gostd/database/sql/sql_test.go.html#7176594">want</a></span><span class="op" id="7176653">)</span>&nbsp;<span class="op" id="7176655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7176659"><a href="/gostd/database/sql/sql_test.go.html#7175335">t</a></span><span class="op" id="7176660">.</span><span class="ident" id="7176661"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7176667">(</span><span class="string" id="7176668">&#34;photo&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7176689">,</span>&nbsp;<span class="ident" id="7176691"><a href="/gostd/database/sql/sql_test.go.html#7176446">photo</a></span><span class="op" id="7176696">,</span>&nbsp;<span class="ident" id="7176698"><a href="/gostd/database/sql/sql_test.go.html#7176594">want</a></span><span class="op" id="7176702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7176705">}</span><br>
<span class="lineno"></span><span class="op" id="7176707">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="keyword" id="7176710">func</span>&nbsp;<span class="ident" id="7176715">TestStatementErrorAfterClose</span><span class="op" id="7176743">(</span><span class="ident" id="7176744">t</span>&nbsp;<span class="op" id="7176746">*</span><span class="ident" id="7176747"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7176754">.</span><span class="ident" id="7176755"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7176756">)</span>&nbsp;<span class="op" id="7176758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7176761">db</span>&nbsp;<span class="op" id="7176764">:=</span>&nbsp;<span class="ident" id="7176767"><a href="/gostd/database/sql/sql_test.go.html#7169849">newTestDB</a></span><span class="op" id="7176776">(</span><span class="ident" id="7176777"><a href="/gostd/database/sql/sql_test.go.html#7176744">t</a></span><span class="op" id="7176778">,</span>&nbsp;<span class="string" id="7176780">&#34;people&#34;</span><span class="op" id="7176788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7176791">defer</span>&nbsp;<span class="ident" id="7176797"><a href="/gostd/database/sql/sql_test.go.html#7170773">closeDB</a></span><span class="op" id="7176804">(</span><span class="ident" id="7176805"><a href="/gostd/database/sql/sql_test.go.html#7176744">t</a></span><span class="op" id="7176806">,</span>&nbsp;<span class="ident" id="7176808"><a href="/gostd/database/sql/sql_test.go.html#7176761">db</a></span><span class="op" id="7176810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7176813">stmt</span><span class="op" id="7176817">,</span>&nbsp;<span class="ident" id="7176819">err</span>&nbsp;<span class="op" id="7176823">:=</span>&nbsp;<span class="ident" id="7176826"><a href="/gostd/database/sql/sql_test.go.html#7176761">db</a></span><span class="op" id="7176828">.</span><span class="ident" id="7176829"><a href="/gostd/database/sql/sql.go.html#5223860">Prepare</a></span><span class="op" id="7176836">(</span><span class="string" id="7176837">&#34;SELECT|people|age|name=?&#34;</span><span class="op" id="7176863">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7176866">if</span>&nbsp;<span class="ident" id="7176869"><a href="/gostd/database/sql/sql_test.go.html#7176819">err</a></span>&nbsp;<span class="op" id="7176873">!=</span>&nbsp;<span class="builtintype" id="7176876">nil</span>&nbsp;<span class="op" id="7176880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7176884"><a href="/gostd/database/sql/sql_test.go.html#7176744">t</a></span><span class="op" id="7176885">.</span><span class="ident" id="7176886"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7176892">(</span><span class="string" id="7176893">&#34;Prepare:&nbsp;%v&#34;</span><span class="op" id="7176906">,</span>&nbsp;<span class="ident" id="7176908"><a href="/gostd/database/sql/sql_test.go.html#7176819">err</a></span><span class="op" id="7176911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7176914">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7176917"><a href="/gostd/database/sql/sql_test.go.html#7176819">err</a></span>&nbsp;<span class="op" id="7176921">=</span>&nbsp;<span class="ident" id="7176923"><a href="/gostd/database/sql/sql_test.go.html#7176813">stmt</a></span><span class="op" id="7176927">.</span><span class="ident" id="7176928"><a href="/gostd/database/sql/sql.go.html#5240529">Close</a></span><span class="op" id="7176933">(</span><span class="op" id="7176934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7176937">if</span>&nbsp;<span class="ident" id="7176940"><a href="/gostd/database/sql/sql_test.go.html#7176819">err</a></span>&nbsp;<span class="op" id="7176944">!=</span>&nbsp;<span class="builtintype" id="7176947">nil</span>&nbsp;<span class="op" id="7176951">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7176955"><a href="/gostd/database/sql/sql_test.go.html#7176744">t</a></span><span class="op" id="7176956">.</span><span class="ident" id="7176957"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7176963">(</span><span class="string" id="7176964">&#34;Close:&nbsp;%v&#34;</span><span class="op" id="7176975">,</span>&nbsp;<span class="ident" id="7176977"><a href="/gostd/database/sql/sql_test.go.html#7176819">err</a></span><span class="op" id="7176980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7176983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7176986">var</span>&nbsp;<span class="ident" id="7176990">name</span>&nbsp;<span class="builtintype" id="7176995">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7177003"><a href="/gostd/database/sql/sql_test.go.html#7176819">err</a></span>&nbsp;<span class="op" id="7177007">=</span>&nbsp;<span class="ident" id="7177009"><a href="/gostd/database/sql/sql_test.go.html#7176813">stmt</a></span><span class="op" id="7177013">.</span><span class="ident" id="7177014"><a href="/gostd/database/sql/sql.go.html#5240343">QueryRow</a></span><span class="op" id="7177022">(</span><span class="string" id="7177023">&#34;foo&#34;</span><span class="op" id="7177028">)</span><span class="op" id="7177029">.</span><span class="ident" id="7177030"><a href="/gostd/database/sql/sql.go.html#5245114">Scan</a></span><span class="op" id="7177034">(</span><span class="op" id="7177035">&amp;</span><span class="ident" id="7177036"><a href="/gostd/database/sql/sql_test.go.html#7176990">name</a></span><span class="op" id="7177040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7177043">if</span>&nbsp;<span class="ident" id="7177046"><a href="/gostd/database/sql/sql_test.go.html#7176819">err</a></span>&nbsp;<span class="op" id="7177050">==</span>&nbsp;<span class="builtintype" id="7177053">nil</span>&nbsp;<span class="op" id="7177057">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7177061"><a href="/gostd/database/sql/sql_test.go.html#7176744">t</a></span><span class="op" id="7177062">.</span><span class="ident" id="7177063"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7177069">(</span><span class="string" id="7177070">&#34;expected&nbsp;error&nbsp;from&nbsp;QueryRow.Scan&nbsp;after&nbsp;Stmt.Close&#34;</span><span class="op" id="7177122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7177125">}</span><br>
<span class="lineno"></span><span class="op" id="7177127">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7177130">func</span>&nbsp;<span class="ident" id="7177135">TestStatementQueryRow</span><span class="op" id="7177156">(</span><span class="ident" id="7177157">t</span>&nbsp;<span class="op" id="7177159">*</span><span class="ident" id="7177160"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7177167">.</span><span class="ident" id="7177168"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7177169">)</span>&nbsp;<span class="op" id="7177171">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7177174">db</span>&nbsp;<span class="op" id="7177177">:=</span>&nbsp;<span class="ident" id="7177180"><a href="/gostd/database/sql/sql_test.go.html#7169849">newTestDB</a></span><span class="op" id="7177189">(</span><span class="ident" id="7177190"><a href="/gostd/database/sql/sql_test.go.html#7177157">t</a></span><span class="op" id="7177191">,</span>&nbsp;<span class="string" id="7177193">&#34;people&#34;</span><span class="op" id="7177201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7177204">defer</span>&nbsp;<span class="ident" id="7177210"><a href="/gostd/database/sql/sql_test.go.html#7170773">closeDB</a></span><span class="op" id="7177217">(</span><span class="ident" id="7177218"><a href="/gostd/database/sql/sql_test.go.html#7177157">t</a></span><span class="op" id="7177219">,</span>&nbsp;<span class="ident" id="7177221"><a href="/gostd/database/sql/sql_test.go.html#7177174">db</a></span><span class="op" id="7177223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7177226">stmt</span><span class="op" id="7177230">,</span>&nbsp;<span class="ident" id="7177232">err</span>&nbsp;<span class="op" id="7177236">:=</span>&nbsp;<span class="ident" id="7177239"><a href="/gostd/database/sql/sql_test.go.html#7177174">db</a></span><span class="op" id="7177241">.</span><span class="ident" id="7177242"><a href="/gostd/database/sql/sql.go.html#5223860">Prepare</a></span><span class="op" id="7177249">(</span><span class="string" id="7177250">&#34;SELECT|people|age|name=?&#34;</span><span class="op" id="7177276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7177279">if</span>&nbsp;<span class="ident" id="7177282"><a href="/gostd/database/sql/sql_test.go.html#7177232">err</a></span>&nbsp;<span class="op" id="7177286">!=</span>&nbsp;<span class="builtintype" id="7177289">nil</span>&nbsp;<span class="op" id="7177293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7177297"><a href="/gostd/database/sql/sql_test.go.html#7177157">t</a></span><span class="op" id="7177298">.</span><span class="ident" id="7177299"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7177305">(</span><span class="string" id="7177306">&#34;Prepare:&nbsp;%v&#34;</span><span class="op" id="7177319">,</span>&nbsp;<span class="ident" id="7177321"><a href="/gostd/database/sql/sql_test.go.html#7177232">err</a></span><span class="op" id="7177324">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7177327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7177330">defer</span>&nbsp;<span class="ident" id="7177336"><a href="/gostd/database/sql/sql_test.go.html#7177226">stmt</a></span><span class="op" id="7177340">.</span><span class="ident" id="7177341"><a href="/gostd/database/sql/sql.go.html#5240529">Close</a></span><span class="op" id="7177346">(</span><span class="op" id="7177347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7177350">var</span>&nbsp;<span class="ident" id="7177354">age</span>&nbsp;<span class="builtintype" id="7177358">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7177363">for</span>&nbsp;<span class="ident" id="7177367">n</span><span class="op" id="7177368">,</span>&nbsp;<span class="ident" id="7177370">tt</span>&nbsp;<span class="op" id="7177373">:=</span>&nbsp;<span class="keyword" id="7177376">range</span>&nbsp;<span class="op" id="7177382">[</span><span class="op" id="7177383">]</span><span class="keyword" id="7177384">struct</span>&nbsp;<span class="op" id="7177391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7177395">name</span>&nbsp;<span class="builtintype" id="7177400">string</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7177409">want</span>&nbsp;<span class="builtintype" id="7177414">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7177419">}</span><span class="op" id="7177420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7177424">{</span><span class="string" id="7177425">&#34;Alice&#34;</span><span class="op" id="7177432">,</span>&nbsp;<span class="num" id="7177434">1</span><span class="op" id="7177435">}</span><span class="op" id="7177436">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7177440">{</span><span class="string" id="7177441">&#34;Bob&#34;</span><span class="op" id="7177446">,</span>&nbsp;<span class="num" id="7177448">2</span><span class="op" id="7177449">}</span><span class="op" id="7177450">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7177454">{</span><span class="string" id="7177455">&#34;Chris&#34;</span><span class="op" id="7177462">,</span>&nbsp;<span class="num" id="7177464">3</span><span class="op" id="7177465">}</span><span class="op" id="7177466">,</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7177469">}</span>&nbsp;<span class="op" id="7177471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7177475">if</span>&nbsp;<span class="ident" id="7177478">err</span>&nbsp;<span class="op" id="7177482">:=</span>&nbsp;<span class="ident" id="7177485"><a href="/gostd/database/sql/sql_test.go.html#7177226">stmt</a></span><span class="op" id="7177489">.</span><span class="ident" id="7177490"><a href="/gostd/database/sql/sql.go.html#5240343">QueryRow</a></span><span class="op" id="7177498">(</span><span class="ident" id="7177499"><a href="/gostd/database/sql/sql_test.go.html#7177370">tt</a></span><span class="op" id="7177501">.</span><span class="ident" id="7177502"><a href="/gostd/database/sql/sql_test.go.html#7177395">name</a></span><span class="op" id="7177506">)</span><span class="op" id="7177507">.</span><span class="ident" id="7177508"><a href="/gostd/database/sql/sql.go.html#5245114">Scan</a></span><span class="op" id="7177512">(</span><span class="op" id="7177513">&amp;</span><span class="ident" id="7177514"><a href="/gostd/database/sql/sql_test.go.html#7177354">age</a></span><span class="op" id="7177517">)</span><span class="op" id="7177518">;</span>&nbsp;<span class="ident" id="7177520"><a href="/gostd/database/sql/sql_test.go.html#7177478">err</a></span>&nbsp;<span class="op" id="7177524">!=</span>&nbsp;<span class="builtintype" id="7177527">nil</span>&nbsp;<span class="op" id="7177531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7177536"><a href="/gostd/database/sql/sql_test.go.html#7177157">t</a></span><span class="op" id="7177537">.</span><span class="ident" id="7177538"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7177544">(</span><span class="string" id="7177545">&#34;%d:&nbsp;on&nbsp;%q,&nbsp;QueryRow/Scan:&nbsp;%v&#34;</span><span class="op" id="7177575">,</span>&nbsp;<span class="ident" id="7177577"><a href="/gostd/database/sql/sql_test.go.html#7177367">n</a></span><span class="op" id="7177578">,</span>&nbsp;<span class="ident" id="7177580"><a href="/gostd/database/sql/sql_test.go.html#7177370">tt</a></span><span class="op" id="7177582">.</span><span class="ident" id="7177583"><a href="/gostd/database/sql/sql_test.go.html#7177395">name</a></span><span class="op" id="7177587">,</span>&nbsp;<span class="ident" id="7177589"><a href="/gostd/database/sql/sql_test.go.html#7177478">err</a></span><span class="op" id="7177592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7177596">}</span>&nbsp;<span class="keyword" id="7177598">else</span>&nbsp;<span class="keyword" id="7177603">if</span>&nbsp;<span class="ident" id="7177606"><a href="/gostd/database/sql/sql_test.go.html#7177354">age</a></span>&nbsp;<span class="op" id="7177610">!=</span>&nbsp;<span class="ident" id="7177613"><a href="/gostd/database/sql/sql_test.go.html#7177370">tt</a></span><span class="op" id="7177615">.</span><span class="ident" id="7177616"><a href="/gostd/database/sql/sql_test.go.html#7177409">want</a></span>&nbsp;<span class="op" id="7177621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7177626"><a href="/gostd/database/sql/sql_test.go.html#7177157">t</a></span><span class="op" id="7177627">.</span><span class="ident" id="7177628"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7177634">(</span><span class="string" id="7177635">&#34;%d:&nbsp;age=%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7177656">,</span>&nbsp;<span class="ident" id="7177658"><a href="/gostd/database/sql/sql_test.go.html#7177367">n</a></span><span class="op" id="7177659">,</span>&nbsp;<span class="ident" id="7177661"><a href="/gostd/database/sql/sql_test.go.html#7177354">age</a></span><span class="op" id="7177664">,</span>&nbsp;<span class="ident" id="7177666"><a href="/gostd/database/sql/sql_test.go.html#7177370">tt</a></span><span class="op" id="7177668">.</span><span class="ident" id="7177669"><a href="/gostd/database/sql/sql_test.go.html#7177409">want</a></span><span class="op" id="7177673">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7177677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7177680">}</span><br>
<span class="lineno"></span><span class="op" id="7177682">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7177685">//&nbsp;golang.org/issue/3734</span><br>
<span class="lineno">360</span><span class="keyword" id="7177710">func</span>&nbsp;<span class="ident" id="7177715">TestStatementQueryRowConcurrent</span><span class="op" id="7177746">(</span><span class="ident" id="7177747">t</span>&nbsp;<span class="op" id="7177749">*</span><span class="ident" id="7177750"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7177757">.</span><span class="ident" id="7177758"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7177759">)</span>&nbsp;<span class="op" id="7177761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7177764">db</span>&nbsp;<span class="op" id="7177767">:=</span>&nbsp;<span class="ident" id="7177770"><a href="/gostd/database/sql/sql_test.go.html#7169849">newTestDB</a></span><span class="op" id="7177779">(</span><span class="ident" id="7177780"><a href="/gostd/database/sql/sql_test.go.html#7177747">t</a></span><span class="op" id="7177781">,</span>&nbsp;<span class="string" id="7177783">&#34;people&#34;</span><span class="op" id="7177791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7177794">defer</span>&nbsp;<span class="ident" id="7177800"><a href="/gostd/database/sql/sql_test.go.html#7170773">closeDB</a></span><span class="op" id="7177807">(</span><span class="ident" id="7177808"><a href="/gostd/database/sql/sql_test.go.html#7177747">t</a></span><span class="op" id="7177809">,</span>&nbsp;<span class="ident" id="7177811"><a href="/gostd/database/sql/sql_test.go.html#7177764">db</a></span><span class="op" id="7177813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7177816">stmt</span><span class="op" id="7177820">,</span>&nbsp;<span class="ident" id="7177822">err</span>&nbsp;<span class="op" id="7177826">:=</span>&nbsp;<span class="ident" id="7177829"><a href="/gostd/database/sql/sql_test.go.html#7177764">db</a></span><span class="op" id="7177831">.</span><span class="ident" id="7177832"><a href="/gostd/database/sql/sql.go.html#5223860">Prepare</a></span><span class="op" id="7177839">(</span><span class="string" id="7177840">&#34;SELECT|people|age|name=?&#34;</span><span class="op" id="7177866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7177869">if</span>&nbsp;<span class="ident" id="7177872"><a href="/gostd/database/sql/sql_test.go.html#7177822">err</a></span>&nbsp;<span class="op" id="7177876">!=</span>&nbsp;<span class="builtintype" id="7177879">nil</span>&nbsp;<span class="op" id="7177883">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7177887"><a href="/gostd/database/sql/sql_test.go.html#7177747">t</a></span><span class="op" id="7177888">.</span><span class="ident" id="7177889"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7177895">(</span><span class="string" id="7177896">&#34;Prepare:&nbsp;%v&#34;</span><span class="op" id="7177909">,</span>&nbsp;<span class="ident" id="7177911"><a href="/gostd/database/sql/sql_test.go.html#7177822">err</a></span><span class="op" id="7177914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7177917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7177920">defer</span>&nbsp;<span class="ident" id="7177926"><a href="/gostd/database/sql/sql_test.go.html#7177816">stmt</a></span><span class="op" id="7177930">.</span><span class="ident" id="7177931"><a href="/gostd/database/sql/sql.go.html#5240529">Close</a></span><span class="op" id="7177936">(</span><span class="op" id="7177937">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7177941">const</span>&nbsp;<span class="ident" id="7177947">n</span>&nbsp;<span class="op" id="7177949">=</span>&nbsp;<span class="num" id="7177951">10</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7177955">ch</span>&nbsp;<span class="op" id="7177958">:=</span>&nbsp;<span class="builtinfunc" id="7177961">make</span><span class="op" id="7177965">(</span><span class="keyword" id="7177966">chan</span>&nbsp;<span class="builtintype" id="7177971">error</span><span class="op" id="7177976">,</span>&nbsp;<span class="ident" id="7177978"><a href="/gostd/database/sql/sql_test.go.html#7177947">n</a></span><span class="op" id="7177979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7177982">for</span>&nbsp;<span class="ident" id="7177986">i</span>&nbsp;<span class="op" id="7177988">:=</span>&nbsp;<span class="num" id="7177991">0</span><span class="op" id="7177992">;</span>&nbsp;<span class="ident" id="7177994"><a href="/gostd/database/sql/sql_test.go.html#7177986">i</a></span>&nbsp;<span class="op" id="7177996">&lt;</span>&nbsp;<span class="ident" id="7177998"><a href="/gostd/database/sql/sql_test.go.html#7177947">n</a></span><span class="op" id="7177999">;</span>&nbsp;<span class="ident" id="7178001"><a href="/gostd/database/sql/sql_test.go.html#7177986">i</a></span><span class="op" id="7178002">++</span>&nbsp;<span class="op" id="7178005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7178009">go</span>&nbsp;<span class="keyword" id="7178012">func</span><span class="op" id="7178016">(</span><span class="op" id="7178017">)</span>&nbsp;<span class="op" id="7178019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7178024">var</span>&nbsp;<span class="ident" id="7178028">age</span>&nbsp;<span class="builtintype" id="7178032">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7178039">err</span>&nbsp;<span class="op" id="7178043">:=</span>&nbsp;<span class="ident" id="7178046"><a href="/gostd/database/sql/sql_test.go.html#7177816">stmt</a></span><span class="op" id="7178050">.</span><span class="ident" id="7178051"><a href="/gostd/database/sql/sql.go.html#5240343">QueryRow</a></span><span class="op" id="7178059">(</span><span class="string" id="7178060">&#34;Alice&#34;</span><span class="op" id="7178067">)</span><span class="op" id="7178068">.</span><span class="ident" id="7178069"><a href="/gostd/database/sql/sql.go.html#5245114">Scan</a></span><span class="op" id="7178073">(</span><span class="op" id="7178074">&amp;</span><span class="ident" id="7178075"><a href="/gostd/database/sql/sql_test.go.html#7178028">age</a></span><span class="op" id="7178078">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7178083">if</span>&nbsp;<span class="ident" id="7178086"><a href="/gostd/database/sql/sql_test.go.html#7178039">err</a></span>&nbsp;<span class="op" id="7178090">==</span>&nbsp;<span class="builtintype" id="7178093">nil</span>&nbsp;<span class="op" id="7178097">&amp;&amp;</span>&nbsp;<span class="ident" id="7178100"><a href="/gostd/database/sql/sql_test.go.html#7178028">age</a></span>&nbsp;<span class="op" id="7178104">!=</span>&nbsp;<span class="num" id="7178107">1</span>&nbsp;<span class="op" id="7178109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7178115"><a href="/gostd/database/sql/sql_test.go.html#7178039">err</a></span>&nbsp;<span class="op" id="7178119">=</span>&nbsp;<span class="ident" id="7178121"><a href="/gostd/database/sql/sql_test.go.html#7169072">fmt</a></span><span class="op" id="7178124">.</span><span class="ident" id="7178125"><a href="/gostd/fmt/print.go.html#2143886">Errorf</a></span><span class="op" id="7178131">(</span><span class="string" id="7178132">&#34;unexpected&nbsp;age&nbsp;%d&#34;</span><span class="op" id="7178151">,</span>&nbsp;<span class="ident" id="7178153"><a href="/gostd/database/sql/sql_test.go.html#7178028">age</a></span><span class="op" id="7178156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7178161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7178166"><a href="/gostd/database/sql/sql_test.go.html#7177955">ch</a></span>&nbsp;<span class="op" id="7178169">&lt;-</span>&nbsp;<span class="ident" id="7178172"><a href="/gostd/database/sql/sql_test.go.html#7178039">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7178178">}</span><span class="op" id="7178179">(</span><span class="op" id="7178180">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7178183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7178186">for</span>&nbsp;<span class="ident" id="7178190">i</span>&nbsp;<span class="op" id="7178192">:=</span>&nbsp;<span class="num" id="7178195">0</span><span class="op" id="7178196">;</span>&nbsp;<span class="ident" id="7178198"><a href="/gostd/database/sql/sql_test.go.html#7178190">i</a></span>&nbsp;<span class="op" id="7178200">&lt;</span>&nbsp;<span class="ident" id="7178202"><a href="/gostd/database/sql/sql_test.go.html#7177947">n</a></span><span class="op" id="7178203">;</span>&nbsp;<span class="ident" id="7178205"><a href="/gostd/database/sql/sql_test.go.html#7178190">i</a></span><span class="op" id="7178206">++</span>&nbsp;<span class="op" id="7178209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7178213">if</span>&nbsp;<span class="ident" id="7178216">err</span>&nbsp;<span class="op" id="7178220">:=</span>&nbsp;<span class="op" id="7178223">&lt;-</span><span class="ident" id="7178225"><a href="/gostd/database/sql/sql_test.go.html#7177955">ch</a></span><span class="op" id="7178227">;</span>&nbsp;<span class="ident" id="7178229"><a href="/gostd/database/sql/sql_test.go.html#7178216">err</a></span>&nbsp;<span class="op" id="7178233">!=</span>&nbsp;<span class="builtintype" id="7178236">nil</span>&nbsp;<span class="op" id="7178240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7178245"><a href="/gostd/database/sql/sql_test.go.html#7177747">t</a></span><span class="op" id="7178246">.</span><span class="ident" id="7178247"><a href="/gostd/testing/testing.go.html#5479963">Error</a></span><span class="op" id="7178252">(</span><span class="ident" id="7178253"><a href="/gostd/database/sql/sql_test.go.html#7178216">err</a></span><span class="op" id="7178256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7178260">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7178263">}</span><br>
<span class="lineno"></span><span class="op" id="7178265">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7178268">//&nbsp;just&nbsp;a&nbsp;test&nbsp;of&nbsp;fakedb&nbsp;itself</span><br>
<span class="lineno"></span><span class="keyword" id="7178300">func</span>&nbsp;<span class="ident" id="7178305">TestBogusPreboundParameters</span><span class="op" id="7178332">(</span><span class="ident" id="7178333">t</span>&nbsp;<span class="op" id="7178335">*</span><span class="ident" id="7178336"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7178343">.</span><span class="ident" id="7178344"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7178345">)</span>&nbsp;<span class="op" id="7178347">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7178350">db</span>&nbsp;<span class="op" id="7178353">:=</span>&nbsp;<span class="ident" id="7178356"><a href="/gostd/database/sql/sql_test.go.html#7169849">newTestDB</a></span><span class="op" id="7178365">(</span><span class="ident" id="7178366"><a href="/gostd/database/sql/sql_test.go.html#7178333">t</a></span><span class="op" id="7178367">,</span>&nbsp;<span class="string" id="7178369">&#34;foo&#34;</span><span class="op" id="7178374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7178377">defer</span>&nbsp;<span class="ident" id="7178383"><a href="/gostd/database/sql/sql_test.go.html#7170773">closeDB</a></span><span class="op" id="7178390">(</span><span class="ident" id="7178391"><a href="/gostd/database/sql/sql_test.go.html#7178333">t</a></span><span class="op" id="7178392">,</span>&nbsp;<span class="ident" id="7178394"><a href="/gostd/database/sql/sql_test.go.html#7178350">db</a></span><span class="op" id="7178396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7178399"><a href="/gostd/database/sql/sql_test.go.html#7170605">exec</a></span><span class="op" id="7178403">(</span><span class="ident" id="7178404"><a href="/gostd/database/sql/sql_test.go.html#7178333">t</a></span><span class="op" id="7178405">,</span>&nbsp;<span class="ident" id="7178407"><a href="/gostd/database/sql/sql_test.go.html#7178350">db</a></span><span class="op" id="7178409">,</span>&nbsp;<span class="string" id="7178411">&#34;CREATE|t1|name=string,age=int32,dead=bool&#34;</span><span class="op" id="7178454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7178457">_</span><span class="op" id="7178458">,</span>&nbsp;<span class="ident" id="7178460">err</span>&nbsp;<span class="op" id="7178464">:=</span>&nbsp;<span class="ident" id="7178467"><a href="/gostd/database/sql/sql_test.go.html#7178350">db</a></span><span class="op" id="7178469">.</span><span class="ident" id="7178470"><a href="/gostd/database/sql/sql.go.html#5223860">Prepare</a></span><span class="op" id="7178477">(</span><span class="string" id="7178478">&#34;INSERT|t1|name=?,age=bogusconversion&#34;</span><span class="op" id="7178516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7178519">if</span>&nbsp;<span class="ident" id="7178522"><a href="/gostd/database/sql/sql_test.go.html#7178460">err</a></span>&nbsp;<span class="op" id="7178526">==</span>&nbsp;<span class="builtintype" id="7178529">nil</span>&nbsp;<span class="op" id="7178533">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7178537"><a href="/gostd/database/sql/sql_test.go.html#7178333">t</a></span><span class="op" id="7178538">.</span><span class="ident" id="7178539"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7178545">(</span><span class="string" id="7178546">&#34;expected&nbsp;error&#34;</span><span class="op" id="7178562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7178565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7178568">if</span>&nbsp;<span class="ident" id="7178571"><a href="/gostd/database/sql/sql_test.go.html#7178460">err</a></span><span class="op" id="7178574">.</span><span class="ident" id="7178575">Error</span><span class="op" id="7178580">(</span><span class="op" id="7178581">)</span>&nbsp;<span class="op" id="7178583">!=</span>&nbsp;<span class="string" id="7178586">`fakedb:&nbsp;invalid&nbsp;conversion&nbsp;to&nbsp;int32&nbsp;from&nbsp;&#34;bogusconversion&#34;`</span>&nbsp;<span class="op" id="7178647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7178651"><a href="/gostd/database/sql/sql_test.go.html#7178333">t</a></span><span class="op" id="7178652">.</span><span class="ident" id="7178653"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7178659">(</span><span class="string" id="7178660">&#34;unexpected&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="7178682">,</span>&nbsp;<span class="ident" id="7178684"><a href="/gostd/database/sql/sql_test.go.html#7178460">err</a></span><span class="op" id="7178687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7178690">}</span><br>
<span class="lineno">400</span><span class="op" id="7178692">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7178695">func</span>&nbsp;<span class="ident" id="7178700">TestExec</span><span class="op" id="7178708">(</span><span class="ident" id="7178709">t</span>&nbsp;<span class="op" id="7178711">*</span><span class="ident" id="7178712"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7178719">.</span><span class="ident" id="7178720"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7178721">)</span>&nbsp;<span class="op" id="7178723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7178726">db</span>&nbsp;<span class="op" id="7178729">:=</span>&nbsp;<span class="ident" id="7178732"><a href="/gostd/database/sql/sql_test.go.html#7169849">newTestDB</a></span><span class="op" id="7178741">(</span><span class="ident" id="7178742"><a href="/gostd/database/sql/sql_test.go.html#7178709">t</a></span><span class="op" id="7178743">,</span>&nbsp;<span class="string" id="7178745">&#34;foo&#34;</span><span class="op" id="7178750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7178753">defer</span>&nbsp;<span class="ident" id="7178759"><a href="/gostd/database/sql/sql_test.go.html#7170773">closeDB</a></span><span class="op" id="7178766">(</span><span class="ident" id="7178767"><a href="/gostd/database/sql/sql_test.go.html#7178709">t</a></span><span class="op" id="7178768">,</span>&nbsp;<span class="ident" id="7178770"><a href="/gostd/database/sql/sql_test.go.html#7178726">db</a></span><span class="op" id="7178772">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7178775"><a href="/gostd/database/sql/sql_test.go.html#7170605">exec</a></span><span class="op" id="7178779">(</span><span class="ident" id="7178780"><a href="/gostd/database/sql/sql_test.go.html#7178709">t</a></span><span class="op" id="7178781">,</span>&nbsp;<span class="ident" id="7178783"><a href="/gostd/database/sql/sql_test.go.html#7178726">db</a></span><span class="op" id="7178785">,</span>&nbsp;<span class="string" id="7178787">&#34;CREATE|t1|name=string,age=int32,dead=bool&#34;</span><span class="op" id="7178830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7178833">stmt</span><span class="op" id="7178837">,</span>&nbsp;<span class="ident" id="7178839">err</span>&nbsp;<span class="op" id="7178843">:=</span>&nbsp;<span class="ident" id="7178846"><a href="/gostd/database/sql/sql_test.go.html#7178726">db</a></span><span class="op" id="7178848">.</span><span class="ident" id="7178849"><a href="/gostd/database/sql/sql.go.html#5223860">Prepare</a></span><span class="op" id="7178856">(</span><span class="string" id="7178857">&#34;INSERT|t1|name=?,age=?&#34;</span><span class="op" id="7178881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7178884">if</span>&nbsp;<span class="ident" id="7178887"><a href="/gostd/database/sql/sql_test.go.html#7178839">err</a></span>&nbsp;<span class="op" id="7178891">!=</span>&nbsp;<span class="builtintype" id="7178894">nil</span>&nbsp;<span class="op" id="7178898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7178902"><a href="/gostd/database/sql/sql_test.go.html#7178709">t</a></span><span class="op" id="7178903">.</span><span class="ident" id="7178904"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7178910">(</span><span class="string" id="7178911">&#34;Stmt,&nbsp;err&nbsp;=&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="7178931">,</span>&nbsp;<span class="ident" id="7178933"><a href="/gostd/database/sql/sql_test.go.html#7178833">stmt</a></span><span class="op" id="7178937">,</span>&nbsp;<span class="ident" id="7178939"><a href="/gostd/database/sql/sql_test.go.html#7178839">err</a></span><span class="op" id="7178942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7178945">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7178948">defer</span>&nbsp;<span class="ident" id="7178954"><a href="/gostd/database/sql/sql_test.go.html#7178833">stmt</a></span><span class="op" id="7178958">.</span><span class="ident" id="7178959"><a href="/gostd/database/sql/sql.go.html#5240529">Close</a></span><span class="op" id="7178964">(</span><span class="op" id="7178965">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7178969">type</span>&nbsp;<span class="ident" id="7178974">execTest</span>&nbsp;<span class="keyword" id="7178983">struct</span>&nbsp;<span class="op" id="7178990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7178994">args</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7179002">[</span><span class="op" id="7179003">]</span><span class="keyword" id="7179004">interface</span><span class="op" id="7179013">{</span><span class="op" id="7179014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7179018">wantErr</span>&nbsp;<span class="builtintype" id="7179026">string</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7179034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7179037">execTests</span>&nbsp;<span class="op" id="7179047">:=</span>&nbsp;<span class="op" id="7179050">[</span><span class="op" id="7179051">]</span><span class="ident" id="7179052"><a href="/gostd/database/sql/sql_test.go.html#7178974">execTest</a></span><span class="op" id="7179060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7179064">//&nbsp;Okay:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7179075">{</span><span class="op" id="7179076">[</span><span class="op" id="7179077">]</span><span class="keyword" id="7179078">interface</span><span class="op" id="7179087">{</span><span class="op" id="7179088">}</span><span class="op" id="7179089">{</span><span class="string" id="7179090">&#34;Brad&#34;</span><span class="op" id="7179096">,</span>&nbsp;<span class="num" id="7179098">31</span><span class="op" id="7179100">}</span><span class="op" id="7179101">,</span>&nbsp;<span class="string" id="7179103">&#34;&#34;</span><span class="op" id="7179105">}</span><span class="op" id="7179106">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7179110">{</span><span class="op" id="7179111">[</span><span class="op" id="7179112">]</span><span class="keyword" id="7179113">interface</span><span class="op" id="7179122">{</span><span class="op" id="7179123">}</span><span class="op" id="7179124">{</span><span class="string" id="7179125">&#34;Brad&#34;</span><span class="op" id="7179131">,</span>&nbsp;<span class="builtintype" id="7179133">int64</span><span class="op" id="7179138">(</span><span class="num" id="7179139">31</span><span class="op" id="7179141">)</span><span class="op" id="7179142">}</span><span class="op" id="7179143">,</span>&nbsp;<span class="string" id="7179145">&#34;&#34;</span><span class="op" id="7179147">}</span><span class="op" id="7179148">,</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7179152">{</span><span class="op" id="7179153">[</span><span class="op" id="7179154">]</span><span class="keyword" id="7179155">interface</span><span class="op" id="7179164">{</span><span class="op" id="7179165">}</span><span class="op" id="7179166">{</span><span class="string" id="7179167">&#34;Bob&#34;</span><span class="op" id="7179172">,</span>&nbsp;<span class="string" id="7179174">&#34;32&#34;</span><span class="op" id="7179178">}</span><span class="op" id="7179179">,</span>&nbsp;<span class="string" id="7179181">&#34;&#34;</span><span class="op" id="7179183">}</span><span class="op" id="7179184">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7179188">{</span><span class="op" id="7179189">[</span><span class="op" id="7179190">]</span><span class="keyword" id="7179191">interface</span><span class="op" id="7179200">{</span><span class="op" id="7179201">}</span><span class="op" id="7179202">{</span><span class="num" id="7179203">7</span><span class="op" id="7179204">,</span>&nbsp;<span class="num" id="7179206">9</span><span class="op" id="7179207">}</span><span class="op" id="7179208">,</span>&nbsp;<span class="string" id="7179210">&#34;&#34;</span><span class="op" id="7179212">}</span><span class="op" id="7179213">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7179218">//&nbsp;Invalid&nbsp;conversions:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7179244">{</span><span class="op" id="7179245">[</span><span class="op" id="7179246">]</span><span class="keyword" id="7179247">interface</span><span class="op" id="7179256">{</span><span class="op" id="7179257">}</span><span class="op" id="7179258">{</span><span class="string" id="7179259">&#34;Brad&#34;</span><span class="op" id="7179265">,</span>&nbsp;<span class="builtintype" id="7179267">int64</span><span class="op" id="7179272">(</span><span class="num" id="7179273">0xFFFFFFFF</span><span class="op" id="7179283">)</span><span class="op" id="7179284">}</span><span class="op" id="7179285">,</span>&nbsp;<span class="string" id="7179287">&#34;sql:&nbsp;converting&nbsp;argument&nbsp;#1&#39;s&nbsp;type:&nbsp;sql/driver:&nbsp;value&nbsp;4294967295&nbsp;overflows&nbsp;int32&#34;</span><span class="op" id="7179369">}</span><span class="op" id="7179370">,</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7179374">{</span><span class="op" id="7179375">[</span><span class="op" id="7179376">]</span><span class="keyword" id="7179377">interface</span><span class="op" id="7179386">{</span><span class="op" id="7179387">}</span><span class="op" id="7179388">{</span><span class="string" id="7179389">&#34;Brad&#34;</span><span class="op" id="7179395">,</span>&nbsp;<span class="string" id="7179397">&#34;strconv&nbsp;fail&#34;</span><span class="op" id="7179411">}</span><span class="op" id="7179412">,</span>&nbsp;<span class="string" id="7179414">&#34;sql:&nbsp;converting&nbsp;argument&nbsp;#1&#39;s&nbsp;type:&nbsp;sql/driver:&nbsp;value&nbsp;\&#34;strconv&nbsp;fail\&#34;&nbsp;can&#39;t&nbsp;be&nbsp;converted&nbsp;to&nbsp;int32&#34;</span><span class="op" id="7179514">}</span><span class="op" id="7179515">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7179520">//&nbsp;Wrong&nbsp;number&nbsp;of&nbsp;args:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7179547">{</span><span class="op" id="7179548">[</span><span class="op" id="7179549">]</span><span class="keyword" id="7179550">interface</span><span class="op" id="7179559">{</span><span class="op" id="7179560">}</span><span class="op" id="7179561">{</span><span class="op" id="7179562">}</span><span class="op" id="7179563">,</span>&nbsp;<span class="string" id="7179565">&#34;sql:&nbsp;expected&nbsp;2&nbsp;arguments,&nbsp;got&nbsp;0&#34;</span><span class="op" id="7179599">}</span><span class="op" id="7179600">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7179604">{</span><span class="op" id="7179605">[</span><span class="op" id="7179606">]</span><span class="keyword" id="7179607">interface</span><span class="op" id="7179616">{</span><span class="op" id="7179617">}</span><span class="op" id="7179618">{</span><span class="num" id="7179619">1</span><span class="op" id="7179620">,</span>&nbsp;<span class="num" id="7179622">2</span><span class="op" id="7179623">,</span>&nbsp;<span class="num" id="7179625">3</span><span class="op" id="7179626">}</span><span class="op" id="7179627">,</span>&nbsp;<span class="string" id="7179629">&#34;sql:&nbsp;expected&nbsp;2&nbsp;arguments,&nbsp;got&nbsp;3&#34;</span><span class="op" id="7179663">}</span><span class="op" id="7179664">,</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7179667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7179670">for</span>&nbsp;<span class="ident" id="7179674">n</span><span class="op" id="7179675">,</span>&nbsp;<span class="ident" id="7179677">et</span>&nbsp;<span class="op" id="7179680">:=</span>&nbsp;<span class="keyword" id="7179683">range</span>&nbsp;<span class="ident" id="7179689"><a href="/gostd/database/sql/sql_test.go.html#7179037">execTests</a></span>&nbsp;<span class="op" id="7179699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7179703">_</span><span class="op" id="7179704">,</span>&nbsp;<span class="ident" id="7179706">err</span>&nbsp;<span class="op" id="7179710">:=</span>&nbsp;<span class="ident" id="7179713"><a href="/gostd/database/sql/sql_test.go.html#7178833">stmt</a></span><span class="op" id="7179717">.</span><span class="ident" id="7179718"><a href="/gostd/database/sql/sql.go.html#5235241">Exec</a></span><span class="op" id="7179722">(</span><span class="ident" id="7179723"><a href="/gostd/database/sql/sql_test.go.html#7179677">et</a></span><span class="op" id="7179725">.</span><span class="ident" id="7179726"><a href="/gostd/database/sql/sql_test.go.html#7178994">args</a></span><span class="op" id="7179730">...</span><span class="op" id="7179733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7179737">errStr</span>&nbsp;<span class="op" id="7179744">:=</span>&nbsp;<span class="string" id="7179747">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7179752">if</span>&nbsp;<span class="ident" id="7179755"><a href="/gostd/database/sql/sql_test.go.html#7179706">err</a></span>&nbsp;<span class="op" id="7179759">!=</span>&nbsp;<span class="builtintype" id="7179762">nil</span>&nbsp;<span class="op" id="7179766">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7179771"><a href="/gostd/database/sql/sql_test.go.html#7179737">errStr</a></span>&nbsp;<span class="op" id="7179778">=</span>&nbsp;<span class="ident" id="7179780"><a href="/gostd/database/sql/sql_test.go.html#7179706">err</a></span><span class="op" id="7179783">.</span><span class="ident" id="7179784">Error</span><span class="op" id="7179789">(</span><span class="op" id="7179790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7179794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7179798">if</span>&nbsp;<span class="ident" id="7179801"><a href="/gostd/database/sql/sql_test.go.html#7179737">errStr</a></span>&nbsp;<span class="op" id="7179808">!=</span>&nbsp;<span class="ident" id="7179811"><a href="/gostd/database/sql/sql_test.go.html#7179677">et</a></span><span class="op" id="7179813">.</span><span class="ident" id="7179814"><a href="/gostd/database/sql/sql_test.go.html#7179018">wantErr</a></span>&nbsp;<span class="op" id="7179822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7179827"><a href="/gostd/database/sql/sql_test.go.html#7178709">t</a></span><span class="op" id="7179828">.</span><span class="ident" id="7179829"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7179835">(</span><span class="string" id="7179836">&#34;stmt.Execute&nbsp;#%d:&nbsp;for&nbsp;%v,&nbsp;got&nbsp;error&nbsp;%q,&nbsp;want&nbsp;error&nbsp;%q&#34;</span><span class="op" id="7179891">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7179897"><a href="/gostd/database/sql/sql_test.go.html#7179674">n</a></span><span class="op" id="7179898">,</span>&nbsp;<span class="ident" id="7179900"><a href="/gostd/database/sql/sql_test.go.html#7179677">et</a></span><span class="op" id="7179902">.</span><span class="ident" id="7179903"><a href="/gostd/database/sql/sql_test.go.html#7178994">args</a></span><span class="op" id="7179907">,</span>&nbsp;<span class="ident" id="7179909"><a href="/gostd/database/sql/sql_test.go.html#7179737">errStr</a></span><span class="op" id="7179915">,</span>&nbsp;<span class="ident" id="7179917"><a href="/gostd/database/sql/sql_test.go.html#7179677">et</a></span><span class="op" id="7179919">.</span><span class="ident" id="7179920"><a href="/gostd/database/sql/sql_test.go.html#7179018">wantErr</a></span><span class="op" id="7179927">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7179931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7179934">}</span><br>
<span class="lineno"></span><span class="op" id="7179936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7179939">func</span>&nbsp;<span class="ident" id="7179944">TestTxPrepare</span><span class="op" id="7179957">(</span><span class="ident" id="7179958">t</span>&nbsp;<span class="op" id="7179960">*</span><span class="ident" id="7179961"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7179968">.</span><span class="ident" id="7179969"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7179970">)</span>&nbsp;<span class="op" id="7179972">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7179975">db</span>&nbsp;<span class="op" id="7179978">:=</span>&nbsp;<span class="ident" id="7179981"><a href="/gostd/database/sql/sql_test.go.html#7169849">newTestDB</a></span><span class="op" id="7179990">(</span><span class="ident" id="7179991"><a href="/gostd/database/sql/sql_test.go.html#7179958">t</a></span><span class="op" id="7179992">,</span>&nbsp;<span class="string" id="7179994">&#34;&#34;</span><span class="op" id="7179996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7179999">defer</span>&nbsp;<span class="ident" id="7180005"><a href="/gostd/database/sql/sql_test.go.html#7170773">closeDB</a></span><span class="op" id="7180012">(</span><span class="ident" id="7180013"><a href="/gostd/database/sql/sql_test.go.html#7179958">t</a></span><span class="op" id="7180014">,</span>&nbsp;<span class="ident" id="7180016"><a href="/gostd/database/sql/sql_test.go.html#7179975">db</a></span><span class="op" id="7180018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7180021"><a href="/gostd/database/sql/sql_test.go.html#7170605">exec</a></span><span class="op" id="7180025">(</span><span class="ident" id="7180026"><a href="/gostd/database/sql/sql_test.go.html#7179958">t</a></span><span class="op" id="7180027">,</span>&nbsp;<span class="ident" id="7180029"><a href="/gostd/database/sql/sql_test.go.html#7179975">db</a></span><span class="op" id="7180031">,</span>&nbsp;<span class="string" id="7180033">&#34;CREATE|t1|name=string,age=int32,dead=bool&#34;</span><span class="op" id="7180076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7180079">tx</span><span class="op" id="7180081">,</span>&nbsp;<span class="ident" id="7180083">err</span>&nbsp;<span class="op" id="7180087">:=</span>&nbsp;<span class="ident" id="7180090"><a href="/gostd/database/sql/sql_test.go.html#7179975">db</a></span><span class="op" id="7180092">.</span><span class="ident" id="7180093"><a href="/gostd/database/sql/sql.go.html#5228078">Begin</a></span><span class="op" id="7180098">(</span><span class="op" id="7180099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7180102">if</span>&nbsp;<span class="ident" id="7180105"><a href="/gostd/database/sql/sql_test.go.html#7180083">err</a></span>&nbsp;<span class="op" id="7180109">!=</span>&nbsp;<span class="builtintype" id="7180112">nil</span>&nbsp;<span class="op" id="7180116">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7180120"><a href="/gostd/database/sql/sql_test.go.html#7179958">t</a></span><span class="op" id="7180121">.</span><span class="ident" id="7180122"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7180128">(</span><span class="string" id="7180129">&#34;Begin&nbsp;=&nbsp;%v&#34;</span><span class="op" id="7180141">,</span>&nbsp;<span class="ident" id="7180143"><a href="/gostd/database/sql/sql_test.go.html#7180083">err</a></span><span class="op" id="7180146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7180149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7180152">stmt</span><span class="op" id="7180156">,</span>&nbsp;<span class="ident" id="7180158"><a href="/gostd/database/sql/sql_test.go.html#7180083">err</a></span>&nbsp;<span class="op" id="7180162">:=</span>&nbsp;<span class="ident" id="7180165"><a href="/gostd/database/sql/sql_test.go.html#7180079">tx</a></span><span class="op" id="7180167">.</span><span class="ident" id="7180168"><a href="/gostd/database/sql/sql.go.html#5230667">Prepare</a></span><span class="op" id="7180175">(</span><span class="string" id="7180176">&#34;INSERT|t1|name=?,age=?&#34;</span><span class="op" id="7180200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7180203">if</span>&nbsp;<span class="ident" id="7180206"><a href="/gostd/database/sql/sql_test.go.html#7180083">err</a></span>&nbsp;<span class="op" id="7180210">!=</span>&nbsp;<span class="builtintype" id="7180213">nil</span>&nbsp;<span class="op" id="7180217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7180221"><a href="/gostd/database/sql/sql_test.go.html#7179958">t</a></span><span class="op" id="7180222">.</span><span class="ident" id="7180223"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7180229">(</span><span class="string" id="7180230">&#34;Stmt,&nbsp;err&nbsp;=&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="7180250">,</span>&nbsp;<span class="ident" id="7180252"><a href="/gostd/database/sql/sql_test.go.html#7180152">stmt</a></span><span class="op" id="7180256">,</span>&nbsp;<span class="ident" id="7180258"><a href="/gostd/database/sql/sql_test.go.html#7180083">err</a></span><span class="op" id="7180261">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7180264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7180267">defer</span>&nbsp;<span class="ident" id="7180273"><a href="/gostd/database/sql/sql_test.go.html#7180152">stmt</a></span><span class="op" id="7180277">.</span><span class="ident" id="7180278"><a href="/gostd/database/sql/sql.go.html#5240529">Close</a></span><span class="op" id="7180283">(</span><span class="op" id="7180284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7180287">_</span><span class="op" id="7180288">,</span>&nbsp;<span class="ident" id="7180290"><a href="/gostd/database/sql/sql_test.go.html#7180083">err</a></span>&nbsp;<span class="op" id="7180294">=</span>&nbsp;<span class="ident" id="7180296"><a href="/gostd/database/sql/sql_test.go.html#7180152">stmt</a></span><span class="op" id="7180300">.</span><span class="ident" id="7180301"><a href="/gostd/database/sql/sql.go.html#5235241">Exec</a></span><span class="op" id="7180305">(</span><span class="string" id="7180306">&#34;Bobby&#34;</span><span class="op" id="7180313">,</span>&nbsp;<span class="num" id="7180315">7</span><span class="op" id="7180316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7180319">if</span>&nbsp;<span class="ident" id="7180322"><a href="/gostd/database/sql/sql_test.go.html#7180083">err</a></span>&nbsp;<span class="op" id="7180326">!=</span>&nbsp;<span class="builtintype" id="7180329">nil</span>&nbsp;<span class="op" id="7180333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7180337"><a href="/gostd/database/sql/sql_test.go.html#7179958">t</a></span><span class="op" id="7180338">.</span><span class="ident" id="7180339"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7180345">(</span><span class="string" id="7180346">&#34;Exec&nbsp;=&nbsp;%v&#34;</span><span class="op" id="7180357">,</span>&nbsp;<span class="ident" id="7180359"><a href="/gostd/database/sql/sql_test.go.html#7180083">err</a></span><span class="op" id="7180362">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7180365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7180368"><a href="/gostd/database/sql/sql_test.go.html#7180083">err</a></span>&nbsp;<span class="op" id="7180372">=</span>&nbsp;<span class="ident" id="7180374"><a href="/gostd/database/sql/sql_test.go.html#7180079">tx</a></span><span class="op" id="7180376">.</span><span class="ident" id="7180377"><a href="/gostd/database/sql/sql.go.html#5229915">Commit</a></span><span class="op" id="7180383">(</span><span class="op" id="7180384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7180387">if</span>&nbsp;<span class="ident" id="7180390"><a href="/gostd/database/sql/sql_test.go.html#7180083">err</a></span>&nbsp;<span class="op" id="7180394">!=</span>&nbsp;<span class="builtintype" id="7180397">nil</span>&nbsp;<span class="op" id="7180401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7180405"><a href="/gostd/database/sql/sql_test.go.html#7179958">t</a></span><span class="op" id="7180406">.</span><span class="ident" id="7180407"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7180413">(</span><span class="string" id="7180414">&#34;Commit&nbsp;=&nbsp;%v&#34;</span><span class="op" id="7180427">,</span>&nbsp;<span class="ident" id="7180429"><a href="/gostd/database/sql/sql_test.go.html#7180083">err</a></span><span class="op" id="7180432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7180435">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7180438">//&nbsp;Commit()&nbsp;should&nbsp;have&nbsp;closed&nbsp;the&nbsp;statement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7180484">if</span>&nbsp;<span class="op" id="7180487">!</span><span class="ident" id="7180488"><a href="/gostd/database/sql/sql_test.go.html#7180152">stmt</a></span><span class="op" id="7180492">.</span><span class="ident" id="7180493"><a href="/gostd/database/sql/sql.go.html#5234840">closed</a></span>&nbsp;<span class="op" id="7180500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7180504"><a href="/gostd/database/sql/sql_test.go.html#7179958">t</a></span><span class="op" id="7180505">.</span><span class="ident" id="7180506"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="7180511">(</span><span class="string" id="7180512">&#34;Stmt&nbsp;not&nbsp;closed&nbsp;after&nbsp;Commit&#34;</span><span class="op" id="7180542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7180545">}</span><br>
<span class="lineno"></span><span class="op" id="7180547">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="keyword" id="7180550">func</span>&nbsp;<span class="ident" id="7180555">TestTxStmt</span><span class="op" id="7180565">(</span><span class="ident" id="7180566">t</span>&nbsp;<span class="op" id="7180568">*</span><span class="ident" id="7180569"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7180576">.</span><span class="ident" id="7180577"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7180578">)</span>&nbsp;<span class="op" id="7180580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7180583">db</span>&nbsp;<span class="op" id="7180586">:=</span>&nbsp;<span class="ident" id="7180589"><a href="/gostd/database/sql/sql_test.go.html#7169849">newTestDB</a></span><span class="op" id="7180598">(</span><span class="ident" id="7180599"><a href="/gostd/database/sql/sql_test.go.html#7180566">t</a></span><span class="op" id="7180600">,</span>&nbsp;<span class="string" id="7180602">&#34;&#34;</span><span class="op" id="7180604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7180607">defer</span>&nbsp;<span class="ident" id="7180613"><a href="/gostd/database/sql/sql_test.go.html#7170773">closeDB</a></span><span class="op" id="7180620">(</span><span class="ident" id="7180621"><a href="/gostd/database/sql/sql_test.go.html#7180566">t</a></span><span class="op" id="7180622">,</span>&nbsp;<span class="ident" id="7180624"><a href="/gostd/database/sql/sql_test.go.html#7180583">db</a></span><span class="op" id="7180626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7180629"><a href="/gostd/database/sql/sql_test.go.html#7170605">exec</a></span><span class="op" id="7180633">(</span><span class="ident" id="7180634"><a href="/gostd/database/sql/sql_test.go.html#7180566">t</a></span><span class="op" id="7180635">,</span>&nbsp;<span class="ident" id="7180637"><a href="/gostd/database/sql/sql_test.go.html#7180583">db</a></span><span class="op" id="7180639">,</span>&nbsp;<span class="string" id="7180641">&#34;CREATE|t1|name=string,age=int32,dead=bool&#34;</span><span class="op" id="7180684">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7180687">stmt</span><span class="op" id="7180691">,</span>&nbsp;<span class="ident" id="7180693">err</span>&nbsp;<span class="op" id="7180697">:=</span>&nbsp;<span class="ident" id="7180700"><a href="/gostd/database/sql/sql_test.go.html#7180583">db</a></span><span class="op" id="7180702">.</span><span class="ident" id="7180703"><a href="/gostd/database/sql/sql.go.html#5223860">Prepare</a></span><span class="op" id="7180710">(</span><span class="string" id="7180711">&#34;INSERT|t1|name=?,age=?&#34;</span><span class="op" id="7180735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7180738">if</span>&nbsp;<span class="ident" id="7180741"><a href="/gostd/database/sql/sql_test.go.html#7180693">err</a></span>&nbsp;<span class="op" id="7180745">!=</span>&nbsp;<span class="builtintype" id="7180748">nil</span>&nbsp;<span class="op" id="7180752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7180756"><a href="/gostd/database/sql/sql_test.go.html#7180566">t</a></span><span class="op" id="7180757">.</span><span class="ident" id="7180758"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7180764">(</span><span class="string" id="7180765">&#34;Stmt,&nbsp;err&nbsp;=&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="7180785">,</span>&nbsp;<span class="ident" id="7180787"><a href="/gostd/database/sql/sql_test.go.html#7180687">stmt</a></span><span class="op" id="7180791">,</span>&nbsp;<span class="ident" id="7180793"><a href="/gostd/database/sql/sql_test.go.html#7180693">err</a></span><span class="op" id="7180796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7180799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7180802">defer</span>&nbsp;<span class="ident" id="7180808"><a href="/gostd/database/sql/sql_test.go.html#7180687">stmt</a></span><span class="op" id="7180812">.</span><span class="ident" id="7180813"><a href="/gostd/database/sql/sql.go.html#5240529">Close</a></span><span class="op" id="7180818">(</span><span class="op" id="7180819">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7180822">tx</span><span class="op" id="7180824">,</span>&nbsp;<span class="ident" id="7180826"><a href="/gostd/database/sql/sql_test.go.html#7180693">err</a></span>&nbsp;<span class="op" id="7180830">:=</span>&nbsp;<span class="ident" id="7180833"><a href="/gostd/database/sql/sql_test.go.html#7180583">db</a></span><span class="op" id="7180835">.</span><span class="ident" id="7180836"><a href="/gostd/database/sql/sql.go.html#5228078">Begin</a></span><span class="op" id="7180841">(</span><span class="op" id="7180842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7180845">if</span>&nbsp;<span class="ident" id="7180848"><a href="/gostd/database/sql/sql_test.go.html#7180693">err</a></span>&nbsp;<span class="op" id="7180852">!=</span>&nbsp;<span class="builtintype" id="7180855">nil</span>&nbsp;<span class="op" id="7180859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7180863"><a href="/gostd/database/sql/sql_test.go.html#7180566">t</a></span><span class="op" id="7180864">.</span><span class="ident" id="7180865"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7180871">(</span><span class="string" id="7180872">&#34;Begin&nbsp;=&nbsp;%v&#34;</span><span class="op" id="7180884">,</span>&nbsp;<span class="ident" id="7180886"><a href="/gostd/database/sql/sql_test.go.html#7180693">err</a></span><span class="op" id="7180889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7180892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7180895">txs</span>&nbsp;<span class="op" id="7180899">:=</span>&nbsp;<span class="ident" id="7180902"><a href="/gostd/database/sql/sql_test.go.html#7180822">tx</a></span><span class="op" id="7180904">.</span><span class="ident" id="7180905"><a href="/gostd/database/sql/sql.go.html#5232149">Stmt</a></span><span class="op" id="7180909">(</span><span class="ident" id="7180910"><a href="/gostd/database/sql/sql_test.go.html#7180687">stmt</a></span><span class="op" id="7180914">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7180917">defer</span>&nbsp;<span class="ident" id="7180923"><a href="/gostd/database/sql/sql_test.go.html#7180895">txs</a></span><span class="op" id="7180926">.</span><span class="ident" id="7180927"><a href="/gostd/database/sql/sql.go.html#5240529">Close</a></span><span class="op" id="7180932">(</span><span class="op" id="7180933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7180936">_</span><span class="op" id="7180937">,</span>&nbsp;<span class="ident" id="7180939"><a href="/gostd/database/sql/sql_test.go.html#7180693">err</a></span>&nbsp;<span class="op" id="7180943">=</span>&nbsp;<span class="ident" id="7180945"><a href="/gostd/database/sql/sql_test.go.html#7180895">txs</a></span><span class="op" id="7180948">.</span><span class="ident" id="7180949"><a href="/gostd/database/sql/sql.go.html#5235241">Exec</a></span><span class="op" id="7180953">(</span><span class="string" id="7180954">&#34;Bobby&#34;</span><span class="op" id="7180961">,</span>&nbsp;<span class="num" id="7180963">7</span><span class="op" id="7180964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7180967">if</span>&nbsp;<span class="ident" id="7180970"><a href="/gostd/database/sql/sql_test.go.html#7180693">err</a></span>&nbsp;<span class="op" id="7180974">!=</span>&nbsp;<span class="builtintype" id="7180977">nil</span>&nbsp;<span class="op" id="7180981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7180985"><a href="/gostd/database/sql/sql_test.go.html#7180566">t</a></span><span class="op" id="7180986">.</span><span class="ident" id="7180987"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7180993">(</span><span class="string" id="7180994">&#34;Exec&nbsp;=&nbsp;%v&#34;</span><span class="op" id="7181005">,</span>&nbsp;<span class="ident" id="7181007"><a href="/gostd/database/sql/sql_test.go.html#7180693">err</a></span><span class="op" id="7181010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7181013">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7181016"><a href="/gostd/database/sql/sql_test.go.html#7180693">err</a></span>&nbsp;<span class="op" id="7181020">=</span>&nbsp;<span class="ident" id="7181022"><a href="/gostd/database/sql/sql_test.go.html#7180822">tx</a></span><span class="op" id="7181024">.</span><span class="ident" id="7181025"><a href="/gostd/database/sql/sql.go.html#5229915">Commit</a></span><span class="op" id="7181031">(</span><span class="op" id="7181032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7181035">if</span>&nbsp;<span class="ident" id="7181038"><a href="/gostd/database/sql/sql_test.go.html#7180693">err</a></span>&nbsp;<span class="op" id="7181042">!=</span>&nbsp;<span class="builtintype" id="7181045">nil</span>&nbsp;<span class="op" id="7181049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7181053"><a href="/gostd/database/sql/sql_test.go.html#7180566">t</a></span><span class="op" id="7181054">.</span><span class="ident" id="7181055"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7181061">(</span><span class="string" id="7181062">&#34;Commit&nbsp;=&nbsp;%v&#34;</span><span class="op" id="7181075">,</span>&nbsp;<span class="ident" id="7181077"><a href="/gostd/database/sql/sql_test.go.html#7180693">err</a></span><span class="op" id="7181080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7181083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7181086">//&nbsp;Commit()&nbsp;should&nbsp;have&nbsp;closed&nbsp;the&nbsp;statement</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7181132">if</span>&nbsp;<span class="op" id="7181135">!</span><span class="ident" id="7181136"><a href="/gostd/database/sql/sql_test.go.html#7180895">txs</a></span><span class="op" id="7181139">.</span><span class="ident" id="7181140"><a href="/gostd/database/sql/sql.go.html#5234840">closed</a></span>&nbsp;<span class="op" id="7181147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7181151"><a href="/gostd/database/sql/sql_test.go.html#7180566">t</a></span><span class="op" id="7181152">.</span><span class="ident" id="7181153"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="7181158">(</span><span class="string" id="7181159">&#34;Stmt&nbsp;not&nbsp;closed&nbsp;after&nbsp;Commit&#34;</span><span class="op" id="7181189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7181192">}</span><br>
<span class="lineno"></span><span class="op" id="7181194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span><span class="comment" id="7181197">//&nbsp;Issue:&nbsp;http://golang.org/issue/2784</span><br>
<span class="lineno"></span><span class="comment" id="7181236">//&nbsp;This&nbsp;test&nbsp;didn&#39;t&nbsp;fail&nbsp;before&nbsp;because&nbsp;we&nbsp;got&nbsp;lucky&nbsp;with&nbsp;the&nbsp;fakedb&nbsp;driver.</span><br>
<span class="lineno"></span><span class="comment" id="7181313">//&nbsp;It&nbsp;was&nbsp;failing,&nbsp;and&nbsp;now&nbsp;not,&nbsp;in&nbsp;github.com/bradfitz/go-sql-test</span><br>
<span class="lineno"></span><span class="keyword" id="7181380">func</span>&nbsp;<span class="ident" id="7181385">TestTxQuery</span><span class="op" id="7181396">(</span><span class="ident" id="7181397">t</span>&nbsp;<span class="op" id="7181399">*</span><span class="ident" id="7181400"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7181407">.</span><span class="ident" id="7181408"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7181409">)</span>&nbsp;<span class="op" id="7181411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7181414">db</span>&nbsp;<span class="op" id="7181417">:=</span>&nbsp;<span class="ident" id="7181420"><a href="/gostd/database/sql/sql_test.go.html#7169849">newTestDB</a></span><span class="op" id="7181429">(</span><span class="ident" id="7181430"><a href="/gostd/database/sql/sql_test.go.html#7181397">t</a></span><span class="op" id="7181431">,</span>&nbsp;<span class="string" id="7181433">&#34;&#34;</span><span class="op" id="7181435">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7181438">defer</span>&nbsp;<span class="ident" id="7181444"><a href="/gostd/database/sql/sql_test.go.html#7170773">closeDB</a></span><span class="op" id="7181451">(</span><span class="ident" id="7181452"><a href="/gostd/database/sql/sql_test.go.html#7181397">t</a></span><span class="op" id="7181453">,</span>&nbsp;<span class="ident" id="7181455"><a href="/gostd/database/sql/sql_test.go.html#7181414">db</a></span><span class="op" id="7181457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7181460"><a href="/gostd/database/sql/sql_test.go.html#7170605">exec</a></span><span class="op" id="7181464">(</span><span class="ident" id="7181465"><a href="/gostd/database/sql/sql_test.go.html#7181397">t</a></span><span class="op" id="7181466">,</span>&nbsp;<span class="ident" id="7181468"><a href="/gostd/database/sql/sql_test.go.html#7181414">db</a></span><span class="op" id="7181470">,</span>&nbsp;<span class="string" id="7181472">&#34;CREATE|t1|name=string,age=int32,dead=bool&#34;</span><span class="op" id="7181515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7181518"><a href="/gostd/database/sql/sql_test.go.html#7170605">exec</a></span><span class="op" id="7181522">(</span><span class="ident" id="7181523"><a href="/gostd/database/sql/sql_test.go.html#7181397">t</a></span><span class="op" id="7181524">,</span>&nbsp;<span class="ident" id="7181526"><a href="/gostd/database/sql/sql_test.go.html#7181414">db</a></span><span class="op" id="7181528">,</span>&nbsp;<span class="string" id="7181530">&#34;INSERT|t1|name=Alice&#34;</span><span class="op" id="7181552">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7181556">tx</span><span class="op" id="7181558">,</span>&nbsp;<span class="ident" id="7181560">err</span>&nbsp;<span class="op" id="7181564">:=</span>&nbsp;<span class="ident" id="7181567"><a href="/gostd/database/sql/sql_test.go.html#7181414">db</a></span><span class="op" id="7181569">.</span><span class="ident" id="7181570"><a href="/gostd/database/sql/sql.go.html#5228078">Begin</a></span><span class="op" id="7181575">(</span><span class="op" id="7181576">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7181579">if</span>&nbsp;<span class="ident" id="7181582"><a href="/gostd/database/sql/sql_test.go.html#7181560">err</a></span>&nbsp;<span class="op" id="7181586">!=</span>&nbsp;<span class="builtintype" id="7181589">nil</span>&nbsp;<span class="op" id="7181593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7181597"><a href="/gostd/database/sql/sql_test.go.html#7181397">t</a></span><span class="op" id="7181598">.</span><span class="ident" id="7181599"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="7181604">(</span><span class="ident" id="7181605"><a href="/gostd/database/sql/sql_test.go.html#7181560">err</a></span><span class="op" id="7181608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7181611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7181614">defer</span>&nbsp;<span class="ident" id="7181620"><a href="/gostd/database/sql/sql_test.go.html#7181556">tx</a></span><span class="op" id="7181622">.</span><span class="ident" id="7181623"><a href="/gostd/database/sql/sql.go.html#5230160">Rollback</a></span><span class="op" id="7181631">(</span><span class="op" id="7181632">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7181636">r</span><span class="op" id="7181637">,</span>&nbsp;<span class="ident" id="7181639"><a href="/gostd/database/sql/sql_test.go.html#7181560">err</a></span>&nbsp;<span class="op" id="7181643">:=</span>&nbsp;<span class="ident" id="7181646"><a href="/gostd/database/sql/sql_test.go.html#7181556">tx</a></span><span class="op" id="7181648">.</span><span class="ident" id="7181649"><a href="/gostd/database/sql/sql.go.html#5233709">Query</a></span><span class="op" id="7181654">(</span><span class="string" id="7181655">&#34;SELECT|t1|name|&#34;</span><span class="op" id="7181672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7181675">if</span>&nbsp;<span class="ident" id="7181678"><a href="/gostd/database/sql/sql_test.go.html#7181560">err</a></span>&nbsp;<span class="op" id="7181682">!=</span>&nbsp;<span class="builtintype" id="7181685">nil</span>&nbsp;<span class="op" id="7181689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7181693"><a href="/gostd/database/sql/sql_test.go.html#7181397">t</a></span><span class="op" id="7181694">.</span><span class="ident" id="7181695"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="7181700">(</span><span class="ident" id="7181701"><a href="/gostd/database/sql/sql_test.go.html#7181560">err</a></span><span class="op" id="7181704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7181707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7181710">defer</span>&nbsp;<span class="ident" id="7181716"><a href="/gostd/database/sql/sql_test.go.html#7181636">r</a></span><span class="op" id="7181717">.</span><span class="ident" id="7181718"><a href="/gostd/database/sql/sql.go.html#5244447">Close</a></span><span class="op" id="7181723">(</span><span class="op" id="7181724">)</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7181728">if</span>&nbsp;<span class="op" id="7181731">!</span><span class="ident" id="7181732"><a href="/gostd/database/sql/sql_test.go.html#7181636">r</a></span><span class="op" id="7181733">.</span><span class="ident" id="7181734"><a href="/gostd/database/sql/sql.go.html#5242163">Next</a></span><span class="op" id="7181738">(</span><span class="op" id="7181739">)</span>&nbsp;<span class="op" id="7181741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7181745">if</span>&nbsp;<span class="ident" id="7181748"><a href="/gostd/database/sql/sql_test.go.html#7181636">r</a></span><span class="op" id="7181749">.</span><span class="ident" id="7181750"><a href="/gostd/database/sql/sql.go.html#5242560">Err</a></span><span class="op" id="7181753">(</span><span class="op" id="7181754">)</span>&nbsp;<span class="op" id="7181756">!=</span>&nbsp;<span class="builtintype" id="7181759">nil</span>&nbsp;<span class="op" id="7181763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7181768"><a href="/gostd/database/sql/sql_test.go.html#7181397">t</a></span><span class="op" id="7181769">.</span><span class="ident" id="7181770"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="7181775">(</span><span class="ident" id="7181776"><a href="/gostd/database/sql/sql_test.go.html#7181636">r</a></span><span class="op" id="7181777">.</span><span class="ident" id="7181778"><a href="/gostd/database/sql/sql.go.html#5242560">Err</a></span><span class="op" id="7181781">(</span><span class="op" id="7181782">)</span><span class="op" id="7181783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7181787">}</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7181791"><a href="/gostd/database/sql/sql_test.go.html#7181397">t</a></span><span class="op" id="7181792">.</span><span class="ident" id="7181793"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="7181798">(</span><span class="string" id="7181799">&#34;expected&nbsp;one&nbsp;row&#34;</span><span class="op" id="7181817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7181820">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7181824">var</span>&nbsp;<span class="ident" id="7181828">x</span>&nbsp;<span class="builtintype" id="7181830">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7181838"><a href="/gostd/database/sql/sql_test.go.html#7181560">err</a></span>&nbsp;<span class="op" id="7181842">=</span>&nbsp;<span class="ident" id="7181844"><a href="/gostd/database/sql/sql_test.go.html#7181636">r</a></span><span class="op" id="7181845">.</span><span class="ident" id="7181846"><a href="/gostd/database/sql/sql.go.html#5243651">Scan</a></span><span class="op" id="7181850">(</span><span class="op" id="7181851">&amp;</span><span class="ident" id="7181852"><a href="/gostd/database/sql/sql_test.go.html#7181828">x</a></span><span class="op" id="7181853">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7181856">if</span>&nbsp;<span class="ident" id="7181859"><a href="/gostd/database/sql/sql_test.go.html#7181560">err</a></span>&nbsp;<span class="op" id="7181863">!=</span>&nbsp;<span class="builtintype" id="7181866">nil</span>&nbsp;<span class="op" id="7181870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7181874"><a href="/gostd/database/sql/sql_test.go.html#7181397">t</a></span><span class="op" id="7181875">.</span><span class="ident" id="7181876"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="7181881">(</span><span class="ident" id="7181882"><a href="/gostd/database/sql/sql_test.go.html#7181560">err</a></span><span class="op" id="7181885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7181888">}</span><br>
<span class="lineno"></span><span class="op" id="7181890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="keyword" id="7181893">func</span>&nbsp;<span class="ident" id="7181898">TestTxQueryInvalid</span><span class="op" id="7181916">(</span><span class="ident" id="7181917">t</span>&nbsp;<span class="op" id="7181919">*</span><span class="ident" id="7181920"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7181927">.</span><span class="ident" id="7181928"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7181929">)</span>&nbsp;<span class="op" id="7181931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7181934">db</span>&nbsp;<span class="op" id="7181937">:=</span>&nbsp;<span class="ident" id="7181940"><a href="/gostd/database/sql/sql_test.go.html#7169849">newTestDB</a></span><span class="op" id="7181949">(</span><span class="ident" id="7181950"><a href="/gostd/database/sql/sql_test.go.html#7181917">t</a></span><span class="op" id="7181951">,</span>&nbsp;<span class="string" id="7181953">&#34;&#34;</span><span class="op" id="7181955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7181958">defer</span>&nbsp;<span class="ident" id="7181964"><a href="/gostd/database/sql/sql_test.go.html#7170773">closeDB</a></span><span class="op" id="7181971">(</span><span class="ident" id="7181972"><a href="/gostd/database/sql/sql_test.go.html#7181917">t</a></span><span class="op" id="7181973">,</span>&nbsp;<span class="ident" id="7181975"><a href="/gostd/database/sql/sql_test.go.html#7181934">db</a></span><span class="op" id="7181977">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7181981">tx</span><span class="op" id="7181983">,</span>&nbsp;<span class="ident" id="7181985">err</span>&nbsp;<span class="op" id="7181989">:=</span>&nbsp;<span class="ident" id="7181992"><a href="/gostd/database/sql/sql_test.go.html#7181934">db</a></span><span class="op" id="7181994">.</span><span class="ident" id="7181995"><a href="/gostd/database/sql/sql.go.html#5228078">Begin</a></span><span class="op" id="7182000">(</span><span class="op" id="7182001">)</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7182004">if</span>&nbsp;<span class="ident" id="7182007"><a href="/gostd/database/sql/sql_test.go.html#7181985">err</a></span>&nbsp;<span class="op" id="7182011">!=</span>&nbsp;<span class="builtintype" id="7182014">nil</span>&nbsp;<span class="op" id="7182018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7182022"><a href="/gostd/database/sql/sql_test.go.html#7181917">t</a></span><span class="op" id="7182023">.</span><span class="ident" id="7182024"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="7182029">(</span><span class="ident" id="7182030"><a href="/gostd/database/sql/sql_test.go.html#7181985">err</a></span><span class="op" id="7182033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7182036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7182039">defer</span>&nbsp;<span class="ident" id="7182045"><a href="/gostd/database/sql/sql_test.go.html#7181981">tx</a></span><span class="op" id="7182047">.</span><span class="ident" id="7182048"><a href="/gostd/database/sql/sql.go.html#5230160">Rollback</a></span><span class="op" id="7182056">(</span><span class="op" id="7182057">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7182061">_</span><span class="op" id="7182062">,</span>&nbsp;<span class="ident" id="7182064"><a href="/gostd/database/sql/sql_test.go.html#7181985">err</a></span>&nbsp;<span class="op" id="7182068">=</span>&nbsp;<span class="ident" id="7182070"><a href="/gostd/database/sql/sql_test.go.html#7181981">tx</a></span><span class="op" id="7182072">.</span><span class="ident" id="7182073"><a href="/gostd/database/sql/sql.go.html#5233709">Query</a></span><span class="op" id="7182078">(</span><span class="string" id="7182079">&#34;SELECT|t1|name|&#34;</span><span class="op" id="7182096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7182099">if</span>&nbsp;<span class="ident" id="7182102"><a href="/gostd/database/sql/sql_test.go.html#7181985">err</a></span>&nbsp;<span class="op" id="7182106">==</span>&nbsp;<span class="builtintype" id="7182109">nil</span>&nbsp;<span class="op" id="7182113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7182117"><a href="/gostd/database/sql/sql_test.go.html#7181917">t</a></span><span class="op" id="7182118">.</span><span class="ident" id="7182119"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="7182124">(</span><span class="string" id="7182125">&#34;Error&nbsp;expected&#34;</span><span class="op" id="7182141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7182144">}</span><br>
<span class="lineno"></span><span class="op" id="7182146">}</span><br>
<span class="lineno">550</span><br>
<span class="lineno"></span><span class="comment" id="7182149">//&nbsp;Tests&nbsp;fix&nbsp;for&nbsp;issue&nbsp;4433,&nbsp;that&nbsp;retries&nbsp;in&nbsp;Begin&nbsp;happen&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="7182212">//&nbsp;conn.Begin()&nbsp;returns&nbsp;ErrBadConn</span><br>
<span class="lineno"></span><span class="keyword" id="7182247">func</span>&nbsp;<span class="ident" id="7182252">TestTxErrBadConn</span><span class="op" id="7182268">(</span><span class="ident" id="7182269">t</span>&nbsp;<span class="op" id="7182271">*</span><span class="ident" id="7182272"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7182279">.</span><span class="ident" id="7182280"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7182281">)</span>&nbsp;<span class="op" id="7182283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7182286">db</span><span class="op" id="7182288">,</span>&nbsp;<span class="ident" id="7182290">err</span>&nbsp;<span class="op" id="7182294">:=</span>&nbsp;<span class="ident" id="7182297"><a href="/gostd/database/sql/sql.go.html#5213876">Open</a></span><span class="op" id="7182301">(</span><span class="string" id="7182302">&#34;test&#34;</span><span class="op" id="7182308">,</span>&nbsp;<span class="ident" id="7182310"><a href="/gostd/database/sql/sql_test.go.html#7169779">fakeDBName</a></span><span class="op" id="7182320">+</span><span class="string" id="7182321">&#34;;badConn&#34;</span><span class="op" id="7182331">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7182334">if</span>&nbsp;<span class="ident" id="7182337"><a href="/gostd/database/sql/sql_test.go.html#7182290">err</a></span>&nbsp;<span class="op" id="7182341">!=</span>&nbsp;<span class="builtintype" id="7182344">nil</span>&nbsp;<span class="op" id="7182348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7182352"><a href="/gostd/database/sql/sql_test.go.html#7182269">t</a></span><span class="op" id="7182353">.</span><span class="ident" id="7182354"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7182360">(</span><span class="string" id="7182361">&#34;Open:&nbsp;%v&#34;</span><span class="op" id="7182371">,</span>&nbsp;<span class="ident" id="7182373"><a href="/gostd/database/sql/sql_test.go.html#7182290">err</a></span><span class="op" id="7182376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7182379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7182382">if</span>&nbsp;<span class="ident" id="7182385">_</span><span class="op" id="7182386">,</span>&nbsp;<span class="ident" id="7182388">err</span>&nbsp;<span class="op" id="7182392">:=</span>&nbsp;<span class="ident" id="7182395"><a href="/gostd/database/sql/sql_test.go.html#7182286">db</a></span><span class="op" id="7182397">.</span><span class="ident" id="7182398"><a href="/gostd/database/sql/sql.go.html#5224928">Exec</a></span><span class="op" id="7182402">(</span><span class="string" id="7182403">&#34;WIPE&#34;</span><span class="op" id="7182409">)</span><span class="op" id="7182410">;</span>&nbsp;<span class="ident" id="7182412"><a href="/gostd/database/sql/sql_test.go.html#7182388">err</a></span>&nbsp;<span class="op" id="7182416">!=</span>&nbsp;<span class="builtintype" id="7182419">nil</span>&nbsp;<span class="op" id="7182423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7182427"><a href="/gostd/database/sql/sql_test.go.html#7182269">t</a></span><span class="op" id="7182428">.</span><span class="ident" id="7182429"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7182435">(</span><span class="string" id="7182436">&#34;exec&nbsp;wipe:&nbsp;%v&#34;</span><span class="op" id="7182451">,</span>&nbsp;<span class="ident" id="7182453"><a href="/gostd/database/sql/sql_test.go.html#7182388">err</a></span><span class="op" id="7182456">)</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7182459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7182462">defer</span>&nbsp;<span class="ident" id="7182468"><a href="/gostd/database/sql/sql_test.go.html#7170773">closeDB</a></span><span class="op" id="7182475">(</span><span class="ident" id="7182476"><a href="/gostd/database/sql/sql_test.go.html#7182269">t</a></span><span class="op" id="7182477">,</span>&nbsp;<span class="ident" id="7182479"><a href="/gostd/database/sql/sql_test.go.html#7182286">db</a></span><span class="op" id="7182481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7182484"><a href="/gostd/database/sql/sql_test.go.html#7170605">exec</a></span><span class="op" id="7182488">(</span><span class="ident" id="7182489"><a href="/gostd/database/sql/sql_test.go.html#7182269">t</a></span><span class="op" id="7182490">,</span>&nbsp;<span class="ident" id="7182492"><a href="/gostd/database/sql/sql_test.go.html#7182286">db</a></span><span class="op" id="7182494">,</span>&nbsp;<span class="string" id="7182496">&#34;CREATE|t1|name=string,age=int32,dead=bool&#34;</span><span class="op" id="7182539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7182542">stmt</span><span class="op" id="7182546">,</span>&nbsp;<span class="ident" id="7182548"><a href="/gostd/database/sql/sql_test.go.html#7182290">err</a></span>&nbsp;<span class="op" id="7182552">:=</span>&nbsp;<span class="ident" id="7182555"><a href="/gostd/database/sql/sql_test.go.html#7182286">db</a></span><span class="op" id="7182557">.</span><span class="ident" id="7182558"><a href="/gostd/database/sql/sql.go.html#5223860">Prepare</a></span><span class="op" id="7182565">(</span><span class="string" id="7182566">&#34;INSERT|t1|name=?,age=?&#34;</span><span class="op" id="7182590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7182593">if</span>&nbsp;<span class="ident" id="7182596"><a href="/gostd/database/sql/sql_test.go.html#7182290">err</a></span>&nbsp;<span class="op" id="7182600">!=</span>&nbsp;<span class="builtintype" id="7182603">nil</span>&nbsp;<span class="op" id="7182607">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7182611"><a href="/gostd/database/sql/sql_test.go.html#7182269">t</a></span><span class="op" id="7182612">.</span><span class="ident" id="7182613"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7182619">(</span><span class="string" id="7182620">&#34;Stmt,&nbsp;err&nbsp;=&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="7182640">,</span>&nbsp;<span class="ident" id="7182642"><a href="/gostd/database/sql/sql_test.go.html#7182542">stmt</a></span><span class="op" id="7182646">,</span>&nbsp;<span class="ident" id="7182648"><a href="/gostd/database/sql/sql_test.go.html#7182290">err</a></span><span class="op" id="7182651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7182654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7182657">defer</span>&nbsp;<span class="ident" id="7182663"><a href="/gostd/database/sql/sql_test.go.html#7182542">stmt</a></span><span class="op" id="7182667">.</span><span class="ident" id="7182668"><a href="/gostd/database/sql/sql.go.html#5240529">Close</a></span><span class="op" id="7182673">(</span><span class="op" id="7182674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7182677">tx</span><span class="op" id="7182679">,</span>&nbsp;<span class="ident" id="7182681"><a href="/gostd/database/sql/sql_test.go.html#7182290">err</a></span>&nbsp;<span class="op" id="7182685">:=</span>&nbsp;<span class="ident" id="7182688"><a href="/gostd/database/sql/sql_test.go.html#7182286">db</a></span><span class="op" id="7182690">.</span><span class="ident" id="7182691"><a href="/gostd/database/sql/sql.go.html#5228078">Begin</a></span><span class="op" id="7182696">(</span><span class="op" id="7182697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7182700">if</span>&nbsp;<span class="ident" id="7182703"><a href="/gostd/database/sql/sql_test.go.html#7182290">err</a></span>&nbsp;<span class="op" id="7182707">!=</span>&nbsp;<span class="builtintype" id="7182710">nil</span>&nbsp;<span class="op" id="7182714">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7182718"><a href="/gostd/database/sql/sql_test.go.html#7182269">t</a></span><span class="op" id="7182719">.</span><span class="ident" id="7182720"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7182726">(</span><span class="string" id="7182727">&#34;Begin&nbsp;=&nbsp;%v&#34;</span><span class="op" id="7182739">,</span>&nbsp;<span class="ident" id="7182741"><a href="/gostd/database/sql/sql_test.go.html#7182290">err</a></span><span class="op" id="7182744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7182747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7182750">txs</span>&nbsp;<span class="op" id="7182754">:=</span>&nbsp;<span class="ident" id="7182757"><a href="/gostd/database/sql/sql_test.go.html#7182677">tx</a></span><span class="op" id="7182759">.</span><span class="ident" id="7182760"><a href="/gostd/database/sql/sql.go.html#5232149">Stmt</a></span><span class="op" id="7182764">(</span><span class="ident" id="7182765"><a href="/gostd/database/sql/sql_test.go.html#7182542">stmt</a></span><span class="op" id="7182769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7182772">defer</span>&nbsp;<span class="ident" id="7182778"><a href="/gostd/database/sql/sql_test.go.html#7182750">txs</a></span><span class="op" id="7182781">.</span><span class="ident" id="7182782"><a href="/gostd/database/sql/sql.go.html#5240529">Close</a></span><span class="op" id="7182787">(</span><span class="op" id="7182788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7182791">_</span><span class="op" id="7182792">,</span>&nbsp;<span class="ident" id="7182794"><a href="/gostd/database/sql/sql_test.go.html#7182290">err</a></span>&nbsp;<span class="op" id="7182798">=</span>&nbsp;<span class="ident" id="7182800"><a href="/gostd/database/sql/sql_test.go.html#7182750">txs</a></span><span class="op" id="7182803">.</span><span class="ident" id="7182804"><a href="/gostd/database/sql/sql.go.html#5235241">Exec</a></span><span class="op" id="7182808">(</span><span class="string" id="7182809">&#34;Bobby&#34;</span><span class="op" id="7182816">,</span>&nbsp;<span class="num" id="7182818">7</span><span class="op" id="7182819">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7182822">if</span>&nbsp;<span class="ident" id="7182825"><a href="/gostd/database/sql/sql_test.go.html#7182290">err</a></span>&nbsp;<span class="op" id="7182829">!=</span>&nbsp;<span class="builtintype" id="7182832">nil</span>&nbsp;<span class="op" id="7182836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7182840"><a href="/gostd/database/sql/sql_test.go.html#7182269">t</a></span><span class="op" id="7182841">.</span><span class="ident" id="7182842"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7182848">(</span><span class="string" id="7182849">&#34;Exec&nbsp;=&nbsp;%v&#34;</span><span class="op" id="7182860">,</span>&nbsp;<span class="ident" id="7182862"><a href="/gostd/database/sql/sql_test.go.html#7182290">err</a></span><span class="op" id="7182865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7182868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7182871"><a href="/gostd/database/sql/sql_test.go.html#7182290">err</a></span>&nbsp;<span class="op" id="7182875">=</span>&nbsp;<span class="ident" id="7182877"><a href="/gostd/database/sql/sql_test.go.html#7182677">tx</a></span><span class="op" id="7182879">.</span><span class="ident" id="7182880"><a href="/gostd/database/sql/sql.go.html#5229915">Commit</a></span><span class="op" id="7182886">(</span><span class="op" id="7182887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7182890">if</span>&nbsp;<span class="ident" id="7182893"><a href="/gostd/database/sql/sql_test.go.html#7182290">err</a></span>&nbsp;<span class="op" id="7182897">!=</span>&nbsp;<span class="builtintype" id="7182900">nil</span>&nbsp;<span class="op" id="7182904">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7182908"><a href="/gostd/database/sql/sql_test.go.html#7182269">t</a></span><span class="op" id="7182909">.</span><span class="ident" id="7182910"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7182916">(</span><span class="string" id="7182917">&#34;Commit&nbsp;=&nbsp;%v&#34;</span><span class="op" id="7182930">,</span>&nbsp;<span class="ident" id="7182932"><a href="/gostd/database/sql/sql_test.go.html#7182290">err</a></span><span class="op" id="7182935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7182938">}</span><br>
<span class="lineno"></span><span class="op" id="7182940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7182943">//&nbsp;Tests&nbsp;fix&nbsp;for&nbsp;issue&nbsp;2542,&nbsp;that&nbsp;we&nbsp;release&nbsp;a&nbsp;lock&nbsp;when&nbsp;querying&nbsp;on</span><br>
<span class="lineno">585</span><span class="comment" id="7183012">//&nbsp;a&nbsp;closed&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="7183036">func</span>&nbsp;<span class="ident" id="7183041">TestIssue2542Deadlock</span><span class="op" id="7183062">(</span><span class="ident" id="7183063">t</span>&nbsp;<span class="op" id="7183065">*</span><span class="ident" id="7183066"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7183073">.</span><span class="ident" id="7183074"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7183075">)</span>&nbsp;<span class="op" id="7183077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7183080">db</span>&nbsp;<span class="op" id="7183083">:=</span>&nbsp;<span class="ident" id="7183086"><a href="/gostd/database/sql/sql_test.go.html#7169849">newTestDB</a></span><span class="op" id="7183095">(</span><span class="ident" id="7183096"><a href="/gostd/database/sql/sql_test.go.html#7183063">t</a></span><span class="op" id="7183097">,</span>&nbsp;<span class="string" id="7183099">&#34;people&#34;</span><span class="op" id="7183107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7183110"><a href="/gostd/database/sql/sql_test.go.html#7170773">closeDB</a></span><span class="op" id="7183117">(</span><span class="ident" id="7183118"><a href="/gostd/database/sql/sql_test.go.html#7183063">t</a></span><span class="op" id="7183119">,</span>&nbsp;<span class="ident" id="7183121"><a href="/gostd/database/sql/sql_test.go.html#7183080">db</a></span><span class="op" id="7183123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7183126">for</span>&nbsp;<span class="ident" id="7183130">i</span>&nbsp;<span class="op" id="7183132">:=</span>&nbsp;<span class="num" id="7183135">0</span><span class="op" id="7183136">;</span>&nbsp;<span class="ident" id="7183138"><a href="/gostd/database/sql/sql_test.go.html#7183130">i</a></span>&nbsp;<span class="op" id="7183140">&lt;</span>&nbsp;<span class="num" id="7183142">2</span><span class="op" id="7183143">;</span>&nbsp;<span class="ident" id="7183145"><a href="/gostd/database/sql/sql_test.go.html#7183130">i</a></span><span class="op" id="7183146">++</span>&nbsp;<span class="op" id="7183149">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7183153">_</span><span class="op" id="7183154">,</span>&nbsp;<span class="ident" id="7183156">err</span>&nbsp;<span class="op" id="7183160">:=</span>&nbsp;<span class="ident" id="7183163"><a href="/gostd/database/sql/sql_test.go.html#7183080">db</a></span><span class="op" id="7183165">.</span><span class="ident" id="7183166"><a href="/gostd/database/sql/sql.go.html#5225993">Query</a></span><span class="op" id="7183171">(</span><span class="string" id="7183172">&#34;SELECT|people|age,name|&#34;</span><span class="op" id="7183197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7183201">if</span>&nbsp;<span class="ident" id="7183204"><a href="/gostd/database/sql/sql_test.go.html#7183156">err</a></span>&nbsp;<span class="op" id="7183208">==</span>&nbsp;<span class="builtintype" id="7183211">nil</span>&nbsp;<span class="op" id="7183215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7183220"><a href="/gostd/database/sql/sql_test.go.html#7183063">t</a></span><span class="op" id="7183221">.</span><span class="ident" id="7183222"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7183228">(</span><span class="string" id="7183229">&#34;expected&nbsp;error&#34;</span><span class="op" id="7183245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7183249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7183252">}</span><br>
<span class="lineno">595</span><span class="op" id="7183254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7183257">//&nbsp;From&nbsp;golang.org/issue/3865</span><br>
<span class="lineno"></span><span class="keyword" id="7183287">func</span>&nbsp;<span class="ident" id="7183292">TestCloseStmtBeforeRows</span><span class="op" id="7183315">(</span><span class="ident" id="7183316">t</span>&nbsp;<span class="op" id="7183318">*</span><span class="ident" id="7183319"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7183326">.</span><span class="ident" id="7183327"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7183328">)</span>&nbsp;<span class="op" id="7183330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7183333">db</span>&nbsp;<span class="op" id="7183336">:=</span>&nbsp;<span class="ident" id="7183339"><a href="/gostd/database/sql/sql_test.go.html#7169849">newTestDB</a></span><span class="op" id="7183348">(</span><span class="ident" id="7183349"><a href="/gostd/database/sql/sql_test.go.html#7183316">t</a></span><span class="op" id="7183350">,</span>&nbsp;<span class="string" id="7183352">&#34;people&#34;</span><span class="op" id="7183360">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7183363">defer</span>&nbsp;<span class="ident" id="7183369"><a href="/gostd/database/sql/sql_test.go.html#7170773">closeDB</a></span><span class="op" id="7183376">(</span><span class="ident" id="7183377"><a href="/gostd/database/sql/sql_test.go.html#7183316">t</a></span><span class="op" id="7183378">,</span>&nbsp;<span class="ident" id="7183380"><a href="/gostd/database/sql/sql_test.go.html#7183333">db</a></span><span class="op" id="7183382">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7183386">s</span><span class="op" id="7183387">,</span>&nbsp;<span class="ident" id="7183389">err</span>&nbsp;<span class="op" id="7183393">:=</span>&nbsp;<span class="ident" id="7183396"><a href="/gostd/database/sql/sql_test.go.html#7183333">db</a></span><span class="op" id="7183398">.</span><span class="ident" id="7183399"><a href="/gostd/database/sql/sql.go.html#5223860">Prepare</a></span><span class="op" id="7183406">(</span><span class="string" id="7183407">&#34;SELECT|people|name|&#34;</span><span class="op" id="7183428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7183431">if</span>&nbsp;<span class="ident" id="7183434"><a href="/gostd/database/sql/sql_test.go.html#7183389">err</a></span>&nbsp;<span class="op" id="7183438">!=</span>&nbsp;<span class="builtintype" id="7183441">nil</span>&nbsp;<span class="op" id="7183445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7183449"><a href="/gostd/database/sql/sql_test.go.html#7183316">t</a></span><span class="op" id="7183450">.</span><span class="ident" id="7183451"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="7183456">(</span><span class="ident" id="7183457"><a href="/gostd/database/sql/sql_test.go.html#7183389">err</a></span><span class="op" id="7183460">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7183463">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7183467">r</span><span class="op" id="7183468">,</span>&nbsp;<span class="ident" id="7183470"><a href="/gostd/database/sql/sql_test.go.html#7183389">err</a></span>&nbsp;<span class="op" id="7183474">:=</span>&nbsp;<span class="ident" id="7183477"><a href="/gostd/database/sql/sql_test.go.html#7183386">s</a></span><span class="op" id="7183478">.</span><span class="ident" id="7183479"><a href="/gostd/database/sql/sql.go.html#5238423">Query</a></span><span class="op" id="7183484">(</span><span class="op" id="7183485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7183488">if</span>&nbsp;<span class="ident" id="7183491"><a href="/gostd/database/sql/sql_test.go.html#7183389">err</a></span>&nbsp;<span class="op" id="7183495">!=</span>&nbsp;<span class="builtintype" id="7183498">nil</span>&nbsp;<span class="op" id="7183502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7183506"><a href="/gostd/database/sql/sql_test.go.html#7183386">s</a></span><span class="op" id="7183507">.</span><span class="ident" id="7183508"><a href="/gostd/database/sql/sql.go.html#5240529">Close</a></span><span class="op" id="7183513">(</span><span class="op" id="7183514">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7183518"><a href="/gostd/database/sql/sql_test.go.html#7183316">t</a></span><span class="op" id="7183519">.</span><span class="ident" id="7183520"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="7183525">(</span><span class="ident" id="7183526"><a href="/gostd/database/sql/sql_test.go.html#7183389">err</a></span><span class="op" id="7183529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7183532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7183536"><a href="/gostd/database/sql/sql_test.go.html#7183389">err</a></span>&nbsp;<span class="op" id="7183540">=</span>&nbsp;<span class="ident" id="7183542"><a href="/gostd/database/sql/sql_test.go.html#7183386">s</a></span><span class="op" id="7183543">.</span><span class="ident" id="7183544"><a href="/gostd/database/sql/sql.go.html#5240529">Close</a></span><span class="op" id="7183549">(</span><span class="op" id="7183550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7183553">if</span>&nbsp;<span class="ident" id="7183556"><a href="/gostd/database/sql/sql_test.go.html#7183389">err</a></span>&nbsp;<span class="op" id="7183560">!=</span>&nbsp;<span class="builtintype" id="7183563">nil</span>&nbsp;<span class="op" id="7183567">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7183571"><a href="/gostd/database/sql/sql_test.go.html#7183316">t</a></span><span class="op" id="7183572">.</span><span class="ident" id="7183573"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="7183578">(</span><span class="ident" id="7183579"><a href="/gostd/database/sql/sql_test.go.html#7183389">err</a></span><span class="op" id="7183582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7183585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7183589"><a href="/gostd/database/sql/sql_test.go.html#7183467">r</a></span><span class="op" id="7183590">.</span><span class="ident" id="7183591"><a href="/gostd/database/sql/sql.go.html#5244447">Close</a></span><span class="op" id="7183596">(</span><span class="op" id="7183597">)</span><br>
<span class="lineno"></span><span class="op" id="7183599">}</span><br>
<span class="lineno">620</span><br>
<span class="lineno"></span><span class="comment" id="7183602">//&nbsp;Tests&nbsp;fix&nbsp;for&nbsp;issue&nbsp;2788,&nbsp;that&nbsp;we&nbsp;bind&nbsp;nil&nbsp;to&nbsp;a&nbsp;[]byte&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="7183667">//&nbsp;value&nbsp;in&nbsp;the&nbsp;column&nbsp;is&nbsp;sql&nbsp;null</span><br>
<span class="lineno"></span><span class="keyword" id="7183702">func</span>&nbsp;<span class="ident" id="7183707">TestNullByteSlice</span><span class="op" id="7183724">(</span><span class="ident" id="7183725">t</span>&nbsp;<span class="op" id="7183727">*</span><span class="ident" id="7183728"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7183735">.</span><span class="ident" id="7183736"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7183737">)</span>&nbsp;<span class="op" id="7183739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7183742">db</span>&nbsp;<span class="op" id="7183745">:=</span>&nbsp;<span class="ident" id="7183748"><a href="/gostd/database/sql/sql_test.go.html#7169849">newTestDB</a></span><span class="op" id="7183757">(</span><span class="ident" id="7183758"><a href="/gostd/database/sql/sql_test.go.html#7183725">t</a></span><span class="op" id="7183759">,</span>&nbsp;<span class="string" id="7183761">&#34;&#34;</span><span class="op" id="7183763">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7183766">defer</span>&nbsp;<span class="ident" id="7183772"><a href="/gostd/database/sql/sql_test.go.html#7170773">closeDB</a></span><span class="op" id="7183779">(</span><span class="ident" id="7183780"><a href="/gostd/database/sql/sql_test.go.html#7183725">t</a></span><span class="op" id="7183781">,</span>&nbsp;<span class="ident" id="7183783"><a href="/gostd/database/sql/sql_test.go.html#7183742">db</a></span><span class="op" id="7183785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7183788"><a href="/gostd/database/sql/sql_test.go.html#7170605">exec</a></span><span class="op" id="7183792">(</span><span class="ident" id="7183793"><a href="/gostd/database/sql/sql_test.go.html#7183725">t</a></span><span class="op" id="7183794">,</span>&nbsp;<span class="ident" id="7183796"><a href="/gostd/database/sql/sql_test.go.html#7183742">db</a></span><span class="op" id="7183798">,</span>&nbsp;<span class="string" id="7183800">&#34;CREATE|t|id=int32,name=nullstring&#34;</span><span class="op" id="7183835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7183838"><a href="/gostd/database/sql/sql_test.go.html#7170605">exec</a></span><span class="op" id="7183842">(</span><span class="ident" id="7183843"><a href="/gostd/database/sql/sql_test.go.html#7183725">t</a></span><span class="op" id="7183844">,</span>&nbsp;<span class="ident" id="7183846"><a href="/gostd/database/sql/sql_test.go.html#7183742">db</a></span><span class="op" id="7183848">,</span>&nbsp;<span class="string" id="7183850">&#34;INSERT|t|id=10,name=?&#34;</span><span class="op" id="7183873">,</span>&nbsp;<span class="builtintype" id="7183875">nil</span><span class="op" id="7183878">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7183882">var</span>&nbsp;<span class="ident" id="7183886">name</span>&nbsp;<span class="op" id="7183891">[</span><span class="op" id="7183892">]</span><span class="builtintype" id="7183893">byte</span><br>
<span class="lineno">630</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7183900">err</span>&nbsp;<span class="op" id="7183904">:=</span>&nbsp;<span class="ident" id="7183907"><a href="/gostd/database/sql/sql_test.go.html#7183742">db</a></span><span class="op" id="7183909">.</span><span class="ident" id="7183910"><a href="/gostd/database/sql/sql.go.html#5227854">QueryRow</a></span><span class="op" id="7183918">(</span><span class="string" id="7183919">&#34;SELECT|t|name|id=?&#34;</span><span class="op" id="7183939">,</span>&nbsp;<span class="num" id="7183941">10</span><span class="op" id="7183943">)</span><span class="op" id="7183944">.</span><span class="ident" id="7183945"><a href="/gostd/database/sql/sql.go.html#5245114">Scan</a></span><span class="op" id="7183949">(</span><span class="op" id="7183950">&amp;</span><span class="ident" id="7183951"><a href="/gostd/database/sql/sql_test.go.html#7183886">name</a></span><span class="op" id="7183955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7183958">if</span>&nbsp;<span class="ident" id="7183961"><a href="/gostd/database/sql/sql_test.go.html#7183900">err</a></span>&nbsp;<span class="op" id="7183965">!=</span>&nbsp;<span class="builtintype" id="7183968">nil</span>&nbsp;<span class="op" id="7183972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7183976"><a href="/gostd/database/sql/sql_test.go.html#7183725">t</a></span><span class="op" id="7183977">.</span><span class="ident" id="7183978"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="7183983">(</span><span class="ident" id="7183984"><a href="/gostd/database/sql/sql_test.go.html#7183900">err</a></span><span class="op" id="7183987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7183990">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7183993">if</span>&nbsp;<span class="ident" id="7183996"><a href="/gostd/database/sql/sql_test.go.html#7183886">name</a></span>&nbsp;<span class="op" id="7184001">!=</span>&nbsp;<span class="builtintype" id="7184004">nil</span>&nbsp;<span class="op" id="7184008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7184012"><a href="/gostd/database/sql/sql_test.go.html#7183725">t</a></span><span class="op" id="7184013">.</span><span class="ident" id="7184014"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7184020">(</span><span class="string" id="7184021">&#34;name&nbsp;[]byte&nbsp;should&nbsp;be&nbsp;nil&nbsp;for&nbsp;null&nbsp;column&nbsp;value,&nbsp;got:&nbsp;%#v&#34;</span><span class="op" id="7184080">,</span>&nbsp;<span class="ident" id="7184082"><a href="/gostd/database/sql/sql_test.go.html#7183886">name</a></span><span class="op" id="7184086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7184089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7184093"><a href="/gostd/database/sql/sql_test.go.html#7170605">exec</a></span><span class="op" id="7184097">(</span><span class="ident" id="7184098"><a href="/gostd/database/sql/sql_test.go.html#7183725">t</a></span><span class="op" id="7184099">,</span>&nbsp;<span class="ident" id="7184101"><a href="/gostd/database/sql/sql_test.go.html#7183742">db</a></span><span class="op" id="7184103">,</span>&nbsp;<span class="string" id="7184105">&#34;INSERT|t|id=11,name=?&#34;</span><span class="op" id="7184128">,</span>&nbsp;<span class="string" id="7184130">&#34;bob&#34;</span><span class="op" id="7184135">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7184138"><a href="/gostd/database/sql/sql_test.go.html#7183900">err</a></span>&nbsp;<span class="op" id="7184142">=</span>&nbsp;<span class="ident" id="7184144"><a href="/gostd/database/sql/sql_test.go.html#7183742">db</a></span><span class="op" id="7184146">.</span><span class="ident" id="7184147"><a href="/gostd/database/sql/sql.go.html#5227854">QueryRow</a></span><span class="op" id="7184155">(</span><span class="string" id="7184156">&#34;SELECT|t|name|id=?&#34;</span><span class="op" id="7184176">,</span>&nbsp;<span class="num" id="7184178">11</span><span class="op" id="7184180">)</span><span class="op" id="7184181">.</span><span class="ident" id="7184182"><a href="/gostd/database/sql/sql.go.html#5245114">Scan</a></span><span class="op" id="7184186">(</span><span class="op" id="7184187">&amp;</span><span class="ident" id="7184188"><a href="/gostd/database/sql/sql_test.go.html#7183886">name</a></span><span class="op" id="7184192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7184195">if</span>&nbsp;<span class="ident" id="7184198"><a href="/gostd/database/sql/sql_test.go.html#7183900">err</a></span>&nbsp;<span class="op" id="7184202">!=</span>&nbsp;<span class="builtintype" id="7184205">nil</span>&nbsp;<span class="op" id="7184209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7184213"><a href="/gostd/database/sql/sql_test.go.html#7183725">t</a></span><span class="op" id="7184214">.</span><span class="ident" id="7184215"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="7184220">(</span><span class="ident" id="7184221"><a href="/gostd/database/sql/sql_test.go.html#7183900">err</a></span><span class="op" id="7184224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7184227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7184230">if</span>&nbsp;<span class="builtintype" id="7184233">string</span><span class="op" id="7184239">(</span><span class="ident" id="7184240"><a href="/gostd/database/sql/sql_test.go.html#7183886">name</a></span><span class="op" id="7184244">)</span>&nbsp;<span class="op" id="7184246">!=</span>&nbsp;<span class="string" id="7184249">&#34;bob&#34;</span>&nbsp;<span class="op" id="7184255">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7184259"><a href="/gostd/database/sql/sql_test.go.html#7183725">t</a></span><span class="op" id="7184260">.</span><span class="ident" id="7184261"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7184267">(</span><span class="string" id="7184268">&#34;name&nbsp;[]byte&nbsp;should&nbsp;be&nbsp;bob,&nbsp;got:&nbsp;%q&#34;</span><span class="op" id="7184304">,</span>&nbsp;<span class="builtintype" id="7184306">string</span><span class="op" id="7184312">(</span><span class="ident" id="7184313"><a href="/gostd/database/sql/sql_test.go.html#7183886">name</a></span><span class="op" id="7184317">)</span><span class="op" id="7184318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7184321">}</span><br>
<span class="lineno"></span><span class="op" id="7184323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7184326">func</span>&nbsp;<span class="ident" id="7184331">TestPointerParamsAndScans</span><span class="op" id="7184356">(</span><span class="ident" id="7184357">t</span>&nbsp;<span class="op" id="7184359">*</span><span class="ident" id="7184360"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7184367">.</span><span class="ident" id="7184368"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7184369">)</span>&nbsp;<span class="op" id="7184371">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7184374">db</span>&nbsp;<span class="op" id="7184377">:=</span>&nbsp;<span class="ident" id="7184380"><a href="/gostd/database/sql/sql_test.go.html#7169849">newTestDB</a></span><span class="op" id="7184389">(</span><span class="ident" id="7184390"><a href="/gostd/database/sql/sql_test.go.html#7184357">t</a></span><span class="op" id="7184391">,</span>&nbsp;<span class="string" id="7184393">&#34;&#34;</span><span class="op" id="7184395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7184398">defer</span>&nbsp;<span class="ident" id="7184404"><a href="/gostd/database/sql/sql_test.go.html#7170773">closeDB</a></span><span class="op" id="7184411">(</span><span class="ident" id="7184412"><a href="/gostd/database/sql/sql_test.go.html#7184357">t</a></span><span class="op" id="7184413">,</span>&nbsp;<span class="ident" id="7184415"><a href="/gostd/database/sql/sql_test.go.html#7184374">db</a></span><span class="op" id="7184417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7184420"><a href="/gostd/database/sql/sql_test.go.html#7170605">exec</a></span><span class="op" id="7184424">(</span><span class="ident" id="7184425"><a href="/gostd/database/sql/sql_test.go.html#7184357">t</a></span><span class="op" id="7184426">,</span>&nbsp;<span class="ident" id="7184428"><a href="/gostd/database/sql/sql_test.go.html#7184374">db</a></span><span class="op" id="7184430">,</span>&nbsp;<span class="string" id="7184432">&#34;CREATE|t|id=int32,name=nullstring&#34;</span><span class="op" id="7184467">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7184471">bob</span>&nbsp;<span class="op" id="7184475">:=</span>&nbsp;<span class="string" id="7184478">&#34;bob&#34;</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7184485">var</span>&nbsp;<span class="ident" id="7184489">name</span>&nbsp;<span class="op" id="7184494">*</span><span class="builtintype" id="7184495">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7184504"><a href="/gostd/database/sql/sql_test.go.html#7184489">name</a></span>&nbsp;<span class="op" id="7184509">=</span>&nbsp;<span class="op" id="7184511">&amp;</span><span class="ident" id="7184512"><a href="/gostd/database/sql/sql_test.go.html#7184471">bob</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7184517"><a href="/gostd/database/sql/sql_test.go.html#7170605">exec</a></span><span class="op" id="7184521">(</span><span class="ident" id="7184522"><a href="/gostd/database/sql/sql_test.go.html#7184357">t</a></span><span class="op" id="7184523">,</span>&nbsp;<span class="ident" id="7184525"><a href="/gostd/database/sql/sql_test.go.html#7184374">db</a></span><span class="op" id="7184527">,</span>&nbsp;<span class="string" id="7184529">&#34;INSERT|t|id=10,name=?&#34;</span><span class="op" id="7184552">,</span>&nbsp;<span class="ident" id="7184554"><a href="/gostd/database/sql/sql_test.go.html#7184489">name</a></span><span class="op" id="7184558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7184561"><a href="/gostd/database/sql/sql_test.go.html#7184489">name</a></span>&nbsp;<span class="op" id="7184566">=</span>&nbsp;<span class="builtintype" id="7184568">nil</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7184573"><a href="/gostd/database/sql/sql_test.go.html#7170605">exec</a></span><span class="op" id="7184577">(</span><span class="ident" id="7184578"><a href="/gostd/database/sql/sql_test.go.html#7184357">t</a></span><span class="op" id="7184579">,</span>&nbsp;<span class="ident" id="7184581"><a href="/gostd/database/sql/sql_test.go.html#7184374">db</a></span><span class="op" id="7184583">,</span>&nbsp;<span class="string" id="7184585">&#34;INSERT|t|id=20,name=?&#34;</span><span class="op" id="7184608">,</span>&nbsp;<span class="ident" id="7184610"><a href="/gostd/database/sql/sql_test.go.html#7184489">name</a></span><span class="op" id="7184614">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7184618">err</span>&nbsp;<span class="op" id="7184622">:=</span>&nbsp;<span class="ident" id="7184625"><a href="/gostd/database/sql/sql_test.go.html#7184374">db</a></span><span class="op" id="7184627">.</span><span class="ident" id="7184628"><a href="/gostd/database/sql/sql.go.html#5227854">QueryRow</a></span><span class="op" id="7184636">(</span><span class="string" id="7184637">&#34;SELECT|t|name|id=?&#34;</span><span class="op" id="7184657">,</span>&nbsp;<span class="num" id="7184659">10</span><span class="op" id="7184661">)</span><span class="op" id="7184662">.</span><span class="ident" id="7184663"><a href="/gostd/database/sql/sql.go.html#5245114">Scan</a></span><span class="op" id="7184667">(</span><span class="op" id="7184668">&amp;</span><span class="ident" id="7184669"><a href="/gostd/database/sql/sql_test.go.html#7184489">name</a></span><span class="op" id="7184673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7184676">if</span>&nbsp;<span class="ident" id="7184679"><a href="/gostd/database/sql/sql_test.go.html#7184618">err</a></span>&nbsp;<span class="op" id="7184683">!=</span>&nbsp;<span class="builtintype" id="7184686">nil</span>&nbsp;<span class="op" id="7184690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7184694"><a href="/gostd/database/sql/sql_test.go.html#7184357">t</a></span><span class="op" id="7184695">.</span><span class="ident" id="7184696"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7184702">(</span><span class="string" id="7184703">&#34;querying&nbsp;id&nbsp;10:&nbsp;%v&#34;</span><span class="op" id="7184723">,</span>&nbsp;<span class="ident" id="7184725"><a href="/gostd/database/sql/sql_test.go.html#7184618">err</a></span><span class="op" id="7184728">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7184731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7184734">if</span>&nbsp;<span class="ident" id="7184737"><a href="/gostd/database/sql/sql_test.go.html#7184489">name</a></span>&nbsp;<span class="op" id="7184742">==</span>&nbsp;<span class="builtintype" id="7184745">nil</span>&nbsp;<span class="op" id="7184749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7184753"><a href="/gostd/database/sql/sql_test.go.html#7184357">t</a></span><span class="op" id="7184754">.</span><span class="ident" id="7184755"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7184761">(</span><span class="string" id="7184762">&#34;id&nbsp;10&#39;s&nbsp;name&nbsp;=&nbsp;nil;&nbsp;want&nbsp;bob&#34;</span><span class="op" id="7184792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7184795">}</span>&nbsp;<span class="keyword" id="7184797">else</span>&nbsp;<span class="keyword" id="7184802">if</span>&nbsp;<span class="op" id="7184805">*</span><span class="ident" id="7184806"><a href="/gostd/database/sql/sql_test.go.html#7184489">name</a></span>&nbsp;<span class="op" id="7184811">!=</span>&nbsp;<span class="string" id="7184814">&#34;bob&#34;</span>&nbsp;<span class="op" id="7184820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7184824"><a href="/gostd/database/sql/sql_test.go.html#7184357">t</a></span><span class="op" id="7184825">.</span><span class="ident" id="7184826"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7184832">(</span><span class="string" id="7184833">&#34;id&nbsp;10&#39;s&nbsp;name&nbsp;=&nbsp;%q;&nbsp;want&nbsp;bob&#34;</span><span class="op" id="7184862">,</span>&nbsp;<span class="op" id="7184864">*</span><span class="ident" id="7184865"><a href="/gostd/database/sql/sql_test.go.html#7184489">name</a></span><span class="op" id="7184869">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7184872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7184876"><a href="/gostd/database/sql/sql_test.go.html#7184618">err</a></span>&nbsp;<span class="op" id="7184880">=</span>&nbsp;<span class="ident" id="7184882"><a href="/gostd/database/sql/sql_test.go.html#7184374">db</a></span><span class="op" id="7184884">.</span><span class="ident" id="7184885"><a href="/gostd/database/sql/sql.go.html#5227854">QueryRow</a></span><span class="op" id="7184893">(</span><span class="string" id="7184894">&#34;SELECT|t|name|id=?&#34;</span><span class="op" id="7184914">,</span>&nbsp;<span class="num" id="7184916">20</span><span class="op" id="7184918">)</span><span class="op" id="7184919">.</span><span class="ident" id="7184920"><a href="/gostd/database/sql/sql.go.html#5245114">Scan</a></span><span class="op" id="7184924">(</span><span class="op" id="7184925">&amp;</span><span class="ident" id="7184926"><a href="/gostd/database/sql/sql_test.go.html#7184489">name</a></span><span class="op" id="7184930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7184933">if</span>&nbsp;<span class="ident" id="7184936"><a href="/gostd/database/sql/sql_test.go.html#7184618">err</a></span>&nbsp;<span class="op" id="7184940">!=</span>&nbsp;<span class="builtintype" id="7184943">nil</span>&nbsp;<span class="op" id="7184947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7184951"><a href="/gostd/database/sql/sql_test.go.html#7184357">t</a></span><span class="op" id="7184952">.</span><span class="ident" id="7184953"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7184959">(</span><span class="string" id="7184960">&#34;querying&nbsp;id&nbsp;20:&nbsp;%v&#34;</span><span class="op" id="7184980">,</span>&nbsp;<span class="ident" id="7184982"><a href="/gostd/database/sql/sql_test.go.html#7184618">err</a></span><span class="op" id="7184985">)</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7184988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7184991">if</span>&nbsp;<span class="ident" id="7184994"><a href="/gostd/database/sql/sql_test.go.html#7184489">name</a></span>&nbsp;<span class="op" id="7184999">!=</span>&nbsp;<span class="builtintype" id="7185002">nil</span>&nbsp;<span class="op" id="7185006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7185010"><a href="/gostd/database/sql/sql_test.go.html#7184357">t</a></span><span class="op" id="7185011">.</span><span class="ident" id="7185012"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7185018">(</span><span class="string" id="7185019">&#34;id&nbsp;20&nbsp;=&nbsp;%q;&nbsp;want&nbsp;nil&#34;</span><span class="op" id="7185041">,</span>&nbsp;<span class="op" id="7185043">*</span><span class="ident" id="7185044"><a href="/gostd/database/sql/sql_test.go.html#7184489">name</a></span><span class="op" id="7185048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7185051">}</span><br>
<span class="lineno"></span><span class="op" id="7185053">}</span><br>
<span class="lineno">680</span><br>
<span class="lineno"></span><span class="keyword" id="7185056">func</span>&nbsp;<span class="ident" id="7185061">TestQueryRowClosingStmt</span><span class="op" id="7185084">(</span><span class="ident" id="7185085">t</span>&nbsp;<span class="op" id="7185087">*</span><span class="ident" id="7185088"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7185095">.</span><span class="ident" id="7185096"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7185097">)</span>&nbsp;<span class="op" id="7185099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7185102">db</span>&nbsp;<span class="op" id="7185105">:=</span>&nbsp;<span class="ident" id="7185108"><a href="/gostd/database/sql/sql_test.go.html#7169849">newTestDB</a></span><span class="op" id="7185117">(</span><span class="ident" id="7185118"><a href="/gostd/database/sql/sql_test.go.html#7185085">t</a></span><span class="op" id="7185119">,</span>&nbsp;<span class="string" id="7185121">&#34;people&#34;</span><span class="op" id="7185129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7185132">defer</span>&nbsp;<span class="ident" id="7185138"><a href="/gostd/database/sql/sql_test.go.html#7170773">closeDB</a></span><span class="op" id="7185145">(</span><span class="ident" id="7185146"><a href="/gostd/database/sql/sql_test.go.html#7185085">t</a></span><span class="op" id="7185147">,</span>&nbsp;<span class="ident" id="7185149"><a href="/gostd/database/sql/sql_test.go.html#7185102">db</a></span><span class="op" id="7185151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7185154">var</span>&nbsp;<span class="ident" id="7185158">name</span>&nbsp;<span class="builtintype" id="7185163">string</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7185171">var</span>&nbsp;<span class="ident" id="7185175">age</span>&nbsp;<span class="builtintype" id="7185179">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7185184">err</span>&nbsp;<span class="op" id="7185188">:=</span>&nbsp;<span class="ident" id="7185191"><a href="/gostd/database/sql/sql_test.go.html#7185102">db</a></span><span class="op" id="7185193">.</span><span class="ident" id="7185194"><a href="/gostd/database/sql/sql.go.html#5227854">QueryRow</a></span><span class="op" id="7185202">(</span><span class="string" id="7185203">&#34;SELECT|people|age,name|age=?&#34;</span><span class="op" id="7185233">,</span>&nbsp;<span class="num" id="7185235">3</span><span class="op" id="7185236">)</span><span class="op" id="7185237">.</span><span class="ident" id="7185238"><a href="/gostd/database/sql/sql.go.html#5245114">Scan</a></span><span class="op" id="7185242">(</span><span class="op" id="7185243">&amp;</span><span class="ident" id="7185244"><a href="/gostd/database/sql/sql_test.go.html#7185175">age</a></span><span class="op" id="7185247">,</span>&nbsp;<span class="op" id="7185249">&amp;</span><span class="ident" id="7185250"><a href="/gostd/database/sql/sql_test.go.html#7185158">name</a></span><span class="op" id="7185254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7185257">if</span>&nbsp;<span class="ident" id="7185260"><a href="/gostd/database/sql/sql_test.go.html#7185184">err</a></span>&nbsp;<span class="op" id="7185264">!=</span>&nbsp;<span class="builtintype" id="7185267">nil</span>&nbsp;<span class="op" id="7185271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7185275"><a href="/gostd/database/sql/sql_test.go.html#7185085">t</a></span><span class="op" id="7185276">.</span><span class="ident" id="7185277"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="7185282">(</span><span class="ident" id="7185283"><a href="/gostd/database/sql/sql_test.go.html#7185184">err</a></span><span class="op" id="7185286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7185289">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7185292">if</span>&nbsp;<span class="builtinfunc" id="7185295">len</span><span class="op" id="7185298">(</span><span class="ident" id="7185299"><a href="/gostd/database/sql/sql_test.go.html#7185102">db</a></span><span class="op" id="7185301">.</span><span class="ident" id="7185302"><a href="/gostd/database/sql/sql.go.html#5207263">freeConn</a></span><span class="op" id="7185310">)</span>&nbsp;<span class="op" id="7185312">!=</span>&nbsp;<span class="num" id="7185315">1</span>&nbsp;<span class="op" id="7185317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7185321"><a href="/gostd/database/sql/sql_test.go.html#7185085">t</a></span><span class="op" id="7185322">.</span><span class="ident" id="7185323"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7185329">(</span><span class="string" id="7185330">&#34;expected&nbsp;1&nbsp;free&nbsp;conn&#34;</span><span class="op" id="7185352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7185355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7185358">fakeConn</span>&nbsp;<span class="op" id="7185367">:=</span>&nbsp;<span class="ident" id="7185370"><a href="/gostd/database/sql/sql_test.go.html#7185102">db</a></span><span class="op" id="7185372">.</span><span class="ident" id="7185373"><a href="/gostd/database/sql/sql.go.html#5207263">freeConn</a></span><span class="op" id="7185381">[</span><span class="num" id="7185382">0</span><span class="op" id="7185383">]</span><span class="op" id="7185384">.</span><span class="ident" id="7185385"><a href="/gostd/database/sql/sql.go.html#5208213">ci</a></span><span class="op" id="7185387">.</span><span class="op" id="7185388">(</span><span class="op" id="7185389">*</span><span class="ident" id="7185390"><a href="/gostd/database/sql/fakedb_test.go.html#7150186">fakeConn</a></span><span class="op" id="7185398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7185401">if</span>&nbsp;<span class="ident" id="7185404">made</span><span class="op" id="7185408">,</span>&nbsp;<span class="ident" id="7185410">closed</span>&nbsp;<span class="op" id="7185417">:=</span>&nbsp;<span class="ident" id="7185420"><a href="/gostd/database/sql/sql_test.go.html#7185358">fakeConn</a></span><span class="op" id="7185428">.</span><span class="ident" id="7185429"><a href="/gostd/database/sql/fakedb_test.go.html#7150312">stmtsMade</a></span><span class="op" id="7185438">,</span>&nbsp;<span class="ident" id="7185440"><a href="/gostd/database/sql/sql_test.go.html#7185358">fakeConn</a></span><span class="op" id="7185448">.</span><span class="ident" id="7185449"><a href="/gostd/database/sql/fakedb_test.go.html#7150329">stmtsClosed</a></span><span class="op" id="7185460">;</span>&nbsp;<span class="ident" id="7185462"><a href="/gostd/database/sql/sql_test.go.html#7185404">made</a></span>&nbsp;<span class="op" id="7185467">!=</span>&nbsp;<span class="ident" id="7185470"><a href="/gostd/database/sql/sql_test.go.html#7185410">closed</a></span>&nbsp;<span class="op" id="7185477">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7185481"><a href="/gostd/database/sql/sql_test.go.html#7185085">t</a></span><span class="op" id="7185482">.</span><span class="ident" id="7185483"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7185489">(</span><span class="string" id="7185490">&#34;statement&nbsp;close&nbsp;mismatch:&nbsp;made&nbsp;%d,&nbsp;closed&nbsp;%d&#34;</span><span class="op" id="7185536">,</span>&nbsp;<span class="ident" id="7185538"><a href="/gostd/database/sql/sql_test.go.html#7185404">made</a></span><span class="op" id="7185542">,</span>&nbsp;<span class="ident" id="7185544"><a href="/gostd/database/sql/sql_test.go.html#7185410">closed</a></span><span class="op" id="7185550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7185553">}</span><br>
<span class="lineno"></span><span class="op" id="7185555">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7185558">//&nbsp;Test&nbsp;issue&nbsp;6651</span><br>
<span class="lineno">700</span><span class="keyword" id="7185577">func</span>&nbsp;<span class="ident" id="7185582">TestIssue6651</span><span class="op" id="7185595">(</span><span class="ident" id="7185596">t</span>&nbsp;<span class="op" id="7185598">*</span><span class="ident" id="7185599"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7185606">.</span><span class="ident" id="7185607"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7185608">)</span>&nbsp;<span class="op" id="7185610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7185613">db</span>&nbsp;<span class="op" id="7185616">:=</span>&nbsp;<span class="ident" id="7185619"><a href="/gostd/database/sql/sql_test.go.html#7169849">newTestDB</a></span><span class="op" id="7185628">(</span><span class="ident" id="7185629"><a href="/gostd/database/sql/sql_test.go.html#7185596">t</a></span><span class="op" id="7185630">,</span>&nbsp;<span class="string" id="7185632">&#34;people&#34;</span><span class="op" id="7185640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7185643">defer</span>&nbsp;<span class="ident" id="7185649"><a href="/gostd/database/sql/sql_test.go.html#7170773">closeDB</a></span><span class="op" id="7185656">(</span><span class="ident" id="7185657"><a href="/gostd/database/sql/sql_test.go.html#7185596">t</a></span><span class="op" id="7185658">,</span>&nbsp;<span class="ident" id="7185660"><a href="/gostd/database/sql/sql_test.go.html#7185613">db</a></span><span class="op" id="7185662">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7185666">var</span>&nbsp;<span class="ident" id="7185670">v</span>&nbsp;<span class="builtintype" id="7185672">string</span><br>
<span class="lineno">705</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7185681">want</span>&nbsp;<span class="op" id="7185686">:=</span>&nbsp;<span class="string" id="7185689">&#34;error&nbsp;in&nbsp;rows.Next&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7185711"><a href="/gostd/database/sql/fakedb_test.go.html#7166249">rowsCursorNextHook</a></span>&nbsp;<span class="op" id="7185730">=</span>&nbsp;<span class="keyword" id="7185732">func</span><span class="op" id="7185736">(</span><span class="ident" id="7185737">dest</span>&nbsp;<span class="op" id="7185742">[</span><span class="op" id="7185743">]</span><span class="ident" id="7185744"><a href="/gostd/database/sql/sql_test.go.html#7169039">driver</a></span><span class="op" id="7185750">.</span><span class="ident" id="7185751"><a href="/gostd/database/sql/driver/driver.go.html#5248050">Value</a></span><span class="op" id="7185756">)</span>&nbsp;<span class="builtintype" id="7185758">error</span>&nbsp;<span class="op" id="7185764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7185768">return</span>&nbsp;<span class="ident" id="7185775"><a href="/gostd/database/sql/sql_test.go.html#7169072">fmt</a></span><span class="op" id="7185778">.</span><span class="ident" id="7185779"><a href="/gostd/fmt/print.go.html#2143886">Errorf</a></span><span class="op" id="7185785">(</span><span class="ident" id="7185786"><a href="/gostd/database/sql/sql_test.go.html#7185681">want</a></span><span class="op" id="7185790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7185793">}</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7185796">defer</span>&nbsp;<span class="keyword" id="7185802">func</span><span class="op" id="7185806">(</span><span class="op" id="7185807">)</span>&nbsp;<span class="op" id="7185809">{</span>&nbsp;<span class="ident" id="7185811"><a href="/gostd/database/sql/fakedb_test.go.html#7166249">rowsCursorNextHook</a></span>&nbsp;<span class="op" id="7185830">=</span>&nbsp;<span class="builtintype" id="7185832">nil</span>&nbsp;<span class="op" id="7185836">}</span><span class="op" id="7185837">(</span><span class="op" id="7185838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7185841">err</span>&nbsp;<span class="op" id="7185845">:=</span>&nbsp;<span class="ident" id="7185848"><a href="/gostd/database/sql/sql_test.go.html#7185613">db</a></span><span class="op" id="7185850">.</span><span class="ident" id="7185851"><a href="/gostd/database/sql/sql.go.html#5227854">QueryRow</a></span><span class="op" id="7185859">(</span><span class="string" id="7185860">&#34;SELECT|people|name|&#34;</span><span class="op" id="7185881">)</span><span class="op" id="7185882">.</span><span class="ident" id="7185883"><a href="/gostd/database/sql/sql.go.html#5245114">Scan</a></span><span class="op" id="7185887">(</span><span class="op" id="7185888">&amp;</span><span class="ident" id="7185889"><a href="/gostd/database/sql/sql_test.go.html#7185670">v</a></span><span class="op" id="7185890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7185893">if</span>&nbsp;<span class="ident" id="7185896"><a href="/gostd/database/sql/sql_test.go.html#7185841">err</a></span>&nbsp;<span class="op" id="7185900">==</span>&nbsp;<span class="builtintype" id="7185903">nil</span>&nbsp;<span class="op" id="7185907">||</span>&nbsp;<span class="ident" id="7185910"><a href="/gostd/database/sql/sql_test.go.html#7185841">err</a></span><span class="op" id="7185913">.</span><span class="ident" id="7185914">Error</span><span class="op" id="7185919">(</span><span class="op" id="7185920">)</span>&nbsp;<span class="op" id="7185922">!=</span>&nbsp;<span class="ident" id="7185925"><a href="/gostd/database/sql/sql_test.go.html#7185681">want</a></span>&nbsp;<span class="op" id="7185930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7185934"><a href="/gostd/database/sql/sql_test.go.html#7185596">t</a></span><span class="op" id="7185935">.</span><span class="ident" id="7185936"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7185942">(</span><span class="string" id="7185943">&#34;error&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7185964">,</span>&nbsp;<span class="ident" id="7185966"><a href="/gostd/database/sql/sql_test.go.html#7185841">err</a></span><span class="op" id="7185969">,</span>&nbsp;<span class="ident" id="7185971"><a href="/gostd/database/sql/sql_test.go.html#7185681">want</a></span><span class="op" id="7185975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7185978">}</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7185981"><a href="/gostd/database/sql/fakedb_test.go.html#7166249">rowsCursorNextHook</a></span>&nbsp;<span class="op" id="7186000">=</span>&nbsp;<span class="builtintype" id="7186002">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7186008"><a href="/gostd/database/sql/sql_test.go.html#7185681">want</a></span>&nbsp;<span class="op" id="7186013">=</span>&nbsp;<span class="string" id="7186015">&#34;error&nbsp;in&nbsp;rows.Close&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7186038"><a href="/gostd/database/sql/sql.go.html#5244168">rowsCloseHook</a></span>&nbsp;<span class="op" id="7186052">=</span>&nbsp;<span class="keyword" id="7186054">func</span><span class="op" id="7186058">(</span><span class="ident" id="7186059">rows</span>&nbsp;<span class="op" id="7186064">*</span><span class="ident" id="7186065"><a href="/gostd/database/sql/sql.go.html#5241499">Rows</a></span><span class="op" id="7186069">,</span>&nbsp;<span class="ident" id="7186071">err</span>&nbsp;<span class="op" id="7186075">*</span><span class="builtintype" id="7186076">error</span><span class="op" id="7186081">)</span>&nbsp;<span class="op" id="7186083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7186087">*</span><span class="ident" id="7186088"><a href="/gostd/database/sql/sql_test.go.html#7186071">err</a></span>&nbsp;<span class="op" id="7186092">=</span>&nbsp;<span class="ident" id="7186094"><a href="/gostd/database/sql/sql_test.go.html#7169072">fmt</a></span><span class="op" id="7186097">.</span><span class="ident" id="7186098"><a href="/gostd/fmt/print.go.html#2143886">Errorf</a></span><span class="op" id="7186104">(</span><span class="ident" id="7186105"><a href="/gostd/database/sql/sql_test.go.html#7185681">want</a></span><span class="op" id="7186109">)</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7186112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7186115">defer</span>&nbsp;<span class="keyword" id="7186121">func</span><span class="op" id="7186125">(</span><span class="op" id="7186126">)</span>&nbsp;<span class="op" id="7186128">{</span>&nbsp;<span class="ident" id="7186130"><a href="/gostd/database/sql/sql.go.html#5244168">rowsCloseHook</a></span>&nbsp;<span class="op" id="7186144">=</span>&nbsp;<span class="builtintype" id="7186146">nil</span>&nbsp;<span class="op" id="7186150">}</span><span class="op" id="7186151">(</span><span class="op" id="7186152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7186155"><a href="/gostd/database/sql/sql_test.go.html#7185841">err</a></span>&nbsp;<span class="op" id="7186159">=</span>&nbsp;<span class="ident" id="7186161"><a href="/gostd/database/sql/sql_test.go.html#7185613">db</a></span><span class="op" id="7186163">.</span><span class="ident" id="7186164"><a href="/gostd/database/sql/sql.go.html#5227854">QueryRow</a></span><span class="op" id="7186172">(</span><span class="string" id="7186173">&#34;SELECT|people|name|&#34;</span><span class="op" id="7186194">)</span><span class="op" id="7186195">.</span><span class="ident" id="7186196"><a href="/gostd/database/sql/sql.go.html#5245114">Scan</a></span><span class="op" id="7186200">(</span><span class="op" id="7186201">&amp;</span><span class="ident" id="7186202"><a href="/gostd/database/sql/sql_test.go.html#7185670">v</a></span><span class="op" id="7186203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7186206">if</span>&nbsp;<span class="ident" id="7186209"><a href="/gostd/database/sql/sql_test.go.html#7185841">err</a></span>&nbsp;<span class="op" id="7186213">==</span>&nbsp;<span class="builtintype" id="7186216">nil</span>&nbsp;<span class="op" id="7186220">||</span>&nbsp;<span class="ident" id="7186223"><a href="/gostd/database/sql/sql_test.go.html#7185841">err</a></span><span class="op" id="7186226">.</span><span class="ident" id="7186227">Error</span><span class="op" id="7186232">(</span><span class="op" id="7186233">)</span>&nbsp;<span class="op" id="7186235">!=</span>&nbsp;<span class="ident" id="7186238"><a href="/gostd/database/sql/sql_test.go.html#7185681">want</a></span>&nbsp;<span class="op" id="7186243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7186247"><a href="/gostd/database/sql/sql_test.go.html#7185596">t</a></span><span class="op" id="7186248">.</span><span class="ident" id="7186249"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7186255">(</span><span class="string" id="7186256">&#34;error&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7186277">,</span>&nbsp;<span class="ident" id="7186279"><a href="/gostd/database/sql/sql_test.go.html#7185841">err</a></span><span class="op" id="7186282">,</span>&nbsp;<span class="ident" id="7186284"><a href="/gostd/database/sql/sql_test.go.html#7185681">want</a></span><span class="op" id="7186288">)</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7186291">}</span><br>
<span class="lineno"></span><span class="op" id="7186293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7186296">type</span>&nbsp;<span class="ident" id="7186301">nullTestRow</span>&nbsp;<span class="keyword" id="7186313">struct</span>&nbsp;<span class="op" id="7186320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7186323">nullParam</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7186336">interface</span><span class="op" id="7186345">{</span><span class="op" id="7186346">}</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7186349">notNullParam</span>&nbsp;<span class="keyword" id="7186362">interface</span><span class="op" id="7186371">{</span><span class="op" id="7186372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7186375">scanNullVal</span>&nbsp;&nbsp;<span class="keyword" id="7186388">interface</span><span class="op" id="7186397">{</span><span class="op" id="7186398">}</span><br>
<span class="lineno"></span><span class="op" id="7186400">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7186403">type</span>&nbsp;<span class="ident" id="7186408">nullTestSpec</span>&nbsp;<span class="keyword" id="7186421">struct</span>&nbsp;<span class="op" id="7186428">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7186431">nullType</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7186443">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7186451">notNullType</span>&nbsp;<span class="builtintype" id="7186463">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7186471">rows</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7186483">[</span><span class="num" id="7186484">6</span><span class="op" id="7186485">]</span><span class="ident" id="7186486"><a href="/gostd/database/sql/sql_test.go.html#7186301">nullTestRow</a></span><br>
<span class="lineno"></span><span class="op" id="7186498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span><span class="keyword" id="7186501">func</span>&nbsp;<span class="ident" id="7186506">TestNullStringParam</span><span class="op" id="7186525">(</span><span class="ident" id="7186526">t</span>&nbsp;<span class="op" id="7186528">*</span><span class="ident" id="7186529"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7186536">.</span><span class="ident" id="7186537"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7186538">)</span>&nbsp;<span class="op" id="7186540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7186543">spec</span>&nbsp;<span class="op" id="7186548">:=</span>&nbsp;<span class="ident" id="7186551"><a href="/gostd/database/sql/sql_test.go.html#7186408">nullTestSpec</a></span><span class="op" id="7186563">{</span><span class="string" id="7186564">&#34;nullstring&#34;</span><span class="op" id="7186576">,</span>&nbsp;<span class="string" id="7186578">&#34;string&#34;</span><span class="op" id="7186586">,</span>&nbsp;<span class="op" id="7186588">[</span><span class="num" id="7186589">6</span><span class="op" id="7186590">]</span><span class="ident" id="7186591"><a href="/gostd/database/sql/sql_test.go.html#7186301">nullTestRow</a></span><span class="op" id="7186602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7186606">{</span><span class="ident" id="7186607"><a href="/gostd/database/sql/sql.go.html#5203429">NullString</a></span><span class="op" id="7186617">{</span><span class="string" id="7186618">&#34;aqua&#34;</span><span class="op" id="7186624">,</span>&nbsp;<span class="builtintype" id="7186626">true</span><span class="op" id="7186630">}</span><span class="op" id="7186631">,</span>&nbsp;<span class="string" id="7186633">&#34;&#34;</span><span class="op" id="7186635">,</span>&nbsp;<span class="ident" id="7186637"><a href="/gostd/database/sql/sql.go.html#5203429">NullString</a></span><span class="op" id="7186647">{</span><span class="string" id="7186648">&#34;aqua&#34;</span><span class="op" id="7186654">,</span>&nbsp;<span class="builtintype" id="7186656">true</span><span class="op" id="7186660">}</span><span class="op" id="7186661">}</span><span class="op" id="7186662">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7186666">{</span><span class="ident" id="7186667"><a href="/gostd/database/sql/sql.go.html#5203429">NullString</a></span><span class="op" id="7186677">{</span><span class="string" id="7186678">&#34;brown&#34;</span><span class="op" id="7186685">,</span>&nbsp;<span class="builtintype" id="7186687">false</span><span class="op" id="7186692">}</span><span class="op" id="7186693">,</span>&nbsp;<span class="string" id="7186695">&#34;&#34;</span><span class="op" id="7186697">,</span>&nbsp;<span class="ident" id="7186699"><a href="/gostd/database/sql/sql.go.html#5203429">NullString</a></span><span class="op" id="7186709">{</span><span class="string" id="7186710">&#34;&#34;</span><span class="op" id="7186712">,</span>&nbsp;<span class="builtintype" id="7186714">false</span><span class="op" id="7186719">}</span><span class="op" id="7186720">}</span><span class="op" id="7186721">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7186725">{</span><span class="string" id="7186726">&#34;chartreuse&#34;</span><span class="op" id="7186738">,</span>&nbsp;<span class="string" id="7186740">&#34;&#34;</span><span class="op" id="7186742">,</span>&nbsp;<span class="ident" id="7186744"><a href="/gostd/database/sql/sql.go.html#5203429">NullString</a></span><span class="op" id="7186754">{</span><span class="string" id="7186755">&#34;chartreuse&#34;</span><span class="op" id="7186767">,</span>&nbsp;<span class="builtintype" id="7186769">true</span><span class="op" id="7186773">}</span><span class="op" id="7186774">}</span><span class="op" id="7186775">,</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7186779">{</span><span class="ident" id="7186780"><a href="/gostd/database/sql/sql.go.html#5203429">NullString</a></span><span class="op" id="7186790">{</span><span class="string" id="7186791">&#34;darkred&#34;</span><span class="op" id="7186800">,</span>&nbsp;<span class="builtintype" id="7186802">true</span><span class="op" id="7186806">}</span><span class="op" id="7186807">,</span>&nbsp;<span class="string" id="7186809">&#34;&#34;</span><span class="op" id="7186811">,</span>&nbsp;<span class="ident" id="7186813"><a href="/gostd/database/sql/sql.go.html#5203429">NullString</a></span><span class="op" id="7186823">{</span><span class="string" id="7186824">&#34;darkred&#34;</span><span class="op" id="7186833">,</span>&nbsp;<span class="builtintype" id="7186835">true</span><span class="op" id="7186839">}</span><span class="op" id="7186840">}</span><span class="op" id="7186841">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7186845">{</span><span class="ident" id="7186846"><a href="/gostd/database/sql/sql.go.html#5203429">NullString</a></span><span class="op" id="7186856">{</span><span class="string" id="7186857">&#34;eel&#34;</span><span class="op" id="7186862">,</span>&nbsp;<span class="builtintype" id="7186864">false</span><span class="op" id="7186869">}</span><span class="op" id="7186870">,</span>&nbsp;<span class="string" id="7186872">&#34;&#34;</span><span class="op" id="7186874">,</span>&nbsp;<span class="ident" id="7186876"><a href="/gostd/database/sql/sql.go.html#5203429">NullString</a></span><span class="op" id="7186886">{</span><span class="string" id="7186887">&#34;&#34;</span><span class="op" id="7186889">,</span>&nbsp;<span class="builtintype" id="7186891">false</span><span class="op" id="7186896">}</span><span class="op" id="7186897">}</span><span class="op" id="7186898">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7186902">{</span><span class="string" id="7186903">&#34;foo&#34;</span><span class="op" id="7186908">,</span>&nbsp;<span class="ident" id="7186910"><a href="/gostd/database/sql/sql.go.html#5203429">NullString</a></span><span class="op" id="7186920">{</span><span class="string" id="7186921">&#34;black&#34;</span><span class="op" id="7186928">,</span>&nbsp;<span class="builtintype" id="7186930">false</span><span class="op" id="7186935">}</span><span class="op" id="7186936">,</span>&nbsp;<span class="builtintype" id="7186938">nil</span><span class="op" id="7186941">}</span><span class="op" id="7186942">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7186945">}</span><span class="op" id="7186946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7186949"><a href="/gostd/database/sql/sql_test.go.html#7188242">nullTestRun</a></span><span class="op" id="7186960">(</span><span class="ident" id="7186961"><a href="/gostd/database/sql/sql_test.go.html#7186526">t</a></span><span class="op" id="7186962">,</span>&nbsp;<span class="ident" id="7186964"><a href="/gostd/database/sql/sql_test.go.html#7186543">spec</a></span><span class="op" id="7186968">)</span><br>
<span class="lineno">750</span><span class="op" id="7186970">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7186973">func</span>&nbsp;<span class="ident" id="7186978">TestNullInt64Param</span><span class="op" id="7186996">(</span><span class="ident" id="7186997">t</span>&nbsp;<span class="op" id="7186999">*</span><span class="ident" id="7187000"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7187007">.</span><span class="ident" id="7187008"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7187009">)</span>&nbsp;<span class="op" id="7187011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7187014">spec</span>&nbsp;<span class="op" id="7187019">:=</span>&nbsp;<span class="ident" id="7187022"><a href="/gostd/database/sql/sql_test.go.html#7186408">nullTestSpec</a></span><span class="op" id="7187034">{</span><span class="string" id="7187035">&#34;nullint64&#34;</span><span class="op" id="7187046">,</span>&nbsp;<span class="string" id="7187048">&#34;int64&#34;</span><span class="op" id="7187055">,</span>&nbsp;<span class="op" id="7187057">[</span><span class="num" id="7187058">6</span><span class="op" id="7187059">]</span><span class="ident" id="7187060"><a href="/gostd/database/sql/sql_test.go.html#7186301">nullTestRow</a></span><span class="op" id="7187071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7187075">{</span><span class="ident" id="7187076"><a href="/gostd/database/sql/sql.go.html#5204079">NullInt64</a></span><span class="op" id="7187085">{</span><span class="num" id="7187086">31</span><span class="op" id="7187088">,</span>&nbsp;<span class="builtintype" id="7187090">true</span><span class="op" id="7187094">}</span><span class="op" id="7187095">,</span>&nbsp;<span class="num" id="7187097">1</span><span class="op" id="7187098">,</span>&nbsp;<span class="ident" id="7187100"><a href="/gostd/database/sql/sql.go.html#5204079">NullInt64</a></span><span class="op" id="7187109">{</span><span class="num" id="7187110">31</span><span class="op" id="7187112">,</span>&nbsp;<span class="builtintype" id="7187114">true</span><span class="op" id="7187118">}</span><span class="op" id="7187119">}</span><span class="op" id="7187120">,</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7187124">{</span><span class="ident" id="7187125"><a href="/gostd/database/sql/sql.go.html#5204079">NullInt64</a></span><span class="op" id="7187134">{</span><span class="op" id="7187135">-</span><span class="num" id="7187136">22</span><span class="op" id="7187138">,</span>&nbsp;<span class="builtintype" id="7187140">false</span><span class="op" id="7187145">}</span><span class="op" id="7187146">,</span>&nbsp;<span class="num" id="7187148">1</span><span class="op" id="7187149">,</span>&nbsp;<span class="ident" id="7187151"><a href="/gostd/database/sql/sql.go.html#5204079">NullInt64</a></span><span class="op" id="7187160">{</span><span class="num" id="7187161">0</span><span class="op" id="7187162">,</span>&nbsp;<span class="builtintype" id="7187164">false</span><span class="op" id="7187169">}</span><span class="op" id="7187170">}</span><span class="op" id="7187171">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7187175">{</span><span class="num" id="7187176">22</span><span class="op" id="7187178">,</span>&nbsp;<span class="num" id="7187180">1</span><span class="op" id="7187181">,</span>&nbsp;<span class="ident" id="7187183"><a href="/gostd/database/sql/sql.go.html#5204079">NullInt64</a></span><span class="op" id="7187192">{</span><span class="num" id="7187193">22</span><span class="op" id="7187195">,</span>&nbsp;<span class="builtintype" id="7187197">true</span><span class="op" id="7187201">}</span><span class="op" id="7187202">}</span><span class="op" id="7187203">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7187207">{</span><span class="ident" id="7187208"><a href="/gostd/database/sql/sql.go.html#5204079">NullInt64</a></span><span class="op" id="7187217">{</span><span class="num" id="7187218">33</span><span class="op" id="7187220">,</span>&nbsp;<span class="builtintype" id="7187222">true</span><span class="op" id="7187226">}</span><span class="op" id="7187227">,</span>&nbsp;<span class="num" id="7187229">1</span><span class="op" id="7187230">,</span>&nbsp;<span class="ident" id="7187232"><a href="/gostd/database/sql/sql.go.html#5204079">NullInt64</a></span><span class="op" id="7187241">{</span><span class="num" id="7187242">33</span><span class="op" id="7187244">,</span>&nbsp;<span class="builtintype" id="7187246">true</span><span class="op" id="7187250">}</span><span class="op" id="7187251">}</span><span class="op" id="7187252">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7187256">{</span><span class="ident" id="7187257"><a href="/gostd/database/sql/sql.go.html#5204079">NullInt64</a></span><span class="op" id="7187266">{</span><span class="num" id="7187267">222</span><span class="op" id="7187270">,</span>&nbsp;<span class="builtintype" id="7187272">false</span><span class="op" id="7187277">}</span><span class="op" id="7187278">,</span>&nbsp;<span class="num" id="7187280">1</span><span class="op" id="7187281">,</span>&nbsp;<span class="ident" id="7187283"><a href="/gostd/database/sql/sql.go.html#5204079">NullInt64</a></span><span class="op" id="7187292">{</span><span class="num" id="7187293">0</span><span class="op" id="7187294">,</span>&nbsp;<span class="builtintype" id="7187296">false</span><span class="op" id="7187301">}</span><span class="op" id="7187302">}</span><span class="op" id="7187303">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7187307">{</span><span class="num" id="7187308">0</span><span class="op" id="7187309">,</span>&nbsp;<span class="ident" id="7187311"><a href="/gostd/database/sql/sql.go.html#5204079">NullInt64</a></span><span class="op" id="7187320">{</span><span class="num" id="7187321">31</span><span class="op" id="7187323">,</span>&nbsp;<span class="builtintype" id="7187325">false</span><span class="op" id="7187330">}</span><span class="op" id="7187331">,</span>&nbsp;<span class="builtintype" id="7187333">nil</span><span class="op" id="7187336">}</span><span class="op" id="7187337">,</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7187340">}</span><span class="op" id="7187341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7187344"><a href="/gostd/database/sql/sql_test.go.html#7188242">nullTestRun</a></span><span class="op" id="7187355">(</span><span class="ident" id="7187356"><a href="/gostd/database/sql/sql_test.go.html#7186997">t</a></span><span class="op" id="7187357">,</span>&nbsp;<span class="ident" id="7187359"><a href="/gostd/database/sql/sql_test.go.html#7187014">spec</a></span><span class="op" id="7187363">)</span><br>
<span class="lineno"></span><span class="op" id="7187365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7187368">func</span>&nbsp;<span class="ident" id="7187373">TestNullFloat64Param</span><span class="op" id="7187393">(</span><span class="ident" id="7187394">t</span>&nbsp;<span class="op" id="7187396">*</span><span class="ident" id="7187397"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7187404">.</span><span class="ident" id="7187405"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7187406">)</span>&nbsp;<span class="op" id="7187408">{</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7187411">spec</span>&nbsp;<span class="op" id="7187416">:=</span>&nbsp;<span class="ident" id="7187419"><a href="/gostd/database/sql/sql_test.go.html#7186408">nullTestSpec</a></span><span class="op" id="7187431">{</span><span class="string" id="7187432">&#34;nullfloat64&#34;</span><span class="op" id="7187445">,</span>&nbsp;<span class="string" id="7187447">&#34;float64&#34;</span><span class="op" id="7187456">,</span>&nbsp;<span class="op" id="7187458">[</span><span class="num" id="7187459">6</span><span class="op" id="7187460">]</span><span class="ident" id="7187461"><a href="/gostd/database/sql/sql_test.go.html#7186301">nullTestRow</a></span><span class="op" id="7187472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7187476">{</span><span class="ident" id="7187477"><a href="/gostd/database/sql/sql.go.html#5204715">NullFloat64</a></span><span class="op" id="7187488">{</span><span class="num" id="7187489">31.2</span><span class="op" id="7187493">,</span>&nbsp;<span class="builtintype" id="7187495">true</span><span class="op" id="7187499">}</span><span class="op" id="7187500">,</span>&nbsp;<span class="num" id="7187502">1</span><span class="op" id="7187503">,</span>&nbsp;<span class="ident" id="7187505"><a href="/gostd/database/sql/sql.go.html#5204715">NullFloat64</a></span><span class="op" id="7187516">{</span><span class="num" id="7187517">31.2</span><span class="op" id="7187521">,</span>&nbsp;<span class="builtintype" id="7187523">true</span><span class="op" id="7187527">}</span><span class="op" id="7187528">}</span><span class="op" id="7187529">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7187533">{</span><span class="ident" id="7187534"><a href="/gostd/database/sql/sql.go.html#5204715">NullFloat64</a></span><span class="op" id="7187545">{</span><span class="num" id="7187546">13.1</span><span class="op" id="7187550">,</span>&nbsp;<span class="builtintype" id="7187552">false</span><span class="op" id="7187557">}</span><span class="op" id="7187558">,</span>&nbsp;<span class="num" id="7187560">1</span><span class="op" id="7187561">,</span>&nbsp;<span class="ident" id="7187563"><a href="/gostd/database/sql/sql.go.html#5204715">NullFloat64</a></span><span class="op" id="7187574">{</span><span class="num" id="7187575">0</span><span class="op" id="7187576">,</span>&nbsp;<span class="builtintype" id="7187578">false</span><span class="op" id="7187583">}</span><span class="op" id="7187584">}</span><span class="op" id="7187585">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7187589">{</span><span class="op" id="7187590">-</span><span class="num" id="7187591">22.9</span><span class="op" id="7187595">,</span>&nbsp;<span class="num" id="7187597">1</span><span class="op" id="7187598">,</span>&nbsp;<span class="ident" id="7187600"><a href="/gostd/database/sql/sql.go.html#5204715">NullFloat64</a></span><span class="op" id="7187611">{</span><span class="op" id="7187612">-</span><span class="num" id="7187613">22.9</span><span class="op" id="7187617">,</span>&nbsp;<span class="builtintype" id="7187619">true</span><span class="op" id="7187623">}</span><span class="op" id="7187624">}</span><span class="op" id="7187625">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7187629">{</span><span class="ident" id="7187630"><a href="/gostd/database/sql/sql.go.html#5204715">NullFloat64</a></span><span class="op" id="7187641">{</span><span class="num" id="7187642">33.81</span><span class="op" id="7187647">,</span>&nbsp;<span class="builtintype" id="7187649">true</span><span class="op" id="7187653">}</span><span class="op" id="7187654">,</span>&nbsp;<span class="num" id="7187656">1</span><span class="op" id="7187657">,</span>&nbsp;<span class="ident" id="7187659"><a href="/gostd/database/sql/sql.go.html#5204715">NullFloat64</a></span><span class="op" id="7187670">{</span><span class="num" id="7187671">33.81</span><span class="op" id="7187676">,</span>&nbsp;<span class="builtintype" id="7187678">true</span><span class="op" id="7187682">}</span><span class="op" id="7187683">}</span><span class="op" id="7187684">,</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7187688">{</span><span class="ident" id="7187689"><a href="/gostd/database/sql/sql.go.html#5204715">NullFloat64</a></span><span class="op" id="7187700">{</span><span class="num" id="7187701">222</span><span class="op" id="7187704">,</span>&nbsp;<span class="builtintype" id="7187706">false</span><span class="op" id="7187711">}</span><span class="op" id="7187712">,</span>&nbsp;<span class="num" id="7187714">1</span><span class="op" id="7187715">,</span>&nbsp;<span class="ident" id="7187717"><a href="/gostd/database/sql/sql.go.html#5204715">NullFloat64</a></span><span class="op" id="7187728">{</span><span class="num" id="7187729">0</span><span class="op" id="7187730">,</span>&nbsp;<span class="builtintype" id="7187732">false</span><span class="op" id="7187737">}</span><span class="op" id="7187738">}</span><span class="op" id="7187739">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7187743">{</span><span class="num" id="7187744">10</span><span class="op" id="7187746">,</span>&nbsp;<span class="ident" id="7187748"><a href="/gostd/database/sql/sql.go.html#5204715">NullFloat64</a></span><span class="op" id="7187759">{</span><span class="num" id="7187760">31.2</span><span class="op" id="7187764">,</span>&nbsp;<span class="builtintype" id="7187766">false</span><span class="op" id="7187771">}</span><span class="op" id="7187772">,</span>&nbsp;<span class="builtintype" id="7187774">nil</span><span class="op" id="7187777">}</span><span class="op" id="7187778">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7187781">}</span><span class="op" id="7187782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7187785"><a href="/gostd/database/sql/sql_test.go.html#7188242">nullTestRun</a></span><span class="op" id="7187796">(</span><span class="ident" id="7187797"><a href="/gostd/database/sql/sql_test.go.html#7187394">t</a></span><span class="op" id="7187798">,</span>&nbsp;<span class="ident" id="7187800"><a href="/gostd/database/sql/sql_test.go.html#7187411">spec</a></span><span class="op" id="7187804">)</span><br>
<span class="lineno"></span><span class="op" id="7187806">}</span><br>
<span class="lineno">775</span><br>
<span class="lineno"></span><span class="keyword" id="7187809">func</span>&nbsp;<span class="ident" id="7187814">TestNullBoolParam</span><span class="op" id="7187831">(</span><span class="ident" id="7187832">t</span>&nbsp;<span class="op" id="7187834">*</span><span class="ident" id="7187835"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7187842">.</span><span class="ident" id="7187843"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7187844">)</span>&nbsp;<span class="op" id="7187846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7187849">spec</span>&nbsp;<span class="op" id="7187854">:=</span>&nbsp;<span class="ident" id="7187857"><a href="/gostd/database/sql/sql_test.go.html#7186408">nullTestSpec</a></span><span class="op" id="7187869">{</span><span class="string" id="7187870">&#34;nullbool&#34;</span><span class="op" id="7187880">,</span>&nbsp;<span class="string" id="7187882">&#34;bool&#34;</span><span class="op" id="7187888">,</span>&nbsp;<span class="op" id="7187890">[</span><span class="num" id="7187891">6</span><span class="op" id="7187892">]</span><span class="ident" id="7187893"><a href="/gostd/database/sql/sql_test.go.html#7186301">nullTestRow</a></span><span class="op" id="7187904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7187908">{</span><span class="ident" id="7187909"><a href="/gostd/database/sql/sql.go.html#5205362">NullBool</a></span><span class="op" id="7187917">{</span><span class="builtintype" id="7187918">false</span><span class="op" id="7187923">,</span>&nbsp;<span class="builtintype" id="7187925">true</span><span class="op" id="7187929">}</span><span class="op" id="7187930">,</span>&nbsp;<span class="builtintype" id="7187932">true</span><span class="op" id="7187936">,</span>&nbsp;<span class="ident" id="7187938"><a href="/gostd/database/sql/sql.go.html#5205362">NullBool</a></span><span class="op" id="7187946">{</span><span class="builtintype" id="7187947">false</span><span class="op" id="7187952">,</span>&nbsp;<span class="builtintype" id="7187954">true</span><span class="op" id="7187958">}</span><span class="op" id="7187959">}</span><span class="op" id="7187960">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7187964">{</span><span class="ident" id="7187965"><a href="/gostd/database/sql/sql.go.html#5205362">NullBool</a></span><span class="op" id="7187973">{</span><span class="builtintype" id="7187974">true</span><span class="op" id="7187978">,</span>&nbsp;<span class="builtintype" id="7187980">false</span><span class="op" id="7187985">}</span><span class="op" id="7187986">,</span>&nbsp;<span class="builtintype" id="7187988">false</span><span class="op" id="7187993">,</span>&nbsp;<span class="ident" id="7187995"><a href="/gostd/database/sql/sql.go.html#5205362">NullBool</a></span><span class="op" id="7188003">{</span><span class="builtintype" id="7188004">false</span><span class="op" id="7188009">,</span>&nbsp;<span class="builtintype" id="7188011">false</span><span class="op" id="7188016">}</span><span class="op" id="7188017">}</span><span class="op" id="7188018">,</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7188022">{</span><span class="builtintype" id="7188023">true</span><span class="op" id="7188027">,</span>&nbsp;<span class="builtintype" id="7188029">true</span><span class="op" id="7188033">,</span>&nbsp;<span class="ident" id="7188035"><a href="/gostd/database/sql/sql.go.html#5205362">NullBool</a></span><span class="op" id="7188043">{</span><span class="builtintype" id="7188044">true</span><span class="op" id="7188048">,</span>&nbsp;<span class="builtintype" id="7188050">true</span><span class="op" id="7188054">}</span><span class="op" id="7188055">}</span><span class="op" id="7188056">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7188060">{</span><span class="ident" id="7188061"><a href="/gostd/database/sql/sql.go.html#5205362">NullBool</a></span><span class="op" id="7188069">{</span><span class="builtintype" id="7188070">true</span><span class="op" id="7188074">,</span>&nbsp;<span class="builtintype" id="7188076">true</span><span class="op" id="7188080">}</span><span class="op" id="7188081">,</span>&nbsp;<span class="builtintype" id="7188083">false</span><span class="op" id="7188088">,</span>&nbsp;<span class="ident" id="7188090"><a href="/gostd/database/sql/sql.go.html#5205362">NullBool</a></span><span class="op" id="7188098">{</span><span class="builtintype" id="7188099">true</span><span class="op" id="7188103">,</span>&nbsp;<span class="builtintype" id="7188105">true</span><span class="op" id="7188109">}</span><span class="op" id="7188110">}</span><span class="op" id="7188111">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7188115">{</span><span class="ident" id="7188116"><a href="/gostd/database/sql/sql.go.html#5205362">NullBool</a></span><span class="op" id="7188124">{</span><span class="builtintype" id="7188125">true</span><span class="op" id="7188129">,</span>&nbsp;<span class="builtintype" id="7188131">false</span><span class="op" id="7188136">}</span><span class="op" id="7188137">,</span>&nbsp;<span class="builtintype" id="7188139">true</span><span class="op" id="7188143">,</span>&nbsp;<span class="ident" id="7188145"><a href="/gostd/database/sql/sql.go.html#5205362">NullBool</a></span><span class="op" id="7188153">{</span><span class="builtintype" id="7188154">false</span><span class="op" id="7188159">,</span>&nbsp;<span class="builtintype" id="7188161">false</span><span class="op" id="7188166">}</span><span class="op" id="7188167">}</span><span class="op" id="7188168">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7188172">{</span><span class="builtintype" id="7188173">true</span><span class="op" id="7188177">,</span>&nbsp;<span class="ident" id="7188179"><a href="/gostd/database/sql/sql.go.html#5205362">NullBool</a></span><span class="op" id="7188187">{</span><span class="builtintype" id="7188188">true</span><span class="op" id="7188192">,</span>&nbsp;<span class="builtintype" id="7188194">false</span><span class="op" id="7188199">}</span><span class="op" id="7188200">,</span>&nbsp;<span class="builtintype" id="7188202">nil</span><span class="op" id="7188205">}</span><span class="op" id="7188206">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7188209">}</span><span class="op" id="7188210">}</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7188213"><a href="/gostd/database/sql/sql_test.go.html#7188242">nullTestRun</a></span><span class="op" id="7188224">(</span><span class="ident" id="7188225"><a href="/gostd/database/sql/sql_test.go.html#7187832">t</a></span><span class="op" id="7188226">,</span>&nbsp;<span class="ident" id="7188228"><a href="/gostd/database/sql/sql_test.go.html#7187849">spec</a></span><span class="op" id="7188232">)</span><br>
<span class="lineno"></span><span class="op" id="7188234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7188237">func</span>&nbsp;<span class="ident" id="7188242">nullTestRun</span><span class="op" id="7188253">(</span><span class="ident" id="7188254">t</span>&nbsp;<span class="op" id="7188256">*</span><span class="ident" id="7188257"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7188264">.</span><span class="ident" id="7188265"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7188266">,</span>&nbsp;<span class="ident" id="7188268">spec</span>&nbsp;<span class="ident" id="7188273"><a href="/gostd/database/sql/sql_test.go.html#7186408">nullTestSpec</a></span><span class="op" id="7188285">)</span>&nbsp;<span class="op" id="7188287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7188290">db</span>&nbsp;<span class="op" id="7188293">:=</span>&nbsp;<span class="ident" id="7188296"><a href="/gostd/database/sql/sql_test.go.html#7169849">newTestDB</a></span><span class="op" id="7188305">(</span><span class="ident" id="7188306"><a href="/gostd/database/sql/sql_test.go.html#7188254">t</a></span><span class="op" id="7188307">,</span>&nbsp;<span class="string" id="7188309">&#34;&#34;</span><span class="op" id="7188311">)</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7188314">defer</span>&nbsp;<span class="ident" id="7188320"><a href="/gostd/database/sql/sql_test.go.html#7170773">closeDB</a></span><span class="op" id="7188327">(</span><span class="ident" id="7188328"><a href="/gostd/database/sql/sql_test.go.html#7188254">t</a></span><span class="op" id="7188329">,</span>&nbsp;<span class="ident" id="7188331"><a href="/gostd/database/sql/sql_test.go.html#7188290">db</a></span><span class="op" id="7188333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7188336"><a href="/gostd/database/sql/sql_test.go.html#7170605">exec</a></span><span class="op" id="7188340">(</span><span class="ident" id="7188341"><a href="/gostd/database/sql/sql_test.go.html#7188254">t</a></span><span class="op" id="7188342">,</span>&nbsp;<span class="ident" id="7188344"><a href="/gostd/database/sql/sql_test.go.html#7188290">db</a></span><span class="op" id="7188346">,</span>&nbsp;<span class="ident" id="7188348"><a href="/gostd/database/sql/sql_test.go.html#7169072">fmt</a></span><span class="op" id="7188351">.</span><span class="ident" id="7188352"><a href="/gostd/fmt/print.go.html#2143637">Sprintf</a></span><span class="op" id="7188359">(</span><span class="string" id="7188360">&#34;CREATE|t|id=int32,name=string,nullf=%s,notnullf=%s&#34;</span><span class="op" id="7188412">,</span>&nbsp;<span class="ident" id="7188414"><a href="/gostd/database/sql/sql_test.go.html#7188268">spec</a></span><span class="op" id="7188418">.</span><span class="ident" id="7188419"><a href="/gostd/database/sql/sql_test.go.html#7186431">nullType</a></span><span class="op" id="7188427">,</span>&nbsp;<span class="ident" id="7188429"><a href="/gostd/database/sql/sql_test.go.html#7188268">spec</a></span><span class="op" id="7188433">.</span><span class="ident" id="7188434"><a href="/gostd/database/sql/sql_test.go.html#7186451">notNullType</a></span><span class="op" id="7188445">)</span><span class="op" id="7188446">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7188450">//&nbsp;Inserts&nbsp;with&nbsp;db.Exec:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7188476"><a href="/gostd/database/sql/sql_test.go.html#7170605">exec</a></span><span class="op" id="7188480">(</span><span class="ident" id="7188481"><a href="/gostd/database/sql/sql_test.go.html#7188254">t</a></span><span class="op" id="7188482">,</span>&nbsp;<span class="ident" id="7188484"><a href="/gostd/database/sql/sql_test.go.html#7188290">db</a></span><span class="op" id="7188486">,</span>&nbsp;<span class="string" id="7188488">&#34;INSERT|t|id=?,name=?,nullf=?,notnullf=?&#34;</span><span class="op" id="7188529">,</span>&nbsp;<span class="num" id="7188531">1</span><span class="op" id="7188532">,</span>&nbsp;<span class="string" id="7188534">&#34;alice&#34;</span><span class="op" id="7188541">,</span>&nbsp;<span class="ident" id="7188543"><a href="/gostd/database/sql/sql_test.go.html#7188268">spec</a></span><span class="op" id="7188547">.</span><span class="ident" id="7188548"><a href="/gostd/database/sql/sql_test.go.html#7186471">rows</a></span><span class="op" id="7188552">[</span><span class="num" id="7188553">0</span><span class="op" id="7188554">]</span><span class="op" id="7188555">.</span><span class="ident" id="7188556"><a href="/gostd/database/sql/sql_test.go.html#7186323">nullParam</a></span><span class="op" id="7188565">,</span>&nbsp;<span class="ident" id="7188567"><a href="/gostd/database/sql/sql_test.go.html#7188268">spec</a></span><span class="op" id="7188571">.</span><span class="ident" id="7188572"><a href="/gostd/database/sql/sql_test.go.html#7186471">rows</a></span><span class="op" id="7188576">[</span><span class="num" id="7188577">0</span><span class="op" id="7188578">]</span><span class="op" id="7188579">.</span><span class="ident" id="7188580"><a href="/gostd/database/sql/sql_test.go.html#7186349">notNullParam</a></span><span class="op" id="7188592">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7188595"><a href="/gostd/database/sql/sql_test.go.html#7170605">exec</a></span><span class="op" id="7188599">(</span><span class="ident" id="7188600"><a href="/gostd/database/sql/sql_test.go.html#7188254">t</a></span><span class="op" id="7188601">,</span>&nbsp;<span class="ident" id="7188603"><a href="/gostd/database/sql/sql_test.go.html#7188290">db</a></span><span class="op" id="7188605">,</span>&nbsp;<span class="string" id="7188607">&#34;INSERT|t|id=?,name=?,nullf=?,notnullf=?&#34;</span><span class="op" id="7188648">,</span>&nbsp;<span class="num" id="7188650">2</span><span class="op" id="7188651">,</span>&nbsp;<span class="string" id="7188653">&#34;bob&#34;</span><span class="op" id="7188658">,</span>&nbsp;<span class="ident" id="7188660"><a href="/gostd/database/sql/sql_test.go.html#7188268">spec</a></span><span class="op" id="7188664">.</span><span class="ident" id="7188665"><a href="/gostd/database/sql/sql_test.go.html#7186471">rows</a></span><span class="op" id="7188669">[</span><span class="num" id="7188670">1</span><span class="op" id="7188671">]</span><span class="op" id="7188672">.</span><span class="ident" id="7188673"><a href="/gostd/database/sql/sql_test.go.html#7186323">nullParam</a></span><span class="op" id="7188682">,</span>&nbsp;<span class="ident" id="7188684"><a href="/gostd/database/sql/sql_test.go.html#7188268">spec</a></span><span class="op" id="7188688">.</span><span class="ident" id="7188689"><a href="/gostd/database/sql/sql_test.go.html#7186471">rows</a></span><span class="op" id="7188693">[</span><span class="num" id="7188694">1</span><span class="op" id="7188695">]</span><span class="op" id="7188696">.</span><span class="ident" id="7188697"><a href="/gostd/database/sql/sql_test.go.html#7186349">notNullParam</a></span><span class="op" id="7188709">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7188713">//&nbsp;Inserts&nbsp;with&nbsp;a&nbsp;prepared&nbsp;statement:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7188752">stmt</span><span class="op" id="7188756">,</span>&nbsp;<span class="ident" id="7188758">err</span>&nbsp;<span class="op" id="7188762">:=</span>&nbsp;<span class="ident" id="7188765"><a href="/gostd/database/sql/sql_test.go.html#7188290">db</a></span><span class="op" id="7188767">.</span><span class="ident" id="7188768"><a href="/gostd/database/sql/sql.go.html#5223860">Prepare</a></span><span class="op" id="7188775">(</span><span class="string" id="7188776">&#34;INSERT|t|id=?,name=?,nullf=?,notnullf=?&#34;</span><span class="op" id="7188817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7188820">if</span>&nbsp;<span class="ident" id="7188823"><a href="/gostd/database/sql/sql_test.go.html#7188758">err</a></span>&nbsp;<span class="op" id="7188827">!=</span>&nbsp;<span class="builtintype" id="7188830">nil</span>&nbsp;<span class="op" id="7188834">{</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7188838"><a href="/gostd/database/sql/sql_test.go.html#7188254">t</a></span><span class="op" id="7188839">.</span><span class="ident" id="7188840"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7188846">(</span><span class="string" id="7188847">&#34;prepare:&nbsp;%v&#34;</span><span class="op" id="7188860">,</span>&nbsp;<span class="ident" id="7188862"><a href="/gostd/database/sql/sql_test.go.html#7188758">err</a></span><span class="op" id="7188865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7188868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7188871">defer</span>&nbsp;<span class="ident" id="7188877"><a href="/gostd/database/sql/sql_test.go.html#7188752">stmt</a></span><span class="op" id="7188881">.</span><span class="ident" id="7188882"><a href="/gostd/database/sql/sql.go.html#5240529">Close</a></span><span class="op" id="7188887">(</span><span class="op" id="7188888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7188891">if</span>&nbsp;<span class="ident" id="7188894">_</span><span class="op" id="7188895">,</span>&nbsp;<span class="ident" id="7188897">err</span>&nbsp;<span class="op" id="7188901">:=</span>&nbsp;<span class="ident" id="7188904"><a href="/gostd/database/sql/sql_test.go.html#7188752">stmt</a></span><span class="op" id="7188908">.</span><span class="ident" id="7188909"><a href="/gostd/database/sql/sql.go.html#5235241">Exec</a></span><span class="op" id="7188913">(</span><span class="num" id="7188914">3</span><span class="op" id="7188915">,</span>&nbsp;<span class="string" id="7188917">&#34;chris&#34;</span><span class="op" id="7188924">,</span>&nbsp;<span class="ident" id="7188926"><a href="/gostd/database/sql/sql_test.go.html#7188268">spec</a></span><span class="op" id="7188930">.</span><span class="ident" id="7188931"><a href="/gostd/database/sql/sql_test.go.html#7186471">rows</a></span><span class="op" id="7188935">[</span><span class="num" id="7188936">2</span><span class="op" id="7188937">]</span><span class="op" id="7188938">.</span><span class="ident" id="7188939"><a href="/gostd/database/sql/sql_test.go.html#7186323">nullParam</a></span><span class="op" id="7188948">,</span>&nbsp;<span class="ident" id="7188950"><a href="/gostd/database/sql/sql_test.go.html#7188268">spec</a></span><span class="op" id="7188954">.</span><span class="ident" id="7188955"><a href="/gostd/database/sql/sql_test.go.html#7186471">rows</a></span><span class="op" id="7188959">[</span><span class="num" id="7188960">2</span><span class="op" id="7188961">]</span><span class="op" id="7188962">.</span><span class="ident" id="7188963"><a href="/gostd/database/sql/sql_test.go.html#7186349">notNullParam</a></span><span class="op" id="7188975">)</span><span class="op" id="7188976">;</span>&nbsp;<span class="ident" id="7188978"><a href="/gostd/database/sql/sql_test.go.html#7188897">err</a></span>&nbsp;<span class="op" id="7188982">!=</span>&nbsp;<span class="builtintype" id="7188985">nil</span>&nbsp;<span class="op" id="7188989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7188993"><a href="/gostd/database/sql/sql_test.go.html#7188254">t</a></span><span class="op" id="7188994">.</span><span class="ident" id="7188995"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7189001">(</span><span class="string" id="7189002">&#34;exec&nbsp;insert&nbsp;chris:&nbsp;%v&#34;</span><span class="op" id="7189025">,</span>&nbsp;<span class="ident" id="7189027"><a href="/gostd/database/sql/sql_test.go.html#7188897">err</a></span><span class="op" id="7189030">)</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7189033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7189036">if</span>&nbsp;<span class="ident" id="7189039">_</span><span class="op" id="7189040">,</span>&nbsp;<span class="ident" id="7189042">err</span>&nbsp;<span class="op" id="7189046">:=</span>&nbsp;<span class="ident" id="7189049"><a href="/gostd/database/sql/sql_test.go.html#7188752">stmt</a></span><span class="op" id="7189053">.</span><span class="ident" id="7189054"><a href="/gostd/database/sql/sql.go.html#5235241">Exec</a></span><span class="op" id="7189058">(</span><span class="num" id="7189059">4</span><span class="op" id="7189060">,</span>&nbsp;<span class="string" id="7189062">&#34;dave&#34;</span><span class="op" id="7189068">,</span>&nbsp;<span class="ident" id="7189070"><a href="/gostd/database/sql/sql_test.go.html#7188268">spec</a></span><span class="op" id="7189074">.</span><span class="ident" id="7189075"><a href="/gostd/database/sql/sql_test.go.html#7186471">rows</a></span><span class="op" id="7189079">[</span><span class="num" id="7189080">3</span><span class="op" id="7189081">]</span><span class="op" id="7189082">.</span><span class="ident" id="7189083"><a href="/gostd/database/sql/sql_test.go.html#7186323">nullParam</a></span><span class="op" id="7189092">,</span>&nbsp;<span class="ident" id="7189094"><a href="/gostd/database/sql/sql_test.go.html#7188268">spec</a></span><span class="op" id="7189098">.</span><span class="ident" id="7189099"><a href="/gostd/database/sql/sql_test.go.html#7186471">rows</a></span><span class="op" id="7189103">[</span><span class="num" id="7189104">3</span><span class="op" id="7189105">]</span><span class="op" id="7189106">.</span><span class="ident" id="7189107"><a href="/gostd/database/sql/sql_test.go.html#7186349">notNullParam</a></span><span class="op" id="7189119">)</span><span class="op" id="7189120">;</span>&nbsp;<span class="ident" id="7189122"><a href="/gostd/database/sql/sql_test.go.html#7189042">err</a></span>&nbsp;<span class="op" id="7189126">!=</span>&nbsp;<span class="builtintype" id="7189129">nil</span>&nbsp;<span class="op" id="7189133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7189137"><a href="/gostd/database/sql/sql_test.go.html#7188254">t</a></span><span class="op" id="7189138">.</span><span class="ident" id="7189139"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7189145">(</span><span class="string" id="7189146">&#34;exec&nbsp;insert&nbsp;dave:&nbsp;%v&#34;</span><span class="op" id="7189168">,</span>&nbsp;<span class="ident" id="7189170"><a href="/gostd/database/sql/sql_test.go.html#7189042">err</a></span><span class="op" id="7189173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7189176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7189179">if</span>&nbsp;<span class="ident" id="7189182">_</span><span class="op" id="7189183">,</span>&nbsp;<span class="ident" id="7189185">err</span>&nbsp;<span class="op" id="7189189">:=</span>&nbsp;<span class="ident" id="7189192"><a href="/gostd/database/sql/sql_test.go.html#7188752">stmt</a></span><span class="op" id="7189196">.</span><span class="ident" id="7189197"><a href="/gostd/database/sql/sql.go.html#5235241">Exec</a></span><span class="op" id="7189201">(</span><span class="num" id="7189202">5</span><span class="op" id="7189203">,</span>&nbsp;<span class="string" id="7189205">&#34;eleanor&#34;</span><span class="op" id="7189214">,</span>&nbsp;<span class="ident" id="7189216"><a href="/gostd/database/sql/sql_test.go.html#7188268">spec</a></span><span class="op" id="7189220">.</span><span class="ident" id="7189221"><a href="/gostd/database/sql/sql_test.go.html#7186471">rows</a></span><span class="op" id="7189225">[</span><span class="num" id="7189226">4</span><span class="op" id="7189227">]</span><span class="op" id="7189228">.</span><span class="ident" id="7189229"><a href="/gostd/database/sql/sql_test.go.html#7186323">nullParam</a></span><span class="op" id="7189238">,</span>&nbsp;<span class="ident" id="7189240"><a href="/gostd/database/sql/sql_test.go.html#7188268">spec</a></span><span class="op" id="7189244">.</span><span class="ident" id="7189245"><a href="/gostd/database/sql/sql_test.go.html#7186471">rows</a></span><span class="op" id="7189249">[</span><span class="num" id="7189250">4</span><span class="op" id="7189251">]</span><span class="op" id="7189252">.</span><span class="ident" id="7189253"><a href="/gostd/database/sql/sql_test.go.html#7186349">notNullParam</a></span><span class="op" id="7189265">)</span><span class="op" id="7189266">;</span>&nbsp;<span class="ident" id="7189268"><a href="/gostd/database/sql/sql_test.go.html#7189185">err</a></span>&nbsp;<span class="op" id="7189272">!=</span>&nbsp;<span class="builtintype" id="7189275">nil</span>&nbsp;<span class="op" id="7189279">{</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7189283"><a href="/gostd/database/sql/sql_test.go.html#7188254">t</a></span><span class="op" id="7189284">.</span><span class="ident" id="7189285"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7189291">(</span><span class="string" id="7189292">&#34;exec&nbsp;insert&nbsp;eleanor:&nbsp;%v&#34;</span><span class="op" id="7189317">,</span>&nbsp;<span class="ident" id="7189319"><a href="/gostd/database/sql/sql_test.go.html#7189185">err</a></span><span class="op" id="7189322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7189325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7189329">//&nbsp;Can&#39;t&nbsp;put&nbsp;null&nbsp;val&nbsp;into&nbsp;non-null&nbsp;col</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7189370">if</span>&nbsp;<span class="ident" id="7189373">_</span><span class="op" id="7189374">,</span>&nbsp;<span class="ident" id="7189376">err</span>&nbsp;<span class="op" id="7189380">:=</span>&nbsp;<span class="ident" id="7189383"><a href="/gostd/database/sql/sql_test.go.html#7188752">stmt</a></span><span class="op" id="7189387">.</span><span class="ident" id="7189388"><a href="/gostd/database/sql/sql.go.html#5235241">Exec</a></span><span class="op" id="7189392">(</span><span class="num" id="7189393">6</span><span class="op" id="7189394">,</span>&nbsp;<span class="string" id="7189396">&#34;bob&#34;</span><span class="op" id="7189401">,</span>&nbsp;<span class="ident" id="7189403"><a href="/gostd/database/sql/sql_test.go.html#7188268">spec</a></span><span class="op" id="7189407">.</span><span class="ident" id="7189408"><a href="/gostd/database/sql/sql_test.go.html#7186471">rows</a></span><span class="op" id="7189412">[</span><span class="num" id="7189413">5</span><span class="op" id="7189414">]</span><span class="op" id="7189415">.</span><span class="ident" id="7189416"><a href="/gostd/database/sql/sql_test.go.html#7186323">nullParam</a></span><span class="op" id="7189425">,</span>&nbsp;<span class="ident" id="7189427"><a href="/gostd/database/sql/sql_test.go.html#7188268">spec</a></span><span class="op" id="7189431">.</span><span class="ident" id="7189432"><a href="/gostd/database/sql/sql_test.go.html#7186471">rows</a></span><span class="op" id="7189436">[</span><span class="num" id="7189437">5</span><span class="op" id="7189438">]</span><span class="op" id="7189439">.</span><span class="ident" id="7189440"><a href="/gostd/database/sql/sql_test.go.html#7186349">notNullParam</a></span><span class="op" id="7189452">)</span><span class="op" id="7189453">;</span>&nbsp;<span class="ident" id="7189455"><a href="/gostd/database/sql/sql_test.go.html#7189376">err</a></span>&nbsp;<span class="op" id="7189459">==</span>&nbsp;<span class="builtintype" id="7189462">nil</span>&nbsp;<span class="op" id="7189466">{</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7189470"><a href="/gostd/database/sql/sql_test.go.html#7188254">t</a></span><span class="op" id="7189471">.</span><span class="ident" id="7189472"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7189478">(</span><span class="string" id="7189479">&#34;expected&nbsp;error&nbsp;inserting&nbsp;nil&nbsp;val&nbsp;with&nbsp;prepared&nbsp;statement&nbsp;Exec&#34;</span><span class="op" id="7189542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7189545">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7189549">_</span><span class="op" id="7189550">,</span>&nbsp;<span class="ident" id="7189552"><a href="/gostd/database/sql/sql_test.go.html#7188758">err</a></span>&nbsp;<span class="op" id="7189556">=</span>&nbsp;<span class="ident" id="7189558"><a href="/gostd/database/sql/sql_test.go.html#7188290">db</a></span><span class="op" id="7189560">.</span><span class="ident" id="7189561"><a href="/gostd/database/sql/sql.go.html#5224928">Exec</a></span><span class="op" id="7189565">(</span><span class="string" id="7189566">&#34;INSERT|t|id=?,name=?,nullf=?&#34;</span><span class="op" id="7189596">,</span>&nbsp;<span class="num" id="7189598">999</span><span class="op" id="7189601">,</span>&nbsp;<span class="builtintype" id="7189603">nil</span><span class="op" id="7189606">,</span>&nbsp;<span class="builtintype" id="7189608">nil</span><span class="op" id="7189611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7189614">if</span>&nbsp;<span class="ident" id="7189617"><a href="/gostd/database/sql/sql_test.go.html#7188758">err</a></span>&nbsp;<span class="op" id="7189621">==</span>&nbsp;<span class="builtintype" id="7189624">nil</span>&nbsp;<span class="op" id="7189628">{</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7189632">//&nbsp;TODO:&nbsp;this&nbsp;test&nbsp;fails,&nbsp;but&nbsp;it&#39;s&nbsp;just&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7189682">//&nbsp;fakeConn&nbsp;implements&nbsp;the&nbsp;optional&nbsp;Execer&nbsp;interface,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7189738">//&nbsp;so&nbsp;arguably&nbsp;this&nbsp;is&nbsp;the&nbsp;correct&nbsp;behavior.&nbsp;&nbsp;But</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7189790">//&nbsp;maybe&nbsp;I&nbsp;should&nbsp;flesh&nbsp;out&nbsp;the&nbsp;fakeConn.Exec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7189838">//&nbsp;implementation&nbsp;so&nbsp;this&nbsp;properly&nbsp;fails.</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7189882">//&nbsp;t.Errorf(&#34;expected&nbsp;error&nbsp;inserting&nbsp;nil&nbsp;name&nbsp;with&nbsp;Exec&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7189942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7189946">paramtype</span>&nbsp;<span class="op" id="7189956">:=</span>&nbsp;<span class="ident" id="7189959"><a href="/gostd/database/sql/sql_test.go.html#7169092">reflect</a></span><span class="op" id="7189966">.</span><span class="ident" id="7189967"><a href="/gostd/reflect/type.go.html#2808718">TypeOf</a></span><span class="op" id="7189973">(</span><span class="ident" id="7189974"><a href="/gostd/database/sql/sql_test.go.html#7188268">spec</a></span><span class="op" id="7189978">.</span><span class="ident" id="7189979"><a href="/gostd/database/sql/sql_test.go.html#7186471">rows</a></span><span class="op" id="7189983">[</span><span class="num" id="7189984">0</span><span class="op" id="7189985">]</span><span class="op" id="7189986">.</span><span class="ident" id="7189987"><a href="/gostd/database/sql/sql_test.go.html#7186323">nullParam</a></span><span class="op" id="7189996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7189999">bindVal</span>&nbsp;<span class="op" id="7190007">:=</span>&nbsp;<span class="ident" id="7190010"><a href="/gostd/database/sql/sql_test.go.html#7169092">reflect</a></span><span class="op" id="7190017">.</span><span class="ident" id="7190018"><a href="/gostd/reflect/value.go.html#2893570">New</a></span><span class="op" id="7190021">(</span><span class="ident" id="7190022"><a href="/gostd/database/sql/sql_test.go.html#7189946">paramtype</a></span><span class="op" id="7190031">)</span><span class="op" id="7190032">.</span><span class="ident" id="7190033"><a href="/gostd/reflect/value.go.html#2858688">Interface</a></span><span class="op" id="7190042">(</span><span class="op" id="7190043">)</span><br>
<span class="lineno">830</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7190047">for</span>&nbsp;<span class="ident" id="7190051">i</span>&nbsp;<span class="op" id="7190053">:=</span>&nbsp;<span class="num" id="7190056">0</span><span class="op" id="7190057">;</span>&nbsp;<span class="ident" id="7190059"><a href="/gostd/database/sql/sql_test.go.html#7190051">i</a></span>&nbsp;<span class="op" id="7190061">&lt;</span>&nbsp;<span class="num" id="7190063">5</span><span class="op" id="7190064">;</span>&nbsp;<span class="ident" id="7190066"><a href="/gostd/database/sql/sql_test.go.html#7190051">i</a></span><span class="op" id="7190067">++</span>&nbsp;<span class="op" id="7190070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7190074">id</span>&nbsp;<span class="op" id="7190077">:=</span>&nbsp;<span class="ident" id="7190080"><a href="/gostd/database/sql/sql_test.go.html#7190051">i</a></span>&nbsp;<span class="op" id="7190082">+</span>&nbsp;<span class="num" id="7190084">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7190088">if</span>&nbsp;<span class="ident" id="7190091">err</span>&nbsp;<span class="op" id="7190095">:=</span>&nbsp;<span class="ident" id="7190098"><a href="/gostd/database/sql/sql_test.go.html#7188290">db</a></span><span class="op" id="7190100">.</span><span class="ident" id="7190101"><a href="/gostd/database/sql/sql.go.html#5227854">QueryRow</a></span><span class="op" id="7190109">(</span><span class="string" id="7190110">&#34;SELECT|t|nullf|id=?&#34;</span><span class="op" id="7190131">,</span>&nbsp;<span class="ident" id="7190133"><a href="/gostd/database/sql/sql_test.go.html#7190074">id</a></span><span class="op" id="7190135">)</span><span class="op" id="7190136">.</span><span class="ident" id="7190137"><a href="/gostd/database/sql/sql.go.html#5245114">Scan</a></span><span class="op" id="7190141">(</span><span class="ident" id="7190142"><a href="/gostd/database/sql/sql_test.go.html#7189999">bindVal</a></span><span class="op" id="7190149">)</span><span class="op" id="7190150">;</span>&nbsp;<span class="ident" id="7190152"><a href="/gostd/database/sql/sql_test.go.html#7190091">err</a></span>&nbsp;<span class="op" id="7190156">!=</span>&nbsp;<span class="builtintype" id="7190159">nil</span>&nbsp;<span class="op" id="7190163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7190168"><a href="/gostd/database/sql/sql_test.go.html#7188254">t</a></span><span class="op" id="7190169">.</span><span class="ident" id="7190170"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7190176">(</span><span class="string" id="7190177">&#34;id=%d&nbsp;Scan:&nbsp;%v&#34;</span><span class="op" id="7190193">,</span>&nbsp;<span class="ident" id="7190195"><a href="/gostd/database/sql/sql_test.go.html#7190074">id</a></span><span class="op" id="7190197">,</span>&nbsp;<span class="ident" id="7190199"><a href="/gostd/database/sql/sql_test.go.html#7190091">err</a></span><span class="op" id="7190202">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7190206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7190210">bindValDeref</span>&nbsp;<span class="op" id="7190223">:=</span>&nbsp;<span class="ident" id="7190226"><a href="/gostd/database/sql/sql_test.go.html#7169092">reflect</a></span><span class="op" id="7190233">.</span><span class="ident" id="7190234"><a href="/gostd/reflect/value.go.html#2892536">ValueOf</a></span><span class="op" id="7190241">(</span><span class="ident" id="7190242"><a href="/gostd/database/sql/sql_test.go.html#7189999">bindVal</a></span><span class="op" id="7190249">)</span><span class="op" id="7190250">.</span><span class="ident" id="7190251"><a href="/gostd/reflect/value.go.html#2853087">Elem</a></span><span class="op" id="7190255">(</span><span class="op" id="7190256">)</span><span class="op" id="7190257">.</span><span class="ident" id="7190258"><a href="/gostd/reflect/value.go.html#2858688">Interface</a></span><span class="op" id="7190267">(</span><span class="op" id="7190268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7190272">if</span>&nbsp;<span class="op" id="7190275">!</span><span class="ident" id="7190276"><a href="/gostd/database/sql/sql_test.go.html#7169092">reflect</a></span><span class="op" id="7190283">.</span><span class="ident" id="7190284"><a href="/gostd/reflect/deepequal.go.html#2775472">DeepEqual</a></span><span class="op" id="7190293">(</span><span class="ident" id="7190294"><a href="/gostd/database/sql/sql_test.go.html#7190210">bindValDeref</a></span><span class="op" id="7190306">,</span>&nbsp;<span class="ident" id="7190308"><a href="/gostd/database/sql/sql_test.go.html#7188268">spec</a></span><span class="op" id="7190312">.</span><span class="ident" id="7190313"><a href="/gostd/database/sql/sql_test.go.html#7186471">rows</a></span><span class="op" id="7190317">[</span><span class="ident" id="7190318"><a href="/gostd/database/sql/sql_test.go.html#7190051">i</a></span><span class="op" id="7190319">]</span><span class="op" id="7190320">.</span><span class="ident" id="7190321"><a href="/gostd/database/sql/sql_test.go.html#7186375">scanNullVal</a></span><span class="op" id="7190332">)</span>&nbsp;<span class="op" id="7190334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7190339"><a href="/gostd/database/sql/sql_test.go.html#7188254">t</a></span><span class="op" id="7190340">.</span><span class="ident" id="7190341"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7190347">(</span><span class="string" id="7190348">&#34;id=%d&nbsp;got&nbsp;%#v,&nbsp;want&nbsp;%#v&#34;</span><span class="op" id="7190373">,</span>&nbsp;<span class="ident" id="7190375"><a href="/gostd/database/sql/sql_test.go.html#7190074">id</a></span><span class="op" id="7190377">,</span>&nbsp;<span class="ident" id="7190379"><a href="/gostd/database/sql/sql_test.go.html#7190210">bindValDeref</a></span><span class="op" id="7190391">,</span>&nbsp;<span class="ident" id="7190393"><a href="/gostd/database/sql/sql_test.go.html#7188268">spec</a></span><span class="op" id="7190397">.</span><span class="ident" id="7190398"><a href="/gostd/database/sql/sql_test.go.html#7186471">rows</a></span><span class="op" id="7190402">[</span><span class="ident" id="7190403"><a href="/gostd/database/sql/sql_test.go.html#7190051">i</a></span><span class="op" id="7190404">]</span><span class="op" id="7190405">.</span><span class="ident" id="7190406"><a href="/gostd/database/sql/sql_test.go.html#7186375">scanNullVal</a></span><span class="op" id="7190417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7190421">}</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7190424">}</span><br>
<span class="lineno"></span><span class="op" id="7190426">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7190429">//&nbsp;golang.org/issue/4859</span><br>
<span class="lineno"></span><span class="keyword" id="7190454">func</span>&nbsp;<span class="ident" id="7190459">TestQueryRowNilScanDest</span><span class="op" id="7190482">(</span><span class="ident" id="7190483">t</span>&nbsp;<span class="op" id="7190485">*</span><span class="ident" id="7190486"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7190493">.</span><span class="ident" id="7190494"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7190495">)</span>&nbsp;<span class="op" id="7190497">{</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7190500">db</span>&nbsp;<span class="op" id="7190503">:=</span>&nbsp;<span class="ident" id="7190506"><a href="/gostd/database/sql/sql_test.go.html#7169849">newTestDB</a></span><span class="op" id="7190515">(</span><span class="ident" id="7190516"><a href="/gostd/database/sql/sql_test.go.html#7190483">t</a></span><span class="op" id="7190517">,</span>&nbsp;<span class="string" id="7190519">&#34;people&#34;</span><span class="op" id="7190527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7190530">defer</span>&nbsp;<span class="ident" id="7190536"><a href="/gostd/database/sql/sql_test.go.html#7170773">closeDB</a></span><span class="op" id="7190543">(</span><span class="ident" id="7190544"><a href="/gostd/database/sql/sql_test.go.html#7190483">t</a></span><span class="op" id="7190545">,</span>&nbsp;<span class="ident" id="7190547"><a href="/gostd/database/sql/sql_test.go.html#7190500">db</a></span><span class="op" id="7190549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7190552">var</span>&nbsp;<span class="ident" id="7190556">name</span>&nbsp;<span class="op" id="7190561">*</span><span class="builtintype" id="7190562">string</span>&nbsp;<span class="comment" id="7190569">//&nbsp;nil&nbsp;pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7190585">err</span>&nbsp;<span class="op" id="7190589">:=</span>&nbsp;<span class="ident" id="7190592"><a href="/gostd/database/sql/sql_test.go.html#7190500">db</a></span><span class="op" id="7190594">.</span><span class="ident" id="7190595"><a href="/gostd/database/sql/sql.go.html#5227854">QueryRow</a></span><span class="op" id="7190603">(</span><span class="string" id="7190604">&#34;SELECT|people|name|&#34;</span><span class="op" id="7190625">)</span><span class="op" id="7190626">.</span><span class="ident" id="7190627"><a href="/gostd/database/sql/sql.go.html#5245114">Scan</a></span><span class="op" id="7190631">(</span><span class="ident" id="7190632"><a href="/gostd/database/sql/sql_test.go.html#7190556">name</a></span><span class="op" id="7190636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7190639">want</span>&nbsp;<span class="op" id="7190644">:=</span>&nbsp;<span class="string" id="7190647">&#34;sql:&nbsp;Scan&nbsp;error&nbsp;on&nbsp;column&nbsp;index&nbsp;0:&nbsp;destination&nbsp;pointer&nbsp;is&nbsp;nil&#34;</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7190712">if</span>&nbsp;<span class="ident" id="7190715"><a href="/gostd/database/sql/sql_test.go.html#7190585">err</a></span>&nbsp;<span class="op" id="7190719">==</span>&nbsp;<span class="builtintype" id="7190722">nil</span>&nbsp;<span class="op" id="7190726">||</span>&nbsp;<span class="ident" id="7190729"><a href="/gostd/database/sql/sql_test.go.html#7190585">err</a></span><span class="op" id="7190732">.</span><span class="ident" id="7190733">Error</span><span class="op" id="7190738">(</span><span class="op" id="7190739">)</span>&nbsp;<span class="op" id="7190741">!=</span>&nbsp;<span class="ident" id="7190744"><a href="/gostd/database/sql/sql_test.go.html#7190639">want</a></span>&nbsp;<span class="op" id="7190749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7190753"><a href="/gostd/database/sql/sql_test.go.html#7190483">t</a></span><span class="op" id="7190754">.</span><span class="ident" id="7190755"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7190761">(</span><span class="string" id="7190762">&#34;error&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7190783">,</span>&nbsp;<span class="ident" id="7190785"><a href="/gostd/database/sql/sql_test.go.html#7190585">err</a></span><span class="op" id="7190788">.</span><span class="ident" id="7190789">Error</span><span class="op" id="7190794">(</span><span class="op" id="7190795">)</span><span class="op" id="7190796">,</span>&nbsp;<span class="ident" id="7190798"><a href="/gostd/database/sql/sql_test.go.html#7190639">want</a></span><span class="op" id="7190802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7190805">}</span><br>
<span class="lineno"></span><span class="op" id="7190807">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">855</span><span class="keyword" id="7190810">func</span>&nbsp;<span class="ident" id="7190815">TestIssue4902</span><span class="op" id="7190828">(</span><span class="ident" id="7190829">t</span>&nbsp;<span class="op" id="7190831">*</span><span class="ident" id="7190832"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7190839">.</span><span class="ident" id="7190840"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7190841">)</span>&nbsp;<span class="op" id="7190843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7190846">db</span>&nbsp;<span class="op" id="7190849">:=</span>&nbsp;<span class="ident" id="7190852"><a href="/gostd/database/sql/sql_test.go.html#7169849">newTestDB</a></span><span class="op" id="7190861">(</span><span class="ident" id="7190862"><a href="/gostd/database/sql/sql_test.go.html#7190829">t</a></span><span class="op" id="7190863">,</span>&nbsp;<span class="string" id="7190865">&#34;people&#34;</span><span class="op" id="7190873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7190876">defer</span>&nbsp;<span class="ident" id="7190882"><a href="/gostd/database/sql/sql_test.go.html#7170773">closeDB</a></span><span class="op" id="7190889">(</span><span class="ident" id="7190890"><a href="/gostd/database/sql/sql_test.go.html#7190829">t</a></span><span class="op" id="7190891">,</span>&nbsp;<span class="ident" id="7190893"><a href="/gostd/database/sql/sql_test.go.html#7190846">db</a></span><span class="op" id="7190895">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7190899">driver</span>&nbsp;<span class="op" id="7190906">:=</span>&nbsp;<span class="ident" id="7190909"><a href="/gostd/database/sql/sql_test.go.html#7190846">db</a></span><span class="op" id="7190911">.</span><span class="ident" id="7190912"><a href="/gostd/database/sql/sql.go.html#5207171">driver</a></span><span class="op" id="7190918">.</span><span class="op" id="7190919">(</span><span class="op" id="7190920">*</span><span class="ident" id="7190921"><a href="/gostd/database/sql/fakedb_test.go.html#7149380">fakeDriver</a></span><span class="op" id="7190931">)</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7190934">opens0</span>&nbsp;<span class="op" id="7190941">:=</span>&nbsp;<span class="ident" id="7190944"><a href="/gostd/database/sql/sql_test.go.html#7190899">driver</a></span><span class="op" id="7190950">.</span><span class="ident" id="7190951"><a href="/gostd/database/sql/fakedb_test.go.html#7149453">openCount</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7190963">var</span>&nbsp;<span class="ident" id="7190967">stmt</span>&nbsp;<span class="op" id="7190972">*</span><span class="ident" id="7190973"><a href="/gostd/database/sql/sql.go.html#5234451">Stmt</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7190979">var</span>&nbsp;<span class="ident" id="7190983">err</span>&nbsp;<span class="builtintype" id="7190987">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7190994">for</span>&nbsp;<span class="ident" id="7190998">i</span>&nbsp;<span class="op" id="7191000">:=</span>&nbsp;<span class="num" id="7191003">0</span><span class="op" id="7191004">;</span>&nbsp;<span class="ident" id="7191006"><a href="/gostd/database/sql/sql_test.go.html#7190998">i</a></span>&nbsp;<span class="op" id="7191008">&lt;</span>&nbsp;<span class="num" id="7191010">10</span><span class="op" id="7191012">;</span>&nbsp;<span class="ident" id="7191014"><a href="/gostd/database/sql/sql_test.go.html#7190998">i</a></span><span class="op" id="7191015">++</span>&nbsp;<span class="op" id="7191018">{</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7191022"><a href="/gostd/database/sql/sql_test.go.html#7190967">stmt</a></span><span class="op" id="7191026">,</span>&nbsp;<span class="ident" id="7191028"><a href="/gostd/database/sql/sql_test.go.html#7190983">err</a></span>&nbsp;<span class="op" id="7191032">=</span>&nbsp;<span class="ident" id="7191034"><a href="/gostd/database/sql/sql_test.go.html#7190846">db</a></span><span class="op" id="7191036">.</span><span class="ident" id="7191037"><a href="/gostd/database/sql/sql.go.html#5223860">Prepare</a></span><span class="op" id="7191044">(</span><span class="string" id="7191045">&#34;SELECT|people|name|&#34;</span><span class="op" id="7191066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7191070">if</span>&nbsp;<span class="ident" id="7191073"><a href="/gostd/database/sql/sql_test.go.html#7190983">err</a></span>&nbsp;<span class="op" id="7191077">!=</span>&nbsp;<span class="builtintype" id="7191080">nil</span>&nbsp;<span class="op" id="7191084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7191089"><a href="/gostd/database/sql/sql_test.go.html#7190829">t</a></span><span class="op" id="7191090">.</span><span class="ident" id="7191091"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="7191096">(</span><span class="ident" id="7191097"><a href="/gostd/database/sql/sql_test.go.html#7190983">err</a></span><span class="op" id="7191100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7191104">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7191108"><a href="/gostd/database/sql/sql_test.go.html#7190983">err</a></span>&nbsp;<span class="op" id="7191112">=</span>&nbsp;<span class="ident" id="7191114"><a href="/gostd/database/sql/sql_test.go.html#7190967">stmt</a></span><span class="op" id="7191118">.</span><span class="ident" id="7191119"><a href="/gostd/database/sql/sql.go.html#5240529">Close</a></span><span class="op" id="7191124">(</span><span class="op" id="7191125">)</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7191129">if</span>&nbsp;<span class="ident" id="7191132"><a href="/gostd/database/sql/sql_test.go.html#7190983">err</a></span>&nbsp;<span class="op" id="7191136">!=</span>&nbsp;<span class="builtintype" id="7191139">nil</span>&nbsp;<span class="op" id="7191143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7191148"><a href="/gostd/database/sql/sql_test.go.html#7190829">t</a></span><span class="op" id="7191149">.</span><span class="ident" id="7191150"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="7191155">(</span><span class="ident" id="7191156"><a href="/gostd/database/sql/sql_test.go.html#7190983">err</a></span><span class="op" id="7191159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7191163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7191166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7191170">opens</span>&nbsp;<span class="op" id="7191176">:=</span>&nbsp;<span class="ident" id="7191179"><a href="/gostd/database/sql/sql_test.go.html#7190899">driver</a></span><span class="op" id="7191185">.</span><span class="ident" id="7191186"><a href="/gostd/database/sql/fakedb_test.go.html#7149453">openCount</a></span>&nbsp;<span class="op" id="7191196">-</span>&nbsp;<span class="ident" id="7191198"><a href="/gostd/database/sql/sql_test.go.html#7190934">opens0</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7191206">if</span>&nbsp;<span class="ident" id="7191209"><a href="/gostd/database/sql/sql_test.go.html#7191170">opens</a></span>&nbsp;<span class="op" id="7191215">&gt;</span>&nbsp;<span class="num" id="7191217">1</span>&nbsp;<span class="op" id="7191219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7191223"><a href="/gostd/database/sql/sql_test.go.html#7190829">t</a></span><span class="op" id="7191224">.</span><span class="ident" id="7191225"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7191231">(</span><span class="string" id="7191232">&#34;opens&nbsp;=&nbsp;%d;&nbsp;want&nbsp;&lt;=&nbsp;1&#34;</span><span class="op" id="7191255">,</span>&nbsp;<span class="ident" id="7191257"><a href="/gostd/database/sql/sql_test.go.html#7191170">opens</a></span><span class="op" id="7191262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7191266"><a href="/gostd/database/sql/sql_test.go.html#7190829">t</a></span><span class="op" id="7191267">.</span><span class="ident" id="7191268"><a href="/gostd/testing/testing.go.html#5479816">Logf</a></span><span class="op" id="7191272">(</span><span class="string" id="7191273">&#34;db&nbsp;=&nbsp;%#v&#34;</span><span class="op" id="7191283">,</span>&nbsp;<span class="ident" id="7191285"><a href="/gostd/database/sql/sql_test.go.html#7190846">db</a></span><span class="op" id="7191287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7191291"><a href="/gostd/database/sql/sql_test.go.html#7190829">t</a></span><span class="op" id="7191292">.</span><span class="ident" id="7191293"><a href="/gostd/testing/testing.go.html#5479816">Logf</a></span><span class="op" id="7191297">(</span><span class="string" id="7191298">&#34;driver&nbsp;=&nbsp;%#v&#34;</span><span class="op" id="7191312">,</span>&nbsp;<span class="ident" id="7191314"><a href="/gostd/database/sql/sql_test.go.html#7190899">driver</a></span><span class="op" id="7191320">)</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7191324"><a href="/gostd/database/sql/sql_test.go.html#7190829">t</a></span><span class="op" id="7191325">.</span><span class="ident" id="7191326"><a href="/gostd/testing/testing.go.html#5479816">Logf</a></span><span class="op" id="7191330">(</span><span class="string" id="7191331">&#34;stmt&nbsp;=&nbsp;%#v&#34;</span><span class="op" id="7191343">,</span>&nbsp;<span class="ident" id="7191345"><a href="/gostd/database/sql/sql_test.go.html#7190967">stmt</a></span><span class="op" id="7191349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7191352">}</span><br>
<span class="lineno"></span><span class="op" id="7191354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7191357">//&nbsp;Issue&nbsp;3857</span><br>
<span class="lineno">885</span><span class="comment" id="7191371">//&nbsp;This&nbsp;used&nbsp;to&nbsp;deadlock.</span><br>
<span class="lineno"></span><span class="keyword" id="7191397">func</span>&nbsp;<span class="ident" id="7191402">TestSimultaneousQueries</span><span class="op" id="7191425">(</span><span class="ident" id="7191426">t</span>&nbsp;<span class="op" id="7191428">*</span><span class="ident" id="7191429"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7191436">.</span><span class="ident" id="7191437"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7191438">)</span>&nbsp;<span class="op" id="7191440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7191443">db</span>&nbsp;<span class="op" id="7191446">:=</span>&nbsp;<span class="ident" id="7191449"><a href="/gostd/database/sql/sql_test.go.html#7169849">newTestDB</a></span><span class="op" id="7191458">(</span><span class="ident" id="7191459"><a href="/gostd/database/sql/sql_test.go.html#7191426">t</a></span><span class="op" id="7191460">,</span>&nbsp;<span class="string" id="7191462">&#34;people&#34;</span><span class="op" id="7191470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7191473">defer</span>&nbsp;<span class="ident" id="7191479"><a href="/gostd/database/sql/sql_test.go.html#7170773">closeDB</a></span><span class="op" id="7191486">(</span><span class="ident" id="7191487"><a href="/gostd/database/sql/sql_test.go.html#7191426">t</a></span><span class="op" id="7191488">,</span>&nbsp;<span class="ident" id="7191490"><a href="/gostd/database/sql/sql_test.go.html#7191443">db</a></span><span class="op" id="7191492">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7191496">tx</span><span class="op" id="7191498">,</span>&nbsp;<span class="ident" id="7191500">err</span>&nbsp;<span class="op" id="7191504">:=</span>&nbsp;<span class="ident" id="7191507"><a href="/gostd/database/sql/sql_test.go.html#7191443">db</a></span><span class="op" id="7191509">.</span><span class="ident" id="7191510"><a href="/gostd/database/sql/sql.go.html#5228078">Begin</a></span><span class="op" id="7191515">(</span><span class="op" id="7191516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7191519">if</span>&nbsp;<span class="ident" id="7191522"><a href="/gostd/database/sql/sql_test.go.html#7191500">err</a></span>&nbsp;<span class="op" id="7191526">!=</span>&nbsp;<span class="builtintype" id="7191529">nil</span>&nbsp;<span class="op" id="7191533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7191537"><a href="/gostd/database/sql/sql_test.go.html#7191426">t</a></span><span class="op" id="7191538">.</span><span class="ident" id="7191539"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="7191544">(</span><span class="ident" id="7191545"><a href="/gostd/database/sql/sql_test.go.html#7191500">err</a></span><span class="op" id="7191548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7191551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7191554">defer</span>&nbsp;<span class="ident" id="7191560"><a href="/gostd/database/sql/sql_test.go.html#7191496">tx</a></span><span class="op" id="7191562">.</span><span class="ident" id="7191563"><a href="/gostd/database/sql/sql.go.html#5230160">Rollback</a></span><span class="op" id="7191571">(</span><span class="op" id="7191572">)</span><br>
<span class="lineno">895</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7191576">r1</span><span class="op" id="7191578">,</span>&nbsp;<span class="ident" id="7191580"><a href="/gostd/database/sql/sql_test.go.html#7191500">err</a></span>&nbsp;<span class="op" id="7191584">:=</span>&nbsp;<span class="ident" id="7191587"><a href="/gostd/database/sql/sql_test.go.html#7191496">tx</a></span><span class="op" id="7191589">.</span><span class="ident" id="7191590"><a href="/gostd/database/sql/sql.go.html#5233709">Query</a></span><span class="op" id="7191595">(</span><span class="string" id="7191596">&#34;SELECT|people|name|&#34;</span><span class="op" id="7191617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7191620">if</span>&nbsp;<span class="ident" id="7191623"><a href="/gostd/database/sql/sql_test.go.html#7191500">err</a></span>&nbsp;<span class="op" id="7191627">!=</span>&nbsp;<span class="builtintype" id="7191630">nil</span>&nbsp;<span class="op" id="7191634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7191638"><a href="/gostd/database/sql/sql_test.go.html#7191426">t</a></span><span class="op" id="7191639">.</span><span class="ident" id="7191640"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="7191645">(</span><span class="ident" id="7191646"><a href="/gostd/database/sql/sql_test.go.html#7191500">err</a></span><span class="op" id="7191649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7191652">}</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7191655">defer</span>&nbsp;<span class="ident" id="7191661"><a href="/gostd/database/sql/sql_test.go.html#7191576">r1</a></span><span class="op" id="7191663">.</span><span class="ident" id="7191664"><a href="/gostd/database/sql/sql.go.html#5244447">Close</a></span><span class="op" id="7191669">(</span><span class="op" id="7191670">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7191674">r2</span><span class="op" id="7191676">,</span>&nbsp;<span class="ident" id="7191678"><a href="/gostd/database/sql/sql_test.go.html#7191500">err</a></span>&nbsp;<span class="op" id="7191682">:=</span>&nbsp;<span class="ident" id="7191685"><a href="/gostd/database/sql/sql_test.go.html#7191496">tx</a></span><span class="op" id="7191687">.</span><span class="ident" id="7191688"><a href="/gostd/database/sql/sql.go.html#5233709">Query</a></span><span class="op" id="7191693">(</span><span class="string" id="7191694">&#34;SELECT|people|name|&#34;</span><span class="op" id="7191715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7191718">if</span>&nbsp;<span class="ident" id="7191721"><a href="/gostd/database/sql/sql_test.go.html#7191500">err</a></span>&nbsp;<span class="op" id="7191725">!=</span>&nbsp;<span class="builtintype" id="7191728">nil</span>&nbsp;<span class="op" id="7191732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7191736"><a href="/gostd/database/sql/sql_test.go.html#7191426">t</a></span><span class="op" id="7191737">.</span><span class="ident" id="7191738"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="7191743">(</span><span class="ident" id="7191744"><a href="/gostd/database/sql/sql_test.go.html#7191500">err</a></span><span class="op" id="7191747">)</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7191750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7191753">defer</span>&nbsp;<span class="ident" id="7191759"><a href="/gostd/database/sql/sql_test.go.html#7191674">r2</a></span><span class="op" id="7191761">.</span><span class="ident" id="7191762"><a href="/gostd/database/sql/sql.go.html#5244447">Close</a></span><span class="op" id="7191767">(</span><span class="op" id="7191768">)</span><br>
<span class="lineno"></span><span class="op" id="7191770">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7191773">func</span>&nbsp;<span class="ident" id="7191778">TestMaxIdleConns</span><span class="op" id="7191794">(</span><span class="ident" id="7191795">t</span>&nbsp;<span class="op" id="7191797">*</span><span class="ident" id="7191798"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7191805">.</span><span class="ident" id="7191806"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7191807">)</span>&nbsp;<span class="op" id="7191809">{</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7191812">db</span>&nbsp;<span class="op" id="7191815">:=</span>&nbsp;<span class="ident" id="7191818"><a href="/gostd/database/sql/sql_test.go.html#7169849">newTestDB</a></span><span class="op" id="7191827">(</span><span class="ident" id="7191828"><a href="/gostd/database/sql/sql_test.go.html#7191795">t</a></span><span class="op" id="7191829">,</span>&nbsp;<span class="string" id="7191831">&#34;people&#34;</span><span class="op" id="7191839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7191842">defer</span>&nbsp;<span class="ident" id="7191848"><a href="/gostd/database/sql/sql_test.go.html#7170773">closeDB</a></span><span class="op" id="7191855">(</span><span class="ident" id="7191856"><a href="/gostd/database/sql/sql_test.go.html#7191795">t</a></span><span class="op" id="7191857">,</span>&nbsp;<span class="ident" id="7191859"><a href="/gostd/database/sql/sql_test.go.html#7191812">db</a></span><span class="op" id="7191861">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7191865">tx</span><span class="op" id="7191867">,</span>&nbsp;<span class="ident" id="7191869">err</span>&nbsp;<span class="op" id="7191873">:=</span>&nbsp;<span class="ident" id="7191876"><a href="/gostd/database/sql/sql_test.go.html#7191812">db</a></span><span class="op" id="7191878">.</span><span class="ident" id="7191879"><a href="/gostd/database/sql/sql.go.html#5228078">Begin</a></span><span class="op" id="7191884">(</span><span class="op" id="7191885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7191888">if</span>&nbsp;<span class="ident" id="7191891"><a href="/gostd/database/sql/sql_test.go.html#7191869">err</a></span>&nbsp;<span class="op" id="7191895">!=</span>&nbsp;<span class="builtintype" id="7191898">nil</span>&nbsp;<span class="op" id="7191902">{</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7191906"><a href="/gostd/database/sql/sql_test.go.html#7191795">t</a></span><span class="op" id="7191907">.</span><span class="ident" id="7191908"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="7191913">(</span><span class="ident" id="7191914"><a href="/gostd/database/sql/sql_test.go.html#7191869">err</a></span><span class="op" id="7191917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7191920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7191923"><a href="/gostd/database/sql/sql_test.go.html#7191865">tx</a></span><span class="op" id="7191925">.</span><span class="ident" id="7191926"><a href="/gostd/database/sql/sql.go.html#5229915">Commit</a></span><span class="op" id="7191932">(</span><span class="op" id="7191933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7191936">if</span>&nbsp;<span class="ident" id="7191939">got</span>&nbsp;<span class="op" id="7191943">:=</span>&nbsp;<span class="builtinfunc" id="7191946">len</span><span class="op" id="7191949">(</span><span class="ident" id="7191950"><a href="/gostd/database/sql/sql_test.go.html#7191812">db</a></span><span class="op" id="7191952">.</span><span class="ident" id="7191953"><a href="/gostd/database/sql/sql.go.html#5207263">freeConn</a></span><span class="op" id="7191961">)</span><span class="op" id="7191962">;</span>&nbsp;<span class="ident" id="7191964"><a href="/gostd/database/sql/sql_test.go.html#7191939">got</a></span>&nbsp;<span class="op" id="7191968">!=</span>&nbsp;<span class="num" id="7191971">1</span>&nbsp;<span class="op" id="7191973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7191977"><a href="/gostd/database/sql/sql_test.go.html#7191795">t</a></span><span class="op" id="7191978">.</span><span class="ident" id="7191979"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7191985">(</span><span class="string" id="7191986">&#34;freeConns&nbsp;=&nbsp;%d;&nbsp;want&nbsp;1&#34;</span><span class="op" id="7192010">,</span>&nbsp;<span class="ident" id="7192012"><a href="/gostd/database/sql/sql_test.go.html#7191939">got</a></span><span class="op" id="7192015">)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7192018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7192022"><a href="/gostd/database/sql/sql_test.go.html#7191812">db</a></span><span class="op" id="7192024">.</span><span class="ident" id="7192025"><a href="/gostd/database/sql/sql.go.html#5215871">SetMaxIdleConns</a></span><span class="op" id="7192040">(</span><span class="num" id="7192041">0</span><span class="op" id="7192042">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7192046">if</span>&nbsp;<span class="ident" id="7192049">got</span>&nbsp;<span class="op" id="7192053">:=</span>&nbsp;<span class="builtinfunc" id="7192056">len</span><span class="op" id="7192059">(</span><span class="ident" id="7192060"><a href="/gostd/database/sql/sql_test.go.html#7191812">db</a></span><span class="op" id="7192062">.</span><span class="ident" id="7192063"><a href="/gostd/database/sql/sql.go.html#5207263">freeConn</a></span><span class="op" id="7192071">)</span><span class="op" id="7192072">;</span>&nbsp;<span class="ident" id="7192074"><a href="/gostd/database/sql/sql_test.go.html#7192049">got</a></span>&nbsp;<span class="op" id="7192078">!=</span>&nbsp;<span class="num" id="7192081">0</span>&nbsp;<span class="op" id="7192083">{</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7192087"><a href="/gostd/database/sql/sql_test.go.html#7191795">t</a></span><span class="op" id="7192088">.</span><span class="ident" id="7192089"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7192095">(</span><span class="string" id="7192096">&#34;freeConns&nbsp;after&nbsp;set&nbsp;to&nbsp;zero&nbsp;=&nbsp;%d;&nbsp;want&nbsp;0&#34;</span><span class="op" id="7192138">,</span>&nbsp;<span class="ident" id="7192140"><a href="/gostd/database/sql/sql_test.go.html#7192049">got</a></span><span class="op" id="7192143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7192146">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7192150"><a href="/gostd/database/sql/sql_test.go.html#7191865">tx</a></span><span class="op" id="7192152">,</span>&nbsp;<span class="ident" id="7192154"><a href="/gostd/database/sql/sql_test.go.html#7191869">err</a></span>&nbsp;<span class="op" id="7192158">=</span>&nbsp;<span class="ident" id="7192160"><a href="/gostd/database/sql/sql_test.go.html#7191812">db</a></span><span class="op" id="7192162">.</span><span class="ident" id="7192163"><a href="/gostd/database/sql/sql.go.html#5228078">Begin</a></span><span class="op" id="7192168">(</span><span class="op" id="7192169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7192172">if</span>&nbsp;<span class="ident" id="7192175"><a href="/gostd/database/sql/sql_test.go.html#7191869">err</a></span>&nbsp;<span class="op" id="7192179">!=</span>&nbsp;<span class="builtintype" id="7192182">nil</span>&nbsp;<span class="op" id="7192186">{</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7192190"><a href="/gostd/database/sql/sql_test.go.html#7191795">t</a></span><span class="op" id="7192191">.</span><span class="ident" id="7192192"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="7192197">(</span><span class="ident" id="7192198"><a href="/gostd/database/sql/sql_test.go.html#7191869">err</a></span><span class="op" id="7192201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7192204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7192207"><a href="/gostd/database/sql/sql_test.go.html#7191865">tx</a></span><span class="op" id="7192209">.</span><span class="ident" id="7192210"><a href="/gostd/database/sql/sql.go.html#5229915">Commit</a></span><span class="op" id="7192216">(</span><span class="op" id="7192217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7192220">if</span>&nbsp;<span class="ident" id="7192223">got</span>&nbsp;<span class="op" id="7192227">:=</span>&nbsp;<span class="builtinfunc" id="7192230">len</span><span class="op" id="7192233">(</span><span class="ident" id="7192234"><a href="/gostd/database/sql/sql_test.go.html#7191812">db</a></span><span class="op" id="7192236">.</span><span class="ident" id="7192237"><a href="/gostd/database/sql/sql.go.html#5207263">freeConn</a></span><span class="op" id="7192245">)</span><span class="op" id="7192246">;</span>&nbsp;<span class="ident" id="7192248"><a href="/gostd/database/sql/sql_test.go.html#7192223">got</a></span>&nbsp;<span class="op" id="7192252">!=</span>&nbsp;<span class="num" id="7192255">0</span>&nbsp;<span class="op" id="7192257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7192261"><a href="/gostd/database/sql/sql_test.go.html#7191795">t</a></span><span class="op" id="7192262">.</span><span class="ident" id="7192263"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7192269">(</span><span class="string" id="7192270">&#34;freeConns&nbsp;=&nbsp;%d;&nbsp;want&nbsp;0&#34;</span><span class="op" id="7192294">,</span>&nbsp;<span class="ident" id="7192296"><a href="/gostd/database/sql/sql_test.go.html#7192223">got</a></span><span class="op" id="7192299">)</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7192302">}</span><br>
<span class="lineno"></span><span class="op" id="7192304">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7192307">func</span>&nbsp;<span class="ident" id="7192312">TestMaxOpenConns</span><span class="op" id="7192328">(</span><span class="ident" id="7192329">t</span>&nbsp;<span class="op" id="7192331">*</span><span class="ident" id="7192332"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7192339">.</span><span class="ident" id="7192340"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7192341">)</span>&nbsp;<span class="op" id="7192343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7192346">if</span>&nbsp;<span class="ident" id="7192349"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7192356">.</span><span class="ident" id="7192357"><a href="/gostd/testing/testing.go.html#5475359">Short</a></span><span class="op" id="7192362">(</span><span class="op" id="7192363">)</span>&nbsp;<span class="op" id="7192365">{</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7192369"><a href="/gostd/database/sql/sql_test.go.html#7192329">t</a></span><span class="op" id="7192370">.</span><span class="ident" id="7192371"><a href="/gostd/testing/testing.go.html#5480575">Skip</a></span><span class="op" id="7192375">(</span><span class="string" id="7192376">&#34;skipping&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="7192400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7192403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7192406">defer</span>&nbsp;<span class="ident" id="7192412"><a href="/gostd/database/sql/fakedb_test.go.html#7154130">setHookpostCloseConn</a></span><span class="op" id="7192432">(</span><span class="builtintype" id="7192433">nil</span><span class="op" id="7192436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7192439"><a href="/gostd/database/sql/fakedb_test.go.html#7154130">setHookpostCloseConn</a></span><span class="op" id="7192459">(</span><span class="keyword" id="7192460">func</span><span class="op" id="7192464">(</span><span class="ident" id="7192465">_</span>&nbsp;<span class="op" id="7192467">*</span><span class="ident" id="7192468"><a href="/gostd/database/sql/fakedb_test.go.html#7150186">fakeConn</a></span><span class="op" id="7192476">,</span>&nbsp;<span class="ident" id="7192478">err</span>&nbsp;<span class="builtintype" id="7192482">error</span><span class="op" id="7192487">)</span>&nbsp;<span class="op" id="7192489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7192493">if</span>&nbsp;<span class="ident" id="7192496"><a href="/gostd/database/sql/sql_test.go.html#7192478">err</a></span>&nbsp;<span class="op" id="7192500">!=</span>&nbsp;<span class="builtintype" id="7192503">nil</span>&nbsp;<span class="op" id="7192507">{</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7192512"><a href="/gostd/database/sql/sql_test.go.html#7192329">t</a></span><span class="op" id="7192513">.</span><span class="ident" id="7192514"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7192520">(</span><span class="string" id="7192521">&#34;Error&nbsp;closing&nbsp;fakeConn:&nbsp;%v&#34;</span><span class="op" id="7192549">,</span>&nbsp;<span class="ident" id="7192551"><a href="/gostd/database/sql/sql_test.go.html#7192478">err</a></span><span class="op" id="7192554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7192558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7192561">}</span><span class="op" id="7192562">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7192566">db</span>&nbsp;<span class="op" id="7192569">:=</span>&nbsp;<span class="ident" id="7192572"><a href="/gostd/database/sql/sql_test.go.html#7169849">newTestDB</a></span><span class="op" id="7192581">(</span><span class="ident" id="7192582"><a href="/gostd/database/sql/sql_test.go.html#7192329">t</a></span><span class="op" id="7192583">,</span>&nbsp;<span class="string" id="7192585">&#34;magicquery&#34;</span><span class="op" id="7192597">)</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7192600">defer</span>&nbsp;<span class="ident" id="7192606"><a href="/gostd/database/sql/sql_test.go.html#7170773">closeDB</a></span><span class="op" id="7192613">(</span><span class="ident" id="7192614"><a href="/gostd/database/sql/sql_test.go.html#7192329">t</a></span><span class="op" id="7192615">,</span>&nbsp;<span class="ident" id="7192617"><a href="/gostd/database/sql/sql_test.go.html#7192566">db</a></span><span class="op" id="7192619">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7192623">driver</span>&nbsp;<span class="op" id="7192630">:=</span>&nbsp;<span class="ident" id="7192633"><a href="/gostd/database/sql/sql_test.go.html#7192566">db</a></span><span class="op" id="7192635">.</span><span class="ident" id="7192636"><a href="/gostd/database/sql/sql.go.html#5207171">driver</a></span><span class="op" id="7192642">.</span><span class="op" id="7192643">(</span><span class="op" id="7192644">*</span><span class="ident" id="7192645"><a href="/gostd/database/sql/fakedb_test.go.html#7149380">fakeDriver</a></span><span class="op" id="7192655">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7192659">//&nbsp;Force&nbsp;the&nbsp;number&nbsp;of&nbsp;open&nbsp;connections&nbsp;to&nbsp;0&nbsp;so&nbsp;we&nbsp;can&nbsp;get&nbsp;an&nbsp;accurate</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7192731">//&nbsp;count&nbsp;for&nbsp;the&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7192754"><a href="/gostd/database/sql/sql_test.go.html#7192566">db</a></span><span class="op" id="7192756">.</span><span class="ident" id="7192757"><a href="/gostd/database/sql/sql.go.html#5215871">SetMaxIdleConns</a></span><span class="op" id="7192772">(</span><span class="num" id="7192773">0</span><span class="op" id="7192774">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7192778">if</span>&nbsp;<span class="ident" id="7192781">g</span><span class="op" id="7192782">,</span>&nbsp;<span class="ident" id="7192784">w</span>&nbsp;<span class="op" id="7192786">:=</span>&nbsp;<span class="ident" id="7192789"><a href="/gostd/database/sql/sql_test.go.html#7192566">db</a></span><span class="op" id="7192791">.</span><span class="ident" id="7192792"><a href="/gostd/database/sql/sql_test.go.html#7172377">numFreeConns</a></span><span class="op" id="7192804">(</span><span class="op" id="7192805">)</span><span class="op" id="7192806">,</span>&nbsp;<span class="num" id="7192808">0</span><span class="op" id="7192809">;</span>&nbsp;<span class="ident" id="7192811"><a href="/gostd/database/sql/sql_test.go.html#7192781">g</a></span>&nbsp;<span class="op" id="7192813">!=</span>&nbsp;<span class="ident" id="7192816"><a href="/gostd/database/sql/sql_test.go.html#7192784">w</a></span>&nbsp;<span class="op" id="7192818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7192822"><a href="/gostd/database/sql/sql_test.go.html#7192329">t</a></span><span class="op" id="7192823">.</span><span class="ident" id="7192824"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7192830">(</span><span class="string" id="7192831">&#34;free&nbsp;conns&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7192857">,</span>&nbsp;<span class="ident" id="7192859"><a href="/gostd/database/sql/sql_test.go.html#7192781">g</a></span><span class="op" id="7192860">,</span>&nbsp;<span class="ident" id="7192862"><a href="/gostd/database/sql/sql_test.go.html#7192784">w</a></span><span class="op" id="7192863">)</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7192866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7192870">if</span>&nbsp;<span class="ident" id="7192873">n</span>&nbsp;<span class="op" id="7192875">:=</span>&nbsp;<span class="ident" id="7192878"><a href="/gostd/database/sql/sql_test.go.html#7192566">db</a></span><span class="op" id="7192880">.</span><span class="ident" id="7192881"><a href="/gostd/database/sql/sql_test.go.html#7172150">numDepsPollUntil</a></span><span class="op" id="7192897">(</span><span class="num" id="7192898">0</span><span class="op" id="7192899">,</span>&nbsp;<span class="ident" id="7192901"><a href="/gostd/database/sql/sql_test.go.html#7169144">time</a></span><span class="op" id="7192905">.</span><span class="ident" id="7192906"><a href="/gostd/time/time.go.html#2734862">Second</a></span><span class="op" id="7192912">)</span><span class="op" id="7192913">;</span>&nbsp;<span class="ident" id="7192915"><a href="/gostd/database/sql/sql_test.go.html#7192873">n</a></span>&nbsp;<span class="op" id="7192917">&gt;</span>&nbsp;<span class="num" id="7192919">0</span>&nbsp;<span class="op" id="7192921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7192925"><a href="/gostd/database/sql/sql_test.go.html#7192329">t</a></span><span class="op" id="7192926">.</span><span class="ident" id="7192927"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7192933">(</span><span class="string" id="7192934">&#34;number&nbsp;of&nbsp;dependencies&nbsp;=&nbsp;%d;&nbsp;expected&nbsp;0&#34;</span><span class="op" id="7192975">,</span>&nbsp;<span class="ident" id="7192977"><a href="/gostd/database/sql/sql_test.go.html#7192873">n</a></span><span class="op" id="7192978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7192982"><a href="/gostd/database/sql/sql_test.go.html#7192566">db</a></span><span class="op" id="7192984">.</span><span class="ident" id="7192985"><a href="/gostd/database/sql/sql_test.go.html#7172476">dumpDeps</a></span><span class="op" id="7192993">(</span><span class="ident" id="7192994"><a href="/gostd/database/sql/sql_test.go.html#7192329">t</a></span><span class="op" id="7192995">)</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7192998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7193002"><a href="/gostd/database/sql/sql_test.go.html#7192623">driver</a></span><span class="op" id="7193008">.</span><span class="ident" id="7193009"><a href="/gostd/database/sql/fakedb_test.go.html#7149401">mu</a></span><span class="op" id="7193011">.</span><span class="ident" id="7193012"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="7193016">(</span><span class="op" id="7193017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7193020">opens0</span>&nbsp;<span class="op" id="7193027">:=</span>&nbsp;<span class="ident" id="7193030"><a href="/gostd/database/sql/sql_test.go.html#7192623">driver</a></span><span class="op" id="7193036">.</span><span class="ident" id="7193037"><a href="/gostd/database/sql/fakedb_test.go.html#7149453">openCount</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7193048">closes0</span>&nbsp;<span class="op" id="7193056">:=</span>&nbsp;<span class="ident" id="7193059"><a href="/gostd/database/sql/sql_test.go.html#7192623">driver</a></span><span class="op" id="7193065">.</span><span class="ident" id="7193066"><a href="/gostd/database/sql/fakedb_test.go.html#7149490">closeCount</a></span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7193078"><a href="/gostd/database/sql/sql_test.go.html#7192623">driver</a></span><span class="op" id="7193084">.</span><span class="ident" id="7193085"><a href="/gostd/database/sql/fakedb_test.go.html#7149401">mu</a></span><span class="op" id="7193087">.</span><span class="ident" id="7193088"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="7193094">(</span><span class="op" id="7193095">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7193099"><a href="/gostd/database/sql/sql_test.go.html#7192566">db</a></span><span class="op" id="7193101">.</span><span class="ident" id="7193102"><a href="/gostd/database/sql/sql.go.html#5215871">SetMaxIdleConns</a></span><span class="op" id="7193117">(</span><span class="num" id="7193118">10</span><span class="op" id="7193120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7193123"><a href="/gostd/database/sql/sql_test.go.html#7192566">db</a></span><span class="op" id="7193125">.</span><span class="ident" id="7193126"><a href="/gostd/database/sql/sql.go.html#5216759">SetMaxOpenConns</a></span><span class="op" id="7193141">(</span><span class="num" id="7193142">10</span><span class="op" id="7193144">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7193148">stmt</span><span class="op" id="7193152">,</span>&nbsp;<span class="ident" id="7193154">err</span>&nbsp;<span class="op" id="7193158">:=</span>&nbsp;<span class="ident" id="7193161"><a href="/gostd/database/sql/sql_test.go.html#7192566">db</a></span><span class="op" id="7193163">.</span><span class="ident" id="7193164"><a href="/gostd/database/sql/sql.go.html#5223860">Prepare</a></span><span class="op" id="7193171">(</span><span class="string" id="7193172">&#34;SELECT|magicquery|op|op=?,millis=?&#34;</span><span class="op" id="7193208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7193211">if</span>&nbsp;<span class="ident" id="7193214"><a href="/gostd/database/sql/sql_test.go.html#7193154">err</a></span>&nbsp;<span class="op" id="7193218">!=</span>&nbsp;<span class="builtintype" id="7193221">nil</span>&nbsp;<span class="op" id="7193225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7193229"><a href="/gostd/database/sql/sql_test.go.html#7192329">t</a></span><span class="op" id="7193230">.</span><span class="ident" id="7193231"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="7193236">(</span><span class="ident" id="7193237"><a href="/gostd/database/sql/sql_test.go.html#7193154">err</a></span><span class="op" id="7193240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7193243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">980</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7193247">//&nbsp;Start&nbsp;50&nbsp;parallel&nbsp;slow&nbsp;queries.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7193283">const</span>&nbsp;<span class="op" id="7193289">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7193293">nquery</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7193305">=</span>&nbsp;<span class="num" id="7193307">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7193312">sleepMillis</span>&nbsp;<span class="op" id="7193324">=</span>&nbsp;<span class="num" id="7193326">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7193331">nbatch</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7193343">=</span>&nbsp;<span class="num" id="7193345">2</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7193348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7193351">var</span>&nbsp;<span class="ident" id="7193355">wg</span>&nbsp;<span class="ident" id="7193358"><a href="/gostd/database/sql/sql_test.go.html#7169125">sync</a></span><span class="op" id="7193362">.</span><span class="ident" id="7193363"><a href="/gostd/sync/waitgroup.go.html#1459933">WaitGroup</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7193374">for</span>&nbsp;<span class="ident" id="7193378">batch</span>&nbsp;<span class="op" id="7193384">:=</span>&nbsp;<span class="num" id="7193387">0</span><span class="op" id="7193388">;</span>&nbsp;<span class="ident" id="7193390"><a href="/gostd/database/sql/sql_test.go.html#7193378">batch</a></span>&nbsp;<span class="op" id="7193396">&lt;</span>&nbsp;<span class="ident" id="7193398"><a href="/gostd/database/sql/sql_test.go.html#7193331">nbatch</a></span><span class="op" id="7193404">;</span>&nbsp;<span class="ident" id="7193406"><a href="/gostd/database/sql/sql_test.go.html#7193378">batch</a></span><span class="op" id="7193411">++</span>&nbsp;<span class="op" id="7193414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7193418">for</span>&nbsp;<span class="ident" id="7193422">i</span>&nbsp;<span class="op" id="7193424">:=</span>&nbsp;<span class="num" id="7193427">0</span><span class="op" id="7193428">;</span>&nbsp;<span class="ident" id="7193430"><a href="/gostd/database/sql/sql_test.go.html#7193422">i</a></span>&nbsp;<span class="op" id="7193432">&lt;</span>&nbsp;<span class="ident" id="7193434"><a href="/gostd/database/sql/sql_test.go.html#7193293">nquery</a></span><span class="op" id="7193440">;</span>&nbsp;<span class="ident" id="7193442"><a href="/gostd/database/sql/sql_test.go.html#7193422">i</a></span><span class="op" id="7193443">++</span>&nbsp;<span class="op" id="7193446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7193451"><a href="/gostd/database/sql/sql_test.go.html#7193355">wg</a></span><span class="op" id="7193453">.</span><span class="ident" id="7193454"><a href="/gostd/sync/waitgroup.go.html#1461154">Add</a></span><span class="op" id="7193457">(</span><span class="num" id="7193458">1</span><span class="op" id="7193459">)</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7193464">go</span>&nbsp;<span class="keyword" id="7193467">func</span><span class="op" id="7193471">(</span><span class="op" id="7193472">)</span>&nbsp;<span class="op" id="7193474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7193480">defer</span>&nbsp;<span class="ident" id="7193486"><a href="/gostd/database/sql/sql_test.go.html#7193355">wg</a></span><span class="op" id="7193488">.</span><span class="ident" id="7193489"><a href="/gostd/sync/waitgroup.go.html#1462065">Done</a></span><span class="op" id="7193493">(</span><span class="op" id="7193494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7193500">var</span>&nbsp;<span class="ident" id="7193504">op</span>&nbsp;<span class="builtintype" id="7193507">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7193518">if</span>&nbsp;<span class="ident" id="7193521">err</span>&nbsp;<span class="op" id="7193525">:=</span>&nbsp;<span class="ident" id="7193528"><a href="/gostd/database/sql/sql_test.go.html#7193148">stmt</a></span><span class="op" id="7193532">.</span><span class="ident" id="7193533"><a href="/gostd/database/sql/sql.go.html#5240343">QueryRow</a></span><span class="op" id="7193541">(</span><span class="string" id="7193542">&#34;sleep&#34;</span><span class="op" id="7193549">,</span>&nbsp;<span class="ident" id="7193551"><a href="/gostd/database/sql/sql_test.go.html#7193312">sleepMillis</a></span><span class="op" id="7193562">)</span><span class="op" id="7193563">.</span><span class="ident" id="7193564"><a href="/gostd/database/sql/sql.go.html#5245114">Scan</a></span><span class="op" id="7193568">(</span><span class="op" id="7193569">&amp;</span><span class="ident" id="7193570"><a href="/gostd/database/sql/sql_test.go.html#7193504">op</a></span><span class="op" id="7193572">)</span><span class="op" id="7193573">;</span>&nbsp;<span class="ident" id="7193575"><a href="/gostd/database/sql/sql_test.go.html#7193521">err</a></span>&nbsp;<span class="op" id="7193579">!=</span>&nbsp;<span class="builtintype" id="7193582">nil</span>&nbsp;<span class="op" id="7193586">&amp;&amp;</span>&nbsp;<span class="ident" id="7193589"><a href="/gostd/database/sql/sql_test.go.html#7193521">err</a></span>&nbsp;<span class="op" id="7193593">!=</span>&nbsp;<span class="ident" id="7193596"><a href="/gostd/database/sql/sql.go.html#5206442">ErrNoRows</a></span>&nbsp;<span class="op" id="7193606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7193613"><a href="/gostd/database/sql/sql_test.go.html#7192329">t</a></span><span class="op" id="7193614">.</span><span class="ident" id="7193615"><a href="/gostd/testing/testing.go.html#5479963">Error</a></span><span class="op" id="7193620">(</span><span class="ident" id="7193621"><a href="/gostd/database/sql/sql_test.go.html#7193521">err</a></span><span class="op" id="7193624">)</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7193630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7193635">}</span><span class="op" id="7193636">(</span><span class="op" id="7193637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7193641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7193645">//&nbsp;Sleep&nbsp;for&nbsp;twice&nbsp;the&nbsp;expected&nbsp;length&nbsp;of&nbsp;time&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7193702">//&nbsp;batch&nbsp;of&nbsp;50&nbsp;queries&nbsp;above&nbsp;to&nbsp;finish&nbsp;before&nbsp;starting</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7193759">//&nbsp;the&nbsp;next&nbsp;round.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7193780"><a href="/gostd/database/sql/sql_test.go.html#7169144">time</a></span><span class="op" id="7193784">.</span><span class="ident" id="7193785"><a href="/gostd/time/sleep.go.html#2713940">Sleep</a></span><span class="op" id="7193790">(</span><span class="num" id="7193791">2</span>&nbsp;<span class="op" id="7193793">*</span>&nbsp;<span class="ident" id="7193795"><a href="/gostd/database/sql/sql_test.go.html#7193312">sleepMillis</a></span>&nbsp;<span class="op" id="7193807">*</span>&nbsp;<span class="ident" id="7193809"><a href="/gostd/database/sql/sql_test.go.html#7169144">time</a></span><span class="op" id="7193813">.</span><span class="ident" id="7193814"><a href="/gostd/time/time.go.html#2734819">Millisecond</a></span><span class="op" id="7193825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7193828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7193831"><a href="/gostd/database/sql/sql_test.go.html#7193355">wg</a></span><span class="op" id="7193833">.</span><span class="ident" id="7193834"><a href="/gostd/sync/waitgroup.go.html#1462162">Wait</a></span><span class="op" id="7193838">(</span><span class="op" id="7193839">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7193843">if</span>&nbsp;<span class="ident" id="7193846">g</span><span class="op" id="7193847">,</span>&nbsp;<span class="ident" id="7193849">w</span>&nbsp;<span class="op" id="7193851">:=</span>&nbsp;<span class="ident" id="7193854"><a href="/gostd/database/sql/sql_test.go.html#7192566">db</a></span><span class="op" id="7193856">.</span><span class="ident" id="7193857"><a href="/gostd/database/sql/sql_test.go.html#7172377">numFreeConns</a></span><span class="op" id="7193869">(</span><span class="op" id="7193870">)</span><span class="op" id="7193871">,</span>&nbsp;<span class="num" id="7193873">10</span><span class="op" id="7193875">;</span>&nbsp;<span class="ident" id="7193877"><a href="/gostd/database/sql/sql_test.go.html#7193846">g</a></span>&nbsp;<span class="op" id="7193879">!=</span>&nbsp;<span class="ident" id="7193882"><a href="/gostd/database/sql/sql_test.go.html#7193849">w</a></span>&nbsp;<span class="op" id="7193884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7193888"><a href="/gostd/database/sql/sql_test.go.html#7192329">t</a></span><span class="op" id="7193889">.</span><span class="ident" id="7193890"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7193896">(</span><span class="string" id="7193897">&#34;free&nbsp;conns&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7193923">,</span>&nbsp;<span class="ident" id="7193925"><a href="/gostd/database/sql/sql_test.go.html#7193846">g</a></span><span class="op" id="7193926">,</span>&nbsp;<span class="ident" id="7193928"><a href="/gostd/database/sql/sql_test.go.html#7193849">w</a></span><span class="op" id="7193929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7193932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7193936">if</span>&nbsp;<span class="ident" id="7193939">n</span>&nbsp;<span class="op" id="7193941">:=</span>&nbsp;<span class="ident" id="7193944"><a href="/gostd/database/sql/sql_test.go.html#7192566">db</a></span><span class="op" id="7193946">.</span><span class="ident" id="7193947"><a href="/gostd/database/sql/sql_test.go.html#7172150">numDepsPollUntil</a></span><span class="op" id="7193963">(</span><span class="num" id="7193964">20</span><span class="op" id="7193966">,</span>&nbsp;<span class="ident" id="7193968"><a href="/gostd/database/sql/sql_test.go.html#7169144">time</a></span><span class="op" id="7193972">.</span><span class="ident" id="7193973"><a href="/gostd/time/time.go.html#2734862">Second</a></span><span class="op" id="7193979">)</span><span class="op" id="7193980">;</span>&nbsp;<span class="ident" id="7193982"><a href="/gostd/database/sql/sql_test.go.html#7193939">n</a></span>&nbsp;<span class="op" id="7193984">&gt;</span>&nbsp;<span class="num" id="7193986">20</span>&nbsp;<span class="op" id="7193989">{</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7193993"><a href="/gostd/database/sql/sql_test.go.html#7192329">t</a></span><span class="op" id="7193994">.</span><span class="ident" id="7193995"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7194001">(</span><span class="string" id="7194002">&#34;number&nbsp;of&nbsp;dependencies&nbsp;=&nbsp;%d;&nbsp;expected&nbsp;&lt;=&nbsp;20&#34;</span><span class="op" id="7194047">,</span>&nbsp;<span class="ident" id="7194049"><a href="/gostd/database/sql/sql_test.go.html#7193939">n</a></span><span class="op" id="7194050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7194054"><a href="/gostd/database/sql/sql_test.go.html#7192566">db</a></span><span class="op" id="7194056">.</span><span class="ident" id="7194057"><a href="/gostd/database/sql/sql_test.go.html#7172476">dumpDeps</a></span><span class="op" id="7194065">(</span><span class="ident" id="7194066"><a href="/gostd/database/sql/sql_test.go.html#7192329">t</a></span><span class="op" id="7194067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7194070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7194074"><a href="/gostd/database/sql/sql_test.go.html#7192623">driver</a></span><span class="op" id="7194080">.</span><span class="ident" id="7194081"><a href="/gostd/database/sql/fakedb_test.go.html#7149401">mu</a></span><span class="op" id="7194083">.</span><span class="ident" id="7194084"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="7194088">(</span><span class="op" id="7194089">)</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7194092">opens</span>&nbsp;<span class="op" id="7194098">:=</span>&nbsp;<span class="ident" id="7194101"><a href="/gostd/database/sql/sql_test.go.html#7192623">driver</a></span><span class="op" id="7194107">.</span><span class="ident" id="7194108"><a href="/gostd/database/sql/fakedb_test.go.html#7149453">openCount</a></span>&nbsp;<span class="op" id="7194118">-</span>&nbsp;<span class="ident" id="7194120"><a href="/gostd/database/sql/sql_test.go.html#7193020">opens0</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7194128">closes</span>&nbsp;<span class="op" id="7194135">:=</span>&nbsp;<span class="ident" id="7194138"><a href="/gostd/database/sql/sql_test.go.html#7192623">driver</a></span><span class="op" id="7194144">.</span><span class="ident" id="7194145"><a href="/gostd/database/sql/fakedb_test.go.html#7149490">closeCount</a></span>&nbsp;<span class="op" id="7194156">-</span>&nbsp;<span class="ident" id="7194158"><a href="/gostd/database/sql/sql_test.go.html#7193048">closes0</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7194167"><a href="/gostd/database/sql/sql_test.go.html#7192623">driver</a></span><span class="op" id="7194173">.</span><span class="ident" id="7194174"><a href="/gostd/database/sql/fakedb_test.go.html#7149401">mu</a></span><span class="op" id="7194176">.</span><span class="ident" id="7194177"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="7194183">(</span><span class="op" id="7194184">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7194188">if</span>&nbsp;<span class="ident" id="7194191"><a href="/gostd/database/sql/sql_test.go.html#7194092">opens</a></span>&nbsp;<span class="op" id="7194197">&gt;</span>&nbsp;<span class="num" id="7194199">10</span>&nbsp;<span class="op" id="7194202">{</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7194206"><a href="/gostd/database/sql/sql_test.go.html#7192329">t</a></span><span class="op" id="7194207">.</span><span class="ident" id="7194208"><a href="/gostd/testing/testing.go.html#5479816">Logf</a></span><span class="op" id="7194212">(</span><span class="string" id="7194213">&#34;open&nbsp;calls&nbsp;=&nbsp;%d&#34;</span><span class="op" id="7194230">,</span>&nbsp;<span class="ident" id="7194232"><a href="/gostd/database/sql/sql_test.go.html#7194092">opens</a></span><span class="op" id="7194237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7194241"><a href="/gostd/database/sql/sql_test.go.html#7192329">t</a></span><span class="op" id="7194242">.</span><span class="ident" id="7194243"><a href="/gostd/testing/testing.go.html#5479816">Logf</a></span><span class="op" id="7194247">(</span><span class="string" id="7194248">&#34;close&nbsp;calls&nbsp;=&nbsp;%d&#34;</span><span class="op" id="7194266">,</span>&nbsp;<span class="ident" id="7194268"><a href="/gostd/database/sql/sql_test.go.html#7194128">closes</a></span><span class="op" id="7194274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7194278"><a href="/gostd/database/sql/sql_test.go.html#7192329">t</a></span><span class="op" id="7194279">.</span><span class="ident" id="7194280"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7194286">(</span><span class="string" id="7194287">&#34;db&nbsp;connections&nbsp;opened&nbsp;=&nbsp;%d;&nbsp;want&nbsp;&lt;=&nbsp;10&#34;</span><span class="op" id="7194327">,</span>&nbsp;<span class="ident" id="7194329"><a href="/gostd/database/sql/sql_test.go.html#7194092">opens</a></span><span class="op" id="7194334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7194338"><a href="/gostd/database/sql/sql_test.go.html#7192566">db</a></span><span class="op" id="7194340">.</span><span class="ident" id="7194341"><a href="/gostd/database/sql/sql_test.go.html#7172476">dumpDeps</a></span><span class="op" id="7194349">(</span><span class="ident" id="7194350"><a href="/gostd/database/sql/sql_test.go.html#7192329">t</a></span><span class="op" id="7194351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7194354">}</span><br>
<span class="lineno">1025</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7194358">if</span>&nbsp;<span class="ident" id="7194361">err</span>&nbsp;<span class="op" id="7194365">:=</span>&nbsp;<span class="ident" id="7194368"><a href="/gostd/database/sql/sql_test.go.html#7193148">stmt</a></span><span class="op" id="7194372">.</span><span class="ident" id="7194373"><a href="/gostd/database/sql/sql.go.html#5240529">Close</a></span><span class="op" id="7194378">(</span><span class="op" id="7194379">)</span><span class="op" id="7194380">;</span>&nbsp;<span class="ident" id="7194382"><a href="/gostd/database/sql/sql_test.go.html#7194361">err</a></span>&nbsp;<span class="op" id="7194386">!=</span>&nbsp;<span class="builtintype" id="7194389">nil</span>&nbsp;<span class="op" id="7194393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7194397"><a href="/gostd/database/sql/sql_test.go.html#7192329">t</a></span><span class="op" id="7194398">.</span><span class="ident" id="7194399"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="7194404">(</span><span class="ident" id="7194405"><a href="/gostd/database/sql/sql_test.go.html#7194361">err</a></span><span class="op" id="7194408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7194411">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7194415">if</span>&nbsp;<span class="ident" id="7194418">g</span><span class="op" id="7194419">,</span>&nbsp;<span class="ident" id="7194421">w</span>&nbsp;<span class="op" id="7194423">:=</span>&nbsp;<span class="ident" id="7194426"><a href="/gostd/database/sql/sql_test.go.html#7192566">db</a></span><span class="op" id="7194428">.</span><span class="ident" id="7194429"><a href="/gostd/database/sql/sql_test.go.html#7172377">numFreeConns</a></span><span class="op" id="7194441">(</span><span class="op" id="7194442">)</span><span class="op" id="7194443">,</span>&nbsp;<span class="num" id="7194445">10</span><span class="op" id="7194447">;</span>&nbsp;<span class="ident" id="7194449"><a href="/gostd/database/sql/sql_test.go.html#7194418">g</a></span>&nbsp;<span class="op" id="7194451">!=</span>&nbsp;<span class="ident" id="7194454"><a href="/gostd/database/sql/sql_test.go.html#7194421">w</a></span>&nbsp;<span class="op" id="7194456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7194460"><a href="/gostd/database/sql/sql_test.go.html#7192329">t</a></span><span class="op" id="7194461">.</span><span class="ident" id="7194462"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7194468">(</span><span class="string" id="7194469">&#34;free&nbsp;conns&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7194495">,</span>&nbsp;<span class="ident" id="7194497"><a href="/gostd/database/sql/sql_test.go.html#7194418">g</a></span><span class="op" id="7194498">,</span>&nbsp;<span class="ident" id="7194500"><a href="/gostd/database/sql/sql_test.go.html#7194421">w</a></span><span class="op" id="7194501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7194504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7194508">if</span>&nbsp;<span class="ident" id="7194511">n</span>&nbsp;<span class="op" id="7194513">:=</span>&nbsp;<span class="ident" id="7194516"><a href="/gostd/database/sql/sql_test.go.html#7192566">db</a></span><span class="op" id="7194518">.</span><span class="ident" id="7194519"><a href="/gostd/database/sql/sql_test.go.html#7172150">numDepsPollUntil</a></span><span class="op" id="7194535">(</span><span class="num" id="7194536">10</span><span class="op" id="7194538">,</span>&nbsp;<span class="ident" id="7194540"><a href="/gostd/database/sql/sql_test.go.html#7169144">time</a></span><span class="op" id="7194544">.</span><span class="ident" id="7194545"><a href="/gostd/time/time.go.html#2734862">Second</a></span><span class="op" id="7194551">)</span><span class="op" id="7194552">;</span>&nbsp;<span class="ident" id="7194554"><a href="/gostd/database/sql/sql_test.go.html#7194511">n</a></span>&nbsp;<span class="op" id="7194556">&gt;</span>&nbsp;<span class="num" id="7194558">10</span>&nbsp;<span class="op" id="7194561">{</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7194565"><a href="/gostd/database/sql/sql_test.go.html#7192329">t</a></span><span class="op" id="7194566">.</span><span class="ident" id="7194567"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7194573">(</span><span class="string" id="7194574">&#34;number&nbsp;of&nbsp;dependencies&nbsp;=&nbsp;%d;&nbsp;expected&nbsp;&lt;=&nbsp;10&#34;</span><span class="op" id="7194619">,</span>&nbsp;<span class="ident" id="7194621"><a href="/gostd/database/sql/sql_test.go.html#7194511">n</a></span><span class="op" id="7194622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7194626"><a href="/gostd/database/sql/sql_test.go.html#7192566">db</a></span><span class="op" id="7194628">.</span><span class="ident" id="7194629"><a href="/gostd/database/sql/sql_test.go.html#7172476">dumpDeps</a></span><span class="op" id="7194637">(</span><span class="ident" id="7194638"><a href="/gostd/database/sql/sql_test.go.html#7192329">t</a></span><span class="op" id="7194639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7194642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7194646"><a href="/gostd/database/sql/sql_test.go.html#7192566">db</a></span><span class="op" id="7194648">.</span><span class="ident" id="7194649"><a href="/gostd/database/sql/sql.go.html#5216759">SetMaxOpenConns</a></span><span class="op" id="7194664">(</span><span class="num" id="7194665">5</span><span class="op" id="7194666">)</span><br>
<span class="lineno">1040</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7194670">if</span>&nbsp;<span class="ident" id="7194673">g</span><span class="op" id="7194674">,</span>&nbsp;<span class="ident" id="7194676">w</span>&nbsp;<span class="op" id="7194678">:=</span>&nbsp;<span class="ident" id="7194681"><a href="/gostd/database/sql/sql_test.go.html#7192566">db</a></span><span class="op" id="7194683">.</span><span class="ident" id="7194684"><a href="/gostd/database/sql/sql_test.go.html#7172377">numFreeConns</a></span><span class="op" id="7194696">(</span><span class="op" id="7194697">)</span><span class="op" id="7194698">,</span>&nbsp;<span class="num" id="7194700">5</span><span class="op" id="7194701">;</span>&nbsp;<span class="ident" id="7194703"><a href="/gostd/database/sql/sql_test.go.html#7194673">g</a></span>&nbsp;<span class="op" id="7194705">!=</span>&nbsp;<span class="ident" id="7194708"><a href="/gostd/database/sql/sql_test.go.html#7194676">w</a></span>&nbsp;<span class="op" id="7194710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7194714"><a href="/gostd/database/sql/sql_test.go.html#7192329">t</a></span><span class="op" id="7194715">.</span><span class="ident" id="7194716"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7194722">(</span><span class="string" id="7194723">&#34;free&nbsp;conns&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7194749">,</span>&nbsp;<span class="ident" id="7194751"><a href="/gostd/database/sql/sql_test.go.html#7194673">g</a></span><span class="op" id="7194752">,</span>&nbsp;<span class="ident" id="7194754"><a href="/gostd/database/sql/sql_test.go.html#7194676">w</a></span><span class="op" id="7194755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7194758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7194762">if</span>&nbsp;<span class="ident" id="7194765">n</span>&nbsp;<span class="op" id="7194767">:=</span>&nbsp;<span class="ident" id="7194770"><a href="/gostd/database/sql/sql_test.go.html#7192566">db</a></span><span class="op" id="7194772">.</span><span class="ident" id="7194773"><a href="/gostd/database/sql/sql_test.go.html#7172150">numDepsPollUntil</a></span><span class="op" id="7194789">(</span><span class="num" id="7194790">5</span><span class="op" id="7194791">,</span>&nbsp;<span class="ident" id="7194793"><a href="/gostd/database/sql/sql_test.go.html#7169144">time</a></span><span class="op" id="7194797">.</span><span class="ident" id="7194798"><a href="/gostd/time/time.go.html#2734862">Second</a></span><span class="op" id="7194804">)</span><span class="op" id="7194805">;</span>&nbsp;<span class="ident" id="7194807"><a href="/gostd/database/sql/sql_test.go.html#7194765">n</a></span>&nbsp;<span class="op" id="7194809">&gt;</span>&nbsp;<span class="num" id="7194811">5</span>&nbsp;<span class="op" id="7194813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7194817"><a href="/gostd/database/sql/sql_test.go.html#7192329">t</a></span><span class="op" id="7194818">.</span><span class="ident" id="7194819"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7194825">(</span><span class="string" id="7194826">&#34;number&nbsp;of&nbsp;dependencies&nbsp;=&nbsp;%d;&nbsp;expected&nbsp;0&#34;</span><span class="op" id="7194867">,</span>&nbsp;<span class="ident" id="7194869"><a href="/gostd/database/sql/sql_test.go.html#7194765">n</a></span><span class="op" id="7194870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7194874"><a href="/gostd/database/sql/sql_test.go.html#7192566">db</a></span><span class="op" id="7194876">.</span><span class="ident" id="7194877"><a href="/gostd/database/sql/sql_test.go.html#7172476">dumpDeps</a></span><span class="op" id="7194885">(</span><span class="ident" id="7194886"><a href="/gostd/database/sql/sql_test.go.html#7192329">t</a></span><span class="op" id="7194887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7194890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7194894"><a href="/gostd/database/sql/sql_test.go.html#7192566">db</a></span><span class="op" id="7194896">.</span><span class="ident" id="7194897"><a href="/gostd/database/sql/sql.go.html#5216759">SetMaxOpenConns</a></span><span class="op" id="7194912">(</span><span class="num" id="7194913">0</span><span class="op" id="7194914">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7194918">if</span>&nbsp;<span class="ident" id="7194921">g</span><span class="op" id="7194922">,</span>&nbsp;<span class="ident" id="7194924">w</span>&nbsp;<span class="op" id="7194926">:=</span>&nbsp;<span class="ident" id="7194929"><a href="/gostd/database/sql/sql_test.go.html#7192566">db</a></span><span class="op" id="7194931">.</span><span class="ident" id="7194932"><a href="/gostd/database/sql/sql_test.go.html#7172377">numFreeConns</a></span><span class="op" id="7194944">(</span><span class="op" id="7194945">)</span><span class="op" id="7194946">,</span>&nbsp;<span class="num" id="7194948">5</span><span class="op" id="7194949">;</span>&nbsp;<span class="ident" id="7194951"><a href="/gostd/database/sql/sql_test.go.html#7194921">g</a></span>&nbsp;<span class="op" id="7194953">!=</span>&nbsp;<span class="ident" id="7194956"><a href="/gostd/database/sql/sql_test.go.html#7194924">w</a></span>&nbsp;<span class="op" id="7194958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7194962"><a href="/gostd/database/sql/sql_test.go.html#7192329">t</a></span><span class="op" id="7194963">.</span><span class="ident" id="7194964"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7194970">(</span><span class="string" id="7194971">&#34;free&nbsp;conns&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7194997">,</span>&nbsp;<span class="ident" id="7194999"><a href="/gostd/database/sql/sql_test.go.html#7194921">g</a></span><span class="op" id="7195000">,</span>&nbsp;<span class="ident" id="7195002"><a href="/gostd/database/sql/sql_test.go.html#7194924">w</a></span><span class="op" id="7195003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7195006">}</span><br>
<span class="lineno">1055</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7195010">if</span>&nbsp;<span class="ident" id="7195013">n</span>&nbsp;<span class="op" id="7195015">:=</span>&nbsp;<span class="ident" id="7195018"><a href="/gostd/database/sql/sql_test.go.html#7192566">db</a></span><span class="op" id="7195020">.</span><span class="ident" id="7195021"><a href="/gostd/database/sql/sql_test.go.html#7172150">numDepsPollUntil</a></span><span class="op" id="7195037">(</span><span class="num" id="7195038">5</span><span class="op" id="7195039">,</span>&nbsp;<span class="ident" id="7195041"><a href="/gostd/database/sql/sql_test.go.html#7169144">time</a></span><span class="op" id="7195045">.</span><span class="ident" id="7195046"><a href="/gostd/time/time.go.html#2734862">Second</a></span><span class="op" id="7195052">)</span><span class="op" id="7195053">;</span>&nbsp;<span class="ident" id="7195055"><a href="/gostd/database/sql/sql_test.go.html#7195013">n</a></span>&nbsp;<span class="op" id="7195057">&gt;</span>&nbsp;<span class="num" id="7195059">5</span>&nbsp;<span class="op" id="7195061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7195065"><a href="/gostd/database/sql/sql_test.go.html#7192329">t</a></span><span class="op" id="7195066">.</span><span class="ident" id="7195067"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7195073">(</span><span class="string" id="7195074">&#34;number&nbsp;of&nbsp;dependencies&nbsp;=&nbsp;%d;&nbsp;expected&nbsp;0&#34;</span><span class="op" id="7195115">,</span>&nbsp;<span class="ident" id="7195117"><a href="/gostd/database/sql/sql_test.go.html#7195013">n</a></span><span class="op" id="7195118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7195122"><a href="/gostd/database/sql/sql_test.go.html#7192566">db</a></span><span class="op" id="7195124">.</span><span class="ident" id="7195125"><a href="/gostd/database/sql/sql_test.go.html#7172476">dumpDeps</a></span><span class="op" id="7195133">(</span><span class="ident" id="7195134"><a href="/gostd/database/sql/sql_test.go.html#7192329">t</a></span><span class="op" id="7195135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7195138">}</span><br>
<span class="lineno">1060</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7195142"><a href="/gostd/database/sql/sql_test.go.html#7192566">db</a></span><span class="op" id="7195144">.</span><span class="ident" id="7195145"><a href="/gostd/database/sql/sql.go.html#5215871">SetMaxIdleConns</a></span><span class="op" id="7195160">(</span><span class="num" id="7195161">0</span><span class="op" id="7195162">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7195166">if</span>&nbsp;<span class="ident" id="7195169">g</span><span class="op" id="7195170">,</span>&nbsp;<span class="ident" id="7195172">w</span>&nbsp;<span class="op" id="7195174">:=</span>&nbsp;<span class="ident" id="7195177"><a href="/gostd/database/sql/sql_test.go.html#7192566">db</a></span><span class="op" id="7195179">.</span><span class="ident" id="7195180"><a href="/gostd/database/sql/sql_test.go.html#7172377">numFreeConns</a></span><span class="op" id="7195192">(</span><span class="op" id="7195193">)</span><span class="op" id="7195194">,</span>&nbsp;<span class="num" id="7195196">0</span><span class="op" id="7195197">;</span>&nbsp;<span class="ident" id="7195199"><a href="/gostd/database/sql/sql_test.go.html#7195169">g</a></span>&nbsp;<span class="op" id="7195201">!=</span>&nbsp;<span class="ident" id="7195204"><a href="/gostd/database/sql/sql_test.go.html#7195172">w</a></span>&nbsp;<span class="op" id="7195206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7195210"><a href="/gostd/database/sql/sql_test.go.html#7192329">t</a></span><span class="op" id="7195211">.</span><span class="ident" id="7195212"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7195218">(</span><span class="string" id="7195219">&#34;free&nbsp;conns&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7195245">,</span>&nbsp;<span class="ident" id="7195247"><a href="/gostd/database/sql/sql_test.go.html#7195169">g</a></span><span class="op" id="7195248">,</span>&nbsp;<span class="ident" id="7195250"><a href="/gostd/database/sql/sql_test.go.html#7195172">w</a></span><span class="op" id="7195251">)</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7195254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7195258">if</span>&nbsp;<span class="ident" id="7195261">n</span>&nbsp;<span class="op" id="7195263">:=</span>&nbsp;<span class="ident" id="7195266"><a href="/gostd/database/sql/sql_test.go.html#7192566">db</a></span><span class="op" id="7195268">.</span><span class="ident" id="7195269"><a href="/gostd/database/sql/sql_test.go.html#7172150">numDepsPollUntil</a></span><span class="op" id="7195285">(</span><span class="num" id="7195286">0</span><span class="op" id="7195287">,</span>&nbsp;<span class="ident" id="7195289"><a href="/gostd/database/sql/sql_test.go.html#7169144">time</a></span><span class="op" id="7195293">.</span><span class="ident" id="7195294"><a href="/gostd/time/time.go.html#2734862">Second</a></span><span class="op" id="7195300">)</span><span class="op" id="7195301">;</span>&nbsp;<span class="ident" id="7195303"><a href="/gostd/database/sql/sql_test.go.html#7195261">n</a></span>&nbsp;<span class="op" id="7195305">&gt;</span>&nbsp;<span class="num" id="7195307">0</span>&nbsp;<span class="op" id="7195309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7195313"><a href="/gostd/database/sql/sql_test.go.html#7192329">t</a></span><span class="op" id="7195314">.</span><span class="ident" id="7195315"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7195321">(</span><span class="string" id="7195322">&#34;number&nbsp;of&nbsp;dependencies&nbsp;=&nbsp;%d;&nbsp;expected&nbsp;0&#34;</span><span class="op" id="7195363">,</span>&nbsp;<span class="ident" id="7195365"><a href="/gostd/database/sql/sql_test.go.html#7195261">n</a></span><span class="op" id="7195366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7195370"><a href="/gostd/database/sql/sql_test.go.html#7192566">db</a></span><span class="op" id="7195372">.</span><span class="ident" id="7195373"><a href="/gostd/database/sql/sql_test.go.html#7172476">dumpDeps</a></span><span class="op" id="7195381">(</span><span class="ident" id="7195382"><a href="/gostd/database/sql/sql_test.go.html#7192329">t</a></span><span class="op" id="7195383">)</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7195386">}</span><br>
<span class="lineno"></span><span class="op" id="7195388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7195391">func</span>&nbsp;<span class="ident" id="7195396">TestSingleOpenConn</span><span class="op" id="7195414">(</span><span class="ident" id="7195415">t</span>&nbsp;<span class="op" id="7195417">*</span><span class="ident" id="7195418"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7195425">.</span><span class="ident" id="7195426"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7195427">)</span>&nbsp;<span class="op" id="7195429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7195432">db</span>&nbsp;<span class="op" id="7195435">:=</span>&nbsp;<span class="ident" id="7195438"><a href="/gostd/database/sql/sql_test.go.html#7169849">newTestDB</a></span><span class="op" id="7195447">(</span><span class="ident" id="7195448"><a href="/gostd/database/sql/sql_test.go.html#7195415">t</a></span><span class="op" id="7195449">,</span>&nbsp;<span class="string" id="7195451">&#34;people&#34;</span><span class="op" id="7195459">)</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7195462">defer</span>&nbsp;<span class="ident" id="7195468"><a href="/gostd/database/sql/sql_test.go.html#7170773">closeDB</a></span><span class="op" id="7195475">(</span><span class="ident" id="7195476"><a href="/gostd/database/sql/sql_test.go.html#7195415">t</a></span><span class="op" id="7195477">,</span>&nbsp;<span class="ident" id="7195479"><a href="/gostd/database/sql/sql_test.go.html#7195432">db</a></span><span class="op" id="7195481">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7195485"><a href="/gostd/database/sql/sql_test.go.html#7195432">db</a></span><span class="op" id="7195487">.</span><span class="ident" id="7195488"><a href="/gostd/database/sql/sql.go.html#5216759">SetMaxOpenConns</a></span><span class="op" id="7195503">(</span><span class="num" id="7195504">1</span><span class="op" id="7195505">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7195509">rows</span><span class="op" id="7195513">,</span>&nbsp;<span class="ident" id="7195515">err</span>&nbsp;<span class="op" id="7195519">:=</span>&nbsp;<span class="ident" id="7195522"><a href="/gostd/database/sql/sql_test.go.html#7195432">db</a></span><span class="op" id="7195524">.</span><span class="ident" id="7195525"><a href="/gostd/database/sql/sql.go.html#5225993">Query</a></span><span class="op" id="7195530">(</span><span class="string" id="7195531">&#34;SELECT|people|name|&#34;</span><span class="op" id="7195552">)</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7195555">if</span>&nbsp;<span class="ident" id="7195558"><a href="/gostd/database/sql/sql_test.go.html#7195515">err</a></span>&nbsp;<span class="op" id="7195562">!=</span>&nbsp;<span class="builtintype" id="7195565">nil</span>&nbsp;<span class="op" id="7195569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7195573"><a href="/gostd/database/sql/sql_test.go.html#7195415">t</a></span><span class="op" id="7195574">.</span><span class="ident" id="7195575"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="7195580">(</span><span class="ident" id="7195581"><a href="/gostd/database/sql/sql_test.go.html#7195515">err</a></span><span class="op" id="7195584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7195587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7195590">if</span>&nbsp;<span class="ident" id="7195593"><a href="/gostd/database/sql/sql_test.go.html#7195515">err</a></span>&nbsp;<span class="op" id="7195597">=</span>&nbsp;<span class="ident" id="7195599"><a href="/gostd/database/sql/sql_test.go.html#7195509">rows</a></span><span class="op" id="7195603">.</span><span class="ident" id="7195604"><a href="/gostd/database/sql/sql.go.html#5244447">Close</a></span><span class="op" id="7195609">(</span><span class="op" id="7195610">)</span><span class="op" id="7195611">;</span>&nbsp;<span class="ident" id="7195613"><a href="/gostd/database/sql/sql_test.go.html#7195515">err</a></span>&nbsp;<span class="op" id="7195617">!=</span>&nbsp;<span class="builtintype" id="7195620">nil</span>&nbsp;<span class="op" id="7195624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7195628"><a href="/gostd/database/sql/sql_test.go.html#7195415">t</a></span><span class="op" id="7195629">.</span><span class="ident" id="7195630"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="7195635">(</span><span class="ident" id="7195636"><a href="/gostd/database/sql/sql_test.go.html#7195515">err</a></span><span class="op" id="7195639">)</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7195642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7195645">//&nbsp;shouldn&#39;t&nbsp;deadlock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7195668"><a href="/gostd/database/sql/sql_test.go.html#7195509">rows</a></span><span class="op" id="7195672">,</span>&nbsp;<span class="ident" id="7195674"><a href="/gostd/database/sql/sql_test.go.html#7195515">err</a></span>&nbsp;<span class="op" id="7195678">=</span>&nbsp;<span class="ident" id="7195680"><a href="/gostd/database/sql/sql_test.go.html#7195432">db</a></span><span class="op" id="7195682">.</span><span class="ident" id="7195683"><a href="/gostd/database/sql/sql.go.html#5225993">Query</a></span><span class="op" id="7195688">(</span><span class="string" id="7195689">&#34;SELECT|people|name|&#34;</span><span class="op" id="7195710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7195713">if</span>&nbsp;<span class="ident" id="7195716"><a href="/gostd/database/sql/sql_test.go.html#7195515">err</a></span>&nbsp;<span class="op" id="7195720">!=</span>&nbsp;<span class="builtintype" id="7195723">nil</span>&nbsp;<span class="op" id="7195727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7195731"><a href="/gostd/database/sql/sql_test.go.html#7195415">t</a></span><span class="op" id="7195732">.</span><span class="ident" id="7195733"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="7195738">(</span><span class="ident" id="7195739"><a href="/gostd/database/sql/sql_test.go.html#7195515">err</a></span><span class="op" id="7195742">)</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7195745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7195748">if</span>&nbsp;<span class="ident" id="7195751"><a href="/gostd/database/sql/sql_test.go.html#7195515">err</a></span>&nbsp;<span class="op" id="7195755">=</span>&nbsp;<span class="ident" id="7195757"><a href="/gostd/database/sql/sql_test.go.html#7195509">rows</a></span><span class="op" id="7195761">.</span><span class="ident" id="7195762"><a href="/gostd/database/sql/sql.go.html#5244447">Close</a></span><span class="op" id="7195767">(</span><span class="op" id="7195768">)</span><span class="op" id="7195769">;</span>&nbsp;<span class="ident" id="7195771"><a href="/gostd/database/sql/sql_test.go.html#7195515">err</a></span>&nbsp;<span class="op" id="7195775">!=</span>&nbsp;<span class="builtintype" id="7195778">nil</span>&nbsp;<span class="op" id="7195782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7195786"><a href="/gostd/database/sql/sql_test.go.html#7195415">t</a></span><span class="op" id="7195787">.</span><span class="ident" id="7195788"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="7195793">(</span><span class="ident" id="7195794"><a href="/gostd/database/sql/sql_test.go.html#7195515">err</a></span><span class="op" id="7195797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7195800">}</span><br>
<span class="lineno"></span><span class="op" id="7195802">}</span><br>
<span class="lineno">1095</span><br>
<span class="lineno"></span><span class="comment" id="7195805">//&nbsp;golang.org/issue/5323</span><br>
<span class="lineno"></span><span class="keyword" id="7195830">func</span>&nbsp;<span class="ident" id="7195835">TestStmtCloseDeps</span><span class="op" id="7195852">(</span><span class="ident" id="7195853">t</span>&nbsp;<span class="op" id="7195855">*</span><span class="ident" id="7195856"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7195863">.</span><span class="ident" id="7195864"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7195865">)</span>&nbsp;<span class="op" id="7195867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7195870">if</span>&nbsp;<span class="ident" id="7195873"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7195880">.</span><span class="ident" id="7195881"><a href="/gostd/testing/testing.go.html#5475359">Short</a></span><span class="op" id="7195886">(</span><span class="op" id="7195887">)</span>&nbsp;<span class="op" id="7195889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7195893"><a href="/gostd/database/sql/sql_test.go.html#7195853">t</a></span><span class="op" id="7195894">.</span><span class="ident" id="7195895"><a href="/gostd/testing/testing.go.html#5480575">Skip</a></span><span class="op" id="7195899">(</span><span class="string" id="7195900">&#34;skipping&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="7195924">)</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7195927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7195930">defer</span>&nbsp;<span class="ident" id="7195936"><a href="/gostd/database/sql/fakedb_test.go.html#7154130">setHookpostCloseConn</a></span><span class="op" id="7195956">(</span><span class="builtintype" id="7195957">nil</span><span class="op" id="7195960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7195963"><a href="/gostd/database/sql/fakedb_test.go.html#7154130">setHookpostCloseConn</a></span><span class="op" id="7195983">(</span><span class="keyword" id="7195984">func</span><span class="op" id="7195988">(</span><span class="ident" id="7195989">_</span>&nbsp;<span class="op" id="7195991">*</span><span class="ident" id="7195992"><a href="/gostd/database/sql/fakedb_test.go.html#7150186">fakeConn</a></span><span class="op" id="7196000">,</span>&nbsp;<span class="ident" id="7196002">err</span>&nbsp;<span class="builtintype" id="7196006">error</span><span class="op" id="7196011">)</span>&nbsp;<span class="op" id="7196013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7196017">if</span>&nbsp;<span class="ident" id="7196020"><a href="/gostd/database/sql/sql_test.go.html#7196002">err</a></span>&nbsp;<span class="op" id="7196024">!=</span>&nbsp;<span class="builtintype" id="7196027">nil</span>&nbsp;<span class="op" id="7196031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7196036"><a href="/gostd/database/sql/sql_test.go.html#7195853">t</a></span><span class="op" id="7196037">.</span><span class="ident" id="7196038"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7196044">(</span><span class="string" id="7196045">&#34;Error&nbsp;closing&nbsp;fakeConn:&nbsp;%v&#34;</span><span class="op" id="7196073">,</span>&nbsp;<span class="ident" id="7196075"><a href="/gostd/database/sql/sql_test.go.html#7196002">err</a></span><span class="op" id="7196078">)</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7196082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7196085">}</span><span class="op" id="7196086">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7196090">db</span>&nbsp;<span class="op" id="7196093">:=</span>&nbsp;<span class="ident" id="7196096"><a href="/gostd/database/sql/sql_test.go.html#7169849">newTestDB</a></span><span class="op" id="7196105">(</span><span class="ident" id="7196106"><a href="/gostd/database/sql/sql_test.go.html#7195853">t</a></span><span class="op" id="7196107">,</span>&nbsp;<span class="string" id="7196109">&#34;magicquery&#34;</span><span class="op" id="7196121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7196124">defer</span>&nbsp;<span class="ident" id="7196130"><a href="/gostd/database/sql/sql_test.go.html#7170773">closeDB</a></span><span class="op" id="7196137">(</span><span class="ident" id="7196138"><a href="/gostd/database/sql/sql_test.go.html#7195853">t</a></span><span class="op" id="7196139">,</span>&nbsp;<span class="ident" id="7196141"><a href="/gostd/database/sql/sql_test.go.html#7196090">db</a></span><span class="op" id="7196143">)</span><br>
<span class="lineno">1110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7196147">driver</span>&nbsp;<span class="op" id="7196154">:=</span>&nbsp;<span class="ident" id="7196157"><a href="/gostd/database/sql/sql_test.go.html#7196090">db</a></span><span class="op" id="7196159">.</span><span class="ident" id="7196160"><a href="/gostd/database/sql/sql.go.html#5207171">driver</a></span><span class="op" id="7196166">.</span><span class="op" id="7196167">(</span><span class="op" id="7196168">*</span><span class="ident" id="7196169"><a href="/gostd/database/sql/fakedb_test.go.html#7149380">fakeDriver</a></span><span class="op" id="7196179">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7196183"><a href="/gostd/database/sql/sql_test.go.html#7196147">driver</a></span><span class="op" id="7196189">.</span><span class="ident" id="7196190"><a href="/gostd/database/sql/fakedb_test.go.html#7149401">mu</a></span><span class="op" id="7196192">.</span><span class="ident" id="7196193"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="7196197">(</span><span class="op" id="7196198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7196201">opens0</span>&nbsp;<span class="op" id="7196208">:=</span>&nbsp;<span class="ident" id="7196211"><a href="/gostd/database/sql/sql_test.go.html#7196147">driver</a></span><span class="op" id="7196217">.</span><span class="ident" id="7196218"><a href="/gostd/database/sql/fakedb_test.go.html#7149453">openCount</a></span><br>
<span class="lineno">1115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7196229">closes0</span>&nbsp;<span class="op" id="7196237">:=</span>&nbsp;<span class="ident" id="7196240"><a href="/gostd/database/sql/sql_test.go.html#7196147">driver</a></span><span class="op" id="7196246">.</span><span class="ident" id="7196247"><a href="/gostd/database/sql/fakedb_test.go.html#7149490">closeCount</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7196259"><a href="/gostd/database/sql/sql_test.go.html#7196147">driver</a></span><span class="op" id="7196265">.</span><span class="ident" id="7196266"><a href="/gostd/database/sql/fakedb_test.go.html#7149401">mu</a></span><span class="op" id="7196268">.</span><span class="ident" id="7196269"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="7196275">(</span><span class="op" id="7196276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7196279">openDelta0</span>&nbsp;<span class="op" id="7196290">:=</span>&nbsp;<span class="ident" id="7196293"><a href="/gostd/database/sql/sql_test.go.html#7196201">opens0</a></span>&nbsp;<span class="op" id="7196300">-</span>&nbsp;<span class="ident" id="7196302"><a href="/gostd/database/sql/sql_test.go.html#7196229">closes0</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7196312">stmt</span><span class="op" id="7196316">,</span>&nbsp;<span class="ident" id="7196318">err</span>&nbsp;<span class="op" id="7196322">:=</span>&nbsp;<span class="ident" id="7196325"><a href="/gostd/database/sql/sql_test.go.html#7196090">db</a></span><span class="op" id="7196327">.</span><span class="ident" id="7196328"><a href="/gostd/database/sql/sql.go.html#5223860">Prepare</a></span><span class="op" id="7196335">(</span><span class="string" id="7196336">&#34;SELECT|magicquery|op|op=?,millis=?&#34;</span><span class="op" id="7196372">)</span><br>
<span class="lineno">1120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7196375">if</span>&nbsp;<span class="ident" id="7196378"><a href="/gostd/database/sql/sql_test.go.html#7196318">err</a></span>&nbsp;<span class="op" id="7196382">!=</span>&nbsp;<span class="builtintype" id="7196385">nil</span>&nbsp;<span class="op" id="7196389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7196393"><a href="/gostd/database/sql/sql_test.go.html#7195853">t</a></span><span class="op" id="7196394">.</span><span class="ident" id="7196395"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="7196400">(</span><span class="ident" id="7196401"><a href="/gostd/database/sql/sql_test.go.html#7196318">err</a></span><span class="op" id="7196404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7196407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7196411">//&nbsp;Start&nbsp;50&nbsp;parallel&nbsp;slow&nbsp;queries.</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7196447">const</span>&nbsp;<span class="op" id="7196453">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7196457">nquery</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7196469">=</span>&nbsp;<span class="num" id="7196471">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7196476">sleepMillis</span>&nbsp;<span class="op" id="7196488">=</span>&nbsp;<span class="num" id="7196490">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7196495">nbatch</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7196507">=</span>&nbsp;<span class="num" id="7196509">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7196512">)</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7196515">var</span>&nbsp;<span class="ident" id="7196519">wg</span>&nbsp;<span class="ident" id="7196522"><a href="/gostd/database/sql/sql_test.go.html#7169125">sync</a></span><span class="op" id="7196526">.</span><span class="ident" id="7196527"><a href="/gostd/sync/waitgroup.go.html#1459933">WaitGroup</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7196538">for</span>&nbsp;<span class="ident" id="7196542">batch</span>&nbsp;<span class="op" id="7196548">:=</span>&nbsp;<span class="num" id="7196551">0</span><span class="op" id="7196552">;</span>&nbsp;<span class="ident" id="7196554"><a href="/gostd/database/sql/sql_test.go.html#7196542">batch</a></span>&nbsp;<span class="op" id="7196560">&lt;</span>&nbsp;<span class="ident" id="7196562"><a href="/gostd/database/sql/sql_test.go.html#7196495">nbatch</a></span><span class="op" id="7196568">;</span>&nbsp;<span class="ident" id="7196570"><a href="/gostd/database/sql/sql_test.go.html#7196542">batch</a></span><span class="op" id="7196575">++</span>&nbsp;<span class="op" id="7196578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7196582">for</span>&nbsp;<span class="ident" id="7196586">i</span>&nbsp;<span class="op" id="7196588">:=</span>&nbsp;<span class="num" id="7196591">0</span><span class="op" id="7196592">;</span>&nbsp;<span class="ident" id="7196594"><a href="/gostd/database/sql/sql_test.go.html#7196586">i</a></span>&nbsp;<span class="op" id="7196596">&lt;</span>&nbsp;<span class="ident" id="7196598"><a href="/gostd/database/sql/sql_test.go.html#7196457">nquery</a></span><span class="op" id="7196604">;</span>&nbsp;<span class="ident" id="7196606"><a href="/gostd/database/sql/sql_test.go.html#7196586">i</a></span><span class="op" id="7196607">++</span>&nbsp;<span class="op" id="7196610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7196615"><a href="/gostd/database/sql/sql_test.go.html#7196519">wg</a></span><span class="op" id="7196617">.</span><span class="ident" id="7196618"><a href="/gostd/sync/waitgroup.go.html#1461154">Add</a></span><span class="op" id="7196621">(</span><span class="num" id="7196622">1</span><span class="op" id="7196623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7196628">go</span>&nbsp;<span class="keyword" id="7196631">func</span><span class="op" id="7196635">(</span><span class="op" id="7196636">)</span>&nbsp;<span class="op" id="7196638">{</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7196644">defer</span>&nbsp;<span class="ident" id="7196650"><a href="/gostd/database/sql/sql_test.go.html#7196519">wg</a></span><span class="op" id="7196652">.</span><span class="ident" id="7196653"><a href="/gostd/sync/waitgroup.go.html#1462065">Done</a></span><span class="op" id="7196657">(</span><span class="op" id="7196658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7196664">var</span>&nbsp;<span class="ident" id="7196668">op</span>&nbsp;<span class="builtintype" id="7196671">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7196682">if</span>&nbsp;<span class="ident" id="7196685">err</span>&nbsp;<span class="op" id="7196689">:=</span>&nbsp;<span class="ident" id="7196692"><a href="/gostd/database/sql/sql_test.go.html#7196312">stmt</a></span><span class="op" id="7196696">.</span><span class="ident" id="7196697"><a href="/gostd/database/sql/sql.go.html#5240343">QueryRow</a></span><span class="op" id="7196705">(</span><span class="string" id="7196706">&#34;sleep&#34;</span><span class="op" id="7196713">,</span>&nbsp;<span class="ident" id="7196715"><a href="/gostd/database/sql/sql_test.go.html#7196476">sleepMillis</a></span><span class="op" id="7196726">)</span><span class="op" id="7196727">.</span><span class="ident" id="7196728"><a href="/gostd/database/sql/sql.go.html#5245114">Scan</a></span><span class="op" id="7196732">(</span><span class="op" id="7196733">&amp;</span><span class="ident" id="7196734"><a href="/gostd/database/sql/sql_test.go.html#7196668">op</a></span><span class="op" id="7196736">)</span><span class="op" id="7196737">;</span>&nbsp;<span class="ident" id="7196739"><a href="/gostd/database/sql/sql_test.go.html#7196685">err</a></span>&nbsp;<span class="op" id="7196743">!=</span>&nbsp;<span class="builtintype" id="7196746">nil</span>&nbsp;<span class="op" id="7196750">&amp;&amp;</span>&nbsp;<span class="ident" id="7196753"><a href="/gostd/database/sql/sql_test.go.html#7196685">err</a></span>&nbsp;<span class="op" id="7196757">!=</span>&nbsp;<span class="ident" id="7196760"><a href="/gostd/database/sql/sql.go.html#5206442">ErrNoRows</a></span>&nbsp;<span class="op" id="7196770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7196777"><a href="/gostd/database/sql/sql_test.go.html#7195853">t</a></span><span class="op" id="7196778">.</span><span class="ident" id="7196779"><a href="/gostd/testing/testing.go.html#5479963">Error</a></span><span class="op" id="7196784">(</span><span class="ident" id="7196785"><a href="/gostd/database/sql/sql_test.go.html#7196685">err</a></span><span class="op" id="7196788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7196794">}</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7196799">}</span><span class="op" id="7196800">(</span><span class="op" id="7196801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7196805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7196809">//&nbsp;Sleep&nbsp;for&nbsp;twice&nbsp;the&nbsp;expected&nbsp;length&nbsp;of&nbsp;time&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7196866">//&nbsp;batch&nbsp;of&nbsp;50&nbsp;queries&nbsp;above&nbsp;to&nbsp;finish&nbsp;before&nbsp;starting</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7196923">//&nbsp;the&nbsp;next&nbsp;round.</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7196944"><a href="/gostd/database/sql/sql_test.go.html#7169144">time</a></span><span class="op" id="7196948">.</span><span class="ident" id="7196949"><a href="/gostd/time/sleep.go.html#2713940">Sleep</a></span><span class="op" id="7196954">(</span><span class="num" id="7196955">2</span>&nbsp;<span class="op" id="7196957">*</span>&nbsp;<span class="ident" id="7196959"><a href="/gostd/database/sql/sql_test.go.html#7196476">sleepMillis</a></span>&nbsp;<span class="op" id="7196971">*</span>&nbsp;<span class="ident" id="7196973"><a href="/gostd/database/sql/sql_test.go.html#7169144">time</a></span><span class="op" id="7196977">.</span><span class="ident" id="7196978"><a href="/gostd/time/time.go.html#2734819">Millisecond</a></span><span class="op" id="7196989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7196992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7196995"><a href="/gostd/database/sql/sql_test.go.html#7196519">wg</a></span><span class="op" id="7196997">.</span><span class="ident" id="7196998"><a href="/gostd/sync/waitgroup.go.html#1462162">Wait</a></span><span class="op" id="7197002">(</span><span class="op" id="7197003">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7197007">if</span>&nbsp;<span class="ident" id="7197010">g</span><span class="op" id="7197011">,</span>&nbsp;<span class="ident" id="7197013">w</span>&nbsp;<span class="op" id="7197015">:=</span>&nbsp;<span class="ident" id="7197018"><a href="/gostd/database/sql/sql_test.go.html#7196090">db</a></span><span class="op" id="7197020">.</span><span class="ident" id="7197021"><a href="/gostd/database/sql/sql_test.go.html#7172377">numFreeConns</a></span><span class="op" id="7197033">(</span><span class="op" id="7197034">)</span><span class="op" id="7197035">,</span>&nbsp;<span class="num" id="7197037">2</span><span class="op" id="7197038">;</span>&nbsp;<span class="ident" id="7197040"><a href="/gostd/database/sql/sql_test.go.html#7197010">g</a></span>&nbsp;<span class="op" id="7197042">!=</span>&nbsp;<span class="ident" id="7197045"><a href="/gostd/database/sql/sql_test.go.html#7197013">w</a></span>&nbsp;<span class="op" id="7197047">{</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7197051"><a href="/gostd/database/sql/sql_test.go.html#7195853">t</a></span><span class="op" id="7197052">.</span><span class="ident" id="7197053"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7197059">(</span><span class="string" id="7197060">&#34;free&nbsp;conns&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7197086">,</span>&nbsp;<span class="ident" id="7197088"><a href="/gostd/database/sql/sql_test.go.html#7197010">g</a></span><span class="op" id="7197089">,</span>&nbsp;<span class="ident" id="7197091"><a href="/gostd/database/sql/sql_test.go.html#7197013">w</a></span><span class="op" id="7197092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7197095">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7197099">if</span>&nbsp;<span class="ident" id="7197102">n</span>&nbsp;<span class="op" id="7197104">:=</span>&nbsp;<span class="ident" id="7197107"><a href="/gostd/database/sql/sql_test.go.html#7196090">db</a></span><span class="op" id="7197109">.</span><span class="ident" id="7197110"><a href="/gostd/database/sql/sql_test.go.html#7172150">numDepsPollUntil</a></span><span class="op" id="7197126">(</span><span class="num" id="7197127">4</span><span class="op" id="7197128">,</span>&nbsp;<span class="ident" id="7197130"><a href="/gostd/database/sql/sql_test.go.html#7169144">time</a></span><span class="op" id="7197134">.</span><span class="ident" id="7197135"><a href="/gostd/time/time.go.html#2734862">Second</a></span><span class="op" id="7197141">)</span><span class="op" id="7197142">;</span>&nbsp;<span class="ident" id="7197144"><a href="/gostd/database/sql/sql_test.go.html#7197102">n</a></span>&nbsp;<span class="op" id="7197146">&gt;</span>&nbsp;<span class="num" id="7197148">4</span>&nbsp;<span class="op" id="7197150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7197154"><a href="/gostd/database/sql/sql_test.go.html#7195853">t</a></span><span class="op" id="7197155">.</span><span class="ident" id="7197156"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7197162">(</span><span class="string" id="7197163">&#34;number&nbsp;of&nbsp;dependencies&nbsp;=&nbsp;%d;&nbsp;expected&nbsp;&lt;=&nbsp;4&#34;</span><span class="op" id="7197207">,</span>&nbsp;<span class="ident" id="7197209"><a href="/gostd/database/sql/sql_test.go.html#7197102">n</a></span><span class="op" id="7197210">)</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7197214"><a href="/gostd/database/sql/sql_test.go.html#7196090">db</a></span><span class="op" id="7197216">.</span><span class="ident" id="7197217"><a href="/gostd/database/sql/sql_test.go.html#7172476">dumpDeps</a></span><span class="op" id="7197225">(</span><span class="ident" id="7197226"><a href="/gostd/database/sql/sql_test.go.html#7195853">t</a></span><span class="op" id="7197227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7197230">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7197234"><a href="/gostd/database/sql/sql_test.go.html#7196147">driver</a></span><span class="op" id="7197240">.</span><span class="ident" id="7197241"><a href="/gostd/database/sql/fakedb_test.go.html#7149401">mu</a></span><span class="op" id="7197243">.</span><span class="ident" id="7197244"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="7197248">(</span><span class="op" id="7197249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7197252">opens</span>&nbsp;<span class="op" id="7197258">:=</span>&nbsp;<span class="ident" id="7197261"><a href="/gostd/database/sql/sql_test.go.html#7196147">driver</a></span><span class="op" id="7197267">.</span><span class="ident" id="7197268"><a href="/gostd/database/sql/fakedb_test.go.html#7149453">openCount</a></span>&nbsp;<span class="op" id="7197278">-</span>&nbsp;<span class="ident" id="7197280"><a href="/gostd/database/sql/sql_test.go.html#7196201">opens0</a></span><br>
<span class="lineno">1160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7197288">closes</span>&nbsp;<span class="op" id="7197295">:=</span>&nbsp;<span class="ident" id="7197298"><a href="/gostd/database/sql/sql_test.go.html#7196147">driver</a></span><span class="op" id="7197304">.</span><span class="ident" id="7197305"><a href="/gostd/database/sql/fakedb_test.go.html#7149490">closeCount</a></span>&nbsp;<span class="op" id="7197316">-</span>&nbsp;<span class="ident" id="7197318"><a href="/gostd/database/sql/sql_test.go.html#7196229">closes0</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7197327">openDelta</span>&nbsp;<span class="op" id="7197337">:=</span>&nbsp;<span class="op" id="7197340">(</span><span class="ident" id="7197341"><a href="/gostd/database/sql/sql_test.go.html#7196147">driver</a></span><span class="op" id="7197347">.</span><span class="ident" id="7197348"><a href="/gostd/database/sql/fakedb_test.go.html#7149453">openCount</a></span>&nbsp;<span class="op" id="7197358">-</span>&nbsp;<span class="ident" id="7197360"><a href="/gostd/database/sql/sql_test.go.html#7196147">driver</a></span><span class="op" id="7197366">.</span><span class="ident" id="7197367"><a href="/gostd/database/sql/fakedb_test.go.html#7149490">closeCount</a></span><span class="op" id="7197377">)</span>&nbsp;<span class="op" id="7197379">-</span>&nbsp;<span class="ident" id="7197381"><a href="/gostd/database/sql/sql_test.go.html#7196279">openDelta0</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7197393"><a href="/gostd/database/sql/sql_test.go.html#7196147">driver</a></span><span class="op" id="7197399">.</span><span class="ident" id="7197400"><a href="/gostd/database/sql/fakedb_test.go.html#7149401">mu</a></span><span class="op" id="7197402">.</span><span class="ident" id="7197403"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="7197409">(</span><span class="op" id="7197410">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7197414">if</span>&nbsp;<span class="ident" id="7197417"><a href="/gostd/database/sql/sql_test.go.html#7197327">openDelta</a></span>&nbsp;<span class="op" id="7197427">&gt;</span>&nbsp;<span class="num" id="7197429">2</span>&nbsp;<span class="op" id="7197431">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7197435"><a href="/gostd/database/sql/sql_test.go.html#7195853">t</a></span><span class="op" id="7197436">.</span><span class="ident" id="7197437"><a href="/gostd/testing/testing.go.html#5479816">Logf</a></span><span class="op" id="7197441">(</span><span class="string" id="7197442">&#34;open&nbsp;calls&nbsp;=&nbsp;%d&#34;</span><span class="op" id="7197459">,</span>&nbsp;<span class="ident" id="7197461"><a href="/gostd/database/sql/sql_test.go.html#7197252">opens</a></span><span class="op" id="7197466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7197470"><a href="/gostd/database/sql/sql_test.go.html#7195853">t</a></span><span class="op" id="7197471">.</span><span class="ident" id="7197472"><a href="/gostd/testing/testing.go.html#5479816">Logf</a></span><span class="op" id="7197476">(</span><span class="string" id="7197477">&#34;close&nbsp;calls&nbsp;=&nbsp;%d&#34;</span><span class="op" id="7197495">,</span>&nbsp;<span class="ident" id="7197497"><a href="/gostd/database/sql/sql_test.go.html#7197288">closes</a></span><span class="op" id="7197503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7197507"><a href="/gostd/database/sql/sql_test.go.html#7195853">t</a></span><span class="op" id="7197508">.</span><span class="ident" id="7197509"><a href="/gostd/testing/testing.go.html#5479816">Logf</a></span><span class="op" id="7197513">(</span><span class="string" id="7197514">&#34;open&nbsp;delta&nbsp;=&nbsp;%d&#34;</span><span class="op" id="7197531">,</span>&nbsp;<span class="ident" id="7197533"><a href="/gostd/database/sql/sql_test.go.html#7197327">openDelta</a></span><span class="op" id="7197542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7197546"><a href="/gostd/database/sql/sql_test.go.html#7195853">t</a></span><span class="op" id="7197547">.</span><span class="ident" id="7197548"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7197554">(</span><span class="string" id="7197555">&#34;db&nbsp;connections&nbsp;opened&nbsp;=&nbsp;%d;&nbsp;want&nbsp;&lt;=&nbsp;2&#34;</span><span class="op" id="7197594">,</span>&nbsp;<span class="ident" id="7197596"><a href="/gostd/database/sql/sql_test.go.html#7197327">openDelta</a></span><span class="op" id="7197605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7197609"><a href="/gostd/database/sql/sql_test.go.html#7196090">db</a></span><span class="op" id="7197611">.</span><span class="ident" id="7197612"><a href="/gostd/database/sql/sql_test.go.html#7172476">dumpDeps</a></span><span class="op" id="7197620">(</span><span class="ident" id="7197621"><a href="/gostd/database/sql/sql_test.go.html#7195853">t</a></span><span class="op" id="7197622">)</span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7197625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7197629">if</span>&nbsp;<span class="builtinfunc" id="7197632">len</span><span class="op" id="7197635">(</span><span class="ident" id="7197636"><a href="/gostd/database/sql/sql_test.go.html#7196312">stmt</a></span><span class="op" id="7197640">.</span><span class="ident" id="7197641"><a href="/gostd/database/sql/sql.go.html#5235080">css</a></span><span class="op" id="7197644">)</span>&nbsp;<span class="op" id="7197646">&gt;</span>&nbsp;<span class="ident" id="7197648"><a href="/gostd/database/sql/sql_test.go.html#7196457">nquery</a></span>&nbsp;<span class="op" id="7197655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7197659"><a href="/gostd/database/sql/sql_test.go.html#7195853">t</a></span><span class="op" id="7197660">.</span><span class="ident" id="7197661"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7197667">(</span><span class="string" id="7197668">&#34;len(stmt.css)&nbsp;=&nbsp;%d;&nbsp;want&nbsp;&lt;=&nbsp;%d&#34;</span><span class="op" id="7197700">,</span>&nbsp;<span class="builtinfunc" id="7197702">len</span><span class="op" id="7197705">(</span><span class="ident" id="7197706"><a href="/gostd/database/sql/sql_test.go.html#7196312">stmt</a></span><span class="op" id="7197710">.</span><span class="ident" id="7197711"><a href="/gostd/database/sql/sql.go.html#5235080">css</a></span><span class="op" id="7197714">)</span><span class="op" id="7197715">,</span>&nbsp;<span class="ident" id="7197717"><a href="/gostd/database/sql/sql_test.go.html#7196457">nquery</a></span><span class="op" id="7197723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7197726">}</span><br>
<span class="lineno">1175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7197730">if</span>&nbsp;<span class="ident" id="7197733">err</span>&nbsp;<span class="op" id="7197737">:=</span>&nbsp;<span class="ident" id="7197740"><a href="/gostd/database/sql/sql_test.go.html#7196312">stmt</a></span><span class="op" id="7197744">.</span><span class="ident" id="7197745"><a href="/gostd/database/sql/sql.go.html#5240529">Close</a></span><span class="op" id="7197750">(</span><span class="op" id="7197751">)</span><span class="op" id="7197752">;</span>&nbsp;<span class="ident" id="7197754"><a href="/gostd/database/sql/sql_test.go.html#7197733">err</a></span>&nbsp;<span class="op" id="7197758">!=</span>&nbsp;<span class="builtintype" id="7197761">nil</span>&nbsp;<span class="op" id="7197765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7197769"><a href="/gostd/database/sql/sql_test.go.html#7195853">t</a></span><span class="op" id="7197770">.</span><span class="ident" id="7197771"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="7197776">(</span><span class="ident" id="7197777"><a href="/gostd/database/sql/sql_test.go.html#7197733">err</a></span><span class="op" id="7197780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7197783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7197787">if</span>&nbsp;<span class="ident" id="7197790">g</span><span class="op" id="7197791">,</span>&nbsp;<span class="ident" id="7197793">w</span>&nbsp;<span class="op" id="7197795">:=</span>&nbsp;<span class="ident" id="7197798"><a href="/gostd/database/sql/sql_test.go.html#7196090">db</a></span><span class="op" id="7197800">.</span><span class="ident" id="7197801"><a href="/gostd/database/sql/sql_test.go.html#7172377">numFreeConns</a></span><span class="op" id="7197813">(</span><span class="op" id="7197814">)</span><span class="op" id="7197815">,</span>&nbsp;<span class="num" id="7197817">2</span><span class="op" id="7197818">;</span>&nbsp;<span class="ident" id="7197820"><a href="/gostd/database/sql/sql_test.go.html#7197790">g</a></span>&nbsp;<span class="op" id="7197822">!=</span>&nbsp;<span class="ident" id="7197825"><a href="/gostd/database/sql/sql_test.go.html#7197793">w</a></span>&nbsp;<span class="op" id="7197827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7197831"><a href="/gostd/database/sql/sql_test.go.html#7195853">t</a></span><span class="op" id="7197832">.</span><span class="ident" id="7197833"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7197839">(</span><span class="string" id="7197840">&#34;free&nbsp;conns&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7197866">,</span>&nbsp;<span class="ident" id="7197868"><a href="/gostd/database/sql/sql_test.go.html#7197790">g</a></span><span class="op" id="7197869">,</span>&nbsp;<span class="ident" id="7197871"><a href="/gostd/database/sql/sql_test.go.html#7197793">w</a></span><span class="op" id="7197872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7197875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7197879">if</span>&nbsp;<span class="ident" id="7197882">n</span>&nbsp;<span class="op" id="7197884">:=</span>&nbsp;<span class="ident" id="7197887"><a href="/gostd/database/sql/sql_test.go.html#7196090">db</a></span><span class="op" id="7197889">.</span><span class="ident" id="7197890"><a href="/gostd/database/sql/sql_test.go.html#7172150">numDepsPollUntil</a></span><span class="op" id="7197906">(</span><span class="num" id="7197907">2</span><span class="op" id="7197908">,</span>&nbsp;<span class="ident" id="7197910"><a href="/gostd/database/sql/sql_test.go.html#7169144">time</a></span><span class="op" id="7197914">.</span><span class="ident" id="7197915"><a href="/gostd/time/time.go.html#2734862">Second</a></span><span class="op" id="7197921">)</span><span class="op" id="7197922">;</span>&nbsp;<span class="ident" id="7197924"><a href="/gostd/database/sql/sql_test.go.html#7197882">n</a></span>&nbsp;<span class="op" id="7197926">&gt;</span>&nbsp;<span class="num" id="7197928">2</span>&nbsp;<span class="op" id="7197930">{</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7197934"><a href="/gostd/database/sql/sql_test.go.html#7195853">t</a></span><span class="op" id="7197935">.</span><span class="ident" id="7197936"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7197942">(</span><span class="string" id="7197943">&#34;number&nbsp;of&nbsp;dependencies&nbsp;=&nbsp;%d;&nbsp;expected&nbsp;&lt;=&nbsp;2&#34;</span><span class="op" id="7197987">,</span>&nbsp;<span class="ident" id="7197989"><a href="/gostd/database/sql/sql_test.go.html#7197882">n</a></span><span class="op" id="7197990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7197994"><a href="/gostd/database/sql/sql_test.go.html#7196090">db</a></span><span class="op" id="7197996">.</span><span class="ident" id="7197997"><a href="/gostd/database/sql/sql_test.go.html#7172476">dumpDeps</a></span><span class="op" id="7198005">(</span><span class="ident" id="7198006"><a href="/gostd/database/sql/sql_test.go.html#7195853">t</a></span><span class="op" id="7198007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7198010">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7198014"><a href="/gostd/database/sql/sql_test.go.html#7196090">db</a></span><span class="op" id="7198016">.</span><span class="ident" id="7198017"><a href="/gostd/database/sql/sql.go.html#5215871">SetMaxIdleConns</a></span><span class="op" id="7198032">(</span><span class="num" id="7198033">0</span><span class="op" id="7198034">)</span><br>
<span class="lineno">1190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7198038">if</span>&nbsp;<span class="ident" id="7198041">g</span><span class="op" id="7198042">,</span>&nbsp;<span class="ident" id="7198044">w</span>&nbsp;<span class="op" id="7198046">:=</span>&nbsp;<span class="ident" id="7198049"><a href="/gostd/database/sql/sql_test.go.html#7196090">db</a></span><span class="op" id="7198051">.</span><span class="ident" id="7198052"><a href="/gostd/database/sql/sql_test.go.html#7172377">numFreeConns</a></span><span class="op" id="7198064">(</span><span class="op" id="7198065">)</span><span class="op" id="7198066">,</span>&nbsp;<span class="num" id="7198068">0</span><span class="op" id="7198069">;</span>&nbsp;<span class="ident" id="7198071"><a href="/gostd/database/sql/sql_test.go.html#7198041">g</a></span>&nbsp;<span class="op" id="7198073">!=</span>&nbsp;<span class="ident" id="7198076"><a href="/gostd/database/sql/sql_test.go.html#7198044">w</a></span>&nbsp;<span class="op" id="7198078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7198082"><a href="/gostd/database/sql/sql_test.go.html#7195853">t</a></span><span class="op" id="7198083">.</span><span class="ident" id="7198084"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7198090">(</span><span class="string" id="7198091">&#34;free&nbsp;conns&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7198117">,</span>&nbsp;<span class="ident" id="7198119"><a href="/gostd/database/sql/sql_test.go.html#7198041">g</a></span><span class="op" id="7198120">,</span>&nbsp;<span class="ident" id="7198122"><a href="/gostd/database/sql/sql_test.go.html#7198044">w</a></span><span class="op" id="7198123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7198126">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7198130">if</span>&nbsp;<span class="ident" id="7198133">n</span>&nbsp;<span class="op" id="7198135">:=</span>&nbsp;<span class="ident" id="7198138"><a href="/gostd/database/sql/sql_test.go.html#7196090">db</a></span><span class="op" id="7198140">.</span><span class="ident" id="7198141"><a href="/gostd/database/sql/sql_test.go.html#7172150">numDepsPollUntil</a></span><span class="op" id="7198157">(</span><span class="num" id="7198158">0</span><span class="op" id="7198159">,</span>&nbsp;<span class="ident" id="7198161"><a href="/gostd/database/sql/sql_test.go.html#7169144">time</a></span><span class="op" id="7198165">.</span><span class="ident" id="7198166"><a href="/gostd/time/time.go.html#2734862">Second</a></span><span class="op" id="7198172">)</span><span class="op" id="7198173">;</span>&nbsp;<span class="ident" id="7198175"><a href="/gostd/database/sql/sql_test.go.html#7198133">n</a></span>&nbsp;<span class="op" id="7198177">&gt;</span>&nbsp;<span class="num" id="7198179">0</span>&nbsp;<span class="op" id="7198181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7198185"><a href="/gostd/database/sql/sql_test.go.html#7195853">t</a></span><span class="op" id="7198186">.</span><span class="ident" id="7198187"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7198193">(</span><span class="string" id="7198194">&#34;number&nbsp;of&nbsp;dependencies&nbsp;=&nbsp;%d;&nbsp;expected&nbsp;0&#34;</span><span class="op" id="7198235">,</span>&nbsp;<span class="ident" id="7198237"><a href="/gostd/database/sql/sql_test.go.html#7198133">n</a></span><span class="op" id="7198238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7198242"><a href="/gostd/database/sql/sql_test.go.html#7196090">db</a></span><span class="op" id="7198244">.</span><span class="ident" id="7198245"><a href="/gostd/database/sql/sql_test.go.html#7172476">dumpDeps</a></span><span class="op" id="7198253">(</span><span class="ident" id="7198254"><a href="/gostd/database/sql/sql_test.go.html#7195853">t</a></span><span class="op" id="7198255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7198258">}</span><br>
<span class="lineno"></span><span class="op" id="7198260">}</span><br>
<span class="lineno">1200</span><br>
<span class="lineno"></span><span class="comment" id="7198263">//&nbsp;golang.org/issue/5046</span><br>
<span class="lineno"></span><span class="keyword" id="7198288">func</span>&nbsp;<span class="ident" id="7198293">TestCloseConnBeforeStmts</span><span class="op" id="7198317">(</span><span class="ident" id="7198318">t</span>&nbsp;<span class="op" id="7198320">*</span><span class="ident" id="7198321"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7198328">.</span><span class="ident" id="7198329"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7198330">)</span>&nbsp;<span class="op" id="7198332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7198335">db</span>&nbsp;<span class="op" id="7198338">:=</span>&nbsp;<span class="ident" id="7198341"><a href="/gostd/database/sql/sql_test.go.html#7169849">newTestDB</a></span><span class="op" id="7198350">(</span><span class="ident" id="7198351"><a href="/gostd/database/sql/sql_test.go.html#7198318">t</a></span><span class="op" id="7198352">,</span>&nbsp;<span class="string" id="7198354">&#34;people&#34;</span><span class="op" id="7198362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7198365">defer</span>&nbsp;<span class="ident" id="7198371"><a href="/gostd/database/sql/sql_test.go.html#7170773">closeDB</a></span><span class="op" id="7198378">(</span><span class="ident" id="7198379"><a href="/gostd/database/sql/sql_test.go.html#7198318">t</a></span><span class="op" id="7198380">,</span>&nbsp;<span class="ident" id="7198382"><a href="/gostd/database/sql/sql_test.go.html#7198335">db</a></span><span class="op" id="7198384">)</span><br>
<span class="lineno">1205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7198388">defer</span>&nbsp;<span class="ident" id="7198394"><a href="/gostd/database/sql/fakedb_test.go.html#7154130">setHookpostCloseConn</a></span><span class="op" id="7198414">(</span><span class="builtintype" id="7198415">nil</span><span class="op" id="7198418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7198421"><a href="/gostd/database/sql/fakedb_test.go.html#7154130">setHookpostCloseConn</a></span><span class="op" id="7198441">(</span><span class="keyword" id="7198442">func</span><span class="op" id="7198446">(</span><span class="ident" id="7198447">_</span>&nbsp;<span class="op" id="7198449">*</span><span class="ident" id="7198450"><a href="/gostd/database/sql/fakedb_test.go.html#7150186">fakeConn</a></span><span class="op" id="7198458">,</span>&nbsp;<span class="ident" id="7198460">err</span>&nbsp;<span class="builtintype" id="7198464">error</span><span class="op" id="7198469">)</span>&nbsp;<span class="op" id="7198471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7198475">if</span>&nbsp;<span class="ident" id="7198478"><a href="/gostd/database/sql/sql_test.go.html#7198460">err</a></span>&nbsp;<span class="op" id="7198482">!=</span>&nbsp;<span class="builtintype" id="7198485">nil</span>&nbsp;<span class="op" id="7198489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7198494"><a href="/gostd/database/sql/sql_test.go.html#7198318">t</a></span><span class="op" id="7198495">.</span><span class="ident" id="7198496"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7198502">(</span><span class="string" id="7198503">&#34;Error&nbsp;closing&nbsp;fakeConn:&nbsp;%v;&nbsp;from&nbsp;%s&#34;</span><span class="op" id="7198540">,</span>&nbsp;<span class="ident" id="7198542"><a href="/gostd/database/sql/sql_test.go.html#7198460">err</a></span><span class="op" id="7198545">,</span>&nbsp;<span class="ident" id="7198547"><a href="/gostd/database/sql/sql.go.html#5247274">stack</a></span><span class="op" id="7198552">(</span><span class="op" id="7198553">)</span><span class="op" id="7198554">)</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7198559"><a href="/gostd/database/sql/sql_test.go.html#7198335">db</a></span><span class="op" id="7198561">.</span><span class="ident" id="7198562"><a href="/gostd/database/sql/sql_test.go.html#7172476">dumpDeps</a></span><span class="op" id="7198570">(</span><span class="ident" id="7198571"><a href="/gostd/database/sql/sql_test.go.html#7198318">t</a></span><span class="op" id="7198572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7198577"><a href="/gostd/database/sql/sql_test.go.html#7198318">t</a></span><span class="op" id="7198578">.</span><span class="ident" id="7198579"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7198585">(</span><span class="string" id="7198586">&#34;DB&nbsp;=&nbsp;%#v&#34;</span><span class="op" id="7198596">,</span>&nbsp;<span class="ident" id="7198598"><a href="/gostd/database/sql/sql_test.go.html#7198335">db</a></span><span class="op" id="7198600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7198604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7198607">}</span><span class="op" id="7198608">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7198612">stmt</span><span class="op" id="7198616">,</span>&nbsp;<span class="ident" id="7198618">err</span>&nbsp;<span class="op" id="7198622">:=</span>&nbsp;<span class="ident" id="7198625"><a href="/gostd/database/sql/sql_test.go.html#7198335">db</a></span><span class="op" id="7198627">.</span><span class="ident" id="7198628"><a href="/gostd/database/sql/sql.go.html#5223860">Prepare</a></span><span class="op" id="7198635">(</span><span class="string" id="7198636">&#34;SELECT|people|name|&#34;</span><span class="op" id="7198657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7198660">if</span>&nbsp;<span class="ident" id="7198663"><a href="/gostd/database/sql/sql_test.go.html#7198618">err</a></span>&nbsp;<span class="op" id="7198667">!=</span>&nbsp;<span class="builtintype" id="7198670">nil</span>&nbsp;<span class="op" id="7198674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7198678"><a href="/gostd/database/sql/sql_test.go.html#7198318">t</a></span><span class="op" id="7198679">.</span><span class="ident" id="7198680"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="7198685">(</span><span class="ident" id="7198686"><a href="/gostd/database/sql/sql_test.go.html#7198618">err</a></span><span class="op" id="7198689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7198692">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7198696">if</span>&nbsp;<span class="builtinfunc" id="7198699">len</span><span class="op" id="7198702">(</span><span class="ident" id="7198703"><a href="/gostd/database/sql/sql_test.go.html#7198335">db</a></span><span class="op" id="7198705">.</span><span class="ident" id="7198706"><a href="/gostd/database/sql/sql.go.html#5207263">freeConn</a></span><span class="op" id="7198714">)</span>&nbsp;<span class="op" id="7198716">!=</span>&nbsp;<span class="num" id="7198719">1</span>&nbsp;<span class="op" id="7198721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7198725"><a href="/gostd/database/sql/sql_test.go.html#7198318">t</a></span><span class="op" id="7198726">.</span><span class="ident" id="7198727"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7198733">(</span><span class="string" id="7198734">&#34;expected&nbsp;1&nbsp;freeConn;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7198763">,</span>&nbsp;<span class="builtinfunc" id="7198765">len</span><span class="op" id="7198768">(</span><span class="ident" id="7198769"><a href="/gostd/database/sql/sql_test.go.html#7198335">db</a></span><span class="op" id="7198771">.</span><span class="ident" id="7198772"><a href="/gostd/database/sql/sql.go.html#5207263">freeConn</a></span><span class="op" id="7198780">)</span><span class="op" id="7198781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7198784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7198787">dc</span>&nbsp;<span class="op" id="7198790">:=</span>&nbsp;<span class="ident" id="7198793"><a href="/gostd/database/sql/sql_test.go.html#7198335">db</a></span><span class="op" id="7198795">.</span><span class="ident" id="7198796"><a href="/gostd/database/sql/sql.go.html#5207263">freeConn</a></span><span class="op" id="7198804">[</span><span class="num" id="7198805">0</span><span class="op" id="7198806">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7198809">if</span>&nbsp;<span class="ident" id="7198812"><a href="/gostd/database/sql/sql_test.go.html#7198787">dc</a></span><span class="op" id="7198814">.</span><span class="ident" id="7198815"><a href="/gostd/database/sql/sql.go.html#5208238">closed</a></span>&nbsp;<span class="op" id="7198822">{</span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7198826"><a href="/gostd/database/sql/sql_test.go.html#7198318">t</a></span><span class="op" id="7198827">.</span><span class="ident" id="7198828"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7198834">(</span><span class="string" id="7198835">&#34;conn&nbsp;shouldn&#39;t&nbsp;be&nbsp;closed&#34;</span><span class="op" id="7198861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7198864">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7198868">if</span>&nbsp;<span class="ident" id="7198871">n</span>&nbsp;<span class="op" id="7198873">:=</span>&nbsp;<span class="builtinfunc" id="7198876">len</span><span class="op" id="7198879">(</span><span class="ident" id="7198880"><a href="/gostd/database/sql/sql_test.go.html#7198787">dc</a></span><span class="op" id="7198882">.</span><span class="ident" id="7198883"><a href="/gostd/database/sql/sql.go.html#5208302">openStmt</a></span><span class="op" id="7198891">)</span><span class="op" id="7198892">;</span>&nbsp;<span class="ident" id="7198894"><a href="/gostd/database/sql/sql_test.go.html#7198871">n</a></span>&nbsp;<span class="op" id="7198896">!=</span>&nbsp;<span class="num" id="7198899">1</span>&nbsp;<span class="op" id="7198901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7198905"><a href="/gostd/database/sql/sql_test.go.html#7198318">t</a></span><span class="op" id="7198906">.</span><span class="ident" id="7198907"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7198913">(</span><span class="string" id="7198914">&#34;driverConn&nbsp;num&nbsp;openStmt&nbsp;=&nbsp;%d;&nbsp;want&nbsp;1&#34;</span><span class="op" id="7198952">,</span>&nbsp;<span class="ident" id="7198954"><a href="/gostd/database/sql/sql_test.go.html#7198871">n</a></span><span class="op" id="7198955">)</span><br>
<span class="lineno">1230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7198958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7198961"><a href="/gostd/database/sql/sql_test.go.html#7198618">err</a></span>&nbsp;<span class="op" id="7198965">=</span>&nbsp;<span class="ident" id="7198967"><a href="/gostd/database/sql/sql_test.go.html#7198335">db</a></span><span class="op" id="7198969">.</span><span class="ident" id="7198970"><a href="/gostd/database/sql/sql.go.html#5214824">Close</a></span><span class="op" id="7198975">(</span><span class="op" id="7198976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7198979">if</span>&nbsp;<span class="ident" id="7198982"><a href="/gostd/database/sql/sql_test.go.html#7198618">err</a></span>&nbsp;<span class="op" id="7198986">!=</span>&nbsp;<span class="builtintype" id="7198989">nil</span>&nbsp;<span class="op" id="7198993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7198997"><a href="/gostd/database/sql/sql_test.go.html#7198318">t</a></span><span class="op" id="7198998">.</span><span class="ident" id="7198999"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7199005">(</span><span class="string" id="7199006">&#34;db&nbsp;Close&nbsp;=&nbsp;%v&#34;</span><span class="op" id="7199021">,</span>&nbsp;<span class="ident" id="7199023"><a href="/gostd/database/sql/sql_test.go.html#7198618">err</a></span><span class="op" id="7199026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7199029">}</span><br>
<span class="lineno">1235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7199032">if</span>&nbsp;<span class="op" id="7199035">!</span><span class="ident" id="7199036"><a href="/gostd/database/sql/sql_test.go.html#7198787">dc</a></span><span class="op" id="7199038">.</span><span class="ident" id="7199039"><a href="/gostd/database/sql/sql.go.html#5208238">closed</a></span>&nbsp;<span class="op" id="7199046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7199050"><a href="/gostd/database/sql/sql_test.go.html#7198318">t</a></span><span class="op" id="7199051">.</span><span class="ident" id="7199052"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7199058">(</span><span class="string" id="7199059">&#34;after&nbsp;db.Close,&nbsp;driverConn&nbsp;should&nbsp;be&nbsp;closed&#34;</span><span class="op" id="7199104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7199107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7199110">if</span>&nbsp;<span class="ident" id="7199113">n</span>&nbsp;<span class="op" id="7199115">:=</span>&nbsp;<span class="builtinfunc" id="7199118">len</span><span class="op" id="7199121">(</span><span class="ident" id="7199122"><a href="/gostd/database/sql/sql_test.go.html#7198787">dc</a></span><span class="op" id="7199124">.</span><span class="ident" id="7199125"><a href="/gostd/database/sql/sql.go.html#5208302">openStmt</a></span><span class="op" id="7199133">)</span><span class="op" id="7199134">;</span>&nbsp;<span class="ident" id="7199136"><a href="/gostd/database/sql/sql_test.go.html#7199113">n</a></span>&nbsp;<span class="op" id="7199138">!=</span>&nbsp;<span class="num" id="7199141">0</span>&nbsp;<span class="op" id="7199143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7199147"><a href="/gostd/database/sql/sql_test.go.html#7198318">t</a></span><span class="op" id="7199148">.</span><span class="ident" id="7199149"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7199155">(</span><span class="string" id="7199156">&#34;driverConn&nbsp;num&nbsp;openStmt&nbsp;=&nbsp;%d;&nbsp;want&nbsp;0&#34;</span><span class="op" id="7199194">,</span>&nbsp;<span class="ident" id="7199196"><a href="/gostd/database/sql/sql_test.go.html#7199113">n</a></span><span class="op" id="7199197">)</span><br>
<span class="lineno">1240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7199200">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7199204"><a href="/gostd/database/sql/sql_test.go.html#7198618">err</a></span>&nbsp;<span class="op" id="7199208">=</span>&nbsp;<span class="ident" id="7199210"><a href="/gostd/database/sql/sql_test.go.html#7198612">stmt</a></span><span class="op" id="7199214">.</span><span class="ident" id="7199215"><a href="/gostd/database/sql/sql.go.html#5240529">Close</a></span><span class="op" id="7199220">(</span><span class="op" id="7199221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7199224">if</span>&nbsp;<span class="ident" id="7199227"><a href="/gostd/database/sql/sql_test.go.html#7198618">err</a></span>&nbsp;<span class="op" id="7199231">!=</span>&nbsp;<span class="builtintype" id="7199234">nil</span>&nbsp;<span class="op" id="7199238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7199242"><a href="/gostd/database/sql/sql_test.go.html#7198318">t</a></span><span class="op" id="7199243">.</span><span class="ident" id="7199244"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7199250">(</span><span class="string" id="7199251">&#34;Stmt&nbsp;close&nbsp;=&nbsp;%v&#34;</span><span class="op" id="7199268">,</span>&nbsp;<span class="ident" id="7199270"><a href="/gostd/database/sql/sql_test.go.html#7198618">err</a></span><span class="op" id="7199273">)</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7199276">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7199280">if</span>&nbsp;<span class="op" id="7199283">!</span><span class="ident" id="7199284"><a href="/gostd/database/sql/sql_test.go.html#7198787">dc</a></span><span class="op" id="7199286">.</span><span class="ident" id="7199287"><a href="/gostd/database/sql/sql.go.html#5208238">closed</a></span>&nbsp;<span class="op" id="7199294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7199298"><a href="/gostd/database/sql/sql_test.go.html#7198318">t</a></span><span class="op" id="7199299">.</span><span class="ident" id="7199300"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7199306">(</span><span class="string" id="7199307">&#34;conn&nbsp;should&nbsp;be&nbsp;closed&#34;</span><span class="op" id="7199330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7199333">}</span><br>
<span class="lineno">1250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7199336">if</span>&nbsp;<span class="ident" id="7199339"><a href="/gostd/database/sql/sql_test.go.html#7198787">dc</a></span><span class="op" id="7199341">.</span><span class="ident" id="7199342"><a href="/gostd/database/sql/sql.go.html#5208213">ci</a></span>&nbsp;<span class="op" id="7199345">!=</span>&nbsp;<span class="builtintype" id="7199348">nil</span>&nbsp;<span class="op" id="7199352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7199356"><a href="/gostd/database/sql/sql_test.go.html#7198318">t</a></span><span class="op" id="7199357">.</span><span class="ident" id="7199358"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7199364">(</span><span class="string" id="7199365">&#34;after&nbsp;Stmt&nbsp;Close,&nbsp;driverConn&#39;s&nbsp;Conn&nbsp;interface&nbsp;should&nbsp;be&nbsp;nil&#34;</span><span class="op" id="7199426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7199429">}</span><br>
<span class="lineno"></span><span class="op" id="7199431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1255</span><span class="comment" id="7199434">//&nbsp;golang.org/issue/5283:&nbsp;don&#39;t&nbsp;release&nbsp;the&nbsp;Rows&#39;&nbsp;connection&nbsp;in&nbsp;Close</span><br>
<span class="lineno"></span><span class="comment" id="7199504">//&nbsp;before&nbsp;calling&nbsp;Stmt.Close.</span><br>
<span class="lineno"></span><span class="keyword" id="7199534">func</span>&nbsp;<span class="ident" id="7199539">TestRowsCloseOrder</span><span class="op" id="7199557">(</span><span class="ident" id="7199558">t</span>&nbsp;<span class="op" id="7199560">*</span><span class="ident" id="7199561"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7199568">.</span><span class="ident" id="7199569"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7199570">)</span>&nbsp;<span class="op" id="7199572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7199575">db</span>&nbsp;<span class="op" id="7199578">:=</span>&nbsp;<span class="ident" id="7199581"><a href="/gostd/database/sql/sql_test.go.html#7169849">newTestDB</a></span><span class="op" id="7199590">(</span><span class="ident" id="7199591"><a href="/gostd/database/sql/sql_test.go.html#7199558">t</a></span><span class="op" id="7199592">,</span>&nbsp;<span class="string" id="7199594">&#34;people&#34;</span><span class="op" id="7199602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7199605">defer</span>&nbsp;<span class="ident" id="7199611"><a href="/gostd/database/sql/sql_test.go.html#7170773">closeDB</a></span><span class="op" id="7199618">(</span><span class="ident" id="7199619"><a href="/gostd/database/sql/sql_test.go.html#7199558">t</a></span><span class="op" id="7199620">,</span>&nbsp;<span class="ident" id="7199622"><a href="/gostd/database/sql/sql_test.go.html#7199575">db</a></span><span class="op" id="7199624">)</span><br>
<span class="lineno">1260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7199628"><a href="/gostd/database/sql/sql_test.go.html#7199575">db</a></span><span class="op" id="7199630">.</span><span class="ident" id="7199631"><a href="/gostd/database/sql/sql.go.html#5215871">SetMaxIdleConns</a></span><span class="op" id="7199646">(</span><span class="num" id="7199647">0</span><span class="op" id="7199648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7199651"><a href="/gostd/database/sql/fakedb_test.go.html#7154427">setStrictFakeConnClose</a></span><span class="op" id="7199673">(</span><span class="ident" id="7199674"><a href="/gostd/database/sql/sql_test.go.html#7199558">t</a></span><span class="op" id="7199675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7199678">defer</span>&nbsp;<span class="ident" id="7199684"><a href="/gostd/database/sql/fakedb_test.go.html#7154427">setStrictFakeConnClose</a></span><span class="op" id="7199706">(</span><span class="builtintype" id="7199707">nil</span><span class="op" id="7199710">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7199714">rows</span><span class="op" id="7199718">,</span>&nbsp;<span class="ident" id="7199720">err</span>&nbsp;<span class="op" id="7199724">:=</span>&nbsp;<span class="ident" id="7199727"><a href="/gostd/database/sql/sql_test.go.html#7199575">db</a></span><span class="op" id="7199729">.</span><span class="ident" id="7199730"><a href="/gostd/database/sql/sql.go.html#5225993">Query</a></span><span class="op" id="7199735">(</span><span class="string" id="7199736">&#34;SELECT|people|age,name|&#34;</span><span class="op" id="7199761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7199764">if</span>&nbsp;<span class="ident" id="7199767"><a href="/gostd/database/sql/sql_test.go.html#7199720">err</a></span>&nbsp;<span class="op" id="7199771">!=</span>&nbsp;<span class="builtintype" id="7199774">nil</span>&nbsp;<span class="op" id="7199778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7199782"><a href="/gostd/database/sql/sql_test.go.html#7199558">t</a></span><span class="op" id="7199783">.</span><span class="ident" id="7199784"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="7199789">(</span><span class="ident" id="7199790"><a href="/gostd/database/sql/sql_test.go.html#7199720">err</a></span><span class="op" id="7199793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7199796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7199799"><a href="/gostd/database/sql/sql_test.go.html#7199720">err</a></span>&nbsp;<span class="op" id="7199803">=</span>&nbsp;<span class="ident" id="7199805"><a href="/gostd/database/sql/sql_test.go.html#7199714">rows</a></span><span class="op" id="7199809">.</span><span class="ident" id="7199810"><a href="/gostd/database/sql/sql.go.html#5244447">Close</a></span><span class="op" id="7199815">(</span><span class="op" id="7199816">)</span><br>
<span class="lineno">1270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7199819">if</span>&nbsp;<span class="ident" id="7199822"><a href="/gostd/database/sql/sql_test.go.html#7199720">err</a></span>&nbsp;<span class="op" id="7199826">!=</span>&nbsp;<span class="builtintype" id="7199829">nil</span>&nbsp;<span class="op" id="7199833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7199837"><a href="/gostd/database/sql/sql_test.go.html#7199558">t</a></span><span class="op" id="7199838">.</span><span class="ident" id="7199839"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="7199844">(</span><span class="ident" id="7199845"><a href="/gostd/database/sql/sql_test.go.html#7199720">err</a></span><span class="op" id="7199848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7199851">}</span><br>
<span class="lineno"></span><span class="op" id="7199853">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1275</span><span class="keyword" id="7199856">func</span>&nbsp;<span class="ident" id="7199861">TestRowsImplicitClose</span><span class="op" id="7199882">(</span><span class="ident" id="7199883">t</span>&nbsp;<span class="op" id="7199885">*</span><span class="ident" id="7199886"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7199893">.</span><span class="ident" id="7199894"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7199895">)</span>&nbsp;<span class="op" id="7199897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7199900">db</span>&nbsp;<span class="op" id="7199903">:=</span>&nbsp;<span class="ident" id="7199906"><a href="/gostd/database/sql/sql_test.go.html#7169849">newTestDB</a></span><span class="op" id="7199915">(</span><span class="ident" id="7199916"><a href="/gostd/database/sql/sql_test.go.html#7199883">t</a></span><span class="op" id="7199917">,</span>&nbsp;<span class="string" id="7199919">&#34;people&#34;</span><span class="op" id="7199927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7199930">defer</span>&nbsp;<span class="ident" id="7199936"><a href="/gostd/database/sql/sql_test.go.html#7170773">closeDB</a></span><span class="op" id="7199943">(</span><span class="ident" id="7199944"><a href="/gostd/database/sql/sql_test.go.html#7199883">t</a></span><span class="op" id="7199945">,</span>&nbsp;<span class="ident" id="7199947"><a href="/gostd/database/sql/sql_test.go.html#7199900">db</a></span><span class="op" id="7199949">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7199953">rows</span><span class="op" id="7199957">,</span>&nbsp;<span class="ident" id="7199959">err</span>&nbsp;<span class="op" id="7199963">:=</span>&nbsp;<span class="ident" id="7199966"><a href="/gostd/database/sql/sql_test.go.html#7199900">db</a></span><span class="op" id="7199968">.</span><span class="ident" id="7199969"><a href="/gostd/database/sql/sql.go.html#5225993">Query</a></span><span class="op" id="7199974">(</span><span class="string" id="7199975">&#34;SELECT|people|age,name|&#34;</span><span class="op" id="7200000">)</span><br>
<span class="lineno">1280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7200003">if</span>&nbsp;<span class="ident" id="7200006"><a href="/gostd/database/sql/sql_test.go.html#7199959">err</a></span>&nbsp;<span class="op" id="7200010">!=</span>&nbsp;<span class="builtintype" id="7200013">nil</span>&nbsp;<span class="op" id="7200017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7200021"><a href="/gostd/database/sql/sql_test.go.html#7199883">t</a></span><span class="op" id="7200022">.</span><span class="ident" id="7200023"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="7200028">(</span><span class="ident" id="7200029"><a href="/gostd/database/sql/sql_test.go.html#7199959">err</a></span><span class="op" id="7200032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7200035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7200039">want</span><span class="op" id="7200043">,</span>&nbsp;<span class="ident" id="7200045">fail</span>&nbsp;<span class="op" id="7200050">:=</span>&nbsp;<span class="num" id="7200053">2</span><span class="op" id="7200054">,</span>&nbsp;<span class="ident" id="7200056"><a href="/gostd/database/sql/sql_test.go.html#7169062">errors</a></span><span class="op" id="7200062">.</span><span class="ident" id="7200063"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="7200066">(</span><span class="string" id="7200067">&#34;fail&#34;</span><span class="op" id="7200073">)</span><br>
<span class="lineno">1285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7200076">r</span>&nbsp;<span class="op" id="7200078">:=</span>&nbsp;<span class="ident" id="7200081"><a href="/gostd/database/sql/sql_test.go.html#7199953">rows</a></span><span class="op" id="7200085">.</span><span class="ident" id="7200086"><a href="/gostd/database/sql/sql.go.html#5241619">rowsi</a></span><span class="op" id="7200091">.</span><span class="op" id="7200092">(</span><span class="op" id="7200093">*</span><span class="ident" id="7200094"><a href="/gostd/database/sql/fakedb_test.go.html#7165641">rowsCursor</a></span><span class="op" id="7200104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7200107"><a href="/gostd/database/sql/sql_test.go.html#7200076">r</a></span><span class="op" id="7200108">.</span><span class="ident" id="7200109"><a href="/gostd/database/sql/fakedb_test.go.html#7165784">errPos</a></span><span class="op" id="7200115">,</span>&nbsp;<span class="ident" id="7200117"><a href="/gostd/database/sql/sql_test.go.html#7200076">r</a></span><span class="op" id="7200118">.</span><span class="ident" id="7200119"><a href="/gostd/database/sql/fakedb_test.go.html#7165796">err</a></span>&nbsp;<span class="op" id="7200123">=</span>&nbsp;<span class="ident" id="7200125"><a href="/gostd/database/sql/sql_test.go.html#7200039">want</a></span><span class="op" id="7200129">,</span>&nbsp;<span class="ident" id="7200131"><a href="/gostd/database/sql/sql_test.go.html#7200045">fail</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7200138">got</span>&nbsp;<span class="op" id="7200142">:=</span>&nbsp;<span class="num" id="7200145">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7200148">for</span>&nbsp;<span class="ident" id="7200152"><a href="/gostd/database/sql/sql_test.go.html#7199953">rows</a></span><span class="op" id="7200156">.</span><span class="ident" id="7200157"><a href="/gostd/database/sql/sql.go.html#5242163">Next</a></span><span class="op" id="7200161">(</span><span class="op" id="7200162">)</span>&nbsp;<span class="op" id="7200164">{</span><br>
<span class="lineno">1290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7200168"><a href="/gostd/database/sql/sql_test.go.html#7200138">got</a></span><span class="op" id="7200171">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7200175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7200178">if</span>&nbsp;<span class="ident" id="7200181"><a href="/gostd/database/sql/sql_test.go.html#7200138">got</a></span>&nbsp;<span class="op" id="7200185">!=</span>&nbsp;<span class="ident" id="7200188"><a href="/gostd/database/sql/sql_test.go.html#7200039">want</a></span>&nbsp;<span class="op" id="7200193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7200197"><a href="/gostd/database/sql/sql_test.go.html#7199883">t</a></span><span class="op" id="7200198">.</span><span class="ident" id="7200199"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7200205">(</span><span class="string" id="7200206">&#34;got&nbsp;%d&nbsp;rows,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7200228">,</span>&nbsp;<span class="ident" id="7200230"><a href="/gostd/database/sql/sql_test.go.html#7200138">got</a></span><span class="op" id="7200233">,</span>&nbsp;<span class="ident" id="7200235"><a href="/gostd/database/sql/sql_test.go.html#7200039">want</a></span><span class="op" id="7200239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7200242">}</span><br>
<span class="lineno">1295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7200245">if</span>&nbsp;<span class="ident" id="7200248">err</span>&nbsp;<span class="op" id="7200252">:=</span>&nbsp;<span class="ident" id="7200255"><a href="/gostd/database/sql/sql_test.go.html#7199953">rows</a></span><span class="op" id="7200259">.</span><span class="ident" id="7200260"><a href="/gostd/database/sql/sql.go.html#5242560">Err</a></span><span class="op" id="7200263">(</span><span class="op" id="7200264">)</span><span class="op" id="7200265">;</span>&nbsp;<span class="ident" id="7200267"><a href="/gostd/database/sql/sql_test.go.html#7200248">err</a></span>&nbsp;<span class="op" id="7200271">!=</span>&nbsp;<span class="ident" id="7200274"><a href="/gostd/database/sql/sql_test.go.html#7200045">fail</a></span>&nbsp;<span class="op" id="7200279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7200283"><a href="/gostd/database/sql/sql_test.go.html#7199883">t</a></span><span class="op" id="7200284">.</span><span class="ident" id="7200285"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7200291">(</span><span class="string" id="7200292">&#34;got&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7200315">,</span>&nbsp;<span class="ident" id="7200317"><a href="/gostd/database/sql/sql_test.go.html#7200248">err</a></span><span class="op" id="7200320">,</span>&nbsp;<span class="ident" id="7200322"><a href="/gostd/database/sql/sql_test.go.html#7200045">fail</a></span><span class="op" id="7200326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7200329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7200332">if</span>&nbsp;<span class="op" id="7200335">!</span><span class="ident" id="7200336"><a href="/gostd/database/sql/sql_test.go.html#7200076">r</a></span><span class="op" id="7200337">.</span><span class="ident" id="7200338"><a href="/gostd/database/sql/fakedb_test.go.html#7165706">closed</a></span>&nbsp;<span class="op" id="7200345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7200349"><a href="/gostd/database/sql/sql_test.go.html#7199883">t</a></span><span class="op" id="7200350">.</span><span class="ident" id="7200351"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7200357">(</span><span class="string" id="7200358">&#34;r.closed&nbsp;is&nbsp;false,&nbsp;want&nbsp;true&#34;</span><span class="op" id="7200388">)</span><br>
<span class="lineno">1300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7200391">}</span><br>
<span class="lineno"></span><span class="op" id="7200393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7200396">func</span>&nbsp;<span class="ident" id="7200401">TestStmtCloseOrder</span><span class="op" id="7200419">(</span><span class="ident" id="7200420">t</span>&nbsp;<span class="op" id="7200422">*</span><span class="ident" id="7200423"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7200430">.</span><span class="ident" id="7200431"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7200432">)</span>&nbsp;<span class="op" id="7200434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7200437">db</span>&nbsp;<span class="op" id="7200440">:=</span>&nbsp;<span class="ident" id="7200443"><a href="/gostd/database/sql/sql_test.go.html#7169849">newTestDB</a></span><span class="op" id="7200452">(</span><span class="ident" id="7200453"><a href="/gostd/database/sql/sql_test.go.html#7200420">t</a></span><span class="op" id="7200454">,</span>&nbsp;<span class="string" id="7200456">&#34;people&#34;</span><span class="op" id="7200464">)</span><br>
<span class="lineno">1305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7200467">defer</span>&nbsp;<span class="ident" id="7200473"><a href="/gostd/database/sql/sql_test.go.html#7170773">closeDB</a></span><span class="op" id="7200480">(</span><span class="ident" id="7200481"><a href="/gostd/database/sql/sql_test.go.html#7200420">t</a></span><span class="op" id="7200482">,</span>&nbsp;<span class="ident" id="7200484"><a href="/gostd/database/sql/sql_test.go.html#7200437">db</a></span><span class="op" id="7200486">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7200490"><a href="/gostd/database/sql/sql_test.go.html#7200437">db</a></span><span class="op" id="7200492">.</span><span class="ident" id="7200493"><a href="/gostd/database/sql/sql.go.html#5215871">SetMaxIdleConns</a></span><span class="op" id="7200508">(</span><span class="num" id="7200509">0</span><span class="op" id="7200510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7200513"><a href="/gostd/database/sql/fakedb_test.go.html#7154427">setStrictFakeConnClose</a></span><span class="op" id="7200535">(</span><span class="ident" id="7200536"><a href="/gostd/database/sql/sql_test.go.html#7200420">t</a></span><span class="op" id="7200537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7200540">defer</span>&nbsp;<span class="ident" id="7200546"><a href="/gostd/database/sql/fakedb_test.go.html#7154427">setStrictFakeConnClose</a></span><span class="op" id="7200568">(</span><span class="builtintype" id="7200569">nil</span><span class="op" id="7200572">)</span><br>
<span class="lineno">1310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7200576">_</span><span class="op" id="7200577">,</span>&nbsp;<span class="ident" id="7200579">err</span>&nbsp;<span class="op" id="7200583">:=</span>&nbsp;<span class="ident" id="7200586"><a href="/gostd/database/sql/sql_test.go.html#7200437">db</a></span><span class="op" id="7200588">.</span><span class="ident" id="7200589"><a href="/gostd/database/sql/sql.go.html#5225993">Query</a></span><span class="op" id="7200594">(</span><span class="string" id="7200595">&#34;SELECT|non_existent|name|&#34;</span><span class="op" id="7200622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7200625">if</span>&nbsp;<span class="ident" id="7200628"><a href="/gostd/database/sql/sql_test.go.html#7200579">err</a></span>&nbsp;<span class="op" id="7200632">==</span>&nbsp;<span class="builtintype" id="7200635">nil</span>&nbsp;<span class="op" id="7200639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7200643"><a href="/gostd/database/sql/sql_test.go.html#7200420">t</a></span><span class="op" id="7200644">.</span><span class="ident" id="7200645"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="7200650">(</span><span class="string" id="7200651">&#34;Quering&nbsp;non-existent&nbsp;table&nbsp;should&nbsp;fail&#34;</span><span class="op" id="7200691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7200694">}</span><br>
<span class="lineno">1315</span><span class="op" id="7200696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7200699">//&nbsp;golang.org/issue/5781</span><br>
<span class="lineno"></span><span class="keyword" id="7200724">func</span>&nbsp;<span class="ident" id="7200729">TestErrBadConnReconnect</span><span class="op" id="7200752">(</span><span class="ident" id="7200753">t</span>&nbsp;<span class="op" id="7200755">*</span><span class="ident" id="7200756"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7200763">.</span><span class="ident" id="7200764"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7200765">)</span>&nbsp;<span class="op" id="7200767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7200770">db</span>&nbsp;<span class="op" id="7200773">:=</span>&nbsp;<span class="ident" id="7200776"><a href="/gostd/database/sql/sql_test.go.html#7169849">newTestDB</a></span><span class="op" id="7200785">(</span><span class="ident" id="7200786"><a href="/gostd/database/sql/sql_test.go.html#7200753">t</a></span><span class="op" id="7200787">,</span>&nbsp;<span class="string" id="7200789">&#34;foo&#34;</span><span class="op" id="7200794">)</span><br>
<span class="lineno">1320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7200797">defer</span>&nbsp;<span class="ident" id="7200803"><a href="/gostd/database/sql/sql_test.go.html#7170773">closeDB</a></span><span class="op" id="7200810">(</span><span class="ident" id="7200811"><a href="/gostd/database/sql/sql_test.go.html#7200753">t</a></span><span class="op" id="7200812">,</span>&nbsp;<span class="ident" id="7200814"><a href="/gostd/database/sql/sql_test.go.html#7200770">db</a></span><span class="op" id="7200816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7200819"><a href="/gostd/database/sql/sql_test.go.html#7170605">exec</a></span><span class="op" id="7200823">(</span><span class="ident" id="7200824"><a href="/gostd/database/sql/sql_test.go.html#7200753">t</a></span><span class="op" id="7200825">,</span>&nbsp;<span class="ident" id="7200827"><a href="/gostd/database/sql/sql_test.go.html#7200770">db</a></span><span class="op" id="7200829">,</span>&nbsp;<span class="string" id="7200831">&#34;CREATE|t1|name=string,age=int32,dead=bool&#34;</span><span class="op" id="7200874">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7200878">simulateBadConn</span>&nbsp;<span class="op" id="7200894">:=</span>&nbsp;<span class="keyword" id="7200897">func</span><span class="op" id="7200901">(</span><span class="ident" id="7200902">name</span>&nbsp;<span class="builtintype" id="7200907">string</span><span class="op" id="7200913">,</span>&nbsp;<span class="ident" id="7200915">hook</span>&nbsp;<span class="op" id="7200920">*</span><span class="keyword" id="7200921">func</span><span class="op" id="7200925">(</span><span class="op" id="7200926">)</span>&nbsp;<span class="builtintype" id="7200928">bool</span><span class="op" id="7200932">,</span>&nbsp;<span class="ident" id="7200934">op</span>&nbsp;<span class="keyword" id="7200937">func</span><span class="op" id="7200941">(</span><span class="op" id="7200942">)</span>&nbsp;<span class="builtintype" id="7200944">error</span><span class="op" id="7200949">)</span>&nbsp;<span class="op" id="7200951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7200955">broken</span><span class="op" id="7200961">,</span>&nbsp;<span class="ident" id="7200963">retried</span>&nbsp;<span class="op" id="7200971">:=</span>&nbsp;<span class="builtintype" id="7200974">false</span><span class="op" id="7200979">,</span>&nbsp;<span class="builtintype" id="7200981">false</span><br>
<span class="lineno">1325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7200989">numOpen</span>&nbsp;<span class="op" id="7200997">:=</span>&nbsp;<span class="ident" id="7201000"><a href="/gostd/database/sql/sql_test.go.html#7200770">db</a></span><span class="op" id="7201002">.</span><span class="ident" id="7201003"><a href="/gostd/database/sql/sql.go.html#5207324">numOpen</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7201014">//&nbsp;simulate&nbsp;a&nbsp;broken&nbsp;connection&nbsp;on&nbsp;the&nbsp;first&nbsp;try</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7201065">*</span><span class="ident" id="7201066"><a href="/gostd/database/sql/sql_test.go.html#7200915">hook</a></span>&nbsp;<span class="op" id="7201071">=</span>&nbsp;<span class="keyword" id="7201073">func</span><span class="op" id="7201077">(</span><span class="op" id="7201078">)</span>&nbsp;<span class="builtintype" id="7201080">bool</span>&nbsp;<span class="op" id="7201085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7201090">if</span>&nbsp;<span class="op" id="7201093">!</span><span class="ident" id="7201094"><a href="/gostd/database/sql/sql_test.go.html#7200955">broken</a></span>&nbsp;<span class="op" id="7201101">{</span><br>
<span class="lineno">1330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7201107"><a href="/gostd/database/sql/sql_test.go.html#7200955">broken</a></span>&nbsp;<span class="op" id="7201114">=</span>&nbsp;<span class="builtintype" id="7201116">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7201125">return</span>&nbsp;<span class="builtintype" id="7201132">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7201140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7201145"><a href="/gostd/database/sql/sql_test.go.html#7200963">retried</a></span>&nbsp;<span class="op" id="7201153">=</span>&nbsp;<span class="builtintype" id="7201155">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7201163">return</span>&nbsp;<span class="builtintype" id="7201170">false</span><br>
<span class="lineno">1335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7201178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7201183">if</span>&nbsp;<span class="ident" id="7201186">err</span>&nbsp;<span class="op" id="7201190">:=</span>&nbsp;<span class="ident" id="7201193"><a href="/gostd/database/sql/sql_test.go.html#7200934">op</a></span><span class="op" id="7201195">(</span><span class="op" id="7201196">)</span><span class="op" id="7201197">;</span>&nbsp;<span class="ident" id="7201199"><a href="/gostd/database/sql/sql_test.go.html#7201186">err</a></span>&nbsp;<span class="op" id="7201203">!=</span>&nbsp;<span class="builtintype" id="7201206">nil</span>&nbsp;<span class="op" id="7201210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7201215"><a href="/gostd/database/sql/sql_test.go.html#7200753">t</a></span><span class="op" id="7201216">.</span><span class="ident" id="7201217"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7201223">(</span><span class="ident" id="7201224"><a href="/gostd/database/sql/sql_test.go.html#7200902">name</a></span><span class="op" id="7201228">+</span><span class="string" id="7201229">&#34;:&nbsp;%v&#34;</span><span class="op" id="7201235">,</span>&nbsp;<span class="ident" id="7201237"><a href="/gostd/database/sql/sql_test.go.html#7201186">err</a></span><span class="op" id="7201240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7201245">return</span><br>
<span class="lineno">1340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7201254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7201259">if</span>&nbsp;<span class="op" id="7201262">!</span><span class="ident" id="7201263"><a href="/gostd/database/sql/sql_test.go.html#7200955">broken</a></span>&nbsp;<span class="op" id="7201270">||</span>&nbsp;<span class="op" id="7201273">!</span><span class="ident" id="7201274"><a href="/gostd/database/sql/sql_test.go.html#7200963">retried</a></span>&nbsp;<span class="op" id="7201282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7201287"><a href="/gostd/database/sql/sql_test.go.html#7200753">t</a></span><span class="op" id="7201288">.</span><span class="ident" id="7201289"><a href="/gostd/testing/testing.go.html#5479963">Error</a></span><span class="op" id="7201294">(</span><span class="ident" id="7201295"><a href="/gostd/database/sql/sql_test.go.html#7200902">name</a></span>&nbsp;<span class="op" id="7201300">+</span>&nbsp;<span class="string" id="7201302">&#34;:&nbsp;Failed&nbsp;to&nbsp;simulate&nbsp;broken&nbsp;connection&#34;</span><span class="op" id="7201342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7201346">}</span><br>
<span class="lineno">1345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7201350">*</span><span class="ident" id="7201351"><a href="/gostd/database/sql/sql_test.go.html#7200915">hook</a></span>&nbsp;<span class="op" id="7201356">=</span>&nbsp;<span class="builtintype" id="7201358">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7201365">if</span>&nbsp;<span class="ident" id="7201368"><a href="/gostd/database/sql/sql_test.go.html#7200989">numOpen</a></span>&nbsp;<span class="op" id="7201376">!=</span>&nbsp;<span class="ident" id="7201379"><a href="/gostd/database/sql/sql_test.go.html#7200770">db</a></span><span class="op" id="7201381">.</span><span class="ident" id="7201382"><a href="/gostd/database/sql/sql.go.html#5207324">numOpen</a></span>&nbsp;<span class="op" id="7201390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7201395"><a href="/gostd/database/sql/sql_test.go.html#7200753">t</a></span><span class="op" id="7201396">.</span><span class="ident" id="7201397"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7201403">(</span><span class="ident" id="7201404"><a href="/gostd/database/sql/sql_test.go.html#7200902">name</a></span><span class="op" id="7201408">+</span><span class="string" id="7201409">&#34;:&nbsp;leaked&nbsp;%d&nbsp;connection(s)!&#34;</span><span class="op" id="7201437">,</span>&nbsp;<span class="ident" id="7201439"><a href="/gostd/database/sql/sql_test.go.html#7200770">db</a></span><span class="op" id="7201441">.</span><span class="ident" id="7201442"><a href="/gostd/database/sql/sql.go.html#5207324">numOpen</a></span><span class="op" id="7201449">-</span><span class="ident" id="7201450"><a href="/gostd/database/sql/sql_test.go.html#7200989">numOpen</a></span><span class="op" id="7201457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7201462"><a href="/gostd/database/sql/sql_test.go.html#7200989">numOpen</a></span>&nbsp;<span class="op" id="7201470">=</span>&nbsp;<span class="ident" id="7201472"><a href="/gostd/database/sql/sql_test.go.html#7200770">db</a></span><span class="op" id="7201474">.</span><span class="ident" id="7201475"><a href="/gostd/database/sql/sql.go.html#5207324">numOpen</a></span><br>
<span class="lineno">1350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7201485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7201488">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7201492">//&nbsp;db.Exec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7201504">dbExec</span>&nbsp;<span class="op" id="7201511">:=</span>&nbsp;<span class="keyword" id="7201514">func</span><span class="op" id="7201518">(</span><span class="op" id="7201519">)</span>&nbsp;<span class="builtintype" id="7201521">error</span>&nbsp;<span class="op" id="7201527">{</span><br>
<span class="lineno">1355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7201531">_</span><span class="op" id="7201532">,</span>&nbsp;<span class="ident" id="7201534">err</span>&nbsp;<span class="op" id="7201538">:=</span>&nbsp;<span class="ident" id="7201541"><a href="/gostd/database/sql/sql_test.go.html#7200770">db</a></span><span class="op" id="7201543">.</span><span class="ident" id="7201544"><a href="/gostd/database/sql/sql.go.html#5224928">Exec</a></span><span class="op" id="7201548">(</span><span class="string" id="7201549">&#34;INSERT|t1|name=?,age=?,dead=?&#34;</span><span class="op" id="7201580">,</span>&nbsp;<span class="string" id="7201582">&#34;Gordon&#34;</span><span class="op" id="7201590">,</span>&nbsp;<span class="num" id="7201592">3</span><span class="op" id="7201593">,</span>&nbsp;<span class="builtintype" id="7201595">true</span><span class="op" id="7201599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7201603">return</span>&nbsp;<span class="ident" id="7201610"><a href="/gostd/database/sql/sql_test.go.html#7201534">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7201615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7201618"><a href="/gostd/database/sql/sql_test.go.html#7200878">simulateBadConn</a></span><span class="op" id="7201633">(</span><span class="string" id="7201634">&#34;db.Exec&nbsp;prepare&#34;</span><span class="op" id="7201651">,</span>&nbsp;<span class="op" id="7201653">&amp;</span><span class="ident" id="7201654"><a href="/gostd/database/sql/fakedb_test.go.html#7159825">hookPrepareBadConn</a></span><span class="op" id="7201672">,</span>&nbsp;<span class="ident" id="7201674"><a href="/gostd/database/sql/sql_test.go.html#7201504">dbExec</a></span><span class="op" id="7201680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7201683"><a href="/gostd/database/sql/sql_test.go.html#7200878">simulateBadConn</a></span><span class="op" id="7201698">(</span><span class="string" id="7201699">&#34;db.Exec&nbsp;exec&#34;</span><span class="op" id="7201713">,</span>&nbsp;<span class="op" id="7201715">&amp;</span><span class="ident" id="7201716"><a href="/gostd/database/sql/fakedb_test.go.html#7161354">hookExecBadConn</a></span><span class="op" id="7201731">,</span>&nbsp;<span class="ident" id="7201733"><a href="/gostd/database/sql/sql_test.go.html#7201504">dbExec</a></span><span class="op" id="7201739">)</span><br>
<span class="lineno">1360</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7201743">//&nbsp;db.Query</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7201756">dbQuery</span>&nbsp;<span class="op" id="7201764">:=</span>&nbsp;<span class="keyword" id="7201767">func</span><span class="op" id="7201771">(</span><span class="op" id="7201772">)</span>&nbsp;<span class="builtintype" id="7201774">error</span>&nbsp;<span class="op" id="7201780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7201784">rows</span><span class="op" id="7201788">,</span>&nbsp;<span class="ident" id="7201790">err</span>&nbsp;<span class="op" id="7201794">:=</span>&nbsp;<span class="ident" id="7201797"><a href="/gostd/database/sql/sql_test.go.html#7200770">db</a></span><span class="op" id="7201799">.</span><span class="ident" id="7201800"><a href="/gostd/database/sql/sql.go.html#5225993">Query</a></span><span class="op" id="7201805">(</span><span class="string" id="7201806">&#34;SELECT|t1|age,name|&#34;</span><span class="op" id="7201827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7201831">if</span>&nbsp;<span class="ident" id="7201834"><a href="/gostd/database/sql/sql_test.go.html#7201790">err</a></span>&nbsp;<span class="op" id="7201838">==</span>&nbsp;<span class="builtintype" id="7201841">nil</span>&nbsp;<span class="op" id="7201845">{</span><br>
<span class="lineno">1365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7201850"><a href="/gostd/database/sql/sql_test.go.html#7201790">err</a></span>&nbsp;<span class="op" id="7201854">=</span>&nbsp;<span class="ident" id="7201856"><a href="/gostd/database/sql/sql_test.go.html#7201784">rows</a></span><span class="op" id="7201860">.</span><span class="ident" id="7201861"><a href="/gostd/database/sql/sql.go.html#5244447">Close</a></span><span class="op" id="7201866">(</span><span class="op" id="7201867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7201871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7201875">return</span>&nbsp;<span class="ident" id="7201882"><a href="/gostd/database/sql/sql_test.go.html#7201790">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7201887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7201890"><a href="/gostd/database/sql/sql_test.go.html#7200878">simulateBadConn</a></span><span class="op" id="7201905">(</span><span class="string" id="7201906">&#34;db.Query&nbsp;prepare&#34;</span><span class="op" id="7201924">,</span>&nbsp;<span class="op" id="7201926">&amp;</span><span class="ident" id="7201927"><a href="/gostd/database/sql/fakedb_test.go.html#7159825">hookPrepareBadConn</a></span><span class="op" id="7201945">,</span>&nbsp;<span class="ident" id="7201947"><a href="/gostd/database/sql/sql_test.go.html#7201756">dbQuery</a></span><span class="op" id="7201954">)</span><br>
<span class="lineno">1370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7201957"><a href="/gostd/database/sql/sql_test.go.html#7200878">simulateBadConn</a></span><span class="op" id="7201972">(</span><span class="string" id="7201973">&#34;db.Query&nbsp;query&#34;</span><span class="op" id="7201989">,</span>&nbsp;<span class="op" id="7201991">&amp;</span><span class="ident" id="7201992"><a href="/gostd/database/sql/fakedb_test.go.html#7163466">hookQueryBadConn</a></span><span class="op" id="7202008">,</span>&nbsp;<span class="ident" id="7202010"><a href="/gostd/database/sql/sql_test.go.html#7201756">dbQuery</a></span><span class="op" id="7202017">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7202021">//&nbsp;db.Prepare</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7202036"><a href="/gostd/database/sql/sql_test.go.html#7200878">simulateBadConn</a></span><span class="op" id="7202051">(</span><span class="string" id="7202052">&#34;db.Prepare&#34;</span><span class="op" id="7202064">,</span>&nbsp;<span class="op" id="7202066">&amp;</span><span class="ident" id="7202067"><a href="/gostd/database/sql/fakedb_test.go.html#7159825">hookPrepareBadConn</a></span><span class="op" id="7202085">,</span>&nbsp;<span class="keyword" id="7202087">func</span><span class="op" id="7202091">(</span><span class="op" id="7202092">)</span>&nbsp;<span class="builtintype" id="7202094">error</span>&nbsp;<span class="op" id="7202100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7202104">stmt</span><span class="op" id="7202108">,</span>&nbsp;<span class="ident" id="7202110">err</span>&nbsp;<span class="op" id="7202114">:=</span>&nbsp;<span class="ident" id="7202117"><a href="/gostd/database/sql/sql_test.go.html#7200770">db</a></span><span class="op" id="7202119">.</span><span class="ident" id="7202120"><a href="/gostd/database/sql/sql.go.html#5223860">Prepare</a></span><span class="op" id="7202127">(</span><span class="string" id="7202128">&#34;INSERT|t1|name=?,age=?,dead=?&#34;</span><span class="op" id="7202159">)</span><br>
<span class="lineno">1375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7202163">if</span>&nbsp;<span class="ident" id="7202166"><a href="/gostd/database/sql/sql_test.go.html#7202110">err</a></span>&nbsp;<span class="op" id="7202170">!=</span>&nbsp;<span class="builtintype" id="7202173">nil</span>&nbsp;<span class="op" id="7202177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7202182">return</span>&nbsp;<span class="ident" id="7202189"><a href="/gostd/database/sql/sql_test.go.html#7202110">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7202195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7202199"><a href="/gostd/database/sql/sql_test.go.html#7202104">stmt</a></span><span class="op" id="7202203">.</span><span class="ident" id="7202204"><a href="/gostd/database/sql/sql.go.html#5240529">Close</a></span><span class="op" id="7202209">(</span><span class="op" id="7202210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7202214">return</span>&nbsp;<span class="builtintype" id="7202221">nil</span><br>
<span class="lineno">1380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7202226">}</span><span class="op" id="7202227">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7202231">//&nbsp;Provide&nbsp;a&nbsp;way&nbsp;to&nbsp;force&nbsp;a&nbsp;re-prepare&nbsp;of&nbsp;a&nbsp;statement&nbsp;on&nbsp;next&nbsp;execution</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7202304">forcePrepare</span>&nbsp;<span class="op" id="7202317">:=</span>&nbsp;<span class="keyword" id="7202320">func</span><span class="op" id="7202324">(</span><span class="ident" id="7202325">stmt</span>&nbsp;<span class="op" id="7202330">*</span><span class="ident" id="7202331"><a href="/gostd/database/sql/sql.go.html#5234451">Stmt</a></span><span class="op" id="7202335">)</span>&nbsp;<span class="op" id="7202337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7202341"><a href="/gostd/database/sql/sql_test.go.html#7202325">stmt</a></span><span class="op" id="7202345">.</span><span class="ident" id="7202346"><a href="/gostd/database/sql/sql.go.html#5235080">css</a></span>&nbsp;<span class="op" id="7202350">=</span>&nbsp;<span class="builtintype" id="7202352">nil</span><br>
<span class="lineno">1385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7202357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7202361">//&nbsp;stmt.Exec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7202375">stmt1</span><span class="op" id="7202380">,</span>&nbsp;<span class="ident" id="7202382">err</span>&nbsp;<span class="op" id="7202386">:=</span>&nbsp;<span class="ident" id="7202389"><a href="/gostd/database/sql/sql_test.go.html#7200770">db</a></span><span class="op" id="7202391">.</span><span class="ident" id="7202392"><a href="/gostd/database/sql/sql.go.html#5223860">Prepare</a></span><span class="op" id="7202399">(</span><span class="string" id="7202400">&#34;INSERT|t1|name=?,age=?,dead=?&#34;</span><span class="op" id="7202431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7202434">if</span>&nbsp;<span class="ident" id="7202437"><a href="/gostd/database/sql/sql_test.go.html#7202382">err</a></span>&nbsp;<span class="op" id="7202441">!=</span>&nbsp;<span class="builtintype" id="7202444">nil</span>&nbsp;<span class="op" id="7202448">{</span><br>
<span class="lineno">1390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7202452"><a href="/gostd/database/sql/sql_test.go.html#7200753">t</a></span><span class="op" id="7202453">.</span><span class="ident" id="7202454"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7202460">(</span><span class="string" id="7202461">&#34;prepare:&nbsp;%v&#34;</span><span class="op" id="7202474">,</span>&nbsp;<span class="ident" id="7202476"><a href="/gostd/database/sql/sql_test.go.html#7202382">err</a></span><span class="op" id="7202479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7202482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7202485">defer</span>&nbsp;<span class="ident" id="7202491"><a href="/gostd/database/sql/sql_test.go.html#7202375">stmt1</a></span><span class="op" id="7202496">.</span><span class="ident" id="7202497"><a href="/gostd/database/sql/sql.go.html#5240529">Close</a></span><span class="op" id="7202502">(</span><span class="op" id="7202503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7202506">//&nbsp;make&nbsp;sure&nbsp;we&nbsp;must&nbsp;prepare&nbsp;the&nbsp;stmt&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7202551"><a href="/gostd/database/sql/sql_test.go.html#7202304">forcePrepare</a></span><span class="op" id="7202563">(</span><span class="ident" id="7202564"><a href="/gostd/database/sql/sql_test.go.html#7202375">stmt1</a></span><span class="op" id="7202569">)</span><br>
<span class="lineno">1395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7202573">stmtExec</span>&nbsp;<span class="op" id="7202582">:=</span>&nbsp;<span class="keyword" id="7202585">func</span><span class="op" id="7202589">(</span><span class="op" id="7202590">)</span>&nbsp;<span class="builtintype" id="7202592">error</span>&nbsp;<span class="op" id="7202598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7202602">_</span><span class="op" id="7202603">,</span>&nbsp;<span class="ident" id="7202605">err</span>&nbsp;<span class="op" id="7202609">:=</span>&nbsp;<span class="ident" id="7202612"><a href="/gostd/database/sql/sql_test.go.html#7202375">stmt1</a></span><span class="op" id="7202617">.</span><span class="ident" id="7202618"><a href="/gostd/database/sql/sql.go.html#5235241">Exec</a></span><span class="op" id="7202622">(</span><span class="string" id="7202623">&#34;Gopher&#34;</span><span class="op" id="7202631">,</span>&nbsp;<span class="num" id="7202633">3</span><span class="op" id="7202634">,</span>&nbsp;<span class="builtintype" id="7202636">false</span><span class="op" id="7202641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7202645">return</span>&nbsp;<span class="ident" id="7202652"><a href="/gostd/database/sql/sql_test.go.html#7202605">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7202657">}</span><br>
<span class="lineno">1400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7202660"><a href="/gostd/database/sql/sql_test.go.html#7200878">simulateBadConn</a></span><span class="op" id="7202675">(</span><span class="string" id="7202676">&#34;stmt.Exec&nbsp;prepare&#34;</span><span class="op" id="7202695">,</span>&nbsp;<span class="op" id="7202697">&amp;</span><span class="ident" id="7202698"><a href="/gostd/database/sql/fakedb_test.go.html#7159825">hookPrepareBadConn</a></span><span class="op" id="7202716">,</span>&nbsp;<span class="ident" id="7202718"><a href="/gostd/database/sql/sql_test.go.html#7202573">stmtExec</a></span><span class="op" id="7202726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7202729"><a href="/gostd/database/sql/sql_test.go.html#7200878">simulateBadConn</a></span><span class="op" id="7202744">(</span><span class="string" id="7202745">&#34;stmt.Exec&nbsp;exec&#34;</span><span class="op" id="7202761">,</span>&nbsp;<span class="op" id="7202763">&amp;</span><span class="ident" id="7202764"><a href="/gostd/database/sql/fakedb_test.go.html#7161354">hookExecBadConn</a></span><span class="op" id="7202779">,</span>&nbsp;<span class="ident" id="7202781"><a href="/gostd/database/sql/sql_test.go.html#7202573">stmtExec</a></span><span class="op" id="7202789">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7202793">//&nbsp;stmt.Query</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7202808">stmt2</span><span class="op" id="7202813">,</span>&nbsp;<span class="ident" id="7202815"><a href="/gostd/database/sql/sql_test.go.html#7202382">err</a></span>&nbsp;<span class="op" id="7202819">:=</span>&nbsp;<span class="ident" id="7202822"><a href="/gostd/database/sql/sql_test.go.html#7200770">db</a></span><span class="op" id="7202824">.</span><span class="ident" id="7202825"><a href="/gostd/database/sql/sql.go.html#5223860">Prepare</a></span><span class="op" id="7202832">(</span><span class="string" id="7202833">&#34;SELECT|t1|age,name|&#34;</span><span class="op" id="7202854">)</span><br>
<span class="lineno">1405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7202857">if</span>&nbsp;<span class="ident" id="7202860"><a href="/gostd/database/sql/sql_test.go.html#7202382">err</a></span>&nbsp;<span class="op" id="7202864">!=</span>&nbsp;<span class="builtintype" id="7202867">nil</span>&nbsp;<span class="op" id="7202871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7202875"><a href="/gostd/database/sql/sql_test.go.html#7200753">t</a></span><span class="op" id="7202876">.</span><span class="ident" id="7202877"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7202883">(</span><span class="string" id="7202884">&#34;prepare:&nbsp;%v&#34;</span><span class="op" id="7202897">,</span>&nbsp;<span class="ident" id="7202899"><a href="/gostd/database/sql/sql_test.go.html#7202382">err</a></span><span class="op" id="7202902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7202905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7202908">defer</span>&nbsp;<span class="ident" id="7202914"><a href="/gostd/database/sql/sql_test.go.html#7202808">stmt2</a></span><span class="op" id="7202919">.</span><span class="ident" id="7202920"><a href="/gostd/database/sql/sql.go.html#5240529">Close</a></span><span class="op" id="7202925">(</span><span class="op" id="7202926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7202929">//&nbsp;make&nbsp;sure&nbsp;we&nbsp;must&nbsp;prepare&nbsp;the&nbsp;stmt&nbsp;first</span><br>
<span class="lineno">1410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7202974"><a href="/gostd/database/sql/sql_test.go.html#7202304">forcePrepare</a></span><span class="op" id="7202986">(</span><span class="ident" id="7202987"><a href="/gostd/database/sql/sql_test.go.html#7202808">stmt2</a></span><span class="op" id="7202992">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7202996">stmtQuery</span>&nbsp;<span class="op" id="7203006">:=</span>&nbsp;<span class="keyword" id="7203009">func</span><span class="op" id="7203013">(</span><span class="op" id="7203014">)</span>&nbsp;<span class="builtintype" id="7203016">error</span>&nbsp;<span class="op" id="7203022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7203026">rows</span><span class="op" id="7203030">,</span>&nbsp;<span class="ident" id="7203032">err</span>&nbsp;<span class="op" id="7203036">:=</span>&nbsp;<span class="ident" id="7203039"><a href="/gostd/database/sql/sql_test.go.html#7202808">stmt2</a></span><span class="op" id="7203044">.</span><span class="ident" id="7203045"><a href="/gostd/database/sql/sql.go.html#5238423">Query</a></span><span class="op" id="7203050">(</span><span class="op" id="7203051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7203055">if</span>&nbsp;<span class="ident" id="7203058"><a href="/gostd/database/sql/sql_test.go.html#7203032">err</a></span>&nbsp;<span class="op" id="7203062">==</span>&nbsp;<span class="builtintype" id="7203065">nil</span>&nbsp;<span class="op" id="7203069">{</span><br>
<span class="lineno">1415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7203074"><a href="/gostd/database/sql/sql_test.go.html#7203032">err</a></span>&nbsp;<span class="op" id="7203078">=</span>&nbsp;<span class="ident" id="7203080"><a href="/gostd/database/sql/sql_test.go.html#7203026">rows</a></span><span class="op" id="7203084">.</span><span class="ident" id="7203085"><a href="/gostd/database/sql/sql.go.html#5244447">Close</a></span><span class="op" id="7203090">(</span><span class="op" id="7203091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7203095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7203099">return</span>&nbsp;<span class="ident" id="7203106"><a href="/gostd/database/sql/sql_test.go.html#7203032">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7203111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7203114"><a href="/gostd/database/sql/sql_test.go.html#7200878">simulateBadConn</a></span><span class="op" id="7203129">(</span><span class="string" id="7203130">&#34;stmt.Query&nbsp;prepare&#34;</span><span class="op" id="7203150">,</span>&nbsp;<span class="op" id="7203152">&amp;</span><span class="ident" id="7203153"><a href="/gostd/database/sql/fakedb_test.go.html#7159825">hookPrepareBadConn</a></span><span class="op" id="7203171">,</span>&nbsp;<span class="ident" id="7203173"><a href="/gostd/database/sql/sql_test.go.html#7202996">stmtQuery</a></span><span class="op" id="7203182">)</span><br>
<span class="lineno">1420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7203185"><a href="/gostd/database/sql/sql_test.go.html#7200878">simulateBadConn</a></span><span class="op" id="7203200">(</span><span class="string" id="7203201">&#34;stmt.Query&nbsp;exec&#34;</span><span class="op" id="7203218">,</span>&nbsp;<span class="op" id="7203220">&amp;</span><span class="ident" id="7203221"><a href="/gostd/database/sql/fakedb_test.go.html#7163466">hookQueryBadConn</a></span><span class="op" id="7203237">,</span>&nbsp;<span class="ident" id="7203239"><a href="/gostd/database/sql/sql_test.go.html#7202996">stmtQuery</a></span><span class="op" id="7203248">)</span><br>
<span class="lineno"></span><span class="op" id="7203250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7203253">type</span>&nbsp;<span class="ident" id="7203258">concurrentTest</span>&nbsp;<span class="keyword" id="7203273">interface</span>&nbsp;<span class="op" id="7203283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7203286">init</span><span class="op" id="7203290">(</span><span class="ident" id="7203291">t</span>&nbsp;<span class="ident" id="7203293"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7203300">.</span><span class="ident" id="7203301"><a href="/gostd/testing/testing.go.html#5476676">TB</a></span><span class="op" id="7203303">,</span>&nbsp;<span class="ident" id="7203305">db</span>&nbsp;<span class="op" id="7203308">*</span><span class="ident" id="7203309"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="7203311">)</span><br>
<span class="lineno">1425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7203314">finish</span><span class="op" id="7203320">(</span><span class="ident" id="7203321">t</span>&nbsp;<span class="ident" id="7203323"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7203330">.</span><span class="ident" id="7203331"><a href="/gostd/testing/testing.go.html#5476676">TB</a></span><span class="op" id="7203333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7203336">test</span><span class="op" id="7203340">(</span><span class="ident" id="7203341">t</span>&nbsp;<span class="ident" id="7203343"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7203350">.</span><span class="ident" id="7203351"><a href="/gostd/testing/testing.go.html#5476676">TB</a></span><span class="op" id="7203353">)</span>&nbsp;<span class="builtintype" id="7203355">error</span><br>
<span class="lineno"></span><span class="op" id="7203361">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7203364">type</span>&nbsp;<span class="ident" id="7203369">concurrentDBQueryTest</span>&nbsp;<span class="keyword" id="7203391">struct</span>&nbsp;<span class="op" id="7203398">{</span><br>
<span class="lineno">1430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7203401">db</span>&nbsp;<span class="op" id="7203404">*</span><span class="ident" id="7203405"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><br>
<span class="lineno"></span><span class="op" id="7203408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7203411">func</span>&nbsp;<span class="op" id="7203416">(</span><span class="ident" id="7203417">c</span>&nbsp;<span class="op" id="7203419">*</span><span class="ident" id="7203420"><a href="/gostd/database/sql/sql_test.go.html#7203369">concurrentDBQueryTest</a></span><span class="op" id="7203441">)</span>&nbsp;<span class="ident" id="7203443">init</span><span class="op" id="7203447">(</span><span class="ident" id="7203448">t</span>&nbsp;<span class="ident" id="7203450"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7203457">.</span><span class="ident" id="7203458"><a href="/gostd/testing/testing.go.html#5476676">TB</a></span><span class="op" id="7203460">,</span>&nbsp;<span class="ident" id="7203462">db</span>&nbsp;<span class="op" id="7203465">*</span><span class="ident" id="7203466"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="7203468">)</span>&nbsp;<span class="op" id="7203470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7203473"><a href="/gostd/database/sql/sql_test.go.html#7203417">c</a></span><span class="op" id="7203474">.</span><span class="ident" id="7203475"><a href="/gostd/database/sql/sql_test.go.html#7203401">db</a></span>&nbsp;<span class="op" id="7203478">=</span>&nbsp;<span class="ident" id="7203480"><a href="/gostd/database/sql/sql_test.go.html#7203462">db</a></span><br>
<span class="lineno">1435</span><span class="op" id="7203483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7203486">func</span>&nbsp;<span class="op" id="7203491">(</span><span class="ident" id="7203492">c</span>&nbsp;<span class="op" id="7203494">*</span><span class="ident" id="7203495"><a href="/gostd/database/sql/sql_test.go.html#7203369">concurrentDBQueryTest</a></span><span class="op" id="7203516">)</span>&nbsp;<span class="ident" id="7203518">finish</span><span class="op" id="7203524">(</span><span class="ident" id="7203525">t</span>&nbsp;<span class="ident" id="7203527"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7203534">.</span><span class="ident" id="7203535"><a href="/gostd/testing/testing.go.html#5476676">TB</a></span><span class="op" id="7203537">)</span>&nbsp;<span class="op" id="7203539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7203542"><a href="/gostd/database/sql/sql_test.go.html#7203492">c</a></span><span class="op" id="7203543">.</span><span class="ident" id="7203544"><a href="/gostd/database/sql/sql_test.go.html#7203401">db</a></span>&nbsp;<span class="op" id="7203547">=</span>&nbsp;<span class="builtintype" id="7203549">nil</span><br>
<span class="lineno"></span><span class="op" id="7203553">}</span><br>
<span class="lineno">1440</span><br>
<span class="lineno"></span><span class="keyword" id="7203556">func</span>&nbsp;<span class="op" id="7203561">(</span><span class="ident" id="7203562">c</span>&nbsp;<span class="op" id="7203564">*</span><span class="ident" id="7203565"><a href="/gostd/database/sql/sql_test.go.html#7203369">concurrentDBQueryTest</a></span><span class="op" id="7203586">)</span>&nbsp;<span class="ident" id="7203588">test</span><span class="op" id="7203592">(</span><span class="ident" id="7203593">t</span>&nbsp;<span class="ident" id="7203595"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7203602">.</span><span class="ident" id="7203603"><a href="/gostd/testing/testing.go.html#5476676">TB</a></span><span class="op" id="7203605">)</span>&nbsp;<span class="builtintype" id="7203607">error</span>&nbsp;<span class="op" id="7203613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7203616">rows</span><span class="op" id="7203620">,</span>&nbsp;<span class="ident" id="7203622">err</span>&nbsp;<span class="op" id="7203626">:=</span>&nbsp;<span class="ident" id="7203629"><a href="/gostd/database/sql/sql_test.go.html#7203562">c</a></span><span class="op" id="7203630">.</span><span class="ident" id="7203631"><a href="/gostd/database/sql/sql_test.go.html#7203401">db</a></span><span class="op" id="7203633">.</span><span class="ident" id="7203634"><a href="/gostd/database/sql/sql.go.html#5225993">Query</a></span><span class="op" id="7203639">(</span><span class="string" id="7203640">&#34;SELECT|people|name|&#34;</span><span class="op" id="7203661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7203664">if</span>&nbsp;<span class="ident" id="7203667"><a href="/gostd/database/sql/sql_test.go.html#7203622">err</a></span>&nbsp;<span class="op" id="7203671">!=</span>&nbsp;<span class="builtintype" id="7203674">nil</span>&nbsp;<span class="op" id="7203678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7203682"><a href="/gostd/database/sql/sql_test.go.html#7203593">t</a></span><span class="op" id="7203683">.</span><span class="ident" id="7203684"><a href="/gostd/testing/testing.go.html#5476692">Error</a></span><span class="op" id="7203689">(</span><span class="ident" id="7203690"><a href="/gostd/database/sql/sql_test.go.html#7203622">err</a></span><span class="op" id="7203693">)</span><br>
<span class="lineno">1445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7203697">return</span>&nbsp;<span class="ident" id="7203704"><a href="/gostd/database/sql/sql_test.go.html#7203622">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7203709">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7203712">var</span>&nbsp;<span class="ident" id="7203716">name</span>&nbsp;<span class="builtintype" id="7203721">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7203729">for</span>&nbsp;<span class="ident" id="7203733"><a href="/gostd/database/sql/sql_test.go.html#7203616">rows</a></span><span class="op" id="7203737">.</span><span class="ident" id="7203738"><a href="/gostd/database/sql/sql.go.html#5242163">Next</a></span><span class="op" id="7203742">(</span><span class="op" id="7203743">)</span>&nbsp;<span class="op" id="7203745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7203749"><a href="/gostd/database/sql/sql_test.go.html#7203616">rows</a></span><span class="op" id="7203753">.</span><span class="ident" id="7203754"><a href="/gostd/database/sql/sql.go.html#5243651">Scan</a></span><span class="op" id="7203758">(</span><span class="op" id="7203759">&amp;</span><span class="ident" id="7203760"><a href="/gostd/database/sql/sql_test.go.html#7203716">name</a></span><span class="op" id="7203764">)</span><br>
<span class="lineno">1450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7203767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7203770"><a href="/gostd/database/sql/sql_test.go.html#7203616">rows</a></span><span class="op" id="7203774">.</span><span class="ident" id="7203775"><a href="/gostd/database/sql/sql.go.html#5244447">Close</a></span><span class="op" id="7203780">(</span><span class="op" id="7203781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7203784">return</span>&nbsp;<span class="builtintype" id="7203791">nil</span><br>
<span class="lineno"></span><span class="op" id="7203795">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1455</span><span class="keyword" id="7203798">type</span>&nbsp;<span class="ident" id="7203803">concurrentDBExecTest</span>&nbsp;<span class="keyword" id="7203824">struct</span>&nbsp;<span class="op" id="7203831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7203834">db</span>&nbsp;<span class="op" id="7203837">*</span><span class="ident" id="7203838"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><br>
<span class="lineno"></span><span class="op" id="7203841">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7203844">func</span>&nbsp;<span class="op" id="7203849">(</span><span class="ident" id="7203850">c</span>&nbsp;<span class="op" id="7203852">*</span><span class="ident" id="7203853"><a href="/gostd/database/sql/sql_test.go.html#7203803">concurrentDBExecTest</a></span><span class="op" id="7203873">)</span>&nbsp;<span class="ident" id="7203875">init</span><span class="op" id="7203879">(</span><span class="ident" id="7203880">t</span>&nbsp;<span class="ident" id="7203882"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7203889">.</span><span class="ident" id="7203890"><a href="/gostd/testing/testing.go.html#5476676">TB</a></span><span class="op" id="7203892">,</span>&nbsp;<span class="ident" id="7203894">db</span>&nbsp;<span class="op" id="7203897">*</span><span class="ident" id="7203898"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="7203900">)</span>&nbsp;<span class="op" id="7203902">{</span><br>
<span class="lineno">1460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7203905"><a href="/gostd/database/sql/sql_test.go.html#7203850">c</a></span><span class="op" id="7203906">.</span><span class="ident" id="7203907"><a href="/gostd/database/sql/sql_test.go.html#7203834">db</a></span>&nbsp;<span class="op" id="7203910">=</span>&nbsp;<span class="ident" id="7203912"><a href="/gostd/database/sql/sql_test.go.html#7203894">db</a></span><br>
<span class="lineno"></span><span class="op" id="7203915">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7203918">func</span>&nbsp;<span class="op" id="7203923">(</span><span class="ident" id="7203924">c</span>&nbsp;<span class="op" id="7203926">*</span><span class="ident" id="7203927"><a href="/gostd/database/sql/sql_test.go.html#7203803">concurrentDBExecTest</a></span><span class="op" id="7203947">)</span>&nbsp;<span class="ident" id="7203949">finish</span><span class="op" id="7203955">(</span><span class="ident" id="7203956">t</span>&nbsp;<span class="ident" id="7203958"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7203965">.</span><span class="ident" id="7203966"><a href="/gostd/testing/testing.go.html#5476676">TB</a></span><span class="op" id="7203968">)</span>&nbsp;<span class="op" id="7203970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7203973"><a href="/gostd/database/sql/sql_test.go.html#7203924">c</a></span><span class="op" id="7203974">.</span><span class="ident" id="7203975"><a href="/gostd/database/sql/sql_test.go.html#7203834">db</a></span>&nbsp;<span class="op" id="7203978">=</span>&nbsp;<span class="builtintype" id="7203980">nil</span><br>
<span class="lineno">1465</span><span class="op" id="7203984">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7203987">func</span>&nbsp;<span class="op" id="7203992">(</span><span class="ident" id="7203993">c</span>&nbsp;<span class="op" id="7203995">*</span><span class="ident" id="7203996"><a href="/gostd/database/sql/sql_test.go.html#7203803">concurrentDBExecTest</a></span><span class="op" id="7204016">)</span>&nbsp;<span class="ident" id="7204018">test</span><span class="op" id="7204022">(</span><span class="ident" id="7204023">t</span>&nbsp;<span class="ident" id="7204025"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7204032">.</span><span class="ident" id="7204033"><a href="/gostd/testing/testing.go.html#5476676">TB</a></span><span class="op" id="7204035">)</span>&nbsp;<span class="builtintype" id="7204037">error</span>&nbsp;<span class="op" id="7204043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7204046">_</span><span class="op" id="7204047">,</span>&nbsp;<span class="ident" id="7204049">err</span>&nbsp;<span class="op" id="7204053">:=</span>&nbsp;<span class="ident" id="7204056"><a href="/gostd/database/sql/sql_test.go.html#7203993">c</a></span><span class="op" id="7204057">.</span><span class="ident" id="7204058"><a href="/gostd/database/sql/sql_test.go.html#7203834">db</a></span><span class="op" id="7204060">.</span><span class="ident" id="7204061"><a href="/gostd/database/sql/sql.go.html#5224928">Exec</a></span><span class="op" id="7204065">(</span><span class="string" id="7204066">&#34;NOSERT|people|name=Chris,age=?,photo=CPHOTO,bdate=?&#34;</span><span class="op" id="7204119">,</span>&nbsp;<span class="num" id="7204121">3</span><span class="op" id="7204122">,</span>&nbsp;<span class="ident" id="7204124"><a href="/gostd/database/sql/sql_test.go.html#7169803">chrisBirthday</a></span><span class="op" id="7204137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7204140">if</span>&nbsp;<span class="ident" id="7204143"><a href="/gostd/database/sql/sql_test.go.html#7204049">err</a></span>&nbsp;<span class="op" id="7204147">!=</span>&nbsp;<span class="builtintype" id="7204150">nil</span>&nbsp;<span class="op" id="7204154">{</span><br>
<span class="lineno">1470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7204158"><a href="/gostd/database/sql/sql_test.go.html#7204023">t</a></span><span class="op" id="7204159">.</span><span class="ident" id="7204160"><a href="/gostd/testing/testing.go.html#5476692">Error</a></span><span class="op" id="7204165">(</span><span class="ident" id="7204166"><a href="/gostd/database/sql/sql_test.go.html#7204049">err</a></span><span class="op" id="7204169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7204173">return</span>&nbsp;<span class="ident" id="7204180"><a href="/gostd/database/sql/sql_test.go.html#7204049">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7204185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7204188">return</span>&nbsp;<span class="builtintype" id="7204195">nil</span><br>
<span class="lineno"></span><span class="op" id="7204199">}</span><br>
<span class="lineno">1475</span><br>
<span class="lineno"></span><span class="keyword" id="7204202">type</span>&nbsp;<span class="ident" id="7204207">concurrentStmtQueryTest</span>&nbsp;<span class="keyword" id="7204231">struct</span>&nbsp;<span class="op" id="7204238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7204241">db</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7204246">*</span><span class="ident" id="7204247"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7204251">stmt</span>&nbsp;<span class="op" id="7204256">*</span><span class="ident" id="7204257"><a href="/gostd/database/sql/sql.go.html#5234451">Stmt</a></span><br>
<span class="lineno"></span><span class="op" id="7204262">}</span><br>
<span class="lineno">1480</span><br>
<span class="lineno"></span><span class="keyword" id="7204265">func</span>&nbsp;<span class="op" id="7204270">(</span><span class="ident" id="7204271">c</span>&nbsp;<span class="op" id="7204273">*</span><span class="ident" id="7204274"><a href="/gostd/database/sql/sql_test.go.html#7204207">concurrentStmtQueryTest</a></span><span class="op" id="7204297">)</span>&nbsp;<span class="ident" id="7204299">init</span><span class="op" id="7204303">(</span><span class="ident" id="7204304">t</span>&nbsp;<span class="ident" id="7204306"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7204313">.</span><span class="ident" id="7204314"><a href="/gostd/testing/testing.go.html#5476676">TB</a></span><span class="op" id="7204316">,</span>&nbsp;<span class="ident" id="7204318">db</span>&nbsp;<span class="op" id="7204321">*</span><span class="ident" id="7204322"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="7204324">)</span>&nbsp;<span class="op" id="7204326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7204329"><a href="/gostd/database/sql/sql_test.go.html#7204271">c</a></span><span class="op" id="7204330">.</span><span class="ident" id="7204331"><a href="/gostd/database/sql/sql_test.go.html#7204241">db</a></span>&nbsp;<span class="op" id="7204334">=</span>&nbsp;<span class="ident" id="7204336"><a href="/gostd/database/sql/sql_test.go.html#7204318">db</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7204340">var</span>&nbsp;<span class="ident" id="7204344">err</span>&nbsp;<span class="builtintype" id="7204348">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7204355"><a href="/gostd/database/sql/sql_test.go.html#7204271">c</a></span><span class="op" id="7204356">.</span><span class="ident" id="7204357"><a href="/gostd/database/sql/sql_test.go.html#7204251">stmt</a></span><span class="op" id="7204361">,</span>&nbsp;<span class="ident" id="7204363"><a href="/gostd/database/sql/sql_test.go.html#7204344">err</a></span>&nbsp;<span class="op" id="7204367">=</span>&nbsp;<span class="ident" id="7204369"><a href="/gostd/database/sql/sql_test.go.html#7204318">db</a></span><span class="op" id="7204371">.</span><span class="ident" id="7204372"><a href="/gostd/database/sql/sql.go.html#5223860">Prepare</a></span><span class="op" id="7204379">(</span><span class="string" id="7204380">&#34;SELECT|people|name|&#34;</span><span class="op" id="7204401">)</span><br>
<span class="lineno">1485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7204404">if</span>&nbsp;<span class="ident" id="7204407"><a href="/gostd/database/sql/sql_test.go.html#7204344">err</a></span>&nbsp;<span class="op" id="7204411">!=</span>&nbsp;<span class="builtintype" id="7204414">nil</span>&nbsp;<span class="op" id="7204418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7204422"><a href="/gostd/database/sql/sql_test.go.html#7204304">t</a></span><span class="op" id="7204423">.</span><span class="ident" id="7204424"><a href="/gostd/testing/testing.go.html#5476798">Fatal</a></span><span class="op" id="7204429">(</span><span class="ident" id="7204430"><a href="/gostd/database/sql/sql_test.go.html#7204344">err</a></span><span class="op" id="7204433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7204436">}</span><br>
<span class="lineno"></span><span class="op" id="7204438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1490</span><span class="keyword" id="7204441">func</span>&nbsp;<span class="op" id="7204446">(</span><span class="ident" id="7204447">c</span>&nbsp;<span class="op" id="7204449">*</span><span class="ident" id="7204450"><a href="/gostd/database/sql/sql_test.go.html#7204207">concurrentStmtQueryTest</a></span><span class="op" id="7204473">)</span>&nbsp;<span class="ident" id="7204475">finish</span><span class="op" id="7204481">(</span><span class="ident" id="7204482">t</span>&nbsp;<span class="ident" id="7204484"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7204491">.</span><span class="ident" id="7204492"><a href="/gostd/testing/testing.go.html#5476676">TB</a></span><span class="op" id="7204494">)</span>&nbsp;<span class="op" id="7204496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7204499">if</span>&nbsp;<span class="ident" id="7204502"><a href="/gostd/database/sql/sql_test.go.html#7204447">c</a></span><span class="op" id="7204503">.</span><span class="ident" id="7204504"><a href="/gostd/database/sql/sql_test.go.html#7204251">stmt</a></span>&nbsp;<span class="op" id="7204509">!=</span>&nbsp;<span class="builtintype" id="7204512">nil</span>&nbsp;<span class="op" id="7204516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7204520"><a href="/gostd/database/sql/sql_test.go.html#7204447">c</a></span><span class="op" id="7204521">.</span><span class="ident" id="7204522"><a href="/gostd/database/sql/sql_test.go.html#7204251">stmt</a></span><span class="op" id="7204526">.</span><span class="ident" id="7204527"><a href="/gostd/database/sql/sql.go.html#5240529">Close</a></span><span class="op" id="7204532">(</span><span class="op" id="7204533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7204537"><a href="/gostd/database/sql/sql_test.go.html#7204447">c</a></span><span class="op" id="7204538">.</span><span class="ident" id="7204539"><a href="/gostd/database/sql/sql_test.go.html#7204251">stmt</a></span>&nbsp;<span class="op" id="7204544">=</span>&nbsp;<span class="builtintype" id="7204546">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7204551">}</span><br>
<span class="lineno">1495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7204554"><a href="/gostd/database/sql/sql_test.go.html#7204447">c</a></span><span class="op" id="7204555">.</span><span class="ident" id="7204556"><a href="/gostd/database/sql/sql_test.go.html#7204241">db</a></span>&nbsp;<span class="op" id="7204559">=</span>&nbsp;<span class="builtintype" id="7204561">nil</span><br>
<span class="lineno"></span><span class="op" id="7204565">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7204568">func</span>&nbsp;<span class="op" id="7204573">(</span><span class="ident" id="7204574">c</span>&nbsp;<span class="op" id="7204576">*</span><span class="ident" id="7204577"><a href="/gostd/database/sql/sql_test.go.html#7204207">concurrentStmtQueryTest</a></span><span class="op" id="7204600">)</span>&nbsp;<span class="ident" id="7204602">test</span><span class="op" id="7204606">(</span><span class="ident" id="7204607">t</span>&nbsp;<span class="ident" id="7204609"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7204616">.</span><span class="ident" id="7204617"><a href="/gostd/testing/testing.go.html#5476676">TB</a></span><span class="op" id="7204619">)</span>&nbsp;<span class="builtintype" id="7204621">error</span>&nbsp;<span class="op" id="7204627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7204630">rows</span><span class="op" id="7204634">,</span>&nbsp;<span class="ident" id="7204636">err</span>&nbsp;<span class="op" id="7204640">:=</span>&nbsp;<span class="ident" id="7204643"><a href="/gostd/database/sql/sql_test.go.html#7204574">c</a></span><span class="op" id="7204644">.</span><span class="ident" id="7204645"><a href="/gostd/database/sql/sql_test.go.html#7204251">stmt</a></span><span class="op" id="7204649">.</span><span class="ident" id="7204650"><a href="/gostd/database/sql/sql.go.html#5238423">Query</a></span><span class="op" id="7204655">(</span><span class="op" id="7204656">)</span><br>
<span class="lineno">1500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7204659">if</span>&nbsp;<span class="ident" id="7204662"><a href="/gostd/database/sql/sql_test.go.html#7204636">err</a></span>&nbsp;<span class="op" id="7204666">!=</span>&nbsp;<span class="builtintype" id="7204669">nil</span>&nbsp;<span class="op" id="7204673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7204677"><a href="/gostd/database/sql/sql_test.go.html#7204607">t</a></span><span class="op" id="7204678">.</span><span class="ident" id="7204679"><a href="/gostd/testing/testing.go.html#5476720">Errorf</a></span><span class="op" id="7204685">(</span><span class="string" id="7204686">&#34;error&nbsp;on&nbsp;query:&nbsp;&nbsp;%v&#34;</span><span class="op" id="7204707">,</span>&nbsp;<span class="ident" id="7204709"><a href="/gostd/database/sql/sql_test.go.html#7204636">err</a></span><span class="op" id="7204712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7204716">return</span>&nbsp;<span class="ident" id="7204723"><a href="/gostd/database/sql/sql_test.go.html#7204636">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7204728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1505</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7204732">var</span>&nbsp;<span class="ident" id="7204736">name</span>&nbsp;<span class="builtintype" id="7204741">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7204749">for</span>&nbsp;<span class="ident" id="7204753"><a href="/gostd/database/sql/sql_test.go.html#7204630">rows</a></span><span class="op" id="7204757">.</span><span class="ident" id="7204758"><a href="/gostd/database/sql/sql.go.html#5242163">Next</a></span><span class="op" id="7204762">(</span><span class="op" id="7204763">)</span>&nbsp;<span class="op" id="7204765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7204769"><a href="/gostd/database/sql/sql_test.go.html#7204630">rows</a></span><span class="op" id="7204773">.</span><span class="ident" id="7204774"><a href="/gostd/database/sql/sql.go.html#5243651">Scan</a></span><span class="op" id="7204778">(</span><span class="op" id="7204779">&amp;</span><span class="ident" id="7204780"><a href="/gostd/database/sql/sql_test.go.html#7204736">name</a></span><span class="op" id="7204784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7204787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7204790"><a href="/gostd/database/sql/sql_test.go.html#7204630">rows</a></span><span class="op" id="7204794">.</span><span class="ident" id="7204795"><a href="/gostd/database/sql/sql.go.html#5244447">Close</a></span><span class="op" id="7204800">(</span><span class="op" id="7204801">)</span><br>
<span class="lineno">1510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7204804">return</span>&nbsp;<span class="builtintype" id="7204811">nil</span><br>
<span class="lineno"></span><span class="op" id="7204815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7204818">type</span>&nbsp;<span class="ident" id="7204823">concurrentStmtExecTest</span>&nbsp;<span class="keyword" id="7204846">struct</span>&nbsp;<span class="op" id="7204853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7204856">db</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7204861">*</span><span class="ident" id="7204862"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><br>
<span class="lineno">1515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7204866">stmt</span>&nbsp;<span class="op" id="7204871">*</span><span class="ident" id="7204872"><a href="/gostd/database/sql/sql.go.html#5234451">Stmt</a></span><br>
<span class="lineno"></span><span class="op" id="7204877">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7204880">func</span>&nbsp;<span class="op" id="7204885">(</span><span class="ident" id="7204886">c</span>&nbsp;<span class="op" id="7204888">*</span><span class="ident" id="7204889"><a href="/gostd/database/sql/sql_test.go.html#7204823">concurrentStmtExecTest</a></span><span class="op" id="7204911">)</span>&nbsp;<span class="ident" id="7204913">init</span><span class="op" id="7204917">(</span><span class="ident" id="7204918">t</span>&nbsp;<span class="ident" id="7204920"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7204927">.</span><span class="ident" id="7204928"><a href="/gostd/testing/testing.go.html#5476676">TB</a></span><span class="op" id="7204930">,</span>&nbsp;<span class="ident" id="7204932">db</span>&nbsp;<span class="op" id="7204935">*</span><span class="ident" id="7204936"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="7204938">)</span>&nbsp;<span class="op" id="7204940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7204943"><a href="/gostd/database/sql/sql_test.go.html#7204886">c</a></span><span class="op" id="7204944">.</span><span class="ident" id="7204945"><a href="/gostd/database/sql/sql_test.go.html#7204856">db</a></span>&nbsp;<span class="op" id="7204948">=</span>&nbsp;<span class="ident" id="7204950"><a href="/gostd/database/sql/sql_test.go.html#7204932">db</a></span><br>
<span class="lineno">1520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7204954">var</span>&nbsp;<span class="ident" id="7204958">err</span>&nbsp;<span class="builtintype" id="7204962">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7204969"><a href="/gostd/database/sql/sql_test.go.html#7204886">c</a></span><span class="op" id="7204970">.</span><span class="ident" id="7204971"><a href="/gostd/database/sql/sql_test.go.html#7204866">stmt</a></span><span class="op" id="7204975">,</span>&nbsp;<span class="ident" id="7204977"><a href="/gostd/database/sql/sql_test.go.html#7204958">err</a></span>&nbsp;<span class="op" id="7204981">=</span>&nbsp;<span class="ident" id="7204983"><a href="/gostd/database/sql/sql_test.go.html#7204932">db</a></span><span class="op" id="7204985">.</span><span class="ident" id="7204986"><a href="/gostd/database/sql/sql.go.html#5223860">Prepare</a></span><span class="op" id="7204993">(</span><span class="string" id="7204994">&#34;NOSERT|people|name=Chris,age=?,photo=CPHOTO,bdate=?&#34;</span><span class="op" id="7205047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7205050">if</span>&nbsp;<span class="ident" id="7205053"><a href="/gostd/database/sql/sql_test.go.html#7204958">err</a></span>&nbsp;<span class="op" id="7205057">!=</span>&nbsp;<span class="builtintype" id="7205060">nil</span>&nbsp;<span class="op" id="7205064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7205068"><a href="/gostd/database/sql/sql_test.go.html#7204918">t</a></span><span class="op" id="7205069">.</span><span class="ident" id="7205070"><a href="/gostd/testing/testing.go.html#5476798">Fatal</a></span><span class="op" id="7205075">(</span><span class="ident" id="7205076"><a href="/gostd/database/sql/sql_test.go.html#7204958">err</a></span><span class="op" id="7205079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7205082">}</span><br>
<span class="lineno">1525</span><span class="op" id="7205084">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7205087">func</span>&nbsp;<span class="op" id="7205092">(</span><span class="ident" id="7205093">c</span>&nbsp;<span class="op" id="7205095">*</span><span class="ident" id="7205096"><a href="/gostd/database/sql/sql_test.go.html#7204823">concurrentStmtExecTest</a></span><span class="op" id="7205118">)</span>&nbsp;<span class="ident" id="7205120">finish</span><span class="op" id="7205126">(</span><span class="ident" id="7205127">t</span>&nbsp;<span class="ident" id="7205129"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7205136">.</span><span class="ident" id="7205137"><a href="/gostd/testing/testing.go.html#5476676">TB</a></span><span class="op" id="7205139">)</span>&nbsp;<span class="op" id="7205141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7205144">if</span>&nbsp;<span class="ident" id="7205147"><a href="/gostd/database/sql/sql_test.go.html#7205093">c</a></span><span class="op" id="7205148">.</span><span class="ident" id="7205149"><a href="/gostd/database/sql/sql_test.go.html#7204866">stmt</a></span>&nbsp;<span class="op" id="7205154">!=</span>&nbsp;<span class="builtintype" id="7205157">nil</span>&nbsp;<span class="op" id="7205161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7205165"><a href="/gostd/database/sql/sql_test.go.html#7205093">c</a></span><span class="op" id="7205166">.</span><span class="ident" id="7205167"><a href="/gostd/database/sql/sql_test.go.html#7204866">stmt</a></span><span class="op" id="7205171">.</span><span class="ident" id="7205172"><a href="/gostd/database/sql/sql.go.html#5240529">Close</a></span><span class="op" id="7205177">(</span><span class="op" id="7205178">)</span><br>
<span class="lineno">1530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7205182"><a href="/gostd/database/sql/sql_test.go.html#7205093">c</a></span><span class="op" id="7205183">.</span><span class="ident" id="7205184"><a href="/gostd/database/sql/sql_test.go.html#7204866">stmt</a></span>&nbsp;<span class="op" id="7205189">=</span>&nbsp;<span class="builtintype" id="7205191">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7205196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7205199"><a href="/gostd/database/sql/sql_test.go.html#7205093">c</a></span><span class="op" id="7205200">.</span><span class="ident" id="7205201"><a href="/gostd/database/sql/sql_test.go.html#7204856">db</a></span>&nbsp;<span class="op" id="7205204">=</span>&nbsp;<span class="builtintype" id="7205206">nil</span><br>
<span class="lineno"></span><span class="op" id="7205210">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1535</span><span class="keyword" id="7205213">func</span>&nbsp;<span class="op" id="7205218">(</span><span class="ident" id="7205219">c</span>&nbsp;<span class="op" id="7205221">*</span><span class="ident" id="7205222"><a href="/gostd/database/sql/sql_test.go.html#7204823">concurrentStmtExecTest</a></span><span class="op" id="7205244">)</span>&nbsp;<span class="ident" id="7205246">test</span><span class="op" id="7205250">(</span><span class="ident" id="7205251">t</span>&nbsp;<span class="ident" id="7205253"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7205260">.</span><span class="ident" id="7205261"><a href="/gostd/testing/testing.go.html#5476676">TB</a></span><span class="op" id="7205263">)</span>&nbsp;<span class="builtintype" id="7205265">error</span>&nbsp;<span class="op" id="7205271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7205274">_</span><span class="op" id="7205275">,</span>&nbsp;<span class="ident" id="7205277">err</span>&nbsp;<span class="op" id="7205281">:=</span>&nbsp;<span class="ident" id="7205284"><a href="/gostd/database/sql/sql_test.go.html#7205219">c</a></span><span class="op" id="7205285">.</span><span class="ident" id="7205286"><a href="/gostd/database/sql/sql_test.go.html#7204866">stmt</a></span><span class="op" id="7205290">.</span><span class="ident" id="7205291"><a href="/gostd/database/sql/sql.go.html#5235241">Exec</a></span><span class="op" id="7205295">(</span><span class="num" id="7205296">3</span><span class="op" id="7205297">,</span>&nbsp;<span class="ident" id="7205299"><a href="/gostd/database/sql/sql_test.go.html#7169803">chrisBirthday</a></span><span class="op" id="7205312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7205315">if</span>&nbsp;<span class="ident" id="7205318"><a href="/gostd/database/sql/sql_test.go.html#7205277">err</a></span>&nbsp;<span class="op" id="7205322">!=</span>&nbsp;<span class="builtintype" id="7205325">nil</span>&nbsp;<span class="op" id="7205329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7205333"><a href="/gostd/database/sql/sql_test.go.html#7205251">t</a></span><span class="op" id="7205334">.</span><span class="ident" id="7205335"><a href="/gostd/testing/testing.go.html#5476720">Errorf</a></span><span class="op" id="7205341">(</span><span class="string" id="7205342">&#34;error&nbsp;on&nbsp;exec:&nbsp;&nbsp;%v&#34;</span><span class="op" id="7205362">,</span>&nbsp;<span class="ident" id="7205364"><a href="/gostd/database/sql/sql_test.go.html#7205277">err</a></span><span class="op" id="7205367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7205371">return</span>&nbsp;<span class="ident" id="7205378"><a href="/gostd/database/sql/sql_test.go.html#7205277">err</a></span><br>
<span class="lineno">1540</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7205383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7205386">return</span>&nbsp;<span class="builtintype" id="7205393">nil</span><br>
<span class="lineno"></span><span class="op" id="7205397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7205400">type</span>&nbsp;<span class="ident" id="7205405">concurrentTxQueryTest</span>&nbsp;<span class="keyword" id="7205427">struct</span>&nbsp;<span class="op" id="7205434">{</span><br>
<span class="lineno">1545</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7205437">db</span>&nbsp;<span class="op" id="7205440">*</span><span class="ident" id="7205441"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7205445">tx</span>&nbsp;<span class="op" id="7205448">*</span><span class="ident" id="7205449"><a href="/gostd/database/sql/sql.go.html#5228860">Tx</a></span><br>
<span class="lineno"></span><span class="op" id="7205452">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7205455">func</span>&nbsp;<span class="op" id="7205460">(</span><span class="ident" id="7205461">c</span>&nbsp;<span class="op" id="7205463">*</span><span class="ident" id="7205464"><a href="/gostd/database/sql/sql_test.go.html#7205405">concurrentTxQueryTest</a></span><span class="op" id="7205485">)</span>&nbsp;<span class="ident" id="7205487">init</span><span class="op" id="7205491">(</span><span class="ident" id="7205492">t</span>&nbsp;<span class="ident" id="7205494"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7205501">.</span><span class="ident" id="7205502"><a href="/gostd/testing/testing.go.html#5476676">TB</a></span><span class="op" id="7205504">,</span>&nbsp;<span class="ident" id="7205506">db</span>&nbsp;<span class="op" id="7205509">*</span><span class="ident" id="7205510"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="7205512">)</span>&nbsp;<span class="op" id="7205514">{</span><br>
<span class="lineno">1550</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7205517"><a href="/gostd/database/sql/sql_test.go.html#7205461">c</a></span><span class="op" id="7205518">.</span><span class="ident" id="7205519"><a href="/gostd/database/sql/sql_test.go.html#7205437">db</a></span>&nbsp;<span class="op" id="7205522">=</span>&nbsp;<span class="ident" id="7205524"><a href="/gostd/database/sql/sql_test.go.html#7205506">db</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7205528">var</span>&nbsp;<span class="ident" id="7205532">err</span>&nbsp;<span class="builtintype" id="7205536">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7205543"><a href="/gostd/database/sql/sql_test.go.html#7205461">c</a></span><span class="op" id="7205544">.</span><span class="ident" id="7205545"><a href="/gostd/database/sql/sql_test.go.html#7205445">tx</a></span><span class="op" id="7205547">,</span>&nbsp;<span class="ident" id="7205549"><a href="/gostd/database/sql/sql_test.go.html#7205532">err</a></span>&nbsp;<span class="op" id="7205553">=</span>&nbsp;<span class="ident" id="7205555"><a href="/gostd/database/sql/sql_test.go.html#7205461">c</a></span><span class="op" id="7205556">.</span><span class="ident" id="7205557"><a href="/gostd/database/sql/sql_test.go.html#7205437">db</a></span><span class="op" id="7205559">.</span><span class="ident" id="7205560"><a href="/gostd/database/sql/sql.go.html#5228078">Begin</a></span><span class="op" id="7205565">(</span><span class="op" id="7205566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7205569">if</span>&nbsp;<span class="ident" id="7205572"><a href="/gostd/database/sql/sql_test.go.html#7205532">err</a></span>&nbsp;<span class="op" id="7205576">!=</span>&nbsp;<span class="builtintype" id="7205579">nil</span>&nbsp;<span class="op" id="7205583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7205587"><a href="/gostd/database/sql/sql_test.go.html#7205492">t</a></span><span class="op" id="7205588">.</span><span class="ident" id="7205589"><a href="/gostd/testing/testing.go.html#5476798">Fatal</a></span><span class="op" id="7205594">(</span><span class="ident" id="7205595"><a href="/gostd/database/sql/sql_test.go.html#7205532">err</a></span><span class="op" id="7205598">)</span><br>
<span class="lineno">1555</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7205601">}</span><br>
<span class="lineno"></span><span class="op" id="7205603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7205606">func</span>&nbsp;<span class="op" id="7205611">(</span><span class="ident" id="7205612">c</span>&nbsp;<span class="op" id="7205614">*</span><span class="ident" id="7205615"><a href="/gostd/database/sql/sql_test.go.html#7205405">concurrentTxQueryTest</a></span><span class="op" id="7205636">)</span>&nbsp;<span class="ident" id="7205638">finish</span><span class="op" id="7205644">(</span><span class="ident" id="7205645">t</span>&nbsp;<span class="ident" id="7205647"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7205654">.</span><span class="ident" id="7205655"><a href="/gostd/testing/testing.go.html#5476676">TB</a></span><span class="op" id="7205657">)</span>&nbsp;<span class="op" id="7205659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7205662">if</span>&nbsp;<span class="ident" id="7205665"><a href="/gostd/database/sql/sql_test.go.html#7205612">c</a></span><span class="op" id="7205666">.</span><span class="ident" id="7205667"><a href="/gostd/database/sql/sql_test.go.html#7205445">tx</a></span>&nbsp;<span class="op" id="7205670">!=</span>&nbsp;<span class="builtintype" id="7205673">nil</span>&nbsp;<span class="op" id="7205677">{</span><br>
<span class="lineno">1560</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7205681"><a href="/gostd/database/sql/sql_test.go.html#7205612">c</a></span><span class="op" id="7205682">.</span><span class="ident" id="7205683"><a href="/gostd/database/sql/sql_test.go.html#7205445">tx</a></span><span class="op" id="7205685">.</span><span class="ident" id="7205686"><a href="/gostd/database/sql/sql.go.html#5230160">Rollback</a></span><span class="op" id="7205694">(</span><span class="op" id="7205695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7205699"><a href="/gostd/database/sql/sql_test.go.html#7205612">c</a></span><span class="op" id="7205700">.</span><span class="ident" id="7205701"><a href="/gostd/database/sql/sql_test.go.html#7205445">tx</a></span>&nbsp;<span class="op" id="7205704">=</span>&nbsp;<span class="builtintype" id="7205706">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7205711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7205714"><a href="/gostd/database/sql/sql_test.go.html#7205612">c</a></span><span class="op" id="7205715">.</span><span class="ident" id="7205716"><a href="/gostd/database/sql/sql_test.go.html#7205437">db</a></span>&nbsp;<span class="op" id="7205719">=</span>&nbsp;<span class="builtintype" id="7205721">nil</span><br>
<span class="lineno"></span><span class="op" id="7205725">}</span><br>
<span class="lineno">1565</span><br>
<span class="lineno"></span><span class="keyword" id="7205728">func</span>&nbsp;<span class="op" id="7205733">(</span><span class="ident" id="7205734">c</span>&nbsp;<span class="op" id="7205736">*</span><span class="ident" id="7205737"><a href="/gostd/database/sql/sql_test.go.html#7205405">concurrentTxQueryTest</a></span><span class="op" id="7205758">)</span>&nbsp;<span class="ident" id="7205760">test</span><span class="op" id="7205764">(</span><span class="ident" id="7205765">t</span>&nbsp;<span class="ident" id="7205767"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7205774">.</span><span class="ident" id="7205775"><a href="/gostd/testing/testing.go.html#5476676">TB</a></span><span class="op" id="7205777">)</span>&nbsp;<span class="builtintype" id="7205779">error</span>&nbsp;<span class="op" id="7205785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7205788">rows</span><span class="op" id="7205792">,</span>&nbsp;<span class="ident" id="7205794">err</span>&nbsp;<span class="op" id="7205798">:=</span>&nbsp;<span class="ident" id="7205801"><a href="/gostd/database/sql/sql_test.go.html#7205734">c</a></span><span class="op" id="7205802">.</span><span class="ident" id="7205803"><a href="/gostd/database/sql/sql_test.go.html#7205437">db</a></span><span class="op" id="7205805">.</span><span class="ident" id="7205806"><a href="/gostd/database/sql/sql.go.html#5225993">Query</a></span><span class="op" id="7205811">(</span><span class="string" id="7205812">&#34;SELECT|people|name|&#34;</span><span class="op" id="7205833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7205836">if</span>&nbsp;<span class="ident" id="7205839"><a href="/gostd/database/sql/sql_test.go.html#7205794">err</a></span>&nbsp;<span class="op" id="7205843">!=</span>&nbsp;<span class="builtintype" id="7205846">nil</span>&nbsp;<span class="op" id="7205850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7205854"><a href="/gostd/database/sql/sql_test.go.html#7205765">t</a></span><span class="op" id="7205855">.</span><span class="ident" id="7205856"><a href="/gostd/testing/testing.go.html#5476692">Error</a></span><span class="op" id="7205861">(</span><span class="ident" id="7205862"><a href="/gostd/database/sql/sql_test.go.html#7205794">err</a></span><span class="op" id="7205865">)</span><br>
<span class="lineno">1570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7205869">return</span>&nbsp;<span class="ident" id="7205876"><a href="/gostd/database/sql/sql_test.go.html#7205794">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7205881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7205884">var</span>&nbsp;<span class="ident" id="7205888">name</span>&nbsp;<span class="builtintype" id="7205893">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7205901">for</span>&nbsp;<span class="ident" id="7205905"><a href="/gostd/database/sql/sql_test.go.html#7205788">rows</a></span><span class="op" id="7205909">.</span><span class="ident" id="7205910"><a href="/gostd/database/sql/sql.go.html#5242163">Next</a></span><span class="op" id="7205914">(</span><span class="op" id="7205915">)</span>&nbsp;<span class="op" id="7205917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7205921"><a href="/gostd/database/sql/sql_test.go.html#7205788">rows</a></span><span class="op" id="7205925">.</span><span class="ident" id="7205926"><a href="/gostd/database/sql/sql.go.html#5243651">Scan</a></span><span class="op" id="7205930">(</span><span class="op" id="7205931">&amp;</span><span class="ident" id="7205932"><a href="/gostd/database/sql/sql_test.go.html#7205888">name</a></span><span class="op" id="7205936">)</span><br>
<span class="lineno">1575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7205939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7205942"><a href="/gostd/database/sql/sql_test.go.html#7205788">rows</a></span><span class="op" id="7205946">.</span><span class="ident" id="7205947"><a href="/gostd/database/sql/sql.go.html#5244447">Close</a></span><span class="op" id="7205952">(</span><span class="op" id="7205953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7205956">return</span>&nbsp;<span class="builtintype" id="7205963">nil</span><br>
<span class="lineno"></span><span class="op" id="7205967">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1580</span><span class="keyword" id="7205970">type</span>&nbsp;<span class="ident" id="7205975">concurrentTxExecTest</span>&nbsp;<span class="keyword" id="7205996">struct</span>&nbsp;<span class="op" id="7206003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7206006">db</span>&nbsp;<span class="op" id="7206009">*</span><span class="ident" id="7206010"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7206014">tx</span>&nbsp;<span class="op" id="7206017">*</span><span class="ident" id="7206018"><a href="/gostd/database/sql/sql.go.html#5228860">Tx</a></span><br>
<span class="lineno"></span><span class="op" id="7206021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1585</span><span class="keyword" id="7206024">func</span>&nbsp;<span class="op" id="7206029">(</span><span class="ident" id="7206030">c</span>&nbsp;<span class="op" id="7206032">*</span><span class="ident" id="7206033"><a href="/gostd/database/sql/sql_test.go.html#7205975">concurrentTxExecTest</a></span><span class="op" id="7206053">)</span>&nbsp;<span class="ident" id="7206055">init</span><span class="op" id="7206059">(</span><span class="ident" id="7206060">t</span>&nbsp;<span class="ident" id="7206062"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7206069">.</span><span class="ident" id="7206070"><a href="/gostd/testing/testing.go.html#5476676">TB</a></span><span class="op" id="7206072">,</span>&nbsp;<span class="ident" id="7206074">db</span>&nbsp;<span class="op" id="7206077">*</span><span class="ident" id="7206078"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="7206080">)</span>&nbsp;<span class="op" id="7206082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7206085"><a href="/gostd/database/sql/sql_test.go.html#7206030">c</a></span><span class="op" id="7206086">.</span><span class="ident" id="7206087"><a href="/gostd/database/sql/sql_test.go.html#7206006">db</a></span>&nbsp;<span class="op" id="7206090">=</span>&nbsp;<span class="ident" id="7206092"><a href="/gostd/database/sql/sql_test.go.html#7206074">db</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7206096">var</span>&nbsp;<span class="ident" id="7206100">err</span>&nbsp;<span class="builtintype" id="7206104">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7206111"><a href="/gostd/database/sql/sql_test.go.html#7206030">c</a></span><span class="op" id="7206112">.</span><span class="ident" id="7206113"><a href="/gostd/database/sql/sql_test.go.html#7206014">tx</a></span><span class="op" id="7206115">,</span>&nbsp;<span class="ident" id="7206117"><a href="/gostd/database/sql/sql_test.go.html#7206100">err</a></span>&nbsp;<span class="op" id="7206121">=</span>&nbsp;<span class="ident" id="7206123"><a href="/gostd/database/sql/sql_test.go.html#7206030">c</a></span><span class="op" id="7206124">.</span><span class="ident" id="7206125"><a href="/gostd/database/sql/sql_test.go.html#7206006">db</a></span><span class="op" id="7206127">.</span><span class="ident" id="7206128"><a href="/gostd/database/sql/sql.go.html#5228078">Begin</a></span><span class="op" id="7206133">(</span><span class="op" id="7206134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7206137">if</span>&nbsp;<span class="ident" id="7206140"><a href="/gostd/database/sql/sql_test.go.html#7206100">err</a></span>&nbsp;<span class="op" id="7206144">!=</span>&nbsp;<span class="builtintype" id="7206147">nil</span>&nbsp;<span class="op" id="7206151">{</span><br>
<span class="lineno">1590</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7206155"><a href="/gostd/database/sql/sql_test.go.html#7206060">t</a></span><span class="op" id="7206156">.</span><span class="ident" id="7206157"><a href="/gostd/testing/testing.go.html#5476798">Fatal</a></span><span class="op" id="7206162">(</span><span class="ident" id="7206163"><a href="/gostd/database/sql/sql_test.go.html#7206100">err</a></span><span class="op" id="7206166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7206169">}</span><br>
<span class="lineno"></span><span class="op" id="7206171">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7206174">func</span>&nbsp;<span class="op" id="7206179">(</span><span class="ident" id="7206180">c</span>&nbsp;<span class="op" id="7206182">*</span><span class="ident" id="7206183"><a href="/gostd/database/sql/sql_test.go.html#7205975">concurrentTxExecTest</a></span><span class="op" id="7206203">)</span>&nbsp;<span class="ident" id="7206205">finish</span><span class="op" id="7206211">(</span><span class="ident" id="7206212">t</span>&nbsp;<span class="ident" id="7206214"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7206221">.</span><span class="ident" id="7206222"><a href="/gostd/testing/testing.go.html#5476676">TB</a></span><span class="op" id="7206224">)</span>&nbsp;<span class="op" id="7206226">{</span><br>
<span class="lineno">1595</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7206229">if</span>&nbsp;<span class="ident" id="7206232"><a href="/gostd/database/sql/sql_test.go.html#7206180">c</a></span><span class="op" id="7206233">.</span><span class="ident" id="7206234"><a href="/gostd/database/sql/sql_test.go.html#7206014">tx</a></span>&nbsp;<span class="op" id="7206237">!=</span>&nbsp;<span class="builtintype" id="7206240">nil</span>&nbsp;<span class="op" id="7206244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7206248"><a href="/gostd/database/sql/sql_test.go.html#7206180">c</a></span><span class="op" id="7206249">.</span><span class="ident" id="7206250"><a href="/gostd/database/sql/sql_test.go.html#7206014">tx</a></span><span class="op" id="7206252">.</span><span class="ident" id="7206253"><a href="/gostd/database/sql/sql.go.html#5230160">Rollback</a></span><span class="op" id="7206261">(</span><span class="op" id="7206262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7206266"><a href="/gostd/database/sql/sql_test.go.html#7206180">c</a></span><span class="op" id="7206267">.</span><span class="ident" id="7206268"><a href="/gostd/database/sql/sql_test.go.html#7206014">tx</a></span>&nbsp;<span class="op" id="7206271">=</span>&nbsp;<span class="builtintype" id="7206273">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7206278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7206281"><a href="/gostd/database/sql/sql_test.go.html#7206180">c</a></span><span class="op" id="7206282">.</span><span class="ident" id="7206283"><a href="/gostd/database/sql/sql_test.go.html#7206006">db</a></span>&nbsp;<span class="op" id="7206286">=</span>&nbsp;<span class="builtintype" id="7206288">nil</span><br>
<span class="lineno">1600</span><span class="op" id="7206292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7206295">func</span>&nbsp;<span class="op" id="7206300">(</span><span class="ident" id="7206301">c</span>&nbsp;<span class="op" id="7206303">*</span><span class="ident" id="7206304"><a href="/gostd/database/sql/sql_test.go.html#7205975">concurrentTxExecTest</a></span><span class="op" id="7206324">)</span>&nbsp;<span class="ident" id="7206326">test</span><span class="op" id="7206330">(</span><span class="ident" id="7206331">t</span>&nbsp;<span class="ident" id="7206333"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7206340">.</span><span class="ident" id="7206341"><a href="/gostd/testing/testing.go.html#5476676">TB</a></span><span class="op" id="7206343">)</span>&nbsp;<span class="builtintype" id="7206345">error</span>&nbsp;<span class="op" id="7206351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7206354">_</span><span class="op" id="7206355">,</span>&nbsp;<span class="ident" id="7206357">err</span>&nbsp;<span class="op" id="7206361">:=</span>&nbsp;<span class="ident" id="7206364"><a href="/gostd/database/sql/sql_test.go.html#7206301">c</a></span><span class="op" id="7206365">.</span><span class="ident" id="7206366"><a href="/gostd/database/sql/sql_test.go.html#7206014">tx</a></span><span class="op" id="7206368">.</span><span class="ident" id="7206369"><a href="/gostd/database/sql/sql.go.html#5233000">Exec</a></span><span class="op" id="7206373">(</span><span class="string" id="7206374">&#34;NOSERT|people|name=Chris,age=?,photo=CPHOTO,bdate=?&#34;</span><span class="op" id="7206427">,</span>&nbsp;<span class="num" id="7206429">3</span><span class="op" id="7206430">,</span>&nbsp;<span class="ident" id="7206432"><a href="/gostd/database/sql/sql_test.go.html#7169803">chrisBirthday</a></span><span class="op" id="7206445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7206448">if</span>&nbsp;<span class="ident" id="7206451"><a href="/gostd/database/sql/sql_test.go.html#7206357">err</a></span>&nbsp;<span class="op" id="7206455">!=</span>&nbsp;<span class="builtintype" id="7206458">nil</span>&nbsp;<span class="op" id="7206462">{</span><br>
<span class="lineno">1605</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7206466"><a href="/gostd/database/sql/sql_test.go.html#7206331">t</a></span><span class="op" id="7206467">.</span><span class="ident" id="7206468"><a href="/gostd/testing/testing.go.html#5476692">Error</a></span><span class="op" id="7206473">(</span><span class="ident" id="7206474"><a href="/gostd/database/sql/sql_test.go.html#7206357">err</a></span><span class="op" id="7206477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7206481">return</span>&nbsp;<span class="ident" id="7206488"><a href="/gostd/database/sql/sql_test.go.html#7206357">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7206493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7206496">return</span>&nbsp;<span class="builtintype" id="7206503">nil</span><br>
<span class="lineno"></span><span class="op" id="7206507">}</span><br>
<span class="lineno">1610</span><br>
<span class="lineno"></span><span class="keyword" id="7206510">type</span>&nbsp;<span class="ident" id="7206515">concurrentTxStmtQueryTest</span>&nbsp;<span class="keyword" id="7206541">struct</span>&nbsp;<span class="op" id="7206548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7206551">db</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7206556">*</span><span class="ident" id="7206557"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7206561">tx</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7206566">*</span><span class="ident" id="7206567"><a href="/gostd/database/sql/sql.go.html#5228860">Tx</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7206571">stmt</span>&nbsp;<span class="op" id="7206576">*</span><span class="ident" id="7206577"><a href="/gostd/database/sql/sql.go.html#5234451">Stmt</a></span><br>
<span class="lineno">1615</span><span class="op" id="7206582">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7206585">func</span>&nbsp;<span class="op" id="7206590">(</span><span class="ident" id="7206591">c</span>&nbsp;<span class="op" id="7206593">*</span><span class="ident" id="7206594"><a href="/gostd/database/sql/sql_test.go.html#7206515">concurrentTxStmtQueryTest</a></span><span class="op" id="7206619">)</span>&nbsp;<span class="ident" id="7206621">init</span><span class="op" id="7206625">(</span><span class="ident" id="7206626">t</span>&nbsp;<span class="ident" id="7206628"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7206635">.</span><span class="ident" id="7206636"><a href="/gostd/testing/testing.go.html#5476676">TB</a></span><span class="op" id="7206638">,</span>&nbsp;<span class="ident" id="7206640">db</span>&nbsp;<span class="op" id="7206643">*</span><span class="ident" id="7206644"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="7206646">)</span>&nbsp;<span class="op" id="7206648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7206651"><a href="/gostd/database/sql/sql_test.go.html#7206591">c</a></span><span class="op" id="7206652">.</span><span class="ident" id="7206653"><a href="/gostd/database/sql/sql_test.go.html#7206551">db</a></span>&nbsp;<span class="op" id="7206656">=</span>&nbsp;<span class="ident" id="7206658"><a href="/gostd/database/sql/sql_test.go.html#7206640">db</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7206662">var</span>&nbsp;<span class="ident" id="7206666">err</span>&nbsp;<span class="builtintype" id="7206670">error</span><br>
<span class="lineno">1620</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7206677"><a href="/gostd/database/sql/sql_test.go.html#7206591">c</a></span><span class="op" id="7206678">.</span><span class="ident" id="7206679"><a href="/gostd/database/sql/sql_test.go.html#7206561">tx</a></span><span class="op" id="7206681">,</span>&nbsp;<span class="ident" id="7206683"><a href="/gostd/database/sql/sql_test.go.html#7206666">err</a></span>&nbsp;<span class="op" id="7206687">=</span>&nbsp;<span class="ident" id="7206689"><a href="/gostd/database/sql/sql_test.go.html#7206591">c</a></span><span class="op" id="7206690">.</span><span class="ident" id="7206691"><a href="/gostd/database/sql/sql_test.go.html#7206551">db</a></span><span class="op" id="7206693">.</span><span class="ident" id="7206694"><a href="/gostd/database/sql/sql.go.html#5228078">Begin</a></span><span class="op" id="7206699">(</span><span class="op" id="7206700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7206703">if</span>&nbsp;<span class="ident" id="7206706"><a href="/gostd/database/sql/sql_test.go.html#7206666">err</a></span>&nbsp;<span class="op" id="7206710">!=</span>&nbsp;<span class="builtintype" id="7206713">nil</span>&nbsp;<span class="op" id="7206717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7206721"><a href="/gostd/database/sql/sql_test.go.html#7206626">t</a></span><span class="op" id="7206722">.</span><span class="ident" id="7206723"><a href="/gostd/testing/testing.go.html#5476798">Fatal</a></span><span class="op" id="7206728">(</span><span class="ident" id="7206729"><a href="/gostd/database/sql/sql_test.go.html#7206666">err</a></span><span class="op" id="7206732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7206735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7206738"><a href="/gostd/database/sql/sql_test.go.html#7206591">c</a></span><span class="op" id="7206739">.</span><span class="ident" id="7206740"><a href="/gostd/database/sql/sql_test.go.html#7206571">stmt</a></span><span class="op" id="7206744">,</span>&nbsp;<span class="ident" id="7206746"><a href="/gostd/database/sql/sql_test.go.html#7206666">err</a></span>&nbsp;<span class="op" id="7206750">=</span>&nbsp;<span class="ident" id="7206752"><a href="/gostd/database/sql/sql_test.go.html#7206591">c</a></span><span class="op" id="7206753">.</span><span class="ident" id="7206754"><a href="/gostd/database/sql/sql_test.go.html#7206561">tx</a></span><span class="op" id="7206756">.</span><span class="ident" id="7206757"><a href="/gostd/database/sql/sql.go.html#5230667">Prepare</a></span><span class="op" id="7206764">(</span><span class="string" id="7206765">&#34;SELECT|people|name|&#34;</span><span class="op" id="7206786">)</span><br>
<span class="lineno">1625</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7206789">if</span>&nbsp;<span class="ident" id="7206792"><a href="/gostd/database/sql/sql_test.go.html#7206666">err</a></span>&nbsp;<span class="op" id="7206796">!=</span>&nbsp;<span class="builtintype" id="7206799">nil</span>&nbsp;<span class="op" id="7206803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7206807"><a href="/gostd/database/sql/sql_test.go.html#7206626">t</a></span><span class="op" id="7206808">.</span><span class="ident" id="7206809"><a href="/gostd/testing/testing.go.html#5476798">Fatal</a></span><span class="op" id="7206814">(</span><span class="ident" id="7206815"><a href="/gostd/database/sql/sql_test.go.html#7206666">err</a></span><span class="op" id="7206818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7206821">}</span><br>
<span class="lineno"></span><span class="op" id="7206823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1630</span><span class="keyword" id="7206826">func</span>&nbsp;<span class="op" id="7206831">(</span><span class="ident" id="7206832">c</span>&nbsp;<span class="op" id="7206834">*</span><span class="ident" id="7206835"><a href="/gostd/database/sql/sql_test.go.html#7206515">concurrentTxStmtQueryTest</a></span><span class="op" id="7206860">)</span>&nbsp;<span class="ident" id="7206862">finish</span><span class="op" id="7206868">(</span><span class="ident" id="7206869">t</span>&nbsp;<span class="ident" id="7206871"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7206878">.</span><span class="ident" id="7206879"><a href="/gostd/testing/testing.go.html#5476676">TB</a></span><span class="op" id="7206881">)</span>&nbsp;<span class="op" id="7206883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7206886">if</span>&nbsp;<span class="ident" id="7206889"><a href="/gostd/database/sql/sql_test.go.html#7206832">c</a></span><span class="op" id="7206890">.</span><span class="ident" id="7206891"><a href="/gostd/database/sql/sql_test.go.html#7206571">stmt</a></span>&nbsp;<span class="op" id="7206896">!=</span>&nbsp;<span class="builtintype" id="7206899">nil</span>&nbsp;<span class="op" id="7206903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7206907"><a href="/gostd/database/sql/sql_test.go.html#7206832">c</a></span><span class="op" id="7206908">.</span><span class="ident" id="7206909"><a href="/gostd/database/sql/sql_test.go.html#7206571">stmt</a></span><span class="op" id="7206913">.</span><span class="ident" id="7206914"><a href="/gostd/database/sql/sql.go.html#5240529">Close</a></span><span class="op" id="7206919">(</span><span class="op" id="7206920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7206924"><a href="/gostd/database/sql/sql_test.go.html#7206832">c</a></span><span class="op" id="7206925">.</span><span class="ident" id="7206926"><a href="/gostd/database/sql/sql_test.go.html#7206571">stmt</a></span>&nbsp;<span class="op" id="7206931">=</span>&nbsp;<span class="builtintype" id="7206933">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7206938">}</span><br>
<span class="lineno">1635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7206941">if</span>&nbsp;<span class="ident" id="7206944"><a href="/gostd/database/sql/sql_test.go.html#7206832">c</a></span><span class="op" id="7206945">.</span><span class="ident" id="7206946"><a href="/gostd/database/sql/sql_test.go.html#7206561">tx</a></span>&nbsp;<span class="op" id="7206949">!=</span>&nbsp;<span class="builtintype" id="7206952">nil</span>&nbsp;<span class="op" id="7206956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7206960"><a href="/gostd/database/sql/sql_test.go.html#7206832">c</a></span><span class="op" id="7206961">.</span><span class="ident" id="7206962"><a href="/gostd/database/sql/sql_test.go.html#7206561">tx</a></span><span class="op" id="7206964">.</span><span class="ident" id="7206965"><a href="/gostd/database/sql/sql.go.html#5230160">Rollback</a></span><span class="op" id="7206973">(</span><span class="op" id="7206974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7206978"><a href="/gostd/database/sql/sql_test.go.html#7206832">c</a></span><span class="op" id="7206979">.</span><span class="ident" id="7206980"><a href="/gostd/database/sql/sql_test.go.html#7206561">tx</a></span>&nbsp;<span class="op" id="7206983">=</span>&nbsp;<span class="builtintype" id="7206985">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7206990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7206993"><a href="/gostd/database/sql/sql_test.go.html#7206832">c</a></span><span class="op" id="7206994">.</span><span class="ident" id="7206995"><a href="/gostd/database/sql/sql_test.go.html#7206551">db</a></span>&nbsp;<span class="op" id="7206998">=</span>&nbsp;<span class="builtintype" id="7207000">nil</span><br>
<span class="lineno">1640</span><span class="op" id="7207004">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7207007">func</span>&nbsp;<span class="op" id="7207012">(</span><span class="ident" id="7207013">c</span>&nbsp;<span class="op" id="7207015">*</span><span class="ident" id="7207016"><a href="/gostd/database/sql/sql_test.go.html#7206515">concurrentTxStmtQueryTest</a></span><span class="op" id="7207041">)</span>&nbsp;<span class="ident" id="7207043">test</span><span class="op" id="7207047">(</span><span class="ident" id="7207048">t</span>&nbsp;<span class="ident" id="7207050"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7207057">.</span><span class="ident" id="7207058"><a href="/gostd/testing/testing.go.html#5476676">TB</a></span><span class="op" id="7207060">)</span>&nbsp;<span class="builtintype" id="7207062">error</span>&nbsp;<span class="op" id="7207068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7207071">rows</span><span class="op" id="7207075">,</span>&nbsp;<span class="ident" id="7207077">err</span>&nbsp;<span class="op" id="7207081">:=</span>&nbsp;<span class="ident" id="7207084"><a href="/gostd/database/sql/sql_test.go.html#7207013">c</a></span><span class="op" id="7207085">.</span><span class="ident" id="7207086"><a href="/gostd/database/sql/sql_test.go.html#7206571">stmt</a></span><span class="op" id="7207090">.</span><span class="ident" id="7207091"><a href="/gostd/database/sql/sql.go.html#5238423">Query</a></span><span class="op" id="7207096">(</span><span class="op" id="7207097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7207100">if</span>&nbsp;<span class="ident" id="7207103"><a href="/gostd/database/sql/sql_test.go.html#7207077">err</a></span>&nbsp;<span class="op" id="7207107">!=</span>&nbsp;<span class="builtintype" id="7207110">nil</span>&nbsp;<span class="op" id="7207114">{</span><br>
<span class="lineno">1645</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7207118"><a href="/gostd/database/sql/sql_test.go.html#7207048">t</a></span><span class="op" id="7207119">.</span><span class="ident" id="7207120"><a href="/gostd/testing/testing.go.html#5476720">Errorf</a></span><span class="op" id="7207126">(</span><span class="string" id="7207127">&#34;error&nbsp;on&nbsp;query:&nbsp;&nbsp;%v&#34;</span><span class="op" id="7207148">,</span>&nbsp;<span class="ident" id="7207150"><a href="/gostd/database/sql/sql_test.go.html#7207077">err</a></span><span class="op" id="7207153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7207157">return</span>&nbsp;<span class="ident" id="7207164"><a href="/gostd/database/sql/sql_test.go.html#7207077">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7207169">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7207173">var</span>&nbsp;<span class="ident" id="7207177">name</span>&nbsp;<span class="builtintype" id="7207182">string</span><br>
<span class="lineno">1650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7207190">for</span>&nbsp;<span class="ident" id="7207194"><a href="/gostd/database/sql/sql_test.go.html#7207071">rows</a></span><span class="op" id="7207198">.</span><span class="ident" id="7207199"><a href="/gostd/database/sql/sql.go.html#5242163">Next</a></span><span class="op" id="7207203">(</span><span class="op" id="7207204">)</span>&nbsp;<span class="op" id="7207206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7207210"><a href="/gostd/database/sql/sql_test.go.html#7207071">rows</a></span><span class="op" id="7207214">.</span><span class="ident" id="7207215"><a href="/gostd/database/sql/sql.go.html#5243651">Scan</a></span><span class="op" id="7207219">(</span><span class="op" id="7207220">&amp;</span><span class="ident" id="7207221"><a href="/gostd/database/sql/sql_test.go.html#7207177">name</a></span><span class="op" id="7207225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7207228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7207231"><a href="/gostd/database/sql/sql_test.go.html#7207071">rows</a></span><span class="op" id="7207235">.</span><span class="ident" id="7207236"><a href="/gostd/database/sql/sql.go.html#5244447">Close</a></span><span class="op" id="7207241">(</span><span class="op" id="7207242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7207245">return</span>&nbsp;<span class="builtintype" id="7207252">nil</span><br>
<span class="lineno">1655</span><span class="op" id="7207256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7207259">type</span>&nbsp;<span class="ident" id="7207264">concurrentTxStmtExecTest</span>&nbsp;<span class="keyword" id="7207289">struct</span>&nbsp;<span class="op" id="7207296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7207299">db</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7207304">*</span><span class="ident" id="7207305"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7207309">tx</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7207314">*</span><span class="ident" id="7207315"><a href="/gostd/database/sql/sql.go.html#5228860">Tx</a></span><br>
<span class="lineno">1660</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7207319">stmt</span>&nbsp;<span class="op" id="7207324">*</span><span class="ident" id="7207325"><a href="/gostd/database/sql/sql.go.html#5234451">Stmt</a></span><br>
<span class="lineno"></span><span class="op" id="7207330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7207333">func</span>&nbsp;<span class="op" id="7207338">(</span><span class="ident" id="7207339">c</span>&nbsp;<span class="op" id="7207341">*</span><span class="ident" id="7207342"><a href="/gostd/database/sql/sql_test.go.html#7207264">concurrentTxStmtExecTest</a></span><span class="op" id="7207366">)</span>&nbsp;<span class="ident" id="7207368">init</span><span class="op" id="7207372">(</span><span class="ident" id="7207373">t</span>&nbsp;<span class="ident" id="7207375"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7207382">.</span><span class="ident" id="7207383"><a href="/gostd/testing/testing.go.html#5476676">TB</a></span><span class="op" id="7207385">,</span>&nbsp;<span class="ident" id="7207387">db</span>&nbsp;<span class="op" id="7207390">*</span><span class="ident" id="7207391"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="7207393">)</span>&nbsp;<span class="op" id="7207395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7207398"><a href="/gostd/database/sql/sql_test.go.html#7207339">c</a></span><span class="op" id="7207399">.</span><span class="ident" id="7207400"><a href="/gostd/database/sql/sql_test.go.html#7207299">db</a></span>&nbsp;<span class="op" id="7207403">=</span>&nbsp;<span class="ident" id="7207405"><a href="/gostd/database/sql/sql_test.go.html#7207387">db</a></span><br>
<span class="lineno">1665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7207409">var</span>&nbsp;<span class="ident" id="7207413">err</span>&nbsp;<span class="builtintype" id="7207417">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7207424"><a href="/gostd/database/sql/sql_test.go.html#7207339">c</a></span><span class="op" id="7207425">.</span><span class="ident" id="7207426"><a href="/gostd/database/sql/sql_test.go.html#7207309">tx</a></span><span class="op" id="7207428">,</span>&nbsp;<span class="ident" id="7207430"><a href="/gostd/database/sql/sql_test.go.html#7207413">err</a></span>&nbsp;<span class="op" id="7207434">=</span>&nbsp;<span class="ident" id="7207436"><a href="/gostd/database/sql/sql_test.go.html#7207339">c</a></span><span class="op" id="7207437">.</span><span class="ident" id="7207438"><a href="/gostd/database/sql/sql_test.go.html#7207299">db</a></span><span class="op" id="7207440">.</span><span class="ident" id="7207441"><a href="/gostd/database/sql/sql.go.html#5228078">Begin</a></span><span class="op" id="7207446">(</span><span class="op" id="7207447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7207450">if</span>&nbsp;<span class="ident" id="7207453"><a href="/gostd/database/sql/sql_test.go.html#7207413">err</a></span>&nbsp;<span class="op" id="7207457">!=</span>&nbsp;<span class="builtintype" id="7207460">nil</span>&nbsp;<span class="op" id="7207464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7207468"><a href="/gostd/database/sql/sql_test.go.html#7207373">t</a></span><span class="op" id="7207469">.</span><span class="ident" id="7207470"><a href="/gostd/testing/testing.go.html#5476798">Fatal</a></span><span class="op" id="7207475">(</span><span class="ident" id="7207476"><a href="/gostd/database/sql/sql_test.go.html#7207413">err</a></span><span class="op" id="7207479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7207482">}</span><br>
<span class="lineno">1670</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7207485"><a href="/gostd/database/sql/sql_test.go.html#7207339">c</a></span><span class="op" id="7207486">.</span><span class="ident" id="7207487"><a href="/gostd/database/sql/sql_test.go.html#7207319">stmt</a></span><span class="op" id="7207491">,</span>&nbsp;<span class="ident" id="7207493"><a href="/gostd/database/sql/sql_test.go.html#7207413">err</a></span>&nbsp;<span class="op" id="7207497">=</span>&nbsp;<span class="ident" id="7207499"><a href="/gostd/database/sql/sql_test.go.html#7207339">c</a></span><span class="op" id="7207500">.</span><span class="ident" id="7207501"><a href="/gostd/database/sql/sql_test.go.html#7207309">tx</a></span><span class="op" id="7207503">.</span><span class="ident" id="7207504"><a href="/gostd/database/sql/sql.go.html#5230667">Prepare</a></span><span class="op" id="7207511">(</span><span class="string" id="7207512">&#34;NOSERT|people|name=Chris,age=?,photo=CPHOTO,bdate=?&#34;</span><span class="op" id="7207565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7207568">if</span>&nbsp;<span class="ident" id="7207571"><a href="/gostd/database/sql/sql_test.go.html#7207413">err</a></span>&nbsp;<span class="op" id="7207575">!=</span>&nbsp;<span class="builtintype" id="7207578">nil</span>&nbsp;<span class="op" id="7207582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7207586"><a href="/gostd/database/sql/sql_test.go.html#7207373">t</a></span><span class="op" id="7207587">.</span><span class="ident" id="7207588"><a href="/gostd/testing/testing.go.html#5476798">Fatal</a></span><span class="op" id="7207593">(</span><span class="ident" id="7207594"><a href="/gostd/database/sql/sql_test.go.html#7207413">err</a></span><span class="op" id="7207597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7207600">}</span><br>
<span class="lineno"></span><span class="op" id="7207602">}</span><br>
<span class="lineno">1675</span><br>
<span class="lineno"></span><span class="keyword" id="7207605">func</span>&nbsp;<span class="op" id="7207610">(</span><span class="ident" id="7207611">c</span>&nbsp;<span class="op" id="7207613">*</span><span class="ident" id="7207614"><a href="/gostd/database/sql/sql_test.go.html#7207264">concurrentTxStmtExecTest</a></span><span class="op" id="7207638">)</span>&nbsp;<span class="ident" id="7207640">finish</span><span class="op" id="7207646">(</span><span class="ident" id="7207647">t</span>&nbsp;<span class="ident" id="7207649"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7207656">.</span><span class="ident" id="7207657"><a href="/gostd/testing/testing.go.html#5476676">TB</a></span><span class="op" id="7207659">)</span>&nbsp;<span class="op" id="7207661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7207664">if</span>&nbsp;<span class="ident" id="7207667"><a href="/gostd/database/sql/sql_test.go.html#7207611">c</a></span><span class="op" id="7207668">.</span><span class="ident" id="7207669"><a href="/gostd/database/sql/sql_test.go.html#7207319">stmt</a></span>&nbsp;<span class="op" id="7207674">!=</span>&nbsp;<span class="builtintype" id="7207677">nil</span>&nbsp;<span class="op" id="7207681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7207685"><a href="/gostd/database/sql/sql_test.go.html#7207611">c</a></span><span class="op" id="7207686">.</span><span class="ident" id="7207687"><a href="/gostd/database/sql/sql_test.go.html#7207319">stmt</a></span><span class="op" id="7207691">.</span><span class="ident" id="7207692"><a href="/gostd/database/sql/sql.go.html#5240529">Close</a></span><span class="op" id="7207697">(</span><span class="op" id="7207698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7207702"><a href="/gostd/database/sql/sql_test.go.html#7207611">c</a></span><span class="op" id="7207703">.</span><span class="ident" id="7207704"><a href="/gostd/database/sql/sql_test.go.html#7207319">stmt</a></span>&nbsp;<span class="op" id="7207709">=</span>&nbsp;<span class="builtintype" id="7207711">nil</span><br>
<span class="lineno">1680</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7207716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7207719">if</span>&nbsp;<span class="ident" id="7207722"><a href="/gostd/database/sql/sql_test.go.html#7207611">c</a></span><span class="op" id="7207723">.</span><span class="ident" id="7207724"><a href="/gostd/database/sql/sql_test.go.html#7207309">tx</a></span>&nbsp;<span class="op" id="7207727">!=</span>&nbsp;<span class="builtintype" id="7207730">nil</span>&nbsp;<span class="op" id="7207734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7207738"><a href="/gostd/database/sql/sql_test.go.html#7207611">c</a></span><span class="op" id="7207739">.</span><span class="ident" id="7207740"><a href="/gostd/database/sql/sql_test.go.html#7207309">tx</a></span><span class="op" id="7207742">.</span><span class="ident" id="7207743"><a href="/gostd/database/sql/sql.go.html#5230160">Rollback</a></span><span class="op" id="7207751">(</span><span class="op" id="7207752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7207756"><a href="/gostd/database/sql/sql_test.go.html#7207611">c</a></span><span class="op" id="7207757">.</span><span class="ident" id="7207758"><a href="/gostd/database/sql/sql_test.go.html#7207309">tx</a></span>&nbsp;<span class="op" id="7207761">=</span>&nbsp;<span class="builtintype" id="7207763">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7207768">}</span><br>
<span class="lineno">1685</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7207771"><a href="/gostd/database/sql/sql_test.go.html#7207611">c</a></span><span class="op" id="7207772">.</span><span class="ident" id="7207773"><a href="/gostd/database/sql/sql_test.go.html#7207299">db</a></span>&nbsp;<span class="op" id="7207776">=</span>&nbsp;<span class="builtintype" id="7207778">nil</span><br>
<span class="lineno"></span><span class="op" id="7207782">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7207785">func</span>&nbsp;<span class="op" id="7207790">(</span><span class="ident" id="7207791">c</span>&nbsp;<span class="op" id="7207793">*</span><span class="ident" id="7207794"><a href="/gostd/database/sql/sql_test.go.html#7207264">concurrentTxStmtExecTest</a></span><span class="op" id="7207818">)</span>&nbsp;<span class="ident" id="7207820">test</span><span class="op" id="7207824">(</span><span class="ident" id="7207825">t</span>&nbsp;<span class="ident" id="7207827"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7207834">.</span><span class="ident" id="7207835"><a href="/gostd/testing/testing.go.html#5476676">TB</a></span><span class="op" id="7207837">)</span>&nbsp;<span class="builtintype" id="7207839">error</span>&nbsp;<span class="op" id="7207845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7207848">_</span><span class="op" id="7207849">,</span>&nbsp;<span class="ident" id="7207851">err</span>&nbsp;<span class="op" id="7207855">:=</span>&nbsp;<span class="ident" id="7207858"><a href="/gostd/database/sql/sql_test.go.html#7207791">c</a></span><span class="op" id="7207859">.</span><span class="ident" id="7207860"><a href="/gostd/database/sql/sql_test.go.html#7207319">stmt</a></span><span class="op" id="7207864">.</span><span class="ident" id="7207865"><a href="/gostd/database/sql/sql.go.html#5235241">Exec</a></span><span class="op" id="7207869">(</span><span class="num" id="7207870">3</span><span class="op" id="7207871">,</span>&nbsp;<span class="ident" id="7207873"><a href="/gostd/database/sql/sql_test.go.html#7169803">chrisBirthday</a></span><span class="op" id="7207886">)</span><br>
<span class="lineno">1690</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7207889">if</span>&nbsp;<span class="ident" id="7207892"><a href="/gostd/database/sql/sql_test.go.html#7207851">err</a></span>&nbsp;<span class="op" id="7207896">!=</span>&nbsp;<span class="builtintype" id="7207899">nil</span>&nbsp;<span class="op" id="7207903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7207907"><a href="/gostd/database/sql/sql_test.go.html#7207825">t</a></span><span class="op" id="7207908">.</span><span class="ident" id="7207909"><a href="/gostd/testing/testing.go.html#5476720">Errorf</a></span><span class="op" id="7207915">(</span><span class="string" id="7207916">&#34;error&nbsp;on&nbsp;exec:&nbsp;&nbsp;%v&#34;</span><span class="op" id="7207936">,</span>&nbsp;<span class="ident" id="7207938"><a href="/gostd/database/sql/sql_test.go.html#7207851">err</a></span><span class="op" id="7207941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7207945">return</span>&nbsp;<span class="ident" id="7207952"><a href="/gostd/database/sql/sql_test.go.html#7207851">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7207957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7207960">return</span>&nbsp;<span class="builtintype" id="7207967">nil</span><br>
<span class="lineno">1695</span><span class="op" id="7207971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7207974">type</span>&nbsp;<span class="ident" id="7207979">concurrentRandomTest</span>&nbsp;<span class="keyword" id="7208000">struct</span>&nbsp;<span class="op" id="7208007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7208010">tests</span>&nbsp;<span class="op" id="7208016">[</span><span class="op" id="7208017">]</span><span class="ident" id="7208018"><a href="/gostd/database/sql/sql_test.go.html#7203258">concurrentTest</a></span><br>
<span class="lineno"></span><span class="op" id="7208033">}</span><br>
<span class="lineno">1700</span><br>
<span class="lineno"></span><span class="keyword" id="7208036">func</span>&nbsp;<span class="op" id="7208041">(</span><span class="ident" id="7208042">c</span>&nbsp;<span class="op" id="7208044">*</span><span class="ident" id="7208045"><a href="/gostd/database/sql/sql_test.go.html#7207979">concurrentRandomTest</a></span><span class="op" id="7208065">)</span>&nbsp;<span class="ident" id="7208067">init</span><span class="op" id="7208071">(</span><span class="ident" id="7208072">t</span>&nbsp;<span class="ident" id="7208074"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7208081">.</span><span class="ident" id="7208082"><a href="/gostd/testing/testing.go.html#5476676">TB</a></span><span class="op" id="7208084">,</span>&nbsp;<span class="ident" id="7208086">db</span>&nbsp;<span class="op" id="7208089">*</span><span class="ident" id="7208090"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="7208092">)</span>&nbsp;<span class="op" id="7208094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7208097"><a href="/gostd/database/sql/sql_test.go.html#7208042">c</a></span><span class="op" id="7208098">.</span><span class="ident" id="7208099"><a href="/gostd/database/sql/sql_test.go.html#7208010">tests</a></span>&nbsp;<span class="op" id="7208105">=</span>&nbsp;<span class="op" id="7208107">[</span><span class="op" id="7208108">]</span><span class="ident" id="7208109"><a href="/gostd/database/sql/sql_test.go.html#7203258">concurrentTest</a></span><span class="op" id="7208123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7208127">new</span><span class="op" id="7208130">(</span><span class="ident" id="7208131"><a href="/gostd/database/sql/sql_test.go.html#7203369">concurrentDBQueryTest</a></span><span class="op" id="7208152">)</span><span class="op" id="7208153">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7208157">new</span><span class="op" id="7208160">(</span><span class="ident" id="7208161"><a href="/gostd/database/sql/sql_test.go.html#7203803">concurrentDBExecTest</a></span><span class="op" id="7208181">)</span><span class="op" id="7208182">,</span><br>
<span class="lineno">1705</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7208186">new</span><span class="op" id="7208189">(</span><span class="ident" id="7208190"><a href="/gostd/database/sql/sql_test.go.html#7204207">concurrentStmtQueryTest</a></span><span class="op" id="7208213">)</span><span class="op" id="7208214">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7208218">new</span><span class="op" id="7208221">(</span><span class="ident" id="7208222"><a href="/gostd/database/sql/sql_test.go.html#7204823">concurrentStmtExecTest</a></span><span class="op" id="7208244">)</span><span class="op" id="7208245">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7208249">new</span><span class="op" id="7208252">(</span><span class="ident" id="7208253"><a href="/gostd/database/sql/sql_test.go.html#7205405">concurrentTxQueryTest</a></span><span class="op" id="7208274">)</span><span class="op" id="7208275">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7208279">new</span><span class="op" id="7208282">(</span><span class="ident" id="7208283"><a href="/gostd/database/sql/sql_test.go.html#7205975">concurrentTxExecTest</a></span><span class="op" id="7208303">)</span><span class="op" id="7208304">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7208308">new</span><span class="op" id="7208311">(</span><span class="ident" id="7208312"><a href="/gostd/database/sql/sql_test.go.html#7206515">concurrentTxStmtQueryTest</a></span><span class="op" id="7208337">)</span><span class="op" id="7208338">,</span><br>
<span class="lineno">1710</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7208342">new</span><span class="op" id="7208345">(</span><span class="ident" id="7208346"><a href="/gostd/database/sql/sql_test.go.html#7207264">concurrentTxStmtExecTest</a></span><span class="op" id="7208370">)</span><span class="op" id="7208371">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7208374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7208377">for</span>&nbsp;<span class="ident" id="7208381">_</span><span class="op" id="7208382">,</span>&nbsp;<span class="ident" id="7208384">ct</span>&nbsp;<span class="op" id="7208387">:=</span>&nbsp;<span class="keyword" id="7208390">range</span>&nbsp;<span class="ident" id="7208396"><a href="/gostd/database/sql/sql_test.go.html#7208042">c</a></span><span class="op" id="7208397">.</span><span class="ident" id="7208398"><a href="/gostd/database/sql/sql_test.go.html#7208010">tests</a></span>&nbsp;<span class="op" id="7208404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7208408"><a href="/gostd/database/sql/sql_test.go.html#7208384">ct</a></span><span class="op" id="7208410">.</span><span class="ident" id="7208411"><a href="/gostd/database/sql/sql_test.go.html#7203286">init</a></span><span class="op" id="7208415">(</span><span class="ident" id="7208416"><a href="/gostd/database/sql/sql_test.go.html#7208072">t</a></span><span class="op" id="7208417">,</span>&nbsp;<span class="ident" id="7208419"><a href="/gostd/database/sql/sql_test.go.html#7208086">db</a></span><span class="op" id="7208421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7208424">}</span><br>
<span class="lineno">1715</span><span class="op" id="7208426">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7208429">func</span>&nbsp;<span class="op" id="7208434">(</span><span class="ident" id="7208435">c</span>&nbsp;<span class="op" id="7208437">*</span><span class="ident" id="7208438"><a href="/gostd/database/sql/sql_test.go.html#7207979">concurrentRandomTest</a></span><span class="op" id="7208458">)</span>&nbsp;<span class="ident" id="7208460">finish</span><span class="op" id="7208466">(</span><span class="ident" id="7208467">t</span>&nbsp;<span class="ident" id="7208469"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7208476">.</span><span class="ident" id="7208477"><a href="/gostd/testing/testing.go.html#5476676">TB</a></span><span class="op" id="7208479">)</span>&nbsp;<span class="op" id="7208481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7208484">for</span>&nbsp;<span class="ident" id="7208488">_</span><span class="op" id="7208489">,</span>&nbsp;<span class="ident" id="7208491">ct</span>&nbsp;<span class="op" id="7208494">:=</span>&nbsp;<span class="keyword" id="7208497">range</span>&nbsp;<span class="ident" id="7208503"><a href="/gostd/database/sql/sql_test.go.html#7208435">c</a></span><span class="op" id="7208504">.</span><span class="ident" id="7208505"><a href="/gostd/database/sql/sql_test.go.html#7208010">tests</a></span>&nbsp;<span class="op" id="7208511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7208515"><a href="/gostd/database/sql/sql_test.go.html#7208491">ct</a></span><span class="op" id="7208517">.</span><span class="ident" id="7208518"><a href="/gostd/database/sql/sql_test.go.html#7203314">finish</a></span><span class="op" id="7208524">(</span><span class="ident" id="7208525"><a href="/gostd/database/sql/sql_test.go.html#7208467">t</a></span><span class="op" id="7208526">)</span><br>
<span class="lineno">1720</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7208529">}</span><br>
<span class="lineno"></span><span class="op" id="7208531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7208534">func</span>&nbsp;<span class="op" id="7208539">(</span><span class="ident" id="7208540">c</span>&nbsp;<span class="op" id="7208542">*</span><span class="ident" id="7208543"><a href="/gostd/database/sql/sql_test.go.html#7207979">concurrentRandomTest</a></span><span class="op" id="7208563">)</span>&nbsp;<span class="ident" id="7208565">test</span><span class="op" id="7208569">(</span><span class="ident" id="7208570">t</span>&nbsp;<span class="ident" id="7208572"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7208579">.</span><span class="ident" id="7208580"><a href="/gostd/testing/testing.go.html#5476676">TB</a></span><span class="op" id="7208582">)</span>&nbsp;<span class="builtintype" id="7208584">error</span>&nbsp;<span class="op" id="7208590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7208593">ct</span>&nbsp;<span class="op" id="7208596">:=</span>&nbsp;<span class="ident" id="7208599"><a href="/gostd/database/sql/sql_test.go.html#7208540">c</a></span><span class="op" id="7208600">.</span><span class="ident" id="7208601"><a href="/gostd/database/sql/sql_test.go.html#7208010">tests</a></span><span class="op" id="7208606">[</span><span class="ident" id="7208607"><a href="/gostd/database/sql/sql_test.go.html#7169079">rand</a></span><span class="op" id="7208611">.</span><span class="ident" id="7208612"><a href="/gostd/math/rand/rand.go.html#2927246">Intn</a></span><span class="op" id="7208616">(</span><span class="builtinfunc" id="7208617">len</span><span class="op" id="7208620">(</span><span class="ident" id="7208621"><a href="/gostd/database/sql/sql_test.go.html#7208540">c</a></span><span class="op" id="7208622">.</span><span class="ident" id="7208623"><a href="/gostd/database/sql/sql_test.go.html#7208010">tests</a></span><span class="op" id="7208628">)</span><span class="op" id="7208629">)</span><span class="op" id="7208630">]</span><br>
<span class="lineno">1725</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7208633">return</span>&nbsp;<span class="ident" id="7208640"><a href="/gostd/database/sql/sql_test.go.html#7208593">ct</a></span><span class="op" id="7208642">.</span><span class="ident" id="7208643"><a href="/gostd/database/sql/sql_test.go.html#7203336">test</a></span><span class="op" id="7208647">(</span><span class="ident" id="7208648"><a href="/gostd/database/sql/sql_test.go.html#7208570">t</a></span><span class="op" id="7208649">)</span><br>
<span class="lineno"></span><span class="op" id="7208651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7208654">func</span>&nbsp;<span class="ident" id="7208659">doConcurrentTest</span><span class="op" id="7208675">(</span><span class="ident" id="7208676">t</span>&nbsp;<span class="ident" id="7208678"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7208685">.</span><span class="ident" id="7208686"><a href="/gostd/testing/testing.go.html#5476676">TB</a></span><span class="op" id="7208688">,</span>&nbsp;<span class="ident" id="7208690">ct</span>&nbsp;<span class="ident" id="7208693"><a href="/gostd/database/sql/sql_test.go.html#7203258">concurrentTest</a></span><span class="op" id="7208707">)</span>&nbsp;<span class="op" id="7208709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7208712">maxProcs</span><span class="op" id="7208720">,</span>&nbsp;<span class="ident" id="7208722">numReqs</span>&nbsp;<span class="op" id="7208730">:=</span>&nbsp;<span class="num" id="7208733">1</span><span class="op" id="7208734">,</span>&nbsp;<span class="num" id="7208736">500</span><br>
<span class="lineno">1730</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7208741">if</span>&nbsp;<span class="ident" id="7208744"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7208751">.</span><span class="ident" id="7208752"><a href="/gostd/testing/testing.go.html#5475359">Short</a></span><span class="op" id="7208757">(</span><span class="op" id="7208758">)</span>&nbsp;<span class="op" id="7208760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7208764"><a href="/gostd/database/sql/sql_test.go.html#7208712">maxProcs</a></span><span class="op" id="7208772">,</span>&nbsp;<span class="ident" id="7208774"><a href="/gostd/database/sql/sql_test.go.html#7208722">numReqs</a></span>&nbsp;<span class="op" id="7208782">=</span>&nbsp;<span class="num" id="7208784">4</span><span class="op" id="7208785">,</span>&nbsp;<span class="num" id="7208787">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7208791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7208794">defer</span>&nbsp;<span class="ident" id="7208800"><a href="/gostd/database/sql/sql_test.go.html#7169103">runtime</a></span><span class="op" id="7208807">.</span><span class="ident" id="7208808"><a href="/gostd/runtime/debug.go.html#1521359">GOMAXPROCS</a></span><span class="op" id="7208818">(</span><span class="ident" id="7208819"><a href="/gostd/database/sql/sql_test.go.html#7169103">runtime</a></span><span class="op" id="7208826">.</span><span class="ident" id="7208827"><a href="/gostd/runtime/debug.go.html#1521359">GOMAXPROCS</a></span><span class="op" id="7208837">(</span><span class="ident" id="7208838"><a href="/gostd/database/sql/sql_test.go.html#7208712">maxProcs</a></span><span class="op" id="7208846">)</span><span class="op" id="7208847">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1735</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7208851">db</span>&nbsp;<span class="op" id="7208854">:=</span>&nbsp;<span class="ident" id="7208857"><a href="/gostd/database/sql/sql_test.go.html#7169849">newTestDB</a></span><span class="op" id="7208866">(</span><span class="ident" id="7208867"><a href="/gostd/database/sql/sql_test.go.html#7208676">t</a></span><span class="op" id="7208868">,</span>&nbsp;<span class="string" id="7208870">&#34;people&#34;</span><span class="op" id="7208878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7208881">defer</span>&nbsp;<span class="ident" id="7208887"><a href="/gostd/database/sql/sql_test.go.html#7170773">closeDB</a></span><span class="op" id="7208894">(</span><span class="ident" id="7208895"><a href="/gostd/database/sql/sql_test.go.html#7208676">t</a></span><span class="op" id="7208896">,</span>&nbsp;<span class="ident" id="7208898"><a href="/gostd/database/sql/sql_test.go.html#7208851">db</a></span><span class="op" id="7208900">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7208904"><a href="/gostd/database/sql/sql_test.go.html#7208690">ct</a></span><span class="op" id="7208906">.</span><span class="ident" id="7208907"><a href="/gostd/database/sql/sql_test.go.html#7203286">init</a></span><span class="op" id="7208911">(</span><span class="ident" id="7208912"><a href="/gostd/database/sql/sql_test.go.html#7208676">t</a></span><span class="op" id="7208913">,</span>&nbsp;<span class="ident" id="7208915"><a href="/gostd/database/sql/sql_test.go.html#7208851">db</a></span><span class="op" id="7208917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7208920">defer</span>&nbsp;<span class="ident" id="7208926"><a href="/gostd/database/sql/sql_test.go.html#7208690">ct</a></span><span class="op" id="7208928">.</span><span class="ident" id="7208929"><a href="/gostd/database/sql/sql_test.go.html#7203314">finish</a></span><span class="op" id="7208935">(</span><span class="ident" id="7208936"><a href="/gostd/database/sql/sql_test.go.html#7208676">t</a></span><span class="op" id="7208937">)</span><br>
<span class="lineno">1740</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7208941">var</span>&nbsp;<span class="ident" id="7208945">wg</span>&nbsp;<span class="ident" id="7208948"><a href="/gostd/database/sql/sql_test.go.html#7169125">sync</a></span><span class="op" id="7208952">.</span><span class="ident" id="7208953"><a href="/gostd/sync/waitgroup.go.html#1459933">WaitGroup</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7208964"><a href="/gostd/database/sql/sql_test.go.html#7208945">wg</a></span><span class="op" id="7208966">.</span><span class="ident" id="7208967"><a href="/gostd/sync/waitgroup.go.html#1461154">Add</a></span><span class="op" id="7208970">(</span><span class="ident" id="7208971"><a href="/gostd/database/sql/sql_test.go.html#7208722">numReqs</a></span><span class="op" id="7208978">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7208982">reqs</span>&nbsp;<span class="op" id="7208987">:=</span>&nbsp;<span class="builtinfunc" id="7208990">make</span><span class="op" id="7208994">(</span><span class="keyword" id="7208995">chan</span>&nbsp;<span class="builtintype" id="7209000">bool</span><span class="op" id="7209004">)</span><br>
<span class="lineno">1745</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7209007">defer</span>&nbsp;<span class="builtinfunc" id="7209013">close</span><span class="op" id="7209018">(</span><span class="ident" id="7209019"><a href="/gostd/database/sql/sql_test.go.html#7208982">reqs</a></span><span class="op" id="7209023">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7209027">for</span>&nbsp;<span class="ident" id="7209031">i</span>&nbsp;<span class="op" id="7209033">:=</span>&nbsp;<span class="num" id="7209036">0</span><span class="op" id="7209037">;</span>&nbsp;<span class="ident" id="7209039"><a href="/gostd/database/sql/sql_test.go.html#7209031">i</a></span>&nbsp;<span class="op" id="7209041">&lt;</span>&nbsp;<span class="ident" id="7209043"><a href="/gostd/database/sql/sql_test.go.html#7208712">maxProcs</a></span><span class="op" id="7209051">*</span><span class="num" id="7209052">2</span><span class="op" id="7209053">;</span>&nbsp;<span class="ident" id="7209055"><a href="/gostd/database/sql/sql_test.go.html#7209031">i</a></span><span class="op" id="7209056">++</span>&nbsp;<span class="op" id="7209059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7209063">go</span>&nbsp;<span class="keyword" id="7209066">func</span><span class="op" id="7209070">(</span><span class="op" id="7209071">)</span>&nbsp;<span class="op" id="7209073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7209078">for</span>&nbsp;<span class="keyword" id="7209082">range</span>&nbsp;<span class="ident" id="7209088"><a href="/gostd/database/sql/sql_test.go.html#7208982">reqs</a></span>&nbsp;<span class="op" id="7209093">{</span><br>
<span class="lineno">1750</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7209099">err</span>&nbsp;<span class="op" id="7209103">:=</span>&nbsp;<span class="ident" id="7209106"><a href="/gostd/database/sql/sql_test.go.html#7208690">ct</a></span><span class="op" id="7209108">.</span><span class="ident" id="7209109"><a href="/gostd/database/sql/sql_test.go.html#7203336">test</a></span><span class="op" id="7209113">(</span><span class="ident" id="7209114"><a href="/gostd/database/sql/sql_test.go.html#7208676">t</a></span><span class="op" id="7209115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7209121">if</span>&nbsp;<span class="ident" id="7209124"><a href="/gostd/database/sql/sql_test.go.html#7209099">err</a></span>&nbsp;<span class="op" id="7209128">!=</span>&nbsp;<span class="builtintype" id="7209131">nil</span>&nbsp;<span class="op" id="7209135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7209142"><a href="/gostd/database/sql/sql_test.go.html#7208945">wg</a></span><span class="op" id="7209144">.</span><span class="ident" id="7209145"><a href="/gostd/sync/waitgroup.go.html#1462065">Done</a></span><span class="op" id="7209149">(</span><span class="op" id="7209150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7209157">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7209170">}</span><br>
<span class="lineno">1755</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7209176"><a href="/gostd/database/sql/sql_test.go.html#7208945">wg</a></span><span class="op" id="7209178">.</span><span class="ident" id="7209179"><a href="/gostd/sync/waitgroup.go.html#1462065">Done</a></span><span class="op" id="7209183">(</span><span class="op" id="7209184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7209189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7209193">}</span><span class="op" id="7209194">(</span><span class="op" id="7209195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7209198">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1760</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7209202">for</span>&nbsp;<span class="ident" id="7209206">i</span>&nbsp;<span class="op" id="7209208">:=</span>&nbsp;<span class="num" id="7209211">0</span><span class="op" id="7209212">;</span>&nbsp;<span class="ident" id="7209214"><a href="/gostd/database/sql/sql_test.go.html#7209206">i</a></span>&nbsp;<span class="op" id="7209216">&lt;</span>&nbsp;<span class="ident" id="7209218"><a href="/gostd/database/sql/sql_test.go.html#7208722">numReqs</a></span><span class="op" id="7209225">;</span>&nbsp;<span class="ident" id="7209227"><a href="/gostd/database/sql/sql_test.go.html#7209206">i</a></span><span class="op" id="7209228">++</span>&nbsp;<span class="op" id="7209231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7209235"><a href="/gostd/database/sql/sql_test.go.html#7208982">reqs</a></span>&nbsp;<span class="op" id="7209240">&lt;-</span>&nbsp;<span class="builtintype" id="7209243">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7209249">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7209253"><a href="/gostd/database/sql/sql_test.go.html#7208945">wg</a></span><span class="op" id="7209255">.</span><span class="ident" id="7209256"><a href="/gostd/sync/waitgroup.go.html#1462162">Wait</a></span><span class="op" id="7209260">(</span><span class="op" id="7209261">)</span><br>
<span class="lineno">1765</span><span class="op" id="7209263">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7209266">func</span>&nbsp;<span class="ident" id="7209271">manyConcurrentQueries</span><span class="op" id="7209292">(</span><span class="ident" id="7209293">t</span>&nbsp;<span class="ident" id="7209295"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7209302">.</span><span class="ident" id="7209303"><a href="/gostd/testing/testing.go.html#5476676">TB</a></span><span class="op" id="7209305">)</span>&nbsp;<span class="op" id="7209307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7209310">maxProcs</span><span class="op" id="7209318">,</span>&nbsp;<span class="ident" id="7209320">numReqs</span>&nbsp;<span class="op" id="7209328">:=</span>&nbsp;<span class="num" id="7209331">16</span><span class="op" id="7209333">,</span>&nbsp;<span class="num" id="7209335">500</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7209340">if</span>&nbsp;<span class="ident" id="7209343"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7209350">.</span><span class="ident" id="7209351"><a href="/gostd/testing/testing.go.html#5475359">Short</a></span><span class="op" id="7209356">(</span><span class="op" id="7209357">)</span>&nbsp;<span class="op" id="7209359">{</span><br>
<span class="lineno">1770</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7209363"><a href="/gostd/database/sql/sql_test.go.html#7209310">maxProcs</a></span><span class="op" id="7209371">,</span>&nbsp;<span class="ident" id="7209373"><a href="/gostd/database/sql/sql_test.go.html#7209320">numReqs</a></span>&nbsp;<span class="op" id="7209381">=</span>&nbsp;<span class="num" id="7209383">4</span><span class="op" id="7209384">,</span>&nbsp;<span class="num" id="7209386">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7209390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7209393">defer</span>&nbsp;<span class="ident" id="7209399"><a href="/gostd/database/sql/sql_test.go.html#7169103">runtime</a></span><span class="op" id="7209406">.</span><span class="ident" id="7209407"><a href="/gostd/runtime/debug.go.html#1521359">GOMAXPROCS</a></span><span class="op" id="7209417">(</span><span class="ident" id="7209418"><a href="/gostd/database/sql/sql_test.go.html#7169103">runtime</a></span><span class="op" id="7209425">.</span><span class="ident" id="7209426"><a href="/gostd/runtime/debug.go.html#1521359">GOMAXPROCS</a></span><span class="op" id="7209436">(</span><span class="ident" id="7209437"><a href="/gostd/database/sql/sql_test.go.html#7209310">maxProcs</a></span><span class="op" id="7209445">)</span><span class="op" id="7209446">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7209450">db</span>&nbsp;<span class="op" id="7209453">:=</span>&nbsp;<span class="ident" id="7209456"><a href="/gostd/database/sql/sql_test.go.html#7169849">newTestDB</a></span><span class="op" id="7209465">(</span><span class="ident" id="7209466"><a href="/gostd/database/sql/sql_test.go.html#7209293">t</a></span><span class="op" id="7209467">,</span>&nbsp;<span class="string" id="7209469">&#34;people&#34;</span><span class="op" id="7209477">)</span><br>
<span class="lineno">1775</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7209480">defer</span>&nbsp;<span class="ident" id="7209486"><a href="/gostd/database/sql/sql_test.go.html#7170773">closeDB</a></span><span class="op" id="7209493">(</span><span class="ident" id="7209494"><a href="/gostd/database/sql/sql_test.go.html#7209293">t</a></span><span class="op" id="7209495">,</span>&nbsp;<span class="ident" id="7209497"><a href="/gostd/database/sql/sql_test.go.html#7209450">db</a></span><span class="op" id="7209499">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7209503">stmt</span><span class="op" id="7209507">,</span>&nbsp;<span class="ident" id="7209509">err</span>&nbsp;<span class="op" id="7209513">:=</span>&nbsp;<span class="ident" id="7209516"><a href="/gostd/database/sql/sql_test.go.html#7209450">db</a></span><span class="op" id="7209518">.</span><span class="ident" id="7209519"><a href="/gostd/database/sql/sql.go.html#5223860">Prepare</a></span><span class="op" id="7209526">(</span><span class="string" id="7209527">&#34;SELECT|people|name|&#34;</span><span class="op" id="7209548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7209551">if</span>&nbsp;<span class="ident" id="7209554"><a href="/gostd/database/sql/sql_test.go.html#7209509">err</a></span>&nbsp;<span class="op" id="7209558">!=</span>&nbsp;<span class="builtintype" id="7209561">nil</span>&nbsp;<span class="op" id="7209565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7209569"><a href="/gostd/database/sql/sql_test.go.html#7209293">t</a></span><span class="op" id="7209570">.</span><span class="ident" id="7209571"><a href="/gostd/testing/testing.go.html#5476798">Fatal</a></span><span class="op" id="7209576">(</span><span class="ident" id="7209577"><a href="/gostd/database/sql/sql_test.go.html#7209509">err</a></span><span class="op" id="7209580">)</span><br>
<span class="lineno">1780</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7209583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7209586">defer</span>&nbsp;<span class="ident" id="7209592"><a href="/gostd/database/sql/sql_test.go.html#7209503">stmt</a></span><span class="op" id="7209596">.</span><span class="ident" id="7209597"><a href="/gostd/database/sql/sql.go.html#5240529">Close</a></span><span class="op" id="7209602">(</span><span class="op" id="7209603">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7209607">var</span>&nbsp;<span class="ident" id="7209611">wg</span>&nbsp;<span class="ident" id="7209614"><a href="/gostd/database/sql/sql_test.go.html#7169125">sync</a></span><span class="op" id="7209618">.</span><span class="ident" id="7209619"><a href="/gostd/sync/waitgroup.go.html#1459933">WaitGroup</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7209630"><a href="/gostd/database/sql/sql_test.go.html#7209611">wg</a></span><span class="op" id="7209632">.</span><span class="ident" id="7209633"><a href="/gostd/sync/waitgroup.go.html#1461154">Add</a></span><span class="op" id="7209636">(</span><span class="ident" id="7209637"><a href="/gostd/database/sql/sql_test.go.html#7209320">numReqs</a></span><span class="op" id="7209644">)</span><br>
<span class="lineno">1785</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7209648">reqs</span>&nbsp;<span class="op" id="7209653">:=</span>&nbsp;<span class="builtinfunc" id="7209656">make</span><span class="op" id="7209660">(</span><span class="keyword" id="7209661">chan</span>&nbsp;<span class="builtintype" id="7209666">bool</span><span class="op" id="7209670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7209673">defer</span>&nbsp;<span class="builtinfunc" id="7209679">close</span><span class="op" id="7209684">(</span><span class="ident" id="7209685"><a href="/gostd/database/sql/sql_test.go.html#7209648">reqs</a></span><span class="op" id="7209689">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7209693">for</span>&nbsp;<span class="ident" id="7209697">i</span>&nbsp;<span class="op" id="7209699">:=</span>&nbsp;<span class="num" id="7209702">0</span><span class="op" id="7209703">;</span>&nbsp;<span class="ident" id="7209705"><a href="/gostd/database/sql/sql_test.go.html#7209697">i</a></span>&nbsp;<span class="op" id="7209707">&lt;</span>&nbsp;<span class="ident" id="7209709"><a href="/gostd/database/sql/sql_test.go.html#7209310">maxProcs</a></span><span class="op" id="7209717">*</span><span class="num" id="7209718">2</span><span class="op" id="7209719">;</span>&nbsp;<span class="ident" id="7209721"><a href="/gostd/database/sql/sql_test.go.html#7209697">i</a></span><span class="op" id="7209722">++</span>&nbsp;<span class="op" id="7209725">{</span><br>
<span class="lineno">1790</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7209729">go</span>&nbsp;<span class="keyword" id="7209732">func</span><span class="op" id="7209736">(</span><span class="op" id="7209737">)</span>&nbsp;<span class="op" id="7209739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7209744">for</span>&nbsp;<span class="keyword" id="7209748">range</span>&nbsp;<span class="ident" id="7209754"><a href="/gostd/database/sql/sql_test.go.html#7209648">reqs</a></span>&nbsp;<span class="op" id="7209759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7209765">rows</span><span class="op" id="7209769">,</span>&nbsp;<span class="ident" id="7209771">err</span>&nbsp;<span class="op" id="7209775">:=</span>&nbsp;<span class="ident" id="7209778"><a href="/gostd/database/sql/sql_test.go.html#7209503">stmt</a></span><span class="op" id="7209782">.</span><span class="ident" id="7209783"><a href="/gostd/database/sql/sql.go.html#5238423">Query</a></span><span class="op" id="7209788">(</span><span class="op" id="7209789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7209795">if</span>&nbsp;<span class="ident" id="7209798"><a href="/gostd/database/sql/sql_test.go.html#7209771">err</a></span>&nbsp;<span class="op" id="7209802">!=</span>&nbsp;<span class="builtintype" id="7209805">nil</span>&nbsp;<span class="op" id="7209809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7209816"><a href="/gostd/database/sql/sql_test.go.html#7209293">t</a></span><span class="op" id="7209817">.</span><span class="ident" id="7209818"><a href="/gostd/testing/testing.go.html#5476720">Errorf</a></span><span class="op" id="7209824">(</span><span class="string" id="7209825">&#34;error&nbsp;on&nbsp;query:&nbsp;&nbsp;%v&#34;</span><span class="op" id="7209846">,</span>&nbsp;<span class="ident" id="7209848"><a href="/gostd/database/sql/sql_test.go.html#7209771">err</a></span><span class="op" id="7209851">)</span><br>
<span class="lineno">1795</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7209858"><a href="/gostd/database/sql/sql_test.go.html#7209611">wg</a></span><span class="op" id="7209860">.</span><span class="ident" id="7209861"><a href="/gostd/sync/waitgroup.go.html#1462065">Done</a></span><span class="op" id="7209865">(</span><span class="op" id="7209866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7209873">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7209886">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7209893">var</span>&nbsp;<span class="ident" id="7209897">name</span>&nbsp;<span class="builtintype" id="7209902">string</span><br>
<span class="lineno">1800</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7209913">for</span>&nbsp;<span class="ident" id="7209917"><a href="/gostd/database/sql/sql_test.go.html#7209765">rows</a></span><span class="op" id="7209921">.</span><span class="ident" id="7209922"><a href="/gostd/database/sql/sql.go.html#5242163">Next</a></span><span class="op" id="7209926">(</span><span class="op" id="7209927">)</span>&nbsp;<span class="op" id="7209929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7209936"><a href="/gostd/database/sql/sql_test.go.html#7209765">rows</a></span><span class="op" id="7209940">.</span><span class="ident" id="7209941"><a href="/gostd/database/sql/sql.go.html#5243651">Scan</a></span><span class="op" id="7209945">(</span><span class="op" id="7209946">&amp;</span><span class="ident" id="7209947"><a href="/gostd/database/sql/sql_test.go.html#7209897">name</a></span><span class="op" id="7209951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7209957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7209963"><a href="/gostd/database/sql/sql_test.go.html#7209765">rows</a></span><span class="op" id="7209967">.</span><span class="ident" id="7209968"><a href="/gostd/database/sql/sql.go.html#5244447">Close</a></span><span class="op" id="7209973">(</span><span class="op" id="7209974">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1805</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7209981"><a href="/gostd/database/sql/sql_test.go.html#7209611">wg</a></span><span class="op" id="7209983">.</span><span class="ident" id="7209984"><a href="/gostd/sync/waitgroup.go.html#1462065">Done</a></span><span class="op" id="7209988">(</span><span class="op" id="7209989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7209994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7209998">}</span><span class="op" id="7209999">(</span><span class="op" id="7210000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7210003">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1810</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7210007">for</span>&nbsp;<span class="ident" id="7210011">i</span>&nbsp;<span class="op" id="7210013">:=</span>&nbsp;<span class="num" id="7210016">0</span><span class="op" id="7210017">;</span>&nbsp;<span class="ident" id="7210019"><a href="/gostd/database/sql/sql_test.go.html#7210011">i</a></span>&nbsp;<span class="op" id="7210021">&lt;</span>&nbsp;<span class="ident" id="7210023"><a href="/gostd/database/sql/sql_test.go.html#7209320">numReqs</a></span><span class="op" id="7210030">;</span>&nbsp;<span class="ident" id="7210032"><a href="/gostd/database/sql/sql_test.go.html#7210011">i</a></span><span class="op" id="7210033">++</span>&nbsp;<span class="op" id="7210036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7210040"><a href="/gostd/database/sql/sql_test.go.html#7209648">reqs</a></span>&nbsp;<span class="op" id="7210045">&lt;-</span>&nbsp;<span class="builtintype" id="7210048">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7210054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7210058"><a href="/gostd/database/sql/sql_test.go.html#7209611">wg</a></span><span class="op" id="7210060">.</span><span class="ident" id="7210061"><a href="/gostd/sync/waitgroup.go.html#1462162">Wait</a></span><span class="op" id="7210065">(</span><span class="op" id="7210066">)</span><br>
<span class="lineno">1815</span><span class="op" id="7210068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7210071">func</span>&nbsp;<span class="ident" id="7210076">TestIssue6081</span><span class="op" id="7210089">(</span><span class="ident" id="7210090">t</span>&nbsp;<span class="op" id="7210092">*</span><span class="ident" id="7210093"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7210100">.</span><span class="ident" id="7210101"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7210102">)</span>&nbsp;<span class="op" id="7210104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7210107">db</span>&nbsp;<span class="op" id="7210110">:=</span>&nbsp;<span class="ident" id="7210113"><a href="/gostd/database/sql/sql_test.go.html#7169849">newTestDB</a></span><span class="op" id="7210122">(</span><span class="ident" id="7210123"><a href="/gostd/database/sql/sql_test.go.html#7210090">t</a></span><span class="op" id="7210124">,</span>&nbsp;<span class="string" id="7210126">&#34;people&#34;</span><span class="op" id="7210134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7210137">defer</span>&nbsp;<span class="ident" id="7210143"><a href="/gostd/database/sql/sql_test.go.html#7170773">closeDB</a></span><span class="op" id="7210150">(</span><span class="ident" id="7210151"><a href="/gostd/database/sql/sql_test.go.html#7210090">t</a></span><span class="op" id="7210152">,</span>&nbsp;<span class="ident" id="7210154"><a href="/gostd/database/sql/sql_test.go.html#7210107">db</a></span><span class="op" id="7210156">)</span><br>
<span class="lineno">1820</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7210160">drv</span>&nbsp;<span class="op" id="7210164">:=</span>&nbsp;<span class="ident" id="7210167"><a href="/gostd/database/sql/sql_test.go.html#7210107">db</a></span><span class="op" id="7210169">.</span><span class="ident" id="7210170"><a href="/gostd/database/sql/sql.go.html#5207171">driver</a></span><span class="op" id="7210176">.</span><span class="op" id="7210177">(</span><span class="op" id="7210178">*</span><span class="ident" id="7210179"><a href="/gostd/database/sql/fakedb_test.go.html#7149380">fakeDriver</a></span><span class="op" id="7210189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7210192"><a href="/gostd/database/sql/sql_test.go.html#7210160">drv</a></span><span class="op" id="7210195">.</span><span class="ident" id="7210196"><a href="/gostd/database/sql/fakedb_test.go.html#7149401">mu</a></span><span class="op" id="7210198">.</span><span class="ident" id="7210199"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="7210203">(</span><span class="op" id="7210204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7210207">opens0</span>&nbsp;<span class="op" id="7210214">:=</span>&nbsp;<span class="ident" id="7210217"><a href="/gostd/database/sql/sql_test.go.html#7210160">drv</a></span><span class="op" id="7210220">.</span><span class="ident" id="7210221"><a href="/gostd/database/sql/fakedb_test.go.html#7149453">openCount</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7210232">closes0</span>&nbsp;<span class="op" id="7210240">:=</span>&nbsp;<span class="ident" id="7210243"><a href="/gostd/database/sql/sql_test.go.html#7210160">drv</a></span><span class="op" id="7210246">.</span><span class="ident" id="7210247"><a href="/gostd/database/sql/fakedb_test.go.html#7149490">closeCount</a></span><br>
<span class="lineno">1825</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7210259"><a href="/gostd/database/sql/sql_test.go.html#7210160">drv</a></span><span class="op" id="7210262">.</span><span class="ident" id="7210263"><a href="/gostd/database/sql/fakedb_test.go.html#7149401">mu</a></span><span class="op" id="7210265">.</span><span class="ident" id="7210266"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="7210272">(</span><span class="op" id="7210273">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7210277">stmt</span><span class="op" id="7210281">,</span>&nbsp;<span class="ident" id="7210283">err</span>&nbsp;<span class="op" id="7210287">:=</span>&nbsp;<span class="ident" id="7210290"><a href="/gostd/database/sql/sql_test.go.html#7210107">db</a></span><span class="op" id="7210292">.</span><span class="ident" id="7210293"><a href="/gostd/database/sql/sql.go.html#5223860">Prepare</a></span><span class="op" id="7210300">(</span><span class="string" id="7210301">&#34;SELECT|people|name|&#34;</span><span class="op" id="7210322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7210325">if</span>&nbsp;<span class="ident" id="7210328"><a href="/gostd/database/sql/sql_test.go.html#7210283">err</a></span>&nbsp;<span class="op" id="7210332">!=</span>&nbsp;<span class="builtintype" id="7210335">nil</span>&nbsp;<span class="op" id="7210339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7210343"><a href="/gostd/database/sql/sql_test.go.html#7210090">t</a></span><span class="op" id="7210344">.</span><span class="ident" id="7210345"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="7210350">(</span><span class="ident" id="7210351"><a href="/gostd/database/sql/sql_test.go.html#7210283">err</a></span><span class="op" id="7210354">)</span><br>
<span class="lineno">1830</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7210357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7210360"><a href="/gostd/database/sql/sql.go.html#5244168">rowsCloseHook</a></span>&nbsp;<span class="op" id="7210374">=</span>&nbsp;<span class="keyword" id="7210376">func</span><span class="op" id="7210380">(</span><span class="ident" id="7210381">rows</span>&nbsp;<span class="op" id="7210386">*</span><span class="ident" id="7210387"><a href="/gostd/database/sql/sql.go.html#5241499">Rows</a></span><span class="op" id="7210391">,</span>&nbsp;<span class="ident" id="7210393">err</span>&nbsp;<span class="op" id="7210397">*</span><span class="builtintype" id="7210398">error</span><span class="op" id="7210403">)</span>&nbsp;<span class="op" id="7210405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7210409">*</span><span class="ident" id="7210410"><a href="/gostd/database/sql/sql_test.go.html#7210393">err</a></span>&nbsp;<span class="op" id="7210414">=</span>&nbsp;<span class="ident" id="7210416"><a href="/gostd/database/sql/sql_test.go.html#7169039">driver</a></span><span class="op" id="7210422">.</span><span class="ident" id="7210423"><a href="/gostd/database/sql/driver/driver.go.html#5249402">ErrBadConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7210435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7210438">defer</span>&nbsp;<span class="keyword" id="7210444">func</span><span class="op" id="7210448">(</span><span class="op" id="7210449">)</span>&nbsp;<span class="op" id="7210451">{</span>&nbsp;<span class="ident" id="7210453"><a href="/gostd/database/sql/sql.go.html#5244168">rowsCloseHook</a></span>&nbsp;<span class="op" id="7210467">=</span>&nbsp;<span class="builtintype" id="7210469">nil</span>&nbsp;<span class="op" id="7210473">}</span><span class="op" id="7210474">(</span><span class="op" id="7210475">)</span><br>
<span class="lineno">1835</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7210478">for</span>&nbsp;<span class="ident" id="7210482">i</span>&nbsp;<span class="op" id="7210484">:=</span>&nbsp;<span class="num" id="7210487">0</span><span class="op" id="7210488">;</span>&nbsp;<span class="ident" id="7210490"><a href="/gostd/database/sql/sql_test.go.html#7210482">i</a></span>&nbsp;<span class="op" id="7210492">&lt;</span>&nbsp;<span class="num" id="7210494">10</span><span class="op" id="7210496">;</span>&nbsp;<span class="ident" id="7210498"><a href="/gostd/database/sql/sql_test.go.html#7210482">i</a></span><span class="op" id="7210499">++</span>&nbsp;<span class="op" id="7210502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7210506">rows</span><span class="op" id="7210510">,</span>&nbsp;<span class="ident" id="7210512">err</span>&nbsp;<span class="op" id="7210516">:=</span>&nbsp;<span class="ident" id="7210519"><a href="/gostd/database/sql/sql_test.go.html#7210277">stmt</a></span><span class="op" id="7210523">.</span><span class="ident" id="7210524"><a href="/gostd/database/sql/sql.go.html#5238423">Query</a></span><span class="op" id="7210529">(</span><span class="op" id="7210530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7210534">if</span>&nbsp;<span class="ident" id="7210537"><a href="/gostd/database/sql/sql_test.go.html#7210512">err</a></span>&nbsp;<span class="op" id="7210541">!=</span>&nbsp;<span class="builtintype" id="7210544">nil</span>&nbsp;<span class="op" id="7210548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7210553"><a href="/gostd/database/sql/sql_test.go.html#7210090">t</a></span><span class="op" id="7210554">.</span><span class="ident" id="7210555"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="7210560">(</span><span class="ident" id="7210561"><a href="/gostd/database/sql/sql_test.go.html#7210512">err</a></span><span class="op" id="7210564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7210568">}</span><br>
<span class="lineno">1840</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7210572"><a href="/gostd/database/sql/sql_test.go.html#7210506">rows</a></span><span class="op" id="7210576">.</span><span class="ident" id="7210577"><a href="/gostd/database/sql/sql.go.html#5244447">Close</a></span><span class="op" id="7210582">(</span><span class="op" id="7210583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7210586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7210589">if</span>&nbsp;<span class="ident" id="7210592">n</span>&nbsp;<span class="op" id="7210594">:=</span>&nbsp;<span class="builtinfunc" id="7210597">len</span><span class="op" id="7210600">(</span><span class="ident" id="7210601"><a href="/gostd/database/sql/sql_test.go.html#7210277">stmt</a></span><span class="op" id="7210605">.</span><span class="ident" id="7210606"><a href="/gostd/database/sql/sql.go.html#5235080">css</a></span><span class="op" id="7210609">)</span><span class="op" id="7210610">;</span>&nbsp;<span class="ident" id="7210612"><a href="/gostd/database/sql/sql_test.go.html#7210592">n</a></span>&nbsp;<span class="op" id="7210614">&gt;</span>&nbsp;<span class="num" id="7210616">1</span>&nbsp;<span class="op" id="7210618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7210622"><a href="/gostd/database/sql/sql_test.go.html#7210090">t</a></span><span class="op" id="7210623">.</span><span class="ident" id="7210624"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7210630">(</span><span class="string" id="7210631">&#34;len(css&nbsp;slice)&nbsp;=&nbsp;%d;&nbsp;want&nbsp;&lt;=&nbsp;1&#34;</span><span class="op" id="7210663">,</span>&nbsp;<span class="ident" id="7210665"><a href="/gostd/database/sql/sql_test.go.html#7210592">n</a></span><span class="op" id="7210666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7210669">}</span><br>
<span class="lineno">1845</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7210672"><a href="/gostd/database/sql/sql_test.go.html#7210277">stmt</a></span><span class="op" id="7210676">.</span><span class="ident" id="7210677"><a href="/gostd/database/sql/sql.go.html#5240529">Close</a></span><span class="op" id="7210682">(</span><span class="op" id="7210683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7210686">if</span>&nbsp;<span class="ident" id="7210689">n</span>&nbsp;<span class="op" id="7210691">:=</span>&nbsp;<span class="builtinfunc" id="7210694">len</span><span class="op" id="7210697">(</span><span class="ident" id="7210698"><a href="/gostd/database/sql/sql_test.go.html#7210277">stmt</a></span><span class="op" id="7210702">.</span><span class="ident" id="7210703"><a href="/gostd/database/sql/sql.go.html#5235080">css</a></span><span class="op" id="7210706">)</span><span class="op" id="7210707">;</span>&nbsp;<span class="ident" id="7210709"><a href="/gostd/database/sql/sql_test.go.html#7210689">n</a></span>&nbsp;<span class="op" id="7210711">!=</span>&nbsp;<span class="num" id="7210714">0</span>&nbsp;<span class="op" id="7210716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7210720"><a href="/gostd/database/sql/sql_test.go.html#7210090">t</a></span><span class="op" id="7210721">.</span><span class="ident" id="7210722"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7210728">(</span><span class="string" id="7210729">&#34;len(css&nbsp;slice)&nbsp;after&nbsp;Close&nbsp;=&nbsp;%d;&nbsp;want&nbsp;0&#34;</span><span class="op" id="7210770">,</span>&nbsp;<span class="ident" id="7210772"><a href="/gostd/database/sql/sql_test.go.html#7210689">n</a></span><span class="op" id="7210773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7210776">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1850</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7210780"><a href="/gostd/database/sql/sql_test.go.html#7210160">drv</a></span><span class="op" id="7210783">.</span><span class="ident" id="7210784"><a href="/gostd/database/sql/fakedb_test.go.html#7149401">mu</a></span><span class="op" id="7210786">.</span><span class="ident" id="7210787"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="7210791">(</span><span class="op" id="7210792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7210795">opens</span>&nbsp;<span class="op" id="7210801">:=</span>&nbsp;<span class="ident" id="7210804"><a href="/gostd/database/sql/sql_test.go.html#7210160">drv</a></span><span class="op" id="7210807">.</span><span class="ident" id="7210808"><a href="/gostd/database/sql/fakedb_test.go.html#7149453">openCount</a></span>&nbsp;<span class="op" id="7210818">-</span>&nbsp;<span class="ident" id="7210820"><a href="/gostd/database/sql/sql_test.go.html#7210207">opens0</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7210828">closes</span>&nbsp;<span class="op" id="7210835">:=</span>&nbsp;<span class="ident" id="7210838"><a href="/gostd/database/sql/sql_test.go.html#7210160">drv</a></span><span class="op" id="7210841">.</span><span class="ident" id="7210842"><a href="/gostd/database/sql/fakedb_test.go.html#7149490">closeCount</a></span>&nbsp;<span class="op" id="7210853">-</span>&nbsp;<span class="ident" id="7210855"><a href="/gostd/database/sql/sql_test.go.html#7210232">closes0</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7210864"><a href="/gostd/database/sql/sql_test.go.html#7210160">drv</a></span><span class="op" id="7210867">.</span><span class="ident" id="7210868"><a href="/gostd/database/sql/fakedb_test.go.html#7149401">mu</a></span><span class="op" id="7210870">.</span><span class="ident" id="7210871"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="7210877">(</span><span class="op" id="7210878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7210881">if</span>&nbsp;<span class="ident" id="7210884"><a href="/gostd/database/sql/sql_test.go.html#7210795">opens</a></span>&nbsp;<span class="op" id="7210890">&lt;</span>&nbsp;<span class="num" id="7210892">9</span>&nbsp;<span class="op" id="7210894">{</span><br>
<span class="lineno">1855</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7210898"><a href="/gostd/database/sql/sql_test.go.html#7210090">t</a></span><span class="op" id="7210899">.</span><span class="ident" id="7210900"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7210906">(</span><span class="string" id="7210907">&#34;opens&nbsp;=&nbsp;%d;&nbsp;want&nbsp;&gt;=&nbsp;9&#34;</span><span class="op" id="7210930">,</span>&nbsp;<span class="ident" id="7210932"><a href="/gostd/database/sql/sql_test.go.html#7210795">opens</a></span><span class="op" id="7210937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7210940">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7210943">if</span>&nbsp;<span class="ident" id="7210946"><a href="/gostd/database/sql/sql_test.go.html#7210828">closes</a></span>&nbsp;<span class="op" id="7210953">&lt;</span>&nbsp;<span class="num" id="7210955">9</span>&nbsp;<span class="op" id="7210957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7210961"><a href="/gostd/database/sql/sql_test.go.html#7210090">t</a></span><span class="op" id="7210962">.</span><span class="ident" id="7210963"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7210969">(</span><span class="string" id="7210970">&#34;closes&nbsp;=&nbsp;%d;&nbsp;want&nbsp;&gt;=&nbsp;9&#34;</span><span class="op" id="7210994">,</span>&nbsp;<span class="ident" id="7210996"><a href="/gostd/database/sql/sql_test.go.html#7210828">closes</a></span><span class="op" id="7211002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7211005">}</span><br>
<span class="lineno">1860</span><span class="op" id="7211007">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7211010">func</span>&nbsp;<span class="ident" id="7211015">TestConcurrency</span><span class="op" id="7211030">(</span><span class="ident" id="7211031">t</span>&nbsp;<span class="op" id="7211033">*</span><span class="ident" id="7211034"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7211041">.</span><span class="ident" id="7211042"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7211043">)</span>&nbsp;<span class="op" id="7211045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7211048"><a href="/gostd/database/sql/sql_test.go.html#7208659">doConcurrentTest</a></span><span class="op" id="7211064">(</span><span class="ident" id="7211065"><a href="/gostd/database/sql/sql_test.go.html#7211031">t</a></span><span class="op" id="7211066">,</span>&nbsp;<span class="builtinfunc" id="7211068">new</span><span class="op" id="7211071">(</span><span class="ident" id="7211072"><a href="/gostd/database/sql/sql_test.go.html#7203369">concurrentDBQueryTest</a></span><span class="op" id="7211093">)</span><span class="op" id="7211094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7211097"><a href="/gostd/database/sql/sql_test.go.html#7208659">doConcurrentTest</a></span><span class="op" id="7211113">(</span><span class="ident" id="7211114"><a href="/gostd/database/sql/sql_test.go.html#7211031">t</a></span><span class="op" id="7211115">,</span>&nbsp;<span class="builtinfunc" id="7211117">new</span><span class="op" id="7211120">(</span><span class="ident" id="7211121"><a href="/gostd/database/sql/sql_test.go.html#7203803">concurrentDBExecTest</a></span><span class="op" id="7211141">)</span><span class="op" id="7211142">)</span><br>
<span class="lineno">1865</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7211145"><a href="/gostd/database/sql/sql_test.go.html#7208659">doConcurrentTest</a></span><span class="op" id="7211161">(</span><span class="ident" id="7211162"><a href="/gostd/database/sql/sql_test.go.html#7211031">t</a></span><span class="op" id="7211163">,</span>&nbsp;<span class="builtinfunc" id="7211165">new</span><span class="op" id="7211168">(</span><span class="ident" id="7211169"><a href="/gostd/database/sql/sql_test.go.html#7204207">concurrentStmtQueryTest</a></span><span class="op" id="7211192">)</span><span class="op" id="7211193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7211196"><a href="/gostd/database/sql/sql_test.go.html#7208659">doConcurrentTest</a></span><span class="op" id="7211212">(</span><span class="ident" id="7211213"><a href="/gostd/database/sql/sql_test.go.html#7211031">t</a></span><span class="op" id="7211214">,</span>&nbsp;<span class="builtinfunc" id="7211216">new</span><span class="op" id="7211219">(</span><span class="ident" id="7211220"><a href="/gostd/database/sql/sql_test.go.html#7204823">concurrentStmtExecTest</a></span><span class="op" id="7211242">)</span><span class="op" id="7211243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7211246"><a href="/gostd/database/sql/sql_test.go.html#7208659">doConcurrentTest</a></span><span class="op" id="7211262">(</span><span class="ident" id="7211263"><a href="/gostd/database/sql/sql_test.go.html#7211031">t</a></span><span class="op" id="7211264">,</span>&nbsp;<span class="builtinfunc" id="7211266">new</span><span class="op" id="7211269">(</span><span class="ident" id="7211270"><a href="/gostd/database/sql/sql_test.go.html#7205405">concurrentTxQueryTest</a></span><span class="op" id="7211291">)</span><span class="op" id="7211292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7211295"><a href="/gostd/database/sql/sql_test.go.html#7208659">doConcurrentTest</a></span><span class="op" id="7211311">(</span><span class="ident" id="7211312"><a href="/gostd/database/sql/sql_test.go.html#7211031">t</a></span><span class="op" id="7211313">,</span>&nbsp;<span class="builtinfunc" id="7211315">new</span><span class="op" id="7211318">(</span><span class="ident" id="7211319"><a href="/gostd/database/sql/sql_test.go.html#7205975">concurrentTxExecTest</a></span><span class="op" id="7211339">)</span><span class="op" id="7211340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7211343"><a href="/gostd/database/sql/sql_test.go.html#7208659">doConcurrentTest</a></span><span class="op" id="7211359">(</span><span class="ident" id="7211360"><a href="/gostd/database/sql/sql_test.go.html#7211031">t</a></span><span class="op" id="7211361">,</span>&nbsp;<span class="builtinfunc" id="7211363">new</span><span class="op" id="7211366">(</span><span class="ident" id="7211367"><a href="/gostd/database/sql/sql_test.go.html#7206515">concurrentTxStmtQueryTest</a></span><span class="op" id="7211392">)</span><span class="op" id="7211393">)</span><br>
<span class="lineno">1870</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7211396"><a href="/gostd/database/sql/sql_test.go.html#7208659">doConcurrentTest</a></span><span class="op" id="7211412">(</span><span class="ident" id="7211413"><a href="/gostd/database/sql/sql_test.go.html#7211031">t</a></span><span class="op" id="7211414">,</span>&nbsp;<span class="builtinfunc" id="7211416">new</span><span class="op" id="7211419">(</span><span class="ident" id="7211420"><a href="/gostd/database/sql/sql_test.go.html#7207264">concurrentTxStmtExecTest</a></span><span class="op" id="7211444">)</span><span class="op" id="7211445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7211448"><a href="/gostd/database/sql/sql_test.go.html#7208659">doConcurrentTest</a></span><span class="op" id="7211464">(</span><span class="ident" id="7211465"><a href="/gostd/database/sql/sql_test.go.html#7211031">t</a></span><span class="op" id="7211466">,</span>&nbsp;<span class="builtinfunc" id="7211468">new</span><span class="op" id="7211471">(</span><span class="ident" id="7211472"><a href="/gostd/database/sql/sql_test.go.html#7207979">concurrentRandomTest</a></span><span class="op" id="7211492">)</span><span class="op" id="7211493">)</span><br>
<span class="lineno"></span><span class="op" id="7211495">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7211498">func</span>&nbsp;<span class="ident" id="7211503">TestConnectionLeak</span><span class="op" id="7211521">(</span><span class="ident" id="7211522">t</span>&nbsp;<span class="op" id="7211524">*</span><span class="ident" id="7211525"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7211532">.</span><span class="ident" id="7211533"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7211534">)</span>&nbsp;<span class="op" id="7211536">{</span><br>
<span class="lineno">1875</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7211539">db</span>&nbsp;<span class="op" id="7211542">:=</span>&nbsp;<span class="ident" id="7211545"><a href="/gostd/database/sql/sql_test.go.html#7169849">newTestDB</a></span><span class="op" id="7211554">(</span><span class="ident" id="7211555"><a href="/gostd/database/sql/sql_test.go.html#7211522">t</a></span><span class="op" id="7211556">,</span>&nbsp;<span class="string" id="7211558">&#34;people&#34;</span><span class="op" id="7211566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7211569">defer</span>&nbsp;<span class="ident" id="7211575"><a href="/gostd/database/sql/sql_test.go.html#7170773">closeDB</a></span><span class="op" id="7211582">(</span><span class="ident" id="7211583"><a href="/gostd/database/sql/sql_test.go.html#7211522">t</a></span><span class="op" id="7211584">,</span>&nbsp;<span class="ident" id="7211586"><a href="/gostd/database/sql/sql_test.go.html#7211539">db</a></span><span class="op" id="7211588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7211591">//&nbsp;Start&nbsp;by&nbsp;opening&nbsp;defaultMaxIdleConns</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7211632">rows</span>&nbsp;<span class="op" id="7211637">:=</span>&nbsp;<span class="builtinfunc" id="7211640">make</span><span class="op" id="7211644">(</span><span class="op" id="7211645">[</span><span class="op" id="7211646">]</span><span class="op" id="7211647">*</span><span class="ident" id="7211648"><a href="/gostd/database/sql/sql.go.html#5241499">Rows</a></span><span class="op" id="7211652">,</span>&nbsp;<span class="ident" id="7211654"><a href="/gostd/database/sql/sql.go.html#5215303">defaultMaxIdleConns</a></span><span class="op" id="7211673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7211676">//&nbsp;We&nbsp;need&nbsp;to&nbsp;SetMaxOpenConns&nbsp;&gt;&nbsp;MaxIdleConns,&nbsp;so&nbsp;the&nbsp;DB&nbsp;can&nbsp;open</span><br>
<span class="lineno">1880</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7211742">//&nbsp;a&nbsp;new&nbsp;connection&nbsp;and&nbsp;we&nbsp;can&nbsp;fill&nbsp;the&nbsp;idle&nbsp;queue&nbsp;with&nbsp;the&nbsp;released</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7211812">//&nbsp;connections.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7211829"><a href="/gostd/database/sql/sql_test.go.html#7211539">db</a></span><span class="op" id="7211831">.</span><span class="ident" id="7211832"><a href="/gostd/database/sql/sql.go.html#5216759">SetMaxOpenConns</a></span><span class="op" id="7211847">(</span><span class="builtinfunc" id="7211848">len</span><span class="op" id="7211851">(</span><span class="ident" id="7211852"><a href="/gostd/database/sql/sql_test.go.html#7211632">rows</a></span><span class="op" id="7211856">)</span>&nbsp;<span class="op" id="7211858">+</span>&nbsp;<span class="num" id="7211860">1</span><span class="op" id="7211861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7211864">for</span>&nbsp;<span class="ident" id="7211868">ii</span>&nbsp;<span class="op" id="7211871">:=</span>&nbsp;<span class="keyword" id="7211874">range</span>&nbsp;<span class="ident" id="7211880"><a href="/gostd/database/sql/sql_test.go.html#7211632">rows</a></span>&nbsp;<span class="op" id="7211885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7211889">r</span><span class="op" id="7211890">,</span>&nbsp;<span class="ident" id="7211892">err</span>&nbsp;<span class="op" id="7211896">:=</span>&nbsp;<span class="ident" id="7211899"><a href="/gostd/database/sql/sql_test.go.html#7211539">db</a></span><span class="op" id="7211901">.</span><span class="ident" id="7211902"><a href="/gostd/database/sql/sql.go.html#5225993">Query</a></span><span class="op" id="7211907">(</span><span class="string" id="7211908">&#34;SELECT|people|name|&#34;</span><span class="op" id="7211929">)</span><br>
<span class="lineno">1885</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7211933">if</span>&nbsp;<span class="ident" id="7211936"><a href="/gostd/database/sql/sql_test.go.html#7211892">err</a></span>&nbsp;<span class="op" id="7211940">!=</span>&nbsp;<span class="builtintype" id="7211943">nil</span>&nbsp;<span class="op" id="7211947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7211952"><a href="/gostd/database/sql/sql_test.go.html#7211522">t</a></span><span class="op" id="7211953">.</span><span class="ident" id="7211954"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="7211959">(</span><span class="ident" id="7211960"><a href="/gostd/database/sql/sql_test.go.html#7211892">err</a></span><span class="op" id="7211963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7211967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7211971"><a href="/gostd/database/sql/sql_test.go.html#7211889">r</a></span><span class="op" id="7211972">.</span><span class="ident" id="7211973"><a href="/gostd/database/sql/sql.go.html#5242163">Next</a></span><span class="op" id="7211977">(</span><span class="op" id="7211978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7211982">if</span>&nbsp;<span class="ident" id="7211985">err</span>&nbsp;<span class="op" id="7211989">:=</span>&nbsp;<span class="ident" id="7211992"><a href="/gostd/database/sql/sql_test.go.html#7211889">r</a></span><span class="op" id="7211993">.</span><span class="ident" id="7211994"><a href="/gostd/database/sql/sql.go.html#5242560">Err</a></span><span class="op" id="7211997">(</span><span class="op" id="7211998">)</span><span class="op" id="7211999">;</span>&nbsp;<span class="ident" id="7212001"><a href="/gostd/database/sql/sql_test.go.html#7211985">err</a></span>&nbsp;<span class="op" id="7212005">!=</span>&nbsp;<span class="builtintype" id="7212008">nil</span>&nbsp;<span class="op" id="7212012">{</span><br>
<span class="lineno">1890</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7212017"><a href="/gostd/database/sql/sql_test.go.html#7211522">t</a></span><span class="op" id="7212018">.</span><span class="ident" id="7212019"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="7212024">(</span><span class="ident" id="7212025"><a href="/gostd/database/sql/sql_test.go.html#7211985">err</a></span><span class="op" id="7212028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7212032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7212036"><a href="/gostd/database/sql/sql_test.go.html#7211632">rows</a></span><span class="op" id="7212040">[</span><span class="ident" id="7212041"><a href="/gostd/database/sql/sql_test.go.html#7211868">ii</a></span><span class="op" id="7212043">]</span>&nbsp;<span class="op" id="7212045">=</span>&nbsp;<span class="ident" id="7212047"><a href="/gostd/database/sql/sql_test.go.html#7211889">r</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7212050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7212053">//&nbsp;Now&nbsp;we&nbsp;have&nbsp;defaultMaxIdleConns&nbsp;busy&nbsp;connections.&nbsp;Open</span><br>
<span class="lineno">1895</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7212112">//&nbsp;a&nbsp;new&nbsp;one,&nbsp;but&nbsp;wait&nbsp;until&nbsp;the&nbsp;busy&nbsp;connections&nbsp;are&nbsp;released</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7212176">//&nbsp;before&nbsp;returning&nbsp;control&nbsp;to&nbsp;DB.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7212212">drv</span>&nbsp;<span class="op" id="7212216">:=</span>&nbsp;<span class="ident" id="7212219"><a href="/gostd/database/sql/sql_test.go.html#7211539">db</a></span><span class="op" id="7212221">.</span><span class="ident" id="7212222"><a href="/gostd/database/sql/sql.go.html#5207171">driver</a></span><span class="op" id="7212228">.</span><span class="op" id="7212229">(</span><span class="op" id="7212230">*</span><span class="ident" id="7212231"><a href="/gostd/database/sql/fakedb_test.go.html#7149380">fakeDriver</a></span><span class="op" id="7212241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7212244"><a href="/gostd/database/sql/sql_test.go.html#7212212">drv</a></span><span class="op" id="7212247">.</span><span class="ident" id="7212248"><a href="/gostd/database/sql/fakedb_test.go.html#7149528">waitCh</a></span>&nbsp;<span class="op" id="7212255">=</span>&nbsp;<span class="builtinfunc" id="7212257">make</span><span class="op" id="7212261">(</span><span class="keyword" id="7212262">chan</span>&nbsp;<span class="keyword" id="7212267">struct</span><span class="op" id="7212273">{</span><span class="op" id="7212274">}</span><span class="op" id="7212275">,</span>&nbsp;<span class="num" id="7212277">1</span><span class="op" id="7212278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7212281"><a href="/gostd/database/sql/sql_test.go.html#7212212">drv</a></span><span class="op" id="7212284">.</span><span class="ident" id="7212285"><a href="/gostd/database/sql/fakedb_test.go.html#7149554">waitingCh</a></span>&nbsp;<span class="op" id="7212295">=</span>&nbsp;<span class="builtinfunc" id="7212297">make</span><span class="op" id="7212301">(</span><span class="keyword" id="7212302">chan</span>&nbsp;<span class="keyword" id="7212307">struct</span><span class="op" id="7212313">{</span><span class="op" id="7212314">}</span><span class="op" id="7212315">,</span>&nbsp;<span class="num" id="7212317">1</span><span class="op" id="7212318">)</span><br>
<span class="lineno">1900</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7212321">var</span>&nbsp;<span class="ident" id="7212325">wg</span>&nbsp;<span class="ident" id="7212328"><a href="/gostd/database/sql/sql_test.go.html#7169125">sync</a></span><span class="op" id="7212332">.</span><span class="ident" id="7212333"><a href="/gostd/sync/waitgroup.go.html#1459933">WaitGroup</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7212344"><a href="/gostd/database/sql/sql_test.go.html#7212325">wg</a></span><span class="op" id="7212346">.</span><span class="ident" id="7212347"><a href="/gostd/sync/waitgroup.go.html#1461154">Add</a></span><span class="op" id="7212350">(</span><span class="num" id="7212351">1</span><span class="op" id="7212352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7212355">go</span>&nbsp;<span class="keyword" id="7212358">func</span><span class="op" id="7212362">(</span><span class="op" id="7212363">)</span>&nbsp;<span class="op" id="7212365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7212369">r</span><span class="op" id="7212370">,</span>&nbsp;<span class="ident" id="7212372">err</span>&nbsp;<span class="op" id="7212376">:=</span>&nbsp;<span class="ident" id="7212379"><a href="/gostd/database/sql/sql_test.go.html#7211539">db</a></span><span class="op" id="7212381">.</span><span class="ident" id="7212382"><a href="/gostd/database/sql/sql.go.html#5225993">Query</a></span><span class="op" id="7212387">(</span><span class="string" id="7212388">&#34;SELECT|people|name|&#34;</span><span class="op" id="7212409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7212413">if</span>&nbsp;<span class="ident" id="7212416"><a href="/gostd/database/sql/sql_test.go.html#7212372">err</a></span>&nbsp;<span class="op" id="7212420">!=</span>&nbsp;<span class="builtintype" id="7212423">nil</span>&nbsp;<span class="op" id="7212427">{</span><br>
<span class="lineno">1905</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7212432"><a href="/gostd/database/sql/sql_test.go.html#7211522">t</a></span><span class="op" id="7212433">.</span><span class="ident" id="7212434"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="7212439">(</span><span class="ident" id="7212440"><a href="/gostd/database/sql/sql_test.go.html#7212372">err</a></span><span class="op" id="7212443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7212447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7212451"><a href="/gostd/database/sql/sql_test.go.html#7212369">r</a></span><span class="op" id="7212452">.</span><span class="ident" id="7212453"><a href="/gostd/database/sql/sql.go.html#5244447">Close</a></span><span class="op" id="7212458">(</span><span class="op" id="7212459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7212463"><a href="/gostd/database/sql/sql_test.go.html#7212325">wg</a></span><span class="op" id="7212465">.</span><span class="ident" id="7212466"><a href="/gostd/sync/waitgroup.go.html#1462065">Done</a></span><span class="op" id="7212470">(</span><span class="op" id="7212471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7212474">}</span><span class="op" id="7212475">(</span><span class="op" id="7212476">)</span><br>
<span class="lineno">1910</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7212479">//&nbsp;Wait&nbsp;until&nbsp;the&nbsp;goroutine&nbsp;we&#39;ve&nbsp;just&nbsp;created&nbsp;has&nbsp;started&nbsp;waiting.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7212548">&lt;-</span><span class="ident" id="7212550"><a href="/gostd/database/sql/sql_test.go.html#7212212">drv</a></span><span class="op" id="7212553">.</span><span class="ident" id="7212554"><a href="/gostd/database/sql/fakedb_test.go.html#7149554">waitingCh</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7212565">//&nbsp;Now&nbsp;close&nbsp;the&nbsp;busy&nbsp;connections.&nbsp;This&nbsp;provides&nbsp;a&nbsp;connection&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7212632">//&nbsp;the&nbsp;blocked&nbsp;goroutine&nbsp;and&nbsp;then&nbsp;fills&nbsp;up&nbsp;the&nbsp;idle&nbsp;queue.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7212692">for</span>&nbsp;<span class="ident" id="7212696">_</span><span class="op" id="7212697">,</span>&nbsp;<span class="ident" id="7212699">v</span>&nbsp;<span class="op" id="7212701">:=</span>&nbsp;<span class="keyword" id="7212704">range</span>&nbsp;<span class="ident" id="7212710"><a href="/gostd/database/sql/sql_test.go.html#7211632">rows</a></span>&nbsp;<span class="op" id="7212715">{</span><br>
<span class="lineno">1915</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7212719"><a href="/gostd/database/sql/sql_test.go.html#7212699">v</a></span><span class="op" id="7212720">.</span><span class="ident" id="7212721"><a href="/gostd/database/sql/sql.go.html#5244447">Close</a></span><span class="op" id="7212726">(</span><span class="op" id="7212727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7212730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7212733">//&nbsp;At&nbsp;this&nbsp;point&nbsp;we&nbsp;give&nbsp;the&nbsp;new&nbsp;connection&nbsp;to&nbsp;DB.&nbsp;This&nbsp;connection&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7212804">//&nbsp;now&nbsp;useless,&nbsp;since&nbsp;the&nbsp;idle&nbsp;queue&nbsp;is&nbsp;full&nbsp;and&nbsp;there&nbsp;are&nbsp;no&nbsp;pending</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7212875">//&nbsp;requests.&nbsp;DB&nbsp;should&nbsp;deal&nbsp;with&nbsp;this&nbsp;situation&nbsp;without&nbsp;leaking&nbsp;the</span><br>
<span class="lineno">1920</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7212944">//&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7212960"><a href="/gostd/database/sql/sql_test.go.html#7212212">drv</a></span><span class="op" id="7212963">.</span><span class="ident" id="7212964"><a href="/gostd/database/sql/fakedb_test.go.html#7149528">waitCh</a></span>&nbsp;<span class="op" id="7212971">&lt;-</span>&nbsp;<span class="keyword" id="7212974">struct</span><span class="op" id="7212980">{</span><span class="op" id="7212981">}</span><span class="op" id="7212982">{</span><span class="op" id="7212983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7212986"><a href="/gostd/database/sql/sql_test.go.html#7212325">wg</a></span><span class="op" id="7212988">.</span><span class="ident" id="7212989"><a href="/gostd/sync/waitgroup.go.html#1462162">Wait</a></span><span class="op" id="7212993">(</span><span class="op" id="7212994">)</span><br>
<span class="lineno"></span><span class="op" id="7212996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1925</span><span class="keyword" id="7212999">func</span>&nbsp;<span class="ident" id="7213004">BenchmarkConcurrentDBExec</span><span class="op" id="7213029">(</span><span class="ident" id="7213030">b</span>&nbsp;<span class="op" id="7213032">*</span><span class="ident" id="7213033"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7213040">.</span><span class="ident" id="7213041"><a href="/gostd/testing/benchmark.go.html#5450963">B</a></span><span class="op" id="7213042">)</span>&nbsp;<span class="op" id="7213044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7213047"><a href="/gostd/database/sql/sql_test.go.html#7213030">b</a></span><span class="op" id="7213048">.</span><span class="ident" id="7213049"><a href="/gostd/testing/benchmark.go.html#5453061">ReportAllocs</a></span><span class="op" id="7213061">(</span><span class="op" id="7213062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7213065">ct</span>&nbsp;<span class="op" id="7213068">:=</span>&nbsp;<span class="builtinfunc" id="7213071">new</span><span class="op" id="7213074">(</span><span class="ident" id="7213075"><a href="/gostd/database/sql/sql_test.go.html#7203803">concurrentDBExecTest</a></span><span class="op" id="7213095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7213098">for</span>&nbsp;<span class="ident" id="7213102">i</span>&nbsp;<span class="op" id="7213104">:=</span>&nbsp;<span class="num" id="7213107">0</span><span class="op" id="7213108">;</span>&nbsp;<span class="ident" id="7213110"><a href="/gostd/database/sql/sql_test.go.html#7213102">i</a></span>&nbsp;<span class="op" id="7213112">&lt;</span>&nbsp;<span class="ident" id="7213114"><a href="/gostd/database/sql/sql_test.go.html#7213030">b</a></span><span class="op" id="7213115">.</span><span class="ident" id="7213116"><a href="/gostd/testing/benchmark.go.html#5450983">N</a></span><span class="op" id="7213117">;</span>&nbsp;<span class="ident" id="7213119"><a href="/gostd/database/sql/sql_test.go.html#7213102">i</a></span><span class="op" id="7213120">++</span>&nbsp;<span class="op" id="7213123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7213127"><a href="/gostd/database/sql/sql_test.go.html#7208659">doConcurrentTest</a></span><span class="op" id="7213143">(</span><span class="ident" id="7213144"><a href="/gostd/database/sql/sql_test.go.html#7213030">b</a></span><span class="op" id="7213145">,</span>&nbsp;<span class="ident" id="7213147"><a href="/gostd/database/sql/sql_test.go.html#7213065">ct</a></span><span class="op" id="7213149">)</span><br>
<span class="lineno">1930</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7213152">}</span><br>
<span class="lineno"></span><span class="op" id="7213154">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7213157">func</span>&nbsp;<span class="ident" id="7213162">BenchmarkConcurrentStmtQuery</span><span class="op" id="7213190">(</span><span class="ident" id="7213191">b</span>&nbsp;<span class="op" id="7213193">*</span><span class="ident" id="7213194"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7213201">.</span><span class="ident" id="7213202"><a href="/gostd/testing/benchmark.go.html#5450963">B</a></span><span class="op" id="7213203">)</span>&nbsp;<span class="op" id="7213205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7213208"><a href="/gostd/database/sql/sql_test.go.html#7213191">b</a></span><span class="op" id="7213209">.</span><span class="ident" id="7213210"><a href="/gostd/testing/benchmark.go.html#5453061">ReportAllocs</a></span><span class="op" id="7213222">(</span><span class="op" id="7213223">)</span><br>
<span class="lineno">1935</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7213226">ct</span>&nbsp;<span class="op" id="7213229">:=</span>&nbsp;<span class="builtinfunc" id="7213232">new</span><span class="op" id="7213235">(</span><span class="ident" id="7213236"><a href="/gostd/database/sql/sql_test.go.html#7204207">concurrentStmtQueryTest</a></span><span class="op" id="7213259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7213262">for</span>&nbsp;<span class="ident" id="7213266">i</span>&nbsp;<span class="op" id="7213268">:=</span>&nbsp;<span class="num" id="7213271">0</span><span class="op" id="7213272">;</span>&nbsp;<span class="ident" id="7213274"><a href="/gostd/database/sql/sql_test.go.html#7213266">i</a></span>&nbsp;<span class="op" id="7213276">&lt;</span>&nbsp;<span class="ident" id="7213278"><a href="/gostd/database/sql/sql_test.go.html#7213191">b</a></span><span class="op" id="7213279">.</span><span class="ident" id="7213280"><a href="/gostd/testing/benchmark.go.html#5450983">N</a></span><span class="op" id="7213281">;</span>&nbsp;<span class="ident" id="7213283"><a href="/gostd/database/sql/sql_test.go.html#7213266">i</a></span><span class="op" id="7213284">++</span>&nbsp;<span class="op" id="7213287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7213291"><a href="/gostd/database/sql/sql_test.go.html#7208659">doConcurrentTest</a></span><span class="op" id="7213307">(</span><span class="ident" id="7213308"><a href="/gostd/database/sql/sql_test.go.html#7213191">b</a></span><span class="op" id="7213309">,</span>&nbsp;<span class="ident" id="7213311"><a href="/gostd/database/sql/sql_test.go.html#7213226">ct</a></span><span class="op" id="7213313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7213316">}</span><br>
<span class="lineno"></span><span class="op" id="7213318">}</span><br>
<span class="lineno">1940</span><br>
<span class="lineno"></span><span class="keyword" id="7213321">func</span>&nbsp;<span class="ident" id="7213326">BenchmarkConcurrentStmtExec</span><span class="op" id="7213353">(</span><span class="ident" id="7213354">b</span>&nbsp;<span class="op" id="7213356">*</span><span class="ident" id="7213357"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7213364">.</span><span class="ident" id="7213365"><a href="/gostd/testing/benchmark.go.html#5450963">B</a></span><span class="op" id="7213366">)</span>&nbsp;<span class="op" id="7213368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7213371"><a href="/gostd/database/sql/sql_test.go.html#7213354">b</a></span><span class="op" id="7213372">.</span><span class="ident" id="7213373"><a href="/gostd/testing/benchmark.go.html#5453061">ReportAllocs</a></span><span class="op" id="7213385">(</span><span class="op" id="7213386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7213389">ct</span>&nbsp;<span class="op" id="7213392">:=</span>&nbsp;<span class="builtinfunc" id="7213395">new</span><span class="op" id="7213398">(</span><span class="ident" id="7213399"><a href="/gostd/database/sql/sql_test.go.html#7204823">concurrentStmtExecTest</a></span><span class="op" id="7213421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7213424">for</span>&nbsp;<span class="ident" id="7213428">i</span>&nbsp;<span class="op" id="7213430">:=</span>&nbsp;<span class="num" id="7213433">0</span><span class="op" id="7213434">;</span>&nbsp;<span class="ident" id="7213436"><a href="/gostd/database/sql/sql_test.go.html#7213428">i</a></span>&nbsp;<span class="op" id="7213438">&lt;</span>&nbsp;<span class="ident" id="7213440"><a href="/gostd/database/sql/sql_test.go.html#7213354">b</a></span><span class="op" id="7213441">.</span><span class="ident" id="7213442"><a href="/gostd/testing/benchmark.go.html#5450983">N</a></span><span class="op" id="7213443">;</span>&nbsp;<span class="ident" id="7213445"><a href="/gostd/database/sql/sql_test.go.html#7213428">i</a></span><span class="op" id="7213446">++</span>&nbsp;<span class="op" id="7213449">{</span><br>
<span class="lineno">1945</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7213453"><a href="/gostd/database/sql/sql_test.go.html#7208659">doConcurrentTest</a></span><span class="op" id="7213469">(</span><span class="ident" id="7213470"><a href="/gostd/database/sql/sql_test.go.html#7213354">b</a></span><span class="op" id="7213471">,</span>&nbsp;<span class="ident" id="7213473"><a href="/gostd/database/sql/sql_test.go.html#7213389">ct</a></span><span class="op" id="7213475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7213478">}</span><br>
<span class="lineno"></span><span class="op" id="7213480">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7213483">func</span>&nbsp;<span class="ident" id="7213488">BenchmarkConcurrentTxQuery</span><span class="op" id="7213514">(</span><span class="ident" id="7213515">b</span>&nbsp;<span class="op" id="7213517">*</span><span class="ident" id="7213518"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7213525">.</span><span class="ident" id="7213526"><a href="/gostd/testing/benchmark.go.html#5450963">B</a></span><span class="op" id="7213527">)</span>&nbsp;<span class="op" id="7213529">{</span><br>
<span class="lineno">1950</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7213532"><a href="/gostd/database/sql/sql_test.go.html#7213515">b</a></span><span class="op" id="7213533">.</span><span class="ident" id="7213534"><a href="/gostd/testing/benchmark.go.html#5453061">ReportAllocs</a></span><span class="op" id="7213546">(</span><span class="op" id="7213547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7213550">ct</span>&nbsp;<span class="op" id="7213553">:=</span>&nbsp;<span class="builtinfunc" id="7213556">new</span><span class="op" id="7213559">(</span><span class="ident" id="7213560"><a href="/gostd/database/sql/sql_test.go.html#7205405">concurrentTxQueryTest</a></span><span class="op" id="7213581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7213584">for</span>&nbsp;<span class="ident" id="7213588">i</span>&nbsp;<span class="op" id="7213590">:=</span>&nbsp;<span class="num" id="7213593">0</span><span class="op" id="7213594">;</span>&nbsp;<span class="ident" id="7213596"><a href="/gostd/database/sql/sql_test.go.html#7213588">i</a></span>&nbsp;<span class="op" id="7213598">&lt;</span>&nbsp;<span class="ident" id="7213600"><a href="/gostd/database/sql/sql_test.go.html#7213515">b</a></span><span class="op" id="7213601">.</span><span class="ident" id="7213602"><a href="/gostd/testing/benchmark.go.html#5450983">N</a></span><span class="op" id="7213603">;</span>&nbsp;<span class="ident" id="7213605"><a href="/gostd/database/sql/sql_test.go.html#7213588">i</a></span><span class="op" id="7213606">++</span>&nbsp;<span class="op" id="7213609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7213613"><a href="/gostd/database/sql/sql_test.go.html#7208659">doConcurrentTest</a></span><span class="op" id="7213629">(</span><span class="ident" id="7213630"><a href="/gostd/database/sql/sql_test.go.html#7213515">b</a></span><span class="op" id="7213631">,</span>&nbsp;<span class="ident" id="7213633"><a href="/gostd/database/sql/sql_test.go.html#7213550">ct</a></span><span class="op" id="7213635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7213638">}</span><br>
<span class="lineno">1955</span><span class="op" id="7213640">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7213643">func</span>&nbsp;<span class="ident" id="7213648">BenchmarkConcurrentTxExec</span><span class="op" id="7213673">(</span><span class="ident" id="7213674">b</span>&nbsp;<span class="op" id="7213676">*</span><span class="ident" id="7213677"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7213684">.</span><span class="ident" id="7213685"><a href="/gostd/testing/benchmark.go.html#5450963">B</a></span><span class="op" id="7213686">)</span>&nbsp;<span class="op" id="7213688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7213691"><a href="/gostd/database/sql/sql_test.go.html#7213674">b</a></span><span class="op" id="7213692">.</span><span class="ident" id="7213693"><a href="/gostd/testing/benchmark.go.html#5453061">ReportAllocs</a></span><span class="op" id="7213705">(</span><span class="op" id="7213706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7213709">ct</span>&nbsp;<span class="op" id="7213712">:=</span>&nbsp;<span class="builtinfunc" id="7213715">new</span><span class="op" id="7213718">(</span><span class="ident" id="7213719"><a href="/gostd/database/sql/sql_test.go.html#7205975">concurrentTxExecTest</a></span><span class="op" id="7213739">)</span><br>
<span class="lineno">1960</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7213742">for</span>&nbsp;<span class="ident" id="7213746">i</span>&nbsp;<span class="op" id="7213748">:=</span>&nbsp;<span class="num" id="7213751">0</span><span class="op" id="7213752">;</span>&nbsp;<span class="ident" id="7213754"><a href="/gostd/database/sql/sql_test.go.html#7213746">i</a></span>&nbsp;<span class="op" id="7213756">&lt;</span>&nbsp;<span class="ident" id="7213758"><a href="/gostd/database/sql/sql_test.go.html#7213674">b</a></span><span class="op" id="7213759">.</span><span class="ident" id="7213760"><a href="/gostd/testing/benchmark.go.html#5450983">N</a></span><span class="op" id="7213761">;</span>&nbsp;<span class="ident" id="7213763"><a href="/gostd/database/sql/sql_test.go.html#7213746">i</a></span><span class="op" id="7213764">++</span>&nbsp;<span class="op" id="7213767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7213771"><a href="/gostd/database/sql/sql_test.go.html#7208659">doConcurrentTest</a></span><span class="op" id="7213787">(</span><span class="ident" id="7213788"><a href="/gostd/database/sql/sql_test.go.html#7213674">b</a></span><span class="op" id="7213789">,</span>&nbsp;<span class="ident" id="7213791"><a href="/gostd/database/sql/sql_test.go.html#7213709">ct</a></span><span class="op" id="7213793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7213796">}</span><br>
<span class="lineno"></span><span class="op" id="7213798">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1965</span><span class="keyword" id="7213801">func</span>&nbsp;<span class="ident" id="7213806">BenchmarkConcurrentTxStmtQuery</span><span class="op" id="7213836">(</span><span class="ident" id="7213837">b</span>&nbsp;<span class="op" id="7213839">*</span><span class="ident" id="7213840"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7213847">.</span><span class="ident" id="7213848"><a href="/gostd/testing/benchmark.go.html#5450963">B</a></span><span class="op" id="7213849">)</span>&nbsp;<span class="op" id="7213851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7213854"><a href="/gostd/database/sql/sql_test.go.html#7213837">b</a></span><span class="op" id="7213855">.</span><span class="ident" id="7213856"><a href="/gostd/testing/benchmark.go.html#5453061">ReportAllocs</a></span><span class="op" id="7213868">(</span><span class="op" id="7213869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7213872">ct</span>&nbsp;<span class="op" id="7213875">:=</span>&nbsp;<span class="builtinfunc" id="7213878">new</span><span class="op" id="7213881">(</span><span class="ident" id="7213882"><a href="/gostd/database/sql/sql_test.go.html#7206515">concurrentTxStmtQueryTest</a></span><span class="op" id="7213907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7213910">for</span>&nbsp;<span class="ident" id="7213914">i</span>&nbsp;<span class="op" id="7213916">:=</span>&nbsp;<span class="num" id="7213919">0</span><span class="op" id="7213920">;</span>&nbsp;<span class="ident" id="7213922"><a href="/gostd/database/sql/sql_test.go.html#7213914">i</a></span>&nbsp;<span class="op" id="7213924">&lt;</span>&nbsp;<span class="ident" id="7213926"><a href="/gostd/database/sql/sql_test.go.html#7213837">b</a></span><span class="op" id="7213927">.</span><span class="ident" id="7213928"><a href="/gostd/testing/benchmark.go.html#5450983">N</a></span><span class="op" id="7213929">;</span>&nbsp;<span class="ident" id="7213931"><a href="/gostd/database/sql/sql_test.go.html#7213914">i</a></span><span class="op" id="7213932">++</span>&nbsp;<span class="op" id="7213935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7213939"><a href="/gostd/database/sql/sql_test.go.html#7208659">doConcurrentTest</a></span><span class="op" id="7213955">(</span><span class="ident" id="7213956"><a href="/gostd/database/sql/sql_test.go.html#7213837">b</a></span><span class="op" id="7213957">,</span>&nbsp;<span class="ident" id="7213959"><a href="/gostd/database/sql/sql_test.go.html#7213872">ct</a></span><span class="op" id="7213961">)</span><br>
<span class="lineno">1970</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7213964">}</span><br>
<span class="lineno"></span><span class="op" id="7213966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7213969">func</span>&nbsp;<span class="ident" id="7213974">BenchmarkConcurrentTxStmtExec</span><span class="op" id="7214003">(</span><span class="ident" id="7214004">b</span>&nbsp;<span class="op" id="7214006">*</span><span class="ident" id="7214007"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7214014">.</span><span class="ident" id="7214015"><a href="/gostd/testing/benchmark.go.html#5450963">B</a></span><span class="op" id="7214016">)</span>&nbsp;<span class="op" id="7214018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7214021"><a href="/gostd/database/sql/sql_test.go.html#7214004">b</a></span><span class="op" id="7214022">.</span><span class="ident" id="7214023"><a href="/gostd/testing/benchmark.go.html#5453061">ReportAllocs</a></span><span class="op" id="7214035">(</span><span class="op" id="7214036">)</span><br>
<span class="lineno">1975</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7214039">ct</span>&nbsp;<span class="op" id="7214042">:=</span>&nbsp;<span class="builtinfunc" id="7214045">new</span><span class="op" id="7214048">(</span><span class="ident" id="7214049"><a href="/gostd/database/sql/sql_test.go.html#7207264">concurrentTxStmtExecTest</a></span><span class="op" id="7214073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7214076">for</span>&nbsp;<span class="ident" id="7214080">i</span>&nbsp;<span class="op" id="7214082">:=</span>&nbsp;<span class="num" id="7214085">0</span><span class="op" id="7214086">;</span>&nbsp;<span class="ident" id="7214088"><a href="/gostd/database/sql/sql_test.go.html#7214080">i</a></span>&nbsp;<span class="op" id="7214090">&lt;</span>&nbsp;<span class="ident" id="7214092"><a href="/gostd/database/sql/sql_test.go.html#7214004">b</a></span><span class="op" id="7214093">.</span><span class="ident" id="7214094"><a href="/gostd/testing/benchmark.go.html#5450983">N</a></span><span class="op" id="7214095">;</span>&nbsp;<span class="ident" id="7214097"><a href="/gostd/database/sql/sql_test.go.html#7214080">i</a></span><span class="op" id="7214098">++</span>&nbsp;<span class="op" id="7214101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7214105"><a href="/gostd/database/sql/sql_test.go.html#7208659">doConcurrentTest</a></span><span class="op" id="7214121">(</span><span class="ident" id="7214122"><a href="/gostd/database/sql/sql_test.go.html#7214004">b</a></span><span class="op" id="7214123">,</span>&nbsp;<span class="ident" id="7214125"><a href="/gostd/database/sql/sql_test.go.html#7214039">ct</a></span><span class="op" id="7214127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7214130">}</span><br>
<span class="lineno"></span><span class="op" id="7214132">}</span><br>
<span class="lineno">1980</span><br>
<span class="lineno"></span><span class="keyword" id="7214135">func</span>&nbsp;<span class="ident" id="7214140">BenchmarkConcurrentRandom</span><span class="op" id="7214165">(</span><span class="ident" id="7214166">b</span>&nbsp;<span class="op" id="7214168">*</span><span class="ident" id="7214169"><a href="/gostd/database/sql/sql_test.go.html#7169133">testing</a></span><span class="op" id="7214176">.</span><span class="ident" id="7214177"><a href="/gostd/testing/benchmark.go.html#5450963">B</a></span><span class="op" id="7214178">)</span>&nbsp;<span class="op" id="7214180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7214183"><a href="/gostd/database/sql/sql_test.go.html#7214166">b</a></span><span class="op" id="7214184">.</span><span class="ident" id="7214185"><a href="/gostd/testing/benchmark.go.html#5453061">ReportAllocs</a></span><span class="op" id="7214197">(</span><span class="op" id="7214198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7214201">ct</span>&nbsp;<span class="op" id="7214204">:=</span>&nbsp;<span class="builtinfunc" id="7214207">new</span><span class="op" id="7214210">(</span><span class="ident" id="7214211"><a href="/gostd/database/sql/sql_test.go.html#7207979">concurrentRandomTest</a></span><span class="op" id="7214231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7214234">for</span>&nbsp;<span class="ident" id="7214238">i</span>&nbsp;<span class="op" id="7214240">:=</span>&nbsp;<span class="num" id="7214243">0</span><span class="op" id="7214244">;</span>&nbsp;<span class="ident" id="7214246"><a href="/gostd/database/sql/sql_test.go.html#7214238">i</a></span>&nbsp;<span class="op" id="7214248">&lt;</span>&nbsp;<span class="ident" id="7214250"><a href="/gostd/database/sql/sql_test.go.html#7214166">b</a></span><span class="op" id="7214251">.</span><span class="ident" id="7214252"><a href="/gostd/testing/benchmark.go.html#5450983">N</a></span><span class="op" id="7214253">;</span>&nbsp;<span class="ident" id="7214255"><a href="/gostd/database/sql/sql_test.go.html#7214238">i</a></span><span class="op" id="7214256">++</span>&nbsp;<span class="op" id="7214259">{</span><br>
<span class="lineno">1985</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7214263"><a href="/gostd/database/sql/sql_test.go.html#7208659">doConcurrentTest</a></span><span class="op" id="7214279">(</span><span class="ident" id="7214280"><a href="/gostd/database/sql/sql_test.go.html#7214166">b</a></span><span class="op" id="7214281">,</span>&nbsp;<span class="ident" id="7214283"><a href="/gostd/database/sql/sql_test.go.html#7214201">ct</a></span><span class="op" id="7214285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7214288">}</span><br>
<span class="lineno"></span><span class="op" id="7214290">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
