<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/ecdsa</h2>
<ul>
<li><a href="/gostd/crypto/ecdsa/ecdsa.go.html">ecdsa.go</a></li>
<li><a href="/gostd/crypto/ecdsa/ecdsa_test.go.html">ecdsa_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4889778">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4889833">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4889887">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4889938">//&nbsp;Package&nbsp;ecdsa&nbsp;implements&nbsp;the&nbsp;Elliptic&nbsp;Curve&nbsp;Digital&nbsp;Signature&nbsp;Algorithm,&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="4890017">//&nbsp;defined&nbsp;in&nbsp;FIPS&nbsp;186-3.</span><br>
<span class="lineno"></span><span class="keyword" id="4890043">package</span>&nbsp;<span class="ident" id="4890051">ecdsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4890058">//&nbsp;References:</span><br>
<span class="lineno">10</span><span class="comment" id="4890073">//&nbsp;&nbsp;&nbsp;[NSA]:&nbsp;Suite&nbsp;B&nbsp;implementer&#39;s&nbsp;guide&nbsp;to&nbsp;FIPS&nbsp;186-3,</span><br>
<span class="lineno"></span><span class="comment" id="4890128">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://www.nsa.gov/ia/_files/ecdsa.pdf</span><br>
<span class="lineno"></span><span class="comment" id="4890174">//&nbsp;&nbsp;&nbsp;[SECG]:&nbsp;SECG,&nbsp;SEC1</span><br>
<span class="lineno"></span><span class="comment" id="4890198">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://www.secg.org/download/aid-780/sec1-v2.pdf</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="4890255">import</span>&nbsp;<span class="op" id="4890262">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4890265">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4890275">&#34;crypto/elliptic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4890294">&#34;encoding/asn1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4890311">&#34;io&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4890317">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="4890328">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4890331">//&nbsp;PublicKey&nbsp;represents&nbsp;an&nbsp;ECDSA&nbsp;public&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4890376">type</span>&nbsp;<span class="ident" id="4890381">PublicKey</span>&nbsp;<span class="keyword" id="4890391">struct</span>&nbsp;<span class="op" id="4890398">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4890401">elliptic</span><span class="op" id="4890409">.</span><span class="ident" id="4890410">Curve</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4890417">X</span><span class="op" id="4890418">,</span>&nbsp;<span class="ident" id="4890420">Y</span>&nbsp;<span class="op" id="4890422">*</span><span class="ident" id="4890423">big</span><span class="op" id="4890426">.</span><span class="ident" id="4890427">Int</span><br>
<span class="lineno"></span><span class="op" id="4890431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4890434">//&nbsp;PrivateKey&nbsp;represents&nbsp;a&nbsp;ECDSA&nbsp;private&nbsp;key.</span><br>
<span class="lineno">30</span><span class="keyword" id="4890480">type</span>&nbsp;<span class="ident" id="4890485">PrivateKey</span>&nbsp;<span class="keyword" id="4890496">struct</span>&nbsp;<span class="op" id="4890503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4890506">PublicKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4890517">D</span>&nbsp;<span class="op" id="4890519">*</span><span class="ident" id="4890520">big</span><span class="op" id="4890523">.</span><span class="ident" id="4890524">Int</span><br>
<span class="lineno"></span><span class="op" id="4890528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="4890531">type</span>&nbsp;<span class="ident" id="4890536">ecdsaSignature</span>&nbsp;<span class="keyword" id="4890551">struct</span>&nbsp;<span class="op" id="4890558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4890561">R</span><span class="op" id="4890562">,</span>&nbsp;<span class="ident" id="4890564">S</span>&nbsp;<span class="op" id="4890566">*</span><span class="ident" id="4890567">big</span><span class="op" id="4890570">.</span><span class="ident" id="4890571">Int</span><br>
<span class="lineno"></span><span class="op" id="4890575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4890578">//&nbsp;Public&nbsp;returns&nbsp;the&nbsp;public&nbsp;key&nbsp;corresponding&nbsp;to&nbsp;priv.</span><br>
<span class="lineno">40</span><span class="keyword" id="4890634">func</span>&nbsp;<span class="op" id="4890639">(</span><span class="ident" id="4890640">priv</span>&nbsp;<span class="op" id="4890645">*</span><span class="ident" id="4890646">PrivateKey</span><span class="op" id="4890656">)</span>&nbsp;<span class="ident" id="4890658">Public</span><span class="op" id="4890664">(</span><span class="op" id="4890665">)</span>&nbsp;<span class="ident" id="4890667">crypto</span><span class="op" id="4890673">.</span><span class="ident" id="4890674">PublicKey</span>&nbsp;<span class="op" id="4890684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4890687">return</span>&nbsp;<span class="op" id="4890694">&amp;</span><span class="ident" id="4890695">priv</span><span class="op" id="4890699">.</span><span class="ident" id="4890700">PublicKey</span><br>
<span class="lineno"></span><span class="op" id="4890710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4890713">//&nbsp;Sign&nbsp;signs&nbsp;msg&nbsp;with&nbsp;priv,&nbsp;reading&nbsp;randomness&nbsp;from&nbsp;rand.&nbsp;This&nbsp;method&nbsp;is</span><br>
<span class="lineno">45</span><span class="comment" id="4890787">//&nbsp;intended&nbsp;to&nbsp;support&nbsp;keys&nbsp;where&nbsp;the&nbsp;private&nbsp;part&nbsp;is&nbsp;kept&nbsp;in,&nbsp;for&nbsp;example,&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4890865">//&nbsp;hardware&nbsp;module.&nbsp;Common&nbsp;uses&nbsp;should&nbsp;use&nbsp;the&nbsp;Sign&nbsp;function&nbsp;in&nbsp;this&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="4890942">//&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="4890955">func</span>&nbsp;<span class="op" id="4890960">(</span><span class="ident" id="4890961">priv</span>&nbsp;<span class="op" id="4890966">*</span><span class="ident" id="4890967">PrivateKey</span><span class="op" id="4890977">)</span>&nbsp;<span class="ident" id="4890979">Sign</span><span class="op" id="4890983">(</span><span class="ident" id="4890984">rand</span>&nbsp;<span class="ident" id="4890989">io</span><span class="op" id="4890991">.</span><span class="ident" id="4890992">Reader</span><span class="op" id="4890998">,</span>&nbsp;<span class="ident" id="4891000">msg</span>&nbsp;<span class="op" id="4891004">[</span><span class="op" id="4891005">]</span><span class="builtintype" id="4891006">byte</span><span class="op" id="4891010">,</span>&nbsp;<span class="ident" id="4891012">opts</span>&nbsp;<span class="ident" id="4891017">crypto</span><span class="op" id="4891023">.</span><span class="ident" id="4891024">SignerOpts</span><span class="op" id="4891034">)</span>&nbsp;<span class="op" id="4891036">(</span><span class="op" id="4891037">[</span><span class="op" id="4891038">]</span><span class="builtintype" id="4891039">byte</span><span class="op" id="4891043">,</span>&nbsp;<span class="builtintype" id="4891045">error</span><span class="op" id="4891050">)</span>&nbsp;<span class="op" id="4891052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4891055">r</span><span class="op" id="4891056">,</span>&nbsp;<span class="ident" id="4891058">s</span><span class="op" id="4891059">,</span>&nbsp;<span class="ident" id="4891061">err</span>&nbsp;<span class="op" id="4891065">:=</span>&nbsp;<span class="ident" id="4891068">Sign</span><span class="op" id="4891072">(</span><span class="ident" id="4891073">rand</span><span class="op" id="4891077">,</span>&nbsp;<span class="ident" id="4891079">priv</span><span class="op" id="4891083">,</span>&nbsp;<span class="ident" id="4891085">msg</span><span class="op" id="4891088">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891091">if</span>&nbsp;<span class="ident" id="4891094">err</span>&nbsp;<span class="op" id="4891098">!=</span>&nbsp;<span class="ident" id="4891101">nil</span>&nbsp;<span class="op" id="4891105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891109">return</span>&nbsp;<span class="ident" id="4891116">nil</span><span class="op" id="4891119">,</span>&nbsp;<span class="ident" id="4891121">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4891126">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891130">return</span>&nbsp;<span class="ident" id="4891137">asn1</span><span class="op" id="4891141">.</span><span class="ident" id="4891142">Marshal</span><span class="op" id="4891149">(</span><span class="ident" id="4891150">ecdsaSignature</span><span class="op" id="4891164">{</span><span class="ident" id="4891165">r</span><span class="op" id="4891166">,</span>&nbsp;<span class="ident" id="4891168">s</span><span class="op" id="4891169">}</span><span class="op" id="4891170">)</span><br>
<span class="lineno">55</span><span class="op" id="4891172">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4891175">var</span>&nbsp;<span class="ident" id="4891179">one</span>&nbsp;<span class="op" id="4891183">=</span>&nbsp;<span class="builtinfunc" id="4891185">new</span><span class="op" id="4891188">(</span><span class="ident" id="4891189">big</span><span class="op" id="4891192">.</span><span class="ident" id="4891193">Int</span><span class="op" id="4891196">)</span><span class="op" id="4891197">.</span><span class="ident" id="4891198">SetInt64</span><span class="op" id="4891206">(</span><span class="num" id="4891207">1</span><span class="op" id="4891208">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4891211">//&nbsp;randFieldElement&nbsp;returns&nbsp;a&nbsp;random&nbsp;element&nbsp;of&nbsp;the&nbsp;field&nbsp;underlying&nbsp;the&nbsp;given</span><br>
<span class="lineno">60</span><span class="comment" id="4891290">//&nbsp;curve&nbsp;using&nbsp;the&nbsp;procedure&nbsp;given&nbsp;in&nbsp;[NSA]&nbsp;A.2.1.</span><br>
<span class="lineno"></span><span class="keyword" id="4891341">func</span>&nbsp;<span class="ident" id="4891346">randFieldElement</span><span class="op" id="4891362">(</span><span class="ident" id="4891363">c</span>&nbsp;<span class="ident" id="4891365">elliptic</span><span class="op" id="4891373">.</span><span class="ident" id="4891374">Curve</span><span class="op" id="4891379">,</span>&nbsp;<span class="ident" id="4891381">rand</span>&nbsp;<span class="ident" id="4891386">io</span><span class="op" id="4891388">.</span><span class="ident" id="4891389">Reader</span><span class="op" id="4891395">)</span>&nbsp;<span class="op" id="4891397">(</span><span class="ident" id="4891398">k</span>&nbsp;<span class="op" id="4891400">*</span><span class="ident" id="4891401">big</span><span class="op" id="4891404">.</span><span class="ident" id="4891405">Int</span><span class="op" id="4891408">,</span>&nbsp;<span class="ident" id="4891410">err</span>&nbsp;<span class="builtintype" id="4891414">error</span><span class="op" id="4891419">)</span>&nbsp;<span class="op" id="4891421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4891424">params</span>&nbsp;<span class="op" id="4891431">:=</span>&nbsp;<span class="ident" id="4891434">c</span><span class="op" id="4891435">.</span><span class="ident" id="4891436">Params</span><span class="op" id="4891442">(</span><span class="op" id="4891443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4891446">b</span>&nbsp;<span class="op" id="4891448">:=</span>&nbsp;<span class="builtinfunc" id="4891451">make</span><span class="op" id="4891455">(</span><span class="op" id="4891456">[</span><span class="op" id="4891457">]</span><span class="builtintype" id="4891458">byte</span><span class="op" id="4891462">,</span>&nbsp;<span class="ident" id="4891464">params</span><span class="op" id="4891470">.</span><span class="ident" id="4891471">BitSize</span><span class="op" id="4891478">/</span><span class="num" id="4891479">8</span><span class="op" id="4891480">+</span><span class="num" id="4891481">8</span><span class="op" id="4891482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4891485">_</span><span class="op" id="4891486">,</span>&nbsp;<span class="ident" id="4891488">err</span>&nbsp;<span class="op" id="4891492">=</span>&nbsp;<span class="ident" id="4891494">io</span><span class="op" id="4891496">.</span><span class="ident" id="4891497">ReadFull</span><span class="op" id="4891505">(</span><span class="ident" id="4891506">rand</span><span class="op" id="4891510">,</span>&nbsp;<span class="ident" id="4891512">b</span><span class="op" id="4891513">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891516">if</span>&nbsp;<span class="ident" id="4891519">err</span>&nbsp;<span class="op" id="4891523">!=</span>&nbsp;<span class="ident" id="4891526">nil</span>&nbsp;<span class="op" id="4891530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891534">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4891542">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4891546">k</span>&nbsp;<span class="op" id="4891548">=</span>&nbsp;<span class="builtinfunc" id="4891550">new</span><span class="op" id="4891553">(</span><span class="ident" id="4891554">big</span><span class="op" id="4891557">.</span><span class="ident" id="4891558">Int</span><span class="op" id="4891561">)</span><span class="op" id="4891562">.</span><span class="ident" id="4891563">SetBytes</span><span class="op" id="4891571">(</span><span class="ident" id="4891572">b</span><span class="op" id="4891573">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4891576">n</span>&nbsp;<span class="op" id="4891578">:=</span>&nbsp;<span class="builtinfunc" id="4891581">new</span><span class="op" id="4891584">(</span><span class="ident" id="4891585">big</span><span class="op" id="4891588">.</span><span class="ident" id="4891589">Int</span><span class="op" id="4891592">)</span><span class="op" id="4891593">.</span><span class="ident" id="4891594">Sub</span><span class="op" id="4891597">(</span><span class="ident" id="4891598">params</span><span class="op" id="4891604">.</span><span class="ident" id="4891605">N</span><span class="op" id="4891606">,</span>&nbsp;<span class="ident" id="4891608">one</span><span class="op" id="4891611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4891614">k</span><span class="op" id="4891615">.</span><span class="ident" id="4891616">Mod</span><span class="op" id="4891619">(</span><span class="ident" id="4891620">k</span><span class="op" id="4891621">,</span>&nbsp;<span class="ident" id="4891623">n</span><span class="op" id="4891624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4891627">k</span><span class="op" id="4891628">.</span><span class="ident" id="4891629">Add</span><span class="op" id="4891632">(</span><span class="ident" id="4891633">k</span><span class="op" id="4891634">,</span>&nbsp;<span class="ident" id="4891636">one</span><span class="op" id="4891639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891642">return</span><br>
<span class="lineno"></span><span class="op" id="4891649">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="4891652">//&nbsp;GenerateKey&nbsp;generates&nbsp;a&nbsp;public&nbsp;and&nbsp;private&nbsp;key&nbsp;pair.</span><br>
<span class="lineno"></span><span class="keyword" id="4891708">func</span>&nbsp;<span class="ident" id="4891713">GenerateKey</span><span class="op" id="4891724">(</span><span class="ident" id="4891725">c</span>&nbsp;<span class="ident" id="4891727">elliptic</span><span class="op" id="4891735">.</span><span class="ident" id="4891736">Curve</span><span class="op" id="4891741">,</span>&nbsp;<span class="ident" id="4891743">rand</span>&nbsp;<span class="ident" id="4891748">io</span><span class="op" id="4891750">.</span><span class="ident" id="4891751">Reader</span><span class="op" id="4891757">)</span>&nbsp;<span class="op" id="4891759">(</span><span class="ident" id="4891760">priv</span>&nbsp;<span class="op" id="4891765">*</span><span class="ident" id="4891766">PrivateKey</span><span class="op" id="4891776">,</span>&nbsp;<span class="ident" id="4891778">err</span>&nbsp;<span class="builtintype" id="4891782">error</span><span class="op" id="4891787">)</span>&nbsp;<span class="op" id="4891789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4891792">k</span><span class="op" id="4891793">,</span>&nbsp;<span class="ident" id="4891795">err</span>&nbsp;<span class="op" id="4891799">:=</span>&nbsp;<span class="ident" id="4891802">randFieldElement</span><span class="op" id="4891818">(</span><span class="ident" id="4891819">c</span><span class="op" id="4891820">,</span>&nbsp;<span class="ident" id="4891822">rand</span><span class="op" id="4891826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891829">if</span>&nbsp;<span class="ident" id="4891832">err</span>&nbsp;<span class="op" id="4891836">!=</span>&nbsp;<span class="ident" id="4891839">nil</span>&nbsp;<span class="op" id="4891843">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891847">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4891855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4891859">priv</span>&nbsp;<span class="op" id="4891864">=</span>&nbsp;<span class="builtinfunc" id="4891866">new</span><span class="op" id="4891869">(</span><span class="ident" id="4891870">PrivateKey</span><span class="op" id="4891880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4891883">priv</span><span class="op" id="4891887">.</span><span class="ident" id="4891888">PublicKey</span><span class="op" id="4891897">.</span><span class="ident" id="4891898">Curve</span>&nbsp;<span class="op" id="4891904">=</span>&nbsp;<span class="ident" id="4891906">c</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4891909">priv</span><span class="op" id="4891913">.</span><span class="ident" id="4891914">D</span>&nbsp;<span class="op" id="4891916">=</span>&nbsp;<span class="ident" id="4891918">k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4891921">priv</span><span class="op" id="4891925">.</span><span class="ident" id="4891926">PublicKey</span><span class="op" id="4891935">.</span><span class="ident" id="4891936">X</span><span class="op" id="4891937">,</span>&nbsp;<span class="ident" id="4891939">priv</span><span class="op" id="4891943">.</span><span class="ident" id="4891944">PublicKey</span><span class="op" id="4891953">.</span><span class="ident" id="4891954">Y</span>&nbsp;<span class="op" id="4891956">=</span>&nbsp;<span class="ident" id="4891958">c</span><span class="op" id="4891959">.</span><span class="ident" id="4891960">ScalarBaseMult</span><span class="op" id="4891974">(</span><span class="ident" id="4891975">k</span><span class="op" id="4891976">.</span><span class="ident" id="4891977">Bytes</span><span class="op" id="4891982">(</span><span class="op" id="4891983">)</span><span class="op" id="4891984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891987">return</span><br>
<span class="lineno"></span><span class="op" id="4891994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="4891997">//&nbsp;hashToInt&nbsp;converts&nbsp;a&nbsp;hash&nbsp;value&nbsp;to&nbsp;an&nbsp;integer.&nbsp;There&nbsp;is&nbsp;some&nbsp;disagreement</span><br>
<span class="lineno"></span><span class="comment" id="4892074">//&nbsp;about&nbsp;how&nbsp;this&nbsp;is&nbsp;done.&nbsp;[NSA]&nbsp;suggests&nbsp;that&nbsp;this&nbsp;is&nbsp;done&nbsp;in&nbsp;the&nbsp;obvious</span><br>
<span class="lineno"></span><span class="comment" id="4892149">//&nbsp;manner,&nbsp;but&nbsp;[SECG]&nbsp;truncates&nbsp;the&nbsp;hash&nbsp;to&nbsp;the&nbsp;bit-length&nbsp;of&nbsp;the&nbsp;curve&nbsp;order</span><br>
<span class="lineno"></span><span class="comment" id="4892227">//&nbsp;first.&nbsp;We&nbsp;follow&nbsp;[SECG]&nbsp;because&nbsp;that&#39;s&nbsp;what&nbsp;OpenSSL&nbsp;does.&nbsp;Additionally,</span><br>
<span class="lineno"></span><span class="comment" id="4892302">//&nbsp;OpenSSL&nbsp;right&nbsp;shifts&nbsp;excess&nbsp;bits&nbsp;from&nbsp;the&nbsp;number&nbsp;if&nbsp;the&nbsp;hash&nbsp;is&nbsp;too&nbsp;large</span><br>
<span class="lineno">95</span><span class="comment" id="4892379">//&nbsp;and&nbsp;we&nbsp;mirror&nbsp;that&nbsp;too.</span><br>
<span class="lineno"></span><span class="keyword" id="4892406">func</span>&nbsp;<span class="ident" id="4892411">hashToInt</span><span class="op" id="4892420">(</span><span class="ident" id="4892421">hash</span>&nbsp;<span class="op" id="4892426">[</span><span class="op" id="4892427">]</span><span class="builtintype" id="4892428">byte</span><span class="op" id="4892432">,</span>&nbsp;<span class="ident" id="4892434">c</span>&nbsp;<span class="ident" id="4892436">elliptic</span><span class="op" id="4892444">.</span><span class="ident" id="4892445">Curve</span><span class="op" id="4892450">)</span>&nbsp;<span class="op" id="4892452">*</span><span class="ident" id="4892453">big</span><span class="op" id="4892456">.</span><span class="ident" id="4892457">Int</span>&nbsp;<span class="op" id="4892461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4892464">orderBits</span>&nbsp;<span class="op" id="4892474">:=</span>&nbsp;<span class="ident" id="4892477">c</span><span class="op" id="4892478">.</span><span class="ident" id="4892479">Params</span><span class="op" id="4892485">(</span><span class="op" id="4892486">)</span><span class="op" id="4892487">.</span><span class="ident" id="4892488">N</span><span class="op" id="4892489">.</span><span class="ident" id="4892490">BitLen</span><span class="op" id="4892496">(</span><span class="op" id="4892497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4892500">orderBytes</span>&nbsp;<span class="op" id="4892511">:=</span>&nbsp;<span class="op" id="4892514">(</span><span class="ident" id="4892515">orderBits</span>&nbsp;<span class="op" id="4892525">+</span>&nbsp;<span class="num" id="4892527">7</span><span class="op" id="4892528">)</span>&nbsp;<span class="op" id="4892530">/</span>&nbsp;<span class="num" id="4892532">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4892535">if</span>&nbsp;<span class="builtinfunc" id="4892538">len</span><span class="op" id="4892541">(</span><span class="ident" id="4892542">hash</span><span class="op" id="4892546">)</span>&nbsp;<span class="op" id="4892548">&gt;</span>&nbsp;<span class="ident" id="4892550">orderBytes</span>&nbsp;<span class="op" id="4892561">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4892565">hash</span>&nbsp;<span class="op" id="4892570">=</span>&nbsp;<span class="ident" id="4892572">hash</span><span class="op" id="4892576">[</span><span class="op" id="4892577">:</span><span class="ident" id="4892578">orderBytes</span><span class="op" id="4892588">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4892591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4892595">ret</span>&nbsp;<span class="op" id="4892599">:=</span>&nbsp;<span class="builtinfunc" id="4892602">new</span><span class="op" id="4892605">(</span><span class="ident" id="4892606">big</span><span class="op" id="4892609">.</span><span class="ident" id="4892610">Int</span><span class="op" id="4892613">)</span><span class="op" id="4892614">.</span><span class="ident" id="4892615">SetBytes</span><span class="op" id="4892623">(</span><span class="ident" id="4892624">hash</span><span class="op" id="4892628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4892631">excess</span>&nbsp;<span class="op" id="4892638">:=</span>&nbsp;<span class="builtinfunc" id="4892641">len</span><span class="op" id="4892644">(</span><span class="ident" id="4892645">hash</span><span class="op" id="4892649">)</span><span class="op" id="4892650">*</span><span class="num" id="4892651">8</span>&nbsp;<span class="op" id="4892653">-</span>&nbsp;<span class="ident" id="4892655">orderBits</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4892666">if</span>&nbsp;<span class="ident" id="4892669">excess</span>&nbsp;<span class="op" id="4892676">&gt;</span>&nbsp;<span class="num" id="4892678">0</span>&nbsp;<span class="op" id="4892680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4892684">ret</span><span class="op" id="4892687">.</span><span class="ident" id="4892688">Rsh</span><span class="op" id="4892691">(</span><span class="ident" id="4892692">ret</span><span class="op" id="4892695">,</span>&nbsp;<span class="builtintype" id="4892697">uint</span><span class="op" id="4892701">(</span><span class="ident" id="4892702">excess</span><span class="op" id="4892708">)</span><span class="op" id="4892709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4892712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4892715">return</span>&nbsp;<span class="ident" id="4892722">ret</span><br>
<span class="lineno"></span><span class="op" id="4892726">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="4892729">//&nbsp;fermatInverse&nbsp;calculates&nbsp;the&nbsp;inverse&nbsp;of&nbsp;k&nbsp;in&nbsp;GF(P)&nbsp;using&nbsp;Fermat&#39;s&nbsp;method.</span><br>
<span class="lineno"></span><span class="comment" id="4892806">//&nbsp;This&nbsp;has&nbsp;better&nbsp;constant-time&nbsp;properties&nbsp;than&nbsp;Euclid&#39;s&nbsp;method&nbsp;(implemented</span><br>
<span class="lineno"></span><span class="comment" id="4892884">//&nbsp;in&nbsp;math/big.Int.ModInverse)&nbsp;although&nbsp;math/big&nbsp;itself&nbsp;isn&#39;t&nbsp;strictly</span><br>
<span class="lineno"></span><span class="comment" id="4892955">//&nbsp;constant-time&nbsp;so&nbsp;it&#39;s&nbsp;not&nbsp;perfect.</span><br>
<span class="lineno">115</span><span class="keyword" id="4892993">func</span>&nbsp;<span class="ident" id="4892998">fermatInverse</span><span class="op" id="4893011">(</span><span class="ident" id="4893012">k</span><span class="op" id="4893013">,</span>&nbsp;<span class="ident" id="4893015">N</span>&nbsp;<span class="op" id="4893017">*</span><span class="ident" id="4893018">big</span><span class="op" id="4893021">.</span><span class="ident" id="4893022">Int</span><span class="op" id="4893025">)</span>&nbsp;<span class="op" id="4893027">*</span><span class="ident" id="4893028">big</span><span class="op" id="4893031">.</span><span class="ident" id="4893032">Int</span>&nbsp;<span class="op" id="4893036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4893039">two</span>&nbsp;<span class="op" id="4893043">:=</span>&nbsp;<span class="ident" id="4893046">big</span><span class="op" id="4893049">.</span><span class="ident" id="4893050">NewInt</span><span class="op" id="4893056">(</span><span class="num" id="4893057">2</span><span class="op" id="4893058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4893061">nMinus2</span>&nbsp;<span class="op" id="4893069">:=</span>&nbsp;<span class="builtinfunc" id="4893072">new</span><span class="op" id="4893075">(</span><span class="ident" id="4893076">big</span><span class="op" id="4893079">.</span><span class="ident" id="4893080">Int</span><span class="op" id="4893083">)</span><span class="op" id="4893084">.</span><span class="ident" id="4893085">Sub</span><span class="op" id="4893088">(</span><span class="ident" id="4893089">N</span><span class="op" id="4893090">,</span>&nbsp;<span class="ident" id="4893092">two</span><span class="op" id="4893095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4893098">return</span>&nbsp;<span class="builtinfunc" id="4893105">new</span><span class="op" id="4893108">(</span><span class="ident" id="4893109">big</span><span class="op" id="4893112">.</span><span class="ident" id="4893113">Int</span><span class="op" id="4893116">)</span><span class="op" id="4893117">.</span><span class="ident" id="4893118">Exp</span><span class="op" id="4893121">(</span><span class="ident" id="4893122">k</span><span class="op" id="4893123">,</span>&nbsp;<span class="ident" id="4893125">nMinus2</span><span class="op" id="4893132">,</span>&nbsp;<span class="ident" id="4893134">N</span><span class="op" id="4893135">)</span><br>
<span class="lineno"></span><span class="op" id="4893137">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="comment" id="4893140">//&nbsp;Sign&nbsp;signs&nbsp;an&nbsp;arbitrary&nbsp;length&nbsp;hash&nbsp;(which&nbsp;should&nbsp;be&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4893220">//&nbsp;larger&nbsp;message)&nbsp;using&nbsp;the&nbsp;private&nbsp;key,&nbsp;priv.&nbsp;It&nbsp;returns&nbsp;the&nbsp;signature&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4893298">//&nbsp;pair&nbsp;of&nbsp;integers.&nbsp;The&nbsp;security&nbsp;of&nbsp;the&nbsp;private&nbsp;key&nbsp;depends&nbsp;on&nbsp;the&nbsp;entropy&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4893377">//&nbsp;rand.</span><br>
<span class="lineno">125</span><span class="keyword" id="4893386">func</span>&nbsp;<span class="ident" id="4893391">Sign</span><span class="op" id="4893395">(</span><span class="ident" id="4893396">rand</span>&nbsp;<span class="ident" id="4893401">io</span><span class="op" id="4893403">.</span><span class="ident" id="4893404">Reader</span><span class="op" id="4893410">,</span>&nbsp;<span class="ident" id="4893412">priv</span>&nbsp;<span class="op" id="4893417">*</span><span class="ident" id="4893418">PrivateKey</span><span class="op" id="4893428">,</span>&nbsp;<span class="ident" id="4893430">hash</span>&nbsp;<span class="op" id="4893435">[</span><span class="op" id="4893436">]</span><span class="builtintype" id="4893437">byte</span><span class="op" id="4893441">)</span>&nbsp;<span class="op" id="4893443">(</span><span class="ident" id="4893444">r</span><span class="op" id="4893445">,</span>&nbsp;<span class="ident" id="4893447">s</span>&nbsp;<span class="op" id="4893449">*</span><span class="ident" id="4893450">big</span><span class="op" id="4893453">.</span><span class="ident" id="4893454">Int</span><span class="op" id="4893457">,</span>&nbsp;<span class="ident" id="4893459">err</span>&nbsp;<span class="builtintype" id="4893463">error</span><span class="op" id="4893468">)</span>&nbsp;<span class="op" id="4893470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4893473">//&nbsp;See&nbsp;[NSA]&nbsp;3.4.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4893493">c</span>&nbsp;<span class="op" id="4893495">:=</span>&nbsp;<span class="ident" id="4893498">priv</span><span class="op" id="4893502">.</span><span class="ident" id="4893503">PublicKey</span><span class="op" id="4893512">.</span><span class="ident" id="4893513">Curve</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4893520">N</span>&nbsp;<span class="op" id="4893522">:=</span>&nbsp;<span class="ident" id="4893525">c</span><span class="op" id="4893526">.</span><span class="ident" id="4893527">Params</span><span class="op" id="4893533">(</span><span class="op" id="4893534">)</span><span class="op" id="4893535">.</span><span class="ident" id="4893536">N</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4893540">var</span>&nbsp;<span class="ident" id="4893544">k</span><span class="op" id="4893545">,</span>&nbsp;<span class="ident" id="4893547">kInv</span>&nbsp;<span class="op" id="4893552">*</span><span class="ident" id="4893553">big</span><span class="op" id="4893556">.</span><span class="ident" id="4893557">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4893562">for</span>&nbsp;<span class="op" id="4893566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4893570">for</span>&nbsp;<span class="op" id="4893574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4893579">k</span><span class="op" id="4893580">,</span>&nbsp;<span class="ident" id="4893582">err</span>&nbsp;<span class="op" id="4893586">=</span>&nbsp;<span class="ident" id="4893588">randFieldElement</span><span class="op" id="4893604">(</span><span class="ident" id="4893605">c</span><span class="op" id="4893606">,</span>&nbsp;<span class="ident" id="4893608">rand</span><span class="op" id="4893612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4893617">if</span>&nbsp;<span class="ident" id="4893620">err</span>&nbsp;<span class="op" id="4893624">!=</span>&nbsp;<span class="ident" id="4893627">nil</span>&nbsp;<span class="op" id="4893631">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4893637">r</span>&nbsp;<span class="op" id="4893639">=</span>&nbsp;<span class="ident" id="4893641">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4893649">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4893659">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4893665">kInv</span>&nbsp;<span class="op" id="4893670">=</span>&nbsp;<span class="ident" id="4893672">fermatInverse</span><span class="op" id="4893685">(</span><span class="ident" id="4893686">k</span><span class="op" id="4893687">,</span>&nbsp;<span class="ident" id="4893689">N</span><span class="op" id="4893690">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4893695">r</span><span class="op" id="4893696">,</span>&nbsp;<span class="ident" id="4893698">_</span>&nbsp;<span class="op" id="4893700">=</span>&nbsp;<span class="ident" id="4893702">priv</span><span class="op" id="4893706">.</span><span class="ident" id="4893707">Curve</span><span class="op" id="4893712">.</span><span class="ident" id="4893713">ScalarBaseMult</span><span class="op" id="4893727">(</span><span class="ident" id="4893728">k</span><span class="op" id="4893729">.</span><span class="ident" id="4893730">Bytes</span><span class="op" id="4893735">(</span><span class="op" id="4893736">)</span><span class="op" id="4893737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4893742">r</span><span class="op" id="4893743">.</span><span class="ident" id="4893744">Mod</span><span class="op" id="4893747">(</span><span class="ident" id="4893748">r</span><span class="op" id="4893749">,</span>&nbsp;<span class="ident" id="4893751">N</span><span class="op" id="4893752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4893757">if</span>&nbsp;<span class="ident" id="4893760">r</span><span class="op" id="4893761">.</span><span class="ident" id="4893762">Sign</span><span class="op" id="4893766">(</span><span class="op" id="4893767">)</span>&nbsp;<span class="op" id="4893769">!=</span>&nbsp;<span class="num" id="4893772">0</span>&nbsp;<span class="op" id="4893774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4893780">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4893789">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4893793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4893798">e</span>&nbsp;<span class="op" id="4893800">:=</span>&nbsp;<span class="ident" id="4893803">hashToInt</span><span class="op" id="4893812">(</span><span class="ident" id="4893813">hash</span><span class="op" id="4893817">,</span>&nbsp;<span class="ident" id="4893819">c</span><span class="op" id="4893820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4893824">s</span>&nbsp;<span class="op" id="4893826">=</span>&nbsp;<span class="builtinfunc" id="4893828">new</span><span class="op" id="4893831">(</span><span class="ident" id="4893832">big</span><span class="op" id="4893835">.</span><span class="ident" id="4893836">Int</span><span class="op" id="4893839">)</span><span class="op" id="4893840">.</span><span class="ident" id="4893841">Mul</span><span class="op" id="4893844">(</span><span class="ident" id="4893845">priv</span><span class="op" id="4893849">.</span><span class="ident" id="4893850">D</span><span class="op" id="4893851">,</span>&nbsp;<span class="ident" id="4893853">r</span><span class="op" id="4893854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4893858">s</span><span class="op" id="4893859">.</span><span class="ident" id="4893860">Add</span><span class="op" id="4893863">(</span><span class="ident" id="4893864">s</span><span class="op" id="4893865">,</span>&nbsp;<span class="ident" id="4893867">e</span><span class="op" id="4893868">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4893872">s</span><span class="op" id="4893873">.</span><span class="ident" id="4893874">Mul</span><span class="op" id="4893877">(</span><span class="ident" id="4893878">s</span><span class="op" id="4893879">,</span>&nbsp;<span class="ident" id="4893881">kInv</span><span class="op" id="4893885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4893889">s</span><span class="op" id="4893890">.</span><span class="ident" id="4893891">Mod</span><span class="op" id="4893894">(</span><span class="ident" id="4893895">s</span><span class="op" id="4893896">,</span>&nbsp;<span class="ident" id="4893898">N</span><span class="op" id="4893899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4893903">if</span>&nbsp;<span class="ident" id="4893906">s</span><span class="op" id="4893907">.</span><span class="ident" id="4893908">Sign</span><span class="op" id="4893912">(</span><span class="op" id="4893913">)</span>&nbsp;<span class="op" id="4893915">!=</span>&nbsp;<span class="num" id="4893918">0</span>&nbsp;<span class="op" id="4893920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4893925">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4893933">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4893936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4893940">return</span><br>
<span class="lineno"></span><span class="op" id="4893947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="4893950">//&nbsp;Verify&nbsp;verifies&nbsp;the&nbsp;signature&nbsp;in&nbsp;r,&nbsp;s&nbsp;of&nbsp;hash&nbsp;using&nbsp;the&nbsp;public&nbsp;key,&nbsp;pub.&nbsp;Its</span><br>
<span class="lineno"></span><span class="comment" id="4894030">//&nbsp;return&nbsp;value&nbsp;records&nbsp;whether&nbsp;the&nbsp;signature&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="4894086">func</span>&nbsp;<span class="ident" id="4894091">Verify</span><span class="op" id="4894097">(</span><span class="ident" id="4894098">pub</span>&nbsp;<span class="op" id="4894102">*</span><span class="ident" id="4894103">PublicKey</span><span class="op" id="4894112">,</span>&nbsp;<span class="ident" id="4894114">hash</span>&nbsp;<span class="op" id="4894119">[</span><span class="op" id="4894120">]</span><span class="builtintype" id="4894121">byte</span><span class="op" id="4894125">,</span>&nbsp;<span class="ident" id="4894127">r</span><span class="op" id="4894128">,</span>&nbsp;<span class="ident" id="4894130">s</span>&nbsp;<span class="op" id="4894132">*</span><span class="ident" id="4894133">big</span><span class="op" id="4894136">.</span><span class="ident" id="4894137">Int</span><span class="op" id="4894140">)</span>&nbsp;<span class="builtintype" id="4894142">bool</span>&nbsp;<span class="op" id="4894147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4894150">//&nbsp;See&nbsp;[NSA]&nbsp;3.4.2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4894170">c</span>&nbsp;<span class="op" id="4894172">:=</span>&nbsp;<span class="ident" id="4894175">pub</span><span class="op" id="4894178">.</span><span class="ident" id="4894179">Curve</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4894186">N</span>&nbsp;<span class="op" id="4894188">:=</span>&nbsp;<span class="ident" id="4894191">c</span><span class="op" id="4894192">.</span><span class="ident" id="4894193">Params</span><span class="op" id="4894199">(</span><span class="op" id="4894200">)</span><span class="op" id="4894201">.</span><span class="ident" id="4894202">N</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4894206">if</span>&nbsp;<span class="ident" id="4894209">r</span><span class="op" id="4894210">.</span><span class="ident" id="4894211">Sign</span><span class="op" id="4894215">(</span><span class="op" id="4894216">)</span>&nbsp;<span class="op" id="4894218">==</span>&nbsp;<span class="num" id="4894221">0</span>&nbsp;<span class="op" id="4894223">||</span>&nbsp;<span class="ident" id="4894226">s</span><span class="op" id="4894227">.</span><span class="ident" id="4894228">Sign</span><span class="op" id="4894232">(</span><span class="op" id="4894233">)</span>&nbsp;<span class="op" id="4894235">==</span>&nbsp;<span class="num" id="4894238">0</span>&nbsp;<span class="op" id="4894240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4894244">return</span>&nbsp;<span class="builtintype" id="4894251">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4894258">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4894261">if</span>&nbsp;<span class="ident" id="4894264">r</span><span class="op" id="4894265">.</span><span class="ident" id="4894266">Cmp</span><span class="op" id="4894269">(</span><span class="ident" id="4894270">N</span><span class="op" id="4894271">)</span>&nbsp;<span class="op" id="4894273">&gt;=</span>&nbsp;<span class="num" id="4894276">0</span>&nbsp;<span class="op" id="4894278">||</span>&nbsp;<span class="ident" id="4894281">s</span><span class="op" id="4894282">.</span><span class="ident" id="4894283">Cmp</span><span class="op" id="4894286">(</span><span class="ident" id="4894287">N</span><span class="op" id="4894288">)</span>&nbsp;<span class="op" id="4894290">&gt;=</span>&nbsp;<span class="num" id="4894293">0</span>&nbsp;<span class="op" id="4894295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4894299">return</span>&nbsp;<span class="builtintype" id="4894306">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4894313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4894316">e</span>&nbsp;<span class="op" id="4894318">:=</span>&nbsp;<span class="ident" id="4894321">hashToInt</span><span class="op" id="4894330">(</span><span class="ident" id="4894331">hash</span><span class="op" id="4894335">,</span>&nbsp;<span class="ident" id="4894337">c</span><span class="op" id="4894338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4894341">w</span>&nbsp;<span class="op" id="4894343">:=</span>&nbsp;<span class="builtinfunc" id="4894346">new</span><span class="op" id="4894349">(</span><span class="ident" id="4894350">big</span><span class="op" id="4894353">.</span><span class="ident" id="4894354">Int</span><span class="op" id="4894357">)</span><span class="op" id="4894358">.</span><span class="ident" id="4894359">ModInverse</span><span class="op" id="4894369">(</span><span class="ident" id="4894370">s</span><span class="op" id="4894371">,</span>&nbsp;<span class="ident" id="4894373">N</span><span class="op" id="4894374">)</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4894378">u1</span>&nbsp;<span class="op" id="4894381">:=</span>&nbsp;<span class="ident" id="4894384">e</span><span class="op" id="4894385">.</span><span class="ident" id="4894386">Mul</span><span class="op" id="4894389">(</span><span class="ident" id="4894390">e</span><span class="op" id="4894391">,</span>&nbsp;<span class="ident" id="4894393">w</span><span class="op" id="4894394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4894397">u1</span><span class="op" id="4894399">.</span><span class="ident" id="4894400">Mod</span><span class="op" id="4894403">(</span><span class="ident" id="4894404">u1</span><span class="op" id="4894406">,</span>&nbsp;<span class="ident" id="4894408">N</span><span class="op" id="4894409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4894412">u2</span>&nbsp;<span class="op" id="4894415">:=</span>&nbsp;<span class="ident" id="4894418">w</span><span class="op" id="4894419">.</span><span class="ident" id="4894420">Mul</span><span class="op" id="4894423">(</span><span class="ident" id="4894424">r</span><span class="op" id="4894425">,</span>&nbsp;<span class="ident" id="4894427">w</span><span class="op" id="4894428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4894431">u2</span><span class="op" id="4894433">.</span><span class="ident" id="4894434">Mod</span><span class="op" id="4894437">(</span><span class="ident" id="4894438">u2</span><span class="op" id="4894440">,</span>&nbsp;<span class="ident" id="4894442">N</span><span class="op" id="4894443">)</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4894447">x1</span><span class="op" id="4894449">,</span>&nbsp;<span class="ident" id="4894451">y1</span>&nbsp;<span class="op" id="4894454">:=</span>&nbsp;<span class="ident" id="4894457">c</span><span class="op" id="4894458">.</span><span class="ident" id="4894459">ScalarBaseMult</span><span class="op" id="4894473">(</span><span class="ident" id="4894474">u1</span><span class="op" id="4894476">.</span><span class="ident" id="4894477">Bytes</span><span class="op" id="4894482">(</span><span class="op" id="4894483">)</span><span class="op" id="4894484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4894487">x2</span><span class="op" id="4894489">,</span>&nbsp;<span class="ident" id="4894491">y2</span>&nbsp;<span class="op" id="4894494">:=</span>&nbsp;<span class="ident" id="4894497">c</span><span class="op" id="4894498">.</span><span class="ident" id="4894499">ScalarMult</span><span class="op" id="4894509">(</span><span class="ident" id="4894510">pub</span><span class="op" id="4894513">.</span><span class="ident" id="4894514">X</span><span class="op" id="4894515">,</span>&nbsp;<span class="ident" id="4894517">pub</span><span class="op" id="4894520">.</span><span class="ident" id="4894521">Y</span><span class="op" id="4894522">,</span>&nbsp;<span class="ident" id="4894524">u2</span><span class="op" id="4894526">.</span><span class="ident" id="4894527">Bytes</span><span class="op" id="4894532">(</span><span class="op" id="4894533">)</span><span class="op" id="4894534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4894537">x</span><span class="op" id="4894538">,</span>&nbsp;<span class="ident" id="4894540">y</span>&nbsp;<span class="op" id="4894542">:=</span>&nbsp;<span class="ident" id="4894545">c</span><span class="op" id="4894546">.</span><span class="ident" id="4894547">Add</span><span class="op" id="4894550">(</span><span class="ident" id="4894551">x1</span><span class="op" id="4894553">,</span>&nbsp;<span class="ident" id="4894555">y1</span><span class="op" id="4894557">,</span>&nbsp;<span class="ident" id="4894559">x2</span><span class="op" id="4894561">,</span>&nbsp;<span class="ident" id="4894563">y2</span><span class="op" id="4894565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4894568">if</span>&nbsp;<span class="ident" id="4894571">x</span><span class="op" id="4894572">.</span><span class="ident" id="4894573">Sign</span><span class="op" id="4894577">(</span><span class="op" id="4894578">)</span>&nbsp;<span class="op" id="4894580">==</span>&nbsp;<span class="num" id="4894583">0</span>&nbsp;<span class="op" id="4894585">&amp;&amp;</span>&nbsp;<span class="ident" id="4894588">y</span><span class="op" id="4894589">.</span><span class="ident" id="4894590">Sign</span><span class="op" id="4894594">(</span><span class="op" id="4894595">)</span>&nbsp;<span class="op" id="4894597">==</span>&nbsp;<span class="num" id="4894600">0</span>&nbsp;<span class="op" id="4894602">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4894606">return</span>&nbsp;<span class="builtintype" id="4894613">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4894620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4894623">x</span><span class="op" id="4894624">.</span><span class="ident" id="4894625">Mod</span><span class="op" id="4894628">(</span><span class="ident" id="4894629">x</span><span class="op" id="4894630">,</span>&nbsp;<span class="ident" id="4894632">N</span><span class="op" id="4894633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4894636">return</span>&nbsp;<span class="ident" id="4894643">x</span><span class="op" id="4894644">.</span><span class="ident" id="4894645">Cmp</span><span class="op" id="4894648">(</span><span class="ident" id="4894649">r</span><span class="op" id="4894650">)</span>&nbsp;<span class="op" id="4894652">==</span>&nbsp;<span class="num" id="4894655">0</span><br>
<span class="lineno"></span><span class="op" id="4894657">}</span>
</div>
</body>
</html>
