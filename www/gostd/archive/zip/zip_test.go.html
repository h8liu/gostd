<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html" class="current">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6960412">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6960467">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6960521">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6960572">//&nbsp;Tests&nbsp;that&nbsp;involve&nbsp;both&nbsp;reading&nbsp;and&nbsp;writing.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6960621">package</span>&nbsp;<span class="ident" id="6960629">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6960634">import</span>&nbsp;<span class="op" id="6960641">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6960644">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6960653">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6960660">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6960668">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6960674">&#34;io/ioutil&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6960687">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6960695">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6960706">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6960717">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6960724">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="6960727">func</span>&nbsp;<span class="ident" id="6960732">TestOver65kFiles</span><span class="op" id="6960748">(</span><span class="ident" id="6960749">t</span>&nbsp;<span class="op" id="6960751">*</span><span class="ident" id="6960752">testing</span><span class="op" id="6960759">.</span><span class="ident" id="6960760">T</span><span class="op" id="6960761">)</span>&nbsp;<span class="op" id="6960763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6960766">buf</span>&nbsp;<span class="op" id="6960770">:=</span>&nbsp;<span class="builtinfunc" id="6960773">new</span><span class="op" id="6960776">(</span><span class="ident" id="6960777">bytes</span><span class="op" id="6960782">.</span><span class="ident" id="6960783">Buffer</span><span class="op" id="6960789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6960792">w</span>&nbsp;<span class="op" id="6960794">:=</span>&nbsp;<span class="ident" id="6960797">NewWriter</span><span class="op" id="6960806">(</span><span class="ident" id="6960807">buf</span><span class="op" id="6960810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6960813">const</span>&nbsp;<span class="ident" id="6960819">nFiles</span>&nbsp;<span class="op" id="6960826">=</span>&nbsp;<span class="op" id="6960828">(</span><span class="num" id="6960829">1</span>&nbsp;<span class="op" id="6960831">&lt;&lt;</span>&nbsp;<span class="num" id="6960834">16</span><span class="op" id="6960836">)</span>&nbsp;<span class="op" id="6960838">+</span>&nbsp;<span class="num" id="6960840">42</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6960844">for</span>&nbsp;<span class="ident" id="6960848">i</span>&nbsp;<span class="op" id="6960850">:=</span>&nbsp;<span class="num" id="6960853">0</span><span class="op" id="6960854">;</span>&nbsp;<span class="ident" id="6960856">i</span>&nbsp;<span class="op" id="6960858">&lt;</span>&nbsp;<span class="ident" id="6960860">nFiles</span><span class="op" id="6960866">;</span>&nbsp;<span class="ident" id="6960868">i</span><span class="op" id="6960869">++</span>&nbsp;<span class="op" id="6960872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6960876">_</span><span class="op" id="6960877">,</span>&nbsp;<span class="ident" id="6960879">err</span>&nbsp;<span class="op" id="6960883">:=</span>&nbsp;<span class="ident" id="6960886">w</span><span class="op" id="6960887">.</span><span class="ident" id="6960888">CreateHeader</span><span class="op" id="6960900">(</span><span class="op" id="6960901">&amp;</span><span class="ident" id="6960902">FileHeader</span><span class="op" id="6960912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6960917">Name</span><span class="op" id="6960921">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6960925">fmt</span><span class="op" id="6960928">.</span><span class="ident" id="6960929">Sprintf</span><span class="op" id="6960936">(</span><span class="string" id="6960937">&#34;%d.dat&#34;</span><span class="op" id="6960945">,</span>&nbsp;<span class="ident" id="6960947">i</span><span class="op" id="6960948">)</span><span class="op" id="6960949">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6960954">Method</span><span class="op" id="6960960">:</span>&nbsp;<span class="ident" id="6960962">Store</span><span class="op" id="6960967">,</span>&nbsp;<span class="comment" id="6960969">//&nbsp;avoid&nbsp;Issue&nbsp;6136&nbsp;and&nbsp;Issue&nbsp;6138</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6961006">}</span><span class="op" id="6961007">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6961011">if</span>&nbsp;<span class="ident" id="6961014">err</span>&nbsp;<span class="op" id="6961018">!=</span>&nbsp;<span class="ident" id="6961021">nil</span>&nbsp;<span class="op" id="6961025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6961030">t</span><span class="op" id="6961031">.</span><span class="ident" id="6961032">Fatalf</span><span class="op" id="6961038">(</span><span class="string" id="6961039">&#34;creating&nbsp;file&nbsp;%d:&nbsp;%v&#34;</span><span class="op" id="6961061">,</span>&nbsp;<span class="ident" id="6961063">i</span><span class="op" id="6961064">,</span>&nbsp;<span class="ident" id="6961066">err</span><span class="op" id="6961069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6961073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6961076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6961079">if</span>&nbsp;<span class="ident" id="6961082">err</span>&nbsp;<span class="op" id="6961086">:=</span>&nbsp;<span class="ident" id="6961089">w</span><span class="op" id="6961090">.</span><span class="ident" id="6961091">Close</span><span class="op" id="6961096">(</span><span class="op" id="6961097">)</span><span class="op" id="6961098">;</span>&nbsp;<span class="ident" id="6961100">err</span>&nbsp;<span class="op" id="6961104">!=</span>&nbsp;<span class="ident" id="6961107">nil</span>&nbsp;<span class="op" id="6961111">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6961115">t</span><span class="op" id="6961116">.</span><span class="ident" id="6961117">Fatalf</span><span class="op" id="6961123">(</span><span class="string" id="6961124">&#34;Writer.Close:&nbsp;%v&#34;</span><span class="op" id="6961142">,</span>&nbsp;<span class="ident" id="6961144">err</span><span class="op" id="6961147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6961150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6961153">s</span>&nbsp;<span class="op" id="6961155">:=</span>&nbsp;<span class="ident" id="6961158">buf</span><span class="op" id="6961161">.</span><span class="ident" id="6961162">String</span><span class="op" id="6961168">(</span><span class="op" id="6961169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6961172">zr</span><span class="op" id="6961174">,</span>&nbsp;<span class="ident" id="6961176">err</span>&nbsp;<span class="op" id="6961180">:=</span>&nbsp;<span class="ident" id="6961183">NewReader</span><span class="op" id="6961192">(</span><span class="ident" id="6961193">strings</span><span class="op" id="6961200">.</span><span class="ident" id="6961201">NewReader</span><span class="op" id="6961210">(</span><span class="ident" id="6961211">s</span><span class="op" id="6961212">)</span><span class="op" id="6961213">,</span>&nbsp;<span class="ident" id="6961215">int64</span><span class="op" id="6961220">(</span><span class="builtinfunc" id="6961221">len</span><span class="op" id="6961224">(</span><span class="ident" id="6961225">s</span><span class="op" id="6961226">)</span><span class="op" id="6961227">)</span><span class="op" id="6961228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6961231">if</span>&nbsp;<span class="ident" id="6961234">err</span>&nbsp;<span class="op" id="6961238">!=</span>&nbsp;<span class="ident" id="6961241">nil</span>&nbsp;<span class="op" id="6961245">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6961249">t</span><span class="op" id="6961250">.</span><span class="ident" id="6961251">Fatalf</span><span class="op" id="6961257">(</span><span class="string" id="6961258">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="6961273">,</span>&nbsp;<span class="ident" id="6961275">err</span><span class="op" id="6961278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6961281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6961284">if</span>&nbsp;<span class="ident" id="6961287">got</span>&nbsp;<span class="op" id="6961291">:=</span>&nbsp;<span class="builtinfunc" id="6961294">len</span><span class="op" id="6961297">(</span><span class="ident" id="6961298">zr</span><span class="op" id="6961300">.</span><span class="ident" id="6961301">File</span><span class="op" id="6961305">)</span><span class="op" id="6961306">;</span>&nbsp;<span class="ident" id="6961308">got</span>&nbsp;<span class="op" id="6961312">!=</span>&nbsp;<span class="ident" id="6961315">nFiles</span>&nbsp;<span class="op" id="6961322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6961326">t</span><span class="op" id="6961327">.</span><span class="ident" id="6961328">Fatalf</span><span class="op" id="6961334">(</span><span class="string" id="6961335">&#34;File&nbsp;contains&nbsp;%d&nbsp;files,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="6961368">,</span>&nbsp;<span class="ident" id="6961370">got</span><span class="op" id="6961373">,</span>&nbsp;<span class="ident" id="6961375">nFiles</span><span class="op" id="6961381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6961384">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6961387">for</span>&nbsp;<span class="ident" id="6961391">i</span>&nbsp;<span class="op" id="6961393">:=</span>&nbsp;<span class="num" id="6961396">0</span><span class="op" id="6961397">;</span>&nbsp;<span class="ident" id="6961399">i</span>&nbsp;<span class="op" id="6961401">&lt;</span>&nbsp;<span class="ident" id="6961403">nFiles</span><span class="op" id="6961409">;</span>&nbsp;<span class="ident" id="6961411">i</span><span class="op" id="6961412">++</span>&nbsp;<span class="op" id="6961415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6961419">want</span>&nbsp;<span class="op" id="6961424">:=</span>&nbsp;<span class="ident" id="6961427">fmt</span><span class="op" id="6961430">.</span><span class="ident" id="6961431">Sprintf</span><span class="op" id="6961438">(</span><span class="string" id="6961439">&#34;%d.dat&#34;</span><span class="op" id="6961447">,</span>&nbsp;<span class="ident" id="6961449">i</span><span class="op" id="6961450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6961454">if</span>&nbsp;<span class="ident" id="6961457">zr</span><span class="op" id="6961459">.</span><span class="ident" id="6961460">File</span><span class="op" id="6961464">[</span><span class="ident" id="6961465">i</span><span class="op" id="6961466">]</span><span class="op" id="6961467">.</span><span class="ident" id="6961468">Name</span>&nbsp;<span class="op" id="6961473">!=</span>&nbsp;<span class="ident" id="6961476">want</span>&nbsp;<span class="op" id="6961481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6961486">t</span><span class="op" id="6961487">.</span><span class="ident" id="6961488">Fatalf</span><span class="op" id="6961494">(</span><span class="string" id="6961495">&#34;File(%d)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6961519">,</span>&nbsp;<span class="ident" id="6961521">i</span><span class="op" id="6961522">,</span>&nbsp;<span class="ident" id="6961524">zr</span><span class="op" id="6961526">.</span><span class="ident" id="6961527">File</span><span class="op" id="6961531">[</span><span class="ident" id="6961532">i</span><span class="op" id="6961533">]</span><span class="op" id="6961534">.</span><span class="ident" id="6961535">Name</span><span class="op" id="6961539">,</span>&nbsp;<span class="ident" id="6961541">want</span><span class="op" id="6961545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6961549">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6961552">}</span><br>
<span class="lineno"></span><span class="op" id="6961554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6961557">func</span>&nbsp;<span class="ident" id="6961562">TestModTime</span><span class="op" id="6961573">(</span><span class="ident" id="6961574">t</span>&nbsp;<span class="op" id="6961576">*</span><span class="ident" id="6961577">testing</span><span class="op" id="6961584">.</span><span class="ident" id="6961585">T</span><span class="op" id="6961586">)</span>&nbsp;<span class="op" id="6961588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6961591">var</span>&nbsp;<span class="ident" id="6961595">testTime</span>&nbsp;<span class="op" id="6961604">=</span>&nbsp;<span class="ident" id="6961606">time</span><span class="op" id="6961610">.</span><span class="ident" id="6961611">Date</span><span class="op" id="6961615">(</span><span class="num" id="6961616">2009</span><span class="op" id="6961620">,</span>&nbsp;<span class="ident" id="6961622">time</span><span class="op" id="6961626">.</span><span class="ident" id="6961627">November</span><span class="op" id="6961635">,</span>&nbsp;<span class="num" id="6961637">10</span><span class="op" id="6961639">,</span>&nbsp;<span class="num" id="6961641">23</span><span class="op" id="6961643">,</span>&nbsp;<span class="num" id="6961645">45</span><span class="op" id="6961647">,</span>&nbsp;<span class="num" id="6961649">58</span><span class="op" id="6961651">,</span>&nbsp;<span class="num" id="6961653">0</span><span class="op" id="6961654">,</span>&nbsp;<span class="ident" id="6961656">time</span><span class="op" id="6961660">.</span><span class="ident" id="6961661">UTC</span><span class="op" id="6961664">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6961667">fh</span>&nbsp;<span class="op" id="6961670">:=</span>&nbsp;<span class="builtinfunc" id="6961673">new</span><span class="op" id="6961676">(</span><span class="ident" id="6961677">FileHeader</span><span class="op" id="6961687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6961690">fh</span><span class="op" id="6961692">.</span><span class="ident" id="6961693">SetModTime</span><span class="op" id="6961703">(</span><span class="ident" id="6961704">testTime</span><span class="op" id="6961712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6961715">outTime</span>&nbsp;<span class="op" id="6961723">:=</span>&nbsp;<span class="ident" id="6961726">fh</span><span class="op" id="6961728">.</span><span class="ident" id="6961729">ModTime</span><span class="op" id="6961736">(</span><span class="op" id="6961737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6961740">if</span>&nbsp;<span class="op" id="6961743">!</span><span class="ident" id="6961744">outTime</span><span class="op" id="6961751">.</span><span class="ident" id="6961752">Equal</span><span class="op" id="6961757">(</span><span class="ident" id="6961758">testTime</span><span class="op" id="6961766">)</span>&nbsp;<span class="op" id="6961768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6961772">t</span><span class="op" id="6961773">.</span><span class="ident" id="6961774">Errorf</span><span class="op" id="6961780">(</span><span class="string" id="6961781">&#34;times&nbsp;don&#39;t&nbsp;match:&nbsp;got&nbsp;%s,&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6961817">,</span>&nbsp;<span class="ident" id="6961819">outTime</span><span class="op" id="6961826">,</span>&nbsp;<span class="ident" id="6961828">testTime</span><span class="op" id="6961836">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6961839">}</span><br>
<span class="lineno"></span><span class="op" id="6961841">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6961844">func</span>&nbsp;<span class="ident" id="6961849">testHeaderRoundTrip</span><span class="op" id="6961868">(</span><span class="ident" id="6961869">fh</span>&nbsp;<span class="op" id="6961872">*</span><span class="ident" id="6961873">FileHeader</span><span class="op" id="6961883">,</span>&nbsp;<span class="ident" id="6961885">wantUncompressedSize</span>&nbsp;<span class="builtintype" id="6961906">uint32</span><span class="op" id="6961912">,</span>&nbsp;<span class="ident" id="6961914">wantUncompressedSize64</span>&nbsp;<span class="ident" id="6961937">uint64</span><span class="op" id="6961943">,</span>&nbsp;<span class="ident" id="6961945">t</span>&nbsp;<span class="op" id="6961947">*</span><span class="ident" id="6961948">testing</span><span class="op" id="6961955">.</span><span class="ident" id="6961956">T</span><span class="op" id="6961957">)</span>&nbsp;<span class="op" id="6961959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6961962">fi</span>&nbsp;<span class="op" id="6961965">:=</span>&nbsp;<span class="ident" id="6961968">fh</span><span class="op" id="6961970">.</span><span class="ident" id="6961971">FileInfo</span><span class="op" id="6961979">(</span><span class="op" id="6961980">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6961983">fh2</span><span class="op" id="6961986">,</span>&nbsp;<span class="ident" id="6961988">err</span>&nbsp;<span class="op" id="6961992">:=</span>&nbsp;<span class="ident" id="6961995">FileInfoHeader</span><span class="op" id="6962009">(</span><span class="ident" id="6962010">fi</span><span class="op" id="6962012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6962015">if</span>&nbsp;<span class="ident" id="6962018">err</span>&nbsp;<span class="op" id="6962022">!=</span>&nbsp;<span class="ident" id="6962025">nil</span>&nbsp;<span class="op" id="6962029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6962033">t</span><span class="op" id="6962034">.</span><span class="ident" id="6962035">Fatal</span><span class="op" id="6962040">(</span><span class="ident" id="6962041">err</span><span class="op" id="6962044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6962047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6962050">if</span>&nbsp;<span class="ident" id="6962053">got</span><span class="op" id="6962056">,</span>&nbsp;<span class="ident" id="6962058">want</span>&nbsp;<span class="op" id="6962063">:=</span>&nbsp;<span class="ident" id="6962066">fh2</span><span class="op" id="6962069">.</span><span class="ident" id="6962070">Name</span><span class="op" id="6962074">,</span>&nbsp;<span class="ident" id="6962076">fh</span><span class="op" id="6962078">.</span><span class="ident" id="6962079">Name</span><span class="op" id="6962083">;</span>&nbsp;<span class="ident" id="6962085">got</span>&nbsp;<span class="op" id="6962089">!=</span>&nbsp;<span class="ident" id="6962092">want</span>&nbsp;<span class="op" id="6962097">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6962101">t</span><span class="op" id="6962102">.</span><span class="ident" id="6962103">Errorf</span><span class="op" id="6962109">(</span><span class="string" id="6962110">&#34;Name:&nbsp;got&nbsp;%s,&nbsp;want&nbsp;%s\n&#34;</span><span class="op" id="6962135">,</span>&nbsp;<span class="ident" id="6962137">got</span><span class="op" id="6962140">,</span>&nbsp;<span class="ident" id="6962142">want</span><span class="op" id="6962146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6962149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6962152">if</span>&nbsp;<span class="ident" id="6962155">got</span><span class="op" id="6962158">,</span>&nbsp;<span class="ident" id="6962160">want</span>&nbsp;<span class="op" id="6962165">:=</span>&nbsp;<span class="ident" id="6962168">fh2</span><span class="op" id="6962171">.</span><span class="ident" id="6962172">UncompressedSize</span><span class="op" id="6962188">,</span>&nbsp;<span class="ident" id="6962190">wantUncompressedSize</span><span class="op" id="6962210">;</span>&nbsp;<span class="ident" id="6962212">got</span>&nbsp;<span class="op" id="6962216">!=</span>&nbsp;<span class="ident" id="6962219">want</span>&nbsp;<span class="op" id="6962224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6962228">t</span><span class="op" id="6962229">.</span><span class="ident" id="6962230">Errorf</span><span class="op" id="6962236">(</span><span class="string" id="6962237">&#34;UncompressedSize:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="6962274">,</span>&nbsp;<span class="ident" id="6962276">got</span><span class="op" id="6962279">,</span>&nbsp;<span class="ident" id="6962281">want</span><span class="op" id="6962285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6962288">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6962291">if</span>&nbsp;<span class="ident" id="6962294">got</span><span class="op" id="6962297">,</span>&nbsp;<span class="ident" id="6962299">want</span>&nbsp;<span class="op" id="6962304">:=</span>&nbsp;<span class="ident" id="6962307">fh2</span><span class="op" id="6962310">.</span><span class="ident" id="6962311">UncompressedSize64</span><span class="op" id="6962329">,</span>&nbsp;<span class="ident" id="6962331">wantUncompressedSize64</span><span class="op" id="6962353">;</span>&nbsp;<span class="ident" id="6962355">got</span>&nbsp;<span class="op" id="6962359">!=</span>&nbsp;<span class="ident" id="6962362">want</span>&nbsp;<span class="op" id="6962367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6962371">t</span><span class="op" id="6962372">.</span><span class="ident" id="6962373">Errorf</span><span class="op" id="6962379">(</span><span class="string" id="6962380">&#34;UncompressedSize64:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="6962419">,</span>&nbsp;<span class="ident" id="6962421">got</span><span class="op" id="6962424">,</span>&nbsp;<span class="ident" id="6962426">want</span><span class="op" id="6962430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6962433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6962436">if</span>&nbsp;<span class="ident" id="6962439">got</span><span class="op" id="6962442">,</span>&nbsp;<span class="ident" id="6962444">want</span>&nbsp;<span class="op" id="6962449">:=</span>&nbsp;<span class="ident" id="6962452">fh2</span><span class="op" id="6962455">.</span><span class="ident" id="6962456">ModifiedTime</span><span class="op" id="6962468">,</span>&nbsp;<span class="ident" id="6962470">fh</span><span class="op" id="6962472">.</span><span class="ident" id="6962473">ModifiedTime</span><span class="op" id="6962485">;</span>&nbsp;<span class="ident" id="6962487">got</span>&nbsp;<span class="op" id="6962491">!=</span>&nbsp;<span class="ident" id="6962494">want</span>&nbsp;<span class="op" id="6962499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6962503">t</span><span class="op" id="6962504">.</span><span class="ident" id="6962505">Errorf</span><span class="op" id="6962511">(</span><span class="string" id="6962512">&#34;ModifiedTime:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="6962545">,</span>&nbsp;<span class="ident" id="6962547">got</span><span class="op" id="6962550">,</span>&nbsp;<span class="ident" id="6962552">want</span><span class="op" id="6962556">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6962559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6962562">if</span>&nbsp;<span class="ident" id="6962565">got</span><span class="op" id="6962568">,</span>&nbsp;<span class="ident" id="6962570">want</span>&nbsp;<span class="op" id="6962575">:=</span>&nbsp;<span class="ident" id="6962578">fh2</span><span class="op" id="6962581">.</span><span class="ident" id="6962582">ModifiedDate</span><span class="op" id="6962594">,</span>&nbsp;<span class="ident" id="6962596">fh</span><span class="op" id="6962598">.</span><span class="ident" id="6962599">ModifiedDate</span><span class="op" id="6962611">;</span>&nbsp;<span class="ident" id="6962613">got</span>&nbsp;<span class="op" id="6962617">!=</span>&nbsp;<span class="ident" id="6962620">want</span>&nbsp;<span class="op" id="6962625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6962629">t</span><span class="op" id="6962630">.</span><span class="ident" id="6962631">Errorf</span><span class="op" id="6962637">(</span><span class="string" id="6962638">&#34;ModifiedDate:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="6962671">,</span>&nbsp;<span class="ident" id="6962673">got</span><span class="op" id="6962676">,</span>&nbsp;<span class="ident" id="6962678">want</span><span class="op" id="6962682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6962685">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6962689">if</span>&nbsp;<span class="ident" id="6962692">sysfh</span><span class="op" id="6962697">,</span>&nbsp;<span class="ident" id="6962699">ok</span>&nbsp;<span class="op" id="6962702">:=</span>&nbsp;<span class="ident" id="6962705">fi</span><span class="op" id="6962707">.</span><span class="ident" id="6962708">Sys</span><span class="op" id="6962711">(</span><span class="op" id="6962712">)</span><span class="op" id="6962713">.</span><span class="op" id="6962714">(</span><span class="op" id="6962715">*</span><span class="ident" id="6962716">FileHeader</span><span class="op" id="6962726">)</span><span class="op" id="6962727">;</span>&nbsp;<span class="op" id="6962729">!</span><span class="ident" id="6962730">ok</span>&nbsp;<span class="op" id="6962733">&amp;&amp;</span>&nbsp;<span class="ident" id="6962736">sysfh</span>&nbsp;<span class="op" id="6962742">!=</span>&nbsp;<span class="ident" id="6962745">fh</span>&nbsp;<span class="op" id="6962748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6962752">t</span><span class="op" id="6962753">.</span><span class="ident" id="6962754">Errorf</span><span class="op" id="6962760">(</span><span class="string" id="6962761">&#34;Sys&nbsp;didn&#39;t&nbsp;return&nbsp;original&nbsp;*FileHeader&#34;</span><span class="op" id="6962801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6962804">}</span><br>
<span class="lineno"></span><span class="op" id="6962806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="6962809">func</span>&nbsp;<span class="ident" id="6962814">TestFileHeaderRoundTrip</span><span class="op" id="6962837">(</span><span class="ident" id="6962838">t</span>&nbsp;<span class="op" id="6962840">*</span><span class="ident" id="6962841">testing</span><span class="op" id="6962848">.</span><span class="ident" id="6962849">T</span><span class="op" id="6962850">)</span>&nbsp;<span class="op" id="6962852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6962855">fh</span>&nbsp;<span class="op" id="6962858">:=</span>&nbsp;<span class="op" id="6962861">&amp;</span><span class="ident" id="6962862">FileHeader</span><span class="op" id="6962872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6962876">Name</span><span class="op" id="6962880">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6962894">&#34;foo.txt&#34;</span><span class="op" id="6962903">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6962907">UncompressedSize</span><span class="op" id="6962923">:</span>&nbsp;<span class="num" id="6962925">987654321</span><span class="op" id="6962934">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6962938">ModifiedTime</span><span class="op" id="6962950">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6962956">1234</span><span class="op" id="6962960">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6962964">ModifiedDate</span><span class="op" id="6962976">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6962982">5678</span><span class="op" id="6962986">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6962989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6962992">testHeaderRoundTrip</span><span class="op" id="6963011">(</span><span class="ident" id="6963012">fh</span><span class="op" id="6963014">,</span>&nbsp;<span class="ident" id="6963016">fh</span><span class="op" id="6963018">.</span><span class="ident" id="6963019">UncompressedSize</span><span class="op" id="6963035">,</span>&nbsp;<span class="ident" id="6963037">uint64</span><span class="op" id="6963043">(</span><span class="ident" id="6963044">fh</span><span class="op" id="6963046">.</span><span class="ident" id="6963047">UncompressedSize</span><span class="op" id="6963063">)</span><span class="op" id="6963064">,</span>&nbsp;<span class="ident" id="6963066">t</span><span class="op" id="6963067">)</span><br>
<span class="lineno"></span><span class="op" id="6963069">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="6963072">func</span>&nbsp;<span class="ident" id="6963077">TestFileHeaderRoundTrip64</span><span class="op" id="6963102">(</span><span class="ident" id="6963103">t</span>&nbsp;<span class="op" id="6963105">*</span><span class="ident" id="6963106">testing</span><span class="op" id="6963113">.</span><span class="ident" id="6963114">T</span><span class="op" id="6963115">)</span>&nbsp;<span class="op" id="6963117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6963120">fh</span>&nbsp;<span class="op" id="6963123">:=</span>&nbsp;<span class="op" id="6963126">&amp;</span><span class="ident" id="6963127">FileHeader</span><span class="op" id="6963137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6963141">Name</span><span class="op" id="6963145">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6963161">&#34;foo.txt&#34;</span><span class="op" id="6963170">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6963174">UncompressedSize64</span><span class="op" id="6963192">:</span>&nbsp;<span class="num" id="6963194">9876543210</span><span class="op" id="6963204">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6963208">ModifiedTime</span><span class="op" id="6963220">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6963228">1234</span><span class="op" id="6963232">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6963236">ModifiedDate</span><span class="op" id="6963248">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6963256">5678</span><span class="op" id="6963260">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6963263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6963266">testHeaderRoundTrip</span><span class="op" id="6963285">(</span><span class="ident" id="6963286">fh</span><span class="op" id="6963288">,</span>&nbsp;<span class="ident" id="6963290">uint32max</span><span class="op" id="6963299">,</span>&nbsp;<span class="ident" id="6963301">fh</span><span class="op" id="6963303">.</span><span class="ident" id="6963304">UncompressedSize64</span><span class="op" id="6963322">,</span>&nbsp;<span class="ident" id="6963324">t</span><span class="op" id="6963325">)</span><br>
<span class="lineno"></span><span class="op" id="6963327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="6963330">type</span>&nbsp;<span class="ident" id="6963335">repeatedByte</span>&nbsp;<span class="keyword" id="6963348">struct</span>&nbsp;<span class="op" id="6963355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6963358">off</span>&nbsp;<span class="ident" id="6963362">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6963369">b</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6963373">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6963379">n</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6963383">int64</span><br>
<span class="lineno"></span><span class="op" id="6963389">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="6963392">//&nbsp;rleBuffer&nbsp;is&nbsp;a&nbsp;run-length-encoded&nbsp;byte&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="6963442">//&nbsp;It&#39;s&nbsp;an&nbsp;io.Writer&nbsp;(like&nbsp;a&nbsp;bytes.Buffer)&nbsp;and&nbsp;also&nbsp;an&nbsp;io.ReaderAt,</span><br>
<span class="lineno"></span><span class="comment" id="6963510">//&nbsp;allowing&nbsp;random-access&nbsp;reads.</span><br>
<span class="lineno"></span><span class="keyword" id="6963543">type</span>&nbsp;<span class="ident" id="6963548">rleBuffer</span>&nbsp;<span class="keyword" id="6963558">struct</span>&nbsp;<span class="op" id="6963565">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6963568">buf</span>&nbsp;<span class="op" id="6963572">[</span><span class="op" id="6963573">]</span><span class="ident" id="6963574">repeatedByte</span><br>
<span class="lineno"></span><span class="op" id="6963587">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6963590">func</span>&nbsp;<span class="op" id="6963595">(</span><span class="ident" id="6963596">r</span>&nbsp;<span class="op" id="6963598">*</span><span class="ident" id="6963599">rleBuffer</span><span class="op" id="6963608">)</span>&nbsp;<span class="ident" id="6963610">Size</span><span class="op" id="6963614">(</span><span class="op" id="6963615">)</span>&nbsp;<span class="ident" id="6963617">int64</span>&nbsp;<span class="op" id="6963623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6963626">if</span>&nbsp;<span class="builtinfunc" id="6963629">len</span><span class="op" id="6963632">(</span><span class="ident" id="6963633">r</span><span class="op" id="6963634">.</span><span class="ident" id="6963635">buf</span><span class="op" id="6963638">)</span>&nbsp;<span class="op" id="6963640">==</span>&nbsp;<span class="num" id="6963643">0</span>&nbsp;<span class="op" id="6963645">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6963649">return</span>&nbsp;<span class="num" id="6963656">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6963659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6963662">last</span>&nbsp;<span class="op" id="6963667">:=</span>&nbsp;<span class="op" id="6963670">&amp;</span><span class="ident" id="6963671">r</span><span class="op" id="6963672">.</span><span class="ident" id="6963673">buf</span><span class="op" id="6963676">[</span><span class="builtinfunc" id="6963677">len</span><span class="op" id="6963680">(</span><span class="ident" id="6963681">r</span><span class="op" id="6963682">.</span><span class="ident" id="6963683">buf</span><span class="op" id="6963686">)</span><span class="op" id="6963687">-</span><span class="num" id="6963688">1</span><span class="op" id="6963689">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6963692">return</span>&nbsp;<span class="ident" id="6963699">last</span><span class="op" id="6963703">.</span><span class="ident" id="6963704">off</span>&nbsp;<span class="op" id="6963708">+</span>&nbsp;<span class="ident" id="6963710">last</span><span class="op" id="6963714">.</span><span class="ident" id="6963715">n</span><br>
<span class="lineno"></span><span class="op" id="6963717">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="keyword" id="6963720">func</span>&nbsp;<span class="op" id="6963725">(</span><span class="ident" id="6963726">r</span>&nbsp;<span class="op" id="6963728">*</span><span class="ident" id="6963729">rleBuffer</span><span class="op" id="6963738">)</span>&nbsp;<span class="ident" id="6963740">Write</span><span class="op" id="6963745">(</span><span class="ident" id="6963746">p</span>&nbsp;<span class="op" id="6963748">[</span><span class="op" id="6963749">]</span><span class="builtintype" id="6963750">byte</span><span class="op" id="6963754">)</span>&nbsp;<span class="op" id="6963756">(</span><span class="ident" id="6963757">n</span>&nbsp;<span class="builtintype" id="6963759">int</span><span class="op" id="6963762">,</span>&nbsp;<span class="ident" id="6963764">err</span>&nbsp;<span class="builtintype" id="6963768">error</span><span class="op" id="6963773">)</span>&nbsp;<span class="op" id="6963775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6963778">var</span>&nbsp;<span class="ident" id="6963782">rp</span>&nbsp;<span class="op" id="6963785">*</span><span class="ident" id="6963786">repeatedByte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6963800">if</span>&nbsp;<span class="builtinfunc" id="6963803">len</span><span class="op" id="6963806">(</span><span class="ident" id="6963807">r</span><span class="op" id="6963808">.</span><span class="ident" id="6963809">buf</span><span class="op" id="6963812">)</span>&nbsp;<span class="op" id="6963814">&gt;</span>&nbsp;<span class="num" id="6963816">0</span>&nbsp;<span class="op" id="6963818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6963822">rp</span>&nbsp;<span class="op" id="6963825">=</span>&nbsp;<span class="op" id="6963827">&amp;</span><span class="ident" id="6963828">r</span><span class="op" id="6963829">.</span><span class="ident" id="6963830">buf</span><span class="op" id="6963833">[</span><span class="builtinfunc" id="6963834">len</span><span class="op" id="6963837">(</span><span class="ident" id="6963838">r</span><span class="op" id="6963839">.</span><span class="ident" id="6963840">buf</span><span class="op" id="6963843">)</span><span class="op" id="6963844">-</span><span class="num" id="6963845">1</span><span class="op" id="6963846">]</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6963850">//&nbsp;Fast&nbsp;path,&nbsp;if&nbsp;p&nbsp;is&nbsp;entirely&nbsp;the&nbsp;same&nbsp;byte&nbsp;repeated.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6963907">if</span>&nbsp;<span class="ident" id="6963910">lastByte</span>&nbsp;<span class="op" id="6963919">:=</span>&nbsp;<span class="ident" id="6963922">rp</span><span class="op" id="6963924">.</span><span class="ident" id="6963925">b</span><span class="op" id="6963926">;</span>&nbsp;<span class="builtinfunc" id="6963928">len</span><span class="op" id="6963931">(</span><span class="ident" id="6963932">p</span><span class="op" id="6963933">)</span>&nbsp;<span class="op" id="6963935">&gt;</span>&nbsp;<span class="num" id="6963937">0</span>&nbsp;<span class="op" id="6963939">&amp;&amp;</span>&nbsp;<span class="ident" id="6963942">p</span><span class="op" id="6963943">[</span><span class="num" id="6963944">0</span><span class="op" id="6963945">]</span>&nbsp;<span class="op" id="6963947">==</span>&nbsp;<span class="ident" id="6963950">lastByte</span>&nbsp;<span class="op" id="6963959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6963964">all</span>&nbsp;<span class="op" id="6963968">:=</span>&nbsp;<span class="builtintype" id="6963971">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6963979">for</span>&nbsp;<span class="ident" id="6963983">_</span><span class="op" id="6963984">,</span>&nbsp;<span class="ident" id="6963986">b</span>&nbsp;<span class="op" id="6963988">:=</span>&nbsp;<span class="keyword" id="6963991">range</span>&nbsp;<span class="ident" id="6963997">p</span>&nbsp;<span class="op" id="6963999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6964005">if</span>&nbsp;<span class="ident" id="6964008">b</span>&nbsp;<span class="op" id="6964010">!=</span>&nbsp;<span class="ident" id="6964013">lastByte</span>&nbsp;<span class="op" id="6964022">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6964029">all</span>&nbsp;<span class="op" id="6964033">=</span>&nbsp;<span class="builtintype" id="6964035">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6964046">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6964056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6964061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6964066">if</span>&nbsp;<span class="ident" id="6964069">all</span>&nbsp;<span class="op" id="6964073">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6964079">rp</span><span class="op" id="6964081">.</span><span class="ident" id="6964082">n</span>&nbsp;<span class="op" id="6964084">+=</span>&nbsp;<span class="ident" id="6964087">int64</span><span class="op" id="6964092">(</span><span class="builtinfunc" id="6964093">len</span><span class="op" id="6964096">(</span><span class="ident" id="6964097">p</span><span class="op" id="6964098">)</span><span class="op" id="6964099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6964105">return</span>&nbsp;<span class="builtinfunc" id="6964112">len</span><span class="op" id="6964115">(</span><span class="ident" id="6964116">p</span><span class="op" id="6964117">)</span><span class="op" id="6964118">,</span>&nbsp;<span class="ident" id="6964120">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6964127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6964131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6964134">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6964138">for</span>&nbsp;<span class="ident" id="6964142">_</span><span class="op" id="6964143">,</span>&nbsp;<span class="ident" id="6964145">b</span>&nbsp;<span class="op" id="6964147">:=</span>&nbsp;<span class="keyword" id="6964150">range</span>&nbsp;<span class="ident" id="6964156">p</span>&nbsp;<span class="op" id="6964158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6964162">if</span>&nbsp;<span class="ident" id="6964165">rp</span>&nbsp;<span class="op" id="6964168">==</span>&nbsp;<span class="ident" id="6964171">nil</span>&nbsp;<span class="op" id="6964175">||</span>&nbsp;<span class="ident" id="6964178">rp</span><span class="op" id="6964180">.</span><span class="ident" id="6964181">b</span>&nbsp;<span class="op" id="6964183">!=</span>&nbsp;<span class="ident" id="6964186">b</span>&nbsp;<span class="op" id="6964188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6964193">r</span><span class="op" id="6964194">.</span><span class="ident" id="6964195">buf</span>&nbsp;<span class="op" id="6964199">=</span>&nbsp;<span class="builtinfunc" id="6964201">append</span><span class="op" id="6964207">(</span><span class="ident" id="6964208">r</span><span class="op" id="6964209">.</span><span class="ident" id="6964210">buf</span><span class="op" id="6964213">,</span>&nbsp;<span class="ident" id="6964215">repeatedByte</span><span class="op" id="6964227">{</span><span class="ident" id="6964228">r</span><span class="op" id="6964229">.</span><span class="ident" id="6964230">Size</span><span class="op" id="6964234">(</span><span class="op" id="6964235">)</span><span class="op" id="6964236">,</span>&nbsp;<span class="ident" id="6964238">b</span><span class="op" id="6964239">,</span>&nbsp;<span class="num" id="6964241">1</span><span class="op" id="6964242">}</span><span class="op" id="6964243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6964248">rp</span>&nbsp;<span class="op" id="6964251">=</span>&nbsp;<span class="op" id="6964253">&amp;</span><span class="ident" id="6964254">r</span><span class="op" id="6964255">.</span><span class="ident" id="6964256">buf</span><span class="op" id="6964259">[</span><span class="builtinfunc" id="6964260">len</span><span class="op" id="6964263">(</span><span class="ident" id="6964264">r</span><span class="op" id="6964265">.</span><span class="ident" id="6964266">buf</span><span class="op" id="6964269">)</span><span class="op" id="6964270">-</span><span class="num" id="6964271">1</span><span class="op" id="6964272">]</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6964276">}</span>&nbsp;<span class="keyword" id="6964278">else</span>&nbsp;<span class="op" id="6964283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6964288">rp</span><span class="op" id="6964290">.</span><span class="ident" id="6964291">n</span><span class="op" id="6964292">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6964297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6964300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6964303">return</span>&nbsp;<span class="builtinfunc" id="6964310">len</span><span class="op" id="6964313">(</span><span class="ident" id="6964314">p</span><span class="op" id="6964315">)</span><span class="op" id="6964316">,</span>&nbsp;<span class="ident" id="6964318">nil</span><br>
<span class="lineno">160</span><span class="op" id="6964322">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6964325">func</span>&nbsp;<span class="op" id="6964330">(</span><span class="ident" id="6964331">r</span>&nbsp;<span class="op" id="6964333">*</span><span class="ident" id="6964334">rleBuffer</span><span class="op" id="6964343">)</span>&nbsp;<span class="ident" id="6964345">ReadAt</span><span class="op" id="6964351">(</span><span class="ident" id="6964352">p</span>&nbsp;<span class="op" id="6964354">[</span><span class="op" id="6964355">]</span><span class="builtintype" id="6964356">byte</span><span class="op" id="6964360">,</span>&nbsp;<span class="ident" id="6964362">off</span>&nbsp;<span class="ident" id="6964366">int64</span><span class="op" id="6964371">)</span>&nbsp;<span class="op" id="6964373">(</span><span class="ident" id="6964374">n</span>&nbsp;<span class="builtintype" id="6964376">int</span><span class="op" id="6964379">,</span>&nbsp;<span class="ident" id="6964381">err</span>&nbsp;<span class="builtintype" id="6964385">error</span><span class="op" id="6964390">)</span>&nbsp;<span class="op" id="6964392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6964395">if</span>&nbsp;<span class="builtinfunc" id="6964398">len</span><span class="op" id="6964401">(</span><span class="ident" id="6964402">p</span><span class="op" id="6964403">)</span>&nbsp;<span class="op" id="6964405">==</span>&nbsp;<span class="num" id="6964408">0</span>&nbsp;<span class="op" id="6964410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6964414">return</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6964422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6964425">skipParts</span>&nbsp;<span class="op" id="6964435">:=</span>&nbsp;<span class="ident" id="6964438">sort</span><span class="op" id="6964442">.</span><span class="ident" id="6964443">Search</span><span class="op" id="6964449">(</span><span class="builtinfunc" id="6964450">len</span><span class="op" id="6964453">(</span><span class="ident" id="6964454">r</span><span class="op" id="6964455">.</span><span class="ident" id="6964456">buf</span><span class="op" id="6964459">)</span><span class="op" id="6964460">,</span>&nbsp;<span class="keyword" id="6964462">func</span><span class="op" id="6964466">(</span><span class="ident" id="6964467">i</span>&nbsp;<span class="builtintype" id="6964469">int</span><span class="op" id="6964472">)</span>&nbsp;<span class="builtintype" id="6964474">bool</span>&nbsp;<span class="op" id="6964479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6964483">part</span>&nbsp;<span class="op" id="6964488">:=</span>&nbsp;<span class="op" id="6964491">&amp;</span><span class="ident" id="6964492">r</span><span class="op" id="6964493">.</span><span class="ident" id="6964494">buf</span><span class="op" id="6964497">[</span><span class="ident" id="6964498">i</span><span class="op" id="6964499">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6964503">return</span>&nbsp;<span class="ident" id="6964510">part</span><span class="op" id="6964514">.</span><span class="ident" id="6964515">off</span><span class="op" id="6964518">+</span><span class="ident" id="6964519">part</span><span class="op" id="6964523">.</span><span class="ident" id="6964524">n</span>&nbsp;<span class="op" id="6964526">&gt;</span>&nbsp;<span class="ident" id="6964528">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6964533">}</span><span class="op" id="6964534">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6964537">parts</span>&nbsp;<span class="op" id="6964543">:=</span>&nbsp;<span class="ident" id="6964546">r</span><span class="op" id="6964547">.</span><span class="ident" id="6964548">buf</span><span class="op" id="6964551">[</span><span class="ident" id="6964552">skipParts</span><span class="op" id="6964561">:</span><span class="op" id="6964562">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6964565">if</span>&nbsp;<span class="builtinfunc" id="6964568">len</span><span class="op" id="6964571">(</span><span class="ident" id="6964572">parts</span><span class="op" id="6964577">)</span>&nbsp;<span class="op" id="6964579">&gt;</span>&nbsp;<span class="num" id="6964581">0</span>&nbsp;<span class="op" id="6964583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6964587">skipBytes</span>&nbsp;<span class="op" id="6964597">:=</span>&nbsp;<span class="ident" id="6964600">off</span>&nbsp;<span class="op" id="6964604">-</span>&nbsp;<span class="ident" id="6964606">parts</span><span class="op" id="6964611">[</span><span class="num" id="6964612">0</span><span class="op" id="6964613">]</span><span class="op" id="6964614">.</span><span class="ident" id="6964615">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6964621">for</span>&nbsp;<span class="builtinfunc" id="6964625">len</span><span class="op" id="6964628">(</span><span class="ident" id="6964629">parts</span><span class="op" id="6964634">)</span>&nbsp;<span class="op" id="6964636">&gt;</span>&nbsp;<span class="num" id="6964638">0</span>&nbsp;<span class="op" id="6964640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6964645">part</span>&nbsp;<span class="op" id="6964650">:=</span>&nbsp;<span class="ident" id="6964653">parts</span><span class="op" id="6964658">[</span><span class="num" id="6964659">0</span><span class="op" id="6964660">]</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6964665">for</span>&nbsp;<span class="ident" id="6964669">i</span>&nbsp;<span class="op" id="6964671">:=</span>&nbsp;<span class="ident" id="6964674">skipBytes</span><span class="op" id="6964683">;</span>&nbsp;<span class="ident" id="6964685">i</span>&nbsp;<span class="op" id="6964687">&lt;</span>&nbsp;<span class="ident" id="6964689">part</span><span class="op" id="6964693">.</span><span class="ident" id="6964694">n</span><span class="op" id="6964695">;</span>&nbsp;<span class="ident" id="6964697">i</span><span class="op" id="6964698">++</span>&nbsp;<span class="op" id="6964701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6964707">if</span>&nbsp;<span class="ident" id="6964710">n</span>&nbsp;<span class="op" id="6964712">==</span>&nbsp;<span class="builtinfunc" id="6964715">len</span><span class="op" id="6964718">(</span><span class="ident" id="6964719">p</span><span class="op" id="6964720">)</span>&nbsp;<span class="op" id="6964722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6964729">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6964740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6964746">p</span><span class="op" id="6964747">[</span><span class="ident" id="6964748">n</span><span class="op" id="6964749">]</span>&nbsp;<span class="op" id="6964751">=</span>&nbsp;<span class="ident" id="6964753">part</span><span class="op" id="6964757">.</span><span class="ident" id="6964758">b</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6964764">n</span><span class="op" id="6964765">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6964771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6964776">parts</span>&nbsp;<span class="op" id="6964782">=</span>&nbsp;<span class="ident" id="6964784">parts</span><span class="op" id="6964789">[</span><span class="num" id="6964790">1</span><span class="op" id="6964791">:</span><span class="op" id="6964792">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6964797">skipBytes</span>&nbsp;<span class="op" id="6964807">=</span>&nbsp;<span class="num" id="6964809">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6964813">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6964816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6964819">if</span>&nbsp;<span class="ident" id="6964822">n</span>&nbsp;<span class="op" id="6964824">!=</span>&nbsp;<span class="builtinfunc" id="6964827">len</span><span class="op" id="6964830">(</span><span class="ident" id="6964831">p</span><span class="op" id="6964832">)</span>&nbsp;<span class="op" id="6964834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6964838">err</span>&nbsp;<span class="op" id="6964842">=</span>&nbsp;<span class="ident" id="6964844">io</span><span class="op" id="6964846">.</span><span class="ident" id="6964847">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6964865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6964868">return</span><br>
<span class="lineno">190</span><span class="op" id="6964875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6964878">//&nbsp;Just&nbsp;testing&nbsp;the&nbsp;rleBuffer&nbsp;used&nbsp;in&nbsp;the&nbsp;Zip64&nbsp;test&nbsp;above.&nbsp;Not&nbsp;used&nbsp;by&nbsp;the&nbsp;zip&nbsp;code.</span><br>
<span class="lineno"></span><span class="keyword" id="6964964">func</span>&nbsp;<span class="ident" id="6964969">TestRLEBuffer</span><span class="op" id="6964982">(</span><span class="ident" id="6964983">t</span>&nbsp;<span class="op" id="6964985">*</span><span class="ident" id="6964986">testing</span><span class="op" id="6964993">.</span><span class="ident" id="6964994">T</span><span class="op" id="6964995">)</span>&nbsp;<span class="op" id="6964997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6965000">b</span>&nbsp;<span class="op" id="6965002">:=</span>&nbsp;<span class="builtinfunc" id="6965005">new</span><span class="op" id="6965008">(</span><span class="ident" id="6965009">rleBuffer</span><span class="op" id="6965018">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6965021">var</span>&nbsp;<span class="ident" id="6965025">all</span>&nbsp;<span class="op" id="6965029">[</span><span class="op" id="6965030">]</span><span class="builtintype" id="6965031">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6965037">writes</span>&nbsp;<span class="op" id="6965044">:=</span>&nbsp;<span class="op" id="6965047">[</span><span class="op" id="6965048">]</span><span class="builtintype" id="6965049">string</span><span class="op" id="6965055">{</span><span class="string" id="6965056">&#34;abcdeee&#34;</span><span class="op" id="6965065">,</span>&nbsp;<span class="string" id="6965067">&#34;eeeeeee&#34;</span><span class="op" id="6965076">,</span>&nbsp;<span class="string" id="6965078">&#34;eeeefghaaiii&#34;</span><span class="op" id="6965092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6965095">for</span>&nbsp;<span class="ident" id="6965099">_</span><span class="op" id="6965100">,</span>&nbsp;<span class="ident" id="6965102">w</span>&nbsp;<span class="op" id="6965104">:=</span>&nbsp;<span class="keyword" id="6965107">range</span>&nbsp;<span class="ident" id="6965113">writes</span>&nbsp;<span class="op" id="6965120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6965124">b</span><span class="op" id="6965125">.</span><span class="ident" id="6965126">Write</span><span class="op" id="6965131">(</span><span class="op" id="6965132">[</span><span class="op" id="6965133">]</span><span class="builtintype" id="6965134">byte</span><span class="op" id="6965138">(</span><span class="ident" id="6965139">w</span><span class="op" id="6965140">)</span><span class="op" id="6965141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6965145">all</span>&nbsp;<span class="op" id="6965149">=</span>&nbsp;<span class="builtinfunc" id="6965151">append</span><span class="op" id="6965157">(</span><span class="ident" id="6965158">all</span><span class="op" id="6965161">,</span>&nbsp;<span class="ident" id="6965163">w</span><span class="op" id="6965164">...</span><span class="op" id="6965167">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6965170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6965173">if</span>&nbsp;<span class="builtinfunc" id="6965176">len</span><span class="op" id="6965179">(</span><span class="ident" id="6965180">b</span><span class="op" id="6965181">.</span><span class="ident" id="6965182">buf</span><span class="op" id="6965185">)</span>&nbsp;<span class="op" id="6965187">!=</span>&nbsp;<span class="num" id="6965190">10</span>&nbsp;<span class="op" id="6965193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6965197">t</span><span class="op" id="6965198">.</span><span class="ident" id="6965199">Fatalf</span><span class="op" id="6965205">(</span><span class="string" id="6965206">&#34;len(b.buf)&nbsp;=&nbsp;%d;&nbsp;want&nbsp;10&#34;</span><span class="op" id="6965232">,</span>&nbsp;<span class="builtinfunc" id="6965234">len</span><span class="op" id="6965237">(</span><span class="ident" id="6965238">b</span><span class="op" id="6965239">.</span><span class="ident" id="6965240">buf</span><span class="op" id="6965243">)</span><span class="op" id="6965244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6965247">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6965251">for</span>&nbsp;<span class="ident" id="6965255">i</span>&nbsp;<span class="op" id="6965257">:=</span>&nbsp;<span class="num" id="6965260">0</span><span class="op" id="6965261">;</span>&nbsp;<span class="ident" id="6965263">i</span>&nbsp;<span class="op" id="6965265">&lt;</span>&nbsp;<span class="builtinfunc" id="6965267">len</span><span class="op" id="6965270">(</span><span class="ident" id="6965271">all</span><span class="op" id="6965274">)</span><span class="op" id="6965275">;</span>&nbsp;<span class="ident" id="6965277">i</span><span class="op" id="6965278">++</span>&nbsp;<span class="op" id="6965281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6965285">for</span>&nbsp;<span class="ident" id="6965289">j</span>&nbsp;<span class="op" id="6965291">:=</span>&nbsp;<span class="num" id="6965294">0</span><span class="op" id="6965295">;</span>&nbsp;<span class="ident" id="6965297">j</span>&nbsp;<span class="op" id="6965299">&lt;</span>&nbsp;<span class="builtinfunc" id="6965301">len</span><span class="op" id="6965304">(</span><span class="ident" id="6965305">all</span><span class="op" id="6965308">)</span><span class="op" id="6965309">-</span><span class="ident" id="6965310">i</span><span class="op" id="6965311">;</span>&nbsp;<span class="ident" id="6965313">j</span><span class="op" id="6965314">++</span>&nbsp;<span class="op" id="6965317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6965322">buf</span>&nbsp;<span class="op" id="6965326">:=</span>&nbsp;<span class="builtinfunc" id="6965329">make</span><span class="op" id="6965333">(</span><span class="op" id="6965334">[</span><span class="op" id="6965335">]</span><span class="builtintype" id="6965336">byte</span><span class="op" id="6965340">,</span>&nbsp;<span class="ident" id="6965342">j</span><span class="op" id="6965343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6965348">n</span><span class="op" id="6965349">,</span>&nbsp;<span class="ident" id="6965351">err</span>&nbsp;<span class="op" id="6965355">:=</span>&nbsp;<span class="ident" id="6965358">b</span><span class="op" id="6965359">.</span><span class="ident" id="6965360">ReadAt</span><span class="op" id="6965366">(</span><span class="ident" id="6965367">buf</span><span class="op" id="6965370">,</span>&nbsp;<span class="ident" id="6965372">int64</span><span class="op" id="6965377">(</span><span class="ident" id="6965378">i</span><span class="op" id="6965379">)</span><span class="op" id="6965380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6965385">if</span>&nbsp;<span class="ident" id="6965388">err</span>&nbsp;<span class="op" id="6965392">!=</span>&nbsp;<span class="ident" id="6965395">nil</span>&nbsp;<span class="op" id="6965399">||</span>&nbsp;<span class="ident" id="6965402">n</span>&nbsp;<span class="op" id="6965404">!=</span>&nbsp;<span class="builtinfunc" id="6965407">len</span><span class="op" id="6965410">(</span><span class="ident" id="6965411">buf</span><span class="op" id="6965414">)</span>&nbsp;<span class="op" id="6965416">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6965422">t</span><span class="op" id="6965423">.</span><span class="ident" id="6965424">Errorf</span><span class="op" id="6965430">(</span><span class="string" id="6965431">&#34;ReadAt(%d,&nbsp;%d)&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;%d,&nbsp;nil&#34;</span><span class="op" id="6965470">,</span>&nbsp;<span class="ident" id="6965472">i</span><span class="op" id="6965473">,</span>&nbsp;<span class="ident" id="6965475">j</span><span class="op" id="6965476">,</span>&nbsp;<span class="ident" id="6965478">n</span><span class="op" id="6965479">,</span>&nbsp;<span class="ident" id="6965481">err</span><span class="op" id="6965484">,</span>&nbsp;<span class="builtinfunc" id="6965486">len</span><span class="op" id="6965489">(</span><span class="ident" id="6965490">buf</span><span class="op" id="6965493">)</span><span class="op" id="6965494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6965499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6965504">if</span>&nbsp;<span class="op" id="6965507">!</span><span class="ident" id="6965508">bytes</span><span class="op" id="6965513">.</span><span class="ident" id="6965514">Equal</span><span class="op" id="6965519">(</span><span class="ident" id="6965520">buf</span><span class="op" id="6965523">,</span>&nbsp;<span class="ident" id="6965525">all</span><span class="op" id="6965528">[</span><span class="ident" id="6965529">i</span><span class="op" id="6965530">:</span><span class="ident" id="6965531">i</span><span class="op" id="6965532">+</span><span class="ident" id="6965533">j</span><span class="op" id="6965534">]</span><span class="op" id="6965535">)</span>&nbsp;<span class="op" id="6965537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6965543">t</span><span class="op" id="6965544">.</span><span class="ident" id="6965545">Errorf</span><span class="op" id="6965551">(</span><span class="string" id="6965552">&#34;ReadAt(%d,&nbsp;%d)&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6965582">,</span>&nbsp;<span class="ident" id="6965584">i</span><span class="op" id="6965585">,</span>&nbsp;<span class="ident" id="6965587">j</span><span class="op" id="6965588">,</span>&nbsp;<span class="ident" id="6965590">buf</span><span class="op" id="6965593">,</span>&nbsp;<span class="ident" id="6965595">all</span><span class="op" id="6965598">[</span><span class="ident" id="6965599">i</span><span class="op" id="6965600">:</span><span class="ident" id="6965601">i</span><span class="op" id="6965602">+</span><span class="ident" id="6965603">j</span><span class="op" id="6965604">]</span><span class="op" id="6965605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6965610">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6965614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6965617">}</span><br>
<span class="lineno"></span><span class="op" id="6965619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6965622">//&nbsp;fakeHash32&nbsp;is&nbsp;a&nbsp;dummy&nbsp;Hash32&nbsp;that&nbsp;always&nbsp;returns&nbsp;0.</span><br>
<span class="lineno">220</span><span class="keyword" id="6965677">type</span>&nbsp;<span class="ident" id="6965682">fakeHash32</span>&nbsp;<span class="keyword" id="6965693">struct</span>&nbsp;<span class="op" id="6965700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6965703">hash</span><span class="op" id="6965707">.</span><span class="ident" id="6965708">Hash32</span><br>
<span class="lineno"></span><span class="op" id="6965715">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6965718">func</span>&nbsp;<span class="op" id="6965723">(</span><span class="ident" id="6965724">fakeHash32</span><span class="op" id="6965734">)</span>&nbsp;<span class="ident" id="6965736">Write</span><span class="op" id="6965741">(</span><span class="ident" id="6965742">p</span>&nbsp;<span class="op" id="6965744">[</span><span class="op" id="6965745">]</span><span class="builtintype" id="6965746">byte</span><span class="op" id="6965750">)</span>&nbsp;<span class="op" id="6965752">(</span><span class="builtintype" id="6965753">int</span><span class="op" id="6965756">,</span>&nbsp;<span class="builtintype" id="6965758">error</span><span class="op" id="6965763">)</span>&nbsp;<span class="op" id="6965765">{</span>&nbsp;<span class="keyword" id="6965767">return</span>&nbsp;<span class="builtinfunc" id="6965774">len</span><span class="op" id="6965777">(</span><span class="ident" id="6965778">p</span><span class="op" id="6965779">)</span><span class="op" id="6965780">,</span>&nbsp;<span class="ident" id="6965782">nil</span>&nbsp;<span class="op" id="6965786">}</span><br>
<span class="lineno">225</span><span class="keyword" id="6965788">func</span>&nbsp;<span class="op" id="6965793">(</span><span class="ident" id="6965794">fakeHash32</span><span class="op" id="6965804">)</span>&nbsp;<span class="ident" id="6965806">Sum32</span><span class="op" id="6965811">(</span><span class="op" id="6965812">)</span>&nbsp;<span class="builtintype" id="6965814">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6965835">{</span>&nbsp;<span class="keyword" id="6965837">return</span>&nbsp;<span class="num" id="6965844">0</span>&nbsp;<span class="op" id="6965846">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6965849">func</span>&nbsp;<span class="ident" id="6965854">TestZip64</span><span class="op" id="6965863">(</span><span class="ident" id="6965864">t</span>&nbsp;<span class="op" id="6965866">*</span><span class="ident" id="6965867">testing</span><span class="op" id="6965874">.</span><span class="ident" id="6965875">T</span><span class="op" id="6965876">)</span>&nbsp;<span class="op" id="6965878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6965881">if</span>&nbsp;<span class="ident" id="6965884">testing</span><span class="op" id="6965891">.</span><span class="ident" id="6965892">Short</span><span class="op" id="6965897">(</span><span class="op" id="6965898">)</span>&nbsp;<span class="op" id="6965900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6965904">t</span><span class="op" id="6965905">.</span><span class="ident" id="6965906">Skip</span><span class="op" id="6965910">(</span><span class="string" id="6965911">&#34;slow&nbsp;test;&nbsp;skipping&#34;</span><span class="op" id="6965932">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6965935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6965938">const</span>&nbsp;<span class="ident" id="6965944">size</span>&nbsp;<span class="op" id="6965949">=</span>&nbsp;<span class="num" id="6965951">1</span>&nbsp;<span class="op" id="6965953">&lt;&lt;</span>&nbsp;<span class="num" id="6965956">32</span>&nbsp;<span class="comment" id="6965959">//&nbsp;before&nbsp;the&nbsp;&#34;END\n&#34;&nbsp;part</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6965987">testZip64</span><span class="op" id="6965996">(</span><span class="ident" id="6965997">t</span><span class="op" id="6965998">,</span>&nbsp;<span class="ident" id="6966000">size</span><span class="op" id="6966004">)</span><br>
<span class="lineno"></span><span class="op" id="6966006">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword" id="6966009">func</span>&nbsp;<span class="ident" id="6966014">testZip64</span><span class="op" id="6966023">(</span><span class="ident" id="6966024">t</span>&nbsp;<span class="ident" id="6966026">testing</span><span class="op" id="6966033">.</span><span class="ident" id="6966034">TB</span><span class="op" id="6966036">,</span>&nbsp;<span class="ident" id="6966038">size</span>&nbsp;<span class="ident" id="6966043">int64</span><span class="op" id="6966048">)</span>&nbsp;<span class="op" id="6966050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6966053">const</span>&nbsp;<span class="ident" id="6966059">chunkSize</span>&nbsp;<span class="op" id="6966069">=</span>&nbsp;<span class="num" id="6966071">1024</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6966077">chunks</span>&nbsp;<span class="op" id="6966084">:=</span>&nbsp;<span class="builtintype" id="6966087">int</span><span class="op" id="6966090">(</span><span class="ident" id="6966091">size</span>&nbsp;<span class="op" id="6966096">/</span>&nbsp;<span class="ident" id="6966098">chunkSize</span><span class="op" id="6966107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6966110">//&nbsp;write&nbsp;2^32&nbsp;bytes&nbsp;plus&nbsp;&#34;END\n&#34;&nbsp;to&nbsp;a&nbsp;zip&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6966158">buf</span>&nbsp;<span class="op" id="6966162">:=</span>&nbsp;<span class="builtinfunc" id="6966165">new</span><span class="op" id="6966168">(</span><span class="ident" id="6966169">rleBuffer</span><span class="op" id="6966178">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6966181">w</span>&nbsp;<span class="op" id="6966183">:=</span>&nbsp;<span class="ident" id="6966186">NewWriter</span><span class="op" id="6966195">(</span><span class="ident" id="6966196">buf</span><span class="op" id="6966199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6966202">f</span><span class="op" id="6966203">,</span>&nbsp;<span class="ident" id="6966205">err</span>&nbsp;<span class="op" id="6966209">:=</span>&nbsp;<span class="ident" id="6966212">w</span><span class="op" id="6966213">.</span><span class="ident" id="6966214">CreateHeader</span><span class="op" id="6966226">(</span><span class="op" id="6966227">&amp;</span><span class="ident" id="6966228">FileHeader</span><span class="op" id="6966238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6966242">Name</span><span class="op" id="6966246">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6966250">&#34;huge.txt&#34;</span><span class="op" id="6966260">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6966264">Method</span><span class="op" id="6966270">:</span>&nbsp;<span class="ident" id="6966272">Store</span><span class="op" id="6966277">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6966280">}</span><span class="op" id="6966281">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6966284">if</span>&nbsp;<span class="ident" id="6966287">err</span>&nbsp;<span class="op" id="6966291">!=</span>&nbsp;<span class="ident" id="6966294">nil</span>&nbsp;<span class="op" id="6966298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6966302">t</span><span class="op" id="6966303">.</span><span class="ident" id="6966304">Fatal</span><span class="op" id="6966309">(</span><span class="ident" id="6966310">err</span><span class="op" id="6966313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6966316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6966319">f</span><span class="op" id="6966320">.</span><span class="op" id="6966321">(</span><span class="op" id="6966322">*</span><span class="ident" id="6966323">fileWriter</span><span class="op" id="6966333">)</span><span class="op" id="6966334">.</span><span class="ident" id="6966335">crc32</span>&nbsp;<span class="op" id="6966341">=</span>&nbsp;<span class="ident" id="6966343">fakeHash32</span><span class="op" id="6966353">{</span><span class="op" id="6966354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6966357">chunk</span>&nbsp;<span class="op" id="6966363">:=</span>&nbsp;<span class="builtinfunc" id="6966366">make</span><span class="op" id="6966370">(</span><span class="op" id="6966371">[</span><span class="op" id="6966372">]</span><span class="builtintype" id="6966373">byte</span><span class="op" id="6966377">,</span>&nbsp;<span class="ident" id="6966379">chunkSize</span><span class="op" id="6966388">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6966391">for</span>&nbsp;<span class="ident" id="6966395">i</span>&nbsp;<span class="op" id="6966397">:=</span>&nbsp;<span class="keyword" id="6966400">range</span>&nbsp;<span class="ident" id="6966406">chunk</span>&nbsp;<span class="op" id="6966412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6966416">chunk</span><span class="op" id="6966421">[</span><span class="ident" id="6966422">i</span><span class="op" id="6966423">]</span>&nbsp;<span class="op" id="6966425">=</span>&nbsp;<span class="string" id="6966427">&#39;.&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6966432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6966435">for</span>&nbsp;<span class="ident" id="6966439">i</span>&nbsp;<span class="op" id="6966441">:=</span>&nbsp;<span class="num" id="6966444">0</span><span class="op" id="6966445">;</span>&nbsp;<span class="ident" id="6966447">i</span>&nbsp;<span class="op" id="6966449">&lt;</span>&nbsp;<span class="ident" id="6966451">chunks</span><span class="op" id="6966457">;</span>&nbsp;<span class="ident" id="6966459">i</span><span class="op" id="6966460">++</span>&nbsp;<span class="op" id="6966463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6966467">_</span><span class="op" id="6966468">,</span>&nbsp;<span class="ident" id="6966470">err</span>&nbsp;<span class="op" id="6966474">:=</span>&nbsp;<span class="ident" id="6966477">f</span><span class="op" id="6966478">.</span><span class="ident" id="6966479">Write</span><span class="op" id="6966484">(</span><span class="ident" id="6966485">chunk</span><span class="op" id="6966490">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6966494">if</span>&nbsp;<span class="ident" id="6966497">err</span>&nbsp;<span class="op" id="6966501">!=</span>&nbsp;<span class="ident" id="6966504">nil</span>&nbsp;<span class="op" id="6966508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6966513">t</span><span class="op" id="6966514">.</span><span class="ident" id="6966515">Fatal</span><span class="op" id="6966520">(</span><span class="string" id="6966521">&#34;write&nbsp;chunk:&#34;</span><span class="op" id="6966535">,</span>&nbsp;<span class="ident" id="6966537">err</span><span class="op" id="6966540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6966544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6966547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6966550">end</span>&nbsp;<span class="op" id="6966554">:=</span>&nbsp;<span class="op" id="6966557">[</span><span class="op" id="6966558">]</span><span class="builtintype" id="6966559">byte</span><span class="op" id="6966563">(</span><span class="string" id="6966564">&#34;END\n&#34;</span><span class="op" id="6966571">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6966574">_</span><span class="op" id="6966575">,</span>&nbsp;<span class="ident" id="6966577">err</span>&nbsp;<span class="op" id="6966581">=</span>&nbsp;<span class="ident" id="6966583">f</span><span class="op" id="6966584">.</span><span class="ident" id="6966585">Write</span><span class="op" id="6966590">(</span><span class="ident" id="6966591">end</span><span class="op" id="6966594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6966597">if</span>&nbsp;<span class="ident" id="6966600">err</span>&nbsp;<span class="op" id="6966604">!=</span>&nbsp;<span class="ident" id="6966607">nil</span>&nbsp;<span class="op" id="6966611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6966615">t</span><span class="op" id="6966616">.</span><span class="ident" id="6966617">Fatal</span><span class="op" id="6966622">(</span><span class="string" id="6966623">&#34;write&nbsp;end:&#34;</span><span class="op" id="6966635">,</span>&nbsp;<span class="ident" id="6966637">err</span><span class="op" id="6966640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6966643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6966646">if</span>&nbsp;<span class="ident" id="6966649">err</span>&nbsp;<span class="op" id="6966653">:=</span>&nbsp;<span class="ident" id="6966656">w</span><span class="op" id="6966657">.</span><span class="ident" id="6966658">Close</span><span class="op" id="6966663">(</span><span class="op" id="6966664">)</span><span class="op" id="6966665">;</span>&nbsp;<span class="ident" id="6966667">err</span>&nbsp;<span class="op" id="6966671">!=</span>&nbsp;<span class="ident" id="6966674">nil</span>&nbsp;<span class="op" id="6966678">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6966682">t</span><span class="op" id="6966683">.</span><span class="ident" id="6966684">Fatal</span><span class="op" id="6966689">(</span><span class="ident" id="6966690">err</span><span class="op" id="6966693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6966696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6966700">//&nbsp;read&nbsp;back&nbsp;zip&nbsp;file&nbsp;and&nbsp;check&nbsp;that&nbsp;we&nbsp;get&nbsp;to&nbsp;the&nbsp;end&nbsp;of&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6966762">r</span><span class="op" id="6966763">,</span>&nbsp;<span class="ident" id="6966765">err</span>&nbsp;<span class="op" id="6966769">:=</span>&nbsp;<span class="ident" id="6966772">NewReader</span><span class="op" id="6966781">(</span><span class="ident" id="6966782">buf</span><span class="op" id="6966785">,</span>&nbsp;<span class="ident" id="6966787">int64</span><span class="op" id="6966792">(</span><span class="ident" id="6966793">buf</span><span class="op" id="6966796">.</span><span class="ident" id="6966797">Size</span><span class="op" id="6966801">(</span><span class="op" id="6966802">)</span><span class="op" id="6966803">)</span><span class="op" id="6966804">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6966807">if</span>&nbsp;<span class="ident" id="6966810">err</span>&nbsp;<span class="op" id="6966814">!=</span>&nbsp;<span class="ident" id="6966817">nil</span>&nbsp;<span class="op" id="6966821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6966825">t</span><span class="op" id="6966826">.</span><span class="ident" id="6966827">Fatal</span><span class="op" id="6966832">(</span><span class="string" id="6966833">&#34;reader:&#34;</span><span class="op" id="6966842">,</span>&nbsp;<span class="ident" id="6966844">err</span><span class="op" id="6966847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6966850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6966853">f0</span>&nbsp;<span class="op" id="6966856">:=</span>&nbsp;<span class="ident" id="6966859">r</span><span class="op" id="6966860">.</span><span class="ident" id="6966861">File</span><span class="op" id="6966865">[</span><span class="num" id="6966866">0</span><span class="op" id="6966867">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6966870">rc</span><span class="op" id="6966872">,</span>&nbsp;<span class="ident" id="6966874">err</span>&nbsp;<span class="op" id="6966878">:=</span>&nbsp;<span class="ident" id="6966881">f0</span><span class="op" id="6966883">.</span><span class="ident" id="6966884">Open</span><span class="op" id="6966888">(</span><span class="op" id="6966889">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6966892">if</span>&nbsp;<span class="ident" id="6966895">err</span>&nbsp;<span class="op" id="6966899">!=</span>&nbsp;<span class="ident" id="6966902">nil</span>&nbsp;<span class="op" id="6966906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6966910">t</span><span class="op" id="6966911">.</span><span class="ident" id="6966912">Fatal</span><span class="op" id="6966917">(</span><span class="string" id="6966918">&#34;opening:&#34;</span><span class="op" id="6966928">,</span>&nbsp;<span class="ident" id="6966930">err</span><span class="op" id="6966933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6966936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6966939">rc</span><span class="op" id="6966941">.</span><span class="op" id="6966942">(</span><span class="op" id="6966943">*</span><span class="ident" id="6966944">checksumReader</span><span class="op" id="6966958">)</span><span class="op" id="6966959">.</span><span class="ident" id="6966960">hash</span>&nbsp;<span class="op" id="6966965">=</span>&nbsp;<span class="ident" id="6966967">fakeHash32</span><span class="op" id="6966977">{</span><span class="op" id="6966978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6966981">for</span>&nbsp;<span class="ident" id="6966985">i</span>&nbsp;<span class="op" id="6966987">:=</span>&nbsp;<span class="num" id="6966990">0</span><span class="op" id="6966991">;</span>&nbsp;<span class="ident" id="6966993">i</span>&nbsp;<span class="op" id="6966995">&lt;</span>&nbsp;<span class="ident" id="6966997">chunks</span><span class="op" id="6967003">;</span>&nbsp;<span class="ident" id="6967005">i</span><span class="op" id="6967006">++</span>&nbsp;<span class="op" id="6967009">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6967013">_</span><span class="op" id="6967014">,</span>&nbsp;<span class="ident" id="6967016">err</span>&nbsp;<span class="op" id="6967020">:=</span>&nbsp;<span class="ident" id="6967023">io</span><span class="op" id="6967025">.</span><span class="ident" id="6967026">ReadFull</span><span class="op" id="6967034">(</span><span class="ident" id="6967035">rc</span><span class="op" id="6967037">,</span>&nbsp;<span class="ident" id="6967039">chunk</span><span class="op" id="6967044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6967048">if</span>&nbsp;<span class="ident" id="6967051">err</span>&nbsp;<span class="op" id="6967055">!=</span>&nbsp;<span class="ident" id="6967058">nil</span>&nbsp;<span class="op" id="6967062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6967067">t</span><span class="op" id="6967068">.</span><span class="ident" id="6967069">Fatal</span><span class="op" id="6967074">(</span><span class="string" id="6967075">&#34;read:&#34;</span><span class="op" id="6967082">,</span>&nbsp;<span class="ident" id="6967084">err</span><span class="op" id="6967087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6967091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6967094">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6967097">gotEnd</span><span class="op" id="6967103">,</span>&nbsp;<span class="ident" id="6967105">err</span>&nbsp;<span class="op" id="6967109">:=</span>&nbsp;<span class="ident" id="6967112">ioutil</span><span class="op" id="6967118">.</span><span class="ident" id="6967119">ReadAll</span><span class="op" id="6967126">(</span><span class="ident" id="6967127">rc</span><span class="op" id="6967129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6967132">if</span>&nbsp;<span class="ident" id="6967135">err</span>&nbsp;<span class="op" id="6967139">!=</span>&nbsp;<span class="ident" id="6967142">nil</span>&nbsp;<span class="op" id="6967146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6967150">t</span><span class="op" id="6967151">.</span><span class="ident" id="6967152">Fatal</span><span class="op" id="6967157">(</span><span class="string" id="6967158">&#34;read&nbsp;end:&#34;</span><span class="op" id="6967169">,</span>&nbsp;<span class="ident" id="6967171">err</span><span class="op" id="6967174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6967177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6967180">if</span>&nbsp;<span class="op" id="6967183">!</span><span class="ident" id="6967184">bytes</span><span class="op" id="6967189">.</span><span class="ident" id="6967190">Equal</span><span class="op" id="6967195">(</span><span class="ident" id="6967196">gotEnd</span><span class="op" id="6967202">,</span>&nbsp;<span class="ident" id="6967204">end</span><span class="op" id="6967207">)</span>&nbsp;<span class="op" id="6967209">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6967213">t</span><span class="op" id="6967214">.</span><span class="ident" id="6967215">Errorf</span><span class="op" id="6967221">(</span><span class="string" id="6967222">&#34;End&nbsp;of&nbsp;zip64&nbsp;archive&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6967256">,</span>&nbsp;<span class="ident" id="6967258">gotEnd</span><span class="op" id="6967264">,</span>&nbsp;<span class="ident" id="6967266">end</span><span class="op" id="6967269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6967272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6967275">err</span>&nbsp;<span class="op" id="6967279">=</span>&nbsp;<span class="ident" id="6967281">rc</span><span class="op" id="6967283">.</span><span class="ident" id="6967284">Close</span><span class="op" id="6967289">(</span><span class="op" id="6967290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6967293">if</span>&nbsp;<span class="ident" id="6967296">err</span>&nbsp;<span class="op" id="6967300">!=</span>&nbsp;<span class="ident" id="6967303">nil</span>&nbsp;<span class="op" id="6967307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6967311">t</span><span class="op" id="6967312">.</span><span class="ident" id="6967313">Fatal</span><span class="op" id="6967318">(</span><span class="string" id="6967319">&#34;closing:&#34;</span><span class="op" id="6967329">,</span>&nbsp;<span class="ident" id="6967331">err</span><span class="op" id="6967334">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6967337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6967340">if</span>&nbsp;<span class="ident" id="6967343">size</span>&nbsp;<span class="op" id="6967348">==</span>&nbsp;<span class="num" id="6967351">1</span><span class="op" id="6967352">&lt;&lt;</span><span class="num" id="6967354">32</span>&nbsp;<span class="op" id="6967357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6967361">if</span>&nbsp;<span class="ident" id="6967364">got</span><span class="op" id="6967367">,</span>&nbsp;<span class="ident" id="6967369">want</span>&nbsp;<span class="op" id="6967374">:=</span>&nbsp;<span class="ident" id="6967377">f0</span><span class="op" id="6967379">.</span><span class="ident" id="6967380">UncompressedSize</span><span class="op" id="6967396">,</span>&nbsp;<span class="builtintype" id="6967398">uint32</span><span class="op" id="6967404">(</span><span class="ident" id="6967405">uint32max</span><span class="op" id="6967414">)</span><span class="op" id="6967415">;</span>&nbsp;<span class="ident" id="6967417">got</span>&nbsp;<span class="op" id="6967421">!=</span>&nbsp;<span class="ident" id="6967424">want</span>&nbsp;<span class="op" id="6967429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6967434">t</span><span class="op" id="6967435">.</span><span class="ident" id="6967436">Errorf</span><span class="op" id="6967442">(</span><span class="string" id="6967443">&#34;UncompressedSize&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="6967473">,</span>&nbsp;<span class="ident" id="6967475">got</span><span class="op" id="6967478">,</span>&nbsp;<span class="ident" id="6967480">want</span><span class="op" id="6967484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6967488">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6967491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6967495">if</span>&nbsp;<span class="ident" id="6967498">got</span><span class="op" id="6967501">,</span>&nbsp;<span class="ident" id="6967503">want</span>&nbsp;<span class="op" id="6967508">:=</span>&nbsp;<span class="ident" id="6967511">f0</span><span class="op" id="6967513">.</span><span class="ident" id="6967514">UncompressedSize64</span><span class="op" id="6967532">,</span>&nbsp;<span class="ident" id="6967534">uint64</span><span class="op" id="6967540">(</span><span class="ident" id="6967541">size</span><span class="op" id="6967545">)</span><span class="op" id="6967546">+</span><span class="ident" id="6967547">uint64</span><span class="op" id="6967553">(</span><span class="builtinfunc" id="6967554">len</span><span class="op" id="6967557">(</span><span class="ident" id="6967558">end</span><span class="op" id="6967561">)</span><span class="op" id="6967562">)</span><span class="op" id="6967563">;</span>&nbsp;<span class="ident" id="6967565">got</span>&nbsp;<span class="op" id="6967569">!=</span>&nbsp;<span class="ident" id="6967572">want</span>&nbsp;<span class="op" id="6967577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6967581">t</span><span class="op" id="6967582">.</span><span class="ident" id="6967583">Errorf</span><span class="op" id="6967589">(</span><span class="string" id="6967590">&#34;UncompressedSize64&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="6967622">,</span>&nbsp;<span class="ident" id="6967624">got</span><span class="op" id="6967627">,</span>&nbsp;<span class="ident" id="6967629">want</span><span class="op" id="6967633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6967636">}</span><br>
<span class="lineno">305</span><span class="op" id="6967638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6967641">func</span>&nbsp;<span class="ident" id="6967646">testInvalidHeader</span><span class="op" id="6967663">(</span><span class="ident" id="6967664">h</span>&nbsp;<span class="op" id="6967666">*</span><span class="ident" id="6967667">FileHeader</span><span class="op" id="6967677">,</span>&nbsp;<span class="ident" id="6967679">t</span>&nbsp;<span class="op" id="6967681">*</span><span class="ident" id="6967682">testing</span><span class="op" id="6967689">.</span><span class="ident" id="6967690">T</span><span class="op" id="6967691">)</span>&nbsp;<span class="op" id="6967693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6967696">var</span>&nbsp;<span class="ident" id="6967700">buf</span>&nbsp;<span class="ident" id="6967704">bytes</span><span class="op" id="6967709">.</span><span class="ident" id="6967710">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6967718">z</span>&nbsp;<span class="op" id="6967720">:=</span>&nbsp;<span class="ident" id="6967723">NewWriter</span><span class="op" id="6967732">(</span><span class="op" id="6967733">&amp;</span><span class="ident" id="6967734">buf</span><span class="op" id="6967737">)</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6967741">f</span><span class="op" id="6967742">,</span>&nbsp;<span class="ident" id="6967744">err</span>&nbsp;<span class="op" id="6967748">:=</span>&nbsp;<span class="ident" id="6967751">z</span><span class="op" id="6967752">.</span><span class="ident" id="6967753">CreateHeader</span><span class="op" id="6967765">(</span><span class="ident" id="6967766">h</span><span class="op" id="6967767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6967770">if</span>&nbsp;<span class="ident" id="6967773">err</span>&nbsp;<span class="op" id="6967777">!=</span>&nbsp;<span class="ident" id="6967780">nil</span>&nbsp;<span class="op" id="6967784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6967788">t</span><span class="op" id="6967789">.</span><span class="ident" id="6967790">Fatalf</span><span class="op" id="6967796">(</span><span class="string" id="6967797">&#34;error&nbsp;creating&nbsp;header:&nbsp;%v&#34;</span><span class="op" id="6967824">,</span>&nbsp;<span class="ident" id="6967826">err</span><span class="op" id="6967829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6967832">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6967835">if</span>&nbsp;<span class="ident" id="6967838">_</span><span class="op" id="6967839">,</span>&nbsp;<span class="ident" id="6967841">err</span>&nbsp;<span class="op" id="6967845">:=</span>&nbsp;<span class="ident" id="6967848">f</span><span class="op" id="6967849">.</span><span class="ident" id="6967850">Write</span><span class="op" id="6967855">(</span><span class="op" id="6967856">[</span><span class="op" id="6967857">]</span><span class="builtintype" id="6967858">byte</span><span class="op" id="6967862">(</span><span class="string" id="6967863">&#34;hi&#34;</span><span class="op" id="6967867">)</span><span class="op" id="6967868">)</span><span class="op" id="6967869">;</span>&nbsp;<span class="ident" id="6967871">err</span>&nbsp;<span class="op" id="6967875">!=</span>&nbsp;<span class="ident" id="6967878">nil</span>&nbsp;<span class="op" id="6967882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6967886">t</span><span class="op" id="6967887">.</span><span class="ident" id="6967888">Fatalf</span><span class="op" id="6967894">(</span><span class="string" id="6967895">&#34;error&nbsp;writing&nbsp;content:&nbsp;%v&#34;</span><span class="op" id="6967922">,</span>&nbsp;<span class="ident" id="6967924">err</span><span class="op" id="6967927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6967930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6967933">if</span>&nbsp;<span class="ident" id="6967936">err</span>&nbsp;<span class="op" id="6967940">:=</span>&nbsp;<span class="ident" id="6967943">z</span><span class="op" id="6967944">.</span><span class="ident" id="6967945">Close</span><span class="op" id="6967950">(</span><span class="op" id="6967951">)</span><span class="op" id="6967952">;</span>&nbsp;<span class="ident" id="6967954">err</span>&nbsp;<span class="op" id="6967958">!=</span>&nbsp;<span class="ident" id="6967961">nil</span>&nbsp;<span class="op" id="6967965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6967969">t</span><span class="op" id="6967970">.</span><span class="ident" id="6967971">Fatalf</span><span class="op" id="6967977">(</span><span class="string" id="6967978">&#34;error&nbsp;closing&nbsp;zip&nbsp;writer:&nbsp;%v&#34;</span><span class="op" id="6968008">,</span>&nbsp;<span class="ident" id="6968010">err</span><span class="op" id="6968013">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6968016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6968020">b</span>&nbsp;<span class="op" id="6968022">:=</span>&nbsp;<span class="ident" id="6968025">buf</span><span class="op" id="6968028">.</span><span class="ident" id="6968029">Bytes</span><span class="op" id="6968034">(</span><span class="op" id="6968035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6968038">if</span>&nbsp;<span class="ident" id="6968041">_</span><span class="op" id="6968042">,</span>&nbsp;<span class="ident" id="6968044">err</span>&nbsp;<span class="op" id="6968048">=</span>&nbsp;<span class="ident" id="6968050">NewReader</span><span class="op" id="6968059">(</span><span class="ident" id="6968060">bytes</span><span class="op" id="6968065">.</span><span class="ident" id="6968066">NewReader</span><span class="op" id="6968075">(</span><span class="ident" id="6968076">b</span><span class="op" id="6968077">)</span><span class="op" id="6968078">,</span>&nbsp;<span class="ident" id="6968080">int64</span><span class="op" id="6968085">(</span><span class="builtinfunc" id="6968086">len</span><span class="op" id="6968089">(</span><span class="ident" id="6968090">b</span><span class="op" id="6968091">)</span><span class="op" id="6968092">)</span><span class="op" id="6968093">)</span><span class="op" id="6968094">;</span>&nbsp;<span class="ident" id="6968096">err</span>&nbsp;<span class="op" id="6968100">!=</span>&nbsp;<span class="ident" id="6968103">ErrFormat</span>&nbsp;<span class="op" id="6968113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6968117">t</span><span class="op" id="6968118">.</span><span class="ident" id="6968119">Fatalf</span><span class="op" id="6968125">(</span><span class="string" id="6968126">&#34;got&nbsp;%v,&nbsp;expected&nbsp;ErrFormat&#34;</span><span class="op" id="6968154">,</span>&nbsp;<span class="ident" id="6968156">err</span><span class="op" id="6968159">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6968162">}</span><br>
<span class="lineno"></span><span class="op" id="6968164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6968167">func</span>&nbsp;<span class="ident" id="6968172">testValidHeader</span><span class="op" id="6968187">(</span><span class="ident" id="6968188">h</span>&nbsp;<span class="op" id="6968190">*</span><span class="ident" id="6968191">FileHeader</span><span class="op" id="6968201">,</span>&nbsp;<span class="ident" id="6968203">t</span>&nbsp;<span class="op" id="6968205">*</span><span class="ident" id="6968206">testing</span><span class="op" id="6968213">.</span><span class="ident" id="6968214">T</span><span class="op" id="6968215">)</span>&nbsp;<span class="op" id="6968217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6968220">var</span>&nbsp;<span class="ident" id="6968224">buf</span>&nbsp;<span class="ident" id="6968228">bytes</span><span class="op" id="6968233">.</span><span class="ident" id="6968234">Buffer</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6968242">z</span>&nbsp;<span class="op" id="6968244">:=</span>&nbsp;<span class="ident" id="6968247">NewWriter</span><span class="op" id="6968256">(</span><span class="op" id="6968257">&amp;</span><span class="ident" id="6968258">buf</span><span class="op" id="6968261">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6968265">f</span><span class="op" id="6968266">,</span>&nbsp;<span class="ident" id="6968268">err</span>&nbsp;<span class="op" id="6968272">:=</span>&nbsp;<span class="ident" id="6968275">z</span><span class="op" id="6968276">.</span><span class="ident" id="6968277">CreateHeader</span><span class="op" id="6968289">(</span><span class="ident" id="6968290">h</span><span class="op" id="6968291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6968294">if</span>&nbsp;<span class="ident" id="6968297">err</span>&nbsp;<span class="op" id="6968301">!=</span>&nbsp;<span class="ident" id="6968304">nil</span>&nbsp;<span class="op" id="6968308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6968312">t</span><span class="op" id="6968313">.</span><span class="ident" id="6968314">Fatalf</span><span class="op" id="6968320">(</span><span class="string" id="6968321">&#34;error&nbsp;creating&nbsp;header:&nbsp;%v&#34;</span><span class="op" id="6968348">,</span>&nbsp;<span class="ident" id="6968350">err</span><span class="op" id="6968353">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6968356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6968359">if</span>&nbsp;<span class="ident" id="6968362">_</span><span class="op" id="6968363">,</span>&nbsp;<span class="ident" id="6968365">err</span>&nbsp;<span class="op" id="6968369">:=</span>&nbsp;<span class="ident" id="6968372">f</span><span class="op" id="6968373">.</span><span class="ident" id="6968374">Write</span><span class="op" id="6968379">(</span><span class="op" id="6968380">[</span><span class="op" id="6968381">]</span><span class="builtintype" id="6968382">byte</span><span class="op" id="6968386">(</span><span class="string" id="6968387">&#34;hi&#34;</span><span class="op" id="6968391">)</span><span class="op" id="6968392">)</span><span class="op" id="6968393">;</span>&nbsp;<span class="ident" id="6968395">err</span>&nbsp;<span class="op" id="6968399">!=</span>&nbsp;<span class="ident" id="6968402">nil</span>&nbsp;<span class="op" id="6968406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6968410">t</span><span class="op" id="6968411">.</span><span class="ident" id="6968412">Fatalf</span><span class="op" id="6968418">(</span><span class="string" id="6968419">&#34;error&nbsp;writing&nbsp;content:&nbsp;%v&#34;</span><span class="op" id="6968446">,</span>&nbsp;<span class="ident" id="6968448">err</span><span class="op" id="6968451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6968454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6968457">if</span>&nbsp;<span class="ident" id="6968460">err</span>&nbsp;<span class="op" id="6968464">:=</span>&nbsp;<span class="ident" id="6968467">z</span><span class="op" id="6968468">.</span><span class="ident" id="6968469">Close</span><span class="op" id="6968474">(</span><span class="op" id="6968475">)</span><span class="op" id="6968476">;</span>&nbsp;<span class="ident" id="6968478">err</span>&nbsp;<span class="op" id="6968482">!=</span>&nbsp;<span class="ident" id="6968485">nil</span>&nbsp;<span class="op" id="6968489">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6968493">t</span><span class="op" id="6968494">.</span><span class="ident" id="6968495">Fatalf</span><span class="op" id="6968501">(</span><span class="string" id="6968502">&#34;error&nbsp;closing&nbsp;zip&nbsp;writer:&nbsp;%v&#34;</span><span class="op" id="6968532">,</span>&nbsp;<span class="ident" id="6968534">err</span><span class="op" id="6968537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6968540">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6968544">b</span>&nbsp;<span class="op" id="6968546">:=</span>&nbsp;<span class="ident" id="6968549">buf</span><span class="op" id="6968552">.</span><span class="ident" id="6968553">Bytes</span><span class="op" id="6968558">(</span><span class="op" id="6968559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6968562">if</span>&nbsp;<span class="ident" id="6968565">_</span><span class="op" id="6968566">,</span>&nbsp;<span class="ident" id="6968568">err</span>&nbsp;<span class="op" id="6968572">=</span>&nbsp;<span class="ident" id="6968574">NewReader</span><span class="op" id="6968583">(</span><span class="ident" id="6968584">bytes</span><span class="op" id="6968589">.</span><span class="ident" id="6968590">NewReader</span><span class="op" id="6968599">(</span><span class="ident" id="6968600">b</span><span class="op" id="6968601">)</span><span class="op" id="6968602">,</span>&nbsp;<span class="ident" id="6968604">int64</span><span class="op" id="6968609">(</span><span class="builtinfunc" id="6968610">len</span><span class="op" id="6968613">(</span><span class="ident" id="6968614">b</span><span class="op" id="6968615">)</span><span class="op" id="6968616">)</span><span class="op" id="6968617">)</span><span class="op" id="6968618">;</span>&nbsp;<span class="ident" id="6968620">err</span>&nbsp;<span class="op" id="6968624">!=</span>&nbsp;<span class="ident" id="6968627">nil</span>&nbsp;<span class="op" id="6968631">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6968635">t</span><span class="op" id="6968636">.</span><span class="ident" id="6968637">Fatalf</span><span class="op" id="6968643">(</span><span class="string" id="6968644">&#34;got&nbsp;%v,&nbsp;expected&nbsp;nil&#34;</span><span class="op" id="6968666">,</span>&nbsp;<span class="ident" id="6968668">err</span><span class="op" id="6968671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6968674">}</span><br>
<span class="lineno"></span><span class="op" id="6968676">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6968679">//&nbsp;Issue&nbsp;4302.</span><br>
<span class="lineno">350</span><span class="keyword" id="6968694">func</span>&nbsp;<span class="ident" id="6968699">TestHeaderInvalidTagAndSize</span><span class="op" id="6968726">(</span><span class="ident" id="6968727">t</span>&nbsp;<span class="op" id="6968729">*</span><span class="ident" id="6968730">testing</span><span class="op" id="6968737">.</span><span class="ident" id="6968738">T</span><span class="op" id="6968739">)</span>&nbsp;<span class="op" id="6968741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6968744">const</span>&nbsp;<span class="ident" id="6968750">timeFormat</span>&nbsp;<span class="op" id="6968761">=</span>&nbsp;<span class="string" id="6968763">&#34;20060102T150405.000.txt&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6968791">ts</span>&nbsp;<span class="op" id="6968794">:=</span>&nbsp;<span class="ident" id="6968797">time</span><span class="op" id="6968801">.</span><span class="ident" id="6968802">Now</span><span class="op" id="6968805">(</span><span class="op" id="6968806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6968809">filename</span>&nbsp;<span class="op" id="6968818">:=</span>&nbsp;<span class="ident" id="6968821">ts</span><span class="op" id="6968823">.</span><span class="ident" id="6968824">Format</span><span class="op" id="6968830">(</span><span class="ident" id="6968831">timeFormat</span><span class="op" id="6968841">)</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6968845">h</span>&nbsp;<span class="op" id="6968847">:=</span>&nbsp;<span class="ident" id="6968850">FileHeader</span><span class="op" id="6968860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6968864">Name</span><span class="op" id="6968868">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6968872">filename</span><span class="op" id="6968880">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6968884">Method</span><span class="op" id="6968890">:</span>&nbsp;<span class="ident" id="6968892">Deflate</span><span class="op" id="6968899">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6968903">Extra</span><span class="op" id="6968908">:</span>&nbsp;&nbsp;<span class="op" id="6968911">[</span><span class="op" id="6968912">]</span><span class="builtintype" id="6968913">byte</span><span class="op" id="6968917">(</span><span class="ident" id="6968918">ts</span><span class="op" id="6968920">.</span><span class="ident" id="6968921">Format</span><span class="op" id="6968927">(</span><span class="ident" id="6968928">time</span><span class="op" id="6968932">.</span><span class="ident" id="6968933">RFC3339Nano</span><span class="op" id="6968944">)</span><span class="op" id="6968945">)</span><span class="op" id="6968946">,</span>&nbsp;<span class="comment" id="6968948">//&nbsp;missing&nbsp;tag&nbsp;and&nbsp;len</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6968972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6968975">h</span><span class="op" id="6968976">.</span><span class="ident" id="6968977">SetModTime</span><span class="op" id="6968987">(</span><span class="ident" id="6968988">ts</span><span class="op" id="6968990">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6968994">testInvalidHeader</span><span class="op" id="6969011">(</span><span class="op" id="6969012">&amp;</span><span class="ident" id="6969013">h</span><span class="op" id="6969014">,</span>&nbsp;<span class="ident" id="6969016">t</span><span class="op" id="6969017">)</span><br>
<span class="lineno"></span><span class="op" id="6969019">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="6969022">func</span>&nbsp;<span class="ident" id="6969027">TestHeaderTooShort</span><span class="op" id="6969045">(</span><span class="ident" id="6969046">t</span>&nbsp;<span class="op" id="6969048">*</span><span class="ident" id="6969049">testing</span><span class="op" id="6969056">.</span><span class="ident" id="6969057">T</span><span class="op" id="6969058">)</span>&nbsp;<span class="op" id="6969060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6969063">h</span>&nbsp;<span class="op" id="6969065">:=</span>&nbsp;<span class="ident" id="6969068">FileHeader</span><span class="op" id="6969078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6969082">Name</span><span class="op" id="6969086">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6969090">&#34;foo.txt&#34;</span><span class="op" id="6969099">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6969103">Method</span><span class="op" id="6969109">:</span>&nbsp;<span class="ident" id="6969111">Deflate</span><span class="op" id="6969118">,</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6969122">Extra</span><span class="op" id="6969127">:</span>&nbsp;&nbsp;<span class="op" id="6969130">[</span><span class="op" id="6969131">]</span><span class="builtintype" id="6969132">byte</span><span class="op" id="6969136">{</span><span class="ident" id="6969137">zip64ExtraId</span><span class="op" id="6969149">}</span><span class="op" id="6969150">,</span>&nbsp;<span class="comment" id="6969152">//&nbsp;missing&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6969169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6969172">testInvalidHeader</span><span class="op" id="6969189">(</span><span class="op" id="6969190">&amp;</span><span class="ident" id="6969191">h</span><span class="op" id="6969192">,</span>&nbsp;<span class="ident" id="6969194">t</span><span class="op" id="6969195">)</span><br>
<span class="lineno"></span><span class="op" id="6969197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span><span class="comment" id="6969200">//&nbsp;Issue&nbsp;4393.&nbsp;It&nbsp;is&nbsp;valid&nbsp;to&nbsp;have&nbsp;an&nbsp;extra&nbsp;data&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="6969256">//&nbsp;which&nbsp;contains&nbsp;no&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="6969283">func</span>&nbsp;<span class="ident" id="6969288">TestZeroLengthHeader</span><span class="op" id="6969308">(</span><span class="ident" id="6969309">t</span>&nbsp;<span class="op" id="6969311">*</span><span class="ident" id="6969312">testing</span><span class="op" id="6969319">.</span><span class="ident" id="6969320">T</span><span class="op" id="6969321">)</span>&nbsp;<span class="op" id="6969323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6969326">h</span>&nbsp;<span class="op" id="6969328">:=</span>&nbsp;<span class="ident" id="6969331">FileHeader</span><span class="op" id="6969341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6969345">Name</span><span class="op" id="6969349">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6969353">&#34;extadata.txt&#34;</span><span class="op" id="6969367">,</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6969371">Method</span><span class="op" id="6969377">:</span>&nbsp;<span class="ident" id="6969379">Deflate</span><span class="op" id="6969386">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6969390">Extra</span><span class="op" id="6969395">:</span>&nbsp;<span class="op" id="6969397">[</span><span class="op" id="6969398">]</span><span class="builtintype" id="6969399">byte</span><span class="op" id="6969403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6969408">85</span><span class="op" id="6969410">,</span>&nbsp;<span class="num" id="6969412">84</span><span class="op" id="6969414">,</span>&nbsp;<span class="num" id="6969416">5</span><span class="op" id="6969417">,</span>&nbsp;<span class="num" id="6969419">0</span><span class="op" id="6969420">,</span>&nbsp;<span class="num" id="6969422">3</span><span class="op" id="6969423">,</span>&nbsp;<span class="num" id="6969425">154</span><span class="op" id="6969428">,</span>&nbsp;<span class="num" id="6969430">144</span><span class="op" id="6969433">,</span>&nbsp;<span class="num" id="6969435">195</span><span class="op" id="6969438">,</span>&nbsp;<span class="num" id="6969440">77</span><span class="op" id="6969442">,</span>&nbsp;<span class="comment" id="6969444">//&nbsp;tag&nbsp;21589&nbsp;size&nbsp;5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6969467">85</span><span class="op" id="6969469">,</span>&nbsp;<span class="num" id="6969471">120</span><span class="op" id="6969474">,</span>&nbsp;<span class="num" id="6969476">0</span><span class="op" id="6969477">,</span>&nbsp;<span class="num" id="6969479">0</span><span class="op" id="6969480">,</span>&nbsp;<span class="comment" id="6969482">//&nbsp;tag&nbsp;30805&nbsp;size&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6969504">}</span><span class="op" id="6969505">,</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6969508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6969511">testValidHeader</span><span class="op" id="6969526">(</span><span class="op" id="6969527">&amp;</span><span class="ident" id="6969528">h</span><span class="op" id="6969529">,</span>&nbsp;<span class="ident" id="6969531">t</span><span class="op" id="6969532">)</span><br>
<span class="lineno"></span><span class="op" id="6969534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6969537">//&nbsp;Just&nbsp;benchmarking&nbsp;how&nbsp;fast&nbsp;the&nbsp;Zip64&nbsp;test&nbsp;above&nbsp;is.&nbsp;Not&nbsp;related&nbsp;to</span><br>
<span class="lineno">390</span><span class="comment" id="6969607">//&nbsp;our&nbsp;zip&nbsp;performance,&nbsp;since&nbsp;the&nbsp;test&nbsp;above&nbsp;disabled&nbsp;CRC32&nbsp;and&nbsp;flate.</span><br>
<span class="lineno"></span><span class="keyword" id="6969678">func</span>&nbsp;<span class="ident" id="6969683">BenchmarkZip64Test</span><span class="op" id="6969701">(</span><span class="ident" id="6969702">b</span>&nbsp;<span class="op" id="6969704">*</span><span class="ident" id="6969705">testing</span><span class="op" id="6969712">.</span><span class="ident" id="6969713">B</span><span class="op" id="6969714">)</span>&nbsp;<span class="op" id="6969716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6969719">for</span>&nbsp;<span class="ident" id="6969723">i</span>&nbsp;<span class="op" id="6969725">:=</span>&nbsp;<span class="num" id="6969728">0</span><span class="op" id="6969729">;</span>&nbsp;<span class="ident" id="6969731">i</span>&nbsp;<span class="op" id="6969733">&lt;</span>&nbsp;<span class="ident" id="6969735">b</span><span class="op" id="6969736">.</span><span class="ident" id="6969737">N</span><span class="op" id="6969738">;</span>&nbsp;<span class="ident" id="6969740">i</span><span class="op" id="6969741">++</span>&nbsp;<span class="op" id="6969744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6969748">testZip64</span><span class="op" id="6969757">(</span><span class="ident" id="6969758">b</span><span class="op" id="6969759">,</span>&nbsp;<span class="num" id="6969761">1</span><span class="op" id="6969762">&lt;&lt;</span><span class="num" id="6969764">26</span><span class="op" id="6969766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6969769">}</span><br>
<span class="lineno">395</span><span class="op" id="6969771">}</span>
</div>
</body>
</html>
