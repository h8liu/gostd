<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/bzip2</h2>
<ul>
<li><a href="/gostd/compress/bzip2/bit_reader.go.html">bit_reader.go</a></li>
<li><a href="/gostd/compress/bzip2/bzip2.go.html">bzip2.go</a></li>
<li><a href="/gostd/compress/bzip2/bzip2_test.go.html">bzip2_test.go</a></li>
<li><a href="/gostd/compress/bzip2/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/compress/bzip2/move_to_front.go.html" class="current">move_to_front.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5654050">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5654105">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5654159">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5654210">package</span>&nbsp;<span class="ident" id="5654218">bzip2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5654225">//&nbsp;moveToFrontDecoder&nbsp;implements&nbsp;a&nbsp;move-to-front&nbsp;list.&nbsp;Such&nbsp;a&nbsp;list&nbsp;is&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="5654298">//&nbsp;efficient&nbsp;way&nbsp;to&nbsp;transform&nbsp;a&nbsp;string&nbsp;with&nbsp;repeating&nbsp;elements&nbsp;into&nbsp;one&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="5654375">//&nbsp;many&nbsp;small&nbsp;valued&nbsp;numbers,&nbsp;which&nbsp;is&nbsp;suitable&nbsp;for&nbsp;entropy&nbsp;encoding.&nbsp;It&nbsp;works</span><br>
<span class="lineno">10</span><span class="comment" id="5654454">//&nbsp;by&nbsp;starting&nbsp;with&nbsp;an&nbsp;initial&nbsp;list&nbsp;of&nbsp;symbols&nbsp;and&nbsp;references&nbsp;symbols&nbsp;by&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="5654533">//&nbsp;index&nbsp;into&nbsp;that&nbsp;list.&nbsp;When&nbsp;a&nbsp;symbol&nbsp;is&nbsp;referenced,&nbsp;it&#39;s&nbsp;moved&nbsp;to&nbsp;the&nbsp;front</span><br>
<span class="lineno"></span><span class="comment" id="5654611">//&nbsp;of&nbsp;the&nbsp;list.&nbsp;Thus,&nbsp;a&nbsp;repeated&nbsp;symbol&nbsp;ends&nbsp;up&nbsp;being&nbsp;encoded&nbsp;with&nbsp;many&nbsp;zeros,</span><br>
<span class="lineno"></span><span class="comment" id="5654690">//&nbsp;as&nbsp;the&nbsp;symbol&nbsp;will&nbsp;be&nbsp;at&nbsp;the&nbsp;front&nbsp;of&nbsp;the&nbsp;list&nbsp;after&nbsp;the&nbsp;first&nbsp;access.</span><br>
<span class="lineno"></span><span class="keyword" id="5654764">type</span>&nbsp;<span class="ident" id="5654769">moveToFrontDecoder</span>&nbsp;<span class="op" id="5654788">[</span><span class="op" id="5654789">]</span><span class="builtintype" id="5654790">byte</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="5654796">//&nbsp;newMTFDecoder&nbsp;creates&nbsp;a&nbsp;move-to-front&nbsp;decoder&nbsp;with&nbsp;an&nbsp;explicit&nbsp;initial&nbsp;list</span><br>
<span class="lineno"></span><span class="comment" id="5654875">//&nbsp;of&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="keyword" id="5654890">func</span>&nbsp;<span class="ident" id="5654895">newMTFDecoder</span><span class="op" id="5654908">(</span><span class="ident" id="5654909">symbols</span>&nbsp;<span class="op" id="5654917">[</span><span class="op" id="5654918">]</span><span class="builtintype" id="5654919">byte</span><span class="op" id="5654923">)</span>&nbsp;<span class="ident" id="5654925">moveToFrontDecoder</span>&nbsp;<span class="op" id="5654944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5654947">if</span>&nbsp;<span class="builtinfunc" id="5654950">len</span><span class="op" id="5654953">(</span><span class="ident" id="5654954">symbols</span><span class="op" id="5654961">)</span>&nbsp;<span class="op" id="5654963">&gt;</span>&nbsp;<span class="num" id="5654965">256</span>&nbsp;<span class="op" id="5654969">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5654973">panic</span><span class="op" id="5654978">(</span><span class="string" id="5654979">&#34;too&nbsp;many&nbsp;symbols&#34;</span><span class="op" id="5654997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5655000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5655003">return</span>&nbsp;<span class="ident" id="5655010">moveToFrontDecoder</span><span class="op" id="5655028">(</span><span class="ident" id="5655029">symbols</span><span class="op" id="5655036">)</span><br>
<span class="lineno"></span><span class="op" id="5655038">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="5655041">//&nbsp;newMTFDecoderWithRange&nbsp;creates&nbsp;a&nbsp;move-to-front&nbsp;decoder&nbsp;with&nbsp;an&nbsp;initial</span><br>
<span class="lineno"></span><span class="comment" id="5655115">//&nbsp;symbol&nbsp;list&nbsp;of&nbsp;0...n-1.</span><br>
<span class="lineno"></span><span class="keyword" id="5655142">func</span>&nbsp;<span class="ident" id="5655147">newMTFDecoderWithRange</span><span class="op" id="5655169">(</span><span class="ident" id="5655170">n</span>&nbsp;<span class="builtintype" id="5655172">int</span><span class="op" id="5655175">)</span>&nbsp;<span class="ident" id="5655177">moveToFrontDecoder</span>&nbsp;<span class="op" id="5655196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5655199">if</span>&nbsp;<span class="ident" id="5655202">n</span>&nbsp;<span class="op" id="5655204">&gt;</span>&nbsp;<span class="num" id="5655206">256</span>&nbsp;<span class="op" id="5655210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5655214">panic</span><span class="op" id="5655219">(</span><span class="string" id="5655220">&#34;newMTFDecoderWithRange:&nbsp;cannot&nbsp;have&nbsp;&gt;&nbsp;256&nbsp;symbols&#34;</span><span class="op" id="5655271">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5655274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5655278">m</span>&nbsp;<span class="op" id="5655280">:=</span>&nbsp;<span class="builtinfunc" id="5655283">make</span><span class="op" id="5655287">(</span><span class="op" id="5655288">[</span><span class="op" id="5655289">]</span><span class="builtintype" id="5655290">byte</span><span class="op" id="5655294">,</span>&nbsp;<span class="ident" id="5655296">n</span><span class="op" id="5655297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5655300">for</span>&nbsp;<span class="ident" id="5655304">i</span>&nbsp;<span class="op" id="5655306">:=</span>&nbsp;<span class="num" id="5655309">0</span><span class="op" id="5655310">;</span>&nbsp;<span class="ident" id="5655312">i</span>&nbsp;<span class="op" id="5655314">&lt;</span>&nbsp;<span class="ident" id="5655316">n</span><span class="op" id="5655317">;</span>&nbsp;<span class="ident" id="5655319">i</span><span class="op" id="5655320">++</span>&nbsp;<span class="op" id="5655323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5655327">m</span><span class="op" id="5655328">[</span><span class="ident" id="5655329">i</span><span class="op" id="5655330">]</span>&nbsp;<span class="op" id="5655332">=</span>&nbsp;<span class="builtintype" id="5655334">byte</span><span class="op" id="5655338">(</span><span class="ident" id="5655339">i</span><span class="op" id="5655340">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5655343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5655346">return</span>&nbsp;<span class="ident" id="5655353">moveToFrontDecoder</span><span class="op" id="5655371">(</span><span class="ident" id="5655372">m</span><span class="op" id="5655373">)</span><br>
<span class="lineno"></span><span class="op" id="5655375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5655378">func</span>&nbsp;<span class="op" id="5655383">(</span><span class="ident" id="5655384">m</span>&nbsp;<span class="ident" id="5655386">moveToFrontDecoder</span><span class="op" id="5655404">)</span>&nbsp;<span class="ident" id="5655406">Decode</span><span class="op" id="5655412">(</span><span class="ident" id="5655413">n</span>&nbsp;<span class="builtintype" id="5655415">int</span><span class="op" id="5655418">)</span>&nbsp;<span class="op" id="5655420">(</span><span class="ident" id="5655421">b</span>&nbsp;<span class="builtintype" id="5655423">byte</span><span class="op" id="5655427">)</span>&nbsp;<span class="op" id="5655429">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5655432">//&nbsp;Implement&nbsp;move-to-front&nbsp;with&nbsp;a&nbsp;simple&nbsp;copy.&nbsp;This&nbsp;approach</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5655494">//&nbsp;beats&nbsp;more&nbsp;sophisticated&nbsp;approaches&nbsp;in&nbsp;benchmarking,&nbsp;probably</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5655560">//&nbsp;because&nbsp;it&nbsp;has&nbsp;high&nbsp;locality&nbsp;of&nbsp;reference&nbsp;inside&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5655618">//&nbsp;single&nbsp;cache&nbsp;line&nbsp;(most&nbsp;move-to-front&nbsp;operations&nbsp;have&nbsp;n&nbsp;&lt;&nbsp;64).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5655685">b</span>&nbsp;<span class="op" id="5655687">=</span>&nbsp;<span class="ident" id="5655689">m</span><span class="op" id="5655690">[</span><span class="ident" id="5655691">n</span><span class="op" id="5655692">]</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5655695">copy</span><span class="op" id="5655699">(</span><span class="ident" id="5655700">m</span><span class="op" id="5655701">[</span><span class="num" id="5655702">1</span><span class="op" id="5655703">:</span><span class="op" id="5655704">]</span><span class="op" id="5655705">,</span>&nbsp;<span class="ident" id="5655707">m</span><span class="op" id="5655708">[</span><span class="op" id="5655709">:</span><span class="ident" id="5655710">n</span><span class="op" id="5655711">]</span><span class="op" id="5655712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5655715">m</span><span class="op" id="5655716">[</span><span class="num" id="5655717">0</span><span class="op" id="5655718">]</span>&nbsp;<span class="op" id="5655720">=</span>&nbsp;<span class="ident" id="5655722">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5655725">return</span><br>
<span class="lineno"></span><span class="op" id="5655732">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="5655735">//&nbsp;First&nbsp;returns&nbsp;the&nbsp;symbol&nbsp;at&nbsp;the&nbsp;front&nbsp;of&nbsp;the&nbsp;list.</span><br>
<span class="lineno"></span><span class="keyword" id="5655789">func</span>&nbsp;<span class="op" id="5655794">(</span><span class="ident" id="5655795">m</span>&nbsp;<span class="ident" id="5655797">moveToFrontDecoder</span><span class="op" id="5655815">)</span>&nbsp;<span class="ident" id="5655817">First</span><span class="op" id="5655822">(</span><span class="op" id="5655823">)</span>&nbsp;<span class="builtintype" id="5655825">byte</span>&nbsp;<span class="op" id="5655830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5655833">return</span>&nbsp;<span class="ident" id="5655840">m</span><span class="op" id="5655841">[</span><span class="num" id="5655842">0</span><span class="op" id="5655843">]</span><br>
<span class="lineno"></span><span class="op" id="5655845">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
