<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5213524">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5213579">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5213633">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5213684">//&nbsp;This&nbsp;file&nbsp;contains&nbsp;the&nbsp;exported&nbsp;entry&nbsp;points&nbsp;for&nbsp;invoking&nbsp;the&nbsp;parser.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5213758">package</span>&nbsp;<span class="ident" id="5213766">parser</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5213774">import</span>&nbsp;<span class="op" id="5213781">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5213784">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5213793">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5213803">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5213813">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5213825">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5213831">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5213844">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5213850">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5213867">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="5213877">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="5213880">//&nbsp;If&nbsp;src&nbsp;!=&nbsp;nil,&nbsp;readSource&nbsp;converts&nbsp;src&nbsp;to&nbsp;a&nbsp;[]byte&nbsp;if&nbsp;possible;</span><br>
<span class="lineno"></span><span class="comment" id="5213947">//&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;an&nbsp;error.&nbsp;If&nbsp;src&nbsp;==&nbsp;nil,&nbsp;readSource&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="5214015">//&nbsp;the&nbsp;result&nbsp;of&nbsp;reading&nbsp;the&nbsp;file&nbsp;specified&nbsp;by&nbsp;filename.</span><br>
<span class="lineno"></span><span class="comment" id="5214072">//</span><br>
<span class="lineno">25</span><span class="keyword" id="5214075">func</span>&nbsp;<span class="ident" id="5214080">readSource</span><span class="op" id="5214090">(</span><span class="ident" id="5214091">filename</span>&nbsp;<span class="builtintype" id="5214100">string</span><span class="op" id="5214106">,</span>&nbsp;<span class="ident" id="5214108">src</span>&nbsp;<span class="keyword" id="5214112">interface</span><span class="op" id="5214121">{</span><span class="op" id="5214122">}</span><span class="op" id="5214123">)</span>&nbsp;<span class="op" id="5214125">(</span><span class="op" id="5214126">[</span><span class="op" id="5214127">]</span><span class="builtintype" id="5214128">byte</span><span class="op" id="5214132">,</span>&nbsp;<span class="builtintype" id="5214134">error</span><span class="op" id="5214139">)</span>&nbsp;<span class="op" id="5214141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5214144">if</span>&nbsp;<span class="ident" id="5214147"><a href="/go/parser/interface.go.html#5214108">src</a></span>&nbsp;<span class="op" id="5214151">!=</span>&nbsp;<span class="ident" id="5214154">nil</span>&nbsp;<span class="op" id="5214158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5214162">switch</span>&nbsp;<span class="ident" id="5214169">s</span>&nbsp;<span class="op" id="5214171">:=</span>&nbsp;<span class="ident" id="5214174"><a href="/go/parser/interface.go.html#5214108">src</a></span><span class="op" id="5214177">.</span><span class="op" id="5214178">(</span><span class="keyword" id="5214179">type</span><span class="op" id="5214183">)</span>&nbsp;<span class="op" id="5214185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5214189">case</span>&nbsp;<span class="builtintype" id="5214194">string</span><span class="op" id="5214200">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5214205">return</span>&nbsp;<span class="op" id="5214212">[</span><span class="op" id="5214213">]</span><span class="builtintype" id="5214214">byte</span><span class="op" id="5214218">(</span><span class="ident" id="5214219"><a href="/go/parser/interface.go.html#5214169">s</a></span><span class="op" id="5214220">)</span><span class="op" id="5214221">,</span>&nbsp;<span class="ident" id="5214223">nil</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5214229">case</span>&nbsp;<span class="op" id="5214234">[</span><span class="op" id="5214235">]</span><span class="builtintype" id="5214236">byte</span><span class="op" id="5214240">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5214245">return</span>&nbsp;<span class="ident" id="5214252"><a href="/go/parser/interface.go.html#5214169">s</a></span><span class="op" id="5214253">,</span>&nbsp;<span class="ident" id="5214255">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5214261">case</span>&nbsp;<span class="op" id="5214266">*</span><span class="ident" id="5214267"><a href="/go/parser/interface.go.html#5213784">bytes</a></span><span class="op" id="5214272">.</span><span class="ident" id="5214273">Buffer</span><span class="op" id="5214279">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5214284">//&nbsp;is&nbsp;io.Reader,&nbsp;but&nbsp;src&nbsp;is&nbsp;already&nbsp;available&nbsp;in&nbsp;[]byte&nbsp;form</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5214348">if</span>&nbsp;<span class="ident" id="5214351"><a href="/go/parser/interface.go.html#5214169">s</a></span>&nbsp;<span class="op" id="5214353">!=</span>&nbsp;<span class="ident" id="5214356">nil</span>&nbsp;<span class="op" id="5214360">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5214366">return</span>&nbsp;<span class="ident" id="5214373"><a href="/go/parser/interface.go.html#5214169">s</a></span><span class="op" id="5214374">.</span><span class="ident" id="5214375">Bytes</span><span class="op" id="5214380">(</span><span class="op" id="5214381">)</span><span class="op" id="5214382">,</span>&nbsp;<span class="ident" id="5214384">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5214391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5214395">case</span>&nbsp;<span class="ident" id="5214400"><a href="/go/parser/interface.go.html#5213825">io</a></span><span class="op" id="5214402">.</span><span class="ident" id="5214403">Reader</span><span class="op" id="5214409">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5214414">var</span>&nbsp;<span class="ident" id="5214418">buf</span>&nbsp;<span class="ident" id="5214422"><a href="/go/parser/interface.go.html#5213784">bytes</a></span><span class="op" id="5214427">.</span><span class="ident" id="5214428">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5214438">if</span>&nbsp;<span class="ident" id="5214441">_</span><span class="op" id="5214442">,</span>&nbsp;<span class="ident" id="5214444">err</span>&nbsp;<span class="op" id="5214448">:=</span>&nbsp;<span class="ident" id="5214451"><a href="/go/parser/interface.go.html#5213825">io</a></span><span class="op" id="5214453">.</span><span class="ident" id="5214454">Copy</span><span class="op" id="5214458">(</span><span class="op" id="5214459">&amp;</span><span class="ident" id="5214460"><a href="/go/parser/interface.go.html#5214418">buf</a></span><span class="op" id="5214463">,</span>&nbsp;<span class="ident" id="5214465"><a href="/go/parser/interface.go.html#5214169">s</a></span><span class="op" id="5214466">)</span><span class="op" id="5214467">;</span>&nbsp;<span class="ident" id="5214469"><a href="/go/parser/interface.go.html#5214444">err</a></span>&nbsp;<span class="op" id="5214473">!=</span>&nbsp;<span class="ident" id="5214476">nil</span>&nbsp;<span class="op" id="5214480">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5214486">return</span>&nbsp;<span class="ident" id="5214493">nil</span><span class="op" id="5214496">,</span>&nbsp;<span class="ident" id="5214498"><a href="/go/parser/interface.go.html#5214444">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5214505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5214510">return</span>&nbsp;<span class="ident" id="5214517"><a href="/go/parser/interface.go.html#5214418">buf</a></span><span class="op" id="5214520">.</span><span class="ident" id="5214521">Bytes</span><span class="op" id="5214526">(</span><span class="op" id="5214527">)</span><span class="op" id="5214528">,</span>&nbsp;<span class="ident" id="5214530">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5214536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5214540">return</span>&nbsp;<span class="ident" id="5214547">nil</span><span class="op" id="5214550">,</span>&nbsp;<span class="ident" id="5214552"><a href="/go/parser/interface.go.html#5213793">errors</a></span><span class="op" id="5214558">.</span><span class="ident" id="5214559">New</span><span class="op" id="5214562">(</span><span class="string" id="5214563">&#34;invalid&nbsp;source&#34;</span><span class="op" id="5214579">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5214582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5214585">return</span>&nbsp;<span class="ident" id="5214592"><a href="/go/parser/interface.go.html#5213831">ioutil</a></span><span class="op" id="5214598">.</span><span class="ident" id="5214599">ReadFile</span><span class="op" id="5214607">(</span><span class="ident" id="5214608"><a href="/go/parser/interface.go.html#5214091">filename</a></span><span class="op" id="5214616">)</span><br>
<span class="lineno"></span><span class="op" id="5214618">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5214621">//&nbsp;A&nbsp;Mode&nbsp;value&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;flags&nbsp;(or&nbsp;0).</span><br>
<span class="lineno">50</span><span class="comment" id="5214663">//&nbsp;They&nbsp;control&nbsp;the&nbsp;amount&nbsp;of&nbsp;source&nbsp;code&nbsp;parsed&nbsp;and&nbsp;other&nbsp;optional</span><br>
<span class="lineno"></span><span class="comment" id="5214731">//&nbsp;parser&nbsp;functionality.</span><br>
<span class="lineno"></span><span class="comment" id="5214756">//</span><br>
<span class="lineno"></span><span class="keyword" id="5214759">type</span>&nbsp;<span class="ident" id="5214764">Mode</span>&nbsp;<span class="builtintype" id="5214769">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="5214775">const</span>&nbsp;<span class="op" id="5214781">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5214784">PackageClauseOnly</span>&nbsp;<span class="ident" id="5214802"><a href="/go/parser/interface.go.html#5214764">Mode</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5214819">=</span>&nbsp;<span class="num" id="5214821">1</span>&nbsp;<span class="op" id="5214823">&lt;&lt;</span>&nbsp;<span class="ident" id="5214826">iota</span>&nbsp;<span class="comment" id="5214831">//&nbsp;stop&nbsp;parsing&nbsp;after&nbsp;package&nbsp;clause</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5214869">ImportsOnly</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5214916">//&nbsp;stop&nbsp;parsing&nbsp;after&nbsp;import&nbsp;declarations</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5214959">ParseComments</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5215006">//&nbsp;parse&nbsp;comments&nbsp;and&nbsp;add&nbsp;them&nbsp;to&nbsp;AST</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5215045">Trace</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5215092">//&nbsp;print&nbsp;a&nbsp;trace&nbsp;of&nbsp;parsed&nbsp;productions</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5215132">DeclarationErrors</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5215179">//&nbsp;report&nbsp;declaration&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5215209">SpuriousErrors</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5215256">//&nbsp;same&nbsp;as&nbsp;AllErrors,&nbsp;for&nbsp;backward-compatibility</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5215306">AllErrors</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5215324">=</span>&nbsp;<span class="ident" id="5215326"><a href="/go/parser/interface.go.html#5215209">SpuriousErrors</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5215353">//&nbsp;report&nbsp;all&nbsp;errors&nbsp;(not&nbsp;just&nbsp;the&nbsp;first&nbsp;10&nbsp;on&nbsp;different&nbsp;lines)</span><br>
<span class="lineno"></span><span class="op" id="5215417">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="5215420">//&nbsp;ParseFile&nbsp;parses&nbsp;the&nbsp;source&nbsp;code&nbsp;of&nbsp;a&nbsp;single&nbsp;Go&nbsp;source&nbsp;file&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="5215495">//&nbsp;the&nbsp;corresponding&nbsp;ast.File&nbsp;node.&nbsp;The&nbsp;source&nbsp;code&nbsp;may&nbsp;be&nbsp;provided&nbsp;via</span><br>
<span class="lineno"></span><span class="comment" id="5215567">//&nbsp;the&nbsp;filename&nbsp;of&nbsp;the&nbsp;source&nbsp;file,&nbsp;or&nbsp;via&nbsp;the&nbsp;src&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="comment" id="5215629">//</span><br>
<span class="lineno"></span><span class="comment" id="5215632">//&nbsp;If&nbsp;src&nbsp;!=&nbsp;nil,&nbsp;ParseFile&nbsp;parses&nbsp;the&nbsp;source&nbsp;from&nbsp;src&nbsp;and&nbsp;the&nbsp;filename&nbsp;is</span><br>
<span class="lineno">70</span><span class="comment" id="5215707">//&nbsp;only&nbsp;used&nbsp;when&nbsp;recording&nbsp;position&nbsp;information.&nbsp;The&nbsp;type&nbsp;of&nbsp;the&nbsp;argument</span><br>
<span class="lineno"></span><span class="comment" id="5215782">//&nbsp;for&nbsp;the&nbsp;src&nbsp;parameter&nbsp;must&nbsp;be&nbsp;string,&nbsp;[]byte,&nbsp;or&nbsp;io.Reader.</span><br>
<span class="lineno"></span><span class="comment" id="5215845">//&nbsp;If&nbsp;src&nbsp;==&nbsp;nil,&nbsp;ParseFile&nbsp;parses&nbsp;the&nbsp;file&nbsp;specified&nbsp;by&nbsp;filename.</span><br>
<span class="lineno"></span><span class="comment" id="5215912">//</span><br>
<span class="lineno"></span><span class="comment" id="5215915">//&nbsp;The&nbsp;mode&nbsp;parameter&nbsp;controls&nbsp;the&nbsp;amount&nbsp;of&nbsp;source&nbsp;text&nbsp;parsed&nbsp;and&nbsp;other</span><br>
<span class="lineno">75</span><span class="comment" id="5215989">//&nbsp;optional&nbsp;parser&nbsp;functionality.&nbsp;Position&nbsp;information&nbsp;is&nbsp;recorded&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5216063">//&nbsp;file&nbsp;set&nbsp;fset.</span><br>
<span class="lineno"></span><span class="comment" id="5216081">//</span><br>
<span class="lineno"></span><span class="comment" id="5216084">//&nbsp;If&nbsp;the&nbsp;source&nbsp;couldn&#39;t&nbsp;be&nbsp;read,&nbsp;the&nbsp;returned&nbsp;AST&nbsp;is&nbsp;nil&nbsp;and&nbsp;the&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="5216157">//&nbsp;indicates&nbsp;the&nbsp;specific&nbsp;failure.&nbsp;If&nbsp;the&nbsp;source&nbsp;was&nbsp;read&nbsp;but&nbsp;syntax</span><br>
<span class="lineno">80</span><span class="comment" id="5216226">//&nbsp;errors&nbsp;were&nbsp;found,&nbsp;the&nbsp;result&nbsp;is&nbsp;a&nbsp;partial&nbsp;AST&nbsp;(with&nbsp;ast.Bad*&nbsp;nodes</span><br>
<span class="lineno"></span><span class="comment" id="5216297">//&nbsp;representing&nbsp;the&nbsp;fragments&nbsp;of&nbsp;erroneous&nbsp;source&nbsp;code).&nbsp;Multiple&nbsp;errors</span><br>
<span class="lineno"></span><span class="comment" id="5216370">//&nbsp;are&nbsp;returned&nbsp;via&nbsp;a&nbsp;scanner.ErrorList&nbsp;which&nbsp;is&nbsp;sorted&nbsp;by&nbsp;file&nbsp;position.</span><br>
<span class="lineno"></span><span class="comment" id="5216444">//</span><br>
<span class="lineno"></span><span class="keyword" id="5216447">func</span>&nbsp;<span class="ident" id="5216452">ParseFile</span><span class="op" id="5216461">(</span><span class="ident" id="5216462">fset</span>&nbsp;<span class="op" id="5216467">*</span><span class="ident" id="5216468"><a href="/go/parser/interface.go.html#5213813">token</a></span><span class="op" id="5216473">.</span><span class="ident" id="5216474">FileSet</span><span class="op" id="5216481">,</span>&nbsp;<span class="ident" id="5216483">filename</span>&nbsp;<span class="builtintype" id="5216492">string</span><span class="op" id="5216498">,</span>&nbsp;<span class="ident" id="5216500">src</span>&nbsp;<span class="keyword" id="5216504">interface</span><span class="op" id="5216513">{</span><span class="op" id="5216514">}</span><span class="op" id="5216515">,</span>&nbsp;<span class="ident" id="5216517">mode</span>&nbsp;<span class="ident" id="5216522"><a href="/go/parser/interface.go.html#5214764">Mode</a></span><span class="op" id="5216526">)</span>&nbsp;<span class="op" id="5216528">(</span><span class="ident" id="5216529">f</span>&nbsp;<span class="op" id="5216531">*</span><span class="ident" id="5216532"><a href="/go/parser/interface.go.html#5213803">ast</a></span><span class="op" id="5216535">.</span><span class="ident" id="5216536">File</span><span class="op" id="5216540">,</span>&nbsp;<span class="ident" id="5216542">err</span>&nbsp;<span class="builtintype" id="5216546">error</span><span class="op" id="5216551">)</span>&nbsp;<span class="op" id="5216553">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5216556">//&nbsp;get&nbsp;source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5216571">text</span><span class="op" id="5216575">,</span>&nbsp;<span class="ident" id="5216577"><a href="/go/parser/interface.go.html#5216542">err</a></span>&nbsp;<span class="op" id="5216581">:=</span>&nbsp;<span class="ident" id="5216584"><a href="/go/parser/interface.go.html#5214080">readSource</a></span><span class="op" id="5216594">(</span><span class="ident" id="5216595"><a href="/go/parser/interface.go.html#5216483">filename</a></span><span class="op" id="5216603">,</span>&nbsp;<span class="ident" id="5216605"><a href="/go/parser/interface.go.html#5216500">src</a></span><span class="op" id="5216608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5216611">if</span>&nbsp;<span class="ident" id="5216614"><a href="/go/parser/interface.go.html#5216542">err</a></span>&nbsp;<span class="op" id="5216618">!=</span>&nbsp;<span class="ident" id="5216621">nil</span>&nbsp;<span class="op" id="5216625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5216629">return</span>&nbsp;<span class="ident" id="5216636">nil</span><span class="op" id="5216639">,</span>&nbsp;<span class="ident" id="5216641"><a href="/go/parser/interface.go.html#5216542">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5216646">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5216650">var</span>&nbsp;<span class="ident" id="5216654">p</span>&nbsp;<span class="ident" id="5216656"><a href="/go/parser/parser.go.html#5220111">parser</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5216664">defer</span>&nbsp;<span class="keyword" id="5216670">func</span><span class="op" id="5216674">(</span><span class="op" id="5216675">)</span>&nbsp;<span class="op" id="5216677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5216681">if</span>&nbsp;<span class="ident" id="5216684">e</span>&nbsp;<span class="op" id="5216686">:=</span>&nbsp;<span class="builtinfunc" id="5216689">recover</span><span class="op" id="5216696">(</span><span class="op" id="5216697">)</span><span class="op" id="5216698">;</span>&nbsp;<span class="ident" id="5216700"><a href="/go/parser/interface.go.html#5216684">e</a></span>&nbsp;<span class="op" id="5216702">!=</span>&nbsp;<span class="ident" id="5216705">nil</span>&nbsp;<span class="op" id="5216709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5216714">_</span>&nbsp;<span class="op" id="5216716">=</span>&nbsp;<span class="ident" id="5216718"><a href="/go/parser/interface.go.html#5216684">e</a></span><span class="op" id="5216719">.</span><span class="op" id="5216720">(</span><span class="ident" id="5216721"><a href="/go/parser/parser.go.html#5229826">bailout</a></span><span class="op" id="5216728">)</span>&nbsp;<span class="comment" id="5216730">//&nbsp;re-panics&nbsp;if&nbsp;it&#39;s&nbsp;not&nbsp;a&nbsp;bailout</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5216767">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5216772">//&nbsp;set&nbsp;result&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5216795">if</span>&nbsp;<span class="ident" id="5216798"><a href="/go/parser/interface.go.html#5216529">f</a></span>&nbsp;<span class="op" id="5216800">==</span>&nbsp;<span class="ident" id="5216803">nil</span>&nbsp;<span class="op" id="5216807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5216812">//&nbsp;source&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;Go&nbsp;source&nbsp;file&nbsp;-&nbsp;satisfy</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5216865">//&nbsp;ParseFile&nbsp;API&nbsp;and&nbsp;return&nbsp;a&nbsp;valid&nbsp;(but)&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5216916">//&nbsp;*ast.File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5216932"><a href="/go/parser/interface.go.html#5216529">f</a></span>&nbsp;<span class="op" id="5216934">=</span>&nbsp;<span class="op" id="5216936">&amp;</span><span class="ident" id="5216937"><a href="/go/parser/interface.go.html#5213803">ast</a></span><span class="op" id="5216940">.</span><span class="ident" id="5216941">File</span><span class="op" id="5216945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5216951">Name</span><span class="op" id="5216955">:</span>&nbsp;&nbsp;<span class="builtinfunc" id="5216958">new</span><span class="op" id="5216961">(</span><span class="ident" id="5216962"><a href="/go/parser/interface.go.html#5213803">ast</a></span><span class="op" id="5216965">.</span><span class="ident" id="5216966">Ident</span><span class="op" id="5216971">)</span><span class="op" id="5216972">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5216978">Scope</span><span class="op" id="5216983">:</span>&nbsp;<span class="ident" id="5216985"><a href="/go/parser/interface.go.html#5213803">ast</a></span><span class="op" id="5216988">.</span><span class="ident" id="5216989">NewScope</span><span class="op" id="5216997">(</span><span class="ident" id="5216998">nil</span><span class="op" id="5217001">)</span><span class="op" id="5217002">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5217007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5217011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5217016"><a href="/go/parser/interface.go.html#5216654">p</a></span><span class="op" id="5217017">.</span><span class="ident" id="5217018">errors</span><span class="op" id="5217024">.</span><span class="ident" id="5217025">Sort</span><span class="op" id="5217029">(</span><span class="op" id="5217030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5217034"><a href="/go/parser/interface.go.html#5216542">err</a></span>&nbsp;<span class="op" id="5217038">=</span>&nbsp;<span class="ident" id="5217040"><a href="/go/parser/interface.go.html#5216654">p</a></span><span class="op" id="5217041">.</span><span class="ident" id="5217042">errors</span><span class="op" id="5217048">.</span><span class="ident" id="5217049">Err</span><span class="op" id="5217052">(</span><span class="op" id="5217053">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5217056">}</span><span class="op" id="5217057">(</span><span class="op" id="5217058">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5217062">//&nbsp;parse&nbsp;source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5217079"><a href="/go/parser/interface.go.html#5216654">p</a></span><span class="op" id="5217080">.</span><span class="ident" id="5217081">init</span><span class="op" id="5217085">(</span><span class="ident" id="5217086"><a href="/go/parser/interface.go.html#5216462">fset</a></span><span class="op" id="5217090">,</span>&nbsp;<span class="ident" id="5217092"><a href="/go/parser/interface.go.html#5216483">filename</a></span><span class="op" id="5217100">,</span>&nbsp;<span class="ident" id="5217102"><a href="/go/parser/interface.go.html#5216571">text</a></span><span class="op" id="5217106">,</span>&nbsp;<span class="ident" id="5217108"><a href="/go/parser/interface.go.html#5216517">mode</a></span><span class="op" id="5217112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5217115"><a href="/go/parser/interface.go.html#5216529">f</a></span>&nbsp;<span class="op" id="5217117">=</span>&nbsp;<span class="ident" id="5217119"><a href="/go/parser/interface.go.html#5216654">p</a></span><span class="op" id="5217120">.</span><span class="ident" id="5217121">parseFile</span><span class="op" id="5217130">(</span><span class="op" id="5217131">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5217135">return</span><br>
<span class="lineno"></span><span class="op" id="5217142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5217145">//&nbsp;ParseDir&nbsp;calls&nbsp;ParseFile&nbsp;for&nbsp;all&nbsp;files&nbsp;with&nbsp;names&nbsp;ending&nbsp;in&nbsp;&#34;.go&#34;&nbsp;in&nbsp;the</span><br>
<span class="lineno">120</span><span class="comment" id="5217221">//&nbsp;directory&nbsp;specified&nbsp;by&nbsp;path&nbsp;and&nbsp;returns&nbsp;a&nbsp;map&nbsp;of&nbsp;package&nbsp;name&nbsp;-&gt;&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="5217297">//&nbsp;AST&nbsp;with&nbsp;all&nbsp;the&nbsp;packages&nbsp;found.</span><br>
<span class="lineno"></span><span class="comment" id="5217333">//</span><br>
<span class="lineno"></span><span class="comment" id="5217336">//&nbsp;If&nbsp;filter&nbsp;!=&nbsp;nil,&nbsp;only&nbsp;the&nbsp;files&nbsp;with&nbsp;os.FileInfo&nbsp;entries&nbsp;passing&nbsp;through</span><br>
<span class="lineno"></span><span class="comment" id="5217413">//&nbsp;the&nbsp;filter&nbsp;(and&nbsp;ending&nbsp;in&nbsp;&#34;.go&#34;)&nbsp;are&nbsp;considered.&nbsp;The&nbsp;mode&nbsp;bits&nbsp;are&nbsp;passed</span><br>
<span class="lineno">125</span><span class="comment" id="5217490">//&nbsp;to&nbsp;ParseFile&nbsp;unchanged.&nbsp;Position&nbsp;information&nbsp;is&nbsp;recorded&nbsp;in&nbsp;fset.</span><br>
<span class="lineno"></span><span class="comment" id="5217559">//</span><br>
<span class="lineno"></span><span class="comment" id="5217562">//&nbsp;If&nbsp;the&nbsp;directory&nbsp;couldn&#39;t&nbsp;be&nbsp;read,&nbsp;a&nbsp;nil&nbsp;map&nbsp;and&nbsp;the&nbsp;respective&nbsp;error&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="5217639">//&nbsp;returned.&nbsp;If&nbsp;a&nbsp;parse&nbsp;error&nbsp;occurred,&nbsp;a&nbsp;non-nil&nbsp;but&nbsp;incomplete&nbsp;map&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5217716">//&nbsp;first&nbsp;error&nbsp;encountered&nbsp;are&nbsp;returned.</span><br>
<span class="lineno">130</span><span class="comment" id="5217757">//</span><br>
<span class="lineno"></span><span class="keyword" id="5217760">func</span>&nbsp;<span class="ident" id="5217765">ParseDir</span><span class="op" id="5217773">(</span><span class="ident" id="5217774">fset</span>&nbsp;<span class="op" id="5217779">*</span><span class="ident" id="5217780"><a href="/go/parser/interface.go.html#5213813">token</a></span><span class="op" id="5217785">.</span><span class="ident" id="5217786">FileSet</span><span class="op" id="5217793">,</span>&nbsp;<span class="ident" id="5217795">path</span>&nbsp;<span class="builtintype" id="5217800">string</span><span class="op" id="5217806">,</span>&nbsp;<span class="ident" id="5217808">filter</span>&nbsp;<span class="keyword" id="5217815">func</span><span class="op" id="5217819">(</span><span class="ident" id="5217820"><a href="/go/parser/interface.go.html#5213844">os</a></span><span class="op" id="5217822">.</span><span class="ident" id="5217823">FileInfo</span><span class="op" id="5217831">)</span>&nbsp;<span class="builtintype" id="5217833">bool</span><span class="op" id="5217837">,</span>&nbsp;<span class="ident" id="5217839">mode</span>&nbsp;<span class="ident" id="5217844"><a href="/go/parser/interface.go.html#5214764">Mode</a></span><span class="op" id="5217848">)</span>&nbsp;<span class="op" id="5217850">(</span><span class="ident" id="5217851">pkgs</span>&nbsp;<span class="keyword" id="5217856">map</span><span class="op" id="5217859">[</span><span class="builtintype" id="5217860">string</span><span class="op" id="5217866">]</span><span class="op" id="5217867">*</span><span class="ident" id="5217868"><a href="/go/parser/interface.go.html#5213803">ast</a></span><span class="op" id="5217871">.</span><span class="ident" id="5217872">Package</span><span class="op" id="5217879">,</span>&nbsp;<span class="ident" id="5217881">first</span>&nbsp;<span class="builtintype" id="5217887">error</span><span class="op" id="5217892">)</span>&nbsp;<span class="op" id="5217894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5217897">fd</span><span class="op" id="5217899">,</span>&nbsp;<span class="ident" id="5217901">err</span>&nbsp;<span class="op" id="5217905">:=</span>&nbsp;<span class="ident" id="5217908"><a href="/go/parser/interface.go.html#5213844">os</a></span><span class="op" id="5217910">.</span><span class="ident" id="5217911">Open</span><span class="op" id="5217915">(</span><span class="ident" id="5217916"><a href="/go/parser/interface.go.html#5217795">path</a></span><span class="op" id="5217920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5217923">if</span>&nbsp;<span class="ident" id="5217926"><a href="/go/parser/interface.go.html#5217901">err</a></span>&nbsp;<span class="op" id="5217930">!=</span>&nbsp;<span class="ident" id="5217933">nil</span>&nbsp;<span class="op" id="5217937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5217941">return</span>&nbsp;<span class="ident" id="5217948">nil</span><span class="op" id="5217951">,</span>&nbsp;<span class="ident" id="5217953"><a href="/go/parser/interface.go.html#5217901">err</a></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5217958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5217961">defer</span>&nbsp;<span class="ident" id="5217967"><a href="/go/parser/interface.go.html#5217897">fd</a></span><span class="op" id="5217969">.</span><span class="ident" id="5217970">Close</span><span class="op" id="5217975">(</span><span class="op" id="5217976">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5217980">list</span><span class="op" id="5217984">,</span>&nbsp;<span class="ident" id="5217986"><a href="/go/parser/interface.go.html#5217901">err</a></span>&nbsp;<span class="op" id="5217990">:=</span>&nbsp;<span class="ident" id="5217993"><a href="/go/parser/interface.go.html#5217897">fd</a></span><span class="op" id="5217995">.</span><span class="ident" id="5217996">Readdir</span><span class="op" id="5218003">(</span><span class="op" id="5218004">-</span><span class="num" id="5218005">1</span><span class="op" id="5218006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5218009">if</span>&nbsp;<span class="ident" id="5218012"><a href="/go/parser/interface.go.html#5217901">err</a></span>&nbsp;<span class="op" id="5218016">!=</span>&nbsp;<span class="ident" id="5218019">nil</span>&nbsp;<span class="op" id="5218023">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5218027">return</span>&nbsp;<span class="ident" id="5218034">nil</span><span class="op" id="5218037">,</span>&nbsp;<span class="ident" id="5218039"><a href="/go/parser/interface.go.html#5217901">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5218044">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5218048"><a href="/go/parser/interface.go.html#5217851">pkgs</a></span>&nbsp;<span class="op" id="5218053">=</span>&nbsp;<span class="builtinfunc" id="5218055">make</span><span class="op" id="5218059">(</span><span class="keyword" id="5218060">map</span><span class="op" id="5218063">[</span><span class="builtintype" id="5218064">string</span><span class="op" id="5218070">]</span><span class="op" id="5218071">*</span><span class="ident" id="5218072"><a href="/go/parser/interface.go.html#5213803">ast</a></span><span class="op" id="5218075">.</span><span class="ident" id="5218076">Package</span><span class="op" id="5218083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5218086">for</span>&nbsp;<span class="ident" id="5218090">_</span><span class="op" id="5218091">,</span>&nbsp;<span class="ident" id="5218093">d</span>&nbsp;<span class="op" id="5218095">:=</span>&nbsp;<span class="keyword" id="5218098">range</span>&nbsp;<span class="ident" id="5218104"><a href="/go/parser/interface.go.html#5217980">list</a></span>&nbsp;<span class="op" id="5218109">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5218113">if</span>&nbsp;<span class="ident" id="5218116"><a href="/go/parser/interface.go.html#5213867">strings</a></span><span class="op" id="5218123">.</span><span class="ident" id="5218124">HasSuffix</span><span class="op" id="5218133">(</span><span class="ident" id="5218134"><a href="/go/parser/interface.go.html#5218093">d</a></span><span class="op" id="5218135">.</span><span class="ident" id="5218136">Name</span><span class="op" id="5218140">(</span><span class="op" id="5218141">)</span><span class="op" id="5218142">,</span>&nbsp;<span class="string" id="5218144">&#34;.go&#34;</span><span class="op" id="5218149">)</span>&nbsp;<span class="op" id="5218151">&amp;&amp;</span>&nbsp;<span class="op" id="5218154">(</span><span class="ident" id="5218155"><a href="/go/parser/interface.go.html#5217808">filter</a></span>&nbsp;<span class="op" id="5218162">==</span>&nbsp;<span class="ident" id="5218165">nil</span>&nbsp;<span class="op" id="5218169">||</span>&nbsp;<span class="ident" id="5218172"><a href="/go/parser/interface.go.html#5217808">filter</a></span><span class="op" id="5218178">(</span><span class="ident" id="5218179"><a href="/go/parser/interface.go.html#5218093">d</a></span><span class="op" id="5218180">)</span><span class="op" id="5218181">)</span>&nbsp;<span class="op" id="5218183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5218188">filename</span>&nbsp;<span class="op" id="5218197">:=</span>&nbsp;<span class="ident" id="5218200"><a href="/go/parser/interface.go.html#5213850">filepath</a></span><span class="op" id="5218208">.</span><span class="ident" id="5218209">Join</span><span class="op" id="5218213">(</span><span class="ident" id="5218214"><a href="/go/parser/interface.go.html#5217795">path</a></span><span class="op" id="5218218">,</span>&nbsp;<span class="ident" id="5218220"><a href="/go/parser/interface.go.html#5218093">d</a></span><span class="op" id="5218221">.</span><span class="ident" id="5218222">Name</span><span class="op" id="5218226">(</span><span class="op" id="5218227">)</span><span class="op" id="5218228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5218233">if</span>&nbsp;<span class="ident" id="5218236">src</span><span class="op" id="5218239">,</span>&nbsp;<span class="ident" id="5218241">err</span>&nbsp;<span class="op" id="5218245">:=</span>&nbsp;<span class="ident" id="5218248"><a href="/go/parser/interface.go.html#5216452">ParseFile</a></span><span class="op" id="5218257">(</span><span class="ident" id="5218258"><a href="/go/parser/interface.go.html#5217774">fset</a></span><span class="op" id="5218262">,</span>&nbsp;<span class="ident" id="5218264"><a href="/go/parser/interface.go.html#5218188">filename</a></span><span class="op" id="5218272">,</span>&nbsp;<span class="ident" id="5218274">nil</span><span class="op" id="5218277">,</span>&nbsp;<span class="ident" id="5218279"><a href="/go/parser/interface.go.html#5217839">mode</a></span><span class="op" id="5218283">)</span><span class="op" id="5218284">;</span>&nbsp;<span class="ident" id="5218286"><a href="/go/parser/interface.go.html#5218241">err</a></span>&nbsp;<span class="op" id="5218290">==</span>&nbsp;<span class="ident" id="5218293">nil</span>&nbsp;<span class="op" id="5218297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5218303">name</span>&nbsp;<span class="op" id="5218308">:=</span>&nbsp;<span class="ident" id="5218311"><a href="/go/parser/interface.go.html#5218236">src</a></span><span class="op" id="5218314">.</span><span class="ident" id="5218315">Name</span><span class="op" id="5218319">.</span><span class="ident" id="5218320">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5218329">pkg</span><span class="op" id="5218332">,</span>&nbsp;<span class="ident" id="5218334">found</span>&nbsp;<span class="op" id="5218340">:=</span>&nbsp;<span class="ident" id="5218343"><a href="/go/parser/interface.go.html#5217851">pkgs</a></span><span class="op" id="5218347">[</span><span class="ident" id="5218348"><a href="/go/parser/interface.go.html#5218303">name</a></span><span class="op" id="5218352">]</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5218358">if</span>&nbsp;<span class="op" id="5218361">!</span><span class="ident" id="5218362"><a href="/go/parser/interface.go.html#5218334">found</a></span>&nbsp;<span class="op" id="5218368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5218375"><a href="/go/parser/interface.go.html#5218329">pkg</a></span>&nbsp;<span class="op" id="5218379">=</span>&nbsp;<span class="op" id="5218381">&amp;</span><span class="ident" id="5218382"><a href="/go/parser/interface.go.html#5213803">ast</a></span><span class="op" id="5218385">.</span><span class="ident" id="5218386">Package</span><span class="op" id="5218393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5218401">Name</span><span class="op" id="5218405">:</span>&nbsp;&nbsp;<span class="ident" id="5218408"><a href="/go/parser/interface.go.html#5218303">name</a></span><span class="op" id="5218412">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5218420">Files</span><span class="op" id="5218425">:</span>&nbsp;<span class="builtinfunc" id="5218427">make</span><span class="op" id="5218431">(</span><span class="keyword" id="5218432">map</span><span class="op" id="5218435">[</span><span class="builtintype" id="5218436">string</span><span class="op" id="5218442">]</span><span class="op" id="5218443">*</span><span class="ident" id="5218444"><a href="/go/parser/interface.go.html#5213803">ast</a></span><span class="op" id="5218447">.</span><span class="ident" id="5218448">File</span><span class="op" id="5218452">)</span><span class="op" id="5218453">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5218460">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5218467"><a href="/go/parser/interface.go.html#5217851">pkgs</a></span><span class="op" id="5218471">[</span><span class="ident" id="5218472"><a href="/go/parser/interface.go.html#5218303">name</a></span><span class="op" id="5218476">]</span>&nbsp;<span class="op" id="5218478">=</span>&nbsp;<span class="ident" id="5218480"><a href="/go/parser/interface.go.html#5218329">pkg</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5218488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5218494"><a href="/go/parser/interface.go.html#5218329">pkg</a></span><span class="op" id="5218497">.</span><span class="ident" id="5218498">Files</span><span class="op" id="5218503">[</span><span class="ident" id="5218504"><a href="/go/parser/interface.go.html#5218188">filename</a></span><span class="op" id="5218512">]</span>&nbsp;<span class="op" id="5218514">=</span>&nbsp;<span class="ident" id="5218516"><a href="/go/parser/interface.go.html#5218236">src</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5218523">}</span>&nbsp;<span class="keyword" id="5218525">else</span>&nbsp;<span class="keyword" id="5218530">if</span>&nbsp;<span class="ident" id="5218533"><a href="/go/parser/interface.go.html#5217881">first</a></span>&nbsp;<span class="op" id="5218539">==</span>&nbsp;<span class="ident" id="5218542">nil</span>&nbsp;<span class="op" id="5218546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5218552"><a href="/go/parser/interface.go.html#5217881">first</a></span>&nbsp;<span class="op" id="5218558">=</span>&nbsp;<span class="ident" id="5218560"><a href="/go/parser/interface.go.html#5218241">err</a></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5218567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5218571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5218574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5218578">return</span><br>
<span class="lineno">165</span><span class="op" id="5218585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5218588">//&nbsp;ParseExpr&nbsp;is&nbsp;a&nbsp;convenience&nbsp;function&nbsp;for&nbsp;obtaining&nbsp;the&nbsp;AST&nbsp;of&nbsp;an&nbsp;expression&nbsp;x.</span><br>
<span class="lineno"></span><span class="comment" id="5218669">//&nbsp;The&nbsp;position&nbsp;information&nbsp;recorded&nbsp;in&nbsp;the&nbsp;AST&nbsp;is&nbsp;undefined.&nbsp;The&nbsp;filename&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="5218749">//&nbsp;in&nbsp;error&nbsp;messages&nbsp;is&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno">170</span><span class="comment" id="5218791">//</span><br>
<span class="lineno"></span><span class="keyword" id="5218794">func</span>&nbsp;<span class="ident" id="5218799">ParseExpr</span><span class="op" id="5218808">(</span><span class="ident" id="5218809">x</span>&nbsp;<span class="builtintype" id="5218811">string</span><span class="op" id="5218817">)</span>&nbsp;<span class="op" id="5218819">(</span><span class="ident" id="5218820"><a href="/go/parser/interface.go.html#5213803">ast</a></span><span class="op" id="5218823">.</span><span class="ident" id="5218824">Expr</span><span class="op" id="5218828">,</span>&nbsp;<span class="builtintype" id="5218830">error</span><span class="op" id="5218835">)</span>&nbsp;<span class="op" id="5218837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5218840">var</span>&nbsp;<span class="ident" id="5218844">p</span>&nbsp;<span class="ident" id="5218846"><a href="/go/parser/parser.go.html#5220111">parser</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5218854"><a href="/go/parser/interface.go.html#5218844">p</a></span><span class="op" id="5218855">.</span><span class="ident" id="5218856">init</span><span class="op" id="5218860">(</span><span class="ident" id="5218861"><a href="/go/parser/interface.go.html#5213813">token</a></span><span class="op" id="5218866">.</span><span class="ident" id="5218867">NewFileSet</span><span class="op" id="5218877">(</span><span class="op" id="5218878">)</span><span class="op" id="5218879">,</span>&nbsp;<span class="string" id="5218881">&#34;&#34;</span><span class="op" id="5218883">,</span>&nbsp;<span class="op" id="5218885">[</span><span class="op" id="5218886">]</span><span class="builtintype" id="5218887">byte</span><span class="op" id="5218891">(</span><span class="ident" id="5218892"><a href="/go/parser/interface.go.html#5218809">x</a></span><span class="op" id="5218893">)</span><span class="op" id="5218894">,</span>&nbsp;<span class="num" id="5218896">0</span><span class="op" id="5218897">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5218901">//&nbsp;Set&nbsp;up&nbsp;pkg-level&nbsp;scopes&nbsp;to&nbsp;avoid&nbsp;nil-pointer&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5218958">//&nbsp;This&nbsp;is&nbsp;not&nbsp;needed&nbsp;for&nbsp;a&nbsp;correct&nbsp;expression&nbsp;x&nbsp;as&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5219015">//&nbsp;parser&nbsp;will&nbsp;be&nbsp;ok&nbsp;with&nbsp;a&nbsp;nil&nbsp;topScope,&nbsp;but&nbsp;be&nbsp;cautious</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5219074">//&nbsp;in&nbsp;case&nbsp;of&nbsp;an&nbsp;erroneous&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5219105"><a href="/go/parser/interface.go.html#5218844">p</a></span><span class="op" id="5219106">.</span><span class="ident" id="5219107">openScope</span><span class="op" id="5219116">(</span><span class="op" id="5219117">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5219120"><a href="/go/parser/interface.go.html#5218844">p</a></span><span class="op" id="5219121">.</span><span class="ident" id="5219122">pkgScope</span>&nbsp;<span class="op" id="5219131">=</span>&nbsp;<span class="ident" id="5219133"><a href="/go/parser/interface.go.html#5218844">p</a></span><span class="op" id="5219134">.</span><span class="ident" id="5219135">topScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5219145">e</span>&nbsp;<span class="op" id="5219147">:=</span>&nbsp;<span class="ident" id="5219150"><a href="/go/parser/interface.go.html#5218844">p</a></span><span class="op" id="5219151">.</span><span class="ident" id="5219152">parseRhsOrType</span><span class="op" id="5219166">(</span><span class="op" id="5219167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5219170"><a href="/go/parser/interface.go.html#5218844">p</a></span><span class="op" id="5219171">.</span><span class="ident" id="5219172">closeScope</span><span class="op" id="5219182">(</span><span class="op" id="5219183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5219186"><a href="/go/parser/parser.go.html#5231787">assert</a></span><span class="op" id="5219192">(</span><span class="ident" id="5219193"><a href="/go/parser/interface.go.html#5218844">p</a></span><span class="op" id="5219194">.</span><span class="ident" id="5219195">topScope</span>&nbsp;<span class="op" id="5219204">==</span>&nbsp;<span class="ident" id="5219207">nil</span><span class="op" id="5219210">,</span>&nbsp;<span class="string" id="5219212">&#34;unbalanced&nbsp;scopes&#34;</span><span class="op" id="5219231">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5219235">//&nbsp;If&nbsp;a&nbsp;semicolon&nbsp;was&nbsp;inserted,&nbsp;consume&nbsp;it;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5219280">//&nbsp;report&nbsp;an&nbsp;error&nbsp;if&nbsp;there&#39;s&nbsp;more&nbsp;tokens.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5219324">if</span>&nbsp;<span class="ident" id="5219327"><a href="/go/parser/interface.go.html#5218844">p</a></span><span class="op" id="5219328">.</span><span class="ident" id="5219329">tok</span>&nbsp;<span class="op" id="5219333">==</span>&nbsp;<span class="ident" id="5219336"><a href="/go/parser/interface.go.html#5213813">token</a></span><span class="op" id="5219341">.</span><span class="ident" id="5219342">SEMICOLON</span>&nbsp;<span class="op" id="5219352">&amp;&amp;</span>&nbsp;<span class="ident" id="5219355"><a href="/go/parser/interface.go.html#5218844">p</a></span><span class="op" id="5219356">.</span><span class="ident" id="5219357">lit</span>&nbsp;<span class="op" id="5219361">==</span>&nbsp;<span class="string" id="5219364">&#34;\n&#34;</span>&nbsp;<span class="op" id="5219369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5219373"><a href="/go/parser/interface.go.html#5218844">p</a></span><span class="op" id="5219374">.</span><span class="ident" id="5219375">next</span><span class="op" id="5219379">(</span><span class="op" id="5219380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5219383">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5219386"><a href="/go/parser/interface.go.html#5218844">p</a></span><span class="op" id="5219387">.</span><span class="ident" id="5219388">expect</span><span class="op" id="5219394">(</span><span class="ident" id="5219395"><a href="/go/parser/interface.go.html#5213813">token</a></span><span class="op" id="5219400">.</span><span class="ident" id="5219401">EOF</span><span class="op" id="5219404">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5219408">if</span>&nbsp;<span class="ident" id="5219411"><a href="/go/parser/interface.go.html#5218844">p</a></span><span class="op" id="5219412">.</span><span class="ident" id="5219413">errors</span><span class="op" id="5219419">.</span><span class="ident" id="5219420">Len</span><span class="op" id="5219423">(</span><span class="op" id="5219424">)</span>&nbsp;<span class="op" id="5219426">&gt;</span>&nbsp;<span class="num" id="5219428">0</span>&nbsp;<span class="op" id="5219430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5219434"><a href="/go/parser/interface.go.html#5218844">p</a></span><span class="op" id="5219435">.</span><span class="ident" id="5219436">errors</span><span class="op" id="5219442">.</span><span class="ident" id="5219443">Sort</span><span class="op" id="5219447">(</span><span class="op" id="5219448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5219452">return</span>&nbsp;<span class="ident" id="5219459">nil</span><span class="op" id="5219462">,</span>&nbsp;<span class="ident" id="5219464"><a href="/go/parser/interface.go.html#5218844">p</a></span><span class="op" id="5219465">.</span><span class="ident" id="5219466">errors</span><span class="op" id="5219472">.</span><span class="ident" id="5219473">Err</span><span class="op" id="5219476">(</span><span class="op" id="5219477">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5219480">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5219484">return</span>&nbsp;<span class="ident" id="5219491"><a href="/go/parser/interface.go.html#5219145">e</a></span><span class="op" id="5219492">,</span>&nbsp;<span class="ident" id="5219494">nil</span><br>
<span class="lineno"></span><span class="op" id="5219498">}</span>
</div>
</body>
</html>
