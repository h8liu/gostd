<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/jpeg</h2>
<ul>
<li><a href="/gostd/image/jpeg/dct_test.go.html">dct_test.go</a></li>
<li><a href="/gostd/image/jpeg/fdct.go.html">fdct.go</a></li>
<li><a href="/gostd/image/jpeg/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/image/jpeg/idct.go.html">idct.go</a></li>
<li><a href="/gostd/image/jpeg/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/jpeg/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/jpeg/scan.go.html">scan.go</a></li>
<li><a href="/gostd/image/jpeg/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/jpeg/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5926565">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5926620">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5926674">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5926725">package</span>&nbsp;<span class="ident" id="5926733">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5926739">import</span>&nbsp;<span class="op" id="5926746">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5926749">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5926758">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5926768">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5926777">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5926792">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5926797">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="5926800">//&nbsp;min&nbsp;returns&nbsp;the&nbsp;minimum&nbsp;of&nbsp;two&nbsp;integers.</span><br>
<span class="lineno"></span><span class="keyword" id="5926844">func</span>&nbsp;<span class="ident" id="5926849">min</span><span class="op" id="5926852">(</span><span class="ident" id="5926853">x</span><span class="op" id="5926854">,</span>&nbsp;<span class="ident" id="5926856">y</span>&nbsp;<span class="builtintype" id="5926858">int</span><span class="op" id="5926861">)</span>&nbsp;<span class="builtintype" id="5926863">int</span>&nbsp;<span class="op" id="5926867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926870">if</span>&nbsp;<span class="ident" id="5926873">x</span>&nbsp;<span class="op" id="5926875">&lt;</span>&nbsp;<span class="ident" id="5926877">y</span>&nbsp;<span class="op" id="5926879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926883">return</span>&nbsp;<span class="ident" id="5926890">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5926893">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926896">return</span>&nbsp;<span class="ident" id="5926903">y</span><br>
<span class="lineno"></span><span class="op" id="5926905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5926908">//&nbsp;div&nbsp;returns&nbsp;a/b&nbsp;rounded&nbsp;to&nbsp;the&nbsp;nearest&nbsp;integer,&nbsp;instead&nbsp;of&nbsp;rounded&nbsp;to&nbsp;zero.</span><br>
<span class="lineno"></span><span class="keyword" id="5926987">func</span>&nbsp;<span class="ident" id="5926992">div</span><span class="op" id="5926995">(</span><span class="ident" id="5926996">a</span><span class="op" id="5926997">,</span>&nbsp;<span class="ident" id="5926999">b</span>&nbsp;<span class="builtintype" id="5927001">int32</span><span class="op" id="5927006">)</span>&nbsp;<span class="builtintype" id="5927008">int32</span>&nbsp;<span class="op" id="5927014">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5927017">if</span>&nbsp;<span class="ident" id="5927020">a</span>&nbsp;<span class="op" id="5927022">&gt;=</span>&nbsp;<span class="num" id="5927025">0</span>&nbsp;<span class="op" id="5927027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5927031">return</span>&nbsp;<span class="op" id="5927038">(</span><span class="ident" id="5927039">a</span>&nbsp;<span class="op" id="5927041">+</span>&nbsp;<span class="op" id="5927043">(</span><span class="ident" id="5927044">b</span>&nbsp;<span class="op" id="5927046">&gt;&gt;</span>&nbsp;<span class="num" id="5927049">1</span><span class="op" id="5927050">)</span><span class="op" id="5927051">)</span>&nbsp;<span class="op" id="5927053">/</span>&nbsp;<span class="ident" id="5927055">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5927058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5927061">return</span>&nbsp;<span class="op" id="5927068">-</span><span class="op" id="5927069">(</span><span class="op" id="5927070">(</span><span class="op" id="5927071">-</span><span class="ident" id="5927072">a</span>&nbsp;<span class="op" id="5927074">+</span>&nbsp;<span class="op" id="5927076">(</span><span class="ident" id="5927077">b</span>&nbsp;<span class="op" id="5927079">&gt;&gt;</span>&nbsp;<span class="num" id="5927082">1</span><span class="op" id="5927083">)</span><span class="op" id="5927084">)</span>&nbsp;<span class="op" id="5927086">/</span>&nbsp;<span class="ident" id="5927088">b</span><span class="op" id="5927089">)</span><br>
<span class="lineno"></span><span class="op" id="5927091">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="5927094">//&nbsp;bitCount&nbsp;counts&nbsp;the&nbsp;number&nbsp;of&nbsp;bits&nbsp;needed&nbsp;to&nbsp;hold&nbsp;an&nbsp;integer.</span><br>
<span class="lineno"></span><span class="keyword" id="5927159">var</span>&nbsp;<span class="ident" id="5927163">bitCount</span>&nbsp;<span class="op" id="5927172">=</span>&nbsp;<span class="op" id="5927174">[</span><span class="num" id="5927175">256</span><span class="op" id="5927178">]</span><span class="builtintype" id="5927179">byte</span><span class="op" id="5927183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5927186">0</span><span class="op" id="5927187">,</span>&nbsp;<span class="num" id="5927189">1</span><span class="op" id="5927190">,</span>&nbsp;<span class="num" id="5927192">2</span><span class="op" id="5927193">,</span>&nbsp;<span class="num" id="5927195">2</span><span class="op" id="5927196">,</span>&nbsp;<span class="num" id="5927198">3</span><span class="op" id="5927199">,</span>&nbsp;<span class="num" id="5927201">3</span><span class="op" id="5927202">,</span>&nbsp;<span class="num" id="5927204">3</span><span class="op" id="5927205">,</span>&nbsp;<span class="num" id="5927207">3</span><span class="op" id="5927208">,</span>&nbsp;<span class="num" id="5927210">4</span><span class="op" id="5927211">,</span>&nbsp;<span class="num" id="5927213">4</span><span class="op" id="5927214">,</span>&nbsp;<span class="num" id="5927216">4</span><span class="op" id="5927217">,</span>&nbsp;<span class="num" id="5927219">4</span><span class="op" id="5927220">,</span>&nbsp;<span class="num" id="5927222">4</span><span class="op" id="5927223">,</span>&nbsp;<span class="num" id="5927225">4</span><span class="op" id="5927226">,</span>&nbsp;<span class="num" id="5927228">4</span><span class="op" id="5927229">,</span>&nbsp;<span class="num" id="5927231">4</span><span class="op" id="5927232">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5927235">5</span><span class="op" id="5927236">,</span>&nbsp;<span class="num" id="5927238">5</span><span class="op" id="5927239">,</span>&nbsp;<span class="num" id="5927241">5</span><span class="op" id="5927242">,</span>&nbsp;<span class="num" id="5927244">5</span><span class="op" id="5927245">,</span>&nbsp;<span class="num" id="5927247">5</span><span class="op" id="5927248">,</span>&nbsp;<span class="num" id="5927250">5</span><span class="op" id="5927251">,</span>&nbsp;<span class="num" id="5927253">5</span><span class="op" id="5927254">,</span>&nbsp;<span class="num" id="5927256">5</span><span class="op" id="5927257">,</span>&nbsp;<span class="num" id="5927259">5</span><span class="op" id="5927260">,</span>&nbsp;<span class="num" id="5927262">5</span><span class="op" id="5927263">,</span>&nbsp;<span class="num" id="5927265">5</span><span class="op" id="5927266">,</span>&nbsp;<span class="num" id="5927268">5</span><span class="op" id="5927269">,</span>&nbsp;<span class="num" id="5927271">5</span><span class="op" id="5927272">,</span>&nbsp;<span class="num" id="5927274">5</span><span class="op" id="5927275">,</span>&nbsp;<span class="num" id="5927277">5</span><span class="op" id="5927278">,</span>&nbsp;<span class="num" id="5927280">5</span><span class="op" id="5927281">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5927284">6</span><span class="op" id="5927285">,</span>&nbsp;<span class="num" id="5927287">6</span><span class="op" id="5927288">,</span>&nbsp;<span class="num" id="5927290">6</span><span class="op" id="5927291">,</span>&nbsp;<span class="num" id="5927293">6</span><span class="op" id="5927294">,</span>&nbsp;<span class="num" id="5927296">6</span><span class="op" id="5927297">,</span>&nbsp;<span class="num" id="5927299">6</span><span class="op" id="5927300">,</span>&nbsp;<span class="num" id="5927302">6</span><span class="op" id="5927303">,</span>&nbsp;<span class="num" id="5927305">6</span><span class="op" id="5927306">,</span>&nbsp;<span class="num" id="5927308">6</span><span class="op" id="5927309">,</span>&nbsp;<span class="num" id="5927311">6</span><span class="op" id="5927312">,</span>&nbsp;<span class="num" id="5927314">6</span><span class="op" id="5927315">,</span>&nbsp;<span class="num" id="5927317">6</span><span class="op" id="5927318">,</span>&nbsp;<span class="num" id="5927320">6</span><span class="op" id="5927321">,</span>&nbsp;<span class="num" id="5927323">6</span><span class="op" id="5927324">,</span>&nbsp;<span class="num" id="5927326">6</span><span class="op" id="5927327">,</span>&nbsp;<span class="num" id="5927329">6</span><span class="op" id="5927330">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5927333">6</span><span class="op" id="5927334">,</span>&nbsp;<span class="num" id="5927336">6</span><span class="op" id="5927337">,</span>&nbsp;<span class="num" id="5927339">6</span><span class="op" id="5927340">,</span>&nbsp;<span class="num" id="5927342">6</span><span class="op" id="5927343">,</span>&nbsp;<span class="num" id="5927345">6</span><span class="op" id="5927346">,</span>&nbsp;<span class="num" id="5927348">6</span><span class="op" id="5927349">,</span>&nbsp;<span class="num" id="5927351">6</span><span class="op" id="5927352">,</span>&nbsp;<span class="num" id="5927354">6</span><span class="op" id="5927355">,</span>&nbsp;<span class="num" id="5927357">6</span><span class="op" id="5927358">,</span>&nbsp;<span class="num" id="5927360">6</span><span class="op" id="5927361">,</span>&nbsp;<span class="num" id="5927363">6</span><span class="op" id="5927364">,</span>&nbsp;<span class="num" id="5927366">6</span><span class="op" id="5927367">,</span>&nbsp;<span class="num" id="5927369">6</span><span class="op" id="5927370">,</span>&nbsp;<span class="num" id="5927372">6</span><span class="op" id="5927373">,</span>&nbsp;<span class="num" id="5927375">6</span><span class="op" id="5927376">,</span>&nbsp;<span class="num" id="5927378">6</span><span class="op" id="5927379">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5927382">7</span><span class="op" id="5927383">,</span>&nbsp;<span class="num" id="5927385">7</span><span class="op" id="5927386">,</span>&nbsp;<span class="num" id="5927388">7</span><span class="op" id="5927389">,</span>&nbsp;<span class="num" id="5927391">7</span><span class="op" id="5927392">,</span>&nbsp;<span class="num" id="5927394">7</span><span class="op" id="5927395">,</span>&nbsp;<span class="num" id="5927397">7</span><span class="op" id="5927398">,</span>&nbsp;<span class="num" id="5927400">7</span><span class="op" id="5927401">,</span>&nbsp;<span class="num" id="5927403">7</span><span class="op" id="5927404">,</span>&nbsp;<span class="num" id="5927406">7</span><span class="op" id="5927407">,</span>&nbsp;<span class="num" id="5927409">7</span><span class="op" id="5927410">,</span>&nbsp;<span class="num" id="5927412">7</span><span class="op" id="5927413">,</span>&nbsp;<span class="num" id="5927415">7</span><span class="op" id="5927416">,</span>&nbsp;<span class="num" id="5927418">7</span><span class="op" id="5927419">,</span>&nbsp;<span class="num" id="5927421">7</span><span class="op" id="5927422">,</span>&nbsp;<span class="num" id="5927424">7</span><span class="op" id="5927425">,</span>&nbsp;<span class="num" id="5927427">7</span><span class="op" id="5927428">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5927431">7</span><span class="op" id="5927432">,</span>&nbsp;<span class="num" id="5927434">7</span><span class="op" id="5927435">,</span>&nbsp;<span class="num" id="5927437">7</span><span class="op" id="5927438">,</span>&nbsp;<span class="num" id="5927440">7</span><span class="op" id="5927441">,</span>&nbsp;<span class="num" id="5927443">7</span><span class="op" id="5927444">,</span>&nbsp;<span class="num" id="5927446">7</span><span class="op" id="5927447">,</span>&nbsp;<span class="num" id="5927449">7</span><span class="op" id="5927450">,</span>&nbsp;<span class="num" id="5927452">7</span><span class="op" id="5927453">,</span>&nbsp;<span class="num" id="5927455">7</span><span class="op" id="5927456">,</span>&nbsp;<span class="num" id="5927458">7</span><span class="op" id="5927459">,</span>&nbsp;<span class="num" id="5927461">7</span><span class="op" id="5927462">,</span>&nbsp;<span class="num" id="5927464">7</span><span class="op" id="5927465">,</span>&nbsp;<span class="num" id="5927467">7</span><span class="op" id="5927468">,</span>&nbsp;<span class="num" id="5927470">7</span><span class="op" id="5927471">,</span>&nbsp;<span class="num" id="5927473">7</span><span class="op" id="5927474">,</span>&nbsp;<span class="num" id="5927476">7</span><span class="op" id="5927477">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5927480">7</span><span class="op" id="5927481">,</span>&nbsp;<span class="num" id="5927483">7</span><span class="op" id="5927484">,</span>&nbsp;<span class="num" id="5927486">7</span><span class="op" id="5927487">,</span>&nbsp;<span class="num" id="5927489">7</span><span class="op" id="5927490">,</span>&nbsp;<span class="num" id="5927492">7</span><span class="op" id="5927493">,</span>&nbsp;<span class="num" id="5927495">7</span><span class="op" id="5927496">,</span>&nbsp;<span class="num" id="5927498">7</span><span class="op" id="5927499">,</span>&nbsp;<span class="num" id="5927501">7</span><span class="op" id="5927502">,</span>&nbsp;<span class="num" id="5927504">7</span><span class="op" id="5927505">,</span>&nbsp;<span class="num" id="5927507">7</span><span class="op" id="5927508">,</span>&nbsp;<span class="num" id="5927510">7</span><span class="op" id="5927511">,</span>&nbsp;<span class="num" id="5927513">7</span><span class="op" id="5927514">,</span>&nbsp;<span class="num" id="5927516">7</span><span class="op" id="5927517">,</span>&nbsp;<span class="num" id="5927519">7</span><span class="op" id="5927520">,</span>&nbsp;<span class="num" id="5927522">7</span><span class="op" id="5927523">,</span>&nbsp;<span class="num" id="5927525">7</span><span class="op" id="5927526">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5927529">7</span><span class="op" id="5927530">,</span>&nbsp;<span class="num" id="5927532">7</span><span class="op" id="5927533">,</span>&nbsp;<span class="num" id="5927535">7</span><span class="op" id="5927536">,</span>&nbsp;<span class="num" id="5927538">7</span><span class="op" id="5927539">,</span>&nbsp;<span class="num" id="5927541">7</span><span class="op" id="5927542">,</span>&nbsp;<span class="num" id="5927544">7</span><span class="op" id="5927545">,</span>&nbsp;<span class="num" id="5927547">7</span><span class="op" id="5927548">,</span>&nbsp;<span class="num" id="5927550">7</span><span class="op" id="5927551">,</span>&nbsp;<span class="num" id="5927553">7</span><span class="op" id="5927554">,</span>&nbsp;<span class="num" id="5927556">7</span><span class="op" id="5927557">,</span>&nbsp;<span class="num" id="5927559">7</span><span class="op" id="5927560">,</span>&nbsp;<span class="num" id="5927562">7</span><span class="op" id="5927563">,</span>&nbsp;<span class="num" id="5927565">7</span><span class="op" id="5927566">,</span>&nbsp;<span class="num" id="5927568">7</span><span class="op" id="5927569">,</span>&nbsp;<span class="num" id="5927571">7</span><span class="op" id="5927572">,</span>&nbsp;<span class="num" id="5927574">7</span><span class="op" id="5927575">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5927578">8</span><span class="op" id="5927579">,</span>&nbsp;<span class="num" id="5927581">8</span><span class="op" id="5927582">,</span>&nbsp;<span class="num" id="5927584">8</span><span class="op" id="5927585">,</span>&nbsp;<span class="num" id="5927587">8</span><span class="op" id="5927588">,</span>&nbsp;<span class="num" id="5927590">8</span><span class="op" id="5927591">,</span>&nbsp;<span class="num" id="5927593">8</span><span class="op" id="5927594">,</span>&nbsp;<span class="num" id="5927596">8</span><span class="op" id="5927597">,</span>&nbsp;<span class="num" id="5927599">8</span><span class="op" id="5927600">,</span>&nbsp;<span class="num" id="5927602">8</span><span class="op" id="5927603">,</span>&nbsp;<span class="num" id="5927605">8</span><span class="op" id="5927606">,</span>&nbsp;<span class="num" id="5927608">8</span><span class="op" id="5927609">,</span>&nbsp;<span class="num" id="5927611">8</span><span class="op" id="5927612">,</span>&nbsp;<span class="num" id="5927614">8</span><span class="op" id="5927615">,</span>&nbsp;<span class="num" id="5927617">8</span><span class="op" id="5927618">,</span>&nbsp;<span class="num" id="5927620">8</span><span class="op" id="5927621">,</span>&nbsp;<span class="num" id="5927623">8</span><span class="op" id="5927624">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5927627">8</span><span class="op" id="5927628">,</span>&nbsp;<span class="num" id="5927630">8</span><span class="op" id="5927631">,</span>&nbsp;<span class="num" id="5927633">8</span><span class="op" id="5927634">,</span>&nbsp;<span class="num" id="5927636">8</span><span class="op" id="5927637">,</span>&nbsp;<span class="num" id="5927639">8</span><span class="op" id="5927640">,</span>&nbsp;<span class="num" id="5927642">8</span><span class="op" id="5927643">,</span>&nbsp;<span class="num" id="5927645">8</span><span class="op" id="5927646">,</span>&nbsp;<span class="num" id="5927648">8</span><span class="op" id="5927649">,</span>&nbsp;<span class="num" id="5927651">8</span><span class="op" id="5927652">,</span>&nbsp;<span class="num" id="5927654">8</span><span class="op" id="5927655">,</span>&nbsp;<span class="num" id="5927657">8</span><span class="op" id="5927658">,</span>&nbsp;<span class="num" id="5927660">8</span><span class="op" id="5927661">,</span>&nbsp;<span class="num" id="5927663">8</span><span class="op" id="5927664">,</span>&nbsp;<span class="num" id="5927666">8</span><span class="op" id="5927667">,</span>&nbsp;<span class="num" id="5927669">8</span><span class="op" id="5927670">,</span>&nbsp;<span class="num" id="5927672">8</span><span class="op" id="5927673">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5927676">8</span><span class="op" id="5927677">,</span>&nbsp;<span class="num" id="5927679">8</span><span class="op" id="5927680">,</span>&nbsp;<span class="num" id="5927682">8</span><span class="op" id="5927683">,</span>&nbsp;<span class="num" id="5927685">8</span><span class="op" id="5927686">,</span>&nbsp;<span class="num" id="5927688">8</span><span class="op" id="5927689">,</span>&nbsp;<span class="num" id="5927691">8</span><span class="op" id="5927692">,</span>&nbsp;<span class="num" id="5927694">8</span><span class="op" id="5927695">,</span>&nbsp;<span class="num" id="5927697">8</span><span class="op" id="5927698">,</span>&nbsp;<span class="num" id="5927700">8</span><span class="op" id="5927701">,</span>&nbsp;<span class="num" id="5927703">8</span><span class="op" id="5927704">,</span>&nbsp;<span class="num" id="5927706">8</span><span class="op" id="5927707">,</span>&nbsp;<span class="num" id="5927709">8</span><span class="op" id="5927710">,</span>&nbsp;<span class="num" id="5927712">8</span><span class="op" id="5927713">,</span>&nbsp;<span class="num" id="5927715">8</span><span class="op" id="5927716">,</span>&nbsp;<span class="num" id="5927718">8</span><span class="op" id="5927719">,</span>&nbsp;<span class="num" id="5927721">8</span><span class="op" id="5927722">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5927725">8</span><span class="op" id="5927726">,</span>&nbsp;<span class="num" id="5927728">8</span><span class="op" id="5927729">,</span>&nbsp;<span class="num" id="5927731">8</span><span class="op" id="5927732">,</span>&nbsp;<span class="num" id="5927734">8</span><span class="op" id="5927735">,</span>&nbsp;<span class="num" id="5927737">8</span><span class="op" id="5927738">,</span>&nbsp;<span class="num" id="5927740">8</span><span class="op" id="5927741">,</span>&nbsp;<span class="num" id="5927743">8</span><span class="op" id="5927744">,</span>&nbsp;<span class="num" id="5927746">8</span><span class="op" id="5927747">,</span>&nbsp;<span class="num" id="5927749">8</span><span class="op" id="5927750">,</span>&nbsp;<span class="num" id="5927752">8</span><span class="op" id="5927753">,</span>&nbsp;<span class="num" id="5927755">8</span><span class="op" id="5927756">,</span>&nbsp;<span class="num" id="5927758">8</span><span class="op" id="5927759">,</span>&nbsp;<span class="num" id="5927761">8</span><span class="op" id="5927762">,</span>&nbsp;<span class="num" id="5927764">8</span><span class="op" id="5927765">,</span>&nbsp;<span class="num" id="5927767">8</span><span class="op" id="5927768">,</span>&nbsp;<span class="num" id="5927770">8</span><span class="op" id="5927771">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5927774">8</span><span class="op" id="5927775">,</span>&nbsp;<span class="num" id="5927777">8</span><span class="op" id="5927778">,</span>&nbsp;<span class="num" id="5927780">8</span><span class="op" id="5927781">,</span>&nbsp;<span class="num" id="5927783">8</span><span class="op" id="5927784">,</span>&nbsp;<span class="num" id="5927786">8</span><span class="op" id="5927787">,</span>&nbsp;<span class="num" id="5927789">8</span><span class="op" id="5927790">,</span>&nbsp;<span class="num" id="5927792">8</span><span class="op" id="5927793">,</span>&nbsp;<span class="num" id="5927795">8</span><span class="op" id="5927796">,</span>&nbsp;<span class="num" id="5927798">8</span><span class="op" id="5927799">,</span>&nbsp;<span class="num" id="5927801">8</span><span class="op" id="5927802">,</span>&nbsp;<span class="num" id="5927804">8</span><span class="op" id="5927805">,</span>&nbsp;<span class="num" id="5927807">8</span><span class="op" id="5927808">,</span>&nbsp;<span class="num" id="5927810">8</span><span class="op" id="5927811">,</span>&nbsp;<span class="num" id="5927813">8</span><span class="op" id="5927814">,</span>&nbsp;<span class="num" id="5927816">8</span><span class="op" id="5927817">,</span>&nbsp;<span class="num" id="5927819">8</span><span class="op" id="5927820">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5927823">8</span><span class="op" id="5927824">,</span>&nbsp;<span class="num" id="5927826">8</span><span class="op" id="5927827">,</span>&nbsp;<span class="num" id="5927829">8</span><span class="op" id="5927830">,</span>&nbsp;<span class="num" id="5927832">8</span><span class="op" id="5927833">,</span>&nbsp;<span class="num" id="5927835">8</span><span class="op" id="5927836">,</span>&nbsp;<span class="num" id="5927838">8</span><span class="op" id="5927839">,</span>&nbsp;<span class="num" id="5927841">8</span><span class="op" id="5927842">,</span>&nbsp;<span class="num" id="5927844">8</span><span class="op" id="5927845">,</span>&nbsp;<span class="num" id="5927847">8</span><span class="op" id="5927848">,</span>&nbsp;<span class="num" id="5927850">8</span><span class="op" id="5927851">,</span>&nbsp;<span class="num" id="5927853">8</span><span class="op" id="5927854">,</span>&nbsp;<span class="num" id="5927856">8</span><span class="op" id="5927857">,</span>&nbsp;<span class="num" id="5927859">8</span><span class="op" id="5927860">,</span>&nbsp;<span class="num" id="5927862">8</span><span class="op" id="5927863">,</span>&nbsp;<span class="num" id="5927865">8</span><span class="op" id="5927866">,</span>&nbsp;<span class="num" id="5927868">8</span><span class="op" id="5927869">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5927872">8</span><span class="op" id="5927873">,</span>&nbsp;<span class="num" id="5927875">8</span><span class="op" id="5927876">,</span>&nbsp;<span class="num" id="5927878">8</span><span class="op" id="5927879">,</span>&nbsp;<span class="num" id="5927881">8</span><span class="op" id="5927882">,</span>&nbsp;<span class="num" id="5927884">8</span><span class="op" id="5927885">,</span>&nbsp;<span class="num" id="5927887">8</span><span class="op" id="5927888">,</span>&nbsp;<span class="num" id="5927890">8</span><span class="op" id="5927891">,</span>&nbsp;<span class="num" id="5927893">8</span><span class="op" id="5927894">,</span>&nbsp;<span class="num" id="5927896">8</span><span class="op" id="5927897">,</span>&nbsp;<span class="num" id="5927899">8</span><span class="op" id="5927900">,</span>&nbsp;<span class="num" id="5927902">8</span><span class="op" id="5927903">,</span>&nbsp;<span class="num" id="5927905">8</span><span class="op" id="5927906">,</span>&nbsp;<span class="num" id="5927908">8</span><span class="op" id="5927909">,</span>&nbsp;<span class="num" id="5927911">8</span><span class="op" id="5927912">,</span>&nbsp;<span class="num" id="5927914">8</span><span class="op" id="5927915">,</span>&nbsp;<span class="num" id="5927917">8</span><span class="op" id="5927918">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5927921">8</span><span class="op" id="5927922">,</span>&nbsp;<span class="num" id="5927924">8</span><span class="op" id="5927925">,</span>&nbsp;<span class="num" id="5927927">8</span><span class="op" id="5927928">,</span>&nbsp;<span class="num" id="5927930">8</span><span class="op" id="5927931">,</span>&nbsp;<span class="num" id="5927933">8</span><span class="op" id="5927934">,</span>&nbsp;<span class="num" id="5927936">8</span><span class="op" id="5927937">,</span>&nbsp;<span class="num" id="5927939">8</span><span class="op" id="5927940">,</span>&nbsp;<span class="num" id="5927942">8</span><span class="op" id="5927943">,</span>&nbsp;<span class="num" id="5927945">8</span><span class="op" id="5927946">,</span>&nbsp;<span class="num" id="5927948">8</span><span class="op" id="5927949">,</span>&nbsp;<span class="num" id="5927951">8</span><span class="op" id="5927952">,</span>&nbsp;<span class="num" id="5927954">8</span><span class="op" id="5927955">,</span>&nbsp;<span class="num" id="5927957">8</span><span class="op" id="5927958">,</span>&nbsp;<span class="num" id="5927960">8</span><span class="op" id="5927961">,</span>&nbsp;<span class="num" id="5927963">8</span><span class="op" id="5927964">,</span>&nbsp;<span class="num" id="5927966">8</span><span class="op" id="5927967">,</span><br>
<span class="lineno"></span><span class="op" id="5927969">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="5927972">type</span>&nbsp;<span class="ident" id="5927977">quantIndex</span>&nbsp;<span class="builtintype" id="5927988">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5927993">const</span>&nbsp;<span class="op" id="5927999">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5928002">quantIndexLuminance</span>&nbsp;<span class="ident" id="5928022">quantIndex</span>&nbsp;<span class="op" id="5928033">=</span>&nbsp;<span class="ident" id="5928035">iota</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5928041">quantIndexChrominance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5928064">nQuantIndex</span><br>
<span class="lineno"></span><span class="op" id="5928076">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5928079">//&nbsp;unscaledQuant&nbsp;are&nbsp;the&nbsp;unscaled&nbsp;quantization&nbsp;tables&nbsp;in&nbsp;zig-zag&nbsp;order.&nbsp;Each</span><br>
<span class="lineno">60</span><span class="comment" id="5928156">//&nbsp;encoder&nbsp;copies&nbsp;and&nbsp;scales&nbsp;the&nbsp;tables&nbsp;according&nbsp;to&nbsp;its&nbsp;quality&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="comment" id="5928232">//&nbsp;The&nbsp;values&nbsp;are&nbsp;derived&nbsp;from&nbsp;section&nbsp;K.1&nbsp;after&nbsp;converting&nbsp;from&nbsp;natural&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5928308">//&nbsp;zig-zag&nbsp;order.</span><br>
<span class="lineno"></span><span class="keyword" id="5928326">var</span>&nbsp;<span class="ident" id="5928330">unscaledQuant</span>&nbsp;<span class="op" id="5928344">=</span>&nbsp;<span class="op" id="5928346">[</span><span class="ident" id="5928347">nQuantIndex</span><span class="op" id="5928358">]</span><span class="op" id="5928359">[</span><span class="ident" id="5928360">blockSize</span><span class="op" id="5928369">]</span><span class="builtintype" id="5928370">byte</span><span class="op" id="5928374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5928377">//&nbsp;Luminance.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5928392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5928396">16</span><span class="op" id="5928398">,</span>&nbsp;<span class="num" id="5928400">11</span><span class="op" id="5928402">,</span>&nbsp;<span class="num" id="5928404">12</span><span class="op" id="5928406">,</span>&nbsp;<span class="num" id="5928408">14</span><span class="op" id="5928410">,</span>&nbsp;<span class="num" id="5928412">12</span><span class="op" id="5928414">,</span>&nbsp;<span class="num" id="5928416">10</span><span class="op" id="5928418">,</span>&nbsp;<span class="num" id="5928420">16</span><span class="op" id="5928422">,</span>&nbsp;<span class="num" id="5928424">14</span><span class="op" id="5928426">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5928430">13</span><span class="op" id="5928432">,</span>&nbsp;<span class="num" id="5928434">14</span><span class="op" id="5928436">,</span>&nbsp;<span class="num" id="5928438">18</span><span class="op" id="5928440">,</span>&nbsp;<span class="num" id="5928442">17</span><span class="op" id="5928444">,</span>&nbsp;<span class="num" id="5928446">16</span><span class="op" id="5928448">,</span>&nbsp;<span class="num" id="5928450">19</span><span class="op" id="5928452">,</span>&nbsp;<span class="num" id="5928454">24</span><span class="op" id="5928456">,</span>&nbsp;<span class="num" id="5928458">40</span><span class="op" id="5928460">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5928464">26</span><span class="op" id="5928466">,</span>&nbsp;<span class="num" id="5928468">24</span><span class="op" id="5928470">,</span>&nbsp;<span class="num" id="5928472">22</span><span class="op" id="5928474">,</span>&nbsp;<span class="num" id="5928476">22</span><span class="op" id="5928478">,</span>&nbsp;<span class="num" id="5928480">24</span><span class="op" id="5928482">,</span>&nbsp;<span class="num" id="5928484">49</span><span class="op" id="5928486">,</span>&nbsp;<span class="num" id="5928488">35</span><span class="op" id="5928490">,</span>&nbsp;<span class="num" id="5928492">37</span><span class="op" id="5928494">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5928498">29</span><span class="op" id="5928500">,</span>&nbsp;<span class="num" id="5928502">40</span><span class="op" id="5928504">,</span>&nbsp;<span class="num" id="5928506">58</span><span class="op" id="5928508">,</span>&nbsp;<span class="num" id="5928510">51</span><span class="op" id="5928512">,</span>&nbsp;<span class="num" id="5928514">61</span><span class="op" id="5928516">,</span>&nbsp;<span class="num" id="5928518">60</span><span class="op" id="5928520">,</span>&nbsp;<span class="num" id="5928522">57</span><span class="op" id="5928524">,</span>&nbsp;<span class="num" id="5928526">51</span><span class="op" id="5928528">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5928532">56</span><span class="op" id="5928534">,</span>&nbsp;<span class="num" id="5928536">55</span><span class="op" id="5928538">,</span>&nbsp;<span class="num" id="5928540">64</span><span class="op" id="5928542">,</span>&nbsp;<span class="num" id="5928544">72</span><span class="op" id="5928546">,</span>&nbsp;<span class="num" id="5928548">92</span><span class="op" id="5928550">,</span>&nbsp;<span class="num" id="5928552">78</span><span class="op" id="5928554">,</span>&nbsp;<span class="num" id="5928556">64</span><span class="op" id="5928558">,</span>&nbsp;<span class="num" id="5928560">68</span><span class="op" id="5928562">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5928566">87</span><span class="op" id="5928568">,</span>&nbsp;<span class="num" id="5928570">69</span><span class="op" id="5928572">,</span>&nbsp;<span class="num" id="5928574">55</span><span class="op" id="5928576">,</span>&nbsp;<span class="num" id="5928578">56</span><span class="op" id="5928580">,</span>&nbsp;<span class="num" id="5928582">80</span><span class="op" id="5928584">,</span>&nbsp;<span class="num" id="5928586">109</span><span class="op" id="5928589">,</span>&nbsp;<span class="num" id="5928591">81</span><span class="op" id="5928593">,</span>&nbsp;<span class="num" id="5928595">87</span><span class="op" id="5928597">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5928601">95</span><span class="op" id="5928603">,</span>&nbsp;<span class="num" id="5928605">98</span><span class="op" id="5928607">,</span>&nbsp;<span class="num" id="5928609">103</span><span class="op" id="5928612">,</span>&nbsp;<span class="num" id="5928614">104</span><span class="op" id="5928617">,</span>&nbsp;<span class="num" id="5928619">103</span><span class="op" id="5928622">,</span>&nbsp;<span class="num" id="5928624">62</span><span class="op" id="5928626">,</span>&nbsp;<span class="num" id="5928628">77</span><span class="op" id="5928630">,</span>&nbsp;<span class="num" id="5928632">113</span><span class="op" id="5928635">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5928639">121</span><span class="op" id="5928642">,</span>&nbsp;<span class="num" id="5928644">112</span><span class="op" id="5928647">,</span>&nbsp;<span class="num" id="5928649">100</span><span class="op" id="5928652">,</span>&nbsp;<span class="num" id="5928654">120</span><span class="op" id="5928657">,</span>&nbsp;<span class="num" id="5928659">92</span><span class="op" id="5928661">,</span>&nbsp;<span class="num" id="5928663">101</span><span class="op" id="5928666">,</span>&nbsp;<span class="num" id="5928668">103</span><span class="op" id="5928671">,</span>&nbsp;<span class="num" id="5928673">99</span><span class="op" id="5928675">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5928678">}</span><span class="op" id="5928679">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5928682">//&nbsp;Chrominance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5928699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5928703">17</span><span class="op" id="5928705">,</span>&nbsp;<span class="num" id="5928707">18</span><span class="op" id="5928709">,</span>&nbsp;<span class="num" id="5928711">18</span><span class="op" id="5928713">,</span>&nbsp;<span class="num" id="5928715">24</span><span class="op" id="5928717">,</span>&nbsp;<span class="num" id="5928719">21</span><span class="op" id="5928721">,</span>&nbsp;<span class="num" id="5928723">24</span><span class="op" id="5928725">,</span>&nbsp;<span class="num" id="5928727">47</span><span class="op" id="5928729">,</span>&nbsp;<span class="num" id="5928731">26</span><span class="op" id="5928733">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5928737">26</span><span class="op" id="5928739">,</span>&nbsp;<span class="num" id="5928741">47</span><span class="op" id="5928743">,</span>&nbsp;<span class="num" id="5928745">99</span><span class="op" id="5928747">,</span>&nbsp;<span class="num" id="5928749">66</span><span class="op" id="5928751">,</span>&nbsp;<span class="num" id="5928753">56</span><span class="op" id="5928755">,</span>&nbsp;<span class="num" id="5928757">66</span><span class="op" id="5928759">,</span>&nbsp;<span class="num" id="5928761">99</span><span class="op" id="5928763">,</span>&nbsp;<span class="num" id="5928765">99</span><span class="op" id="5928767">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5928771">99</span><span class="op" id="5928773">,</span>&nbsp;<span class="num" id="5928775">99</span><span class="op" id="5928777">,</span>&nbsp;<span class="num" id="5928779">99</span><span class="op" id="5928781">,</span>&nbsp;<span class="num" id="5928783">99</span><span class="op" id="5928785">,</span>&nbsp;<span class="num" id="5928787">99</span><span class="op" id="5928789">,</span>&nbsp;<span class="num" id="5928791">99</span><span class="op" id="5928793">,</span>&nbsp;<span class="num" id="5928795">99</span><span class="op" id="5928797">,</span>&nbsp;<span class="num" id="5928799">99</span><span class="op" id="5928801">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5928805">99</span><span class="op" id="5928807">,</span>&nbsp;<span class="num" id="5928809">99</span><span class="op" id="5928811">,</span>&nbsp;<span class="num" id="5928813">99</span><span class="op" id="5928815">,</span>&nbsp;<span class="num" id="5928817">99</span><span class="op" id="5928819">,</span>&nbsp;<span class="num" id="5928821">99</span><span class="op" id="5928823">,</span>&nbsp;<span class="num" id="5928825">99</span><span class="op" id="5928827">,</span>&nbsp;<span class="num" id="5928829">99</span><span class="op" id="5928831">,</span>&nbsp;<span class="num" id="5928833">99</span><span class="op" id="5928835">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5928839">99</span><span class="op" id="5928841">,</span>&nbsp;<span class="num" id="5928843">99</span><span class="op" id="5928845">,</span>&nbsp;<span class="num" id="5928847">99</span><span class="op" id="5928849">,</span>&nbsp;<span class="num" id="5928851">99</span><span class="op" id="5928853">,</span>&nbsp;<span class="num" id="5928855">99</span><span class="op" id="5928857">,</span>&nbsp;<span class="num" id="5928859">99</span><span class="op" id="5928861">,</span>&nbsp;<span class="num" id="5928863">99</span><span class="op" id="5928865">,</span>&nbsp;<span class="num" id="5928867">99</span><span class="op" id="5928869">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5928873">99</span><span class="op" id="5928875">,</span>&nbsp;<span class="num" id="5928877">99</span><span class="op" id="5928879">,</span>&nbsp;<span class="num" id="5928881">99</span><span class="op" id="5928883">,</span>&nbsp;<span class="num" id="5928885">99</span><span class="op" id="5928887">,</span>&nbsp;<span class="num" id="5928889">99</span><span class="op" id="5928891">,</span>&nbsp;<span class="num" id="5928893">99</span><span class="op" id="5928895">,</span>&nbsp;<span class="num" id="5928897">99</span><span class="op" id="5928899">,</span>&nbsp;<span class="num" id="5928901">99</span><span class="op" id="5928903">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5928907">99</span><span class="op" id="5928909">,</span>&nbsp;<span class="num" id="5928911">99</span><span class="op" id="5928913">,</span>&nbsp;<span class="num" id="5928915">99</span><span class="op" id="5928917">,</span>&nbsp;<span class="num" id="5928919">99</span><span class="op" id="5928921">,</span>&nbsp;<span class="num" id="5928923">99</span><span class="op" id="5928925">,</span>&nbsp;<span class="num" id="5928927">99</span><span class="op" id="5928929">,</span>&nbsp;<span class="num" id="5928931">99</span><span class="op" id="5928933">,</span>&nbsp;<span class="num" id="5928935">99</span><span class="op" id="5928937">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5928941">99</span><span class="op" id="5928943">,</span>&nbsp;<span class="num" id="5928945">99</span><span class="op" id="5928947">,</span>&nbsp;<span class="num" id="5928949">99</span><span class="op" id="5928951">,</span>&nbsp;<span class="num" id="5928953">99</span><span class="op" id="5928955">,</span>&nbsp;<span class="num" id="5928957">99</span><span class="op" id="5928959">,</span>&nbsp;<span class="num" id="5928961">99</span><span class="op" id="5928963">,</span>&nbsp;<span class="num" id="5928965">99</span><span class="op" id="5928967">,</span>&nbsp;<span class="num" id="5928969">99</span><span class="op" id="5928971">,</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5928974">}</span><span class="op" id="5928975">,</span><br>
<span class="lineno"></span><span class="op" id="5928977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5928980">type</span>&nbsp;<span class="ident" id="5928985">huffIndex</span>&nbsp;<span class="builtintype" id="5928995">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="5929000">const</span>&nbsp;<span class="op" id="5929006">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5929009">huffIndexLuminanceDC</span>&nbsp;<span class="ident" id="5929030">huffIndex</span>&nbsp;<span class="op" id="5929040">=</span>&nbsp;<span class="ident" id="5929042">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5929048">huffIndexLuminanceAC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5929070">huffIndexChrominanceDC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5929094">huffIndexChrominanceAC</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5929118">nHuffIndex</span><br>
<span class="lineno"></span><span class="op" id="5929129">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5929132">//&nbsp;huffmanSpec&nbsp;specifies&nbsp;a&nbsp;Huffman&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="5929177">type</span>&nbsp;<span class="ident" id="5929182">huffmanSpec</span>&nbsp;<span class="keyword" id="5929194">struct</span>&nbsp;<span class="op" id="5929201">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5929204">//&nbsp;count[i]&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;codes&nbsp;of&nbsp;length&nbsp;i&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5929258">count</span>&nbsp;<span class="op" id="5929264">[</span><span class="num" id="5929265">16</span><span class="op" id="5929267">]</span><span class="builtintype" id="5929268">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5929274">//&nbsp;value[i]&nbsp;is&nbsp;the&nbsp;decoded&nbsp;value&nbsp;of&nbsp;the&nbsp;i&#39;th&nbsp;codeword.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5929330">value</span>&nbsp;<span class="op" id="5929336">[</span><span class="op" id="5929337">]</span><span class="builtintype" id="5929338">byte</span><br>
<span class="lineno"></span><span class="op" id="5929343">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="5929346">//&nbsp;theHuffmanSpec&nbsp;is&nbsp;the&nbsp;Huffman&nbsp;encoding&nbsp;specifications.</span><br>
<span class="lineno"></span><span class="comment" id="5929404">//&nbsp;This&nbsp;encoder&nbsp;uses&nbsp;the&nbsp;same&nbsp;Huffman&nbsp;encoding&nbsp;for&nbsp;all&nbsp;images.</span><br>
<span class="lineno"></span><span class="keyword" id="5929467">var</span>&nbsp;<span class="ident" id="5929471">theHuffmanSpec</span>&nbsp;<span class="op" id="5929486">=</span>&nbsp;<span class="op" id="5929488">[</span><span class="ident" id="5929489">nHuffIndex</span><span class="op" id="5929499">]</span><span class="ident" id="5929500">huffmanSpec</span><span class="op" id="5929511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5929514">//&nbsp;Luminance&nbsp;DC.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5929532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5929536">[</span><span class="num" id="5929537">16</span><span class="op" id="5929539">]</span><span class="builtintype" id="5929540">byte</span><span class="op" id="5929544">{</span><span class="num" id="5929545">0</span><span class="op" id="5929546">,</span>&nbsp;<span class="num" id="5929548">1</span><span class="op" id="5929549">,</span>&nbsp;<span class="num" id="5929551">5</span><span class="op" id="5929552">,</span>&nbsp;<span class="num" id="5929554">1</span><span class="op" id="5929555">,</span>&nbsp;<span class="num" id="5929557">1</span><span class="op" id="5929558">,</span>&nbsp;<span class="num" id="5929560">1</span><span class="op" id="5929561">,</span>&nbsp;<span class="num" id="5929563">1</span><span class="op" id="5929564">,</span>&nbsp;<span class="num" id="5929566">1</span><span class="op" id="5929567">,</span>&nbsp;<span class="num" id="5929569">1</span><span class="op" id="5929570">,</span>&nbsp;<span class="num" id="5929572">0</span><span class="op" id="5929573">,</span>&nbsp;<span class="num" id="5929575">0</span><span class="op" id="5929576">,</span>&nbsp;<span class="num" id="5929578">0</span><span class="op" id="5929579">,</span>&nbsp;<span class="num" id="5929581">0</span><span class="op" id="5929582">,</span>&nbsp;<span class="num" id="5929584">0</span><span class="op" id="5929585">,</span>&nbsp;<span class="num" id="5929587">0</span><span class="op" id="5929588">,</span>&nbsp;<span class="num" id="5929590">0</span><span class="op" id="5929591">}</span><span class="op" id="5929592">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5929596">[</span><span class="op" id="5929597">]</span><span class="builtintype" id="5929598">byte</span><span class="op" id="5929602">{</span><span class="num" id="5929603">0</span><span class="op" id="5929604">,</span>&nbsp;<span class="num" id="5929606">1</span><span class="op" id="5929607">,</span>&nbsp;<span class="num" id="5929609">2</span><span class="op" id="5929610">,</span>&nbsp;<span class="num" id="5929612">3</span><span class="op" id="5929613">,</span>&nbsp;<span class="num" id="5929615">4</span><span class="op" id="5929616">,</span>&nbsp;<span class="num" id="5929618">5</span><span class="op" id="5929619">,</span>&nbsp;<span class="num" id="5929621">6</span><span class="op" id="5929622">,</span>&nbsp;<span class="num" id="5929624">7</span><span class="op" id="5929625">,</span>&nbsp;<span class="num" id="5929627">8</span><span class="op" id="5929628">,</span>&nbsp;<span class="num" id="5929630">9</span><span class="op" id="5929631">,</span>&nbsp;<span class="num" id="5929633">10</span><span class="op" id="5929635">,</span>&nbsp;<span class="num" id="5929637">11</span><span class="op" id="5929639">}</span><span class="op" id="5929640">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5929643">}</span><span class="op" id="5929644">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5929647">//&nbsp;Luminance&nbsp;AC.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5929665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5929669">[</span><span class="num" id="5929670">16</span><span class="op" id="5929672">]</span><span class="builtintype" id="5929673">byte</span><span class="op" id="5929677">{</span><span class="num" id="5929678">0</span><span class="op" id="5929679">,</span>&nbsp;<span class="num" id="5929681">2</span><span class="op" id="5929682">,</span>&nbsp;<span class="num" id="5929684">1</span><span class="op" id="5929685">,</span>&nbsp;<span class="num" id="5929687">3</span><span class="op" id="5929688">,</span>&nbsp;<span class="num" id="5929690">3</span><span class="op" id="5929691">,</span>&nbsp;<span class="num" id="5929693">2</span><span class="op" id="5929694">,</span>&nbsp;<span class="num" id="5929696">4</span><span class="op" id="5929697">,</span>&nbsp;<span class="num" id="5929699">3</span><span class="op" id="5929700">,</span>&nbsp;<span class="num" id="5929702">5</span><span class="op" id="5929703">,</span>&nbsp;<span class="num" id="5929705">5</span><span class="op" id="5929706">,</span>&nbsp;<span class="num" id="5929708">4</span><span class="op" id="5929709">,</span>&nbsp;<span class="num" id="5929711">4</span><span class="op" id="5929712">,</span>&nbsp;<span class="num" id="5929714">0</span><span class="op" id="5929715">,</span>&nbsp;<span class="num" id="5929717">0</span><span class="op" id="5929718">,</span>&nbsp;<span class="num" id="5929720">1</span><span class="op" id="5929721">,</span>&nbsp;<span class="num" id="5929723">125</span><span class="op" id="5929726">}</span><span class="op" id="5929727">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5929731">[</span><span class="op" id="5929732">]</span><span class="builtintype" id="5929733">byte</span><span class="op" id="5929737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5929742">0x01</span><span class="op" id="5929746">,</span>&nbsp;<span class="num" id="5929748">0x02</span><span class="op" id="5929752">,</span>&nbsp;<span class="num" id="5929754">0x03</span><span class="op" id="5929758">,</span>&nbsp;<span class="num" id="5929760">0x00</span><span class="op" id="5929764">,</span>&nbsp;<span class="num" id="5929766">0x04</span><span class="op" id="5929770">,</span>&nbsp;<span class="num" id="5929772">0x11</span><span class="op" id="5929776">,</span>&nbsp;<span class="num" id="5929778">0x05</span><span class="op" id="5929782">,</span>&nbsp;<span class="num" id="5929784">0x12</span><span class="op" id="5929788">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5929793">0x21</span><span class="op" id="5929797">,</span>&nbsp;<span class="num" id="5929799">0x31</span><span class="op" id="5929803">,</span>&nbsp;<span class="num" id="5929805">0x41</span><span class="op" id="5929809">,</span>&nbsp;<span class="num" id="5929811">0x06</span><span class="op" id="5929815">,</span>&nbsp;<span class="num" id="5929817">0x13</span><span class="op" id="5929821">,</span>&nbsp;<span class="num" id="5929823">0x51</span><span class="op" id="5929827">,</span>&nbsp;<span class="num" id="5929829">0x61</span><span class="op" id="5929833">,</span>&nbsp;<span class="num" id="5929835">0x07</span><span class="op" id="5929839">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5929844">0x22</span><span class="op" id="5929848">,</span>&nbsp;<span class="num" id="5929850">0x71</span><span class="op" id="5929854">,</span>&nbsp;<span class="num" id="5929856">0x14</span><span class="op" id="5929860">,</span>&nbsp;<span class="num" id="5929862">0x32</span><span class="op" id="5929866">,</span>&nbsp;<span class="num" id="5929868">0x81</span><span class="op" id="5929872">,</span>&nbsp;<span class="num" id="5929874">0x91</span><span class="op" id="5929878">,</span>&nbsp;<span class="num" id="5929880">0xa1</span><span class="op" id="5929884">,</span>&nbsp;<span class="num" id="5929886">0x08</span><span class="op" id="5929890">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5929895">0x23</span><span class="op" id="5929899">,</span>&nbsp;<span class="num" id="5929901">0x42</span><span class="op" id="5929905">,</span>&nbsp;<span class="num" id="5929907">0xb1</span><span class="op" id="5929911">,</span>&nbsp;<span class="num" id="5929913">0xc1</span><span class="op" id="5929917">,</span>&nbsp;<span class="num" id="5929919">0x15</span><span class="op" id="5929923">,</span>&nbsp;<span class="num" id="5929925">0x52</span><span class="op" id="5929929">,</span>&nbsp;<span class="num" id="5929931">0xd1</span><span class="op" id="5929935">,</span>&nbsp;<span class="num" id="5929937">0xf0</span><span class="op" id="5929941">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5929946">0x24</span><span class="op" id="5929950">,</span>&nbsp;<span class="num" id="5929952">0x33</span><span class="op" id="5929956">,</span>&nbsp;<span class="num" id="5929958">0x62</span><span class="op" id="5929962">,</span>&nbsp;<span class="num" id="5929964">0x72</span><span class="op" id="5929968">,</span>&nbsp;<span class="num" id="5929970">0x82</span><span class="op" id="5929974">,</span>&nbsp;<span class="num" id="5929976">0x09</span><span class="op" id="5929980">,</span>&nbsp;<span class="num" id="5929982">0x0a</span><span class="op" id="5929986">,</span>&nbsp;<span class="num" id="5929988">0x16</span><span class="op" id="5929992">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5929997">0x17</span><span class="op" id="5930001">,</span>&nbsp;<span class="num" id="5930003">0x18</span><span class="op" id="5930007">,</span>&nbsp;<span class="num" id="5930009">0x19</span><span class="op" id="5930013">,</span>&nbsp;<span class="num" id="5930015">0x1a</span><span class="op" id="5930019">,</span>&nbsp;<span class="num" id="5930021">0x25</span><span class="op" id="5930025">,</span>&nbsp;<span class="num" id="5930027">0x26</span><span class="op" id="5930031">,</span>&nbsp;<span class="num" id="5930033">0x27</span><span class="op" id="5930037">,</span>&nbsp;<span class="num" id="5930039">0x28</span><span class="op" id="5930043">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5930048">0x29</span><span class="op" id="5930052">,</span>&nbsp;<span class="num" id="5930054">0x2a</span><span class="op" id="5930058">,</span>&nbsp;<span class="num" id="5930060">0x34</span><span class="op" id="5930064">,</span>&nbsp;<span class="num" id="5930066">0x35</span><span class="op" id="5930070">,</span>&nbsp;<span class="num" id="5930072">0x36</span><span class="op" id="5930076">,</span>&nbsp;<span class="num" id="5930078">0x37</span><span class="op" id="5930082">,</span>&nbsp;<span class="num" id="5930084">0x38</span><span class="op" id="5930088">,</span>&nbsp;<span class="num" id="5930090">0x39</span><span class="op" id="5930094">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5930099">0x3a</span><span class="op" id="5930103">,</span>&nbsp;<span class="num" id="5930105">0x43</span><span class="op" id="5930109">,</span>&nbsp;<span class="num" id="5930111">0x44</span><span class="op" id="5930115">,</span>&nbsp;<span class="num" id="5930117">0x45</span><span class="op" id="5930121">,</span>&nbsp;<span class="num" id="5930123">0x46</span><span class="op" id="5930127">,</span>&nbsp;<span class="num" id="5930129">0x47</span><span class="op" id="5930133">,</span>&nbsp;<span class="num" id="5930135">0x48</span><span class="op" id="5930139">,</span>&nbsp;<span class="num" id="5930141">0x49</span><span class="op" id="5930145">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5930150">0x4a</span><span class="op" id="5930154">,</span>&nbsp;<span class="num" id="5930156">0x53</span><span class="op" id="5930160">,</span>&nbsp;<span class="num" id="5930162">0x54</span><span class="op" id="5930166">,</span>&nbsp;<span class="num" id="5930168">0x55</span><span class="op" id="5930172">,</span>&nbsp;<span class="num" id="5930174">0x56</span><span class="op" id="5930178">,</span>&nbsp;<span class="num" id="5930180">0x57</span><span class="op" id="5930184">,</span>&nbsp;<span class="num" id="5930186">0x58</span><span class="op" id="5930190">,</span>&nbsp;<span class="num" id="5930192">0x59</span><span class="op" id="5930196">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5930201">0x5a</span><span class="op" id="5930205">,</span>&nbsp;<span class="num" id="5930207">0x63</span><span class="op" id="5930211">,</span>&nbsp;<span class="num" id="5930213">0x64</span><span class="op" id="5930217">,</span>&nbsp;<span class="num" id="5930219">0x65</span><span class="op" id="5930223">,</span>&nbsp;<span class="num" id="5930225">0x66</span><span class="op" id="5930229">,</span>&nbsp;<span class="num" id="5930231">0x67</span><span class="op" id="5930235">,</span>&nbsp;<span class="num" id="5930237">0x68</span><span class="op" id="5930241">,</span>&nbsp;<span class="num" id="5930243">0x69</span><span class="op" id="5930247">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5930252">0x6a</span><span class="op" id="5930256">,</span>&nbsp;<span class="num" id="5930258">0x73</span><span class="op" id="5930262">,</span>&nbsp;<span class="num" id="5930264">0x74</span><span class="op" id="5930268">,</span>&nbsp;<span class="num" id="5930270">0x75</span><span class="op" id="5930274">,</span>&nbsp;<span class="num" id="5930276">0x76</span><span class="op" id="5930280">,</span>&nbsp;<span class="num" id="5930282">0x77</span><span class="op" id="5930286">,</span>&nbsp;<span class="num" id="5930288">0x78</span><span class="op" id="5930292">,</span>&nbsp;<span class="num" id="5930294">0x79</span><span class="op" id="5930298">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5930303">0x7a</span><span class="op" id="5930307">,</span>&nbsp;<span class="num" id="5930309">0x83</span><span class="op" id="5930313">,</span>&nbsp;<span class="num" id="5930315">0x84</span><span class="op" id="5930319">,</span>&nbsp;<span class="num" id="5930321">0x85</span><span class="op" id="5930325">,</span>&nbsp;<span class="num" id="5930327">0x86</span><span class="op" id="5930331">,</span>&nbsp;<span class="num" id="5930333">0x87</span><span class="op" id="5930337">,</span>&nbsp;<span class="num" id="5930339">0x88</span><span class="op" id="5930343">,</span>&nbsp;<span class="num" id="5930345">0x89</span><span class="op" id="5930349">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5930354">0x8a</span><span class="op" id="5930358">,</span>&nbsp;<span class="num" id="5930360">0x92</span><span class="op" id="5930364">,</span>&nbsp;<span class="num" id="5930366">0x93</span><span class="op" id="5930370">,</span>&nbsp;<span class="num" id="5930372">0x94</span><span class="op" id="5930376">,</span>&nbsp;<span class="num" id="5930378">0x95</span><span class="op" id="5930382">,</span>&nbsp;<span class="num" id="5930384">0x96</span><span class="op" id="5930388">,</span>&nbsp;<span class="num" id="5930390">0x97</span><span class="op" id="5930394">,</span>&nbsp;<span class="num" id="5930396">0x98</span><span class="op" id="5930400">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5930405">0x99</span><span class="op" id="5930409">,</span>&nbsp;<span class="num" id="5930411">0x9a</span><span class="op" id="5930415">,</span>&nbsp;<span class="num" id="5930417">0xa2</span><span class="op" id="5930421">,</span>&nbsp;<span class="num" id="5930423">0xa3</span><span class="op" id="5930427">,</span>&nbsp;<span class="num" id="5930429">0xa4</span><span class="op" id="5930433">,</span>&nbsp;<span class="num" id="5930435">0xa5</span><span class="op" id="5930439">,</span>&nbsp;<span class="num" id="5930441">0xa6</span><span class="op" id="5930445">,</span>&nbsp;<span class="num" id="5930447">0xa7</span><span class="op" id="5930451">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5930456">0xa8</span><span class="op" id="5930460">,</span>&nbsp;<span class="num" id="5930462">0xa9</span><span class="op" id="5930466">,</span>&nbsp;<span class="num" id="5930468">0xaa</span><span class="op" id="5930472">,</span>&nbsp;<span class="num" id="5930474">0xb2</span><span class="op" id="5930478">,</span>&nbsp;<span class="num" id="5930480">0xb3</span><span class="op" id="5930484">,</span>&nbsp;<span class="num" id="5930486">0xb4</span><span class="op" id="5930490">,</span>&nbsp;<span class="num" id="5930492">0xb5</span><span class="op" id="5930496">,</span>&nbsp;<span class="num" id="5930498">0xb6</span><span class="op" id="5930502">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5930507">0xb7</span><span class="op" id="5930511">,</span>&nbsp;<span class="num" id="5930513">0xb8</span><span class="op" id="5930517">,</span>&nbsp;<span class="num" id="5930519">0xb9</span><span class="op" id="5930523">,</span>&nbsp;<span class="num" id="5930525">0xba</span><span class="op" id="5930529">,</span>&nbsp;<span class="num" id="5930531">0xc2</span><span class="op" id="5930535">,</span>&nbsp;<span class="num" id="5930537">0xc3</span><span class="op" id="5930541">,</span>&nbsp;<span class="num" id="5930543">0xc4</span><span class="op" id="5930547">,</span>&nbsp;<span class="num" id="5930549">0xc5</span><span class="op" id="5930553">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5930558">0xc6</span><span class="op" id="5930562">,</span>&nbsp;<span class="num" id="5930564">0xc7</span><span class="op" id="5930568">,</span>&nbsp;<span class="num" id="5930570">0xc8</span><span class="op" id="5930574">,</span>&nbsp;<span class="num" id="5930576">0xc9</span><span class="op" id="5930580">,</span>&nbsp;<span class="num" id="5930582">0xca</span><span class="op" id="5930586">,</span>&nbsp;<span class="num" id="5930588">0xd2</span><span class="op" id="5930592">,</span>&nbsp;<span class="num" id="5930594">0xd3</span><span class="op" id="5930598">,</span>&nbsp;<span class="num" id="5930600">0xd4</span><span class="op" id="5930604">,</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5930609">0xd5</span><span class="op" id="5930613">,</span>&nbsp;<span class="num" id="5930615">0xd6</span><span class="op" id="5930619">,</span>&nbsp;<span class="num" id="5930621">0xd7</span><span class="op" id="5930625">,</span>&nbsp;<span class="num" id="5930627">0xd8</span><span class="op" id="5930631">,</span>&nbsp;<span class="num" id="5930633">0xd9</span><span class="op" id="5930637">,</span>&nbsp;<span class="num" id="5930639">0xda</span><span class="op" id="5930643">,</span>&nbsp;<span class="num" id="5930645">0xe1</span><span class="op" id="5930649">,</span>&nbsp;<span class="num" id="5930651">0xe2</span><span class="op" id="5930655">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5930660">0xe3</span><span class="op" id="5930664">,</span>&nbsp;<span class="num" id="5930666">0xe4</span><span class="op" id="5930670">,</span>&nbsp;<span class="num" id="5930672">0xe5</span><span class="op" id="5930676">,</span>&nbsp;<span class="num" id="5930678">0xe6</span><span class="op" id="5930682">,</span>&nbsp;<span class="num" id="5930684">0xe7</span><span class="op" id="5930688">,</span>&nbsp;<span class="num" id="5930690">0xe8</span><span class="op" id="5930694">,</span>&nbsp;<span class="num" id="5930696">0xe9</span><span class="op" id="5930700">,</span>&nbsp;<span class="num" id="5930702">0xea</span><span class="op" id="5930706">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5930711">0xf1</span><span class="op" id="5930715">,</span>&nbsp;<span class="num" id="5930717">0xf2</span><span class="op" id="5930721">,</span>&nbsp;<span class="num" id="5930723">0xf3</span><span class="op" id="5930727">,</span>&nbsp;<span class="num" id="5930729">0xf4</span><span class="op" id="5930733">,</span>&nbsp;<span class="num" id="5930735">0xf5</span><span class="op" id="5930739">,</span>&nbsp;<span class="num" id="5930741">0xf6</span><span class="op" id="5930745">,</span>&nbsp;<span class="num" id="5930747">0xf7</span><span class="op" id="5930751">,</span>&nbsp;<span class="num" id="5930753">0xf8</span><span class="op" id="5930757">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5930762">0xf9</span><span class="op" id="5930766">,</span>&nbsp;<span class="num" id="5930768">0xfa</span><span class="op" id="5930772">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5930776">}</span><span class="op" id="5930777">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5930780">}</span><span class="op" id="5930781">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5930784">//&nbsp;Chrominance&nbsp;DC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5930804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5930808">[</span><span class="num" id="5930809">16</span><span class="op" id="5930811">]</span><span class="builtintype" id="5930812">byte</span><span class="op" id="5930816">{</span><span class="num" id="5930817">0</span><span class="op" id="5930818">,</span>&nbsp;<span class="num" id="5930820">3</span><span class="op" id="5930821">,</span>&nbsp;<span class="num" id="5930823">1</span><span class="op" id="5930824">,</span>&nbsp;<span class="num" id="5930826">1</span><span class="op" id="5930827">,</span>&nbsp;<span class="num" id="5930829">1</span><span class="op" id="5930830">,</span>&nbsp;<span class="num" id="5930832">1</span><span class="op" id="5930833">,</span>&nbsp;<span class="num" id="5930835">1</span><span class="op" id="5930836">,</span>&nbsp;<span class="num" id="5930838">1</span><span class="op" id="5930839">,</span>&nbsp;<span class="num" id="5930841">1</span><span class="op" id="5930842">,</span>&nbsp;<span class="num" id="5930844">1</span><span class="op" id="5930845">,</span>&nbsp;<span class="num" id="5930847">1</span><span class="op" id="5930848">,</span>&nbsp;<span class="num" id="5930850">0</span><span class="op" id="5930851">,</span>&nbsp;<span class="num" id="5930853">0</span><span class="op" id="5930854">,</span>&nbsp;<span class="num" id="5930856">0</span><span class="op" id="5930857">,</span>&nbsp;<span class="num" id="5930859">0</span><span class="op" id="5930860">,</span>&nbsp;<span class="num" id="5930862">0</span><span class="op" id="5930863">}</span><span class="op" id="5930864">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5930868">[</span><span class="op" id="5930869">]</span><span class="builtintype" id="5930870">byte</span><span class="op" id="5930874">{</span><span class="num" id="5930875">0</span><span class="op" id="5930876">,</span>&nbsp;<span class="num" id="5930878">1</span><span class="op" id="5930879">,</span>&nbsp;<span class="num" id="5930881">2</span><span class="op" id="5930882">,</span>&nbsp;<span class="num" id="5930884">3</span><span class="op" id="5930885">,</span>&nbsp;<span class="num" id="5930887">4</span><span class="op" id="5930888">,</span>&nbsp;<span class="num" id="5930890">5</span><span class="op" id="5930891">,</span>&nbsp;<span class="num" id="5930893">6</span><span class="op" id="5930894">,</span>&nbsp;<span class="num" id="5930896">7</span><span class="op" id="5930897">,</span>&nbsp;<span class="num" id="5930899">8</span><span class="op" id="5930900">,</span>&nbsp;<span class="num" id="5930902">9</span><span class="op" id="5930903">,</span>&nbsp;<span class="num" id="5930905">10</span><span class="op" id="5930907">,</span>&nbsp;<span class="num" id="5930909">11</span><span class="op" id="5930911">}</span><span class="op" id="5930912">,</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5930915">}</span><span class="op" id="5930916">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5930919">//&nbsp;Chrominance&nbsp;AC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5930939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5930943">[</span><span class="num" id="5930944">16</span><span class="op" id="5930946">]</span><span class="builtintype" id="5930947">byte</span><span class="op" id="5930951">{</span><span class="num" id="5930952">0</span><span class="op" id="5930953">,</span>&nbsp;<span class="num" id="5930955">2</span><span class="op" id="5930956">,</span>&nbsp;<span class="num" id="5930958">1</span><span class="op" id="5930959">,</span>&nbsp;<span class="num" id="5930961">2</span><span class="op" id="5930962">,</span>&nbsp;<span class="num" id="5930964">4</span><span class="op" id="5930965">,</span>&nbsp;<span class="num" id="5930967">4</span><span class="op" id="5930968">,</span>&nbsp;<span class="num" id="5930970">3</span><span class="op" id="5930971">,</span>&nbsp;<span class="num" id="5930973">4</span><span class="op" id="5930974">,</span>&nbsp;<span class="num" id="5930976">7</span><span class="op" id="5930977">,</span>&nbsp;<span class="num" id="5930979">5</span><span class="op" id="5930980">,</span>&nbsp;<span class="num" id="5930982">4</span><span class="op" id="5930983">,</span>&nbsp;<span class="num" id="5930985">4</span><span class="op" id="5930986">,</span>&nbsp;<span class="num" id="5930988">0</span><span class="op" id="5930989">,</span>&nbsp;<span class="num" id="5930991">1</span><span class="op" id="5930992">,</span>&nbsp;<span class="num" id="5930994">2</span><span class="op" id="5930995">,</span>&nbsp;<span class="num" id="5930997">119</span><span class="op" id="5931000">}</span><span class="op" id="5931001">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5931005">[</span><span class="op" id="5931006">]</span><span class="builtintype" id="5931007">byte</span><span class="op" id="5931011">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5931016">0x00</span><span class="op" id="5931020">,</span>&nbsp;<span class="num" id="5931022">0x01</span><span class="op" id="5931026">,</span>&nbsp;<span class="num" id="5931028">0x02</span><span class="op" id="5931032">,</span>&nbsp;<span class="num" id="5931034">0x03</span><span class="op" id="5931038">,</span>&nbsp;<span class="num" id="5931040">0x11</span><span class="op" id="5931044">,</span>&nbsp;<span class="num" id="5931046">0x04</span><span class="op" id="5931050">,</span>&nbsp;<span class="num" id="5931052">0x05</span><span class="op" id="5931056">,</span>&nbsp;<span class="num" id="5931058">0x21</span><span class="op" id="5931062">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5931067">0x31</span><span class="op" id="5931071">,</span>&nbsp;<span class="num" id="5931073">0x06</span><span class="op" id="5931077">,</span>&nbsp;<span class="num" id="5931079">0x12</span><span class="op" id="5931083">,</span>&nbsp;<span class="num" id="5931085">0x41</span><span class="op" id="5931089">,</span>&nbsp;<span class="num" id="5931091">0x51</span><span class="op" id="5931095">,</span>&nbsp;<span class="num" id="5931097">0x07</span><span class="op" id="5931101">,</span>&nbsp;<span class="num" id="5931103">0x61</span><span class="op" id="5931107">,</span>&nbsp;<span class="num" id="5931109">0x71</span><span class="op" id="5931113">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5931118">0x13</span><span class="op" id="5931122">,</span>&nbsp;<span class="num" id="5931124">0x22</span><span class="op" id="5931128">,</span>&nbsp;<span class="num" id="5931130">0x32</span><span class="op" id="5931134">,</span>&nbsp;<span class="num" id="5931136">0x81</span><span class="op" id="5931140">,</span>&nbsp;<span class="num" id="5931142">0x08</span><span class="op" id="5931146">,</span>&nbsp;<span class="num" id="5931148">0x14</span><span class="op" id="5931152">,</span>&nbsp;<span class="num" id="5931154">0x42</span><span class="op" id="5931158">,</span>&nbsp;<span class="num" id="5931160">0x91</span><span class="op" id="5931164">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5931169">0xa1</span><span class="op" id="5931173">,</span>&nbsp;<span class="num" id="5931175">0xb1</span><span class="op" id="5931179">,</span>&nbsp;<span class="num" id="5931181">0xc1</span><span class="op" id="5931185">,</span>&nbsp;<span class="num" id="5931187">0x09</span><span class="op" id="5931191">,</span>&nbsp;<span class="num" id="5931193">0x23</span><span class="op" id="5931197">,</span>&nbsp;<span class="num" id="5931199">0x33</span><span class="op" id="5931203">,</span>&nbsp;<span class="num" id="5931205">0x52</span><span class="op" id="5931209">,</span>&nbsp;<span class="num" id="5931211">0xf0</span><span class="op" id="5931215">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5931220">0x15</span><span class="op" id="5931224">,</span>&nbsp;<span class="num" id="5931226">0x62</span><span class="op" id="5931230">,</span>&nbsp;<span class="num" id="5931232">0x72</span><span class="op" id="5931236">,</span>&nbsp;<span class="num" id="5931238">0xd1</span><span class="op" id="5931242">,</span>&nbsp;<span class="num" id="5931244">0x0a</span><span class="op" id="5931248">,</span>&nbsp;<span class="num" id="5931250">0x16</span><span class="op" id="5931254">,</span>&nbsp;<span class="num" id="5931256">0x24</span><span class="op" id="5931260">,</span>&nbsp;<span class="num" id="5931262">0x34</span><span class="op" id="5931266">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5931271">0xe1</span><span class="op" id="5931275">,</span>&nbsp;<span class="num" id="5931277">0x25</span><span class="op" id="5931281">,</span>&nbsp;<span class="num" id="5931283">0xf1</span><span class="op" id="5931287">,</span>&nbsp;<span class="num" id="5931289">0x17</span><span class="op" id="5931293">,</span>&nbsp;<span class="num" id="5931295">0x18</span><span class="op" id="5931299">,</span>&nbsp;<span class="num" id="5931301">0x19</span><span class="op" id="5931305">,</span>&nbsp;<span class="num" id="5931307">0x1a</span><span class="op" id="5931311">,</span>&nbsp;<span class="num" id="5931313">0x26</span><span class="op" id="5931317">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5931322">0x27</span><span class="op" id="5931326">,</span>&nbsp;<span class="num" id="5931328">0x28</span><span class="op" id="5931332">,</span>&nbsp;<span class="num" id="5931334">0x29</span><span class="op" id="5931338">,</span>&nbsp;<span class="num" id="5931340">0x2a</span><span class="op" id="5931344">,</span>&nbsp;<span class="num" id="5931346">0x35</span><span class="op" id="5931350">,</span>&nbsp;<span class="num" id="5931352">0x36</span><span class="op" id="5931356">,</span>&nbsp;<span class="num" id="5931358">0x37</span><span class="op" id="5931362">,</span>&nbsp;<span class="num" id="5931364">0x38</span><span class="op" id="5931368">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5931373">0x39</span><span class="op" id="5931377">,</span>&nbsp;<span class="num" id="5931379">0x3a</span><span class="op" id="5931383">,</span>&nbsp;<span class="num" id="5931385">0x43</span><span class="op" id="5931389">,</span>&nbsp;<span class="num" id="5931391">0x44</span><span class="op" id="5931395">,</span>&nbsp;<span class="num" id="5931397">0x45</span><span class="op" id="5931401">,</span>&nbsp;<span class="num" id="5931403">0x46</span><span class="op" id="5931407">,</span>&nbsp;<span class="num" id="5931409">0x47</span><span class="op" id="5931413">,</span>&nbsp;<span class="num" id="5931415">0x48</span><span class="op" id="5931419">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5931424">0x49</span><span class="op" id="5931428">,</span>&nbsp;<span class="num" id="5931430">0x4a</span><span class="op" id="5931434">,</span>&nbsp;<span class="num" id="5931436">0x53</span><span class="op" id="5931440">,</span>&nbsp;<span class="num" id="5931442">0x54</span><span class="op" id="5931446">,</span>&nbsp;<span class="num" id="5931448">0x55</span><span class="op" id="5931452">,</span>&nbsp;<span class="num" id="5931454">0x56</span><span class="op" id="5931458">,</span>&nbsp;<span class="num" id="5931460">0x57</span><span class="op" id="5931464">,</span>&nbsp;<span class="num" id="5931466">0x58</span><span class="op" id="5931470">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5931475">0x59</span><span class="op" id="5931479">,</span>&nbsp;<span class="num" id="5931481">0x5a</span><span class="op" id="5931485">,</span>&nbsp;<span class="num" id="5931487">0x63</span><span class="op" id="5931491">,</span>&nbsp;<span class="num" id="5931493">0x64</span><span class="op" id="5931497">,</span>&nbsp;<span class="num" id="5931499">0x65</span><span class="op" id="5931503">,</span>&nbsp;<span class="num" id="5931505">0x66</span><span class="op" id="5931509">,</span>&nbsp;<span class="num" id="5931511">0x67</span><span class="op" id="5931515">,</span>&nbsp;<span class="num" id="5931517">0x68</span><span class="op" id="5931521">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5931526">0x69</span><span class="op" id="5931530">,</span>&nbsp;<span class="num" id="5931532">0x6a</span><span class="op" id="5931536">,</span>&nbsp;<span class="num" id="5931538">0x73</span><span class="op" id="5931542">,</span>&nbsp;<span class="num" id="5931544">0x74</span><span class="op" id="5931548">,</span>&nbsp;<span class="num" id="5931550">0x75</span><span class="op" id="5931554">,</span>&nbsp;<span class="num" id="5931556">0x76</span><span class="op" id="5931560">,</span>&nbsp;<span class="num" id="5931562">0x77</span><span class="op" id="5931566">,</span>&nbsp;<span class="num" id="5931568">0x78</span><span class="op" id="5931572">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5931577">0x79</span><span class="op" id="5931581">,</span>&nbsp;<span class="num" id="5931583">0x7a</span><span class="op" id="5931587">,</span>&nbsp;<span class="num" id="5931589">0x82</span><span class="op" id="5931593">,</span>&nbsp;<span class="num" id="5931595">0x83</span><span class="op" id="5931599">,</span>&nbsp;<span class="num" id="5931601">0x84</span><span class="op" id="5931605">,</span>&nbsp;<span class="num" id="5931607">0x85</span><span class="op" id="5931611">,</span>&nbsp;<span class="num" id="5931613">0x86</span><span class="op" id="5931617">,</span>&nbsp;<span class="num" id="5931619">0x87</span><span class="op" id="5931623">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5931628">0x88</span><span class="op" id="5931632">,</span>&nbsp;<span class="num" id="5931634">0x89</span><span class="op" id="5931638">,</span>&nbsp;<span class="num" id="5931640">0x8a</span><span class="op" id="5931644">,</span>&nbsp;<span class="num" id="5931646">0x92</span><span class="op" id="5931650">,</span>&nbsp;<span class="num" id="5931652">0x93</span><span class="op" id="5931656">,</span>&nbsp;<span class="num" id="5931658">0x94</span><span class="op" id="5931662">,</span>&nbsp;<span class="num" id="5931664">0x95</span><span class="op" id="5931668">,</span>&nbsp;<span class="num" id="5931670">0x96</span><span class="op" id="5931674">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5931679">0x97</span><span class="op" id="5931683">,</span>&nbsp;<span class="num" id="5931685">0x98</span><span class="op" id="5931689">,</span>&nbsp;<span class="num" id="5931691">0x99</span><span class="op" id="5931695">,</span>&nbsp;<span class="num" id="5931697">0x9a</span><span class="op" id="5931701">,</span>&nbsp;<span class="num" id="5931703">0xa2</span><span class="op" id="5931707">,</span>&nbsp;<span class="num" id="5931709">0xa3</span><span class="op" id="5931713">,</span>&nbsp;<span class="num" id="5931715">0xa4</span><span class="op" id="5931719">,</span>&nbsp;<span class="num" id="5931721">0xa5</span><span class="op" id="5931725">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5931730">0xa6</span><span class="op" id="5931734">,</span>&nbsp;<span class="num" id="5931736">0xa7</span><span class="op" id="5931740">,</span>&nbsp;<span class="num" id="5931742">0xa8</span><span class="op" id="5931746">,</span>&nbsp;<span class="num" id="5931748">0xa9</span><span class="op" id="5931752">,</span>&nbsp;<span class="num" id="5931754">0xaa</span><span class="op" id="5931758">,</span>&nbsp;<span class="num" id="5931760">0xb2</span><span class="op" id="5931764">,</span>&nbsp;<span class="num" id="5931766">0xb3</span><span class="op" id="5931770">,</span>&nbsp;<span class="num" id="5931772">0xb4</span><span class="op" id="5931776">,</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5931781">0xb5</span><span class="op" id="5931785">,</span>&nbsp;<span class="num" id="5931787">0xb6</span><span class="op" id="5931791">,</span>&nbsp;<span class="num" id="5931793">0xb7</span><span class="op" id="5931797">,</span>&nbsp;<span class="num" id="5931799">0xb8</span><span class="op" id="5931803">,</span>&nbsp;<span class="num" id="5931805">0xb9</span><span class="op" id="5931809">,</span>&nbsp;<span class="num" id="5931811">0xba</span><span class="op" id="5931815">,</span>&nbsp;<span class="num" id="5931817">0xc2</span><span class="op" id="5931821">,</span>&nbsp;<span class="num" id="5931823">0xc3</span><span class="op" id="5931827">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5931832">0xc4</span><span class="op" id="5931836">,</span>&nbsp;<span class="num" id="5931838">0xc5</span><span class="op" id="5931842">,</span>&nbsp;<span class="num" id="5931844">0xc6</span><span class="op" id="5931848">,</span>&nbsp;<span class="num" id="5931850">0xc7</span><span class="op" id="5931854">,</span>&nbsp;<span class="num" id="5931856">0xc8</span><span class="op" id="5931860">,</span>&nbsp;<span class="num" id="5931862">0xc9</span><span class="op" id="5931866">,</span>&nbsp;<span class="num" id="5931868">0xca</span><span class="op" id="5931872">,</span>&nbsp;<span class="num" id="5931874">0xd2</span><span class="op" id="5931878">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5931883">0xd3</span><span class="op" id="5931887">,</span>&nbsp;<span class="num" id="5931889">0xd4</span><span class="op" id="5931893">,</span>&nbsp;<span class="num" id="5931895">0xd5</span><span class="op" id="5931899">,</span>&nbsp;<span class="num" id="5931901">0xd6</span><span class="op" id="5931905">,</span>&nbsp;<span class="num" id="5931907">0xd7</span><span class="op" id="5931911">,</span>&nbsp;<span class="num" id="5931913">0xd8</span><span class="op" id="5931917">,</span>&nbsp;<span class="num" id="5931919">0xd9</span><span class="op" id="5931923">,</span>&nbsp;<span class="num" id="5931925">0xda</span><span class="op" id="5931929">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5931934">0xe2</span><span class="op" id="5931938">,</span>&nbsp;<span class="num" id="5931940">0xe3</span><span class="op" id="5931944">,</span>&nbsp;<span class="num" id="5931946">0xe4</span><span class="op" id="5931950">,</span>&nbsp;<span class="num" id="5931952">0xe5</span><span class="op" id="5931956">,</span>&nbsp;<span class="num" id="5931958">0xe6</span><span class="op" id="5931962">,</span>&nbsp;<span class="num" id="5931964">0xe7</span><span class="op" id="5931968">,</span>&nbsp;<span class="num" id="5931970">0xe8</span><span class="op" id="5931974">,</span>&nbsp;<span class="num" id="5931976">0xe9</span><span class="op" id="5931980">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5931985">0xea</span><span class="op" id="5931989">,</span>&nbsp;<span class="num" id="5931991">0xf2</span><span class="op" id="5931995">,</span>&nbsp;<span class="num" id="5931997">0xf3</span><span class="op" id="5932001">,</span>&nbsp;<span class="num" id="5932003">0xf4</span><span class="op" id="5932007">,</span>&nbsp;<span class="num" id="5932009">0xf5</span><span class="op" id="5932013">,</span>&nbsp;<span class="num" id="5932015">0xf6</span><span class="op" id="5932019">,</span>&nbsp;<span class="num" id="5932021">0xf7</span><span class="op" id="5932025">,</span>&nbsp;<span class="num" id="5932027">0xf8</span><span class="op" id="5932031">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5932036">0xf9</span><span class="op" id="5932040">,</span>&nbsp;<span class="num" id="5932042">0xfa</span><span class="op" id="5932046">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5932050">}</span><span class="op" id="5932051">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5932054">}</span><span class="op" id="5932055">,</span><br>
<span class="lineno"></span><span class="op" id="5932057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="5932060">//&nbsp;huffmanLUT&nbsp;is&nbsp;a&nbsp;compiled&nbsp;look-up&nbsp;table&nbsp;representation&nbsp;of&nbsp;a&nbsp;huffmanSpec.</span><br>
<span class="lineno"></span><span class="comment" id="5932135">//&nbsp;Each&nbsp;value&nbsp;maps&nbsp;to&nbsp;a&nbsp;uint32&nbsp;of&nbsp;which&nbsp;the&nbsp;8&nbsp;most&nbsp;significant&nbsp;bits&nbsp;hold&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5932212">//&nbsp;codeword&nbsp;size&nbsp;in&nbsp;bits&nbsp;and&nbsp;the&nbsp;24&nbsp;least&nbsp;significant&nbsp;bits&nbsp;hold&nbsp;the&nbsp;codeword.</span><br>
<span class="lineno"></span><span class="comment" id="5932290">//&nbsp;The&nbsp;maximum&nbsp;codeword&nbsp;size&nbsp;is&nbsp;16&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="5932331">type</span>&nbsp;<span class="ident" id="5932336">huffmanLUT</span>&nbsp;<span class="op" id="5932347">[</span><span class="op" id="5932348">]</span><span class="builtintype" id="5932349">uint32</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="keyword" id="5932357">func</span>&nbsp;<span class="op" id="5932362">(</span><span class="ident" id="5932363">h</span>&nbsp;<span class="op" id="5932365">*</span><span class="ident" id="5932366">huffmanLUT</span><span class="op" id="5932376">)</span>&nbsp;<span class="ident" id="5932378">init</span><span class="op" id="5932382">(</span><span class="ident" id="5932383">s</span>&nbsp;<span class="ident" id="5932385">huffmanSpec</span><span class="op" id="5932396">)</span>&nbsp;<span class="op" id="5932398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5932401">maxValue</span>&nbsp;<span class="op" id="5932410">:=</span>&nbsp;<span class="num" id="5932413">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5932416">for</span>&nbsp;<span class="ident" id="5932420">_</span><span class="op" id="5932421">,</span>&nbsp;<span class="ident" id="5932423">v</span>&nbsp;<span class="op" id="5932425">:=</span>&nbsp;<span class="keyword" id="5932428">range</span>&nbsp;<span class="ident" id="5932434">s</span><span class="op" id="5932435">.</span><span class="ident" id="5932436">value</span>&nbsp;<span class="op" id="5932442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5932446">if</span>&nbsp;<span class="builtintype" id="5932449">int</span><span class="op" id="5932452">(</span><span class="ident" id="5932453">v</span><span class="op" id="5932454">)</span>&nbsp;<span class="op" id="5932456">&gt;</span>&nbsp;<span class="ident" id="5932458">maxValue</span>&nbsp;<span class="op" id="5932467">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5932472">maxValue</span>&nbsp;<span class="op" id="5932481">=</span>&nbsp;<span class="builtintype" id="5932483">int</span><span class="op" id="5932486">(</span><span class="ident" id="5932487">v</span><span class="op" id="5932488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5932492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5932495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5932498">*</span><span class="ident" id="5932499">h</span>&nbsp;<span class="op" id="5932501">=</span>&nbsp;<span class="builtinfunc" id="5932503">make</span><span class="op" id="5932507">(</span><span class="op" id="5932508">[</span><span class="op" id="5932509">]</span><span class="builtintype" id="5932510">uint32</span><span class="op" id="5932516">,</span>&nbsp;<span class="ident" id="5932518">maxValue</span><span class="op" id="5932526">+</span><span class="num" id="5932527">1</span><span class="op" id="5932528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5932531">code</span><span class="op" id="5932535">,</span>&nbsp;<span class="ident" id="5932537">k</span>&nbsp;<span class="op" id="5932539">:=</span>&nbsp;<span class="builtintype" id="5932542">uint32</span><span class="op" id="5932548">(</span><span class="num" id="5932549">0</span><span class="op" id="5932550">)</span><span class="op" id="5932551">,</span>&nbsp;<span class="num" id="5932553">0</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5932556">for</span>&nbsp;<span class="ident" id="5932560">i</span>&nbsp;<span class="op" id="5932562">:=</span>&nbsp;<span class="num" id="5932565">0</span><span class="op" id="5932566">;</span>&nbsp;<span class="ident" id="5932568">i</span>&nbsp;<span class="op" id="5932570">&lt;</span>&nbsp;<span class="builtinfunc" id="5932572">len</span><span class="op" id="5932575">(</span><span class="ident" id="5932576">s</span><span class="op" id="5932577">.</span><span class="ident" id="5932578">count</span><span class="op" id="5932583">)</span><span class="op" id="5932584">;</span>&nbsp;<span class="ident" id="5932586">i</span><span class="op" id="5932587">++</span>&nbsp;<span class="op" id="5932590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5932594">nBits</span>&nbsp;<span class="op" id="5932600">:=</span>&nbsp;<span class="builtintype" id="5932603">uint32</span><span class="op" id="5932609">(</span><span class="ident" id="5932610">i</span><span class="op" id="5932611">+</span><span class="num" id="5932612">1</span><span class="op" id="5932613">)</span>&nbsp;<span class="op" id="5932615">&lt;&lt;</span>&nbsp;<span class="num" id="5932618">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5932623">for</span>&nbsp;<span class="ident" id="5932627">j</span>&nbsp;<span class="op" id="5932629">:=</span>&nbsp;<span class="builtintype" id="5932632">uint8</span><span class="op" id="5932637">(</span><span class="num" id="5932638">0</span><span class="op" id="5932639">)</span><span class="op" id="5932640">;</span>&nbsp;<span class="ident" id="5932642">j</span>&nbsp;<span class="op" id="5932644">&lt;</span>&nbsp;<span class="ident" id="5932646">s</span><span class="op" id="5932647">.</span><span class="ident" id="5932648">count</span><span class="op" id="5932653">[</span><span class="ident" id="5932654">i</span><span class="op" id="5932655">]</span><span class="op" id="5932656">;</span>&nbsp;<span class="ident" id="5932658">j</span><span class="op" id="5932659">++</span>&nbsp;<span class="op" id="5932662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5932667">(</span><span class="op" id="5932668">*</span><span class="ident" id="5932669">h</span><span class="op" id="5932670">)</span><span class="op" id="5932671">[</span><span class="ident" id="5932672">s</span><span class="op" id="5932673">.</span><span class="ident" id="5932674">value</span><span class="op" id="5932679">[</span><span class="ident" id="5932680">k</span><span class="op" id="5932681">]</span><span class="op" id="5932682">]</span>&nbsp;<span class="op" id="5932684">=</span>&nbsp;<span class="ident" id="5932686">nBits</span>&nbsp;<span class="op" id="5932692">|</span>&nbsp;<span class="ident" id="5932694">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5932702">code</span><span class="op" id="5932706">++</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5932712">k</span><span class="op" id="5932713">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5932718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5932722">code</span>&nbsp;<span class="op" id="5932727">&lt;&lt;=</span>&nbsp;<span class="num" id="5932731">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5932734">}</span><br>
<span class="lineno"></span><span class="op" id="5932736">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="5932739">//&nbsp;theHuffmanLUT&nbsp;are&nbsp;compiled&nbsp;representations&nbsp;of&nbsp;theHuffmanSpec.</span><br>
<span class="lineno"></span><span class="keyword" id="5932804">var</span>&nbsp;<span class="ident" id="5932808">theHuffmanLUT</span>&nbsp;<span class="op" id="5932822">[</span><span class="num" id="5932823">4</span><span class="op" id="5932824">]</span><span class="ident" id="5932825">huffmanLUT</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5932837">func</span>&nbsp;<span class="ident" id="5932842">init</span><span class="op" id="5932846">(</span><span class="op" id="5932847">)</span>&nbsp;<span class="op" id="5932849">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5932852">for</span>&nbsp;<span class="ident" id="5932856">i</span><span class="op" id="5932857">,</span>&nbsp;<span class="ident" id="5932859">s</span>&nbsp;<span class="op" id="5932861">:=</span>&nbsp;<span class="keyword" id="5932864">range</span>&nbsp;<span class="ident" id="5932870">theHuffmanSpec</span>&nbsp;<span class="op" id="5932885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5932889">theHuffmanLUT</span><span class="op" id="5932902">[</span><span class="ident" id="5932903">i</span><span class="op" id="5932904">]</span><span class="op" id="5932905">.</span><span class="ident" id="5932906">init</span><span class="op" id="5932910">(</span><span class="ident" id="5932911">s</span><span class="op" id="5932912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5932915">}</span><br>
<span class="lineno"></span><span class="op" id="5932917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="comment" id="5932920">//&nbsp;writer&nbsp;is&nbsp;a&nbsp;buffered&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="5932952">type</span>&nbsp;<span class="ident" id="5932957">writer</span>&nbsp;<span class="keyword" id="5932964">interface</span>&nbsp;<span class="op" id="5932974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5932977">Flush</span><span class="op" id="5932982">(</span><span class="op" id="5932983">)</span>&nbsp;<span class="builtintype" id="5932985">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5932992">io</span><span class="op" id="5932994">.</span><span class="ident" id="5932995">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933003">io</span><span class="op" id="5933005">.</span><span class="ident" id="5933006">ByteWriter</span><br>
<span class="lineno">215</span><span class="op" id="5933017">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5933020">//&nbsp;encoder&nbsp;encodes&nbsp;an&nbsp;image&nbsp;to&nbsp;the&nbsp;JPEG&nbsp;format.</span><br>
<span class="lineno"></span><span class="keyword" id="5933068">type</span>&nbsp;<span class="ident" id="5933073">encoder</span>&nbsp;<span class="keyword" id="5933081">struct</span>&nbsp;<span class="op" id="5933088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5933091">//&nbsp;w&nbsp;is&nbsp;the&nbsp;writer&nbsp;to&nbsp;write&nbsp;to.&nbsp;err&nbsp;is&nbsp;the&nbsp;first&nbsp;error&nbsp;encountered&nbsp;during</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5933166">//&nbsp;writing.&nbsp;All&nbsp;attempted&nbsp;writes&nbsp;after&nbsp;the&nbsp;first&nbsp;error&nbsp;become&nbsp;no-ops.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933237">w</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5933241">writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933249">err</span>&nbsp;<span class="builtintype" id="5933253">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5933260">//&nbsp;buf&nbsp;is&nbsp;a&nbsp;scratch&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933289">buf</span>&nbsp;<span class="op" id="5933293">[</span><span class="num" id="5933294">16</span><span class="op" id="5933296">]</span><span class="builtintype" id="5933297">byte</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5933303">//&nbsp;bits&nbsp;and&nbsp;nBits&nbsp;are&nbsp;accumulated&nbsp;bits&nbsp;to&nbsp;write&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933358">bits</span><span class="op" id="5933362">,</span>&nbsp;<span class="ident" id="5933364">nBits</span>&nbsp;<span class="builtintype" id="5933370">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5933378">//&nbsp;quant&nbsp;is&nbsp;the&nbsp;scaled&nbsp;quantization&nbsp;tables,&nbsp;in&nbsp;zig-zag&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933441">quant</span>&nbsp;<span class="op" id="5933447">[</span><span class="ident" id="5933448">nQuantIndex</span><span class="op" id="5933459">]</span><span class="op" id="5933460">[</span><span class="ident" id="5933461">blockSize</span><span class="op" id="5933470">]</span><span class="builtintype" id="5933471">byte</span><br>
<span class="lineno"></span><span class="op" id="5933476">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="keyword" id="5933479">func</span>&nbsp;<span class="op" id="5933484">(</span><span class="ident" id="5933485">e</span>&nbsp;<span class="op" id="5933487">*</span><span class="ident" id="5933488">encoder</span><span class="op" id="5933495">)</span>&nbsp;<span class="ident" id="5933497">flush</span><span class="op" id="5933502">(</span><span class="op" id="5933503">)</span>&nbsp;<span class="op" id="5933505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5933508">if</span>&nbsp;<span class="ident" id="5933511">e</span><span class="op" id="5933512">.</span><span class="ident" id="5933513">err</span>&nbsp;<span class="op" id="5933517">!=</span>&nbsp;<span class="ident" id="5933520">nil</span>&nbsp;<span class="op" id="5933524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5933528">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5933536">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933539">e</span><span class="op" id="5933540">.</span><span class="ident" id="5933541">err</span>&nbsp;<span class="op" id="5933545">=</span>&nbsp;<span class="ident" id="5933547">e</span><span class="op" id="5933548">.</span><span class="ident" id="5933549">w</span><span class="op" id="5933550">.</span><span class="ident" id="5933551">Flush</span><span class="op" id="5933556">(</span><span class="op" id="5933557">)</span><br>
<span class="lineno"></span><span class="op" id="5933559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5933562">func</span>&nbsp;<span class="op" id="5933567">(</span><span class="ident" id="5933568">e</span>&nbsp;<span class="op" id="5933570">*</span><span class="ident" id="5933571">encoder</span><span class="op" id="5933578">)</span>&nbsp;<span class="ident" id="5933580">write</span><span class="op" id="5933585">(</span><span class="ident" id="5933586">p</span>&nbsp;<span class="op" id="5933588">[</span><span class="op" id="5933589">]</span><span class="builtintype" id="5933590">byte</span><span class="op" id="5933594">)</span>&nbsp;<span class="op" id="5933596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5933599">if</span>&nbsp;<span class="ident" id="5933602">e</span><span class="op" id="5933603">.</span><span class="ident" id="5933604">err</span>&nbsp;<span class="op" id="5933608">!=</span>&nbsp;<span class="ident" id="5933611">nil</span>&nbsp;<span class="op" id="5933615">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5933619">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5933627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933630">_</span><span class="op" id="5933631">,</span>&nbsp;<span class="ident" id="5933633">e</span><span class="op" id="5933634">.</span><span class="ident" id="5933635">err</span>&nbsp;<span class="op" id="5933639">=</span>&nbsp;<span class="ident" id="5933641">e</span><span class="op" id="5933642">.</span><span class="ident" id="5933643">w</span><span class="op" id="5933644">.</span><span class="ident" id="5933645">Write</span><span class="op" id="5933650">(</span><span class="ident" id="5933651">p</span><span class="op" id="5933652">)</span><br>
<span class="lineno"></span><span class="op" id="5933654">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="keyword" id="5933657">func</span>&nbsp;<span class="op" id="5933662">(</span><span class="ident" id="5933663">e</span>&nbsp;<span class="op" id="5933665">*</span><span class="ident" id="5933666">encoder</span><span class="op" id="5933673">)</span>&nbsp;<span class="ident" id="5933675">writeByte</span><span class="op" id="5933684">(</span><span class="ident" id="5933685">b</span>&nbsp;<span class="builtintype" id="5933687">byte</span><span class="op" id="5933691">)</span>&nbsp;<span class="op" id="5933693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5933696">if</span>&nbsp;<span class="ident" id="5933699">e</span><span class="op" id="5933700">.</span><span class="ident" id="5933701">err</span>&nbsp;<span class="op" id="5933705">!=</span>&nbsp;<span class="ident" id="5933708">nil</span>&nbsp;<span class="op" id="5933712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5933716">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5933724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933727">e</span><span class="op" id="5933728">.</span><span class="ident" id="5933729">err</span>&nbsp;<span class="op" id="5933733">=</span>&nbsp;<span class="ident" id="5933735">e</span><span class="op" id="5933736">.</span><span class="ident" id="5933737">w</span><span class="op" id="5933738">.</span><span class="ident" id="5933739">WriteByte</span><span class="op" id="5933748">(</span><span class="ident" id="5933749">b</span><span class="op" id="5933750">)</span><br>
<span class="lineno">250</span><span class="op" id="5933752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5933755">//&nbsp;emit&nbsp;emits&nbsp;the&nbsp;least&nbsp;significant&nbsp;nBits&nbsp;bits&nbsp;of&nbsp;bits&nbsp;to&nbsp;the&nbsp;bit-stream.</span><br>
<span class="lineno"></span><span class="comment" id="5933829">//&nbsp;The&nbsp;precondition&nbsp;is&nbsp;bits&nbsp;&lt;&nbsp;1&lt;&lt;nBits&nbsp;&amp;&amp;&nbsp;nBits&nbsp;&lt;=&nbsp;16.</span><br>
<span class="lineno"></span><span class="keyword" id="5933884">func</span>&nbsp;<span class="op" id="5933889">(</span><span class="ident" id="5933890">e</span>&nbsp;<span class="op" id="5933892">*</span><span class="ident" id="5933893">encoder</span><span class="op" id="5933900">)</span>&nbsp;<span class="ident" id="5933902">emit</span><span class="op" id="5933906">(</span><span class="ident" id="5933907">bits</span><span class="op" id="5933911">,</span>&nbsp;<span class="ident" id="5933913">nBits</span>&nbsp;<span class="builtintype" id="5933919">uint32</span><span class="op" id="5933925">)</span>&nbsp;<span class="op" id="5933927">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933930">nBits</span>&nbsp;<span class="op" id="5933936">+=</span>&nbsp;<span class="ident" id="5933939">e</span><span class="op" id="5933940">.</span><span class="ident" id="5933941">nBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933948">bits</span>&nbsp;<span class="op" id="5933953">&lt;&lt;=</span>&nbsp;<span class="num" id="5933957">32</span>&nbsp;<span class="op" id="5933960">-</span>&nbsp;<span class="ident" id="5933962">nBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933969">bits</span>&nbsp;<span class="op" id="5933974">|=</span>&nbsp;<span class="ident" id="5933977">e</span><span class="op" id="5933978">.</span><span class="ident" id="5933979">bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5933985">for</span>&nbsp;<span class="ident" id="5933989">nBits</span>&nbsp;<span class="op" id="5933995">&gt;=</span>&nbsp;<span class="num" id="5933998">8</span>&nbsp;<span class="op" id="5934000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934004">b</span>&nbsp;<span class="op" id="5934006">:=</span>&nbsp;<span class="builtintype" id="5934009">uint8</span><span class="op" id="5934014">(</span><span class="ident" id="5934015">bits</span>&nbsp;<span class="op" id="5934020">&gt;&gt;</span>&nbsp;<span class="num" id="5934023">24</span><span class="op" id="5934025">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934029">e</span><span class="op" id="5934030">.</span><span class="ident" id="5934031">writeByte</span><span class="op" id="5934040">(</span><span class="ident" id="5934041">b</span><span class="op" id="5934042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5934046">if</span>&nbsp;<span class="ident" id="5934049">b</span>&nbsp;<span class="op" id="5934051">==</span>&nbsp;<span class="num" id="5934054">0xff</span>&nbsp;<span class="op" id="5934059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934064">e</span><span class="op" id="5934065">.</span><span class="ident" id="5934066">writeByte</span><span class="op" id="5934075">(</span><span class="num" id="5934076">0x00</span><span class="op" id="5934080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5934084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934088">bits</span>&nbsp;<span class="op" id="5934093">&lt;&lt;=</span>&nbsp;<span class="num" id="5934097">8</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934101">nBits</span>&nbsp;<span class="op" id="5934107">-=</span>&nbsp;<span class="num" id="5934110">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5934113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934116">e</span><span class="op" id="5934117">.</span><span class="ident" id="5934118">bits</span><span class="op" id="5934122">,</span>&nbsp;<span class="ident" id="5934124">e</span><span class="op" id="5934125">.</span><span class="ident" id="5934126">nBits</span>&nbsp;<span class="op" id="5934132">=</span>&nbsp;<span class="ident" id="5934134">bits</span><span class="op" id="5934138">,</span>&nbsp;<span class="ident" id="5934140">nBits</span><br>
<span class="lineno"></span><span class="op" id="5934146">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="5934149">//&nbsp;emitHuff&nbsp;emits&nbsp;the&nbsp;given&nbsp;value&nbsp;with&nbsp;the&nbsp;given&nbsp;Huffman&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="keyword" id="5934215">func</span>&nbsp;<span class="op" id="5934220">(</span><span class="ident" id="5934221">e</span>&nbsp;<span class="op" id="5934223">*</span><span class="ident" id="5934224">encoder</span><span class="op" id="5934231">)</span>&nbsp;<span class="ident" id="5934233">emitHuff</span><span class="op" id="5934241">(</span><span class="ident" id="5934242">h</span>&nbsp;<span class="ident" id="5934244">huffIndex</span><span class="op" id="5934253">,</span>&nbsp;<span class="ident" id="5934255">value</span>&nbsp;<span class="builtintype" id="5934261">int32</span><span class="op" id="5934266">)</span>&nbsp;<span class="op" id="5934268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934271">x</span>&nbsp;<span class="op" id="5934273">:=</span>&nbsp;<span class="ident" id="5934276">theHuffmanLUT</span><span class="op" id="5934289">[</span><span class="ident" id="5934290">h</span><span class="op" id="5934291">]</span><span class="op" id="5934292">[</span><span class="ident" id="5934293">value</span><span class="op" id="5934298">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934301">e</span><span class="op" id="5934302">.</span><span class="ident" id="5934303">emit</span><span class="op" id="5934307">(</span><span class="ident" id="5934308">x</span><span class="op" id="5934309">&amp;</span><span class="op" id="5934310">(</span><span class="num" id="5934311">1</span><span class="op" id="5934312">&lt;&lt;</span><span class="num" id="5934314">24</span><span class="op" id="5934316">-</span><span class="num" id="5934317">1</span><span class="op" id="5934318">)</span><span class="op" id="5934319">,</span>&nbsp;<span class="ident" id="5934321">x</span><span class="op" id="5934322">&gt;&gt;</span><span class="num" id="5934324">24</span><span class="op" id="5934326">)</span><br>
<span class="lineno"></span><span class="op" id="5934328">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="comment" id="5934331">//&nbsp;emitHuffRLE&nbsp;emits&nbsp;a&nbsp;run&nbsp;of&nbsp;runLength&nbsp;copies&nbsp;of&nbsp;value&nbsp;encoded&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="5934410">//&nbsp;Huffman&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="keyword" id="5934430">func</span>&nbsp;<span class="op" id="5934435">(</span><span class="ident" id="5934436">e</span>&nbsp;<span class="op" id="5934438">*</span><span class="ident" id="5934439">encoder</span><span class="op" id="5934446">)</span>&nbsp;<span class="ident" id="5934448">emitHuffRLE</span><span class="op" id="5934459">(</span><span class="ident" id="5934460">h</span>&nbsp;<span class="ident" id="5934462">huffIndex</span><span class="op" id="5934471">,</span>&nbsp;<span class="ident" id="5934473">runLength</span><span class="op" id="5934482">,</span>&nbsp;<span class="ident" id="5934484">value</span>&nbsp;<span class="builtintype" id="5934490">int32</span><span class="op" id="5934495">)</span>&nbsp;<span class="op" id="5934497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934500">a</span><span class="op" id="5934501">,</span>&nbsp;<span class="ident" id="5934503">b</span>&nbsp;<span class="op" id="5934505">:=</span>&nbsp;<span class="ident" id="5934508">value</span><span class="op" id="5934513">,</span>&nbsp;<span class="ident" id="5934515">value</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5934522">if</span>&nbsp;<span class="ident" id="5934525">a</span>&nbsp;<span class="op" id="5934527">&lt;</span>&nbsp;<span class="num" id="5934529">0</span>&nbsp;<span class="op" id="5934531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934535">a</span><span class="op" id="5934536">,</span>&nbsp;<span class="ident" id="5934538">b</span>&nbsp;<span class="op" id="5934540">=</span>&nbsp;<span class="op" id="5934542">-</span><span class="ident" id="5934543">value</span><span class="op" id="5934548">,</span>&nbsp;<span class="ident" id="5934550">value</span><span class="op" id="5934555">-</span><span class="num" id="5934556">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5934559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5934562">var</span>&nbsp;<span class="ident" id="5934566">nBits</span>&nbsp;<span class="builtintype" id="5934572">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5934580">if</span>&nbsp;<span class="ident" id="5934583">a</span>&nbsp;<span class="op" id="5934585">&lt;</span>&nbsp;<span class="num" id="5934587">0x100</span>&nbsp;<span class="op" id="5934593">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934597">nBits</span>&nbsp;<span class="op" id="5934603">=</span>&nbsp;<span class="builtintype" id="5934605">uint32</span><span class="op" id="5934611">(</span><span class="ident" id="5934612">bitCount</span><span class="op" id="5934620">[</span><span class="ident" id="5934621">a</span><span class="op" id="5934622">]</span><span class="op" id="5934623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5934626">}</span>&nbsp;<span class="keyword" id="5934628">else</span>&nbsp;<span class="op" id="5934633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934637">nBits</span>&nbsp;<span class="op" id="5934643">=</span>&nbsp;<span class="num" id="5934645">8</span>&nbsp;<span class="op" id="5934647">+</span>&nbsp;<span class="builtintype" id="5934649">uint32</span><span class="op" id="5934655">(</span><span class="ident" id="5934656">bitCount</span><span class="op" id="5934664">[</span><span class="ident" id="5934665">a</span><span class="op" id="5934666">&gt;&gt;</span><span class="num" id="5934668">8</span><span class="op" id="5934669">]</span><span class="op" id="5934670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5934673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934676">e</span><span class="op" id="5934677">.</span><span class="ident" id="5934678">emitHuff</span><span class="op" id="5934686">(</span><span class="ident" id="5934687">h</span><span class="op" id="5934688">,</span>&nbsp;<span class="ident" id="5934690">runLength</span><span class="op" id="5934699">&lt;&lt;</span><span class="num" id="5934701">4</span><span class="op" id="5934702">|</span><span class="builtintype" id="5934703">int32</span><span class="op" id="5934708">(</span><span class="ident" id="5934709">nBits</span><span class="op" id="5934714">)</span><span class="op" id="5934715">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5934718">if</span>&nbsp;<span class="ident" id="5934721">nBits</span>&nbsp;<span class="op" id="5934727">&gt;</span>&nbsp;<span class="num" id="5934729">0</span>&nbsp;<span class="op" id="5934731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934735">e</span><span class="op" id="5934736">.</span><span class="ident" id="5934737">emit</span><span class="op" id="5934741">(</span><span class="builtintype" id="5934742">uint32</span><span class="op" id="5934748">(</span><span class="ident" id="5934749">b</span><span class="op" id="5934750">)</span><span class="op" id="5934751">&amp;</span><span class="op" id="5934752">(</span><span class="num" id="5934753">1</span><span class="op" id="5934754">&lt;&lt;</span><span class="ident" id="5934756">nBits</span><span class="op" id="5934761">-</span><span class="num" id="5934762">1</span><span class="op" id="5934763">)</span><span class="op" id="5934764">,</span>&nbsp;<span class="ident" id="5934766">nBits</span><span class="op" id="5934771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5934774">}</span><br>
<span class="lineno"></span><span class="op" id="5934776">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span><span class="comment" id="5934779">//&nbsp;writeMarkerHeader&nbsp;writes&nbsp;the&nbsp;header&nbsp;for&nbsp;a&nbsp;marker&nbsp;with&nbsp;the&nbsp;given&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="5934854">func</span>&nbsp;<span class="op" id="5934859">(</span><span class="ident" id="5934860">e</span>&nbsp;<span class="op" id="5934862">*</span><span class="ident" id="5934863">encoder</span><span class="op" id="5934870">)</span>&nbsp;<span class="ident" id="5934872">writeMarkerHeader</span><span class="op" id="5934889">(</span><span class="ident" id="5934890">marker</span>&nbsp;<span class="builtintype" id="5934897">uint8</span><span class="op" id="5934902">,</span>&nbsp;<span class="ident" id="5934904">markerlen</span>&nbsp;<span class="builtintype" id="5934914">int</span><span class="op" id="5934917">)</span>&nbsp;<span class="op" id="5934919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934922">e</span><span class="op" id="5934923">.</span><span class="ident" id="5934924">buf</span><span class="op" id="5934927">[</span><span class="num" id="5934928">0</span><span class="op" id="5934929">]</span>&nbsp;<span class="op" id="5934931">=</span>&nbsp;<span class="num" id="5934933">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934939">e</span><span class="op" id="5934940">.</span><span class="ident" id="5934941">buf</span><span class="op" id="5934944">[</span><span class="num" id="5934945">1</span><span class="op" id="5934946">]</span>&nbsp;<span class="op" id="5934948">=</span>&nbsp;<span class="ident" id="5934950">marker</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934958">e</span><span class="op" id="5934959">.</span><span class="ident" id="5934960">buf</span><span class="op" id="5934963">[</span><span class="num" id="5934964">2</span><span class="op" id="5934965">]</span>&nbsp;<span class="op" id="5934967">=</span>&nbsp;<span class="builtintype" id="5934969">uint8</span><span class="op" id="5934974">(</span><span class="ident" id="5934975">markerlen</span>&nbsp;<span class="op" id="5934985">&gt;&gt;</span>&nbsp;<span class="num" id="5934988">8</span><span class="op" id="5934989">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934992">e</span><span class="op" id="5934993">.</span><span class="ident" id="5934994">buf</span><span class="op" id="5934997">[</span><span class="num" id="5934998">3</span><span class="op" id="5934999">]</span>&nbsp;<span class="op" id="5935001">=</span>&nbsp;<span class="builtintype" id="5935003">uint8</span><span class="op" id="5935008">(</span><span class="ident" id="5935009">markerlen</span>&nbsp;<span class="op" id="5935019">&amp;</span>&nbsp;<span class="num" id="5935021">0xff</span><span class="op" id="5935025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935028">e</span><span class="op" id="5935029">.</span><span class="ident" id="5935030">write</span><span class="op" id="5935035">(</span><span class="ident" id="5935036">e</span><span class="op" id="5935037">.</span><span class="ident" id="5935038">buf</span><span class="op" id="5935041">[</span><span class="op" id="5935042">:</span><span class="num" id="5935043">4</span><span class="op" id="5935044">]</span><span class="op" id="5935045">)</span><br>
<span class="lineno"></span><span class="op" id="5935047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5935050">//&nbsp;writeDQT&nbsp;writes&nbsp;the&nbsp;Define&nbsp;Quantization&nbsp;Table&nbsp;marker.</span><br>
<span class="lineno">305</span><span class="keyword" id="5935107">func</span>&nbsp;<span class="op" id="5935112">(</span><span class="ident" id="5935113">e</span>&nbsp;<span class="op" id="5935115">*</span><span class="ident" id="5935116">encoder</span><span class="op" id="5935123">)</span>&nbsp;<span class="ident" id="5935125">writeDQT</span><span class="op" id="5935133">(</span><span class="op" id="5935134">)</span>&nbsp;<span class="op" id="5935136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5935139">const</span>&nbsp;<span class="ident" id="5935145">markerlen</span>&nbsp;<span class="op" id="5935155">=</span>&nbsp;<span class="num" id="5935157">2</span>&nbsp;<span class="op" id="5935159">+</span>&nbsp;<span class="builtintype" id="5935161">int</span><span class="op" id="5935164">(</span><span class="ident" id="5935165">nQuantIndex</span><span class="op" id="5935176">)</span><span class="op" id="5935177">*</span><span class="op" id="5935178">(</span><span class="num" id="5935179">1</span><span class="op" id="5935180">+</span><span class="ident" id="5935181">blockSize</span><span class="op" id="5935190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935193">e</span><span class="op" id="5935194">.</span><span class="ident" id="5935195">writeMarkerHeader</span><span class="op" id="5935212">(</span><span class="ident" id="5935213">dqtMarker</span><span class="op" id="5935222">,</span>&nbsp;<span class="ident" id="5935224">markerlen</span><span class="op" id="5935233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5935236">for</span>&nbsp;<span class="ident" id="5935240">i</span>&nbsp;<span class="op" id="5935242">:=</span>&nbsp;<span class="keyword" id="5935245">range</span>&nbsp;<span class="ident" id="5935251">e</span><span class="op" id="5935252">.</span><span class="ident" id="5935253">quant</span>&nbsp;<span class="op" id="5935259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935263">e</span><span class="op" id="5935264">.</span><span class="ident" id="5935265">writeByte</span><span class="op" id="5935274">(</span><span class="builtintype" id="5935275">uint8</span><span class="op" id="5935280">(</span><span class="ident" id="5935281">i</span><span class="op" id="5935282">)</span><span class="op" id="5935283">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935287">e</span><span class="op" id="5935288">.</span><span class="ident" id="5935289">write</span><span class="op" id="5935294">(</span><span class="ident" id="5935295">e</span><span class="op" id="5935296">.</span><span class="ident" id="5935297">quant</span><span class="op" id="5935302">[</span><span class="ident" id="5935303">i</span><span class="op" id="5935304">]</span><span class="op" id="5935305">[</span><span class="op" id="5935306">:</span><span class="op" id="5935307">]</span><span class="op" id="5935308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5935311">}</span><br>
<span class="lineno"></span><span class="op" id="5935313">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5935316">//&nbsp;writeSOF0&nbsp;writes&nbsp;the&nbsp;Start&nbsp;Of&nbsp;Frame&nbsp;(Baseline)&nbsp;marker.</span><br>
<span class="lineno">315</span><span class="keyword" id="5935374">func</span>&nbsp;<span class="op" id="5935379">(</span><span class="ident" id="5935380">e</span>&nbsp;<span class="op" id="5935382">*</span><span class="ident" id="5935383">encoder</span><span class="op" id="5935390">)</span>&nbsp;<span class="ident" id="5935392">writeSOF0</span><span class="op" id="5935401">(</span><span class="ident" id="5935402">size</span>&nbsp;<span class="ident" id="5935407">image</span><span class="op" id="5935412">.</span><span class="ident" id="5935413">Point</span><span class="op" id="5935418">,</span>&nbsp;<span class="ident" id="5935420">nComponent</span>&nbsp;<span class="builtintype" id="5935431">int</span><span class="op" id="5935434">)</span>&nbsp;<span class="op" id="5935436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935439">markerlen</span>&nbsp;<span class="op" id="5935449">:=</span>&nbsp;<span class="num" id="5935452">8</span>&nbsp;<span class="op" id="5935454">+</span>&nbsp;<span class="num" id="5935456">3</span><span class="op" id="5935457">*</span><span class="ident" id="5935458">nComponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935470">e</span><span class="op" id="5935471">.</span><span class="ident" id="5935472">writeMarkerHeader</span><span class="op" id="5935489">(</span><span class="ident" id="5935490">sof0Marker</span><span class="op" id="5935500">,</span>&nbsp;<span class="ident" id="5935502">markerlen</span><span class="op" id="5935511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935514">e</span><span class="op" id="5935515">.</span><span class="ident" id="5935516">buf</span><span class="op" id="5935519">[</span><span class="num" id="5935520">0</span><span class="op" id="5935521">]</span>&nbsp;<span class="op" id="5935523">=</span>&nbsp;<span class="num" id="5935525">8</span>&nbsp;<span class="comment" id="5935527">//&nbsp;8-bit&nbsp;color.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935544">e</span><span class="op" id="5935545">.</span><span class="ident" id="5935546">buf</span><span class="op" id="5935549">[</span><span class="num" id="5935550">1</span><span class="op" id="5935551">]</span>&nbsp;<span class="op" id="5935553">=</span>&nbsp;<span class="builtintype" id="5935555">uint8</span><span class="op" id="5935560">(</span><span class="ident" id="5935561">size</span><span class="op" id="5935565">.</span><span class="ident" id="5935566">Y</span>&nbsp;<span class="op" id="5935568">&gt;&gt;</span>&nbsp;<span class="num" id="5935571">8</span><span class="op" id="5935572">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935575">e</span><span class="op" id="5935576">.</span><span class="ident" id="5935577">buf</span><span class="op" id="5935580">[</span><span class="num" id="5935581">2</span><span class="op" id="5935582">]</span>&nbsp;<span class="op" id="5935584">=</span>&nbsp;<span class="builtintype" id="5935586">uint8</span><span class="op" id="5935591">(</span><span class="ident" id="5935592">size</span><span class="op" id="5935596">.</span><span class="ident" id="5935597">Y</span>&nbsp;<span class="op" id="5935599">&amp;</span>&nbsp;<span class="num" id="5935601">0xff</span><span class="op" id="5935605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935608">e</span><span class="op" id="5935609">.</span><span class="ident" id="5935610">buf</span><span class="op" id="5935613">[</span><span class="num" id="5935614">3</span><span class="op" id="5935615">]</span>&nbsp;<span class="op" id="5935617">=</span>&nbsp;<span class="builtintype" id="5935619">uint8</span><span class="op" id="5935624">(</span><span class="ident" id="5935625">size</span><span class="op" id="5935629">.</span><span class="ident" id="5935630">X</span>&nbsp;<span class="op" id="5935632">&gt;&gt;</span>&nbsp;<span class="num" id="5935635">8</span><span class="op" id="5935636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935639">e</span><span class="op" id="5935640">.</span><span class="ident" id="5935641">buf</span><span class="op" id="5935644">[</span><span class="num" id="5935645">4</span><span class="op" id="5935646">]</span>&nbsp;<span class="op" id="5935648">=</span>&nbsp;<span class="builtintype" id="5935650">uint8</span><span class="op" id="5935655">(</span><span class="ident" id="5935656">size</span><span class="op" id="5935660">.</span><span class="ident" id="5935661">X</span>&nbsp;<span class="op" id="5935663">&amp;</span>&nbsp;<span class="num" id="5935665">0xff</span><span class="op" id="5935669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935672">e</span><span class="op" id="5935673">.</span><span class="ident" id="5935674">buf</span><span class="op" id="5935677">[</span><span class="num" id="5935678">5</span><span class="op" id="5935679">]</span>&nbsp;<span class="op" id="5935681">=</span>&nbsp;<span class="builtintype" id="5935683">uint8</span><span class="op" id="5935688">(</span><span class="ident" id="5935689">nComponent</span><span class="op" id="5935699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5935702">if</span>&nbsp;<span class="ident" id="5935705">nComponent</span>&nbsp;<span class="op" id="5935716">==</span>&nbsp;<span class="num" id="5935719">1</span>&nbsp;<span class="op" id="5935721">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935725">e</span><span class="op" id="5935726">.</span><span class="ident" id="5935727">buf</span><span class="op" id="5935730">[</span><span class="num" id="5935731">6</span><span class="op" id="5935732">]</span>&nbsp;<span class="op" id="5935734">=</span>&nbsp;<span class="num" id="5935736">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5935740">//&nbsp;No&nbsp;subsampling&nbsp;for&nbsp;grayscale&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935781">e</span><span class="op" id="5935782">.</span><span class="ident" id="5935783">buf</span><span class="op" id="5935786">[</span><span class="num" id="5935787">7</span><span class="op" id="5935788">]</span>&nbsp;<span class="op" id="5935790">=</span>&nbsp;<span class="num" id="5935792">0x11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935799">e</span><span class="op" id="5935800">.</span><span class="ident" id="5935801">buf</span><span class="op" id="5935804">[</span><span class="num" id="5935805">8</span><span class="op" id="5935806">]</span>&nbsp;<span class="op" id="5935808">=</span>&nbsp;<span class="num" id="5935810">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5935816">}</span>&nbsp;<span class="keyword" id="5935818">else</span>&nbsp;<span class="op" id="5935823">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5935827">for</span>&nbsp;<span class="ident" id="5935831">i</span>&nbsp;<span class="op" id="5935833">:=</span>&nbsp;<span class="num" id="5935836">0</span><span class="op" id="5935837">;</span>&nbsp;<span class="ident" id="5935839">i</span>&nbsp;<span class="op" id="5935841">&lt;</span>&nbsp;<span class="ident" id="5935843">nComponent</span><span class="op" id="5935853">;</span>&nbsp;<span class="ident" id="5935855">i</span><span class="op" id="5935856">++</span>&nbsp;<span class="op" id="5935859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935864">e</span><span class="op" id="5935865">.</span><span class="ident" id="5935866">buf</span><span class="op" id="5935869">[</span><span class="num" id="5935870">3</span><span class="op" id="5935871">*</span><span class="ident" id="5935872">i</span><span class="op" id="5935873">+</span><span class="num" id="5935874">6</span><span class="op" id="5935875">]</span>&nbsp;<span class="op" id="5935877">=</span>&nbsp;<span class="builtintype" id="5935879">uint8</span><span class="op" id="5935884">(</span><span class="ident" id="5935885">i</span>&nbsp;<span class="op" id="5935887">+</span>&nbsp;<span class="num" id="5935889">1</span><span class="op" id="5935890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5935895">//&nbsp;We&nbsp;use&nbsp;4:2:0&nbsp;chroma&nbsp;subsampling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935934">e</span><span class="op" id="5935935">.</span><span class="ident" id="5935936">buf</span><span class="op" id="5935939">[</span><span class="num" id="5935940">3</span><span class="op" id="5935941">*</span><span class="ident" id="5935942">i</span><span class="op" id="5935943">+</span><span class="num" id="5935944">7</span><span class="op" id="5935945">]</span>&nbsp;<span class="op" id="5935947">=</span>&nbsp;<span class="string" id="5935949">&#34;\x22\x11\x11&#34;</span><span class="op" id="5935963">[</span><span class="ident" id="5935964">i</span><span class="op" id="5935965">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935970">e</span><span class="op" id="5935971">.</span><span class="ident" id="5935972">buf</span><span class="op" id="5935975">[</span><span class="num" id="5935976">3</span><span class="op" id="5935977">*</span><span class="ident" id="5935978">i</span><span class="op" id="5935979">+</span><span class="num" id="5935980">8</span><span class="op" id="5935981">]</span>&nbsp;<span class="op" id="5935983">=</span>&nbsp;<span class="string" id="5935985">&#34;\x00\x01\x01&#34;</span><span class="op" id="5935999">[</span><span class="ident" id="5936000">i</span><span class="op" id="5936001">]</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5936005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5936008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936011">e</span><span class="op" id="5936012">.</span><span class="ident" id="5936013">write</span><span class="op" id="5936018">(</span><span class="ident" id="5936019">e</span><span class="op" id="5936020">.</span><span class="ident" id="5936021">buf</span><span class="op" id="5936024">[</span><span class="op" id="5936025">:</span><span class="num" id="5936026">3</span><span class="op" id="5936027">*</span><span class="op" id="5936028">(</span><span class="ident" id="5936029">nComponent</span><span class="op" id="5936039">-</span><span class="num" id="5936040">1</span><span class="op" id="5936041">)</span><span class="op" id="5936042">+</span><span class="num" id="5936043">9</span><span class="op" id="5936044">]</span><span class="op" id="5936045">)</span><br>
<span class="lineno"></span><span class="op" id="5936047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="comment" id="5936050">//&nbsp;writeDHT&nbsp;writes&nbsp;the&nbsp;Define&nbsp;Huffman&nbsp;Table&nbsp;marker.</span><br>
<span class="lineno"></span><span class="keyword" id="5936102">func</span>&nbsp;<span class="op" id="5936107">(</span><span class="ident" id="5936108">e</span>&nbsp;<span class="op" id="5936110">*</span><span class="ident" id="5936111">encoder</span><span class="op" id="5936118">)</span>&nbsp;<span class="ident" id="5936120">writeDHT</span><span class="op" id="5936128">(</span><span class="ident" id="5936129">nComponent</span>&nbsp;<span class="builtintype" id="5936140">int</span><span class="op" id="5936143">)</span>&nbsp;<span class="op" id="5936145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936148">markerlen</span>&nbsp;<span class="op" id="5936158">:=</span>&nbsp;<span class="num" id="5936161">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936164">specs</span>&nbsp;<span class="op" id="5936170">:=</span>&nbsp;<span class="ident" id="5936173">theHuffmanSpec</span><span class="op" id="5936187">[</span><span class="op" id="5936188">:</span><span class="op" id="5936189">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5936192">if</span>&nbsp;<span class="ident" id="5936195">nComponent</span>&nbsp;<span class="op" id="5936206">==</span>&nbsp;<span class="num" id="5936209">1</span>&nbsp;<span class="op" id="5936211">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5936215">//&nbsp;Drop&nbsp;the&nbsp;Chrominance&nbsp;tables.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936249">specs</span>&nbsp;<span class="op" id="5936255">=</span>&nbsp;<span class="ident" id="5936257">specs</span><span class="op" id="5936262">[</span><span class="op" id="5936263">:</span><span class="num" id="5936264">2</span><span class="op" id="5936265">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5936268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5936271">for</span>&nbsp;<span class="ident" id="5936275">_</span><span class="op" id="5936276">,</span>&nbsp;<span class="ident" id="5936278">s</span>&nbsp;<span class="op" id="5936280">:=</span>&nbsp;<span class="keyword" id="5936283">range</span>&nbsp;<span class="ident" id="5936289">specs</span>&nbsp;<span class="op" id="5936295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936299">markerlen</span>&nbsp;<span class="op" id="5936309">+=</span>&nbsp;<span class="num" id="5936312">1</span>&nbsp;<span class="op" id="5936314">+</span>&nbsp;<span class="num" id="5936316">16</span>&nbsp;<span class="op" id="5936319">+</span>&nbsp;<span class="builtinfunc" id="5936321">len</span><span class="op" id="5936324">(</span><span class="ident" id="5936325">s</span><span class="op" id="5936326">.</span><span class="ident" id="5936327">value</span><span class="op" id="5936332">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5936335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936338">e</span><span class="op" id="5936339">.</span><span class="ident" id="5936340">writeMarkerHeader</span><span class="op" id="5936357">(</span><span class="ident" id="5936358">dhtMarker</span><span class="op" id="5936367">,</span>&nbsp;<span class="ident" id="5936369">markerlen</span><span class="op" id="5936378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5936381">for</span>&nbsp;<span class="ident" id="5936385">i</span><span class="op" id="5936386">,</span>&nbsp;<span class="ident" id="5936388">s</span>&nbsp;<span class="op" id="5936390">:=</span>&nbsp;<span class="keyword" id="5936393">range</span>&nbsp;<span class="ident" id="5936399">specs</span>&nbsp;<span class="op" id="5936405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936409">e</span><span class="op" id="5936410">.</span><span class="ident" id="5936411">writeByte</span><span class="op" id="5936420">(</span><span class="string" id="5936421">&#34;\x00\x10\x01\x11&#34;</span><span class="op" id="5936439">[</span><span class="ident" id="5936440">i</span><span class="op" id="5936441">]</span><span class="op" id="5936442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936446">e</span><span class="op" id="5936447">.</span><span class="ident" id="5936448">write</span><span class="op" id="5936453">(</span><span class="ident" id="5936454">s</span><span class="op" id="5936455">.</span><span class="ident" id="5936456">count</span><span class="op" id="5936461">[</span><span class="op" id="5936462">:</span><span class="op" id="5936463">]</span><span class="op" id="5936464">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936468">e</span><span class="op" id="5936469">.</span><span class="ident" id="5936470">write</span><span class="op" id="5936475">(</span><span class="ident" id="5936476">s</span><span class="op" id="5936477">.</span><span class="ident" id="5936478">value</span><span class="op" id="5936483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5936486">}</span><br>
<span class="lineno"></span><span class="op" id="5936488">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5936491">//&nbsp;writeBlock&nbsp;writes&nbsp;a&nbsp;block&nbsp;of&nbsp;pixel&nbsp;data&nbsp;using&nbsp;the&nbsp;given&nbsp;quantization&nbsp;table,</span><br>
<span class="lineno">360</span><span class="comment" id="5936570">//&nbsp;returning&nbsp;the&nbsp;post-quantized&nbsp;DC&nbsp;value&nbsp;of&nbsp;the&nbsp;DCT-transformed&nbsp;block.&nbsp;b&nbsp;is&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="5936649">//&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order.</span><br>
<span class="lineno"></span><span class="keyword" id="5936681">func</span>&nbsp;<span class="op" id="5936686">(</span><span class="ident" id="5936687">e</span>&nbsp;<span class="op" id="5936689">*</span><span class="ident" id="5936690">encoder</span><span class="op" id="5936697">)</span>&nbsp;<span class="ident" id="5936699">writeBlock</span><span class="op" id="5936709">(</span><span class="ident" id="5936710">b</span>&nbsp;<span class="op" id="5936712">*</span><span class="ident" id="5936713">block</span><span class="op" id="5936718">,</span>&nbsp;<span class="ident" id="5936720">q</span>&nbsp;<span class="ident" id="5936722">quantIndex</span><span class="op" id="5936732">,</span>&nbsp;<span class="ident" id="5936734">prevDC</span>&nbsp;<span class="builtintype" id="5936741">int32</span><span class="op" id="5936746">)</span>&nbsp;<span class="builtintype" id="5936748">int32</span>&nbsp;<span class="op" id="5936754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936757">fdct</span><span class="op" id="5936761">(</span><span class="ident" id="5936762">b</span><span class="op" id="5936763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5936766">//&nbsp;Emit&nbsp;the&nbsp;DC&nbsp;delta.</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936789">dc</span>&nbsp;<span class="op" id="5936792">:=</span>&nbsp;<span class="ident" id="5936795">div</span><span class="op" id="5936798">(</span><span class="ident" id="5936799">b</span><span class="op" id="5936800">[</span><span class="num" id="5936801">0</span><span class="op" id="5936802">]</span><span class="op" id="5936803">,</span>&nbsp;<span class="num" id="5936805">8</span><span class="op" id="5936806">*</span><span class="builtintype" id="5936807">int32</span><span class="op" id="5936812">(</span><span class="ident" id="5936813">e</span><span class="op" id="5936814">.</span><span class="ident" id="5936815">quant</span><span class="op" id="5936820">[</span><span class="ident" id="5936821">q</span><span class="op" id="5936822">]</span><span class="op" id="5936823">[</span><span class="num" id="5936824">0</span><span class="op" id="5936825">]</span><span class="op" id="5936826">)</span><span class="op" id="5936827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936830">e</span><span class="op" id="5936831">.</span><span class="ident" id="5936832">emitHuffRLE</span><span class="op" id="5936843">(</span><span class="ident" id="5936844">huffIndex</span><span class="op" id="5936853">(</span><span class="num" id="5936854">2</span><span class="op" id="5936855">*</span><span class="ident" id="5936856">q</span><span class="op" id="5936857">+</span><span class="num" id="5936858">0</span><span class="op" id="5936859">)</span><span class="op" id="5936860">,</span>&nbsp;<span class="num" id="5936862">0</span><span class="op" id="5936863">,</span>&nbsp;<span class="ident" id="5936865">dc</span><span class="op" id="5936867">-</span><span class="ident" id="5936868">prevDC</span><span class="op" id="5936874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5936877">//&nbsp;Emit&nbsp;the&nbsp;AC&nbsp;components.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936905">h</span><span class="op" id="5936906">,</span>&nbsp;<span class="ident" id="5936908">runLength</span>&nbsp;<span class="op" id="5936918">:=</span>&nbsp;<span class="ident" id="5936921">huffIndex</span><span class="op" id="5936930">(</span><span class="num" id="5936931">2</span><span class="op" id="5936932">*</span><span class="ident" id="5936933">q</span><span class="op" id="5936934">+</span><span class="num" id="5936935">1</span><span class="op" id="5936936">)</span><span class="op" id="5936937">,</span>&nbsp;<span class="builtintype" id="5936939">int32</span><span class="op" id="5936944">(</span><span class="num" id="5936945">0</span><span class="op" id="5936946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5936949">for</span>&nbsp;<span class="ident" id="5936953">zig</span>&nbsp;<span class="op" id="5936957">:=</span>&nbsp;<span class="num" id="5936960">1</span><span class="op" id="5936961">;</span>&nbsp;<span class="ident" id="5936963">zig</span>&nbsp;<span class="op" id="5936967">&lt;</span>&nbsp;<span class="ident" id="5936969">blockSize</span><span class="op" id="5936978">;</span>&nbsp;<span class="ident" id="5936980">zig</span><span class="op" id="5936983">++</span>&nbsp;<span class="op" id="5936986">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936990">ac</span>&nbsp;<span class="op" id="5936993">:=</span>&nbsp;<span class="ident" id="5936996">div</span><span class="op" id="5936999">(</span><span class="ident" id="5937000">b</span><span class="op" id="5937001">[</span><span class="ident" id="5937002">unzig</span><span class="op" id="5937007">[</span><span class="ident" id="5937008">zig</span><span class="op" id="5937011">]</span><span class="op" id="5937012">]</span><span class="op" id="5937013">,</span>&nbsp;<span class="num" id="5937015">8</span><span class="op" id="5937016">*</span><span class="builtintype" id="5937017">int32</span><span class="op" id="5937022">(</span><span class="ident" id="5937023">e</span><span class="op" id="5937024">.</span><span class="ident" id="5937025">quant</span><span class="op" id="5937030">[</span><span class="ident" id="5937031">q</span><span class="op" id="5937032">]</span><span class="op" id="5937033">[</span><span class="ident" id="5937034">zig</span><span class="op" id="5937037">]</span><span class="op" id="5937038">)</span><span class="op" id="5937039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5937043">if</span>&nbsp;<span class="ident" id="5937046">ac</span>&nbsp;<span class="op" id="5937049">==</span>&nbsp;<span class="num" id="5937052">0</span>&nbsp;<span class="op" id="5937054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937059">runLength</span><span class="op" id="5937068">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5937073">}</span>&nbsp;<span class="keyword" id="5937075">else</span>&nbsp;<span class="op" id="5937080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5937085">for</span>&nbsp;<span class="ident" id="5937089">runLength</span>&nbsp;<span class="op" id="5937099">&gt;</span>&nbsp;<span class="num" id="5937101">15</span>&nbsp;<span class="op" id="5937104">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937110">e</span><span class="op" id="5937111">.</span><span class="ident" id="5937112">emitHuff</span><span class="op" id="5937120">(</span><span class="ident" id="5937121">h</span><span class="op" id="5937122">,</span>&nbsp;<span class="num" id="5937124">0xf0</span><span class="op" id="5937128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937134">runLength</span>&nbsp;<span class="op" id="5937144">-=</span>&nbsp;<span class="num" id="5937147">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5937153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937158">e</span><span class="op" id="5937159">.</span><span class="ident" id="5937160">emitHuffRLE</span><span class="op" id="5937171">(</span><span class="ident" id="5937172">h</span><span class="op" id="5937173">,</span>&nbsp;<span class="ident" id="5937175">runLength</span><span class="op" id="5937184">,</span>&nbsp;<span class="ident" id="5937186">ac</span><span class="op" id="5937188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937193">runLength</span>&nbsp;<span class="op" id="5937203">=</span>&nbsp;<span class="num" id="5937205">0</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5937209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5937212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5937215">if</span>&nbsp;<span class="ident" id="5937218">runLength</span>&nbsp;<span class="op" id="5937228">&gt;</span>&nbsp;<span class="num" id="5937230">0</span>&nbsp;<span class="op" id="5937232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937236">e</span><span class="op" id="5937237">.</span><span class="ident" id="5937238">emitHuff</span><span class="op" id="5937246">(</span><span class="ident" id="5937247">h</span><span class="op" id="5937248">,</span>&nbsp;<span class="num" id="5937250">0x00</span><span class="op" id="5937254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5937257">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5937260">return</span>&nbsp;<span class="ident" id="5937267">dc</span><br>
<span class="lineno"></span><span class="op" id="5937270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5937273">//&nbsp;toYCbCr&nbsp;converts&nbsp;the&nbsp;8x8&nbsp;region&nbsp;of&nbsp;m&nbsp;whose&nbsp;top-left&nbsp;corner&nbsp;is&nbsp;p&nbsp;to&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="5937347">//&nbsp;YCbCr&nbsp;values.</span><br>
<span class="lineno">390</span><span class="keyword" id="5937364">func</span>&nbsp;<span class="ident" id="5937369">toYCbCr</span><span class="op" id="5937376">(</span><span class="ident" id="5937377">m</span>&nbsp;<span class="ident" id="5937379">image</span><span class="op" id="5937384">.</span><span class="ident" id="5937385">Image</span><span class="op" id="5937390">,</span>&nbsp;<span class="ident" id="5937392">p</span>&nbsp;<span class="ident" id="5937394">image</span><span class="op" id="5937399">.</span><span class="ident" id="5937400">Point</span><span class="op" id="5937405">,</span>&nbsp;<span class="ident" id="5937407">yBlock</span><span class="op" id="5937413">,</span>&nbsp;<span class="ident" id="5937415">cbBlock</span><span class="op" id="5937422">,</span>&nbsp;<span class="ident" id="5937424">crBlock</span>&nbsp;<span class="op" id="5937432">*</span><span class="ident" id="5937433">block</span><span class="op" id="5937438">)</span>&nbsp;<span class="op" id="5937440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937443">b</span>&nbsp;<span class="op" id="5937445">:=</span>&nbsp;<span class="ident" id="5937448">m</span><span class="op" id="5937449">.</span><span class="ident" id="5937450">Bounds</span><span class="op" id="5937456">(</span><span class="op" id="5937457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937460">xmax</span>&nbsp;<span class="op" id="5937465">:=</span>&nbsp;<span class="ident" id="5937468">b</span><span class="op" id="5937469">.</span><span class="ident" id="5937470">Max</span><span class="op" id="5937473">.</span><span class="ident" id="5937474">X</span>&nbsp;<span class="op" id="5937476">-</span>&nbsp;<span class="num" id="5937478">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937481">ymax</span>&nbsp;<span class="op" id="5937486">:=</span>&nbsp;<span class="ident" id="5937489">b</span><span class="op" id="5937490">.</span><span class="ident" id="5937491">Max</span><span class="op" id="5937494">.</span><span class="ident" id="5937495">Y</span>&nbsp;<span class="op" id="5937497">-</span>&nbsp;<span class="num" id="5937499">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5937502">for</span>&nbsp;<span class="ident" id="5937506">j</span>&nbsp;<span class="op" id="5937508">:=</span>&nbsp;<span class="num" id="5937511">0</span><span class="op" id="5937512">;</span>&nbsp;<span class="ident" id="5937514">j</span>&nbsp;<span class="op" id="5937516">&lt;</span>&nbsp;<span class="num" id="5937518">8</span><span class="op" id="5937519">;</span>&nbsp;<span class="ident" id="5937521">j</span><span class="op" id="5937522">++</span>&nbsp;<span class="op" id="5937525">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5937529">for</span>&nbsp;<span class="ident" id="5937533">i</span>&nbsp;<span class="op" id="5937535">:=</span>&nbsp;<span class="num" id="5937538">0</span><span class="op" id="5937539">;</span>&nbsp;<span class="ident" id="5937541">i</span>&nbsp;<span class="op" id="5937543">&lt;</span>&nbsp;<span class="num" id="5937545">8</span><span class="op" id="5937546">;</span>&nbsp;<span class="ident" id="5937548">i</span><span class="op" id="5937549">++</span>&nbsp;<span class="op" id="5937552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937557">r</span><span class="op" id="5937558">,</span>&nbsp;<span class="ident" id="5937560">g</span><span class="op" id="5937561">,</span>&nbsp;<span class="ident" id="5937563">b</span><span class="op" id="5937564">,</span>&nbsp;<span class="ident" id="5937566">_</span>&nbsp;<span class="op" id="5937568">:=</span>&nbsp;<span class="ident" id="5937571">m</span><span class="op" id="5937572">.</span><span class="ident" id="5937573">At</span><span class="op" id="5937575">(</span><span class="ident" id="5937576">min</span><span class="op" id="5937579">(</span><span class="ident" id="5937580">p</span><span class="op" id="5937581">.</span><span class="ident" id="5937582">X</span><span class="op" id="5937583">+</span><span class="ident" id="5937584">i</span><span class="op" id="5937585">,</span>&nbsp;<span class="ident" id="5937587">xmax</span><span class="op" id="5937591">)</span><span class="op" id="5937592">,</span>&nbsp;<span class="ident" id="5937594">min</span><span class="op" id="5937597">(</span><span class="ident" id="5937598">p</span><span class="op" id="5937599">.</span><span class="ident" id="5937600">Y</span><span class="op" id="5937601">+</span><span class="ident" id="5937602">j</span><span class="op" id="5937603">,</span>&nbsp;<span class="ident" id="5937605">ymax</span><span class="op" id="5937609">)</span><span class="op" id="5937610">)</span><span class="op" id="5937611">.</span><span class="ident" id="5937612">RGBA</span><span class="op" id="5937616">(</span><span class="op" id="5937617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937622">yy</span><span class="op" id="5937624">,</span>&nbsp;<span class="ident" id="5937626">cb</span><span class="op" id="5937628">,</span>&nbsp;<span class="ident" id="5937630">cr</span>&nbsp;<span class="op" id="5937633">:=</span>&nbsp;<span class="ident" id="5937636">color</span><span class="op" id="5937641">.</span><span class="ident" id="5937642">RGBToYCbCr</span><span class="op" id="5937652">(</span><span class="builtintype" id="5937653">uint8</span><span class="op" id="5937658">(</span><span class="ident" id="5937659">r</span><span class="op" id="5937660">&gt;&gt;</span><span class="num" id="5937662">8</span><span class="op" id="5937663">)</span><span class="op" id="5937664">,</span>&nbsp;<span class="builtintype" id="5937666">uint8</span><span class="op" id="5937671">(</span><span class="ident" id="5937672">g</span><span class="op" id="5937673">&gt;&gt;</span><span class="num" id="5937675">8</span><span class="op" id="5937676">)</span><span class="op" id="5937677">,</span>&nbsp;<span class="builtintype" id="5937679">uint8</span><span class="op" id="5937684">(</span><span class="ident" id="5937685">b</span><span class="op" id="5937686">&gt;&gt;</span><span class="num" id="5937688">8</span><span class="op" id="5937689">)</span><span class="op" id="5937690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937695">yBlock</span><span class="op" id="5937701">[</span><span class="num" id="5937702">8</span><span class="op" id="5937703">*</span><span class="ident" id="5937704">j</span><span class="op" id="5937705">+</span><span class="ident" id="5937706">i</span><span class="op" id="5937707">]</span>&nbsp;<span class="op" id="5937709">=</span>&nbsp;<span class="builtintype" id="5937711">int32</span><span class="op" id="5937716">(</span><span class="ident" id="5937717">yy</span><span class="op" id="5937719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937724">cbBlock</span><span class="op" id="5937731">[</span><span class="num" id="5937732">8</span><span class="op" id="5937733">*</span><span class="ident" id="5937734">j</span><span class="op" id="5937735">+</span><span class="ident" id="5937736">i</span><span class="op" id="5937737">]</span>&nbsp;<span class="op" id="5937739">=</span>&nbsp;<span class="builtintype" id="5937741">int32</span><span class="op" id="5937746">(</span><span class="ident" id="5937747">cb</span><span class="op" id="5937749">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937754">crBlock</span><span class="op" id="5937761">[</span><span class="num" id="5937762">8</span><span class="op" id="5937763">*</span><span class="ident" id="5937764">j</span><span class="op" id="5937765">+</span><span class="ident" id="5937766">i</span><span class="op" id="5937767">]</span>&nbsp;<span class="op" id="5937769">=</span>&nbsp;<span class="builtintype" id="5937771">int32</span><span class="op" id="5937776">(</span><span class="ident" id="5937777">cr</span><span class="op" id="5937779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5937783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5937786">}</span><br>
<span class="lineno"></span><span class="op" id="5937788">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span><span class="comment" id="5937791">//&nbsp;grayToY&nbsp;stores&nbsp;the&nbsp;8x8&nbsp;region&nbsp;of&nbsp;m&nbsp;whose&nbsp;top-left&nbsp;corner&nbsp;is&nbsp;p&nbsp;in&nbsp;yBlock.</span><br>
<span class="lineno"></span><span class="keyword" id="5937867">func</span>&nbsp;<span class="ident" id="5937872">grayToY</span><span class="op" id="5937879">(</span><span class="ident" id="5937880">m</span>&nbsp;<span class="op" id="5937882">*</span><span class="ident" id="5937883">image</span><span class="op" id="5937888">.</span><span class="ident" id="5937889">Gray</span><span class="op" id="5937893">,</span>&nbsp;<span class="ident" id="5937895">p</span>&nbsp;<span class="ident" id="5937897">image</span><span class="op" id="5937902">.</span><span class="ident" id="5937903">Point</span><span class="op" id="5937908">,</span>&nbsp;<span class="ident" id="5937910">yBlock</span>&nbsp;<span class="op" id="5937917">*</span><span class="ident" id="5937918">block</span><span class="op" id="5937923">)</span>&nbsp;<span class="op" id="5937925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937928">b</span>&nbsp;<span class="op" id="5937930">:=</span>&nbsp;<span class="ident" id="5937933">m</span><span class="op" id="5937934">.</span><span class="ident" id="5937935">Bounds</span><span class="op" id="5937941">(</span><span class="op" id="5937942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937945">xmax</span>&nbsp;<span class="op" id="5937950">:=</span>&nbsp;<span class="ident" id="5937953">b</span><span class="op" id="5937954">.</span><span class="ident" id="5937955">Max</span><span class="op" id="5937958">.</span><span class="ident" id="5937959">X</span>&nbsp;<span class="op" id="5937961">-</span>&nbsp;<span class="num" id="5937963">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937966">ymax</span>&nbsp;<span class="op" id="5937971">:=</span>&nbsp;<span class="ident" id="5937974">b</span><span class="op" id="5937975">.</span><span class="ident" id="5937976">Max</span><span class="op" id="5937979">.</span><span class="ident" id="5937980">Y</span>&nbsp;<span class="op" id="5937982">-</span>&nbsp;<span class="num" id="5937984">1</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937987">pix</span>&nbsp;<span class="op" id="5937991">:=</span>&nbsp;<span class="ident" id="5937994">m</span><span class="op" id="5937995">.</span><span class="ident" id="5937996">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5938001">for</span>&nbsp;<span class="ident" id="5938005">j</span>&nbsp;<span class="op" id="5938007">:=</span>&nbsp;<span class="num" id="5938010">0</span><span class="op" id="5938011">;</span>&nbsp;<span class="ident" id="5938013">j</span>&nbsp;<span class="op" id="5938015">&lt;</span>&nbsp;<span class="num" id="5938017">8</span><span class="op" id="5938018">;</span>&nbsp;<span class="ident" id="5938020">j</span><span class="op" id="5938021">++</span>&nbsp;<span class="op" id="5938024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5938028">for</span>&nbsp;<span class="ident" id="5938032">i</span>&nbsp;<span class="op" id="5938034">:=</span>&nbsp;<span class="num" id="5938037">0</span><span class="op" id="5938038">;</span>&nbsp;<span class="ident" id="5938040">i</span>&nbsp;<span class="op" id="5938042">&lt;</span>&nbsp;<span class="num" id="5938044">8</span><span class="op" id="5938045">;</span>&nbsp;<span class="ident" id="5938047">i</span><span class="op" id="5938048">++</span>&nbsp;<span class="op" id="5938051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5938056">idx</span>&nbsp;<span class="op" id="5938060">:=</span>&nbsp;<span class="ident" id="5938063">m</span><span class="op" id="5938064">.</span><span class="ident" id="5938065">PixOffset</span><span class="op" id="5938074">(</span><span class="ident" id="5938075">min</span><span class="op" id="5938078">(</span><span class="ident" id="5938079">p</span><span class="op" id="5938080">.</span><span class="ident" id="5938081">X</span><span class="op" id="5938082">+</span><span class="ident" id="5938083">i</span><span class="op" id="5938084">,</span>&nbsp;<span class="ident" id="5938086">xmax</span><span class="op" id="5938090">)</span><span class="op" id="5938091">,</span>&nbsp;<span class="ident" id="5938093">min</span><span class="op" id="5938096">(</span><span class="ident" id="5938097">p</span><span class="op" id="5938098">.</span><span class="ident" id="5938099">Y</span><span class="op" id="5938100">+</span><span class="ident" id="5938101">j</span><span class="op" id="5938102">,</span>&nbsp;<span class="ident" id="5938104">ymax</span><span class="op" id="5938108">)</span><span class="op" id="5938109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5938114">yBlock</span><span class="op" id="5938120">[</span><span class="num" id="5938121">8</span><span class="op" id="5938122">*</span><span class="ident" id="5938123">j</span><span class="op" id="5938124">+</span><span class="ident" id="5938125">i</span><span class="op" id="5938126">]</span>&nbsp;<span class="op" id="5938128">=</span>&nbsp;<span class="builtintype" id="5938130">int32</span><span class="op" id="5938135">(</span><span class="ident" id="5938136">pix</span><span class="op" id="5938139">[</span><span class="ident" id="5938140">idx</span><span class="op" id="5938143">]</span><span class="op" id="5938144">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5938148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5938151">}</span><br>
<span class="lineno"></span><span class="op" id="5938153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5938156">//&nbsp;rgbaToYCbCr&nbsp;is&nbsp;a&nbsp;specialized&nbsp;version&nbsp;of&nbsp;toYCbCr&nbsp;for&nbsp;image.RGBA&nbsp;images.</span><br>
<span class="lineno">420</span><span class="keyword" id="5938230">func</span>&nbsp;<span class="ident" id="5938235">rgbaToYCbCr</span><span class="op" id="5938246">(</span><span class="ident" id="5938247">m</span>&nbsp;<span class="op" id="5938249">*</span><span class="ident" id="5938250">image</span><span class="op" id="5938255">.</span><span class="ident" id="5938256">RGBA</span><span class="op" id="5938260">,</span>&nbsp;<span class="ident" id="5938262">p</span>&nbsp;<span class="ident" id="5938264">image</span><span class="op" id="5938269">.</span><span class="ident" id="5938270">Point</span><span class="op" id="5938275">,</span>&nbsp;<span class="ident" id="5938277">yBlock</span><span class="op" id="5938283">,</span>&nbsp;<span class="ident" id="5938285">cbBlock</span><span class="op" id="5938292">,</span>&nbsp;<span class="ident" id="5938294">crBlock</span>&nbsp;<span class="op" id="5938302">*</span><span class="ident" id="5938303">block</span><span class="op" id="5938308">)</span>&nbsp;<span class="op" id="5938310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5938313">b</span>&nbsp;<span class="op" id="5938315">:=</span>&nbsp;<span class="ident" id="5938318">m</span><span class="op" id="5938319">.</span><span class="ident" id="5938320">Bounds</span><span class="op" id="5938326">(</span><span class="op" id="5938327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5938330">xmax</span>&nbsp;<span class="op" id="5938335">:=</span>&nbsp;<span class="ident" id="5938338">b</span><span class="op" id="5938339">.</span><span class="ident" id="5938340">Max</span><span class="op" id="5938343">.</span><span class="ident" id="5938344">X</span>&nbsp;<span class="op" id="5938346">-</span>&nbsp;<span class="num" id="5938348">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5938351">ymax</span>&nbsp;<span class="op" id="5938356">:=</span>&nbsp;<span class="ident" id="5938359">b</span><span class="op" id="5938360">.</span><span class="ident" id="5938361">Max</span><span class="op" id="5938364">.</span><span class="ident" id="5938365">Y</span>&nbsp;<span class="op" id="5938367">-</span>&nbsp;<span class="num" id="5938369">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5938372">for</span>&nbsp;<span class="ident" id="5938376">j</span>&nbsp;<span class="op" id="5938378">:=</span>&nbsp;<span class="num" id="5938381">0</span><span class="op" id="5938382">;</span>&nbsp;<span class="ident" id="5938384">j</span>&nbsp;<span class="op" id="5938386">&lt;</span>&nbsp;<span class="num" id="5938388">8</span><span class="op" id="5938389">;</span>&nbsp;<span class="ident" id="5938391">j</span><span class="op" id="5938392">++</span>&nbsp;<span class="op" id="5938395">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5938399">sj</span>&nbsp;<span class="op" id="5938402">:=</span>&nbsp;<span class="ident" id="5938405">p</span><span class="op" id="5938406">.</span><span class="ident" id="5938407">Y</span>&nbsp;<span class="op" id="5938409">+</span>&nbsp;<span class="ident" id="5938411">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5938415">if</span>&nbsp;<span class="ident" id="5938418">sj</span>&nbsp;<span class="op" id="5938421">&gt;</span>&nbsp;<span class="ident" id="5938423">ymax</span>&nbsp;<span class="op" id="5938428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5938433">sj</span>&nbsp;<span class="op" id="5938436">=</span>&nbsp;<span class="ident" id="5938438">ymax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5938445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5938449">offset</span>&nbsp;<span class="op" id="5938456">:=</span>&nbsp;<span class="op" id="5938459">(</span><span class="ident" id="5938460">sj</span><span class="op" id="5938462">-</span><span class="ident" id="5938463">b</span><span class="op" id="5938464">.</span><span class="ident" id="5938465">Min</span><span class="op" id="5938468">.</span><span class="ident" id="5938469">Y</span><span class="op" id="5938470">)</span><span class="op" id="5938471">*</span><span class="ident" id="5938472">m</span><span class="op" id="5938473">.</span><span class="ident" id="5938474">Stride</span>&nbsp;<span class="op" id="5938481">-</span>&nbsp;<span class="ident" id="5938483">b</span><span class="op" id="5938484">.</span><span class="ident" id="5938485">Min</span><span class="op" id="5938488">.</span><span class="ident" id="5938489">X</span><span class="op" id="5938490">*</span><span class="num" id="5938491">4</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5938495">for</span>&nbsp;<span class="ident" id="5938499">i</span>&nbsp;<span class="op" id="5938501">:=</span>&nbsp;<span class="num" id="5938504">0</span><span class="op" id="5938505">;</span>&nbsp;<span class="ident" id="5938507">i</span>&nbsp;<span class="op" id="5938509">&lt;</span>&nbsp;<span class="num" id="5938511">8</span><span class="op" id="5938512">;</span>&nbsp;<span class="ident" id="5938514">i</span><span class="op" id="5938515">++</span>&nbsp;<span class="op" id="5938518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5938523">sx</span>&nbsp;<span class="op" id="5938526">:=</span>&nbsp;<span class="ident" id="5938529">p</span><span class="op" id="5938530">.</span><span class="ident" id="5938531">X</span>&nbsp;<span class="op" id="5938533">+</span>&nbsp;<span class="ident" id="5938535">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5938540">if</span>&nbsp;<span class="ident" id="5938543">sx</span>&nbsp;<span class="op" id="5938546">&gt;</span>&nbsp;<span class="ident" id="5938548">xmax</span>&nbsp;<span class="op" id="5938553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5938559">sx</span>&nbsp;<span class="op" id="5938562">=</span>&nbsp;<span class="ident" id="5938564">xmax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5938572">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5938577">pix</span>&nbsp;<span class="op" id="5938581">:=</span>&nbsp;<span class="ident" id="5938584">m</span><span class="op" id="5938585">.</span><span class="ident" id="5938586">Pix</span><span class="op" id="5938589">[</span><span class="ident" id="5938590">offset</span><span class="op" id="5938596">+</span><span class="ident" id="5938597">sx</span><span class="op" id="5938599">*</span><span class="num" id="5938600">4</span><span class="op" id="5938601">:</span><span class="op" id="5938602">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5938607">yy</span><span class="op" id="5938609">,</span>&nbsp;<span class="ident" id="5938611">cb</span><span class="op" id="5938613">,</span>&nbsp;<span class="ident" id="5938615">cr</span>&nbsp;<span class="op" id="5938618">:=</span>&nbsp;<span class="ident" id="5938621">color</span><span class="op" id="5938626">.</span><span class="ident" id="5938627">RGBToYCbCr</span><span class="op" id="5938637">(</span><span class="ident" id="5938638">pix</span><span class="op" id="5938641">[</span><span class="num" id="5938642">0</span><span class="op" id="5938643">]</span><span class="op" id="5938644">,</span>&nbsp;<span class="ident" id="5938646">pix</span><span class="op" id="5938649">[</span><span class="num" id="5938650">1</span><span class="op" id="5938651">]</span><span class="op" id="5938652">,</span>&nbsp;<span class="ident" id="5938654">pix</span><span class="op" id="5938657">[</span><span class="num" id="5938658">2</span><span class="op" id="5938659">]</span><span class="op" id="5938660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5938665">yBlock</span><span class="op" id="5938671">[</span><span class="num" id="5938672">8</span><span class="op" id="5938673">*</span><span class="ident" id="5938674">j</span><span class="op" id="5938675">+</span><span class="ident" id="5938676">i</span><span class="op" id="5938677">]</span>&nbsp;<span class="op" id="5938679">=</span>&nbsp;<span class="builtintype" id="5938681">int32</span><span class="op" id="5938686">(</span><span class="ident" id="5938687">yy</span><span class="op" id="5938689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5938694">cbBlock</span><span class="op" id="5938701">[</span><span class="num" id="5938702">8</span><span class="op" id="5938703">*</span><span class="ident" id="5938704">j</span><span class="op" id="5938705">+</span><span class="ident" id="5938706">i</span><span class="op" id="5938707">]</span>&nbsp;<span class="op" id="5938709">=</span>&nbsp;<span class="builtintype" id="5938711">int32</span><span class="op" id="5938716">(</span><span class="ident" id="5938717">cb</span><span class="op" id="5938719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5938724">crBlock</span><span class="op" id="5938731">[</span><span class="num" id="5938732">8</span><span class="op" id="5938733">*</span><span class="ident" id="5938734">j</span><span class="op" id="5938735">+</span><span class="ident" id="5938736">i</span><span class="op" id="5938737">]</span>&nbsp;<span class="op" id="5938739">=</span>&nbsp;<span class="builtintype" id="5938741">int32</span><span class="op" id="5938746">(</span><span class="ident" id="5938747">cr</span><span class="op" id="5938749">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5938753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5938756">}</span><br>
<span class="lineno"></span><span class="op" id="5938758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5938761">//&nbsp;scale&nbsp;scales&nbsp;the&nbsp;16x16&nbsp;region&nbsp;represented&nbsp;by&nbsp;the&nbsp;4&nbsp;src&nbsp;blocks&nbsp;to&nbsp;the&nbsp;8x8</span><br>
<span class="lineno">445</span><span class="comment" id="5938837">//&nbsp;dst&nbsp;block.</span><br>
<span class="lineno"></span><span class="keyword" id="5938851">func</span>&nbsp;<span class="ident" id="5938856">scale</span><span class="op" id="5938861">(</span><span class="ident" id="5938862">dst</span>&nbsp;<span class="op" id="5938866">*</span><span class="ident" id="5938867">block</span><span class="op" id="5938872">,</span>&nbsp;<span class="ident" id="5938874">src</span>&nbsp;<span class="op" id="5938878">*</span><span class="op" id="5938879">[</span><span class="num" id="5938880">4</span><span class="op" id="5938881">]</span><span class="ident" id="5938882">block</span><span class="op" id="5938887">)</span>&nbsp;<span class="op" id="5938889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5938892">for</span>&nbsp;<span class="ident" id="5938896">i</span>&nbsp;<span class="op" id="5938898">:=</span>&nbsp;<span class="num" id="5938901">0</span><span class="op" id="5938902">;</span>&nbsp;<span class="ident" id="5938904">i</span>&nbsp;<span class="op" id="5938906">&lt;</span>&nbsp;<span class="num" id="5938908">4</span><span class="op" id="5938909">;</span>&nbsp;<span class="ident" id="5938911">i</span><span class="op" id="5938912">++</span>&nbsp;<span class="op" id="5938915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5938919">dstOff</span>&nbsp;<span class="op" id="5938926">:=</span>&nbsp;<span class="op" id="5938929">(</span><span class="ident" id="5938930">i</span><span class="op" id="5938931">&amp;</span><span class="num" id="5938932">2</span><span class="op" id="5938933">)</span><span class="op" id="5938934">&lt;&lt;</span><span class="num" id="5938936">4</span>&nbsp;<span class="op" id="5938938">|</span>&nbsp;<span class="op" id="5938940">(</span><span class="ident" id="5938941">i</span><span class="op" id="5938942">&amp;</span><span class="num" id="5938943">1</span><span class="op" id="5938944">)</span><span class="op" id="5938945">&lt;&lt;</span><span class="num" id="5938947">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5938951">for</span>&nbsp;<span class="ident" id="5938955">y</span>&nbsp;<span class="op" id="5938957">:=</span>&nbsp;<span class="num" id="5938960">0</span><span class="op" id="5938961">;</span>&nbsp;<span class="ident" id="5938963">y</span>&nbsp;<span class="op" id="5938965">&lt;</span>&nbsp;<span class="num" id="5938967">4</span><span class="op" id="5938968">;</span>&nbsp;<span class="ident" id="5938970">y</span><span class="op" id="5938971">++</span>&nbsp;<span class="op" id="5938974">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5938979">for</span>&nbsp;<span class="ident" id="5938983">x</span>&nbsp;<span class="op" id="5938985">:=</span>&nbsp;<span class="num" id="5938988">0</span><span class="op" id="5938989">;</span>&nbsp;<span class="ident" id="5938991">x</span>&nbsp;<span class="op" id="5938993">&lt;</span>&nbsp;<span class="num" id="5938995">4</span><span class="op" id="5938996">;</span>&nbsp;<span class="ident" id="5938998">x</span><span class="op" id="5938999">++</span>&nbsp;<span class="op" id="5939002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5939008">j</span>&nbsp;<span class="op" id="5939010">:=</span>&nbsp;<span class="num" id="5939013">16</span><span class="op" id="5939015">*</span><span class="ident" id="5939016">y</span>&nbsp;<span class="op" id="5939018">+</span>&nbsp;<span class="num" id="5939020">2</span><span class="op" id="5939021">*</span><span class="ident" id="5939022">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5939028">sum</span>&nbsp;<span class="op" id="5939032">:=</span>&nbsp;<span class="ident" id="5939035">src</span><span class="op" id="5939038">[</span><span class="ident" id="5939039">i</span><span class="op" id="5939040">]</span><span class="op" id="5939041">[</span><span class="ident" id="5939042">j</span><span class="op" id="5939043">]</span>&nbsp;<span class="op" id="5939045">+</span>&nbsp;<span class="ident" id="5939047">src</span><span class="op" id="5939050">[</span><span class="ident" id="5939051">i</span><span class="op" id="5939052">]</span><span class="op" id="5939053">[</span><span class="ident" id="5939054">j</span><span class="op" id="5939055">+</span><span class="num" id="5939056">1</span><span class="op" id="5939057">]</span>&nbsp;<span class="op" id="5939059">+</span>&nbsp;<span class="ident" id="5939061">src</span><span class="op" id="5939064">[</span><span class="ident" id="5939065">i</span><span class="op" id="5939066">]</span><span class="op" id="5939067">[</span><span class="ident" id="5939068">j</span><span class="op" id="5939069">+</span><span class="num" id="5939070">8</span><span class="op" id="5939071">]</span>&nbsp;<span class="op" id="5939073">+</span>&nbsp;<span class="ident" id="5939075">src</span><span class="op" id="5939078">[</span><span class="ident" id="5939079">i</span><span class="op" id="5939080">]</span><span class="op" id="5939081">[</span><span class="ident" id="5939082">j</span><span class="op" id="5939083">+</span><span class="num" id="5939084">9</span><span class="op" id="5939085">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5939091">dst</span><span class="op" id="5939094">[</span><span class="num" id="5939095">8</span><span class="op" id="5939096">*</span><span class="ident" id="5939097">y</span><span class="op" id="5939098">+</span><span class="ident" id="5939099">x</span><span class="op" id="5939100">+</span><span class="ident" id="5939101">dstOff</span><span class="op" id="5939107">]</span>&nbsp;<span class="op" id="5939109">=</span>&nbsp;<span class="op" id="5939111">(</span><span class="ident" id="5939112">sum</span>&nbsp;<span class="op" id="5939116">+</span>&nbsp;<span class="num" id="5939118">2</span><span class="op" id="5939119">)</span>&nbsp;<span class="op" id="5939121">&gt;&gt;</span>&nbsp;<span class="num" id="5939124">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5939129">}</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5939133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5939136">}</span><br>
<span class="lineno"></span><span class="op" id="5939138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5939141">//&nbsp;sosHeaderY&nbsp;is&nbsp;the&nbsp;SOS&nbsp;marker&nbsp;&#34;\xff\xda&#34;&nbsp;followed&nbsp;by&nbsp;8&nbsp;bytes:</span><br>
<span class="lineno">460</span><span class="comment" id="5939205">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;marker&nbsp;length&nbsp;&#34;\x00\x08&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5939240">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;number&nbsp;of&nbsp;components&nbsp;&#34;\x01&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5939278">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;component&nbsp;1&nbsp;uses&nbsp;DC&nbsp;table&nbsp;0&nbsp;and&nbsp;AC&nbsp;table&nbsp;0&nbsp;&#34;\x01\x00&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5939338">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;bytes&nbsp;&#34;\x00\x3f\x00&#34;.&nbsp;Section&nbsp;B.2.3&nbsp;of&nbsp;the&nbsp;spec&nbsp;says&nbsp;that&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5939409">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;sequential&nbsp;DCTs,&nbsp;those&nbsp;bytes&nbsp;(8-bit&nbsp;Ss,&nbsp;8-bit&nbsp;Se,&nbsp;4-bit&nbsp;Ah,&nbsp;4-bit&nbsp;Al)</span><br>
<span class="lineno">465</span><span class="comment" id="5939484">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;should&nbsp;be&nbsp;0x00,&nbsp;0x3f,&nbsp;0x00&lt;&lt;4&nbsp;|&nbsp;0x00.</span><br>
<span class="lineno"></span><span class="keyword" id="5939527">var</span>&nbsp;<span class="ident" id="5939531">sosHeaderY</span>&nbsp;<span class="op" id="5939542">=</span>&nbsp;<span class="op" id="5939544">[</span><span class="op" id="5939545">]</span><span class="builtintype" id="5939546">byte</span><span class="op" id="5939550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5939553">0xff</span><span class="op" id="5939557">,</span>&nbsp;<span class="num" id="5939559">0xda</span><span class="op" id="5939563">,</span>&nbsp;<span class="num" id="5939565">0x00</span><span class="op" id="5939569">,</span>&nbsp;<span class="num" id="5939571">0x08</span><span class="op" id="5939575">,</span>&nbsp;<span class="num" id="5939577">0x01</span><span class="op" id="5939581">,</span>&nbsp;<span class="num" id="5939583">0x01</span><span class="op" id="5939587">,</span>&nbsp;<span class="num" id="5939589">0x00</span><span class="op" id="5939593">,</span>&nbsp;<span class="num" id="5939595">0x00</span><span class="op" id="5939599">,</span>&nbsp;<span class="num" id="5939601">0x3f</span><span class="op" id="5939605">,</span>&nbsp;<span class="num" id="5939607">0x00</span><span class="op" id="5939611">,</span><br>
<span class="lineno"></span><span class="op" id="5939613">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span><span class="comment" id="5939616">//&nbsp;sosHeaderYCbCr&nbsp;is&nbsp;the&nbsp;SOS&nbsp;marker&nbsp;&#34;\xff\xda&#34;&nbsp;followed&nbsp;by&nbsp;12&nbsp;bytes:</span><br>
<span class="lineno"></span><span class="comment" id="5939685">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;marker&nbsp;length&nbsp;&#34;\x00\x0c&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5939720">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;number&nbsp;of&nbsp;components&nbsp;&#34;\x03&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5939758">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;component&nbsp;1&nbsp;uses&nbsp;DC&nbsp;table&nbsp;0&nbsp;and&nbsp;AC&nbsp;table&nbsp;0&nbsp;&#34;\x01\x00&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5939818">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;component&nbsp;2&nbsp;uses&nbsp;DC&nbsp;table&nbsp;1&nbsp;and&nbsp;AC&nbsp;table&nbsp;1&nbsp;&#34;\x02\x11&#34;,</span><br>
<span class="lineno">475</span><span class="comment" id="5939878">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;component&nbsp;3&nbsp;uses&nbsp;DC&nbsp;table&nbsp;1&nbsp;and&nbsp;AC&nbsp;table&nbsp;1&nbsp;&#34;\x03\x11&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5939938">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;bytes&nbsp;&#34;\x00\x3f\x00&#34;.&nbsp;Section&nbsp;B.2.3&nbsp;of&nbsp;the&nbsp;spec&nbsp;says&nbsp;that&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5940009">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;sequential&nbsp;DCTs,&nbsp;those&nbsp;bytes&nbsp;(8-bit&nbsp;Ss,&nbsp;8-bit&nbsp;Se,&nbsp;4-bit&nbsp;Ah,&nbsp;4-bit&nbsp;Al)</span><br>
<span class="lineno"></span><span class="comment" id="5940084">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;should&nbsp;be&nbsp;0x00,&nbsp;0x3f,&nbsp;0x00&lt;&lt;4&nbsp;|&nbsp;0x00.</span><br>
<span class="lineno"></span><span class="keyword" id="5940127">var</span>&nbsp;<span class="ident" id="5940131">sosHeaderYCbCr</span>&nbsp;<span class="op" id="5940146">=</span>&nbsp;<span class="op" id="5940148">[</span><span class="op" id="5940149">]</span><span class="builtintype" id="5940150">byte</span><span class="op" id="5940154">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5940157">0xff</span><span class="op" id="5940161">,</span>&nbsp;<span class="num" id="5940163">0xda</span><span class="op" id="5940167">,</span>&nbsp;<span class="num" id="5940169">0x00</span><span class="op" id="5940173">,</span>&nbsp;<span class="num" id="5940175">0x0c</span><span class="op" id="5940179">,</span>&nbsp;<span class="num" id="5940181">0x03</span><span class="op" id="5940185">,</span>&nbsp;<span class="num" id="5940187">0x01</span><span class="op" id="5940191">,</span>&nbsp;<span class="num" id="5940193">0x00</span><span class="op" id="5940197">,</span>&nbsp;<span class="num" id="5940199">0x02</span><span class="op" id="5940203">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5940206">0x11</span><span class="op" id="5940210">,</span>&nbsp;<span class="num" id="5940212">0x03</span><span class="op" id="5940216">,</span>&nbsp;<span class="num" id="5940218">0x11</span><span class="op" id="5940222">,</span>&nbsp;<span class="num" id="5940224">0x00</span><span class="op" id="5940228">,</span>&nbsp;<span class="num" id="5940230">0x3f</span><span class="op" id="5940234">,</span>&nbsp;<span class="num" id="5940236">0x00</span><span class="op" id="5940240">,</span><br>
<span class="lineno"></span><span class="op" id="5940242">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5940245">//&nbsp;writeSOS&nbsp;writes&nbsp;the&nbsp;StartOfScan&nbsp;marker.</span><br>
<span class="lineno">485</span><span class="keyword" id="5940288">func</span>&nbsp;<span class="op" id="5940293">(</span><span class="ident" id="5940294">e</span>&nbsp;<span class="op" id="5940296">*</span><span class="ident" id="5940297">encoder</span><span class="op" id="5940304">)</span>&nbsp;<span class="ident" id="5940306">writeSOS</span><span class="op" id="5940314">(</span><span class="ident" id="5940315">m</span>&nbsp;<span class="ident" id="5940317">image</span><span class="op" id="5940322">.</span><span class="ident" id="5940323">Image</span><span class="op" id="5940328">)</span>&nbsp;<span class="op" id="5940330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5940333">switch</span>&nbsp;<span class="ident" id="5940340">m</span><span class="op" id="5940341">.</span><span class="op" id="5940342">(</span><span class="keyword" id="5940343">type</span><span class="op" id="5940347">)</span>&nbsp;<span class="op" id="5940349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5940352">case</span>&nbsp;<span class="op" id="5940357">*</span><span class="ident" id="5940358">image</span><span class="op" id="5940363">.</span><span class="ident" id="5940364">Gray</span><span class="op" id="5940368">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5940372">e</span><span class="op" id="5940373">.</span><span class="ident" id="5940374">write</span><span class="op" id="5940379">(</span><span class="ident" id="5940380">sosHeaderY</span><span class="op" id="5940390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5940393">default</span><span class="op" id="5940400">:</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5940404">e</span><span class="op" id="5940405">.</span><span class="ident" id="5940406">write</span><span class="op" id="5940411">(</span><span class="ident" id="5940412">sosHeaderYCbCr</span><span class="op" id="5940426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5940429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5940432">var</span>&nbsp;<span class="op" id="5940436">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5940440">//&nbsp;Scratch&nbsp;buffers&nbsp;to&nbsp;hold&nbsp;the&nbsp;YCbCr&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5940487">//&nbsp;The&nbsp;blocks&nbsp;are&nbsp;in&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5940539">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5940546">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5940554">cb</span><span class="op" id="5940556">,</span>&nbsp;<span class="ident" id="5940558">cr</span>&nbsp;<span class="op" id="5940561">[</span><span class="num" id="5940562">4</span><span class="op" id="5940563">]</span><span class="ident" id="5940564">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5940572">//&nbsp;DC&nbsp;components&nbsp;are&nbsp;delta-encoded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5940610">prevDCY</span><span class="op" id="5940617">,</span>&nbsp;<span class="ident" id="5940619">prevDCCb</span><span class="op" id="5940627">,</span>&nbsp;<span class="ident" id="5940629">prevDCCr</span>&nbsp;<span class="builtintype" id="5940638">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5940645">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5940648">bounds</span>&nbsp;<span class="op" id="5940655">:=</span>&nbsp;<span class="ident" id="5940658">m</span><span class="op" id="5940659">.</span><span class="ident" id="5940660">Bounds</span><span class="op" id="5940666">(</span><span class="op" id="5940667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5940670">switch</span>&nbsp;<span class="ident" id="5940677">m</span>&nbsp;<span class="op" id="5940679">:=</span>&nbsp;<span class="ident" id="5940682">m</span><span class="op" id="5940683">.</span><span class="op" id="5940684">(</span><span class="keyword" id="5940685">type</span><span class="op" id="5940689">)</span>&nbsp;<span class="op" id="5940691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5940694">//&nbsp;TODO(wathiede):&nbsp;switch&nbsp;on&nbsp;m.ColorModel()&nbsp;instead&nbsp;of&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5940756">case</span>&nbsp;<span class="op" id="5940761">*</span><span class="ident" id="5940762">image</span><span class="op" id="5940767">.</span><span class="ident" id="5940768">Gray</span><span class="op" id="5940772">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5940776">for</span>&nbsp;<span class="ident" id="5940780">y</span>&nbsp;<span class="op" id="5940782">:=</span>&nbsp;<span class="ident" id="5940785">bounds</span><span class="op" id="5940791">.</span><span class="ident" id="5940792">Min</span><span class="op" id="5940795">.</span><span class="ident" id="5940796">Y</span><span class="op" id="5940797">;</span>&nbsp;<span class="ident" id="5940799">y</span>&nbsp;<span class="op" id="5940801">&lt;</span>&nbsp;<span class="ident" id="5940803">bounds</span><span class="op" id="5940809">.</span><span class="ident" id="5940810">Max</span><span class="op" id="5940813">.</span><span class="ident" id="5940814">Y</span><span class="op" id="5940815">;</span>&nbsp;<span class="ident" id="5940817">y</span>&nbsp;<span class="op" id="5940819">+=</span>&nbsp;<span class="num" id="5940822">8</span>&nbsp;<span class="op" id="5940824">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5940829">for</span>&nbsp;<span class="ident" id="5940833">x</span>&nbsp;<span class="op" id="5940835">:=</span>&nbsp;<span class="ident" id="5940838">bounds</span><span class="op" id="5940844">.</span><span class="ident" id="5940845">Min</span><span class="op" id="5940848">.</span><span class="ident" id="5940849">X</span><span class="op" id="5940850">;</span>&nbsp;<span class="ident" id="5940852">x</span>&nbsp;<span class="op" id="5940854">&lt;</span>&nbsp;<span class="ident" id="5940856">bounds</span><span class="op" id="5940862">.</span><span class="ident" id="5940863">Max</span><span class="op" id="5940866">.</span><span class="ident" id="5940867">X</span><span class="op" id="5940868">;</span>&nbsp;<span class="ident" id="5940870">x</span>&nbsp;<span class="op" id="5940872">+=</span>&nbsp;<span class="num" id="5940875">8</span>&nbsp;<span class="op" id="5940877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5940883">p</span>&nbsp;<span class="op" id="5940885">:=</span>&nbsp;<span class="ident" id="5940888">image</span><span class="op" id="5940893">.</span><span class="ident" id="5940894">Pt</span><span class="op" id="5940896">(</span><span class="ident" id="5940897">x</span><span class="op" id="5940898">,</span>&nbsp;<span class="ident" id="5940900">y</span><span class="op" id="5940901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5940907">grayToY</span><span class="op" id="5940914">(</span><span class="ident" id="5940915">m</span><span class="op" id="5940916">,</span>&nbsp;<span class="ident" id="5940918">p</span><span class="op" id="5940919">,</span>&nbsp;<span class="op" id="5940921">&amp;</span><span class="ident" id="5940922">b</span><span class="op" id="5940923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5940929">prevDCY</span>&nbsp;<span class="op" id="5940937">=</span>&nbsp;<span class="ident" id="5940939">e</span><span class="op" id="5940940">.</span><span class="ident" id="5940941">writeBlock</span><span class="op" id="5940951">(</span><span class="op" id="5940952">&amp;</span><span class="ident" id="5940953">b</span><span class="op" id="5940954">,</span>&nbsp;<span class="num" id="5940956">0</span><span class="op" id="5940957">,</span>&nbsp;<span class="ident" id="5940959">prevDCY</span><span class="op" id="5940966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5940971">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5940975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5940978">default</span><span class="op" id="5940985">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5940989">rgba</span><span class="op" id="5940993">,</span>&nbsp;<span class="ident" id="5940995">_</span>&nbsp;<span class="op" id="5940997">:=</span>&nbsp;<span class="ident" id="5941000">m</span><span class="op" id="5941001">.</span><span class="op" id="5941002">(</span><span class="op" id="5941003">*</span><span class="ident" id="5941004">image</span><span class="op" id="5941009">.</span><span class="ident" id="5941010">RGBA</span><span class="op" id="5941014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5941018">for</span>&nbsp;<span class="ident" id="5941022">y</span>&nbsp;<span class="op" id="5941024">:=</span>&nbsp;<span class="ident" id="5941027">bounds</span><span class="op" id="5941033">.</span><span class="ident" id="5941034">Min</span><span class="op" id="5941037">.</span><span class="ident" id="5941038">Y</span><span class="op" id="5941039">;</span>&nbsp;<span class="ident" id="5941041">y</span>&nbsp;<span class="op" id="5941043">&lt;</span>&nbsp;<span class="ident" id="5941045">bounds</span><span class="op" id="5941051">.</span><span class="ident" id="5941052">Max</span><span class="op" id="5941055">.</span><span class="ident" id="5941056">Y</span><span class="op" id="5941057">;</span>&nbsp;<span class="ident" id="5941059">y</span>&nbsp;<span class="op" id="5941061">+=</span>&nbsp;<span class="num" id="5941064">16</span>&nbsp;<span class="op" id="5941067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5941072">for</span>&nbsp;<span class="ident" id="5941076">x</span>&nbsp;<span class="op" id="5941078">:=</span>&nbsp;<span class="ident" id="5941081">bounds</span><span class="op" id="5941087">.</span><span class="ident" id="5941088">Min</span><span class="op" id="5941091">.</span><span class="ident" id="5941092">X</span><span class="op" id="5941093">;</span>&nbsp;<span class="ident" id="5941095">x</span>&nbsp;<span class="op" id="5941097">&lt;</span>&nbsp;<span class="ident" id="5941099">bounds</span><span class="op" id="5941105">.</span><span class="ident" id="5941106">Max</span><span class="op" id="5941109">.</span><span class="ident" id="5941110">X</span><span class="op" id="5941111">;</span>&nbsp;<span class="ident" id="5941113">x</span>&nbsp;<span class="op" id="5941115">+=</span>&nbsp;<span class="num" id="5941118">16</span>&nbsp;<span class="op" id="5941121">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5941127">for</span>&nbsp;<span class="ident" id="5941131">i</span>&nbsp;<span class="op" id="5941133">:=</span>&nbsp;<span class="num" id="5941136">0</span><span class="op" id="5941137">;</span>&nbsp;<span class="ident" id="5941139">i</span>&nbsp;<span class="op" id="5941141">&lt;</span>&nbsp;<span class="num" id="5941143">4</span><span class="op" id="5941144">;</span>&nbsp;<span class="ident" id="5941146">i</span><span class="op" id="5941147">++</span>&nbsp;<span class="op" id="5941150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5941157">xOff</span>&nbsp;<span class="op" id="5941162">:=</span>&nbsp;<span class="op" id="5941165">(</span><span class="ident" id="5941166">i</span>&nbsp;<span class="op" id="5941168">&amp;</span>&nbsp;<span class="num" id="5941170">1</span><span class="op" id="5941171">)</span>&nbsp;<span class="op" id="5941173">*</span>&nbsp;<span class="num" id="5941175">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5941182">yOff</span>&nbsp;<span class="op" id="5941187">:=</span>&nbsp;<span class="op" id="5941190">(</span><span class="ident" id="5941191">i</span>&nbsp;<span class="op" id="5941193">&amp;</span>&nbsp;<span class="num" id="5941195">2</span><span class="op" id="5941196">)</span>&nbsp;<span class="op" id="5941198">*</span>&nbsp;<span class="num" id="5941200">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5941207">p</span>&nbsp;<span class="op" id="5941209">:=</span>&nbsp;<span class="ident" id="5941212">image</span><span class="op" id="5941217">.</span><span class="ident" id="5941218">Pt</span><span class="op" id="5941220">(</span><span class="ident" id="5941221">x</span><span class="op" id="5941222">+</span><span class="ident" id="5941223">xOff</span><span class="op" id="5941227">,</span>&nbsp;<span class="ident" id="5941229">y</span><span class="op" id="5941230">+</span><span class="ident" id="5941231">yOff</span><span class="op" id="5941235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5941242">if</span>&nbsp;<span class="ident" id="5941245">rgba</span>&nbsp;<span class="op" id="5941250">!=</span>&nbsp;<span class="ident" id="5941253">nil</span>&nbsp;<span class="op" id="5941257">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5941265">rgbaToYCbCr</span><span class="op" id="5941276">(</span><span class="ident" id="5941277">rgba</span><span class="op" id="5941281">,</span>&nbsp;<span class="ident" id="5941283">p</span><span class="op" id="5941284">,</span>&nbsp;<span class="op" id="5941286">&amp;</span><span class="ident" id="5941287">b</span><span class="op" id="5941288">,</span>&nbsp;<span class="op" id="5941290">&amp;</span><span class="ident" id="5941291">cb</span><span class="op" id="5941293">[</span><span class="ident" id="5941294">i</span><span class="op" id="5941295">]</span><span class="op" id="5941296">,</span>&nbsp;<span class="op" id="5941298">&amp;</span><span class="ident" id="5941299">cr</span><span class="op" id="5941301">[</span><span class="ident" id="5941302">i</span><span class="op" id="5941303">]</span><span class="op" id="5941304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5941311">}</span>&nbsp;<span class="keyword" id="5941313">else</span>&nbsp;<span class="op" id="5941318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5941326">toYCbCr</span><span class="op" id="5941333">(</span><span class="ident" id="5941334">m</span><span class="op" id="5941335">,</span>&nbsp;<span class="ident" id="5941337">p</span><span class="op" id="5941338">,</span>&nbsp;<span class="op" id="5941340">&amp;</span><span class="ident" id="5941341">b</span><span class="op" id="5941342">,</span>&nbsp;<span class="op" id="5941344">&amp;</span><span class="ident" id="5941345">cb</span><span class="op" id="5941347">[</span><span class="ident" id="5941348">i</span><span class="op" id="5941349">]</span><span class="op" id="5941350">,</span>&nbsp;<span class="op" id="5941352">&amp;</span><span class="ident" id="5941353">cr</span><span class="op" id="5941355">[</span><span class="ident" id="5941356">i</span><span class="op" id="5941357">]</span><span class="op" id="5941358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5941365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5941372">prevDCY</span>&nbsp;<span class="op" id="5941380">=</span>&nbsp;<span class="ident" id="5941382">e</span><span class="op" id="5941383">.</span><span class="ident" id="5941384">writeBlock</span><span class="op" id="5941394">(</span><span class="op" id="5941395">&amp;</span><span class="ident" id="5941396">b</span><span class="op" id="5941397">,</span>&nbsp;<span class="num" id="5941399">0</span><span class="op" id="5941400">,</span>&nbsp;<span class="ident" id="5941402">prevDCY</span><span class="op" id="5941409">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5941415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5941421">scale</span><span class="op" id="5941426">(</span><span class="op" id="5941427">&amp;</span><span class="ident" id="5941428">b</span><span class="op" id="5941429">,</span>&nbsp;<span class="op" id="5941431">&amp;</span><span class="ident" id="5941432">cb</span><span class="op" id="5941434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5941440">prevDCCb</span>&nbsp;<span class="op" id="5941449">=</span>&nbsp;<span class="ident" id="5941451">e</span><span class="op" id="5941452">.</span><span class="ident" id="5941453">writeBlock</span><span class="op" id="5941463">(</span><span class="op" id="5941464">&amp;</span><span class="ident" id="5941465">b</span><span class="op" id="5941466">,</span>&nbsp;<span class="num" id="5941468">1</span><span class="op" id="5941469">,</span>&nbsp;<span class="ident" id="5941471">prevDCCb</span><span class="op" id="5941479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5941485">scale</span><span class="op" id="5941490">(</span><span class="op" id="5941491">&amp;</span><span class="ident" id="5941492">b</span><span class="op" id="5941493">,</span>&nbsp;<span class="op" id="5941495">&amp;</span><span class="ident" id="5941496">cr</span><span class="op" id="5941498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5941504">prevDCCr</span>&nbsp;<span class="op" id="5941513">=</span>&nbsp;<span class="ident" id="5941515">e</span><span class="op" id="5941516">.</span><span class="ident" id="5941517">writeBlock</span><span class="op" id="5941527">(</span><span class="op" id="5941528">&amp;</span><span class="ident" id="5941529">b</span><span class="op" id="5941530">,</span>&nbsp;<span class="num" id="5941532">1</span><span class="op" id="5941533">,</span>&nbsp;<span class="ident" id="5941535">prevDCCr</span><span class="op" id="5941543">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5941548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5941552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5941555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5941558">//&nbsp;Pad&nbsp;the&nbsp;last&nbsp;byte&nbsp;with&nbsp;1&#39;s.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5941590">e</span><span class="op" id="5941591">.</span><span class="ident" id="5941592">emit</span><span class="op" id="5941596">(</span><span class="num" id="5941597">0x7f</span><span class="op" id="5941601">,</span>&nbsp;<span class="num" id="5941603">7</span><span class="op" id="5941604">)</span><br>
<span class="lineno">535</span><span class="op" id="5941606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5941609">//&nbsp;DefaultQuality&nbsp;is&nbsp;the&nbsp;default&nbsp;quality&nbsp;encoding&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="keyword" id="5941670">const</span>&nbsp;<span class="ident" id="5941676">DefaultQuality</span>&nbsp;<span class="op" id="5941691">=</span>&nbsp;<span class="num" id="5941693">75</span><br>
<span class="lineno"></span><br>
<span class="lineno">540</span><span class="comment" id="5941697">//&nbsp;Options&nbsp;are&nbsp;the&nbsp;encoding&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="comment" id="5941737">//&nbsp;Quality&nbsp;ranges&nbsp;from&nbsp;1&nbsp;to&nbsp;100&nbsp;inclusive,&nbsp;higher&nbsp;is&nbsp;better.</span><br>
<span class="lineno"></span><span class="keyword" id="5941798">type</span>&nbsp;<span class="ident" id="5941803">Options</span>&nbsp;<span class="keyword" id="5941811">struct</span>&nbsp;<span class="op" id="5941818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5941821">Quality</span>&nbsp;<span class="builtintype" id="5941829">int</span><br>
<span class="lineno"></span><span class="op" id="5941833">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span><span class="comment" id="5941836">//&nbsp;Encode&nbsp;writes&nbsp;the&nbsp;Image&nbsp;m&nbsp;to&nbsp;w&nbsp;in&nbsp;JPEG&nbsp;4:2:0&nbsp;baseline&nbsp;format&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="5941915">//&nbsp;options.&nbsp;Default&nbsp;parameters&nbsp;are&nbsp;used&nbsp;if&nbsp;a&nbsp;nil&nbsp;*Options&nbsp;is&nbsp;passed.</span><br>
<span class="lineno"></span><span class="keyword" id="5941984">func</span>&nbsp;<span class="ident" id="5941989">Encode</span><span class="op" id="5941995">(</span><span class="ident" id="5941996">w</span>&nbsp;<span class="ident" id="5941998">io</span><span class="op" id="5942000">.</span><span class="ident" id="5942001">Writer</span><span class="op" id="5942007">,</span>&nbsp;<span class="ident" id="5942009">m</span>&nbsp;<span class="ident" id="5942011">image</span><span class="op" id="5942016">.</span><span class="ident" id="5942017">Image</span><span class="op" id="5942022">,</span>&nbsp;<span class="ident" id="5942024">o</span>&nbsp;<span class="op" id="5942026">*</span><span class="ident" id="5942027">Options</span><span class="op" id="5942034">)</span>&nbsp;<span class="builtintype" id="5942036">error</span>&nbsp;<span class="op" id="5942042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942045">b</span>&nbsp;<span class="op" id="5942047">:=</span>&nbsp;<span class="ident" id="5942050">m</span><span class="op" id="5942051">.</span><span class="ident" id="5942052">Bounds</span><span class="op" id="5942058">(</span><span class="op" id="5942059">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5942062">if</span>&nbsp;<span class="ident" id="5942065">b</span><span class="op" id="5942066">.</span><span class="ident" id="5942067">Dx</span><span class="op" id="5942069">(</span><span class="op" id="5942070">)</span>&nbsp;<span class="op" id="5942072">&gt;=</span>&nbsp;<span class="num" id="5942075">1</span><span class="op" id="5942076">&lt;&lt;</span><span class="num" id="5942078">16</span>&nbsp;<span class="op" id="5942081">||</span>&nbsp;<span class="ident" id="5942084">b</span><span class="op" id="5942085">.</span><span class="ident" id="5942086">Dy</span><span class="op" id="5942088">(</span><span class="op" id="5942089">)</span>&nbsp;<span class="op" id="5942091">&gt;=</span>&nbsp;<span class="num" id="5942094">1</span><span class="op" id="5942095">&lt;&lt;</span><span class="num" id="5942097">16</span>&nbsp;<span class="op" id="5942100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5942104">return</span>&nbsp;<span class="ident" id="5942111">errors</span><span class="op" id="5942117">.</span><span class="ident" id="5942118">New</span><span class="op" id="5942121">(</span><span class="string" id="5942122">&#34;jpeg:&nbsp;image&nbsp;is&nbsp;too&nbsp;large&nbsp;to&nbsp;encode&#34;</span><span class="op" id="5942158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5942161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5942164">var</span>&nbsp;<span class="ident" id="5942168">e</span>&nbsp;<span class="ident" id="5942170">encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5942179">if</span>&nbsp;<span class="ident" id="5942182">ww</span><span class="op" id="5942184">,</span>&nbsp;<span class="ident" id="5942186">ok</span>&nbsp;<span class="op" id="5942189">:=</span>&nbsp;<span class="ident" id="5942192">w</span><span class="op" id="5942193">.</span><span class="op" id="5942194">(</span><span class="ident" id="5942195">writer</span><span class="op" id="5942201">)</span><span class="op" id="5942202">;</span>&nbsp;<span class="ident" id="5942204">ok</span>&nbsp;<span class="op" id="5942207">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942211">e</span><span class="op" id="5942212">.</span><span class="ident" id="5942213">w</span>&nbsp;<span class="op" id="5942215">=</span>&nbsp;<span class="ident" id="5942217">ww</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5942221">}</span>&nbsp;<span class="keyword" id="5942223">else</span>&nbsp;<span class="op" id="5942228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942232">e</span><span class="op" id="5942233">.</span><span class="ident" id="5942234">w</span>&nbsp;<span class="op" id="5942236">=</span>&nbsp;<span class="ident" id="5942238">bufio</span><span class="op" id="5942243">.</span><span class="ident" id="5942244">NewWriter</span><span class="op" id="5942253">(</span><span class="ident" id="5942254">w</span><span class="op" id="5942255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5942258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5942261">//&nbsp;Clip&nbsp;quality&nbsp;to&nbsp;[1,&nbsp;100].</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942291">quality</span>&nbsp;<span class="op" id="5942299">:=</span>&nbsp;<span class="ident" id="5942302">DefaultQuality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5942318">if</span>&nbsp;<span class="ident" id="5942321">o</span>&nbsp;<span class="op" id="5942323">!=</span>&nbsp;<span class="ident" id="5942326">nil</span>&nbsp;<span class="op" id="5942330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942334">quality</span>&nbsp;<span class="op" id="5942342">=</span>&nbsp;<span class="ident" id="5942344">o</span><span class="op" id="5942345">.</span><span class="ident" id="5942346">Quality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5942356">if</span>&nbsp;<span class="ident" id="5942359">quality</span>&nbsp;<span class="op" id="5942367">&lt;</span>&nbsp;<span class="num" id="5942369">1</span>&nbsp;<span class="op" id="5942371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942376">quality</span>&nbsp;<span class="op" id="5942384">=</span>&nbsp;<span class="num" id="5942386">1</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5942390">}</span>&nbsp;<span class="keyword" id="5942392">else</span>&nbsp;<span class="keyword" id="5942397">if</span>&nbsp;<span class="ident" id="5942400">quality</span>&nbsp;<span class="op" id="5942408">&gt;</span>&nbsp;<span class="num" id="5942410">100</span>&nbsp;<span class="op" id="5942414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942419">quality</span>&nbsp;<span class="op" id="5942427">=</span>&nbsp;<span class="num" id="5942429">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5942435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5942438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5942441">//&nbsp;Convert&nbsp;from&nbsp;a&nbsp;quality&nbsp;rating&nbsp;to&nbsp;a&nbsp;scaling&nbsp;factor.</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5942496">var</span>&nbsp;<span class="ident" id="5942500">scale</span>&nbsp;<span class="builtintype" id="5942506">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5942511">if</span>&nbsp;<span class="ident" id="5942514">quality</span>&nbsp;<span class="op" id="5942522">&lt;</span>&nbsp;<span class="num" id="5942524">50</span>&nbsp;<span class="op" id="5942527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942531">scale</span>&nbsp;<span class="op" id="5942537">=</span>&nbsp;<span class="num" id="5942539">5000</span>&nbsp;<span class="op" id="5942544">/</span>&nbsp;<span class="ident" id="5942546">quality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5942555">}</span>&nbsp;<span class="keyword" id="5942557">else</span>&nbsp;<span class="op" id="5942562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942566">scale</span>&nbsp;<span class="op" id="5942572">=</span>&nbsp;<span class="num" id="5942574">200</span>&nbsp;<span class="op" id="5942578">-</span>&nbsp;<span class="ident" id="5942580">quality</span><span class="op" id="5942587">*</span><span class="num" id="5942588">2</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5942591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5942594">//&nbsp;Initialize&nbsp;the&nbsp;quantization&nbsp;tables.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5942634">for</span>&nbsp;<span class="ident" id="5942638">i</span>&nbsp;<span class="op" id="5942640">:=</span>&nbsp;<span class="keyword" id="5942643">range</span>&nbsp;<span class="ident" id="5942649">e</span><span class="op" id="5942650">.</span><span class="ident" id="5942651">quant</span>&nbsp;<span class="op" id="5942657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5942661">for</span>&nbsp;<span class="ident" id="5942665">j</span>&nbsp;<span class="op" id="5942667">:=</span>&nbsp;<span class="keyword" id="5942670">range</span>&nbsp;<span class="ident" id="5942676">e</span><span class="op" id="5942677">.</span><span class="ident" id="5942678">quant</span><span class="op" id="5942683">[</span><span class="ident" id="5942684">i</span><span class="op" id="5942685">]</span>&nbsp;<span class="op" id="5942687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942692">x</span>&nbsp;<span class="op" id="5942694">:=</span>&nbsp;<span class="builtintype" id="5942697">int</span><span class="op" id="5942700">(</span><span class="ident" id="5942701">unscaledQuant</span><span class="op" id="5942714">[</span><span class="ident" id="5942715">i</span><span class="op" id="5942716">]</span><span class="op" id="5942717">[</span><span class="ident" id="5942718">j</span><span class="op" id="5942719">]</span><span class="op" id="5942720">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942725">x</span>&nbsp;<span class="op" id="5942727">=</span>&nbsp;<span class="op" id="5942729">(</span><span class="ident" id="5942730">x</span><span class="op" id="5942731">*</span><span class="ident" id="5942732">scale</span>&nbsp;<span class="op" id="5942738">+</span>&nbsp;<span class="num" id="5942740">50</span><span class="op" id="5942742">)</span>&nbsp;<span class="op" id="5942744">/</span>&nbsp;<span class="num" id="5942746">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5942753">if</span>&nbsp;<span class="ident" id="5942756">x</span>&nbsp;<span class="op" id="5942758">&lt;</span>&nbsp;<span class="num" id="5942760">1</span>&nbsp;<span class="op" id="5942762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942768">x</span>&nbsp;<span class="op" id="5942770">=</span>&nbsp;<span class="num" id="5942772">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5942777">}</span>&nbsp;<span class="keyword" id="5942779">else</span>&nbsp;<span class="keyword" id="5942784">if</span>&nbsp;<span class="ident" id="5942787">x</span>&nbsp;<span class="op" id="5942789">&gt;</span>&nbsp;<span class="num" id="5942791">255</span>&nbsp;<span class="op" id="5942795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942801">x</span>&nbsp;<span class="op" id="5942803">=</span>&nbsp;<span class="num" id="5942805">255</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5942812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942817">e</span><span class="op" id="5942818">.</span><span class="ident" id="5942819">quant</span><span class="op" id="5942824">[</span><span class="ident" id="5942825">i</span><span class="op" id="5942826">]</span><span class="op" id="5942827">[</span><span class="ident" id="5942828">j</span><span class="op" id="5942829">]</span>&nbsp;<span class="op" id="5942831">=</span>&nbsp;<span class="builtintype" id="5942833">uint8</span><span class="op" id="5942838">(</span><span class="ident" id="5942839">x</span><span class="op" id="5942840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5942844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5942847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5942850">//&nbsp;Compute&nbsp;number&nbsp;of&nbsp;components&nbsp;based&nbsp;on&nbsp;input&nbsp;image&nbsp;type.</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942910">nComponent</span>&nbsp;<span class="op" id="5942921">:=</span>&nbsp;<span class="num" id="5942924">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5942927">switch</span>&nbsp;<span class="ident" id="5942934">m</span><span class="op" id="5942935">.</span><span class="op" id="5942936">(</span><span class="keyword" id="5942937">type</span><span class="op" id="5942941">)</span>&nbsp;<span class="op" id="5942943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5942946">//&nbsp;TODO(wathiede):&nbsp;switch&nbsp;on&nbsp;m.ColorModel()&nbsp;instead&nbsp;of&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5943008">case</span>&nbsp;<span class="op" id="5943013">*</span><span class="ident" id="5943014">image</span><span class="op" id="5943019">.</span><span class="ident" id="5943020">Gray</span><span class="op" id="5943024">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943028">nComponent</span>&nbsp;<span class="op" id="5943039">=</span>&nbsp;<span class="num" id="5943041">1</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5943044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5943047">//&nbsp;Write&nbsp;the&nbsp;Start&nbsp;Of&nbsp;Image&nbsp;marker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943084">e</span><span class="op" id="5943085">.</span><span class="ident" id="5943086">buf</span><span class="op" id="5943089">[</span><span class="num" id="5943090">0</span><span class="op" id="5943091">]</span>&nbsp;<span class="op" id="5943093">=</span>&nbsp;<span class="num" id="5943095">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943101">e</span><span class="op" id="5943102">.</span><span class="ident" id="5943103">buf</span><span class="op" id="5943106">[</span><span class="num" id="5943107">1</span><span class="op" id="5943108">]</span>&nbsp;<span class="op" id="5943110">=</span>&nbsp;<span class="num" id="5943112">0xd8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943118">e</span><span class="op" id="5943119">.</span><span class="ident" id="5943120">write</span><span class="op" id="5943125">(</span><span class="ident" id="5943126">e</span><span class="op" id="5943127">.</span><span class="ident" id="5943128">buf</span><span class="op" id="5943131">[</span><span class="op" id="5943132">:</span><span class="num" id="5943133">2</span><span class="op" id="5943134">]</span><span class="op" id="5943135">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5943138">//&nbsp;Write&nbsp;the&nbsp;quantization&nbsp;tables.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943173">e</span><span class="op" id="5943174">.</span><span class="ident" id="5943175">writeDQT</span><span class="op" id="5943183">(</span><span class="op" id="5943184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5943187">//&nbsp;Write&nbsp;the&nbsp;image&nbsp;dimensions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943219">e</span><span class="op" id="5943220">.</span><span class="ident" id="5943221">writeSOF0</span><span class="op" id="5943230">(</span><span class="ident" id="5943231">b</span><span class="op" id="5943232">.</span><span class="ident" id="5943233">Size</span><span class="op" id="5943237">(</span><span class="op" id="5943238">)</span><span class="op" id="5943239">,</span>&nbsp;<span class="ident" id="5943241">nComponent</span><span class="op" id="5943251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5943254">//&nbsp;Write&nbsp;the&nbsp;Huffman&nbsp;tables.</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943284">e</span><span class="op" id="5943285">.</span><span class="ident" id="5943286">writeDHT</span><span class="op" id="5943294">(</span><span class="ident" id="5943295">nComponent</span><span class="op" id="5943305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5943308">//&nbsp;Write&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943334">e</span><span class="op" id="5943335">.</span><span class="ident" id="5943336">writeSOS</span><span class="op" id="5943344">(</span><span class="ident" id="5943345">m</span><span class="op" id="5943346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5943349">//&nbsp;Write&nbsp;the&nbsp;End&nbsp;Of&nbsp;Image&nbsp;marker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943384">e</span><span class="op" id="5943385">.</span><span class="ident" id="5943386">buf</span><span class="op" id="5943389">[</span><span class="num" id="5943390">0</span><span class="op" id="5943391">]</span>&nbsp;<span class="op" id="5943393">=</span>&nbsp;<span class="num" id="5943395">0xff</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943401">e</span><span class="op" id="5943402">.</span><span class="ident" id="5943403">buf</span><span class="op" id="5943406">[</span><span class="num" id="5943407">1</span><span class="op" id="5943408">]</span>&nbsp;<span class="op" id="5943410">=</span>&nbsp;<span class="num" id="5943412">0xd9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943418">e</span><span class="op" id="5943419">.</span><span class="ident" id="5943420">write</span><span class="op" id="5943425">(</span><span class="ident" id="5943426">e</span><span class="op" id="5943427">.</span><span class="ident" id="5943428">buf</span><span class="op" id="5943431">[</span><span class="op" id="5943432">:</span><span class="num" id="5943433">2</span><span class="op" id="5943434">]</span><span class="op" id="5943435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943438">e</span><span class="op" id="5943439">.</span><span class="ident" id="5943440">flush</span><span class="op" id="5943445">(</span><span class="op" id="5943446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5943449">return</span>&nbsp;<span class="ident" id="5943456">e</span><span class="op" id="5943457">.</span><span class="ident" id="5943458">err</span><br>
<span class="lineno"></span><span class="op" id="5943462">}</span>
</div>
</body>
</html>
