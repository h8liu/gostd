<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/flate</h2>
<ul>
<li><a href="/gostd/compress/flate/copy.go.html">copy.go</a></li>
<li><a href="/gostd/compress/flate/copy_test.go.html">copy_test.go</a></li>
<li><a href="/gostd/compress/flate/deflate.go.html">deflate.go</a></li>
<li><a href="/gostd/compress/flate/deflate_test.go.html">deflate_test.go</a></li>
<li><a href="/gostd/compress/flate/fixedhuff.go.html">fixedhuff.go</a></li>
<li><a href="/gostd/compress/flate/flate_test.go.html">flate_test.go</a></li>
<li><a href="/gostd/compress/flate/huffman_bit_writer.go.html">huffman_bit_writer.go</a></li>
<li><a href="/gostd/compress/flate/huffman_code.go.html" class="current">huffman_code.go</a></li>
<li><a href="/gostd/compress/flate/inflate.go.html">inflate.go</a></li>
<li><a href="/gostd/compress/flate/inflate_test.go.html">inflate_test.go</a></li>
<li><a href="/gostd/compress/flate/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/flate/reverse_bits.go.html">reverse_bits.go</a></li>
<li><a href="/gostd/compress/flate/token.go.html">token.go</a></li>
<li><a href="/gostd/compress/flate/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4825142">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4825197">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4825251">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4825302">package</span>&nbsp;<span class="ident" id="4825310">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4825317">import</span>&nbsp;<span class="op" id="4825324">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4825327">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4825335">&#34;sort&#34;</span><br>
<span class="lineno">10</span><span class="op" id="4825342">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4825345">type</span>&nbsp;<span class="ident" id="4825350">huffmanEncoder</span>&nbsp;<span class="keyword" id="4825365">struct</span>&nbsp;<span class="op" id="4825372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4825375">codeBits</span>&nbsp;<span class="op" id="4825384">[</span><span class="op" id="4825385">]</span><span class="builtintype" id="4825386">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4825393">code</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4825402">[</span><span class="op" id="4825403">]</span><span class="builtintype" id="4825404">uint16</span><br>
<span class="lineno">15</span><span class="op" id="4825411">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4825414">type</span>&nbsp;<span class="ident" id="4825419">literalNode</span>&nbsp;<span class="keyword" id="4825431">struct</span>&nbsp;<span class="op" id="4825438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4825441">literal</span>&nbsp;<span class="builtintype" id="4825449">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4825457">freq</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4825465">int32</span><br>
<span class="lineno">20</span><span class="op" id="4825471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4825474">//&nbsp;A&nbsp;levelInfo&nbsp;describes&nbsp;the&nbsp;state&nbsp;of&nbsp;the&nbsp;constructed&nbsp;tree&nbsp;for&nbsp;a&nbsp;given&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="4825552">type</span>&nbsp;<span class="ident" id="4825557">levelInfo</span>&nbsp;<span class="keyword" id="4825567">struct</span>&nbsp;<span class="op" id="4825574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4825577">//&nbsp;Our&nbsp;level.&nbsp;&nbsp;for&nbsp;better&nbsp;printing</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4825613">level</span>&nbsp;<span class="builtintype" id="4825619">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4825627">//&nbsp;The&nbsp;frequency&nbsp;of&nbsp;the&nbsp;last&nbsp;node&nbsp;at&nbsp;this&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4825676">lastFreq</span>&nbsp;<span class="builtintype" id="4825685">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4825693">//&nbsp;The&nbsp;frequency&nbsp;of&nbsp;the&nbsp;next&nbsp;character&nbsp;to&nbsp;add&nbsp;to&nbsp;this&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4825754">nextCharFreq</span>&nbsp;<span class="builtintype" id="4825767">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4825775">//&nbsp;The&nbsp;frequency&nbsp;of&nbsp;the&nbsp;next&nbsp;pair&nbsp;(from&nbsp;level&nbsp;below)&nbsp;to&nbsp;add&nbsp;to&nbsp;this&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4825851">//&nbsp;Only&nbsp;valid&nbsp;if&nbsp;the&nbsp;&#34;needed&#34;&nbsp;value&nbsp;of&nbsp;the&nbsp;next&nbsp;lower&nbsp;level&nbsp;is&nbsp;0.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4825918">nextPairFreq</span>&nbsp;<span class="builtintype" id="4825931">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4825939">//&nbsp;The&nbsp;number&nbsp;of&nbsp;chains&nbsp;remaining&nbsp;to&nbsp;generate&nbsp;for&nbsp;this&nbsp;level&nbsp;before&nbsp;moving</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4826015">//&nbsp;up&nbsp;to&nbsp;the&nbsp;next&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4826040">needed</span>&nbsp;<span class="builtintype" id="4826047">int32</span><br>
<span class="lineno">40</span><span class="op" id="4826053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4826056">func</span>&nbsp;<span class="ident" id="4826061">maxNode</span><span class="op" id="4826068">(</span><span class="op" id="4826069">)</span>&nbsp;<span class="ident" id="4826071"><a href="/gostd/compress/flate/huffman_code.go.html#4825419">literalNode</a></span>&nbsp;<span class="op" id="4826083">{</span>&nbsp;<span class="keyword" id="4826085">return</span>&nbsp;<span class="ident" id="4826092"><a href="/gostd/compress/flate/huffman_code.go.html#4825419">literalNode</a></span><span class="op" id="4826103">{</span><span class="ident" id="4826104"><a href="/gostd/compress/flate/huffman_code.go.html#4825327">math</a></span><span class="op" id="4826108">.</span><span class="ident" id="4826109"><a href="/gostd/math/const.go.html#2216142">MaxUint16</a></span><span class="op" id="4826118">,</span>&nbsp;<span class="ident" id="4826120"><a href="/gostd/compress/flate/huffman_code.go.html#4825327">math</a></span><span class="op" id="4826124">.</span><span class="ident" id="4826125"><a href="/gostd/math/const.go.html#2216030">MaxInt32</a></span><span class="op" id="4826133">}</span>&nbsp;<span class="op" id="4826135">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4826138">func</span>&nbsp;<span class="ident" id="4826143">newHuffmanEncoder</span><span class="op" id="4826160">(</span><span class="ident" id="4826161">size</span>&nbsp;<span class="builtintype" id="4826166">int</span><span class="op" id="4826169">)</span>&nbsp;<span class="op" id="4826171">*</span><span class="ident" id="4826172"><a href="/gostd/compress/flate/huffman_code.go.html#4825350">huffmanEncoder</a></span>&nbsp;<span class="op" id="4826187">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826190">return</span>&nbsp;<span class="op" id="4826197">&amp;</span><span class="ident" id="4826198"><a href="/gostd/compress/flate/huffman_code.go.html#4825350">huffmanEncoder</a></span><span class="op" id="4826212">{</span><span class="builtinfunc" id="4826213">make</span><span class="op" id="4826217">(</span><span class="op" id="4826218">[</span><span class="op" id="4826219">]</span><span class="builtintype" id="4826220">uint8</span><span class="op" id="4826225">,</span>&nbsp;<span class="ident" id="4826227"><a href="/gostd/compress/flate/huffman_code.go.html#4826161">size</a></span><span class="op" id="4826231">)</span><span class="op" id="4826232">,</span>&nbsp;<span class="builtinfunc" id="4826234">make</span><span class="op" id="4826238">(</span><span class="op" id="4826239">[</span><span class="op" id="4826240">]</span><span class="builtintype" id="4826241">uint16</span><span class="op" id="4826247">,</span>&nbsp;<span class="ident" id="4826249"><a href="/gostd/compress/flate/huffman_code.go.html#4826161">size</a></span><span class="op" id="4826253">)</span><span class="op" id="4826254">}</span><br>
<span class="lineno"></span><span class="op" id="4826256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4826259">//&nbsp;Generates&nbsp;a&nbsp;HuffmanCode&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;fixed&nbsp;literal&nbsp;table</span><br>
<span class="lineno"></span><span class="keyword" id="4826327">func</span>&nbsp;<span class="ident" id="4826332">generateFixedLiteralEncoding</span><span class="op" id="4826360">(</span><span class="op" id="4826361">)</span>&nbsp;<span class="op" id="4826363">*</span><span class="ident" id="4826364"><a href="/gostd/compress/flate/huffman_code.go.html#4825350">huffmanEncoder</a></span>&nbsp;<span class="op" id="4826379">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4826382">h</span>&nbsp;<span class="op" id="4826384">:=</span>&nbsp;<span class="ident" id="4826387"><a href="/gostd/compress/flate/huffman_code.go.html#4826143">newHuffmanEncoder</a></span><span class="op" id="4826404">(</span><span class="ident" id="4826405"><a href="/gostd/compress/flate/inflate.go.html#4835110">maxLit</a></span><span class="op" id="4826411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4826414">codeBits</span>&nbsp;<span class="op" id="4826423">:=</span>&nbsp;<span class="ident" id="4826426"><a href="/gostd/compress/flate/huffman_code.go.html#4826382">h</a></span><span class="op" id="4826427">.</span><span class="ident" id="4826428"><a href="/gostd/compress/flate/huffman_code.go.html#4825375">codeBits</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4826438">code</span>&nbsp;<span class="op" id="4826443">:=</span>&nbsp;<span class="ident" id="4826446"><a href="/gostd/compress/flate/huffman_code.go.html#4826382">h</a></span><span class="op" id="4826447">.</span><span class="ident" id="4826448"><a href="/gostd/compress/flate/huffman_code.go.html#4825393">code</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826454">var</span>&nbsp;<span class="ident" id="4826458">ch</span>&nbsp;<span class="builtintype" id="4826461">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826469">for</span>&nbsp;<span class="ident" id="4826473"><a href="/gostd/compress/flate/huffman_code.go.html#4826458">ch</a></span>&nbsp;<span class="op" id="4826476">=</span>&nbsp;<span class="num" id="4826478">0</span><span class="op" id="4826479">;</span>&nbsp;<span class="ident" id="4826481"><a href="/gostd/compress/flate/huffman_code.go.html#4826458">ch</a></span>&nbsp;<span class="op" id="4826484">&lt;</span>&nbsp;<span class="ident" id="4826486"><a href="/gostd/compress/flate/inflate.go.html#4835110">maxLit</a></span><span class="op" id="4826492">;</span>&nbsp;<span class="ident" id="4826494"><a href="/gostd/compress/flate/huffman_code.go.html#4826458">ch</a></span><span class="op" id="4826496">++</span>&nbsp;<span class="op" id="4826499">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826503">var</span>&nbsp;<span class="ident" id="4826507">bits</span>&nbsp;<span class="builtintype" id="4826512">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826521">var</span>&nbsp;<span class="ident" id="4826525">size</span>&nbsp;<span class="builtintype" id="4826530">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826538">switch</span>&nbsp;<span class="op" id="4826545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826549">case</span>&nbsp;<span class="ident" id="4826554"><a href="/gostd/compress/flate/huffman_code.go.html#4826458">ch</a></span>&nbsp;<span class="op" id="4826557">&lt;</span>&nbsp;<span class="num" id="4826559">144</span><span class="op" id="4826562">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4826567">//&nbsp;size&nbsp;8,&nbsp;000110000&nbsp;&nbsp;..&nbsp;10111111</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4826604"><a href="/gostd/compress/flate/huffman_code.go.html#4826507">bits</a></span>&nbsp;<span class="op" id="4826609">=</span>&nbsp;<span class="ident" id="4826611"><a href="/gostd/compress/flate/huffman_code.go.html#4826458">ch</a></span>&nbsp;<span class="op" id="4826614">+</span>&nbsp;<span class="num" id="4826616">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4826622"><a href="/gostd/compress/flate/huffman_code.go.html#4826525">size</a></span>&nbsp;<span class="op" id="4826627">=</span>&nbsp;<span class="num" id="4826629">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826634">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826642">case</span>&nbsp;<span class="ident" id="4826647"><a href="/gostd/compress/flate/huffman_code.go.html#4826458">ch</a></span>&nbsp;<span class="op" id="4826650">&lt;</span>&nbsp;<span class="num" id="4826652">256</span><span class="op" id="4826655">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4826660">//&nbsp;size&nbsp;9,&nbsp;110010000&nbsp;..&nbsp;111111111</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4826697"><a href="/gostd/compress/flate/huffman_code.go.html#4826507">bits</a></span>&nbsp;<span class="op" id="4826702">=</span>&nbsp;<span class="ident" id="4826704"><a href="/gostd/compress/flate/huffman_code.go.html#4826458">ch</a></span>&nbsp;<span class="op" id="4826707">+</span>&nbsp;<span class="num" id="4826709">400</span>&nbsp;<span class="op" id="4826713">-</span>&nbsp;<span class="num" id="4826715">144</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4826722"><a href="/gostd/compress/flate/huffman_code.go.html#4826525">size</a></span>&nbsp;<span class="op" id="4826727">=</span>&nbsp;<span class="num" id="4826729">9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826734">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826742">case</span>&nbsp;<span class="ident" id="4826747"><a href="/gostd/compress/flate/huffman_code.go.html#4826458">ch</a></span>&nbsp;<span class="op" id="4826750">&lt;</span>&nbsp;<span class="num" id="4826752">280</span><span class="op" id="4826755">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4826760">//&nbsp;size&nbsp;7,&nbsp;0000000&nbsp;..&nbsp;0010111</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4826793"><a href="/gostd/compress/flate/huffman_code.go.html#4826507">bits</a></span>&nbsp;<span class="op" id="4826798">=</span>&nbsp;<span class="ident" id="4826800"><a href="/gostd/compress/flate/huffman_code.go.html#4826458">ch</a></span>&nbsp;<span class="op" id="4826803">-</span>&nbsp;<span class="num" id="4826805">256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4826812"><a href="/gostd/compress/flate/huffman_code.go.html#4826525">size</a></span>&nbsp;<span class="op" id="4826817">=</span>&nbsp;<span class="num" id="4826819">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826824">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826832">default</span><span class="op" id="4826839">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4826844">//&nbsp;size&nbsp;8,&nbsp;11000000&nbsp;..&nbsp;11000111</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4826879"><a href="/gostd/compress/flate/huffman_code.go.html#4826507">bits</a></span>&nbsp;<span class="op" id="4826884">=</span>&nbsp;<span class="ident" id="4826886"><a href="/gostd/compress/flate/huffman_code.go.html#4826458">ch</a></span>&nbsp;<span class="op" id="4826889">+</span>&nbsp;<span class="num" id="4826891">192</span>&nbsp;<span class="op" id="4826895">-</span>&nbsp;<span class="num" id="4826897">280</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4826904"><a href="/gostd/compress/flate/huffman_code.go.html#4826525">size</a></span>&nbsp;<span class="op" id="4826909">=</span>&nbsp;<span class="num" id="4826911">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4826915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4826919"><a href="/gostd/compress/flate/huffman_code.go.html#4826414">codeBits</a></span><span class="op" id="4826927">[</span><span class="ident" id="4826928"><a href="/gostd/compress/flate/huffman_code.go.html#4826458">ch</a></span><span class="op" id="4826930">]</span>&nbsp;<span class="op" id="4826932">=</span>&nbsp;<span class="ident" id="4826934"><a href="/gostd/compress/flate/huffman_code.go.html#4826525">size</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4826941"><a href="/gostd/compress/flate/huffman_code.go.html#4826438">code</a></span><span class="op" id="4826945">[</span><span class="ident" id="4826946"><a href="/gostd/compress/flate/huffman_code.go.html#4826458">ch</a></span><span class="op" id="4826948">]</span>&nbsp;<span class="op" id="4826950">=</span>&nbsp;<span class="ident" id="4826952"><a href="/gostd/compress/flate/reverse_bits.go.html#4853319">reverseBits</a></span><span class="op" id="4826963">(</span><span class="ident" id="4826964"><a href="/gostd/compress/flate/huffman_code.go.html#4826507">bits</a></span><span class="op" id="4826968">,</span>&nbsp;<span class="ident" id="4826970"><a href="/gostd/compress/flate/huffman_code.go.html#4826525">size</a></span><span class="op" id="4826974">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4826977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826980">return</span>&nbsp;<span class="ident" id="4826987"><a href="/gostd/compress/flate/huffman_code.go.html#4826382">h</a></span><br>
<span class="lineno"></span><span class="op" id="4826989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4826992">func</span>&nbsp;<span class="ident" id="4826997">generateFixedOffsetEncoding</span><span class="op" id="4827024">(</span><span class="op" id="4827025">)</span>&nbsp;<span class="op" id="4827027">*</span><span class="ident" id="4827028"><a href="/gostd/compress/flate/huffman_code.go.html#4825350">huffmanEncoder</a></span>&nbsp;<span class="op" id="4827043">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4827046">h</span>&nbsp;<span class="op" id="4827048">:=</span>&nbsp;<span class="ident" id="4827051"><a href="/gostd/compress/flate/huffman_code.go.html#4826143">newHuffmanEncoder</a></span><span class="op" id="4827068">(</span><span class="num" id="4827069">30</span><span class="op" id="4827071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4827074">codeBits</span>&nbsp;<span class="op" id="4827083">:=</span>&nbsp;<span class="ident" id="4827086"><a href="/gostd/compress/flate/huffman_code.go.html#4827046">h</a></span><span class="op" id="4827087">.</span><span class="ident" id="4827088"><a href="/gostd/compress/flate/huffman_code.go.html#4825375">codeBits</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4827098">code</span>&nbsp;<span class="op" id="4827103">:=</span>&nbsp;<span class="ident" id="4827106"><a href="/gostd/compress/flate/huffman_code.go.html#4827046">h</a></span><span class="op" id="4827107">.</span><span class="ident" id="4827108"><a href="/gostd/compress/flate/huffman_code.go.html#4825393">code</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4827114">for</span>&nbsp;<span class="ident" id="4827118">ch</span>&nbsp;<span class="op" id="4827121">:=</span>&nbsp;<span class="builtintype" id="4827124">uint16</span><span class="op" id="4827130">(</span><span class="num" id="4827131">0</span><span class="op" id="4827132">)</span><span class="op" id="4827133">;</span>&nbsp;<span class="ident" id="4827135"><a href="/gostd/compress/flate/huffman_code.go.html#4827118">ch</a></span>&nbsp;<span class="op" id="4827138">&lt;</span>&nbsp;<span class="num" id="4827140">30</span><span class="op" id="4827142">;</span>&nbsp;<span class="ident" id="4827144"><a href="/gostd/compress/flate/huffman_code.go.html#4827118">ch</a></span><span class="op" id="4827146">++</span>&nbsp;<span class="op" id="4827149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4827153"><a href="/gostd/compress/flate/huffman_code.go.html#4827074">codeBits</a></span><span class="op" id="4827161">[</span><span class="ident" id="4827162"><a href="/gostd/compress/flate/huffman_code.go.html#4827118">ch</a></span><span class="op" id="4827164">]</span>&nbsp;<span class="op" id="4827166">=</span>&nbsp;<span class="num" id="4827168">5</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4827172"><a href="/gostd/compress/flate/huffman_code.go.html#4827098">code</a></span><span class="op" id="4827176">[</span><span class="ident" id="4827177"><a href="/gostd/compress/flate/huffman_code.go.html#4827118">ch</a></span><span class="op" id="4827179">]</span>&nbsp;<span class="op" id="4827181">=</span>&nbsp;<span class="ident" id="4827183"><a href="/gostd/compress/flate/reverse_bits.go.html#4853319">reverseBits</a></span><span class="op" id="4827194">(</span><span class="ident" id="4827195"><a href="/gostd/compress/flate/huffman_code.go.html#4827118">ch</a></span><span class="op" id="4827197">,</span>&nbsp;<span class="num" id="4827199">5</span><span class="op" id="4827200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4827203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4827206">return</span>&nbsp;<span class="ident" id="4827213"><a href="/gostd/compress/flate/huffman_code.go.html#4827046">h</a></span><br>
<span class="lineno"></span><span class="op" id="4827215">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="4827218">var</span>&nbsp;<span class="ident" id="4827222">fixedLiteralEncoding</span>&nbsp;<span class="op" id="4827243">*</span><span class="ident" id="4827244"><a href="/gostd/compress/flate/huffman_code.go.html#4825350">huffmanEncoder</a></span>&nbsp;<span class="op" id="4827259">=</span>&nbsp;<span class="ident" id="4827261"><a href="/gostd/compress/flate/huffman_code.go.html#4826332">generateFixedLiteralEncoding</a></span><span class="op" id="4827289">(</span><span class="op" id="4827290">)</span><br>
<span class="lineno"></span><span class="keyword" id="4827292">var</span>&nbsp;<span class="ident" id="4827296">fixedOffsetEncoding</span>&nbsp;<span class="op" id="4827316">*</span><span class="ident" id="4827317"><a href="/gostd/compress/flate/huffman_code.go.html#4825350">huffmanEncoder</a></span>&nbsp;<span class="op" id="4827332">=</span>&nbsp;<span class="ident" id="4827334"><a href="/gostd/compress/flate/huffman_code.go.html#4826997">generateFixedOffsetEncoding</a></span><span class="op" id="4827361">(</span><span class="op" id="4827362">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4827365">func</span>&nbsp;<span class="op" id="4827370">(</span><span class="ident" id="4827371">h</span>&nbsp;<span class="op" id="4827373">*</span><span class="ident" id="4827374"><a href="/gostd/compress/flate/huffman_code.go.html#4825350">huffmanEncoder</a></span><span class="op" id="4827388">)</span>&nbsp;<span class="ident" id="4827390">bitLength</span><span class="op" id="4827399">(</span><span class="ident" id="4827400">freq</span>&nbsp;<span class="op" id="4827405">[</span><span class="op" id="4827406">]</span><span class="builtintype" id="4827407">int32</span><span class="op" id="4827412">)</span>&nbsp;<span class="builtintype" id="4827414">int64</span>&nbsp;<span class="op" id="4827420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4827423">var</span>&nbsp;<span class="ident" id="4827427">total</span>&nbsp;<span class="builtintype" id="4827433">int64</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4827440">for</span>&nbsp;<span class="ident" id="4827444">i</span><span class="op" id="4827445">,</span>&nbsp;<span class="ident" id="4827447">f</span>&nbsp;<span class="op" id="4827449">:=</span>&nbsp;<span class="keyword" id="4827452">range</span>&nbsp;<span class="ident" id="4827458"><a href="/gostd/compress/flate/huffman_code.go.html#4827400">freq</a></span>&nbsp;<span class="op" id="4827463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4827467">if</span>&nbsp;<span class="ident" id="4827470"><a href="/gostd/compress/flate/huffman_code.go.html#4827447">f</a></span>&nbsp;<span class="op" id="4827472">!=</span>&nbsp;<span class="num" id="4827475">0</span>&nbsp;<span class="op" id="4827477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4827482"><a href="/gostd/compress/flate/huffman_code.go.html#4827427">total</a></span>&nbsp;<span class="op" id="4827488">+=</span>&nbsp;<span class="builtintype" id="4827491">int64</span><span class="op" id="4827496">(</span><span class="ident" id="4827497"><a href="/gostd/compress/flate/huffman_code.go.html#4827447">f</a></span><span class="op" id="4827498">)</span>&nbsp;<span class="op" id="4827500">*</span>&nbsp;<span class="builtintype" id="4827502">int64</span><span class="op" id="4827507">(</span><span class="ident" id="4827508"><a href="/gostd/compress/flate/huffman_code.go.html#4827371">h</a></span><span class="op" id="4827509">.</span><span class="ident" id="4827510"><a href="/gostd/compress/flate/huffman_code.go.html#4825375">codeBits</a></span><span class="op" id="4827518">[</span><span class="ident" id="4827519"><a href="/gostd/compress/flate/huffman_code.go.html#4827444">i</a></span><span class="op" id="4827520">]</span><span class="op" id="4827521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4827525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4827528">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4827531">return</span>&nbsp;<span class="ident" id="4827538"><a href="/gostd/compress/flate/huffman_code.go.html#4827427">total</a></span><br>
<span class="lineno"></span><span class="op" id="4827544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4827547">const</span>&nbsp;<span class="ident" id="4827553">maxBitsLimit</span>&nbsp;<span class="op" id="4827566">=</span>&nbsp;<span class="num" id="4827568">16</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="4827572">//&nbsp;Return&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;assigned&nbsp;to&nbsp;each&nbsp;bit&nbsp;size&nbsp;in&nbsp;the&nbsp;Huffman&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="4827655">//</span><br>
<span class="lineno"></span><span class="comment" id="4827658">//&nbsp;This&nbsp;method&nbsp;is&nbsp;only&nbsp;called&nbsp;when&nbsp;list.length&nbsp;&gt;=&nbsp;3</span><br>
<span class="lineno"></span><span class="comment" id="4827710">//&nbsp;The&nbsp;cases&nbsp;of&nbsp;0,&nbsp;1,&nbsp;and&nbsp;2&nbsp;literals&nbsp;are&nbsp;handled&nbsp;by&nbsp;special&nbsp;case&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="4827781">//</span><br>
<span class="lineno">115</span><span class="comment" id="4827784">//&nbsp;list&nbsp;&nbsp;An&nbsp;array&nbsp;of&nbsp;the&nbsp;literals&nbsp;with&nbsp;non-zero&nbsp;frequencies</span><br>
<span class="lineno"></span><span class="comment" id="4827844">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;their&nbsp;associated&nbsp;frequencies.&nbsp;&nbsp;The&nbsp;array&nbsp;is&nbsp;in&nbsp;order&nbsp;of&nbsp;increasing</span><br>
<span class="lineno"></span><span class="comment" id="4827930">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;frequency,&nbsp;and&nbsp;has&nbsp;as&nbsp;its&nbsp;last&nbsp;element&nbsp;a&nbsp;special&nbsp;element&nbsp;with&nbsp;frequency</span><br>
<span class="lineno"></span><span class="comment" id="4828017">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MaxInt32</span><br>
<span class="lineno"></span><span class="comment" id="4828041">//&nbsp;maxBits&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;maximum&nbsp;number&nbsp;of&nbsp;bits&nbsp;that&nbsp;should&nbsp;be&nbsp;used&nbsp;to&nbsp;encode&nbsp;any&nbsp;literal.</span><br>
<span class="lineno">120</span><span class="comment" id="4828126">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Must&nbsp;be&nbsp;less&nbsp;than&nbsp;16.</span><br>
<span class="lineno"></span><span class="comment" id="4828163">//&nbsp;return&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;An&nbsp;integer&nbsp;array&nbsp;in&nbsp;which&nbsp;array[i]&nbsp;indicates&nbsp;the&nbsp;number&nbsp;of&nbsp;literals</span><br>
<span class="lineno"></span><span class="comment" id="4828246">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;that&nbsp;should&nbsp;be&nbsp;encoded&nbsp;in&nbsp;i&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="4828295">func</span>&nbsp;<span class="op" id="4828300">(</span><span class="ident" id="4828301">h</span>&nbsp;<span class="op" id="4828303">*</span><span class="ident" id="4828304"><a href="/gostd/compress/flate/huffman_code.go.html#4825350">huffmanEncoder</a></span><span class="op" id="4828318">)</span>&nbsp;<span class="ident" id="4828320">bitCounts</span><span class="op" id="4828329">(</span><span class="ident" id="4828330">list</span>&nbsp;<span class="op" id="4828335">[</span><span class="op" id="4828336">]</span><span class="ident" id="4828337"><a href="/gostd/compress/flate/huffman_code.go.html#4825419">literalNode</a></span><span class="op" id="4828348">,</span>&nbsp;<span class="ident" id="4828350">maxBits</span>&nbsp;<span class="builtintype" id="4828358">int32</span><span class="op" id="4828363">)</span>&nbsp;<span class="op" id="4828365">[</span><span class="op" id="4828366">]</span><span class="builtintype" id="4828367">int32</span>&nbsp;<span class="op" id="4828373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4828376">if</span>&nbsp;<span class="ident" id="4828379"><a href="/gostd/compress/flate/huffman_code.go.html#4828350">maxBits</a></span>&nbsp;<span class="op" id="4828387">&gt;=</span>&nbsp;<span class="ident" id="4828390"><a href="/gostd/compress/flate/huffman_code.go.html#4827553">maxBitsLimit</a></span>&nbsp;<span class="op" id="4828403">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4828407">panic</span><span class="op" id="4828412">(</span><span class="string" id="4828413">&#34;flate:&nbsp;maxBits&nbsp;too&nbsp;large&#34;</span><span class="op" id="4828439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4828442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4828445">n</span>&nbsp;<span class="op" id="4828447">:=</span>&nbsp;<span class="builtintype" id="4828450">int32</span><span class="op" id="4828455">(</span><span class="builtinfunc" id="4828456">len</span><span class="op" id="4828459">(</span><span class="ident" id="4828460"><a href="/gostd/compress/flate/huffman_code.go.html#4828330">list</a></span><span class="op" id="4828464">)</span><span class="op" id="4828465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4828468"><a href="/gostd/compress/flate/huffman_code.go.html#4828330">list</a></span>&nbsp;<span class="op" id="4828473">=</span>&nbsp;<span class="ident" id="4828475"><a href="/gostd/compress/flate/huffman_code.go.html#4828330">list</a></span><span class="op" id="4828479">[</span><span class="num" id="4828480">0</span>&nbsp;<span class="op" id="4828482">:</span>&nbsp;<span class="ident" id="4828484"><a href="/gostd/compress/flate/huffman_code.go.html#4828445">n</a></span><span class="op" id="4828485">+</span><span class="num" id="4828486">1</span><span class="op" id="4828487">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4828490"><a href="/gostd/compress/flate/huffman_code.go.html#4828330">list</a></span><span class="op" id="4828494">[</span><span class="ident" id="4828495"><a href="/gostd/compress/flate/huffman_code.go.html#4828445">n</a></span><span class="op" id="4828496">]</span>&nbsp;<span class="op" id="4828498">=</span>&nbsp;<span class="ident" id="4828500"><a href="/gostd/compress/flate/huffman_code.go.html#4826061">maxNode</a></span><span class="op" id="4828507">(</span><span class="op" id="4828508">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4828512">//&nbsp;The&nbsp;tree&nbsp;can&#39;t&nbsp;have&nbsp;greater&nbsp;depth&nbsp;than&nbsp;n&nbsp;-&nbsp;1,&nbsp;no&nbsp;matter&nbsp;what.&nbsp;&nbsp;This</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4828584">//&nbsp;saves&nbsp;a&nbsp;little&nbsp;bit&nbsp;of&nbsp;work&nbsp;in&nbsp;some&nbsp;small&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4828635">if</span>&nbsp;<span class="ident" id="4828638"><a href="/gostd/compress/flate/huffman_code.go.html#4828350">maxBits</a></span>&nbsp;<span class="op" id="4828646">&gt;</span>&nbsp;<span class="ident" id="4828648"><a href="/gostd/compress/flate/huffman_code.go.html#4828445">n</a></span><span class="op" id="4828649">-</span><span class="num" id="4828650">1</span>&nbsp;<span class="op" id="4828652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4828656"><a href="/gostd/compress/flate/huffman_code.go.html#4828350">maxBits</a></span>&nbsp;<span class="op" id="4828664">=</span>&nbsp;<span class="ident" id="4828666"><a href="/gostd/compress/flate/huffman_code.go.html#4828445">n</a></span>&nbsp;<span class="op" id="4828668">-</span>&nbsp;<span class="num" id="4828670">1</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4828673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4828677">//&nbsp;Create&nbsp;information&nbsp;about&nbsp;each&nbsp;of&nbsp;the&nbsp;levels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4828726">//&nbsp;A&nbsp;bogus&nbsp;&#34;Level&nbsp;0&#34;&nbsp;whose&nbsp;sole&nbsp;purpose&nbsp;is&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4828778">//&nbsp;level1.prev.needed==0.&nbsp;&nbsp;This&nbsp;makes&nbsp;level1.nextPairFreq</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4828837">//&nbsp;be&nbsp;a&nbsp;legitimate&nbsp;value&nbsp;that&nbsp;never&nbsp;gets&nbsp;chosen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4828887">var</span>&nbsp;<span class="ident" id="4828891">levels</span>&nbsp;<span class="op" id="4828898">[</span><span class="ident" id="4828899"><a href="/gostd/compress/flate/huffman_code.go.html#4827553">maxBitsLimit</a></span><span class="op" id="4828911">]</span><span class="ident" id="4828912"><a href="/gostd/compress/flate/huffman_code.go.html#4825557">levelInfo</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4828923">//&nbsp;leafCounts[i]&nbsp;counts&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;at&nbsp;the&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4828983">//&nbsp;of&nbsp;ancestors&nbsp;of&nbsp;the&nbsp;rightmost&nbsp;node&nbsp;at&nbsp;level&nbsp;i.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4829034">//&nbsp;leafCounts[i][j]&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;at&nbsp;the&nbsp;left</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4829093">//&nbsp;of&nbsp;the&nbsp;level&nbsp;j&nbsp;ancestor.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4829122">var</span>&nbsp;<span class="ident" id="4829126">leafCounts</span>&nbsp;<span class="op" id="4829137">[</span><span class="ident" id="4829138"><a href="/gostd/compress/flate/huffman_code.go.html#4827553">maxBitsLimit</a></span><span class="op" id="4829150">]</span><span class="op" id="4829151">[</span><span class="ident" id="4829152"><a href="/gostd/compress/flate/huffman_code.go.html#4827553">maxBitsLimit</a></span><span class="op" id="4829164">]</span><span class="builtintype" id="4829165">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4829173">for</span>&nbsp;<span class="ident" id="4829177">level</span>&nbsp;<span class="op" id="4829183">:=</span>&nbsp;<span class="builtintype" id="4829186">int32</span><span class="op" id="4829191">(</span><span class="num" id="4829192">1</span><span class="op" id="4829193">)</span><span class="op" id="4829194">;</span>&nbsp;<span class="ident" id="4829196"><a href="/gostd/compress/flate/huffman_code.go.html#4829177">level</a></span>&nbsp;<span class="op" id="4829202">&lt;=</span>&nbsp;<span class="ident" id="4829205"><a href="/gostd/compress/flate/huffman_code.go.html#4828350">maxBits</a></span><span class="op" id="4829212">;</span>&nbsp;<span class="ident" id="4829214"><a href="/gostd/compress/flate/huffman_code.go.html#4829177">level</a></span><span class="op" id="4829219">++</span>&nbsp;<span class="op" id="4829222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4829226">//&nbsp;For&nbsp;every&nbsp;level,&nbsp;the&nbsp;first&nbsp;two&nbsp;items&nbsp;are&nbsp;the&nbsp;first&nbsp;two&nbsp;characters.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4829298">//&nbsp;We&nbsp;initialize&nbsp;the&nbsp;levels&nbsp;as&nbsp;if&nbsp;we&nbsp;had&nbsp;already&nbsp;figured&nbsp;this&nbsp;out.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4829367"><a href="/gostd/compress/flate/huffman_code.go.html#4828891">levels</a></span><span class="op" id="4829373">[</span><span class="ident" id="4829374"><a href="/gostd/compress/flate/huffman_code.go.html#4829177">level</a></span><span class="op" id="4829379">]</span>&nbsp;<span class="op" id="4829381">=</span>&nbsp;<span class="ident" id="4829383"><a href="/gostd/compress/flate/huffman_code.go.html#4825557">levelInfo</a></span><span class="op" id="4829392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4829397"><a href="/gostd/compress/flate/huffman_code.go.html#4825613">level</a></span><span class="op" id="4829402">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4829411"><a href="/gostd/compress/flate/huffman_code.go.html#4829177">level</a></span><span class="op" id="4829416">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4829421"><a href="/gostd/compress/flate/huffman_code.go.html#4825676">lastFreq</a></span><span class="op" id="4829429">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4829435"><a href="/gostd/compress/flate/huffman_code.go.html#4828330">list</a></span><span class="op" id="4829439">[</span><span class="num" id="4829440">1</span><span class="op" id="4829441">]</span><span class="op" id="4829442">.</span><span class="ident" id="4829443"><a href="/gostd/compress/flate/huffman_code.go.html#4825457">freq</a></span><span class="op" id="4829447">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4829452"><a href="/gostd/compress/flate/huffman_code.go.html#4825754">nextCharFreq</a></span><span class="op" id="4829464">:</span>&nbsp;<span class="ident" id="4829466"><a href="/gostd/compress/flate/huffman_code.go.html#4828330">list</a></span><span class="op" id="4829470">[</span><span class="num" id="4829471">2</span><span class="op" id="4829472">]</span><span class="op" id="4829473">.</span><span class="ident" id="4829474"><a href="/gostd/compress/flate/huffman_code.go.html#4825457">freq</a></span><span class="op" id="4829478">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4829483"><a href="/gostd/compress/flate/huffman_code.go.html#4825918">nextPairFreq</a></span><span class="op" id="4829495">:</span>&nbsp;<span class="ident" id="4829497"><a href="/gostd/compress/flate/huffman_code.go.html#4828330">list</a></span><span class="op" id="4829501">[</span><span class="num" id="4829502">0</span><span class="op" id="4829503">]</span><span class="op" id="4829504">.</span><span class="ident" id="4829505"><a href="/gostd/compress/flate/huffman_code.go.html#4825457">freq</a></span>&nbsp;<span class="op" id="4829510">+</span>&nbsp;<span class="ident" id="4829512"><a href="/gostd/compress/flate/huffman_code.go.html#4828330">list</a></span><span class="op" id="4829516">[</span><span class="num" id="4829517">1</span><span class="op" id="4829518">]</span><span class="op" id="4829519">.</span><span class="ident" id="4829520"><a href="/gostd/compress/flate/huffman_code.go.html#4825457">freq</a></span><span class="op" id="4829524">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4829528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4829532"><a href="/gostd/compress/flate/huffman_code.go.html#4829126">leafCounts</a></span><span class="op" id="4829542">[</span><span class="ident" id="4829543"><a href="/gostd/compress/flate/huffman_code.go.html#4829177">level</a></span><span class="op" id="4829548">]</span><span class="op" id="4829549">[</span><span class="ident" id="4829550"><a href="/gostd/compress/flate/huffman_code.go.html#4829177">level</a></span><span class="op" id="4829555">]</span>&nbsp;<span class="op" id="4829557">=</span>&nbsp;<span class="num" id="4829559">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4829563">if</span>&nbsp;<span class="ident" id="4829566"><a href="/gostd/compress/flate/huffman_code.go.html#4829177">level</a></span>&nbsp;<span class="op" id="4829572">==</span>&nbsp;<span class="num" id="4829575">1</span>&nbsp;<span class="op" id="4829577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4829582"><a href="/gostd/compress/flate/huffman_code.go.html#4828891">levels</a></span><span class="op" id="4829588">[</span><span class="ident" id="4829589"><a href="/gostd/compress/flate/huffman_code.go.html#4829177">level</a></span><span class="op" id="4829594">]</span><span class="op" id="4829595">.</span><span class="ident" id="4829596"><a href="/gostd/compress/flate/huffman_code.go.html#4825918">nextPairFreq</a></span>&nbsp;<span class="op" id="4829609">=</span>&nbsp;<span class="ident" id="4829611"><a href="/gostd/compress/flate/huffman_code.go.html#4825327">math</a></span><span class="op" id="4829615">.</span><span class="ident" id="4829616"><a href="/gostd/math/const.go.html#2216030">MaxInt32</a></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4829627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4829630">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4829634">//&nbsp;We&nbsp;need&nbsp;a&nbsp;total&nbsp;of&nbsp;2*n&nbsp;-&nbsp;2&nbsp;items&nbsp;at&nbsp;top&nbsp;level&nbsp;and&nbsp;have&nbsp;already&nbsp;generated&nbsp;2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4829714"><a href="/gostd/compress/flate/huffman_code.go.html#4828891">levels</a></span><span class="op" id="4829720">[</span><span class="ident" id="4829721"><a href="/gostd/compress/flate/huffman_code.go.html#4828350">maxBits</a></span><span class="op" id="4829728">]</span><span class="op" id="4829729">.</span><span class="ident" id="4829730"><a href="/gostd/compress/flate/huffman_code.go.html#4826040">needed</a></span>&nbsp;<span class="op" id="4829737">=</span>&nbsp;<span class="num" id="4829739">2</span><span class="op" id="4829740">*</span><span class="ident" id="4829741"><a href="/gostd/compress/flate/huffman_code.go.html#4828445">n</a></span>&nbsp;<span class="op" id="4829743">-</span>&nbsp;<span class="num" id="4829745">4</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4829749">level</span>&nbsp;<span class="op" id="4829755">:=</span>&nbsp;<span class="ident" id="4829758"><a href="/gostd/compress/flate/huffman_code.go.html#4828350">maxBits</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4829767">for</span>&nbsp;<span class="op" id="4829771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4829775">l</span>&nbsp;<span class="op" id="4829777">:=</span>&nbsp;<span class="op" id="4829780">&amp;</span><span class="ident" id="4829781"><a href="/gostd/compress/flate/huffman_code.go.html#4828891">levels</a></span><span class="op" id="4829787">[</span><span class="ident" id="4829788"><a href="/gostd/compress/flate/huffman_code.go.html#4829749">level</a></span><span class="op" id="4829793">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4829797">if</span>&nbsp;<span class="ident" id="4829800"><a href="/gostd/compress/flate/huffman_code.go.html#4829775">l</a></span><span class="op" id="4829801">.</span><span class="ident" id="4829802"><a href="/gostd/compress/flate/huffman_code.go.html#4825918">nextPairFreq</a></span>&nbsp;<span class="op" id="4829815">==</span>&nbsp;<span class="ident" id="4829818"><a href="/gostd/compress/flate/huffman_code.go.html#4825327">math</a></span><span class="op" id="4829822">.</span><span class="ident" id="4829823"><a href="/gostd/math/const.go.html#2216030">MaxInt32</a></span>&nbsp;<span class="op" id="4829832">&amp;&amp;</span>&nbsp;<span class="ident" id="4829835"><a href="/gostd/compress/flate/huffman_code.go.html#4829775">l</a></span><span class="op" id="4829836">.</span><span class="ident" id="4829837"><a href="/gostd/compress/flate/huffman_code.go.html#4825754">nextCharFreq</a></span>&nbsp;<span class="op" id="4829850">==</span>&nbsp;<span class="ident" id="4829853"><a href="/gostd/compress/flate/huffman_code.go.html#4825327">math</a></span><span class="op" id="4829857">.</span><span class="ident" id="4829858"><a href="/gostd/math/const.go.html#2216030">MaxInt32</a></span>&nbsp;<span class="op" id="4829867">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4829872">//&nbsp;We&#39;ve&nbsp;run&nbsp;out&nbsp;of&nbsp;both&nbsp;leafs&nbsp;and&nbsp;pairs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4829917">//&nbsp;End&nbsp;all&nbsp;calculations&nbsp;for&nbsp;this&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4829960">//&nbsp;To&nbsp;make&nbsp;sure&nbsp;we&nbsp;never&nbsp;come&nbsp;back&nbsp;to&nbsp;this&nbsp;level&nbsp;or&nbsp;any&nbsp;lower&nbsp;level,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4830032">//&nbsp;set&nbsp;nextPairFreq&nbsp;impossibly&nbsp;large.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4830073"><a href="/gostd/compress/flate/huffman_code.go.html#4829775">l</a></span><span class="op" id="4830074">.</span><span class="ident" id="4830075"><a href="/gostd/compress/flate/huffman_code.go.html#4826040">needed</a></span>&nbsp;<span class="op" id="4830082">=</span>&nbsp;<span class="num" id="4830084">0</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4830089"><a href="/gostd/compress/flate/huffman_code.go.html#4828891">levels</a></span><span class="op" id="4830095">[</span><span class="ident" id="4830096"><a href="/gostd/compress/flate/huffman_code.go.html#4829749">level</a></span><span class="op" id="4830101">+</span><span class="num" id="4830102">1</span><span class="op" id="4830103">]</span><span class="op" id="4830104">.</span><span class="ident" id="4830105"><a href="/gostd/compress/flate/huffman_code.go.html#4825918">nextPairFreq</a></span>&nbsp;<span class="op" id="4830118">=</span>&nbsp;<span class="ident" id="4830120"><a href="/gostd/compress/flate/huffman_code.go.html#4825327">math</a></span><span class="op" id="4830124">.</span><span class="ident" id="4830125"><a href="/gostd/math/const.go.html#2216030">MaxInt32</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4830137"><a href="/gostd/compress/flate/huffman_code.go.html#4829749">level</a></span><span class="op" id="4830142">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4830148">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4830159">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4830164">prevFreq</span>&nbsp;<span class="op" id="4830173">:=</span>&nbsp;<span class="ident" id="4830176"><a href="/gostd/compress/flate/huffman_code.go.html#4829775">l</a></span><span class="op" id="4830177">.</span><span class="ident" id="4830178"><a href="/gostd/compress/flate/huffman_code.go.html#4825676">lastFreq</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4830189">if</span>&nbsp;<span class="ident" id="4830192"><a href="/gostd/compress/flate/huffman_code.go.html#4829775">l</a></span><span class="op" id="4830193">.</span><span class="ident" id="4830194"><a href="/gostd/compress/flate/huffman_code.go.html#4825754">nextCharFreq</a></span>&nbsp;<span class="op" id="4830207">&lt;</span>&nbsp;<span class="ident" id="4830209"><a href="/gostd/compress/flate/huffman_code.go.html#4829775">l</a></span><span class="op" id="4830210">.</span><span class="ident" id="4830211"><a href="/gostd/compress/flate/huffman_code.go.html#4825918">nextPairFreq</a></span>&nbsp;<span class="op" id="4830224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4830229">//&nbsp;The&nbsp;next&nbsp;item&nbsp;on&nbsp;this&nbsp;row&nbsp;is&nbsp;a&nbsp;leaf&nbsp;node.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4830277">n</span>&nbsp;<span class="op" id="4830279">:=</span>&nbsp;<span class="ident" id="4830282"><a href="/gostd/compress/flate/huffman_code.go.html#4829126">leafCounts</a></span><span class="op" id="4830292">[</span><span class="ident" id="4830293"><a href="/gostd/compress/flate/huffman_code.go.html#4829749">level</a></span><span class="op" id="4830298">]</span><span class="op" id="4830299">[</span><span class="ident" id="4830300"><a href="/gostd/compress/flate/huffman_code.go.html#4829749">level</a></span><span class="op" id="4830305">]</span>&nbsp;<span class="op" id="4830307">+</span>&nbsp;<span class="num" id="4830309">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4830314"><a href="/gostd/compress/flate/huffman_code.go.html#4829775">l</a></span><span class="op" id="4830315">.</span><span class="ident" id="4830316"><a href="/gostd/compress/flate/huffman_code.go.html#4825676">lastFreq</a></span>&nbsp;<span class="op" id="4830325">=</span>&nbsp;<span class="ident" id="4830327"><a href="/gostd/compress/flate/huffman_code.go.html#4829775">l</a></span><span class="op" id="4830328">.</span><span class="ident" id="4830329"><a href="/gostd/compress/flate/huffman_code.go.html#4825754">nextCharFreq</a></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4830345">//&nbsp;Lower&nbsp;leafCounts&nbsp;are&nbsp;the&nbsp;same&nbsp;of&nbsp;the&nbsp;previous&nbsp;node.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4830403"><a href="/gostd/compress/flate/huffman_code.go.html#4829126">leafCounts</a></span><span class="op" id="4830413">[</span><span class="ident" id="4830414"><a href="/gostd/compress/flate/huffman_code.go.html#4829749">level</a></span><span class="op" id="4830419">]</span><span class="op" id="4830420">[</span><span class="ident" id="4830421"><a href="/gostd/compress/flate/huffman_code.go.html#4829749">level</a></span><span class="op" id="4830426">]</span>&nbsp;<span class="op" id="4830428">=</span>&nbsp;<span class="ident" id="4830430"><a href="/gostd/compress/flate/huffman_code.go.html#4830277">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4830435"><a href="/gostd/compress/flate/huffman_code.go.html#4829775">l</a></span><span class="op" id="4830436">.</span><span class="ident" id="4830437"><a href="/gostd/compress/flate/huffman_code.go.html#4825754">nextCharFreq</a></span>&nbsp;<span class="op" id="4830450">=</span>&nbsp;<span class="ident" id="4830452"><a href="/gostd/compress/flate/huffman_code.go.html#4828330">list</a></span><span class="op" id="4830456">[</span><span class="ident" id="4830457"><a href="/gostd/compress/flate/huffman_code.go.html#4830277">n</a></span><span class="op" id="4830458">]</span><span class="op" id="4830459">.</span><span class="ident" id="4830460"><a href="/gostd/compress/flate/huffman_code.go.html#4825457">freq</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4830467">}</span>&nbsp;<span class="keyword" id="4830469">else</span>&nbsp;<span class="op" id="4830474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4830479">//&nbsp;The&nbsp;next&nbsp;item&nbsp;on&nbsp;this&nbsp;row&nbsp;is&nbsp;a&nbsp;pair&nbsp;from&nbsp;the&nbsp;previous&nbsp;row.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4830544">//&nbsp;nextPairFreq&nbsp;isn&#39;t&nbsp;valid&nbsp;until&nbsp;we&nbsp;generate&nbsp;two</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4830597">//&nbsp;more&nbsp;values&nbsp;in&nbsp;the&nbsp;level&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4830634"><a href="/gostd/compress/flate/huffman_code.go.html#4829775">l</a></span><span class="op" id="4830635">.</span><span class="ident" id="4830636"><a href="/gostd/compress/flate/huffman_code.go.html#4825676">lastFreq</a></span>&nbsp;<span class="op" id="4830645">=</span>&nbsp;<span class="ident" id="4830647"><a href="/gostd/compress/flate/huffman_code.go.html#4829775">l</a></span><span class="op" id="4830648">.</span><span class="ident" id="4830649"><a href="/gostd/compress/flate/huffman_code.go.html#4825918">nextPairFreq</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4830665">//&nbsp;Take&nbsp;leaf&nbsp;counts&nbsp;from&nbsp;the&nbsp;lower&nbsp;level,&nbsp;except&nbsp;counts[level]&nbsp;remains&nbsp;the&nbsp;same.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4830749">copy</span><span class="op" id="4830753">(</span><span class="ident" id="4830754"><a href="/gostd/compress/flate/huffman_code.go.html#4829126">leafCounts</a></span><span class="op" id="4830764">[</span><span class="ident" id="4830765"><a href="/gostd/compress/flate/huffman_code.go.html#4829749">level</a></span><span class="op" id="4830770">]</span><span class="op" id="4830771">[</span><span class="op" id="4830772">:</span><span class="ident" id="4830773"><a href="/gostd/compress/flate/huffman_code.go.html#4829749">level</a></span><span class="op" id="4830778">]</span><span class="op" id="4830779">,</span>&nbsp;<span class="ident" id="4830781"><a href="/gostd/compress/flate/huffman_code.go.html#4829126">leafCounts</a></span><span class="op" id="4830791">[</span><span class="ident" id="4830792"><a href="/gostd/compress/flate/huffman_code.go.html#4829749">level</a></span><span class="op" id="4830797">-</span><span class="num" id="4830798">1</span><span class="op" id="4830799">]</span><span class="op" id="4830800">[</span><span class="op" id="4830801">:</span><span class="ident" id="4830802"><a href="/gostd/compress/flate/huffman_code.go.html#4829749">level</a></span><span class="op" id="4830807">]</span><span class="op" id="4830808">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4830813"><a href="/gostd/compress/flate/huffman_code.go.html#4828891">levels</a></span><span class="op" id="4830819">[</span><span class="ident" id="4830820"><a href="/gostd/compress/flate/huffman_code.go.html#4829775">l</a></span><span class="op" id="4830821">.</span><span class="ident" id="4830822"><a href="/gostd/compress/flate/huffman_code.go.html#4825613">level</a></span><span class="op" id="4830827">-</span><span class="num" id="4830828">1</span><span class="op" id="4830829">]</span><span class="op" id="4830830">.</span><span class="ident" id="4830831"><a href="/gostd/compress/flate/huffman_code.go.html#4826040">needed</a></span>&nbsp;<span class="op" id="4830838">=</span>&nbsp;<span class="num" id="4830840">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4830844">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4830849">if</span>&nbsp;<span class="ident" id="4830852"><a href="/gostd/compress/flate/huffman_code.go.html#4829775">l</a></span><span class="op" id="4830853">.</span><span class="ident" id="4830854"><a href="/gostd/compress/flate/huffman_code.go.html#4826040">needed</a></span><span class="op" id="4830860">--</span><span class="op" id="4830862">;</span>&nbsp;<span class="ident" id="4830864"><a href="/gostd/compress/flate/huffman_code.go.html#4829775">l</a></span><span class="op" id="4830865">.</span><span class="ident" id="4830866"><a href="/gostd/compress/flate/huffman_code.go.html#4826040">needed</a></span>&nbsp;<span class="op" id="4830873">==</span>&nbsp;<span class="num" id="4830876">0</span>&nbsp;<span class="op" id="4830878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4830883">//&nbsp;We&#39;ve&nbsp;done&nbsp;everything&nbsp;we&nbsp;need&nbsp;to&nbsp;do&nbsp;for&nbsp;this&nbsp;level.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4830941">//&nbsp;Continue&nbsp;calculating&nbsp;one&nbsp;level&nbsp;up.&nbsp;&nbsp;Fill&nbsp;in&nbsp;nextPairFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4831004">//&nbsp;of&nbsp;that&nbsp;level&nbsp;with&nbsp;the&nbsp;sum&nbsp;of&nbsp;the&nbsp;two&nbsp;nodes&nbsp;we&#39;ve&nbsp;just&nbsp;calculated&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4831079">//&nbsp;this&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4831097">if</span>&nbsp;<span class="ident" id="4831100"><a href="/gostd/compress/flate/huffman_code.go.html#4829775">l</a></span><span class="op" id="4831101">.</span><span class="ident" id="4831102"><a href="/gostd/compress/flate/huffman_code.go.html#4825613">level</a></span>&nbsp;<span class="op" id="4831108">==</span>&nbsp;<span class="ident" id="4831111"><a href="/gostd/compress/flate/huffman_code.go.html#4828350">maxBits</a></span>&nbsp;<span class="op" id="4831119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4831125">//&nbsp;All&nbsp;done!</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4831142">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4831151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4831156"><a href="/gostd/compress/flate/huffman_code.go.html#4828891">levels</a></span><span class="op" id="4831162">[</span><span class="ident" id="4831163"><a href="/gostd/compress/flate/huffman_code.go.html#4829775">l</a></span><span class="op" id="4831164">.</span><span class="ident" id="4831165"><a href="/gostd/compress/flate/huffman_code.go.html#4825613">level</a></span><span class="op" id="4831170">+</span><span class="num" id="4831171">1</span><span class="op" id="4831172">]</span><span class="op" id="4831173">.</span><span class="ident" id="4831174"><a href="/gostd/compress/flate/huffman_code.go.html#4825918">nextPairFreq</a></span>&nbsp;<span class="op" id="4831187">=</span>&nbsp;<span class="ident" id="4831189"><a href="/gostd/compress/flate/huffman_code.go.html#4830164">prevFreq</a></span>&nbsp;<span class="op" id="4831198">+</span>&nbsp;<span class="ident" id="4831200"><a href="/gostd/compress/flate/huffman_code.go.html#4829775">l</a></span><span class="op" id="4831201">.</span><span class="ident" id="4831202"><a href="/gostd/compress/flate/huffman_code.go.html#4825676">lastFreq</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4831214"><a href="/gostd/compress/flate/huffman_code.go.html#4829749">level</a></span><span class="op" id="4831219">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4831224">}</span>&nbsp;<span class="keyword" id="4831226">else</span>&nbsp;<span class="op" id="4831231">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4831236">//&nbsp;If&nbsp;we&nbsp;stole&nbsp;from&nbsp;below,&nbsp;move&nbsp;down&nbsp;temporarily&nbsp;to&nbsp;replenish&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4831305">for</span>&nbsp;<span class="ident" id="4831309"><a href="/gostd/compress/flate/huffman_code.go.html#4828891">levels</a></span><span class="op" id="4831315">[</span><span class="ident" id="4831316"><a href="/gostd/compress/flate/huffman_code.go.html#4829749">level</a></span><span class="op" id="4831321">-</span><span class="num" id="4831322">1</span><span class="op" id="4831323">]</span><span class="op" id="4831324">.</span><span class="ident" id="4831325"><a href="/gostd/compress/flate/huffman_code.go.html#4826040">needed</a></span>&nbsp;<span class="op" id="4831332">&gt;</span>&nbsp;<span class="num" id="4831334">0</span>&nbsp;<span class="op" id="4831336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4831342"><a href="/gostd/compress/flate/huffman_code.go.html#4829749">level</a></span><span class="op" id="4831347">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4831353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4831357">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4831360">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4831364">//&nbsp;Somethings&nbsp;is&nbsp;wrong&nbsp;if&nbsp;at&nbsp;the&nbsp;end,&nbsp;the&nbsp;top&nbsp;level&nbsp;is&nbsp;null&nbsp;or&nbsp;hasn&#39;t&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4831440">//&nbsp;all&nbsp;of&nbsp;the&nbsp;leaves.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4831463">if</span>&nbsp;<span class="ident" id="4831466"><a href="/gostd/compress/flate/huffman_code.go.html#4829126">leafCounts</a></span><span class="op" id="4831476">[</span><span class="ident" id="4831477"><a href="/gostd/compress/flate/huffman_code.go.html#4828350">maxBits</a></span><span class="op" id="4831484">]</span><span class="op" id="4831485">[</span><span class="ident" id="4831486"><a href="/gostd/compress/flate/huffman_code.go.html#4828350">maxBits</a></span><span class="op" id="4831493">]</span>&nbsp;<span class="op" id="4831495">!=</span>&nbsp;<span class="ident" id="4831498"><a href="/gostd/compress/flate/huffman_code.go.html#4828445">n</a></span>&nbsp;<span class="op" id="4831500">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4831504">panic</span><span class="op" id="4831509">(</span><span class="string" id="4831510">&#34;leafCounts[maxBits][maxBits]&nbsp;!=&nbsp;n&#34;</span><span class="op" id="4831545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4831548">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4831552">bitCount</span>&nbsp;<span class="op" id="4831561">:=</span>&nbsp;<span class="builtinfunc" id="4831564">make</span><span class="op" id="4831568">(</span><span class="op" id="4831569">[</span><span class="op" id="4831570">]</span><span class="builtintype" id="4831571">int32</span><span class="op" id="4831576">,</span>&nbsp;<span class="ident" id="4831578"><a href="/gostd/compress/flate/huffman_code.go.html#4828350">maxBits</a></span><span class="op" id="4831585">+</span><span class="num" id="4831586">1</span><span class="op" id="4831587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4831590">bits</span>&nbsp;<span class="op" id="4831595">:=</span>&nbsp;<span class="num" id="4831598">1</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4831601">counts</span>&nbsp;<span class="op" id="4831608">:=</span>&nbsp;<span class="op" id="4831611">&amp;</span><span class="ident" id="4831612"><a href="/gostd/compress/flate/huffman_code.go.html#4829126">leafCounts</a></span><span class="op" id="4831622">[</span><span class="ident" id="4831623"><a href="/gostd/compress/flate/huffman_code.go.html#4828350">maxBits</a></span><span class="op" id="4831630">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4831633">for</span>&nbsp;<span class="ident" id="4831637">level</span>&nbsp;<span class="op" id="4831643">:=</span>&nbsp;<span class="ident" id="4831646"><a href="/gostd/compress/flate/huffman_code.go.html#4828350">maxBits</a></span><span class="op" id="4831653">;</span>&nbsp;<span class="ident" id="4831655"><a href="/gostd/compress/flate/huffman_code.go.html#4831637">level</a></span>&nbsp;<span class="op" id="4831661">&gt;</span>&nbsp;<span class="num" id="4831663">0</span><span class="op" id="4831664">;</span>&nbsp;<span class="ident" id="4831666"><a href="/gostd/compress/flate/huffman_code.go.html#4831637">level</a></span><span class="op" id="4831671">--</span>&nbsp;<span class="op" id="4831674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4831678">//&nbsp;chain.leafCount&nbsp;gives&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;requiring&nbsp;at&nbsp;least&nbsp;&#34;bits&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4831754">//&nbsp;bits&nbsp;to&nbsp;encode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4831775"><a href="/gostd/compress/flate/huffman_code.go.html#4831552">bitCount</a></span><span class="op" id="4831783">[</span><span class="ident" id="4831784"><a href="/gostd/compress/flate/huffman_code.go.html#4831590">bits</a></span><span class="op" id="4831788">]</span>&nbsp;<span class="op" id="4831790">=</span>&nbsp;<span class="ident" id="4831792"><a href="/gostd/compress/flate/huffman_code.go.html#4831601">counts</a></span><span class="op" id="4831798">[</span><span class="ident" id="4831799"><a href="/gostd/compress/flate/huffman_code.go.html#4831637">level</a></span><span class="op" id="4831804">]</span>&nbsp;<span class="op" id="4831806">-</span>&nbsp;<span class="ident" id="4831808"><a href="/gostd/compress/flate/huffman_code.go.html#4831601">counts</a></span><span class="op" id="4831814">[</span><span class="ident" id="4831815"><a href="/gostd/compress/flate/huffman_code.go.html#4831637">level</a></span><span class="op" id="4831820">-</span><span class="num" id="4831821">1</span><span class="op" id="4831822">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4831826"><a href="/gostd/compress/flate/huffman_code.go.html#4831590">bits</a></span><span class="op" id="4831830">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4831834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4831837">return</span>&nbsp;<span class="ident" id="4831844"><a href="/gostd/compress/flate/huffman_code.go.html#4831552">bitCount</a></span><br>
<span class="lineno"></span><span class="op" id="4831853">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="comment" id="4831856">//&nbsp;Look&nbsp;at&nbsp;the&nbsp;leaves&nbsp;and&nbsp;assign&nbsp;them&nbsp;a&nbsp;bit&nbsp;count&nbsp;and&nbsp;an&nbsp;encoding&nbsp;as&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="4831935">//&nbsp;in&nbsp;RFC&nbsp;1951&nbsp;3.2.2</span><br>
<span class="lineno"></span><span class="keyword" id="4831956">func</span>&nbsp;<span class="op" id="4831961">(</span><span class="ident" id="4831962">h</span>&nbsp;<span class="op" id="4831964">*</span><span class="ident" id="4831965"><a href="/gostd/compress/flate/huffman_code.go.html#4825350">huffmanEncoder</a></span><span class="op" id="4831979">)</span>&nbsp;<span class="ident" id="4831981">assignEncodingAndSize</span><span class="op" id="4832002">(</span><span class="ident" id="4832003">bitCount</span>&nbsp;<span class="op" id="4832012">[</span><span class="op" id="4832013">]</span><span class="builtintype" id="4832014">int32</span><span class="op" id="4832019">,</span>&nbsp;<span class="ident" id="4832021">list</span>&nbsp;<span class="op" id="4832026">[</span><span class="op" id="4832027">]</span><span class="ident" id="4832028"><a href="/gostd/compress/flate/huffman_code.go.html#4825419">literalNode</a></span><span class="op" id="4832039">)</span>&nbsp;<span class="op" id="4832041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4832044">code</span>&nbsp;<span class="op" id="4832049">:=</span>&nbsp;<span class="builtintype" id="4832052">uint16</span><span class="op" id="4832058">(</span><span class="num" id="4832059">0</span><span class="op" id="4832060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4832063">for</span>&nbsp;<span class="ident" id="4832067">n</span><span class="op" id="4832068">,</span>&nbsp;<span class="ident" id="4832070">bits</span>&nbsp;<span class="op" id="4832075">:=</span>&nbsp;<span class="keyword" id="4832078">range</span>&nbsp;<span class="ident" id="4832084"><a href="/gostd/compress/flate/huffman_code.go.html#4832003">bitCount</a></span>&nbsp;<span class="op" id="4832093">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4832097"><a href="/gostd/compress/flate/huffman_code.go.html#4832044">code</a></span>&nbsp;<span class="op" id="4832102">&lt;&lt;=</span>&nbsp;<span class="num" id="4832106">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4832110">if</span>&nbsp;<span class="ident" id="4832113"><a href="/gostd/compress/flate/huffman_code.go.html#4832067">n</a></span>&nbsp;<span class="op" id="4832115">==</span>&nbsp;<span class="num" id="4832118">0</span>&nbsp;<span class="op" id="4832120">||</span>&nbsp;<span class="ident" id="4832123"><a href="/gostd/compress/flate/huffman_code.go.html#4832070">bits</a></span>&nbsp;<span class="op" id="4832128">==</span>&nbsp;<span class="num" id="4832131">0</span>&nbsp;<span class="op" id="4832133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4832138">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4832149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4832153">//&nbsp;The&nbsp;literals&nbsp;list[len(list)-bits]&nbsp;..&nbsp;list[len(list)-bits]</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4832216">//&nbsp;are&nbsp;encoded&nbsp;using&nbsp;&#34;bits&#34;&nbsp;bits,&nbsp;and&nbsp;get&nbsp;the&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4832271">//&nbsp;code,&nbsp;code&nbsp;+&nbsp;1,&nbsp;....&nbsp;&nbsp;The&nbsp;code&nbsp;values&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4832318">//&nbsp;assigned&nbsp;in&nbsp;literal&nbsp;order&nbsp;(not&nbsp;frequency&nbsp;order).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4832372">chunk</span>&nbsp;<span class="op" id="4832378">:=</span>&nbsp;<span class="ident" id="4832381"><a href="/gostd/compress/flate/huffman_code.go.html#4832021">list</a></span><span class="op" id="4832385">[</span><span class="builtinfunc" id="4832386">len</span><span class="op" id="4832389">(</span><span class="ident" id="4832390"><a href="/gostd/compress/flate/huffman_code.go.html#4832021">list</a></span><span class="op" id="4832394">)</span><span class="op" id="4832395">-</span><span class="builtintype" id="4832396">int</span><span class="op" id="4832399">(</span><span class="ident" id="4832400"><a href="/gostd/compress/flate/huffman_code.go.html#4832070">bits</a></span><span class="op" id="4832404">)</span><span class="op" id="4832405">:</span><span class="op" id="4832406">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4832410"><a href="/gostd/compress/flate/huffman_code.go.html#4834376">sortByLiteral</a></span><span class="op" id="4832423">(</span><span class="ident" id="4832424"><a href="/gostd/compress/flate/huffman_code.go.html#4832372">chunk</a></span><span class="op" id="4832429">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4832433">for</span>&nbsp;<span class="ident" id="4832437">_</span><span class="op" id="4832438">,</span>&nbsp;<span class="ident" id="4832440">node</span>&nbsp;<span class="op" id="4832445">:=</span>&nbsp;<span class="keyword" id="4832448">range</span>&nbsp;<span class="ident" id="4832454"><a href="/gostd/compress/flate/huffman_code.go.html#4832372">chunk</a></span>&nbsp;<span class="op" id="4832460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4832465"><a href="/gostd/compress/flate/huffman_code.go.html#4831962">h</a></span><span class="op" id="4832466">.</span><span class="ident" id="4832467"><a href="/gostd/compress/flate/huffman_code.go.html#4825375">codeBits</a></span><span class="op" id="4832475">[</span><span class="ident" id="4832476"><a href="/gostd/compress/flate/huffman_code.go.html#4832440">node</a></span><span class="op" id="4832480">.</span><span class="ident" id="4832481"><a href="/gostd/compress/flate/huffman_code.go.html#4825441">literal</a></span><span class="op" id="4832488">]</span>&nbsp;<span class="op" id="4832490">=</span>&nbsp;<span class="builtintype" id="4832492">uint8</span><span class="op" id="4832497">(</span><span class="ident" id="4832498"><a href="/gostd/compress/flate/huffman_code.go.html#4832067">n</a></span><span class="op" id="4832499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4832504"><a href="/gostd/compress/flate/huffman_code.go.html#4831962">h</a></span><span class="op" id="4832505">.</span><span class="ident" id="4832506"><a href="/gostd/compress/flate/huffman_code.go.html#4825393">code</a></span><span class="op" id="4832510">[</span><span class="ident" id="4832511"><a href="/gostd/compress/flate/huffman_code.go.html#4832440">node</a></span><span class="op" id="4832515">.</span><span class="ident" id="4832516"><a href="/gostd/compress/flate/huffman_code.go.html#4825441">literal</a></span><span class="op" id="4832523">]</span>&nbsp;<span class="op" id="4832525">=</span>&nbsp;<span class="ident" id="4832527"><a href="/gostd/compress/flate/reverse_bits.go.html#4853319">reverseBits</a></span><span class="op" id="4832538">(</span><span class="ident" id="4832539"><a href="/gostd/compress/flate/huffman_code.go.html#4832044">code</a></span><span class="op" id="4832543">,</span>&nbsp;<span class="builtintype" id="4832545">uint8</span><span class="op" id="4832550">(</span><span class="ident" id="4832551"><a href="/gostd/compress/flate/huffman_code.go.html#4832067">n</a></span><span class="op" id="4832552">)</span><span class="op" id="4832553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4832558"><a href="/gostd/compress/flate/huffman_code.go.html#4832044">code</a></span><span class="op" id="4832562">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4832567">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4832571"><a href="/gostd/compress/flate/huffman_code.go.html#4832021">list</a></span>&nbsp;<span class="op" id="4832576">=</span>&nbsp;<span class="ident" id="4832578"><a href="/gostd/compress/flate/huffman_code.go.html#4832021">list</a></span><span class="op" id="4832582">[</span><span class="num" id="4832583">0</span>&nbsp;<span class="op" id="4832585">:</span>&nbsp;<span class="builtinfunc" id="4832587">len</span><span class="op" id="4832590">(</span><span class="ident" id="4832591"><a href="/gostd/compress/flate/huffman_code.go.html#4832021">list</a></span><span class="op" id="4832595">)</span><span class="op" id="4832596">-</span><span class="builtintype" id="4832597">int</span><span class="op" id="4832600">(</span><span class="ident" id="4832601"><a href="/gostd/compress/flate/huffman_code.go.html#4832070">bits</a></span><span class="op" id="4832605">)</span><span class="op" id="4832606">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4832609">}</span><br>
<span class="lineno"></span><span class="op" id="4832611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4832614">//&nbsp;Update&nbsp;this&nbsp;Huffman&nbsp;Code&nbsp;object&nbsp;to&nbsp;be&nbsp;the&nbsp;minimum&nbsp;code&nbsp;for&nbsp;the&nbsp;specified&nbsp;frequency&nbsp;count.</span><br>
<span class="lineno">260</span><span class="comment" id="4832707">//</span><br>
<span class="lineno"></span><span class="comment" id="4832710">//&nbsp;freq&nbsp;&nbsp;An&nbsp;array&nbsp;of&nbsp;frequencies,&nbsp;in&nbsp;which&nbsp;frequency[i]&nbsp;gives&nbsp;the&nbsp;frequency&nbsp;of&nbsp;literal&nbsp;i.</span><br>
<span class="lineno"></span><span class="comment" id="4832800">//&nbsp;maxBits&nbsp;&nbsp;The&nbsp;maximum&nbsp;number&nbsp;of&nbsp;bits&nbsp;to&nbsp;use&nbsp;for&nbsp;any&nbsp;literal.</span><br>
<span class="lineno"></span><span class="keyword" id="4832863">func</span>&nbsp;<span class="op" id="4832868">(</span><span class="ident" id="4832869">h</span>&nbsp;<span class="op" id="4832871">*</span><span class="ident" id="4832872"><a href="/gostd/compress/flate/huffman_code.go.html#4825350">huffmanEncoder</a></span><span class="op" id="4832886">)</span>&nbsp;<span class="ident" id="4832888">generate</span><span class="op" id="4832896">(</span><span class="ident" id="4832897">freq</span>&nbsp;<span class="op" id="4832902">[</span><span class="op" id="4832903">]</span><span class="builtintype" id="4832904">int32</span><span class="op" id="4832909">,</span>&nbsp;<span class="ident" id="4832911">maxBits</span>&nbsp;<span class="builtintype" id="4832919">int32</span><span class="op" id="4832924">)</span>&nbsp;<span class="op" id="4832926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4832929">list</span>&nbsp;<span class="op" id="4832934">:=</span>&nbsp;<span class="builtinfunc" id="4832937">make</span><span class="op" id="4832941">(</span><span class="op" id="4832942">[</span><span class="op" id="4832943">]</span><span class="ident" id="4832944"><a href="/gostd/compress/flate/huffman_code.go.html#4825419">literalNode</a></span><span class="op" id="4832955">,</span>&nbsp;<span class="builtinfunc" id="4832957">len</span><span class="op" id="4832960">(</span><span class="ident" id="4832961"><a href="/gostd/compress/flate/huffman_code.go.html#4832897">freq</a></span><span class="op" id="4832965">)</span><span class="op" id="4832966">+</span><span class="num" id="4832967">1</span><span class="op" id="4832968">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4832971">//&nbsp;Number&nbsp;of&nbsp;non-zero&nbsp;literals</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4833003">count</span>&nbsp;<span class="op" id="4833009">:=</span>&nbsp;<span class="num" id="4833012">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4833015">//&nbsp;Set&nbsp;list&nbsp;to&nbsp;be&nbsp;the&nbsp;set&nbsp;of&nbsp;all&nbsp;non-zero&nbsp;literals&nbsp;and&nbsp;their&nbsp;frequencies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4833089">for</span>&nbsp;<span class="ident" id="4833093">i</span><span class="op" id="4833094">,</span>&nbsp;<span class="ident" id="4833096">f</span>&nbsp;<span class="op" id="4833098">:=</span>&nbsp;<span class="keyword" id="4833101">range</span>&nbsp;<span class="ident" id="4833107"><a href="/gostd/compress/flate/huffman_code.go.html#4832897">freq</a></span>&nbsp;<span class="op" id="4833112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4833116">if</span>&nbsp;<span class="ident" id="4833119"><a href="/gostd/compress/flate/huffman_code.go.html#4833096">f</a></span>&nbsp;<span class="op" id="4833121">!=</span>&nbsp;<span class="num" id="4833124">0</span>&nbsp;<span class="op" id="4833126">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4833131"><a href="/gostd/compress/flate/huffman_code.go.html#4832929">list</a></span><span class="op" id="4833135">[</span><span class="ident" id="4833136"><a href="/gostd/compress/flate/huffman_code.go.html#4833003">count</a></span><span class="op" id="4833141">]</span>&nbsp;<span class="op" id="4833143">=</span>&nbsp;<span class="ident" id="4833145"><a href="/gostd/compress/flate/huffman_code.go.html#4825419">literalNode</a></span><span class="op" id="4833156">{</span><span class="builtintype" id="4833157">uint16</span><span class="op" id="4833163">(</span><span class="ident" id="4833164"><a href="/gostd/compress/flate/huffman_code.go.html#4833093">i</a></span><span class="op" id="4833165">)</span><span class="op" id="4833166">,</span>&nbsp;<span class="ident" id="4833168"><a href="/gostd/compress/flate/huffman_code.go.html#4833096">f</a></span><span class="op" id="4833169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4833174"><a href="/gostd/compress/flate/huffman_code.go.html#4833003">count</a></span><span class="op" id="4833179">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4833184">}</span>&nbsp;<span class="keyword" id="4833186">else</span>&nbsp;<span class="op" id="4833191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4833196"><a href="/gostd/compress/flate/huffman_code.go.html#4832869">h</a></span><span class="op" id="4833197">.</span><span class="ident" id="4833198"><a href="/gostd/compress/flate/huffman_code.go.html#4825375">codeBits</a></span><span class="op" id="4833206">[</span><span class="ident" id="4833207"><a href="/gostd/compress/flate/huffman_code.go.html#4833093">i</a></span><span class="op" id="4833208">]</span>&nbsp;<span class="op" id="4833210">=</span>&nbsp;<span class="num" id="4833212">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4833216">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4833219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4833222">//&nbsp;If&nbsp;freq[]&nbsp;is&nbsp;shorter&nbsp;than&nbsp;codeBits[],&nbsp;fill&nbsp;rest&nbsp;of&nbsp;codeBits[]&nbsp;with&nbsp;zeros</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4833299"><a href="/gostd/compress/flate/huffman_code.go.html#4832869">h</a></span><span class="op" id="4833300">.</span><span class="ident" id="4833301"><a href="/gostd/compress/flate/huffman_code.go.html#4825375">codeBits</a></span>&nbsp;<span class="op" id="4833310">=</span>&nbsp;<span class="ident" id="4833312"><a href="/gostd/compress/flate/huffman_code.go.html#4832869">h</a></span><span class="op" id="4833313">.</span><span class="ident" id="4833314"><a href="/gostd/compress/flate/huffman_code.go.html#4825375">codeBits</a></span><span class="op" id="4833322">[</span><span class="num" id="4833323">0</span><span class="op" id="4833324">:</span><span class="builtinfunc" id="4833325">len</span><span class="op" id="4833328">(</span><span class="ident" id="4833329"><a href="/gostd/compress/flate/huffman_code.go.html#4832897">freq</a></span><span class="op" id="4833333">)</span><span class="op" id="4833334">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4833337"><a href="/gostd/compress/flate/huffman_code.go.html#4832929">list</a></span>&nbsp;<span class="op" id="4833342">=</span>&nbsp;<span class="ident" id="4833344"><a href="/gostd/compress/flate/huffman_code.go.html#4832929">list</a></span><span class="op" id="4833348">[</span><span class="num" id="4833349">0</span><span class="op" id="4833350">:</span><span class="ident" id="4833351"><a href="/gostd/compress/flate/huffman_code.go.html#4833003">count</a></span><span class="op" id="4833356">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4833359">if</span>&nbsp;<span class="ident" id="4833362"><a href="/gostd/compress/flate/huffman_code.go.html#4833003">count</a></span>&nbsp;<span class="op" id="4833368">&lt;=</span>&nbsp;<span class="num" id="4833371">2</span>&nbsp;<span class="op" id="4833373">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4833377">//&nbsp;Handle&nbsp;the&nbsp;small&nbsp;cases&nbsp;here,&nbsp;because&nbsp;they&nbsp;are&nbsp;awkward&nbsp;for&nbsp;the&nbsp;general&nbsp;case&nbsp;code.&nbsp;&nbsp;With</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4833469">//&nbsp;two&nbsp;or&nbsp;fewer&nbsp;literals,&nbsp;everything&nbsp;has&nbsp;bit&nbsp;length&nbsp;1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4833526">for</span>&nbsp;<span class="ident" id="4833530">i</span><span class="op" id="4833531">,</span>&nbsp;<span class="ident" id="4833533">node</span>&nbsp;<span class="op" id="4833538">:=</span>&nbsp;<span class="keyword" id="4833541">range</span>&nbsp;<span class="ident" id="4833547"><a href="/gostd/compress/flate/huffman_code.go.html#4832929">list</a></span>&nbsp;<span class="op" id="4833552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4833557">//&nbsp;&#34;list&#34;&nbsp;is&nbsp;in&nbsp;order&nbsp;of&nbsp;increasing&nbsp;literal&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4833611"><a href="/gostd/compress/flate/huffman_code.go.html#4832869">h</a></span><span class="op" id="4833612">.</span><span class="ident" id="4833613"><a href="/gostd/compress/flate/huffman_code.go.html#4825375">codeBits</a></span><span class="op" id="4833621">[</span><span class="ident" id="4833622"><a href="/gostd/compress/flate/huffman_code.go.html#4833533">node</a></span><span class="op" id="4833626">.</span><span class="ident" id="4833627"><a href="/gostd/compress/flate/huffman_code.go.html#4825441">literal</a></span><span class="op" id="4833634">]</span>&nbsp;<span class="op" id="4833636">=</span>&nbsp;<span class="num" id="4833638">1</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4833643"><a href="/gostd/compress/flate/huffman_code.go.html#4832869">h</a></span><span class="op" id="4833644">.</span><span class="ident" id="4833645"><a href="/gostd/compress/flate/huffman_code.go.html#4825393">code</a></span><span class="op" id="4833649">[</span><span class="ident" id="4833650"><a href="/gostd/compress/flate/huffman_code.go.html#4833533">node</a></span><span class="op" id="4833654">.</span><span class="ident" id="4833655"><a href="/gostd/compress/flate/huffman_code.go.html#4825441">literal</a></span><span class="op" id="4833662">]</span>&nbsp;<span class="op" id="4833664">=</span>&nbsp;<span class="builtintype" id="4833666">uint16</span><span class="op" id="4833672">(</span><span class="ident" id="4833673"><a href="/gostd/compress/flate/huffman_code.go.html#4833530">i</a></span><span class="op" id="4833674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4833678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4833682">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4833690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4833693"><a href="/gostd/compress/flate/huffman_code.go.html#4834167">sortByFreq</a></span><span class="op" id="4833703">(</span><span class="ident" id="4833704"><a href="/gostd/compress/flate/huffman_code.go.html#4832929">list</a></span><span class="op" id="4833708">)</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4833712">//&nbsp;Get&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;for&nbsp;each&nbsp;bit&nbsp;count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4833762">bitCount</span>&nbsp;<span class="op" id="4833771">:=</span>&nbsp;<span class="ident" id="4833774"><a href="/gostd/compress/flate/huffman_code.go.html#4832869">h</a></span><span class="op" id="4833775">.</span><span class="ident" id="4833776"><a href="/gostd/compress/flate/huffman_code.go.html#4828320">bitCounts</a></span><span class="op" id="4833785">(</span><span class="ident" id="4833786"><a href="/gostd/compress/flate/huffman_code.go.html#4832929">list</a></span><span class="op" id="4833790">,</span>&nbsp;<span class="ident" id="4833792"><a href="/gostd/compress/flate/huffman_code.go.html#4832911">maxBits</a></span><span class="op" id="4833799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4833802">//&nbsp;And&nbsp;do&nbsp;the&nbsp;assignment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4833828"><a href="/gostd/compress/flate/huffman_code.go.html#4832869">h</a></span><span class="op" id="4833829">.</span><span class="ident" id="4833830"><a href="/gostd/compress/flate/huffman_code.go.html#4831981">assignEncodingAndSize</a></span><span class="op" id="4833851">(</span><span class="ident" id="4833852"><a href="/gostd/compress/flate/huffman_code.go.html#4833762">bitCount</a></span><span class="op" id="4833860">,</span>&nbsp;<span class="ident" id="4833862"><a href="/gostd/compress/flate/huffman_code.go.html#4832929">list</a></span><span class="op" id="4833866">)</span><br>
<span class="lineno">295</span><span class="op" id="4833868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4833871">type</span>&nbsp;<span class="ident" id="4833876">literalNodeSorter</span>&nbsp;<span class="keyword" id="4833894">struct</span>&nbsp;<span class="op" id="4833901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4833904">a</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4833909">[</span><span class="op" id="4833910">]</span><span class="ident" id="4833911"><a href="/gostd/compress/flate/huffman_code.go.html#4825419">literalNode</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4833924">less</span>&nbsp;<span class="keyword" id="4833929">func</span><span class="op" id="4833933">(</span><span class="ident" id="4833934">i</span><span class="op" id="4833935">,</span>&nbsp;<span class="ident" id="4833937">j</span>&nbsp;<span class="builtintype" id="4833939">int</span><span class="op" id="4833942">)</span>&nbsp;<span class="builtintype" id="4833944">bool</span><br>
<span class="lineno">300</span><span class="op" id="4833949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4833952">func</span>&nbsp;<span class="op" id="4833957">(</span><span class="ident" id="4833958">s</span>&nbsp;<span class="ident" id="4833960"><a href="/gostd/compress/flate/huffman_code.go.html#4833876">literalNodeSorter</a></span><span class="op" id="4833977">)</span>&nbsp;<span class="ident" id="4833979">Len</span><span class="op" id="4833982">(</span><span class="op" id="4833983">)</span>&nbsp;<span class="builtintype" id="4833985">int</span>&nbsp;<span class="op" id="4833989">{</span>&nbsp;<span class="keyword" id="4833991">return</span>&nbsp;<span class="builtinfunc" id="4833998">len</span><span class="op" id="4834001">(</span><span class="ident" id="4834002"><a href="/gostd/compress/flate/huffman_code.go.html#4833958">s</a></span><span class="op" id="4834003">.</span><span class="ident" id="4834004"><a href="/gostd/compress/flate/huffman_code.go.html#4833904">a</a></span><span class="op" id="4834005">)</span>&nbsp;<span class="op" id="4834007">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4834010">func</span>&nbsp;<span class="op" id="4834015">(</span><span class="ident" id="4834016">s</span>&nbsp;<span class="ident" id="4834018"><a href="/gostd/compress/flate/huffman_code.go.html#4833876">literalNodeSorter</a></span><span class="op" id="4834035">)</span>&nbsp;<span class="ident" id="4834037">Less</span><span class="op" id="4834041">(</span><span class="ident" id="4834042">i</span><span class="op" id="4834043">,</span>&nbsp;<span class="ident" id="4834045">j</span>&nbsp;<span class="builtintype" id="4834047">int</span><span class="op" id="4834050">)</span>&nbsp;<span class="builtintype" id="4834052">bool</span>&nbsp;<span class="op" id="4834057">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4834060">return</span>&nbsp;<span class="ident" id="4834067"><a href="/gostd/compress/flate/huffman_code.go.html#4834016">s</a></span><span class="op" id="4834068">.</span><span class="ident" id="4834069"><a href="/gostd/compress/flate/huffman_code.go.html#4833924">less</a></span><span class="op" id="4834073">(</span><span class="ident" id="4834074"><a href="/gostd/compress/flate/huffman_code.go.html#4834042">i</a></span><span class="op" id="4834075">,</span>&nbsp;<span class="ident" id="4834077"><a href="/gostd/compress/flate/huffman_code.go.html#4834045">j</a></span><span class="op" id="4834078">)</span><br>
<span class="lineno"></span><span class="op" id="4834080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4834083">func</span>&nbsp;<span class="op" id="4834088">(</span><span class="ident" id="4834089">s</span>&nbsp;<span class="ident" id="4834091"><a href="/gostd/compress/flate/huffman_code.go.html#4833876">literalNodeSorter</a></span><span class="op" id="4834108">)</span>&nbsp;<span class="ident" id="4834110">Swap</span><span class="op" id="4834114">(</span><span class="ident" id="4834115">i</span><span class="op" id="4834116">,</span>&nbsp;<span class="ident" id="4834118">j</span>&nbsp;<span class="builtintype" id="4834120">int</span><span class="op" id="4834123">)</span>&nbsp;<span class="op" id="4834125">{</span>&nbsp;<span class="ident" id="4834127"><a href="/gostd/compress/flate/huffman_code.go.html#4834089">s</a></span><span class="op" id="4834128">.</span><span class="ident" id="4834129"><a href="/gostd/compress/flate/huffman_code.go.html#4833904">a</a></span><span class="op" id="4834130">[</span><span class="ident" id="4834131"><a href="/gostd/compress/flate/huffman_code.go.html#4834115">i</a></span><span class="op" id="4834132">]</span><span class="op" id="4834133">,</span>&nbsp;<span class="ident" id="4834135"><a href="/gostd/compress/flate/huffman_code.go.html#4834089">s</a></span><span class="op" id="4834136">.</span><span class="ident" id="4834137"><a href="/gostd/compress/flate/huffman_code.go.html#4833904">a</a></span><span class="op" id="4834138">[</span><span class="ident" id="4834139"><a href="/gostd/compress/flate/huffman_code.go.html#4834118">j</a></span><span class="op" id="4834140">]</span>&nbsp;<span class="op" id="4834142">=</span>&nbsp;<span class="ident" id="4834144"><a href="/gostd/compress/flate/huffman_code.go.html#4834089">s</a></span><span class="op" id="4834145">.</span><span class="ident" id="4834146"><a href="/gostd/compress/flate/huffman_code.go.html#4833904">a</a></span><span class="op" id="4834147">[</span><span class="ident" id="4834148"><a href="/gostd/compress/flate/huffman_code.go.html#4834118">j</a></span><span class="op" id="4834149">]</span><span class="op" id="4834150">,</span>&nbsp;<span class="ident" id="4834152"><a href="/gostd/compress/flate/huffman_code.go.html#4834089">s</a></span><span class="op" id="4834153">.</span><span class="ident" id="4834154"><a href="/gostd/compress/flate/huffman_code.go.html#4833904">a</a></span><span class="op" id="4834155">[</span><span class="ident" id="4834156"><a href="/gostd/compress/flate/huffman_code.go.html#4834115">i</a></span><span class="op" id="4834157">]</span>&nbsp;<span class="op" id="4834159">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="keyword" id="4834162">func</span>&nbsp;<span class="ident" id="4834167">sortByFreq</span><span class="op" id="4834177">(</span><span class="ident" id="4834178">a</span>&nbsp;<span class="op" id="4834180">[</span><span class="op" id="4834181">]</span><span class="ident" id="4834182"><a href="/gostd/compress/flate/huffman_code.go.html#4825419">literalNode</a></span><span class="op" id="4834193">)</span>&nbsp;<span class="op" id="4834195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4834198">s</span>&nbsp;<span class="op" id="4834200">:=</span>&nbsp;<span class="op" id="4834203">&amp;</span><span class="ident" id="4834204"><a href="/gostd/compress/flate/huffman_code.go.html#4833876">literalNodeSorter</a></span><span class="op" id="4834221">{</span><span class="ident" id="4834222"><a href="/gostd/compress/flate/huffman_code.go.html#4834178">a</a></span><span class="op" id="4834223">,</span>&nbsp;<span class="keyword" id="4834225">func</span><span class="op" id="4834229">(</span><span class="ident" id="4834230">i</span><span class="op" id="4834231">,</span>&nbsp;<span class="ident" id="4834233">j</span>&nbsp;<span class="builtintype" id="4834235">int</span><span class="op" id="4834238">)</span>&nbsp;<span class="builtintype" id="4834240">bool</span>&nbsp;<span class="op" id="4834245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4834249">if</span>&nbsp;<span class="ident" id="4834252"><a href="/gostd/compress/flate/huffman_code.go.html#4834178">a</a></span><span class="op" id="4834253">[</span><span class="ident" id="4834254"><a href="/gostd/compress/flate/huffman_code.go.html#4834230">i</a></span><span class="op" id="4834255">]</span><span class="op" id="4834256">.</span><span class="ident" id="4834257"><a href="/gostd/compress/flate/huffman_code.go.html#4825457">freq</a></span>&nbsp;<span class="op" id="4834262">==</span>&nbsp;<span class="ident" id="4834265"><a href="/gostd/compress/flate/huffman_code.go.html#4834178">a</a></span><span class="op" id="4834266">[</span><span class="ident" id="4834267"><a href="/gostd/compress/flate/huffman_code.go.html#4834233">j</a></span><span class="op" id="4834268">]</span><span class="op" id="4834269">.</span><span class="ident" id="4834270"><a href="/gostd/compress/flate/huffman_code.go.html#4825457">freq</a></span>&nbsp;<span class="op" id="4834275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4834280">return</span>&nbsp;<span class="ident" id="4834287"><a href="/gostd/compress/flate/huffman_code.go.html#4834178">a</a></span><span class="op" id="4834288">[</span><span class="ident" id="4834289"><a href="/gostd/compress/flate/huffman_code.go.html#4834230">i</a></span><span class="op" id="4834290">]</span><span class="op" id="4834291">.</span><span class="ident" id="4834292"><a href="/gostd/compress/flate/huffman_code.go.html#4825441">literal</a></span>&nbsp;<span class="op" id="4834300">&lt;</span>&nbsp;<span class="ident" id="4834302"><a href="/gostd/compress/flate/huffman_code.go.html#4834178">a</a></span><span class="op" id="4834303">[</span><span class="ident" id="4834304"><a href="/gostd/compress/flate/huffman_code.go.html#4834233">j</a></span><span class="op" id="4834305">]</span><span class="op" id="4834306">.</span><span class="ident" id="4834307"><a href="/gostd/compress/flate/huffman_code.go.html#4825441">literal</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4834317">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4834321">return</span>&nbsp;<span class="ident" id="4834328"><a href="/gostd/compress/flate/huffman_code.go.html#4834178">a</a></span><span class="op" id="4834329">[</span><span class="ident" id="4834330"><a href="/gostd/compress/flate/huffman_code.go.html#4834230">i</a></span><span class="op" id="4834331">]</span><span class="op" id="4834332">.</span><span class="ident" id="4834333"><a href="/gostd/compress/flate/huffman_code.go.html#4825457">freq</a></span>&nbsp;<span class="op" id="4834338">&lt;</span>&nbsp;<span class="ident" id="4834340"><a href="/gostd/compress/flate/huffman_code.go.html#4834178">a</a></span><span class="op" id="4834341">[</span><span class="ident" id="4834342"><a href="/gostd/compress/flate/huffman_code.go.html#4834233">j</a></span><span class="op" id="4834343">]</span><span class="op" id="4834344">.</span><span class="ident" id="4834345"><a href="/gostd/compress/flate/huffman_code.go.html#4825457">freq</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4834351">}</span><span class="op" id="4834352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4834355"><a href="/gostd/compress/flate/huffman_code.go.html#4825335">sort</a></span><span class="op" id="4834359">.</span><span class="ident" id="4834360"><a href="/gostd/sort/sort.go.html#2015380">Sort</a></span><span class="op" id="4834364">(</span><span class="ident" id="4834365"><a href="/gostd/compress/flate/huffman_code.go.html#4834198">s</a></span><span class="op" id="4834366">)</span><br>
<span class="lineno"></span><span class="op" id="4834368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">320</span><span class="keyword" id="4834371">func</span>&nbsp;<span class="ident" id="4834376">sortByLiteral</span><span class="op" id="4834389">(</span><span class="ident" id="4834390">a</span>&nbsp;<span class="op" id="4834392">[</span><span class="op" id="4834393">]</span><span class="ident" id="4834394"><a href="/gostd/compress/flate/huffman_code.go.html#4825419">literalNode</a></span><span class="op" id="4834405">)</span>&nbsp;<span class="op" id="4834407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4834410">s</span>&nbsp;<span class="op" id="4834412">:=</span>&nbsp;<span class="op" id="4834415">&amp;</span><span class="ident" id="4834416"><a href="/gostd/compress/flate/huffman_code.go.html#4833876">literalNodeSorter</a></span><span class="op" id="4834433">{</span><span class="ident" id="4834434"><a href="/gostd/compress/flate/huffman_code.go.html#4834390">a</a></span><span class="op" id="4834435">,</span>&nbsp;<span class="keyword" id="4834437">func</span><span class="op" id="4834441">(</span><span class="ident" id="4834442">i</span><span class="op" id="4834443">,</span>&nbsp;<span class="ident" id="4834445">j</span>&nbsp;<span class="builtintype" id="4834447">int</span><span class="op" id="4834450">)</span>&nbsp;<span class="builtintype" id="4834452">bool</span>&nbsp;<span class="op" id="4834457">{</span>&nbsp;<span class="keyword" id="4834459">return</span>&nbsp;<span class="ident" id="4834466"><a href="/gostd/compress/flate/huffman_code.go.html#4834390">a</a></span><span class="op" id="4834467">[</span><span class="ident" id="4834468"><a href="/gostd/compress/flate/huffman_code.go.html#4834442">i</a></span><span class="op" id="4834469">]</span><span class="op" id="4834470">.</span><span class="ident" id="4834471"><a href="/gostd/compress/flate/huffman_code.go.html#4825441">literal</a></span>&nbsp;<span class="op" id="4834479">&lt;</span>&nbsp;<span class="ident" id="4834481"><a href="/gostd/compress/flate/huffman_code.go.html#4834390">a</a></span><span class="op" id="4834482">[</span><span class="ident" id="4834483"><a href="/gostd/compress/flate/huffman_code.go.html#4834445">j</a></span><span class="op" id="4834484">]</span><span class="op" id="4834485">.</span><span class="ident" id="4834486"><a href="/gostd/compress/flate/huffman_code.go.html#4825441">literal</a></span>&nbsp;<span class="op" id="4834494">}</span><span class="op" id="4834495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4834498"><a href="/gostd/compress/flate/huffman_code.go.html#4825335">sort</a></span><span class="op" id="4834502">.</span><span class="ident" id="4834503"><a href="/gostd/sort/sort.go.html#2015380">Sort</a></span><span class="op" id="4834507">(</span><span class="ident" id="4834508"><a href="/gostd/compress/flate/huffman_code.go.html#4834410">s</a></span><span class="op" id="4834509">)</span><br>
<span class="lineno"></span><span class="op" id="4834511">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
