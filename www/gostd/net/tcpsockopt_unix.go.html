<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3409512">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3409568">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3409622">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3409673">//&nbsp;+build&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3409713">package</span>&nbsp;<span class="ident" id="3409721">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3409726">import</span>&nbsp;<span class="op" id="3409733">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3409736">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3409742">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3409753">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3409760">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="3409763">func</span>&nbsp;<span class="ident" id="3409768">setKeepAlivePeriod</span><span class="op" id="3409786">(</span><span class="ident" id="3409787">fd</span>&nbsp;<span class="op" id="3409790">*</span><span class="ident" id="3409791">netFD</span><span class="op" id="3409796">,</span>&nbsp;<span class="ident" id="3409798">d</span>&nbsp;<span class="ident" id="3409800">time</span><span class="op" id="3409804">.</span><span class="ident" id="3409805">Duration</span><span class="op" id="3409813">)</span>&nbsp;<span class="builtintype" id="3409815">error</span>&nbsp;<span class="op" id="3409821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409824">if</span>&nbsp;<span class="ident" id="3409827">err</span>&nbsp;<span class="op" id="3409831">:=</span>&nbsp;<span class="ident" id="3409834">fd</span><span class="op" id="3409836">.</span><span class="ident" id="3409837">incref</span><span class="op" id="3409843">(</span><span class="op" id="3409844">)</span><span class="op" id="3409845">;</span>&nbsp;<span class="ident" id="3409847">err</span>&nbsp;<span class="op" id="3409851">!=</span>&nbsp;<span class="ident" id="3409854">nil</span>&nbsp;<span class="op" id="3409858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409862">return</span>&nbsp;<span class="ident" id="3409869">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3409874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409877">defer</span>&nbsp;<span class="ident" id="3409883">fd</span><span class="op" id="3409885">.</span><span class="ident" id="3409886">decref</span><span class="op" id="3409892">(</span><span class="op" id="3409893">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3409896">//&nbsp;The&nbsp;kernel&nbsp;expects&nbsp;seconds&nbsp;so&nbsp;round&nbsp;to&nbsp;next&nbsp;highest&nbsp;second.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409960">d</span>&nbsp;<span class="op" id="3409962">+=</span>&nbsp;<span class="op" id="3409965">(</span><span class="ident" id="3409966">time</span><span class="op" id="3409970">.</span><span class="ident" id="3409971">Second</span>&nbsp;<span class="op" id="3409978">-</span>&nbsp;<span class="ident" id="3409980">time</span><span class="op" id="3409984">.</span><span class="ident" id="3409985">Nanosecond</span><span class="op" id="3409995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409998">secs</span>&nbsp;<span class="op" id="3410003">:=</span>&nbsp;<span class="builtintype" id="3410006">int</span><span class="op" id="3410009">(</span><span class="ident" id="3410010">d</span><span class="op" id="3410011">.</span><span class="ident" id="3410012">Seconds</span><span class="op" id="3410019">(</span><span class="op" id="3410020">)</span><span class="op" id="3410021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410024">if</span>&nbsp;<span class="ident" id="3410027">err</span>&nbsp;<span class="op" id="3410031">:=</span>&nbsp;<span class="ident" id="3410034">syscall</span><span class="op" id="3410041">.</span><span class="ident" id="3410042">SetsockoptInt</span><span class="op" id="3410055">(</span><span class="ident" id="3410056">fd</span><span class="op" id="3410058">.</span><span class="ident" id="3410059">sysfd</span><span class="op" id="3410064">,</span>&nbsp;<span class="ident" id="3410066">syscall</span><span class="op" id="3410073">.</span><span class="ident" id="3410074">IPPROTO_TCP</span><span class="op" id="3410085">,</span>&nbsp;<span class="ident" id="3410087">syscall</span><span class="op" id="3410094">.</span><span class="ident" id="3410095">TCP_KEEPINTVL</span><span class="op" id="3410108">,</span>&nbsp;<span class="ident" id="3410110">secs</span><span class="op" id="3410114">)</span><span class="op" id="3410115">;</span>&nbsp;<span class="ident" id="3410117">err</span>&nbsp;<span class="op" id="3410121">!=</span>&nbsp;<span class="ident" id="3410124">nil</span>&nbsp;<span class="op" id="3410128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410132">return</span>&nbsp;<span class="ident" id="3410139">os</span><span class="op" id="3410141">.</span><span class="ident" id="3410142">NewSyscallError</span><span class="op" id="3410157">(</span><span class="string" id="3410158">&#34;setsockopt&#34;</span><span class="op" id="3410170">,</span>&nbsp;<span class="ident" id="3410172">err</span><span class="op" id="3410175">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3410178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410181">return</span>&nbsp;<span class="ident" id="3410188">os</span><span class="op" id="3410190">.</span><span class="ident" id="3410191">NewSyscallError</span><span class="op" id="3410206">(</span><span class="string" id="3410207">&#34;setsockopt&#34;</span><span class="op" id="3410219">,</span>&nbsp;<span class="ident" id="3410221">syscall</span><span class="op" id="3410228">.</span><span class="ident" id="3410229">SetsockoptInt</span><span class="op" id="3410242">(</span><span class="ident" id="3410243">fd</span><span class="op" id="3410245">.</span><span class="ident" id="3410246">sysfd</span><span class="op" id="3410251">,</span>&nbsp;<span class="ident" id="3410253">syscall</span><span class="op" id="3410260">.</span><span class="ident" id="3410261">IPPROTO_TCP</span><span class="op" id="3410272">,</span>&nbsp;<span class="ident" id="3410274">syscall</span><span class="op" id="3410281">.</span><span class="ident" id="3410282">TCP_KEEPIDLE</span><span class="op" id="3410294">,</span>&nbsp;<span class="ident" id="3410296">secs</span><span class="op" id="3410300">)</span><span class="op" id="3410301">)</span><br>
<span class="lineno"></span><span class="op" id="3410303">}</span>
</div>
</body>
</html>
