<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2012437">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2012492">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2012546">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2012597">//&nbsp;Malloc&nbsp;profiling.</span><br>
<span class="lineno"></span><span class="comment" id="2012618">//&nbsp;Patterned&nbsp;after&nbsp;tcmalloc&#39;s&nbsp;algorithms;&nbsp;shorter&nbsp;code.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2012675">package</span>&nbsp;<span class="ident" id="2012683">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="2012692">import</span>&nbsp;<span class="op" id="2012699">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2012702">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="2012711">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2012714">//&nbsp;NOTE(rsc):&nbsp;Everything&nbsp;here&nbsp;could&nbsp;use&nbsp;cas&nbsp;if&nbsp;contention&nbsp;became&nbsp;an&nbsp;issue.</span><br>
<span class="lineno">15</span><span class="keyword" id="2012789">var</span>&nbsp;<span class="ident" id="2012793">proflock</span>&nbsp;<span class="ident" id="2012802"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2179310">mutex</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2012809">//&nbsp;All&nbsp;memory&nbsp;allocations&nbsp;are&nbsp;local&nbsp;and&nbsp;do&nbsp;not&nbsp;escape&nbsp;outside&nbsp;of&nbsp;the&nbsp;profiler.</span><br>
<span class="lineno"></span><span class="comment" id="2012888">//&nbsp;The&nbsp;profiler&nbsp;is&nbsp;forbidden&nbsp;from&nbsp;referring&nbsp;to&nbsp;garbage-collected&nbsp;memory.</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="2012962">const</span>&nbsp;<span class="op" id="2012968">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2012971">//&nbsp;profile&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2012989">memProfile</span>&nbsp;<span class="ident" id="2013000"><a href="/runtime/mprof.go.html#2013157">bucketType</a></span>&nbsp;<span class="op" id="2013011">=</span>&nbsp;<span class="num" id="2013013">1</span>&nbsp;<span class="op" id="2013015">+</span>&nbsp;<span class="ident" id="2013017">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2013023">blockProfile</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2013038">//&nbsp;size&nbsp;of&nbsp;bucket&nbsp;hash&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2013068">buckHashSize</span>&nbsp;<span class="op" id="2013081">=</span>&nbsp;<span class="num" id="2013083">179999</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2013092">//&nbsp;max&nbsp;depth&nbsp;of&nbsp;stack&nbsp;to&nbsp;record&nbsp;in&nbsp;bucket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2013135">maxStack</span>&nbsp;<span class="op" id="2013144">=</span>&nbsp;<span class="num" id="2013146">32</span><br>
<span class="lineno">30</span><span class="op" id="2013149">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2013152">type</span>&nbsp;<span class="ident" id="2013157">bucketType</span>&nbsp;<span class="builtintype" id="2013168">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2013173">//&nbsp;A&nbsp;bucket&nbsp;holds&nbsp;per-call-stack&nbsp;profiling&nbsp;information.</span><br>
<span class="lineno">35</span><span class="comment" id="2013229">//&nbsp;The&nbsp;representation&nbsp;is&nbsp;a&nbsp;bit&nbsp;sleazy,&nbsp;inherited&nbsp;from&nbsp;C.</span><br>
<span class="lineno"></span><span class="comment" id="2013286">//&nbsp;This&nbsp;struct&nbsp;defines&nbsp;the&nbsp;bucket&nbsp;header.&nbsp;It&nbsp;is&nbsp;followed&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="2013346">//&nbsp;memory&nbsp;by&nbsp;the&nbsp;stack&nbsp;words&nbsp;and&nbsp;then&nbsp;the&nbsp;actual&nbsp;record</span><br>
<span class="lineno"></span><span class="comment" id="2013402">//&nbsp;data,&nbsp;either&nbsp;a&nbsp;memRecord&nbsp;or&nbsp;a&nbsp;blockRecord.</span><br>
<span class="lineno"></span><span class="comment" id="2013448">//</span><br>
<span class="lineno">40</span><span class="comment" id="2013451">//&nbsp;Per-call-stack&nbsp;profiling&nbsp;information.</span><br>
<span class="lineno"></span><span class="comment" id="2013492">//&nbsp;Lookup&nbsp;by&nbsp;hashing&nbsp;call&nbsp;stack&nbsp;into&nbsp;a&nbsp;linked-list&nbsp;hash&nbsp;table.</span><br>
<span class="lineno"></span><span class="keyword" id="2013555">type</span>&nbsp;<span class="ident" id="2013560">bucket</span>&nbsp;<span class="keyword" id="2013567">struct</span>&nbsp;<span class="op" id="2013574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2013577">next</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2013585">*</span><span class="ident" id="2013586"><a href="/runtime/mprof.go.html#2013560">bucket</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2013594">allnext</span>&nbsp;<span class="op" id="2013602">*</span><span class="ident" id="2013603"><a href="/runtime/mprof.go.html#2013560">bucket</a></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2013611">typ</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2013619"><a href="/runtime/mprof.go.html#2013157">bucketType</a></span>&nbsp;<span class="comment" id="2013630">//&nbsp;memBucket&nbsp;or&nbsp;blockBucket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2013659">hash</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2013667">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2013676">size</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2013684">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2013693">nstk</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2013701">uintptr</span><br>
<span class="lineno"></span><span class="op" id="2013709">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="2013712">//&nbsp;A&nbsp;memRecord&nbsp;is&nbsp;the&nbsp;bucket&nbsp;data&nbsp;for&nbsp;a&nbsp;bucket&nbsp;of&nbsp;type&nbsp;memProfile,</span><br>
<span class="lineno"></span><span class="comment" id="2013779">//&nbsp;part&nbsp;of&nbsp;the&nbsp;memory&nbsp;profile.</span><br>
<span class="lineno"></span><span class="keyword" id="2013810">type</span>&nbsp;<span class="ident" id="2013815">memRecord</span>&nbsp;<span class="keyword" id="2013825">struct</span>&nbsp;<span class="op" id="2013832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2013835">//&nbsp;The&nbsp;following&nbsp;complex&nbsp;3-stage&nbsp;scheme&nbsp;of&nbsp;stats&nbsp;accumulation</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2013898">//&nbsp;is&nbsp;required&nbsp;to&nbsp;obtain&nbsp;a&nbsp;consistent&nbsp;picture&nbsp;of&nbsp;mallocs&nbsp;and&nbsp;frees</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2013966">//&nbsp;for&nbsp;some&nbsp;point&nbsp;in&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2013994">//&nbsp;The&nbsp;problem&nbsp;is&nbsp;that&nbsp;mallocs&nbsp;come&nbsp;in&nbsp;real&nbsp;time,&nbsp;while&nbsp;frees</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2014057">//&nbsp;come&nbsp;only&nbsp;after&nbsp;a&nbsp;GC&nbsp;during&nbsp;concurrent&nbsp;sweeping.&nbsp;So&nbsp;if&nbsp;we&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2014125">//&nbsp;naively&nbsp;count&nbsp;them,&nbsp;we&nbsp;would&nbsp;get&nbsp;a&nbsp;skew&nbsp;toward&nbsp;mallocs.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2014185">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2014189">//&nbsp;Mallocs&nbsp;are&nbsp;accounted&nbsp;in&nbsp;recent&nbsp;stats.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2014232">//&nbsp;Explicit&nbsp;frees&nbsp;are&nbsp;accounted&nbsp;in&nbsp;recent&nbsp;stats.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2014282">//&nbsp;GC&nbsp;frees&nbsp;are&nbsp;accounted&nbsp;in&nbsp;prev&nbsp;stats.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2014324">//&nbsp;After&nbsp;GC&nbsp;prev&nbsp;stats&nbsp;are&nbsp;added&nbsp;to&nbsp;final&nbsp;stats&nbsp;and</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2014377">//&nbsp;recent&nbsp;stats&nbsp;are&nbsp;moved&nbsp;into&nbsp;prev&nbsp;stats.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2014421">allocs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2014433">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2014442">frees</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2014454">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2014463">alloc_bytes</span>&nbsp;<span class="builtintype" id="2014475">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2014484">free_bytes</span>&nbsp;&nbsp;<span class="builtintype" id="2014496">uintptr</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2014506">//&nbsp;changes&nbsp;between&nbsp;next-to-last&nbsp;GC&nbsp;and&nbsp;last&nbsp;GC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2014554">prev_allocs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2014571">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2014580">prev_frees</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2014597">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2014606">prev_alloc_bytes</span>&nbsp;<span class="builtintype" id="2014623">uintptr</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2014632">prev_free_bytes</span>&nbsp;&nbsp;<span class="builtintype" id="2014649">uintptr</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2014659">//&nbsp;changes&nbsp;since&nbsp;last&nbsp;GC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2014685">recent_allocs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2014704">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2014713">recent_frees</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2014732">uintptr</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2014741">recent_alloc_bytes</span>&nbsp;<span class="builtintype" id="2014760">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2014769">recent_free_bytes</span>&nbsp;&nbsp;<span class="builtintype" id="2014788">uintptr</span><br>
<span class="lineno"></span><span class="op" id="2014796">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2014799">//&nbsp;A&nbsp;blockRecord&nbsp;is&nbsp;the&nbsp;bucket&nbsp;data&nbsp;for&nbsp;a&nbsp;bucket&nbsp;of&nbsp;type&nbsp;blockProfile,</span><br>
<span class="lineno">85</span><span class="comment" id="2014870">//&nbsp;part&nbsp;of&nbsp;the&nbsp;blocking&nbsp;profile.</span><br>
<span class="lineno"></span><span class="keyword" id="2014903">type</span>&nbsp;<span class="ident" id="2014908">blockRecord</span>&nbsp;<span class="keyword" id="2014920">struct</span>&nbsp;<span class="op" id="2014927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2014930">count</span>&nbsp;&nbsp;<span class="ident" id="2014937">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2014944">cycles</span>&nbsp;<span class="ident" id="2014951">int64</span><br>
<span class="lineno"></span><span class="op" id="2014957">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="2014960">var</span>&nbsp;<span class="op" id="2014964">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2014967">mbuckets</span>&nbsp;&nbsp;<span class="op" id="2014977">*</span><span class="ident" id="2014978"><a href="/runtime/mprof.go.html#2013560">bucket</a></span>&nbsp;<span class="comment" id="2014985">//&nbsp;memory&nbsp;profile&nbsp;buckets</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2015012">bbuckets</span>&nbsp;&nbsp;<span class="op" id="2015022">*</span><span class="ident" id="2015023"><a href="/runtime/mprof.go.html#2013560">bucket</a></span>&nbsp;<span class="comment" id="2015030">//&nbsp;blocking&nbsp;profile&nbsp;buckets</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2015059">buckhash</span>&nbsp;&nbsp;<span class="op" id="2015069">*</span><span class="op" id="2015070">[</span><span class="num" id="2015071">179999</span><span class="op" id="2015077">]</span><span class="op" id="2015078">*</span><span class="ident" id="2015079"><a href="/runtime/mprof.go.html#2013560">bucket</a></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2015087">bucketmem</span>&nbsp;<span class="builtintype" id="2015097">uintptr</span><br>
<span class="lineno"></span><span class="op" id="2015105">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2015108">//&nbsp;newBucket&nbsp;allocates&nbsp;a&nbsp;bucket&nbsp;with&nbsp;the&nbsp;given&nbsp;type&nbsp;and&nbsp;number&nbsp;of&nbsp;stack&nbsp;entries.</span><br>
<span class="lineno"></span><span class="keyword" id="2015189">func</span>&nbsp;<span class="ident" id="2015194">newBucket</span><span class="op" id="2015203">(</span><span class="ident" id="2015204">typ</span>&nbsp;<span class="ident" id="2015208"><a href="/runtime/mprof.go.html#2013157">bucketType</a></span><span class="op" id="2015218">,</span>&nbsp;<span class="ident" id="2015220">nstk</span>&nbsp;<span class="builtintype" id="2015225">int</span><span class="op" id="2015228">)</span>&nbsp;<span class="op" id="2015230">*</span><span class="ident" id="2015231"><a href="/runtime/mprof.go.html#2013560">bucket</a></span>&nbsp;<span class="op" id="2015238">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2015241">size</span>&nbsp;<span class="op" id="2015246">:=</span>&nbsp;<span class="ident" id="2015249"><a href="/runtime/mprof.go.html#2012702">unsafe</a></span><span class="op" id="2015255">.</span><span class="ident" id="2015256">Sizeof</span><span class="op" id="2015262">(</span><span class="ident" id="2015263"><a href="/runtime/mprof.go.html#2013560">bucket</a></span><span class="op" id="2015269">{</span><span class="op" id="2015270">}</span><span class="op" id="2015271">)</span>&nbsp;<span class="op" id="2015273">+</span>&nbsp;<span class="builtintype" id="2015275">uintptr</span><span class="op" id="2015282">(</span><span class="ident" id="2015283"><a href="/runtime/mprof.go.html#2015220">nstk</a></span><span class="op" id="2015287">)</span><span class="op" id="2015288">*</span><span class="ident" id="2015289"><a href="/runtime/mprof.go.html#2012702">unsafe</a></span><span class="op" id="2015295">.</span><span class="ident" id="2015296">Sizeof</span><span class="op" id="2015302">(</span><span class="builtintype" id="2015303">uintptr</span><span class="op" id="2015310">(</span><span class="num" id="2015311">0</span><span class="op" id="2015312">)</span><span class="op" id="2015313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2015316">switch</span>&nbsp;<span class="ident" id="2015323"><a href="/runtime/mprof.go.html#2015204">typ</a></span>&nbsp;<span class="op" id="2015327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2015330">default</span><span class="op" id="2015337">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2015341"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="2015348">(</span><span class="string" id="2015349">&#34;invalid&nbsp;profile&nbsp;bucket&nbsp;type&#34;</span><span class="op" id="2015378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2015381">case</span>&nbsp;<span class="ident" id="2015386"><a href="/runtime/mprof.go.html#2012989">memProfile</a></span><span class="op" id="2015396">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2015400"><a href="/runtime/mprof.go.html#2015241">size</a></span>&nbsp;<span class="op" id="2015405">+=</span>&nbsp;<span class="ident" id="2015408"><a href="/runtime/mprof.go.html#2012702">unsafe</a></span><span class="op" id="2015414">.</span><span class="ident" id="2015415">Sizeof</span><span class="op" id="2015421">(</span><span class="ident" id="2015422"><a href="/runtime/mprof.go.html#2013815">memRecord</a></span><span class="op" id="2015431">{</span><span class="op" id="2015432">}</span><span class="op" id="2015433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2015436">case</span>&nbsp;<span class="ident" id="2015441"><a href="/runtime/mprof.go.html#2013023">blockProfile</a></span><span class="op" id="2015453">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2015457"><a href="/runtime/mprof.go.html#2015241">size</a></span>&nbsp;<span class="op" id="2015462">+=</span>&nbsp;<span class="ident" id="2015465"><a href="/runtime/mprof.go.html#2012702">unsafe</a></span><span class="op" id="2015471">.</span><span class="ident" id="2015472">Sizeof</span><span class="op" id="2015478">(</span><span class="ident" id="2015479"><a href="/runtime/mprof.go.html#2014908">blockRecord</a></span><span class="op" id="2015490">{</span><span class="op" id="2015491">}</span><span class="op" id="2015492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2015495">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2015499">b</span>&nbsp;<span class="op" id="2015501">:=</span>&nbsp;<span class="op" id="2015504">(</span><span class="op" id="2015505">*</span><span class="ident" id="2015506"><a href="/runtime/mprof.go.html#2013560">bucket</a></span><span class="op" id="2015512">)</span><span class="op" id="2015513">(</span><span class="ident" id="2015514"><a href="/runtime/malloc.go.html#2005184">persistentalloc</a></span><span class="op" id="2015529">(</span><span class="ident" id="2015530"><a href="/runtime/mprof.go.html#2015241">size</a></span><span class="op" id="2015534">,</span>&nbsp;<span class="num" id="2015536">0</span><span class="op" id="2015537">,</span>&nbsp;<span class="op" id="2015539">&amp;</span><span class="ident" id="2015540"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2186172">memstats</a></span><span class="op" id="2015548">.</span><span class="ident" id="2015549">buckhash_sys</span><span class="op" id="2015561">)</span><span class="op" id="2015562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2015565"><a href="/runtime/mprof.go.html#2015087">bucketmem</a></span>&nbsp;<span class="op" id="2015575">+=</span>&nbsp;<span class="ident" id="2015578"><a href="/runtime/mprof.go.html#2015241">size</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2015584"><a href="/runtime/mprof.go.html#2015499">b</a></span><span class="op" id="2015585">.</span><span class="ident" id="2015586">typ</span>&nbsp;<span class="op" id="2015590">=</span>&nbsp;<span class="ident" id="2015592"><a href="/runtime/mprof.go.html#2015204">typ</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2015597"><a href="/runtime/mprof.go.html#2015499">b</a></span><span class="op" id="2015598">.</span><span class="ident" id="2015599">nstk</span>&nbsp;<span class="op" id="2015604">=</span>&nbsp;<span class="builtintype" id="2015606">uintptr</span><span class="op" id="2015613">(</span><span class="ident" id="2015614"><a href="/runtime/mprof.go.html#2015220">nstk</a></span><span class="op" id="2015618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2015621">return</span>&nbsp;<span class="ident" id="2015628"><a href="/runtime/mprof.go.html#2015499">b</a></span><br>
<span class="lineno">115</span><span class="op" id="2015630">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2015633">//&nbsp;stk&nbsp;returns&nbsp;the&nbsp;slice&nbsp;in&nbsp;b&nbsp;holding&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span><span class="keyword" id="2015682">func</span>&nbsp;<span class="op" id="2015687">(</span><span class="ident" id="2015688">b</span>&nbsp;<span class="op" id="2015690">*</span><span class="ident" id="2015691"><a href="/runtime/mprof.go.html#2013560">bucket</a></span><span class="op" id="2015697">)</span>&nbsp;<span class="ident" id="2015699">stk</span><span class="op" id="2015702">(</span><span class="op" id="2015703">)</span>&nbsp;<span class="op" id="2015705">[</span><span class="op" id="2015706">]</span><span class="builtintype" id="2015707">uintptr</span>&nbsp;<span class="op" id="2015715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2015718">stk</span>&nbsp;<span class="op" id="2015722">:=</span>&nbsp;<span class="op" id="2015725">(</span><span class="op" id="2015726">*</span><span class="op" id="2015727">[</span><span class="ident" id="2015728"><a href="/runtime/mprof.go.html#2013135">maxStack</a></span><span class="op" id="2015736">]</span><span class="builtintype" id="2015737">uintptr</span><span class="op" id="2015744">)</span><span class="op" id="2015745">(</span><span class="ident" id="2015746"><a href="/runtime/stubs.go.html#2131745">add</a></span><span class="op" id="2015749">(</span><span class="ident" id="2015750"><a href="/runtime/mprof.go.html#2012702">unsafe</a></span><span class="op" id="2015756">.</span><span class="ident" id="2015757">Pointer</span><span class="op" id="2015764">(</span><span class="ident" id="2015765"><a href="/runtime/mprof.go.html#2015688">b</a></span><span class="op" id="2015766">)</span><span class="op" id="2015767">,</span>&nbsp;<span class="ident" id="2015769"><a href="/runtime/mprof.go.html#2012702">unsafe</a></span><span class="op" id="2015775">.</span><span class="ident" id="2015776">Sizeof</span><span class="op" id="2015782">(</span><span class="op" id="2015783">*</span><span class="ident" id="2015784"><a href="/runtime/mprof.go.html#2015688">b</a></span><span class="op" id="2015785">)</span><span class="op" id="2015786">)</span><span class="op" id="2015787">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2015790">return</span>&nbsp;<span class="ident" id="2015797"><a href="/runtime/mprof.go.html#2015718">stk</a></span><span class="op" id="2015800">[</span><span class="op" id="2015801">:</span><span class="ident" id="2015802"><a href="/runtime/mprof.go.html#2015688">b</a></span><span class="op" id="2015803">.</span><span class="ident" id="2015804">nstk</span><span class="op" id="2015808">:</span><span class="ident" id="2015809"><a href="/runtime/mprof.go.html#2015688">b</a></span><span class="op" id="2015810">.</span><span class="ident" id="2015811">nstk</span><span class="op" id="2015815">]</span><br>
<span class="lineno"></span><span class="op" id="2015817">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2015820">//&nbsp;mp&nbsp;returns&nbsp;the&nbsp;memRecord&nbsp;associated&nbsp;with&nbsp;the&nbsp;memProfile&nbsp;bucket&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="2015889">func</span>&nbsp;<span class="op" id="2015894">(</span><span class="ident" id="2015895">b</span>&nbsp;<span class="op" id="2015897">*</span><span class="ident" id="2015898"><a href="/runtime/mprof.go.html#2013560">bucket</a></span><span class="op" id="2015904">)</span>&nbsp;<span class="ident" id="2015906">mp</span><span class="op" id="2015908">(</span><span class="op" id="2015909">)</span>&nbsp;<span class="op" id="2015911">*</span><span class="ident" id="2015912"><a href="/runtime/mprof.go.html#2013815">memRecord</a></span>&nbsp;<span class="op" id="2015922">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2015925">if</span>&nbsp;<span class="ident" id="2015928"><a href="/runtime/mprof.go.html#2015895">b</a></span><span class="op" id="2015929">.</span><span class="ident" id="2015930">typ</span>&nbsp;<span class="op" id="2015934">!=</span>&nbsp;<span class="ident" id="2015937"><a href="/runtime/mprof.go.html#2012989">memProfile</a></span>&nbsp;<span class="op" id="2015948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2015952"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="2015959">(</span><span class="string" id="2015960">&#34;bad&nbsp;use&nbsp;of&nbsp;bucket.mp&#34;</span><span class="op" id="2015982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2015985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2015988">data</span>&nbsp;<span class="op" id="2015993">:=</span>&nbsp;<span class="ident" id="2015996"><a href="/runtime/stubs.go.html#2131745">add</a></span><span class="op" id="2015999">(</span><span class="ident" id="2016000"><a href="/runtime/mprof.go.html#2012702">unsafe</a></span><span class="op" id="2016006">.</span><span class="ident" id="2016007">Pointer</span><span class="op" id="2016014">(</span><span class="ident" id="2016015"><a href="/runtime/mprof.go.html#2015895">b</a></span><span class="op" id="2016016">)</span><span class="op" id="2016017">,</span>&nbsp;<span class="ident" id="2016019"><a href="/runtime/mprof.go.html#2012702">unsafe</a></span><span class="op" id="2016025">.</span><span class="ident" id="2016026">Sizeof</span><span class="op" id="2016032">(</span><span class="op" id="2016033">*</span><span class="ident" id="2016034"><a href="/runtime/mprof.go.html#2015895">b</a></span><span class="op" id="2016035">)</span><span class="op" id="2016036">+</span><span class="ident" id="2016037"><a href="/runtime/mprof.go.html#2015895">b</a></span><span class="op" id="2016038">.</span><span class="ident" id="2016039">nstk</span><span class="op" id="2016043">*</span><span class="ident" id="2016044"><a href="/runtime/mprof.go.html#2012702">unsafe</a></span><span class="op" id="2016050">.</span><span class="ident" id="2016051">Sizeof</span><span class="op" id="2016057">(</span><span class="builtintype" id="2016058">uintptr</span><span class="op" id="2016065">(</span><span class="num" id="2016066">0</span><span class="op" id="2016067">)</span><span class="op" id="2016068">)</span><span class="op" id="2016069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2016072">return</span>&nbsp;<span class="op" id="2016079">(</span><span class="op" id="2016080">*</span><span class="ident" id="2016081"><a href="/runtime/mprof.go.html#2013815">memRecord</a></span><span class="op" id="2016090">)</span><span class="op" id="2016091">(</span><span class="ident" id="2016092"><a href="/runtime/mprof.go.html#2015988">data</a></span><span class="op" id="2016096">)</span><br>
<span class="lineno">130</span><span class="op" id="2016098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2016101">//&nbsp;bp&nbsp;returns&nbsp;the&nbsp;blockRecord&nbsp;associated&nbsp;with&nbsp;the&nbsp;blockProfile&nbsp;bucket&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="2016174">func</span>&nbsp;<span class="op" id="2016179">(</span><span class="ident" id="2016180">b</span>&nbsp;<span class="op" id="2016182">*</span><span class="ident" id="2016183"><a href="/runtime/mprof.go.html#2013560">bucket</a></span><span class="op" id="2016189">)</span>&nbsp;<span class="ident" id="2016191">bp</span><span class="op" id="2016193">(</span><span class="op" id="2016194">)</span>&nbsp;<span class="op" id="2016196">*</span><span class="ident" id="2016197"><a href="/runtime/mprof.go.html#2014908">blockRecord</a></span>&nbsp;<span class="op" id="2016209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2016212">if</span>&nbsp;<span class="ident" id="2016215"><a href="/runtime/mprof.go.html#2016180">b</a></span><span class="op" id="2016216">.</span><span class="ident" id="2016217">typ</span>&nbsp;<span class="op" id="2016221">!=</span>&nbsp;<span class="ident" id="2016224"><a href="/runtime/mprof.go.html#2013023">blockProfile</a></span>&nbsp;<span class="op" id="2016237">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2016241"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="2016248">(</span><span class="string" id="2016249">&#34;bad&nbsp;use&nbsp;of&nbsp;bucket.bp&#34;</span><span class="op" id="2016271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2016274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2016277">data</span>&nbsp;<span class="op" id="2016282">:=</span>&nbsp;<span class="ident" id="2016285"><a href="/runtime/stubs.go.html#2131745">add</a></span><span class="op" id="2016288">(</span><span class="ident" id="2016289"><a href="/runtime/mprof.go.html#2012702">unsafe</a></span><span class="op" id="2016295">.</span><span class="ident" id="2016296">Pointer</span><span class="op" id="2016303">(</span><span class="ident" id="2016304"><a href="/runtime/mprof.go.html#2016180">b</a></span><span class="op" id="2016305">)</span><span class="op" id="2016306">,</span>&nbsp;<span class="ident" id="2016308"><a href="/runtime/mprof.go.html#2012702">unsafe</a></span><span class="op" id="2016314">.</span><span class="ident" id="2016315">Sizeof</span><span class="op" id="2016321">(</span><span class="op" id="2016322">*</span><span class="ident" id="2016323"><a href="/runtime/mprof.go.html#2016180">b</a></span><span class="op" id="2016324">)</span><span class="op" id="2016325">+</span><span class="ident" id="2016326"><a href="/runtime/mprof.go.html#2016180">b</a></span><span class="op" id="2016327">.</span><span class="ident" id="2016328">nstk</span><span class="op" id="2016332">*</span><span class="ident" id="2016333"><a href="/runtime/mprof.go.html#2012702">unsafe</a></span><span class="op" id="2016339">.</span><span class="ident" id="2016340">Sizeof</span><span class="op" id="2016346">(</span><span class="builtintype" id="2016347">uintptr</span><span class="op" id="2016354">(</span><span class="num" id="2016355">0</span><span class="op" id="2016356">)</span><span class="op" id="2016357">)</span><span class="op" id="2016358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2016361">return</span>&nbsp;<span class="op" id="2016368">(</span><span class="op" id="2016369">*</span><span class="ident" id="2016370"><a href="/runtime/mprof.go.html#2014908">blockRecord</a></span><span class="op" id="2016381">)</span><span class="op" id="2016382">(</span><span class="ident" id="2016383"><a href="/runtime/mprof.go.html#2016277">data</a></span><span class="op" id="2016387">)</span><br>
<span class="lineno"></span><span class="op" id="2016389">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="comment" id="2016392">//&nbsp;Return&nbsp;the&nbsp;bucket&nbsp;for&nbsp;stk[0:nstk],&nbsp;allocating&nbsp;new&nbsp;bucket&nbsp;if&nbsp;needed.</span><br>
<span class="lineno"></span><span class="keyword" id="2016463">func</span>&nbsp;<span class="ident" id="2016468">stkbucket</span><span class="op" id="2016477">(</span><span class="ident" id="2016478">typ</span>&nbsp;<span class="ident" id="2016482"><a href="/runtime/mprof.go.html#2013157">bucketType</a></span><span class="op" id="2016492">,</span>&nbsp;<span class="ident" id="2016494">size</span>&nbsp;<span class="builtintype" id="2016499">uintptr</span><span class="op" id="2016506">,</span>&nbsp;<span class="ident" id="2016508">stk</span>&nbsp;<span class="op" id="2016512">[</span><span class="op" id="2016513">]</span><span class="builtintype" id="2016514">uintptr</span><span class="op" id="2016521">,</span>&nbsp;<span class="ident" id="2016523">alloc</span>&nbsp;<span class="builtintype" id="2016529">bool</span><span class="op" id="2016533">)</span>&nbsp;<span class="op" id="2016535">*</span><span class="ident" id="2016536"><a href="/runtime/mprof.go.html#2013560">bucket</a></span>&nbsp;<span class="op" id="2016543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2016546">if</span>&nbsp;<span class="ident" id="2016549"><a href="/runtime/mprof.go.html#2015059">buckhash</a></span>&nbsp;<span class="op" id="2016558">==</span>&nbsp;<span class="ident" id="2016561">nil</span>&nbsp;<span class="op" id="2016565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2016569"><a href="/runtime/mprof.go.html#2015059">buckhash</a></span>&nbsp;<span class="op" id="2016578">=</span>&nbsp;<span class="op" id="2016580">(</span><span class="op" id="2016581">*</span><span class="op" id="2016582">[</span><span class="ident" id="2016583"><a href="/runtime/mprof.go.html#2013068">buckHashSize</a></span><span class="op" id="2016595">]</span><span class="op" id="2016596">*</span><span class="ident" id="2016597"><a href="/runtime/mprof.go.html#2013560">bucket</a></span><span class="op" id="2016603">)</span><span class="op" id="2016604">(</span><span class="ident" id="2016605"><a href="/runtime/mprof.go.html#2017410">sysAlloc</a></span><span class="op" id="2016613">(</span><span class="ident" id="2016614"><a href="/runtime/mprof.go.html#2012702">unsafe</a></span><span class="op" id="2016620">.</span><span class="ident" id="2016621">Sizeof</span><span class="op" id="2016627">(</span><span class="op" id="2016628">*</span><span class="ident" id="2016629"><a href="/runtime/mprof.go.html#2015059">buckhash</a></span><span class="op" id="2016637">)</span><span class="op" id="2016638">,</span>&nbsp;<span class="op" id="2016640">&amp;</span><span class="ident" id="2016641"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2186172">memstats</a></span><span class="op" id="2016649">.</span><span class="ident" id="2016650">buckhash_sys</span><span class="op" id="2016662">)</span><span class="op" id="2016663">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2016667">if</span>&nbsp;<span class="ident" id="2016670"><a href="/runtime/mprof.go.html#2015059">buckhash</a></span>&nbsp;<span class="op" id="2016679">==</span>&nbsp;<span class="ident" id="2016682">nil</span>&nbsp;<span class="op" id="2016686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2016691"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="2016698">(</span><span class="string" id="2016699">&#34;runtime:&nbsp;cannot&nbsp;allocate&nbsp;memory&#34;</span><span class="op" id="2016732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2016736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2016739">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2016743">//&nbsp;Hash&nbsp;stack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2016759">var</span>&nbsp;<span class="ident" id="2016763">h</span>&nbsp;<span class="builtintype" id="2016765">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2016774">for</span>&nbsp;<span class="ident" id="2016778">_</span><span class="op" id="2016779">,</span>&nbsp;<span class="ident" id="2016781">pc</span>&nbsp;<span class="op" id="2016784">:=</span>&nbsp;<span class="keyword" id="2016787">range</span>&nbsp;<span class="ident" id="2016793"><a href="/runtime/mprof.go.html#2016508">stk</a></span>&nbsp;<span class="op" id="2016797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2016801"><a href="/runtime/mprof.go.html#2016763">h</a></span>&nbsp;<span class="op" id="2016803">+=</span>&nbsp;<span class="ident" id="2016806"><a href="/runtime/mprof.go.html#2016781">pc</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2016811"><a href="/runtime/mprof.go.html#2016763">h</a></span>&nbsp;<span class="op" id="2016813">+=</span>&nbsp;<span class="ident" id="2016816"><a href="/runtime/mprof.go.html#2016763">h</a></span>&nbsp;<span class="op" id="2016818">&lt;&lt;</span>&nbsp;<span class="num" id="2016821">10</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2016826"><a href="/runtime/mprof.go.html#2016763">h</a></span>&nbsp;<span class="op" id="2016828">^=</span>&nbsp;<span class="ident" id="2016831"><a href="/runtime/mprof.go.html#2016763">h</a></span>&nbsp;<span class="op" id="2016833">&gt;&gt;</span>&nbsp;<span class="num" id="2016836">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2016839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2016842">//&nbsp;hash&nbsp;in&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2016859"><a href="/runtime/mprof.go.html#2016763">h</a></span>&nbsp;<span class="op" id="2016861">+=</span>&nbsp;<span class="ident" id="2016864"><a href="/runtime/mprof.go.html#2016494">size</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2016870"><a href="/runtime/mprof.go.html#2016763">h</a></span>&nbsp;<span class="op" id="2016872">+=</span>&nbsp;<span class="ident" id="2016875"><a href="/runtime/mprof.go.html#2016763">h</a></span>&nbsp;<span class="op" id="2016877">&lt;&lt;</span>&nbsp;<span class="num" id="2016880">10</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2016884"><a href="/runtime/mprof.go.html#2016763">h</a></span>&nbsp;<span class="op" id="2016886">^=</span>&nbsp;<span class="ident" id="2016889"><a href="/runtime/mprof.go.html#2016763">h</a></span>&nbsp;<span class="op" id="2016891">&gt;&gt;</span>&nbsp;<span class="num" id="2016894">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2016897">//&nbsp;finalize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2016910"><a href="/runtime/mprof.go.html#2016763">h</a></span>&nbsp;<span class="op" id="2016912">+=</span>&nbsp;<span class="ident" id="2016915"><a href="/runtime/mprof.go.html#2016763">h</a></span>&nbsp;<span class="op" id="2016917">&lt;&lt;</span>&nbsp;<span class="num" id="2016920">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2016923"><a href="/runtime/mprof.go.html#2016763">h</a></span>&nbsp;<span class="op" id="2016925">^=</span>&nbsp;<span class="ident" id="2016928"><a href="/runtime/mprof.go.html#2016763">h</a></span>&nbsp;<span class="op" id="2016930">&gt;&gt;</span>&nbsp;<span class="num" id="2016933">11</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2016938">i</span>&nbsp;<span class="op" id="2016940">:=</span>&nbsp;<span class="builtintype" id="2016943">int</span><span class="op" id="2016946">(</span><span class="ident" id="2016947"><a href="/runtime/mprof.go.html#2016763">h</a></span>&nbsp;<span class="op" id="2016949">%</span>&nbsp;<span class="ident" id="2016951"><a href="/runtime/mprof.go.html#2013068">buckHashSize</a></span><span class="op" id="2016963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2016966">for</span>&nbsp;<span class="ident" id="2016970">b</span>&nbsp;<span class="op" id="2016972">:=</span>&nbsp;<span class="ident" id="2016975"><a href="/runtime/mprof.go.html#2015059">buckhash</a></span><span class="op" id="2016983">[</span><span class="ident" id="2016984"><a href="/runtime/mprof.go.html#2016938">i</a></span><span class="op" id="2016985">]</span><span class="op" id="2016986">;</span>&nbsp;<span class="ident" id="2016988"><a href="/runtime/mprof.go.html#2016970">b</a></span>&nbsp;<span class="op" id="2016990">!=</span>&nbsp;<span class="ident" id="2016993">nil</span><span class="op" id="2016996">;</span>&nbsp;<span class="ident" id="2016998"><a href="/runtime/mprof.go.html#2016970">b</a></span>&nbsp;<span class="op" id="2017000">=</span>&nbsp;<span class="ident" id="2017002"><a href="/runtime/mprof.go.html#2016970">b</a></span><span class="op" id="2017003">.</span><span class="ident" id="2017004">next</span>&nbsp;<span class="op" id="2017009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2017013">if</span>&nbsp;<span class="ident" id="2017016"><a href="/runtime/mprof.go.html#2016970">b</a></span><span class="op" id="2017017">.</span><span class="ident" id="2017018">typ</span>&nbsp;<span class="op" id="2017022">==</span>&nbsp;<span class="ident" id="2017025"><a href="/runtime/mprof.go.html#2016478">typ</a></span>&nbsp;<span class="op" id="2017029">&amp;&amp;</span>&nbsp;<span class="ident" id="2017032"><a href="/runtime/mprof.go.html#2016970">b</a></span><span class="op" id="2017033">.</span><span class="ident" id="2017034">hash</span>&nbsp;<span class="op" id="2017039">==</span>&nbsp;<span class="ident" id="2017042"><a href="/runtime/mprof.go.html#2016763">h</a></span>&nbsp;<span class="op" id="2017044">&amp;&amp;</span>&nbsp;<span class="ident" id="2017047"><a href="/runtime/mprof.go.html#2016970">b</a></span><span class="op" id="2017048">.</span><span class="ident" id="2017049">size</span>&nbsp;<span class="op" id="2017054">==</span>&nbsp;<span class="ident" id="2017057"><a href="/runtime/mprof.go.html#2016494">size</a></span>&nbsp;<span class="op" id="2017062">&amp;&amp;</span>&nbsp;<span class="ident" id="2017065"><a href="/runtime/mprof.go.html#2017465">eqslice</a></span><span class="op" id="2017072">(</span><span class="ident" id="2017073"><a href="/runtime/mprof.go.html#2016970">b</a></span><span class="op" id="2017074">.</span><span class="ident" id="2017075">stk</span><span class="op" id="2017078">(</span><span class="op" id="2017079">)</span><span class="op" id="2017080">,</span>&nbsp;<span class="ident" id="2017082"><a href="/runtime/mprof.go.html#2016508">stk</a></span><span class="op" id="2017085">)</span>&nbsp;<span class="op" id="2017087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2017092">return</span>&nbsp;<span class="ident" id="2017099"><a href="/runtime/mprof.go.html#2016970">b</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2017103">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2017106">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2017110">if</span>&nbsp;<span class="op" id="2017113">!</span><span class="ident" id="2017114"><a href="/runtime/mprof.go.html#2016523">alloc</a></span>&nbsp;<span class="op" id="2017120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2017124">return</span>&nbsp;<span class="ident" id="2017131">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2017136">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2017140">//&nbsp;Create&nbsp;new&nbsp;bucket.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017163">b</span>&nbsp;<span class="op" id="2017165">:=</span>&nbsp;<span class="ident" id="2017168"><a href="/runtime/mprof.go.html#2015194">newBucket</a></span><span class="op" id="2017177">(</span><span class="ident" id="2017178"><a href="/runtime/mprof.go.html#2016478">typ</a></span><span class="op" id="2017181">,</span>&nbsp;<span class="builtinfunc" id="2017183">len</span><span class="op" id="2017186">(</span><span class="ident" id="2017187"><a href="/runtime/mprof.go.html#2016508">stk</a></span><span class="op" id="2017190">)</span><span class="op" id="2017191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2017194">copy</span><span class="op" id="2017198">(</span><span class="ident" id="2017199"><a href="/runtime/mprof.go.html#2017163">b</a></span><span class="op" id="2017200">.</span><span class="ident" id="2017201">stk</span><span class="op" id="2017204">(</span><span class="op" id="2017205">)</span><span class="op" id="2017206">,</span>&nbsp;<span class="ident" id="2017208"><a href="/runtime/mprof.go.html#2016508">stk</a></span><span class="op" id="2017211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017214"><a href="/runtime/mprof.go.html#2017163">b</a></span><span class="op" id="2017215">.</span><span class="ident" id="2017216">hash</span>&nbsp;<span class="op" id="2017221">=</span>&nbsp;<span class="ident" id="2017223"><a href="/runtime/mprof.go.html#2016763">h</a></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017226"><a href="/runtime/mprof.go.html#2017163">b</a></span><span class="op" id="2017227">.</span><span class="ident" id="2017228">size</span>&nbsp;<span class="op" id="2017233">=</span>&nbsp;<span class="ident" id="2017235"><a href="/runtime/mprof.go.html#2016494">size</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017241"><a href="/runtime/mprof.go.html#2017163">b</a></span><span class="op" id="2017242">.</span><span class="ident" id="2017243">next</span>&nbsp;<span class="op" id="2017248">=</span>&nbsp;<span class="ident" id="2017250"><a href="/runtime/mprof.go.html#2015059">buckhash</a></span><span class="op" id="2017258">[</span><span class="ident" id="2017259"><a href="/runtime/mprof.go.html#2016938">i</a></span><span class="op" id="2017260">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017263"><a href="/runtime/mprof.go.html#2015059">buckhash</a></span><span class="op" id="2017271">[</span><span class="ident" id="2017272"><a href="/runtime/mprof.go.html#2016938">i</a></span><span class="op" id="2017273">]</span>&nbsp;<span class="op" id="2017275">=</span>&nbsp;<span class="ident" id="2017277"><a href="/runtime/mprof.go.html#2017163">b</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2017280">if</span>&nbsp;<span class="ident" id="2017283"><a href="/runtime/mprof.go.html#2016478">typ</a></span>&nbsp;<span class="op" id="2017287">==</span>&nbsp;<span class="ident" id="2017290"><a href="/runtime/mprof.go.html#2012989">memProfile</a></span>&nbsp;<span class="op" id="2017301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017305"><a href="/runtime/mprof.go.html#2017163">b</a></span><span class="op" id="2017306">.</span><span class="ident" id="2017307">allnext</span>&nbsp;<span class="op" id="2017315">=</span>&nbsp;<span class="ident" id="2017317"><a href="/runtime/mprof.go.html#2014967">mbuckets</a></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017328"><a href="/runtime/mprof.go.html#2014967">mbuckets</a></span>&nbsp;<span class="op" id="2017337">=</span>&nbsp;<span class="ident" id="2017339"><a href="/runtime/mprof.go.html#2017163">b</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2017342">}</span>&nbsp;<span class="keyword" id="2017344">else</span>&nbsp;<span class="op" id="2017349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017353"><a href="/runtime/mprof.go.html#2017163">b</a></span><span class="op" id="2017354">.</span><span class="ident" id="2017355">allnext</span>&nbsp;<span class="op" id="2017363">=</span>&nbsp;<span class="ident" id="2017365"><a href="/runtime/mprof.go.html#2015012">bbuckets</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017376"><a href="/runtime/mprof.go.html#2015012">bbuckets</a></span>&nbsp;<span class="op" id="2017385">=</span>&nbsp;<span class="ident" id="2017387"><a href="/runtime/mprof.go.html#2017163">b</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2017390">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2017393">return</span>&nbsp;<span class="ident" id="2017400"><a href="/runtime/mprof.go.html#2017163">b</a></span><br>
<span class="lineno"></span><span class="op" id="2017402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2017405">func</span>&nbsp;<span class="ident" id="2017410">sysAlloc</span><span class="op" id="2017418">(</span><span class="ident" id="2017419">n</span>&nbsp;<span class="builtintype" id="2017421">uintptr</span><span class="op" id="2017428">,</span>&nbsp;<span class="ident" id="2017430">stat</span>&nbsp;<span class="op" id="2017435">*</span><span class="ident" id="2017436">uint64</span><span class="op" id="2017442">)</span>&nbsp;<span class="ident" id="2017444"><a href="/runtime/mprof.go.html#2012702">unsafe</a></span><span class="op" id="2017450">.</span><span class="ident" id="2017451">Pointer</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span><span class="keyword" id="2017460">func</span>&nbsp;<span class="ident" id="2017465">eqslice</span><span class="op" id="2017472">(</span><span class="ident" id="2017473">x</span><span class="op" id="2017474">,</span>&nbsp;<span class="ident" id="2017476">y</span>&nbsp;<span class="op" id="2017478">[</span><span class="op" id="2017479">]</span><span class="builtintype" id="2017480">uintptr</span><span class="op" id="2017487">)</span>&nbsp;<span class="builtintype" id="2017489">bool</span>&nbsp;<span class="op" id="2017494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2017497">if</span>&nbsp;<span class="builtinfunc" id="2017500">len</span><span class="op" id="2017503">(</span><span class="ident" id="2017504"><a href="/runtime/mprof.go.html#2017473">x</a></span><span class="op" id="2017505">)</span>&nbsp;<span class="op" id="2017507">!=</span>&nbsp;<span class="builtinfunc" id="2017510">len</span><span class="op" id="2017513">(</span><span class="ident" id="2017514"><a href="/runtime/mprof.go.html#2017476">y</a></span><span class="op" id="2017515">)</span>&nbsp;<span class="op" id="2017517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2017521">return</span>&nbsp;<span class="builtintype" id="2017528">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2017535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2017538">for</span>&nbsp;<span class="ident" id="2017542">i</span><span class="op" id="2017543">,</span>&nbsp;<span class="ident" id="2017545">xi</span>&nbsp;<span class="op" id="2017548">:=</span>&nbsp;<span class="keyword" id="2017551">range</span>&nbsp;<span class="ident" id="2017557"><a href="/runtime/mprof.go.html#2017473">x</a></span>&nbsp;<span class="op" id="2017559">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2017563">if</span>&nbsp;<span class="ident" id="2017566"><a href="/runtime/mprof.go.html#2017545">xi</a></span>&nbsp;<span class="op" id="2017569">!=</span>&nbsp;<span class="ident" id="2017572"><a href="/runtime/mprof.go.html#2017476">y</a></span><span class="op" id="2017573">[</span><span class="ident" id="2017574"><a href="/runtime/mprof.go.html#2017542">i</a></span><span class="op" id="2017575">]</span>&nbsp;<span class="op" id="2017577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2017582">return</span>&nbsp;<span class="builtintype" id="2017589">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2017597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2017600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2017603">return</span>&nbsp;<span class="builtintype" id="2017610">true</span><br>
<span class="lineno">205</span><span class="op" id="2017615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2017618">func</span>&nbsp;<span class="ident" id="2017623">mprof_GC</span><span class="op" id="2017631">(</span><span class="op" id="2017632">)</span>&nbsp;<span class="op" id="2017634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2017637">for</span>&nbsp;<span class="ident" id="2017641">b</span>&nbsp;<span class="op" id="2017643">:=</span>&nbsp;<span class="ident" id="2017646"><a href="/runtime/mprof.go.html#2014967">mbuckets</a></span><span class="op" id="2017654">;</span>&nbsp;<span class="ident" id="2017656"><a href="/runtime/mprof.go.html#2017641">b</a></span>&nbsp;<span class="op" id="2017658">!=</span>&nbsp;<span class="ident" id="2017661">nil</span><span class="op" id="2017664">;</span>&nbsp;<span class="ident" id="2017666"><a href="/runtime/mprof.go.html#2017641">b</a></span>&nbsp;<span class="op" id="2017668">=</span>&nbsp;<span class="ident" id="2017670"><a href="/runtime/mprof.go.html#2017641">b</a></span><span class="op" id="2017671">.</span><span class="ident" id="2017672">allnext</span>&nbsp;<span class="op" id="2017680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017684">mp</span>&nbsp;<span class="op" id="2017687">:=</span>&nbsp;<span class="ident" id="2017690"><a href="/runtime/mprof.go.html#2017641">b</a></span><span class="op" id="2017691">.</span><span class="ident" id="2017692">mp</span><span class="op" id="2017694">(</span><span class="op" id="2017695">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017699"><a href="/runtime/mprof.go.html#2017684">mp</a></span><span class="op" id="2017701">.</span><span class="ident" id="2017702">allocs</span>&nbsp;<span class="op" id="2017709">+=</span>&nbsp;<span class="ident" id="2017712"><a href="/runtime/mprof.go.html#2017684">mp</a></span><span class="op" id="2017714">.</span><span class="ident" id="2017715">prev_allocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017729"><a href="/runtime/mprof.go.html#2017684">mp</a></span><span class="op" id="2017731">.</span><span class="ident" id="2017732">frees</span>&nbsp;<span class="op" id="2017738">+=</span>&nbsp;<span class="ident" id="2017741"><a href="/runtime/mprof.go.html#2017684">mp</a></span><span class="op" id="2017743">.</span><span class="ident" id="2017744">prev_frees</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017757"><a href="/runtime/mprof.go.html#2017684">mp</a></span><span class="op" id="2017759">.</span><span class="ident" id="2017760">alloc_bytes</span>&nbsp;<span class="op" id="2017772">+=</span>&nbsp;<span class="ident" id="2017775"><a href="/runtime/mprof.go.html#2017684">mp</a></span><span class="op" id="2017777">.</span><span class="ident" id="2017778">prev_alloc_bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017797"><a href="/runtime/mprof.go.html#2017684">mp</a></span><span class="op" id="2017799">.</span><span class="ident" id="2017800">free_bytes</span>&nbsp;<span class="op" id="2017811">+=</span>&nbsp;<span class="ident" id="2017814"><a href="/runtime/mprof.go.html#2017684">mp</a></span><span class="op" id="2017816">.</span><span class="ident" id="2017817">prev_free_bytes</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017836"><a href="/runtime/mprof.go.html#2017684">mp</a></span><span class="op" id="2017838">.</span><span class="ident" id="2017839">prev_allocs</span>&nbsp;<span class="op" id="2017851">=</span>&nbsp;<span class="ident" id="2017853"><a href="/runtime/mprof.go.html#2017684">mp</a></span><span class="op" id="2017855">.</span><span class="ident" id="2017856">recent_allocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017872"><a href="/runtime/mprof.go.html#2017684">mp</a></span><span class="op" id="2017874">.</span><span class="ident" id="2017875">prev_frees</span>&nbsp;<span class="op" id="2017886">=</span>&nbsp;<span class="ident" id="2017888"><a href="/runtime/mprof.go.html#2017684">mp</a></span><span class="op" id="2017890">.</span><span class="ident" id="2017891">recent_frees</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017906"><a href="/runtime/mprof.go.html#2017684">mp</a></span><span class="op" id="2017908">.</span><span class="ident" id="2017909">prev_alloc_bytes</span>&nbsp;<span class="op" id="2017926">=</span>&nbsp;<span class="ident" id="2017928"><a href="/runtime/mprof.go.html#2017684">mp</a></span><span class="op" id="2017930">.</span><span class="ident" id="2017931">recent_alloc_bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017952"><a href="/runtime/mprof.go.html#2017684">mp</a></span><span class="op" id="2017954">.</span><span class="ident" id="2017955">prev_free_bytes</span>&nbsp;<span class="op" id="2017971">=</span>&nbsp;<span class="ident" id="2017973"><a href="/runtime/mprof.go.html#2017684">mp</a></span><span class="op" id="2017975">.</span><span class="ident" id="2017976">recent_free_bytes</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017997"><a href="/runtime/mprof.go.html#2017684">mp</a></span><span class="op" id="2017999">.</span><span class="ident" id="2018000">recent_allocs</span>&nbsp;<span class="op" id="2018014">=</span>&nbsp;<span class="num" id="2018016">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018020"><a href="/runtime/mprof.go.html#2017684">mp</a></span><span class="op" id="2018022">.</span><span class="ident" id="2018023">recent_frees</span>&nbsp;<span class="op" id="2018036">=</span>&nbsp;<span class="num" id="2018038">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018042"><a href="/runtime/mprof.go.html#2017684">mp</a></span><span class="op" id="2018044">.</span><span class="ident" id="2018045">recent_alloc_bytes</span>&nbsp;<span class="op" id="2018064">=</span>&nbsp;<span class="num" id="2018066">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018070"><a href="/runtime/mprof.go.html#2017684">mp</a></span><span class="op" id="2018072">.</span><span class="ident" id="2018073">recent_free_bytes</span>&nbsp;<span class="op" id="2018091">=</span>&nbsp;<span class="num" id="2018093">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2018096">}</span><br>
<span class="lineno">225</span><span class="op" id="2018098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2018101">//&nbsp;Record&nbsp;that&nbsp;a&nbsp;gc&nbsp;just&nbsp;happened:&nbsp;all&nbsp;the&nbsp;&#39;recent&#39;&nbsp;statistics&nbsp;are&nbsp;now&nbsp;real.</span><br>
<span class="lineno"></span><span class="keyword" id="2018178">func</span>&nbsp;<span class="ident" id="2018183">mProf_GC</span><span class="op" id="2018191">(</span><span class="op" id="2018192">)</span>&nbsp;<span class="op" id="2018194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018197"><a href="/runtime/lock_futex.go.html#1978439">lock</a></span><span class="op" id="2018201">(</span><span class="op" id="2018202">&amp;</span><span class="ident" id="2018203"><a href="/runtime/mprof.go.html#2012793">proflock</a></span><span class="op" id="2018211">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018214"><a href="/runtime/mprof.go.html#2017623">mprof_GC</a></span><span class="op" id="2018222">(</span><span class="op" id="2018223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018226"><a href="/runtime/lock_futex.go.html#1979731">unlock</a></span><span class="op" id="2018232">(</span><span class="op" id="2018233">&amp;</span><span class="ident" id="2018234"><a href="/runtime/mprof.go.html#2012793">proflock</a></span><span class="op" id="2018242">)</span><br>
<span class="lineno"></span><span class="op" id="2018244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2018247">//&nbsp;Called&nbsp;by&nbsp;malloc&nbsp;to&nbsp;record&nbsp;a&nbsp;profiled&nbsp;block.</span><br>
<span class="lineno">235</span><span class="keyword" id="2018295">func</span>&nbsp;<span class="ident" id="2018300">mProf_Malloc</span><span class="op" id="2018312">(</span><span class="ident" id="2018313">p</span>&nbsp;<span class="ident" id="2018315"><a href="/runtime/mprof.go.html#2012702">unsafe</a></span><span class="op" id="2018321">.</span><span class="ident" id="2018322">Pointer</span><span class="op" id="2018329">,</span>&nbsp;<span class="ident" id="2018331">size</span>&nbsp;<span class="builtintype" id="2018336">uintptr</span><span class="op" id="2018343">)</span>&nbsp;<span class="op" id="2018345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2018348">var</span>&nbsp;<span class="ident" id="2018352">stk</span>&nbsp;<span class="op" id="2018356">[</span><span class="ident" id="2018357"><a href="/runtime/mprof.go.html#2013135">maxStack</a></span><span class="op" id="2018365">]</span><span class="builtintype" id="2018366">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018375">nstk</span>&nbsp;<span class="op" id="2018380">:=</span>&nbsp;<span class="ident" id="2018383"><a href="/runtime/traceback.go.html#2173694">callers</a></span><span class="op" id="2018390">(</span><span class="num" id="2018391">4</span><span class="op" id="2018392">,</span>&nbsp;<span class="op" id="2018394">&amp;</span><span class="ident" id="2018395"><a href="/runtime/mprof.go.html#2018352">stk</a></span><span class="op" id="2018398">[</span><span class="num" id="2018399">0</span><span class="op" id="2018400">]</span><span class="op" id="2018401">,</span>&nbsp;<span class="builtinfunc" id="2018403">len</span><span class="op" id="2018406">(</span><span class="ident" id="2018407"><a href="/runtime/mprof.go.html#2018352">stk</a></span><span class="op" id="2018410">)</span><span class="op" id="2018411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018414"><a href="/runtime/lock_futex.go.html#1978439">lock</a></span><span class="op" id="2018418">(</span><span class="op" id="2018419">&amp;</span><span class="ident" id="2018420"><a href="/runtime/mprof.go.html#2012793">proflock</a></span><span class="op" id="2018428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018431">b</span>&nbsp;<span class="op" id="2018433">:=</span>&nbsp;<span class="ident" id="2018436"><a href="/runtime/mprof.go.html#2016468">stkbucket</a></span><span class="op" id="2018445">(</span><span class="ident" id="2018446"><a href="/runtime/mprof.go.html#2012989">memProfile</a></span><span class="op" id="2018456">,</span>&nbsp;<span class="ident" id="2018458"><a href="/runtime/mprof.go.html#2018331">size</a></span><span class="op" id="2018462">,</span>&nbsp;<span class="ident" id="2018464"><a href="/runtime/mprof.go.html#2018352">stk</a></span><span class="op" id="2018467">[</span><span class="op" id="2018468">:</span><span class="ident" id="2018469"><a href="/runtime/mprof.go.html#2018375">nstk</a></span><span class="op" id="2018473">]</span><span class="op" id="2018474">,</span>&nbsp;<span class="builtintype" id="2018476">true</span><span class="op" id="2018480">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018483">mp</span>&nbsp;<span class="op" id="2018486">:=</span>&nbsp;<span class="ident" id="2018489"><a href="/runtime/mprof.go.html#2018431">b</a></span><span class="op" id="2018490">.</span><span class="ident" id="2018491">mp</span><span class="op" id="2018493">(</span><span class="op" id="2018494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018497"><a href="/runtime/mprof.go.html#2018483">mp</a></span><span class="op" id="2018499">.</span><span class="ident" id="2018500">recent_allocs</span><span class="op" id="2018513">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018517"><a href="/runtime/mprof.go.html#2018483">mp</a></span><span class="op" id="2018519">.</span><span class="ident" id="2018520">recent_alloc_bytes</span>&nbsp;<span class="op" id="2018539">+=</span>&nbsp;<span class="ident" id="2018542"><a href="/runtime/mprof.go.html#2018331">size</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018548"><a href="/runtime/lock_futex.go.html#1979731">unlock</a></span><span class="op" id="2018554">(</span><span class="op" id="2018555">&amp;</span><span class="ident" id="2018556"><a href="/runtime/mprof.go.html#2012793">proflock</a></span><span class="op" id="2018564">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2018568">//&nbsp;Setprofilebucket&nbsp;locks&nbsp;a&nbsp;bunch&nbsp;of&nbsp;other&nbsp;mutexes,&nbsp;so&nbsp;we&nbsp;call&nbsp;it&nbsp;outside&nbsp;of&nbsp;proflock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2018656">//&nbsp;This&nbsp;reduces&nbsp;potential&nbsp;contention&nbsp;and&nbsp;chances&nbsp;of&nbsp;deadlocks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2018720">//&nbsp;Since&nbsp;the&nbsp;object&nbsp;must&nbsp;be&nbsp;alive&nbsp;during&nbsp;call&nbsp;to&nbsp;mProf_Malloc,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2018784">//&nbsp;it&#39;s&nbsp;fine&nbsp;to&nbsp;do&nbsp;this&nbsp;non-atomically.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018825"><a href="/runtime/mprof.go.html#2018894">setprofilebucket</a></span><span class="op" id="2018841">(</span><span class="ident" id="2018842"><a href="/runtime/mprof.go.html#2018313">p</a></span><span class="op" id="2018843">,</span>&nbsp;<span class="ident" id="2018845"><a href="/runtime/mprof.go.html#2018431">b</a></span><span class="op" id="2018846">)</span><br>
<span class="lineno">250</span><span class="op" id="2018848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2018851">func</span>&nbsp;<span class="ident" id="2018856">setprofilebucket_m</span><span class="op" id="2018874">(</span><span class="op" id="2018875">)</span>&nbsp;<span class="comment" id="2018877">//&nbsp;mheap.c</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2018889">func</span>&nbsp;<span class="ident" id="2018894">setprofilebucket</span><span class="op" id="2018910">(</span><span class="ident" id="2018911">p</span>&nbsp;<span class="ident" id="2018913"><a href="/runtime/mprof.go.html#2012702">unsafe</a></span><span class="op" id="2018919">.</span><span class="ident" id="2018920">Pointer</span><span class="op" id="2018927">,</span>&nbsp;<span class="ident" id="2018929">b</span>&nbsp;<span class="op" id="2018931">*</span><span class="ident" id="2018932"><a href="/runtime/mprof.go.html#2013560">bucket</a></span><span class="op" id="2018938">)</span>&nbsp;<span class="op" id="2018940">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018943">g</span>&nbsp;<span class="op" id="2018945">:=</span>&nbsp;<span class="ident" id="2018948"><a href="/runtime/stubs.go.html#2132021">getg</a></span><span class="op" id="2018952">(</span><span class="op" id="2018953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018956"><a href="/runtime/mprof.go.html#2018943">g</a></span><span class="op" id="2018957">.</span><span class="ident" id="2018958">m</span><span class="op" id="2018959">.</span><span class="ident" id="2018960">ptrarg</span><span class="op" id="2018966">[</span><span class="num" id="2018967">0</span><span class="op" id="2018968">]</span>&nbsp;<span class="op" id="2018970">=</span>&nbsp;<span class="ident" id="2018972"><a href="/runtime/mprof.go.html#2018911">p</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018975"><a href="/runtime/mprof.go.html#2018943">g</a></span><span class="op" id="2018976">.</span><span class="ident" id="2018977">m</span><span class="op" id="2018978">.</span><span class="ident" id="2018979">ptrarg</span><span class="op" id="2018985">[</span><span class="num" id="2018986">1</span><span class="op" id="2018987">]</span>&nbsp;<span class="op" id="2018989">=</span>&nbsp;<span class="ident" id="2018991"><a href="/runtime/mprof.go.html#2012702">unsafe</a></span><span class="op" id="2018997">.</span><span class="ident" id="2018998">Pointer</span><span class="op" id="2019005">(</span><span class="ident" id="2019006"><a href="/runtime/mprof.go.html#2018929">b</a></span><span class="op" id="2019007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2019010"><a href="/runtime/stubs.go.html#2134137">onM</a></span><span class="op" id="2019013">(</span><span class="ident" id="2019014"><a href="/runtime/mprof.go.html#2018856">setprofilebucket_m</a></span><span class="op" id="2019032">)</span><br>
<span class="lineno"></span><span class="op" id="2019034">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="comment" id="2019037">//&nbsp;Called&nbsp;when&nbsp;freeing&nbsp;a&nbsp;profiled&nbsp;block.</span><br>
<span class="lineno"></span><span class="keyword" id="2019078">func</span>&nbsp;<span class="ident" id="2019083">mProf_Free</span><span class="op" id="2019093">(</span><span class="ident" id="2019094">b</span>&nbsp;<span class="op" id="2019096">*</span><span class="ident" id="2019097"><a href="/runtime/mprof.go.html#2013560">bucket</a></span><span class="op" id="2019103">,</span>&nbsp;<span class="ident" id="2019105">size</span>&nbsp;<span class="builtintype" id="2019110">uintptr</span><span class="op" id="2019117">,</span>&nbsp;<span class="ident" id="2019119">freed</span>&nbsp;<span class="builtintype" id="2019125">bool</span><span class="op" id="2019129">)</span>&nbsp;<span class="op" id="2019131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2019134"><a href="/runtime/lock_futex.go.html#1978439">lock</a></span><span class="op" id="2019138">(</span><span class="op" id="2019139">&amp;</span><span class="ident" id="2019140"><a href="/runtime/mprof.go.html#2012793">proflock</a></span><span class="op" id="2019148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2019151">mp</span>&nbsp;<span class="op" id="2019154">:=</span>&nbsp;<span class="ident" id="2019157"><a href="/runtime/mprof.go.html#2019094">b</a></span><span class="op" id="2019158">.</span><span class="ident" id="2019159">mp</span><span class="op" id="2019161">(</span><span class="op" id="2019162">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2019165">if</span>&nbsp;<span class="ident" id="2019168"><a href="/runtime/mprof.go.html#2019119">freed</a></span>&nbsp;<span class="op" id="2019174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2019178"><a href="/runtime/mprof.go.html#2019151">mp</a></span><span class="op" id="2019180">.</span><span class="ident" id="2019181">recent_frees</span><span class="op" id="2019193">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2019198"><a href="/runtime/mprof.go.html#2019151">mp</a></span><span class="op" id="2019200">.</span><span class="ident" id="2019201">recent_free_bytes</span>&nbsp;<span class="op" id="2019219">+=</span>&nbsp;<span class="ident" id="2019222"><a href="/runtime/mprof.go.html#2019105">size</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2019228">}</span>&nbsp;<span class="keyword" id="2019230">else</span>&nbsp;<span class="op" id="2019235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2019239"><a href="/runtime/mprof.go.html#2019151">mp</a></span><span class="op" id="2019241">.</span><span class="ident" id="2019242">prev_frees</span><span class="op" id="2019252">++</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2019257"><a href="/runtime/mprof.go.html#2019151">mp</a></span><span class="op" id="2019259">.</span><span class="ident" id="2019260">prev_free_bytes</span>&nbsp;<span class="op" id="2019276">+=</span>&nbsp;<span class="ident" id="2019279"><a href="/runtime/mprof.go.html#2019105">size</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2019285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2019288"><a href="/runtime/lock_futex.go.html#1979731">unlock</a></span><span class="op" id="2019294">(</span><span class="op" id="2019295">&amp;</span><span class="ident" id="2019296"><a href="/runtime/mprof.go.html#2012793">proflock</a></span><span class="op" id="2019304">)</span><br>
<span class="lineno"></span><span class="op" id="2019306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="keyword" id="2019309">var</span>&nbsp;<span class="ident" id="2019313">blockprofilerate</span>&nbsp;<span class="ident" id="2019330">uint64</span>&nbsp;<span class="comment" id="2019337">//&nbsp;in&nbsp;CPU&nbsp;ticks</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2019354">//&nbsp;SetBlockProfileRate&nbsp;controls&nbsp;the&nbsp;fraction&nbsp;of&nbsp;goroutine&nbsp;blocking&nbsp;events</span><br>
<span class="lineno"></span><span class="comment" id="2019428">//&nbsp;that&nbsp;are&nbsp;reported&nbsp;in&nbsp;the&nbsp;blocking&nbsp;profile.&nbsp;&nbsp;The&nbsp;profiler&nbsp;aims&nbsp;to&nbsp;sample</span><br>
<span class="lineno"></span><span class="comment" id="2019503">//&nbsp;an&nbsp;average&nbsp;of&nbsp;one&nbsp;blocking&nbsp;event&nbsp;per&nbsp;rate&nbsp;nanoseconds&nbsp;spent&nbsp;blocked.</span><br>
<span class="lineno">280</span><span class="comment" id="2019575">//</span><br>
<span class="lineno"></span><span class="comment" id="2019578">//&nbsp;To&nbsp;include&nbsp;every&nbsp;blocking&nbsp;event&nbsp;in&nbsp;the&nbsp;profile,&nbsp;pass&nbsp;rate&nbsp;=&nbsp;1.</span><br>
<span class="lineno"></span><span class="comment" id="2019644">//&nbsp;To&nbsp;turn&nbsp;off&nbsp;profiling&nbsp;entirely,&nbsp;pass&nbsp;rate&nbsp;&lt;=&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="2019695">func</span>&nbsp;<span class="ident" id="2019700">SetBlockProfileRate</span><span class="op" id="2019719">(</span><span class="ident" id="2019720">rate</span>&nbsp;<span class="builtintype" id="2019725">int</span><span class="op" id="2019728">)</span>&nbsp;<span class="op" id="2019730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2019733">var</span>&nbsp;<span class="ident" id="2019737">r</span>&nbsp;<span class="ident" id="2019739">int64</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2019746">if</span>&nbsp;<span class="ident" id="2019749"><a href="/runtime/mprof.go.html#2019720">rate</a></span>&nbsp;<span class="op" id="2019754">&lt;=</span>&nbsp;<span class="num" id="2019757">0</span>&nbsp;<span class="op" id="2019759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2019763"><a href="/runtime/mprof.go.html#2019737">r</a></span>&nbsp;<span class="op" id="2019765">=</span>&nbsp;<span class="num" id="2019767">0</span>&nbsp;<span class="comment" id="2019769">//&nbsp;disable&nbsp;profiling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2019791">}</span>&nbsp;<span class="keyword" id="2019793">else</span>&nbsp;<span class="keyword" id="2019798">if</span>&nbsp;<span class="ident" id="2019801"><a href="/runtime/mprof.go.html#2019720">rate</a></span>&nbsp;<span class="op" id="2019806">==</span>&nbsp;<span class="num" id="2019809">1</span>&nbsp;<span class="op" id="2019811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2019815"><a href="/runtime/mprof.go.html#2019737">r</a></span>&nbsp;<span class="op" id="2019817">=</span>&nbsp;<span class="num" id="2019819">1</span>&nbsp;<span class="comment" id="2019821">//&nbsp;profile&nbsp;everything</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2019844">}</span>&nbsp;<span class="keyword" id="2019846">else</span>&nbsp;<span class="op" id="2019851">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2019855">//&nbsp;convert&nbsp;ns&nbsp;to&nbsp;cycles,&nbsp;use&nbsp;float64&nbsp;to&nbsp;prevent&nbsp;overflow&nbsp;during&nbsp;multiplication</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2019936"><a href="/runtime/mprof.go.html#2019737">r</a></span>&nbsp;<span class="op" id="2019938">=</span>&nbsp;<span class="ident" id="2019940">int64</span><span class="op" id="2019945">(</span><span class="builtintype" id="2019946">float64</span><span class="op" id="2019953">(</span><span class="ident" id="2019954"><a href="/runtime/mprof.go.html#2019720">rate</a></span><span class="op" id="2019958">)</span>&nbsp;<span class="op" id="2019960">*</span>&nbsp;<span class="builtintype" id="2019962">float64</span><span class="op" id="2019969">(</span><span class="ident" id="2019970"><a href="/runtime/runtime.go.html#2078177">tickspersecond</a></span><span class="op" id="2019984">(</span><span class="op" id="2019985">)</span><span class="op" id="2019986">)</span>&nbsp;<span class="op" id="2019988">/</span>&nbsp;<span class="op" id="2019990">(</span><span class="num" id="2019991">1000</span>&nbsp;<span class="op" id="2019996">*</span>&nbsp;<span class="num" id="2019998">1000</span>&nbsp;<span class="op" id="2020003">*</span>&nbsp;<span class="num" id="2020005">1000</span><span class="op" id="2020009">)</span><span class="op" id="2020010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2020014">if</span>&nbsp;<span class="ident" id="2020017"><a href="/runtime/mprof.go.html#2019737">r</a></span>&nbsp;<span class="op" id="2020019">==</span>&nbsp;<span class="num" id="2020022">0</span>&nbsp;<span class="op" id="2020024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2020029"><a href="/runtime/mprof.go.html#2019737">r</a></span>&nbsp;<span class="op" id="2020031">=</span>&nbsp;<span class="num" id="2020033">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2020037">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2020040">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2020044"><a href="/runtime/atomic.go.html#1874774">atomicstore64</a></span><span class="op" id="2020057">(</span><span class="op" id="2020058">&amp;</span><span class="ident" id="2020059"><a href="/runtime/mprof.go.html#2019313">blockprofilerate</a></span><span class="op" id="2020075">,</span>&nbsp;<span class="ident" id="2020077">uint64</span><span class="op" id="2020083">(</span><span class="ident" id="2020084"><a href="/runtime/mprof.go.html#2019737">r</a></span><span class="op" id="2020085">)</span><span class="op" id="2020086">)</span><br>
<span class="lineno"></span><span class="op" id="2020088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="keyword" id="2020091">func</span>&nbsp;<span class="ident" id="2020096">blockevent</span><span class="op" id="2020106">(</span><span class="ident" id="2020107">cycles</span>&nbsp;<span class="ident" id="2020114">int64</span><span class="op" id="2020119">,</span>&nbsp;<span class="ident" id="2020121">skip</span>&nbsp;<span class="builtintype" id="2020126">int</span><span class="op" id="2020129">)</span>&nbsp;<span class="op" id="2020131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2020134">if</span>&nbsp;<span class="ident" id="2020137"><a href="/runtime/mprof.go.html#2020107">cycles</a></span>&nbsp;<span class="op" id="2020144">&lt;=</span>&nbsp;<span class="num" id="2020147">0</span>&nbsp;<span class="op" id="2020149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2020153"><a href="/runtime/mprof.go.html#2020107">cycles</a></span>&nbsp;<span class="op" id="2020160">=</span>&nbsp;<span class="num" id="2020162">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2020165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2020168">rate</span>&nbsp;<span class="op" id="2020173">:=</span>&nbsp;<span class="ident" id="2020176">int64</span><span class="op" id="2020181">(</span><span class="ident" id="2020182"><a href="/runtime/atomic.go.html#1874483">atomicload64</a></span><span class="op" id="2020194">(</span><span class="op" id="2020195">&amp;</span><span class="ident" id="2020196"><a href="/runtime/mprof.go.html#2019313">blockprofilerate</a></span><span class="op" id="2020212">)</span><span class="op" id="2020213">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2020216">if</span>&nbsp;<span class="ident" id="2020219"><a href="/runtime/mprof.go.html#2020168">rate</a></span>&nbsp;<span class="op" id="2020224">&lt;=</span>&nbsp;<span class="num" id="2020227">0</span>&nbsp;<span class="op" id="2020229">||</span>&nbsp;<span class="op" id="2020232">(</span><span class="ident" id="2020233"><a href="/runtime/mprof.go.html#2020168">rate</a></span>&nbsp;<span class="op" id="2020238">&gt;</span>&nbsp;<span class="ident" id="2020240"><a href="/runtime/mprof.go.html#2020107">cycles</a></span>&nbsp;<span class="op" id="2020247">&amp;&amp;</span>&nbsp;<span class="ident" id="2020250">int64</span><span class="op" id="2020255">(</span><span class="ident" id="2020256"><a href="/runtime/stubs.go.html#2136047">fastrand1</a></span><span class="op" id="2020265">(</span><span class="op" id="2020266">)</span><span class="op" id="2020267">)</span><span class="op" id="2020268">%</span><span class="ident" id="2020269"><a href="/runtime/mprof.go.html#2020168">rate</a></span>&nbsp;<span class="op" id="2020274">&gt;</span>&nbsp;<span class="ident" id="2020276"><a href="/runtime/mprof.go.html#2020107">cycles</a></span><span class="op" id="2020282">)</span>&nbsp;<span class="op" id="2020284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2020288">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2020296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2020299">gp</span>&nbsp;<span class="op" id="2020302">:=</span>&nbsp;<span class="ident" id="2020305"><a href="/runtime/stubs.go.html#2132021">getg</a></span><span class="op" id="2020309">(</span><span class="op" id="2020310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2020313">var</span>&nbsp;<span class="ident" id="2020317">nstk</span>&nbsp;<span class="builtintype" id="2020322">int</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2020327">var</span>&nbsp;<span class="ident" id="2020331">stk</span>&nbsp;<span class="op" id="2020335">[</span><span class="ident" id="2020336"><a href="/runtime/mprof.go.html#2013135">maxStack</a></span><span class="op" id="2020344">]</span><span class="builtintype" id="2020345">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2020354">if</span>&nbsp;<span class="ident" id="2020357"><a href="/runtime/mprof.go.html#2020299">gp</a></span><span class="op" id="2020359">.</span><span class="ident" id="2020360">m</span><span class="op" id="2020361">.</span><span class="ident" id="2020362">curg</span>&nbsp;<span class="op" id="2020367">==</span>&nbsp;<span class="ident" id="2020370">nil</span>&nbsp;<span class="op" id="2020374">||</span>&nbsp;<span class="ident" id="2020377"><a href="/runtime/mprof.go.html#2020299">gp</a></span><span class="op" id="2020379">.</span><span class="ident" id="2020380">m</span><span class="op" id="2020381">.</span><span class="ident" id="2020382">curg</span>&nbsp;<span class="op" id="2020387">==</span>&nbsp;<span class="ident" id="2020390"><a href="/runtime/mprof.go.html#2020299">gp</a></span>&nbsp;<span class="op" id="2020393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2020397"><a href="/runtime/mprof.go.html#2020317">nstk</a></span>&nbsp;<span class="op" id="2020402">=</span>&nbsp;<span class="ident" id="2020404"><a href="/runtime/traceback.go.html#2173694">callers</a></span><span class="op" id="2020411">(</span><span class="ident" id="2020412"><a href="/runtime/mprof.go.html#2020121">skip</a></span><span class="op" id="2020416">,</span>&nbsp;<span class="op" id="2020418">&amp;</span><span class="ident" id="2020419"><a href="/runtime/mprof.go.html#2020331">stk</a></span><span class="op" id="2020422">[</span><span class="num" id="2020423">0</span><span class="op" id="2020424">]</span><span class="op" id="2020425">,</span>&nbsp;<span class="builtinfunc" id="2020427">len</span><span class="op" id="2020430">(</span><span class="ident" id="2020431"><a href="/runtime/mprof.go.html#2020331">stk</a></span><span class="op" id="2020434">)</span><span class="op" id="2020435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2020438">}</span>&nbsp;<span class="keyword" id="2020440">else</span>&nbsp;<span class="op" id="2020445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2020449"><a href="/runtime/mprof.go.html#2020317">nstk</a></span>&nbsp;<span class="op" id="2020454">=</span>&nbsp;<span class="ident" id="2020456"><a href="/runtime/traceback.go.html#2173948">gcallers</a></span><span class="op" id="2020464">(</span><span class="ident" id="2020465"><a href="/runtime/mprof.go.html#2020299">gp</a></span><span class="op" id="2020467">.</span><span class="ident" id="2020468">m</span><span class="op" id="2020469">.</span><span class="ident" id="2020470">curg</span><span class="op" id="2020474">,</span>&nbsp;<span class="ident" id="2020476"><a href="/runtime/mprof.go.html#2020121">skip</a></span><span class="op" id="2020480">,</span>&nbsp;<span class="op" id="2020482">&amp;</span><span class="ident" id="2020483"><a href="/runtime/mprof.go.html#2020331">stk</a></span><span class="op" id="2020486">[</span><span class="num" id="2020487">0</span><span class="op" id="2020488">]</span><span class="op" id="2020489">,</span>&nbsp;<span class="builtinfunc" id="2020491">len</span><span class="op" id="2020494">(</span><span class="ident" id="2020495"><a href="/runtime/mprof.go.html#2020331">stk</a></span><span class="op" id="2020498">)</span><span class="op" id="2020499">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2020502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2020505"><a href="/runtime/lock_futex.go.html#1978439">lock</a></span><span class="op" id="2020509">(</span><span class="op" id="2020510">&amp;</span><span class="ident" id="2020511"><a href="/runtime/mprof.go.html#2012793">proflock</a></span><span class="op" id="2020519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2020522">b</span>&nbsp;<span class="op" id="2020524">:=</span>&nbsp;<span class="ident" id="2020527"><a href="/runtime/mprof.go.html#2016468">stkbucket</a></span><span class="op" id="2020536">(</span><span class="ident" id="2020537"><a href="/runtime/mprof.go.html#2013023">blockProfile</a></span><span class="op" id="2020549">,</span>&nbsp;<span class="num" id="2020551">0</span><span class="op" id="2020552">,</span>&nbsp;<span class="ident" id="2020554"><a href="/runtime/mprof.go.html#2020331">stk</a></span><span class="op" id="2020557">[</span><span class="op" id="2020558">:</span><span class="ident" id="2020559"><a href="/runtime/mprof.go.html#2020317">nstk</a></span><span class="op" id="2020563">]</span><span class="op" id="2020564">,</span>&nbsp;<span class="builtintype" id="2020566">true</span><span class="op" id="2020570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2020573"><a href="/runtime/mprof.go.html#2020522">b</a></span><span class="op" id="2020574">.</span><span class="ident" id="2020575">bp</span><span class="op" id="2020577">(</span><span class="op" id="2020578">)</span><span class="op" id="2020579">.</span><span class="ident" id="2020580">count</span><span class="op" id="2020585">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2020589"><a href="/runtime/mprof.go.html#2020522">b</a></span><span class="op" id="2020590">.</span><span class="ident" id="2020591">bp</span><span class="op" id="2020593">(</span><span class="op" id="2020594">)</span><span class="op" id="2020595">.</span><span class="ident" id="2020596">cycles</span>&nbsp;<span class="op" id="2020603">+=</span>&nbsp;<span class="ident" id="2020606"><a href="/runtime/mprof.go.html#2020107">cycles</a></span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2020614"><a href="/runtime/lock_futex.go.html#1979731">unlock</a></span><span class="op" id="2020620">(</span><span class="op" id="2020621">&amp;</span><span class="ident" id="2020622"><a href="/runtime/mprof.go.html#2012793">proflock</a></span><span class="op" id="2020630">)</span><br>
<span class="lineno"></span><span class="op" id="2020632">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2020635">//&nbsp;Go&nbsp;interface&nbsp;to&nbsp;profile&nbsp;data.</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="comment" id="2020669">//&nbsp;A&nbsp;StackRecord&nbsp;describes&nbsp;a&nbsp;single&nbsp;execution&nbsp;stack.</span><br>
<span class="lineno"></span><span class="keyword" id="2020722">type</span>&nbsp;<span class="ident" id="2020727">StackRecord</span>&nbsp;<span class="keyword" id="2020739">struct</span>&nbsp;<span class="op" id="2020746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2020749">Stack0</span>&nbsp;<span class="op" id="2020756">[</span><span class="num" id="2020757">32</span><span class="op" id="2020759">]</span><span class="builtintype" id="2020760">uintptr</span>&nbsp;<span class="comment" id="2020768">//&nbsp;stack&nbsp;trace&nbsp;for&nbsp;this&nbsp;record;&nbsp;ends&nbsp;at&nbsp;first&nbsp;0&nbsp;entry</span><br>
<span class="lineno"></span><span class="op" id="2020822">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span><span class="comment" id="2020825">//&nbsp;Stack&nbsp;returns&nbsp;the&nbsp;stack&nbsp;trace&nbsp;associated&nbsp;with&nbsp;the&nbsp;record,</span><br>
<span class="lineno"></span><span class="comment" id="2020886">//&nbsp;a&nbsp;prefix&nbsp;of&nbsp;r.Stack0.</span><br>
<span class="lineno"></span><span class="keyword" id="2020911">func</span>&nbsp;<span class="op" id="2020916">(</span><span class="ident" id="2020917">r</span>&nbsp;<span class="op" id="2020919">*</span><span class="ident" id="2020920"><a href="/runtime/mprof.go.html#2020727">StackRecord</a></span><span class="op" id="2020931">)</span>&nbsp;<span class="ident" id="2020933">Stack</span><span class="op" id="2020938">(</span><span class="op" id="2020939">)</span>&nbsp;<span class="op" id="2020941">[</span><span class="op" id="2020942">]</span><span class="builtintype" id="2020943">uintptr</span>&nbsp;<span class="op" id="2020951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2020954">for</span>&nbsp;<span class="ident" id="2020958">i</span><span class="op" id="2020959">,</span>&nbsp;<span class="ident" id="2020961">v</span>&nbsp;<span class="op" id="2020963">:=</span>&nbsp;<span class="keyword" id="2020966">range</span>&nbsp;<span class="ident" id="2020972"><a href="/runtime/mprof.go.html#2020917">r</a></span><span class="op" id="2020973">.</span><span class="ident" id="2020974">Stack0</span>&nbsp;<span class="op" id="2020981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2020985">if</span>&nbsp;<span class="ident" id="2020988"><a href="/runtime/mprof.go.html#2020961">v</a></span>&nbsp;<span class="op" id="2020990">==</span>&nbsp;<span class="num" id="2020993">0</span>&nbsp;<span class="op" id="2020995">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2021000">return</span>&nbsp;<span class="ident" id="2021007"><a href="/runtime/mprof.go.html#2020917">r</a></span><span class="op" id="2021008">.</span><span class="ident" id="2021009">Stack0</span><span class="op" id="2021015">[</span><span class="num" id="2021016">0</span><span class="op" id="2021017">:</span><span class="ident" id="2021018"><a href="/runtime/mprof.go.html#2020958">i</a></span><span class="op" id="2021019">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2021023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2021026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2021029">return</span>&nbsp;<span class="ident" id="2021036"><a href="/runtime/mprof.go.html#2020917">r</a></span><span class="op" id="2021037">.</span><span class="ident" id="2021038">Stack0</span><span class="op" id="2021044">[</span><span class="num" id="2021045">0</span><span class="op" id="2021046">:</span><span class="op" id="2021047">]</span><br>
<span class="lineno"></span><span class="op" id="2021049">}</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span><span class="comment" id="2021052">//&nbsp;MemProfileRate&nbsp;controls&nbsp;the&nbsp;fraction&nbsp;of&nbsp;memory&nbsp;allocations</span><br>
<span class="lineno"></span><span class="comment" id="2021114">//&nbsp;that&nbsp;are&nbsp;recorded&nbsp;and&nbsp;reported&nbsp;in&nbsp;the&nbsp;memory&nbsp;profile.</span><br>
<span class="lineno"></span><span class="comment" id="2021171">//&nbsp;The&nbsp;profiler&nbsp;aims&nbsp;to&nbsp;sample&nbsp;an&nbsp;average&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2021216">//&nbsp;one&nbsp;allocation&nbsp;per&nbsp;MemProfileRate&nbsp;bytes&nbsp;allocated.</span><br>
<span class="lineno">345</span><span class="comment" id="2021270">//</span><br>
<span class="lineno"></span><span class="comment" id="2021273">//&nbsp;To&nbsp;include&nbsp;every&nbsp;allocated&nbsp;block&nbsp;in&nbsp;the&nbsp;profile,&nbsp;set&nbsp;MemProfileRate&nbsp;to&nbsp;1.</span><br>
<span class="lineno"></span><span class="comment" id="2021350">//&nbsp;To&nbsp;turn&nbsp;off&nbsp;profiling&nbsp;entirely,&nbsp;set&nbsp;MemProfileRate&nbsp;to&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="2021410">//</span><br>
<span class="lineno"></span><span class="comment" id="2021413">//&nbsp;The&nbsp;tools&nbsp;that&nbsp;process&nbsp;the&nbsp;memory&nbsp;profiles&nbsp;assume&nbsp;that&nbsp;the</span><br>
<span class="lineno">350</span><span class="comment" id="2021475">//&nbsp;profile&nbsp;rate&nbsp;is&nbsp;constant&nbsp;across&nbsp;the&nbsp;lifetime&nbsp;of&nbsp;the&nbsp;program</span><br>
<span class="lineno"></span><span class="comment" id="2021538">//&nbsp;and&nbsp;equal&nbsp;to&nbsp;the&nbsp;current&nbsp;value.&nbsp;&nbsp;Programs&nbsp;that&nbsp;change&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2021599">//&nbsp;memory&nbsp;profiling&nbsp;rate&nbsp;should&nbsp;do&nbsp;so&nbsp;just&nbsp;once,&nbsp;as&nbsp;early&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="2021660">//&nbsp;possible&nbsp;in&nbsp;the&nbsp;execution&nbsp;of&nbsp;the&nbsp;program&nbsp;(for&nbsp;example,</span><br>
<span class="lineno"></span><span class="comment" id="2021718">//&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;main).</span><br>
<span class="lineno">355</span><span class="keyword" id="2021748">var</span>&nbsp;<span class="ident" id="2021752">MemProfileRate</span>&nbsp;<span class="builtintype" id="2021767">int</span>&nbsp;<span class="op" id="2021771">=</span>&nbsp;<span class="num" id="2021773">512</span>&nbsp;<span class="op" id="2021777">*</span>&nbsp;<span class="num" id="2021779">1024</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2021785">//&nbsp;A&nbsp;MemProfileRecord&nbsp;describes&nbsp;the&nbsp;live&nbsp;objects&nbsp;allocated</span><br>
<span class="lineno"></span><span class="comment" id="2021844">//&nbsp;by&nbsp;a&nbsp;particular&nbsp;call&nbsp;sequence&nbsp;(stack&nbsp;trace).</span><br>
<span class="lineno"></span><span class="keyword" id="2021892">type</span>&nbsp;<span class="ident" id="2021897">MemProfileRecord</span>&nbsp;<span class="keyword" id="2021914">struct</span>&nbsp;<span class="op" id="2021921">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2021924">AllocBytes</span><span class="op" id="2021934">,</span>&nbsp;<span class="ident" id="2021936">FreeBytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2021950">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2021962">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;allocated,&nbsp;freed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2021999">AllocObjects</span><span class="op" id="2022011">,</span>&nbsp;<span class="ident" id="2022013">FreeObjects</span>&nbsp;<span class="ident" id="2022025">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2022037">//&nbsp;number&nbsp;of&nbsp;objects&nbsp;allocated,&nbsp;freed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2022076">Stack0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2022102">[</span><span class="num" id="2022103">32</span><span class="op" id="2022105">]</span><span class="builtintype" id="2022106">uintptr</span>&nbsp;<span class="comment" id="2022114">//&nbsp;stack&nbsp;trace&nbsp;for&nbsp;this&nbsp;record;&nbsp;ends&nbsp;at&nbsp;first&nbsp;0&nbsp;entry</span><br>
<span class="lineno"></span><span class="op" id="2022168">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="2022171">//&nbsp;InUseBytes&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;in&nbsp;use&nbsp;(AllocBytes&nbsp;-&nbsp;FreeBytes).</span><br>
<span class="lineno"></span><span class="keyword" id="2022246">func</span>&nbsp;<span class="op" id="2022251">(</span><span class="ident" id="2022252">r</span>&nbsp;<span class="op" id="2022254">*</span><span class="ident" id="2022255"><a href="/runtime/mprof.go.html#2021897">MemProfileRecord</a></span><span class="op" id="2022271">)</span>&nbsp;<span class="ident" id="2022273">InUseBytes</span><span class="op" id="2022283">(</span><span class="op" id="2022284">)</span>&nbsp;<span class="ident" id="2022286">int64</span>&nbsp;<span class="op" id="2022292">{</span>&nbsp;<span class="keyword" id="2022294">return</span>&nbsp;<span class="ident" id="2022301"><a href="/runtime/mprof.go.html#2022252">r</a></span><span class="op" id="2022302">.</span><span class="ident" id="2022303">AllocBytes</span>&nbsp;<span class="op" id="2022314">-</span>&nbsp;<span class="ident" id="2022316"><a href="/runtime/mprof.go.html#2022252">r</a></span><span class="op" id="2022317">.</span><span class="ident" id="2022318">FreeBytes</span>&nbsp;<span class="op" id="2022328">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2022331">//&nbsp;InUseObjects&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;objects&nbsp;in&nbsp;use&nbsp;(AllocObjects&nbsp;-&nbsp;FreeObjects).</span><br>
<span class="lineno"></span><span class="keyword" id="2022414">func</span>&nbsp;<span class="op" id="2022419">(</span><span class="ident" id="2022420">r</span>&nbsp;<span class="op" id="2022422">*</span><span class="ident" id="2022423"><a href="/runtime/mprof.go.html#2021897">MemProfileRecord</a></span><span class="op" id="2022439">)</span>&nbsp;<span class="ident" id="2022441">InUseObjects</span><span class="op" id="2022453">(</span><span class="op" id="2022454">)</span>&nbsp;<span class="ident" id="2022456">int64</span>&nbsp;<span class="op" id="2022462">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2022465">return</span>&nbsp;<span class="ident" id="2022472"><a href="/runtime/mprof.go.html#2022420">r</a></span><span class="op" id="2022473">.</span><span class="ident" id="2022474">AllocObjects</span>&nbsp;<span class="op" id="2022487">-</span>&nbsp;<span class="ident" id="2022489"><a href="/runtime/mprof.go.html#2022420">r</a></span><span class="op" id="2022490">.</span><span class="ident" id="2022491">FreeObjects</span><br>
<span class="lineno"></span><span class="op" id="2022503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2022506">//&nbsp;Stack&nbsp;returns&nbsp;the&nbsp;stack&nbsp;trace&nbsp;associated&nbsp;with&nbsp;the&nbsp;record,</span><br>
<span class="lineno"></span><span class="comment" id="2022567">//&nbsp;a&nbsp;prefix&nbsp;of&nbsp;r.Stack0.</span><br>
<span class="lineno">375</span><span class="keyword" id="2022592">func</span>&nbsp;<span class="op" id="2022597">(</span><span class="ident" id="2022598">r</span>&nbsp;<span class="op" id="2022600">*</span><span class="ident" id="2022601"><a href="/runtime/mprof.go.html#2021897">MemProfileRecord</a></span><span class="op" id="2022617">)</span>&nbsp;<span class="ident" id="2022619">Stack</span><span class="op" id="2022624">(</span><span class="op" id="2022625">)</span>&nbsp;<span class="op" id="2022627">[</span><span class="op" id="2022628">]</span><span class="builtintype" id="2022629">uintptr</span>&nbsp;<span class="op" id="2022637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2022640">for</span>&nbsp;<span class="ident" id="2022644">i</span><span class="op" id="2022645">,</span>&nbsp;<span class="ident" id="2022647">v</span>&nbsp;<span class="op" id="2022649">:=</span>&nbsp;<span class="keyword" id="2022652">range</span>&nbsp;<span class="ident" id="2022658"><a href="/runtime/mprof.go.html#2022598">r</a></span><span class="op" id="2022659">.</span><span class="ident" id="2022660">Stack0</span>&nbsp;<span class="op" id="2022667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2022671">if</span>&nbsp;<span class="ident" id="2022674"><a href="/runtime/mprof.go.html#2022647">v</a></span>&nbsp;<span class="op" id="2022676">==</span>&nbsp;<span class="num" id="2022679">0</span>&nbsp;<span class="op" id="2022681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2022686">return</span>&nbsp;<span class="ident" id="2022693"><a href="/runtime/mprof.go.html#2022598">r</a></span><span class="op" id="2022694">.</span><span class="ident" id="2022695">Stack0</span><span class="op" id="2022701">[</span><span class="num" id="2022702">0</span><span class="op" id="2022703">:</span><span class="ident" id="2022704"><a href="/runtime/mprof.go.html#2022644">i</a></span><span class="op" id="2022705">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2022709">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2022712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2022715">return</span>&nbsp;<span class="ident" id="2022722"><a href="/runtime/mprof.go.html#2022598">r</a></span><span class="op" id="2022723">.</span><span class="ident" id="2022724">Stack0</span><span class="op" id="2022730">[</span><span class="num" id="2022731">0</span><span class="op" id="2022732">:</span><span class="op" id="2022733">]</span><br>
<span class="lineno"></span><span class="op" id="2022735">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2022738">//&nbsp;MemProfile&nbsp;returns&nbsp;n,&nbsp;the&nbsp;number&nbsp;of&nbsp;records&nbsp;in&nbsp;the&nbsp;current&nbsp;memory&nbsp;profile.</span><br>
<span class="lineno">385</span><span class="comment" id="2022816">//&nbsp;If&nbsp;len(p)&nbsp;&gt;=&nbsp;n,&nbsp;MemProfile&nbsp;copies&nbsp;the&nbsp;profile&nbsp;into&nbsp;p&nbsp;and&nbsp;returns&nbsp;n,&nbsp;true.</span><br>
<span class="lineno"></span><span class="comment" id="2022893">//&nbsp;If&nbsp;len(p)&nbsp;&lt;&nbsp;n,&nbsp;MemProfile&nbsp;does&nbsp;not&nbsp;change&nbsp;p&nbsp;and&nbsp;returns&nbsp;n,&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="2022962">//</span><br>
<span class="lineno"></span><span class="comment" id="2022965">//&nbsp;If&nbsp;inuseZero&nbsp;is&nbsp;true,&nbsp;the&nbsp;profile&nbsp;includes&nbsp;allocation&nbsp;records</span><br>
<span class="lineno"></span><span class="comment" id="2023030">//&nbsp;where&nbsp;r.AllocBytes&nbsp;&gt;&nbsp;0&nbsp;but&nbsp;r.AllocBytes&nbsp;==&nbsp;r.FreeBytes.</span><br>
<span class="lineno">390</span><span class="comment" id="2023089">//&nbsp;These&nbsp;are&nbsp;sites&nbsp;where&nbsp;memory&nbsp;was&nbsp;allocated,&nbsp;but&nbsp;it&nbsp;has&nbsp;all</span><br>
<span class="lineno"></span><span class="comment" id="2023151">//&nbsp;been&nbsp;released&nbsp;back&nbsp;to&nbsp;the&nbsp;runtime.</span><br>
<span class="lineno"></span><span class="comment" id="2023189">//</span><br>
<span class="lineno"></span><span class="comment" id="2023192">//&nbsp;Most&nbsp;clients&nbsp;should&nbsp;use&nbsp;the&nbsp;runtime/pprof&nbsp;package&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="2023248">//&nbsp;the&nbsp;testing&nbsp;package&#39;s&nbsp;-test.memprofile&nbsp;flag&nbsp;instead</span><br>
<span class="lineno">395</span><span class="comment" id="2023303">//&nbsp;of&nbsp;calling&nbsp;MemProfile&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="2023338">func</span>&nbsp;<span class="ident" id="2023343">MemProfile</span><span class="op" id="2023353">(</span><span class="ident" id="2023354">p</span>&nbsp;<span class="op" id="2023356">[</span><span class="op" id="2023357">]</span><span class="ident" id="2023358"><a href="/runtime/mprof.go.html#2021897">MemProfileRecord</a></span><span class="op" id="2023374">,</span>&nbsp;<span class="ident" id="2023376">inuseZero</span>&nbsp;<span class="builtintype" id="2023386">bool</span><span class="op" id="2023390">)</span>&nbsp;<span class="op" id="2023392">(</span><span class="ident" id="2023393">n</span>&nbsp;<span class="builtintype" id="2023395">int</span><span class="op" id="2023398">,</span>&nbsp;<span class="ident" id="2023400">ok</span>&nbsp;<span class="builtintype" id="2023403">bool</span><span class="op" id="2023407">)</span>&nbsp;<span class="op" id="2023409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2023412"><a href="/runtime/lock_futex.go.html#1978439">lock</a></span><span class="op" id="2023416">(</span><span class="op" id="2023417">&amp;</span><span class="ident" id="2023418"><a href="/runtime/mprof.go.html#2012793">proflock</a></span><span class="op" id="2023426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2023429">clear</span>&nbsp;<span class="op" id="2023435">:=</span>&nbsp;<span class="builtintype" id="2023438">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2023444">for</span>&nbsp;<span class="ident" id="2023448">b</span>&nbsp;<span class="op" id="2023450">:=</span>&nbsp;<span class="ident" id="2023453"><a href="/runtime/mprof.go.html#2014967">mbuckets</a></span><span class="op" id="2023461">;</span>&nbsp;<span class="ident" id="2023463"><a href="/runtime/mprof.go.html#2023448">b</a></span>&nbsp;<span class="op" id="2023465">!=</span>&nbsp;<span class="ident" id="2023468">nil</span><span class="op" id="2023471">;</span>&nbsp;<span class="ident" id="2023473"><a href="/runtime/mprof.go.html#2023448">b</a></span>&nbsp;<span class="op" id="2023475">=</span>&nbsp;<span class="ident" id="2023477"><a href="/runtime/mprof.go.html#2023448">b</a></span><span class="op" id="2023478">.</span><span class="ident" id="2023479">allnext</span>&nbsp;<span class="op" id="2023487">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2023491">mp</span>&nbsp;<span class="op" id="2023494">:=</span>&nbsp;<span class="ident" id="2023497"><a href="/runtime/mprof.go.html#2023448">b</a></span><span class="op" id="2023498">.</span><span class="ident" id="2023499">mp</span><span class="op" id="2023501">(</span><span class="op" id="2023502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2023506">if</span>&nbsp;<span class="ident" id="2023509"><a href="/runtime/mprof.go.html#2023376">inuseZero</a></span>&nbsp;<span class="op" id="2023519">||</span>&nbsp;<span class="ident" id="2023522"><a href="/runtime/mprof.go.html#2023491">mp</a></span><span class="op" id="2023524">.</span><span class="ident" id="2023525">alloc_bytes</span>&nbsp;<span class="op" id="2023537">!=</span>&nbsp;<span class="ident" id="2023540"><a href="/runtime/mprof.go.html#2023491">mp</a></span><span class="op" id="2023542">.</span><span class="ident" id="2023543">free_bytes</span>&nbsp;<span class="op" id="2023554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2023559"><a href="/runtime/mprof.go.html#2023393">n</a></span><span class="op" id="2023560">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2023565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2023569">if</span>&nbsp;<span class="ident" id="2023572"><a href="/runtime/mprof.go.html#2023491">mp</a></span><span class="op" id="2023574">.</span><span class="ident" id="2023575">allocs</span>&nbsp;<span class="op" id="2023582">!=</span>&nbsp;<span class="num" id="2023585">0</span>&nbsp;<span class="op" id="2023587">||</span>&nbsp;<span class="ident" id="2023590"><a href="/runtime/mprof.go.html#2023491">mp</a></span><span class="op" id="2023592">.</span><span class="ident" id="2023593">frees</span>&nbsp;<span class="op" id="2023599">!=</span>&nbsp;<span class="num" id="2023602">0</span>&nbsp;<span class="op" id="2023604">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2023609"><a href="/runtime/mprof.go.html#2023429">clear</a></span>&nbsp;<span class="op" id="2023615">=</span>&nbsp;<span class="builtintype" id="2023617">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2023625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2023628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2023631">if</span>&nbsp;<span class="ident" id="2023634"><a href="/runtime/mprof.go.html#2023429">clear</a></span>&nbsp;<span class="op" id="2023640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2023644">//&nbsp;Absolutely&nbsp;no&nbsp;data,&nbsp;suggesting&nbsp;that&nbsp;a&nbsp;garbage&nbsp;collection</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2023706">//&nbsp;has&nbsp;not&nbsp;yet&nbsp;happened.&nbsp;In&nbsp;order&nbsp;to&nbsp;allow&nbsp;profiling&nbsp;when</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2023766">//&nbsp;garbage&nbsp;collection&nbsp;is&nbsp;disabled&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;execution,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2023835">//&nbsp;accumulate&nbsp;stats&nbsp;as&nbsp;if&nbsp;a&nbsp;GC&nbsp;just&nbsp;happened,&nbsp;and&nbsp;recount&nbsp;buckets.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2023904"><a href="/runtime/mprof.go.html#2017623">mprof_GC</a></span><span class="op" id="2023912">(</span><span class="op" id="2023913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2023917"><a href="/runtime/mprof.go.html#2017623">mprof_GC</a></span><span class="op" id="2023925">(</span><span class="op" id="2023926">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2023930"><a href="/runtime/mprof.go.html#2023393">n</a></span>&nbsp;<span class="op" id="2023932">=</span>&nbsp;<span class="num" id="2023934">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2023938">for</span>&nbsp;<span class="ident" id="2023942">b</span>&nbsp;<span class="op" id="2023944">:=</span>&nbsp;<span class="ident" id="2023947"><a href="/runtime/mprof.go.html#2014967">mbuckets</a></span><span class="op" id="2023955">;</span>&nbsp;<span class="ident" id="2023957"><a href="/runtime/mprof.go.html#2023942">b</a></span>&nbsp;<span class="op" id="2023959">!=</span>&nbsp;<span class="ident" id="2023962">nil</span><span class="op" id="2023965">;</span>&nbsp;<span class="ident" id="2023967"><a href="/runtime/mprof.go.html#2023942">b</a></span>&nbsp;<span class="op" id="2023969">=</span>&nbsp;<span class="ident" id="2023971"><a href="/runtime/mprof.go.html#2023942">b</a></span><span class="op" id="2023972">.</span><span class="ident" id="2023973">allnext</span>&nbsp;<span class="op" id="2023981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2023986">mp</span>&nbsp;<span class="op" id="2023989">:=</span>&nbsp;<span class="ident" id="2023992"><a href="/runtime/mprof.go.html#2023942">b</a></span><span class="op" id="2023993">.</span><span class="ident" id="2023994">mp</span><span class="op" id="2023996">(</span><span class="op" id="2023997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2024002">if</span>&nbsp;<span class="ident" id="2024005"><a href="/runtime/mprof.go.html#2023376">inuseZero</a></span>&nbsp;<span class="op" id="2024015">||</span>&nbsp;<span class="ident" id="2024018"><a href="/runtime/mprof.go.html#2023986">mp</a></span><span class="op" id="2024020">.</span><span class="ident" id="2024021">alloc_bytes</span>&nbsp;<span class="op" id="2024033">!=</span>&nbsp;<span class="ident" id="2024036"><a href="/runtime/mprof.go.html#2023986">mp</a></span><span class="op" id="2024038">.</span><span class="ident" id="2024039">free_bytes</span>&nbsp;<span class="op" id="2024050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2024056"><a href="/runtime/mprof.go.html#2023393">n</a></span><span class="op" id="2024057">++</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2024063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2024067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2024070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2024073">if</span>&nbsp;<span class="ident" id="2024076"><a href="/runtime/mprof.go.html#2023393">n</a></span>&nbsp;<span class="op" id="2024078">&lt;=</span>&nbsp;<span class="builtinfunc" id="2024081">len</span><span class="op" id="2024084">(</span><span class="ident" id="2024085"><a href="/runtime/mprof.go.html#2023354">p</a></span><span class="op" id="2024086">)</span>&nbsp;<span class="op" id="2024088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2024092"><a href="/runtime/mprof.go.html#2023400">ok</a></span>&nbsp;<span class="op" id="2024095">=</span>&nbsp;<span class="builtintype" id="2024097">true</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2024104">idx</span>&nbsp;<span class="op" id="2024108">:=</span>&nbsp;<span class="num" id="2024111">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2024115">for</span>&nbsp;<span class="ident" id="2024119">b</span>&nbsp;<span class="op" id="2024121">:=</span>&nbsp;<span class="ident" id="2024124"><a href="/runtime/mprof.go.html#2014967">mbuckets</a></span><span class="op" id="2024132">;</span>&nbsp;<span class="ident" id="2024134"><a href="/runtime/mprof.go.html#2024119">b</a></span>&nbsp;<span class="op" id="2024136">!=</span>&nbsp;<span class="ident" id="2024139">nil</span><span class="op" id="2024142">;</span>&nbsp;<span class="ident" id="2024144"><a href="/runtime/mprof.go.html#2024119">b</a></span>&nbsp;<span class="op" id="2024146">=</span>&nbsp;<span class="ident" id="2024148"><a href="/runtime/mprof.go.html#2024119">b</a></span><span class="op" id="2024149">.</span><span class="ident" id="2024150">allnext</span>&nbsp;<span class="op" id="2024158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2024163">mp</span>&nbsp;<span class="op" id="2024166">:=</span>&nbsp;<span class="ident" id="2024169"><a href="/runtime/mprof.go.html#2024119">b</a></span><span class="op" id="2024170">.</span><span class="ident" id="2024171">mp</span><span class="op" id="2024173">(</span><span class="op" id="2024174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2024179">if</span>&nbsp;<span class="ident" id="2024182"><a href="/runtime/mprof.go.html#2023376">inuseZero</a></span>&nbsp;<span class="op" id="2024192">||</span>&nbsp;<span class="ident" id="2024195"><a href="/runtime/mprof.go.html#2024163">mp</a></span><span class="op" id="2024197">.</span><span class="ident" id="2024198">alloc_bytes</span>&nbsp;<span class="op" id="2024210">!=</span>&nbsp;<span class="ident" id="2024213"><a href="/runtime/mprof.go.html#2024163">mp</a></span><span class="op" id="2024215">.</span><span class="ident" id="2024216">free_bytes</span>&nbsp;<span class="op" id="2024227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2024233"><a href="/runtime/mprof.go.html#2024333">record</a></span><span class="op" id="2024239">(</span><span class="op" id="2024240">&amp;</span><span class="ident" id="2024241"><a href="/runtime/mprof.go.html#2023354">p</a></span><span class="op" id="2024242">[</span><span class="ident" id="2024243"><a href="/runtime/mprof.go.html#2024104">idx</a></span><span class="op" id="2024246">]</span><span class="op" id="2024247">,</span>&nbsp;<span class="ident" id="2024249"><a href="/runtime/mprof.go.html#2024119">b</a></span><span class="op" id="2024250">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2024256"><a href="/runtime/mprof.go.html#2024104">idx</a></span><span class="op" id="2024259">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2024265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2024269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2024272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2024275"><a href="/runtime/lock_futex.go.html#1979731">unlock</a></span><span class="op" id="2024281">(</span><span class="op" id="2024282">&amp;</span><span class="ident" id="2024283"><a href="/runtime/mprof.go.html#2012793">proflock</a></span><span class="op" id="2024291">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2024294">return</span><br>
<span class="lineno"></span><span class="op" id="2024301">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2024304">//&nbsp;Write&nbsp;b&#39;s&nbsp;data&nbsp;to&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="2024328">func</span>&nbsp;<span class="ident" id="2024333">record</span><span class="op" id="2024339">(</span><span class="ident" id="2024340">r</span>&nbsp;<span class="op" id="2024342">*</span><span class="ident" id="2024343"><a href="/runtime/mprof.go.html#2021897">MemProfileRecord</a></span><span class="op" id="2024359">,</span>&nbsp;<span class="ident" id="2024361">b</span>&nbsp;<span class="op" id="2024363">*</span><span class="ident" id="2024364"><a href="/runtime/mprof.go.html#2013560">bucket</a></span><span class="op" id="2024370">)</span>&nbsp;<span class="op" id="2024372">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2024375">mp</span>&nbsp;<span class="op" id="2024378">:=</span>&nbsp;<span class="ident" id="2024381"><a href="/runtime/mprof.go.html#2024361">b</a></span><span class="op" id="2024382">.</span><span class="ident" id="2024383">mp</span><span class="op" id="2024385">(</span><span class="op" id="2024386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2024389"><a href="/runtime/mprof.go.html#2024340">r</a></span><span class="op" id="2024390">.</span><span class="ident" id="2024391">AllocBytes</span>&nbsp;<span class="op" id="2024402">=</span>&nbsp;<span class="ident" id="2024404">int64</span><span class="op" id="2024409">(</span><span class="ident" id="2024410"><a href="/runtime/mprof.go.html#2024375">mp</a></span><span class="op" id="2024412">.</span><span class="ident" id="2024413">alloc_bytes</span><span class="op" id="2024424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2024427"><a href="/runtime/mprof.go.html#2024340">r</a></span><span class="op" id="2024428">.</span><span class="ident" id="2024429">FreeBytes</span>&nbsp;<span class="op" id="2024439">=</span>&nbsp;<span class="ident" id="2024441">int64</span><span class="op" id="2024446">(</span><span class="ident" id="2024447"><a href="/runtime/mprof.go.html#2024375">mp</a></span><span class="op" id="2024449">.</span><span class="ident" id="2024450">free_bytes</span><span class="op" id="2024460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2024463"><a href="/runtime/mprof.go.html#2024340">r</a></span><span class="op" id="2024464">.</span><span class="ident" id="2024465">AllocObjects</span>&nbsp;<span class="op" id="2024478">=</span>&nbsp;<span class="ident" id="2024480">int64</span><span class="op" id="2024485">(</span><span class="ident" id="2024486"><a href="/runtime/mprof.go.html#2024375">mp</a></span><span class="op" id="2024488">.</span><span class="ident" id="2024489">allocs</span><span class="op" id="2024495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2024498"><a href="/runtime/mprof.go.html#2024340">r</a></span><span class="op" id="2024499">.</span><span class="ident" id="2024500">FreeObjects</span>&nbsp;<span class="op" id="2024512">=</span>&nbsp;<span class="ident" id="2024514">int64</span><span class="op" id="2024519">(</span><span class="ident" id="2024520"><a href="/runtime/mprof.go.html#2024375">mp</a></span><span class="op" id="2024522">.</span><span class="ident" id="2024523">frees</span><span class="op" id="2024528">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2024531">copy</span><span class="op" id="2024535">(</span><span class="ident" id="2024536"><a href="/runtime/mprof.go.html#2024340">r</a></span><span class="op" id="2024537">.</span><span class="ident" id="2024538">Stack0</span><span class="op" id="2024544">[</span><span class="op" id="2024545">:</span><span class="op" id="2024546">]</span><span class="op" id="2024547">,</span>&nbsp;<span class="ident" id="2024549"><a href="/runtime/mprof.go.html#2024361">b</a></span><span class="op" id="2024550">.</span><span class="ident" id="2024551">stk</span><span class="op" id="2024554">(</span><span class="op" id="2024555">)</span><span class="op" id="2024556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2024559">for</span>&nbsp;<span class="ident" id="2024563">i</span>&nbsp;<span class="op" id="2024565">:=</span>&nbsp;<span class="builtintype" id="2024568">int</span><span class="op" id="2024571">(</span><span class="ident" id="2024572"><a href="/runtime/mprof.go.html#2024361">b</a></span><span class="op" id="2024573">.</span><span class="ident" id="2024574">nstk</span><span class="op" id="2024578">)</span><span class="op" id="2024579">;</span>&nbsp;<span class="ident" id="2024581"><a href="/runtime/mprof.go.html#2024563">i</a></span>&nbsp;<span class="op" id="2024583">&lt;</span>&nbsp;<span class="builtinfunc" id="2024585">len</span><span class="op" id="2024588">(</span><span class="ident" id="2024589"><a href="/runtime/mprof.go.html#2024340">r</a></span><span class="op" id="2024590">.</span><span class="ident" id="2024591">Stack0</span><span class="op" id="2024597">)</span><span class="op" id="2024598">;</span>&nbsp;<span class="ident" id="2024600"><a href="/runtime/mprof.go.html#2024563">i</a></span><span class="op" id="2024601">++</span>&nbsp;<span class="op" id="2024604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2024608"><a href="/runtime/mprof.go.html#2024340">r</a></span><span class="op" id="2024609">.</span><span class="ident" id="2024610">Stack0</span><span class="op" id="2024616">[</span><span class="ident" id="2024617"><a href="/runtime/mprof.go.html#2024563">i</a></span><span class="op" id="2024618">]</span>&nbsp;<span class="op" id="2024620">=</span>&nbsp;<span class="num" id="2024622">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2024625">}</span><br>
<span class="lineno"></span><span class="op" id="2024627">}</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span><span class="keyword" id="2024630">func</span>&nbsp;<span class="ident" id="2024635">iterate_memprof</span><span class="op" id="2024650">(</span><span class="ident" id="2024651">fn</span>&nbsp;<span class="keyword" id="2024654">func</span><span class="op" id="2024658">(</span><span class="op" id="2024659">*</span><span class="ident" id="2024660"><a href="/runtime/mprof.go.html#2013560">bucket</a></span><span class="op" id="2024666">,</span>&nbsp;<span class="builtintype" id="2024668">uintptr</span><span class="op" id="2024675">,</span>&nbsp;<span class="op" id="2024677">*</span><span class="builtintype" id="2024678">uintptr</span><span class="op" id="2024685">,</span>&nbsp;<span class="builtintype" id="2024687">uintptr</span><span class="op" id="2024694">,</span>&nbsp;<span class="builtintype" id="2024696">uintptr</span><span class="op" id="2024703">,</span>&nbsp;<span class="builtintype" id="2024705">uintptr</span><span class="op" id="2024712">)</span><span class="op" id="2024713">)</span>&nbsp;<span class="op" id="2024715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2024718"><a href="/runtime/lock_futex.go.html#1978439">lock</a></span><span class="op" id="2024722">(</span><span class="op" id="2024723">&amp;</span><span class="ident" id="2024724"><a href="/runtime/mprof.go.html#2012793">proflock</a></span><span class="op" id="2024732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2024735">for</span>&nbsp;<span class="ident" id="2024739">b</span>&nbsp;<span class="op" id="2024741">:=</span>&nbsp;<span class="ident" id="2024744"><a href="/runtime/mprof.go.html#2014967">mbuckets</a></span><span class="op" id="2024752">;</span>&nbsp;<span class="ident" id="2024754"><a href="/runtime/mprof.go.html#2024739">b</a></span>&nbsp;<span class="op" id="2024756">!=</span>&nbsp;<span class="ident" id="2024759">nil</span><span class="op" id="2024762">;</span>&nbsp;<span class="ident" id="2024764"><a href="/runtime/mprof.go.html#2024739">b</a></span>&nbsp;<span class="op" id="2024766">=</span>&nbsp;<span class="ident" id="2024768"><a href="/runtime/mprof.go.html#2024739">b</a></span><span class="op" id="2024769">.</span><span class="ident" id="2024770">allnext</span>&nbsp;<span class="op" id="2024778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2024782">mp</span>&nbsp;<span class="op" id="2024785">:=</span>&nbsp;<span class="ident" id="2024788"><a href="/runtime/mprof.go.html#2024739">b</a></span><span class="op" id="2024789">.</span><span class="ident" id="2024790">mp</span><span class="op" id="2024792">(</span><span class="op" id="2024793">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2024797"><a href="/runtime/mprof.go.html#2024651">fn</a></span><span class="op" id="2024799">(</span><span class="ident" id="2024800"><a href="/runtime/mprof.go.html#2024739">b</a></span><span class="op" id="2024801">,</span>&nbsp;<span class="builtintype" id="2024803">uintptr</span><span class="op" id="2024810">(</span><span class="ident" id="2024811"><a href="/runtime/mprof.go.html#2024739">b</a></span><span class="op" id="2024812">.</span><span class="ident" id="2024813">nstk</span><span class="op" id="2024817">)</span><span class="op" id="2024818">,</span>&nbsp;<span class="op" id="2024820">&amp;</span><span class="ident" id="2024821"><a href="/runtime/mprof.go.html#2024739">b</a></span><span class="op" id="2024822">.</span><span class="ident" id="2024823">stk</span><span class="op" id="2024826">(</span><span class="op" id="2024827">)</span><span class="op" id="2024828">[</span><span class="num" id="2024829">0</span><span class="op" id="2024830">]</span><span class="op" id="2024831">,</span>&nbsp;<span class="ident" id="2024833"><a href="/runtime/mprof.go.html#2024739">b</a></span><span class="op" id="2024834">.</span><span class="ident" id="2024835">size</span><span class="op" id="2024839">,</span>&nbsp;<span class="ident" id="2024841"><a href="/runtime/mprof.go.html#2024782">mp</a></span><span class="op" id="2024843">.</span><span class="ident" id="2024844">allocs</span><span class="op" id="2024850">,</span>&nbsp;<span class="ident" id="2024852"><a href="/runtime/mprof.go.html#2024782">mp</a></span><span class="op" id="2024854">.</span><span class="ident" id="2024855">frees</span><span class="op" id="2024860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2024863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2024866"><a href="/runtime/lock_futex.go.html#1979731">unlock</a></span><span class="op" id="2024872">(</span><span class="op" id="2024873">&amp;</span><span class="ident" id="2024874"><a href="/runtime/mprof.go.html#2012793">proflock</a></span><span class="op" id="2024882">)</span><br>
<span class="lineno"></span><span class="op" id="2024884">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">460</span><span class="comment" id="2024887">//&nbsp;BlockProfileRecord&nbsp;describes&nbsp;blocking&nbsp;events&nbsp;originated</span><br>
<span class="lineno"></span><span class="comment" id="2024946">//&nbsp;at&nbsp;a&nbsp;particular&nbsp;call&nbsp;sequence&nbsp;(stack&nbsp;trace).</span><br>
<span class="lineno"></span><span class="keyword" id="2024994">type</span>&nbsp;<span class="ident" id="2024999">BlockProfileRecord</span>&nbsp;<span class="keyword" id="2025018">struct</span>&nbsp;<span class="op" id="2025025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2025028">Count</span>&nbsp;&nbsp;<span class="ident" id="2025035">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2025042">Cycles</span>&nbsp;<span class="ident" id="2025049">int64</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2025056"><a href="/runtime/mprof.go.html#2020727">StackRecord</a></span><br>
<span class="lineno"></span><span class="op" id="2025068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2025071">//&nbsp;BlockProfile&nbsp;returns&nbsp;n,&nbsp;the&nbsp;number&nbsp;of&nbsp;records&nbsp;in&nbsp;the&nbsp;current&nbsp;blocking&nbsp;profile.</span><br>
<span class="lineno"></span><span class="comment" id="2025153">//&nbsp;If&nbsp;len(p)&nbsp;&gt;=&nbsp;n,&nbsp;BlockProfile&nbsp;copies&nbsp;the&nbsp;profile&nbsp;into&nbsp;p&nbsp;and&nbsp;returns&nbsp;n,&nbsp;true.</span><br>
<span class="lineno">470</span><span class="comment" id="2025232">//&nbsp;If&nbsp;len(p)&nbsp;&lt;&nbsp;n,&nbsp;BlockProfile&nbsp;does&nbsp;not&nbsp;change&nbsp;p&nbsp;and&nbsp;returns&nbsp;n,&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="2025303">//</span><br>
<span class="lineno"></span><span class="comment" id="2025306">//&nbsp;Most&nbsp;clients&nbsp;should&nbsp;use&nbsp;the&nbsp;runtime/pprof&nbsp;package&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="2025362">//&nbsp;the&nbsp;testing&nbsp;package&#39;s&nbsp;-test.blockprofile&nbsp;flag&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="2025419">//&nbsp;of&nbsp;calling&nbsp;BlockProfile&nbsp;directly.</span><br>
<span class="lineno">475</span><span class="keyword" id="2025456">func</span>&nbsp;<span class="ident" id="2025461">BlockProfile</span><span class="op" id="2025473">(</span><span class="ident" id="2025474">p</span>&nbsp;<span class="op" id="2025476">[</span><span class="op" id="2025477">]</span><span class="ident" id="2025478"><a href="/runtime/mprof.go.html#2024999">BlockProfileRecord</a></span><span class="op" id="2025496">)</span>&nbsp;<span class="op" id="2025498">(</span><span class="ident" id="2025499">n</span>&nbsp;<span class="builtintype" id="2025501">int</span><span class="op" id="2025504">,</span>&nbsp;<span class="ident" id="2025506">ok</span>&nbsp;<span class="builtintype" id="2025509">bool</span><span class="op" id="2025513">)</span>&nbsp;<span class="op" id="2025515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2025518"><a href="/runtime/lock_futex.go.html#1978439">lock</a></span><span class="op" id="2025522">(</span><span class="op" id="2025523">&amp;</span><span class="ident" id="2025524"><a href="/runtime/mprof.go.html#2012793">proflock</a></span><span class="op" id="2025532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2025535">for</span>&nbsp;<span class="ident" id="2025539">b</span>&nbsp;<span class="op" id="2025541">:=</span>&nbsp;<span class="ident" id="2025544"><a href="/runtime/mprof.go.html#2015012">bbuckets</a></span><span class="op" id="2025552">;</span>&nbsp;<span class="ident" id="2025554"><a href="/runtime/mprof.go.html#2025539">b</a></span>&nbsp;<span class="op" id="2025556">!=</span>&nbsp;<span class="ident" id="2025559">nil</span><span class="op" id="2025562">;</span>&nbsp;<span class="ident" id="2025564"><a href="/runtime/mprof.go.html#2025539">b</a></span>&nbsp;<span class="op" id="2025566">=</span>&nbsp;<span class="ident" id="2025568"><a href="/runtime/mprof.go.html#2025539">b</a></span><span class="op" id="2025569">.</span><span class="ident" id="2025570">allnext</span>&nbsp;<span class="op" id="2025578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2025582"><a href="/runtime/mprof.go.html#2025499">n</a></span><span class="op" id="2025583">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2025587">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2025590">if</span>&nbsp;<span class="ident" id="2025593"><a href="/runtime/mprof.go.html#2025499">n</a></span>&nbsp;<span class="op" id="2025595">&lt;=</span>&nbsp;<span class="builtinfunc" id="2025598">len</span><span class="op" id="2025601">(</span><span class="ident" id="2025602"><a href="/runtime/mprof.go.html#2025474">p</a></span><span class="op" id="2025603">)</span>&nbsp;<span class="op" id="2025605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2025609"><a href="/runtime/mprof.go.html#2025506">ok</a></span>&nbsp;<span class="op" id="2025612">=</span>&nbsp;<span class="builtintype" id="2025614">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2025621">for</span>&nbsp;<span class="ident" id="2025625">b</span>&nbsp;<span class="op" id="2025627">:=</span>&nbsp;<span class="ident" id="2025630"><a href="/runtime/mprof.go.html#2015012">bbuckets</a></span><span class="op" id="2025638">;</span>&nbsp;<span class="ident" id="2025640"><a href="/runtime/mprof.go.html#2025625">b</a></span>&nbsp;<span class="op" id="2025642">!=</span>&nbsp;<span class="ident" id="2025645">nil</span><span class="op" id="2025648">;</span>&nbsp;<span class="ident" id="2025650"><a href="/runtime/mprof.go.html#2025625">b</a></span>&nbsp;<span class="op" id="2025652">=</span>&nbsp;<span class="ident" id="2025654"><a href="/runtime/mprof.go.html#2025625">b</a></span><span class="op" id="2025655">.</span><span class="ident" id="2025656">allnext</span>&nbsp;<span class="op" id="2025664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2025669">bp</span>&nbsp;<span class="op" id="2025672">:=</span>&nbsp;<span class="ident" id="2025675"><a href="/runtime/mprof.go.html#2025625">b</a></span><span class="op" id="2025676">.</span><span class="ident" id="2025677">bp</span><span class="op" id="2025679">(</span><span class="op" id="2025680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2025685">r</span>&nbsp;<span class="op" id="2025687">:=</span>&nbsp;<span class="op" id="2025690">&amp;</span><span class="ident" id="2025691"><a href="/runtime/mprof.go.html#2025474">p</a></span><span class="op" id="2025692">[</span><span class="num" id="2025693">0</span><span class="op" id="2025694">]</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2025699"><a href="/runtime/mprof.go.html#2025685">r</a></span><span class="op" id="2025700">.</span><span class="ident" id="2025701">Count</span>&nbsp;<span class="op" id="2025707">=</span>&nbsp;<span class="ident" id="2025709">int64</span><span class="op" id="2025714">(</span><span class="ident" id="2025715"><a href="/runtime/mprof.go.html#2025669">bp</a></span><span class="op" id="2025717">.</span><span class="ident" id="2025718">count</span><span class="op" id="2025723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2025728"><a href="/runtime/mprof.go.html#2025685">r</a></span><span class="op" id="2025729">.</span><span class="ident" id="2025730">Cycles</span>&nbsp;<span class="op" id="2025737">=</span>&nbsp;<span class="ident" id="2025739">int64</span><span class="op" id="2025744">(</span><span class="ident" id="2025745"><a href="/runtime/mprof.go.html#2025669">bp</a></span><span class="op" id="2025747">.</span><span class="ident" id="2025748">cycles</span><span class="op" id="2025754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2025759">i</span>&nbsp;<span class="op" id="2025761">:=</span>&nbsp;<span class="builtinfunc" id="2025764">copy</span><span class="op" id="2025768">(</span><span class="ident" id="2025769"><a href="/runtime/mprof.go.html#2025685">r</a></span><span class="op" id="2025770">.</span><span class="ident" id="2025771">Stack0</span><span class="op" id="2025777">[</span><span class="op" id="2025778">:</span><span class="op" id="2025779">]</span><span class="op" id="2025780">,</span>&nbsp;<span class="ident" id="2025782"><a href="/runtime/mprof.go.html#2025625">b</a></span><span class="op" id="2025783">.</span><span class="ident" id="2025784">stk</span><span class="op" id="2025787">(</span><span class="op" id="2025788">)</span><span class="op" id="2025789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2025794">for</span>&nbsp;<span class="op" id="2025798">;</span>&nbsp;<span class="ident" id="2025800"><a href="/runtime/mprof.go.html#2025759">i</a></span>&nbsp;<span class="op" id="2025802">&lt;</span>&nbsp;<span class="builtinfunc" id="2025804">len</span><span class="op" id="2025807">(</span><span class="ident" id="2025808"><a href="/runtime/mprof.go.html#2025685">r</a></span><span class="op" id="2025809">.</span><span class="ident" id="2025810">Stack0</span><span class="op" id="2025816">)</span><span class="op" id="2025817">;</span>&nbsp;<span class="ident" id="2025819"><a href="/runtime/mprof.go.html#2025759">i</a></span><span class="op" id="2025820">++</span>&nbsp;<span class="op" id="2025823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2025829"><a href="/runtime/mprof.go.html#2025685">r</a></span><span class="op" id="2025830">.</span><span class="ident" id="2025831">Stack0</span><span class="op" id="2025837">[</span><span class="ident" id="2025838"><a href="/runtime/mprof.go.html#2025759">i</a></span><span class="op" id="2025839">]</span>&nbsp;<span class="op" id="2025841">=</span>&nbsp;<span class="num" id="2025843">0</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2025848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2025853"><a href="/runtime/mprof.go.html#2025474">p</a></span>&nbsp;<span class="op" id="2025855">=</span>&nbsp;<span class="ident" id="2025857"><a href="/runtime/mprof.go.html#2025474">p</a></span><span class="op" id="2025858">[</span><span class="num" id="2025859">1</span><span class="op" id="2025860">:</span><span class="op" id="2025861">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2025865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2025868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2025871"><a href="/runtime/lock_futex.go.html#1979731">unlock</a></span><span class="op" id="2025877">(</span><span class="op" id="2025878">&amp;</span><span class="ident" id="2025879"><a href="/runtime/mprof.go.html#2012793">proflock</a></span><span class="op" id="2025887">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2025890">return</span><br>
<span class="lineno"></span><span class="op" id="2025897">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2025900">//&nbsp;ThreadCreateProfile&nbsp;returns&nbsp;n,&nbsp;the&nbsp;number&nbsp;of&nbsp;records&nbsp;in&nbsp;the&nbsp;thread&nbsp;creation&nbsp;profile.</span><br>
<span class="lineno"></span><span class="comment" id="2025988">//&nbsp;If&nbsp;len(p)&nbsp;&gt;=&nbsp;n,&nbsp;ThreadCreateProfile&nbsp;copies&nbsp;the&nbsp;profile&nbsp;into&nbsp;p&nbsp;and&nbsp;returns&nbsp;n,&nbsp;true.</span><br>
<span class="lineno">500</span><span class="comment" id="2026074">//&nbsp;If&nbsp;len(p)&nbsp;&lt;&nbsp;n,&nbsp;ThreadCreateProfile&nbsp;does&nbsp;not&nbsp;change&nbsp;p&nbsp;and&nbsp;returns&nbsp;n,&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="2026152">//</span><br>
<span class="lineno"></span><span class="comment" id="2026155">//&nbsp;Most&nbsp;clients&nbsp;should&nbsp;use&nbsp;the&nbsp;runtime/pprof&nbsp;package&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="2026216">//&nbsp;of&nbsp;calling&nbsp;ThreadCreateProfile&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="2026260">func</span>&nbsp;<span class="ident" id="2026265">ThreadCreateProfile</span><span class="op" id="2026284">(</span><span class="ident" id="2026285">p</span>&nbsp;<span class="op" id="2026287">[</span><span class="op" id="2026288">]</span><span class="ident" id="2026289"><a href="/runtime/mprof.go.html#2020727">StackRecord</a></span><span class="op" id="2026300">)</span>&nbsp;<span class="op" id="2026302">(</span><span class="ident" id="2026303">n</span>&nbsp;<span class="builtintype" id="2026305">int</span><span class="op" id="2026308">,</span>&nbsp;<span class="ident" id="2026310">ok</span>&nbsp;<span class="builtintype" id="2026313">bool</span><span class="op" id="2026317">)</span>&nbsp;<span class="op" id="2026319">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2026322">first</span>&nbsp;<span class="op" id="2026328">:=</span>&nbsp;<span class="op" id="2026331">(</span><span class="op" id="2026332">*</span><span class="ident" id="2026333"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2180912">m</a></span><span class="op" id="2026334">)</span><span class="op" id="2026335">(</span><span class="ident" id="2026336"><a href="/runtime/atomic.go.html#1874536">atomicloadp</a></span><span class="op" id="2026347">(</span><span class="ident" id="2026348"><a href="/runtime/mprof.go.html#2012702">unsafe</a></span><span class="op" id="2026354">.</span><span class="ident" id="2026355">Pointer</span><span class="op" id="2026362">(</span><span class="op" id="2026363">&amp;</span><span class="ident" id="2026364"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2184344">allm</a></span><span class="op" id="2026368">)</span><span class="op" id="2026369">)</span><span class="op" id="2026370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2026373">for</span>&nbsp;<span class="ident" id="2026377">mp</span>&nbsp;<span class="op" id="2026380">:=</span>&nbsp;<span class="ident" id="2026383"><a href="/runtime/mprof.go.html#2026322">first</a></span><span class="op" id="2026388">;</span>&nbsp;<span class="ident" id="2026390"><a href="/runtime/mprof.go.html#2026377">mp</a></span>&nbsp;<span class="op" id="2026393">!=</span>&nbsp;<span class="ident" id="2026396">nil</span><span class="op" id="2026399">;</span>&nbsp;<span class="ident" id="2026401"><a href="/runtime/mprof.go.html#2026377">mp</a></span>&nbsp;<span class="op" id="2026404">=</span>&nbsp;<span class="ident" id="2026406"><a href="/runtime/mprof.go.html#2026377">mp</a></span><span class="op" id="2026408">.</span><span class="ident" id="2026409">alllink</span>&nbsp;<span class="op" id="2026417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2026421"><a href="/runtime/mprof.go.html#2026303">n</a></span><span class="op" id="2026422">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2026426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2026429">if</span>&nbsp;<span class="ident" id="2026432"><a href="/runtime/mprof.go.html#2026303">n</a></span>&nbsp;<span class="op" id="2026434">&lt;=</span>&nbsp;<span class="builtinfunc" id="2026437">len</span><span class="op" id="2026440">(</span><span class="ident" id="2026441"><a href="/runtime/mprof.go.html#2026285">p</a></span><span class="op" id="2026442">)</span>&nbsp;<span class="op" id="2026444">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2026448"><a href="/runtime/mprof.go.html#2026310">ok</a></span>&nbsp;<span class="op" id="2026451">=</span>&nbsp;<span class="builtintype" id="2026453">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2026460">i</span>&nbsp;<span class="op" id="2026462">:=</span>&nbsp;<span class="num" id="2026465">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2026469">for</span>&nbsp;<span class="ident" id="2026473">mp</span>&nbsp;<span class="op" id="2026476">:=</span>&nbsp;<span class="ident" id="2026479"><a href="/runtime/mprof.go.html#2026322">first</a></span><span class="op" id="2026484">;</span>&nbsp;<span class="ident" id="2026486"><a href="/runtime/mprof.go.html#2026473">mp</a></span>&nbsp;<span class="op" id="2026489">!=</span>&nbsp;<span class="ident" id="2026492">nil</span><span class="op" id="2026495">;</span>&nbsp;<span class="ident" id="2026497"><a href="/runtime/mprof.go.html#2026473">mp</a></span>&nbsp;<span class="op" id="2026500">=</span>&nbsp;<span class="ident" id="2026502"><a href="/runtime/mprof.go.html#2026473">mp</a></span><span class="op" id="2026504">.</span><span class="ident" id="2026505">alllink</span>&nbsp;<span class="op" id="2026513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2026518">for</span>&nbsp;<span class="ident" id="2026522">s</span>&nbsp;<span class="op" id="2026524">:=</span>&nbsp;<span class="keyword" id="2026527">range</span>&nbsp;<span class="ident" id="2026533"><a href="/runtime/mprof.go.html#2026473">mp</a></span><span class="op" id="2026535">.</span><span class="ident" id="2026536">createstack</span>&nbsp;<span class="op" id="2026548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2026554"><a href="/runtime/mprof.go.html#2026285">p</a></span><span class="op" id="2026555">[</span><span class="ident" id="2026556"><a href="/runtime/mprof.go.html#2026460">i</a></span><span class="op" id="2026557">]</span><span class="op" id="2026558">.</span><span class="ident" id="2026559">Stack0</span><span class="op" id="2026565">[</span><span class="ident" id="2026566"><a href="/runtime/mprof.go.html#2026522">s</a></span><span class="op" id="2026567">]</span>&nbsp;<span class="op" id="2026569">=</span>&nbsp;<span class="builtintype" id="2026571">uintptr</span><span class="op" id="2026578">(</span><span class="ident" id="2026579"><a href="/runtime/mprof.go.html#2026473">mp</a></span><span class="op" id="2026581">.</span><span class="ident" id="2026582">createstack</span><span class="op" id="2026593">[</span><span class="ident" id="2026594"><a href="/runtime/mprof.go.html#2026522">s</a></span><span class="op" id="2026595">]</span><span class="op" id="2026596">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2026601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2026606"><a href="/runtime/mprof.go.html#2026460">i</a></span><span class="op" id="2026607">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2026612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2026615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2026618">return</span><br>
<span class="lineno">520</span><span class="op" id="2026625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2026628">var</span>&nbsp;<span class="ident" id="2026632">allgs</span>&nbsp;<span class="op" id="2026638">[</span><span class="op" id="2026639">]</span><span class="op" id="2026640">*</span><span class="ident" id="2026641"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2180373">g</a></span>&nbsp;<span class="comment" id="2026643">//&nbsp;proc.c</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2026654">//&nbsp;GoroutineProfile&nbsp;returns&nbsp;n,&nbsp;the&nbsp;number&nbsp;of&nbsp;records&nbsp;in&nbsp;the&nbsp;active&nbsp;goroutine&nbsp;stack&nbsp;profile.</span><br>
<span class="lineno">525</span><span class="comment" id="2026746">//&nbsp;If&nbsp;len(p)&nbsp;&gt;=&nbsp;n,&nbsp;GoroutineProfile&nbsp;copies&nbsp;the&nbsp;profile&nbsp;into&nbsp;p&nbsp;and&nbsp;returns&nbsp;n,&nbsp;true.</span><br>
<span class="lineno"></span><span class="comment" id="2026829">//&nbsp;If&nbsp;len(p)&nbsp;&lt;&nbsp;n,&nbsp;GoroutineProfile&nbsp;does&nbsp;not&nbsp;change&nbsp;p&nbsp;and&nbsp;returns&nbsp;n,&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="2026904">//</span><br>
<span class="lineno"></span><span class="comment" id="2026907">//&nbsp;Most&nbsp;clients&nbsp;should&nbsp;use&nbsp;the&nbsp;runtime/pprof&nbsp;package&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="2026968">//&nbsp;of&nbsp;calling&nbsp;GoroutineProfile&nbsp;directly.</span><br>
<span class="lineno">530</span><span class="keyword" id="2027009">func</span>&nbsp;<span class="ident" id="2027014">GoroutineProfile</span><span class="op" id="2027030">(</span><span class="ident" id="2027031">p</span>&nbsp;<span class="op" id="2027033">[</span><span class="op" id="2027034">]</span><span class="ident" id="2027035"><a href="/runtime/mprof.go.html#2020727">StackRecord</a></span><span class="op" id="2027046">)</span>&nbsp;<span class="op" id="2027048">(</span><span class="ident" id="2027049">n</span>&nbsp;<span class="builtintype" id="2027051">int</span><span class="op" id="2027054">,</span>&nbsp;<span class="ident" id="2027056">ok</span>&nbsp;<span class="builtintype" id="2027059">bool</span><span class="op" id="2027063">)</span>&nbsp;<span class="op" id="2027065">{</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2027069"><a href="/runtime/mprof.go.html#2027049">n</a></span>&nbsp;<span class="op" id="2027071">=</span>&nbsp;<span class="ident" id="2027073"><a href="/runtime/debug.go.html#1915288">NumGoroutine</a></span><span class="op" id="2027085">(</span><span class="op" id="2027086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2027089">if</span>&nbsp;<span class="ident" id="2027092"><a href="/runtime/mprof.go.html#2027049">n</a></span>&nbsp;<span class="op" id="2027094">&lt;=</span>&nbsp;<span class="builtinfunc" id="2027097">len</span><span class="op" id="2027100">(</span><span class="ident" id="2027101"><a href="/runtime/mprof.go.html#2027031">p</a></span><span class="op" id="2027102">)</span>&nbsp;<span class="op" id="2027104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2027108">gp</span>&nbsp;<span class="op" id="2027111">:=</span>&nbsp;<span class="ident" id="2027114"><a href="/runtime/stubs.go.html#2132021">getg</a></span><span class="op" id="2027118">(</span><span class="op" id="2027119">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2027123"><a href="/runtime/sema.go.html#2096000">semacquire</a></span><span class="op" id="2027133">(</span><span class="op" id="2027134">&amp;</span><span class="ident" id="2027135"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2184696">worldsema</a></span><span class="op" id="2027144">,</span>&nbsp;<span class="builtintype" id="2027146">false</span><span class="op" id="2027151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2027155"><a href="/runtime/mprof.go.html#2027108">gp</a></span><span class="op" id="2027157">.</span><span class="ident" id="2027158">m</span><span class="op" id="2027159">.</span><span class="ident" id="2027160">gcing</span>&nbsp;<span class="op" id="2027166">=</span>&nbsp;<span class="num" id="2027168">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2027172"><a href="/runtime/stubs.go.html#2134137">onM</a></span><span class="op" id="2027175">(</span><span class="ident" id="2027176"><a href="/runtime/stubs.go.html#2135896">stoptheworld</a></span><span class="op" id="2027188">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2027193"><a href="/runtime/mprof.go.html#2027049">n</a></span>&nbsp;<span class="op" id="2027195">=</span>&nbsp;<span class="ident" id="2027197"><a href="/runtime/debug.go.html#1915288">NumGoroutine</a></span><span class="op" id="2027209">(</span><span class="op" id="2027210">)</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2027214">if</span>&nbsp;<span class="ident" id="2027217"><a href="/runtime/mprof.go.html#2027049">n</a></span>&nbsp;<span class="op" id="2027219">&lt;=</span>&nbsp;<span class="builtinfunc" id="2027222">len</span><span class="op" id="2027225">(</span><span class="ident" id="2027226"><a href="/runtime/mprof.go.html#2027031">p</a></span><span class="op" id="2027227">)</span>&nbsp;<span class="op" id="2027229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2027234"><a href="/runtime/mprof.go.html#2027056">ok</a></span>&nbsp;<span class="op" id="2027237">=</span>&nbsp;<span class="builtintype" id="2027239">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2027247">r</span>&nbsp;<span class="op" id="2027249">:=</span>&nbsp;<span class="ident" id="2027252"><a href="/runtime/mprof.go.html#2027031">p</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2027257">sp</span>&nbsp;<span class="op" id="2027260">:=</span>&nbsp;<span class="ident" id="2027263"><a href="/runtime/stubs.go.html#2139560">getcallersp</a></span><span class="op" id="2027274">(</span><span class="ident" id="2027275"><a href="/runtime/mprof.go.html#2012702">unsafe</a></span><span class="op" id="2027281">.</span><span class="ident" id="2027282">Pointer</span><span class="op" id="2027289">(</span><span class="op" id="2027290">&amp;</span><span class="ident" id="2027291"><a href="/runtime/mprof.go.html#2027031">p</a></span><span class="op" id="2027292">)</span><span class="op" id="2027293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2027298">pc</span>&nbsp;<span class="op" id="2027301">:=</span>&nbsp;<span class="ident" id="2027304"><a href="/runtime/stubs.go.html#2139499">getcallerpc</a></span><span class="op" id="2027315">(</span><span class="ident" id="2027316"><a href="/runtime/mprof.go.html#2012702">unsafe</a></span><span class="op" id="2027322">.</span><span class="ident" id="2027323">Pointer</span><span class="op" id="2027330">(</span><span class="op" id="2027331">&amp;</span><span class="ident" id="2027332"><a href="/runtime/mprof.go.html#2027031">p</a></span><span class="op" id="2027333">)</span><span class="op" id="2027334">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2027339"><a href="/runtime/stubs.go.html#2134137">onM</a></span><span class="op" id="2027342">(</span><span class="keyword" id="2027343">func</span><span class="op" id="2027347">(</span><span class="op" id="2027348">)</span>&nbsp;<span class="op" id="2027350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2027356"><a href="/runtime/mprof.go.html#2027661">saveg</a></span><span class="op" id="2027361">(</span><span class="ident" id="2027362"><a href="/runtime/mprof.go.html#2027298">pc</a></span><span class="op" id="2027364">,</span>&nbsp;<span class="ident" id="2027366"><a href="/runtime/mprof.go.html#2027257">sp</a></span><span class="op" id="2027368">,</span>&nbsp;<span class="ident" id="2027370"><a href="/runtime/mprof.go.html#2027108">gp</a></span><span class="op" id="2027372">,</span>&nbsp;<span class="op" id="2027374">&amp;</span><span class="ident" id="2027375"><a href="/runtime/mprof.go.html#2027247">r</a></span><span class="op" id="2027376">[</span><span class="num" id="2027377">0</span><span class="op" id="2027378">]</span><span class="op" id="2027379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2027384">}</span><span class="op" id="2027385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2027390"><a href="/runtime/mprof.go.html#2027247">r</a></span>&nbsp;<span class="op" id="2027392">=</span>&nbsp;<span class="ident" id="2027394"><a href="/runtime/mprof.go.html#2027247">r</a></span><span class="op" id="2027395">[</span><span class="num" id="2027396">1</span><span class="op" id="2027397">:</span><span class="op" id="2027398">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2027403">for</span>&nbsp;<span class="ident" id="2027407">_</span><span class="op" id="2027408">,</span>&nbsp;<span class="ident" id="2027410">gp1</span>&nbsp;<span class="op" id="2027414">:=</span>&nbsp;<span class="keyword" id="2027417">range</span>&nbsp;<span class="ident" id="2027423"><a href="/runtime/mprof.go.html#2026632">allgs</a></span>&nbsp;<span class="op" id="2027429">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2027435">if</span>&nbsp;<span class="ident" id="2027438"><a href="/runtime/mprof.go.html#2027410">gp1</a></span>&nbsp;<span class="op" id="2027442">==</span>&nbsp;<span class="ident" id="2027445"><a href="/runtime/mprof.go.html#2027108">gp</a></span>&nbsp;<span class="op" id="2027448">||</span>&nbsp;<span class="ident" id="2027451"><a href="/runtime/stubs.go.html#2132100">readgstatus</a></span><span class="op" id="2027462">(</span><span class="ident" id="2027463"><a href="/runtime/mprof.go.html#2027410">gp1</a></span><span class="op" id="2027466">)</span>&nbsp;<span class="op" id="2027468">==</span>&nbsp;<span class="ident" id="2027471"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2178984">_Gdead</a></span>&nbsp;<span class="op" id="2027478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2027485">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2027498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2027504"><a href="/runtime/mprof.go.html#2027661">saveg</a></span><span class="op" id="2027509">(</span><span class="op" id="2027510">^</span><span class="builtintype" id="2027511">uintptr</span><span class="op" id="2027518">(</span><span class="num" id="2027519">0</span><span class="op" id="2027520">)</span><span class="op" id="2027521">,</span>&nbsp;<span class="op" id="2027523">^</span><span class="builtintype" id="2027524">uintptr</span><span class="op" id="2027531">(</span><span class="num" id="2027532">0</span><span class="op" id="2027533">)</span><span class="op" id="2027534">,</span>&nbsp;<span class="ident" id="2027536"><a href="/runtime/mprof.go.html#2027410">gp1</a></span><span class="op" id="2027539">,</span>&nbsp;<span class="op" id="2027541">&amp;</span><span class="ident" id="2027542"><a href="/runtime/mprof.go.html#2027247">r</a></span><span class="op" id="2027543">[</span><span class="num" id="2027544">0</span><span class="op" id="2027545">]</span><span class="op" id="2027546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2027552"><a href="/runtime/mprof.go.html#2027247">r</a></span>&nbsp;<span class="op" id="2027554">=</span>&nbsp;<span class="ident" id="2027556"><a href="/runtime/mprof.go.html#2027247">r</a></span><span class="op" id="2027557">[</span><span class="num" id="2027558">1</span><span class="op" id="2027559">:</span><span class="op" id="2027560">]</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2027565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2027569">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2027574"><a href="/runtime/mprof.go.html#2027108">gp</a></span><span class="op" id="2027576">.</span><span class="ident" id="2027577">m</span><span class="op" id="2027578">.</span><span class="ident" id="2027579">gcing</span>&nbsp;<span class="op" id="2027585">=</span>&nbsp;<span class="num" id="2027587">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2027591"><a href="/runtime/sema.go.html#2097084">semrelease</a></span><span class="op" id="2027601">(</span><span class="op" id="2027602">&amp;</span><span class="ident" id="2027603"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2184696">worldsema</a></span><span class="op" id="2027612">)</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2027616"><a href="/runtime/stubs.go.html#2134137">onM</a></span><span class="op" id="2027619">(</span><span class="ident" id="2027620"><a href="/runtime/stubs.go.html#2135875">starttheworld</a></span><span class="op" id="2027633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2027636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2027640">return</span>&nbsp;<span class="ident" id="2027647"><a href="/runtime/mprof.go.html#2027049">n</a></span><span class="op" id="2027648">,</span>&nbsp;<span class="ident" id="2027650"><a href="/runtime/mprof.go.html#2027056">ok</a></span><br>
<span class="lineno"></span><span class="op" id="2027653">}</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span><span class="keyword" id="2027656">func</span>&nbsp;<span class="ident" id="2027661">saveg</span><span class="op" id="2027666">(</span><span class="ident" id="2027667">pc</span><span class="op" id="2027669">,</span>&nbsp;<span class="ident" id="2027671">sp</span>&nbsp;<span class="builtintype" id="2027674">uintptr</span><span class="op" id="2027681">,</span>&nbsp;<span class="ident" id="2027683">gp</span>&nbsp;<span class="op" id="2027686">*</span><span class="ident" id="2027687"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2180373">g</a></span><span class="op" id="2027688">,</span>&nbsp;<span class="ident" id="2027690">r</span>&nbsp;<span class="op" id="2027692">*</span><span class="ident" id="2027693"><a href="/runtime/mprof.go.html#2020727">StackRecord</a></span><span class="op" id="2027704">)</span>&nbsp;<span class="op" id="2027706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2027709">n</span>&nbsp;<span class="op" id="2027711">:=</span>&nbsp;<span class="ident" id="2027714"><a href="/runtime/traceback.go.html#2159312">gentraceback</a></span><span class="op" id="2027726">(</span><span class="ident" id="2027727"><a href="/runtime/mprof.go.html#2027667">pc</a></span><span class="op" id="2027729">,</span>&nbsp;<span class="ident" id="2027731"><a href="/runtime/mprof.go.html#2027671">sp</a></span><span class="op" id="2027733">,</span>&nbsp;<span class="num" id="2027735">0</span><span class="op" id="2027736">,</span>&nbsp;<span class="ident" id="2027738"><a href="/runtime/mprof.go.html#2027683">gp</a></span><span class="op" id="2027740">,</span>&nbsp;<span class="num" id="2027742">0</span><span class="op" id="2027743">,</span>&nbsp;<span class="op" id="2027745">&amp;</span><span class="ident" id="2027746"><a href="/runtime/mprof.go.html#2027690">r</a></span><span class="op" id="2027747">.</span><span class="ident" id="2027748">Stack0</span><span class="op" id="2027754">[</span><span class="num" id="2027755">0</span><span class="op" id="2027756">]</span><span class="op" id="2027757">,</span>&nbsp;<span class="builtinfunc" id="2027759">len</span><span class="op" id="2027762">(</span><span class="ident" id="2027763"><a href="/runtime/mprof.go.html#2027690">r</a></span><span class="op" id="2027764">.</span><span class="ident" id="2027765">Stack0</span><span class="op" id="2027771">)</span><span class="op" id="2027772">,</span>&nbsp;<span class="ident" id="2027774">nil</span><span class="op" id="2027777">,</span>&nbsp;<span class="ident" id="2027779">nil</span><span class="op" id="2027782">,</span>&nbsp;<span class="num" id="2027784">0</span><span class="op" id="2027785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2027788">if</span>&nbsp;<span class="ident" id="2027791"><a href="/runtime/mprof.go.html#2027709">n</a></span>&nbsp;<span class="op" id="2027793">&lt;</span>&nbsp;<span class="builtinfunc" id="2027795">len</span><span class="op" id="2027798">(</span><span class="ident" id="2027799"><a href="/runtime/mprof.go.html#2027690">r</a></span><span class="op" id="2027800">.</span><span class="ident" id="2027801">Stack0</span><span class="op" id="2027807">)</span>&nbsp;<span class="op" id="2027809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2027813"><a href="/runtime/mprof.go.html#2027690">r</a></span><span class="op" id="2027814">.</span><span class="ident" id="2027815">Stack0</span><span class="op" id="2027821">[</span><span class="ident" id="2027822"><a href="/runtime/mprof.go.html#2027709">n</a></span><span class="op" id="2027823">]</span>&nbsp;<span class="op" id="2027825">=</span>&nbsp;<span class="num" id="2027827">0</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2027830">}</span><br>
<span class="lineno"></span><span class="op" id="2027832">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2027835">//&nbsp;Stack&nbsp;formats&nbsp;a&nbsp;stack&nbsp;trace&nbsp;of&nbsp;the&nbsp;calling&nbsp;goroutine&nbsp;into&nbsp;buf</span><br>
<span class="lineno"></span><span class="comment" id="2027900">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written&nbsp;to&nbsp;buf.</span><br>
<span class="lineno">575</span><span class="comment" id="2027951">//&nbsp;If&nbsp;all&nbsp;is&nbsp;true,&nbsp;Stack&nbsp;formats&nbsp;stack&nbsp;traces&nbsp;of&nbsp;all&nbsp;other&nbsp;goroutines</span><br>
<span class="lineno"></span><span class="comment" id="2028021">//&nbsp;into&nbsp;buf&nbsp;after&nbsp;the&nbsp;trace&nbsp;for&nbsp;the&nbsp;current&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="2028076">func</span>&nbsp;<span class="ident" id="2028081">Stack</span><span class="op" id="2028086">(</span><span class="ident" id="2028087">buf</span>&nbsp;<span class="op" id="2028091">[</span><span class="op" id="2028092">]</span><span class="builtintype" id="2028093">byte</span><span class="op" id="2028097">,</span>&nbsp;<span class="ident" id="2028099">all</span>&nbsp;<span class="builtintype" id="2028103">bool</span><span class="op" id="2028107">)</span>&nbsp;<span class="builtintype" id="2028109">int</span>&nbsp;<span class="op" id="2028113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2028116">mp</span>&nbsp;<span class="op" id="2028119">:=</span>&nbsp;<span class="ident" id="2028122"><a href="/runtime/stubs.go.html#2132036">acquirem</a></span><span class="op" id="2028130">(</span><span class="op" id="2028131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2028134">gp</span>&nbsp;<span class="op" id="2028137">:=</span>&nbsp;<span class="ident" id="2028140"><a href="/runtime/mprof.go.html#2028116">mp</a></span><span class="op" id="2028142">.</span><span class="ident" id="2028143">curg</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2028149">if</span>&nbsp;<span class="ident" id="2028152"><a href="/runtime/mprof.go.html#2028099">all</a></span>&nbsp;<span class="op" id="2028156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2028160"><a href="/runtime/sema.go.html#2096000">semacquire</a></span><span class="op" id="2028170">(</span><span class="op" id="2028171">&amp;</span><span class="ident" id="2028172"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2184696">worldsema</a></span><span class="op" id="2028181">,</span>&nbsp;<span class="builtintype" id="2028183">false</span><span class="op" id="2028188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2028192"><a href="/runtime/mprof.go.html#2028116">mp</a></span><span class="op" id="2028194">.</span><span class="ident" id="2028195">gcing</span>&nbsp;<span class="op" id="2028201">=</span>&nbsp;<span class="num" id="2028203">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2028207"><a href="/runtime/stubs.go.html#2132055">releasem</a></span><span class="op" id="2028215">(</span><span class="ident" id="2028216"><a href="/runtime/mprof.go.html#2028116">mp</a></span><span class="op" id="2028218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2028222"><a href="/runtime/stubs.go.html#2134137">onM</a></span><span class="op" id="2028225">(</span><span class="ident" id="2028226"><a href="/runtime/stubs.go.html#2135896">stoptheworld</a></span><span class="op" id="2028238">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2028242">if</span>&nbsp;<span class="ident" id="2028245"><a href="/runtime/mprof.go.html#2028116">mp</a></span>&nbsp;<span class="op" id="2028248">!=</span>&nbsp;<span class="ident" id="2028251"><a href="/runtime/stubs.go.html#2132036">acquirem</a></span><span class="op" id="2028259">(</span><span class="op" id="2028260">)</span>&nbsp;<span class="op" id="2028262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2028267"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="2028274">(</span><span class="string" id="2028275">&#34;Stack:&nbsp;rescheduled&#34;</span><span class="op" id="2028295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2028299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2028302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2028306">n</span>&nbsp;<span class="op" id="2028308">:=</span>&nbsp;<span class="num" id="2028311">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2028314">if</span>&nbsp;<span class="builtinfunc" id="2028317">len</span><span class="op" id="2028320">(</span><span class="ident" id="2028321"><a href="/runtime/mprof.go.html#2028087">buf</a></span><span class="op" id="2028324">)</span>&nbsp;<span class="op" id="2028326">&gt;</span>&nbsp;<span class="num" id="2028328">0</span>&nbsp;<span class="op" id="2028330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2028334">sp</span>&nbsp;<span class="op" id="2028337">:=</span>&nbsp;<span class="ident" id="2028340"><a href="/runtime/stubs.go.html#2139560">getcallersp</a></span><span class="op" id="2028351">(</span><span class="ident" id="2028352"><a href="/runtime/mprof.go.html#2012702">unsafe</a></span><span class="op" id="2028358">.</span><span class="ident" id="2028359">Pointer</span><span class="op" id="2028366">(</span><span class="op" id="2028367">&amp;</span><span class="ident" id="2028368"><a href="/runtime/mprof.go.html#2028087">buf</a></span><span class="op" id="2028371">)</span><span class="op" id="2028372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2028376">pc</span>&nbsp;<span class="op" id="2028379">:=</span>&nbsp;<span class="ident" id="2028382"><a href="/runtime/stubs.go.html#2139499">getcallerpc</a></span><span class="op" id="2028393">(</span><span class="ident" id="2028394"><a href="/runtime/mprof.go.html#2012702">unsafe</a></span><span class="op" id="2028400">.</span><span class="ident" id="2028401">Pointer</span><span class="op" id="2028408">(</span><span class="op" id="2028409">&amp;</span><span class="ident" id="2028410"><a href="/runtime/mprof.go.html#2028087">buf</a></span><span class="op" id="2028413">)</span><span class="op" id="2028414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2028418"><a href="/runtime/stubs.go.html#2134137">onM</a></span><span class="op" id="2028421">(</span><span class="keyword" id="2028422">func</span><span class="op" id="2028426">(</span><span class="op" id="2028427">)</span>&nbsp;<span class="op" id="2028429">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2028434">g0</span>&nbsp;<span class="op" id="2028437">:=</span>&nbsp;<span class="ident" id="2028440"><a href="/runtime/stubs.go.html#2132021">getg</a></span><span class="op" id="2028444">(</span><span class="op" id="2028445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2028450"><a href="/runtime/mprof.go.html#2028434">g0</a></span><span class="op" id="2028452">.</span><span class="ident" id="2028453">writebuf</span>&nbsp;<span class="op" id="2028462">=</span>&nbsp;<span class="ident" id="2028464"><a href="/runtime/mprof.go.html#2028087">buf</a></span><span class="op" id="2028467">[</span><span class="num" id="2028468">0</span><span class="op" id="2028469">:</span><span class="num" id="2028470">0</span><span class="op" id="2028471">:</span><span class="builtinfunc" id="2028472">len</span><span class="op" id="2028475">(</span><span class="ident" id="2028476"><a href="/runtime/mprof.go.html#2028087">buf</a></span><span class="op" id="2028479">)</span><span class="op" id="2028480">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2028485"><a href="/runtime/traceback.go.html#2175392">goroutineheader</a></span><span class="op" id="2028500">(</span><span class="ident" id="2028501"><a href="/runtime/mprof.go.html#2028134">gp</a></span><span class="op" id="2028503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2028508"><a href="/runtime/traceback.go.html#2172370">traceback</a></span><span class="op" id="2028517">(</span><span class="ident" id="2028518"><a href="/runtime/mprof.go.html#2028376">pc</a></span><span class="op" id="2028520">,</span>&nbsp;<span class="ident" id="2028522"><a href="/runtime/mprof.go.html#2028334">sp</a></span><span class="op" id="2028524">,</span>&nbsp;<span class="num" id="2028526">0</span><span class="op" id="2028527">,</span>&nbsp;<span class="ident" id="2028529"><a href="/runtime/mprof.go.html#2028134">gp</a></span><span class="op" id="2028531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2028536">if</span>&nbsp;<span class="ident" id="2028539"><a href="/runtime/mprof.go.html#2028099">all</a></span>&nbsp;<span class="op" id="2028543">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2028549"><a href="/runtime/traceback.go.html#2176310">tracebackothers</a></span><span class="op" id="2028564">(</span><span class="ident" id="2028565"><a href="/runtime/mprof.go.html#2028134">gp</a></span><span class="op" id="2028567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2028572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2028577"><a href="/runtime/mprof.go.html#2028306">n</a></span>&nbsp;<span class="op" id="2028579">=</span>&nbsp;<span class="builtinfunc" id="2028581">len</span><span class="op" id="2028584">(</span><span class="ident" id="2028585"><a href="/runtime/mprof.go.html#2028434">g0</a></span><span class="op" id="2028587">.</span><span class="ident" id="2028588">writebuf</span><span class="op" id="2028596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2028601"><a href="/runtime/mprof.go.html#2028434">g0</a></span><span class="op" id="2028603">.</span><span class="ident" id="2028604">writebuf</span>&nbsp;<span class="op" id="2028613">=</span>&nbsp;<span class="ident" id="2028615">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2028621">}</span><span class="op" id="2028622">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2028625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2028629">if</span>&nbsp;<span class="ident" id="2028632"><a href="/runtime/mprof.go.html#2028099">all</a></span>&nbsp;<span class="op" id="2028636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2028640"><a href="/runtime/mprof.go.html#2028116">mp</a></span><span class="op" id="2028642">.</span><span class="ident" id="2028643">gcing</span>&nbsp;<span class="op" id="2028649">=</span>&nbsp;<span class="num" id="2028651">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2028655"><a href="/runtime/sema.go.html#2097084">semrelease</a></span><span class="op" id="2028665">(</span><span class="op" id="2028666">&amp;</span><span class="ident" id="2028667"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2184696">worldsema</a></span><span class="op" id="2028676">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2028680"><a href="/runtime/stubs.go.html#2134137">onM</a></span><span class="op" id="2028683">(</span><span class="ident" id="2028684"><a href="/runtime/stubs.go.html#2135875">starttheworld</a></span><span class="op" id="2028697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2028700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2028703"><a href="/runtime/stubs.go.html#2132055">releasem</a></span><span class="op" id="2028711">(</span><span class="ident" id="2028712"><a href="/runtime/mprof.go.html#2028116">mp</a></span><span class="op" id="2028714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2028717">return</span>&nbsp;<span class="ident" id="2028724"><a href="/runtime/mprof.go.html#2028306">n</a></span><br>
<span class="lineno"></span><span class="op" id="2028726">}</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span><span class="comment" id="2028729">//&nbsp;Tracing&nbsp;of&nbsp;alloc/free/gc.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2028759">var</span>&nbsp;<span class="ident" id="2028763">tracelock</span>&nbsp;<span class="ident" id="2028773"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2179310">mutex</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">620</span><span class="keyword" id="2028780">func</span>&nbsp;<span class="ident" id="2028785">tracealloc</span><span class="op" id="2028795">(</span><span class="ident" id="2028796">p</span>&nbsp;<span class="ident" id="2028798"><a href="/runtime/mprof.go.html#2012702">unsafe</a></span><span class="op" id="2028804">.</span><span class="ident" id="2028805">Pointer</span><span class="op" id="2028812">,</span>&nbsp;<span class="ident" id="2028814">size</span>&nbsp;<span class="builtintype" id="2028819">uintptr</span><span class="op" id="2028826">,</span>&nbsp;<span class="ident" id="2028828">typ</span>&nbsp;<span class="op" id="2028832">*</span><span class="ident" id="2028833"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2188707">_type</a></span><span class="op" id="2028838">)</span>&nbsp;<span class="op" id="2028840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2028843"><a href="/runtime/lock_futex.go.html#1978439">lock</a></span><span class="op" id="2028847">(</span><span class="op" id="2028848">&amp;</span><span class="ident" id="2028849"><a href="/runtime/mprof.go.html#2028763">tracelock</a></span><span class="op" id="2028858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2028861">gp</span>&nbsp;<span class="op" id="2028864">:=</span>&nbsp;<span class="ident" id="2028867"><a href="/runtime/stubs.go.html#2132021">getg</a></span><span class="op" id="2028871">(</span><span class="op" id="2028872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2028875"><a href="/runtime/mprof.go.html#2028861">gp</a></span><span class="op" id="2028877">.</span><span class="ident" id="2028878">m</span><span class="op" id="2028879">.</span><span class="ident" id="2028880">traceback</span>&nbsp;<span class="op" id="2028890">=</span>&nbsp;<span class="num" id="2028892">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2028895">if</span>&nbsp;<span class="ident" id="2028898"><a href="/runtime/mprof.go.html#2028828">typ</a></span>&nbsp;<span class="op" id="2028902">==</span>&nbsp;<span class="ident" id="2028905">nil</span>&nbsp;<span class="op" id="2028909">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2028913">print</span><span class="op" id="2028918">(</span><span class="string" id="2028919">&#34;tracealloc(&#34;</span><span class="op" id="2028932">,</span>&nbsp;<span class="ident" id="2028934"><a href="/runtime/mprof.go.html#2028796">p</a></span><span class="op" id="2028935">,</span>&nbsp;<span class="string" id="2028937">&#34;,&nbsp;&#34;</span><span class="op" id="2028941">,</span>&nbsp;<span class="ident" id="2028943"><a href="/runtime/print1.go.html#2057919">hex</a></span><span class="op" id="2028946">(</span><span class="ident" id="2028947"><a href="/runtime/mprof.go.html#2028814">size</a></span><span class="op" id="2028951">)</span><span class="op" id="2028952">,</span>&nbsp;<span class="string" id="2028954">&#34;)\n&#34;</span><span class="op" id="2028959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2028962">}</span>&nbsp;<span class="keyword" id="2028964">else</span>&nbsp;<span class="op" id="2028969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2028973">print</span><span class="op" id="2028978">(</span><span class="string" id="2028979">&#34;tracealloc(&#34;</span><span class="op" id="2028992">,</span>&nbsp;<span class="ident" id="2028994"><a href="/runtime/mprof.go.html#2028796">p</a></span><span class="op" id="2028995">,</span>&nbsp;<span class="string" id="2028997">&#34;,&nbsp;&#34;</span><span class="op" id="2029001">,</span>&nbsp;<span class="ident" id="2029003"><a href="/runtime/print1.go.html#2057919">hex</a></span><span class="op" id="2029006">(</span><span class="ident" id="2029007"><a href="/runtime/mprof.go.html#2028814">size</a></span><span class="op" id="2029011">)</span><span class="op" id="2029012">,</span>&nbsp;<span class="string" id="2029014">&#34;,&nbsp;&#34;</span><span class="op" id="2029018">,</span>&nbsp;<span class="op" id="2029020">*</span><span class="ident" id="2029021"><a href="/runtime/mprof.go.html#2028828">typ</a></span><span class="op" id="2029024">.</span><span class="ident" id="2029025">_string</span><span class="op" id="2029032">,</span>&nbsp;<span class="string" id="2029034">&#34;)\n&#34;</span><span class="op" id="2029039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2029042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2029045">if</span>&nbsp;<span class="ident" id="2029048"><a href="/runtime/mprof.go.html#2028861">gp</a></span><span class="op" id="2029050">.</span><span class="ident" id="2029051">m</span><span class="op" id="2029052">.</span><span class="ident" id="2029053">curg</span>&nbsp;<span class="op" id="2029058">==</span>&nbsp;<span class="ident" id="2029061">nil</span>&nbsp;<span class="op" id="2029065">||</span>&nbsp;<span class="ident" id="2029068"><a href="/runtime/mprof.go.html#2028861">gp</a></span>&nbsp;<span class="op" id="2029071">==</span>&nbsp;<span class="ident" id="2029074"><a href="/runtime/mprof.go.html#2028861">gp</a></span><span class="op" id="2029076">.</span><span class="ident" id="2029077">m</span><span class="op" id="2029078">.</span><span class="ident" id="2029079">curg</span>&nbsp;<span class="op" id="2029084">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2029088"><a href="/runtime/traceback.go.html#2175392">goroutineheader</a></span><span class="op" id="2029103">(</span><span class="ident" id="2029104"><a href="/runtime/mprof.go.html#2028861">gp</a></span><span class="op" id="2029106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2029110">pc</span>&nbsp;<span class="op" id="2029113">:=</span>&nbsp;<span class="ident" id="2029116"><a href="/runtime/stubs.go.html#2139499">getcallerpc</a></span><span class="op" id="2029127">(</span><span class="ident" id="2029128"><a href="/runtime/mprof.go.html#2012702">unsafe</a></span><span class="op" id="2029134">.</span><span class="ident" id="2029135">Pointer</span><span class="op" id="2029142">(</span><span class="op" id="2029143">&amp;</span><span class="ident" id="2029144"><a href="/runtime/mprof.go.html#2028796">p</a></span><span class="op" id="2029145">)</span><span class="op" id="2029146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2029150">sp</span>&nbsp;<span class="op" id="2029153">:=</span>&nbsp;<span class="ident" id="2029156"><a href="/runtime/stubs.go.html#2139560">getcallersp</a></span><span class="op" id="2029167">(</span><span class="ident" id="2029168"><a href="/runtime/mprof.go.html#2012702">unsafe</a></span><span class="op" id="2029174">.</span><span class="ident" id="2029175">Pointer</span><span class="op" id="2029182">(</span><span class="op" id="2029183">&amp;</span><span class="ident" id="2029184"><a href="/runtime/mprof.go.html#2028796">p</a></span><span class="op" id="2029185">)</span><span class="op" id="2029186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2029190"><a href="/runtime/stubs.go.html#2134137">onM</a></span><span class="op" id="2029193">(</span><span class="keyword" id="2029194">func</span><span class="op" id="2029198">(</span><span class="op" id="2029199">)</span>&nbsp;<span class="op" id="2029201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2029206"><a href="/runtime/traceback.go.html#2172370">traceback</a></span><span class="op" id="2029215">(</span><span class="ident" id="2029216"><a href="/runtime/mprof.go.html#2029110">pc</a></span><span class="op" id="2029218">,</span>&nbsp;<span class="ident" id="2029220"><a href="/runtime/mprof.go.html#2029150">sp</a></span><span class="op" id="2029222">,</span>&nbsp;<span class="num" id="2029224">0</span><span class="op" id="2029225">,</span>&nbsp;<span class="ident" id="2029227"><a href="/runtime/mprof.go.html#2028861">gp</a></span><span class="op" id="2029229">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2029233">}</span><span class="op" id="2029234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2029237">}</span>&nbsp;<span class="keyword" id="2029239">else</span>&nbsp;<span class="op" id="2029244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2029248"><a href="/runtime/traceback.go.html#2175392">goroutineheader</a></span><span class="op" id="2029263">(</span><span class="ident" id="2029264"><a href="/runtime/mprof.go.html#2028861">gp</a></span><span class="op" id="2029266">.</span><span class="ident" id="2029267">m</span><span class="op" id="2029268">.</span><span class="ident" id="2029269">curg</span><span class="op" id="2029273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2029277"><a href="/runtime/traceback.go.html#2172370">traceback</a></span><span class="op" id="2029286">(</span><span class="op" id="2029287">^</span><span class="builtintype" id="2029288">uintptr</span><span class="op" id="2029295">(</span><span class="num" id="2029296">0</span><span class="op" id="2029297">)</span><span class="op" id="2029298">,</span>&nbsp;<span class="op" id="2029300">^</span><span class="builtintype" id="2029301">uintptr</span><span class="op" id="2029308">(</span><span class="num" id="2029309">0</span><span class="op" id="2029310">)</span><span class="op" id="2029311">,</span>&nbsp;<span class="num" id="2029313">0</span><span class="op" id="2029314">,</span>&nbsp;<span class="ident" id="2029316"><a href="/runtime/mprof.go.html#2028861">gp</a></span><span class="op" id="2029318">.</span><span class="ident" id="2029319">m</span><span class="op" id="2029320">.</span><span class="ident" id="2029321">curg</span><span class="op" id="2029325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2029328">}</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2029331">print</span><span class="op" id="2029336">(</span><span class="string" id="2029337">&#34;\n&#34;</span><span class="op" id="2029341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2029344"><a href="/runtime/mprof.go.html#2028861">gp</a></span><span class="op" id="2029346">.</span><span class="ident" id="2029347">m</span><span class="op" id="2029348">.</span><span class="ident" id="2029349">traceback</span>&nbsp;<span class="op" id="2029359">=</span>&nbsp;<span class="num" id="2029361">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2029364"><a href="/runtime/lock_futex.go.html#1979731">unlock</a></span><span class="op" id="2029370">(</span><span class="op" id="2029371">&amp;</span><span class="ident" id="2029372"><a href="/runtime/mprof.go.html#2028763">tracelock</a></span><span class="op" id="2029381">)</span><br>
<span class="lineno"></span><span class="op" id="2029383">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">645</span><span class="keyword" id="2029386">func</span>&nbsp;<span class="ident" id="2029391">tracefree</span><span class="op" id="2029400">(</span><span class="ident" id="2029401">p</span>&nbsp;<span class="ident" id="2029403"><a href="/runtime/mprof.go.html#2012702">unsafe</a></span><span class="op" id="2029409">.</span><span class="ident" id="2029410">Pointer</span><span class="op" id="2029417">,</span>&nbsp;<span class="ident" id="2029419">size</span>&nbsp;<span class="builtintype" id="2029424">uintptr</span><span class="op" id="2029431">)</span>&nbsp;<span class="op" id="2029433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2029436"><a href="/runtime/lock_futex.go.html#1978439">lock</a></span><span class="op" id="2029440">(</span><span class="op" id="2029441">&amp;</span><span class="ident" id="2029442"><a href="/runtime/mprof.go.html#2028763">tracelock</a></span><span class="op" id="2029451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2029454">gp</span>&nbsp;<span class="op" id="2029457">:=</span>&nbsp;<span class="ident" id="2029460"><a href="/runtime/stubs.go.html#2132021">getg</a></span><span class="op" id="2029464">(</span><span class="op" id="2029465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2029468"><a href="/runtime/mprof.go.html#2029454">gp</a></span><span class="op" id="2029470">.</span><span class="ident" id="2029471">m</span><span class="op" id="2029472">.</span><span class="ident" id="2029473">traceback</span>&nbsp;<span class="op" id="2029483">=</span>&nbsp;<span class="num" id="2029485">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2029488">print</span><span class="op" id="2029493">(</span><span class="string" id="2029494">&#34;tracefree(&#34;</span><span class="op" id="2029506">,</span>&nbsp;<span class="ident" id="2029508"><a href="/runtime/mprof.go.html#2029401">p</a></span><span class="op" id="2029509">,</span>&nbsp;<span class="string" id="2029511">&#34;,&nbsp;&#34;</span><span class="op" id="2029515">,</span>&nbsp;<span class="ident" id="2029517"><a href="/runtime/print1.go.html#2057919">hex</a></span><span class="op" id="2029520">(</span><span class="ident" id="2029521"><a href="/runtime/mprof.go.html#2029419">size</a></span><span class="op" id="2029525">)</span><span class="op" id="2029526">,</span>&nbsp;<span class="string" id="2029528">&#34;)\n&#34;</span><span class="op" id="2029533">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2029536"><a href="/runtime/traceback.go.html#2175392">goroutineheader</a></span><span class="op" id="2029551">(</span><span class="ident" id="2029552"><a href="/runtime/mprof.go.html#2029454">gp</a></span><span class="op" id="2029554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2029557">pc</span>&nbsp;<span class="op" id="2029560">:=</span>&nbsp;<span class="ident" id="2029563"><a href="/runtime/stubs.go.html#2139499">getcallerpc</a></span><span class="op" id="2029574">(</span><span class="ident" id="2029575"><a href="/runtime/mprof.go.html#2012702">unsafe</a></span><span class="op" id="2029581">.</span><span class="ident" id="2029582">Pointer</span><span class="op" id="2029589">(</span><span class="op" id="2029590">&amp;</span><span class="ident" id="2029591"><a href="/runtime/mprof.go.html#2029401">p</a></span><span class="op" id="2029592">)</span><span class="op" id="2029593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2029596">sp</span>&nbsp;<span class="op" id="2029599">:=</span>&nbsp;<span class="ident" id="2029602"><a href="/runtime/stubs.go.html#2139560">getcallersp</a></span><span class="op" id="2029613">(</span><span class="ident" id="2029614"><a href="/runtime/mprof.go.html#2012702">unsafe</a></span><span class="op" id="2029620">.</span><span class="ident" id="2029621">Pointer</span><span class="op" id="2029628">(</span><span class="op" id="2029629">&amp;</span><span class="ident" id="2029630"><a href="/runtime/mprof.go.html#2029401">p</a></span><span class="op" id="2029631">)</span><span class="op" id="2029632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2029635"><a href="/runtime/stubs.go.html#2134137">onM</a></span><span class="op" id="2029638">(</span><span class="keyword" id="2029639">func</span><span class="op" id="2029643">(</span><span class="op" id="2029644">)</span>&nbsp;<span class="op" id="2029646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2029650"><a href="/runtime/traceback.go.html#2172370">traceback</a></span><span class="op" id="2029659">(</span><span class="ident" id="2029660"><a href="/runtime/mprof.go.html#2029557">pc</a></span><span class="op" id="2029662">,</span>&nbsp;<span class="ident" id="2029664"><a href="/runtime/mprof.go.html#2029596">sp</a></span><span class="op" id="2029666">,</span>&nbsp;<span class="num" id="2029668">0</span><span class="op" id="2029669">,</span>&nbsp;<span class="ident" id="2029671"><a href="/runtime/mprof.go.html#2029454">gp</a></span><span class="op" id="2029673">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2029676">}</span><span class="op" id="2029677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2029680">print</span><span class="op" id="2029685">(</span><span class="string" id="2029686">&#34;\n&#34;</span><span class="op" id="2029690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2029693"><a href="/runtime/mprof.go.html#2029454">gp</a></span><span class="op" id="2029695">.</span><span class="ident" id="2029696">m</span><span class="op" id="2029697">.</span><span class="ident" id="2029698">traceback</span>&nbsp;<span class="op" id="2029708">=</span>&nbsp;<span class="num" id="2029710">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2029713"><a href="/runtime/lock_futex.go.html#1979731">unlock</a></span><span class="op" id="2029719">(</span><span class="op" id="2029720">&amp;</span><span class="ident" id="2029721"><a href="/runtime/mprof.go.html#2028763">tracelock</a></span><span class="op" id="2029730">)</span><br>
<span class="lineno"></span><span class="op" id="2029732">}</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span><span class="keyword" id="2029735">func</span>&nbsp;<span class="ident" id="2029740">tracegc</span><span class="op" id="2029747">(</span><span class="op" id="2029748">)</span>&nbsp;<span class="op" id="2029750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2029753"><a href="/runtime/lock_futex.go.html#1978439">lock</a></span><span class="op" id="2029757">(</span><span class="op" id="2029758">&amp;</span><span class="ident" id="2029759"><a href="/runtime/mprof.go.html#2028763">tracelock</a></span><span class="op" id="2029768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2029771">gp</span>&nbsp;<span class="op" id="2029774">:=</span>&nbsp;<span class="ident" id="2029777"><a href="/runtime/stubs.go.html#2132021">getg</a></span><span class="op" id="2029781">(</span><span class="op" id="2029782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2029785"><a href="/runtime/mprof.go.html#2029771">gp</a></span><span class="op" id="2029787">.</span><span class="ident" id="2029788">m</span><span class="op" id="2029789">.</span><span class="ident" id="2029790">traceback</span>&nbsp;<span class="op" id="2029800">=</span>&nbsp;<span class="num" id="2029802">2</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2029805">print</span><span class="op" id="2029810">(</span><span class="string" id="2029811">&#34;tracegc()\n&#34;</span><span class="op" id="2029824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2029827">//&nbsp;running&nbsp;on&nbsp;m-&gt;g0&nbsp;stack;&nbsp;show&nbsp;all&nbsp;non-g0&nbsp;goroutines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2029882"><a href="/runtime/traceback.go.html#2176310">tracebackothers</a></span><span class="op" id="2029897">(</span><span class="ident" id="2029898"><a href="/runtime/mprof.go.html#2029771">gp</a></span><span class="op" id="2029900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2029903">print</span><span class="op" id="2029908">(</span><span class="string" id="2029909">&#34;end&nbsp;tracegc\n&#34;</span><span class="op" id="2029924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2029927">print</span><span class="op" id="2029932">(</span><span class="string" id="2029933">&#34;\n&#34;</span><span class="op" id="2029937">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2029940"><a href="/runtime/mprof.go.html#2029771">gp</a></span><span class="op" id="2029942">.</span><span class="ident" id="2029943">m</span><span class="op" id="2029944">.</span><span class="ident" id="2029945">traceback</span>&nbsp;<span class="op" id="2029955">=</span>&nbsp;<span class="num" id="2029957">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2029960"><a href="/runtime/lock_futex.go.html#1979731">unlock</a></span><span class="op" id="2029966">(</span><span class="op" id="2029967">&amp;</span><span class="ident" id="2029968"><a href="/runtime/mprof.go.html#2028763">tracelock</a></span><span class="op" id="2029977">)</span><br>
<span class="lineno"></span><span class="op" id="2029979">}</span>
</div>
</body>
</html>
