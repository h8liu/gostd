<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8210695">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8210750">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8210804">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8210855">package</span>&nbsp;<span class="ident" id="8210863">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8210868">import</span>&nbsp;<span class="op" id="8210875">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8210878">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8210887">&#34;encoding/hex&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8210903">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8210913">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8210921">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8210928">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8210934">&#34;io/ioutil&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8210947">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8210954">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8210965">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8210976">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="8210983">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="8210986">//&nbsp;TLS&nbsp;reference&nbsp;tests&nbsp;run&nbsp;a&nbsp;connection&nbsp;against&nbsp;a&nbsp;reference&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="8211061">//&nbsp;(OpenSSL)&nbsp;of&nbsp;TLS&nbsp;and&nbsp;record&nbsp;the&nbsp;bytes&nbsp;of&nbsp;the&nbsp;resulting&nbsp;connection.&nbsp;The&nbsp;Go</span><br>
<span class="lineno"></span><span class="comment" id="8211138">//&nbsp;code,&nbsp;during&nbsp;a&nbsp;test,&nbsp;is&nbsp;configured&nbsp;with&nbsp;deterministic&nbsp;randomness&nbsp;and&nbsp;so&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="8211217">//&nbsp;reference&nbsp;test&nbsp;can&nbsp;be&nbsp;reproduced&nbsp;exactly&nbsp;in&nbsp;the&nbsp;future.</span><br>
<span class="lineno">25</span><span class="comment" id="8211276">//</span><br>
<span class="lineno"></span><span class="comment" id="8211279">//&nbsp;In&nbsp;order&nbsp;to&nbsp;save&nbsp;everyone&nbsp;who&nbsp;wishes&nbsp;to&nbsp;run&nbsp;the&nbsp;tests&nbsp;from&nbsp;needing&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="8211353">//&nbsp;reference&nbsp;implementation&nbsp;installed,&nbsp;the&nbsp;reference&nbsp;connections&nbsp;are&nbsp;saved&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="8211431">//&nbsp;files&nbsp;in&nbsp;the&nbsp;testdata&nbsp;directory.&nbsp;Thus&nbsp;running&nbsp;the&nbsp;tests&nbsp;involves&nbsp;nothing</span><br>
<span class="lineno"></span><span class="comment" id="8211507">//&nbsp;external,&nbsp;but&nbsp;creating&nbsp;and&nbsp;updating&nbsp;them&nbsp;requires&nbsp;the&nbsp;reference</span><br>
<span class="lineno">30</span><span class="comment" id="8211574">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="comment" id="8211593">//</span><br>
<span class="lineno"></span><span class="comment" id="8211596">//&nbsp;Tests&nbsp;can&nbsp;be&nbsp;updated&nbsp;by&nbsp;running&nbsp;them&nbsp;with&nbsp;the&nbsp;-update&nbsp;flag.&nbsp;This&nbsp;will&nbsp;cause</span><br>
<span class="lineno"></span><span class="comment" id="8211675">//&nbsp;the&nbsp;test&nbsp;files.&nbsp;Generally&nbsp;one&nbsp;should&nbsp;combine&nbsp;the&nbsp;-update&nbsp;flag&nbsp;with&nbsp;-test.run</span><br>
<span class="lineno"></span><span class="comment" id="8211755">//&nbsp;to&nbsp;updated&nbsp;a&nbsp;specific&nbsp;test.&nbsp;Since&nbsp;the&nbsp;reference&nbsp;implementation&nbsp;will&nbsp;always</span><br>
<span class="lineno">35</span><span class="comment" id="8211833">//&nbsp;generate&nbsp;fresh&nbsp;random&nbsp;numbers,&nbsp;large&nbsp;parts&nbsp;of&nbsp;the&nbsp;reference&nbsp;connection&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="8211912">//&nbsp;always&nbsp;change.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8211931">var</span>&nbsp;<span class="ident" id="8211935">update</span>&nbsp;<span class="op" id="8211942">=</span>&nbsp;<span class="ident" id="8211944">flag</span><span class="op" id="8211948">.</span><span class="ident" id="8211949">Bool</span><span class="op" id="8211953">(</span><span class="string" id="8211954">&#34;update&#34;</span><span class="op" id="8211962">,</span>&nbsp;<span class="builtintype" id="8211964">false</span><span class="op" id="8211969">,</span>&nbsp;<span class="string" id="8211971">&#34;update&nbsp;golden&nbsp;files&nbsp;on&nbsp;disk&#34;</span><span class="op" id="8212000">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="8212003">//&nbsp;recordingConn&nbsp;is&nbsp;a&nbsp;net.Conn&nbsp;that&nbsp;records&nbsp;the&nbsp;traffic&nbsp;that&nbsp;passes&nbsp;through&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="8212083">//&nbsp;WriteTo&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;produce&nbsp;output&nbsp;that&nbsp;can&nbsp;be&nbsp;later&nbsp;be&nbsp;loaded&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="8212157">//&nbsp;ParseTestData.</span><br>
<span class="lineno"></span><span class="keyword" id="8212175">type</span>&nbsp;<span class="ident" id="8212180">recordingConn</span>&nbsp;<span class="keyword" id="8212194">struct</span>&nbsp;<span class="op" id="8212201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8212204">net</span><span class="op" id="8212207">.</span><span class="ident" id="8212208">Conn</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8212214">sync</span><span class="op" id="8212218">.</span><span class="ident" id="8212219">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8212226">flows</span>&nbsp;&nbsp;&nbsp;<span class="op" id="8212234">[</span><span class="op" id="8212235">]</span><span class="op" id="8212236">[</span><span class="op" id="8212237">]</span><span class="builtintype" id="8212238">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8212244">reading</span>&nbsp;<span class="builtintype" id="8212252">bool</span><br>
<span class="lineno"></span><span class="op" id="8212257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="8212260">func</span>&nbsp;<span class="op" id="8212265">(</span><span class="ident" id="8212266">r</span>&nbsp;<span class="op" id="8212268">*</span><span class="ident" id="8212269">recordingConn</span><span class="op" id="8212282">)</span>&nbsp;<span class="ident" id="8212284">Read</span><span class="op" id="8212288">(</span><span class="ident" id="8212289">b</span>&nbsp;<span class="op" id="8212291">[</span><span class="op" id="8212292">]</span><span class="builtintype" id="8212293">byte</span><span class="op" id="8212297">)</span>&nbsp;<span class="op" id="8212299">(</span><span class="ident" id="8212300">n</span>&nbsp;<span class="builtintype" id="8212302">int</span><span class="op" id="8212305">,</span>&nbsp;<span class="ident" id="8212307">err</span>&nbsp;<span class="builtintype" id="8212311">error</span><span class="op" id="8212316">)</span>&nbsp;<span class="op" id="8212318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8212321">if</span>&nbsp;<span class="ident" id="8212324">n</span><span class="op" id="8212325">,</span>&nbsp;<span class="ident" id="8212327">err</span>&nbsp;<span class="op" id="8212331">=</span>&nbsp;<span class="ident" id="8212333">r</span><span class="op" id="8212334">.</span><span class="ident" id="8212335">Conn</span><span class="op" id="8212339">.</span><span class="ident" id="8212340">Read</span><span class="op" id="8212344">(</span><span class="ident" id="8212345">b</span><span class="op" id="8212346">)</span><span class="op" id="8212347">;</span>&nbsp;<span class="ident" id="8212349">n</span>&nbsp;<span class="op" id="8212351">==</span>&nbsp;<span class="num" id="8212354">0</span>&nbsp;<span class="op" id="8212356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8212360">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8212368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8212371">b</span>&nbsp;<span class="op" id="8212373">=</span>&nbsp;<span class="ident" id="8212375">b</span><span class="op" id="8212376">[</span><span class="op" id="8212377">:</span><span class="ident" id="8212378">n</span><span class="op" id="8212379">]</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8212383">r</span><span class="op" id="8212384">.</span><span class="ident" id="8212385">Lock</span><span class="op" id="8212389">(</span><span class="op" id="8212390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8212393">defer</span>&nbsp;<span class="ident" id="8212399">r</span><span class="op" id="8212400">.</span><span class="ident" id="8212401">Unlock</span><span class="op" id="8212407">(</span><span class="op" id="8212408">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8212412">if</span>&nbsp;<span class="ident" id="8212415">l</span>&nbsp;<span class="op" id="8212417">:=</span>&nbsp;<span class="builtinfunc" id="8212420">len</span><span class="op" id="8212423">(</span><span class="ident" id="8212424">r</span><span class="op" id="8212425">.</span><span class="ident" id="8212426">flows</span><span class="op" id="8212431">)</span><span class="op" id="8212432">;</span>&nbsp;<span class="ident" id="8212434">l</span>&nbsp;<span class="op" id="8212436">==</span>&nbsp;<span class="num" id="8212439">0</span>&nbsp;<span class="op" id="8212441">||</span>&nbsp;<span class="op" id="8212444">!</span><span class="ident" id="8212445">r</span><span class="op" id="8212446">.</span><span class="ident" id="8212447">reading</span>&nbsp;<span class="op" id="8212455">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8212459">buf</span>&nbsp;<span class="op" id="8212463">:=</span>&nbsp;<span class="builtinfunc" id="8212466">make</span><span class="op" id="8212470">(</span><span class="op" id="8212471">[</span><span class="op" id="8212472">]</span><span class="builtintype" id="8212473">byte</span><span class="op" id="8212477">,</span>&nbsp;<span class="builtinfunc" id="8212479">len</span><span class="op" id="8212482">(</span><span class="ident" id="8212483">b</span><span class="op" id="8212484">)</span><span class="op" id="8212485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8212489">copy</span><span class="op" id="8212493">(</span><span class="ident" id="8212494">buf</span><span class="op" id="8212497">,</span>&nbsp;<span class="ident" id="8212499">b</span><span class="op" id="8212500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8212504">r</span><span class="op" id="8212505">.</span><span class="ident" id="8212506">flows</span>&nbsp;<span class="op" id="8212512">=</span>&nbsp;<span class="builtinfunc" id="8212514">append</span><span class="op" id="8212520">(</span><span class="ident" id="8212521">r</span><span class="op" id="8212522">.</span><span class="ident" id="8212523">flows</span><span class="op" id="8212528">,</span>&nbsp;<span class="ident" id="8212530">buf</span><span class="op" id="8212533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8212536">}</span>&nbsp;<span class="keyword" id="8212538">else</span>&nbsp;<span class="op" id="8212543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8212547">r</span><span class="op" id="8212548">.</span><span class="ident" id="8212549">flows</span><span class="op" id="8212554">[</span><span class="ident" id="8212555">l</span><span class="op" id="8212556">-</span><span class="num" id="8212557">1</span><span class="op" id="8212558">]</span>&nbsp;<span class="op" id="8212560">=</span>&nbsp;<span class="builtinfunc" id="8212562">append</span><span class="op" id="8212568">(</span><span class="ident" id="8212569">r</span><span class="op" id="8212570">.</span><span class="ident" id="8212571">flows</span><span class="op" id="8212576">[</span><span class="ident" id="8212577">l</span><span class="op" id="8212578">-</span><span class="num" id="8212579">1</span><span class="op" id="8212580">]</span><span class="op" id="8212581">,</span>&nbsp;<span class="ident" id="8212583">b</span><span class="op" id="8212584">[</span><span class="op" id="8212585">:</span><span class="ident" id="8212586">n</span><span class="op" id="8212587">]</span><span class="op" id="8212588">...</span><span class="op" id="8212591">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8212594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8212597">r</span><span class="op" id="8212598">.</span><span class="ident" id="8212599">reading</span>&nbsp;<span class="op" id="8212607">=</span>&nbsp;<span class="builtintype" id="8212609">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8212615">return</span><br>
<span class="lineno"></span><span class="op" id="8212622">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="8212625">func</span>&nbsp;<span class="op" id="8212630">(</span><span class="ident" id="8212631">r</span>&nbsp;<span class="op" id="8212633">*</span><span class="ident" id="8212634">recordingConn</span><span class="op" id="8212647">)</span>&nbsp;<span class="ident" id="8212649">Write</span><span class="op" id="8212654">(</span><span class="ident" id="8212655">b</span>&nbsp;<span class="op" id="8212657">[</span><span class="op" id="8212658">]</span><span class="builtintype" id="8212659">byte</span><span class="op" id="8212663">)</span>&nbsp;<span class="op" id="8212665">(</span><span class="ident" id="8212666">n</span>&nbsp;<span class="builtintype" id="8212668">int</span><span class="op" id="8212671">,</span>&nbsp;<span class="ident" id="8212673">err</span>&nbsp;<span class="builtintype" id="8212677">error</span><span class="op" id="8212682">)</span>&nbsp;<span class="op" id="8212684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8212687">if</span>&nbsp;<span class="ident" id="8212690">n</span><span class="op" id="8212691">,</span>&nbsp;<span class="ident" id="8212693">err</span>&nbsp;<span class="op" id="8212697">=</span>&nbsp;<span class="ident" id="8212699">r</span><span class="op" id="8212700">.</span><span class="ident" id="8212701">Conn</span><span class="op" id="8212705">.</span><span class="ident" id="8212706">Write</span><span class="op" id="8212711">(</span><span class="ident" id="8212712">b</span><span class="op" id="8212713">)</span><span class="op" id="8212714">;</span>&nbsp;<span class="ident" id="8212716">n</span>&nbsp;<span class="op" id="8212718">==</span>&nbsp;<span class="num" id="8212721">0</span>&nbsp;<span class="op" id="8212723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8212727">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8212735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8212738">b</span>&nbsp;<span class="op" id="8212740">=</span>&nbsp;<span class="ident" id="8212742">b</span><span class="op" id="8212743">[</span><span class="op" id="8212744">:</span><span class="ident" id="8212745">n</span><span class="op" id="8212746">]</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8212750">r</span><span class="op" id="8212751">.</span><span class="ident" id="8212752">Lock</span><span class="op" id="8212756">(</span><span class="op" id="8212757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8212760">defer</span>&nbsp;<span class="ident" id="8212766">r</span><span class="op" id="8212767">.</span><span class="ident" id="8212768">Unlock</span><span class="op" id="8212774">(</span><span class="op" id="8212775">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8212779">if</span>&nbsp;<span class="ident" id="8212782">l</span>&nbsp;<span class="op" id="8212784">:=</span>&nbsp;<span class="builtinfunc" id="8212787">len</span><span class="op" id="8212790">(</span><span class="ident" id="8212791">r</span><span class="op" id="8212792">.</span><span class="ident" id="8212793">flows</span><span class="op" id="8212798">)</span><span class="op" id="8212799">;</span>&nbsp;<span class="ident" id="8212801">l</span>&nbsp;<span class="op" id="8212803">==</span>&nbsp;<span class="num" id="8212806">0</span>&nbsp;<span class="op" id="8212808">||</span>&nbsp;<span class="ident" id="8212811">r</span><span class="op" id="8212812">.</span><span class="ident" id="8212813">reading</span>&nbsp;<span class="op" id="8212821">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8212825">buf</span>&nbsp;<span class="op" id="8212829">:=</span>&nbsp;<span class="builtinfunc" id="8212832">make</span><span class="op" id="8212836">(</span><span class="op" id="8212837">[</span><span class="op" id="8212838">]</span><span class="builtintype" id="8212839">byte</span><span class="op" id="8212843">,</span>&nbsp;<span class="builtinfunc" id="8212845">len</span><span class="op" id="8212848">(</span><span class="ident" id="8212849">b</span><span class="op" id="8212850">)</span><span class="op" id="8212851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8212855">copy</span><span class="op" id="8212859">(</span><span class="ident" id="8212860">buf</span><span class="op" id="8212863">,</span>&nbsp;<span class="ident" id="8212865">b</span><span class="op" id="8212866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8212870">r</span><span class="op" id="8212871">.</span><span class="ident" id="8212872">flows</span>&nbsp;<span class="op" id="8212878">=</span>&nbsp;<span class="builtinfunc" id="8212880">append</span><span class="op" id="8212886">(</span><span class="ident" id="8212887">r</span><span class="op" id="8212888">.</span><span class="ident" id="8212889">flows</span><span class="op" id="8212894">,</span>&nbsp;<span class="ident" id="8212896">buf</span><span class="op" id="8212899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8212902">}</span>&nbsp;<span class="keyword" id="8212904">else</span>&nbsp;<span class="op" id="8212909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8212913">r</span><span class="op" id="8212914">.</span><span class="ident" id="8212915">flows</span><span class="op" id="8212920">[</span><span class="ident" id="8212921">l</span><span class="op" id="8212922">-</span><span class="num" id="8212923">1</span><span class="op" id="8212924">]</span>&nbsp;<span class="op" id="8212926">=</span>&nbsp;<span class="builtinfunc" id="8212928">append</span><span class="op" id="8212934">(</span><span class="ident" id="8212935">r</span><span class="op" id="8212936">.</span><span class="ident" id="8212937">flows</span><span class="op" id="8212942">[</span><span class="ident" id="8212943">l</span><span class="op" id="8212944">-</span><span class="num" id="8212945">1</span><span class="op" id="8212946">]</span><span class="op" id="8212947">,</span>&nbsp;<span class="ident" id="8212949">b</span><span class="op" id="8212950">[</span><span class="op" id="8212951">:</span><span class="ident" id="8212952">n</span><span class="op" id="8212953">]</span><span class="op" id="8212954">...</span><span class="op" id="8212957">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8212960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8212963">r</span><span class="op" id="8212964">.</span><span class="ident" id="8212965">reading</span>&nbsp;<span class="op" id="8212973">=</span>&nbsp;<span class="builtintype" id="8212975">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8212982">return</span><br>
<span class="lineno"></span><span class="op" id="8212989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="8212992">//&nbsp;WriteTo&nbsp;writes&nbsp;Go&nbsp;source&nbsp;code&nbsp;to&nbsp;w&nbsp;that&nbsp;contains&nbsp;the&nbsp;recorded&nbsp;traffic.</span><br>
<span class="lineno"></span><span class="keyword" id="8213066">func</span>&nbsp;<span class="op" id="8213071">(</span><span class="ident" id="8213072">r</span>&nbsp;<span class="op" id="8213074">*</span><span class="ident" id="8213075">recordingConn</span><span class="op" id="8213088">)</span>&nbsp;<span class="ident" id="8213090">WriteTo</span><span class="op" id="8213097">(</span><span class="ident" id="8213098">w</span>&nbsp;<span class="ident" id="8213100">io</span><span class="op" id="8213102">.</span><span class="ident" id="8213103">Writer</span><span class="op" id="8213109">)</span>&nbsp;<span class="op" id="8213111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8213114">//&nbsp;TLS&nbsp;always&nbsp;starts&nbsp;with&nbsp;a&nbsp;client&nbsp;to&nbsp;server&nbsp;flow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8213166">clientToServer</span>&nbsp;<span class="op" id="8213181">:=</span>&nbsp;<span class="builtintype" id="8213184">true</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8213191">for</span>&nbsp;<span class="ident" id="8213195">i</span><span class="op" id="8213196">,</span>&nbsp;<span class="ident" id="8213198">flow</span>&nbsp;<span class="op" id="8213203">:=</span>&nbsp;<span class="keyword" id="8213206">range</span>&nbsp;<span class="ident" id="8213212">r</span><span class="op" id="8213213">.</span><span class="ident" id="8213214">flows</span>&nbsp;<span class="op" id="8213220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8213224">source</span><span class="op" id="8213230">,</span>&nbsp;<span class="ident" id="8213232">dest</span>&nbsp;<span class="op" id="8213237">:=</span>&nbsp;<span class="string" id="8213240">&#34;client&#34;</span><span class="op" id="8213248">,</span>&nbsp;<span class="string" id="8213250">&#34;server&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8213261">if</span>&nbsp;<span class="op" id="8213264">!</span><span class="ident" id="8213265">clientToServer</span>&nbsp;<span class="op" id="8213280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8213285">source</span><span class="op" id="8213291">,</span>&nbsp;<span class="ident" id="8213293">dest</span>&nbsp;<span class="op" id="8213298">=</span>&nbsp;<span class="ident" id="8213300">dest</span><span class="op" id="8213304">,</span>&nbsp;<span class="ident" id="8213306">source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8213315">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8213319">fmt</span><span class="op" id="8213322">.</span><span class="ident" id="8213323">Fprintf</span><span class="op" id="8213330">(</span><span class="ident" id="8213331">w</span><span class="op" id="8213332">,</span>&nbsp;<span class="string" id="8213334">&#34;&gt;&gt;&gt;&nbsp;Flow&nbsp;%d&nbsp;(%s&nbsp;to&nbsp;%s)\n&#34;</span><span class="op" id="8213360">,</span>&nbsp;<span class="ident" id="8213362">i</span><span class="op" id="8213363">+</span><span class="num" id="8213364">1</span><span class="op" id="8213365">,</span>&nbsp;<span class="ident" id="8213367">source</span><span class="op" id="8213373">,</span>&nbsp;<span class="ident" id="8213375">dest</span><span class="op" id="8213379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8213383">dumper</span>&nbsp;<span class="op" id="8213390">:=</span>&nbsp;<span class="ident" id="8213393">hex</span><span class="op" id="8213396">.</span><span class="ident" id="8213397">Dumper</span><span class="op" id="8213403">(</span><span class="ident" id="8213404">w</span><span class="op" id="8213405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8213409">dumper</span><span class="op" id="8213415">.</span><span class="ident" id="8213416">Write</span><span class="op" id="8213421">(</span><span class="ident" id="8213422">flow</span><span class="op" id="8213426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8213430">dumper</span><span class="op" id="8213436">.</span><span class="ident" id="8213437">Close</span><span class="op" id="8213442">(</span><span class="op" id="8213443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8213447">clientToServer</span>&nbsp;<span class="op" id="8213462">=</span>&nbsp;<span class="op" id="8213464">!</span><span class="ident" id="8213465">clientToServer</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8213481">}</span><br>
<span class="lineno"></span><span class="op" id="8213483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8213486">func</span>&nbsp;<span class="ident" id="8213491">parseTestData</span><span class="op" id="8213504">(</span><span class="ident" id="8213505">r</span>&nbsp;<span class="ident" id="8213507">io</span><span class="op" id="8213509">.</span><span class="ident" id="8213510">Reader</span><span class="op" id="8213516">)</span>&nbsp;<span class="op" id="8213518">(</span><span class="ident" id="8213519">flows</span>&nbsp;<span class="op" id="8213525">[</span><span class="op" id="8213526">]</span><span class="op" id="8213527">[</span><span class="op" id="8213528">]</span><span class="builtintype" id="8213529">byte</span><span class="op" id="8213533">,</span>&nbsp;<span class="ident" id="8213535">err</span>&nbsp;<span class="builtintype" id="8213539">error</span><span class="op" id="8213544">)</span>&nbsp;<span class="op" id="8213546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8213549">var</span>&nbsp;<span class="ident" id="8213553">currentFlow</span>&nbsp;<span class="op" id="8213565">[</span><span class="op" id="8213566">]</span><span class="builtintype" id="8213567">byte</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8213574">scanner</span>&nbsp;<span class="op" id="8213582">:=</span>&nbsp;<span class="ident" id="8213585">bufio</span><span class="op" id="8213590">.</span><span class="ident" id="8213591">NewScanner</span><span class="op" id="8213601">(</span><span class="ident" id="8213602">r</span><span class="op" id="8213603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8213606">for</span>&nbsp;<span class="ident" id="8213610">scanner</span><span class="op" id="8213617">.</span><span class="ident" id="8213618">Scan</span><span class="op" id="8213622">(</span><span class="op" id="8213623">)</span>&nbsp;<span class="op" id="8213625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8213629">line</span>&nbsp;<span class="op" id="8213634">:=</span>&nbsp;<span class="ident" id="8213637">scanner</span><span class="op" id="8213644">.</span><span class="ident" id="8213645">Text</span><span class="op" id="8213649">(</span><span class="op" id="8213650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8213654">//&nbsp;If&nbsp;the&nbsp;line&nbsp;starts&nbsp;with&nbsp;&#34;&gt;&gt;&gt;&nbsp;&#34;&nbsp;then&nbsp;it&nbsp;marks&nbsp;the&nbsp;beginning</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8213718">//&nbsp;of&nbsp;a&nbsp;new&nbsp;flow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8213738">if</span>&nbsp;<span class="ident" id="8213741">strings</span><span class="op" id="8213748">.</span><span class="ident" id="8213749">HasPrefix</span><span class="op" id="8213758">(</span><span class="ident" id="8213759">line</span><span class="op" id="8213763">,</span>&nbsp;<span class="string" id="8213765">&#34;&gt;&gt;&gt;&nbsp;&#34;</span><span class="op" id="8213771">)</span>&nbsp;<span class="op" id="8213773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8213778">if</span>&nbsp;<span class="builtinfunc" id="8213781">len</span><span class="op" id="8213784">(</span><span class="ident" id="8213785">currentFlow</span><span class="op" id="8213796">)</span>&nbsp;<span class="op" id="8213798">&gt;</span>&nbsp;<span class="num" id="8213800">0</span>&nbsp;<span class="op" id="8213802">||</span>&nbsp;<span class="builtinfunc" id="8213805">len</span><span class="op" id="8213808">(</span><span class="ident" id="8213809">flows</span><span class="op" id="8213814">)</span>&nbsp;<span class="op" id="8213816">&gt;</span>&nbsp;<span class="num" id="8213818">0</span>&nbsp;<span class="op" id="8213820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8213826">flows</span>&nbsp;<span class="op" id="8213832">=</span>&nbsp;<span class="builtinfunc" id="8213834">append</span><span class="op" id="8213840">(</span><span class="ident" id="8213841">flows</span><span class="op" id="8213846">,</span>&nbsp;<span class="ident" id="8213848">currentFlow</span><span class="op" id="8213859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8213865">currentFlow</span>&nbsp;<span class="op" id="8213877">=</span>&nbsp;<span class="ident" id="8213879">nil</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8213886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8213891">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8213902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8213907">//&nbsp;Otherwise&nbsp;the&nbsp;line&nbsp;is&nbsp;a&nbsp;line&nbsp;of&nbsp;hex&nbsp;dump&nbsp;that&nbsp;looks&nbsp;like:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8213970">//&nbsp;00000170&nbsp;&nbsp;fc&nbsp;f5&nbsp;06&nbsp;bf&nbsp;(...)&nbsp;&nbsp;|.....X{&amp;?......!|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8214023">//&nbsp;(Some&nbsp;bytes&nbsp;have&nbsp;been&nbsp;omitted&nbsp;from&nbsp;the&nbsp;middle&nbsp;section.)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8214085">if</span>&nbsp;<span class="ident" id="8214088">i</span>&nbsp;<span class="op" id="8214090">:=</span>&nbsp;<span class="ident" id="8214093">strings</span><span class="op" id="8214100">.</span><span class="ident" id="8214101">IndexByte</span><span class="op" id="8214110">(</span><span class="ident" id="8214111">line</span><span class="op" id="8214115">,</span>&nbsp;<span class="string" id="8214117">&#39;&nbsp;&#39;</span><span class="op" id="8214120">)</span><span class="op" id="8214121">;</span>&nbsp;<span class="ident" id="8214123">i</span>&nbsp;<span class="op" id="8214125">&gt;=</span>&nbsp;<span class="num" id="8214128">0</span>&nbsp;<span class="op" id="8214130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8214135">line</span>&nbsp;<span class="op" id="8214140">=</span>&nbsp;<span class="ident" id="8214142">line</span><span class="op" id="8214146">[</span><span class="ident" id="8214147">i</span><span class="op" id="8214148">:</span><span class="op" id="8214149">]</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8214153">}</span>&nbsp;<span class="keyword" id="8214155">else</span>&nbsp;<span class="op" id="8214160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8214165">return</span>&nbsp;<span class="ident" id="8214172">nil</span><span class="op" id="8214175">,</span>&nbsp;<span class="ident" id="8214177">errors</span><span class="op" id="8214183">.</span><span class="ident" id="8214184">New</span><span class="op" id="8214187">(</span><span class="string" id="8214188">&#34;invalid&nbsp;test&nbsp;data&#34;</span><span class="op" id="8214207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8214211">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8214216">if</span>&nbsp;<span class="ident" id="8214219">i</span>&nbsp;<span class="op" id="8214221">:=</span>&nbsp;<span class="ident" id="8214224">strings</span><span class="op" id="8214231">.</span><span class="ident" id="8214232">IndexByte</span><span class="op" id="8214241">(</span><span class="ident" id="8214242">line</span><span class="op" id="8214246">,</span>&nbsp;<span class="string" id="8214248">&#39;|&#39;</span><span class="op" id="8214251">)</span><span class="op" id="8214252">;</span>&nbsp;<span class="ident" id="8214254">i</span>&nbsp;<span class="op" id="8214256">&gt;=</span>&nbsp;<span class="num" id="8214259">0</span>&nbsp;<span class="op" id="8214261">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8214266">line</span>&nbsp;<span class="op" id="8214271">=</span>&nbsp;<span class="ident" id="8214273">line</span><span class="op" id="8214277">[</span><span class="op" id="8214278">:</span><span class="ident" id="8214279">i</span><span class="op" id="8214280">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8214284">}</span>&nbsp;<span class="keyword" id="8214286">else</span>&nbsp;<span class="op" id="8214291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8214296">return</span>&nbsp;<span class="ident" id="8214303">nil</span><span class="op" id="8214306">,</span>&nbsp;<span class="ident" id="8214308">errors</span><span class="op" id="8214314">.</span><span class="ident" id="8214315">New</span><span class="op" id="8214318">(</span><span class="string" id="8214319">&#34;invalid&nbsp;test&nbsp;data&#34;</span><span class="op" id="8214338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8214342">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8214347">hexBytes</span>&nbsp;<span class="op" id="8214356">:=</span>&nbsp;<span class="ident" id="8214359">strings</span><span class="op" id="8214366">.</span><span class="ident" id="8214367">Fields</span><span class="op" id="8214373">(</span><span class="ident" id="8214374">line</span><span class="op" id="8214378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8214382">for</span>&nbsp;<span class="ident" id="8214386">_</span><span class="op" id="8214387">,</span>&nbsp;<span class="ident" id="8214389">hexByte</span>&nbsp;<span class="op" id="8214397">:=</span>&nbsp;<span class="keyword" id="8214400">range</span>&nbsp;<span class="ident" id="8214406">hexBytes</span>&nbsp;<span class="op" id="8214415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8214420">val</span><span class="op" id="8214423">,</span>&nbsp;<span class="ident" id="8214425">err</span>&nbsp;<span class="op" id="8214429">:=</span>&nbsp;<span class="ident" id="8214432">strconv</span><span class="op" id="8214439">.</span><span class="ident" id="8214440">ParseUint</span><span class="op" id="8214449">(</span><span class="ident" id="8214450">hexByte</span><span class="op" id="8214457">,</span>&nbsp;<span class="num" id="8214459">16</span><span class="op" id="8214461">,</span>&nbsp;<span class="num" id="8214463">8</span><span class="op" id="8214464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8214469">if</span>&nbsp;<span class="ident" id="8214472">err</span>&nbsp;<span class="op" id="8214476">!=</span>&nbsp;<span class="ident" id="8214479">nil</span>&nbsp;<span class="op" id="8214483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8214489">return</span>&nbsp;<span class="ident" id="8214496">nil</span><span class="op" id="8214499">,</span>&nbsp;<span class="ident" id="8214501">errors</span><span class="op" id="8214507">.</span><span class="ident" id="8214508">New</span><span class="op" id="8214511">(</span><span class="string" id="8214512">&#34;invalid&nbsp;hex&nbsp;byte&nbsp;in&nbsp;test&nbsp;data:&nbsp;&#34;</span>&nbsp;<span class="op" id="8214546">+</span>&nbsp;<span class="ident" id="8214548">err</span><span class="op" id="8214551">.</span><span class="ident" id="8214552">Error</span><span class="op" id="8214557">(</span><span class="op" id="8214558">)</span><span class="op" id="8214559">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8214564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8214569">currentFlow</span>&nbsp;<span class="op" id="8214581">=</span>&nbsp;<span class="builtinfunc" id="8214583">append</span><span class="op" id="8214589">(</span><span class="ident" id="8214590">currentFlow</span><span class="op" id="8214601">,</span>&nbsp;<span class="builtintype" id="8214603">byte</span><span class="op" id="8214607">(</span><span class="ident" id="8214608">val</span><span class="op" id="8214611">)</span><span class="op" id="8214612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8214616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8214619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8214623">if</span>&nbsp;<span class="builtinfunc" id="8214626">len</span><span class="op" id="8214629">(</span><span class="ident" id="8214630">currentFlow</span><span class="op" id="8214641">)</span>&nbsp;<span class="op" id="8214643">&gt;</span>&nbsp;<span class="num" id="8214645">0</span>&nbsp;<span class="op" id="8214647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8214651">flows</span>&nbsp;<span class="op" id="8214657">=</span>&nbsp;<span class="builtinfunc" id="8214659">append</span><span class="op" id="8214665">(</span><span class="ident" id="8214666">flows</span><span class="op" id="8214671">,</span>&nbsp;<span class="ident" id="8214673">currentFlow</span><span class="op" id="8214684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8214687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8214691">return</span>&nbsp;<span class="ident" id="8214698">flows</span><span class="op" id="8214703">,</span>&nbsp;<span class="ident" id="8214705">nil</span><br>
<span class="lineno">155</span><span class="op" id="8214709">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8214712">//&nbsp;tempFile&nbsp;creates&nbsp;a&nbsp;temp&nbsp;file&nbsp;containing&nbsp;contents&nbsp;and&nbsp;returns&nbsp;its&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="8214786">func</span>&nbsp;<span class="ident" id="8214791">tempFile</span><span class="op" id="8214799">(</span><span class="ident" id="8214800">contents</span>&nbsp;<span class="builtintype" id="8214809">string</span><span class="op" id="8214815">)</span>&nbsp;<span class="builtintype" id="8214817">string</span>&nbsp;<span class="op" id="8214824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8214827">file</span><span class="op" id="8214831">,</span>&nbsp;<span class="ident" id="8214833">err</span>&nbsp;<span class="op" id="8214837">:=</span>&nbsp;<span class="ident" id="8214840">ioutil</span><span class="op" id="8214846">.</span><span class="ident" id="8214847">TempFile</span><span class="op" id="8214855">(</span><span class="string" id="8214856">&#34;&#34;</span><span class="op" id="8214858">,</span>&nbsp;<span class="string" id="8214860">&#34;go-tls-test&#34;</span><span class="op" id="8214873">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8214876">if</span>&nbsp;<span class="ident" id="8214879">err</span>&nbsp;<span class="op" id="8214883">!=</span>&nbsp;<span class="ident" id="8214886">nil</span>&nbsp;<span class="op" id="8214890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8214894">panic</span><span class="op" id="8214899">(</span><span class="string" id="8214900">&#34;failed&nbsp;to&nbsp;create&nbsp;temp&nbsp;file:&nbsp;&#34;</span>&nbsp;<span class="op" id="8214931">+</span>&nbsp;<span class="ident" id="8214933">err</span><span class="op" id="8214936">.</span><span class="ident" id="8214937">Error</span><span class="op" id="8214942">(</span><span class="op" id="8214943">)</span><span class="op" id="8214944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8214947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8214950">path</span>&nbsp;<span class="op" id="8214955">:=</span>&nbsp;<span class="ident" id="8214958">file</span><span class="op" id="8214962">.</span><span class="ident" id="8214963">Name</span><span class="op" id="8214967">(</span><span class="op" id="8214968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8214971">file</span><span class="op" id="8214975">.</span><span class="ident" id="8214976">WriteString</span><span class="op" id="8214987">(</span><span class="ident" id="8214988">contents</span><span class="op" id="8214996">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8214999">file</span><span class="op" id="8215003">.</span><span class="ident" id="8215004">Close</span><span class="op" id="8215009">(</span><span class="op" id="8215010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8215013">return</span>&nbsp;<span class="ident" id="8215020">path</span><br>
<span class="lineno"></span><span class="op" id="8215025">}</span>
</div>
</body>
</html>
