<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os/signal</h2>
<ul>
<li><a href="/gostd/os/signal/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/os/signal/signal.go.html" class="current">signal.go</a></li>
<li><a href="/gostd/os/signal/signal_test.go.html">signal_test.go</a></li>
<li><a href="/gostd/os/signal/signal_unix.go.html">signal_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4875250">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4875305">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4875359">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4875410">//&nbsp;Package&nbsp;signal&nbsp;implements&nbsp;access&nbsp;to&nbsp;incoming&nbsp;signals.</span><br>
<span class="lineno"></span><span class="keyword" id="4875467">package</span>&nbsp;<span class="ident" id="4875475">signal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4875483">//&nbsp;BUG(rsc):&nbsp;This&nbsp;package&nbsp;is&nbsp;not&nbsp;yet&nbsp;implemented&nbsp;on&nbsp;Plan&nbsp;9.</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="4875544">import</span>&nbsp;<span class="op" id="4875551">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4875554">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4875560">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="4875567">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="4875570">var</span>&nbsp;<span class="ident" id="4875574">handlers</span>&nbsp;<span class="keyword" id="4875583">struct</span>&nbsp;<span class="op" id="4875590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4875593">sync</span><span class="op" id="4875597">.</span><span class="ident" id="4875598">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4875605">m</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="4875609">map</span><span class="op" id="4875612">[</span><span class="keyword" id="4875613">chan</span><span class="op" id="4875617">&lt;-</span>&nbsp;<span class="ident" id="4875620">os</span><span class="op" id="4875622">.</span><span class="ident" id="4875623">Signal</span><span class="op" id="4875629">]</span><span class="op" id="4875630">*</span><span class="ident" id="4875631">handler</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4875640">ref</span>&nbsp;<span class="op" id="4875644">[</span><span class="ident" id="4875645">numSig</span><span class="op" id="4875651">]</span><span class="ident" id="4875652">int64</span><br>
<span class="lineno"></span><span class="op" id="4875658">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="4875661">type</span>&nbsp;<span class="ident" id="4875666">handler</span>&nbsp;<span class="keyword" id="4875674">struct</span>&nbsp;<span class="op" id="4875681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4875684">mask</span>&nbsp;<span class="op" id="4875689">[</span><span class="op" id="4875690">(</span><span class="ident" id="4875691">numSig</span>&nbsp;<span class="op" id="4875698">+</span>&nbsp;<span class="num" id="4875700">31</span><span class="op" id="4875702">)</span>&nbsp;<span class="op" id="4875704">/</span>&nbsp;<span class="num" id="4875706">32</span><span class="op" id="4875708">]</span><span class="builtintype" id="4875709">uint32</span><br>
<span class="lineno"></span><span class="op" id="4875716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="4875719">func</span>&nbsp;<span class="op" id="4875724">(</span><span class="ident" id="4875725">h</span>&nbsp;<span class="op" id="4875727">*</span><span class="ident" id="4875728">handler</span><span class="op" id="4875735">)</span>&nbsp;<span class="ident" id="4875737">want</span><span class="op" id="4875741">(</span><span class="ident" id="4875742">sig</span>&nbsp;<span class="builtintype" id="4875746">int</span><span class="op" id="4875749">)</span>&nbsp;<span class="builtintype" id="4875751">bool</span>&nbsp;<span class="op" id="4875756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4875759">return</span>&nbsp;<span class="op" id="4875766">(</span><span class="ident" id="4875767">h</span><span class="op" id="4875768">.</span><span class="ident" id="4875769">mask</span><span class="op" id="4875773">[</span><span class="ident" id="4875774">sig</span><span class="op" id="4875777">/</span><span class="num" id="4875778">32</span><span class="op" id="4875780">]</span><span class="op" id="4875781">&gt;&gt;</span><span class="builtintype" id="4875783">uint</span><span class="op" id="4875787">(</span><span class="ident" id="4875788">sig</span><span class="op" id="4875791">&amp;</span><span class="num" id="4875792">31</span><span class="op" id="4875794">)</span><span class="op" id="4875795">)</span><span class="op" id="4875796">&amp;</span><span class="num" id="4875797">1</span>&nbsp;<span class="op" id="4875799">!=</span>&nbsp;<span class="num" id="4875802">0</span><br>
<span class="lineno"></span><span class="op" id="4875804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4875807">func</span>&nbsp;<span class="op" id="4875812">(</span><span class="ident" id="4875813">h</span>&nbsp;<span class="op" id="4875815">*</span><span class="ident" id="4875816">handler</span><span class="op" id="4875823">)</span>&nbsp;<span class="ident" id="4875825">set</span><span class="op" id="4875828">(</span><span class="ident" id="4875829">sig</span>&nbsp;<span class="builtintype" id="4875833">int</span><span class="op" id="4875836">)</span>&nbsp;<span class="op" id="4875838">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4875841">h</span><span class="op" id="4875842">.</span><span class="ident" id="4875843">mask</span><span class="op" id="4875847">[</span><span class="ident" id="4875848">sig</span><span class="op" id="4875851">/</span><span class="num" id="4875852">32</span><span class="op" id="4875854">]</span>&nbsp;<span class="op" id="4875856">|=</span>&nbsp;<span class="num" id="4875859">1</span>&nbsp;<span class="op" id="4875861">&lt;&lt;</span>&nbsp;<span class="builtintype" id="4875864">uint</span><span class="op" id="4875868">(</span><span class="ident" id="4875869">sig</span><span class="op" id="4875872">&amp;</span><span class="num" id="4875873">31</span><span class="op" id="4875875">)</span><br>
<span class="lineno"></span><span class="op" id="4875877">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4875880">//&nbsp;Notify&nbsp;causes&nbsp;package&nbsp;signal&nbsp;to&nbsp;relay&nbsp;incoming&nbsp;signals&nbsp;to&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="4875944">//&nbsp;If&nbsp;no&nbsp;signals&nbsp;are&nbsp;listed,&nbsp;all&nbsp;incoming&nbsp;signals&nbsp;will&nbsp;be&nbsp;relayed&nbsp;to&nbsp;c.</span><br>
<span class="lineno">35</span><span class="comment" id="4876016">//&nbsp;Otherwise,&nbsp;just&nbsp;the&nbsp;listed&nbsp;signals&nbsp;will.</span><br>
<span class="lineno"></span><span class="comment" id="4876060">//</span><br>
<span class="lineno"></span><span class="comment" id="4876063">//&nbsp;Package&nbsp;signal&nbsp;will&nbsp;not&nbsp;block&nbsp;sending&nbsp;to&nbsp;c:&nbsp;the&nbsp;caller&nbsp;must&nbsp;ensure</span><br>
<span class="lineno"></span><span class="comment" id="4876133">//&nbsp;that&nbsp;c&nbsp;has&nbsp;sufficient&nbsp;buffer&nbsp;space&nbsp;to&nbsp;keep&nbsp;up&nbsp;with&nbsp;the&nbsp;expected</span><br>
<span class="lineno"></span><span class="comment" id="4876200">//&nbsp;signal&nbsp;rate.&nbsp;&nbsp;For&nbsp;a&nbsp;channel&nbsp;used&nbsp;for&nbsp;notification&nbsp;of&nbsp;just&nbsp;one&nbsp;signal&nbsp;value,</span><br>
<span class="lineno">40</span><span class="comment" id="4876279">//&nbsp;a&nbsp;buffer&nbsp;of&nbsp;size&nbsp;1&nbsp;is&nbsp;sufficient.</span><br>
<span class="lineno"></span><span class="comment" id="4876316">//</span><br>
<span class="lineno"></span><span class="comment" id="4876319">//&nbsp;It&nbsp;is&nbsp;allowed&nbsp;to&nbsp;call&nbsp;Notify&nbsp;multiple&nbsp;times&nbsp;with&nbsp;the&nbsp;same&nbsp;channel:</span><br>
<span class="lineno"></span><span class="comment" id="4876389">//&nbsp;each&nbsp;call&nbsp;expands&nbsp;the&nbsp;set&nbsp;of&nbsp;signals&nbsp;sent&nbsp;to&nbsp;that&nbsp;channel.</span><br>
<span class="lineno"></span><span class="comment" id="4876451">//&nbsp;The&nbsp;only&nbsp;way&nbsp;to&nbsp;remove&nbsp;signals&nbsp;from&nbsp;the&nbsp;set&nbsp;is&nbsp;to&nbsp;call&nbsp;Stop.</span><br>
<span class="lineno">45</span><span class="comment" id="4876515">//</span><br>
<span class="lineno"></span><span class="comment" id="4876518">//&nbsp;It&nbsp;is&nbsp;allowed&nbsp;to&nbsp;call&nbsp;Notify&nbsp;multiple&nbsp;times&nbsp;with&nbsp;different&nbsp;channels</span><br>
<span class="lineno"></span><span class="comment" id="4876589">//&nbsp;and&nbsp;the&nbsp;same&nbsp;signals:&nbsp;each&nbsp;channel&nbsp;receives&nbsp;copies&nbsp;of&nbsp;incoming</span><br>
<span class="lineno"></span><span class="comment" id="4876655">//&nbsp;signals&nbsp;independently.</span><br>
<span class="lineno"></span><span class="keyword" id="4876681">func</span>&nbsp;<span class="ident" id="4876686">Notify</span><span class="op" id="4876692">(</span><span class="ident" id="4876693">c</span>&nbsp;<span class="keyword" id="4876695">chan</span><span class="op" id="4876699">&lt;-</span>&nbsp;<span class="ident" id="4876702">os</span><span class="op" id="4876704">.</span><span class="ident" id="4876705">Signal</span><span class="op" id="4876711">,</span>&nbsp;<span class="ident" id="4876713">sig</span>&nbsp;<span class="op" id="4876717">...</span><span class="ident" id="4876720">os</span><span class="op" id="4876722">.</span><span class="ident" id="4876723">Signal</span><span class="op" id="4876729">)</span>&nbsp;<span class="op" id="4876731">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4876734">if</span>&nbsp;<span class="ident" id="4876737">c</span>&nbsp;<span class="op" id="4876739">==</span>&nbsp;<span class="builtintype" id="4876742">nil</span>&nbsp;<span class="op" id="4876746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4876750">panic</span><span class="op" id="4876755">(</span><span class="string" id="4876756">&#34;os/signal:&nbsp;Notify&nbsp;using&nbsp;nil&nbsp;channel&#34;</span><span class="op" id="4876793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4876796">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4876800">handlers</span><span class="op" id="4876808">.</span><span class="ident" id="4876809">Lock</span><span class="op" id="4876813">(</span><span class="op" id="4876814">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4876817">defer</span>&nbsp;<span class="ident" id="4876823">handlers</span><span class="op" id="4876831">.</span><span class="ident" id="4876832">Unlock</span><span class="op" id="4876838">(</span><span class="op" id="4876839">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4876843">h</span>&nbsp;<span class="op" id="4876845">:=</span>&nbsp;<span class="ident" id="4876848">handlers</span><span class="op" id="4876856">.</span><span class="ident" id="4876857">m</span><span class="op" id="4876858">[</span><span class="ident" id="4876859">c</span><span class="op" id="4876860">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4876863">if</span>&nbsp;<span class="ident" id="4876866">h</span>&nbsp;<span class="op" id="4876868">==</span>&nbsp;<span class="builtintype" id="4876871">nil</span>&nbsp;<span class="op" id="4876875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4876879">if</span>&nbsp;<span class="ident" id="4876882">handlers</span><span class="op" id="4876890">.</span><span class="ident" id="4876891">m</span>&nbsp;<span class="op" id="4876893">==</span>&nbsp;<span class="builtintype" id="4876896">nil</span>&nbsp;<span class="op" id="4876900">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4876905">handlers</span><span class="op" id="4876913">.</span><span class="ident" id="4876914">m</span>&nbsp;<span class="op" id="4876916">=</span>&nbsp;<span class="builtinfunc" id="4876918">make</span><span class="op" id="4876922">(</span><span class="keyword" id="4876923">map</span><span class="op" id="4876926">[</span><span class="keyword" id="4876927">chan</span><span class="op" id="4876931">&lt;-</span>&nbsp;<span class="ident" id="4876934">os</span><span class="op" id="4876936">.</span><span class="ident" id="4876937">Signal</span><span class="op" id="4876943">]</span><span class="op" id="4876944">*</span><span class="ident" id="4876945">handler</span><span class="op" id="4876952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4876956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4876960">h</span>&nbsp;<span class="op" id="4876962">=</span>&nbsp;<span class="builtinfunc" id="4876964">new</span><span class="op" id="4876967">(</span><span class="ident" id="4876968">handler</span><span class="op" id="4876975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4876979">handlers</span><span class="op" id="4876987">.</span><span class="ident" id="4876988">m</span><span class="op" id="4876989">[</span><span class="ident" id="4876990">c</span><span class="op" id="4876991">]</span>&nbsp;<span class="op" id="4876993">=</span>&nbsp;<span class="ident" id="4876995">h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4876998">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4877002">add</span>&nbsp;<span class="op" id="4877006">:=</span>&nbsp;<span class="keyword" id="4877009">func</span><span class="op" id="4877013">(</span><span class="ident" id="4877014">n</span>&nbsp;<span class="builtintype" id="4877016">int</span><span class="op" id="4877019">)</span>&nbsp;<span class="op" id="4877021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4877025">if</span>&nbsp;<span class="ident" id="4877028">n</span>&nbsp;<span class="op" id="4877030">&lt;</span>&nbsp;<span class="num" id="4877032">0</span>&nbsp;<span class="op" id="4877034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4877039">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4877048">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4877052">if</span>&nbsp;<span class="op" id="4877055">!</span><span class="ident" id="4877056">h</span><span class="op" id="4877057">.</span><span class="ident" id="4877058">want</span><span class="op" id="4877062">(</span><span class="ident" id="4877063">n</span><span class="op" id="4877064">)</span>&nbsp;<span class="op" id="4877066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4877071">h</span><span class="op" id="4877072">.</span><span class="ident" id="4877073">set</span><span class="op" id="4877076">(</span><span class="ident" id="4877077">n</span><span class="op" id="4877078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4877083">if</span>&nbsp;<span class="ident" id="4877086">handlers</span><span class="op" id="4877094">.</span><span class="ident" id="4877095">ref</span><span class="op" id="4877098">[</span><span class="ident" id="4877099">n</span><span class="op" id="4877100">]</span>&nbsp;<span class="op" id="4877102">==</span>&nbsp;<span class="num" id="4877105">0</span>&nbsp;<span class="op" id="4877107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4877113">enableSignal</span><span class="op" id="4877125">(</span><span class="ident" id="4877126">n</span><span class="op" id="4877127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4877132">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4877137">handlers</span><span class="op" id="4877145">.</span><span class="ident" id="4877146">ref</span><span class="op" id="4877149">[</span><span class="ident" id="4877150">n</span><span class="op" id="4877151">]</span><span class="op" id="4877152">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4877157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4877160">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4877164">if</span>&nbsp;<span class="builtinfunc" id="4877167">len</span><span class="op" id="4877170">(</span><span class="ident" id="4877171">sig</span><span class="op" id="4877174">)</span>&nbsp;<span class="op" id="4877176">==</span>&nbsp;<span class="num" id="4877179">0</span>&nbsp;<span class="op" id="4877181">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4877185">for</span>&nbsp;<span class="ident" id="4877189">n</span>&nbsp;<span class="op" id="4877191">:=</span>&nbsp;<span class="num" id="4877194">0</span><span class="op" id="4877195">;</span>&nbsp;<span class="ident" id="4877197">n</span>&nbsp;<span class="op" id="4877199">&lt;</span>&nbsp;<span class="ident" id="4877201">numSig</span><span class="op" id="4877207">;</span>&nbsp;<span class="ident" id="4877209">n</span><span class="op" id="4877210">++</span>&nbsp;<span class="op" id="4877213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4877218">add</span><span class="op" id="4877221">(</span><span class="ident" id="4877222">n</span><span class="op" id="4877223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4877227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4877230">}</span>&nbsp;<span class="keyword" id="4877232">else</span>&nbsp;<span class="op" id="4877237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4877241">for</span>&nbsp;<span class="ident" id="4877245">_</span><span class="op" id="4877246">,</span>&nbsp;<span class="ident" id="4877248">s</span>&nbsp;<span class="op" id="4877250">:=</span>&nbsp;<span class="keyword" id="4877253">range</span>&nbsp;<span class="ident" id="4877259">sig</span>&nbsp;<span class="op" id="4877263">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4877268">add</span><span class="op" id="4877271">(</span><span class="ident" id="4877272">signum</span><span class="op" id="4877278">(</span><span class="ident" id="4877279">s</span><span class="op" id="4877280">)</span><span class="op" id="4877281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4877285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4877288">}</span><br>
<span class="lineno"></span><span class="op" id="4877290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="4877293">//&nbsp;Stop&nbsp;causes&nbsp;package&nbsp;signal&nbsp;to&nbsp;stop&nbsp;relaying&nbsp;incoming&nbsp;signals&nbsp;to&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="4877363">//&nbsp;It&nbsp;undoes&nbsp;the&nbsp;effect&nbsp;of&nbsp;all&nbsp;prior&nbsp;calls&nbsp;to&nbsp;Notify&nbsp;using&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="4877425">//&nbsp;When&nbsp;Stop&nbsp;returns,&nbsp;it&nbsp;is&nbsp;guaranteed&nbsp;that&nbsp;c&nbsp;will&nbsp;receive&nbsp;no&nbsp;more&nbsp;signals.</span><br>
<span class="lineno"></span><span class="keyword" id="4877501">func</span>&nbsp;<span class="ident" id="4877506">Stop</span><span class="op" id="4877510">(</span><span class="ident" id="4877511">c</span>&nbsp;<span class="keyword" id="4877513">chan</span><span class="op" id="4877517">&lt;-</span>&nbsp;<span class="ident" id="4877520">os</span><span class="op" id="4877522">.</span><span class="ident" id="4877523">Signal</span><span class="op" id="4877529">)</span>&nbsp;<span class="op" id="4877531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4877534">handlers</span><span class="op" id="4877542">.</span><span class="ident" id="4877543">Lock</span><span class="op" id="4877547">(</span><span class="op" id="4877548">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4877551">defer</span>&nbsp;<span class="ident" id="4877557">handlers</span><span class="op" id="4877565">.</span><span class="ident" id="4877566">Unlock</span><span class="op" id="4877572">(</span><span class="op" id="4877573">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4877577">h</span>&nbsp;<span class="op" id="4877579">:=</span>&nbsp;<span class="ident" id="4877582">handlers</span><span class="op" id="4877590">.</span><span class="ident" id="4877591">m</span><span class="op" id="4877592">[</span><span class="ident" id="4877593">c</span><span class="op" id="4877594">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4877597">if</span>&nbsp;<span class="ident" id="4877600">h</span>&nbsp;<span class="op" id="4877602">==</span>&nbsp;<span class="builtintype" id="4877605">nil</span>&nbsp;<span class="op" id="4877609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4877613">return</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4877621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4877624">delete</span><span class="op" id="4877630">(</span><span class="ident" id="4877631">handlers</span><span class="op" id="4877639">.</span><span class="ident" id="4877640">m</span><span class="op" id="4877641">,</span>&nbsp;<span class="ident" id="4877643">c</span><span class="op" id="4877644">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4877648">for</span>&nbsp;<span class="ident" id="4877652">n</span>&nbsp;<span class="op" id="4877654">:=</span>&nbsp;<span class="num" id="4877657">0</span><span class="op" id="4877658">;</span>&nbsp;<span class="ident" id="4877660">n</span>&nbsp;<span class="op" id="4877662">&lt;</span>&nbsp;<span class="ident" id="4877664">numSig</span><span class="op" id="4877670">;</span>&nbsp;<span class="ident" id="4877672">n</span><span class="op" id="4877673">++</span>&nbsp;<span class="op" id="4877676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4877680">if</span>&nbsp;<span class="ident" id="4877683">h</span><span class="op" id="4877684">.</span><span class="ident" id="4877685">want</span><span class="op" id="4877689">(</span><span class="ident" id="4877690">n</span><span class="op" id="4877691">)</span>&nbsp;<span class="op" id="4877693">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4877698">handlers</span><span class="op" id="4877706">.</span><span class="ident" id="4877707">ref</span><span class="op" id="4877710">[</span><span class="ident" id="4877711">n</span><span class="op" id="4877712">]</span><span class="op" id="4877713">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4877719">if</span>&nbsp;<span class="ident" id="4877722">handlers</span><span class="op" id="4877730">.</span><span class="ident" id="4877731">ref</span><span class="op" id="4877734">[</span><span class="ident" id="4877735">n</span><span class="op" id="4877736">]</span>&nbsp;<span class="op" id="4877738">==</span>&nbsp;<span class="num" id="4877741">0</span>&nbsp;<span class="op" id="4877743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4877749">disableSignal</span><span class="op" id="4877762">(</span><span class="ident" id="4877763">n</span><span class="op" id="4877764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4877769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4877773">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4877776">}</span><br>
<span class="lineno"></span><span class="op" id="4877778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4877781">func</span>&nbsp;<span class="ident" id="4877786">process</span><span class="op" id="4877793">(</span><span class="ident" id="4877794">sig</span>&nbsp;<span class="ident" id="4877798">os</span><span class="op" id="4877800">.</span><span class="ident" id="4877801">Signal</span><span class="op" id="4877807">)</span>&nbsp;<span class="op" id="4877809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4877812">n</span>&nbsp;<span class="op" id="4877814">:=</span>&nbsp;<span class="ident" id="4877817">signum</span><span class="op" id="4877823">(</span><span class="ident" id="4877824">sig</span><span class="op" id="4877827">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4877830">if</span>&nbsp;<span class="ident" id="4877833">n</span>&nbsp;<span class="op" id="4877835">&lt;</span>&nbsp;<span class="num" id="4877837">0</span>&nbsp;<span class="op" id="4877839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4877843">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4877851">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4877855">handlers</span><span class="op" id="4877863">.</span><span class="ident" id="4877864">Lock</span><span class="op" id="4877868">(</span><span class="op" id="4877869">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4877872">defer</span>&nbsp;<span class="ident" id="4877878">handlers</span><span class="op" id="4877886">.</span><span class="ident" id="4877887">Unlock</span><span class="op" id="4877893">(</span><span class="op" id="4877894">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4877898">for</span>&nbsp;<span class="ident" id="4877902">c</span><span class="op" id="4877903">,</span>&nbsp;<span class="ident" id="4877905">h</span>&nbsp;<span class="op" id="4877907">:=</span>&nbsp;<span class="keyword" id="4877910">range</span>&nbsp;<span class="ident" id="4877916">handlers</span><span class="op" id="4877924">.</span><span class="ident" id="4877925">m</span>&nbsp;<span class="op" id="4877927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4877931">if</span>&nbsp;<span class="ident" id="4877934">h</span><span class="op" id="4877935">.</span><span class="ident" id="4877936">want</span><span class="op" id="4877940">(</span><span class="ident" id="4877941">n</span><span class="op" id="4877942">)</span>&nbsp;<span class="op" id="4877944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4877949">//&nbsp;send&nbsp;but&nbsp;do&nbsp;not&nbsp;block&nbsp;for&nbsp;it</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4877984">select</span>&nbsp;<span class="op" id="4877991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4877996">case</span>&nbsp;<span class="ident" id="4878001">c</span>&nbsp;<span class="op" id="4878003">&lt;-</span>&nbsp;<span class="ident" id="4878006">sig</span><span class="op" id="4878009">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4878014">default</span><span class="op" id="4878021">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4878026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4878030">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4878033">}</span><br>
<span class="lineno"></span><span class="op" id="4878035">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
