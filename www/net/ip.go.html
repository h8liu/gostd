<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3361246">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3361301">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3361355">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3361406">//&nbsp;IP&nbsp;address&nbsp;manipulations</span><br>
<span class="lineno"></span><span class="comment" id="3361434">//</span><br>
<span class="lineno"></span><span class="comment" id="3361437">//&nbsp;IPv4&nbsp;addresses&nbsp;are&nbsp;4&nbsp;bytes;&nbsp;IPv6&nbsp;addresses&nbsp;are&nbsp;16&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="3361497">//&nbsp;An&nbsp;IPv4&nbsp;address&nbsp;can&nbsp;be&nbsp;converted&nbsp;to&nbsp;an&nbsp;IPv6&nbsp;address&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="3361555">//&nbsp;adding&nbsp;a&nbsp;canonical&nbsp;prefix&nbsp;(10&nbsp;zeros,&nbsp;2&nbsp;0xFFs).</span><br>
<span class="lineno">10</span><span class="comment" id="3361605">//&nbsp;This&nbsp;library&nbsp;accepts&nbsp;either&nbsp;size&nbsp;of&nbsp;byte&nbsp;slice&nbsp;but&nbsp;always</span><br>
<span class="lineno"></span><span class="comment" id="3361666">//&nbsp;returns&nbsp;16-byte&nbsp;addresses.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3361697">package</span>&nbsp;<span class="ident" id="3361705">net</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="3361710">import</span>&nbsp;<span class="string" id="3361717">&#34;errors&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3361727">//&nbsp;IP&nbsp;address&nbsp;lengths&nbsp;(bytes).</span><br>
<span class="lineno"></span><span class="keyword" id="3361758">const</span>&nbsp;<span class="op" id="3361764">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3361767">IPv4len</span>&nbsp;<span class="op" id="3361775">=</span>&nbsp;<span class="num" id="3361777">4</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3361780">IPv6len</span>&nbsp;<span class="op" id="3361788">=</span>&nbsp;<span class="num" id="3361790">16</span><br>
<span class="lineno"></span><span class="op" id="3361793">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3361796">//&nbsp;An&nbsp;IP&nbsp;is&nbsp;a&nbsp;single&nbsp;IP&nbsp;address,&nbsp;a&nbsp;slice&nbsp;of&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="3361847">//&nbsp;Functions&nbsp;in&nbsp;this&nbsp;package&nbsp;accept&nbsp;either&nbsp;4-byte&nbsp;(IPv4)</span><br>
<span class="lineno">25</span><span class="comment" id="3361904">//&nbsp;or&nbsp;16-byte&nbsp;(IPv6)&nbsp;slices&nbsp;as&nbsp;input.</span><br>
<span class="lineno"></span><span class="comment" id="3361942">//</span><br>
<span class="lineno"></span><span class="comment" id="3361945">//&nbsp;Note&nbsp;that&nbsp;in&nbsp;this&nbsp;documentation,&nbsp;referring&nbsp;to&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="3361997">//&nbsp;IP&nbsp;address&nbsp;as&nbsp;an&nbsp;IPv4&nbsp;address&nbsp;or&nbsp;an&nbsp;IPv6&nbsp;address</span><br>
<span class="lineno"></span><span class="comment" id="3362049">//&nbsp;is&nbsp;a&nbsp;semantic&nbsp;property&nbsp;of&nbsp;the&nbsp;address,&nbsp;not&nbsp;just&nbsp;the</span><br>
<span class="lineno">30</span><span class="comment" id="3362104">//&nbsp;length&nbsp;of&nbsp;the&nbsp;byte&nbsp;slice:&nbsp;a&nbsp;16-byte&nbsp;slice&nbsp;can&nbsp;still</span><br>
<span class="lineno"></span><span class="comment" id="3362159">//&nbsp;be&nbsp;an&nbsp;IPv4&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="3362182">type</span>&nbsp;<span class="ident" id="3362187">IP</span>&nbsp;<span class="op" id="3362190">[</span><span class="op" id="3362191">]</span><span class="builtintype" id="3362192">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3362198">//&nbsp;An&nbsp;IP&nbsp;mask&nbsp;is&nbsp;an&nbsp;IP&nbsp;address.</span><br>
<span class="lineno">35</span><span class="keyword" id="3362230">type</span>&nbsp;<span class="ident" id="3362235">IPMask</span>&nbsp;<span class="op" id="3362242">[</span><span class="op" id="3362243">]</span><span class="builtintype" id="3362244">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3362250">//&nbsp;An&nbsp;IPNet&nbsp;represents&nbsp;an&nbsp;IP&nbsp;network.</span><br>
<span class="lineno"></span><span class="keyword" id="3362288">type</span>&nbsp;<span class="ident" id="3362293">IPNet</span>&nbsp;<span class="keyword" id="3362299">struct</span>&nbsp;<span class="op" id="3362306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3362309">IP</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3362314">IP</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3362321">//&nbsp;network&nbsp;number</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3362340">Mask</span>&nbsp;<span class="ident" id="3362345">IPMask</span>&nbsp;<span class="comment" id="3362352">//&nbsp;network&nbsp;mask</span><br>
<span class="lineno"></span><span class="op" id="3362368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3362371">//&nbsp;IPv4&nbsp;returns&nbsp;the&nbsp;IP&nbsp;address&nbsp;(in&nbsp;16-byte&nbsp;form)&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3362427">//&nbsp;IPv4&nbsp;address&nbsp;a.b.c.d.</span><br>
<span class="lineno">45</span><span class="keyword" id="3362452">func</span>&nbsp;<span class="ident" id="3362457">IPv4</span><span class="op" id="3362461">(</span><span class="ident" id="3362462">a</span><span class="op" id="3362463">,</span>&nbsp;<span class="ident" id="3362465">b</span><span class="op" id="3362466">,</span>&nbsp;<span class="ident" id="3362468">c</span><span class="op" id="3362469">,</span>&nbsp;<span class="ident" id="3362471">d</span>&nbsp;<span class="builtintype" id="3362473">byte</span><span class="op" id="3362477">)</span>&nbsp;<span class="ident" id="3362479">IP</span>&nbsp;<span class="op" id="3362482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3362485">p</span>&nbsp;<span class="op" id="3362487">:=</span>&nbsp;<span class="builtinfunc" id="3362490">make</span><span class="op" id="3362494">(</span><span class="ident" id="3362495">IP</span><span class="op" id="3362497">,</span>&nbsp;<span class="ident" id="3362499">IPv6len</span><span class="op" id="3362506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3362509">copy</span><span class="op" id="3362513">(</span><span class="ident" id="3362514">p</span><span class="op" id="3362515">,</span>&nbsp;<span class="ident" id="3362517">v4InV6Prefix</span><span class="op" id="3362529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3362532">p</span><span class="op" id="3362533">[</span><span class="num" id="3362534">12</span><span class="op" id="3362536">]</span>&nbsp;<span class="op" id="3362538">=</span>&nbsp;<span class="ident" id="3362540">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3362543">p</span><span class="op" id="3362544">[</span><span class="num" id="3362545">13</span><span class="op" id="3362547">]</span>&nbsp;<span class="op" id="3362549">=</span>&nbsp;<span class="ident" id="3362551">b</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3362554">p</span><span class="op" id="3362555">[</span><span class="num" id="3362556">14</span><span class="op" id="3362558">]</span>&nbsp;<span class="op" id="3362560">=</span>&nbsp;<span class="ident" id="3362562">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3362565">p</span><span class="op" id="3362566">[</span><span class="num" id="3362567">15</span><span class="op" id="3362569">]</span>&nbsp;<span class="op" id="3362571">=</span>&nbsp;<span class="ident" id="3362573">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3362576">return</span>&nbsp;<span class="ident" id="3362583">p</span><br>
<span class="lineno"></span><span class="op" id="3362585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="3362588">var</span>&nbsp;<span class="ident" id="3362592">v4InV6Prefix</span>&nbsp;<span class="op" id="3362605">=</span>&nbsp;<span class="op" id="3362607">[</span><span class="op" id="3362608">]</span><span class="builtintype" id="3362609">byte</span><span class="op" id="3362613">{</span><span class="num" id="3362614">0</span><span class="op" id="3362615">,</span>&nbsp;<span class="num" id="3362617">0</span><span class="op" id="3362618">,</span>&nbsp;<span class="num" id="3362620">0</span><span class="op" id="3362621">,</span>&nbsp;<span class="num" id="3362623">0</span><span class="op" id="3362624">,</span>&nbsp;<span class="num" id="3362626">0</span><span class="op" id="3362627">,</span>&nbsp;<span class="num" id="3362629">0</span><span class="op" id="3362630">,</span>&nbsp;<span class="num" id="3362632">0</span><span class="op" id="3362633">,</span>&nbsp;<span class="num" id="3362635">0</span><span class="op" id="3362636">,</span>&nbsp;<span class="num" id="3362638">0</span><span class="op" id="3362639">,</span>&nbsp;<span class="num" id="3362641">0</span><span class="op" id="3362642">,</span>&nbsp;<span class="num" id="3362644">0xff</span><span class="op" id="3362648">,</span>&nbsp;<span class="num" id="3362650">0xff</span><span class="op" id="3362654">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3362657">//&nbsp;IPv4Mask&nbsp;returns&nbsp;the&nbsp;IP&nbsp;mask&nbsp;(in&nbsp;4-byte&nbsp;form)&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3362713">//&nbsp;IPv4&nbsp;mask&nbsp;a.b.c.d.</span><br>
<span class="lineno"></span><span class="keyword" id="3362735">func</span>&nbsp;<span class="ident" id="3362740">IPv4Mask</span><span class="op" id="3362748">(</span><span class="ident" id="3362749">a</span><span class="op" id="3362750">,</span>&nbsp;<span class="ident" id="3362752">b</span><span class="op" id="3362753">,</span>&nbsp;<span class="ident" id="3362755">c</span><span class="op" id="3362756">,</span>&nbsp;<span class="ident" id="3362758">d</span>&nbsp;<span class="builtintype" id="3362760">byte</span><span class="op" id="3362764">)</span>&nbsp;<span class="ident" id="3362766">IPMask</span>&nbsp;<span class="op" id="3362773">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3362776">p</span>&nbsp;<span class="op" id="3362778">:=</span>&nbsp;<span class="builtinfunc" id="3362781">make</span><span class="op" id="3362785">(</span><span class="ident" id="3362786">IPMask</span><span class="op" id="3362792">,</span>&nbsp;<span class="ident" id="3362794">IPv4len</span><span class="op" id="3362801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3362804">p</span><span class="op" id="3362805">[</span><span class="num" id="3362806">0</span><span class="op" id="3362807">]</span>&nbsp;<span class="op" id="3362809">=</span>&nbsp;<span class="ident" id="3362811">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3362814">p</span><span class="op" id="3362815">[</span><span class="num" id="3362816">1</span><span class="op" id="3362817">]</span>&nbsp;<span class="op" id="3362819">=</span>&nbsp;<span class="ident" id="3362821">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3362824">p</span><span class="op" id="3362825">[</span><span class="num" id="3362826">2</span><span class="op" id="3362827">]</span>&nbsp;<span class="op" id="3362829">=</span>&nbsp;<span class="ident" id="3362831">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3362834">p</span><span class="op" id="3362835">[</span><span class="num" id="3362836">3</span><span class="op" id="3362837">]</span>&nbsp;<span class="op" id="3362839">=</span>&nbsp;<span class="ident" id="3362841">d</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3362844">return</span>&nbsp;<span class="ident" id="3362851">p</span><br>
<span class="lineno"></span><span class="op" id="3362853">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3362856">//&nbsp;CIDRMask&nbsp;returns&nbsp;an&nbsp;IPMask&nbsp;consisting&nbsp;of&nbsp;`ones&#39;&nbsp;1&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="3362914">//&nbsp;followed&nbsp;by&nbsp;0s&nbsp;up&nbsp;to&nbsp;a&nbsp;total&nbsp;length&nbsp;of&nbsp;`bits&#39;&nbsp;bits.</span><br>
<span class="lineno">70</span><span class="comment" id="3362969">//&nbsp;For&nbsp;a&nbsp;mask&nbsp;of&nbsp;this&nbsp;form,&nbsp;CIDRMask&nbsp;is&nbsp;the&nbsp;inverse&nbsp;of&nbsp;IPMask.Size.</span><br>
<span class="lineno"></span><span class="keyword" id="3363037">func</span>&nbsp;<span class="ident" id="3363042">CIDRMask</span><span class="op" id="3363050">(</span><span class="ident" id="3363051">ones</span><span class="op" id="3363055">,</span>&nbsp;<span class="ident" id="3363057">bits</span>&nbsp;<span class="builtintype" id="3363062">int</span><span class="op" id="3363065">)</span>&nbsp;<span class="ident" id="3363067">IPMask</span>&nbsp;<span class="op" id="3363074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3363077">if</span>&nbsp;<span class="ident" id="3363080">bits</span>&nbsp;<span class="op" id="3363085">!=</span>&nbsp;<span class="num" id="3363088">8</span><span class="op" id="3363089">*</span><span class="ident" id="3363090">IPv4len</span>&nbsp;<span class="op" id="3363098">&amp;&amp;</span>&nbsp;<span class="ident" id="3363101">bits</span>&nbsp;<span class="op" id="3363106">!=</span>&nbsp;<span class="num" id="3363109">8</span><span class="op" id="3363110">*</span><span class="ident" id="3363111">IPv6len</span>&nbsp;<span class="op" id="3363119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3363123">return</span>&nbsp;<span class="ident" id="3363130">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3363135">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3363138">if</span>&nbsp;<span class="ident" id="3363141">ones</span>&nbsp;<span class="op" id="3363146">&lt;</span>&nbsp;<span class="num" id="3363148">0</span>&nbsp;<span class="op" id="3363150">||</span>&nbsp;<span class="ident" id="3363153">ones</span>&nbsp;<span class="op" id="3363158">&gt;</span>&nbsp;<span class="ident" id="3363160">bits</span>&nbsp;<span class="op" id="3363165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3363169">return</span>&nbsp;<span class="ident" id="3363176">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3363181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3363184">l</span>&nbsp;<span class="op" id="3363186">:=</span>&nbsp;<span class="ident" id="3363189">bits</span>&nbsp;<span class="op" id="3363194">/</span>&nbsp;<span class="num" id="3363196">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3363199">m</span>&nbsp;<span class="op" id="3363201">:=</span>&nbsp;<span class="builtinfunc" id="3363204">make</span><span class="op" id="3363208">(</span><span class="ident" id="3363209">IPMask</span><span class="op" id="3363215">,</span>&nbsp;<span class="ident" id="3363217">l</span><span class="op" id="3363218">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3363221">n</span>&nbsp;<span class="op" id="3363223">:=</span>&nbsp;<span class="builtintype" id="3363226">uint</span><span class="op" id="3363230">(</span><span class="ident" id="3363231">ones</span><span class="op" id="3363235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3363238">for</span>&nbsp;<span class="ident" id="3363242">i</span>&nbsp;<span class="op" id="3363244">:=</span>&nbsp;<span class="num" id="3363247">0</span><span class="op" id="3363248">;</span>&nbsp;<span class="ident" id="3363250">i</span>&nbsp;<span class="op" id="3363252">&lt;</span>&nbsp;<span class="ident" id="3363254">l</span><span class="op" id="3363255">;</span>&nbsp;<span class="ident" id="3363257">i</span><span class="op" id="3363258">++</span>&nbsp;<span class="op" id="3363261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3363265">if</span>&nbsp;<span class="ident" id="3363268">n</span>&nbsp;<span class="op" id="3363270">&gt;=</span>&nbsp;<span class="num" id="3363273">8</span>&nbsp;<span class="op" id="3363275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3363280">m</span><span class="op" id="3363281">[</span><span class="ident" id="3363282">i</span><span class="op" id="3363283">]</span>&nbsp;<span class="op" id="3363285">=</span>&nbsp;<span class="num" id="3363287">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3363295">n</span>&nbsp;<span class="op" id="3363297">-=</span>&nbsp;<span class="num" id="3363300">8</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3363305">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3363316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3363320">m</span><span class="op" id="3363321">[</span><span class="ident" id="3363322">i</span><span class="op" id="3363323">]</span>&nbsp;<span class="op" id="3363325">=</span>&nbsp;<span class="op" id="3363327">^</span><span class="builtintype" id="3363328">byte</span><span class="op" id="3363332">(</span><span class="num" id="3363333">0xff</span>&nbsp;<span class="op" id="3363338">&gt;&gt;</span>&nbsp;<span class="ident" id="3363341">n</span><span class="op" id="3363342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3363346">n</span>&nbsp;<span class="op" id="3363348">=</span>&nbsp;<span class="num" id="3363350">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3363353">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3363356">return</span>&nbsp;<span class="ident" id="3363363">m</span><br>
<span class="lineno"></span><span class="op" id="3363365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3363368">//&nbsp;Well-known&nbsp;IPv4&nbsp;addresses</span><br>
<span class="lineno"></span><span class="keyword" id="3363397">var</span>&nbsp;<span class="op" id="3363401">(</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3363404">IPv4bcast</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3363418">=</span>&nbsp;<span class="ident" id="3363420">IPv4</span><span class="op" id="3363424">(</span><span class="num" id="3363425">255</span><span class="op" id="3363428">,</span>&nbsp;<span class="num" id="3363430">255</span><span class="op" id="3363433">,</span>&nbsp;<span class="num" id="3363435">255</span><span class="op" id="3363438">,</span>&nbsp;<span class="num" id="3363440">255</span><span class="op" id="3363443">)</span>&nbsp;<span class="comment" id="3363445">//&nbsp;broadcast</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3363459">IPv4allsys</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3363473">=</span>&nbsp;<span class="ident" id="3363475">IPv4</span><span class="op" id="3363479">(</span><span class="num" id="3363480">224</span><span class="op" id="3363483">,</span>&nbsp;<span class="num" id="3363485">0</span><span class="op" id="3363486">,</span>&nbsp;<span class="num" id="3363488">0</span><span class="op" id="3363489">,</span>&nbsp;<span class="num" id="3363491">1</span><span class="op" id="3363492">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3363500">//&nbsp;all&nbsp;systems</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3363516">IPv4allrouter</span>&nbsp;<span class="op" id="3363530">=</span>&nbsp;<span class="ident" id="3363532">IPv4</span><span class="op" id="3363536">(</span><span class="num" id="3363537">224</span><span class="op" id="3363540">,</span>&nbsp;<span class="num" id="3363542">0</span><span class="op" id="3363543">,</span>&nbsp;<span class="num" id="3363545">0</span><span class="op" id="3363546">,</span>&nbsp;<span class="num" id="3363548">2</span><span class="op" id="3363549">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3363557">//&nbsp;all&nbsp;routers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3363573">IPv4zero</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3363587">=</span>&nbsp;<span class="ident" id="3363589">IPv4</span><span class="op" id="3363593">(</span><span class="num" id="3363594">0</span><span class="op" id="3363595">,</span>&nbsp;<span class="num" id="3363597">0</span><span class="op" id="3363598">,</span>&nbsp;<span class="num" id="3363600">0</span><span class="op" id="3363601">,</span>&nbsp;<span class="num" id="3363603">0</span><span class="op" id="3363604">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3363614">//&nbsp;all&nbsp;zeros</span><br>
<span class="lineno"></span><span class="op" id="3363627">)</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="3363630">//&nbsp;Well-known&nbsp;IPv6&nbsp;addresses</span><br>
<span class="lineno"></span><span class="keyword" id="3363659">var</span>&nbsp;<span class="op" id="3363663">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3363666">IPv6zero</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3363693">=</span>&nbsp;<span class="ident" id="3363695">IP</span><span class="op" id="3363697">{</span><span class="num" id="3363698">0</span><span class="op" id="3363699">,</span>&nbsp;<span class="num" id="3363701">0</span><span class="op" id="3363702">,</span>&nbsp;<span class="num" id="3363704">0</span><span class="op" id="3363705">,</span>&nbsp;<span class="num" id="3363707">0</span><span class="op" id="3363708">,</span>&nbsp;<span class="num" id="3363710">0</span><span class="op" id="3363711">,</span>&nbsp;<span class="num" id="3363713">0</span><span class="op" id="3363714">,</span>&nbsp;<span class="num" id="3363716">0</span><span class="op" id="3363717">,</span>&nbsp;<span class="num" id="3363719">0</span><span class="op" id="3363720">,</span>&nbsp;<span class="num" id="3363722">0</span><span class="op" id="3363723">,</span>&nbsp;<span class="num" id="3363725">0</span><span class="op" id="3363726">,</span>&nbsp;<span class="num" id="3363728">0</span><span class="op" id="3363729">,</span>&nbsp;<span class="num" id="3363731">0</span><span class="op" id="3363732">,</span>&nbsp;<span class="num" id="3363734">0</span><span class="op" id="3363735">,</span>&nbsp;<span class="num" id="3363737">0</span><span class="op" id="3363738">,</span>&nbsp;<span class="num" id="3363740">0</span><span class="op" id="3363741">,</span>&nbsp;<span class="num" id="3363743">0</span><span class="op" id="3363744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3363747">IPv6unspecified</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3363774">=</span>&nbsp;<span class="ident" id="3363776">IP</span><span class="op" id="3363778">{</span><span class="num" id="3363779">0</span><span class="op" id="3363780">,</span>&nbsp;<span class="num" id="3363782">0</span><span class="op" id="3363783">,</span>&nbsp;<span class="num" id="3363785">0</span><span class="op" id="3363786">,</span>&nbsp;<span class="num" id="3363788">0</span><span class="op" id="3363789">,</span>&nbsp;<span class="num" id="3363791">0</span><span class="op" id="3363792">,</span>&nbsp;<span class="num" id="3363794">0</span><span class="op" id="3363795">,</span>&nbsp;<span class="num" id="3363797">0</span><span class="op" id="3363798">,</span>&nbsp;<span class="num" id="3363800">0</span><span class="op" id="3363801">,</span>&nbsp;<span class="num" id="3363803">0</span><span class="op" id="3363804">,</span>&nbsp;<span class="num" id="3363806">0</span><span class="op" id="3363807">,</span>&nbsp;<span class="num" id="3363809">0</span><span class="op" id="3363810">,</span>&nbsp;<span class="num" id="3363812">0</span><span class="op" id="3363813">,</span>&nbsp;<span class="num" id="3363815">0</span><span class="op" id="3363816">,</span>&nbsp;<span class="num" id="3363818">0</span><span class="op" id="3363819">,</span>&nbsp;<span class="num" id="3363821">0</span><span class="op" id="3363822">,</span>&nbsp;<span class="num" id="3363824">0</span><span class="op" id="3363825">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3363828">IPv6loopback</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3363855">=</span>&nbsp;<span class="ident" id="3363857">IP</span><span class="op" id="3363859">{</span><span class="num" id="3363860">0</span><span class="op" id="3363861">,</span>&nbsp;<span class="num" id="3363863">0</span><span class="op" id="3363864">,</span>&nbsp;<span class="num" id="3363866">0</span><span class="op" id="3363867">,</span>&nbsp;<span class="num" id="3363869">0</span><span class="op" id="3363870">,</span>&nbsp;<span class="num" id="3363872">0</span><span class="op" id="3363873">,</span>&nbsp;<span class="num" id="3363875">0</span><span class="op" id="3363876">,</span>&nbsp;<span class="num" id="3363878">0</span><span class="op" id="3363879">,</span>&nbsp;<span class="num" id="3363881">0</span><span class="op" id="3363882">,</span>&nbsp;<span class="num" id="3363884">0</span><span class="op" id="3363885">,</span>&nbsp;<span class="num" id="3363887">0</span><span class="op" id="3363888">,</span>&nbsp;<span class="num" id="3363890">0</span><span class="op" id="3363891">,</span>&nbsp;<span class="num" id="3363893">0</span><span class="op" id="3363894">,</span>&nbsp;<span class="num" id="3363896">0</span><span class="op" id="3363897">,</span>&nbsp;<span class="num" id="3363899">0</span><span class="op" id="3363900">,</span>&nbsp;<span class="num" id="3363902">0</span><span class="op" id="3363903">,</span>&nbsp;<span class="num" id="3363905">1</span><span class="op" id="3363906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3363909">IPv6interfacelocalallnodes</span>&nbsp;<span class="op" id="3363936">=</span>&nbsp;<span class="ident" id="3363938">IP</span><span class="op" id="3363940">{</span><span class="num" id="3363941">0xff</span><span class="op" id="3363945">,</span>&nbsp;<span class="num" id="3363947">0x01</span><span class="op" id="3363951">,</span>&nbsp;<span class="num" id="3363953">0</span><span class="op" id="3363954">,</span>&nbsp;<span class="num" id="3363956">0</span><span class="op" id="3363957">,</span>&nbsp;<span class="num" id="3363959">0</span><span class="op" id="3363960">,</span>&nbsp;<span class="num" id="3363962">0</span><span class="op" id="3363963">,</span>&nbsp;<span class="num" id="3363965">0</span><span class="op" id="3363966">,</span>&nbsp;<span class="num" id="3363968">0</span><span class="op" id="3363969">,</span>&nbsp;<span class="num" id="3363971">0</span><span class="op" id="3363972">,</span>&nbsp;<span class="num" id="3363974">0</span><span class="op" id="3363975">,</span>&nbsp;<span class="num" id="3363977">0</span><span class="op" id="3363978">,</span>&nbsp;<span class="num" id="3363980">0</span><span class="op" id="3363981">,</span>&nbsp;<span class="num" id="3363983">0</span><span class="op" id="3363984">,</span>&nbsp;<span class="num" id="3363986">0</span><span class="op" id="3363987">,</span>&nbsp;<span class="num" id="3363989">0</span><span class="op" id="3363990">,</span>&nbsp;<span class="num" id="3363992">0x01</span><span class="op" id="3363996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3363999">IPv6linklocalallnodes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3364026">=</span>&nbsp;<span class="ident" id="3364028">IP</span><span class="op" id="3364030">{</span><span class="num" id="3364031">0xff</span><span class="op" id="3364035">,</span>&nbsp;<span class="num" id="3364037">0x02</span><span class="op" id="3364041">,</span>&nbsp;<span class="num" id="3364043">0</span><span class="op" id="3364044">,</span>&nbsp;<span class="num" id="3364046">0</span><span class="op" id="3364047">,</span>&nbsp;<span class="num" id="3364049">0</span><span class="op" id="3364050">,</span>&nbsp;<span class="num" id="3364052">0</span><span class="op" id="3364053">,</span>&nbsp;<span class="num" id="3364055">0</span><span class="op" id="3364056">,</span>&nbsp;<span class="num" id="3364058">0</span><span class="op" id="3364059">,</span>&nbsp;<span class="num" id="3364061">0</span><span class="op" id="3364062">,</span>&nbsp;<span class="num" id="3364064">0</span><span class="op" id="3364065">,</span>&nbsp;<span class="num" id="3364067">0</span><span class="op" id="3364068">,</span>&nbsp;<span class="num" id="3364070">0</span><span class="op" id="3364071">,</span>&nbsp;<span class="num" id="3364073">0</span><span class="op" id="3364074">,</span>&nbsp;<span class="num" id="3364076">0</span><span class="op" id="3364077">,</span>&nbsp;<span class="num" id="3364079">0</span><span class="op" id="3364080">,</span>&nbsp;<span class="num" id="3364082">0x01</span><span class="op" id="3364086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3364089">IPv6linklocalallrouters</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3364116">=</span>&nbsp;<span class="ident" id="3364118">IP</span><span class="op" id="3364120">{</span><span class="num" id="3364121">0xff</span><span class="op" id="3364125">,</span>&nbsp;<span class="num" id="3364127">0x02</span><span class="op" id="3364131">,</span>&nbsp;<span class="num" id="3364133">0</span><span class="op" id="3364134">,</span>&nbsp;<span class="num" id="3364136">0</span><span class="op" id="3364137">,</span>&nbsp;<span class="num" id="3364139">0</span><span class="op" id="3364140">,</span>&nbsp;<span class="num" id="3364142">0</span><span class="op" id="3364143">,</span>&nbsp;<span class="num" id="3364145">0</span><span class="op" id="3364146">,</span>&nbsp;<span class="num" id="3364148">0</span><span class="op" id="3364149">,</span>&nbsp;<span class="num" id="3364151">0</span><span class="op" id="3364152">,</span>&nbsp;<span class="num" id="3364154">0</span><span class="op" id="3364155">,</span>&nbsp;<span class="num" id="3364157">0</span><span class="op" id="3364158">,</span>&nbsp;<span class="num" id="3364160">0</span><span class="op" id="3364161">,</span>&nbsp;<span class="num" id="3364163">0</span><span class="op" id="3364164">,</span>&nbsp;<span class="num" id="3364166">0</span><span class="op" id="3364167">,</span>&nbsp;<span class="num" id="3364169">0</span><span class="op" id="3364170">,</span>&nbsp;<span class="num" id="3364172">0x02</span><span class="op" id="3364176">}</span><br>
<span class="lineno"></span><span class="op" id="3364178">)</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="3364181">//&nbsp;IsUnspecified&nbsp;returns&nbsp;true&nbsp;if&nbsp;ip&nbsp;is&nbsp;an&nbsp;unspecified&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="3364244">func</span>&nbsp;<span class="op" id="3364249">(</span><span class="ident" id="3364250">ip</span>&nbsp;<span class="ident" id="3364253">IP</span><span class="op" id="3364255">)</span>&nbsp;<span class="ident" id="3364257">IsUnspecified</span><span class="op" id="3364270">(</span><span class="op" id="3364271">)</span>&nbsp;<span class="builtintype" id="3364273">bool</span>&nbsp;<span class="op" id="3364278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3364281">if</span>&nbsp;<span class="ident" id="3364284">ip</span><span class="op" id="3364286">.</span><span class="ident" id="3364287">Equal</span><span class="op" id="3364292">(</span><span class="ident" id="3364293">IPv4zero</span><span class="op" id="3364301">)</span>&nbsp;<span class="op" id="3364303">||</span>&nbsp;<span class="ident" id="3364306">ip</span><span class="op" id="3364308">.</span><span class="ident" id="3364309">Equal</span><span class="op" id="3364314">(</span><span class="ident" id="3364315">IPv6unspecified</span><span class="op" id="3364330">)</span>&nbsp;<span class="op" id="3364332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3364336">return</span>&nbsp;<span class="ident" id="3364343">true</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3364349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3364352">return</span>&nbsp;<span class="ident" id="3364359">false</span><br>
<span class="lineno"></span><span class="op" id="3364365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3364368">//&nbsp;IsLoopback&nbsp;returns&nbsp;true&nbsp;if&nbsp;ip&nbsp;is&nbsp;a&nbsp;loopback&nbsp;address.</span><br>
<span class="lineno">120</span><span class="keyword" id="3364424">func</span>&nbsp;<span class="op" id="3364429">(</span><span class="ident" id="3364430">ip</span>&nbsp;<span class="ident" id="3364433">IP</span><span class="op" id="3364435">)</span>&nbsp;<span class="ident" id="3364437">IsLoopback</span><span class="op" id="3364447">(</span><span class="op" id="3364448">)</span>&nbsp;<span class="builtintype" id="3364450">bool</span>&nbsp;<span class="op" id="3364455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3364458">if</span>&nbsp;<span class="ident" id="3364461">ip4</span>&nbsp;<span class="op" id="3364465">:=</span>&nbsp;<span class="ident" id="3364468">ip</span><span class="op" id="3364470">.</span><span class="ident" id="3364471">To4</span><span class="op" id="3364474">(</span><span class="op" id="3364475">)</span><span class="op" id="3364476">;</span>&nbsp;<span class="ident" id="3364478">ip4</span>&nbsp;<span class="op" id="3364482">!=</span>&nbsp;<span class="ident" id="3364485">nil</span>&nbsp;<span class="op" id="3364489">&amp;&amp;</span>&nbsp;<span class="ident" id="3364492">ip4</span><span class="op" id="3364495">[</span><span class="num" id="3364496">0</span><span class="op" id="3364497">]</span>&nbsp;<span class="op" id="3364499">==</span>&nbsp;<span class="num" id="3364502">127</span>&nbsp;<span class="op" id="3364506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3364510">return</span>&nbsp;<span class="ident" id="3364517">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3364523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3364526">return</span>&nbsp;<span class="ident" id="3364533">ip</span><span class="op" id="3364535">.</span><span class="ident" id="3364536">Equal</span><span class="op" id="3364541">(</span><span class="ident" id="3364542">IPv6loopback</span><span class="op" id="3364554">)</span><br>
<span class="lineno">125</span><span class="op" id="3364556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3364559">//&nbsp;IsMulticast&nbsp;returns&nbsp;true&nbsp;if&nbsp;ip&nbsp;is&nbsp;a&nbsp;multicast&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="3364617">func</span>&nbsp;<span class="op" id="3364622">(</span><span class="ident" id="3364623">ip</span>&nbsp;<span class="ident" id="3364626">IP</span><span class="op" id="3364628">)</span>&nbsp;<span class="ident" id="3364630">IsMulticast</span><span class="op" id="3364641">(</span><span class="op" id="3364642">)</span>&nbsp;<span class="builtintype" id="3364644">bool</span>&nbsp;<span class="op" id="3364649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3364652">if</span>&nbsp;<span class="ident" id="3364655">ip4</span>&nbsp;<span class="op" id="3364659">:=</span>&nbsp;<span class="ident" id="3364662">ip</span><span class="op" id="3364664">.</span><span class="ident" id="3364665">To4</span><span class="op" id="3364668">(</span><span class="op" id="3364669">)</span><span class="op" id="3364670">;</span>&nbsp;<span class="ident" id="3364672">ip4</span>&nbsp;<span class="op" id="3364676">!=</span>&nbsp;<span class="ident" id="3364679">nil</span>&nbsp;<span class="op" id="3364683">&amp;&amp;</span>&nbsp;<span class="ident" id="3364686">ip4</span><span class="op" id="3364689">[</span><span class="num" id="3364690">0</span><span class="op" id="3364691">]</span><span class="op" id="3364692">&amp;</span><span class="num" id="3364693">0xf0</span>&nbsp;<span class="op" id="3364698">==</span>&nbsp;<span class="num" id="3364701">0xe0</span>&nbsp;<span class="op" id="3364706">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3364710">return</span>&nbsp;<span class="ident" id="3364717">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3364723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3364726">return</span>&nbsp;<span class="ident" id="3364733">ip</span><span class="op" id="3364735">[</span><span class="num" id="3364736">0</span><span class="op" id="3364737">]</span>&nbsp;<span class="op" id="3364739">==</span>&nbsp;<span class="num" id="3364742">0xff</span><br>
<span class="lineno"></span><span class="op" id="3364747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="comment" id="3364750">//&nbsp;IsInterfaceLinkLocalMulticast&nbsp;returns&nbsp;true&nbsp;if&nbsp;ip&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3364805">//&nbsp;an&nbsp;interface-local&nbsp;multicast&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="3364846">func</span>&nbsp;<span class="op" id="3364851">(</span><span class="ident" id="3364852">ip</span>&nbsp;<span class="ident" id="3364855">IP</span><span class="op" id="3364857">)</span>&nbsp;<span class="ident" id="3364859">IsInterfaceLocalMulticast</span><span class="op" id="3364884">(</span><span class="op" id="3364885">)</span>&nbsp;<span class="builtintype" id="3364887">bool</span>&nbsp;<span class="op" id="3364892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3364895">return</span>&nbsp;<span class="builtinfunc" id="3364902">len</span><span class="op" id="3364905">(</span><span class="ident" id="3364906">ip</span><span class="op" id="3364908">)</span>&nbsp;<span class="op" id="3364910">==</span>&nbsp;<span class="ident" id="3364913">IPv6len</span>&nbsp;<span class="op" id="3364921">&amp;&amp;</span>&nbsp;<span class="ident" id="3364924">ip</span><span class="op" id="3364926">[</span><span class="num" id="3364927">0</span><span class="op" id="3364928">]</span>&nbsp;<span class="op" id="3364930">==</span>&nbsp;<span class="num" id="3364933">0xff</span>&nbsp;<span class="op" id="3364938">&amp;&amp;</span>&nbsp;<span class="ident" id="3364941">ip</span><span class="op" id="3364943">[</span><span class="num" id="3364944">1</span><span class="op" id="3364945">]</span><span class="op" id="3364946">&amp;</span><span class="num" id="3364947">0x0f</span>&nbsp;<span class="op" id="3364952">==</span>&nbsp;<span class="num" id="3364955">0x01</span><br>
<span class="lineno"></span><span class="op" id="3364960">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="comment" id="3364963">//&nbsp;IsLinkLocalMulticast&nbsp;returns&nbsp;true&nbsp;if&nbsp;ip&nbsp;is&nbsp;a&nbsp;link-local</span><br>
<span class="lineno"></span><span class="comment" id="3365022">//&nbsp;multicast&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="3365044">func</span>&nbsp;<span class="op" id="3365049">(</span><span class="ident" id="3365050">ip</span>&nbsp;<span class="ident" id="3365053">IP</span><span class="op" id="3365055">)</span>&nbsp;<span class="ident" id="3365057">IsLinkLocalMulticast</span><span class="op" id="3365077">(</span><span class="op" id="3365078">)</span>&nbsp;<span class="builtintype" id="3365080">bool</span>&nbsp;<span class="op" id="3365085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3365088">if</span>&nbsp;<span class="ident" id="3365091">ip4</span>&nbsp;<span class="op" id="3365095">:=</span>&nbsp;<span class="ident" id="3365098">ip</span><span class="op" id="3365100">.</span><span class="ident" id="3365101">To4</span><span class="op" id="3365104">(</span><span class="op" id="3365105">)</span><span class="op" id="3365106">;</span>&nbsp;<span class="ident" id="3365108">ip4</span>&nbsp;<span class="op" id="3365112">!=</span>&nbsp;<span class="ident" id="3365115">nil</span>&nbsp;<span class="op" id="3365119">&amp;&amp;</span>&nbsp;<span class="ident" id="3365122">ip4</span><span class="op" id="3365125">[</span><span class="num" id="3365126">0</span><span class="op" id="3365127">]</span>&nbsp;<span class="op" id="3365129">==</span>&nbsp;<span class="num" id="3365132">224</span>&nbsp;<span class="op" id="3365136">&amp;&amp;</span>&nbsp;<span class="ident" id="3365139">ip4</span><span class="op" id="3365142">[</span><span class="num" id="3365143">1</span><span class="op" id="3365144">]</span>&nbsp;<span class="op" id="3365146">==</span>&nbsp;<span class="num" id="3365149">0</span>&nbsp;<span class="op" id="3365151">&amp;&amp;</span>&nbsp;<span class="ident" id="3365154">ip4</span><span class="op" id="3365157">[</span><span class="num" id="3365158">2</span><span class="op" id="3365159">]</span>&nbsp;<span class="op" id="3365161">==</span>&nbsp;<span class="num" id="3365164">0</span>&nbsp;<span class="op" id="3365166">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3365170">return</span>&nbsp;<span class="ident" id="3365177">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3365183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3365186">return</span>&nbsp;<span class="ident" id="3365193">ip</span><span class="op" id="3365195">[</span><span class="num" id="3365196">0</span><span class="op" id="3365197">]</span>&nbsp;<span class="op" id="3365199">==</span>&nbsp;<span class="num" id="3365202">0xff</span>&nbsp;<span class="op" id="3365207">&amp;&amp;</span>&nbsp;<span class="ident" id="3365210">ip</span><span class="op" id="3365212">[</span><span class="num" id="3365213">1</span><span class="op" id="3365214">]</span><span class="op" id="3365215">&amp;</span><span class="num" id="3365216">0x0f</span>&nbsp;<span class="op" id="3365221">==</span>&nbsp;<span class="num" id="3365224">0x02</span><br>
<span class="lineno"></span><span class="op" id="3365229">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="3365232">//&nbsp;IsLinkLocalUnicast&nbsp;returns&nbsp;true&nbsp;if&nbsp;ip&nbsp;is&nbsp;a&nbsp;link-local</span><br>
<span class="lineno"></span><span class="comment" id="3365289">//&nbsp;unicast&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="3365309">func</span>&nbsp;<span class="op" id="3365314">(</span><span class="ident" id="3365315">ip</span>&nbsp;<span class="ident" id="3365318">IP</span><span class="op" id="3365320">)</span>&nbsp;<span class="ident" id="3365322">IsLinkLocalUnicast</span><span class="op" id="3365340">(</span><span class="op" id="3365341">)</span>&nbsp;<span class="builtintype" id="3365343">bool</span>&nbsp;<span class="op" id="3365348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3365351">if</span>&nbsp;<span class="ident" id="3365354">ip4</span>&nbsp;<span class="op" id="3365358">:=</span>&nbsp;<span class="ident" id="3365361">ip</span><span class="op" id="3365363">.</span><span class="ident" id="3365364">To4</span><span class="op" id="3365367">(</span><span class="op" id="3365368">)</span><span class="op" id="3365369">;</span>&nbsp;<span class="ident" id="3365371">ip4</span>&nbsp;<span class="op" id="3365375">!=</span>&nbsp;<span class="ident" id="3365378">nil</span>&nbsp;<span class="op" id="3365382">&amp;&amp;</span>&nbsp;<span class="ident" id="3365385">ip4</span><span class="op" id="3365388">[</span><span class="num" id="3365389">0</span><span class="op" id="3365390">]</span>&nbsp;<span class="op" id="3365392">==</span>&nbsp;<span class="num" id="3365395">169</span>&nbsp;<span class="op" id="3365399">&amp;&amp;</span>&nbsp;<span class="ident" id="3365402">ip4</span><span class="op" id="3365405">[</span><span class="num" id="3365406">1</span><span class="op" id="3365407">]</span>&nbsp;<span class="op" id="3365409">==</span>&nbsp;<span class="num" id="3365412">254</span>&nbsp;<span class="op" id="3365416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3365420">return</span>&nbsp;<span class="ident" id="3365427">true</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3365433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3365436">return</span>&nbsp;<span class="ident" id="3365443">ip</span><span class="op" id="3365445">[</span><span class="num" id="3365446">0</span><span class="op" id="3365447">]</span>&nbsp;<span class="op" id="3365449">==</span>&nbsp;<span class="num" id="3365452">0xfe</span>&nbsp;<span class="op" id="3365457">&amp;&amp;</span>&nbsp;<span class="ident" id="3365460">ip</span><span class="op" id="3365462">[</span><span class="num" id="3365463">1</span><span class="op" id="3365464">]</span><span class="op" id="3365465">&amp;</span><span class="num" id="3365466">0xc0</span>&nbsp;<span class="op" id="3365471">==</span>&nbsp;<span class="num" id="3365474">0x80</span><br>
<span class="lineno"></span><span class="op" id="3365479">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3365482">//&nbsp;IsGlobalUnicast&nbsp;returns&nbsp;true&nbsp;if&nbsp;ip&nbsp;is&nbsp;a&nbsp;global&nbsp;unicast</span><br>
<span class="lineno">160</span><span class="comment" id="3365540">//&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="3365552">func</span>&nbsp;<span class="op" id="3365557">(</span><span class="ident" id="3365558">ip</span>&nbsp;<span class="ident" id="3365561">IP</span><span class="op" id="3365563">)</span>&nbsp;<span class="ident" id="3365565">IsGlobalUnicast</span><span class="op" id="3365580">(</span><span class="op" id="3365581">)</span>&nbsp;<span class="builtintype" id="3365583">bool</span>&nbsp;<span class="op" id="3365588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3365591">return</span>&nbsp;<span class="op" id="3365598">!</span><span class="ident" id="3365599">ip</span><span class="op" id="3365601">.</span><span class="ident" id="3365602">IsUnspecified</span><span class="op" id="3365615">(</span><span class="op" id="3365616">)</span>&nbsp;<span class="op" id="3365618">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3365623">!</span><span class="ident" id="3365624">ip</span><span class="op" id="3365626">.</span><span class="ident" id="3365627">IsLoopback</span><span class="op" id="3365637">(</span><span class="op" id="3365638">)</span>&nbsp;<span class="op" id="3365640">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3365645">!</span><span class="ident" id="3365646">ip</span><span class="op" id="3365648">.</span><span class="ident" id="3365649">IsMulticast</span><span class="op" id="3365660">(</span><span class="op" id="3365661">)</span>&nbsp;<span class="op" id="3365663">&amp;&amp;</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3365668">!</span><span class="ident" id="3365669">ip</span><span class="op" id="3365671">.</span><span class="ident" id="3365672">IsLinkLocalUnicast</span><span class="op" id="3365690">(</span><span class="op" id="3365691">)</span><br>
<span class="lineno"></span><span class="op" id="3365693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3365696">//&nbsp;Is&nbsp;p&nbsp;all&nbsp;zeros?</span><br>
<span class="lineno"></span><span class="keyword" id="3365715">func</span>&nbsp;<span class="ident" id="3365720">isZeros</span><span class="op" id="3365727">(</span><span class="ident" id="3365728">p</span>&nbsp;<span class="ident" id="3365730">IP</span><span class="op" id="3365732">)</span>&nbsp;<span class="builtintype" id="3365734">bool</span>&nbsp;<span class="op" id="3365739">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3365742">for</span>&nbsp;<span class="ident" id="3365746">i</span>&nbsp;<span class="op" id="3365748">:=</span>&nbsp;<span class="num" id="3365751">0</span><span class="op" id="3365752">;</span>&nbsp;<span class="ident" id="3365754">i</span>&nbsp;<span class="op" id="3365756">&lt;</span>&nbsp;<span class="builtinfunc" id="3365758">len</span><span class="op" id="3365761">(</span><span class="ident" id="3365762">p</span><span class="op" id="3365763">)</span><span class="op" id="3365764">;</span>&nbsp;<span class="ident" id="3365766">i</span><span class="op" id="3365767">++</span>&nbsp;<span class="op" id="3365770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3365774">if</span>&nbsp;<span class="ident" id="3365777">p</span><span class="op" id="3365778">[</span><span class="ident" id="3365779">i</span><span class="op" id="3365780">]</span>&nbsp;<span class="op" id="3365782">!=</span>&nbsp;<span class="num" id="3365785">0</span>&nbsp;<span class="op" id="3365787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3365792">return</span>&nbsp;<span class="ident" id="3365799">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3365807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3365810">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3365813">return</span>&nbsp;<span class="ident" id="3365820">true</span><br>
<span class="lineno"></span><span class="op" id="3365825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3365828">//&nbsp;To4&nbsp;converts&nbsp;the&nbsp;IPv4&nbsp;address&nbsp;ip&nbsp;to&nbsp;a&nbsp;4-byte&nbsp;representation.</span><br>
<span class="lineno"></span><span class="comment" id="3365892">//&nbsp;If&nbsp;ip&nbsp;is&nbsp;not&nbsp;an&nbsp;IPv4&nbsp;address,&nbsp;To4&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno">180</span><span class="keyword" id="3365942">func</span>&nbsp;<span class="op" id="3365947">(</span><span class="ident" id="3365948">ip</span>&nbsp;<span class="ident" id="3365951">IP</span><span class="op" id="3365953">)</span>&nbsp;<span class="ident" id="3365955">To4</span><span class="op" id="3365958">(</span><span class="op" id="3365959">)</span>&nbsp;<span class="ident" id="3365961">IP</span>&nbsp;<span class="op" id="3365964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3365967">if</span>&nbsp;<span class="builtinfunc" id="3365970">len</span><span class="op" id="3365973">(</span><span class="ident" id="3365974">ip</span><span class="op" id="3365976">)</span>&nbsp;<span class="op" id="3365978">==</span>&nbsp;<span class="ident" id="3365981">IPv4len</span>&nbsp;<span class="op" id="3365989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3365993">return</span>&nbsp;<span class="ident" id="3366000">ip</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3366004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366007">if</span>&nbsp;<span class="builtinfunc" id="3366010">len</span><span class="op" id="3366013">(</span><span class="ident" id="3366014">ip</span><span class="op" id="3366016">)</span>&nbsp;<span class="op" id="3366018">==</span>&nbsp;<span class="ident" id="3366021">IPv6len</span>&nbsp;<span class="op" id="3366029">&amp;&amp;</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3366034">isZeros</span><span class="op" id="3366041">(</span><span class="ident" id="3366042">ip</span><span class="op" id="3366044">[</span><span class="num" id="3366045">0</span><span class="op" id="3366046">:</span><span class="num" id="3366047">10</span><span class="op" id="3366049">]</span><span class="op" id="3366050">)</span>&nbsp;<span class="op" id="3366052">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3366057">ip</span><span class="op" id="3366059">[</span><span class="num" id="3366060">10</span><span class="op" id="3366062">]</span>&nbsp;<span class="op" id="3366064">==</span>&nbsp;<span class="num" id="3366067">0xff</span>&nbsp;<span class="op" id="3366072">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3366077">ip</span><span class="op" id="3366079">[</span><span class="num" id="3366080">11</span><span class="op" id="3366082">]</span>&nbsp;<span class="op" id="3366084">==</span>&nbsp;<span class="num" id="3366087">0xff</span>&nbsp;<span class="op" id="3366092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366096">return</span>&nbsp;<span class="ident" id="3366103">ip</span><span class="op" id="3366105">[</span><span class="num" id="3366106">12</span><span class="op" id="3366108">:</span><span class="num" id="3366109">16</span><span class="op" id="3366111">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3366114">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366117">return</span>&nbsp;<span class="ident" id="3366124">nil</span><br>
<span class="lineno"></span><span class="op" id="3366128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3366131">//&nbsp;To16&nbsp;converts&nbsp;the&nbsp;IP&nbsp;address&nbsp;ip&nbsp;to&nbsp;a&nbsp;16-byte&nbsp;representation.</span><br>
<span class="lineno"></span><span class="comment" id="3366195">//&nbsp;If&nbsp;ip&nbsp;is&nbsp;not&nbsp;an&nbsp;IP&nbsp;address&nbsp;(it&nbsp;is&nbsp;the&nbsp;wrong&nbsp;length),&nbsp;To16&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno">195</span><span class="keyword" id="3366269">func</span>&nbsp;<span class="op" id="3366274">(</span><span class="ident" id="3366275">ip</span>&nbsp;<span class="ident" id="3366278">IP</span><span class="op" id="3366280">)</span>&nbsp;<span class="ident" id="3366282">To16</span><span class="op" id="3366286">(</span><span class="op" id="3366287">)</span>&nbsp;<span class="ident" id="3366289">IP</span>&nbsp;<span class="op" id="3366292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366295">if</span>&nbsp;<span class="builtinfunc" id="3366298">len</span><span class="op" id="3366301">(</span><span class="ident" id="3366302">ip</span><span class="op" id="3366304">)</span>&nbsp;<span class="op" id="3366306">==</span>&nbsp;<span class="ident" id="3366309">IPv4len</span>&nbsp;<span class="op" id="3366317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366321">return</span>&nbsp;<span class="ident" id="3366328">IPv4</span><span class="op" id="3366332">(</span><span class="ident" id="3366333">ip</span><span class="op" id="3366335">[</span><span class="num" id="3366336">0</span><span class="op" id="3366337">]</span><span class="op" id="3366338">,</span>&nbsp;<span class="ident" id="3366340">ip</span><span class="op" id="3366342">[</span><span class="num" id="3366343">1</span><span class="op" id="3366344">]</span><span class="op" id="3366345">,</span>&nbsp;<span class="ident" id="3366347">ip</span><span class="op" id="3366349">[</span><span class="num" id="3366350">2</span><span class="op" id="3366351">]</span><span class="op" id="3366352">,</span>&nbsp;<span class="ident" id="3366354">ip</span><span class="op" id="3366356">[</span><span class="num" id="3366357">3</span><span class="op" id="3366358">]</span><span class="op" id="3366359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3366362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366365">if</span>&nbsp;<span class="builtinfunc" id="3366368">len</span><span class="op" id="3366371">(</span><span class="ident" id="3366372">ip</span><span class="op" id="3366374">)</span>&nbsp;<span class="op" id="3366376">==</span>&nbsp;<span class="ident" id="3366379">IPv6len</span>&nbsp;<span class="op" id="3366387">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366391">return</span>&nbsp;<span class="ident" id="3366398">ip</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3366402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366405">return</span>&nbsp;<span class="ident" id="3366412">nil</span><br>
<span class="lineno"></span><span class="op" id="3366416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="3366419">//&nbsp;Default&nbsp;route&nbsp;masks&nbsp;for&nbsp;IPv4.</span><br>
<span class="lineno"></span><span class="keyword" id="3366452">var</span>&nbsp;<span class="op" id="3366456">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3366459">classAMask</span>&nbsp;<span class="op" id="3366470">=</span>&nbsp;<span class="ident" id="3366472">IPv4Mask</span><span class="op" id="3366480">(</span><span class="num" id="3366481">0xff</span><span class="op" id="3366485">,</span>&nbsp;<span class="num" id="3366487">0</span><span class="op" id="3366488">,</span>&nbsp;<span class="num" id="3366490">0</span><span class="op" id="3366491">,</span>&nbsp;<span class="num" id="3366493">0</span><span class="op" id="3366494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3366497">classBMask</span>&nbsp;<span class="op" id="3366508">=</span>&nbsp;<span class="ident" id="3366510">IPv4Mask</span><span class="op" id="3366518">(</span><span class="num" id="3366519">0xff</span><span class="op" id="3366523">,</span>&nbsp;<span class="num" id="3366525">0xff</span><span class="op" id="3366529">,</span>&nbsp;<span class="num" id="3366531">0</span><span class="op" id="3366532">,</span>&nbsp;<span class="num" id="3366534">0</span><span class="op" id="3366535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3366538">classCMask</span>&nbsp;<span class="op" id="3366549">=</span>&nbsp;<span class="ident" id="3366551">IPv4Mask</span><span class="op" id="3366559">(</span><span class="num" id="3366560">0xff</span><span class="op" id="3366564">,</span>&nbsp;<span class="num" id="3366566">0xff</span><span class="op" id="3366570">,</span>&nbsp;<span class="num" id="3366572">0xff</span><span class="op" id="3366576">,</span>&nbsp;<span class="num" id="3366578">0</span><span class="op" id="3366579">)</span><br>
<span class="lineno">210</span><span class="op" id="3366581">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3366584">//&nbsp;DefaultMask&nbsp;returns&nbsp;the&nbsp;default&nbsp;IP&nbsp;mask&nbsp;for&nbsp;the&nbsp;IP&nbsp;address&nbsp;ip.</span><br>
<span class="lineno"></span><span class="comment" id="3366650">//&nbsp;Only&nbsp;IPv4&nbsp;addresses&nbsp;have&nbsp;default&nbsp;masks;&nbsp;DefaultMask&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3366713">//&nbsp;nil&nbsp;if&nbsp;ip&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;IPv4&nbsp;address.</span><br>
<span class="lineno">215</span><span class="keyword" id="3366755">func</span>&nbsp;<span class="op" id="3366760">(</span><span class="ident" id="3366761">ip</span>&nbsp;<span class="ident" id="3366764">IP</span><span class="op" id="3366766">)</span>&nbsp;<span class="ident" id="3366768">DefaultMask</span><span class="op" id="3366779">(</span><span class="op" id="3366780">)</span>&nbsp;<span class="ident" id="3366782">IPMask</span>&nbsp;<span class="op" id="3366789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366792">if</span>&nbsp;<span class="ident" id="3366795">ip</span>&nbsp;<span class="op" id="3366798">=</span>&nbsp;<span class="ident" id="3366800">ip</span><span class="op" id="3366802">.</span><span class="ident" id="3366803">To4</span><span class="op" id="3366806">(</span><span class="op" id="3366807">)</span><span class="op" id="3366808">;</span>&nbsp;<span class="ident" id="3366810">ip</span>&nbsp;<span class="op" id="3366813">==</span>&nbsp;<span class="ident" id="3366816">nil</span>&nbsp;<span class="op" id="3366820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366824">return</span>&nbsp;<span class="ident" id="3366831">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3366836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366839">switch</span>&nbsp;<span class="ident" id="3366846">true</span>&nbsp;<span class="op" id="3366851">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366854">case</span>&nbsp;<span class="ident" id="3366859">ip</span><span class="op" id="3366861">[</span><span class="num" id="3366862">0</span><span class="op" id="3366863">]</span>&nbsp;<span class="op" id="3366865">&lt;</span>&nbsp;<span class="num" id="3366867">0x80</span><span class="op" id="3366871">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366875">return</span>&nbsp;<span class="ident" id="3366882">classAMask</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366894">case</span>&nbsp;<span class="ident" id="3366899">ip</span><span class="op" id="3366901">[</span><span class="num" id="3366902">0</span><span class="op" id="3366903">]</span>&nbsp;<span class="op" id="3366905">&lt;</span>&nbsp;<span class="num" id="3366907">0xC0</span><span class="op" id="3366911">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366915">return</span>&nbsp;<span class="ident" id="3366922">classBMask</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366934">default</span><span class="op" id="3366941">:</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366945">return</span>&nbsp;<span class="ident" id="3366952">classCMask</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3366964">}</span><br>
<span class="lineno"></span><span class="op" id="3366966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3366969">func</span>&nbsp;<span class="ident" id="3366974">allFF</span><span class="op" id="3366979">(</span><span class="ident" id="3366980">b</span>&nbsp;<span class="op" id="3366982">[</span><span class="op" id="3366983">]</span><span class="builtintype" id="3366984">byte</span><span class="op" id="3366988">)</span>&nbsp;<span class="builtintype" id="3366990">bool</span>&nbsp;<span class="op" id="3366995">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366998">for</span>&nbsp;<span class="ident" id="3367002">_</span><span class="op" id="3367003">,</span>&nbsp;<span class="ident" id="3367005">c</span>&nbsp;<span class="op" id="3367007">:=</span>&nbsp;<span class="keyword" id="3367010">range</span>&nbsp;<span class="ident" id="3367016">b</span>&nbsp;<span class="op" id="3367018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3367022">if</span>&nbsp;<span class="ident" id="3367025">c</span>&nbsp;<span class="op" id="3367027">!=</span>&nbsp;<span class="num" id="3367030">0xff</span>&nbsp;<span class="op" id="3367035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3367040">return</span>&nbsp;<span class="ident" id="3367047">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3367055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3367058">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3367061">return</span>&nbsp;<span class="ident" id="3367068">true</span><br>
<span class="lineno"></span><span class="op" id="3367073">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3367076">//&nbsp;Mask&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;masking&nbsp;the&nbsp;IP&nbsp;address&nbsp;ip&nbsp;with&nbsp;mask.</span><br>
<span class="lineno"></span><span class="keyword" id="3367143">func</span>&nbsp;<span class="op" id="3367148">(</span><span class="ident" id="3367149">ip</span>&nbsp;<span class="ident" id="3367152">IP</span><span class="op" id="3367154">)</span>&nbsp;<span class="ident" id="3367156">Mask</span><span class="op" id="3367160">(</span><span class="ident" id="3367161">mask</span>&nbsp;<span class="ident" id="3367166">IPMask</span><span class="op" id="3367172">)</span>&nbsp;<span class="ident" id="3367174">IP</span>&nbsp;<span class="op" id="3367177">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3367180">if</span>&nbsp;<span class="builtinfunc" id="3367183">len</span><span class="op" id="3367186">(</span><span class="ident" id="3367187">mask</span><span class="op" id="3367191">)</span>&nbsp;<span class="op" id="3367193">==</span>&nbsp;<span class="ident" id="3367196">IPv6len</span>&nbsp;<span class="op" id="3367204">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3367207">len</span><span class="op" id="3367210">(</span><span class="ident" id="3367211">ip</span><span class="op" id="3367213">)</span>&nbsp;<span class="op" id="3367215">==</span>&nbsp;<span class="ident" id="3367218">IPv4len</span>&nbsp;<span class="op" id="3367226">&amp;&amp;</span>&nbsp;<span class="ident" id="3367229">allFF</span><span class="op" id="3367234">(</span><span class="ident" id="3367235">mask</span><span class="op" id="3367239">[</span><span class="op" id="3367240">:</span><span class="num" id="3367241">12</span><span class="op" id="3367243">]</span><span class="op" id="3367244">)</span>&nbsp;<span class="op" id="3367246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3367250">mask</span>&nbsp;<span class="op" id="3367255">=</span>&nbsp;<span class="ident" id="3367257">mask</span><span class="op" id="3367261">[</span><span class="num" id="3367262">12</span><span class="op" id="3367264">:</span><span class="op" id="3367265">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3367268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3367271">if</span>&nbsp;<span class="builtinfunc" id="3367274">len</span><span class="op" id="3367277">(</span><span class="ident" id="3367278">mask</span><span class="op" id="3367282">)</span>&nbsp;<span class="op" id="3367284">==</span>&nbsp;<span class="ident" id="3367287">IPv4len</span>&nbsp;<span class="op" id="3367295">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3367298">len</span><span class="op" id="3367301">(</span><span class="ident" id="3367302">ip</span><span class="op" id="3367304">)</span>&nbsp;<span class="op" id="3367306">==</span>&nbsp;<span class="ident" id="3367309">IPv6len</span>&nbsp;<span class="op" id="3367317">&amp;&amp;</span>&nbsp;<span class="ident" id="3367320">bytesEqual</span><span class="op" id="3367330">(</span><span class="ident" id="3367331">ip</span><span class="op" id="3367333">[</span><span class="op" id="3367334">:</span><span class="num" id="3367335">12</span><span class="op" id="3367337">]</span><span class="op" id="3367338">,</span>&nbsp;<span class="ident" id="3367340">v4InV6Prefix</span><span class="op" id="3367352">)</span>&nbsp;<span class="op" id="3367354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3367358">ip</span>&nbsp;<span class="op" id="3367361">=</span>&nbsp;<span class="ident" id="3367363">ip</span><span class="op" id="3367365">[</span><span class="num" id="3367366">12</span><span class="op" id="3367368">:</span><span class="op" id="3367369">]</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3367372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3367375">n</span>&nbsp;<span class="op" id="3367377">:=</span>&nbsp;<span class="builtinfunc" id="3367380">len</span><span class="op" id="3367383">(</span><span class="ident" id="3367384">ip</span><span class="op" id="3367386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3367389">if</span>&nbsp;<span class="ident" id="3367392">n</span>&nbsp;<span class="op" id="3367394">!=</span>&nbsp;<span class="builtinfunc" id="3367397">len</span><span class="op" id="3367400">(</span><span class="ident" id="3367401">mask</span><span class="op" id="3367405">)</span>&nbsp;<span class="op" id="3367407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3367411">return</span>&nbsp;<span class="ident" id="3367418">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3367423">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3367426">out</span>&nbsp;<span class="op" id="3367430">:=</span>&nbsp;<span class="builtinfunc" id="3367433">make</span><span class="op" id="3367437">(</span><span class="ident" id="3367438">IP</span><span class="op" id="3367440">,</span>&nbsp;<span class="ident" id="3367442">n</span><span class="op" id="3367443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3367446">for</span>&nbsp;<span class="ident" id="3367450">i</span>&nbsp;<span class="op" id="3367452">:=</span>&nbsp;<span class="num" id="3367455">0</span><span class="op" id="3367456">;</span>&nbsp;<span class="ident" id="3367458">i</span>&nbsp;<span class="op" id="3367460">&lt;</span>&nbsp;<span class="ident" id="3367462">n</span><span class="op" id="3367463">;</span>&nbsp;<span class="ident" id="3367465">i</span><span class="op" id="3367466">++</span>&nbsp;<span class="op" id="3367469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3367473">out</span><span class="op" id="3367476">[</span><span class="ident" id="3367477">i</span><span class="op" id="3367478">]</span>&nbsp;<span class="op" id="3367480">=</span>&nbsp;<span class="ident" id="3367482">ip</span><span class="op" id="3367484">[</span><span class="ident" id="3367485">i</span><span class="op" id="3367486">]</span>&nbsp;<span class="op" id="3367488">&amp;</span>&nbsp;<span class="ident" id="3367490">mask</span><span class="op" id="3367494">[</span><span class="ident" id="3367495">i</span><span class="op" id="3367496">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3367499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3367502">return</span>&nbsp;<span class="ident" id="3367509">out</span><br>
<span class="lineno">255</span><span class="op" id="3367513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3367516">//&nbsp;String&nbsp;returns&nbsp;the&nbsp;string&nbsp;form&nbsp;of&nbsp;the&nbsp;IP&nbsp;address&nbsp;ip.</span><br>
<span class="lineno"></span><span class="comment" id="3367572">//&nbsp;If&nbsp;the&nbsp;address&nbsp;is&nbsp;an&nbsp;IPv4&nbsp;address,&nbsp;the&nbsp;string&nbsp;representation</span><br>
<span class="lineno"></span><span class="comment" id="3367636">//&nbsp;is&nbsp;dotted&nbsp;decimal&nbsp;(&#34;74.125.19.99&#34;).&nbsp;&nbsp;Otherwise&nbsp;the&nbsp;representation</span><br>
<span class="lineno">260</span><span class="comment" id="3367705">//&nbsp;is&nbsp;IPv6&nbsp;(&#34;2001:4860:0:2001::68&#34;).</span><br>
<span class="lineno"></span><span class="keyword" id="3367742">func</span>&nbsp;<span class="op" id="3367747">(</span><span class="ident" id="3367748">ip</span>&nbsp;<span class="ident" id="3367751">IP</span><span class="op" id="3367753">)</span>&nbsp;<span class="ident" id="3367755">String</span><span class="op" id="3367761">(</span><span class="op" id="3367762">)</span>&nbsp;<span class="builtintype" id="3367764">string</span>&nbsp;<span class="op" id="3367771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3367774">p</span>&nbsp;<span class="op" id="3367776">:=</span>&nbsp;<span class="ident" id="3367779">ip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3367784">if</span>&nbsp;<span class="builtinfunc" id="3367787">len</span><span class="op" id="3367790">(</span><span class="ident" id="3367791">ip</span><span class="op" id="3367793">)</span>&nbsp;<span class="op" id="3367795">==</span>&nbsp;<span class="num" id="3367798">0</span>&nbsp;<span class="op" id="3367800">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3367804">return</span>&nbsp;<span class="string" id="3367811">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3367820">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3367824">//&nbsp;If&nbsp;IPv4,&nbsp;use&nbsp;dotted&nbsp;notation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3367858">if</span>&nbsp;<span class="ident" id="3367861">p4</span>&nbsp;<span class="op" id="3367864">:=</span>&nbsp;<span class="ident" id="3367867">p</span><span class="op" id="3367868">.</span><span class="ident" id="3367869">To4</span><span class="op" id="3367872">(</span><span class="op" id="3367873">)</span><span class="op" id="3367874">;</span>&nbsp;<span class="builtinfunc" id="3367876">len</span><span class="op" id="3367879">(</span><span class="ident" id="3367880">p4</span><span class="op" id="3367882">)</span>&nbsp;<span class="op" id="3367884">==</span>&nbsp;<span class="ident" id="3367887">IPv4len</span>&nbsp;<span class="op" id="3367895">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3367899">return</span>&nbsp;<span class="ident" id="3367906">itod</span><span class="op" id="3367910">(</span><span class="builtintype" id="3367911">uint</span><span class="op" id="3367915">(</span><span class="ident" id="3367916">p4</span><span class="op" id="3367918">[</span><span class="num" id="3367919">0</span><span class="op" id="3367920">]</span><span class="op" id="3367921">)</span><span class="op" id="3367922">)</span>&nbsp;<span class="op" id="3367924">+</span>&nbsp;<span class="string" id="3367926">&#34;.&#34;</span>&nbsp;<span class="op" id="3367930">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3367935">itod</span><span class="op" id="3367939">(</span><span class="builtintype" id="3367940">uint</span><span class="op" id="3367944">(</span><span class="ident" id="3367945">p4</span><span class="op" id="3367947">[</span><span class="num" id="3367948">1</span><span class="op" id="3367949">]</span><span class="op" id="3367950">)</span><span class="op" id="3367951">)</span>&nbsp;<span class="op" id="3367953">+</span>&nbsp;<span class="string" id="3367955">&#34;.&#34;</span>&nbsp;<span class="op" id="3367959">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3367964">itod</span><span class="op" id="3367968">(</span><span class="builtintype" id="3367969">uint</span><span class="op" id="3367973">(</span><span class="ident" id="3367974">p4</span><span class="op" id="3367976">[</span><span class="num" id="3367977">2</span><span class="op" id="3367978">]</span><span class="op" id="3367979">)</span><span class="op" id="3367980">)</span>&nbsp;<span class="op" id="3367982">+</span>&nbsp;<span class="string" id="3367984">&#34;.&#34;</span>&nbsp;<span class="op" id="3367988">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3367993">itod</span><span class="op" id="3367997">(</span><span class="builtintype" id="3367998">uint</span><span class="op" id="3368002">(</span><span class="ident" id="3368003">p4</span><span class="op" id="3368005">[</span><span class="num" id="3368006">3</span><span class="op" id="3368007">]</span><span class="op" id="3368008">)</span><span class="op" id="3368009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3368012">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368015">if</span>&nbsp;<span class="builtinfunc" id="3368018">len</span><span class="op" id="3368021">(</span><span class="ident" id="3368022">p</span><span class="op" id="3368023">)</span>&nbsp;<span class="op" id="3368025">!=</span>&nbsp;<span class="ident" id="3368028">IPv6len</span>&nbsp;<span class="op" id="3368036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368040">return</span>&nbsp;<span class="string" id="3368047">&#34;?&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3368052">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3368056">//&nbsp;Find&nbsp;longest&nbsp;run&nbsp;of&nbsp;zeros.</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3368087">e0</span>&nbsp;<span class="op" id="3368090">:=</span>&nbsp;<span class="op" id="3368093">-</span><span class="num" id="3368094">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3368097">e1</span>&nbsp;<span class="op" id="3368100">:=</span>&nbsp;<span class="op" id="3368103">-</span><span class="num" id="3368104">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368107">for</span>&nbsp;<span class="ident" id="3368111">i</span>&nbsp;<span class="op" id="3368113">:=</span>&nbsp;<span class="num" id="3368116">0</span><span class="op" id="3368117">;</span>&nbsp;<span class="ident" id="3368119">i</span>&nbsp;<span class="op" id="3368121">&lt;</span>&nbsp;<span class="ident" id="3368123">IPv6len</span><span class="op" id="3368130">;</span>&nbsp;<span class="ident" id="3368132">i</span>&nbsp;<span class="op" id="3368134">+=</span>&nbsp;<span class="num" id="3368137">2</span>&nbsp;<span class="op" id="3368139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3368143">j</span>&nbsp;<span class="op" id="3368145">:=</span>&nbsp;<span class="ident" id="3368148">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368152">for</span>&nbsp;<span class="ident" id="3368156">j</span>&nbsp;<span class="op" id="3368158">&lt;</span>&nbsp;<span class="ident" id="3368160">IPv6len</span>&nbsp;<span class="op" id="3368168">&amp;&amp;</span>&nbsp;<span class="ident" id="3368171">p</span><span class="op" id="3368172">[</span><span class="ident" id="3368173">j</span><span class="op" id="3368174">]</span>&nbsp;<span class="op" id="3368176">==</span>&nbsp;<span class="num" id="3368179">0</span>&nbsp;<span class="op" id="3368181">&amp;&amp;</span>&nbsp;<span class="ident" id="3368184">p</span><span class="op" id="3368185">[</span><span class="ident" id="3368186">j</span><span class="op" id="3368187">+</span><span class="num" id="3368188">1</span><span class="op" id="3368189">]</span>&nbsp;<span class="op" id="3368191">==</span>&nbsp;<span class="num" id="3368194">0</span>&nbsp;<span class="op" id="3368196">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3368201">j</span>&nbsp;<span class="op" id="3368203">+=</span>&nbsp;<span class="num" id="3368206">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3368210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368214">if</span>&nbsp;<span class="ident" id="3368217">j</span>&nbsp;<span class="op" id="3368219">&gt;</span>&nbsp;<span class="ident" id="3368221">i</span>&nbsp;<span class="op" id="3368223">&amp;&amp;</span>&nbsp;<span class="ident" id="3368226">j</span><span class="op" id="3368227">-</span><span class="ident" id="3368228">i</span>&nbsp;<span class="op" id="3368230">&gt;</span>&nbsp;<span class="ident" id="3368232">e1</span><span class="op" id="3368234">-</span><span class="ident" id="3368235">e0</span>&nbsp;<span class="op" id="3368238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3368243">e0</span>&nbsp;<span class="op" id="3368246">=</span>&nbsp;<span class="ident" id="3368248">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3368253">e1</span>&nbsp;<span class="op" id="3368256">=</span>&nbsp;<span class="ident" id="3368258">j</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3368263">i</span>&nbsp;<span class="op" id="3368265">=</span>&nbsp;<span class="ident" id="3368267">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3368271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3368274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3368277">//&nbsp;The&nbsp;symbol&nbsp;&#34;::&#34;&nbsp;MUST&nbsp;NOT&nbsp;be&nbsp;used&nbsp;to&nbsp;shorten&nbsp;just&nbsp;one&nbsp;16&nbsp;bit&nbsp;0&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368350">if</span>&nbsp;<span class="ident" id="3368353">e1</span><span class="op" id="3368355">-</span><span class="ident" id="3368356">e0</span>&nbsp;<span class="op" id="3368359">&lt;=</span>&nbsp;<span class="num" id="3368362">2</span>&nbsp;<span class="op" id="3368364">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3368368">e0</span>&nbsp;<span class="op" id="3368371">=</span>&nbsp;<span class="op" id="3368373">-</span><span class="num" id="3368374">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3368378">e1</span>&nbsp;<span class="op" id="3368381">=</span>&nbsp;<span class="op" id="3368383">-</span><span class="num" id="3368384">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3368387">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368391">const</span>&nbsp;<span class="ident" id="3368397">maxLen</span>&nbsp;<span class="op" id="3368404">=</span>&nbsp;<span class="builtinfunc" id="3368406">len</span><span class="op" id="3368409">(</span><span class="string" id="3368410">&#34;ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff&#34;</span><span class="op" id="3368451">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3368454">b</span>&nbsp;<span class="op" id="3368456">:=</span>&nbsp;<span class="builtinfunc" id="3368459">make</span><span class="op" id="3368463">(</span><span class="op" id="3368464">[</span><span class="op" id="3368465">]</span><span class="builtintype" id="3368466">byte</span><span class="op" id="3368470">,</span>&nbsp;<span class="num" id="3368472">0</span><span class="op" id="3368473">,</span>&nbsp;<span class="ident" id="3368475">maxLen</span><span class="op" id="3368481">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3368485">//&nbsp;Print&nbsp;with&nbsp;possible&nbsp;::&nbsp;in&nbsp;place&nbsp;of&nbsp;run&nbsp;of&nbsp;zeros</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368537">for</span>&nbsp;<span class="ident" id="3368541">i</span>&nbsp;<span class="op" id="3368543">:=</span>&nbsp;<span class="num" id="3368546">0</span><span class="op" id="3368547">;</span>&nbsp;<span class="ident" id="3368549">i</span>&nbsp;<span class="op" id="3368551">&lt;</span>&nbsp;<span class="ident" id="3368553">IPv6len</span><span class="op" id="3368560">;</span>&nbsp;<span class="ident" id="3368562">i</span>&nbsp;<span class="op" id="3368564">+=</span>&nbsp;<span class="num" id="3368567">2</span>&nbsp;<span class="op" id="3368569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368573">if</span>&nbsp;<span class="ident" id="3368576">i</span>&nbsp;<span class="op" id="3368578">==</span>&nbsp;<span class="ident" id="3368581">e0</span>&nbsp;<span class="op" id="3368584">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3368589">b</span>&nbsp;<span class="op" id="3368591">=</span>&nbsp;<span class="builtinfunc" id="3368593">append</span><span class="op" id="3368599">(</span><span class="ident" id="3368600">b</span><span class="op" id="3368601">,</span>&nbsp;<span class="string" id="3368603">&#39;:&#39;</span><span class="op" id="3368606">,</span>&nbsp;<span class="string" id="3368608">&#39;:&#39;</span><span class="op" id="3368611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3368616">i</span>&nbsp;<span class="op" id="3368618">=</span>&nbsp;<span class="ident" id="3368620">e1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368626">if</span>&nbsp;<span class="ident" id="3368629">i</span>&nbsp;<span class="op" id="3368631">&gt;=</span>&nbsp;<span class="ident" id="3368634">IPv6len</span>&nbsp;<span class="op" id="3368642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368648">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3368657">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3368661">}</span>&nbsp;<span class="keyword" id="3368663">else</span>&nbsp;<span class="keyword" id="3368668">if</span>&nbsp;<span class="ident" id="3368671">i</span>&nbsp;<span class="op" id="3368673">&gt;</span>&nbsp;<span class="num" id="3368675">0</span>&nbsp;<span class="op" id="3368677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3368682">b</span>&nbsp;<span class="op" id="3368684">=</span>&nbsp;<span class="builtinfunc" id="3368686">append</span><span class="op" id="3368692">(</span><span class="ident" id="3368693">b</span><span class="op" id="3368694">,</span>&nbsp;<span class="string" id="3368696">&#39;:&#39;</span><span class="op" id="3368699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3368703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3368707">b</span>&nbsp;<span class="op" id="3368709">=</span>&nbsp;<span class="ident" id="3368711">appendHex</span><span class="op" id="3368720">(</span><span class="ident" id="3368721">b</span><span class="op" id="3368722">,</span>&nbsp;<span class="op" id="3368724">(</span><span class="builtintype" id="3368725">uint32</span><span class="op" id="3368731">(</span><span class="ident" id="3368732">p</span><span class="op" id="3368733">[</span><span class="ident" id="3368734">i</span><span class="op" id="3368735">]</span><span class="op" id="3368736">)</span><span class="op" id="3368737">&lt;&lt;</span><span class="num" id="3368739">8</span><span class="op" id="3368740">)</span><span class="op" id="3368741">|</span><span class="builtintype" id="3368742">uint32</span><span class="op" id="3368748">(</span><span class="ident" id="3368749">p</span><span class="op" id="3368750">[</span><span class="ident" id="3368751">i</span><span class="op" id="3368752">+</span><span class="num" id="3368753">1</span><span class="op" id="3368754">]</span><span class="op" id="3368755">)</span><span class="op" id="3368756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3368759">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368762">return</span>&nbsp;<span class="builtintype" id="3368769">string</span><span class="op" id="3368775">(</span><span class="ident" id="3368776">b</span><span class="op" id="3368777">)</span><br>
<span class="lineno"></span><span class="op" id="3368779">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3368782">//&nbsp;ipEmptyString&nbsp;is&nbsp;like&nbsp;ip.String&nbsp;except&nbsp;that&nbsp;it&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3368840">//&nbsp;an&nbsp;empty&nbsp;string&nbsp;when&nbsp;ip&nbsp;is&nbsp;unset.</span><br>
<span class="lineno">320</span><span class="keyword" id="3368877">func</span>&nbsp;<span class="ident" id="3368882">ipEmptyString</span><span class="op" id="3368895">(</span><span class="ident" id="3368896">ip</span>&nbsp;<span class="ident" id="3368899">IP</span><span class="op" id="3368901">)</span>&nbsp;<span class="builtintype" id="3368903">string</span>&nbsp;<span class="op" id="3368910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368913">if</span>&nbsp;<span class="builtinfunc" id="3368916">len</span><span class="op" id="3368919">(</span><span class="ident" id="3368920">ip</span><span class="op" id="3368922">)</span>&nbsp;<span class="op" id="3368924">==</span>&nbsp;<span class="num" id="3368927">0</span>&nbsp;<span class="op" id="3368929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368933">return</span>&nbsp;<span class="string" id="3368940">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3368944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368947">return</span>&nbsp;<span class="ident" id="3368954">ip</span><span class="op" id="3368956">.</span><span class="ident" id="3368957">String</span><span class="op" id="3368963">(</span><span class="op" id="3368964">)</span><br>
<span class="lineno">325</span><span class="op" id="3368966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3368969">//&nbsp;MarshalText&nbsp;implements&nbsp;the&nbsp;encoding.TextMarshaler&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="3369033">//&nbsp;The&nbsp;encoding&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;returned&nbsp;by&nbsp;String.</span><br>
<span class="lineno"></span><span class="keyword" id="3369084">func</span>&nbsp;<span class="op" id="3369089">(</span><span class="ident" id="3369090">ip</span>&nbsp;<span class="ident" id="3369093">IP</span><span class="op" id="3369095">)</span>&nbsp;<span class="ident" id="3369097">MarshalText</span><span class="op" id="3369108">(</span><span class="op" id="3369109">)</span>&nbsp;<span class="op" id="3369111">(</span><span class="op" id="3369112">[</span><span class="op" id="3369113">]</span><span class="builtintype" id="3369114">byte</span><span class="op" id="3369118">,</span>&nbsp;<span class="builtintype" id="3369120">error</span><span class="op" id="3369125">)</span>&nbsp;<span class="op" id="3369127">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369130">if</span>&nbsp;<span class="builtinfunc" id="3369133">len</span><span class="op" id="3369136">(</span><span class="ident" id="3369137">ip</span><span class="op" id="3369139">)</span>&nbsp;<span class="op" id="3369141">==</span>&nbsp;<span class="num" id="3369144">0</span>&nbsp;<span class="op" id="3369146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369150">return</span>&nbsp;<span class="op" id="3369157">[</span><span class="op" id="3369158">]</span><span class="builtintype" id="3369159">byte</span><span class="op" id="3369163">(</span><span class="string" id="3369164">&#34;&#34;</span><span class="op" id="3369166">)</span><span class="op" id="3369167">,</span>&nbsp;<span class="ident" id="3369169">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3369174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369177">if</span>&nbsp;<span class="builtinfunc" id="3369180">len</span><span class="op" id="3369183">(</span><span class="ident" id="3369184">ip</span><span class="op" id="3369186">)</span>&nbsp;<span class="op" id="3369188">!=</span>&nbsp;<span class="ident" id="3369191">IPv4len</span>&nbsp;<span class="op" id="3369199">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3369202">len</span><span class="op" id="3369205">(</span><span class="ident" id="3369206">ip</span><span class="op" id="3369208">)</span>&nbsp;<span class="op" id="3369210">!=</span>&nbsp;<span class="ident" id="3369213">IPv6len</span>&nbsp;<span class="op" id="3369221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369225">return</span>&nbsp;<span class="ident" id="3369232">nil</span><span class="op" id="3369235">,</span>&nbsp;<span class="ident" id="3369237">errors</span><span class="op" id="3369243">.</span><span class="ident" id="3369244">New</span><span class="op" id="3369247">(</span><span class="string" id="3369248">&#34;invalid&nbsp;IP&nbsp;address&#34;</span><span class="op" id="3369268">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3369271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369274">return</span>&nbsp;<span class="op" id="3369281">[</span><span class="op" id="3369282">]</span><span class="builtintype" id="3369283">byte</span><span class="op" id="3369287">(</span><span class="ident" id="3369288">ip</span><span class="op" id="3369290">.</span><span class="ident" id="3369291">String</span><span class="op" id="3369297">(</span><span class="op" id="3369298">)</span><span class="op" id="3369299">)</span><span class="op" id="3369300">,</span>&nbsp;<span class="ident" id="3369302">nil</span><br>
<span class="lineno"></span><span class="op" id="3369306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3369309">//&nbsp;UnmarshalText&nbsp;implements&nbsp;the&nbsp;encoding.TextUnmarshaler&nbsp;interface.</span><br>
<span class="lineno">340</span><span class="comment" id="3369377">//&nbsp;The&nbsp;IP&nbsp;address&nbsp;is&nbsp;expected&nbsp;in&nbsp;a&nbsp;form&nbsp;accepted&nbsp;by&nbsp;ParseIP.</span><br>
<span class="lineno"></span><span class="keyword" id="3369438">func</span>&nbsp;<span class="op" id="3369443">(</span><span class="ident" id="3369444">ip</span>&nbsp;<span class="op" id="3369447">*</span><span class="ident" id="3369448">IP</span><span class="op" id="3369450">)</span>&nbsp;<span class="ident" id="3369452">UnmarshalText</span><span class="op" id="3369465">(</span><span class="ident" id="3369466">text</span>&nbsp;<span class="op" id="3369471">[</span><span class="op" id="3369472">]</span><span class="builtintype" id="3369473">byte</span><span class="op" id="3369477">)</span>&nbsp;<span class="builtintype" id="3369479">error</span>&nbsp;<span class="op" id="3369485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369488">if</span>&nbsp;<span class="builtinfunc" id="3369491">len</span><span class="op" id="3369494">(</span><span class="ident" id="3369495">text</span><span class="op" id="3369499">)</span>&nbsp;<span class="op" id="3369501">==</span>&nbsp;<span class="num" id="3369504">0</span>&nbsp;<span class="op" id="3369506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3369510">*</span><span class="ident" id="3369511">ip</span>&nbsp;<span class="op" id="3369514">=</span>&nbsp;<span class="ident" id="3369516">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369522">return</span>&nbsp;<span class="ident" id="3369529">nil</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3369534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3369537">s</span>&nbsp;<span class="op" id="3369539">:=</span>&nbsp;<span class="builtintype" id="3369542">string</span><span class="op" id="3369548">(</span><span class="ident" id="3369549">text</span><span class="op" id="3369553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3369556">x</span>&nbsp;<span class="op" id="3369558">:=</span>&nbsp;<span class="ident" id="3369561">ParseIP</span><span class="op" id="3369568">(</span><span class="ident" id="3369569">s</span><span class="op" id="3369570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369573">if</span>&nbsp;<span class="ident" id="3369576">x</span>&nbsp;<span class="op" id="3369578">==</span>&nbsp;<span class="ident" id="3369581">nil</span>&nbsp;<span class="op" id="3369585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369589">return</span>&nbsp;<span class="op" id="3369596">&amp;</span><span class="ident" id="3369597">ParseError</span><span class="op" id="3369607">{</span><span class="string" id="3369608">&#34;IP&nbsp;address&#34;</span><span class="op" id="3369620">,</span>&nbsp;<span class="ident" id="3369622">s</span><span class="op" id="3369623">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3369626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3369629">*</span><span class="ident" id="3369630">ip</span>&nbsp;<span class="op" id="3369633">=</span>&nbsp;<span class="ident" id="3369635">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369638">return</span>&nbsp;<span class="ident" id="3369645">nil</span><br>
<span class="lineno"></span><span class="op" id="3369649">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="3369652">//&nbsp;Equal&nbsp;returns&nbsp;true&nbsp;if&nbsp;ip&nbsp;and&nbsp;x&nbsp;are&nbsp;the&nbsp;same&nbsp;IP&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="3369711">//&nbsp;An&nbsp;IPv4&nbsp;address&nbsp;and&nbsp;that&nbsp;same&nbsp;address&nbsp;in&nbsp;IPv6&nbsp;form&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="3369769">//&nbsp;considered&nbsp;to&nbsp;be&nbsp;equal.</span><br>
<span class="lineno"></span><span class="keyword" id="3369796">func</span>&nbsp;<span class="op" id="3369801">(</span><span class="ident" id="3369802">ip</span>&nbsp;<span class="ident" id="3369805">IP</span><span class="op" id="3369807">)</span>&nbsp;<span class="ident" id="3369809">Equal</span><span class="op" id="3369814">(</span><span class="ident" id="3369815">x</span>&nbsp;<span class="ident" id="3369817">IP</span><span class="op" id="3369819">)</span>&nbsp;<span class="builtintype" id="3369821">bool</span>&nbsp;<span class="op" id="3369826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369829">if</span>&nbsp;<span class="builtinfunc" id="3369832">len</span><span class="op" id="3369835">(</span><span class="ident" id="3369836">ip</span><span class="op" id="3369838">)</span>&nbsp;<span class="op" id="3369840">==</span>&nbsp;<span class="builtinfunc" id="3369843">len</span><span class="op" id="3369846">(</span><span class="ident" id="3369847">x</span><span class="op" id="3369848">)</span>&nbsp;<span class="op" id="3369850">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369854">return</span>&nbsp;<span class="ident" id="3369861">bytesEqual</span><span class="op" id="3369871">(</span><span class="ident" id="3369872">ip</span><span class="op" id="3369874">,</span>&nbsp;<span class="ident" id="3369876">x</span><span class="op" id="3369877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3369880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369883">if</span>&nbsp;<span class="builtinfunc" id="3369886">len</span><span class="op" id="3369889">(</span><span class="ident" id="3369890">ip</span><span class="op" id="3369892">)</span>&nbsp;<span class="op" id="3369894">==</span>&nbsp;<span class="ident" id="3369897">IPv4len</span>&nbsp;<span class="op" id="3369905">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3369908">len</span><span class="op" id="3369911">(</span><span class="ident" id="3369912">x</span><span class="op" id="3369913">)</span>&nbsp;<span class="op" id="3369915">==</span>&nbsp;<span class="ident" id="3369918">IPv6len</span>&nbsp;<span class="op" id="3369926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369930">return</span>&nbsp;<span class="ident" id="3369937">bytesEqual</span><span class="op" id="3369947">(</span><span class="ident" id="3369948">x</span><span class="op" id="3369949">[</span><span class="num" id="3369950">0</span><span class="op" id="3369951">:</span><span class="num" id="3369952">12</span><span class="op" id="3369954">]</span><span class="op" id="3369955">,</span>&nbsp;<span class="ident" id="3369957">v4InV6Prefix</span><span class="op" id="3369969">)</span>&nbsp;<span class="op" id="3369971">&amp;&amp;</span>&nbsp;<span class="ident" id="3369974">bytesEqual</span><span class="op" id="3369984">(</span><span class="ident" id="3369985">ip</span><span class="op" id="3369987">,</span>&nbsp;<span class="ident" id="3369989">x</span><span class="op" id="3369990">[</span><span class="num" id="3369991">12</span><span class="op" id="3369993">:</span><span class="op" id="3369994">]</span><span class="op" id="3369995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3369998">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3370001">if</span>&nbsp;<span class="builtinfunc" id="3370004">len</span><span class="op" id="3370007">(</span><span class="ident" id="3370008">ip</span><span class="op" id="3370010">)</span>&nbsp;<span class="op" id="3370012">==</span>&nbsp;<span class="ident" id="3370015">IPv6len</span>&nbsp;<span class="op" id="3370023">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3370026">len</span><span class="op" id="3370029">(</span><span class="ident" id="3370030">x</span><span class="op" id="3370031">)</span>&nbsp;<span class="op" id="3370033">==</span>&nbsp;<span class="ident" id="3370036">IPv4len</span>&nbsp;<span class="op" id="3370044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3370048">return</span>&nbsp;<span class="ident" id="3370055">bytesEqual</span><span class="op" id="3370065">(</span><span class="ident" id="3370066">ip</span><span class="op" id="3370068">[</span><span class="num" id="3370069">0</span><span class="op" id="3370070">:</span><span class="num" id="3370071">12</span><span class="op" id="3370073">]</span><span class="op" id="3370074">,</span>&nbsp;<span class="ident" id="3370076">v4InV6Prefix</span><span class="op" id="3370088">)</span>&nbsp;<span class="op" id="3370090">&amp;&amp;</span>&nbsp;<span class="ident" id="3370093">bytesEqual</span><span class="op" id="3370103">(</span><span class="ident" id="3370104">ip</span><span class="op" id="3370106">[</span><span class="num" id="3370107">12</span><span class="op" id="3370109">:</span><span class="op" id="3370110">]</span><span class="op" id="3370111">,</span>&nbsp;<span class="ident" id="3370113">x</span><span class="op" id="3370114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3370117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3370120">return</span>&nbsp;<span class="ident" id="3370127">false</span><br>
<span class="lineno"></span><span class="op" id="3370133">}</span><br>
<span class="lineno">370</span><br>
<span class="lineno"></span><span class="keyword" id="3370136">func</span>&nbsp;<span class="ident" id="3370141">bytesEqual</span><span class="op" id="3370151">(</span><span class="ident" id="3370152">x</span><span class="op" id="3370153">,</span>&nbsp;<span class="ident" id="3370155">y</span>&nbsp;<span class="op" id="3370157">[</span><span class="op" id="3370158">]</span><span class="builtintype" id="3370159">byte</span><span class="op" id="3370163">)</span>&nbsp;<span class="builtintype" id="3370165">bool</span>&nbsp;<span class="op" id="3370170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3370173">if</span>&nbsp;<span class="builtinfunc" id="3370176">len</span><span class="op" id="3370179">(</span><span class="ident" id="3370180">x</span><span class="op" id="3370181">)</span>&nbsp;<span class="op" id="3370183">!=</span>&nbsp;<span class="builtinfunc" id="3370186">len</span><span class="op" id="3370189">(</span><span class="ident" id="3370190">y</span><span class="op" id="3370191">)</span>&nbsp;<span class="op" id="3370193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3370197">return</span>&nbsp;<span class="ident" id="3370204">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3370211">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3370214">for</span>&nbsp;<span class="ident" id="3370218">i</span><span class="op" id="3370219">,</span>&nbsp;<span class="ident" id="3370221">b</span>&nbsp;<span class="op" id="3370223">:=</span>&nbsp;<span class="keyword" id="3370226">range</span>&nbsp;<span class="ident" id="3370232">x</span>&nbsp;<span class="op" id="3370234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3370238">if</span>&nbsp;<span class="ident" id="3370241">y</span><span class="op" id="3370242">[</span><span class="ident" id="3370243">i</span><span class="op" id="3370244">]</span>&nbsp;<span class="op" id="3370246">!=</span>&nbsp;<span class="ident" id="3370249">b</span>&nbsp;<span class="op" id="3370251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3370256">return</span>&nbsp;<span class="ident" id="3370263">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3370271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3370274">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3370277">return</span>&nbsp;<span class="ident" id="3370284">true</span><br>
<span class="lineno"></span><span class="op" id="3370289">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3370292">//&nbsp;If&nbsp;mask&nbsp;is&nbsp;a&nbsp;sequence&nbsp;of&nbsp;1&nbsp;bits&nbsp;followed&nbsp;by&nbsp;0&nbsp;bits,</span><br>
<span class="lineno"></span><span class="comment" id="3370347">//&nbsp;return&nbsp;the&nbsp;number&nbsp;of&nbsp;1&nbsp;bits.</span><br>
<span class="lineno">385</span><span class="keyword" id="3370379">func</span>&nbsp;<span class="ident" id="3370384">simpleMaskLength</span><span class="op" id="3370400">(</span><span class="ident" id="3370401">mask</span>&nbsp;<span class="ident" id="3370406">IPMask</span><span class="op" id="3370412">)</span>&nbsp;<span class="builtintype" id="3370414">int</span>&nbsp;<span class="op" id="3370418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3370421">var</span>&nbsp;<span class="ident" id="3370425">n</span>&nbsp;<span class="builtintype" id="3370427">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3370432">for</span>&nbsp;<span class="ident" id="3370436">i</span><span class="op" id="3370437">,</span>&nbsp;<span class="ident" id="3370439">v</span>&nbsp;<span class="op" id="3370441">:=</span>&nbsp;<span class="keyword" id="3370444">range</span>&nbsp;<span class="ident" id="3370450">mask</span>&nbsp;<span class="op" id="3370455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3370459">if</span>&nbsp;<span class="ident" id="3370462">v</span>&nbsp;<span class="op" id="3370464">==</span>&nbsp;<span class="num" id="3370467">0xff</span>&nbsp;<span class="op" id="3370472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3370477">n</span>&nbsp;<span class="op" id="3370479">+=</span>&nbsp;<span class="num" id="3370482">8</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3370487">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3370498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3370502">//&nbsp;found&nbsp;non-ff&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3370525">//&nbsp;count&nbsp;1&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3370543">for</span>&nbsp;<span class="ident" id="3370547">v</span><span class="op" id="3370548">&amp;</span><span class="num" id="3370549">0x80</span>&nbsp;<span class="op" id="3370554">!=</span>&nbsp;<span class="num" id="3370557">0</span>&nbsp;<span class="op" id="3370559">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3370564">n</span><span class="op" id="3370565">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3370571">v</span>&nbsp;<span class="op" id="3370573">&lt;&lt;=</span>&nbsp;<span class="num" id="3370577">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3370581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3370585">//&nbsp;rest&nbsp;must&nbsp;be&nbsp;0&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3370610">if</span>&nbsp;<span class="ident" id="3370613">v</span>&nbsp;<span class="op" id="3370615">!=</span>&nbsp;<span class="num" id="3370618">0</span>&nbsp;<span class="op" id="3370620">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3370625">return</span>&nbsp;<span class="op" id="3370632">-</span><span class="num" id="3370633">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3370637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3370641">for</span>&nbsp;<span class="ident" id="3370645">i</span><span class="op" id="3370646">++</span><span class="op" id="3370648">;</span>&nbsp;<span class="ident" id="3370650">i</span>&nbsp;<span class="op" id="3370652">&lt;</span>&nbsp;<span class="builtinfunc" id="3370654">len</span><span class="op" id="3370657">(</span><span class="ident" id="3370658">mask</span><span class="op" id="3370662">)</span><span class="op" id="3370663">;</span>&nbsp;<span class="ident" id="3370665">i</span><span class="op" id="3370666">++</span>&nbsp;<span class="op" id="3370669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3370674">if</span>&nbsp;<span class="ident" id="3370677">mask</span><span class="op" id="3370681">[</span><span class="ident" id="3370682">i</span><span class="op" id="3370683">]</span>&nbsp;<span class="op" id="3370685">!=</span>&nbsp;<span class="num" id="3370688">0</span>&nbsp;<span class="op" id="3370690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3370696">return</span>&nbsp;<span class="op" id="3370703">-</span><span class="num" id="3370704">1</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3370709">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3370713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3370717">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3370724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3370727">return</span>&nbsp;<span class="ident" id="3370734">n</span><br>
<span class="lineno">410</span><span class="op" id="3370736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3370739">//&nbsp;Size&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;leading&nbsp;ones&nbsp;and&nbsp;total&nbsp;bits&nbsp;in&nbsp;the&nbsp;mask.</span><br>
<span class="lineno"></span><span class="comment" id="3370810">//&nbsp;If&nbsp;the&nbsp;mask&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;canonical&nbsp;form--ones&nbsp;followed&nbsp;by&nbsp;zeros--then</span><br>
<span class="lineno"></span><span class="comment" id="3370884">//&nbsp;Size&nbsp;returns&nbsp;0,&nbsp;0.</span><br>
<span class="lineno">415</span><span class="keyword" id="3370906">func</span>&nbsp;<span class="op" id="3370911">(</span><span class="ident" id="3370912">m</span>&nbsp;<span class="ident" id="3370914">IPMask</span><span class="op" id="3370920">)</span>&nbsp;<span class="ident" id="3370922">Size</span><span class="op" id="3370926">(</span><span class="op" id="3370927">)</span>&nbsp;<span class="op" id="3370929">(</span><span class="ident" id="3370930">ones</span><span class="op" id="3370934">,</span>&nbsp;<span class="ident" id="3370936">bits</span>&nbsp;<span class="builtintype" id="3370941">int</span><span class="op" id="3370944">)</span>&nbsp;<span class="op" id="3370946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3370949">ones</span><span class="op" id="3370953">,</span>&nbsp;<span class="ident" id="3370955">bits</span>&nbsp;<span class="op" id="3370960">=</span>&nbsp;<span class="ident" id="3370962">simpleMaskLength</span><span class="op" id="3370978">(</span><span class="ident" id="3370979">m</span><span class="op" id="3370980">)</span><span class="op" id="3370981">,</span>&nbsp;<span class="builtinfunc" id="3370983">len</span><span class="op" id="3370986">(</span><span class="ident" id="3370987">m</span><span class="op" id="3370988">)</span><span class="op" id="3370989">*</span><span class="num" id="3370990">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3370993">if</span>&nbsp;<span class="ident" id="3370996">ones</span>&nbsp;<span class="op" id="3371001">==</span>&nbsp;<span class="op" id="3371004">-</span><span class="num" id="3371005">1</span>&nbsp;<span class="op" id="3371007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371011">return</span>&nbsp;<span class="num" id="3371018">0</span><span class="op" id="3371019">,</span>&nbsp;<span class="num" id="3371021">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3371024">}</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371027">return</span><br>
<span class="lineno"></span><span class="op" id="3371034">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3371037">//&nbsp;String&nbsp;returns&nbsp;the&nbsp;hexadecimal&nbsp;form&nbsp;of&nbsp;m,&nbsp;with&nbsp;no&nbsp;punctuation.</span><br>
<span class="lineno"></span><span class="keyword" id="3371103">func</span>&nbsp;<span class="op" id="3371108">(</span><span class="ident" id="3371109">m</span>&nbsp;<span class="ident" id="3371111">IPMask</span><span class="op" id="3371117">)</span>&nbsp;<span class="ident" id="3371119">String</span><span class="op" id="3371125">(</span><span class="op" id="3371126">)</span>&nbsp;<span class="builtintype" id="3371128">string</span>&nbsp;<span class="op" id="3371135">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371138">if</span>&nbsp;<span class="builtinfunc" id="3371141">len</span><span class="op" id="3371144">(</span><span class="ident" id="3371145">m</span><span class="op" id="3371146">)</span>&nbsp;<span class="op" id="3371148">==</span>&nbsp;<span class="num" id="3371151">0</span>&nbsp;<span class="op" id="3371153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371157">return</span>&nbsp;<span class="string" id="3371164">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3371173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3371176">buf</span>&nbsp;<span class="op" id="3371180">:=</span>&nbsp;<span class="builtinfunc" id="3371183">make</span><span class="op" id="3371187">(</span><span class="op" id="3371188">[</span><span class="op" id="3371189">]</span><span class="builtintype" id="3371190">byte</span><span class="op" id="3371194">,</span>&nbsp;<span class="builtinfunc" id="3371196">len</span><span class="op" id="3371199">(</span><span class="ident" id="3371200">m</span><span class="op" id="3371201">)</span><span class="op" id="3371202">*</span><span class="num" id="3371203">2</span><span class="op" id="3371204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371207">for</span>&nbsp;<span class="ident" id="3371211">i</span><span class="op" id="3371212">,</span>&nbsp;<span class="ident" id="3371214">b</span>&nbsp;<span class="op" id="3371216">:=</span>&nbsp;<span class="keyword" id="3371219">range</span>&nbsp;<span class="ident" id="3371225">m</span>&nbsp;<span class="op" id="3371227">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3371231">buf</span><span class="op" id="3371234">[</span><span class="ident" id="3371235">i</span><span class="op" id="3371236">*</span><span class="num" id="3371237">2</span><span class="op" id="3371238">]</span><span class="op" id="3371239">,</span>&nbsp;<span class="ident" id="3371241">buf</span><span class="op" id="3371244">[</span><span class="ident" id="3371245">i</span><span class="op" id="3371246">*</span><span class="num" id="3371247">2</span><span class="op" id="3371248">+</span><span class="num" id="3371249">1</span><span class="op" id="3371250">]</span>&nbsp;<span class="op" id="3371252">=</span>&nbsp;<span class="ident" id="3371254">hexDigit</span><span class="op" id="3371262">[</span><span class="ident" id="3371263">b</span><span class="op" id="3371264">&gt;&gt;</span><span class="num" id="3371266">4</span><span class="op" id="3371267">]</span><span class="op" id="3371268">,</span>&nbsp;<span class="ident" id="3371270">hexDigit</span><span class="op" id="3371278">[</span><span class="ident" id="3371279">b</span><span class="op" id="3371280">&amp;</span><span class="num" id="3371281">0xf</span><span class="op" id="3371284">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3371287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371290">return</span>&nbsp;<span class="builtintype" id="3371297">string</span><span class="op" id="3371303">(</span><span class="ident" id="3371304">buf</span><span class="op" id="3371307">)</span><br>
<span class="lineno"></span><span class="op" id="3371309">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="keyword" id="3371312">func</span>&nbsp;<span class="ident" id="3371317">networkNumberAndMask</span><span class="op" id="3371337">(</span><span class="ident" id="3371338">n</span>&nbsp;<span class="op" id="3371340">*</span><span class="ident" id="3371341">IPNet</span><span class="op" id="3371346">)</span>&nbsp;<span class="op" id="3371348">(</span><span class="ident" id="3371349">ip</span>&nbsp;<span class="ident" id="3371352">IP</span><span class="op" id="3371354">,</span>&nbsp;<span class="ident" id="3371356">m</span>&nbsp;<span class="ident" id="3371358">IPMask</span><span class="op" id="3371364">)</span>&nbsp;<span class="op" id="3371366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371369">if</span>&nbsp;<span class="ident" id="3371372">ip</span>&nbsp;<span class="op" id="3371375">=</span>&nbsp;<span class="ident" id="3371377">n</span><span class="op" id="3371378">.</span><span class="ident" id="3371379">IP</span><span class="op" id="3371381">.</span><span class="ident" id="3371382">To4</span><span class="op" id="3371385">(</span><span class="op" id="3371386">)</span><span class="op" id="3371387">;</span>&nbsp;<span class="ident" id="3371389">ip</span>&nbsp;<span class="op" id="3371392">==</span>&nbsp;<span class="ident" id="3371395">nil</span>&nbsp;<span class="op" id="3371399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3371403">ip</span>&nbsp;<span class="op" id="3371406">=</span>&nbsp;<span class="ident" id="3371408">n</span><span class="op" id="3371409">.</span><span class="ident" id="3371410">IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371415">if</span>&nbsp;<span class="builtinfunc" id="3371418">len</span><span class="op" id="3371421">(</span><span class="ident" id="3371422">ip</span><span class="op" id="3371424">)</span>&nbsp;<span class="op" id="3371426">!=</span>&nbsp;<span class="ident" id="3371429">IPv6len</span>&nbsp;<span class="op" id="3371437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371442">return</span>&nbsp;<span class="ident" id="3371449">nil</span><span class="op" id="3371452">,</span>&nbsp;<span class="ident" id="3371454">nil</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3371460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3371463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3371466">m</span>&nbsp;<span class="op" id="3371468">=</span>&nbsp;<span class="ident" id="3371470">n</span><span class="op" id="3371471">.</span><span class="ident" id="3371472">Mask</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371478">switch</span>&nbsp;<span class="builtinfunc" id="3371485">len</span><span class="op" id="3371488">(</span><span class="ident" id="3371489">m</span><span class="op" id="3371490">)</span>&nbsp;<span class="op" id="3371492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371495">case</span>&nbsp;<span class="ident" id="3371500">IPv4len</span><span class="op" id="3371507">:</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371511">if</span>&nbsp;<span class="builtinfunc" id="3371514">len</span><span class="op" id="3371517">(</span><span class="ident" id="3371518">ip</span><span class="op" id="3371520">)</span>&nbsp;<span class="op" id="3371522">!=</span>&nbsp;<span class="ident" id="3371525">IPv4len</span>&nbsp;<span class="op" id="3371533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371538">return</span>&nbsp;<span class="ident" id="3371545">nil</span><span class="op" id="3371548">,</span>&nbsp;<span class="ident" id="3371550">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3371556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371559">case</span>&nbsp;<span class="ident" id="3371564">IPv6len</span><span class="op" id="3371571">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371575">if</span>&nbsp;<span class="builtinfunc" id="3371578">len</span><span class="op" id="3371581">(</span><span class="ident" id="3371582">ip</span><span class="op" id="3371584">)</span>&nbsp;<span class="op" id="3371586">==</span>&nbsp;<span class="ident" id="3371589">IPv4len</span>&nbsp;<span class="op" id="3371597">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3371602">m</span>&nbsp;<span class="op" id="3371604">=</span>&nbsp;<span class="ident" id="3371606">m</span><span class="op" id="3371607">[</span><span class="num" id="3371608">12</span><span class="op" id="3371610">:</span><span class="op" id="3371611">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3371615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371618">default</span><span class="op" id="3371625">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371629">return</span>&nbsp;<span class="ident" id="3371636">nil</span><span class="op" id="3371639">,</span>&nbsp;<span class="ident" id="3371641">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3371646">}</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371649">return</span><br>
<span class="lineno"></span><span class="op" id="3371656">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3371659">//&nbsp;Contains&nbsp;reports&nbsp;whether&nbsp;the&nbsp;network&nbsp;includes&nbsp;ip.</span><br>
<span class="lineno"></span><span class="keyword" id="3371712">func</span>&nbsp;<span class="op" id="3371717">(</span><span class="ident" id="3371718">n</span>&nbsp;<span class="op" id="3371720">*</span><span class="ident" id="3371721">IPNet</span><span class="op" id="3371726">)</span>&nbsp;<span class="ident" id="3371728">Contains</span><span class="op" id="3371736">(</span><span class="ident" id="3371737">ip</span>&nbsp;<span class="ident" id="3371740">IP</span><span class="op" id="3371742">)</span>&nbsp;<span class="builtintype" id="3371744">bool</span>&nbsp;<span class="op" id="3371749">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3371752">nn</span><span class="op" id="3371754">,</span>&nbsp;<span class="ident" id="3371756">m</span>&nbsp;<span class="op" id="3371758">:=</span>&nbsp;<span class="ident" id="3371761">networkNumberAndMask</span><span class="op" id="3371781">(</span><span class="ident" id="3371782">n</span><span class="op" id="3371783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371786">if</span>&nbsp;<span class="ident" id="3371789">x</span>&nbsp;<span class="op" id="3371791">:=</span>&nbsp;<span class="ident" id="3371794">ip</span><span class="op" id="3371796">.</span><span class="ident" id="3371797">To4</span><span class="op" id="3371800">(</span><span class="op" id="3371801">)</span><span class="op" id="3371802">;</span>&nbsp;<span class="ident" id="3371804">x</span>&nbsp;<span class="op" id="3371806">!=</span>&nbsp;<span class="ident" id="3371809">nil</span>&nbsp;<span class="op" id="3371813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3371817">ip</span>&nbsp;<span class="op" id="3371820">=</span>&nbsp;<span class="ident" id="3371822">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3371825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3371828">l</span>&nbsp;<span class="op" id="3371830">:=</span>&nbsp;<span class="builtinfunc" id="3371833">len</span><span class="op" id="3371836">(</span><span class="ident" id="3371837">ip</span><span class="op" id="3371839">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371842">if</span>&nbsp;<span class="ident" id="3371845">l</span>&nbsp;<span class="op" id="3371847">!=</span>&nbsp;<span class="builtinfunc" id="3371850">len</span><span class="op" id="3371853">(</span><span class="ident" id="3371854">nn</span><span class="op" id="3371856">)</span>&nbsp;<span class="op" id="3371858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371862">return</span>&nbsp;<span class="ident" id="3371869">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3371876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371879">for</span>&nbsp;<span class="ident" id="3371883">i</span>&nbsp;<span class="op" id="3371885">:=</span>&nbsp;<span class="num" id="3371888">0</span><span class="op" id="3371889">;</span>&nbsp;<span class="ident" id="3371891">i</span>&nbsp;<span class="op" id="3371893">&lt;</span>&nbsp;<span class="ident" id="3371895">l</span><span class="op" id="3371896">;</span>&nbsp;<span class="ident" id="3371898">i</span><span class="op" id="3371899">++</span>&nbsp;<span class="op" id="3371902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371906">if</span>&nbsp;<span class="ident" id="3371909">nn</span><span class="op" id="3371911">[</span><span class="ident" id="3371912">i</span><span class="op" id="3371913">]</span><span class="op" id="3371914">&amp;</span><span class="ident" id="3371915">m</span><span class="op" id="3371916">[</span><span class="ident" id="3371917">i</span><span class="op" id="3371918">]</span>&nbsp;<span class="op" id="3371920">!=</span>&nbsp;<span class="ident" id="3371923">ip</span><span class="op" id="3371925">[</span><span class="ident" id="3371926">i</span><span class="op" id="3371927">]</span><span class="op" id="3371928">&amp;</span><span class="ident" id="3371929">m</span><span class="op" id="3371930">[</span><span class="ident" id="3371931">i</span><span class="op" id="3371932">]</span>&nbsp;<span class="op" id="3371934">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371939">return</span>&nbsp;<span class="ident" id="3371946">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3371954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3371957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371960">return</span>&nbsp;<span class="ident" id="3371967">true</span><br>
<span class="lineno"></span><span class="op" id="3371972">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="comment" id="3371975">//&nbsp;Network&nbsp;returns&nbsp;the&nbsp;address&#39;s&nbsp;network&nbsp;name,&nbsp;&#34;ip+net&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3372032">func</span>&nbsp;<span class="op" id="3372037">(</span><span class="ident" id="3372038">n</span>&nbsp;<span class="op" id="3372040">*</span><span class="ident" id="3372041">IPNet</span><span class="op" id="3372046">)</span>&nbsp;<span class="ident" id="3372048">Network</span><span class="op" id="3372055">(</span><span class="op" id="3372056">)</span>&nbsp;<span class="builtintype" id="3372058">string</span>&nbsp;<span class="op" id="3372065">{</span>&nbsp;<span class="keyword" id="3372067">return</span>&nbsp;<span class="string" id="3372074">&#34;ip+net&#34;</span>&nbsp;<span class="op" id="3372083">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3372086">//&nbsp;String&nbsp;returns&nbsp;the&nbsp;CIDR&nbsp;notation&nbsp;of&nbsp;n&nbsp;like&nbsp;&#34;192.168.100.1/24&#34;</span><br>
<span class="lineno">480</span><span class="comment" id="3372151">//&nbsp;or&nbsp;&#34;2001:DB8::/48&#34;&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4632&nbsp;and&nbsp;RFC&nbsp;4291.</span><br>
<span class="lineno"></span><span class="comment" id="3372210">//&nbsp;If&nbsp;the&nbsp;mask&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;canonical&nbsp;form,&nbsp;it&nbsp;returns&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3372270">//&nbsp;string&nbsp;which&nbsp;consists&nbsp;of&nbsp;an&nbsp;IP&nbsp;address,&nbsp;followed&nbsp;by&nbsp;a&nbsp;slash</span><br>
<span class="lineno"></span><span class="comment" id="3372333">//&nbsp;character&nbsp;and&nbsp;a&nbsp;mask&nbsp;expressed&nbsp;as&nbsp;hexadecimal&nbsp;form&nbsp;with&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="3372395">//&nbsp;punctuation&nbsp;like&nbsp;&#34;192.168.100.1/c000ff00&#34;.</span><br>
<span class="lineno">485</span><span class="keyword" id="3372441">func</span>&nbsp;<span class="op" id="3372446">(</span><span class="ident" id="3372447">n</span>&nbsp;<span class="op" id="3372449">*</span><span class="ident" id="3372450">IPNet</span><span class="op" id="3372455">)</span>&nbsp;<span class="ident" id="3372457">String</span><span class="op" id="3372463">(</span><span class="op" id="3372464">)</span>&nbsp;<span class="builtintype" id="3372466">string</span>&nbsp;<span class="op" id="3372473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3372476">nn</span><span class="op" id="3372478">,</span>&nbsp;<span class="ident" id="3372480">m</span>&nbsp;<span class="op" id="3372482">:=</span>&nbsp;<span class="ident" id="3372485">networkNumberAndMask</span><span class="op" id="3372505">(</span><span class="ident" id="3372506">n</span><span class="op" id="3372507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3372510">if</span>&nbsp;<span class="ident" id="3372513">nn</span>&nbsp;<span class="op" id="3372516">==</span>&nbsp;<span class="ident" id="3372519">nil</span>&nbsp;<span class="op" id="3372523">||</span>&nbsp;<span class="ident" id="3372526">m</span>&nbsp;<span class="op" id="3372528">==</span>&nbsp;<span class="ident" id="3372531">nil</span>&nbsp;<span class="op" id="3372535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3372539">return</span>&nbsp;<span class="string" id="3372546">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3372555">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3372558">l</span>&nbsp;<span class="op" id="3372560">:=</span>&nbsp;<span class="ident" id="3372563">simpleMaskLength</span><span class="op" id="3372579">(</span><span class="ident" id="3372580">m</span><span class="op" id="3372581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3372584">if</span>&nbsp;<span class="ident" id="3372587">l</span>&nbsp;<span class="op" id="3372589">==</span>&nbsp;<span class="op" id="3372592">-</span><span class="num" id="3372593">1</span>&nbsp;<span class="op" id="3372595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3372599">return</span>&nbsp;<span class="ident" id="3372606">nn</span><span class="op" id="3372608">.</span><span class="ident" id="3372609">String</span><span class="op" id="3372615">(</span><span class="op" id="3372616">)</span>&nbsp;<span class="op" id="3372618">+</span>&nbsp;<span class="string" id="3372620">&#34;/&#34;</span>&nbsp;<span class="op" id="3372624">+</span>&nbsp;<span class="ident" id="3372626">m</span><span class="op" id="3372627">.</span><span class="ident" id="3372628">String</span><span class="op" id="3372634">(</span><span class="op" id="3372635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3372638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3372641">return</span>&nbsp;<span class="ident" id="3372648">nn</span><span class="op" id="3372650">.</span><span class="ident" id="3372651">String</span><span class="op" id="3372657">(</span><span class="op" id="3372658">)</span>&nbsp;<span class="op" id="3372660">+</span>&nbsp;<span class="string" id="3372662">&#34;/&#34;</span>&nbsp;<span class="op" id="3372666">+</span>&nbsp;<span class="ident" id="3372668">itod</span><span class="op" id="3372672">(</span><span class="builtintype" id="3372673">uint</span><span class="op" id="3372677">(</span><span class="ident" id="3372678">l</span><span class="op" id="3372679">)</span><span class="op" id="3372680">)</span><br>
<span class="lineno">495</span><span class="op" id="3372682">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3372685">//&nbsp;Parse&nbsp;IPv4&nbsp;address&nbsp;(d.d.d.d).</span><br>
<span class="lineno"></span><span class="keyword" id="3372718">func</span>&nbsp;<span class="ident" id="3372723">parseIPv4</span><span class="op" id="3372732">(</span><span class="ident" id="3372733">s</span>&nbsp;<span class="builtintype" id="3372735">string</span><span class="op" id="3372741">)</span>&nbsp;<span class="ident" id="3372743">IP</span>&nbsp;<span class="op" id="3372746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3372749">var</span>&nbsp;<span class="ident" id="3372753">p</span>&nbsp;<span class="op" id="3372755">[</span><span class="ident" id="3372756">IPv4len</span><span class="op" id="3372763">]</span><span class="builtintype" id="3372764">byte</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3372770">i</span>&nbsp;<span class="op" id="3372772">:=</span>&nbsp;<span class="num" id="3372775">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3372778">for</span>&nbsp;<span class="ident" id="3372782">j</span>&nbsp;<span class="op" id="3372784">:=</span>&nbsp;<span class="num" id="3372787">0</span><span class="op" id="3372788">;</span>&nbsp;<span class="ident" id="3372790">j</span>&nbsp;<span class="op" id="3372792">&lt;</span>&nbsp;<span class="ident" id="3372794">IPv4len</span><span class="op" id="3372801">;</span>&nbsp;<span class="ident" id="3372803">j</span><span class="op" id="3372804">++</span>&nbsp;<span class="op" id="3372807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3372811">if</span>&nbsp;<span class="ident" id="3372814">i</span>&nbsp;<span class="op" id="3372816">&gt;=</span>&nbsp;<span class="builtinfunc" id="3372819">len</span><span class="op" id="3372822">(</span><span class="ident" id="3372823">s</span><span class="op" id="3372824">)</span>&nbsp;<span class="op" id="3372826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3372831">//&nbsp;Missing&nbsp;octets.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3372853">return</span>&nbsp;<span class="ident" id="3372860">nil</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3372866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3372870">if</span>&nbsp;<span class="ident" id="3372873">j</span>&nbsp;<span class="op" id="3372875">&gt;</span>&nbsp;<span class="num" id="3372877">0</span>&nbsp;<span class="op" id="3372879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3372884">if</span>&nbsp;<span class="ident" id="3372887">s</span><span class="op" id="3372888">[</span><span class="ident" id="3372889">i</span><span class="op" id="3372890">]</span>&nbsp;<span class="op" id="3372892">!=</span>&nbsp;<span class="string" id="3372895">&#39;.&#39;</span>&nbsp;<span class="op" id="3372899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3372905">return</span>&nbsp;<span class="ident" id="3372912">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3372919">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3372924">i</span><span class="op" id="3372925">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3372930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3372934">var</span>&nbsp;<span class="op" id="3372938">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3372943">n</span>&nbsp;&nbsp;<span class="builtintype" id="3372946">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3372953">ok</span>&nbsp;<span class="builtintype" id="3372956">bool</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3372963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3372967">n</span><span class="op" id="3372968">,</span>&nbsp;<span class="ident" id="3372970">i</span><span class="op" id="3372971">,</span>&nbsp;<span class="ident" id="3372973">ok</span>&nbsp;<span class="op" id="3372976">=</span>&nbsp;<span class="ident" id="3372978">dtoi</span><span class="op" id="3372982">(</span><span class="ident" id="3372983">s</span><span class="op" id="3372984">,</span>&nbsp;<span class="ident" id="3372986">i</span><span class="op" id="3372987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3372991">if</span>&nbsp;<span class="op" id="3372994">!</span><span class="ident" id="3372995">ok</span>&nbsp;<span class="op" id="3372998">||</span>&nbsp;<span class="ident" id="3373001">n</span>&nbsp;<span class="op" id="3373003">&gt;</span>&nbsp;<span class="num" id="3373005">0xFF</span>&nbsp;<span class="op" id="3373010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3373015">return</span>&nbsp;<span class="ident" id="3373022">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3373028">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3373032">p</span><span class="op" id="3373033">[</span><span class="ident" id="3373034">j</span><span class="op" id="3373035">]</span>&nbsp;<span class="op" id="3373037">=</span>&nbsp;<span class="builtintype" id="3373039">byte</span><span class="op" id="3373043">(</span><span class="ident" id="3373044">n</span><span class="op" id="3373045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3373048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3373051">if</span>&nbsp;<span class="ident" id="3373054">i</span>&nbsp;<span class="op" id="3373056">!=</span>&nbsp;<span class="builtinfunc" id="3373059">len</span><span class="op" id="3373062">(</span><span class="ident" id="3373063">s</span><span class="op" id="3373064">)</span>&nbsp;<span class="op" id="3373066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3373070">return</span>&nbsp;<span class="ident" id="3373077">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3373082">}</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3373085">return</span>&nbsp;<span class="ident" id="3373092">IPv4</span><span class="op" id="3373096">(</span><span class="ident" id="3373097">p</span><span class="op" id="3373098">[</span><span class="num" id="3373099">0</span><span class="op" id="3373100">]</span><span class="op" id="3373101">,</span>&nbsp;<span class="ident" id="3373103">p</span><span class="op" id="3373104">[</span><span class="num" id="3373105">1</span><span class="op" id="3373106">]</span><span class="op" id="3373107">,</span>&nbsp;<span class="ident" id="3373109">p</span><span class="op" id="3373110">[</span><span class="num" id="3373111">2</span><span class="op" id="3373112">]</span><span class="op" id="3373113">,</span>&nbsp;<span class="ident" id="3373115">p</span><span class="op" id="3373116">[</span><span class="num" id="3373117">3</span><span class="op" id="3373118">]</span><span class="op" id="3373119">)</span><br>
<span class="lineno"></span><span class="op" id="3373121">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3373124">//&nbsp;parseIPv6&nbsp;parses&nbsp;s&nbsp;as&nbsp;a&nbsp;literal&nbsp;IPv6&nbsp;address&nbsp;described&nbsp;in&nbsp;RFC&nbsp;4291</span><br>
<span class="lineno"></span><span class="comment" id="3373194">//&nbsp;and&nbsp;RFC&nbsp;5952.&nbsp;&nbsp;It&nbsp;can&nbsp;also&nbsp;parse&nbsp;a&nbsp;literal&nbsp;scoped&nbsp;IPv6&nbsp;address&nbsp;with</span><br>
<span class="lineno">530</span><span class="comment" id="3373265">//&nbsp;zone&nbsp;identifier&nbsp;which&nbsp;is&nbsp;described&nbsp;in&nbsp;RFC&nbsp;4007&nbsp;when&nbsp;zoneAllowed&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3373335">//&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="3373344">func</span>&nbsp;<span class="ident" id="3373349">parseIPv6</span><span class="op" id="3373358">(</span><span class="ident" id="3373359">s</span>&nbsp;<span class="builtintype" id="3373361">string</span><span class="op" id="3373367">,</span>&nbsp;<span class="ident" id="3373369">zoneAllowed</span>&nbsp;<span class="builtintype" id="3373381">bool</span><span class="op" id="3373385">)</span>&nbsp;<span class="op" id="3373387">(</span><span class="ident" id="3373388">ip</span>&nbsp;<span class="ident" id="3373391">IP</span><span class="op" id="3373393">,</span>&nbsp;<span class="ident" id="3373395">zone</span>&nbsp;<span class="builtintype" id="3373400">string</span><span class="op" id="3373406">)</span>&nbsp;<span class="op" id="3373408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3373411">ip</span>&nbsp;<span class="op" id="3373414">=</span>&nbsp;<span class="builtinfunc" id="3373416">make</span><span class="op" id="3373420">(</span><span class="ident" id="3373421">IP</span><span class="op" id="3373423">,</span>&nbsp;<span class="ident" id="3373425">IPv6len</span><span class="op" id="3373432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3373435">ellipsis</span>&nbsp;<span class="op" id="3373444">:=</span>&nbsp;<span class="op" id="3373447">-</span><span class="num" id="3373448">1</span>&nbsp;<span class="comment" id="3373450">//&nbsp;position&nbsp;of&nbsp;ellipsis&nbsp;in&nbsp;p</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3373480">i</span>&nbsp;<span class="op" id="3373482">:=</span>&nbsp;<span class="num" id="3373485">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3373495">//&nbsp;index&nbsp;in&nbsp;string&nbsp;s</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3373518">if</span>&nbsp;<span class="ident" id="3373521">zoneAllowed</span>&nbsp;<span class="op" id="3373533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3373537">s</span><span class="op" id="3373538">,</span>&nbsp;<span class="ident" id="3373540">zone</span>&nbsp;<span class="op" id="3373545">=</span>&nbsp;<span class="ident" id="3373547">splitHostZone</span><span class="op" id="3373560">(</span><span class="ident" id="3373561">s</span><span class="op" id="3373562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3373565">}</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3373569">//&nbsp;Might&nbsp;have&nbsp;leading&nbsp;ellipsis</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3373601">if</span>&nbsp;<span class="builtinfunc" id="3373604">len</span><span class="op" id="3373607">(</span><span class="ident" id="3373608">s</span><span class="op" id="3373609">)</span>&nbsp;<span class="op" id="3373611">&gt;=</span>&nbsp;<span class="num" id="3373614">2</span>&nbsp;<span class="op" id="3373616">&amp;&amp;</span>&nbsp;<span class="ident" id="3373619">s</span><span class="op" id="3373620">[</span><span class="num" id="3373621">0</span><span class="op" id="3373622">]</span>&nbsp;<span class="op" id="3373624">==</span>&nbsp;<span class="string" id="3373627">&#39;:&#39;</span>&nbsp;<span class="op" id="3373631">&amp;&amp;</span>&nbsp;<span class="ident" id="3373634">s</span><span class="op" id="3373635">[</span><span class="num" id="3373636">1</span><span class="op" id="3373637">]</span>&nbsp;<span class="op" id="3373639">==</span>&nbsp;<span class="string" id="3373642">&#39;:&#39;</span>&nbsp;<span class="op" id="3373646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3373650">ellipsis</span>&nbsp;<span class="op" id="3373659">=</span>&nbsp;<span class="num" id="3373661">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3373665">i</span>&nbsp;<span class="op" id="3373667">=</span>&nbsp;<span class="num" id="3373669">2</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3373673">//&nbsp;Might&nbsp;be&nbsp;only&nbsp;ellipsis</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3373701">if</span>&nbsp;<span class="ident" id="3373704">i</span>&nbsp;<span class="op" id="3373706">==</span>&nbsp;<span class="builtinfunc" id="3373709">len</span><span class="op" id="3373712">(</span><span class="ident" id="3373713">s</span><span class="op" id="3373714">)</span>&nbsp;<span class="op" id="3373716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3373721">return</span>&nbsp;<span class="ident" id="3373728">ip</span><span class="op" id="3373730">,</span>&nbsp;<span class="ident" id="3373732">zone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3373739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3373742">}</span><br>
<span class="lineno">550</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3373746">//&nbsp;Loop,&nbsp;parsing&nbsp;hex&nbsp;numbers&nbsp;followed&nbsp;by&nbsp;colon.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3373795">j</span>&nbsp;<span class="op" id="3373797">:=</span>&nbsp;<span class="num" id="3373800">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3373803">for</span>&nbsp;<span class="ident" id="3373807">j</span>&nbsp;<span class="op" id="3373809">&lt;</span>&nbsp;<span class="ident" id="3373811">IPv6len</span>&nbsp;<span class="op" id="3373819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3373823">//&nbsp;Hex&nbsp;number.</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3373840">n</span><span class="op" id="3373841">,</span>&nbsp;<span class="ident" id="3373843">i1</span><span class="op" id="3373845">,</span>&nbsp;<span class="ident" id="3373847">ok</span>&nbsp;<span class="op" id="3373850">:=</span>&nbsp;<span class="ident" id="3373853">xtoi</span><span class="op" id="3373857">(</span><span class="ident" id="3373858">s</span><span class="op" id="3373859">,</span>&nbsp;<span class="ident" id="3373861">i</span><span class="op" id="3373862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3373866">if</span>&nbsp;<span class="op" id="3373869">!</span><span class="ident" id="3373870">ok</span>&nbsp;<span class="op" id="3373873">||</span>&nbsp;<span class="ident" id="3373876">n</span>&nbsp;<span class="op" id="3373878">&gt;</span>&nbsp;<span class="num" id="3373880">0xFFFF</span>&nbsp;<span class="op" id="3373887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3373892">return</span>&nbsp;<span class="ident" id="3373899">nil</span><span class="op" id="3373902">,</span>&nbsp;<span class="ident" id="3373904">zone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3373911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3373916">//&nbsp;If&nbsp;followed&nbsp;by&nbsp;dot,&nbsp;might&nbsp;be&nbsp;in&nbsp;trailing&nbsp;IPv4.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3373968">if</span>&nbsp;<span class="ident" id="3373971">i1</span>&nbsp;<span class="op" id="3373974">&lt;</span>&nbsp;<span class="builtinfunc" id="3373976">len</span><span class="op" id="3373979">(</span><span class="ident" id="3373980">s</span><span class="op" id="3373981">)</span>&nbsp;<span class="op" id="3373983">&amp;&amp;</span>&nbsp;<span class="ident" id="3373986">s</span><span class="op" id="3373987">[</span><span class="ident" id="3373988">i1</span><span class="op" id="3373990">]</span>&nbsp;<span class="op" id="3373992">==</span>&nbsp;<span class="string" id="3373995">&#39;.&#39;</span>&nbsp;<span class="op" id="3373999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374004">if</span>&nbsp;<span class="ident" id="3374007">ellipsis</span>&nbsp;<span class="op" id="3374016">&lt;</span>&nbsp;<span class="num" id="3374018">0</span>&nbsp;<span class="op" id="3374020">&amp;&amp;</span>&nbsp;<span class="ident" id="3374023">j</span>&nbsp;<span class="op" id="3374025">!=</span>&nbsp;<span class="ident" id="3374028">IPv6len</span><span class="op" id="3374035">-</span><span class="ident" id="3374036">IPv4len</span>&nbsp;<span class="op" id="3374044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3374050">//&nbsp;Not&nbsp;the&nbsp;right&nbsp;place.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374078">return</span>&nbsp;<span class="ident" id="3374085">nil</span><span class="op" id="3374088">,</span>&nbsp;<span class="ident" id="3374090">zone</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3374098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374103">if</span>&nbsp;<span class="ident" id="3374106">j</span><span class="op" id="3374107">+</span><span class="ident" id="3374108">IPv4len</span>&nbsp;<span class="op" id="3374116">&gt;</span>&nbsp;<span class="ident" id="3374118">IPv6len</span>&nbsp;<span class="op" id="3374126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3374132">//&nbsp;Not&nbsp;enough&nbsp;room.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374156">return</span>&nbsp;<span class="ident" id="3374163">nil</span><span class="op" id="3374166">,</span>&nbsp;<span class="ident" id="3374168">zone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3374176">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3374181">ip4</span>&nbsp;<span class="op" id="3374185">:=</span>&nbsp;<span class="ident" id="3374188">parseIPv4</span><span class="op" id="3374197">(</span><span class="ident" id="3374198">s</span><span class="op" id="3374199">[</span><span class="ident" id="3374200">i</span><span class="op" id="3374201">:</span><span class="op" id="3374202">]</span><span class="op" id="3374203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374208">if</span>&nbsp;<span class="ident" id="3374211">ip4</span>&nbsp;<span class="op" id="3374215">==</span>&nbsp;<span class="ident" id="3374218">nil</span>&nbsp;<span class="op" id="3374222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374228">return</span>&nbsp;<span class="ident" id="3374235">nil</span><span class="op" id="3374238">,</span>&nbsp;<span class="ident" id="3374240">zone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3374248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3374253">ip</span><span class="op" id="3374255">[</span><span class="ident" id="3374256">j</span><span class="op" id="3374257">]</span>&nbsp;<span class="op" id="3374259">=</span>&nbsp;<span class="ident" id="3374261">ip4</span><span class="op" id="3374264">[</span><span class="num" id="3374265">12</span><span class="op" id="3374267">]</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3374272">ip</span><span class="op" id="3374274">[</span><span class="ident" id="3374275">j</span><span class="op" id="3374276">+</span><span class="num" id="3374277">1</span><span class="op" id="3374278">]</span>&nbsp;<span class="op" id="3374280">=</span>&nbsp;<span class="ident" id="3374282">ip4</span><span class="op" id="3374285">[</span><span class="num" id="3374286">13</span><span class="op" id="3374288">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3374293">ip</span><span class="op" id="3374295">[</span><span class="ident" id="3374296">j</span><span class="op" id="3374297">+</span><span class="num" id="3374298">2</span><span class="op" id="3374299">]</span>&nbsp;<span class="op" id="3374301">=</span>&nbsp;<span class="ident" id="3374303">ip4</span><span class="op" id="3374306">[</span><span class="num" id="3374307">14</span><span class="op" id="3374309">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3374314">ip</span><span class="op" id="3374316">[</span><span class="ident" id="3374317">j</span><span class="op" id="3374318">+</span><span class="num" id="3374319">3</span><span class="op" id="3374320">]</span>&nbsp;<span class="op" id="3374322">=</span>&nbsp;<span class="ident" id="3374324">ip4</span><span class="op" id="3374327">[</span><span class="num" id="3374328">15</span><span class="op" id="3374330">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3374335">i</span>&nbsp;<span class="op" id="3374337">=</span>&nbsp;<span class="builtinfunc" id="3374339">len</span><span class="op" id="3374342">(</span><span class="ident" id="3374343">s</span><span class="op" id="3374344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3374349">j</span>&nbsp;<span class="op" id="3374351">+=</span>&nbsp;<span class="ident" id="3374354">IPv4len</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374365">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3374373">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3374378">//&nbsp;Save&nbsp;this&nbsp;16-bit&nbsp;chunk.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3374407">ip</span><span class="op" id="3374409">[</span><span class="ident" id="3374410">j</span><span class="op" id="3374411">]</span>&nbsp;<span class="op" id="3374413">=</span>&nbsp;<span class="builtintype" id="3374415">byte</span><span class="op" id="3374419">(</span><span class="ident" id="3374420">n</span>&nbsp;<span class="op" id="3374422">&gt;&gt;</span>&nbsp;<span class="num" id="3374425">8</span><span class="op" id="3374426">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3374430">ip</span><span class="op" id="3374432">[</span><span class="ident" id="3374433">j</span><span class="op" id="3374434">+</span><span class="num" id="3374435">1</span><span class="op" id="3374436">]</span>&nbsp;<span class="op" id="3374438">=</span>&nbsp;<span class="builtintype" id="3374440">byte</span><span class="op" id="3374444">(</span><span class="ident" id="3374445">n</span><span class="op" id="3374446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3374450">j</span>&nbsp;<span class="op" id="3374452">+=</span>&nbsp;<span class="num" id="3374455">2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3374460">//&nbsp;Stop&nbsp;at&nbsp;end&nbsp;of&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3374488">i</span>&nbsp;<span class="op" id="3374490">=</span>&nbsp;<span class="ident" id="3374492">i1</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374497">if</span>&nbsp;<span class="ident" id="3374500">i</span>&nbsp;<span class="op" id="3374502">==</span>&nbsp;<span class="builtinfunc" id="3374505">len</span><span class="op" id="3374508">(</span><span class="ident" id="3374509">s</span><span class="op" id="3374510">)</span>&nbsp;<span class="op" id="3374512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374517">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3374525">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3374530">//&nbsp;Otherwise&nbsp;must&nbsp;be&nbsp;followed&nbsp;by&nbsp;colon&nbsp;and&nbsp;more.</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374581">if</span>&nbsp;<span class="ident" id="3374584">s</span><span class="op" id="3374585">[</span><span class="ident" id="3374586">i</span><span class="op" id="3374587">]</span>&nbsp;<span class="op" id="3374589">!=</span>&nbsp;<span class="string" id="3374592">&#39;:&#39;</span>&nbsp;<span class="op" id="3374596">||</span>&nbsp;<span class="ident" id="3374599">i</span><span class="op" id="3374600">+</span><span class="num" id="3374601">1</span>&nbsp;<span class="op" id="3374603">==</span>&nbsp;<span class="builtinfunc" id="3374606">len</span><span class="op" id="3374609">(</span><span class="ident" id="3374610">s</span><span class="op" id="3374611">)</span>&nbsp;<span class="op" id="3374613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374618">return</span>&nbsp;<span class="ident" id="3374625">nil</span><span class="op" id="3374628">,</span>&nbsp;<span class="ident" id="3374630">zone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3374637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3374641">i</span><span class="op" id="3374642">++</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3374648">//&nbsp;Look&nbsp;for&nbsp;ellipsis.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374672">if</span>&nbsp;<span class="ident" id="3374675">s</span><span class="op" id="3374676">[</span><span class="ident" id="3374677">i</span><span class="op" id="3374678">]</span>&nbsp;<span class="op" id="3374680">==</span>&nbsp;<span class="string" id="3374683">&#39;:&#39;</span>&nbsp;<span class="op" id="3374687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374692">if</span>&nbsp;<span class="ident" id="3374695">ellipsis</span>&nbsp;<span class="op" id="3374704">&gt;=</span>&nbsp;<span class="num" id="3374707">0</span>&nbsp;<span class="op" id="3374709">{</span>&nbsp;<span class="comment" id="3374711">//&nbsp;already&nbsp;have&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374735">return</span>&nbsp;<span class="ident" id="3374742">nil</span><span class="op" id="3374745">,</span>&nbsp;<span class="ident" id="3374747">zone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3374755">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3374760">ellipsis</span>&nbsp;<span class="op" id="3374769">=</span>&nbsp;<span class="ident" id="3374771">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374776">if</span>&nbsp;<span class="ident" id="3374779">i</span><span class="op" id="3374780">++</span><span class="op" id="3374782">;</span>&nbsp;<span class="ident" id="3374784">i</span>&nbsp;<span class="op" id="3374786">==</span>&nbsp;<span class="builtinfunc" id="3374789">len</span><span class="op" id="3374792">(</span><span class="ident" id="3374793">s</span><span class="op" id="3374794">)</span>&nbsp;<span class="op" id="3374796">{</span>&nbsp;<span class="comment" id="3374798">//&nbsp;can&nbsp;be&nbsp;at&nbsp;end</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374819">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3374828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3374832">}</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3374835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3374839">//&nbsp;Must&nbsp;have&nbsp;used&nbsp;entire&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374873">if</span>&nbsp;<span class="ident" id="3374876">i</span>&nbsp;<span class="op" id="3374878">!=</span>&nbsp;<span class="builtinfunc" id="3374881">len</span><span class="op" id="3374884">(</span><span class="ident" id="3374885">s</span><span class="op" id="3374886">)</span>&nbsp;<span class="op" id="3374888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374892">return</span>&nbsp;<span class="ident" id="3374899">nil</span><span class="op" id="3374902">,</span>&nbsp;<span class="ident" id="3374904">zone</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3374910">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3374914">//&nbsp;If&nbsp;didn&#39;t&nbsp;parse&nbsp;enough,&nbsp;expand&nbsp;ellipsis.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374959">if</span>&nbsp;<span class="ident" id="3374962">j</span>&nbsp;<span class="op" id="3374964">&lt;</span>&nbsp;<span class="ident" id="3374966">IPv6len</span>&nbsp;<span class="op" id="3374974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374978">if</span>&nbsp;<span class="ident" id="3374981">ellipsis</span>&nbsp;<span class="op" id="3374990">&lt;</span>&nbsp;<span class="num" id="3374992">0</span>&nbsp;<span class="op" id="3374994">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374999">return</span>&nbsp;<span class="ident" id="3375006">nil</span><span class="op" id="3375009">,</span>&nbsp;<span class="ident" id="3375011">zone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3375018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3375022">n</span>&nbsp;<span class="op" id="3375024">:=</span>&nbsp;<span class="ident" id="3375027">IPv6len</span>&nbsp;<span class="op" id="3375035">-</span>&nbsp;<span class="ident" id="3375037">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3375041">for</span>&nbsp;<span class="ident" id="3375045">k</span>&nbsp;<span class="op" id="3375047">:=</span>&nbsp;<span class="ident" id="3375050">j</span>&nbsp;<span class="op" id="3375052">-</span>&nbsp;<span class="num" id="3375054">1</span><span class="op" id="3375055">;</span>&nbsp;<span class="ident" id="3375057">k</span>&nbsp;<span class="op" id="3375059">&gt;=</span>&nbsp;<span class="ident" id="3375062">ellipsis</span><span class="op" id="3375070">;</span>&nbsp;<span class="ident" id="3375072">k</span><span class="op" id="3375073">--</span>&nbsp;<span class="op" id="3375076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3375081">ip</span><span class="op" id="3375083">[</span><span class="ident" id="3375084">k</span><span class="op" id="3375085">+</span><span class="ident" id="3375086">n</span><span class="op" id="3375087">]</span>&nbsp;<span class="op" id="3375089">=</span>&nbsp;<span class="ident" id="3375091">ip</span><span class="op" id="3375093">[</span><span class="ident" id="3375094">k</span><span class="op" id="3375095">]</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3375099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3375103">for</span>&nbsp;<span class="ident" id="3375107">k</span>&nbsp;<span class="op" id="3375109">:=</span>&nbsp;<span class="ident" id="3375112">ellipsis</span>&nbsp;<span class="op" id="3375121">+</span>&nbsp;<span class="ident" id="3375123">n</span>&nbsp;<span class="op" id="3375125">-</span>&nbsp;<span class="num" id="3375127">1</span><span class="op" id="3375128">;</span>&nbsp;<span class="ident" id="3375130">k</span>&nbsp;<span class="op" id="3375132">&gt;=</span>&nbsp;<span class="ident" id="3375135">ellipsis</span><span class="op" id="3375143">;</span>&nbsp;<span class="ident" id="3375145">k</span><span class="op" id="3375146">--</span>&nbsp;<span class="op" id="3375149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3375154">ip</span><span class="op" id="3375156">[</span><span class="ident" id="3375157">k</span><span class="op" id="3375158">]</span>&nbsp;<span class="op" id="3375160">=</span>&nbsp;<span class="num" id="3375162">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3375166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3375169">}</span>&nbsp;<span class="keyword" id="3375171">else</span>&nbsp;<span class="keyword" id="3375176">if</span>&nbsp;<span class="ident" id="3375179">ellipsis</span>&nbsp;<span class="op" id="3375188">&gt;=</span>&nbsp;<span class="num" id="3375191">0</span>&nbsp;<span class="op" id="3375193">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3375197">//&nbsp;Ellipsis&nbsp;must&nbsp;represent&nbsp;at&nbsp;least&nbsp;one&nbsp;0&nbsp;group.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3375248">return</span>&nbsp;<span class="ident" id="3375255">nil</span><span class="op" id="3375258">,</span>&nbsp;<span class="ident" id="3375260">zone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3375266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3375269">return</span>&nbsp;<span class="ident" id="3375276">ip</span><span class="op" id="3375278">,</span>&nbsp;<span class="ident" id="3375280">zone</span><br>
<span class="lineno"></span><span class="op" id="3375285">}</span><br>
<span class="lineno">635</span><br>
<span class="lineno"></span><span class="comment" id="3375288">//&nbsp;A&nbsp;ParseError&nbsp;represents&nbsp;a&nbsp;malformed&nbsp;text&nbsp;string&nbsp;and&nbsp;the&nbsp;type&nbsp;of&nbsp;string&nbsp;that&nbsp;was&nbsp;expected.</span><br>
<span class="lineno"></span><span class="keyword" id="3375381">type</span>&nbsp;<span class="ident" id="3375386">ParseError</span>&nbsp;<span class="keyword" id="3375397">struct</span>&nbsp;<span class="op" id="3375404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3375407">Type</span>&nbsp;<span class="builtintype" id="3375412">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3375420">Text</span>&nbsp;<span class="builtintype" id="3375425">string</span><br>
<span class="lineno">640</span><span class="op" id="3375432">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3375435">func</span>&nbsp;<span class="op" id="3375440">(</span><span class="ident" id="3375441">e</span>&nbsp;<span class="op" id="3375443">*</span><span class="ident" id="3375444">ParseError</span><span class="op" id="3375454">)</span>&nbsp;<span class="ident" id="3375456">Error</span><span class="op" id="3375461">(</span><span class="op" id="3375462">)</span>&nbsp;<span class="builtintype" id="3375464">string</span>&nbsp;<span class="op" id="3375471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3375474">return</span>&nbsp;<span class="string" id="3375481">&#34;invalid&nbsp;&#34;</span>&nbsp;<span class="op" id="3375492">+</span>&nbsp;<span class="ident" id="3375494">e</span><span class="op" id="3375495">.</span><span class="ident" id="3375496">Type</span>&nbsp;<span class="op" id="3375501">+</span>&nbsp;<span class="string" id="3375503">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="3375508">+</span>&nbsp;<span class="ident" id="3375510">e</span><span class="op" id="3375511">.</span><span class="ident" id="3375512">Text</span><br>
<span class="lineno"></span><span class="op" id="3375517">}</span><br>
<span class="lineno">645</span><br>
<span class="lineno"></span><span class="comment" id="3375520">//&nbsp;ParseIP&nbsp;parses&nbsp;s&nbsp;as&nbsp;an&nbsp;IP&nbsp;address,&nbsp;returning&nbsp;the&nbsp;result.</span><br>
<span class="lineno"></span><span class="comment" id="3375580">//&nbsp;The&nbsp;string&nbsp;s&nbsp;can&nbsp;be&nbsp;in&nbsp;dotted&nbsp;decimal&nbsp;(&#34;74.125.19.99&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3375638">//&nbsp;or&nbsp;IPv6&nbsp;(&#34;2001:4860:0:2001::68&#34;)&nbsp;form.</span><br>
<span class="lineno"></span><span class="comment" id="3375680">//&nbsp;If&nbsp;s&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;textual&nbsp;representation&nbsp;of&nbsp;an&nbsp;IP&nbsp;address,</span><br>
<span class="lineno">650</span><span class="comment" id="3375744">//&nbsp;ParseIP&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3375768">func</span>&nbsp;<span class="ident" id="3375773">ParseIP</span><span class="op" id="3375780">(</span><span class="ident" id="3375781">s</span>&nbsp;<span class="builtintype" id="3375783">string</span><span class="op" id="3375789">)</span>&nbsp;<span class="ident" id="3375791">IP</span>&nbsp;<span class="op" id="3375794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3375797">for</span>&nbsp;<span class="ident" id="3375801">i</span>&nbsp;<span class="op" id="3375803">:=</span>&nbsp;<span class="num" id="3375806">0</span><span class="op" id="3375807">;</span>&nbsp;<span class="ident" id="3375809">i</span>&nbsp;<span class="op" id="3375811">&lt;</span>&nbsp;<span class="builtinfunc" id="3375813">len</span><span class="op" id="3375816">(</span><span class="ident" id="3375817">s</span><span class="op" id="3375818">)</span><span class="op" id="3375819">;</span>&nbsp;<span class="ident" id="3375821">i</span><span class="op" id="3375822">++</span>&nbsp;<span class="op" id="3375825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3375829">switch</span>&nbsp;<span class="ident" id="3375836">s</span><span class="op" id="3375837">[</span><span class="ident" id="3375838">i</span><span class="op" id="3375839">]</span>&nbsp;<span class="op" id="3375841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3375845">case</span>&nbsp;<span class="string" id="3375850">&#39;.&#39;</span><span class="op" id="3375853">:</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3375858">return</span>&nbsp;<span class="ident" id="3375865">parseIPv4</span><span class="op" id="3375874">(</span><span class="ident" id="3375875">s</span><span class="op" id="3375876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3375880">case</span>&nbsp;<span class="string" id="3375885">&#39;:&#39;</span><span class="op" id="3375888">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3375893">ip</span><span class="op" id="3375895">,</span>&nbsp;<span class="ident" id="3375897">_</span>&nbsp;<span class="op" id="3375899">:=</span>&nbsp;<span class="ident" id="3375902">parseIPv6</span><span class="op" id="3375911">(</span><span class="ident" id="3375912">s</span><span class="op" id="3375913">,</span>&nbsp;<span class="ident" id="3375915">false</span><span class="op" id="3375920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3375925">return</span>&nbsp;<span class="ident" id="3375932">ip</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3375937">}</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3375940">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3375943">return</span>&nbsp;<span class="ident" id="3375950">nil</span><br>
<span class="lineno"></span><span class="op" id="3375954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3375957">//&nbsp;ParseCIDR&nbsp;parses&nbsp;s&nbsp;as&nbsp;a&nbsp;CIDR&nbsp;notation&nbsp;IP&nbsp;address&nbsp;and&nbsp;mask,</span><br>
<span class="lineno">665</span><span class="comment" id="3376019">//&nbsp;like&nbsp;&#34;192.168.100.1/24&#34;&nbsp;or&nbsp;&#34;2001:DB8::/48&#34;,&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3376080">//&nbsp;RFC&nbsp;4632&nbsp;and&nbsp;RFC&nbsp;4291.</span><br>
<span class="lineno"></span><span class="comment" id="3376106">//</span><br>
<span class="lineno"></span><span class="comment" id="3376109">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;IP&nbsp;address&nbsp;and&nbsp;the&nbsp;network&nbsp;implied&nbsp;by&nbsp;the&nbsp;IP</span><br>
<span class="lineno"></span><span class="comment" id="3376172">//&nbsp;and&nbsp;mask.&nbsp;&nbsp;For&nbsp;example,&nbsp;ParseCIDR(&#34;192.168.100.1/16&#34;)&nbsp;returns</span><br>
<span class="lineno">670</span><span class="comment" id="3376237">//&nbsp;the&nbsp;IP&nbsp;address&nbsp;192.168.100.1&nbsp;and&nbsp;the&nbsp;network&nbsp;192.168.0.0/16.</span><br>
<span class="lineno"></span><span class="keyword" id="3376301">func</span>&nbsp;<span class="ident" id="3376306">ParseCIDR</span><span class="op" id="3376315">(</span><span class="ident" id="3376316">s</span>&nbsp;<span class="builtintype" id="3376318">string</span><span class="op" id="3376324">)</span>&nbsp;<span class="op" id="3376326">(</span><span class="ident" id="3376327">IP</span><span class="op" id="3376329">,</span>&nbsp;<span class="op" id="3376331">*</span><span class="ident" id="3376332">IPNet</span><span class="op" id="3376337">,</span>&nbsp;<span class="builtintype" id="3376339">error</span><span class="op" id="3376344">)</span>&nbsp;<span class="op" id="3376346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3376349">i</span>&nbsp;<span class="op" id="3376351">:=</span>&nbsp;<span class="ident" id="3376354">byteIndex</span><span class="op" id="3376363">(</span><span class="ident" id="3376364">s</span><span class="op" id="3376365">,</span>&nbsp;<span class="string" id="3376367">&#39;/&#39;</span><span class="op" id="3376370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3376373">if</span>&nbsp;<span class="ident" id="3376376">i</span>&nbsp;<span class="op" id="3376378">&lt;</span>&nbsp;<span class="num" id="3376380">0</span>&nbsp;<span class="op" id="3376382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3376386">return</span>&nbsp;<span class="ident" id="3376393">nil</span><span class="op" id="3376396">,</span>&nbsp;<span class="ident" id="3376398">nil</span><span class="op" id="3376401">,</span>&nbsp;<span class="op" id="3376403">&amp;</span><span class="ident" id="3376404">ParseError</span><span class="op" id="3376414">{</span><span class="string" id="3376415">&#34;CIDR&nbsp;address&#34;</span><span class="op" id="3376429">,</span>&nbsp;<span class="ident" id="3376431">s</span><span class="op" id="3376432">}</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3376435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3376438">addr</span><span class="op" id="3376442">,</span>&nbsp;<span class="ident" id="3376444">mask</span>&nbsp;<span class="op" id="3376449">:=</span>&nbsp;<span class="ident" id="3376452">s</span><span class="op" id="3376453">[</span><span class="op" id="3376454">:</span><span class="ident" id="3376455">i</span><span class="op" id="3376456">]</span><span class="op" id="3376457">,</span>&nbsp;<span class="ident" id="3376459">s</span><span class="op" id="3376460">[</span><span class="ident" id="3376461">i</span><span class="op" id="3376462">+</span><span class="num" id="3376463">1</span><span class="op" id="3376464">:</span><span class="op" id="3376465">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3376468">iplen</span>&nbsp;<span class="op" id="3376474">:=</span>&nbsp;<span class="ident" id="3376477">IPv4len</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3376486">ip</span>&nbsp;<span class="op" id="3376489">:=</span>&nbsp;<span class="ident" id="3376492">parseIPv4</span><span class="op" id="3376501">(</span><span class="ident" id="3376502">addr</span><span class="op" id="3376506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3376509">if</span>&nbsp;<span class="ident" id="3376512">ip</span>&nbsp;<span class="op" id="3376515">==</span>&nbsp;<span class="ident" id="3376518">nil</span>&nbsp;<span class="op" id="3376522">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3376526">iplen</span>&nbsp;<span class="op" id="3376532">=</span>&nbsp;<span class="ident" id="3376534">IPv6len</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3376544">ip</span><span class="op" id="3376546">,</span>&nbsp;<span class="ident" id="3376548">_</span>&nbsp;<span class="op" id="3376550">=</span>&nbsp;<span class="ident" id="3376552">parseIPv6</span><span class="op" id="3376561">(</span><span class="ident" id="3376562">addr</span><span class="op" id="3376566">,</span>&nbsp;<span class="ident" id="3376568">false</span><span class="op" id="3376573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3376576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3376579">n</span><span class="op" id="3376580">,</span>&nbsp;<span class="ident" id="3376582">i</span><span class="op" id="3376583">,</span>&nbsp;<span class="ident" id="3376585">ok</span>&nbsp;<span class="op" id="3376588">:=</span>&nbsp;<span class="ident" id="3376591">dtoi</span><span class="op" id="3376595">(</span><span class="ident" id="3376596">mask</span><span class="op" id="3376600">,</span>&nbsp;<span class="num" id="3376602">0</span><span class="op" id="3376603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3376606">if</span>&nbsp;<span class="ident" id="3376609">ip</span>&nbsp;<span class="op" id="3376612">==</span>&nbsp;<span class="ident" id="3376615">nil</span>&nbsp;<span class="op" id="3376619">||</span>&nbsp;<span class="op" id="3376622">!</span><span class="ident" id="3376623">ok</span>&nbsp;<span class="op" id="3376626">||</span>&nbsp;<span class="ident" id="3376629">i</span>&nbsp;<span class="op" id="3376631">!=</span>&nbsp;<span class="builtinfunc" id="3376634">len</span><span class="op" id="3376637">(</span><span class="ident" id="3376638">mask</span><span class="op" id="3376642">)</span>&nbsp;<span class="op" id="3376644">||</span>&nbsp;<span class="ident" id="3376647">n</span>&nbsp;<span class="op" id="3376649">&lt;</span>&nbsp;<span class="num" id="3376651">0</span>&nbsp;<span class="op" id="3376653">||</span>&nbsp;<span class="ident" id="3376656">n</span>&nbsp;<span class="op" id="3376658">&gt;</span>&nbsp;<span class="num" id="3376660">8</span><span class="op" id="3376661">*</span><span class="ident" id="3376662">iplen</span>&nbsp;<span class="op" id="3376668">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3376672">return</span>&nbsp;<span class="ident" id="3376679">nil</span><span class="op" id="3376682">,</span>&nbsp;<span class="ident" id="3376684">nil</span><span class="op" id="3376687">,</span>&nbsp;<span class="op" id="3376689">&amp;</span><span class="ident" id="3376690">ParseError</span><span class="op" id="3376700">{</span><span class="string" id="3376701">&#34;CIDR&nbsp;address&#34;</span><span class="op" id="3376715">,</span>&nbsp;<span class="ident" id="3376717">s</span><span class="op" id="3376718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3376721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3376724">m</span>&nbsp;<span class="op" id="3376726">:=</span>&nbsp;<span class="ident" id="3376729">CIDRMask</span><span class="op" id="3376737">(</span><span class="ident" id="3376738">n</span><span class="op" id="3376739">,</span>&nbsp;<span class="num" id="3376741">8</span><span class="op" id="3376742">*</span><span class="ident" id="3376743">iplen</span><span class="op" id="3376748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3376751">return</span>&nbsp;<span class="ident" id="3376758">ip</span><span class="op" id="3376760">,</span>&nbsp;<span class="op" id="3376762">&amp;</span><span class="ident" id="3376763">IPNet</span><span class="op" id="3376768">{</span><span class="ident" id="3376769">IP</span><span class="op" id="3376771">:</span>&nbsp;<span class="ident" id="3376773">ip</span><span class="op" id="3376775">.</span><span class="ident" id="3376776">Mask</span><span class="op" id="3376780">(</span><span class="ident" id="3376781">m</span><span class="op" id="3376782">)</span><span class="op" id="3376783">,</span>&nbsp;<span class="ident" id="3376785">Mask</span><span class="op" id="3376789">:</span>&nbsp;<span class="ident" id="3376791">m</span><span class="op" id="3376792">}</span><span class="op" id="3376793">,</span>&nbsp;<span class="ident" id="3376795">nil</span><br>
<span class="lineno"></span><span class="op" id="3376799">}</span>
</div>
</body>
</html>
