<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/rpc/jsonrpc</h2>
<ul>
<li><a href="/gostd/net/rpc/jsonrpc/all_test.go.html">all_test.go</a></li>
<li><a href="/gostd/net/rpc/jsonrpc/client.go.html">client.go</a></li>
<li><a href="/gostd/net/rpc/jsonrpc/server.go.html">server.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8243552">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8243608">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8243662">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8243713">package</span>&nbsp;<span class="ident" id="8243721">jsonrpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8243730">import</span>&nbsp;<span class="op" id="8243737">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8243740">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8243749">&#34;encoding/json&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8243766">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8243776">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8243783">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8243789">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8243802">&#34;net&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8243809">&#34;net/rpc&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8243820">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8243831">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8243841">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="8243844">type</span>&nbsp;<span class="ident" id="8243849">Args</span>&nbsp;<span class="keyword" id="8243854">struct</span>&nbsp;<span class="op" id="8243861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8243864">A</span><span class="op" id="8243865">,</span>&nbsp;<span class="ident" id="8243867">B</span>&nbsp;<span class="builtintype" id="8243869">int</span><br>
<span class="lineno"></span><span class="op" id="8243873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8243876">type</span>&nbsp;<span class="ident" id="8243881">Reply</span>&nbsp;<span class="keyword" id="8243887">struct</span>&nbsp;<span class="op" id="8243894">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8243897">C</span>&nbsp;<span class="builtintype" id="8243899">int</span><br>
<span class="lineno"></span><span class="op" id="8243903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8243906">type</span>&nbsp;<span class="ident" id="8243911">Arith</span>&nbsp;<span class="builtintype" id="8243917">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="8243922">type</span>&nbsp;<span class="ident" id="8243927">ArithAddResp</span>&nbsp;<span class="keyword" id="8243940">struct</span>&nbsp;<span class="op" id="8243947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8243950">Id</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8243957">interface</span><span class="op" id="8243966">{</span><span class="op" id="8243967">}</span>&nbsp;<span class="string" id="8243969">`json:&#34;id&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8243982">Result</span>&nbsp;<span class="ident" id="8243989">Reply</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8244001">`json:&#34;result&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8244018">Error</span>&nbsp;&nbsp;<span class="keyword" id="8244025">interface</span><span class="op" id="8244034">{</span><span class="op" id="8244035">}</span>&nbsp;<span class="string" id="8244037">`json:&#34;error&#34;`</span><br>
<span class="lineno"></span><span class="op" id="8244052">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="8244055">func</span>&nbsp;<span class="op" id="8244060">(</span><span class="ident" id="8244061">t</span>&nbsp;<span class="op" id="8244063">*</span><span class="ident" id="8244064">Arith</span><span class="op" id="8244069">)</span>&nbsp;<span class="ident" id="8244071">Add</span><span class="op" id="8244074">(</span><span class="ident" id="8244075">args</span>&nbsp;<span class="op" id="8244080">*</span><span class="ident" id="8244081">Args</span><span class="op" id="8244085">,</span>&nbsp;<span class="ident" id="8244087">reply</span>&nbsp;<span class="op" id="8244093">*</span><span class="ident" id="8244094">Reply</span><span class="op" id="8244099">)</span>&nbsp;<span class="builtintype" id="8244101">error</span>&nbsp;<span class="op" id="8244107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8244110">reply</span><span class="op" id="8244115">.</span><span class="ident" id="8244116">C</span>&nbsp;<span class="op" id="8244118">=</span>&nbsp;<span class="ident" id="8244120">args</span><span class="op" id="8244124">.</span><span class="ident" id="8244125">A</span>&nbsp;<span class="op" id="8244127">+</span>&nbsp;<span class="ident" id="8244129">args</span><span class="op" id="8244133">.</span><span class="ident" id="8244134">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8244137">return</span>&nbsp;<span class="ident" id="8244144">nil</span><br>
<span class="lineno"></span><span class="op" id="8244148">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="8244151">func</span>&nbsp;<span class="op" id="8244156">(</span><span class="ident" id="8244157">t</span>&nbsp;<span class="op" id="8244159">*</span><span class="ident" id="8244160">Arith</span><span class="op" id="8244165">)</span>&nbsp;<span class="ident" id="8244167">Mul</span><span class="op" id="8244170">(</span><span class="ident" id="8244171">args</span>&nbsp;<span class="op" id="8244176">*</span><span class="ident" id="8244177">Args</span><span class="op" id="8244181">,</span>&nbsp;<span class="ident" id="8244183">reply</span>&nbsp;<span class="op" id="8244189">*</span><span class="ident" id="8244190">Reply</span><span class="op" id="8244195">)</span>&nbsp;<span class="builtintype" id="8244197">error</span>&nbsp;<span class="op" id="8244203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8244206">reply</span><span class="op" id="8244211">.</span><span class="ident" id="8244212">C</span>&nbsp;<span class="op" id="8244214">=</span>&nbsp;<span class="ident" id="8244216">args</span><span class="op" id="8244220">.</span><span class="ident" id="8244221">A</span>&nbsp;<span class="op" id="8244223">*</span>&nbsp;<span class="ident" id="8244225">args</span><span class="op" id="8244229">.</span><span class="ident" id="8244230">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8244233">return</span>&nbsp;<span class="ident" id="8244240">nil</span><br>
<span class="lineno"></span><span class="op" id="8244244">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="8244247">func</span>&nbsp;<span class="op" id="8244252">(</span><span class="ident" id="8244253">t</span>&nbsp;<span class="op" id="8244255">*</span><span class="ident" id="8244256">Arith</span><span class="op" id="8244261">)</span>&nbsp;<span class="ident" id="8244263">Div</span><span class="op" id="8244266">(</span><span class="ident" id="8244267">args</span>&nbsp;<span class="op" id="8244272">*</span><span class="ident" id="8244273">Args</span><span class="op" id="8244277">,</span>&nbsp;<span class="ident" id="8244279">reply</span>&nbsp;<span class="op" id="8244285">*</span><span class="ident" id="8244286">Reply</span><span class="op" id="8244291">)</span>&nbsp;<span class="builtintype" id="8244293">error</span>&nbsp;<span class="op" id="8244299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8244302">if</span>&nbsp;<span class="ident" id="8244305">args</span><span class="op" id="8244309">.</span><span class="ident" id="8244310">B</span>&nbsp;<span class="op" id="8244312">==</span>&nbsp;<span class="num" id="8244315">0</span>&nbsp;<span class="op" id="8244317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8244321">return</span>&nbsp;<span class="ident" id="8244328">errors</span><span class="op" id="8244334">.</span><span class="ident" id="8244335">New</span><span class="op" id="8244338">(</span><span class="string" id="8244339">&#34;divide&nbsp;by&nbsp;zero&#34;</span><span class="op" id="8244355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8244358">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8244361">reply</span><span class="op" id="8244366">.</span><span class="ident" id="8244367">C</span>&nbsp;<span class="op" id="8244369">=</span>&nbsp;<span class="ident" id="8244371">args</span><span class="op" id="8244375">.</span><span class="ident" id="8244376">A</span>&nbsp;<span class="op" id="8244378">/</span>&nbsp;<span class="ident" id="8244380">args</span><span class="op" id="8244384">.</span><span class="ident" id="8244385">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8244388">return</span>&nbsp;<span class="ident" id="8244395">nil</span><br>
<span class="lineno"></span><span class="op" id="8244399">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8244402">func</span>&nbsp;<span class="op" id="8244407">(</span><span class="ident" id="8244408">t</span>&nbsp;<span class="op" id="8244410">*</span><span class="ident" id="8244411">Arith</span><span class="op" id="8244416">)</span>&nbsp;<span class="ident" id="8244418">Error</span><span class="op" id="8244423">(</span><span class="ident" id="8244424">args</span>&nbsp;<span class="op" id="8244429">*</span><span class="ident" id="8244430">Args</span><span class="op" id="8244434">,</span>&nbsp;<span class="ident" id="8244436">reply</span>&nbsp;<span class="op" id="8244442">*</span><span class="ident" id="8244443">Reply</span><span class="op" id="8244448">)</span>&nbsp;<span class="builtintype" id="8244450">error</span>&nbsp;<span class="op" id="8244456">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8244459">panic</span><span class="op" id="8244464">(</span><span class="string" id="8244465">&#34;ERROR&#34;</span><span class="op" id="8244472">)</span><br>
<span class="lineno"></span><span class="op" id="8244474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8244477">func</span>&nbsp;<span class="ident" id="8244482">init</span><span class="op" id="8244486">(</span><span class="op" id="8244487">)</span>&nbsp;<span class="op" id="8244489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8244492">rpc</span><span class="op" id="8244495">.</span><span class="ident" id="8244496">Register</span><span class="op" id="8244504">(</span><span class="builtinfunc" id="8244505">new</span><span class="op" id="8244508">(</span><span class="ident" id="8244509">Arith</span><span class="op" id="8244514">)</span><span class="op" id="8244515">)</span><br>
<span class="lineno">60</span><span class="op" id="8244517">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8244520">func</span>&nbsp;<span class="ident" id="8244525">TestServerNoParams</span><span class="op" id="8244543">(</span><span class="ident" id="8244544">t</span>&nbsp;<span class="op" id="8244546">*</span><span class="ident" id="8244547">testing</span><span class="op" id="8244554">.</span><span class="ident" id="8244555">T</span><span class="op" id="8244556">)</span>&nbsp;<span class="op" id="8244558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8244561">cli</span><span class="op" id="8244564">,</span>&nbsp;<span class="ident" id="8244566">srv</span>&nbsp;<span class="op" id="8244570">:=</span>&nbsp;<span class="ident" id="8244573">net</span><span class="op" id="8244576">.</span><span class="ident" id="8244577">Pipe</span><span class="op" id="8244581">(</span><span class="op" id="8244582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8244585">defer</span>&nbsp;<span class="ident" id="8244591">cli</span><span class="op" id="8244594">.</span><span class="ident" id="8244595">Close</span><span class="op" id="8244600">(</span><span class="op" id="8244601">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8244604">go</span>&nbsp;<span class="ident" id="8244607">ServeConn</span><span class="op" id="8244616">(</span><span class="ident" id="8244617">srv</span><span class="op" id="8244620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8244623">dec</span>&nbsp;<span class="op" id="8244627">:=</span>&nbsp;<span class="ident" id="8244630">json</span><span class="op" id="8244634">.</span><span class="ident" id="8244635">NewDecoder</span><span class="op" id="8244645">(</span><span class="ident" id="8244646">cli</span><span class="op" id="8244649">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8244653">fmt</span><span class="op" id="8244656">.</span><span class="ident" id="8244657">Fprintf</span><span class="op" id="8244664">(</span><span class="ident" id="8244665">cli</span><span class="op" id="8244668">,</span>&nbsp;<span class="string" id="8244670">`{&#34;method&#34;:&nbsp;&#34;Arith.Add&#34;,&nbsp;&#34;id&#34;:&nbsp;&#34;123&#34;}`</span><span class="op" id="8244708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8244711">var</span>&nbsp;<span class="ident" id="8244715">resp</span>&nbsp;<span class="ident" id="8244720">ArithAddResp</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8244734">if</span>&nbsp;<span class="ident" id="8244737">err</span>&nbsp;<span class="op" id="8244741">:=</span>&nbsp;<span class="ident" id="8244744">dec</span><span class="op" id="8244747">.</span><span class="ident" id="8244748">Decode</span><span class="op" id="8244754">(</span><span class="op" id="8244755">&amp;</span><span class="ident" id="8244756">resp</span><span class="op" id="8244760">)</span><span class="op" id="8244761">;</span>&nbsp;<span class="ident" id="8244763">err</span>&nbsp;<span class="op" id="8244767">!=</span>&nbsp;<span class="ident" id="8244770">nil</span>&nbsp;<span class="op" id="8244774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8244778">t</span><span class="op" id="8244779">.</span><span class="ident" id="8244780">Fatalf</span><span class="op" id="8244786">(</span><span class="string" id="8244787">&#34;Decode&nbsp;after&nbsp;no&nbsp;params:&nbsp;%s&#34;</span><span class="op" id="8244815">,</span>&nbsp;<span class="ident" id="8244817">err</span><span class="op" id="8244820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8244823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8244826">if</span>&nbsp;<span class="ident" id="8244829">resp</span><span class="op" id="8244833">.</span><span class="ident" id="8244834">Error</span>&nbsp;<span class="op" id="8244840">==</span>&nbsp;<span class="ident" id="8244843">nil</span>&nbsp;<span class="op" id="8244847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8244851">t</span><span class="op" id="8244852">.</span><span class="ident" id="8244853">Fatalf</span><span class="op" id="8244859">(</span><span class="string" id="8244860">&#34;Expected&nbsp;error,&nbsp;got&nbsp;nil&#34;</span><span class="op" id="8244885">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8244888">}</span><br>
<span class="lineno"></span><span class="op" id="8244890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8244893">func</span>&nbsp;<span class="ident" id="8244898">TestServerEmptyMessage</span><span class="op" id="8244920">(</span><span class="ident" id="8244921">t</span>&nbsp;<span class="op" id="8244923">*</span><span class="ident" id="8244924">testing</span><span class="op" id="8244931">.</span><span class="ident" id="8244932">T</span><span class="op" id="8244933">)</span>&nbsp;<span class="op" id="8244935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8244938">cli</span><span class="op" id="8244941">,</span>&nbsp;<span class="ident" id="8244943">srv</span>&nbsp;<span class="op" id="8244947">:=</span>&nbsp;<span class="ident" id="8244950">net</span><span class="op" id="8244953">.</span><span class="ident" id="8244954">Pipe</span><span class="op" id="8244958">(</span><span class="op" id="8244959">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8244962">defer</span>&nbsp;<span class="ident" id="8244968">cli</span><span class="op" id="8244971">.</span><span class="ident" id="8244972">Close</span><span class="op" id="8244977">(</span><span class="op" id="8244978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8244981">go</span>&nbsp;<span class="ident" id="8244984">ServeConn</span><span class="op" id="8244993">(</span><span class="ident" id="8244994">srv</span><span class="op" id="8244997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8245000">dec</span>&nbsp;<span class="op" id="8245004">:=</span>&nbsp;<span class="ident" id="8245007">json</span><span class="op" id="8245011">.</span><span class="ident" id="8245012">NewDecoder</span><span class="op" id="8245022">(</span><span class="ident" id="8245023">cli</span><span class="op" id="8245026">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8245030">fmt</span><span class="op" id="8245033">.</span><span class="ident" id="8245034">Fprintf</span><span class="op" id="8245041">(</span><span class="ident" id="8245042">cli</span><span class="op" id="8245045">,</span>&nbsp;<span class="string" id="8245047">&#34;{}&#34;</span><span class="op" id="8245051">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8245054">var</span>&nbsp;<span class="ident" id="8245058">resp</span>&nbsp;<span class="ident" id="8245063">ArithAddResp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8245077">if</span>&nbsp;<span class="ident" id="8245080">err</span>&nbsp;<span class="op" id="8245084">:=</span>&nbsp;<span class="ident" id="8245087">dec</span><span class="op" id="8245090">.</span><span class="ident" id="8245091">Decode</span><span class="op" id="8245097">(</span><span class="op" id="8245098">&amp;</span><span class="ident" id="8245099">resp</span><span class="op" id="8245103">)</span><span class="op" id="8245104">;</span>&nbsp;<span class="ident" id="8245106">err</span>&nbsp;<span class="op" id="8245110">!=</span>&nbsp;<span class="ident" id="8245113">nil</span>&nbsp;<span class="op" id="8245117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8245121">t</span><span class="op" id="8245122">.</span><span class="ident" id="8245123">Fatalf</span><span class="op" id="8245129">(</span><span class="string" id="8245130">&#34;Decode&nbsp;after&nbsp;empty:&nbsp;%s&#34;</span><span class="op" id="8245154">,</span>&nbsp;<span class="ident" id="8245156">err</span><span class="op" id="8245159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8245162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8245165">if</span>&nbsp;<span class="ident" id="8245168">resp</span><span class="op" id="8245172">.</span><span class="ident" id="8245173">Error</span>&nbsp;<span class="op" id="8245179">==</span>&nbsp;<span class="ident" id="8245182">nil</span>&nbsp;<span class="op" id="8245186">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8245190">t</span><span class="op" id="8245191">.</span><span class="ident" id="8245192">Fatalf</span><span class="op" id="8245198">(</span><span class="string" id="8245199">&#34;Expected&nbsp;error,&nbsp;got&nbsp;nil&#34;</span><span class="op" id="8245224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8245227">}</span><br>
<span class="lineno"></span><span class="op" id="8245229">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8245232">func</span>&nbsp;<span class="ident" id="8245237">TestServer</span><span class="op" id="8245247">(</span><span class="ident" id="8245248">t</span>&nbsp;<span class="op" id="8245250">*</span><span class="ident" id="8245251">testing</span><span class="op" id="8245258">.</span><span class="ident" id="8245259">T</span><span class="op" id="8245260">)</span>&nbsp;<span class="op" id="8245262">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8245265">cli</span><span class="op" id="8245268">,</span>&nbsp;<span class="ident" id="8245270">srv</span>&nbsp;<span class="op" id="8245274">:=</span>&nbsp;<span class="ident" id="8245277">net</span><span class="op" id="8245280">.</span><span class="ident" id="8245281">Pipe</span><span class="op" id="8245285">(</span><span class="op" id="8245286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8245289">defer</span>&nbsp;<span class="ident" id="8245295">cli</span><span class="op" id="8245298">.</span><span class="ident" id="8245299">Close</span><span class="op" id="8245304">(</span><span class="op" id="8245305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8245308">go</span>&nbsp;<span class="ident" id="8245311">ServeConn</span><span class="op" id="8245320">(</span><span class="ident" id="8245321">srv</span><span class="op" id="8245324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8245327">dec</span>&nbsp;<span class="op" id="8245331">:=</span>&nbsp;<span class="ident" id="8245334">json</span><span class="op" id="8245338">.</span><span class="ident" id="8245339">NewDecoder</span><span class="op" id="8245349">(</span><span class="ident" id="8245350">cli</span><span class="op" id="8245353">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8245357">//&nbsp;Send&nbsp;hand-coded&nbsp;requests&nbsp;to&nbsp;server,&nbsp;parse&nbsp;responses.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8245414">for</span>&nbsp;<span class="ident" id="8245418">i</span>&nbsp;<span class="op" id="8245420">:=</span>&nbsp;<span class="num" id="8245423">0</span><span class="op" id="8245424">;</span>&nbsp;<span class="ident" id="8245426">i</span>&nbsp;<span class="op" id="8245428">&lt;</span>&nbsp;<span class="num" id="8245430">10</span><span class="op" id="8245432">;</span>&nbsp;<span class="ident" id="8245434">i</span><span class="op" id="8245435">++</span>&nbsp;<span class="op" id="8245438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8245442">fmt</span><span class="op" id="8245445">.</span><span class="ident" id="8245446">Fprintf</span><span class="op" id="8245453">(</span><span class="ident" id="8245454">cli</span><span class="op" id="8245457">,</span>&nbsp;<span class="string" id="8245459">`{&#34;method&#34;:&nbsp;&#34;Arith.Add&#34;,&nbsp;&#34;id&#34;:&nbsp;&#34;\u%04d&#34;,&nbsp;&#34;params&#34;:&nbsp;[{&#34;A&#34;:&nbsp;%d,&nbsp;&#34;B&#34;:&nbsp;%d}]}`</span><span class="op" id="8245532">,</span>&nbsp;<span class="ident" id="8245534">i</span><span class="op" id="8245535">,</span>&nbsp;<span class="ident" id="8245537">i</span><span class="op" id="8245538">,</span>&nbsp;<span class="ident" id="8245540">i</span><span class="op" id="8245541">+</span><span class="num" id="8245542">1</span><span class="op" id="8245543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8245547">var</span>&nbsp;<span class="ident" id="8245551">resp</span>&nbsp;<span class="ident" id="8245556">ArithAddResp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8245571">err</span>&nbsp;<span class="op" id="8245575">:=</span>&nbsp;<span class="ident" id="8245578">dec</span><span class="op" id="8245581">.</span><span class="ident" id="8245582">Decode</span><span class="op" id="8245588">(</span><span class="op" id="8245589">&amp;</span><span class="ident" id="8245590">resp</span><span class="op" id="8245594">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8245598">if</span>&nbsp;<span class="ident" id="8245601">err</span>&nbsp;<span class="op" id="8245605">!=</span>&nbsp;<span class="ident" id="8245608">nil</span>&nbsp;<span class="op" id="8245612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8245617">t</span><span class="op" id="8245618">.</span><span class="ident" id="8245619">Fatalf</span><span class="op" id="8245625">(</span><span class="string" id="8245626">&#34;Decode:&nbsp;%s&#34;</span><span class="op" id="8245638">,</span>&nbsp;<span class="ident" id="8245640">err</span><span class="op" id="8245643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8245647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8245651">if</span>&nbsp;<span class="ident" id="8245654">resp</span><span class="op" id="8245658">.</span><span class="ident" id="8245659">Error</span>&nbsp;<span class="op" id="8245665">!=</span>&nbsp;<span class="ident" id="8245668">nil</span>&nbsp;<span class="op" id="8245672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8245677">t</span><span class="op" id="8245678">.</span><span class="ident" id="8245679">Fatalf</span><span class="op" id="8245685">(</span><span class="string" id="8245686">&#34;resp.Error:&nbsp;%s&#34;</span><span class="op" id="8245702">,</span>&nbsp;<span class="ident" id="8245704">resp</span><span class="op" id="8245708">.</span><span class="ident" id="8245709">Error</span><span class="op" id="8245714">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8245718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8245722">if</span>&nbsp;<span class="ident" id="8245725">resp</span><span class="op" id="8245729">.</span><span class="ident" id="8245730">Id</span><span class="op" id="8245732">.</span><span class="op" id="8245733">(</span><span class="builtintype" id="8245734">string</span><span class="op" id="8245740">)</span>&nbsp;<span class="op" id="8245742">!=</span>&nbsp;<span class="builtintype" id="8245745">string</span><span class="op" id="8245751">(</span><span class="ident" id="8245752">i</span><span class="op" id="8245753">)</span>&nbsp;<span class="op" id="8245755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8245760">t</span><span class="op" id="8245761">.</span><span class="ident" id="8245762">Fatalf</span><span class="op" id="8245768">(</span><span class="string" id="8245769">&#34;resp:&nbsp;bad&nbsp;id&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8245794">,</span>&nbsp;<span class="ident" id="8245796">resp</span><span class="op" id="8245800">.</span><span class="ident" id="8245801">Id</span><span class="op" id="8245803">.</span><span class="op" id="8245804">(</span><span class="builtintype" id="8245805">string</span><span class="op" id="8245811">)</span><span class="op" id="8245812">,</span>&nbsp;<span class="builtintype" id="8245814">string</span><span class="op" id="8245820">(</span><span class="ident" id="8245821">i</span><span class="op" id="8245822">)</span><span class="op" id="8245823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8245827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8245831">if</span>&nbsp;<span class="ident" id="8245834">resp</span><span class="op" id="8245838">.</span><span class="ident" id="8245839">Result</span><span class="op" id="8245845">.</span><span class="ident" id="8245846">C</span>&nbsp;<span class="op" id="8245848">!=</span>&nbsp;<span class="num" id="8245851">2</span><span class="op" id="8245852">*</span><span class="ident" id="8245853">i</span><span class="op" id="8245854">+</span><span class="num" id="8245855">1</span>&nbsp;<span class="op" id="8245857">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8245862">t</span><span class="op" id="8245863">.</span><span class="ident" id="8245864">Fatalf</span><span class="op" id="8245870">(</span><span class="string" id="8245871">&#34;resp:&nbsp;bad&nbsp;result:&nbsp;%d+%d=%d&#34;</span><span class="op" id="8245899">,</span>&nbsp;<span class="ident" id="8245901">i</span><span class="op" id="8245902">,</span>&nbsp;<span class="ident" id="8245904">i</span><span class="op" id="8245905">+</span><span class="num" id="8245906">1</span><span class="op" id="8245907">,</span>&nbsp;<span class="ident" id="8245909">resp</span><span class="op" id="8245913">.</span><span class="ident" id="8245914">Result</span><span class="op" id="8245920">.</span><span class="ident" id="8245921">C</span><span class="op" id="8245922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8245926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8245929">}</span><br>
<span class="lineno"></span><span class="op" id="8245931">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="8245934">func</span>&nbsp;<span class="ident" id="8245939">TestClient</span><span class="op" id="8245949">(</span><span class="ident" id="8245950">t</span>&nbsp;<span class="op" id="8245952">*</span><span class="ident" id="8245953">testing</span><span class="op" id="8245960">.</span><span class="ident" id="8245961">T</span><span class="op" id="8245962">)</span>&nbsp;<span class="op" id="8245964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8245967">//&nbsp;Assume&nbsp;server&nbsp;is&nbsp;okay&nbsp;(TestServer&nbsp;is&nbsp;above).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8246016">//&nbsp;Test&nbsp;client&nbsp;against&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8246048">cli</span><span class="op" id="8246051">,</span>&nbsp;<span class="ident" id="8246053">srv</span>&nbsp;<span class="op" id="8246057">:=</span>&nbsp;<span class="ident" id="8246060">net</span><span class="op" id="8246063">.</span><span class="ident" id="8246064">Pipe</span><span class="op" id="8246068">(</span><span class="op" id="8246069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8246072">go</span>&nbsp;<span class="ident" id="8246075">ServeConn</span><span class="op" id="8246084">(</span><span class="ident" id="8246085">srv</span><span class="op" id="8246088">)</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8246092">client</span>&nbsp;<span class="op" id="8246099">:=</span>&nbsp;<span class="ident" id="8246102">NewClient</span><span class="op" id="8246111">(</span><span class="ident" id="8246112">cli</span><span class="op" id="8246115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8246118">defer</span>&nbsp;<span class="ident" id="8246124">client</span><span class="op" id="8246130">.</span><span class="ident" id="8246131">Close</span><span class="op" id="8246136">(</span><span class="op" id="8246137">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8246141">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8246163">args</span>&nbsp;<span class="op" id="8246168">:=</span>&nbsp;<span class="op" id="8246171">&amp;</span><span class="ident" id="8246172">Args</span><span class="op" id="8246176">{</span><span class="num" id="8246177">7</span><span class="op" id="8246178">,</span>&nbsp;<span class="num" id="8246180">8</span><span class="op" id="8246181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8246184">reply</span>&nbsp;<span class="op" id="8246190">:=</span>&nbsp;<span class="builtinfunc" id="8246193">new</span><span class="op" id="8246196">(</span><span class="ident" id="8246197">Reply</span><span class="op" id="8246202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8246205">err</span>&nbsp;<span class="op" id="8246209">:=</span>&nbsp;<span class="ident" id="8246212">client</span><span class="op" id="8246218">.</span><span class="ident" id="8246219">Call</span><span class="op" id="8246223">(</span><span class="string" id="8246224">&#34;Arith.Add&#34;</span><span class="op" id="8246235">,</span>&nbsp;<span class="ident" id="8246237">args</span><span class="op" id="8246241">,</span>&nbsp;<span class="ident" id="8246243">reply</span><span class="op" id="8246248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8246251">if</span>&nbsp;<span class="ident" id="8246254">err</span>&nbsp;<span class="op" id="8246258">!=</span>&nbsp;<span class="ident" id="8246261">nil</span>&nbsp;<span class="op" id="8246265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8246269">t</span><span class="op" id="8246270">.</span><span class="ident" id="8246271">Errorf</span><span class="op" id="8246277">(</span><span class="string" id="8246278">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8246320">,</span>&nbsp;<span class="ident" id="8246322">err</span><span class="op" id="8246325">.</span><span class="ident" id="8246326">Error</span><span class="op" id="8246331">(</span><span class="op" id="8246332">)</span><span class="op" id="8246333">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8246336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8246339">if</span>&nbsp;<span class="ident" id="8246342">reply</span><span class="op" id="8246347">.</span><span class="ident" id="8246348">C</span>&nbsp;<span class="op" id="8246350">!=</span>&nbsp;<span class="ident" id="8246353">args</span><span class="op" id="8246357">.</span><span class="ident" id="8246358">A</span><span class="op" id="8246359">+</span><span class="ident" id="8246360">args</span><span class="op" id="8246364">.</span><span class="ident" id="8246365">B</span>&nbsp;<span class="op" id="8246367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8246371">t</span><span class="op" id="8246372">.</span><span class="ident" id="8246373">Errorf</span><span class="op" id="8246379">(</span><span class="string" id="8246380">&#34;Add:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="8246405">,</span>&nbsp;<span class="ident" id="8246407">reply</span><span class="op" id="8246412">.</span><span class="ident" id="8246413">C</span><span class="op" id="8246414">,</span>&nbsp;<span class="ident" id="8246416">args</span><span class="op" id="8246420">.</span><span class="ident" id="8246421">A</span><span class="op" id="8246422">+</span><span class="ident" id="8246423">args</span><span class="op" id="8246427">.</span><span class="ident" id="8246428">B</span><span class="op" id="8246429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8246432">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8246436">args</span>&nbsp;<span class="op" id="8246441">=</span>&nbsp;<span class="op" id="8246443">&amp;</span><span class="ident" id="8246444">Args</span><span class="op" id="8246448">{</span><span class="num" id="8246449">7</span><span class="op" id="8246450">,</span>&nbsp;<span class="num" id="8246452">8</span><span class="op" id="8246453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8246456">reply</span>&nbsp;<span class="op" id="8246462">=</span>&nbsp;<span class="builtinfunc" id="8246464">new</span><span class="op" id="8246467">(</span><span class="ident" id="8246468">Reply</span><span class="op" id="8246473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8246476">err</span>&nbsp;<span class="op" id="8246480">=</span>&nbsp;<span class="ident" id="8246482">client</span><span class="op" id="8246488">.</span><span class="ident" id="8246489">Call</span><span class="op" id="8246493">(</span><span class="string" id="8246494">&#34;Arith.Mul&#34;</span><span class="op" id="8246505">,</span>&nbsp;<span class="ident" id="8246507">args</span><span class="op" id="8246511">,</span>&nbsp;<span class="ident" id="8246513">reply</span><span class="op" id="8246518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8246521">if</span>&nbsp;<span class="ident" id="8246524">err</span>&nbsp;<span class="op" id="8246528">!=</span>&nbsp;<span class="ident" id="8246531">nil</span>&nbsp;<span class="op" id="8246535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8246539">t</span><span class="op" id="8246540">.</span><span class="ident" id="8246541">Errorf</span><span class="op" id="8246547">(</span><span class="string" id="8246548">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8246590">,</span>&nbsp;<span class="ident" id="8246592">err</span><span class="op" id="8246595">.</span><span class="ident" id="8246596">Error</span><span class="op" id="8246601">(</span><span class="op" id="8246602">)</span><span class="op" id="8246603">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8246606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8246609">if</span>&nbsp;<span class="ident" id="8246612">reply</span><span class="op" id="8246617">.</span><span class="ident" id="8246618">C</span>&nbsp;<span class="op" id="8246620">!=</span>&nbsp;<span class="ident" id="8246623">args</span><span class="op" id="8246627">.</span><span class="ident" id="8246628">A</span><span class="op" id="8246629">*</span><span class="ident" id="8246630">args</span><span class="op" id="8246634">.</span><span class="ident" id="8246635">B</span>&nbsp;<span class="op" id="8246637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8246641">t</span><span class="op" id="8246642">.</span><span class="ident" id="8246643">Errorf</span><span class="op" id="8246649">(</span><span class="string" id="8246650">&#34;Mul:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="8246675">,</span>&nbsp;<span class="ident" id="8246677">reply</span><span class="op" id="8246682">.</span><span class="ident" id="8246683">C</span><span class="op" id="8246684">,</span>&nbsp;<span class="ident" id="8246686">args</span><span class="op" id="8246690">.</span><span class="ident" id="8246691">A</span><span class="op" id="8246692">*</span><span class="ident" id="8246693">args</span><span class="op" id="8246697">.</span><span class="ident" id="8246698">B</span><span class="op" id="8246699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8246702">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8246706">//&nbsp;Out&nbsp;of&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8246724">args</span>&nbsp;<span class="op" id="8246729">=</span>&nbsp;<span class="op" id="8246731">&amp;</span><span class="ident" id="8246732">Args</span><span class="op" id="8246736">{</span><span class="num" id="8246737">7</span><span class="op" id="8246738">,</span>&nbsp;<span class="num" id="8246740">8</span><span class="op" id="8246741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8246744">mulReply</span>&nbsp;<span class="op" id="8246753">:=</span>&nbsp;<span class="builtinfunc" id="8246756">new</span><span class="op" id="8246759">(</span><span class="ident" id="8246760">Reply</span><span class="op" id="8246765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8246768">mulCall</span>&nbsp;<span class="op" id="8246776">:=</span>&nbsp;<span class="ident" id="8246779">client</span><span class="op" id="8246785">.</span><span class="ident" id="8246786">Go</span><span class="op" id="8246788">(</span><span class="string" id="8246789">&#34;Arith.Mul&#34;</span><span class="op" id="8246800">,</span>&nbsp;<span class="ident" id="8246802">args</span><span class="op" id="8246806">,</span>&nbsp;<span class="ident" id="8246808">mulReply</span><span class="op" id="8246816">,</span>&nbsp;<span class="ident" id="8246818">nil</span><span class="op" id="8246821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8246824">addReply</span>&nbsp;<span class="op" id="8246833">:=</span>&nbsp;<span class="builtinfunc" id="8246836">new</span><span class="op" id="8246839">(</span><span class="ident" id="8246840">Reply</span><span class="op" id="8246845">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8246848">addCall</span>&nbsp;<span class="op" id="8246856">:=</span>&nbsp;<span class="ident" id="8246859">client</span><span class="op" id="8246865">.</span><span class="ident" id="8246866">Go</span><span class="op" id="8246868">(</span><span class="string" id="8246869">&#34;Arith.Add&#34;</span><span class="op" id="8246880">,</span>&nbsp;<span class="ident" id="8246882">args</span><span class="op" id="8246886">,</span>&nbsp;<span class="ident" id="8246888">addReply</span><span class="op" id="8246896">,</span>&nbsp;<span class="ident" id="8246898">nil</span><span class="op" id="8246901">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8246905">addCall</span>&nbsp;<span class="op" id="8246913">=</span>&nbsp;<span class="op" id="8246915">&lt;-</span><span class="ident" id="8246917">addCall</span><span class="op" id="8246924">.</span><span class="ident" id="8246925">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8246931">if</span>&nbsp;<span class="ident" id="8246934">addCall</span><span class="op" id="8246941">.</span><span class="ident" id="8246942">Error</span>&nbsp;<span class="op" id="8246948">!=</span>&nbsp;<span class="ident" id="8246951">nil</span>&nbsp;<span class="op" id="8246955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8246959">t</span><span class="op" id="8246960">.</span><span class="ident" id="8246961">Errorf</span><span class="op" id="8246967">(</span><span class="string" id="8246968">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8247010">,</span>&nbsp;<span class="ident" id="8247012">addCall</span><span class="op" id="8247019">.</span><span class="ident" id="8247020">Error</span><span class="op" id="8247025">.</span><span class="ident" id="8247026">Error</span><span class="op" id="8247031">(</span><span class="op" id="8247032">)</span><span class="op" id="8247033">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8247036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8247039">if</span>&nbsp;<span class="ident" id="8247042">addReply</span><span class="op" id="8247050">.</span><span class="ident" id="8247051">C</span>&nbsp;<span class="op" id="8247053">!=</span>&nbsp;<span class="ident" id="8247056">args</span><span class="op" id="8247060">.</span><span class="ident" id="8247061">A</span><span class="op" id="8247062">+</span><span class="ident" id="8247063">args</span><span class="op" id="8247067">.</span><span class="ident" id="8247068">B</span>&nbsp;<span class="op" id="8247070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8247074">t</span><span class="op" id="8247075">.</span><span class="ident" id="8247076">Errorf</span><span class="op" id="8247082">(</span><span class="string" id="8247083">&#34;Add:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="8247108">,</span>&nbsp;<span class="ident" id="8247110">addReply</span><span class="op" id="8247118">.</span><span class="ident" id="8247119">C</span><span class="op" id="8247120">,</span>&nbsp;<span class="ident" id="8247122">args</span><span class="op" id="8247126">.</span><span class="ident" id="8247127">A</span><span class="op" id="8247128">+</span><span class="ident" id="8247129">args</span><span class="op" id="8247133">.</span><span class="ident" id="8247134">B</span><span class="op" id="8247135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8247138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8247142">mulCall</span>&nbsp;<span class="op" id="8247150">=</span>&nbsp;<span class="op" id="8247152">&lt;-</span><span class="ident" id="8247154">mulCall</span><span class="op" id="8247161">.</span><span class="ident" id="8247162">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8247168">if</span>&nbsp;<span class="ident" id="8247171">mulCall</span><span class="op" id="8247178">.</span><span class="ident" id="8247179">Error</span>&nbsp;<span class="op" id="8247185">!=</span>&nbsp;<span class="ident" id="8247188">nil</span>&nbsp;<span class="op" id="8247192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8247196">t</span><span class="op" id="8247197">.</span><span class="ident" id="8247198">Errorf</span><span class="op" id="8247204">(</span><span class="string" id="8247205">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8247247">,</span>&nbsp;<span class="ident" id="8247249">mulCall</span><span class="op" id="8247256">.</span><span class="ident" id="8247257">Error</span><span class="op" id="8247262">.</span><span class="ident" id="8247263">Error</span><span class="op" id="8247268">(</span><span class="op" id="8247269">)</span><span class="op" id="8247270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8247273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8247276">if</span>&nbsp;<span class="ident" id="8247279">mulReply</span><span class="op" id="8247287">.</span><span class="ident" id="8247288">C</span>&nbsp;<span class="op" id="8247290">!=</span>&nbsp;<span class="ident" id="8247293">args</span><span class="op" id="8247297">.</span><span class="ident" id="8247298">A</span><span class="op" id="8247299">*</span><span class="ident" id="8247300">args</span><span class="op" id="8247304">.</span><span class="ident" id="8247305">B</span>&nbsp;<span class="op" id="8247307">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8247311">t</span><span class="op" id="8247312">.</span><span class="ident" id="8247313">Errorf</span><span class="op" id="8247319">(</span><span class="string" id="8247320">&#34;Mul:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="8247345">,</span>&nbsp;<span class="ident" id="8247347">mulReply</span><span class="op" id="8247355">.</span><span class="ident" id="8247356">C</span><span class="op" id="8247357">,</span>&nbsp;<span class="ident" id="8247359">args</span><span class="op" id="8247363">.</span><span class="ident" id="8247364">A</span><span class="op" id="8247365">*</span><span class="ident" id="8247366">args</span><span class="op" id="8247370">.</span><span class="ident" id="8247371">B</span><span class="op" id="8247372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8247375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8247379">//&nbsp;Error&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8247394">args</span>&nbsp;<span class="op" id="8247399">=</span>&nbsp;<span class="op" id="8247401">&amp;</span><span class="ident" id="8247402">Args</span><span class="op" id="8247406">{</span><span class="num" id="8247407">7</span><span class="op" id="8247408">,</span>&nbsp;<span class="num" id="8247410">0</span><span class="op" id="8247411">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8247414">reply</span>&nbsp;<span class="op" id="8247420">=</span>&nbsp;<span class="builtinfunc" id="8247422">new</span><span class="op" id="8247425">(</span><span class="ident" id="8247426">Reply</span><span class="op" id="8247431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8247434">err</span>&nbsp;<span class="op" id="8247438">=</span>&nbsp;<span class="ident" id="8247440">client</span><span class="op" id="8247446">.</span><span class="ident" id="8247447">Call</span><span class="op" id="8247451">(</span><span class="string" id="8247452">&#34;Arith.Div&#34;</span><span class="op" id="8247463">,</span>&nbsp;<span class="ident" id="8247465">args</span><span class="op" id="8247469">,</span>&nbsp;<span class="ident" id="8247471">reply</span><span class="op" id="8247476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8247479">//&nbsp;expect&nbsp;an&nbsp;error:&nbsp;zero&nbsp;divide</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8247512">if</span>&nbsp;<span class="ident" id="8247515">err</span>&nbsp;<span class="op" id="8247519">==</span>&nbsp;<span class="ident" id="8247522">nil</span>&nbsp;<span class="op" id="8247526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8247530">t</span><span class="op" id="8247531">.</span><span class="ident" id="8247532">Error</span><span class="op" id="8247537">(</span><span class="string" id="8247538">&#34;Div:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="8247559">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8247562">}</span>&nbsp;<span class="keyword" id="8247564">else</span>&nbsp;<span class="keyword" id="8247569">if</span>&nbsp;<span class="ident" id="8247572">err</span><span class="op" id="8247575">.</span><span class="ident" id="8247576">Error</span><span class="op" id="8247581">(</span><span class="op" id="8247582">)</span>&nbsp;<span class="op" id="8247584">!=</span>&nbsp;<span class="string" id="8247587">&#34;divide&nbsp;by&nbsp;zero&#34;</span>&nbsp;<span class="op" id="8247604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8247608">t</span><span class="op" id="8247609">.</span><span class="ident" id="8247610">Error</span><span class="op" id="8247615">(</span><span class="string" id="8247616">&#34;Div:&nbsp;expected&nbsp;divide&nbsp;by&nbsp;zero&nbsp;error;&nbsp;got&#34;</span><span class="op" id="8247657">,</span>&nbsp;<span class="ident" id="8247659">err</span><span class="op" id="8247662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8247665">}</span><br>
<span class="lineno"></span><span class="op" id="8247667">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="8247670">func</span>&nbsp;<span class="ident" id="8247675">TestMalformedInput</span><span class="op" id="8247693">(</span><span class="ident" id="8247694">t</span>&nbsp;<span class="op" id="8247696">*</span><span class="ident" id="8247697">testing</span><span class="op" id="8247704">.</span><span class="ident" id="8247705">T</span><span class="op" id="8247706">)</span>&nbsp;<span class="op" id="8247708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8247711">cli</span><span class="op" id="8247714">,</span>&nbsp;<span class="ident" id="8247716">srv</span>&nbsp;<span class="op" id="8247720">:=</span>&nbsp;<span class="ident" id="8247723">net</span><span class="op" id="8247726">.</span><span class="ident" id="8247727">Pipe</span><span class="op" id="8247731">(</span><span class="op" id="8247732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8247735">go</span>&nbsp;<span class="ident" id="8247738">cli</span><span class="op" id="8247741">.</span><span class="ident" id="8247742">Write</span><span class="op" id="8247747">(</span><span class="op" id="8247748">[</span><span class="op" id="8247749">]</span><span class="builtintype" id="8247750">byte</span><span class="op" id="8247754">(</span><span class="string" id="8247755">`{id:1}`</span><span class="op" id="8247763">)</span><span class="op" id="8247764">)</span>&nbsp;<span class="comment" id="8247766">//&nbsp;invalid&nbsp;json</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8247783">ServeConn</span><span class="op" id="8247792">(</span><span class="ident" id="8247793">srv</span><span class="op" id="8247796">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8247814">//&nbsp;must&nbsp;return,&nbsp;not&nbsp;loop</span><br>
<span class="lineno"></span><span class="op" id="8247839">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="keyword" id="8247842">func</span>&nbsp;<span class="ident" id="8247847">TestMalformedOutput</span><span class="op" id="8247866">(</span><span class="ident" id="8247867">t</span>&nbsp;<span class="op" id="8247869">*</span><span class="ident" id="8247870">testing</span><span class="op" id="8247877">.</span><span class="ident" id="8247878">T</span><span class="op" id="8247879">)</span>&nbsp;<span class="op" id="8247881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8247884">cli</span><span class="op" id="8247887">,</span>&nbsp;<span class="ident" id="8247889">srv</span>&nbsp;<span class="op" id="8247893">:=</span>&nbsp;<span class="ident" id="8247896">net</span><span class="op" id="8247899">.</span><span class="ident" id="8247900">Pipe</span><span class="op" id="8247904">(</span><span class="op" id="8247905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8247908">go</span>&nbsp;<span class="ident" id="8247911">srv</span><span class="op" id="8247914">.</span><span class="ident" id="8247915">Write</span><span class="op" id="8247920">(</span><span class="op" id="8247921">[</span><span class="op" id="8247922">]</span><span class="builtintype" id="8247923">byte</span><span class="op" id="8247927">(</span><span class="string" id="8247928">`{&#34;id&#34;:0,&#34;result&#34;:null,&#34;error&#34;:null}`</span><span class="op" id="8247965">)</span><span class="op" id="8247966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8247969">go</span>&nbsp;<span class="ident" id="8247972">ioutil</span><span class="op" id="8247978">.</span><span class="ident" id="8247979">ReadAll</span><span class="op" id="8247986">(</span><span class="ident" id="8247987">srv</span><span class="op" id="8247990">)</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8247994">client</span>&nbsp;<span class="op" id="8248001">:=</span>&nbsp;<span class="ident" id="8248004">NewClient</span><span class="op" id="8248013">(</span><span class="ident" id="8248014">cli</span><span class="op" id="8248017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8248020">defer</span>&nbsp;<span class="ident" id="8248026">client</span><span class="op" id="8248032">.</span><span class="ident" id="8248033">Close</span><span class="op" id="8248038">(</span><span class="op" id="8248039">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8248043">args</span>&nbsp;<span class="op" id="8248048">:=</span>&nbsp;<span class="op" id="8248051">&amp;</span><span class="ident" id="8248052">Args</span><span class="op" id="8248056">{</span><span class="num" id="8248057">7</span><span class="op" id="8248058">,</span>&nbsp;<span class="num" id="8248060">8</span><span class="op" id="8248061">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8248064">reply</span>&nbsp;<span class="op" id="8248070">:=</span>&nbsp;<span class="builtinfunc" id="8248073">new</span><span class="op" id="8248076">(</span><span class="ident" id="8248077">Reply</span><span class="op" id="8248082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8248085">err</span>&nbsp;<span class="op" id="8248089">:=</span>&nbsp;<span class="ident" id="8248092">client</span><span class="op" id="8248098">.</span><span class="ident" id="8248099">Call</span><span class="op" id="8248103">(</span><span class="string" id="8248104">&#34;Arith.Add&#34;</span><span class="op" id="8248115">,</span>&nbsp;<span class="ident" id="8248117">args</span><span class="op" id="8248121">,</span>&nbsp;<span class="ident" id="8248123">reply</span><span class="op" id="8248128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8248131">if</span>&nbsp;<span class="ident" id="8248134">err</span>&nbsp;<span class="op" id="8248138">==</span>&nbsp;<span class="ident" id="8248141">nil</span>&nbsp;<span class="op" id="8248145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8248149">t</span><span class="op" id="8248150">.</span><span class="ident" id="8248151">Error</span><span class="op" id="8248156">(</span><span class="string" id="8248157">&#34;expected&nbsp;error&#34;</span><span class="op" id="8248173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8248176">}</span><br>
<span class="lineno">205</span><span class="op" id="8248178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8248181">func</span>&nbsp;<span class="ident" id="8248186">TestServerErrorHasNullResult</span><span class="op" id="8248214">(</span><span class="ident" id="8248215">t</span>&nbsp;<span class="op" id="8248217">*</span><span class="ident" id="8248218">testing</span><span class="op" id="8248225">.</span><span class="ident" id="8248226">T</span><span class="op" id="8248227">)</span>&nbsp;<span class="op" id="8248229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8248232">var</span>&nbsp;<span class="ident" id="8248236">out</span>&nbsp;<span class="ident" id="8248240">bytes</span><span class="op" id="8248245">.</span><span class="ident" id="8248246">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8248254">sc</span>&nbsp;<span class="op" id="8248257">:=</span>&nbsp;<span class="ident" id="8248260">NewServerCodec</span><span class="op" id="8248274">(</span><span class="keyword" id="8248275">struct</span>&nbsp;<span class="op" id="8248282">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8248286">io</span><span class="op" id="8248288">.</span><span class="ident" id="8248289">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8248298">io</span><span class="op" id="8248300">.</span><span class="ident" id="8248301">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8248310">io</span><span class="op" id="8248312">.</span><span class="ident" id="8248313">Closer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8248321">}</span><span class="op" id="8248322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8248326">Reader</span><span class="op" id="8248332">:</span>&nbsp;<span class="ident" id="8248334">strings</span><span class="op" id="8248341">.</span><span class="ident" id="8248342">NewReader</span><span class="op" id="8248351">(</span><span class="string" id="8248352">`{&#34;method&#34;:&nbsp;&#34;Arith.Add&#34;,&nbsp;&#34;id&#34;:&nbsp;&#34;123&#34;,&nbsp;&#34;params&#34;:&nbsp;[]}`</span><span class="op" id="8248404">)</span><span class="op" id="8248405">,</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8248409">Writer</span><span class="op" id="8248415">:</span>&nbsp;<span class="op" id="8248417">&amp;</span><span class="ident" id="8248418">out</span><span class="op" id="8248421">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8248425">Closer</span><span class="op" id="8248431">:</span>&nbsp;<span class="ident" id="8248433">ioutil</span><span class="op" id="8248439">.</span><span class="ident" id="8248440">NopCloser</span><span class="op" id="8248449">(</span><span class="ident" id="8248450">nil</span><span class="op" id="8248453">)</span><span class="op" id="8248454">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8248457">}</span><span class="op" id="8248458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8248461">r</span>&nbsp;<span class="op" id="8248463">:=</span>&nbsp;<span class="builtinfunc" id="8248466">new</span><span class="op" id="8248469">(</span><span class="ident" id="8248470">rpc</span><span class="op" id="8248473">.</span><span class="ident" id="8248474">Request</span><span class="op" id="8248481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8248484">if</span>&nbsp;<span class="ident" id="8248487">err</span>&nbsp;<span class="op" id="8248491">:=</span>&nbsp;<span class="ident" id="8248494">sc</span><span class="op" id="8248496">.</span><span class="ident" id="8248497">ReadRequestHeader</span><span class="op" id="8248514">(</span><span class="ident" id="8248515">r</span><span class="op" id="8248516">)</span><span class="op" id="8248517">;</span>&nbsp;<span class="ident" id="8248519">err</span>&nbsp;<span class="op" id="8248523">!=</span>&nbsp;<span class="ident" id="8248526">nil</span>&nbsp;<span class="op" id="8248530">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8248534">t</span><span class="op" id="8248535">.</span><span class="ident" id="8248536">Fatal</span><span class="op" id="8248541">(</span><span class="ident" id="8248542">err</span><span class="op" id="8248545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8248548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8248551">const</span>&nbsp;<span class="ident" id="8248557">valueText</span>&nbsp;<span class="op" id="8248567">=</span>&nbsp;<span class="string" id="8248569">&#34;the&nbsp;value&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;see&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8248603">const</span>&nbsp;<span class="ident" id="8248609">errorText</span>&nbsp;<span class="op" id="8248619">=</span>&nbsp;<span class="string" id="8248621">&#34;some&nbsp;error&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8248635">err</span>&nbsp;<span class="op" id="8248639">:=</span>&nbsp;<span class="ident" id="8248642">sc</span><span class="op" id="8248644">.</span><span class="ident" id="8248645">WriteResponse</span><span class="op" id="8248658">(</span><span class="op" id="8248659">&amp;</span><span class="ident" id="8248660">rpc</span><span class="op" id="8248663">.</span><span class="ident" id="8248664">Response</span><span class="op" id="8248672">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8248676">ServiceMethod</span><span class="op" id="8248689">:</span>&nbsp;<span class="string" id="8248691">&#34;Method&#34;</span><span class="op" id="8248699">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8248703">Seq</span><span class="op" id="8248706">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8248718">1</span><span class="op" id="8248719">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8248723">Error</span><span class="op" id="8248728">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8248738">errorText</span><span class="op" id="8248747">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8248750">}</span><span class="op" id="8248751">,</span>&nbsp;<span class="ident" id="8248753">valueText</span><span class="op" id="8248762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8248765">if</span>&nbsp;<span class="ident" id="8248768">err</span>&nbsp;<span class="op" id="8248772">!=</span>&nbsp;<span class="ident" id="8248775">nil</span>&nbsp;<span class="op" id="8248779">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8248783">t</span><span class="op" id="8248784">.</span><span class="ident" id="8248785">Fatal</span><span class="op" id="8248790">(</span><span class="ident" id="8248791">err</span><span class="op" id="8248794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8248797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8248800">if</span>&nbsp;<span class="op" id="8248803">!</span><span class="ident" id="8248804">strings</span><span class="op" id="8248811">.</span><span class="ident" id="8248812">Contains</span><span class="op" id="8248820">(</span><span class="ident" id="8248821">out</span><span class="op" id="8248824">.</span><span class="ident" id="8248825">String</span><span class="op" id="8248831">(</span><span class="op" id="8248832">)</span><span class="op" id="8248833">,</span>&nbsp;<span class="ident" id="8248835">errorText</span><span class="op" id="8248844">)</span>&nbsp;<span class="op" id="8248846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8248850">t</span><span class="op" id="8248851">.</span><span class="ident" id="8248852">Fatalf</span><span class="op" id="8248858">(</span><span class="string" id="8248859">&#34;Response&nbsp;didn&#39;t&nbsp;contain&nbsp;expected&nbsp;error&nbsp;%q:&nbsp;%s&#34;</span><span class="op" id="8248906">,</span>&nbsp;<span class="ident" id="8248908">errorText</span><span class="op" id="8248917">,</span>&nbsp;<span class="op" id="8248919">&amp;</span><span class="ident" id="8248920">out</span><span class="op" id="8248923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8248926">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8248929">if</span>&nbsp;<span class="ident" id="8248932">strings</span><span class="op" id="8248939">.</span><span class="ident" id="8248940">Contains</span><span class="op" id="8248948">(</span><span class="ident" id="8248949">out</span><span class="op" id="8248952">.</span><span class="ident" id="8248953">String</span><span class="op" id="8248959">(</span><span class="op" id="8248960">)</span><span class="op" id="8248961">,</span>&nbsp;<span class="ident" id="8248963">valueText</span><span class="op" id="8248972">)</span>&nbsp;<span class="op" id="8248974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8248978">t</span><span class="op" id="8248979">.</span><span class="ident" id="8248980">Errorf</span><span class="op" id="8248986">(</span><span class="string" id="8248987">&#34;Response&nbsp;contains&nbsp;both&nbsp;an&nbsp;error&nbsp;and&nbsp;value:&nbsp;%s&#34;</span><span class="op" id="8249034">,</span>&nbsp;<span class="op" id="8249036">&amp;</span><span class="ident" id="8249037">out</span><span class="op" id="8249040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8249043">}</span><br>
<span class="lineno"></span><span class="op" id="8249045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="8249048">func</span>&nbsp;<span class="ident" id="8249053">TestUnexpectedError</span><span class="op" id="8249072">(</span><span class="ident" id="8249073">t</span>&nbsp;<span class="op" id="8249075">*</span><span class="ident" id="8249076">testing</span><span class="op" id="8249083">.</span><span class="ident" id="8249084">T</span><span class="op" id="8249085">)</span>&nbsp;<span class="op" id="8249087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8249090">cli</span><span class="op" id="8249093">,</span>&nbsp;<span class="ident" id="8249095">srv</span>&nbsp;<span class="op" id="8249099">:=</span>&nbsp;<span class="ident" id="8249102">myPipe</span><span class="op" id="8249108">(</span><span class="op" id="8249109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8249112">go</span>&nbsp;<span class="ident" id="8249115">cli</span><span class="op" id="8249118">.</span><span class="ident" id="8249119">PipeWriter</span><span class="op" id="8249129">.</span><span class="ident" id="8249130">CloseWithError</span><span class="op" id="8249144">(</span><span class="ident" id="8249145">errors</span><span class="op" id="8249151">.</span><span class="ident" id="8249152">New</span><span class="op" id="8249155">(</span><span class="string" id="8249156">&#34;unexpected&nbsp;error!&#34;</span><span class="op" id="8249175">)</span><span class="op" id="8249176">)</span>&nbsp;<span class="comment" id="8249178">//&nbsp;reader&nbsp;will&nbsp;get&nbsp;this&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8249209">ServeConn</span><span class="op" id="8249218">(</span><span class="ident" id="8249219">srv</span><span class="op" id="8249222">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8249275">//&nbsp;must&nbsp;return,&nbsp;not&nbsp;loop</span><br>
<span class="lineno"></span><span class="op" id="8249300">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="8249303">//&nbsp;Copied&nbsp;from&nbsp;package&nbsp;net.</span><br>
<span class="lineno"></span><span class="keyword" id="8249331">func</span>&nbsp;<span class="ident" id="8249336">myPipe</span><span class="op" id="8249342">(</span><span class="op" id="8249343">)</span>&nbsp;<span class="op" id="8249345">(</span><span class="op" id="8249346">*</span><span class="ident" id="8249347">pipe</span><span class="op" id="8249351">,</span>&nbsp;<span class="op" id="8249353">*</span><span class="ident" id="8249354">pipe</span><span class="op" id="8249358">)</span>&nbsp;<span class="op" id="8249360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8249363">r1</span><span class="op" id="8249365">,</span>&nbsp;<span class="ident" id="8249367">w1</span>&nbsp;<span class="op" id="8249370">:=</span>&nbsp;<span class="ident" id="8249373">io</span><span class="op" id="8249375">.</span><span class="ident" id="8249376">Pipe</span><span class="op" id="8249380">(</span><span class="op" id="8249381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8249384">r2</span><span class="op" id="8249386">,</span>&nbsp;<span class="ident" id="8249388">w2</span>&nbsp;<span class="op" id="8249391">:=</span>&nbsp;<span class="ident" id="8249394">io</span><span class="op" id="8249396">.</span><span class="ident" id="8249397">Pipe</span><span class="op" id="8249401">(</span><span class="op" id="8249402">)</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8249406">return</span>&nbsp;<span class="op" id="8249413">&amp;</span><span class="ident" id="8249414">pipe</span><span class="op" id="8249418">{</span><span class="ident" id="8249419">r1</span><span class="op" id="8249421">,</span>&nbsp;<span class="ident" id="8249423">w2</span><span class="op" id="8249425">}</span><span class="op" id="8249426">,</span>&nbsp;<span class="op" id="8249428">&amp;</span><span class="ident" id="8249429">pipe</span><span class="op" id="8249433">{</span><span class="ident" id="8249434">r2</span><span class="op" id="8249436">,</span>&nbsp;<span class="ident" id="8249438">w1</span><span class="op" id="8249440">}</span><br>
<span class="lineno"></span><span class="op" id="8249442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8249445">type</span>&nbsp;<span class="ident" id="8249450">pipe</span>&nbsp;<span class="keyword" id="8249455">struct</span>&nbsp;<span class="op" id="8249462">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8249465">*</span><span class="ident" id="8249466">io</span><span class="op" id="8249468">.</span><span class="ident" id="8249469">PipeReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8249481">*</span><span class="ident" id="8249482">io</span><span class="op" id="8249484">.</span><span class="ident" id="8249485">PipeWriter</span><br>
<span class="lineno"></span><span class="op" id="8249496">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8249499">type</span>&nbsp;<span class="ident" id="8249504">pipeAddr</span>&nbsp;<span class="builtintype" id="8249513">int</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="keyword" id="8249518">func</span>&nbsp;<span class="op" id="8249523">(</span><span class="ident" id="8249524">pipeAddr</span><span class="op" id="8249532">)</span>&nbsp;<span class="ident" id="8249534">Network</span><span class="op" id="8249541">(</span><span class="op" id="8249542">)</span>&nbsp;<span class="builtintype" id="8249544">string</span>&nbsp;<span class="op" id="8249551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8249554">return</span>&nbsp;<span class="string" id="8249561">&#34;pipe&#34;</span><br>
<span class="lineno"></span><span class="op" id="8249568">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span><span class="keyword" id="8249571">func</span>&nbsp;<span class="op" id="8249576">(</span><span class="ident" id="8249577">pipeAddr</span><span class="op" id="8249585">)</span>&nbsp;<span class="ident" id="8249587">String</span><span class="op" id="8249593">(</span><span class="op" id="8249594">)</span>&nbsp;<span class="builtintype" id="8249596">string</span>&nbsp;<span class="op" id="8249603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8249606">return</span>&nbsp;<span class="string" id="8249613">&#34;pipe&#34;</span><br>
<span class="lineno"></span><span class="op" id="8249620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8249623">func</span>&nbsp;<span class="op" id="8249628">(</span><span class="ident" id="8249629">p</span>&nbsp;<span class="op" id="8249631">*</span><span class="ident" id="8249632">pipe</span><span class="op" id="8249636">)</span>&nbsp;<span class="ident" id="8249638">Close</span><span class="op" id="8249643">(</span><span class="op" id="8249644">)</span>&nbsp;<span class="builtintype" id="8249646">error</span>&nbsp;<span class="op" id="8249652">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8249655">err</span>&nbsp;<span class="op" id="8249659">:=</span>&nbsp;<span class="ident" id="8249662">p</span><span class="op" id="8249663">.</span><span class="ident" id="8249664">PipeReader</span><span class="op" id="8249674">.</span><span class="ident" id="8249675">Close</span><span class="op" id="8249680">(</span><span class="op" id="8249681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8249684">err1</span>&nbsp;<span class="op" id="8249689">:=</span>&nbsp;<span class="ident" id="8249692">p</span><span class="op" id="8249693">.</span><span class="ident" id="8249694">PipeWriter</span><span class="op" id="8249704">.</span><span class="ident" id="8249705">Close</span><span class="op" id="8249710">(</span><span class="op" id="8249711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8249714">if</span>&nbsp;<span class="ident" id="8249717">err</span>&nbsp;<span class="op" id="8249721">==</span>&nbsp;<span class="ident" id="8249724">nil</span>&nbsp;<span class="op" id="8249728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8249732">err</span>&nbsp;<span class="op" id="8249736">=</span>&nbsp;<span class="ident" id="8249738">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8249744">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8249747">return</span>&nbsp;<span class="ident" id="8249754">err</span><br>
<span class="lineno"></span><span class="op" id="8249758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8249761">func</span>&nbsp;<span class="op" id="8249766">(</span><span class="ident" id="8249767">p</span>&nbsp;<span class="op" id="8249769">*</span><span class="ident" id="8249770">pipe</span><span class="op" id="8249774">)</span>&nbsp;<span class="ident" id="8249776">LocalAddr</span><span class="op" id="8249785">(</span><span class="op" id="8249786">)</span>&nbsp;<span class="ident" id="8249788">net</span><span class="op" id="8249791">.</span><span class="ident" id="8249792">Addr</span>&nbsp;<span class="op" id="8249797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8249800">return</span>&nbsp;<span class="ident" id="8249807">pipeAddr</span><span class="op" id="8249815">(</span><span class="num" id="8249816">0</span><span class="op" id="8249817">)</span><br>
<span class="lineno">280</span><span class="op" id="8249819">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8249822">func</span>&nbsp;<span class="op" id="8249827">(</span><span class="ident" id="8249828">p</span>&nbsp;<span class="op" id="8249830">*</span><span class="ident" id="8249831">pipe</span><span class="op" id="8249835">)</span>&nbsp;<span class="ident" id="8249837">RemoteAddr</span><span class="op" id="8249847">(</span><span class="op" id="8249848">)</span>&nbsp;<span class="ident" id="8249850">net</span><span class="op" id="8249853">.</span><span class="ident" id="8249854">Addr</span>&nbsp;<span class="op" id="8249859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8249862">return</span>&nbsp;<span class="ident" id="8249869">pipeAddr</span><span class="op" id="8249877">(</span><span class="num" id="8249878">0</span><span class="op" id="8249879">)</span><br>
<span class="lineno"></span><span class="op" id="8249881">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="keyword" id="8249884">func</span>&nbsp;<span class="op" id="8249889">(</span><span class="ident" id="8249890">p</span>&nbsp;<span class="op" id="8249892">*</span><span class="ident" id="8249893">pipe</span><span class="op" id="8249897">)</span>&nbsp;<span class="ident" id="8249899">SetTimeout</span><span class="op" id="8249909">(</span><span class="ident" id="8249910">nsec</span>&nbsp;<span class="ident" id="8249915">int64</span><span class="op" id="8249920">)</span>&nbsp;<span class="builtintype" id="8249922">error</span>&nbsp;<span class="op" id="8249928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8249931">return</span>&nbsp;<span class="ident" id="8249938">errors</span><span class="op" id="8249944">.</span><span class="ident" id="8249945">New</span><span class="op" id="8249948">(</span><span class="string" id="8249949">&#34;net.Pipe&nbsp;does&nbsp;not&nbsp;support&nbsp;timeouts&#34;</span><span class="op" id="8249985">)</span><br>
<span class="lineno"></span><span class="op" id="8249987">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="keyword" id="8249990">func</span>&nbsp;<span class="op" id="8249995">(</span><span class="ident" id="8249996">p</span>&nbsp;<span class="op" id="8249998">*</span><span class="ident" id="8249999">pipe</span><span class="op" id="8250003">)</span>&nbsp;<span class="ident" id="8250005">SetReadTimeout</span><span class="op" id="8250019">(</span><span class="ident" id="8250020">nsec</span>&nbsp;<span class="ident" id="8250025">int64</span><span class="op" id="8250030">)</span>&nbsp;<span class="builtintype" id="8250032">error</span>&nbsp;<span class="op" id="8250038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8250041">return</span>&nbsp;<span class="ident" id="8250048">errors</span><span class="op" id="8250054">.</span><span class="ident" id="8250055">New</span><span class="op" id="8250058">(</span><span class="string" id="8250059">&#34;net.Pipe&nbsp;does&nbsp;not&nbsp;support&nbsp;timeouts&#34;</span><span class="op" id="8250095">)</span><br>
<span class="lineno"></span><span class="op" id="8250097">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8250100">func</span>&nbsp;<span class="op" id="8250105">(</span><span class="ident" id="8250106">p</span>&nbsp;<span class="op" id="8250108">*</span><span class="ident" id="8250109">pipe</span><span class="op" id="8250113">)</span>&nbsp;<span class="ident" id="8250115">SetWriteTimeout</span><span class="op" id="8250130">(</span><span class="ident" id="8250131">nsec</span>&nbsp;<span class="ident" id="8250136">int64</span><span class="op" id="8250141">)</span>&nbsp;<span class="builtintype" id="8250143">error</span>&nbsp;<span class="op" id="8250149">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8250152">return</span>&nbsp;<span class="ident" id="8250159">errors</span><span class="op" id="8250165">.</span><span class="ident" id="8250166">New</span><span class="op" id="8250169">(</span><span class="string" id="8250170">&#34;net.Pipe&nbsp;does&nbsp;not&nbsp;support&nbsp;timeouts&#34;</span><span class="op" id="8250206">)</span><br>
<span class="lineno"></span><span class="op" id="8250208">}</span>
</div>
</body>
</html>
