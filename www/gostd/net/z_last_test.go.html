<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html" class="current">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6773985">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6774040">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6774094">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6774145">package</span>&nbsp;<span class="ident" id="6774153">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6774158">import</span>&nbsp;<span class="op" id="6774165">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6774168">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6774176">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6774183">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6774194">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6774201">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6774204">var</span>&nbsp;<span class="ident" id="6774208">testDNSFlood</span>&nbsp;<span class="op" id="6774221">=</span>&nbsp;<span class="ident" id="6774223">flag</span><span class="op" id="6774227">.</span><span class="ident" id="6774228">Bool</span><span class="op" id="6774232">(</span><span class="string" id="6774233">&#34;dnsflood&#34;</span><span class="op" id="6774243">,</span>&nbsp;<span class="builtintype" id="6774245">false</span><span class="op" id="6774250">,</span>&nbsp;<span class="string" id="6774252">&#34;whether&nbsp;to&nbsp;test&nbsp;dns&nbsp;query&nbsp;flooding&#34;</span><span class="op" id="6774288">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="6774291">func</span>&nbsp;<span class="ident" id="6774296">TestDNSThreadLimit</span><span class="op" id="6774314">(</span><span class="ident" id="6774315">t</span>&nbsp;<span class="op" id="6774317">*</span><span class="ident" id="6774318">testing</span><span class="op" id="6774325">.</span><span class="ident" id="6774326">T</span><span class="op" id="6774327">)</span>&nbsp;<span class="op" id="6774329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6774332">if</span>&nbsp;<span class="op" id="6774335">!</span><span class="op" id="6774336">*</span><span class="ident" id="6774337">testDNSFlood</span>&nbsp;<span class="op" id="6774350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6774354">t</span><span class="op" id="6774355">.</span><span class="ident" id="6774356">Skip</span><span class="op" id="6774360">(</span><span class="string" id="6774361">&#34;test&nbsp;disabled;&nbsp;use&nbsp;-dnsflood&nbsp;to&nbsp;enable&#34;</span><span class="op" id="6774401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6774404">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6774408">const</span>&nbsp;<span class="ident" id="6774414">N</span>&nbsp;<span class="op" id="6774416">=</span>&nbsp;<span class="num" id="6774418">10000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6774425">c</span>&nbsp;<span class="op" id="6774427">:=</span>&nbsp;<span class="builtinfunc" id="6774430">make</span><span class="op" id="6774434">(</span><span class="keyword" id="6774435">chan</span>&nbsp;<span class="builtintype" id="6774440">int</span><span class="op" id="6774443">,</span>&nbsp;<span class="ident" id="6774445">N</span><span class="op" id="6774446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6774449">for</span>&nbsp;<span class="ident" id="6774453">i</span>&nbsp;<span class="op" id="6774455">:=</span>&nbsp;<span class="num" id="6774458">0</span><span class="op" id="6774459">;</span>&nbsp;<span class="ident" id="6774461">i</span>&nbsp;<span class="op" id="6774463">&lt;</span>&nbsp;<span class="ident" id="6774465">N</span><span class="op" id="6774466">;</span>&nbsp;<span class="ident" id="6774468">i</span><span class="op" id="6774469">++</span>&nbsp;<span class="op" id="6774472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6774476">go</span>&nbsp;<span class="keyword" id="6774479">func</span><span class="op" id="6774483">(</span><span class="ident" id="6774484">i</span>&nbsp;<span class="builtintype" id="6774486">int</span><span class="op" id="6774489">)</span>&nbsp;<span class="op" id="6774491">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6774496">LookupIP</span><span class="op" id="6774504">(</span><span class="ident" id="6774505">fmt</span><span class="op" id="6774508">.</span><span class="ident" id="6774509">Sprintf</span><span class="op" id="6774516">(</span><span class="string" id="6774517">&#34;%d.net-test.golang.org&#34;</span><span class="op" id="6774541">,</span>&nbsp;<span class="ident" id="6774543">i</span><span class="op" id="6774544">)</span><span class="op" id="6774545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6774550">c</span>&nbsp;<span class="op" id="6774552">&lt;-</span>&nbsp;<span class="num" id="6774555">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6774559">}</span><span class="op" id="6774560">(</span><span class="ident" id="6774561">i</span><span class="op" id="6774562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6774565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6774568">//&nbsp;Don&#39;t&nbsp;bother&nbsp;waiting&nbsp;for&nbsp;the&nbsp;stragglers;&nbsp;stop&nbsp;at&nbsp;0.9&nbsp;N.</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6774628">for</span>&nbsp;<span class="ident" id="6774632">i</span>&nbsp;<span class="op" id="6774634">:=</span>&nbsp;<span class="num" id="6774637">0</span><span class="op" id="6774638">;</span>&nbsp;<span class="ident" id="6774640">i</span>&nbsp;<span class="op" id="6774642">&lt;</span>&nbsp;<span class="ident" id="6774644">N</span><span class="op" id="6774645">*</span><span class="num" id="6774646">9</span><span class="op" id="6774647">/</span><span class="num" id="6774648">10</span><span class="op" id="6774650">;</span>&nbsp;<span class="ident" id="6774652">i</span><span class="op" id="6774653">++</span>&nbsp;<span class="op" id="6774656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6774660">if</span>&nbsp;<span class="ident" id="6774663">i</span><span class="op" id="6774664">%</span><span class="num" id="6774665">100</span>&nbsp;<span class="op" id="6774669">==</span>&nbsp;<span class="num" id="6774672">0</span>&nbsp;<span class="op" id="6774674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6774679">//println(&#34;TestDNSThreadLimit:&#34;,&nbsp;i)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6774717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6774721">&lt;-</span><span class="ident" id="6774723">c</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6774726">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6774730">//&nbsp;If&nbsp;we&#39;re&nbsp;still&nbsp;here,&nbsp;it&nbsp;worked.</span><br>
<span class="lineno"></span><span class="op" id="6774765">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="6774768">func</span>&nbsp;<span class="ident" id="6774773">TestLookupIPDeadline</span><span class="op" id="6774793">(</span><span class="ident" id="6774794">t</span>&nbsp;<span class="op" id="6774796">*</span><span class="ident" id="6774797">testing</span><span class="op" id="6774804">.</span><span class="ident" id="6774805">T</span><span class="op" id="6774806">)</span>&nbsp;<span class="op" id="6774808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6774811">if</span>&nbsp;<span class="op" id="6774814">!</span><span class="op" id="6774815">*</span><span class="ident" id="6774816">testDNSFlood</span>&nbsp;<span class="op" id="6774829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6774833">t</span><span class="op" id="6774834">.</span><span class="ident" id="6774835">Skip</span><span class="op" id="6774839">(</span><span class="string" id="6774840">&#34;test&nbsp;disabled;&nbsp;use&nbsp;-dnsflood&nbsp;to&nbsp;enable&#34;</span><span class="op" id="6774880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6774883">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6774887">const</span>&nbsp;<span class="ident" id="6774893">N</span>&nbsp;<span class="op" id="6774895">=</span>&nbsp;<span class="num" id="6774897">5000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6774903">const</span>&nbsp;<span class="ident" id="6774909">timeout</span>&nbsp;<span class="op" id="6774917">=</span>&nbsp;<span class="num" id="6774919">3</span>&nbsp;<span class="op" id="6774921">*</span>&nbsp;<span class="ident" id="6774923">time</span><span class="op" id="6774927">.</span><span class="ident" id="6774928">Second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6774936">c</span>&nbsp;<span class="op" id="6774938">:=</span>&nbsp;<span class="builtinfunc" id="6774941">make</span><span class="op" id="6774945">(</span><span class="keyword" id="6774946">chan</span>&nbsp;<span class="builtintype" id="6774951">error</span><span class="op" id="6774956">,</span>&nbsp;<span class="num" id="6774958">2</span><span class="op" id="6774959">*</span><span class="ident" id="6774960">N</span><span class="op" id="6774961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6774964">for</span>&nbsp;<span class="ident" id="6774968">i</span>&nbsp;<span class="op" id="6774970">:=</span>&nbsp;<span class="num" id="6774973">0</span><span class="op" id="6774974">;</span>&nbsp;<span class="ident" id="6774976">i</span>&nbsp;<span class="op" id="6774978">&lt;</span>&nbsp;<span class="ident" id="6774980">N</span><span class="op" id="6774981">;</span>&nbsp;<span class="ident" id="6774983">i</span><span class="op" id="6774984">++</span>&nbsp;<span class="op" id="6774987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6774991">name</span>&nbsp;<span class="op" id="6774996">:=</span>&nbsp;<span class="ident" id="6774999">fmt</span><span class="op" id="6775002">.</span><span class="ident" id="6775003">Sprintf</span><span class="op" id="6775010">(</span><span class="string" id="6775011">&#34;%d.net-test.golang.org&#34;</span><span class="op" id="6775035">,</span>&nbsp;<span class="ident" id="6775037">i</span><span class="op" id="6775038">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6775042">go</span>&nbsp;<span class="keyword" id="6775045">func</span><span class="op" id="6775049">(</span><span class="op" id="6775050">)</span>&nbsp;<span class="op" id="6775052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6775057">_</span><span class="op" id="6775058">,</span>&nbsp;<span class="ident" id="6775060">err</span>&nbsp;<span class="op" id="6775064">:=</span>&nbsp;<span class="ident" id="6775067">lookupIPDeadline</span><span class="op" id="6775083">(</span><span class="ident" id="6775084">name</span><span class="op" id="6775088">,</span>&nbsp;<span class="ident" id="6775090">time</span><span class="op" id="6775094">.</span><span class="ident" id="6775095">Now</span><span class="op" id="6775098">(</span><span class="op" id="6775099">)</span><span class="op" id="6775100">.</span><span class="ident" id="6775101">Add</span><span class="op" id="6775104">(</span><span class="ident" id="6775105">timeout</span><span class="op" id="6775112">/</span><span class="num" id="6775113">2</span><span class="op" id="6775114">)</span><span class="op" id="6775115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6775120">c</span>&nbsp;<span class="op" id="6775122">&lt;-</span>&nbsp;<span class="ident" id="6775125">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6775131">}</span><span class="op" id="6775132">(</span><span class="op" id="6775133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6775137">go</span>&nbsp;<span class="keyword" id="6775140">func</span><span class="op" id="6775144">(</span><span class="op" id="6775145">)</span>&nbsp;<span class="op" id="6775147">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6775152">_</span><span class="op" id="6775153">,</span>&nbsp;<span class="ident" id="6775155">err</span>&nbsp;<span class="op" id="6775159">:=</span>&nbsp;<span class="ident" id="6775162">lookupIPDeadline</span><span class="op" id="6775178">(</span><span class="ident" id="6775179">name</span><span class="op" id="6775183">,</span>&nbsp;<span class="ident" id="6775185">time</span><span class="op" id="6775189">.</span><span class="ident" id="6775190">Now</span><span class="op" id="6775193">(</span><span class="op" id="6775194">)</span><span class="op" id="6775195">.</span><span class="ident" id="6775196">Add</span><span class="op" id="6775199">(</span><span class="ident" id="6775200">timeout</span><span class="op" id="6775207">)</span><span class="op" id="6775208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6775213">c</span>&nbsp;<span class="op" id="6775215">&lt;-</span>&nbsp;<span class="ident" id="6775218">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6775224">}</span><span class="op" id="6775225">(</span><span class="op" id="6775226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6775229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6775232">qstats</span>&nbsp;<span class="op" id="6775239">:=</span>&nbsp;<span class="keyword" id="6775242">struct</span>&nbsp;<span class="op" id="6775249">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6775253">succeeded</span><span class="op" id="6775262">,</span>&nbsp;<span class="ident" id="6775264">failed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6775279">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6775285">timeout</span><span class="op" id="6775292">,</span>&nbsp;<span class="ident" id="6775294">temporary</span><span class="op" id="6775303">,</span>&nbsp;<span class="ident" id="6775305">other</span>&nbsp;<span class="builtintype" id="6775311">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6775317">unknown</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6775343">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6775348">}</span><span class="op" id="6775349">{</span><span class="op" id="6775350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6775353">deadline</span>&nbsp;<span class="op" id="6775362">:=</span>&nbsp;<span class="ident" id="6775365">time</span><span class="op" id="6775369">.</span><span class="ident" id="6775370">After</span><span class="op" id="6775375">(</span><span class="ident" id="6775376">timeout</span>&nbsp;<span class="op" id="6775384">+</span>&nbsp;<span class="ident" id="6775386">time</span><span class="op" id="6775390">.</span><span class="ident" id="6775391">Second</span><span class="op" id="6775397">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6775400">for</span>&nbsp;<span class="ident" id="6775404">i</span>&nbsp;<span class="op" id="6775406">:=</span>&nbsp;<span class="num" id="6775409">0</span><span class="op" id="6775410">;</span>&nbsp;<span class="ident" id="6775412">i</span>&nbsp;<span class="op" id="6775414">&lt;</span>&nbsp;<span class="num" id="6775416">2</span><span class="op" id="6775417">*</span><span class="ident" id="6775418">N</span><span class="op" id="6775419">;</span>&nbsp;<span class="ident" id="6775421">i</span><span class="op" id="6775422">++</span>&nbsp;<span class="op" id="6775425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6775429">select</span>&nbsp;<span class="op" id="6775436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6775440">case</span>&nbsp;<span class="op" id="6775445">&lt;-</span><span class="ident" id="6775447">deadline</span><span class="op" id="6775455">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6775460">t</span><span class="op" id="6775461">.</span><span class="ident" id="6775462">Fatal</span><span class="op" id="6775467">(</span><span class="string" id="6775468">&#34;deadline&nbsp;exceeded&#34;</span><span class="op" id="6775487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6775491">case</span>&nbsp;<span class="ident" id="6775496">err</span>&nbsp;<span class="op" id="6775500">:=</span>&nbsp;<span class="op" id="6775503">&lt;-</span><span class="ident" id="6775505">c</span><span class="op" id="6775506">:</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6775511">switch</span>&nbsp;<span class="ident" id="6775518">err</span>&nbsp;<span class="op" id="6775522">:=</span>&nbsp;<span class="ident" id="6775525">err</span><span class="op" id="6775528">.</span><span class="op" id="6775529">(</span><span class="keyword" id="6775530">type</span><span class="op" id="6775534">)</span>&nbsp;<span class="op" id="6775536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6775541">case</span>&nbsp;<span class="ident" id="6775546">nil</span><span class="op" id="6775549">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6775555">qstats</span><span class="op" id="6775561">.</span><span class="ident" id="6775562">succeeded</span><span class="op" id="6775571">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6775577">case</span>&nbsp;<span class="ident" id="6775582">Error</span><span class="op" id="6775587">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6775593">qstats</span><span class="op" id="6775599">.</span><span class="ident" id="6775600">failed</span><span class="op" id="6775606">++</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6775613">if</span>&nbsp;<span class="ident" id="6775616">err</span><span class="op" id="6775619">.</span><span class="ident" id="6775620">Timeout</span><span class="op" id="6775627">(</span><span class="op" id="6775628">)</span>&nbsp;<span class="op" id="6775630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6775637">qstats</span><span class="op" id="6775643">.</span><span class="ident" id="6775644">timeout</span><span class="op" id="6775651">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6775658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6775664">if</span>&nbsp;<span class="ident" id="6775667">err</span><span class="op" id="6775670">.</span><span class="ident" id="6775671">Temporary</span><span class="op" id="6775680">(</span><span class="op" id="6775681">)</span>&nbsp;<span class="op" id="6775683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6775690">qstats</span><span class="op" id="6775696">.</span><span class="ident" id="6775697">temporary</span><span class="op" id="6775706">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6775713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6775719">if</span>&nbsp;<span class="op" id="6775722">!</span><span class="ident" id="6775723">err</span><span class="op" id="6775726">.</span><span class="ident" id="6775727">Timeout</span><span class="op" id="6775734">(</span><span class="op" id="6775735">)</span>&nbsp;<span class="op" id="6775737">&amp;&amp;</span>&nbsp;<span class="op" id="6775740">!</span><span class="ident" id="6775741">err</span><span class="op" id="6775744">.</span><span class="ident" id="6775745">Temporary</span><span class="op" id="6775754">(</span><span class="op" id="6775755">)</span>&nbsp;<span class="op" id="6775757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6775764">qstats</span><span class="op" id="6775770">.</span><span class="ident" id="6775771">other</span><span class="op" id="6775776">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6775783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6775788">default</span><span class="op" id="6775795">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6775801">qstats</span><span class="op" id="6775807">.</span><span class="ident" id="6775808">failed</span><span class="op" id="6775814">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6775821">qstats</span><span class="op" id="6775827">.</span><span class="ident" id="6775828">unknown</span><span class="op" id="6775835">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6775841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6775845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6775848">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6775852">//&nbsp;A&nbsp;high&nbsp;volume&nbsp;of&nbsp;DNS&nbsp;queries&nbsp;for&nbsp;sub-domain&nbsp;of&nbsp;golang.org</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6775914">//&nbsp;would&nbsp;be&nbsp;coordinated&nbsp;by&nbsp;authoritative&nbsp;or&nbsp;recursive&nbsp;server,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6775977">//&nbsp;or&nbsp;stub&nbsp;resolver&nbsp;which&nbsp;implements&nbsp;query-response&nbsp;rate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6776035">//&nbsp;limitation,&nbsp;so&nbsp;we&nbsp;can&nbsp;expect&nbsp;some&nbsp;query&nbsp;successes&nbsp;and&nbsp;more</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6776098">//&nbsp;failures&nbsp;including&nbsp;timeout,&nbsp;temporary&nbsp;and&nbsp;other&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6776156">//&nbsp;As&nbsp;a&nbsp;rule,&nbsp;unknown&nbsp;must&nbsp;not&nbsp;be&nbsp;shown&nbsp;but&nbsp;it&nbsp;might&nbsp;possibly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6776219">//&nbsp;happen&nbsp;due&nbsp;to&nbsp;issue&nbsp;4856&nbsp;for&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6776257">t</span><span class="op" id="6776258">.</span><span class="ident" id="6776259">Logf</span><span class="op" id="6776263">(</span><span class="string" id="6776264">&#34;%v&nbsp;succeeded,&nbsp;%v&nbsp;failed&nbsp;(%v&nbsp;timeout,&nbsp;%v&nbsp;temporary,&nbsp;%v&nbsp;other,&nbsp;%v&nbsp;unknown)&#34;</span><span class="op" id="6776338">,</span>&nbsp;<span class="ident" id="6776340">qstats</span><span class="op" id="6776346">.</span><span class="ident" id="6776347">succeeded</span><span class="op" id="6776356">,</span>&nbsp;<span class="ident" id="6776358">qstats</span><span class="op" id="6776364">.</span><span class="ident" id="6776365">failed</span><span class="op" id="6776371">,</span>&nbsp;<span class="ident" id="6776373">qstats</span><span class="op" id="6776379">.</span><span class="ident" id="6776380">timeout</span><span class="op" id="6776387">,</span>&nbsp;<span class="ident" id="6776389">qstats</span><span class="op" id="6776395">.</span><span class="ident" id="6776396">temporary</span><span class="op" id="6776405">,</span>&nbsp;<span class="ident" id="6776407">qstats</span><span class="op" id="6776413">.</span><span class="ident" id="6776414">other</span><span class="op" id="6776419">,</span>&nbsp;<span class="ident" id="6776421">qstats</span><span class="op" id="6776427">.</span><span class="ident" id="6776428">unknown</span><span class="op" id="6776435">)</span><br>
<span class="lineno"></span><span class="op" id="6776437">}</span>
</div>
</body>
</html>
