<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3273970">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3274025">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3274079">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3274130">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;sysSocket&nbsp;and&nbsp;accept&nbsp;for&nbsp;platforms&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3274194">//&nbsp;provide&nbsp;a&nbsp;fast&nbsp;path&nbsp;for&nbsp;setting&nbsp;SetNonblock&nbsp;and&nbsp;CloseOnExec.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3274259">//&nbsp;+build&nbsp;freebsd&nbsp;linux</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="3274284">package</span>&nbsp;<span class="ident" id="3274292">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3274297">import</span>&nbsp;<span class="string" id="3274304">&#34;syscall&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3274315">//&nbsp;Wrapper&nbsp;around&nbsp;the&nbsp;socket&nbsp;system&nbsp;call&nbsp;that&nbsp;marks&nbsp;the&nbsp;returned&nbsp;file</span><br>
<span class="lineno">15</span><span class="comment" id="3274385">//&nbsp;descriptor&nbsp;as&nbsp;nonblocking&nbsp;and&nbsp;close-on-exec.</span><br>
<span class="lineno"></span><span class="keyword" id="3274433">func</span>&nbsp;<span class="ident" id="3274438">sysSocket</span><span class="op" id="3274447">(</span><span class="ident" id="3274448">family</span><span class="op" id="3274454">,</span>&nbsp;<span class="ident" id="3274456">sotype</span><span class="op" id="3274462">,</span>&nbsp;<span class="ident" id="3274464">proto</span>&nbsp;<span class="builtintype" id="3274470">int</span><span class="op" id="3274473">)</span>&nbsp;<span class="op" id="3274475">(</span><span class="builtintype" id="3274476">int</span><span class="op" id="3274479">,</span>&nbsp;<span class="builtintype" id="3274481">error</span><span class="op" id="3274486">)</span>&nbsp;<span class="op" id="3274488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3274491">s</span><span class="op" id="3274492">,</span>&nbsp;<span class="ident" id="3274494">err</span>&nbsp;<span class="op" id="3274498">:=</span>&nbsp;<span class="ident" id="3274501">syscall</span><span class="op" id="3274508">.</span><span class="ident" id="3274509">Socket</span><span class="op" id="3274515">(</span><span class="ident" id="3274516">family</span><span class="op" id="3274522">,</span>&nbsp;<span class="ident" id="3274524">sotype</span><span class="op" id="3274530">|</span><span class="ident" id="3274531">syscall</span><span class="op" id="3274538">.</span><span class="ident" id="3274539">SOCK_NONBLOCK</span><span class="op" id="3274552">|</span><span class="ident" id="3274553">syscall</span><span class="op" id="3274560">.</span><span class="ident" id="3274561">SOCK_CLOEXEC</span><span class="op" id="3274573">,</span>&nbsp;<span class="ident" id="3274575">proto</span><span class="op" id="3274580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3274583">//&nbsp;On&nbsp;Linux&nbsp;the&nbsp;SOCK_NONBLOCK&nbsp;and&nbsp;SOCK_CLOEXEC&nbsp;flags&nbsp;were</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3274642">//&nbsp;introduced&nbsp;in&nbsp;2.6.27&nbsp;kernel&nbsp;and&nbsp;on&nbsp;FreeBSD&nbsp;both&nbsp;flags&nbsp;were</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3274705">//&nbsp;introduced&nbsp;in&nbsp;10&nbsp;kernel.&nbsp;If&nbsp;we&nbsp;get&nbsp;an&nbsp;EINVAL&nbsp;error&nbsp;on&nbsp;Linux</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3274769">//&nbsp;or&nbsp;EPROTONOSUPPORT&nbsp;error&nbsp;on&nbsp;FreeBSD,&nbsp;fall&nbsp;back&nbsp;to&nbsp;using</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3274829">//&nbsp;socket&nbsp;without&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3274854">if</span>&nbsp;<span class="ident" id="3274857">err</span>&nbsp;<span class="op" id="3274861">==</span>&nbsp;<span class="ident" id="3274864">nil</span>&nbsp;<span class="op" id="3274868">||</span>&nbsp;<span class="op" id="3274871">(</span><span class="ident" id="3274872">err</span>&nbsp;<span class="op" id="3274876">!=</span>&nbsp;<span class="ident" id="3274879">syscall</span><span class="op" id="3274886">.</span><span class="ident" id="3274887">EPROTONOSUPPORT</span>&nbsp;<span class="op" id="3274903">&amp;&amp;</span>&nbsp;<span class="ident" id="3274906">err</span>&nbsp;<span class="op" id="3274910">!=</span>&nbsp;<span class="ident" id="3274913">syscall</span><span class="op" id="3274920">.</span><span class="ident" id="3274921">EINVAL</span><span class="op" id="3274927">)</span>&nbsp;<span class="op" id="3274929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3274933">return</span>&nbsp;<span class="ident" id="3274940">s</span><span class="op" id="3274941">,</span>&nbsp;<span class="ident" id="3274943">err</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3274948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3274952">//&nbsp;See&nbsp;../syscall/exec_unix.go&nbsp;for&nbsp;description&nbsp;of&nbsp;ForkLock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3275013">syscall</span><span class="op" id="3275020">.</span><span class="ident" id="3275021">ForkLock</span><span class="op" id="3275029">.</span><span class="ident" id="3275030">RLock</span><span class="op" id="3275035">(</span><span class="op" id="3275036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3275039">s</span><span class="op" id="3275040">,</span>&nbsp;<span class="ident" id="3275042">err</span>&nbsp;<span class="op" id="3275046">=</span>&nbsp;<span class="ident" id="3275048">syscall</span><span class="op" id="3275055">.</span><span class="ident" id="3275056">Socket</span><span class="op" id="3275062">(</span><span class="ident" id="3275063">family</span><span class="op" id="3275069">,</span>&nbsp;<span class="ident" id="3275071">sotype</span><span class="op" id="3275077">,</span>&nbsp;<span class="ident" id="3275079">proto</span><span class="op" id="3275084">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3275087">if</span>&nbsp;<span class="ident" id="3275090">err</span>&nbsp;<span class="op" id="3275094">==</span>&nbsp;<span class="ident" id="3275097">nil</span>&nbsp;<span class="op" id="3275101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3275105">syscall</span><span class="op" id="3275112">.</span><span class="ident" id="3275113">CloseOnExec</span><span class="op" id="3275124">(</span><span class="ident" id="3275125">s</span><span class="op" id="3275126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3275129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3275132">syscall</span><span class="op" id="3275139">.</span><span class="ident" id="3275140">ForkLock</span><span class="op" id="3275148">.</span><span class="ident" id="3275149">RUnlock</span><span class="op" id="3275156">(</span><span class="op" id="3275157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3275160">if</span>&nbsp;<span class="ident" id="3275163">err</span>&nbsp;<span class="op" id="3275167">!=</span>&nbsp;<span class="ident" id="3275170">nil</span>&nbsp;<span class="op" id="3275174">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3275178">return</span>&nbsp;<span class="op" id="3275185">-</span><span class="num" id="3275186">1</span><span class="op" id="3275187">,</span>&nbsp;<span class="ident" id="3275189">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3275194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3275197">if</span>&nbsp;<span class="ident" id="3275200">err</span>&nbsp;<span class="op" id="3275204">=</span>&nbsp;<span class="ident" id="3275206">syscall</span><span class="op" id="3275213">.</span><span class="ident" id="3275214">SetNonblock</span><span class="op" id="3275225">(</span><span class="ident" id="3275226">s</span><span class="op" id="3275227">,</span>&nbsp;<span class="builtintype" id="3275229">true</span><span class="op" id="3275233">)</span><span class="op" id="3275234">;</span>&nbsp;<span class="ident" id="3275236">err</span>&nbsp;<span class="op" id="3275240">!=</span>&nbsp;<span class="ident" id="3275243">nil</span>&nbsp;<span class="op" id="3275247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3275251">syscall</span><span class="op" id="3275258">.</span><span class="ident" id="3275259">Close</span><span class="op" id="3275264">(</span><span class="ident" id="3275265">s</span><span class="op" id="3275266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3275270">return</span>&nbsp;<span class="op" id="3275277">-</span><span class="num" id="3275278">1</span><span class="op" id="3275279">,</span>&nbsp;<span class="ident" id="3275281">err</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3275286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3275289">return</span>&nbsp;<span class="ident" id="3275296">s</span><span class="op" id="3275297">,</span>&nbsp;<span class="ident" id="3275299">nil</span><br>
<span class="lineno"></span><span class="op" id="3275303">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3275306">//&nbsp;Wrapper&nbsp;around&nbsp;the&nbsp;accept&nbsp;system&nbsp;call&nbsp;that&nbsp;marks&nbsp;the&nbsp;returned&nbsp;file</span><br>
<span class="lineno">45</span><span class="comment" id="3275376">//&nbsp;descriptor&nbsp;as&nbsp;nonblocking&nbsp;and&nbsp;close-on-exec.</span><br>
<span class="lineno"></span><span class="keyword" id="3275424">func</span>&nbsp;<span class="ident" id="3275429">accept</span><span class="op" id="3275435">(</span><span class="ident" id="3275436">s</span>&nbsp;<span class="builtintype" id="3275438">int</span><span class="op" id="3275441">)</span>&nbsp;<span class="op" id="3275443">(</span><span class="builtintype" id="3275444">int</span><span class="op" id="3275447">,</span>&nbsp;<span class="ident" id="3275449">syscall</span><span class="op" id="3275456">.</span><span class="ident" id="3275457">Sockaddr</span><span class="op" id="3275465">,</span>&nbsp;<span class="builtintype" id="3275467">error</span><span class="op" id="3275472">)</span>&nbsp;<span class="op" id="3275474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3275477">ns</span><span class="op" id="3275479">,</span>&nbsp;<span class="ident" id="3275481">sa</span><span class="op" id="3275483">,</span>&nbsp;<span class="ident" id="3275485">err</span>&nbsp;<span class="op" id="3275489">:=</span>&nbsp;<span class="ident" id="3275492">syscall</span><span class="op" id="3275499">.</span><span class="ident" id="3275500">Accept4</span><span class="op" id="3275507">(</span><span class="ident" id="3275508">s</span><span class="op" id="3275509">,</span>&nbsp;<span class="ident" id="3275511">syscall</span><span class="op" id="3275518">.</span><span class="ident" id="3275519">SOCK_NONBLOCK</span><span class="op" id="3275532">|</span><span class="ident" id="3275533">syscall</span><span class="op" id="3275540">.</span><span class="ident" id="3275541">SOCK_CLOEXEC</span><span class="op" id="3275553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3275556">//&nbsp;On&nbsp;Linux&nbsp;the&nbsp;accept4&nbsp;system&nbsp;call&nbsp;was&nbsp;introduced&nbsp;in&nbsp;2.6.28</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3275618">//&nbsp;kernel&nbsp;and&nbsp;on&nbsp;FreeBSD&nbsp;it&nbsp;was&nbsp;introduced&nbsp;in&nbsp;10&nbsp;kernel.&nbsp;If&nbsp;we</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3275682">//&nbsp;get&nbsp;an&nbsp;ENOSYS&nbsp;error&nbsp;on&nbsp;both&nbsp;Linux&nbsp;and&nbsp;FreeBSD,&nbsp;or&nbsp;EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3275743">//&nbsp;error&nbsp;on&nbsp;Linux,&nbsp;fall&nbsp;back&nbsp;to&nbsp;using&nbsp;accept.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3275790">switch</span>&nbsp;<span class="ident" id="3275797">err</span>&nbsp;<span class="op" id="3275801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3275804">default</span><span class="op" id="3275811">:</span>&nbsp;<span class="comment" id="3275813">//&nbsp;nil&nbsp;and&nbsp;errors&nbsp;other&nbsp;than&nbsp;the&nbsp;ones&nbsp;listed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3275860">return</span>&nbsp;<span class="ident" id="3275867">ns</span><span class="op" id="3275869">,</span>&nbsp;<span class="ident" id="3275871">sa</span><span class="op" id="3275873">,</span>&nbsp;<span class="ident" id="3275875">err</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3275880">case</span>&nbsp;<span class="ident" id="3275885">syscall</span><span class="op" id="3275892">.</span><span class="ident" id="3275893">ENOSYS</span><span class="op" id="3275899">:</span>&nbsp;<span class="comment" id="3275901">//&nbsp;syscall&nbsp;missing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3275921">case</span>&nbsp;<span class="ident" id="3275926">syscall</span><span class="op" id="3275933">.</span><span class="ident" id="3275934">EINVAL</span><span class="op" id="3275940">:</span>&nbsp;<span class="comment" id="3275942">//&nbsp;some&nbsp;Linux&nbsp;use&nbsp;this&nbsp;instead&nbsp;of&nbsp;ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3275984">case</span>&nbsp;<span class="ident" id="3275989">syscall</span><span class="op" id="3275996">.</span><span class="ident" id="3275997">EACCES</span><span class="op" id="3276003">:</span>&nbsp;<span class="comment" id="3276005">//&nbsp;some&nbsp;Linux&nbsp;use&nbsp;this&nbsp;instead&nbsp;of&nbsp;ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3276047">case</span>&nbsp;<span class="ident" id="3276052">syscall</span><span class="op" id="3276059">.</span><span class="ident" id="3276060">EFAULT</span><span class="op" id="3276066">:</span>&nbsp;<span class="comment" id="3276068">//&nbsp;some&nbsp;Linux&nbsp;use&nbsp;this&nbsp;instead&nbsp;of&nbsp;ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3276110">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3276114">//&nbsp;See&nbsp;../syscall/exec_unix.go&nbsp;for&nbsp;description&nbsp;of&nbsp;ForkLock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3276175">//&nbsp;It&nbsp;is&nbsp;probably&nbsp;okay&nbsp;to&nbsp;hold&nbsp;the&nbsp;lock&nbsp;across&nbsp;syscall.Accept</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3276238">//&nbsp;because&nbsp;we&nbsp;have&nbsp;put&nbsp;fd.sysfd&nbsp;into&nbsp;non-blocking&nbsp;mode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3276295">//&nbsp;However,&nbsp;a&nbsp;call&nbsp;to&nbsp;the&nbsp;File&nbsp;method&nbsp;will&nbsp;put&nbsp;it&nbsp;back&nbsp;into</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3276356">//&nbsp;blocking&nbsp;mode.&nbsp;We&nbsp;can&#39;t&nbsp;take&nbsp;that&nbsp;risk,&nbsp;so&nbsp;no&nbsp;use&nbsp;of&nbsp;ForkLock&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3276428">ns</span><span class="op" id="3276430">,</span>&nbsp;<span class="ident" id="3276432">sa</span><span class="op" id="3276434">,</span>&nbsp;<span class="ident" id="3276436">err</span>&nbsp;<span class="op" id="3276440">=</span>&nbsp;<span class="ident" id="3276442">syscall</span><span class="op" id="3276449">.</span><span class="ident" id="3276450">Accept</span><span class="op" id="3276456">(</span><span class="ident" id="3276457">s</span><span class="op" id="3276458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3276461">if</span>&nbsp;<span class="ident" id="3276464">err</span>&nbsp;<span class="op" id="3276468">==</span>&nbsp;<span class="ident" id="3276471">nil</span>&nbsp;<span class="op" id="3276475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3276479">syscall</span><span class="op" id="3276486">.</span><span class="ident" id="3276487">CloseOnExec</span><span class="op" id="3276498">(</span><span class="ident" id="3276499">ns</span><span class="op" id="3276501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3276504">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3276507">if</span>&nbsp;<span class="ident" id="3276510">err</span>&nbsp;<span class="op" id="3276514">!=</span>&nbsp;<span class="ident" id="3276517">nil</span>&nbsp;<span class="op" id="3276521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3276525">return</span>&nbsp;<span class="op" id="3276532">-</span><span class="num" id="3276533">1</span><span class="op" id="3276534">,</span>&nbsp;<span class="ident" id="3276536">nil</span><span class="op" id="3276539">,</span>&nbsp;<span class="ident" id="3276541">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3276546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3276549">if</span>&nbsp;<span class="ident" id="3276552">err</span>&nbsp;<span class="op" id="3276556">=</span>&nbsp;<span class="ident" id="3276558">syscall</span><span class="op" id="3276565">.</span><span class="ident" id="3276566">SetNonblock</span><span class="op" id="3276577">(</span><span class="ident" id="3276578">ns</span><span class="op" id="3276580">,</span>&nbsp;<span class="builtintype" id="3276582">true</span><span class="op" id="3276586">)</span><span class="op" id="3276587">;</span>&nbsp;<span class="ident" id="3276589">err</span>&nbsp;<span class="op" id="3276593">!=</span>&nbsp;<span class="ident" id="3276596">nil</span>&nbsp;<span class="op" id="3276600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3276604">syscall</span><span class="op" id="3276611">.</span><span class="ident" id="3276612">Close</span><span class="op" id="3276617">(</span><span class="ident" id="3276618">ns</span><span class="op" id="3276620">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3276624">return</span>&nbsp;<span class="op" id="3276631">-</span><span class="num" id="3276632">1</span><span class="op" id="3276633">,</span>&nbsp;<span class="ident" id="3276635">nil</span><span class="op" id="3276638">,</span>&nbsp;<span class="ident" id="3276640">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3276645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3276648">return</span>&nbsp;<span class="ident" id="3276655">ns</span><span class="op" id="3276657">,</span>&nbsp;<span class="ident" id="3276659">sa</span><span class="op" id="3276661">,</span>&nbsp;<span class="ident" id="3276663">nil</span><br>
<span class="lineno"></span><span class="op" id="3276667">}</span>
</div>
</body>
</html>
