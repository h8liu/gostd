<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1818503">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1818558">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1818612">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1818663">//&nbsp;+build&nbsp;linux</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1818680">package</span>&nbsp;<span class="ident" id="1818688">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1818697">import</span>&nbsp;<span class="string" id="1818704">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1818714">func</span>&nbsp;<span class="ident" id="1818719">epollcreate</span><span class="op" id="1818730">(</span><span class="ident" id="1818731">size</span>&nbsp;<span class="builtintype" id="1818736">int32</span><span class="op" id="1818741">)</span>&nbsp;<span class="builtintype" id="1818743">int32</span><br>
<span class="lineno"></span><span class="keyword" id="1818749">func</span>&nbsp;<span class="ident" id="1818754">epollcreate1</span><span class="op" id="1818766">(</span><span class="ident" id="1818767">flags</span>&nbsp;<span class="builtintype" id="1818773">int32</span><span class="op" id="1818778">)</span>&nbsp;<span class="builtintype" id="1818780">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1818787">//go:noescape</span><br>
<span class="lineno">15</span><span class="keyword" id="1818801">func</span>&nbsp;<span class="ident" id="1818806">epollctl</span><span class="op" id="1818814">(</span><span class="ident" id="1818815">epfd</span><span class="op" id="1818819">,</span>&nbsp;<span class="ident" id="1818821">op</span><span class="op" id="1818823">,</span>&nbsp;<span class="ident" id="1818825">fd</span>&nbsp;<span class="builtintype" id="1818828">int32</span><span class="op" id="1818833">,</span>&nbsp;<span class="ident" id="1818835">ev</span>&nbsp;<span class="op" id="1818838">*</span><span class="ident" id="1818839">epollevent</span><span class="op" id="1818849">)</span>&nbsp;<span class="builtintype" id="1818851">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1818858">//go:noescape</span><br>
<span class="lineno"></span><span class="keyword" id="1818872">func</span>&nbsp;<span class="ident" id="1818877">epollwait</span><span class="op" id="1818886">(</span><span class="ident" id="1818887">epfd</span>&nbsp;<span class="builtintype" id="1818892">int32</span><span class="op" id="1818897">,</span>&nbsp;<span class="ident" id="1818899">ev</span>&nbsp;<span class="op" id="1818902">*</span><span class="ident" id="1818903">epollevent</span><span class="op" id="1818913">,</span>&nbsp;<span class="ident" id="1818915">nev</span><span class="op" id="1818918">,</span>&nbsp;<span class="ident" id="1818920">timeout</span>&nbsp;<span class="builtintype" id="1818928">int32</span><span class="op" id="1818933">)</span>&nbsp;<span class="builtintype" id="1818935">int32</span><br>
<span class="lineno"></span><span class="keyword" id="1818941">func</span>&nbsp;<span class="ident" id="1818946">closeonexec</span><span class="op" id="1818957">(</span><span class="ident" id="1818958">fd</span>&nbsp;<span class="builtintype" id="1818961">int32</span><span class="op" id="1818966">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="1818969">var</span>&nbsp;<span class="op" id="1818973">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1818976">epfd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1818991">int32</span>&nbsp;<span class="op" id="1818997">=</span>&nbsp;<span class="op" id="1818999">-</span><span class="num" id="1819000">1</span>&nbsp;<span class="comment" id="1819002">//&nbsp;epoll&nbsp;descriptor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1819023">netpolllasterr</span>&nbsp;<span class="builtintype" id="1819038">int32</span><br>
<span class="lineno"></span><span class="op" id="1819044">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="1819047">func</span>&nbsp;<span class="ident" id="1819052">netpollinit</span><span class="op" id="1819063">(</span><span class="op" id="1819064">)</span>&nbsp;<span class="op" id="1819066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1819069">epfd</span>&nbsp;<span class="op" id="1819074">=</span>&nbsp;<span class="ident" id="1819076">epollcreate1</span><span class="op" id="1819088">(</span><span class="ident" id="1819089">_EPOLL_CLOEXEC</span><span class="op" id="1819103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1819106">if</span>&nbsp;<span class="ident" id="1819109">epfd</span>&nbsp;<span class="op" id="1819114">&gt;=</span>&nbsp;<span class="num" id="1819117">0</span>&nbsp;<span class="op" id="1819119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1819123">return</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1819131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1819134">epfd</span>&nbsp;<span class="op" id="1819139">=</span>&nbsp;<span class="ident" id="1819141">epollcreate</span><span class="op" id="1819152">(</span><span class="num" id="1819153">1024</span><span class="op" id="1819157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1819160">if</span>&nbsp;<span class="ident" id="1819163">epfd</span>&nbsp;<span class="op" id="1819168">&gt;=</span>&nbsp;<span class="num" id="1819171">0</span>&nbsp;<span class="op" id="1819173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1819177">closeonexec</span><span class="op" id="1819188">(</span><span class="ident" id="1819189">epfd</span><span class="op" id="1819193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1819197">return</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1819205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1819208">println</span><span class="op" id="1819215">(</span><span class="string" id="1819216">&#34;netpollinit:&nbsp;failed&nbsp;to&nbsp;create&nbsp;epoll&nbsp;descriptor&#34;</span><span class="op" id="1819264">,</span>&nbsp;<span class="op" id="1819266">-</span><span class="ident" id="1819267">epfd</span><span class="op" id="1819271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1819274">gothrow</span><span class="op" id="1819281">(</span><span class="string" id="1819282">&#34;netpollinit:&nbsp;failed&nbsp;to&nbsp;create&nbsp;descriptor&#34;</span><span class="op" id="1819324">)</span><br>
<span class="lineno"></span><span class="op" id="1819326">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="1819329">func</span>&nbsp;<span class="ident" id="1819334">netpollopen</span><span class="op" id="1819345">(</span><span class="ident" id="1819346">fd</span>&nbsp;<span class="builtintype" id="1819349">uintptr</span><span class="op" id="1819356">,</span>&nbsp;<span class="ident" id="1819358">pd</span>&nbsp;<span class="op" id="1819361">*</span><span class="ident" id="1819362">pollDesc</span><span class="op" id="1819370">)</span>&nbsp;<span class="builtintype" id="1819372">int32</span>&nbsp;<span class="op" id="1819378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1819381">var</span>&nbsp;<span class="ident" id="1819385">ev</span>&nbsp;<span class="ident" id="1819388">epollevent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1819400">ev</span><span class="op" id="1819402">.</span><span class="ident" id="1819403">events</span>&nbsp;<span class="op" id="1819410">=</span>&nbsp;<span class="ident" id="1819412">_EPOLLIN</span>&nbsp;<span class="op" id="1819421">|</span>&nbsp;<span class="ident" id="1819423">_EPOLLOUT</span>&nbsp;<span class="op" id="1819433">|</span>&nbsp;<span class="ident" id="1819435">_EPOLLRDHUP</span>&nbsp;<span class="op" id="1819447">|</span>&nbsp;<span class="ident" id="1819449">_EPOLLET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1819459">*</span><span class="op" id="1819460">(</span><span class="op" id="1819461">*</span><span class="op" id="1819462">*</span><span class="ident" id="1819463">pollDesc</span><span class="op" id="1819471">)</span><span class="op" id="1819472">(</span><span class="ident" id="1819473">unsafe</span><span class="op" id="1819479">.</span><span class="ident" id="1819480">Pointer</span><span class="op" id="1819487">(</span><span class="op" id="1819488">&amp;</span><span class="ident" id="1819489">ev</span><span class="op" id="1819491">.</span><span class="ident" id="1819492">data</span><span class="op" id="1819496">)</span><span class="op" id="1819497">)</span>&nbsp;<span class="op" id="1819499">=</span>&nbsp;<span class="ident" id="1819501">pd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1819505">return</span>&nbsp;<span class="op" id="1819512">-</span><span class="ident" id="1819513">epollctl</span><span class="op" id="1819521">(</span><span class="ident" id="1819522">epfd</span><span class="op" id="1819526">,</span>&nbsp;<span class="ident" id="1819528">_EPOLL_CTL_ADD</span><span class="op" id="1819542">,</span>&nbsp;<span class="builtintype" id="1819544">int32</span><span class="op" id="1819549">(</span><span class="ident" id="1819550">fd</span><span class="op" id="1819552">)</span><span class="op" id="1819553">,</span>&nbsp;<span class="op" id="1819555">&amp;</span><span class="ident" id="1819556">ev</span><span class="op" id="1819558">)</span><br>
<span class="lineno">45</span><span class="op" id="1819560">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1819563">func</span>&nbsp;<span class="ident" id="1819568">netpollclose</span><span class="op" id="1819580">(</span><span class="ident" id="1819581">fd</span>&nbsp;<span class="builtintype" id="1819584">uintptr</span><span class="op" id="1819591">)</span>&nbsp;<span class="builtintype" id="1819593">int32</span>&nbsp;<span class="op" id="1819599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1819602">var</span>&nbsp;<span class="ident" id="1819606">ev</span>&nbsp;<span class="ident" id="1819609">epollevent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1819621">return</span>&nbsp;<span class="op" id="1819628">-</span><span class="ident" id="1819629">epollctl</span><span class="op" id="1819637">(</span><span class="ident" id="1819638">epfd</span><span class="op" id="1819642">,</span>&nbsp;<span class="ident" id="1819644">_EPOLL_CTL_DEL</span><span class="op" id="1819658">,</span>&nbsp;<span class="builtintype" id="1819660">int32</span><span class="op" id="1819665">(</span><span class="ident" id="1819666">fd</span><span class="op" id="1819668">)</span><span class="op" id="1819669">,</span>&nbsp;<span class="op" id="1819671">&amp;</span><span class="ident" id="1819672">ev</span><span class="op" id="1819674">)</span><br>
<span class="lineno">50</span><span class="op" id="1819676">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1819679">func</span>&nbsp;<span class="ident" id="1819684">netpollarm</span><span class="op" id="1819694">(</span><span class="ident" id="1819695">pd</span>&nbsp;<span class="op" id="1819698">*</span><span class="ident" id="1819699">pollDesc</span><span class="op" id="1819707">,</span>&nbsp;<span class="ident" id="1819709">mode</span>&nbsp;<span class="builtintype" id="1819714">int</span><span class="op" id="1819717">)</span>&nbsp;<span class="op" id="1819719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1819722">gothrow</span><span class="op" id="1819729">(</span><span class="string" id="1819730">&#34;unused&#34;</span><span class="op" id="1819738">)</span><br>
<span class="lineno"></span><span class="op" id="1819740">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="1819743">//&nbsp;polls&nbsp;for&nbsp;ready&nbsp;network&nbsp;connections</span><br>
<span class="lineno"></span><span class="comment" id="1819782">//&nbsp;returns&nbsp;list&nbsp;of&nbsp;goroutines&nbsp;that&nbsp;become&nbsp;runnable</span><br>
<span class="lineno"></span><span class="keyword" id="1819833">func</span>&nbsp;<span class="ident" id="1819838">netpoll</span><span class="op" id="1819845">(</span><span class="ident" id="1819846">block</span>&nbsp;<span class="builtintype" id="1819852">bool</span><span class="op" id="1819856">)</span>&nbsp;<span class="op" id="1819858">(</span><span class="ident" id="1819859">gp</span>&nbsp;<span class="op" id="1819862">*</span><span class="ident" id="1819863">g</span><span class="op" id="1819864">)</span>&nbsp;<span class="op" id="1819866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1819869">if</span>&nbsp;<span class="ident" id="1819872">epfd</span>&nbsp;<span class="op" id="1819877">==</span>&nbsp;<span class="op" id="1819880">-</span><span class="num" id="1819881">1</span>&nbsp;<span class="op" id="1819883">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1819887">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1819895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1819898">waitms</span>&nbsp;<span class="op" id="1819905">:=</span>&nbsp;<span class="builtintype" id="1819908">int32</span><span class="op" id="1819913">(</span><span class="op" id="1819914">-</span><span class="num" id="1819915">1</span><span class="op" id="1819916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1819919">if</span>&nbsp;<span class="op" id="1819922">!</span><span class="ident" id="1819923">block</span>&nbsp;<span class="op" id="1819929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1819933">waitms</span>&nbsp;<span class="op" id="1819940">=</span>&nbsp;<span class="num" id="1819942">0</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1819945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1819948">var</span>&nbsp;<span class="ident" id="1819952">events</span>&nbsp;<span class="op" id="1819959">[</span><span class="num" id="1819960">128</span><span class="op" id="1819963">]</span><span class="ident" id="1819964">epollevent</span><br>
<span class="lineno"></span><span class="ident" id="1819975">retry</span><span class="op" id="1819980">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1819983">n</span>&nbsp;<span class="op" id="1819985">:=</span>&nbsp;<span class="ident" id="1819988">epollwait</span><span class="op" id="1819997">(</span><span class="ident" id="1819998">epfd</span><span class="op" id="1820002">,</span>&nbsp;<span class="op" id="1820004">&amp;</span><span class="ident" id="1820005">events</span><span class="op" id="1820011">[</span><span class="num" id="1820012">0</span><span class="op" id="1820013">]</span><span class="op" id="1820014">,</span>&nbsp;<span class="builtintype" id="1820016">int32</span><span class="op" id="1820021">(</span><span class="builtinfunc" id="1820022">len</span><span class="op" id="1820025">(</span><span class="ident" id="1820026">events</span><span class="op" id="1820032">)</span><span class="op" id="1820033">)</span><span class="op" id="1820034">,</span>&nbsp;<span class="ident" id="1820036">waitms</span><span class="op" id="1820042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1820045">if</span>&nbsp;<span class="ident" id="1820048">n</span>&nbsp;<span class="op" id="1820050">&lt;</span>&nbsp;<span class="num" id="1820052">0</span>&nbsp;<span class="op" id="1820054">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1820058">if</span>&nbsp;<span class="ident" id="1820061">n</span>&nbsp;<span class="op" id="1820063">!=</span>&nbsp;<span class="op" id="1820066">-</span><span class="ident" id="1820067">_EINTR</span>&nbsp;<span class="op" id="1820074">&amp;&amp;</span>&nbsp;<span class="ident" id="1820077">n</span>&nbsp;<span class="op" id="1820079">!=</span>&nbsp;<span class="ident" id="1820082">netpolllasterr</span>&nbsp;<span class="op" id="1820097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1820102">netpolllasterr</span>&nbsp;<span class="op" id="1820117">=</span>&nbsp;<span class="ident" id="1820119">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1820124">println</span><span class="op" id="1820131">(</span><span class="string" id="1820132">&#34;runtime:&nbsp;epollwait&nbsp;on&nbsp;fd&#34;</span><span class="op" id="1820158">,</span>&nbsp;<span class="ident" id="1820160">epfd</span><span class="op" id="1820164">,</span>&nbsp;<span class="string" id="1820166">&#34;failed&nbsp;with&#34;</span><span class="op" id="1820179">,</span>&nbsp;<span class="op" id="1820181">-</span><span class="ident" id="1820182">n</span><span class="op" id="1820183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1820187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1820191">goto</span>&nbsp;<span class="ident" id="1820196">retry</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1820203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1820206">for</span>&nbsp;<span class="ident" id="1820210">i</span>&nbsp;<span class="op" id="1820212">:=</span>&nbsp;<span class="builtintype" id="1820215">int32</span><span class="op" id="1820220">(</span><span class="num" id="1820221">0</span><span class="op" id="1820222">)</span><span class="op" id="1820223">;</span>&nbsp;<span class="ident" id="1820225">i</span>&nbsp;<span class="op" id="1820227">&lt;</span>&nbsp;<span class="ident" id="1820229">n</span><span class="op" id="1820230">;</span>&nbsp;<span class="ident" id="1820232">i</span><span class="op" id="1820233">++</span>&nbsp;<span class="op" id="1820236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1820240">ev</span>&nbsp;<span class="op" id="1820243">:=</span>&nbsp;<span class="op" id="1820246">&amp;</span><span class="ident" id="1820247">events</span><span class="op" id="1820253">[</span><span class="ident" id="1820254">i</span><span class="op" id="1820255">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1820259">if</span>&nbsp;<span class="ident" id="1820262">ev</span><span class="op" id="1820264">.</span><span class="ident" id="1820265">events</span>&nbsp;<span class="op" id="1820272">==</span>&nbsp;<span class="num" id="1820275">0</span>&nbsp;<span class="op" id="1820277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1820282">continue</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1820293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1820297">var</span>&nbsp;<span class="ident" id="1820301">mode</span>&nbsp;<span class="builtintype" id="1820306">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1820314">if</span>&nbsp;<span class="ident" id="1820317">ev</span><span class="op" id="1820319">.</span><span class="ident" id="1820320">events</span><span class="op" id="1820326">&amp;</span><span class="op" id="1820327">(</span><span class="ident" id="1820328">_EPOLLIN</span><span class="op" id="1820336">|</span><span class="ident" id="1820337">_EPOLLRDHUP</span><span class="op" id="1820348">|</span><span class="ident" id="1820349">_EPOLLHUP</span><span class="op" id="1820358">|</span><span class="ident" id="1820359">_EPOLLERR</span><span class="op" id="1820368">)</span>&nbsp;<span class="op" id="1820370">!=</span>&nbsp;<span class="num" id="1820373">0</span>&nbsp;<span class="op" id="1820375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1820380">mode</span>&nbsp;<span class="op" id="1820385">+=</span>&nbsp;<span class="string" id="1820388">&#39;r&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1820394">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1820398">if</span>&nbsp;<span class="ident" id="1820401">ev</span><span class="op" id="1820403">.</span><span class="ident" id="1820404">events</span><span class="op" id="1820410">&amp;</span><span class="op" id="1820411">(</span><span class="ident" id="1820412">_EPOLLOUT</span><span class="op" id="1820421">|</span><span class="ident" id="1820422">_EPOLLHUP</span><span class="op" id="1820431">|</span><span class="ident" id="1820432">_EPOLLERR</span><span class="op" id="1820441">)</span>&nbsp;<span class="op" id="1820443">!=</span>&nbsp;<span class="num" id="1820446">0</span>&nbsp;<span class="op" id="1820448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1820453">mode</span>&nbsp;<span class="op" id="1820458">+=</span>&nbsp;<span class="string" id="1820461">&#39;w&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1820467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1820471">if</span>&nbsp;<span class="ident" id="1820474">mode</span>&nbsp;<span class="op" id="1820479">!=</span>&nbsp;<span class="num" id="1820482">0</span>&nbsp;<span class="op" id="1820484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1820489">pd</span>&nbsp;<span class="op" id="1820492">:=</span>&nbsp;<span class="op" id="1820495">*</span><span class="op" id="1820496">(</span><span class="op" id="1820497">*</span><span class="op" id="1820498">*</span><span class="ident" id="1820499">pollDesc</span><span class="op" id="1820507">)</span><span class="op" id="1820508">(</span><span class="ident" id="1820509">unsafe</span><span class="op" id="1820515">.</span><span class="ident" id="1820516">Pointer</span><span class="op" id="1820523">(</span><span class="op" id="1820524">&amp;</span><span class="ident" id="1820525">ev</span><span class="op" id="1820527">.</span><span class="ident" id="1820528">data</span><span class="op" id="1820532">)</span><span class="op" id="1820533">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1820538">netpollready</span><span class="op" id="1820550">(</span><span class="op" id="1820551">(</span><span class="op" id="1820552">*</span><span class="op" id="1820553">*</span><span class="ident" id="1820554">g</span><span class="op" id="1820555">)</span><span class="op" id="1820556">(</span><span class="ident" id="1820557">noescape</span><span class="op" id="1820565">(</span><span class="ident" id="1820566">unsafe</span><span class="op" id="1820572">.</span><span class="ident" id="1820573">Pointer</span><span class="op" id="1820580">(</span><span class="op" id="1820581">&amp;</span><span class="ident" id="1820582">gp</span><span class="op" id="1820584">)</span><span class="op" id="1820585">)</span><span class="op" id="1820586">)</span><span class="op" id="1820587">,</span>&nbsp;<span class="ident" id="1820589">pd</span><span class="op" id="1820591">,</span>&nbsp;<span class="ident" id="1820593">mode</span><span class="op" id="1820597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1820601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1820604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1820607">if</span>&nbsp;<span class="ident" id="1820610">block</span>&nbsp;<span class="op" id="1820616">&amp;&amp;</span>&nbsp;<span class="ident" id="1820619">gp</span>&nbsp;<span class="op" id="1820622">==</span>&nbsp;<span class="ident" id="1820625">nil</span>&nbsp;<span class="op" id="1820629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1820633">goto</span>&nbsp;<span class="ident" id="1820638">retry</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1820645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1820648">return</span>&nbsp;<span class="ident" id="1820655">gp</span><br>
<span class="lineno"></span><span class="op" id="1820658">}</span>
</div>
</body>
</html>
