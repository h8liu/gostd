<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/lzw</h2>
<ul>
<li><a href="/gostd/compress/lzw/reader.go.html">reader.go</a></li>
<li><a href="/gostd/compress/lzw/reader_test.go.html" class="current">reader_test.go</a></li>
<li><a href="/gostd/compress/lzw/writer.go.html">writer.go</a></li>
<li><a href="/gostd/compress/lzw/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6780380">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6780435">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6780489">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6780540">package</span>&nbsp;<span class="ident" id="6780548">lzw</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6780553">import</span>&nbsp;<span class="op" id="6780560">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6780563">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6780572">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6780578">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6780591">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6780602">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6780613">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6780624">&#34;testing&#34;</span><br>
<span class="lineno">15</span><span class="op" id="6780634">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6780637">type</span>&nbsp;<span class="ident" id="6780642">lzwTest</span>&nbsp;<span class="keyword" id="6780650">struct</span>&nbsp;<span class="op" id="6780657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6780660">desc</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6780671">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6780679">raw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6780690">string</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6780698">compressed</span>&nbsp;<span class="builtintype" id="6780709">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6780717">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6780728">error</span><br>
<span class="lineno"></span><span class="op" id="6780734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6780737">var</span>&nbsp;<span class="ident" id="6780741">lzwTests</span>&nbsp;<span class="op" id="6780750">=</span>&nbsp;<span class="op" id="6780752">[</span><span class="op" id="6780753">]</span><span class="ident" id="6780754">lzwTest</span><span class="op" id="6780761">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6780764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6780768">&#34;empty;LSB;8&#34;</span><span class="op" id="6780781">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6780785">&#34;&#34;</span><span class="op" id="6780787">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6780791">&#34;\x01\x01&#34;</span><span class="op" id="6780801">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6780805">nil</span><span class="op" id="6780808">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6780811">}</span><span class="op" id="6780812">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6780815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6780819">&#34;empty;MSB;8&#34;</span><span class="op" id="6780832">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6780836">&#34;&#34;</span><span class="op" id="6780838">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6780842">&#34;\x80\x80&#34;</span><span class="op" id="6780852">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6780856">nil</span><span class="op" id="6780859">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6780862">}</span><span class="op" id="6780863">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6780866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6780870">&#34;tobe;LSB;7&#34;</span><span class="op" id="6780882">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6780886">&#34;TOBEORNOTTOBEORTOBEORNOT&#34;</span><span class="op" id="6780912">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6780916">&#34;\x54\x4f\x42\x45\x4f\x52\x4e\x4f\x54\x82\x84\x86\x8b\x85\x87\x89\x81&#34;</span><span class="op" id="6780986">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6780990">nil</span><span class="op" id="6780993">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6780996">}</span><span class="op" id="6780997">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6781000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6781004">&#34;tobe;LSB;8&#34;</span><span class="op" id="6781016">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6781020">&#34;TOBEORNOTTOBEORTOBEORNOT&#34;</span><span class="op" id="6781046">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6781050">&#34;\x54\x9e\x08\x29\xf2\x44\x8a\x93\x27\x54\x04\x12\x34\xb8\xb0\xe0\xc1\x84\x01\x01&#34;</span><span class="op" id="6781132">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6781136">nil</span><span class="op" id="6781139">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6781142">}</span><span class="op" id="6781143">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6781146">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6781150">&#34;tobe;MSB;7&#34;</span><span class="op" id="6781162">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6781166">&#34;TOBEORNOTTOBEORTOBEORNOT&#34;</span><span class="op" id="6781192">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6781196">&#34;\x54\x4f\x42\x45\x4f\x52\x4e\x4f\x54\x82\x84\x86\x8b\x85\x87\x89\x81&#34;</span><span class="op" id="6781266">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6781270">nil</span><span class="op" id="6781273">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6781276">}</span><span class="op" id="6781277">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6781280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6781284">&#34;tobe;MSB;8&#34;</span><span class="op" id="6781296">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6781300">&#34;TOBEORNOTTOBEORTOBEORNOT&#34;</span><span class="op" id="6781326">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6781330">&#34;\x2a\x13\xc8\x44\x52\x79\x48\x9c\x4f\x2a\x40\xa0\x90\x68\x5c\x16\x0f\x09\x80\x80&#34;</span><span class="op" id="6781412">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6781416">nil</span><span class="op" id="6781419">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6781422">}</span><span class="op" id="6781423">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6781426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6781430">&#34;tobe-truncated;LSB;8&#34;</span><span class="op" id="6781452">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6781456">&#34;TOBEORNOTTOBEORTOBEORNOT&#34;</span><span class="op" id="6781482">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6781486">&#34;\x54\x9e\x08\x29\xf2\x44\x8a\x93\x27\x54\x04&#34;</span><span class="op" id="6781532">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6781536">io</span><span class="op" id="6781538">.</span><span class="ident" id="6781539">ErrUnexpectedEOF</span><span class="op" id="6781555">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6781558">}</span><span class="op" id="6781559">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6781562">//&nbsp;This&nbsp;example&nbsp;comes&nbsp;from&nbsp;http://en.wikipedia.org/wiki/Graphics_Interchange_Format.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6781648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6781652">&#34;gif;LSB;8&#34;</span><span class="op" id="6781663">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6781667">&#34;\x28\xff\xff\xff\x28\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff&#34;</span><span class="op" id="6781729">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6781733">&#34;\x00\x51\xfc\x1b\x28\x70\xa0\xc1\x83\x01\x01&#34;</span><span class="op" id="6781779">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6781783">nil</span><span class="op" id="6781786">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6781789">}</span><span class="op" id="6781790">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6781793">//&nbsp;This&nbsp;example&nbsp;comes&nbsp;from&nbsp;http://compgroups.net/comp.lang.ruby/Decompressing-LZW-compression-from-PDF-file</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6781902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6781906">&#34;pdf;MSB;8&#34;</span><span class="op" id="6781917">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6781921">&#34;-----A---B&#34;</span><span class="op" id="6781933">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6781937">&#34;\x80\x0b\x60\x50\x22\x0c\x0c\x85\x01&#34;</span><span class="op" id="6781975">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6781979">nil</span><span class="op" id="6781982">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6781985">}</span><span class="op" id="6781986">,</span><br>
<span class="lineno"></span><span class="op" id="6781988">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6781991">func</span>&nbsp;<span class="ident" id="6781996">TestReader</span><span class="op" id="6782006">(</span><span class="ident" id="6782007">t</span>&nbsp;<span class="op" id="6782009">*</span><span class="ident" id="6782010">testing</span><span class="op" id="6782017">.</span><span class="ident" id="6782018">T</span><span class="op" id="6782019">)</span>&nbsp;<span class="op" id="6782021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6782024">var</span>&nbsp;<span class="ident" id="6782028">b</span>&nbsp;<span class="ident" id="6782030">bytes</span><span class="op" id="6782035">.</span><span class="ident" id="6782036">Buffer</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6782044">for</span>&nbsp;<span class="ident" id="6782048">_</span><span class="op" id="6782049">,</span>&nbsp;<span class="ident" id="6782051">tt</span>&nbsp;<span class="op" id="6782054">:=</span>&nbsp;<span class="keyword" id="6782057">range</span>&nbsp;<span class="ident" id="6782063">lzwTests</span>&nbsp;<span class="op" id="6782072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6782076">d</span>&nbsp;<span class="op" id="6782078">:=</span>&nbsp;<span class="ident" id="6782081">strings</span><span class="op" id="6782088">.</span><span class="ident" id="6782089">Split</span><span class="op" id="6782094">(</span><span class="ident" id="6782095">tt</span><span class="op" id="6782097">.</span><span class="ident" id="6782098">desc</span><span class="op" id="6782102">,</span>&nbsp;<span class="string" id="6782104">&#34;;&#34;</span><span class="op" id="6782107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6782111">var</span>&nbsp;<span class="ident" id="6782115">order</span>&nbsp;<span class="ident" id="6782121">Order</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6782129">switch</span>&nbsp;<span class="ident" id="6782136">d</span><span class="op" id="6782137">[</span><span class="num" id="6782138">1</span><span class="op" id="6782139">]</span>&nbsp;<span class="op" id="6782141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6782145">case</span>&nbsp;<span class="string" id="6782150">&#34;LSB&#34;</span><span class="op" id="6782155">:</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6782160">order</span>&nbsp;<span class="op" id="6782166">=</span>&nbsp;<span class="ident" id="6782168">LSB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6782174">case</span>&nbsp;<span class="string" id="6782179">&#34;MSB&#34;</span><span class="op" id="6782184">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6782189">order</span>&nbsp;<span class="op" id="6782195">=</span>&nbsp;<span class="ident" id="6782197">MSB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6782203">default</span><span class="op" id="6782210">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6782215">t</span><span class="op" id="6782216">.</span><span class="ident" id="6782217">Errorf</span><span class="op" id="6782223">(</span><span class="string" id="6782224">&#34;%s:&nbsp;bad&nbsp;order&nbsp;%q&#34;</span><span class="op" id="6782242">,</span>&nbsp;<span class="ident" id="6782244">tt</span><span class="op" id="6782246">.</span><span class="ident" id="6782247">desc</span><span class="op" id="6782251">,</span>&nbsp;<span class="ident" id="6782253">d</span><span class="op" id="6782254">[</span><span class="num" id="6782255">1</span><span class="op" id="6782256">]</span><span class="op" id="6782257">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6782261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6782265">litWidth</span><span class="op" id="6782273">,</span>&nbsp;<span class="ident" id="6782275">_</span>&nbsp;<span class="op" id="6782277">:=</span>&nbsp;<span class="ident" id="6782280">strconv</span><span class="op" id="6782287">.</span><span class="ident" id="6782288">Atoi</span><span class="op" id="6782292">(</span><span class="ident" id="6782293">d</span><span class="op" id="6782294">[</span><span class="num" id="6782295">2</span><span class="op" id="6782296">]</span><span class="op" id="6782297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6782301">rc</span>&nbsp;<span class="op" id="6782304">:=</span>&nbsp;<span class="ident" id="6782307">NewReader</span><span class="op" id="6782316">(</span><span class="ident" id="6782317">strings</span><span class="op" id="6782324">.</span><span class="ident" id="6782325">NewReader</span><span class="op" id="6782334">(</span><span class="ident" id="6782335">tt</span><span class="op" id="6782337">.</span><span class="ident" id="6782338">compressed</span><span class="op" id="6782348">)</span><span class="op" id="6782349">,</span>&nbsp;<span class="ident" id="6782351">order</span><span class="op" id="6782356">,</span>&nbsp;<span class="ident" id="6782358">litWidth</span><span class="op" id="6782366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6782370">defer</span>&nbsp;<span class="ident" id="6782376">rc</span><span class="op" id="6782378">.</span><span class="ident" id="6782379">Close</span><span class="op" id="6782384">(</span><span class="op" id="6782385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6782389">b</span><span class="op" id="6782390">.</span><span class="ident" id="6782391">Reset</span><span class="op" id="6782396">(</span><span class="op" id="6782397">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6782401">n</span><span class="op" id="6782402">,</span>&nbsp;<span class="ident" id="6782404">err</span>&nbsp;<span class="op" id="6782408">:=</span>&nbsp;<span class="ident" id="6782411">io</span><span class="op" id="6782413">.</span><span class="ident" id="6782414">Copy</span><span class="op" id="6782418">(</span><span class="op" id="6782419">&amp;</span><span class="ident" id="6782420">b</span><span class="op" id="6782421">,</span>&nbsp;<span class="ident" id="6782423">rc</span><span class="op" id="6782425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6782429">if</span>&nbsp;<span class="ident" id="6782432">err</span>&nbsp;<span class="op" id="6782436">!=</span>&nbsp;<span class="builtintype" id="6782439">nil</span>&nbsp;<span class="op" id="6782443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6782448">if</span>&nbsp;<span class="ident" id="6782451">err</span>&nbsp;<span class="op" id="6782455">!=</span>&nbsp;<span class="ident" id="6782458">tt</span><span class="op" id="6782460">.</span><span class="ident" id="6782461">err</span>&nbsp;<span class="op" id="6782465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6782471">t</span><span class="op" id="6782472">.</span><span class="ident" id="6782473">Errorf</span><span class="op" id="6782479">(</span><span class="string" id="6782480">&#34;%s:&nbsp;io.Copy:&nbsp;%v&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6782505">,</span>&nbsp;<span class="ident" id="6782507">tt</span><span class="op" id="6782509">.</span><span class="ident" id="6782510">desc</span><span class="op" id="6782514">,</span>&nbsp;<span class="ident" id="6782516">err</span><span class="op" id="6782519">,</span>&nbsp;<span class="ident" id="6782521">tt</span><span class="op" id="6782523">.</span><span class="ident" id="6782524">err</span><span class="op" id="6782527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6782532">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6782537">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6782548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6782552">s</span>&nbsp;<span class="op" id="6782554">:=</span>&nbsp;<span class="ident" id="6782557">b</span><span class="op" id="6782558">.</span><span class="ident" id="6782559">String</span><span class="op" id="6782565">(</span><span class="op" id="6782566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6782570">if</span>&nbsp;<span class="ident" id="6782573">s</span>&nbsp;<span class="op" id="6782575">!=</span>&nbsp;<span class="ident" id="6782578">tt</span><span class="op" id="6782580">.</span><span class="ident" id="6782581">raw</span>&nbsp;<span class="op" id="6782585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6782590">t</span><span class="op" id="6782591">.</span><span class="ident" id="6782592">Errorf</span><span class="op" id="6782598">(</span><span class="string" id="6782599">&#34;%s:&nbsp;got&nbsp;%d-byte&nbsp;%q&nbsp;want&nbsp;%d-byte&nbsp;%q&#34;</span><span class="op" id="6782635">,</span>&nbsp;<span class="ident" id="6782637">tt</span><span class="op" id="6782639">.</span><span class="ident" id="6782640">desc</span><span class="op" id="6782644">,</span>&nbsp;<span class="ident" id="6782646">n</span><span class="op" id="6782647">,</span>&nbsp;<span class="ident" id="6782649">s</span><span class="op" id="6782650">,</span>&nbsp;<span class="builtinfunc" id="6782652">len</span><span class="op" id="6782655">(</span><span class="ident" id="6782656">tt</span><span class="op" id="6782658">.</span><span class="ident" id="6782659">raw</span><span class="op" id="6782662">)</span><span class="op" id="6782663">,</span>&nbsp;<span class="ident" id="6782665">tt</span><span class="op" id="6782667">.</span><span class="ident" id="6782668">raw</span><span class="op" id="6782671">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6782675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6782678">}</span><br>
<span class="lineno"></span><span class="op" id="6782680">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6782683">func</span>&nbsp;<span class="ident" id="6782688">benchmarkDecoder</span><span class="op" id="6782704">(</span><span class="ident" id="6782705">b</span>&nbsp;<span class="op" id="6782707">*</span><span class="ident" id="6782708">testing</span><span class="op" id="6782715">.</span><span class="ident" id="6782716">B</span><span class="op" id="6782717">,</span>&nbsp;<span class="ident" id="6782719">n</span>&nbsp;<span class="builtintype" id="6782721">int</span><span class="op" id="6782724">)</span>&nbsp;<span class="op" id="6782726">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6782729">b</span><span class="op" id="6782730">.</span><span class="ident" id="6782731">StopTimer</span><span class="op" id="6782740">(</span><span class="op" id="6782741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6782744">b</span><span class="op" id="6782745">.</span><span class="ident" id="6782746">SetBytes</span><span class="op" id="6782754">(</span><span class="ident" id="6782755">int64</span><span class="op" id="6782760">(</span><span class="ident" id="6782761">n</span><span class="op" id="6782762">)</span><span class="op" id="6782763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6782766">buf0</span><span class="op" id="6782770">,</span>&nbsp;<span class="ident" id="6782772">err</span>&nbsp;<span class="op" id="6782776">:=</span>&nbsp;<span class="ident" id="6782779">ioutil</span><span class="op" id="6782785">.</span><span class="ident" id="6782786">ReadFile</span><span class="op" id="6782794">(</span><span class="string" id="6782795">&#34;../testdata/e.txt&#34;</span><span class="op" id="6782814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6782817">if</span>&nbsp;<span class="ident" id="6782820">err</span>&nbsp;<span class="op" id="6782824">!=</span>&nbsp;<span class="builtintype" id="6782827">nil</span>&nbsp;<span class="op" id="6782831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6782835">b</span><span class="op" id="6782836">.</span><span class="ident" id="6782837">Fatal</span><span class="op" id="6782842">(</span><span class="ident" id="6782843">err</span><span class="op" id="6782846">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6782849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6782852">if</span>&nbsp;<span class="builtinfunc" id="6782855">len</span><span class="op" id="6782858">(</span><span class="ident" id="6782859">buf0</span><span class="op" id="6782863">)</span>&nbsp;<span class="op" id="6782865">==</span>&nbsp;<span class="num" id="6782868">0</span>&nbsp;<span class="op" id="6782870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6782874">b</span><span class="op" id="6782875">.</span><span class="ident" id="6782876">Fatalf</span><span class="op" id="6782882">(</span><span class="string" id="6782883">&#34;test&nbsp;file&nbsp;has&nbsp;no&nbsp;data&#34;</span><span class="op" id="6782906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6782909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6782912">compressed</span>&nbsp;<span class="op" id="6782923">:=</span>&nbsp;<span class="builtinfunc" id="6782926">new</span><span class="op" id="6782929">(</span><span class="ident" id="6782930">bytes</span><span class="op" id="6782935">.</span><span class="ident" id="6782936">Buffer</span><span class="op" id="6782942">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6782945">w</span>&nbsp;<span class="op" id="6782947">:=</span>&nbsp;<span class="ident" id="6782950">NewWriter</span><span class="op" id="6782959">(</span><span class="ident" id="6782960">compressed</span><span class="op" id="6782970">,</span>&nbsp;<span class="ident" id="6782972">LSB</span><span class="op" id="6782975">,</span>&nbsp;<span class="num" id="6782977">8</span><span class="op" id="6782978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6782981">for</span>&nbsp;<span class="ident" id="6782985">i</span>&nbsp;<span class="op" id="6782987">:=</span>&nbsp;<span class="num" id="6782990">0</span><span class="op" id="6782991">;</span>&nbsp;<span class="ident" id="6782993">i</span>&nbsp;<span class="op" id="6782995">&lt;</span>&nbsp;<span class="ident" id="6782997">n</span><span class="op" id="6782998">;</span>&nbsp;<span class="ident" id="6783000">i</span>&nbsp;<span class="op" id="6783002">+=</span>&nbsp;<span class="builtinfunc" id="6783005">len</span><span class="op" id="6783008">(</span><span class="ident" id="6783009">buf0</span><span class="op" id="6783013">)</span>&nbsp;<span class="op" id="6783015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6783019">if</span>&nbsp;<span class="builtinfunc" id="6783022">len</span><span class="op" id="6783025">(</span><span class="ident" id="6783026">buf0</span><span class="op" id="6783030">)</span>&nbsp;<span class="op" id="6783032">&gt;</span>&nbsp;<span class="ident" id="6783034">n</span><span class="op" id="6783035">-</span><span class="ident" id="6783036">i</span>&nbsp;<span class="op" id="6783038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6783043">buf0</span>&nbsp;<span class="op" id="6783048">=</span>&nbsp;<span class="ident" id="6783050">buf0</span><span class="op" id="6783054">[</span><span class="op" id="6783055">:</span><span class="ident" id="6783056">n</span><span class="op" id="6783057">-</span><span class="ident" id="6783058">i</span><span class="op" id="6783059">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6783063">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6783067">w</span><span class="op" id="6783068">.</span><span class="ident" id="6783069">Write</span><span class="op" id="6783074">(</span><span class="ident" id="6783075">buf0</span><span class="op" id="6783079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6783082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6783085">w</span><span class="op" id="6783086">.</span><span class="ident" id="6783087">Close</span><span class="op" id="6783092">(</span><span class="op" id="6783093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6783096">buf1</span>&nbsp;<span class="op" id="6783101">:=</span>&nbsp;<span class="ident" id="6783104">compressed</span><span class="op" id="6783114">.</span><span class="ident" id="6783115">Bytes</span><span class="op" id="6783120">(</span><span class="op" id="6783121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6783124">buf0</span><span class="op" id="6783128">,</span>&nbsp;<span class="ident" id="6783130">compressed</span><span class="op" id="6783140">,</span>&nbsp;<span class="ident" id="6783142">w</span>&nbsp;<span class="op" id="6783144">=</span>&nbsp;<span class="builtintype" id="6783146">nil</span><span class="op" id="6783149">,</span>&nbsp;<span class="builtintype" id="6783151">nil</span><span class="op" id="6783154">,</span>&nbsp;<span class="builtintype" id="6783156">nil</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6783161">runtime</span><span class="op" id="6783168">.</span><span class="ident" id="6783169">GC</span><span class="op" id="6783171">(</span><span class="op" id="6783172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6783175">b</span><span class="op" id="6783176">.</span><span class="ident" id="6783177">StartTimer</span><span class="op" id="6783187">(</span><span class="op" id="6783188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6783191">for</span>&nbsp;<span class="ident" id="6783195">i</span>&nbsp;<span class="op" id="6783197">:=</span>&nbsp;<span class="num" id="6783200">0</span><span class="op" id="6783201">;</span>&nbsp;<span class="ident" id="6783203">i</span>&nbsp;<span class="op" id="6783205">&lt;</span>&nbsp;<span class="ident" id="6783207">b</span><span class="op" id="6783208">.</span><span class="ident" id="6783209">N</span><span class="op" id="6783210">;</span>&nbsp;<span class="ident" id="6783212">i</span><span class="op" id="6783213">++</span>&nbsp;<span class="op" id="6783216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6783220">io</span><span class="op" id="6783222">.</span><span class="ident" id="6783223">Copy</span><span class="op" id="6783227">(</span><span class="ident" id="6783228">ioutil</span><span class="op" id="6783234">.</span><span class="ident" id="6783235">Discard</span><span class="op" id="6783242">,</span>&nbsp;<span class="ident" id="6783244">NewReader</span><span class="op" id="6783253">(</span><span class="ident" id="6783254">bytes</span><span class="op" id="6783259">.</span><span class="ident" id="6783260">NewReader</span><span class="op" id="6783269">(</span><span class="ident" id="6783270">buf1</span><span class="op" id="6783274">)</span><span class="op" id="6783275">,</span>&nbsp;<span class="ident" id="6783277">LSB</span><span class="op" id="6783280">,</span>&nbsp;<span class="num" id="6783282">8</span><span class="op" id="6783283">)</span><span class="op" id="6783284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6783287">}</span><br>
<span class="lineno">140</span><span class="op" id="6783289">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6783292">func</span>&nbsp;<span class="ident" id="6783297">BenchmarkDecoder1e4</span><span class="op" id="6783316">(</span><span class="ident" id="6783317">b</span>&nbsp;<span class="op" id="6783319">*</span><span class="ident" id="6783320">testing</span><span class="op" id="6783327">.</span><span class="ident" id="6783328">B</span><span class="op" id="6783329">)</span>&nbsp;<span class="op" id="6783331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6783334">benchmarkDecoder</span><span class="op" id="6783350">(</span><span class="ident" id="6783351">b</span><span class="op" id="6783352">,</span>&nbsp;<span class="num" id="6783354">1e4</span><span class="op" id="6783357">)</span><br>
<span class="lineno"></span><span class="op" id="6783359">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="keyword" id="6783362">func</span>&nbsp;<span class="ident" id="6783367">BenchmarkDecoder1e5</span><span class="op" id="6783386">(</span><span class="ident" id="6783387">b</span>&nbsp;<span class="op" id="6783389">*</span><span class="ident" id="6783390">testing</span><span class="op" id="6783397">.</span><span class="ident" id="6783398">B</span><span class="op" id="6783399">)</span>&nbsp;<span class="op" id="6783401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6783404">benchmarkDecoder</span><span class="op" id="6783420">(</span><span class="ident" id="6783421">b</span><span class="op" id="6783422">,</span>&nbsp;<span class="num" id="6783424">1e5</span><span class="op" id="6783427">)</span><br>
<span class="lineno"></span><span class="op" id="6783429">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="keyword" id="6783432">func</span>&nbsp;<span class="ident" id="6783437">BenchmarkDecoder1e6</span><span class="op" id="6783456">(</span><span class="ident" id="6783457">b</span>&nbsp;<span class="op" id="6783459">*</span><span class="ident" id="6783460">testing</span><span class="op" id="6783467">.</span><span class="ident" id="6783468">B</span><span class="op" id="6783469">)</span>&nbsp;<span class="op" id="6783471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6783474">benchmarkDecoder</span><span class="op" id="6783490">(</span><span class="ident" id="6783491">b</span><span class="op" id="6783492">,</span>&nbsp;<span class="num" id="6783494">1e6</span><span class="op" id="6783497">)</span><br>
<span class="lineno"></span><span class="op" id="6783499">}</span>
</div>
</body>
</html>
