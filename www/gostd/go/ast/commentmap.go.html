<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/ast</h2>
<ul>
<li><a href="/gostd/go/ast/ast.go.html">ast.go</a></li>
<li><a href="/gostd/go/ast/ast_test.go.html">ast_test.go</a></li>
<li><a href="/gostd/go/ast/commentmap.go.html" class="current">commentmap.go</a></li>
<li><a href="/gostd/go/ast/commentmap_test.go.html">commentmap_test.go</a></li>
<li><a href="/gostd/go/ast/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/ast/filter.go.html">filter.go</a></li>
<li><a href="/gostd/go/ast/filter_test.go.html">filter_test.go</a></li>
<li><a href="/gostd/go/ast/import.go.html">import.go</a></li>
<li><a href="/gostd/go/ast/print.go.html">print.go</a></li>
<li><a href="/gostd/go/ast/print_test.go.html">print_test.go</a></li>
<li><a href="/gostd/go/ast/resolve.go.html">resolve.go</a></li>
<li><a href="/gostd/go/ast/scope.go.html">scope.go</a></li>
<li><a href="/gostd/go/ast/walk.go.html">walk.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2824455">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2824510">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2824564">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2824615">package</span>&nbsp;<span class="ident" id="2824623">ast</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2824628">import</span>&nbsp;<span class="op" id="2824635">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2824638">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2824647">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2824654">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2824666">&#34;sort&#34;</span><br>
<span class="lineno"></span><span class="op" id="2824673">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2824676">type</span>&nbsp;<span class="ident" id="2824681">byPos</span>&nbsp;<span class="op" id="2824687">[</span><span class="op" id="2824688">]</span><span class="op" id="2824689">*</span><span class="ident" id="2824690">CommentGroup</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="2824704">func</span>&nbsp;<span class="op" id="2824709">(</span><span class="ident" id="2824710">a</span>&nbsp;<span class="ident" id="2824712">byPos</span><span class="op" id="2824717">)</span>&nbsp;<span class="ident" id="2824719">Len</span><span class="op" id="2824722">(</span><span class="op" id="2824723">)</span>&nbsp;<span class="builtintype" id="2824725">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2824739">{</span>&nbsp;<span class="keyword" id="2824741">return</span>&nbsp;<span class="builtinfunc" id="2824748">len</span><span class="op" id="2824751">(</span><span class="ident" id="2824752">a</span><span class="op" id="2824753">)</span>&nbsp;<span class="op" id="2824755">}</span><br>
<span class="lineno"></span><span class="keyword" id="2824757">func</span>&nbsp;<span class="op" id="2824762">(</span><span class="ident" id="2824763">a</span>&nbsp;<span class="ident" id="2824765">byPos</span><span class="op" id="2824770">)</span>&nbsp;<span class="ident" id="2824772">Less</span><span class="op" id="2824776">(</span><span class="ident" id="2824777">i</span><span class="op" id="2824778">,</span>&nbsp;<span class="ident" id="2824780">j</span>&nbsp;<span class="builtintype" id="2824782">int</span><span class="op" id="2824785">)</span>&nbsp;<span class="builtintype" id="2824787">bool</span>&nbsp;<span class="op" id="2824792">{</span>&nbsp;<span class="keyword" id="2824794">return</span>&nbsp;<span class="ident" id="2824801">a</span><span class="op" id="2824802">[</span><span class="ident" id="2824803">i</span><span class="op" id="2824804">]</span><span class="op" id="2824805">.</span><span class="ident" id="2824806">Pos</span><span class="op" id="2824809">(</span><span class="op" id="2824810">)</span>&nbsp;<span class="op" id="2824812">&lt;</span>&nbsp;<span class="ident" id="2824814">a</span><span class="op" id="2824815">[</span><span class="ident" id="2824816">j</span><span class="op" id="2824817">]</span><span class="op" id="2824818">.</span><span class="ident" id="2824819">Pos</span><span class="op" id="2824822">(</span><span class="op" id="2824823">)</span>&nbsp;<span class="op" id="2824825">}</span><br>
<span class="lineno"></span><span class="keyword" id="2824827">func</span>&nbsp;<span class="op" id="2824832">(</span><span class="ident" id="2824833">a</span>&nbsp;<span class="ident" id="2824835">byPos</span><span class="op" id="2824840">)</span>&nbsp;<span class="ident" id="2824842">Swap</span><span class="op" id="2824846">(</span><span class="ident" id="2824847">i</span><span class="op" id="2824848">,</span>&nbsp;<span class="ident" id="2824850">j</span>&nbsp;<span class="builtintype" id="2824852">int</span><span class="op" id="2824855">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2824862">{</span>&nbsp;<span class="ident" id="2824864">a</span><span class="op" id="2824865">[</span><span class="ident" id="2824866">i</span><span class="op" id="2824867">]</span><span class="op" id="2824868">,</span>&nbsp;<span class="ident" id="2824870">a</span><span class="op" id="2824871">[</span><span class="ident" id="2824872">j</span><span class="op" id="2824873">]</span>&nbsp;<span class="op" id="2824875">=</span>&nbsp;<span class="ident" id="2824877">a</span><span class="op" id="2824878">[</span><span class="ident" id="2824879">j</span><span class="op" id="2824880">]</span><span class="op" id="2824881">,</span>&nbsp;<span class="ident" id="2824883">a</span><span class="op" id="2824884">[</span><span class="ident" id="2824885">i</span><span class="op" id="2824886">]</span>&nbsp;<span class="op" id="2824888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="2824891">//&nbsp;sortComments&nbsp;sorts&nbsp;the&nbsp;list&nbsp;of&nbsp;comment&nbsp;groups&nbsp;in&nbsp;source&nbsp;order.</span><br>
<span class="lineno"></span><span class="comment" id="2824957">//</span><br>
<span class="lineno"></span><span class="keyword" id="2824960">func</span>&nbsp;<span class="ident" id="2824965">sortComments</span><span class="op" id="2824977">(</span><span class="ident" id="2824978">list</span>&nbsp;<span class="op" id="2824983">[</span><span class="op" id="2824984">]</span><span class="op" id="2824985">*</span><span class="ident" id="2824986">CommentGroup</span><span class="op" id="2824998">)</span>&nbsp;<span class="op" id="2825000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2825003">//&nbsp;TODO(gri):&nbsp;Does&nbsp;it&nbsp;make&nbsp;sense&nbsp;to&nbsp;check&nbsp;for&nbsp;sorted-ness</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2825062">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;first&nbsp;(because&nbsp;we&nbsp;know&nbsp;that&nbsp;sorted-ness&nbsp;is</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2825120">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;very&nbsp;likely)?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2825149">if</span>&nbsp;<span class="ident" id="2825152">orderedList</span>&nbsp;<span class="op" id="2825164">:=</span>&nbsp;<span class="ident" id="2825167">byPos</span><span class="op" id="2825172">(</span><span class="ident" id="2825173">list</span><span class="op" id="2825177">)</span><span class="op" id="2825178">;</span>&nbsp;<span class="op" id="2825180">!</span><span class="ident" id="2825181">sort</span><span class="op" id="2825185">.</span><span class="ident" id="2825186">IsSorted</span><span class="op" id="2825194">(</span><span class="ident" id="2825195">orderedList</span><span class="op" id="2825206">)</span>&nbsp;<span class="op" id="2825208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2825212">sort</span><span class="op" id="2825216">.</span><span class="ident" id="2825217">Sort</span><span class="op" id="2825221">(</span><span class="ident" id="2825222">orderedList</span><span class="op" id="2825233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2825236">}</span><br>
<span class="lineno"></span><span class="op" id="2825238">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="2825241">//&nbsp;A&nbsp;CommentMap&nbsp;maps&nbsp;an&nbsp;AST&nbsp;node&nbsp;to&nbsp;a&nbsp;list&nbsp;of&nbsp;comment&nbsp;groups</span><br>
<span class="lineno"></span><span class="comment" id="2825302">//&nbsp;associated&nbsp;with&nbsp;it.&nbsp;See&nbsp;NewCommentMap&nbsp;for&nbsp;a&nbsp;description&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2825364">//&nbsp;the&nbsp;association.</span><br>
<span class="lineno"></span><span class="comment" id="2825384">//</span><br>
<span class="lineno">35</span><span class="keyword" id="2825387">type</span>&nbsp;<span class="ident" id="2825392">CommentMap</span>&nbsp;<span class="keyword" id="2825403">map</span><span class="op" id="2825406">[</span><span class="ident" id="2825407">Node</span><span class="op" id="2825411">]</span><span class="op" id="2825412">[</span><span class="op" id="2825413">]</span><span class="op" id="2825414">*</span><span class="ident" id="2825415">CommentGroup</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2825429">func</span>&nbsp;<span class="op" id="2825434">(</span><span class="ident" id="2825435">cmap</span>&nbsp;<span class="ident" id="2825440">CommentMap</span><span class="op" id="2825450">)</span>&nbsp;<span class="ident" id="2825452">addComment</span><span class="op" id="2825462">(</span><span class="ident" id="2825463">n</span>&nbsp;<span class="ident" id="2825465">Node</span><span class="op" id="2825469">,</span>&nbsp;<span class="ident" id="2825471">c</span>&nbsp;<span class="op" id="2825473">*</span><span class="ident" id="2825474">CommentGroup</span><span class="op" id="2825486">)</span>&nbsp;<span class="op" id="2825488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2825491">list</span>&nbsp;<span class="op" id="2825496">:=</span>&nbsp;<span class="ident" id="2825499">cmap</span><span class="op" id="2825503">[</span><span class="ident" id="2825504">n</span><span class="op" id="2825505">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2825508">if</span>&nbsp;<span class="builtinfunc" id="2825511">len</span><span class="op" id="2825514">(</span><span class="ident" id="2825515">list</span><span class="op" id="2825519">)</span>&nbsp;<span class="op" id="2825521">==</span>&nbsp;<span class="num" id="2825524">0</span>&nbsp;<span class="op" id="2825526">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2825530">list</span>&nbsp;<span class="op" id="2825535">=</span>&nbsp;<span class="op" id="2825537">[</span><span class="op" id="2825538">]</span><span class="op" id="2825539">*</span><span class="ident" id="2825540">CommentGroup</span><span class="op" id="2825552">{</span><span class="ident" id="2825553">c</span><span class="op" id="2825554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2825557">}</span>&nbsp;<span class="keyword" id="2825559">else</span>&nbsp;<span class="op" id="2825564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2825568">list</span>&nbsp;<span class="op" id="2825573">=</span>&nbsp;<span class="builtinfunc" id="2825575">append</span><span class="op" id="2825581">(</span><span class="ident" id="2825582">list</span><span class="op" id="2825586">,</span>&nbsp;<span class="ident" id="2825588">c</span><span class="op" id="2825589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2825592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2825595">cmap</span><span class="op" id="2825599">[</span><span class="ident" id="2825600">n</span><span class="op" id="2825601">]</span>&nbsp;<span class="op" id="2825603">=</span>&nbsp;<span class="ident" id="2825605">list</span><br>
<span class="lineno">45</span><span class="op" id="2825610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2825613">type</span>&nbsp;<span class="ident" id="2825618">byInterval</span>&nbsp;<span class="op" id="2825629">[</span><span class="op" id="2825630">]</span><span class="ident" id="2825631">Node</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2825637">func</span>&nbsp;<span class="op" id="2825642">(</span><span class="ident" id="2825643">a</span>&nbsp;<span class="ident" id="2825645">byInterval</span><span class="op" id="2825655">)</span>&nbsp;<span class="ident" id="2825657">Len</span><span class="op" id="2825660">(</span><span class="op" id="2825661">)</span>&nbsp;<span class="builtintype" id="2825663">int</span>&nbsp;<span class="op" id="2825667">{</span>&nbsp;<span class="keyword" id="2825669">return</span>&nbsp;<span class="builtinfunc" id="2825676">len</span><span class="op" id="2825679">(</span><span class="ident" id="2825680">a</span><span class="op" id="2825681">)</span>&nbsp;<span class="op" id="2825683">}</span><br>
<span class="lineno">50</span><span class="keyword" id="2825685">func</span>&nbsp;<span class="op" id="2825690">(</span><span class="ident" id="2825691">a</span>&nbsp;<span class="ident" id="2825693">byInterval</span><span class="op" id="2825703">)</span>&nbsp;<span class="ident" id="2825705">Less</span><span class="op" id="2825709">(</span><span class="ident" id="2825710">i</span><span class="op" id="2825711">,</span>&nbsp;<span class="ident" id="2825713">j</span>&nbsp;<span class="builtintype" id="2825715">int</span><span class="op" id="2825718">)</span>&nbsp;<span class="builtintype" id="2825720">bool</span>&nbsp;<span class="op" id="2825725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2825728">pi</span><span class="op" id="2825730">,</span>&nbsp;<span class="ident" id="2825732">pj</span>&nbsp;<span class="op" id="2825735">:=</span>&nbsp;<span class="ident" id="2825738">a</span><span class="op" id="2825739">[</span><span class="ident" id="2825740">i</span><span class="op" id="2825741">]</span><span class="op" id="2825742">.</span><span class="ident" id="2825743">Pos</span><span class="op" id="2825746">(</span><span class="op" id="2825747">)</span><span class="op" id="2825748">,</span>&nbsp;<span class="ident" id="2825750">a</span><span class="op" id="2825751">[</span><span class="ident" id="2825752">j</span><span class="op" id="2825753">]</span><span class="op" id="2825754">.</span><span class="ident" id="2825755">Pos</span><span class="op" id="2825758">(</span><span class="op" id="2825759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2825762">return</span>&nbsp;<span class="ident" id="2825769">pi</span>&nbsp;<span class="op" id="2825772">&lt;</span>&nbsp;<span class="ident" id="2825774">pj</span>&nbsp;<span class="op" id="2825777">||</span>&nbsp;<span class="ident" id="2825780">pi</span>&nbsp;<span class="op" id="2825783">==</span>&nbsp;<span class="ident" id="2825786">pj</span>&nbsp;<span class="op" id="2825789">&amp;&amp;</span>&nbsp;<span class="ident" id="2825792">a</span><span class="op" id="2825793">[</span><span class="ident" id="2825794">i</span><span class="op" id="2825795">]</span><span class="op" id="2825796">.</span><span class="ident" id="2825797">End</span><span class="op" id="2825800">(</span><span class="op" id="2825801">)</span>&nbsp;<span class="op" id="2825803">&gt;</span>&nbsp;<span class="ident" id="2825805">a</span><span class="op" id="2825806">[</span><span class="ident" id="2825807">j</span><span class="op" id="2825808">]</span><span class="op" id="2825809">.</span><span class="ident" id="2825810">End</span><span class="op" id="2825813">(</span><span class="op" id="2825814">)</span><br>
<span class="lineno"></span><span class="op" id="2825816">}</span><br>
<span class="lineno"></span><span class="keyword" id="2825818">func</span>&nbsp;<span class="op" id="2825823">(</span><span class="ident" id="2825824">a</span>&nbsp;<span class="ident" id="2825826">byInterval</span><span class="op" id="2825836">)</span>&nbsp;<span class="ident" id="2825838">Swap</span><span class="op" id="2825842">(</span><span class="ident" id="2825843">i</span><span class="op" id="2825844">,</span>&nbsp;<span class="ident" id="2825846">j</span>&nbsp;<span class="builtintype" id="2825848">int</span><span class="op" id="2825851">)</span>&nbsp;<span class="op" id="2825853">{</span>&nbsp;<span class="ident" id="2825855">a</span><span class="op" id="2825856">[</span><span class="ident" id="2825857">i</span><span class="op" id="2825858">]</span><span class="op" id="2825859">,</span>&nbsp;<span class="ident" id="2825861">a</span><span class="op" id="2825862">[</span><span class="ident" id="2825863">j</span><span class="op" id="2825864">]</span>&nbsp;<span class="op" id="2825866">=</span>&nbsp;<span class="ident" id="2825868">a</span><span class="op" id="2825869">[</span><span class="ident" id="2825870">j</span><span class="op" id="2825871">]</span><span class="op" id="2825872">,</span>&nbsp;<span class="ident" id="2825874">a</span><span class="op" id="2825875">[</span><span class="ident" id="2825876">i</span><span class="op" id="2825877">]</span>&nbsp;<span class="op" id="2825879">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="2825882">//&nbsp;nodeList&nbsp;returns&nbsp;the&nbsp;list&nbsp;of&nbsp;nodes&nbsp;of&nbsp;the&nbsp;AST&nbsp;n&nbsp;in&nbsp;source&nbsp;order.</span><br>
<span class="lineno"></span><span class="comment" id="2825950">//</span><br>
<span class="lineno"></span><span class="keyword" id="2825953">func</span>&nbsp;<span class="ident" id="2825958">nodeList</span><span class="op" id="2825966">(</span><span class="ident" id="2825967">n</span>&nbsp;<span class="ident" id="2825969">Node</span><span class="op" id="2825973">)</span>&nbsp;<span class="op" id="2825975">[</span><span class="op" id="2825976">]</span><span class="ident" id="2825977">Node</span>&nbsp;<span class="op" id="2825982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2825985">var</span>&nbsp;<span class="ident" id="2825989">list</span>&nbsp;<span class="op" id="2825994">[</span><span class="op" id="2825995">]</span><span class="ident" id="2825996">Node</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2826002">Inspect</span><span class="op" id="2826009">(</span><span class="ident" id="2826010">n</span><span class="op" id="2826011">,</span>&nbsp;<span class="keyword" id="2826013">func</span><span class="op" id="2826017">(</span><span class="ident" id="2826018">n</span>&nbsp;<span class="ident" id="2826020">Node</span><span class="op" id="2826024">)</span>&nbsp;<span class="builtintype" id="2826026">bool</span>&nbsp;<span class="op" id="2826031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2826035">//&nbsp;don&#39;t&nbsp;collect&nbsp;comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2826063">switch</span>&nbsp;<span class="ident" id="2826070">n</span><span class="op" id="2826071">.</span><span class="op" id="2826072">(</span><span class="keyword" id="2826073">type</span><span class="op" id="2826077">)</span>&nbsp;<span class="op" id="2826079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2826083">case</span>&nbsp;<span class="ident" id="2826088">nil</span><span class="op" id="2826091">,</span>&nbsp;<span class="op" id="2826093">*</span><span class="ident" id="2826094">CommentGroup</span><span class="op" id="2826106">,</span>&nbsp;<span class="op" id="2826108">*</span><span class="ident" id="2826109">Comment</span><span class="op" id="2826116">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2826121">return</span>&nbsp;<span class="builtintype" id="2826128">false</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2826136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2826140">list</span>&nbsp;<span class="op" id="2826145">=</span>&nbsp;<span class="builtinfunc" id="2826147">append</span><span class="op" id="2826153">(</span><span class="ident" id="2826154">list</span><span class="op" id="2826158">,</span>&nbsp;<span class="ident" id="2826160">n</span><span class="op" id="2826161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2826165">return</span>&nbsp;<span class="builtintype" id="2826172">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2826178">}</span><span class="op" id="2826179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2826182">//&nbsp;Note:&nbsp;The&nbsp;current&nbsp;implementation&nbsp;assumes&nbsp;that&nbsp;Inspect&nbsp;traverses&nbsp;the</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2826254">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AST&nbsp;in&nbsp;depth-first&nbsp;and&nbsp;thus&nbsp;_source_&nbsp;order.&nbsp;If&nbsp;AST&nbsp;traversal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2826325">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;does&nbsp;not&nbsp;follow&nbsp;source&nbsp;order,&nbsp;the&nbsp;sorting&nbsp;call&nbsp;below&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2826396">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2826416">//&nbsp;sort.Sort(byInterval(list))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2826448">return</span>&nbsp;<span class="ident" id="2826455">list</span><br>
<span class="lineno">75</span><span class="op" id="2826460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2826463">//&nbsp;A&nbsp;commentListReader&nbsp;helps&nbsp;iterating&nbsp;through&nbsp;a&nbsp;list&nbsp;of&nbsp;comment&nbsp;groups.</span><br>
<span class="lineno"></span><span class="comment" id="2826536">//</span><br>
<span class="lineno"></span><span class="keyword" id="2826539">type</span>&nbsp;<span class="ident" id="2826544">commentListReader</span>&nbsp;<span class="keyword" id="2826562">struct</span>&nbsp;<span class="op" id="2826569">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2826572">fset</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2826581">*</span><span class="ident" id="2826582">token</span><span class="op" id="2826587">.</span><span class="ident" id="2826588">FileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2826597">list</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2826606">[</span><span class="op" id="2826607">]</span><span class="op" id="2826608">*</span><span class="ident" id="2826609">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2826623">index</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2826632">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2826637">comment</span>&nbsp;&nbsp;<span class="op" id="2826646">*</span><span class="ident" id="2826647">CommentGroup</span>&nbsp;&nbsp;<span class="comment" id="2826661">//&nbsp;comment&nbsp;group&nbsp;at&nbsp;current&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2826696">pos</span><span class="op" id="2826699">,</span>&nbsp;<span class="ident" id="2826701">end</span>&nbsp;<span class="ident" id="2826705">token</span><span class="op" id="2826710">.</span><span class="ident" id="2826711">Position</span>&nbsp;<span class="comment" id="2826720">//&nbsp;source&nbsp;interval&nbsp;of&nbsp;comment&nbsp;group&nbsp;at&nbsp;current&nbsp;index</span><br>
<span class="lineno">85</span><span class="op" id="2826773">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2826776">func</span>&nbsp;<span class="op" id="2826781">(</span><span class="ident" id="2826782">r</span>&nbsp;<span class="op" id="2826784">*</span><span class="ident" id="2826785">commentListReader</span><span class="op" id="2826802">)</span>&nbsp;<span class="ident" id="2826804">eol</span><span class="op" id="2826807">(</span><span class="op" id="2826808">)</span>&nbsp;<span class="builtintype" id="2826810">bool</span>&nbsp;<span class="op" id="2826815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2826818">return</span>&nbsp;<span class="ident" id="2826825">r</span><span class="op" id="2826826">.</span><span class="ident" id="2826827">index</span>&nbsp;<span class="op" id="2826833">&gt;=</span>&nbsp;<span class="builtinfunc" id="2826836">len</span><span class="op" id="2826839">(</span><span class="ident" id="2826840">r</span><span class="op" id="2826841">.</span><span class="ident" id="2826842">list</span><span class="op" id="2826846">)</span><br>
<span class="lineno"></span><span class="op" id="2826848">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="2826851">func</span>&nbsp;<span class="op" id="2826856">(</span><span class="ident" id="2826857">r</span>&nbsp;<span class="op" id="2826859">*</span><span class="ident" id="2826860">commentListReader</span><span class="op" id="2826877">)</span>&nbsp;<span class="ident" id="2826879">next</span><span class="op" id="2826883">(</span><span class="op" id="2826884">)</span>&nbsp;<span class="op" id="2826886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2826889">if</span>&nbsp;<span class="op" id="2826892">!</span><span class="ident" id="2826893">r</span><span class="op" id="2826894">.</span><span class="ident" id="2826895">eol</span><span class="op" id="2826898">(</span><span class="op" id="2826899">)</span>&nbsp;<span class="op" id="2826901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2826905">r</span><span class="op" id="2826906">.</span><span class="ident" id="2826907">comment</span>&nbsp;<span class="op" id="2826915">=</span>&nbsp;<span class="ident" id="2826917">r</span><span class="op" id="2826918">.</span><span class="ident" id="2826919">list</span><span class="op" id="2826923">[</span><span class="ident" id="2826924">r</span><span class="op" id="2826925">.</span><span class="ident" id="2826926">index</span><span class="op" id="2826931">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2826935">r</span><span class="op" id="2826936">.</span><span class="ident" id="2826937">pos</span>&nbsp;<span class="op" id="2826941">=</span>&nbsp;<span class="ident" id="2826943">r</span><span class="op" id="2826944">.</span><span class="ident" id="2826945">fset</span><span class="op" id="2826949">.</span><span class="ident" id="2826950">Position</span><span class="op" id="2826958">(</span><span class="ident" id="2826959">r</span><span class="op" id="2826960">.</span><span class="ident" id="2826961">comment</span><span class="op" id="2826968">.</span><span class="ident" id="2826969">Pos</span><span class="op" id="2826972">(</span><span class="op" id="2826973">)</span><span class="op" id="2826974">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2826978">r</span><span class="op" id="2826979">.</span><span class="ident" id="2826980">end</span>&nbsp;<span class="op" id="2826984">=</span>&nbsp;<span class="ident" id="2826986">r</span><span class="op" id="2826987">.</span><span class="ident" id="2826988">fset</span><span class="op" id="2826992">.</span><span class="ident" id="2826993">Position</span><span class="op" id="2827001">(</span><span class="ident" id="2827002">r</span><span class="op" id="2827003">.</span><span class="ident" id="2827004">comment</span><span class="op" id="2827011">.</span><span class="ident" id="2827012">End</span><span class="op" id="2827015">(</span><span class="op" id="2827016">)</span><span class="op" id="2827017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2827021">r</span><span class="op" id="2827022">.</span><span class="ident" id="2827023">index</span><span class="op" id="2827028">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2827032">}</span><br>
<span class="lineno"></span><span class="op" id="2827034">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="2827037">//&nbsp;A&nbsp;nodeStack&nbsp;keeps&nbsp;track&nbsp;of&nbsp;nested&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="comment" id="2827081">//&nbsp;A&nbsp;node&nbsp;lower&nbsp;on&nbsp;the&nbsp;stack&nbsp;lexically&nbsp;contains&nbsp;the&nbsp;nodes&nbsp;higher&nbsp;on&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span><span class="comment" id="2827160">//</span><br>
<span class="lineno"></span><span class="keyword" id="2827163">type</span>&nbsp;<span class="ident" id="2827168">nodeStack</span>&nbsp;<span class="op" id="2827178">[</span><span class="op" id="2827179">]</span><span class="ident" id="2827180">Node</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="2827186">//&nbsp;push&nbsp;pops&nbsp;all&nbsp;nodes&nbsp;that&nbsp;appear&nbsp;lexically&nbsp;before&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="2827240">//&nbsp;and&nbsp;then&nbsp;pushes&nbsp;n&nbsp;on&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span><span class="comment" id="2827275">//</span><br>
<span class="lineno"></span><span class="keyword" id="2827278">func</span>&nbsp;<span class="op" id="2827283">(</span><span class="ident" id="2827284">s</span>&nbsp;<span class="op" id="2827286">*</span><span class="ident" id="2827287">nodeStack</span><span class="op" id="2827296">)</span>&nbsp;<span class="ident" id="2827298">push</span><span class="op" id="2827302">(</span><span class="ident" id="2827303">n</span>&nbsp;<span class="ident" id="2827305">Node</span><span class="op" id="2827309">)</span>&nbsp;<span class="op" id="2827311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2827314">s</span><span class="op" id="2827315">.</span><span class="ident" id="2827316">pop</span><span class="op" id="2827319">(</span><span class="ident" id="2827320">n</span><span class="op" id="2827321">.</span><span class="ident" id="2827322">Pos</span><span class="op" id="2827325">(</span><span class="op" id="2827326">)</span><span class="op" id="2827327">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2827330">*</span><span class="ident" id="2827331">s</span>&nbsp;<span class="op" id="2827333">=</span>&nbsp;<span class="builtinfunc" id="2827335">append</span><span class="op" id="2827341">(</span><span class="op" id="2827342">(</span><span class="op" id="2827343">*</span><span class="ident" id="2827344">s</span><span class="op" id="2827345">)</span><span class="op" id="2827346">,</span>&nbsp;<span class="ident" id="2827348">n</span><span class="op" id="2827349">)</span><br>
<span class="lineno"></span><span class="op" id="2827351">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2827354">//&nbsp;pop&nbsp;pops&nbsp;all&nbsp;nodes&nbsp;that&nbsp;appear&nbsp;lexically&nbsp;before&nbsp;pos</span><br>
<span class="lineno"></span><span class="comment" id="2827409">//&nbsp;(i.e.,&nbsp;whose&nbsp;lexical&nbsp;extent&nbsp;has&nbsp;ended&nbsp;before&nbsp;or&nbsp;at&nbsp;pos).</span><br>
<span class="lineno">115</span><span class="comment" id="2827469">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;last&nbsp;node&nbsp;popped.</span><br>
<span class="lineno"></span><span class="comment" id="2827505">//</span><br>
<span class="lineno"></span><span class="keyword" id="2827508">func</span>&nbsp;<span class="op" id="2827513">(</span><span class="ident" id="2827514">s</span>&nbsp;<span class="op" id="2827516">*</span><span class="ident" id="2827517">nodeStack</span><span class="op" id="2827526">)</span>&nbsp;<span class="ident" id="2827528">pop</span><span class="op" id="2827531">(</span><span class="ident" id="2827532">pos</span>&nbsp;<span class="ident" id="2827536">token</span><span class="op" id="2827541">.</span><span class="ident" id="2827542">Pos</span><span class="op" id="2827545">)</span>&nbsp;<span class="op" id="2827547">(</span><span class="ident" id="2827548">top</span>&nbsp;<span class="ident" id="2827552">Node</span><span class="op" id="2827556">)</span>&nbsp;<span class="op" id="2827558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2827561">i</span>&nbsp;<span class="op" id="2827563">:=</span>&nbsp;<span class="builtinfunc" id="2827566">len</span><span class="op" id="2827569">(</span><span class="op" id="2827570">*</span><span class="ident" id="2827571">s</span><span class="op" id="2827572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2827575">for</span>&nbsp;<span class="ident" id="2827579">i</span>&nbsp;<span class="op" id="2827581">&gt;</span>&nbsp;<span class="num" id="2827583">0</span>&nbsp;<span class="op" id="2827585">&amp;&amp;</span>&nbsp;<span class="op" id="2827588">(</span><span class="op" id="2827589">*</span><span class="ident" id="2827590">s</span><span class="op" id="2827591">)</span><span class="op" id="2827592">[</span><span class="ident" id="2827593">i</span><span class="op" id="2827594">-</span><span class="num" id="2827595">1</span><span class="op" id="2827596">]</span><span class="op" id="2827597">.</span><span class="ident" id="2827598">End</span><span class="op" id="2827601">(</span><span class="op" id="2827602">)</span>&nbsp;<span class="op" id="2827604">&lt;=</span>&nbsp;<span class="ident" id="2827607">pos</span>&nbsp;<span class="op" id="2827611">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2827615">top</span>&nbsp;<span class="op" id="2827619">=</span>&nbsp;<span class="op" id="2827621">(</span><span class="op" id="2827622">*</span><span class="ident" id="2827623">s</span><span class="op" id="2827624">)</span><span class="op" id="2827625">[</span><span class="ident" id="2827626">i</span><span class="op" id="2827627">-</span><span class="num" id="2827628">1</span><span class="op" id="2827629">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2827633">i</span><span class="op" id="2827634">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2827638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2827641">*</span><span class="ident" id="2827642">s</span>&nbsp;<span class="op" id="2827644">=</span>&nbsp;<span class="op" id="2827646">(</span><span class="op" id="2827647">*</span><span class="ident" id="2827648">s</span><span class="op" id="2827649">)</span><span class="op" id="2827650">[</span><span class="num" id="2827651">0</span><span class="op" id="2827652">:</span><span class="ident" id="2827653">i</span><span class="op" id="2827654">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2827657">return</span>&nbsp;<span class="ident" id="2827664">top</span><br>
<span class="lineno">125</span><span class="op" id="2827668">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2827671">//&nbsp;NewCommentMap&nbsp;creates&nbsp;a&nbsp;new&nbsp;comment&nbsp;map&nbsp;by&nbsp;associating&nbsp;comment&nbsp;groups</span><br>
<span class="lineno"></span><span class="comment" id="2827744">//&nbsp;of&nbsp;the&nbsp;comments&nbsp;list&nbsp;with&nbsp;the&nbsp;nodes&nbsp;of&nbsp;the&nbsp;AST&nbsp;specified&nbsp;by&nbsp;node.</span><br>
<span class="lineno"></span><span class="comment" id="2827813">//</span><br>
<span class="lineno">130</span><span class="comment" id="2827816">//&nbsp;A&nbsp;comment&nbsp;group&nbsp;g&nbsp;is&nbsp;associated&nbsp;with&nbsp;a&nbsp;node&nbsp;n&nbsp;if:</span><br>
<span class="lineno"></span><span class="comment" id="2827869">//</span><br>
<span class="lineno"></span><span class="comment" id="2827872">//&nbsp;&nbsp;&nbsp;-&nbsp;g&nbsp;starts&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;as&nbsp;n&nbsp;ends</span><br>
<span class="lineno"></span><span class="comment" id="2827915">//&nbsp;&nbsp;&nbsp;-&nbsp;g&nbsp;starts&nbsp;on&nbsp;the&nbsp;line&nbsp;immediately&nbsp;following&nbsp;n,&nbsp;and&nbsp;there&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2827981">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;least&nbsp;one&nbsp;empty&nbsp;line&nbsp;after&nbsp;g&nbsp;and&nbsp;before&nbsp;the&nbsp;next&nbsp;node</span><br>
<span class="lineno">135</span><span class="comment" id="2828045">//&nbsp;&nbsp;&nbsp;-&nbsp;g&nbsp;starts&nbsp;before&nbsp;n&nbsp;and&nbsp;is&nbsp;not&nbsp;associated&nbsp;to&nbsp;the&nbsp;node&nbsp;before&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="2828113">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;via&nbsp;the&nbsp;previous&nbsp;rules</span><br>
<span class="lineno"></span><span class="comment" id="2828143">//</span><br>
<span class="lineno"></span><span class="comment" id="2828146">//&nbsp;NewCommentMap&nbsp;tries&nbsp;to&nbsp;associate&nbsp;a&nbsp;comment&nbsp;group&nbsp;to&nbsp;the&nbsp;&#34;largest&#34;</span><br>
<span class="lineno"></span><span class="comment" id="2828215">//&nbsp;node&nbsp;possible:&nbsp;For&nbsp;instance,&nbsp;if&nbsp;the&nbsp;comment&nbsp;is&nbsp;a&nbsp;line&nbsp;comment</span><br>
<span class="lineno">140</span><span class="comment" id="2828280">//&nbsp;trailing&nbsp;an&nbsp;assignment,&nbsp;the&nbsp;comment&nbsp;is&nbsp;associated&nbsp;with&nbsp;the&nbsp;entire</span><br>
<span class="lineno"></span><span class="comment" id="2828349">//&nbsp;assignment&nbsp;rather&nbsp;than&nbsp;just&nbsp;the&nbsp;last&nbsp;operand&nbsp;in&nbsp;the&nbsp;assignment.</span><br>
<span class="lineno"></span><span class="comment" id="2828416">//</span><br>
<span class="lineno"></span><span class="keyword" id="2828419">func</span>&nbsp;<span class="ident" id="2828424">NewCommentMap</span><span class="op" id="2828437">(</span><span class="ident" id="2828438">fset</span>&nbsp;<span class="op" id="2828443">*</span><span class="ident" id="2828444">token</span><span class="op" id="2828449">.</span><span class="ident" id="2828450">FileSet</span><span class="op" id="2828457">,</span>&nbsp;<span class="ident" id="2828459">node</span>&nbsp;<span class="ident" id="2828464">Node</span><span class="op" id="2828468">,</span>&nbsp;<span class="ident" id="2828470">comments</span>&nbsp;<span class="op" id="2828479">[</span><span class="op" id="2828480">]</span><span class="op" id="2828481">*</span><span class="ident" id="2828482">CommentGroup</span><span class="op" id="2828494">)</span>&nbsp;<span class="ident" id="2828496">CommentMap</span>&nbsp;<span class="op" id="2828507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2828510">if</span>&nbsp;<span class="builtinfunc" id="2828513">len</span><span class="op" id="2828516">(</span><span class="ident" id="2828517">comments</span><span class="op" id="2828525">)</span>&nbsp;<span class="op" id="2828527">==</span>&nbsp;<span class="num" id="2828530">0</span>&nbsp;<span class="op" id="2828532">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2828536">return</span>&nbsp;<span class="ident" id="2828543">nil</span>&nbsp;<span class="comment" id="2828547">//&nbsp;no&nbsp;comments&nbsp;to&nbsp;map</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2828570">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2828574">cmap</span>&nbsp;<span class="op" id="2828579">:=</span>&nbsp;<span class="builtinfunc" id="2828582">make</span><span class="op" id="2828586">(</span><span class="ident" id="2828587">CommentMap</span><span class="op" id="2828597">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2828601">//&nbsp;set&nbsp;up&nbsp;comment&nbsp;reader&nbsp;r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2828629">tmp</span>&nbsp;<span class="op" id="2828633">:=</span>&nbsp;<span class="builtinfunc" id="2828636">make</span><span class="op" id="2828640">(</span><span class="op" id="2828641">[</span><span class="op" id="2828642">]</span><span class="op" id="2828643">*</span><span class="ident" id="2828644">CommentGroup</span><span class="op" id="2828656">,</span>&nbsp;<span class="builtinfunc" id="2828658">len</span><span class="op" id="2828661">(</span><span class="ident" id="2828662">comments</span><span class="op" id="2828670">)</span><span class="op" id="2828671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2828674">copy</span><span class="op" id="2828678">(</span><span class="ident" id="2828679">tmp</span><span class="op" id="2828682">,</span>&nbsp;<span class="ident" id="2828684">comments</span><span class="op" id="2828692">)</span>&nbsp;<span class="comment" id="2828694">//&nbsp;don&#39;t&nbsp;change&nbsp;incoming&nbsp;comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2828729">sortComments</span><span class="op" id="2828741">(</span><span class="ident" id="2828742">tmp</span><span class="op" id="2828745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2828748">r</span>&nbsp;<span class="op" id="2828750">:=</span>&nbsp;<span class="ident" id="2828753">commentListReader</span><span class="op" id="2828770">{</span><span class="ident" id="2828771">fset</span><span class="op" id="2828775">:</span>&nbsp;<span class="ident" id="2828777">fset</span><span class="op" id="2828781">,</span>&nbsp;<span class="ident" id="2828783">list</span><span class="op" id="2828787">:</span>&nbsp;<span class="ident" id="2828789">tmp</span><span class="op" id="2828792">}</span>&nbsp;<span class="comment" id="2828794">//&nbsp;!r.eol()&nbsp;because&nbsp;len(comments)&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2828833">r</span><span class="op" id="2828834">.</span><span class="ident" id="2828835">next</span><span class="op" id="2828839">(</span><span class="op" id="2828840">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2828844">//&nbsp;create&nbsp;node&nbsp;list&nbsp;in&nbsp;lexical&nbsp;order</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2828882">nodes</span>&nbsp;<span class="op" id="2828888">:=</span>&nbsp;<span class="ident" id="2828891">nodeList</span><span class="op" id="2828899">(</span><span class="ident" id="2828900">node</span><span class="op" id="2828904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2828907">nodes</span>&nbsp;<span class="op" id="2828913">=</span>&nbsp;<span class="builtinfunc" id="2828915">append</span><span class="op" id="2828921">(</span><span class="ident" id="2828922">nodes</span><span class="op" id="2828927">,</span>&nbsp;<span class="ident" id="2828929">nil</span><span class="op" id="2828932">)</span>&nbsp;<span class="comment" id="2828934">//&nbsp;append&nbsp;sentinel</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2828955">//&nbsp;set&nbsp;up&nbsp;iteration&nbsp;variables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2828986">var</span>&nbsp;<span class="op" id="2828990">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2828994">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2829000">Node</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2829015">//&nbsp;previous&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2829034">pend</span>&nbsp;&nbsp;<span class="ident" id="2829040">token</span><span class="op" id="2829045">.</span><span class="ident" id="2829046">Position</span>&nbsp;<span class="comment" id="2829055">//&nbsp;end&nbsp;of&nbsp;p</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2829069">pg</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2829075">Node</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2829090">//&nbsp;previous&nbsp;node&nbsp;group&nbsp;(enclosing&nbsp;nodes&nbsp;of&nbsp;&#34;importance&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2829149">pgend</span>&nbsp;<span class="ident" id="2829155">token</span><span class="op" id="2829160">.</span><span class="ident" id="2829161">Position</span>&nbsp;<span class="comment" id="2829170">//&nbsp;end&nbsp;of&nbsp;pg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2829185">stack</span>&nbsp;<span class="ident" id="2829191">nodeStack</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2829206">//&nbsp;stack&nbsp;of&nbsp;node&nbsp;groups</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2829231">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2829235">for</span>&nbsp;<span class="ident" id="2829239">_</span><span class="op" id="2829240">,</span>&nbsp;<span class="ident" id="2829242">q</span>&nbsp;<span class="op" id="2829244">:=</span>&nbsp;<span class="keyword" id="2829247">range</span>&nbsp;<span class="ident" id="2829253">nodes</span>&nbsp;<span class="op" id="2829259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2829263">var</span>&nbsp;<span class="ident" id="2829267">qpos</span>&nbsp;<span class="ident" id="2829272">token</span><span class="op" id="2829277">.</span><span class="ident" id="2829278">Position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2829289">if</span>&nbsp;<span class="ident" id="2829292">q</span>&nbsp;<span class="op" id="2829294">!=</span>&nbsp;<span class="ident" id="2829297">nil</span>&nbsp;<span class="op" id="2829301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2829306">qpos</span>&nbsp;<span class="op" id="2829311">=</span>&nbsp;<span class="ident" id="2829313">fset</span><span class="op" id="2829317">.</span><span class="ident" id="2829318">Position</span><span class="op" id="2829326">(</span><span class="ident" id="2829327">q</span><span class="op" id="2829328">.</span><span class="ident" id="2829329">Pos</span><span class="op" id="2829332">(</span><span class="op" id="2829333">)</span><span class="op" id="2829334">)</span>&nbsp;<span class="comment" id="2829336">//&nbsp;current&nbsp;node&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2829363">}</span>&nbsp;<span class="keyword" id="2829365">else</span>&nbsp;<span class="op" id="2829370">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2829375">//&nbsp;set&nbsp;fake&nbsp;sentinel&nbsp;position&nbsp;to&nbsp;infinity&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2829428">//&nbsp;all&nbsp;comments&nbsp;get&nbsp;processed&nbsp;before&nbsp;the&nbsp;sentinel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2829481">const</span>&nbsp;<span class="ident" id="2829487">infinity</span>&nbsp;<span class="op" id="2829496">=</span>&nbsp;<span class="num" id="2829498">1</span>&nbsp;<span class="op" id="2829500">&lt;&lt;</span>&nbsp;<span class="num" id="2829503">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2829509">qpos</span><span class="op" id="2829513">.</span><span class="ident" id="2829514">Offset</span>&nbsp;<span class="op" id="2829521">=</span>&nbsp;<span class="ident" id="2829523">infinity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2829535">qpos</span><span class="op" id="2829539">.</span><span class="ident" id="2829540">Line</span>&nbsp;<span class="op" id="2829545">=</span>&nbsp;<span class="ident" id="2829547">infinity</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2829558">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2829563">//&nbsp;process&nbsp;comments&nbsp;before&nbsp;current&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2829605">for</span>&nbsp;<span class="ident" id="2829609">r</span><span class="op" id="2829610">.</span><span class="ident" id="2829611">end</span><span class="op" id="2829614">.</span><span class="ident" id="2829615">Offset</span>&nbsp;<span class="op" id="2829622">&lt;=</span>&nbsp;<span class="ident" id="2829625">qpos</span><span class="op" id="2829629">.</span><span class="ident" id="2829630">Offset</span>&nbsp;<span class="op" id="2829637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2829642">//&nbsp;determine&nbsp;recent&nbsp;node&nbsp;group</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2829676">if</span>&nbsp;<span class="ident" id="2829679">top</span>&nbsp;<span class="op" id="2829683">:=</span>&nbsp;<span class="ident" id="2829686">stack</span><span class="op" id="2829691">.</span><span class="ident" id="2829692">pop</span><span class="op" id="2829695">(</span><span class="ident" id="2829696">r</span><span class="op" id="2829697">.</span><span class="ident" id="2829698">comment</span><span class="op" id="2829705">.</span><span class="ident" id="2829706">Pos</span><span class="op" id="2829709">(</span><span class="op" id="2829710">)</span><span class="op" id="2829711">)</span><span class="op" id="2829712">;</span>&nbsp;<span class="ident" id="2829714">top</span>&nbsp;<span class="op" id="2829718">!=</span>&nbsp;<span class="ident" id="2829721">nil</span>&nbsp;<span class="op" id="2829725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2829731">pg</span>&nbsp;<span class="op" id="2829734">=</span>&nbsp;<span class="ident" id="2829736">top</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2829744">pgend</span>&nbsp;<span class="op" id="2829750">=</span>&nbsp;<span class="ident" id="2829752">fset</span><span class="op" id="2829756">.</span><span class="ident" id="2829757">Position</span><span class="op" id="2829765">(</span><span class="ident" id="2829766">pg</span><span class="op" id="2829768">.</span><span class="ident" id="2829769">End</span><span class="op" id="2829772">(</span><span class="op" id="2829773">)</span><span class="op" id="2829774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2829779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2829784">//&nbsp;Try&nbsp;to&nbsp;associate&nbsp;a&nbsp;comment&nbsp;first&nbsp;with&nbsp;a&nbsp;node&nbsp;group</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2829841">//&nbsp;(i.e.,&nbsp;a&nbsp;node&nbsp;of&nbsp;&#34;importance&#34;&nbsp;such&nbsp;as&nbsp;a&nbsp;declaration);</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2829901">//&nbsp;if&nbsp;that&nbsp;fails,&nbsp;try&nbsp;to&nbsp;associate&nbsp;it&nbsp;with&nbsp;the&nbsp;most&nbsp;recent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2829963">//&nbsp;node.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2829975">//&nbsp;TODO(gri)&nbsp;try&nbsp;to&nbsp;simplify&nbsp;the&nbsp;logic&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2830023">var</span>&nbsp;<span class="ident" id="2830027">assoc</span>&nbsp;<span class="ident" id="2830033">Node</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2830041">switch</span>&nbsp;<span class="op" id="2830048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2830053">case</span>&nbsp;<span class="ident" id="2830058">pg</span>&nbsp;<span class="op" id="2830061">!=</span>&nbsp;<span class="ident" id="2830064">nil</span>&nbsp;<span class="op" id="2830068">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2830075">(</span><span class="ident" id="2830076">pgend</span><span class="op" id="2830081">.</span><span class="ident" id="2830082">Line</span>&nbsp;<span class="op" id="2830087">==</span>&nbsp;<span class="ident" id="2830090">r</span><span class="op" id="2830091">.</span><span class="ident" id="2830092">pos</span><span class="op" id="2830095">.</span><span class="ident" id="2830096">Line</span>&nbsp;<span class="op" id="2830101">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2830109">pgend</span><span class="op" id="2830114">.</span><span class="ident" id="2830115">Line</span><span class="op" id="2830119">+</span><span class="num" id="2830120">1</span>&nbsp;<span class="op" id="2830122">==</span>&nbsp;<span class="ident" id="2830125">r</span><span class="op" id="2830126">.</span><span class="ident" id="2830127">pos</span><span class="op" id="2830130">.</span><span class="ident" id="2830131">Line</span>&nbsp;<span class="op" id="2830136">&amp;&amp;</span>&nbsp;<span class="ident" id="2830139">r</span><span class="op" id="2830140">.</span><span class="ident" id="2830141">end</span><span class="op" id="2830144">.</span><span class="ident" id="2830145">Line</span><span class="op" id="2830149">+</span><span class="num" id="2830150">1</span>&nbsp;<span class="op" id="2830152">&lt;</span>&nbsp;<span class="ident" id="2830154">qpos</span><span class="op" id="2830158">.</span><span class="ident" id="2830159">Line</span><span class="op" id="2830163">)</span><span class="op" id="2830164">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2830170">//&nbsp;1)&nbsp;comment&nbsp;starts&nbsp;on&nbsp;same&nbsp;line&nbsp;as&nbsp;previous&nbsp;node&nbsp;group&nbsp;ends,&nbsp;or</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2830240">//&nbsp;2)&nbsp;comment&nbsp;starts&nbsp;on&nbsp;the&nbsp;line&nbsp;immediately&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2830299">//&nbsp;&nbsp;&nbsp;&nbsp;previous&nbsp;node&nbsp;group&nbsp;and&nbsp;there&nbsp;is&nbsp;an&nbsp;empty&nbsp;line&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2830363">//&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;current&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2830390">//&nbsp;=&gt;&nbsp;associate&nbsp;comment&nbsp;with&nbsp;previous&nbsp;node&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2830443">assoc</span>&nbsp;<span class="op" id="2830449">=</span>&nbsp;<span class="ident" id="2830451">pg</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2830457">case</span>&nbsp;<span class="ident" id="2830462">p</span>&nbsp;<span class="op" id="2830464">!=</span>&nbsp;<span class="ident" id="2830467">nil</span>&nbsp;<span class="op" id="2830471">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2830478">(</span><span class="ident" id="2830479">pend</span><span class="op" id="2830483">.</span><span class="ident" id="2830484">Line</span>&nbsp;<span class="op" id="2830489">==</span>&nbsp;<span class="ident" id="2830492">r</span><span class="op" id="2830493">.</span><span class="ident" id="2830494">pos</span><span class="op" id="2830497">.</span><span class="ident" id="2830498">Line</span>&nbsp;<span class="op" id="2830503">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2830511">pend</span><span class="op" id="2830515">.</span><span class="ident" id="2830516">Line</span><span class="op" id="2830520">+</span><span class="num" id="2830521">1</span>&nbsp;<span class="op" id="2830523">==</span>&nbsp;<span class="ident" id="2830526">r</span><span class="op" id="2830527">.</span><span class="ident" id="2830528">pos</span><span class="op" id="2830531">.</span><span class="ident" id="2830532">Line</span>&nbsp;<span class="op" id="2830537">&amp;&amp;</span>&nbsp;<span class="ident" id="2830540">r</span><span class="op" id="2830541">.</span><span class="ident" id="2830542">end</span><span class="op" id="2830545">.</span><span class="ident" id="2830546">Line</span><span class="op" id="2830550">+</span><span class="num" id="2830551">1</span>&nbsp;<span class="op" id="2830553">&lt;</span>&nbsp;<span class="ident" id="2830555">qpos</span><span class="op" id="2830559">.</span><span class="ident" id="2830560">Line</span>&nbsp;<span class="op" id="2830565">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2830573">q</span>&nbsp;<span class="op" id="2830575">==</span>&nbsp;<span class="ident" id="2830578">nil</span><span class="op" id="2830581">)</span><span class="op" id="2830582">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2830588">//&nbsp;same&nbsp;rules&nbsp;apply&nbsp;as&nbsp;above&nbsp;for&nbsp;p&nbsp;rather&nbsp;than&nbsp;pg,</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2830643">//&nbsp;but&nbsp;also&nbsp;associate&nbsp;with&nbsp;p&nbsp;if&nbsp;we&nbsp;are&nbsp;at&nbsp;the&nbsp;end&nbsp;(q&nbsp;==&nbsp;nil)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2830708">assoc</span>&nbsp;<span class="op" id="2830714">=</span>&nbsp;<span class="ident" id="2830716">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2830721">default</span><span class="op" id="2830728">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2830734">//&nbsp;otherwise,&nbsp;associate&nbsp;comment&nbsp;with&nbsp;current&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2830788">if</span>&nbsp;<span class="ident" id="2830791">q</span>&nbsp;<span class="op" id="2830793">==</span>&nbsp;<span class="ident" id="2830796">nil</span>&nbsp;<span class="op" id="2830800">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2830807">//&nbsp;we&nbsp;can&nbsp;only&nbsp;reach&nbsp;here&nbsp;if&nbsp;there&nbsp;was&nbsp;no&nbsp;p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2830856">//&nbsp;which&nbsp;would&nbsp;imply&nbsp;that&nbsp;there&nbsp;were&nbsp;no&nbsp;nodes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2830907">panic</span><span class="op" id="2830912">(</span><span class="string" id="2830913">&#34;internal&nbsp;error:&nbsp;no&nbsp;comments&nbsp;should&nbsp;be&nbsp;associated&nbsp;with&nbsp;sentinel&#34;</span><span class="op" id="2830977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2830983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2830989">assoc</span>&nbsp;<span class="op" id="2830995">=</span>&nbsp;<span class="ident" id="2830997">q</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2831002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2831007">cmap</span><span class="op" id="2831011">.</span><span class="ident" id="2831012">addComment</span><span class="op" id="2831022">(</span><span class="ident" id="2831023">assoc</span><span class="op" id="2831028">,</span>&nbsp;<span class="ident" id="2831030">r</span><span class="op" id="2831031">.</span><span class="ident" id="2831032">comment</span><span class="op" id="2831039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2831044">if</span>&nbsp;<span class="ident" id="2831047">r</span><span class="op" id="2831048">.</span><span class="ident" id="2831049">eol</span><span class="op" id="2831052">(</span><span class="op" id="2831053">)</span>&nbsp;<span class="op" id="2831055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2831061">return</span>&nbsp;<span class="ident" id="2831068">cmap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2831076">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2831081">r</span><span class="op" id="2831082">.</span><span class="ident" id="2831083">next</span><span class="op" id="2831087">(</span><span class="op" id="2831088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2831092">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2831097">//&nbsp;update&nbsp;previous&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2831123">p</span>&nbsp;<span class="op" id="2831125">=</span>&nbsp;<span class="ident" id="2831127">q</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2831131">pend</span>&nbsp;<span class="op" id="2831136">=</span>&nbsp;<span class="ident" id="2831138">fset</span><span class="op" id="2831142">.</span><span class="ident" id="2831143">Position</span><span class="op" id="2831151">(</span><span class="ident" id="2831152">p</span><span class="op" id="2831153">.</span><span class="ident" id="2831154">End</span><span class="op" id="2831157">(</span><span class="op" id="2831158">)</span><span class="op" id="2831159">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2831164">//&nbsp;update&nbsp;previous&nbsp;node&nbsp;group&nbsp;if&nbsp;we&nbsp;see&nbsp;an&nbsp;&#34;important&#34;&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2831226">switch</span>&nbsp;<span class="ident" id="2831233">q</span><span class="op" id="2831234">.</span><span class="op" id="2831235">(</span><span class="keyword" id="2831236">type</span><span class="op" id="2831240">)</span>&nbsp;<span class="op" id="2831242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2831246">case</span>&nbsp;<span class="op" id="2831251">*</span><span class="ident" id="2831252">File</span><span class="op" id="2831256">,</span>&nbsp;<span class="op" id="2831258">*</span><span class="ident" id="2831259">Field</span><span class="op" id="2831264">,</span>&nbsp;<span class="ident" id="2831266">Decl</span><span class="op" id="2831270">,</span>&nbsp;<span class="ident" id="2831272">Spec</span><span class="op" id="2831276">,</span>&nbsp;<span class="ident" id="2831278">Stmt</span><span class="op" id="2831282">:</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2831287">stack</span><span class="op" id="2831292">.</span><span class="ident" id="2831293">push</span><span class="op" id="2831297">(</span><span class="ident" id="2831298">q</span><span class="op" id="2831299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2831303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2831306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2831310">return</span>&nbsp;<span class="ident" id="2831317">cmap</span><br>
<span class="lineno">240</span><span class="op" id="2831322">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2831325">//&nbsp;Update&nbsp;replaces&nbsp;an&nbsp;old&nbsp;node&nbsp;in&nbsp;the&nbsp;comment&nbsp;map&nbsp;with&nbsp;the&nbsp;new&nbsp;node</span><br>
<span class="lineno"></span><span class="comment" id="2831393">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;node.&nbsp;Comments&nbsp;that&nbsp;were&nbsp;associated&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2831461">//&nbsp;old&nbsp;node&nbsp;are&nbsp;associated&nbsp;with&nbsp;the&nbsp;new&nbsp;node.</span><br>
<span class="lineno">245</span><span class="comment" id="2831507">//</span><br>
<span class="lineno"></span><span class="keyword" id="2831510">func</span>&nbsp;<span class="op" id="2831515">(</span><span class="ident" id="2831516">cmap</span>&nbsp;<span class="ident" id="2831521">CommentMap</span><span class="op" id="2831531">)</span>&nbsp;<span class="ident" id="2831533">Update</span><span class="op" id="2831539">(</span><span class="ident" id="2831540">old</span><span class="op" id="2831543">,</span>&nbsp;<span class="builtinfunc" id="2831545">new</span>&nbsp;<span class="ident" id="2831549">Node</span><span class="op" id="2831553">)</span>&nbsp;<span class="ident" id="2831555">Node</span>&nbsp;<span class="op" id="2831560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2831563">if</span>&nbsp;<span class="ident" id="2831566">list</span>&nbsp;<span class="op" id="2831571">:=</span>&nbsp;<span class="ident" id="2831574">cmap</span><span class="op" id="2831578">[</span><span class="ident" id="2831579">old</span><span class="op" id="2831582">]</span><span class="op" id="2831583">;</span>&nbsp;<span class="builtinfunc" id="2831585">len</span><span class="op" id="2831588">(</span><span class="ident" id="2831589">list</span><span class="op" id="2831593">)</span>&nbsp;<span class="op" id="2831595">&gt;</span>&nbsp;<span class="num" id="2831597">0</span>&nbsp;<span class="op" id="2831599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2831603">delete</span><span class="op" id="2831609">(</span><span class="ident" id="2831610">cmap</span><span class="op" id="2831614">,</span>&nbsp;<span class="ident" id="2831616">old</span><span class="op" id="2831619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2831623">cmap</span><span class="op" id="2831627">[</span><span class="builtinfunc" id="2831628">new</span><span class="op" id="2831631">]</span>&nbsp;<span class="op" id="2831633">=</span>&nbsp;<span class="builtinfunc" id="2831635">append</span><span class="op" id="2831641">(</span><span class="ident" id="2831642">cmap</span><span class="op" id="2831646">[</span><span class="builtinfunc" id="2831647">new</span><span class="op" id="2831650">]</span><span class="op" id="2831651">,</span>&nbsp;<span class="ident" id="2831653">list</span><span class="op" id="2831657">...</span><span class="op" id="2831660">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2831663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2831666">return</span>&nbsp;<span class="builtinfunc" id="2831673">new</span><br>
<span class="lineno"></span><span class="op" id="2831677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2831680">//&nbsp;Filter&nbsp;returns&nbsp;a&nbsp;new&nbsp;comment&nbsp;map&nbsp;consisting&nbsp;of&nbsp;only&nbsp;those</span><br>
<span class="lineno">255</span><span class="comment" id="2831741">//&nbsp;entries&nbsp;of&nbsp;cmap&nbsp;for&nbsp;which&nbsp;a&nbsp;corresponding&nbsp;node&nbsp;exists&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="2831801">//&nbsp;the&nbsp;AST&nbsp;specified&nbsp;by&nbsp;node.</span><br>
<span class="lineno"></span><span class="comment" id="2831831">//</span><br>
<span class="lineno"></span><span class="keyword" id="2831834">func</span>&nbsp;<span class="op" id="2831839">(</span><span class="ident" id="2831840">cmap</span>&nbsp;<span class="ident" id="2831845">CommentMap</span><span class="op" id="2831855">)</span>&nbsp;<span class="ident" id="2831857">Filter</span><span class="op" id="2831863">(</span><span class="ident" id="2831864">node</span>&nbsp;<span class="ident" id="2831869">Node</span><span class="op" id="2831873">)</span>&nbsp;<span class="ident" id="2831875">CommentMap</span>&nbsp;<span class="op" id="2831886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2831889">umap</span>&nbsp;<span class="op" id="2831894">:=</span>&nbsp;<span class="builtinfunc" id="2831897">make</span><span class="op" id="2831901">(</span><span class="ident" id="2831902">CommentMap</span><span class="op" id="2831912">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2831915">Inspect</span><span class="op" id="2831922">(</span><span class="ident" id="2831923">node</span><span class="op" id="2831927">,</span>&nbsp;<span class="keyword" id="2831929">func</span><span class="op" id="2831933">(</span><span class="ident" id="2831934">n</span>&nbsp;<span class="ident" id="2831936">Node</span><span class="op" id="2831940">)</span>&nbsp;<span class="builtintype" id="2831942">bool</span>&nbsp;<span class="op" id="2831947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2831951">if</span>&nbsp;<span class="ident" id="2831954">g</span>&nbsp;<span class="op" id="2831956">:=</span>&nbsp;<span class="ident" id="2831959">cmap</span><span class="op" id="2831963">[</span><span class="ident" id="2831964">n</span><span class="op" id="2831965">]</span><span class="op" id="2831966">;</span>&nbsp;<span class="builtinfunc" id="2831968">len</span><span class="op" id="2831971">(</span><span class="ident" id="2831972">g</span><span class="op" id="2831973">)</span>&nbsp;<span class="op" id="2831975">&gt;</span>&nbsp;<span class="num" id="2831977">0</span>&nbsp;<span class="op" id="2831979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2831984">umap</span><span class="op" id="2831988">[</span><span class="ident" id="2831989">n</span><span class="op" id="2831990">]</span>&nbsp;<span class="op" id="2831992">=</span>&nbsp;<span class="ident" id="2831994">g</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2831998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2832002">return</span>&nbsp;<span class="builtintype" id="2832009">true</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2832015">}</span><span class="op" id="2832016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2832019">return</span>&nbsp;<span class="ident" id="2832026">umap</span><br>
<span class="lineno"></span><span class="op" id="2832031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2832034">//&nbsp;Comments&nbsp;returns&nbsp;the&nbsp;list&nbsp;of&nbsp;comment&nbsp;groups&nbsp;in&nbsp;the&nbsp;comment&nbsp;map.</span><br>
<span class="lineno">270</span><span class="comment" id="2832101">//&nbsp;The&nbsp;result&nbsp;is&nbsp;sorted&nbsp;is&nbsp;source&nbsp;order.</span><br>
<span class="lineno"></span><span class="comment" id="2832142">//</span><br>
<span class="lineno"></span><span class="keyword" id="2832145">func</span>&nbsp;<span class="op" id="2832150">(</span><span class="ident" id="2832151">cmap</span>&nbsp;<span class="ident" id="2832156">CommentMap</span><span class="op" id="2832166">)</span>&nbsp;<span class="ident" id="2832168">Comments</span><span class="op" id="2832176">(</span><span class="op" id="2832177">)</span>&nbsp;<span class="op" id="2832179">[</span><span class="op" id="2832180">]</span><span class="op" id="2832181">*</span><span class="ident" id="2832182">CommentGroup</span>&nbsp;<span class="op" id="2832195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2832198">list</span>&nbsp;<span class="op" id="2832203">:=</span>&nbsp;<span class="builtinfunc" id="2832206">make</span><span class="op" id="2832210">(</span><span class="op" id="2832211">[</span><span class="op" id="2832212">]</span><span class="op" id="2832213">*</span><span class="ident" id="2832214">CommentGroup</span><span class="op" id="2832226">,</span>&nbsp;<span class="num" id="2832228">0</span><span class="op" id="2832229">,</span>&nbsp;<span class="builtinfunc" id="2832231">len</span><span class="op" id="2832234">(</span><span class="ident" id="2832235">cmap</span><span class="op" id="2832239">)</span><span class="op" id="2832240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2832243">for</span>&nbsp;<span class="ident" id="2832247">_</span><span class="op" id="2832248">,</span>&nbsp;<span class="ident" id="2832250">e</span>&nbsp;<span class="op" id="2832252">:=</span>&nbsp;<span class="keyword" id="2832255">range</span>&nbsp;<span class="ident" id="2832261">cmap</span>&nbsp;<span class="op" id="2832266">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2832270">list</span>&nbsp;<span class="op" id="2832275">=</span>&nbsp;<span class="builtinfunc" id="2832277">append</span><span class="op" id="2832283">(</span><span class="ident" id="2832284">list</span><span class="op" id="2832288">,</span>&nbsp;<span class="ident" id="2832290">e</span><span class="op" id="2832291">...</span><span class="op" id="2832294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2832297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2832300">sortComments</span><span class="op" id="2832312">(</span><span class="ident" id="2832313">list</span><span class="op" id="2832317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2832320">return</span>&nbsp;<span class="ident" id="2832327">list</span><br>
<span class="lineno"></span><span class="op" id="2832332">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="2832335">func</span>&nbsp;<span class="ident" id="2832340">summary</span><span class="op" id="2832347">(</span><span class="ident" id="2832348">list</span>&nbsp;<span class="op" id="2832353">[</span><span class="op" id="2832354">]</span><span class="op" id="2832355">*</span><span class="ident" id="2832356">CommentGroup</span><span class="op" id="2832368">)</span>&nbsp;<span class="builtintype" id="2832370">string</span>&nbsp;<span class="op" id="2832377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2832380">const</span>&nbsp;<span class="ident" id="2832386">maxLen</span>&nbsp;<span class="op" id="2832393">=</span>&nbsp;<span class="num" id="2832395">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2832399">var</span>&nbsp;<span class="ident" id="2832403">buf</span>&nbsp;<span class="ident" id="2832407">bytes</span><span class="op" id="2832412">.</span><span class="ident" id="2832413">Buffer</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2832422">//&nbsp;collect&nbsp;comments&nbsp;text</span><br>
<span class="lineno"></span><span class="ident" id="2832447">loop</span><span class="op" id="2832451">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2832454">for</span>&nbsp;<span class="ident" id="2832458">_</span><span class="op" id="2832459">,</span>&nbsp;<span class="ident" id="2832461">group</span>&nbsp;<span class="op" id="2832467">:=</span>&nbsp;<span class="keyword" id="2832470">range</span>&nbsp;<span class="ident" id="2832476">list</span>&nbsp;<span class="op" id="2832481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2832485">//&nbsp;Note:&nbsp;CommentGroup.Text()&nbsp;does&nbsp;too&nbsp;much&nbsp;work&nbsp;for&nbsp;what&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2832547">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;need&nbsp;and&nbsp;would&nbsp;only&nbsp;replace&nbsp;this&nbsp;innermost&nbsp;loop.</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2832607">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Just&nbsp;do&nbsp;it&nbsp;explicitly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2832641">for</span>&nbsp;<span class="ident" id="2832645">_</span><span class="op" id="2832646">,</span>&nbsp;<span class="ident" id="2832648">comment</span>&nbsp;<span class="op" id="2832656">:=</span>&nbsp;<span class="keyword" id="2832659">range</span>&nbsp;<span class="ident" id="2832665">group</span><span class="op" id="2832670">.</span><span class="ident" id="2832671">List</span>&nbsp;<span class="op" id="2832676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2832681">if</span>&nbsp;<span class="ident" id="2832684">buf</span><span class="op" id="2832687">.</span><span class="ident" id="2832688">Len</span><span class="op" id="2832691">(</span><span class="op" id="2832692">)</span>&nbsp;<span class="op" id="2832694">&gt;=</span>&nbsp;<span class="ident" id="2832697">maxLen</span>&nbsp;<span class="op" id="2832704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2832710">break</span>&nbsp;<span class="ident" id="2832716">loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2832724">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2832729">buf</span><span class="op" id="2832732">.</span><span class="ident" id="2832733">WriteString</span><span class="op" id="2832744">(</span><span class="ident" id="2832745">comment</span><span class="op" id="2832752">.</span><span class="ident" id="2832753">Text</span><span class="op" id="2832757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2832761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2832764">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2832768">//&nbsp;truncate&nbsp;if&nbsp;too&nbsp;long</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2832793">if</span>&nbsp;<span class="ident" id="2832796">buf</span><span class="op" id="2832799">.</span><span class="ident" id="2832800">Len</span><span class="op" id="2832803">(</span><span class="op" id="2832804">)</span>&nbsp;<span class="op" id="2832806">&gt;</span>&nbsp;<span class="ident" id="2832808">maxLen</span>&nbsp;<span class="op" id="2832815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2832819">buf</span><span class="op" id="2832822">.</span><span class="ident" id="2832823">Truncate</span><span class="op" id="2832831">(</span><span class="ident" id="2832832">maxLen</span>&nbsp;<span class="op" id="2832839">-</span>&nbsp;<span class="num" id="2832841">3</span><span class="op" id="2832842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2832846">buf</span><span class="op" id="2832849">.</span><span class="ident" id="2832850">WriteString</span><span class="op" id="2832861">(</span><span class="string" id="2832862">&#34;...&#34;</span><span class="op" id="2832867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2832870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2832874">//&nbsp;replace&nbsp;any&nbsp;invisibles&nbsp;with&nbsp;blanks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2832913">bytes</span>&nbsp;<span class="op" id="2832919">:=</span>&nbsp;<span class="ident" id="2832922">buf</span><span class="op" id="2832925">.</span><span class="ident" id="2832926">Bytes</span><span class="op" id="2832931">(</span><span class="op" id="2832932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2832935">for</span>&nbsp;<span class="ident" id="2832939">i</span><span class="op" id="2832940">,</span>&nbsp;<span class="ident" id="2832942">b</span>&nbsp;<span class="op" id="2832944">:=</span>&nbsp;<span class="keyword" id="2832947">range</span>&nbsp;<span class="ident" id="2832953">bytes</span>&nbsp;<span class="op" id="2832959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2832963">switch</span>&nbsp;<span class="ident" id="2832970">b</span>&nbsp;<span class="op" id="2832972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2832976">case</span>&nbsp;<span class="string" id="2832981">&#39;\t&#39;</span><span class="op" id="2832985">,</span>&nbsp;<span class="string" id="2832987">&#39;\n&#39;</span><span class="op" id="2832991">,</span>&nbsp;<span class="string" id="2832993">&#39;\r&#39;</span><span class="op" id="2832997">:</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2833002">bytes</span><span class="op" id="2833007">[</span><span class="ident" id="2833008">i</span><span class="op" id="2833009">]</span>&nbsp;<span class="op" id="2833011">=</span>&nbsp;<span class="string" id="2833013">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2833019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2833022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2833026">return</span>&nbsp;<span class="builtintype" id="2833033">string</span><span class="op" id="2833039">(</span><span class="ident" id="2833040">bytes</span><span class="op" id="2833045">)</span><br>
<span class="lineno">315</span><span class="op" id="2833047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2833050">func</span>&nbsp;<span class="op" id="2833055">(</span><span class="ident" id="2833056">cmap</span>&nbsp;<span class="ident" id="2833061">CommentMap</span><span class="op" id="2833071">)</span>&nbsp;<span class="ident" id="2833073">String</span><span class="op" id="2833079">(</span><span class="op" id="2833080">)</span>&nbsp;<span class="builtintype" id="2833082">string</span>&nbsp;<span class="op" id="2833089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2833092">var</span>&nbsp;<span class="ident" id="2833096">buf</span>&nbsp;<span class="ident" id="2833100">bytes</span><span class="op" id="2833105">.</span><span class="ident" id="2833106">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2833114">fmt</span><span class="op" id="2833117">.</span><span class="ident" id="2833118">Fprintln</span><span class="op" id="2833126">(</span><span class="op" id="2833127">&amp;</span><span class="ident" id="2833128">buf</span><span class="op" id="2833131">,</span>&nbsp;<span class="string" id="2833133">&#34;CommentMap&nbsp;{&#34;</span><span class="op" id="2833147">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2833150">for</span>&nbsp;<span class="ident" id="2833154">node</span><span class="op" id="2833158">,</span>&nbsp;<span class="ident" id="2833160">comment</span>&nbsp;<span class="op" id="2833168">:=</span>&nbsp;<span class="keyword" id="2833171">range</span>&nbsp;<span class="ident" id="2833177">cmap</span>&nbsp;<span class="op" id="2833182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2833186">//&nbsp;print&nbsp;name&nbsp;of&nbsp;identifiers;&nbsp;print&nbsp;node&nbsp;type&nbsp;for&nbsp;other&nbsp;nodes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2833250">var</span>&nbsp;<span class="ident" id="2833254">s</span>&nbsp;<span class="builtintype" id="2833256">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2833265">if</span>&nbsp;<span class="ident" id="2833268">ident</span><span class="op" id="2833273">,</span>&nbsp;<span class="ident" id="2833275">ok</span>&nbsp;<span class="op" id="2833278">:=</span>&nbsp;<span class="ident" id="2833281">node</span><span class="op" id="2833285">.</span><span class="op" id="2833286">(</span><span class="op" id="2833287">*</span><span class="ident" id="2833288">Ident</span><span class="op" id="2833293">)</span><span class="op" id="2833294">;</span>&nbsp;<span class="ident" id="2833296">ok</span>&nbsp;<span class="op" id="2833299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2833304">s</span>&nbsp;<span class="op" id="2833306">=</span>&nbsp;<span class="ident" id="2833308">ident</span><span class="op" id="2833313">.</span><span class="ident" id="2833314">Name</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2833321">}</span>&nbsp;<span class="keyword" id="2833323">else</span>&nbsp;<span class="op" id="2833328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2833333">s</span>&nbsp;<span class="op" id="2833335">=</span>&nbsp;<span class="ident" id="2833337">fmt</span><span class="op" id="2833340">.</span><span class="ident" id="2833341">Sprintf</span><span class="op" id="2833348">(</span><span class="string" id="2833349">&#34;%T&#34;</span><span class="op" id="2833353">,</span>&nbsp;<span class="ident" id="2833355">node</span><span class="op" id="2833359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2833363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2833367">fmt</span><span class="op" id="2833370">.</span><span class="ident" id="2833371">Fprintf</span><span class="op" id="2833378">(</span><span class="op" id="2833379">&amp;</span><span class="ident" id="2833380">buf</span><span class="op" id="2833383">,</span>&nbsp;<span class="string" id="2833385">&#34;\t%p&nbsp;&nbsp;%20s:&nbsp;&nbsp;%s\n&#34;</span><span class="op" id="2833404">,</span>&nbsp;<span class="ident" id="2833406">node</span><span class="op" id="2833410">,</span>&nbsp;<span class="ident" id="2833412">s</span><span class="op" id="2833413">,</span>&nbsp;<span class="ident" id="2833415">summary</span><span class="op" id="2833422">(</span><span class="ident" id="2833423">comment</span><span class="op" id="2833430">)</span><span class="op" id="2833431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2833434">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2833437">fmt</span><span class="op" id="2833440">.</span><span class="ident" id="2833441">Fprintln</span><span class="op" id="2833449">(</span><span class="op" id="2833450">&amp;</span><span class="ident" id="2833451">buf</span><span class="op" id="2833454">,</span>&nbsp;<span class="string" id="2833456">&#34;}&#34;</span><span class="op" id="2833459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2833462">return</span>&nbsp;<span class="ident" id="2833469">buf</span><span class="op" id="2833472">.</span><span class="ident" id="2833473">String</span><span class="op" id="2833479">(</span><span class="op" id="2833480">)</span><br>
<span class="lineno"></span><span class="op" id="2833482">}</span>
</div>
</body>
</html>
