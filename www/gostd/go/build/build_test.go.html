<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/build</h2>
<ul>
<li><a href="/gostd/go/build/build.go.html">build.go</a></li>
<li><a href="/gostd/go/build/build_test.go.html">build_test.go</a></li>
<li><a href="/gostd/go/build/deps_test.go.html">deps_test.go</a></li>
<li><a href="/gostd/go/build/doc.go.html">doc.go</a></li>
<li><a href="/gostd/go/build/read.go.html">read.go</a></li>
<li><a href="/gostd/go/build/read_test.go.html">read_test.go</a></li>
<li><a href="/gostd/go/build/syslist.go.html">syslist.go</a></li>
<li><a href="/gostd/go/build/syslist_test.go.html">syslist_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7099417">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7099473">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7099527">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7099578">package</span>&nbsp;<span class="ident" id="7099586">build</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7099593">import</span>&nbsp;<span class="op" id="7099600">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7099603">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7099609">&#34;os&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7099615">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7099632">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7099643">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7099654">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7099665">&#34;testing&#34;</span><br>
<span class="lineno">15</span><span class="op" id="7099675">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7099678">func</span>&nbsp;<span class="ident" id="7099683">TestMatch</span><span class="op" id="7099692">(</span><span class="ident" id="7099693">t</span>&nbsp;<span class="op" id="7099695">*</span><span class="ident" id="7099696">testing</span><span class="op" id="7099703">.</span><span class="ident" id="7099704">T</span><span class="op" id="7099705">)</span>&nbsp;<span class="op" id="7099707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7099710">ctxt</span>&nbsp;<span class="op" id="7099715">:=</span>&nbsp;<span class="ident" id="7099718">Default</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7099727">what</span>&nbsp;<span class="op" id="7099732">:=</span>&nbsp;<span class="string" id="7099735">&#34;default&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7099746">match</span>&nbsp;<span class="op" id="7099752">:=</span>&nbsp;<span class="keyword" id="7099755">func</span><span class="op" id="7099759">(</span><span class="ident" id="7099760">tag</span>&nbsp;<span class="builtintype" id="7099764">string</span><span class="op" id="7099770">,</span>&nbsp;<span class="ident" id="7099772">want</span>&nbsp;<span class="keyword" id="7099777">map</span><span class="op" id="7099780">[</span><span class="builtintype" id="7099781">string</span><span class="op" id="7099787">]</span><span class="builtintype" id="7099788">bool</span><span class="op" id="7099792">)</span>&nbsp;<span class="op" id="7099794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7099798">m</span>&nbsp;<span class="op" id="7099800">:=</span>&nbsp;<span class="builtinfunc" id="7099803">make</span><span class="op" id="7099807">(</span><span class="keyword" id="7099808">map</span><span class="op" id="7099811">[</span><span class="builtintype" id="7099812">string</span><span class="op" id="7099818">]</span><span class="builtintype" id="7099819">bool</span><span class="op" id="7099823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7099827">if</span>&nbsp;<span class="op" id="7099830">!</span><span class="ident" id="7099831">ctxt</span><span class="op" id="7099835">.</span><span class="ident" id="7099836">match</span><span class="op" id="7099841">(</span><span class="ident" id="7099842">tag</span><span class="op" id="7099845">,</span>&nbsp;<span class="ident" id="7099847">m</span><span class="op" id="7099848">)</span>&nbsp;<span class="op" id="7099850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7099855">t</span><span class="op" id="7099856">.</span><span class="ident" id="7099857">Errorf</span><span class="op" id="7099863">(</span><span class="string" id="7099864">&#34;%s&nbsp;context&nbsp;should&nbsp;match&nbsp;%s,&nbsp;does&nbsp;not&#34;</span><span class="op" id="7099902">,</span>&nbsp;<span class="ident" id="7099904">what</span><span class="op" id="7099908">,</span>&nbsp;<span class="ident" id="7099910">tag</span><span class="op" id="7099913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7099917">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7099921">if</span>&nbsp;<span class="op" id="7099924">!</span><span class="ident" id="7099925">reflect</span><span class="op" id="7099932">.</span><span class="ident" id="7099933">DeepEqual</span><span class="op" id="7099942">(</span><span class="ident" id="7099943">m</span><span class="op" id="7099944">,</span>&nbsp;<span class="ident" id="7099946">want</span><span class="op" id="7099950">)</span>&nbsp;<span class="op" id="7099952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7099957">t</span><span class="op" id="7099958">.</span><span class="ident" id="7099959">Errorf</span><span class="op" id="7099965">(</span><span class="string" id="7099966">&#34;%s&nbsp;tags&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7099989">,</span>&nbsp;<span class="ident" id="7099991">tag</span><span class="op" id="7099994">,</span>&nbsp;<span class="ident" id="7099996">m</span><span class="op" id="7099997">,</span>&nbsp;<span class="ident" id="7099999">want</span><span class="op" id="7100003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7100007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7100010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7100013">nomatch</span>&nbsp;<span class="op" id="7100021">:=</span>&nbsp;<span class="keyword" id="7100024">func</span><span class="op" id="7100028">(</span><span class="ident" id="7100029">tag</span>&nbsp;<span class="builtintype" id="7100033">string</span><span class="op" id="7100039">,</span>&nbsp;<span class="ident" id="7100041">want</span>&nbsp;<span class="keyword" id="7100046">map</span><span class="op" id="7100049">[</span><span class="builtintype" id="7100050">string</span><span class="op" id="7100056">]</span><span class="builtintype" id="7100057">bool</span><span class="op" id="7100061">)</span>&nbsp;<span class="op" id="7100063">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7100067">m</span>&nbsp;<span class="op" id="7100069">:=</span>&nbsp;<span class="builtinfunc" id="7100072">make</span><span class="op" id="7100076">(</span><span class="keyword" id="7100077">map</span><span class="op" id="7100080">[</span><span class="builtintype" id="7100081">string</span><span class="op" id="7100087">]</span><span class="builtintype" id="7100088">bool</span><span class="op" id="7100092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7100096">if</span>&nbsp;<span class="ident" id="7100099">ctxt</span><span class="op" id="7100103">.</span><span class="ident" id="7100104">match</span><span class="op" id="7100109">(</span><span class="ident" id="7100110">tag</span><span class="op" id="7100113">,</span>&nbsp;<span class="ident" id="7100115">m</span><span class="op" id="7100116">)</span>&nbsp;<span class="op" id="7100118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7100123">t</span><span class="op" id="7100124">.</span><span class="ident" id="7100125">Errorf</span><span class="op" id="7100131">(</span><span class="string" id="7100132">&#34;%s&nbsp;context&nbsp;should&nbsp;NOT&nbsp;match&nbsp;%s,&nbsp;does&#34;</span><span class="op" id="7100170">,</span>&nbsp;<span class="ident" id="7100172">what</span><span class="op" id="7100176">,</span>&nbsp;<span class="ident" id="7100178">tag</span><span class="op" id="7100181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7100185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7100189">if</span>&nbsp;<span class="op" id="7100192">!</span><span class="ident" id="7100193">reflect</span><span class="op" id="7100200">.</span><span class="ident" id="7100201">DeepEqual</span><span class="op" id="7100210">(</span><span class="ident" id="7100211">m</span><span class="op" id="7100212">,</span>&nbsp;<span class="ident" id="7100214">want</span><span class="op" id="7100218">)</span>&nbsp;<span class="op" id="7100220">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7100225">t</span><span class="op" id="7100226">.</span><span class="ident" id="7100227">Errorf</span><span class="op" id="7100233">(</span><span class="string" id="7100234">&#34;%s&nbsp;tags&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7100257">,</span>&nbsp;<span class="ident" id="7100259">tag</span><span class="op" id="7100262">,</span>&nbsp;<span class="ident" id="7100264">m</span><span class="op" id="7100265">,</span>&nbsp;<span class="ident" id="7100267">want</span><span class="op" id="7100271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7100275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7100278">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7100282">match</span><span class="op" id="7100287">(</span><span class="ident" id="7100288">runtime</span><span class="op" id="7100295">.</span><span class="ident" id="7100296">GOOS</span><span class="op" id="7100300">+</span><span class="string" id="7100301">&#34;,&#34;</span><span class="op" id="7100304">+</span><span class="ident" id="7100305">runtime</span><span class="op" id="7100312">.</span><span class="ident" id="7100313">GOARCH</span><span class="op" id="7100319">,</span>&nbsp;<span class="keyword" id="7100321">map</span><span class="op" id="7100324">[</span><span class="builtintype" id="7100325">string</span><span class="op" id="7100331">]</span><span class="builtintype" id="7100332">bool</span><span class="op" id="7100336">{</span><span class="ident" id="7100337">runtime</span><span class="op" id="7100344">.</span><span class="ident" id="7100345">GOOS</span><span class="op" id="7100349">:</span>&nbsp;<span class="builtintype" id="7100351">true</span><span class="op" id="7100355">,</span>&nbsp;<span class="ident" id="7100357">runtime</span><span class="op" id="7100364">.</span><span class="ident" id="7100365">GOARCH</span><span class="op" id="7100371">:</span>&nbsp;<span class="builtintype" id="7100373">true</span><span class="op" id="7100377">}</span><span class="op" id="7100378">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7100381">match</span><span class="op" id="7100386">(</span><span class="ident" id="7100387">runtime</span><span class="op" id="7100394">.</span><span class="ident" id="7100395">GOOS</span><span class="op" id="7100399">+</span><span class="string" id="7100400">&#34;,&#34;</span><span class="op" id="7100403">+</span><span class="ident" id="7100404">runtime</span><span class="op" id="7100411">.</span><span class="ident" id="7100412">GOARCH</span><span class="op" id="7100418">+</span><span class="string" id="7100419">&#34;,!foo&#34;</span><span class="op" id="7100426">,</span>&nbsp;<span class="keyword" id="7100428">map</span><span class="op" id="7100431">[</span><span class="builtintype" id="7100432">string</span><span class="op" id="7100438">]</span><span class="builtintype" id="7100439">bool</span><span class="op" id="7100443">{</span><span class="ident" id="7100444">runtime</span><span class="op" id="7100451">.</span><span class="ident" id="7100452">GOOS</span><span class="op" id="7100456">:</span>&nbsp;<span class="builtintype" id="7100458">true</span><span class="op" id="7100462">,</span>&nbsp;<span class="ident" id="7100464">runtime</span><span class="op" id="7100471">.</span><span class="ident" id="7100472">GOARCH</span><span class="op" id="7100478">:</span>&nbsp;<span class="builtintype" id="7100480">true</span><span class="op" id="7100484">,</span>&nbsp;<span class="string" id="7100486">&#34;foo&#34;</span><span class="op" id="7100491">:</span>&nbsp;<span class="builtintype" id="7100493">true</span><span class="op" id="7100497">}</span><span class="op" id="7100498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7100501">nomatch</span><span class="op" id="7100508">(</span><span class="ident" id="7100509">runtime</span><span class="op" id="7100516">.</span><span class="ident" id="7100517">GOOS</span><span class="op" id="7100521">+</span><span class="string" id="7100522">&#34;,&#34;</span><span class="op" id="7100525">+</span><span class="ident" id="7100526">runtime</span><span class="op" id="7100533">.</span><span class="ident" id="7100534">GOARCH</span><span class="op" id="7100540">+</span><span class="string" id="7100541">&#34;,foo&#34;</span><span class="op" id="7100547">,</span>&nbsp;<span class="keyword" id="7100549">map</span><span class="op" id="7100552">[</span><span class="builtintype" id="7100553">string</span><span class="op" id="7100559">]</span><span class="builtintype" id="7100560">bool</span><span class="op" id="7100564">{</span><span class="ident" id="7100565">runtime</span><span class="op" id="7100572">.</span><span class="ident" id="7100573">GOOS</span><span class="op" id="7100577">:</span>&nbsp;<span class="builtintype" id="7100579">true</span><span class="op" id="7100583">,</span>&nbsp;<span class="ident" id="7100585">runtime</span><span class="op" id="7100592">.</span><span class="ident" id="7100593">GOARCH</span><span class="op" id="7100599">:</span>&nbsp;<span class="builtintype" id="7100601">true</span><span class="op" id="7100605">,</span>&nbsp;<span class="string" id="7100607">&#34;foo&#34;</span><span class="op" id="7100612">:</span>&nbsp;<span class="builtintype" id="7100614">true</span><span class="op" id="7100618">}</span><span class="op" id="7100619">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7100623">what</span>&nbsp;<span class="op" id="7100628">=</span>&nbsp;<span class="string" id="7100630">&#34;modified&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7100642">ctxt</span><span class="op" id="7100646">.</span><span class="ident" id="7100647">BuildTags</span>&nbsp;<span class="op" id="7100657">=</span>&nbsp;<span class="op" id="7100659">[</span><span class="op" id="7100660">]</span><span class="builtintype" id="7100661">string</span><span class="op" id="7100667">{</span><span class="string" id="7100668">&#34;foo&#34;</span><span class="op" id="7100673">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7100676">match</span><span class="op" id="7100681">(</span><span class="ident" id="7100682">runtime</span><span class="op" id="7100689">.</span><span class="ident" id="7100690">GOOS</span><span class="op" id="7100694">+</span><span class="string" id="7100695">&#34;,&#34;</span><span class="op" id="7100698">+</span><span class="ident" id="7100699">runtime</span><span class="op" id="7100706">.</span><span class="ident" id="7100707">GOARCH</span><span class="op" id="7100713">,</span>&nbsp;<span class="keyword" id="7100715">map</span><span class="op" id="7100718">[</span><span class="builtintype" id="7100719">string</span><span class="op" id="7100725">]</span><span class="builtintype" id="7100726">bool</span><span class="op" id="7100730">{</span><span class="ident" id="7100731">runtime</span><span class="op" id="7100738">.</span><span class="ident" id="7100739">GOOS</span><span class="op" id="7100743">:</span>&nbsp;<span class="builtintype" id="7100745">true</span><span class="op" id="7100749">,</span>&nbsp;<span class="ident" id="7100751">runtime</span><span class="op" id="7100758">.</span><span class="ident" id="7100759">GOARCH</span><span class="op" id="7100765">:</span>&nbsp;<span class="builtintype" id="7100767">true</span><span class="op" id="7100771">}</span><span class="op" id="7100772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7100775">match</span><span class="op" id="7100780">(</span><span class="ident" id="7100781">runtime</span><span class="op" id="7100788">.</span><span class="ident" id="7100789">GOOS</span><span class="op" id="7100793">+</span><span class="string" id="7100794">&#34;,&#34;</span><span class="op" id="7100797">+</span><span class="ident" id="7100798">runtime</span><span class="op" id="7100805">.</span><span class="ident" id="7100806">GOARCH</span><span class="op" id="7100812">+</span><span class="string" id="7100813">&#34;,foo&#34;</span><span class="op" id="7100819">,</span>&nbsp;<span class="keyword" id="7100821">map</span><span class="op" id="7100824">[</span><span class="builtintype" id="7100825">string</span><span class="op" id="7100831">]</span><span class="builtintype" id="7100832">bool</span><span class="op" id="7100836">{</span><span class="ident" id="7100837">runtime</span><span class="op" id="7100844">.</span><span class="ident" id="7100845">GOOS</span><span class="op" id="7100849">:</span>&nbsp;<span class="builtintype" id="7100851">true</span><span class="op" id="7100855">,</span>&nbsp;<span class="ident" id="7100857">runtime</span><span class="op" id="7100864">.</span><span class="ident" id="7100865">GOARCH</span><span class="op" id="7100871">:</span>&nbsp;<span class="builtintype" id="7100873">true</span><span class="op" id="7100877">,</span>&nbsp;<span class="string" id="7100879">&#34;foo&#34;</span><span class="op" id="7100884">:</span>&nbsp;<span class="builtintype" id="7100886">true</span><span class="op" id="7100890">}</span><span class="op" id="7100891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7100894">nomatch</span><span class="op" id="7100901">(</span><span class="ident" id="7100902">runtime</span><span class="op" id="7100909">.</span><span class="ident" id="7100910">GOOS</span><span class="op" id="7100914">+</span><span class="string" id="7100915">&#34;,&#34;</span><span class="op" id="7100918">+</span><span class="ident" id="7100919">runtime</span><span class="op" id="7100926">.</span><span class="ident" id="7100927">GOARCH</span><span class="op" id="7100933">+</span><span class="string" id="7100934">&#34;,!foo&#34;</span><span class="op" id="7100941">,</span>&nbsp;<span class="keyword" id="7100943">map</span><span class="op" id="7100946">[</span><span class="builtintype" id="7100947">string</span><span class="op" id="7100953">]</span><span class="builtintype" id="7100954">bool</span><span class="op" id="7100958">{</span><span class="ident" id="7100959">runtime</span><span class="op" id="7100966">.</span><span class="ident" id="7100967">GOOS</span><span class="op" id="7100971">:</span>&nbsp;<span class="builtintype" id="7100973">true</span><span class="op" id="7100977">,</span>&nbsp;<span class="ident" id="7100979">runtime</span><span class="op" id="7100986">.</span><span class="ident" id="7100987">GOARCH</span><span class="op" id="7100993">:</span>&nbsp;<span class="builtintype" id="7100995">true</span><span class="op" id="7100999">,</span>&nbsp;<span class="string" id="7101001">&#34;foo&#34;</span><span class="op" id="7101006">:</span>&nbsp;<span class="builtintype" id="7101008">true</span><span class="op" id="7101012">}</span><span class="op" id="7101013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7101016">match</span><span class="op" id="7101021">(</span><span class="ident" id="7101022">runtime</span><span class="op" id="7101029">.</span><span class="ident" id="7101030">GOOS</span><span class="op" id="7101034">+</span><span class="string" id="7101035">&#34;,&#34;</span><span class="op" id="7101038">+</span><span class="ident" id="7101039">runtime</span><span class="op" id="7101046">.</span><span class="ident" id="7101047">GOARCH</span><span class="op" id="7101053">+</span><span class="string" id="7101054">&#34;,!bar&#34;</span><span class="op" id="7101061">,</span>&nbsp;<span class="keyword" id="7101063">map</span><span class="op" id="7101066">[</span><span class="builtintype" id="7101067">string</span><span class="op" id="7101073">]</span><span class="builtintype" id="7101074">bool</span><span class="op" id="7101078">{</span><span class="ident" id="7101079">runtime</span><span class="op" id="7101086">.</span><span class="ident" id="7101087">GOOS</span><span class="op" id="7101091">:</span>&nbsp;<span class="builtintype" id="7101093">true</span><span class="op" id="7101097">,</span>&nbsp;<span class="ident" id="7101099">runtime</span><span class="op" id="7101106">.</span><span class="ident" id="7101107">GOARCH</span><span class="op" id="7101113">:</span>&nbsp;<span class="builtintype" id="7101115">true</span><span class="op" id="7101119">,</span>&nbsp;<span class="string" id="7101121">&#34;bar&#34;</span><span class="op" id="7101126">:</span>&nbsp;<span class="builtintype" id="7101128">true</span><span class="op" id="7101132">}</span><span class="op" id="7101133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7101136">nomatch</span><span class="op" id="7101143">(</span><span class="ident" id="7101144">runtime</span><span class="op" id="7101151">.</span><span class="ident" id="7101152">GOOS</span><span class="op" id="7101156">+</span><span class="string" id="7101157">&#34;,&#34;</span><span class="op" id="7101160">+</span><span class="ident" id="7101161">runtime</span><span class="op" id="7101168">.</span><span class="ident" id="7101169">GOARCH</span><span class="op" id="7101175">+</span><span class="string" id="7101176">&#34;,bar&#34;</span><span class="op" id="7101182">,</span>&nbsp;<span class="keyword" id="7101184">map</span><span class="op" id="7101187">[</span><span class="builtintype" id="7101188">string</span><span class="op" id="7101194">]</span><span class="builtintype" id="7101195">bool</span><span class="op" id="7101199">{</span><span class="ident" id="7101200">runtime</span><span class="op" id="7101207">.</span><span class="ident" id="7101208">GOOS</span><span class="op" id="7101212">:</span>&nbsp;<span class="builtintype" id="7101214">true</span><span class="op" id="7101218">,</span>&nbsp;<span class="ident" id="7101220">runtime</span><span class="op" id="7101227">.</span><span class="ident" id="7101228">GOARCH</span><span class="op" id="7101234">:</span>&nbsp;<span class="builtintype" id="7101236">true</span><span class="op" id="7101240">,</span>&nbsp;<span class="string" id="7101242">&#34;bar&#34;</span><span class="op" id="7101247">:</span>&nbsp;<span class="builtintype" id="7101249">true</span><span class="op" id="7101253">}</span><span class="op" id="7101254">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7101257">nomatch</span><span class="op" id="7101264">(</span><span class="string" id="7101265">&#34;!&#34;</span><span class="op" id="7101268">,</span>&nbsp;<span class="keyword" id="7101270">map</span><span class="op" id="7101273">[</span><span class="builtintype" id="7101274">string</span><span class="op" id="7101280">]</span><span class="builtintype" id="7101281">bool</span><span class="op" id="7101285">{</span><span class="op" id="7101286">}</span><span class="op" id="7101287">)</span><br>
<span class="lineno"></span><span class="op" id="7101289">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7101292">func</span>&nbsp;<span class="ident" id="7101297">TestDotSlashImport</span><span class="op" id="7101315">(</span><span class="ident" id="7101316">t</span>&nbsp;<span class="op" id="7101318">*</span><span class="ident" id="7101319">testing</span><span class="op" id="7101326">.</span><span class="ident" id="7101327">T</span><span class="op" id="7101328">)</span>&nbsp;<span class="op" id="7101330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7101333">p</span><span class="op" id="7101334">,</span>&nbsp;<span class="ident" id="7101336">err</span>&nbsp;<span class="op" id="7101340">:=</span>&nbsp;<span class="ident" id="7101343">ImportDir</span><span class="op" id="7101352">(</span><span class="string" id="7101353">&#34;testdata/other&#34;</span><span class="op" id="7101369">,</span>&nbsp;<span class="num" id="7101371">0</span><span class="op" id="7101372">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7101375">if</span>&nbsp;<span class="ident" id="7101378">err</span>&nbsp;<span class="op" id="7101382">!=</span>&nbsp;<span class="ident" id="7101385">nil</span>&nbsp;<span class="op" id="7101389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7101393">t</span><span class="op" id="7101394">.</span><span class="ident" id="7101395">Fatal</span><span class="op" id="7101400">(</span><span class="ident" id="7101401">err</span><span class="op" id="7101404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7101407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7101410">if</span>&nbsp;<span class="builtinfunc" id="7101413">len</span><span class="op" id="7101416">(</span><span class="ident" id="7101417">p</span><span class="op" id="7101418">.</span><span class="ident" id="7101419">Imports</span><span class="op" id="7101426">)</span>&nbsp;<span class="op" id="7101428">!=</span>&nbsp;<span class="num" id="7101431">1</span>&nbsp;<span class="op" id="7101433">||</span>&nbsp;<span class="ident" id="7101436">p</span><span class="op" id="7101437">.</span><span class="ident" id="7101438">Imports</span><span class="op" id="7101445">[</span><span class="num" id="7101446">0</span><span class="op" id="7101447">]</span>&nbsp;<span class="op" id="7101449">!=</span>&nbsp;<span class="string" id="7101452">&#34;./file&#34;</span>&nbsp;<span class="op" id="7101461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7101465">t</span><span class="op" id="7101466">.</span><span class="ident" id="7101467">Fatalf</span><span class="op" id="7101473">(</span><span class="string" id="7101474">&#34;testdata/other:&nbsp;Imports=%v,&nbsp;want&nbsp;[./file]&#34;</span><span class="op" id="7101517">,</span>&nbsp;<span class="ident" id="7101519">p</span><span class="op" id="7101520">.</span><span class="ident" id="7101521">Imports</span><span class="op" id="7101528">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7101531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7101535">p1</span><span class="op" id="7101537">,</span>&nbsp;<span class="ident" id="7101539">err</span>&nbsp;<span class="op" id="7101543">:=</span>&nbsp;<span class="ident" id="7101546">Import</span><span class="op" id="7101552">(</span><span class="string" id="7101553">&#34;./file&#34;</span><span class="op" id="7101561">,</span>&nbsp;<span class="string" id="7101563">&#34;testdata/other&#34;</span><span class="op" id="7101579">,</span>&nbsp;<span class="num" id="7101581">0</span><span class="op" id="7101582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7101585">if</span>&nbsp;<span class="ident" id="7101588">err</span>&nbsp;<span class="op" id="7101592">!=</span>&nbsp;<span class="ident" id="7101595">nil</span>&nbsp;<span class="op" id="7101599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7101603">t</span><span class="op" id="7101604">.</span><span class="ident" id="7101605">Fatal</span><span class="op" id="7101610">(</span><span class="ident" id="7101611">err</span><span class="op" id="7101614">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7101617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7101620">if</span>&nbsp;<span class="ident" id="7101623">p1</span><span class="op" id="7101625">.</span><span class="ident" id="7101626">Name</span>&nbsp;<span class="op" id="7101631">!=</span>&nbsp;<span class="string" id="7101634">&#34;file&#34;</span>&nbsp;<span class="op" id="7101641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7101645">t</span><span class="op" id="7101646">.</span><span class="ident" id="7101647">Fatalf</span><span class="op" id="7101653">(</span><span class="string" id="7101654">&#34;./file:&nbsp;Name=%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7101680">,</span>&nbsp;<span class="ident" id="7101682">p1</span><span class="op" id="7101684">.</span><span class="ident" id="7101685">Name</span><span class="op" id="7101689">,</span>&nbsp;<span class="string" id="7101691">&#34;file&#34;</span><span class="op" id="7101697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7101700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7101703">dir</span>&nbsp;<span class="op" id="7101707">:=</span>&nbsp;<span class="ident" id="7101710">filepath</span><span class="op" id="7101718">.</span><span class="ident" id="7101719">Clean</span><span class="op" id="7101724">(</span><span class="string" id="7101725">&#34;testdata/other/file&#34;</span><span class="op" id="7101746">)</span>&nbsp;<span class="comment" id="7101748">//&nbsp;Clean&nbsp;to&nbsp;use&nbsp;\&nbsp;on&nbsp;Windows</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7101778">if</span>&nbsp;<span class="ident" id="7101781">p1</span><span class="op" id="7101783">.</span><span class="ident" id="7101784">Dir</span>&nbsp;<span class="op" id="7101788">!=</span>&nbsp;<span class="ident" id="7101791">dir</span>&nbsp;<span class="op" id="7101795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7101799">t</span><span class="op" id="7101800">.</span><span class="ident" id="7101801">Fatalf</span><span class="op" id="7101807">(</span><span class="string" id="7101808">&#34;./file:&nbsp;Dir=%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7101833">,</span>&nbsp;<span class="ident" id="7101835">p1</span><span class="op" id="7101837">.</span><span class="ident" id="7101838">Name</span><span class="op" id="7101842">,</span>&nbsp;<span class="ident" id="7101844">dir</span><span class="op" id="7101847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7101850">}</span><br>
<span class="lineno"></span><span class="op" id="7101852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="7101855">func</span>&nbsp;<span class="ident" id="7101860">TestEmptyImport</span><span class="op" id="7101875">(</span><span class="ident" id="7101876">t</span>&nbsp;<span class="op" id="7101878">*</span><span class="ident" id="7101879">testing</span><span class="op" id="7101886">.</span><span class="ident" id="7101887">T</span><span class="op" id="7101888">)</span>&nbsp;<span class="op" id="7101890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7101893">p</span><span class="op" id="7101894">,</span>&nbsp;<span class="ident" id="7101896">err</span>&nbsp;<span class="op" id="7101900">:=</span>&nbsp;<span class="ident" id="7101903">Import</span><span class="op" id="7101909">(</span><span class="string" id="7101910">&#34;&#34;</span><span class="op" id="7101912">,</span>&nbsp;<span class="ident" id="7101914">Default</span><span class="op" id="7101921">.</span><span class="ident" id="7101922">GOROOT</span><span class="op" id="7101928">,</span>&nbsp;<span class="ident" id="7101930">FindOnly</span><span class="op" id="7101938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7101941">if</span>&nbsp;<span class="ident" id="7101944">err</span>&nbsp;<span class="op" id="7101948">==</span>&nbsp;<span class="ident" id="7101951">nil</span>&nbsp;<span class="op" id="7101955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7101959">t</span><span class="op" id="7101960">.</span><span class="ident" id="7101961">Fatal</span><span class="op" id="7101966">(</span><span class="string" id="7101967">`Import(&#34;&#34;)&nbsp;returned&nbsp;nil&nbsp;error.`</span><span class="op" id="7101999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7102002">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7102005">if</span>&nbsp;<span class="ident" id="7102008">p</span>&nbsp;<span class="op" id="7102010">==</span>&nbsp;<span class="ident" id="7102013">nil</span>&nbsp;<span class="op" id="7102017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7102021">t</span><span class="op" id="7102022">.</span><span class="ident" id="7102023">Fatal</span><span class="op" id="7102028">(</span><span class="string" id="7102029">`Import(&#34;&#34;)&nbsp;returned&nbsp;nil&nbsp;package.`</span><span class="op" id="7102063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7102066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7102069">if</span>&nbsp;<span class="ident" id="7102072">p</span><span class="op" id="7102073">.</span><span class="ident" id="7102074">ImportPath</span>&nbsp;<span class="op" id="7102085">!=</span>&nbsp;<span class="string" id="7102088">&#34;&#34;</span>&nbsp;<span class="op" id="7102091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7102095">t</span><span class="op" id="7102096">.</span><span class="ident" id="7102097">Fatalf</span><span class="op" id="7102103">(</span><span class="string" id="7102104">&#34;ImportPath=%q,&nbsp;want&nbsp;%q.&#34;</span><span class="op" id="7102129">,</span>&nbsp;<span class="ident" id="7102131">p</span><span class="op" id="7102132">.</span><span class="ident" id="7102133">ImportPath</span><span class="op" id="7102143">,</span>&nbsp;<span class="string" id="7102145">&#34;&#34;</span><span class="op" id="7102147">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7102150">}</span><br>
<span class="lineno"></span><span class="op" id="7102152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7102155">func</span>&nbsp;<span class="ident" id="7102160">TestEmptyFolderImport</span><span class="op" id="7102181">(</span><span class="ident" id="7102182">t</span>&nbsp;<span class="op" id="7102184">*</span><span class="ident" id="7102185">testing</span><span class="op" id="7102192">.</span><span class="ident" id="7102193">T</span><span class="op" id="7102194">)</span>&nbsp;<span class="op" id="7102196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7102199">_</span><span class="op" id="7102200">,</span>&nbsp;<span class="ident" id="7102202">err</span>&nbsp;<span class="op" id="7102206">:=</span>&nbsp;<span class="ident" id="7102209">Import</span><span class="op" id="7102215">(</span><span class="string" id="7102216">&#34;.&#34;</span><span class="op" id="7102219">,</span>&nbsp;<span class="string" id="7102221">&#34;testdata/empty&#34;</span><span class="op" id="7102237">,</span>&nbsp;<span class="num" id="7102239">0</span><span class="op" id="7102240">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7102243">if</span>&nbsp;<span class="ident" id="7102246">_</span><span class="op" id="7102247">,</span>&nbsp;<span class="ident" id="7102249">ok</span>&nbsp;<span class="op" id="7102252">:=</span>&nbsp;<span class="ident" id="7102255">err</span><span class="op" id="7102258">.</span><span class="op" id="7102259">(</span><span class="op" id="7102260">*</span><span class="ident" id="7102261">NoGoError</span><span class="op" id="7102270">)</span><span class="op" id="7102271">;</span>&nbsp;<span class="op" id="7102273">!</span><span class="ident" id="7102274">ok</span>&nbsp;<span class="op" id="7102277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7102281">t</span><span class="op" id="7102282">.</span><span class="ident" id="7102283">Fatal</span><span class="op" id="7102288">(</span><span class="string" id="7102289">`Import(&#34;testdata/empty&#34;)&nbsp;did&nbsp;not&nbsp;return&nbsp;NoGoError.`</span><span class="op" id="7102341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7102344">}</span><br>
<span class="lineno"></span><span class="op" id="7102346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="7102349">func</span>&nbsp;<span class="ident" id="7102354">TestMultiplePackageImport</span><span class="op" id="7102379">(</span><span class="ident" id="7102380">t</span>&nbsp;<span class="op" id="7102382">*</span><span class="ident" id="7102383">testing</span><span class="op" id="7102390">.</span><span class="ident" id="7102391">T</span><span class="op" id="7102392">)</span>&nbsp;<span class="op" id="7102394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7102397">_</span><span class="op" id="7102398">,</span>&nbsp;<span class="ident" id="7102400">err</span>&nbsp;<span class="op" id="7102404">:=</span>&nbsp;<span class="ident" id="7102407">Import</span><span class="op" id="7102413">(</span><span class="string" id="7102414">&#34;.&#34;</span><span class="op" id="7102417">,</span>&nbsp;<span class="string" id="7102419">&#34;testdata/multi&#34;</span><span class="op" id="7102435">,</span>&nbsp;<span class="num" id="7102437">0</span><span class="op" id="7102438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7102441">if</span>&nbsp;<span class="ident" id="7102444">_</span><span class="op" id="7102445">,</span>&nbsp;<span class="ident" id="7102447">ok</span>&nbsp;<span class="op" id="7102450">:=</span>&nbsp;<span class="ident" id="7102453">err</span><span class="op" id="7102456">.</span><span class="op" id="7102457">(</span><span class="op" id="7102458">*</span><span class="ident" id="7102459">MultiplePackageError</span><span class="op" id="7102479">)</span><span class="op" id="7102480">;</span>&nbsp;<span class="op" id="7102482">!</span><span class="ident" id="7102483">ok</span>&nbsp;<span class="op" id="7102486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7102490">t</span><span class="op" id="7102491">.</span><span class="ident" id="7102492">Fatal</span><span class="op" id="7102497">(</span><span class="string" id="7102498">`Import(&#34;testdata/multi&#34;)&nbsp;did&nbsp;not&nbsp;return&nbsp;MultiplePackageError.`</span><span class="op" id="7102561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7102564">}</span><br>
<span class="lineno">100</span><span class="op" id="7102566">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7102569">func</span>&nbsp;<span class="ident" id="7102574">TestLocalDirectory</span><span class="op" id="7102592">(</span><span class="ident" id="7102593">t</span>&nbsp;<span class="op" id="7102595">*</span><span class="ident" id="7102596">testing</span><span class="op" id="7102603">.</span><span class="ident" id="7102604">T</span><span class="op" id="7102605">)</span>&nbsp;<span class="op" id="7102607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7102610">cwd</span><span class="op" id="7102613">,</span>&nbsp;<span class="ident" id="7102615">err</span>&nbsp;<span class="op" id="7102619">:=</span>&nbsp;<span class="ident" id="7102622">os</span><span class="op" id="7102624">.</span><span class="ident" id="7102625">Getwd</span><span class="op" id="7102630">(</span><span class="op" id="7102631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7102634">if</span>&nbsp;<span class="ident" id="7102637">err</span>&nbsp;<span class="op" id="7102641">!=</span>&nbsp;<span class="ident" id="7102644">nil</span>&nbsp;<span class="op" id="7102648">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7102652">t</span><span class="op" id="7102653">.</span><span class="ident" id="7102654">Fatal</span><span class="op" id="7102659">(</span><span class="ident" id="7102660">err</span><span class="op" id="7102663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7102666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7102670">p</span><span class="op" id="7102671">,</span>&nbsp;<span class="ident" id="7102673">err</span>&nbsp;<span class="op" id="7102677">:=</span>&nbsp;<span class="ident" id="7102680">ImportDir</span><span class="op" id="7102689">(</span><span class="ident" id="7102690">cwd</span><span class="op" id="7102693">,</span>&nbsp;<span class="num" id="7102695">0</span><span class="op" id="7102696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7102699">if</span>&nbsp;<span class="ident" id="7102702">err</span>&nbsp;<span class="op" id="7102706">!=</span>&nbsp;<span class="ident" id="7102709">nil</span>&nbsp;<span class="op" id="7102713">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7102717">t</span><span class="op" id="7102718">.</span><span class="ident" id="7102719">Fatal</span><span class="op" id="7102724">(</span><span class="ident" id="7102725">err</span><span class="op" id="7102728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7102731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7102734">if</span>&nbsp;<span class="ident" id="7102737">p</span><span class="op" id="7102738">.</span><span class="ident" id="7102739">ImportPath</span>&nbsp;<span class="op" id="7102750">!=</span>&nbsp;<span class="string" id="7102753">&#34;go/build&#34;</span>&nbsp;<span class="op" id="7102764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7102768">t</span><span class="op" id="7102769">.</span><span class="ident" id="7102770">Fatalf</span><span class="op" id="7102776">(</span><span class="string" id="7102777">&#34;ImportPath=%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7102801">,</span>&nbsp;<span class="ident" id="7102803">p</span><span class="op" id="7102804">.</span><span class="ident" id="7102805">ImportPath</span><span class="op" id="7102815">,</span>&nbsp;<span class="string" id="7102817">&#34;go/build&#34;</span><span class="op" id="7102827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7102830">}</span><br>
<span class="lineno">115</span><span class="op" id="7102832">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7102835">func</span>&nbsp;<span class="ident" id="7102840">TestShouldBuild</span><span class="op" id="7102855">(</span><span class="ident" id="7102856">t</span>&nbsp;<span class="op" id="7102858">*</span><span class="ident" id="7102859">testing</span><span class="op" id="7102866">.</span><span class="ident" id="7102867">T</span><span class="op" id="7102868">)</span>&nbsp;<span class="op" id="7102870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7102873">const</span>&nbsp;<span class="ident" id="7102879">file1</span>&nbsp;<span class="op" id="7102885">=</span>&nbsp;<span class="string" id="7102887">&#34;//&nbsp;+build&nbsp;tag1\n\n&#34;</span>&nbsp;<span class="op" id="7102908">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7102912">&#34;package&nbsp;main\n&#34;</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7102930">want1</span>&nbsp;<span class="op" id="7102936">:=</span>&nbsp;<span class="keyword" id="7102939">map</span><span class="op" id="7102942">[</span><span class="builtintype" id="7102943">string</span><span class="op" id="7102949">]</span><span class="builtintype" id="7102950">bool</span><span class="op" id="7102954">{</span><span class="string" id="7102955">&#34;tag1&#34;</span><span class="op" id="7102961">:</span>&nbsp;<span class="builtintype" id="7102963">true</span><span class="op" id="7102967">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7102971">const</span>&nbsp;<span class="ident" id="7102977">file2</span>&nbsp;<span class="op" id="7102983">=</span>&nbsp;<span class="string" id="7102985">&#34;//&nbsp;+build&nbsp;cgo\n\n&#34;</span>&nbsp;<span class="op" id="7103005">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7103009">&#34;//&nbsp;This&nbsp;package&nbsp;implements&nbsp;parsing&nbsp;of&nbsp;tags&nbsp;like\n&#34;</span>&nbsp;<span class="op" id="7103061">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7103065">&#34;//&nbsp;+build&nbsp;tag1\n&#34;</span>&nbsp;<span class="op" id="7103084">+</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7103088">&#34;package&nbsp;build&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7103105">want2</span>&nbsp;<span class="op" id="7103111">:=</span>&nbsp;<span class="keyword" id="7103114">map</span><span class="op" id="7103117">[</span><span class="builtintype" id="7103118">string</span><span class="op" id="7103124">]</span><span class="builtintype" id="7103125">bool</span><span class="op" id="7103129">{</span><span class="string" id="7103130">&#34;cgo&#34;</span><span class="op" id="7103135">:</span>&nbsp;<span class="builtintype" id="7103137">true</span><span class="op" id="7103141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7103145">const</span>&nbsp;<span class="ident" id="7103151">file3</span>&nbsp;<span class="op" id="7103157">=</span>&nbsp;<span class="string" id="7103159">&#34;//&nbsp;Copyright&nbsp;The&nbsp;Go&nbsp;Authors.\n\n&#34;</span>&nbsp;<span class="op" id="7103194">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7103198">&#34;package&nbsp;build\n\n&#34;</span>&nbsp;<span class="op" id="7103218">+</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7103222">&#34;//&nbsp;shouldBuild&nbsp;checks&nbsp;tags&nbsp;given&nbsp;by&nbsp;lines&nbsp;of&nbsp;the&nbsp;form\n&#34;</span>&nbsp;<span class="op" id="7103280">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7103284">&#34;//&nbsp;+build&nbsp;tag\n&#34;</span>&nbsp;<span class="op" id="7103302">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7103306">&#34;func&nbsp;shouldBuild(content&nbsp;[]byte)\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7103344">want3</span>&nbsp;<span class="op" id="7103350">:=</span>&nbsp;<span class="keyword" id="7103353">map</span><span class="op" id="7103356">[</span><span class="builtintype" id="7103357">string</span><span class="op" id="7103363">]</span><span class="builtintype" id="7103364">bool</span><span class="op" id="7103368">{</span><span class="op" id="7103369">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7103373">ctx</span>&nbsp;<span class="op" id="7103377">:=</span>&nbsp;<span class="op" id="7103380">&amp;</span><span class="ident" id="7103381">Context</span><span class="op" id="7103388">{</span><span class="ident" id="7103389">BuildTags</span><span class="op" id="7103398">:</span>&nbsp;<span class="op" id="7103400">[</span><span class="op" id="7103401">]</span><span class="builtintype" id="7103402">string</span><span class="op" id="7103408">{</span><span class="string" id="7103409">&#34;tag1&#34;</span><span class="op" id="7103415">}</span><span class="op" id="7103416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7103419">m</span>&nbsp;<span class="op" id="7103421">:=</span>&nbsp;<span class="keyword" id="7103424">map</span><span class="op" id="7103427">[</span><span class="builtintype" id="7103428">string</span><span class="op" id="7103434">]</span><span class="builtintype" id="7103435">bool</span><span class="op" id="7103439">{</span><span class="op" id="7103440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7103443">if</span>&nbsp;<span class="op" id="7103446">!</span><span class="ident" id="7103447">ctx</span><span class="op" id="7103450">.</span><span class="ident" id="7103451">shouldBuild</span><span class="op" id="7103462">(</span><span class="op" id="7103463">[</span><span class="op" id="7103464">]</span><span class="builtintype" id="7103465">byte</span><span class="op" id="7103469">(</span><span class="ident" id="7103470">file1</span><span class="op" id="7103475">)</span><span class="op" id="7103476">,</span>&nbsp;<span class="ident" id="7103478">m</span><span class="op" id="7103479">)</span>&nbsp;<span class="op" id="7103481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7103485">t</span><span class="op" id="7103486">.</span><span class="ident" id="7103487">Errorf</span><span class="op" id="7103493">(</span><span class="string" id="7103494">&#34;shouldBuild(file1)&nbsp;=&nbsp;false,&nbsp;want&nbsp;true&#34;</span><span class="op" id="7103533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7103536">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7103539">if</span>&nbsp;<span class="op" id="7103542">!</span><span class="ident" id="7103543">reflect</span><span class="op" id="7103550">.</span><span class="ident" id="7103551">DeepEqual</span><span class="op" id="7103560">(</span><span class="ident" id="7103561">m</span><span class="op" id="7103562">,</span>&nbsp;<span class="ident" id="7103564">want1</span><span class="op" id="7103569">)</span>&nbsp;<span class="op" id="7103571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7103575">t</span><span class="op" id="7103576">.</span><span class="ident" id="7103577">Errorf</span><span class="op" id="7103583">(</span><span class="string" id="7103584">&#34;shoudBuild(file1)&nbsp;tags&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7103622">,</span>&nbsp;<span class="ident" id="7103624">m</span><span class="op" id="7103625">,</span>&nbsp;<span class="ident" id="7103627">want1</span><span class="op" id="7103632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7103635">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7103639">m</span>&nbsp;<span class="op" id="7103641">=</span>&nbsp;<span class="keyword" id="7103643">map</span><span class="op" id="7103646">[</span><span class="builtintype" id="7103647">string</span><span class="op" id="7103653">]</span><span class="builtintype" id="7103654">bool</span><span class="op" id="7103658">{</span><span class="op" id="7103659">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7103662">if</span>&nbsp;<span class="ident" id="7103665">ctx</span><span class="op" id="7103668">.</span><span class="ident" id="7103669">shouldBuild</span><span class="op" id="7103680">(</span><span class="op" id="7103681">[</span><span class="op" id="7103682">]</span><span class="builtintype" id="7103683">byte</span><span class="op" id="7103687">(</span><span class="ident" id="7103688">file2</span><span class="op" id="7103693">)</span><span class="op" id="7103694">,</span>&nbsp;<span class="ident" id="7103696">m</span><span class="op" id="7103697">)</span>&nbsp;<span class="op" id="7103699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7103703">t</span><span class="op" id="7103704">.</span><span class="ident" id="7103705">Errorf</span><span class="op" id="7103711">(</span><span class="string" id="7103712">&#34;shouldBuild(file2)&nbsp;=&nbsp;true,&nbsp;want&nbsp;fakse&#34;</span><span class="op" id="7103751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7103754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7103757">if</span>&nbsp;<span class="op" id="7103760">!</span><span class="ident" id="7103761">reflect</span><span class="op" id="7103768">.</span><span class="ident" id="7103769">DeepEqual</span><span class="op" id="7103778">(</span><span class="ident" id="7103779">m</span><span class="op" id="7103780">,</span>&nbsp;<span class="ident" id="7103782">want2</span><span class="op" id="7103787">)</span>&nbsp;<span class="op" id="7103789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7103793">t</span><span class="op" id="7103794">.</span><span class="ident" id="7103795">Errorf</span><span class="op" id="7103801">(</span><span class="string" id="7103802">&#34;shoudBuild(file2)&nbsp;tags&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7103840">,</span>&nbsp;<span class="ident" id="7103842">m</span><span class="op" id="7103843">,</span>&nbsp;<span class="ident" id="7103845">want2</span><span class="op" id="7103850">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7103853">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7103857">m</span>&nbsp;<span class="op" id="7103859">=</span>&nbsp;<span class="keyword" id="7103861">map</span><span class="op" id="7103864">[</span><span class="builtintype" id="7103865">string</span><span class="op" id="7103871">]</span><span class="builtintype" id="7103872">bool</span><span class="op" id="7103876">{</span><span class="op" id="7103877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7103880">ctx</span>&nbsp;<span class="op" id="7103884">=</span>&nbsp;<span class="op" id="7103886">&amp;</span><span class="ident" id="7103887">Context</span><span class="op" id="7103894">{</span><span class="ident" id="7103895">BuildTags</span><span class="op" id="7103904">:</span>&nbsp;<span class="ident" id="7103906">nil</span><span class="op" id="7103909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7103912">if</span>&nbsp;<span class="op" id="7103915">!</span><span class="ident" id="7103916">ctx</span><span class="op" id="7103919">.</span><span class="ident" id="7103920">shouldBuild</span><span class="op" id="7103931">(</span><span class="op" id="7103932">[</span><span class="op" id="7103933">]</span><span class="builtintype" id="7103934">byte</span><span class="op" id="7103938">(</span><span class="ident" id="7103939">file3</span><span class="op" id="7103944">)</span><span class="op" id="7103945">,</span>&nbsp;<span class="ident" id="7103947">m</span><span class="op" id="7103948">)</span>&nbsp;<span class="op" id="7103950">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7103954">t</span><span class="op" id="7103955">.</span><span class="ident" id="7103956">Errorf</span><span class="op" id="7103962">(</span><span class="string" id="7103963">&#34;shouldBuild(file3)&nbsp;=&nbsp;false,&nbsp;want&nbsp;true&#34;</span><span class="op" id="7104002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7104005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7104008">if</span>&nbsp;<span class="op" id="7104011">!</span><span class="ident" id="7104012">reflect</span><span class="op" id="7104019">.</span><span class="ident" id="7104020">DeepEqual</span><span class="op" id="7104029">(</span><span class="ident" id="7104030">m</span><span class="op" id="7104031">,</span>&nbsp;<span class="ident" id="7104033">want3</span><span class="op" id="7104038">)</span>&nbsp;<span class="op" id="7104040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7104044">t</span><span class="op" id="7104045">.</span><span class="ident" id="7104046">Errorf</span><span class="op" id="7104052">(</span><span class="string" id="7104053">&#34;shoudBuild(file3)&nbsp;tags&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7104091">,</span>&nbsp;<span class="ident" id="7104093">m</span><span class="op" id="7104094">,</span>&nbsp;<span class="ident" id="7104096">want3</span><span class="op" id="7104101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7104104">}</span><br>
<span class="lineno">160</span><span class="op" id="7104106">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7104109">type</span>&nbsp;<span class="ident" id="7104114">readNopCloser</span>&nbsp;<span class="keyword" id="7104128">struct</span>&nbsp;<span class="op" id="7104135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7104138">io</span><span class="op" id="7104140">.</span><span class="ident" id="7104141">Reader</span><br>
<span class="lineno"></span><span class="op" id="7104148">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="7104151">func</span>&nbsp;<span class="op" id="7104156">(</span><span class="ident" id="7104157">r</span>&nbsp;<span class="ident" id="7104159">readNopCloser</span><span class="op" id="7104172">)</span>&nbsp;<span class="ident" id="7104174">Close</span><span class="op" id="7104179">(</span><span class="op" id="7104180">)</span>&nbsp;<span class="builtintype" id="7104182">error</span>&nbsp;<span class="op" id="7104188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7104191">return</span>&nbsp;<span class="ident" id="7104198">nil</span><br>
<span class="lineno"></span><span class="op" id="7104202">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="7104205">var</span>&nbsp;<span class="op" id="7104209">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7104212">ctxtP9</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7104224">=</span>&nbsp;<span class="ident" id="7104226">Context</span><span class="op" id="7104233">{</span><span class="ident" id="7104234">GOARCH</span><span class="op" id="7104240">:</span>&nbsp;<span class="string" id="7104242">&#34;arm&#34;</span><span class="op" id="7104247">,</span>&nbsp;<span class="ident" id="7104249">GOOS</span><span class="op" id="7104253">:</span>&nbsp;<span class="string" id="7104255">&#34;plan9&#34;</span><span class="op" id="7104262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7104265">ctxtAndroid</span>&nbsp;<span class="op" id="7104277">=</span>&nbsp;<span class="ident" id="7104279">Context</span><span class="op" id="7104286">{</span><span class="ident" id="7104287">GOARCH</span><span class="op" id="7104293">:</span>&nbsp;<span class="string" id="7104295">&#34;arm&#34;</span><span class="op" id="7104300">,</span>&nbsp;<span class="ident" id="7104302">GOOS</span><span class="op" id="7104306">:</span>&nbsp;<span class="string" id="7104308">&#34;android&#34;</span><span class="op" id="7104317">}</span><br>
<span class="lineno"></span><span class="op" id="7104319">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="keyword" id="7104322">var</span>&nbsp;<span class="ident" id="7104326">matchFileTests</span>&nbsp;<span class="op" id="7104341">=</span>&nbsp;<span class="op" id="7104343">[</span><span class="op" id="7104344">]</span><span class="keyword" id="7104345">struct</span>&nbsp;<span class="op" id="7104352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7104355">ctxt</span>&nbsp;&nbsp;<span class="ident" id="7104361">Context</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7104370">name</span>&nbsp;&nbsp;<span class="builtintype" id="7104376">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7104384">data</span>&nbsp;&nbsp;<span class="builtintype" id="7104390">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7104398">match</span>&nbsp;<span class="builtintype" id="7104404">bool</span><br>
<span class="lineno">180</span><span class="op" id="7104409">}</span><span class="op" id="7104410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7104413">{</span><span class="ident" id="7104414">ctxtP9</span><span class="op" id="7104420">,</span>&nbsp;<span class="string" id="7104422">&#34;foo_arm.go&#34;</span><span class="op" id="7104434">,</span>&nbsp;<span class="string" id="7104436">&#34;&#34;</span><span class="op" id="7104438">,</span>&nbsp;<span class="builtintype" id="7104440">true</span><span class="op" id="7104444">}</span><span class="op" id="7104445">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7104448">{</span><span class="ident" id="7104449">ctxtP9</span><span class="op" id="7104455">,</span>&nbsp;<span class="string" id="7104457">&#34;foo1_arm.go&#34;</span><span class="op" id="7104470">,</span>&nbsp;<span class="string" id="7104472">&#34;//&nbsp;+build&nbsp;linux\n\npackage&nbsp;main\n&#34;</span><span class="op" id="7104507">,</span>&nbsp;<span class="builtintype" id="7104509">false</span><span class="op" id="7104514">}</span><span class="op" id="7104515">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7104518">{</span><span class="ident" id="7104519">ctxtP9</span><span class="op" id="7104525">,</span>&nbsp;<span class="string" id="7104527">&#34;foo_darwin.go&#34;</span><span class="op" id="7104542">,</span>&nbsp;<span class="string" id="7104544">&#34;&#34;</span><span class="op" id="7104546">,</span>&nbsp;<span class="builtintype" id="7104548">false</span><span class="op" id="7104553">}</span><span class="op" id="7104554">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7104557">{</span><span class="ident" id="7104558">ctxtP9</span><span class="op" id="7104564">,</span>&nbsp;<span class="string" id="7104566">&#34;foo.go&#34;</span><span class="op" id="7104574">,</span>&nbsp;<span class="string" id="7104576">&#34;&#34;</span><span class="op" id="7104578">,</span>&nbsp;<span class="builtintype" id="7104580">true</span><span class="op" id="7104584">}</span><span class="op" id="7104585">,</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7104588">{</span><span class="ident" id="7104589">ctxtP9</span><span class="op" id="7104595">,</span>&nbsp;<span class="string" id="7104597">&#34;foo1.go&#34;</span><span class="op" id="7104606">,</span>&nbsp;<span class="string" id="7104608">&#34;//&nbsp;+build&nbsp;linux\n\npackage&nbsp;main\n&#34;</span><span class="op" id="7104643">,</span>&nbsp;<span class="builtintype" id="7104645">false</span><span class="op" id="7104650">}</span><span class="op" id="7104651">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7104654">{</span><span class="ident" id="7104655">ctxtP9</span><span class="op" id="7104661">,</span>&nbsp;<span class="string" id="7104663">&#34;foo.badsuffix&#34;</span><span class="op" id="7104678">,</span>&nbsp;<span class="string" id="7104680">&#34;&#34;</span><span class="op" id="7104682">,</span>&nbsp;<span class="builtintype" id="7104684">false</span><span class="op" id="7104689">}</span><span class="op" id="7104690">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7104693">{</span><span class="ident" id="7104694">ctxtAndroid</span><span class="op" id="7104705">,</span>&nbsp;<span class="string" id="7104707">&#34;foo_linux.go&#34;</span><span class="op" id="7104721">,</span>&nbsp;<span class="string" id="7104723">&#34;&#34;</span><span class="op" id="7104725">,</span>&nbsp;<span class="builtintype" id="7104727">true</span><span class="op" id="7104731">}</span><span class="op" id="7104732">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7104735">{</span><span class="ident" id="7104736">ctxtAndroid</span><span class="op" id="7104747">,</span>&nbsp;<span class="string" id="7104749">&#34;foo_android.go&#34;</span><span class="op" id="7104765">,</span>&nbsp;<span class="string" id="7104767">&#34;&#34;</span><span class="op" id="7104769">,</span>&nbsp;<span class="builtintype" id="7104771">true</span><span class="op" id="7104775">}</span><span class="op" id="7104776">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7104779">{</span><span class="ident" id="7104780">ctxtAndroid</span><span class="op" id="7104791">,</span>&nbsp;<span class="string" id="7104793">&#34;foo_plan9.go&#34;</span><span class="op" id="7104807">,</span>&nbsp;<span class="string" id="7104809">&#34;&#34;</span><span class="op" id="7104811">,</span>&nbsp;<span class="builtintype" id="7104813">false</span><span class="op" id="7104818">}</span><span class="op" id="7104819">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7104822">{</span><span class="ident" id="7104823">ctxtAndroid</span><span class="op" id="7104834">,</span>&nbsp;<span class="string" id="7104836">&#34;android.go&#34;</span><span class="op" id="7104848">,</span>&nbsp;<span class="string" id="7104850">&#34;&#34;</span><span class="op" id="7104852">,</span>&nbsp;<span class="builtintype" id="7104854">true</span><span class="op" id="7104858">}</span><span class="op" id="7104859">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7104862">{</span><span class="ident" id="7104863">ctxtAndroid</span><span class="op" id="7104874">,</span>&nbsp;<span class="string" id="7104876">&#34;plan9.go&#34;</span><span class="op" id="7104886">,</span>&nbsp;<span class="string" id="7104888">&#34;&#34;</span><span class="op" id="7104890">,</span>&nbsp;<span class="builtintype" id="7104892">true</span><span class="op" id="7104896">}</span><span class="op" id="7104897">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7104900">{</span><span class="ident" id="7104901">ctxtAndroid</span><span class="op" id="7104912">,</span>&nbsp;<span class="string" id="7104914">&#34;plan9_test.go&#34;</span><span class="op" id="7104929">,</span>&nbsp;<span class="string" id="7104931">&#34;&#34;</span><span class="op" id="7104933">,</span>&nbsp;<span class="builtintype" id="7104935">true</span><span class="op" id="7104939">}</span><span class="op" id="7104940">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7104943">{</span><span class="ident" id="7104944">ctxtAndroid</span><span class="op" id="7104955">,</span>&nbsp;<span class="string" id="7104957">&#34;arm.s&#34;</span><span class="op" id="7104964">,</span>&nbsp;<span class="string" id="7104966">&#34;&#34;</span><span class="op" id="7104968">,</span>&nbsp;<span class="builtintype" id="7104970">true</span><span class="op" id="7104974">}</span><span class="op" id="7104975">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7104978">{</span><span class="ident" id="7104979">ctxtAndroid</span><span class="op" id="7104990">,</span>&nbsp;<span class="string" id="7104992">&#34;amd64.s&#34;</span><span class="op" id="7105001">,</span>&nbsp;<span class="string" id="7105003">&#34;&#34;</span><span class="op" id="7105005">,</span>&nbsp;<span class="builtintype" id="7105007">true</span><span class="op" id="7105011">}</span><span class="op" id="7105012">,</span><br>
<span class="lineno">195</span><span class="op" id="7105014">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7105017">func</span>&nbsp;<span class="ident" id="7105022">TestMatchFile</span><span class="op" id="7105035">(</span><span class="ident" id="7105036">t</span>&nbsp;<span class="op" id="7105038">*</span><span class="ident" id="7105039">testing</span><span class="op" id="7105046">.</span><span class="ident" id="7105047">T</span><span class="op" id="7105048">)</span>&nbsp;<span class="op" id="7105050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7105053">for</span>&nbsp;<span class="ident" id="7105057">_</span><span class="op" id="7105058">,</span>&nbsp;<span class="ident" id="7105060">tt</span>&nbsp;<span class="op" id="7105063">:=</span>&nbsp;<span class="keyword" id="7105066">range</span>&nbsp;<span class="ident" id="7105072">matchFileTests</span>&nbsp;<span class="op" id="7105087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7105091">ctxt</span>&nbsp;<span class="op" id="7105096">:=</span>&nbsp;<span class="ident" id="7105099">tt</span><span class="op" id="7105101">.</span><span class="ident" id="7105102">ctxt</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7105109">ctxt</span><span class="op" id="7105113">.</span><span class="ident" id="7105114">OpenFile</span>&nbsp;<span class="op" id="7105123">=</span>&nbsp;<span class="keyword" id="7105125">func</span><span class="op" id="7105129">(</span><span class="ident" id="7105130">path</span>&nbsp;<span class="builtintype" id="7105135">string</span><span class="op" id="7105141">)</span>&nbsp;<span class="op" id="7105143">(</span><span class="ident" id="7105144">r</span>&nbsp;<span class="ident" id="7105146">io</span><span class="op" id="7105148">.</span><span class="ident" id="7105149">ReadCloser</span><span class="op" id="7105159">,</span>&nbsp;<span class="ident" id="7105161">err</span>&nbsp;<span class="builtintype" id="7105165">error</span><span class="op" id="7105170">)</span>&nbsp;<span class="op" id="7105172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7105177">if</span>&nbsp;<span class="ident" id="7105180">path</span>&nbsp;<span class="op" id="7105185">!=</span>&nbsp;<span class="string" id="7105188">&#34;x+&#34;</span><span class="op" id="7105192">+</span><span class="ident" id="7105193">tt</span><span class="op" id="7105195">.</span><span class="ident" id="7105196">name</span>&nbsp;<span class="op" id="7105201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7105207">t</span><span class="op" id="7105208">.</span><span class="ident" id="7105209">Fatalf</span><span class="op" id="7105215">(</span><span class="string" id="7105216">&#34;OpenFile&nbsp;asked&nbsp;for&nbsp;%q,&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="7105252">,</span>&nbsp;<span class="ident" id="7105254">path</span><span class="op" id="7105258">,</span>&nbsp;<span class="string" id="7105260">&#34;x+&#34;</span><span class="op" id="7105264">+</span><span class="ident" id="7105265">tt</span><span class="op" id="7105267">.</span><span class="ident" id="7105268">name</span><span class="op" id="7105272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7105277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7105282">return</span>&nbsp;<span class="op" id="7105289">&amp;</span><span class="ident" id="7105290">readNopCloser</span><span class="op" id="7105303">{</span><span class="ident" id="7105304">strings</span><span class="op" id="7105311">.</span><span class="ident" id="7105312">NewReader</span><span class="op" id="7105321">(</span><span class="ident" id="7105322">tt</span><span class="op" id="7105324">.</span><span class="ident" id="7105325">data</span><span class="op" id="7105329">)</span><span class="op" id="7105330">}</span><span class="op" id="7105331">,</span>&nbsp;<span class="ident" id="7105333">nil</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7105339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7105343">ctxt</span><span class="op" id="7105347">.</span><span class="ident" id="7105348">JoinPath</span>&nbsp;<span class="op" id="7105357">=</span>&nbsp;<span class="keyword" id="7105359">func</span><span class="op" id="7105363">(</span><span class="ident" id="7105364">elem</span>&nbsp;<span class="op" id="7105369">...</span><span class="builtintype" id="7105372">string</span><span class="op" id="7105378">)</span>&nbsp;<span class="builtintype" id="7105380">string</span>&nbsp;<span class="op" id="7105387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7105392">return</span>&nbsp;<span class="ident" id="7105399">strings</span><span class="op" id="7105406">.</span><span class="ident" id="7105407">Join</span><span class="op" id="7105411">(</span><span class="ident" id="7105412">elem</span><span class="op" id="7105416">,</span>&nbsp;<span class="string" id="7105418">&#34;+&#34;</span><span class="op" id="7105421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7105425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7105429">match</span><span class="op" id="7105434">,</span>&nbsp;<span class="ident" id="7105436">err</span>&nbsp;<span class="op" id="7105440">:=</span>&nbsp;<span class="ident" id="7105443">ctxt</span><span class="op" id="7105447">.</span><span class="ident" id="7105448">MatchFile</span><span class="op" id="7105457">(</span><span class="string" id="7105458">&#34;x&#34;</span><span class="op" id="7105461">,</span>&nbsp;<span class="ident" id="7105463">tt</span><span class="op" id="7105465">.</span><span class="ident" id="7105466">name</span><span class="op" id="7105470">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7105474">if</span>&nbsp;<span class="ident" id="7105477">match</span>&nbsp;<span class="op" id="7105483">!=</span>&nbsp;<span class="ident" id="7105486">tt</span><span class="op" id="7105488">.</span><span class="ident" id="7105489">match</span>&nbsp;<span class="op" id="7105495">||</span>&nbsp;<span class="ident" id="7105498">err</span>&nbsp;<span class="op" id="7105502">!=</span>&nbsp;<span class="ident" id="7105505">nil</span>&nbsp;<span class="op" id="7105509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7105514">t</span><span class="op" id="7105515">.</span><span class="ident" id="7105516">Fatalf</span><span class="op" id="7105522">(</span><span class="string" id="7105523">&#34;MatchFile(%q)&nbsp;=&nbsp;%v,&nbsp;%v,&nbsp;want&nbsp;%v,&nbsp;nil&#34;</span><span class="op" id="7105561">,</span>&nbsp;<span class="ident" id="7105563">tt</span><span class="op" id="7105565">.</span><span class="ident" id="7105566">name</span><span class="op" id="7105570">,</span>&nbsp;<span class="ident" id="7105572">match</span><span class="op" id="7105577">,</span>&nbsp;<span class="ident" id="7105579">err</span><span class="op" id="7105582">,</span>&nbsp;<span class="ident" id="7105584">tt</span><span class="op" id="7105586">.</span><span class="ident" id="7105587">match</span><span class="op" id="7105592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7105596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7105599">}</span><br>
<span class="lineno"></span><span class="op" id="7105601">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="keyword" id="7105604">func</span>&nbsp;<span class="ident" id="7105609">TestImportCmd</span><span class="op" id="7105622">(</span><span class="ident" id="7105623">t</span>&nbsp;<span class="op" id="7105625">*</span><span class="ident" id="7105626">testing</span><span class="op" id="7105633">.</span><span class="ident" id="7105634">T</span><span class="op" id="7105635">)</span>&nbsp;<span class="op" id="7105637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7105640">p</span><span class="op" id="7105641">,</span>&nbsp;<span class="ident" id="7105643">err</span>&nbsp;<span class="op" id="7105647">:=</span>&nbsp;<span class="ident" id="7105650">Import</span><span class="op" id="7105656">(</span><span class="string" id="7105657">&#34;cmd/internal/objfile&#34;</span><span class="op" id="7105679">,</span>&nbsp;<span class="string" id="7105681">&#34;&#34;</span><span class="op" id="7105683">,</span>&nbsp;<span class="num" id="7105685">0</span><span class="op" id="7105686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7105689">if</span>&nbsp;<span class="ident" id="7105692">err</span>&nbsp;<span class="op" id="7105696">!=</span>&nbsp;<span class="ident" id="7105699">nil</span>&nbsp;<span class="op" id="7105703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7105707">t</span><span class="op" id="7105708">.</span><span class="ident" id="7105709">Fatal</span><span class="op" id="7105714">(</span><span class="ident" id="7105715">err</span><span class="op" id="7105718">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7105721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7105724">if</span>&nbsp;<span class="op" id="7105727">!</span><span class="ident" id="7105728">strings</span><span class="op" id="7105735">.</span><span class="ident" id="7105736">HasSuffix</span><span class="op" id="7105745">(</span><span class="ident" id="7105746">filepath</span><span class="op" id="7105754">.</span><span class="ident" id="7105755">ToSlash</span><span class="op" id="7105762">(</span><span class="ident" id="7105763">p</span><span class="op" id="7105764">.</span><span class="ident" id="7105765">Dir</span><span class="op" id="7105768">)</span><span class="op" id="7105769">,</span>&nbsp;<span class="string" id="7105771">&#34;src/cmd/internal/objfile&#34;</span><span class="op" id="7105797">)</span>&nbsp;<span class="op" id="7105799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7105803">t</span><span class="op" id="7105804">.</span><span class="ident" id="7105805">Fatalf</span><span class="op" id="7105811">(</span><span class="string" id="7105812">&#34;Import&nbsp;cmd/internal/objfile&nbsp;returned&nbsp;Dir=%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7105866">,</span>&nbsp;<span class="ident" id="7105868">filepath</span><span class="op" id="7105876">.</span><span class="ident" id="7105877">ToSlash</span><span class="op" id="7105884">(</span><span class="ident" id="7105885">p</span><span class="op" id="7105886">.</span><span class="ident" id="7105887">Dir</span><span class="op" id="7105890">)</span><span class="op" id="7105891">,</span>&nbsp;<span class="string" id="7105893">&#34;.../src/cmd/internal/objfile&#34;</span><span class="op" id="7105923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7105926">}</span><br>
<span class="lineno"></span><span class="op" id="7105928">}</span>
</div>
</body>
</html>
