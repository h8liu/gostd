<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/cipher</h2>
<ul>
<li><a href="/gostd/crypto/cipher/benchmark_test.go.html">benchmark_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cbc.go.html">cbc.go</a></li>
<li><a href="/gostd/crypto/cipher/cbc_aes_test.go.html">cbc_aes_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cfb.go.html">cfb.go</a></li>
<li><a href="/gostd/crypto/cipher/cfb_test.go.html" class="current">cfb_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cipher.go.html">cipher.go</a></li>
<li><a href="/gostd/crypto/cipher/cipher_test.go.html">cipher_test.go</a></li>
<li><a href="/gostd/crypto/cipher/common_test.go.html">common_test.go</a></li>
<li><a href="/gostd/crypto/cipher/ctr.go.html">ctr.go</a></li>
<li><a href="/gostd/crypto/cipher/ctr_aes_test.go.html">ctr_aes_test.go</a></li>
<li><a href="/gostd/crypto/cipher/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/cipher/gcm.go.html">gcm.go</a></li>
<li><a href="/gostd/crypto/cipher/gcm_test.go.html">gcm_test.go</a></li>
<li><a href="/gostd/crypto/cipher/io.go.html">io.go</a></li>
<li><a href="/gostd/crypto/cipher/ofb.go.html">ofb.go</a></li>
<li><a href="/gostd/crypto/cipher/ofb_test.go.html">ofb_test.go</a></li>
<li><a href="/gostd/crypto/cipher/xor.go.html">xor.go</a></li>
<li><a href="/gostd/crypto/cipher/xor_test.go.html">xor_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="125173">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="125228">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="125282">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="125333">package</span>&nbsp;<span class="ident" id="125341">cipher_test</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="125354">import</span>&nbsp;<span class="op" id="125361">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="125364">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="125373">&#34;crypto/aes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="125387">&#34;crypto/cipher&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="125404">&#34;crypto/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="125419">&#34;encoding/hex&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="125435">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="125445">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="125448">//&nbsp;cfbTests&nbsp;contains&nbsp;the&nbsp;test&nbsp;vectors&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="125491">//&nbsp;http://csrc.nist.gov/publications/nistpubs/800-38a/sp800-38a.pdf,&nbsp;section</span><br>
<span class="lineno"></span><span class="comment" id="125568">//&nbsp;F.3.13.</span><br>
<span class="lineno"></span><span class="keyword" id="125579">var</span>&nbsp;<span class="ident" id="125583">cfbTests</span>&nbsp;<span class="op" id="125592">=</span>&nbsp;<span class="op" id="125594">[</span><span class="op" id="125595">]</span><span class="keyword" id="125596">struct</span>&nbsp;<span class="op" id="125603">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="125606">key</span><span class="op" id="125609">,</span>&nbsp;<span class="ident" id="125611">iv</span><span class="op" id="125613">,</span>&nbsp;<span class="ident" id="125615">plaintext</span><span class="op" id="125624">,</span>&nbsp;<span class="ident" id="125626">ciphertext</span>&nbsp;<span class="builtintype" id="125637">string</span><br>
<span class="lineno"></span><span class="op" id="125644">}</span><span class="op" id="125645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="125648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="125652">&#34;2b7e151628aed2a6abf7158809cf4f3c&#34;</span><span class="op" id="125686">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="125690">&#34;000102030405060708090a0b0c0d0e0f&#34;</span><span class="op" id="125724">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="125728">&#34;6bc1bee22e409f96e93d7e117393172a&#34;</span><span class="op" id="125762">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="125766">&#34;3b3fd92eb72dad20333449f8e83cfb4a&#34;</span><span class="op" id="125800">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="125803">}</span><span class="op" id="125804">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="125807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="125811">&#34;2b7e151628aed2a6abf7158809cf4f3c&#34;</span><span class="op" id="125845">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="125849">&#34;3B3FD92EB72DAD20333449F8E83CFB4A&#34;</span><span class="op" id="125883">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="125887">&#34;ae2d8a571e03ac9c9eb76fac45af8e51&#34;</span><span class="op" id="125921">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="125925">&#34;c8a64537a0b3a93fcde3cdad9f1ce58b&#34;</span><span class="op" id="125959">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="125962">}</span><span class="op" id="125963">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="125966">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="125970">&#34;2b7e151628aed2a6abf7158809cf4f3c&#34;</span><span class="op" id="126004">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="126008">&#34;C8A64537A0B3A93FCDE3CDAD9F1CE58B&#34;</span><span class="op" id="126042">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="126046">&#34;30c81c46a35ce411e5fbc1191a0a52ef&#34;</span><span class="op" id="126080">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="126084">&#34;26751f67a3cbb140b1808cf187a4f4df&#34;</span><span class="op" id="126118">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="126121">}</span><span class="op" id="126122">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="126125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="126129">&#34;2b7e151628aed2a6abf7158809cf4f3c&#34;</span><span class="op" id="126163">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="126167">&#34;26751F67A3CBB140B1808CF187A4F4DF&#34;</span><span class="op" id="126201">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="126205">&#34;f69f2445df4f9b17ad2b417be66c3710&#34;</span><span class="op" id="126239">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="126243">&#34;c04b05357c5d1c0eeac4c66f9ff7f2e6&#34;</span><span class="op" id="126277">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="126280">}</span><span class="op" id="126281">,</span><br>
<span class="lineno"></span><span class="op" id="126283">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="126286">func</span>&nbsp;<span class="ident" id="126291">TestCFBVectors</span><span class="op" id="126305">(</span><span class="ident" id="126306">t</span>&nbsp;<span class="op" id="126308">*</span><span class="ident" id="126309">testing</span><span class="op" id="126316">.</span><span class="ident" id="126317">T</span><span class="op" id="126318">)</span>&nbsp;<span class="op" id="126320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="126323">for</span>&nbsp;<span class="ident" id="126327">i</span><span class="op" id="126328">,</span>&nbsp;<span class="ident" id="126330">test</span>&nbsp;<span class="op" id="126335">:=</span>&nbsp;<span class="keyword" id="126338">range</span>&nbsp;<span class="ident" id="126344">cfbTests</span>&nbsp;<span class="op" id="126353">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="126357">key</span><span class="op" id="126360">,</span>&nbsp;<span class="ident" id="126362">err</span>&nbsp;<span class="op" id="126366">:=</span>&nbsp;<span class="ident" id="126369">hex</span><span class="op" id="126372">.</span><span class="ident" id="126373">DecodeString</span><span class="op" id="126385">(</span><span class="ident" id="126386">test</span><span class="op" id="126390">.</span><span class="ident" id="126391">key</span><span class="op" id="126394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="126398">if</span>&nbsp;<span class="ident" id="126401">err</span>&nbsp;<span class="op" id="126405">!=</span>&nbsp;<span class="ident" id="126408">nil</span>&nbsp;<span class="op" id="126412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="126417">t</span><span class="op" id="126418">.</span><span class="ident" id="126419">Fatal</span><span class="op" id="126424">(</span><span class="ident" id="126425">err</span><span class="op" id="126428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="126432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="126436">iv</span><span class="op" id="126438">,</span>&nbsp;<span class="ident" id="126440">err</span>&nbsp;<span class="op" id="126444">:=</span>&nbsp;<span class="ident" id="126447">hex</span><span class="op" id="126450">.</span><span class="ident" id="126451">DecodeString</span><span class="op" id="126463">(</span><span class="ident" id="126464">test</span><span class="op" id="126468">.</span><span class="ident" id="126469">iv</span><span class="op" id="126471">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="126475">if</span>&nbsp;<span class="ident" id="126478">err</span>&nbsp;<span class="op" id="126482">!=</span>&nbsp;<span class="ident" id="126485">nil</span>&nbsp;<span class="op" id="126489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="126494">t</span><span class="op" id="126495">.</span><span class="ident" id="126496">Fatal</span><span class="op" id="126501">(</span><span class="ident" id="126502">err</span><span class="op" id="126505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="126509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="126513">plaintext</span><span class="op" id="126522">,</span>&nbsp;<span class="ident" id="126524">err</span>&nbsp;<span class="op" id="126528">:=</span>&nbsp;<span class="ident" id="126531">hex</span><span class="op" id="126534">.</span><span class="ident" id="126535">DecodeString</span><span class="op" id="126547">(</span><span class="ident" id="126548">test</span><span class="op" id="126552">.</span><span class="ident" id="126553">plaintext</span><span class="op" id="126562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="126566">if</span>&nbsp;<span class="ident" id="126569">err</span>&nbsp;<span class="op" id="126573">!=</span>&nbsp;<span class="ident" id="126576">nil</span>&nbsp;<span class="op" id="126580">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="126585">t</span><span class="op" id="126586">.</span><span class="ident" id="126587">Fatal</span><span class="op" id="126592">(</span><span class="ident" id="126593">err</span><span class="op" id="126596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="126600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="126604">expected</span><span class="op" id="126612">,</span>&nbsp;<span class="ident" id="126614">err</span>&nbsp;<span class="op" id="126618">:=</span>&nbsp;<span class="ident" id="126621">hex</span><span class="op" id="126624">.</span><span class="ident" id="126625">DecodeString</span><span class="op" id="126637">(</span><span class="ident" id="126638">test</span><span class="op" id="126642">.</span><span class="ident" id="126643">ciphertext</span><span class="op" id="126653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="126657">if</span>&nbsp;<span class="ident" id="126660">err</span>&nbsp;<span class="op" id="126664">!=</span>&nbsp;<span class="ident" id="126667">nil</span>&nbsp;<span class="op" id="126671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="126676">t</span><span class="op" id="126677">.</span><span class="ident" id="126678">Fatal</span><span class="op" id="126683">(</span><span class="ident" id="126684">err</span><span class="op" id="126687">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="126691">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="126696">block</span><span class="op" id="126701">,</span>&nbsp;<span class="ident" id="126703">err</span>&nbsp;<span class="op" id="126707">:=</span>&nbsp;<span class="ident" id="126710">aes</span><span class="op" id="126713">.</span><span class="ident" id="126714">NewCipher</span><span class="op" id="126723">(</span><span class="ident" id="126724">key</span><span class="op" id="126727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="126731">if</span>&nbsp;<span class="ident" id="126734">err</span>&nbsp;<span class="op" id="126738">!=</span>&nbsp;<span class="ident" id="126741">nil</span>&nbsp;<span class="op" id="126745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="126750">t</span><span class="op" id="126751">.</span><span class="ident" id="126752">Fatal</span><span class="op" id="126757">(</span><span class="ident" id="126758">err</span><span class="op" id="126761">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="126765">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="126770">ciphertext</span>&nbsp;<span class="op" id="126781">:=</span>&nbsp;<span class="builtinfunc" id="126784">make</span><span class="op" id="126788">(</span><span class="op" id="126789">[</span><span class="op" id="126790">]</span><span class="builtintype" id="126791">byte</span><span class="op" id="126795">,</span>&nbsp;<span class="builtinfunc" id="126797">len</span><span class="op" id="126800">(</span><span class="ident" id="126801">plaintext</span><span class="op" id="126810">)</span><span class="op" id="126811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="126815">cfb</span>&nbsp;<span class="op" id="126819">:=</span>&nbsp;<span class="ident" id="126822">cipher</span><span class="op" id="126828">.</span><span class="ident" id="126829">NewCFBEncrypter</span><span class="op" id="126844">(</span><span class="ident" id="126845">block</span><span class="op" id="126850">,</span>&nbsp;<span class="ident" id="126852">iv</span><span class="op" id="126854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="126858">cfb</span><span class="op" id="126861">.</span><span class="ident" id="126862">XORKeyStream</span><span class="op" id="126874">(</span><span class="ident" id="126875">ciphertext</span><span class="op" id="126885">,</span>&nbsp;<span class="ident" id="126887">plaintext</span><span class="op" id="126896">)</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="126901">if</span>&nbsp;<span class="op" id="126904">!</span><span class="ident" id="126905">bytes</span><span class="op" id="126910">.</span><span class="ident" id="126911">Equal</span><span class="op" id="126916">(</span><span class="ident" id="126917">ciphertext</span><span class="op" id="126927">,</span>&nbsp;<span class="ident" id="126929">expected</span><span class="op" id="126937">)</span>&nbsp;<span class="op" id="126939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="126944">t</span><span class="op" id="126945">.</span><span class="ident" id="126946">Errorf</span><span class="op" id="126952">(</span><span class="string" id="126953">&#34;#%d:&nbsp;wrong&nbsp;output:&nbsp;got&nbsp;%x,&nbsp;expected&nbsp;%x&#34;</span><span class="op" id="126993">,</span>&nbsp;<span class="ident" id="126995">i</span><span class="op" id="126996">,</span>&nbsp;<span class="ident" id="126998">ciphertext</span><span class="op" id="127008">,</span>&nbsp;<span class="ident" id="127010">expected</span><span class="op" id="127018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="127022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="127027">cfbdec</span>&nbsp;<span class="op" id="127034">:=</span>&nbsp;<span class="ident" id="127037">cipher</span><span class="op" id="127043">.</span><span class="ident" id="127044">NewCFBDecrypter</span><span class="op" id="127059">(</span><span class="ident" id="127060">block</span><span class="op" id="127065">,</span>&nbsp;<span class="ident" id="127067">iv</span><span class="op" id="127069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="127073">plaintextCopy</span>&nbsp;<span class="op" id="127087">:=</span>&nbsp;<span class="builtinfunc" id="127090">make</span><span class="op" id="127094">(</span><span class="op" id="127095">[</span><span class="op" id="127096">]</span><span class="builtintype" id="127097">byte</span><span class="op" id="127101">,</span>&nbsp;<span class="builtinfunc" id="127103">len</span><span class="op" id="127106">(</span><span class="ident" id="127107">ciphertext</span><span class="op" id="127117">)</span><span class="op" id="127118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="127122">cfbdec</span><span class="op" id="127128">.</span><span class="ident" id="127129">XORKeyStream</span><span class="op" id="127141">(</span><span class="ident" id="127142">plaintextCopy</span><span class="op" id="127155">,</span>&nbsp;<span class="ident" id="127157">ciphertext</span><span class="op" id="127167">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="127172">if</span>&nbsp;<span class="op" id="127175">!</span><span class="ident" id="127176">bytes</span><span class="op" id="127181">.</span><span class="ident" id="127182">Equal</span><span class="op" id="127187">(</span><span class="ident" id="127188">plaintextCopy</span><span class="op" id="127201">,</span>&nbsp;<span class="ident" id="127203">plaintextCopy</span><span class="op" id="127216">)</span>&nbsp;<span class="op" id="127218">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="127223">t</span><span class="op" id="127224">.</span><span class="ident" id="127225">Errorf</span><span class="op" id="127231">(</span><span class="string" id="127232">&#34;#%d:&nbsp;wrong&nbsp;plaintext:&nbsp;got&nbsp;%x,&nbsp;expected&nbsp;%x&#34;</span><span class="op" id="127275">,</span>&nbsp;<span class="ident" id="127277">i</span><span class="op" id="127278">,</span>&nbsp;<span class="ident" id="127280">plaintextCopy</span><span class="op" id="127293">,</span>&nbsp;<span class="ident" id="127295">plaintext</span><span class="op" id="127304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="127308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="127311">}</span><br>
<span class="lineno"></span><span class="op" id="127313">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="127316">func</span>&nbsp;<span class="ident" id="127321">TestCFBInverse</span><span class="op" id="127335">(</span><span class="ident" id="127336">t</span>&nbsp;<span class="op" id="127338">*</span><span class="ident" id="127339">testing</span><span class="op" id="127346">.</span><span class="ident" id="127347">T</span><span class="op" id="127348">)</span>&nbsp;<span class="op" id="127350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="127353">block</span><span class="op" id="127358">,</span>&nbsp;<span class="ident" id="127360">err</span>&nbsp;<span class="op" id="127364">:=</span>&nbsp;<span class="ident" id="127367">aes</span><span class="op" id="127370">.</span><span class="ident" id="127371">NewCipher</span><span class="op" id="127380">(</span><span class="ident" id="127381">commonKey128</span><span class="op" id="127393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="127396">if</span>&nbsp;<span class="ident" id="127399">err</span>&nbsp;<span class="op" id="127403">!=</span>&nbsp;<span class="ident" id="127406">nil</span>&nbsp;<span class="op" id="127410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="127414">t</span><span class="op" id="127415">.</span><span class="ident" id="127416">Error</span><span class="op" id="127421">(</span><span class="ident" id="127422">err</span><span class="op" id="127425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="127429">return</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="127437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="127441">plaintext</span>&nbsp;<span class="op" id="127451">:=</span>&nbsp;<span class="op" id="127454">[</span><span class="op" id="127455">]</span><span class="builtintype" id="127456">byte</span><span class="op" id="127460">(</span><span class="string" id="127461">&#34;this&nbsp;is&nbsp;the&nbsp;plaintext.&nbsp;this&nbsp;is&nbsp;the&nbsp;plaintext.&#34;</span><span class="op" id="127508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="127511">iv</span>&nbsp;<span class="op" id="127514">:=</span>&nbsp;<span class="builtinfunc" id="127517">make</span><span class="op" id="127521">(</span><span class="op" id="127522">[</span><span class="op" id="127523">]</span><span class="builtintype" id="127524">byte</span><span class="op" id="127528">,</span>&nbsp;<span class="ident" id="127530">block</span><span class="op" id="127535">.</span><span class="ident" id="127536">BlockSize</span><span class="op" id="127545">(</span><span class="op" id="127546">)</span><span class="op" id="127547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="127550">rand</span><span class="op" id="127554">.</span><span class="ident" id="127555">Reader</span><span class="op" id="127561">.</span><span class="ident" id="127562">Read</span><span class="op" id="127566">(</span><span class="ident" id="127567">iv</span><span class="op" id="127569">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="127572">cfb</span>&nbsp;<span class="op" id="127576">:=</span>&nbsp;<span class="ident" id="127579">cipher</span><span class="op" id="127585">.</span><span class="ident" id="127586">NewCFBEncrypter</span><span class="op" id="127601">(</span><span class="ident" id="127602">block</span><span class="op" id="127607">,</span>&nbsp;<span class="ident" id="127609">iv</span><span class="op" id="127611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="127614">ciphertext</span>&nbsp;<span class="op" id="127625">:=</span>&nbsp;<span class="builtinfunc" id="127628">make</span><span class="op" id="127632">(</span><span class="op" id="127633">[</span><span class="op" id="127634">]</span><span class="builtintype" id="127635">byte</span><span class="op" id="127639">,</span>&nbsp;<span class="builtinfunc" id="127641">len</span><span class="op" id="127644">(</span><span class="ident" id="127645">plaintext</span><span class="op" id="127654">)</span><span class="op" id="127655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="127658">copy</span><span class="op" id="127662">(</span><span class="ident" id="127663">ciphertext</span><span class="op" id="127673">,</span>&nbsp;<span class="ident" id="127675">plaintext</span><span class="op" id="127684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="127687">cfb</span><span class="op" id="127690">.</span><span class="ident" id="127691">XORKeyStream</span><span class="op" id="127703">(</span><span class="ident" id="127704">ciphertext</span><span class="op" id="127714">,</span>&nbsp;<span class="ident" id="127716">ciphertext</span><span class="op" id="127726">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="127730">cfbdec</span>&nbsp;<span class="op" id="127737">:=</span>&nbsp;<span class="ident" id="127740">cipher</span><span class="op" id="127746">.</span><span class="ident" id="127747">NewCFBDecrypter</span><span class="op" id="127762">(</span><span class="ident" id="127763">block</span><span class="op" id="127768">,</span>&nbsp;<span class="ident" id="127770">iv</span><span class="op" id="127772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="127775">plaintextCopy</span>&nbsp;<span class="op" id="127789">:=</span>&nbsp;<span class="builtinfunc" id="127792">make</span><span class="op" id="127796">(</span><span class="op" id="127797">[</span><span class="op" id="127798">]</span><span class="builtintype" id="127799">byte</span><span class="op" id="127803">,</span>&nbsp;<span class="builtinfunc" id="127805">len</span><span class="op" id="127808">(</span><span class="ident" id="127809">plaintext</span><span class="op" id="127818">)</span><span class="op" id="127819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="127822">copy</span><span class="op" id="127826">(</span><span class="ident" id="127827">plaintextCopy</span><span class="op" id="127840">,</span>&nbsp;<span class="ident" id="127842">ciphertext</span><span class="op" id="127852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="127855">cfbdec</span><span class="op" id="127861">.</span><span class="ident" id="127862">XORKeyStream</span><span class="op" id="127874">(</span><span class="ident" id="127875">plaintextCopy</span><span class="op" id="127888">,</span>&nbsp;<span class="ident" id="127890">plaintextCopy</span><span class="op" id="127903">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="127907">if</span>&nbsp;<span class="op" id="127910">!</span><span class="ident" id="127911">bytes</span><span class="op" id="127916">.</span><span class="ident" id="127917">Equal</span><span class="op" id="127922">(</span><span class="ident" id="127923">plaintextCopy</span><span class="op" id="127936">,</span>&nbsp;<span class="ident" id="127938">plaintext</span><span class="op" id="127947">)</span>&nbsp;<span class="op" id="127949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="127953">t</span><span class="op" id="127954">.</span><span class="ident" id="127955">Errorf</span><span class="op" id="127961">(</span><span class="string" id="127962">&#34;got:&nbsp;%x,&nbsp;want:&nbsp;%x&#34;</span><span class="op" id="127981">,</span>&nbsp;<span class="ident" id="127983">plaintextCopy</span><span class="op" id="127996">,</span>&nbsp;<span class="ident" id="127998">plaintext</span><span class="op" id="128007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="128010">}</span><br>
<span class="lineno"></span><span class="op" id="128012">}</span>
</div>
</body>
</html>
