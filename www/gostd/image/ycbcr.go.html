<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image</h2>
<ul>
<li><a href="/gostd/image/decode_example_test.go.html">decode_example_test.go</a></li>
<li><a href="/gostd/image/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/image/format.go.html">format.go</a></li>
<li><a href="/gostd/image/geom.go.html">geom.go</a></li>
<li><a href="/gostd/image/image.go.html">image.go</a></li>
<li><a href="/gostd/image/image_test.go.html">image_test.go</a></li>
<li><a href="/gostd/image/names.go.html">names.go</a></li>
<li><a href="/gostd/image/ycbcr.go.html" class="current">ycbcr.go</a></li>
<li><a href="/gostd/image/ycbcr_test.go.html">ycbcr_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1815186">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1815241">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1815295">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1815346">package</span>&nbsp;<span class="ident" id="1815354">image</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1815361">import</span>&nbsp;<span class="op" id="1815368">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1815371">&#34;image/color&#34;</span><br>
<span class="lineno"></span><span class="op" id="1815385">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="1815388">//&nbsp;YCbCrSubsampleRatio&nbsp;is&nbsp;the&nbsp;chroma&nbsp;subsample&nbsp;ratio&nbsp;used&nbsp;in&nbsp;a&nbsp;YCbCr&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="1815464">type</span>&nbsp;<span class="ident" id="1815469">YCbCrSubsampleRatio</span>&nbsp;<span class="builtintype" id="1815489">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1815494">const</span>&nbsp;<span class="op" id="1815500">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1815503">YCbCrSubsampleRatio444</span>&nbsp;<span class="ident" id="1815526">YCbCrSubsampleRatio</span>&nbsp;<span class="op" id="1815546">=</span>&nbsp;<span class="ident" id="1815548">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1815554">YCbCrSubsampleRatio422</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1815578">YCbCrSubsampleRatio420</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1815602">YCbCrSubsampleRatio440</span><br>
<span class="lineno"></span><span class="op" id="1815625">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="1815628">func</span>&nbsp;<span class="op" id="1815633">(</span><span class="ident" id="1815634">s</span>&nbsp;<span class="ident" id="1815636">YCbCrSubsampleRatio</span><span class="op" id="1815655">)</span>&nbsp;<span class="ident" id="1815657">String</span><span class="op" id="1815663">(</span><span class="op" id="1815664">)</span>&nbsp;<span class="builtintype" id="1815666">string</span>&nbsp;<span class="op" id="1815673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1815676">switch</span>&nbsp;<span class="ident" id="1815683">s</span>&nbsp;<span class="op" id="1815685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1815688">case</span>&nbsp;<span class="ident" id="1815693">YCbCrSubsampleRatio444</span><span class="op" id="1815715">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1815719">return</span>&nbsp;<span class="string" id="1815726">&#34;YCbCrSubsampleRatio444&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1815752">case</span>&nbsp;<span class="ident" id="1815757">YCbCrSubsampleRatio422</span><span class="op" id="1815779">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1815783">return</span>&nbsp;<span class="string" id="1815790">&#34;YCbCrSubsampleRatio422&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1815816">case</span>&nbsp;<span class="ident" id="1815821">YCbCrSubsampleRatio420</span><span class="op" id="1815843">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1815847">return</span>&nbsp;<span class="string" id="1815854">&#34;YCbCrSubsampleRatio420&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1815880">case</span>&nbsp;<span class="ident" id="1815885">YCbCrSubsampleRatio440</span><span class="op" id="1815907">:</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1815911">return</span>&nbsp;<span class="string" id="1815918">&#34;YCbCrSubsampleRatio440&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1815944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1815947">return</span>&nbsp;<span class="string" id="1815954">&#34;YCbCrSubsampleRatioUnknown&#34;</span><br>
<span class="lineno"></span><span class="op" id="1815983">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="1815986">//&nbsp;YCbCr&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;of&nbsp;Y&#39;CbCr&nbsp;colors.&nbsp;There&nbsp;is&nbsp;one&nbsp;Y&nbsp;sample&nbsp;per</span><br>
<span class="lineno"></span><span class="comment" id="1816061">//&nbsp;pixel,&nbsp;but&nbsp;each&nbsp;Cb&nbsp;and&nbsp;Cr&nbsp;sample&nbsp;can&nbsp;span&nbsp;one&nbsp;or&nbsp;more&nbsp;pixels.</span><br>
<span class="lineno"></span><span class="comment" id="1816126">//&nbsp;YStride&nbsp;is&nbsp;the&nbsp;Y&nbsp;slice&nbsp;index&nbsp;delta&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span><span class="comment" id="1816200">//&nbsp;CStride&nbsp;is&nbsp;the&nbsp;Cb&nbsp;and&nbsp;Cr&nbsp;slice&nbsp;index&nbsp;delta&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels</span><br>
<span class="lineno"></span><span class="comment" id="1816281">//&nbsp;that&nbsp;map&nbsp;to&nbsp;separate&nbsp;chroma&nbsp;samples.</span><br>
<span class="lineno">40</span><span class="comment" id="1816321">//&nbsp;It&nbsp;is&nbsp;not&nbsp;an&nbsp;absolute&nbsp;requirement,&nbsp;but&nbsp;YStride&nbsp;and&nbsp;len(Y)&nbsp;are&nbsp;typically</span><br>
<span class="lineno"></span><span class="comment" id="1816396">//&nbsp;multiples&nbsp;of&nbsp;8,&nbsp;and:</span><br>
<span class="lineno"></span><span class="comment" id="1816420">//&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;4:4:4,&nbsp;CStride&nbsp;==&nbsp;YStride/1&nbsp;&amp;&amp;&nbsp;len(Cb)&nbsp;==&nbsp;len(Cr)&nbsp;==&nbsp;len(Y)/1.</span><br>
<span class="lineno"></span><span class="comment" id="1816490">//&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;4:2:2,&nbsp;CStride&nbsp;==&nbsp;YStride/2&nbsp;&amp;&amp;&nbsp;len(Cb)&nbsp;==&nbsp;len(Cr)&nbsp;==&nbsp;len(Y)/2.</span><br>
<span class="lineno"></span><span class="comment" id="1816560">//&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;4:2:0,&nbsp;CStride&nbsp;==&nbsp;YStride/2&nbsp;&amp;&amp;&nbsp;len(Cb)&nbsp;==&nbsp;len(Cr)&nbsp;==&nbsp;len(Y)/4.</span><br>
<span class="lineno">45</span><span class="comment" id="1816630">//&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;4:4:0,&nbsp;CStride&nbsp;==&nbsp;YStride/1&nbsp;&amp;&amp;&nbsp;len(Cb)&nbsp;==&nbsp;len(Cr)&nbsp;==&nbsp;len(Y)/2.</span><br>
<span class="lineno"></span><span class="keyword" id="1816700">type</span>&nbsp;<span class="ident" id="1816705">YCbCr</span>&nbsp;<span class="keyword" id="1816711">struct</span>&nbsp;<span class="op" id="1816718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1816721">Y</span><span class="op" id="1816722">,</span>&nbsp;<span class="ident" id="1816724">Cb</span><span class="op" id="1816726">,</span>&nbsp;<span class="ident" id="1816728">Cr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1816736">[</span><span class="op" id="1816737">]</span><span class="builtintype" id="1816738">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1816745">YStride</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1816760">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1816765">CStride</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1816780">int</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1816785">SubsampleRatio</span>&nbsp;<span class="ident" id="1816800">YCbCrSubsampleRatio</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1816821">Rect</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1816836">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="1816846">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1816849">func</span>&nbsp;<span class="op" id="1816854">(</span><span class="ident" id="1816855">p</span>&nbsp;<span class="op" id="1816857">*</span><span class="ident" id="1816858">YCbCr</span><span class="op" id="1816863">)</span>&nbsp;<span class="ident" id="1816865">ColorModel</span><span class="op" id="1816875">(</span><span class="op" id="1816876">)</span>&nbsp;<span class="ident" id="1816878">color</span><span class="op" id="1816883">.</span><span class="ident" id="1816884">Model</span>&nbsp;<span class="op" id="1816890">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1816893">return</span>&nbsp;<span class="ident" id="1816900">color</span><span class="op" id="1816905">.</span><span class="ident" id="1816906">YCbCrModel</span><br>
<span class="lineno"></span><span class="op" id="1816917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1816920">func</span>&nbsp;<span class="op" id="1816925">(</span><span class="ident" id="1816926">p</span>&nbsp;<span class="op" id="1816928">*</span><span class="ident" id="1816929">YCbCr</span><span class="op" id="1816934">)</span>&nbsp;<span class="ident" id="1816936">Bounds</span><span class="op" id="1816942">(</span><span class="op" id="1816943">)</span>&nbsp;<span class="ident" id="1816945">Rectangle</span>&nbsp;<span class="op" id="1816955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1816958">return</span>&nbsp;<span class="ident" id="1816965">p</span><span class="op" id="1816966">.</span><span class="ident" id="1816967">Rect</span><br>
<span class="lineno">60</span><span class="op" id="1816972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1816975">func</span>&nbsp;<span class="op" id="1816980">(</span><span class="ident" id="1816981">p</span>&nbsp;<span class="op" id="1816983">*</span><span class="ident" id="1816984">YCbCr</span><span class="op" id="1816989">)</span>&nbsp;<span class="ident" id="1816991">At</span><span class="op" id="1816993">(</span><span class="ident" id="1816994">x</span><span class="op" id="1816995">,</span>&nbsp;<span class="ident" id="1816997">y</span>&nbsp;<span class="builtintype" id="1816999">int</span><span class="op" id="1817002">)</span>&nbsp;<span class="ident" id="1817004">color</span><span class="op" id="1817009">.</span><span class="ident" id="1817010">Color</span>&nbsp;<span class="op" id="1817016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1817019">return</span>&nbsp;<span class="ident" id="1817026">p</span><span class="op" id="1817027">.</span><span class="ident" id="1817028">YCbCrAt</span><span class="op" id="1817035">(</span><span class="ident" id="1817036">x</span><span class="op" id="1817037">,</span>&nbsp;<span class="ident" id="1817039">y</span><span class="op" id="1817040">)</span><br>
<span class="lineno"></span><span class="op" id="1817042">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="1817045">func</span>&nbsp;<span class="op" id="1817050">(</span><span class="ident" id="1817051">p</span>&nbsp;<span class="op" id="1817053">*</span><span class="ident" id="1817054">YCbCr</span><span class="op" id="1817059">)</span>&nbsp;<span class="ident" id="1817061">YCbCrAt</span><span class="op" id="1817068">(</span><span class="ident" id="1817069">x</span><span class="op" id="1817070">,</span>&nbsp;<span class="ident" id="1817072">y</span>&nbsp;<span class="builtintype" id="1817074">int</span><span class="op" id="1817077">)</span>&nbsp;<span class="ident" id="1817079">color</span><span class="op" id="1817084">.</span><span class="ident" id="1817085">YCbCr</span>&nbsp;<span class="op" id="1817091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1817094">if</span>&nbsp;<span class="op" id="1817097">!</span><span class="op" id="1817098">(</span><span class="ident" id="1817099">Point</span><span class="op" id="1817104">{</span><span class="ident" id="1817105">x</span><span class="op" id="1817106">,</span>&nbsp;<span class="ident" id="1817108">y</span><span class="op" id="1817109">}</span><span class="op" id="1817110">.</span><span class="ident" id="1817111">In</span><span class="op" id="1817113">(</span><span class="ident" id="1817114">p</span><span class="op" id="1817115">.</span><span class="ident" id="1817116">Rect</span><span class="op" id="1817120">)</span><span class="op" id="1817121">)</span>&nbsp;<span class="op" id="1817123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1817127">return</span>&nbsp;<span class="ident" id="1817134">color</span><span class="op" id="1817139">.</span><span class="ident" id="1817140">YCbCr</span><span class="op" id="1817145">{</span><span class="op" id="1817146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1817149">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1817152">yi</span>&nbsp;<span class="op" id="1817155">:=</span>&nbsp;<span class="ident" id="1817158">p</span><span class="op" id="1817159">.</span><span class="ident" id="1817160">YOffset</span><span class="op" id="1817167">(</span><span class="ident" id="1817168">x</span><span class="op" id="1817169">,</span>&nbsp;<span class="ident" id="1817171">y</span><span class="op" id="1817172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1817175">ci</span>&nbsp;<span class="op" id="1817178">:=</span>&nbsp;<span class="ident" id="1817181">p</span><span class="op" id="1817182">.</span><span class="ident" id="1817183">COffset</span><span class="op" id="1817190">(</span><span class="ident" id="1817191">x</span><span class="op" id="1817192">,</span>&nbsp;<span class="ident" id="1817194">y</span><span class="op" id="1817195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1817198">return</span>&nbsp;<span class="ident" id="1817205">color</span><span class="op" id="1817210">.</span><span class="ident" id="1817211">YCbCr</span><span class="op" id="1817216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1817220">p</span><span class="op" id="1817221">.</span><span class="ident" id="1817222">Y</span><span class="op" id="1817223">[</span><span class="ident" id="1817224">yi</span><span class="op" id="1817226">]</span><span class="op" id="1817227">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1817231">p</span><span class="op" id="1817232">.</span><span class="ident" id="1817233">Cb</span><span class="op" id="1817235">[</span><span class="ident" id="1817236">ci</span><span class="op" id="1817238">]</span><span class="op" id="1817239">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1817243">p</span><span class="op" id="1817244">.</span><span class="ident" id="1817245">Cr</span><span class="op" id="1817247">[</span><span class="ident" id="1817248">ci</span><span class="op" id="1817250">]</span><span class="op" id="1817251">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1817254">}</span><br>
<span class="lineno"></span><span class="op" id="1817256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1817259">//&nbsp;YOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Y&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno">80</span><span class="comment" id="1817334">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="1817358">func</span>&nbsp;<span class="op" id="1817363">(</span><span class="ident" id="1817364">p</span>&nbsp;<span class="op" id="1817366">*</span><span class="ident" id="1817367">YCbCr</span><span class="op" id="1817372">)</span>&nbsp;<span class="ident" id="1817374">YOffset</span><span class="op" id="1817381">(</span><span class="ident" id="1817382">x</span><span class="op" id="1817383">,</span>&nbsp;<span class="ident" id="1817385">y</span>&nbsp;<span class="builtintype" id="1817387">int</span><span class="op" id="1817390">)</span>&nbsp;<span class="builtintype" id="1817392">int</span>&nbsp;<span class="op" id="1817396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1817399">return</span>&nbsp;<span class="op" id="1817406">(</span><span class="ident" id="1817407">y</span><span class="op" id="1817408">-</span><span class="ident" id="1817409">p</span><span class="op" id="1817410">.</span><span class="ident" id="1817411">Rect</span><span class="op" id="1817415">.</span><span class="ident" id="1817416">Min</span><span class="op" id="1817419">.</span><span class="ident" id="1817420">Y</span><span class="op" id="1817421">)</span><span class="op" id="1817422">*</span><span class="ident" id="1817423">p</span><span class="op" id="1817424">.</span><span class="ident" id="1817425">YStride</span>&nbsp;<span class="op" id="1817433">+</span>&nbsp;<span class="op" id="1817435">(</span><span class="ident" id="1817436">x</span>&nbsp;<span class="op" id="1817438">-</span>&nbsp;<span class="ident" id="1817440">p</span><span class="op" id="1817441">.</span><span class="ident" id="1817442">Rect</span><span class="op" id="1817446">.</span><span class="ident" id="1817447">Min</span><span class="op" id="1817450">.</span><span class="ident" id="1817451">X</span><span class="op" id="1817452">)</span><br>
<span class="lineno"></span><span class="op" id="1817454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="1817457">//&nbsp;COffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Cb&nbsp;or&nbsp;Cr&nbsp;that&nbsp;corresponds</span><br>
<span class="lineno"></span><span class="comment" id="1817536">//&nbsp;to&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="1817563">func</span>&nbsp;<span class="op" id="1817568">(</span><span class="ident" id="1817569">p</span>&nbsp;<span class="op" id="1817571">*</span><span class="ident" id="1817572">YCbCr</span><span class="op" id="1817577">)</span>&nbsp;<span class="ident" id="1817579">COffset</span><span class="op" id="1817586">(</span><span class="ident" id="1817587">x</span><span class="op" id="1817588">,</span>&nbsp;<span class="ident" id="1817590">y</span>&nbsp;<span class="builtintype" id="1817592">int</span><span class="op" id="1817595">)</span>&nbsp;<span class="builtintype" id="1817597">int</span>&nbsp;<span class="op" id="1817601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1817604">switch</span>&nbsp;<span class="ident" id="1817611">p</span><span class="op" id="1817612">.</span><span class="ident" id="1817613">SubsampleRatio</span>&nbsp;<span class="op" id="1817628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1817631">case</span>&nbsp;<span class="ident" id="1817636">YCbCrSubsampleRatio422</span><span class="op" id="1817658">:</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1817662">return</span>&nbsp;<span class="op" id="1817669">(</span><span class="ident" id="1817670">y</span><span class="op" id="1817671">-</span><span class="ident" id="1817672">p</span><span class="op" id="1817673">.</span><span class="ident" id="1817674">Rect</span><span class="op" id="1817678">.</span><span class="ident" id="1817679">Min</span><span class="op" id="1817682">.</span><span class="ident" id="1817683">Y</span><span class="op" id="1817684">)</span><span class="op" id="1817685">*</span><span class="ident" id="1817686">p</span><span class="op" id="1817687">.</span><span class="ident" id="1817688">CStride</span>&nbsp;<span class="op" id="1817696">+</span>&nbsp;<span class="op" id="1817698">(</span><span class="ident" id="1817699">x</span><span class="op" id="1817700">/</span><span class="num" id="1817701">2</span>&nbsp;<span class="op" id="1817703">-</span>&nbsp;<span class="ident" id="1817705">p</span><span class="op" id="1817706">.</span><span class="ident" id="1817707">Rect</span><span class="op" id="1817711">.</span><span class="ident" id="1817712">Min</span><span class="op" id="1817715">.</span><span class="ident" id="1817716">X</span><span class="op" id="1817717">/</span><span class="num" id="1817718">2</span><span class="op" id="1817719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1817722">case</span>&nbsp;<span class="ident" id="1817727">YCbCrSubsampleRatio420</span><span class="op" id="1817749">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1817753">return</span>&nbsp;<span class="op" id="1817760">(</span><span class="ident" id="1817761">y</span><span class="op" id="1817762">/</span><span class="num" id="1817763">2</span><span class="op" id="1817764">-</span><span class="ident" id="1817765">p</span><span class="op" id="1817766">.</span><span class="ident" id="1817767">Rect</span><span class="op" id="1817771">.</span><span class="ident" id="1817772">Min</span><span class="op" id="1817775">.</span><span class="ident" id="1817776">Y</span><span class="op" id="1817777">/</span><span class="num" id="1817778">2</span><span class="op" id="1817779">)</span><span class="op" id="1817780">*</span><span class="ident" id="1817781">p</span><span class="op" id="1817782">.</span><span class="ident" id="1817783">CStride</span>&nbsp;<span class="op" id="1817791">+</span>&nbsp;<span class="op" id="1817793">(</span><span class="ident" id="1817794">x</span><span class="op" id="1817795">/</span><span class="num" id="1817796">2</span>&nbsp;<span class="op" id="1817798">-</span>&nbsp;<span class="ident" id="1817800">p</span><span class="op" id="1817801">.</span><span class="ident" id="1817802">Rect</span><span class="op" id="1817806">.</span><span class="ident" id="1817807">Min</span><span class="op" id="1817810">.</span><span class="ident" id="1817811">X</span><span class="op" id="1817812">/</span><span class="num" id="1817813">2</span><span class="op" id="1817814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1817817">case</span>&nbsp;<span class="ident" id="1817822">YCbCrSubsampleRatio440</span><span class="op" id="1817844">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1817848">return</span>&nbsp;<span class="op" id="1817855">(</span><span class="ident" id="1817856">y</span><span class="op" id="1817857">/</span><span class="num" id="1817858">2</span><span class="op" id="1817859">-</span><span class="ident" id="1817860">p</span><span class="op" id="1817861">.</span><span class="ident" id="1817862">Rect</span><span class="op" id="1817866">.</span><span class="ident" id="1817867">Min</span><span class="op" id="1817870">.</span><span class="ident" id="1817871">Y</span><span class="op" id="1817872">/</span><span class="num" id="1817873">2</span><span class="op" id="1817874">)</span><span class="op" id="1817875">*</span><span class="ident" id="1817876">p</span><span class="op" id="1817877">.</span><span class="ident" id="1817878">CStride</span>&nbsp;<span class="op" id="1817886">+</span>&nbsp;<span class="op" id="1817888">(</span><span class="ident" id="1817889">x</span>&nbsp;<span class="op" id="1817891">-</span>&nbsp;<span class="ident" id="1817893">p</span><span class="op" id="1817894">.</span><span class="ident" id="1817895">Rect</span><span class="op" id="1817899">.</span><span class="ident" id="1817900">Min</span><span class="op" id="1817903">.</span><span class="ident" id="1817904">X</span><span class="op" id="1817905">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1817908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1817911">//&nbsp;Default&nbsp;to&nbsp;4:4:4&nbsp;subsampling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1817945">return</span>&nbsp;<span class="op" id="1817952">(</span><span class="ident" id="1817953">y</span><span class="op" id="1817954">-</span><span class="ident" id="1817955">p</span><span class="op" id="1817956">.</span><span class="ident" id="1817957">Rect</span><span class="op" id="1817961">.</span><span class="ident" id="1817962">Min</span><span class="op" id="1817965">.</span><span class="ident" id="1817966">Y</span><span class="op" id="1817967">)</span><span class="op" id="1817968">*</span><span class="ident" id="1817969">p</span><span class="op" id="1817970">.</span><span class="ident" id="1817971">CStride</span>&nbsp;<span class="op" id="1817979">+</span>&nbsp;<span class="op" id="1817981">(</span><span class="ident" id="1817982">x</span>&nbsp;<span class="op" id="1817984">-</span>&nbsp;<span class="ident" id="1817986">p</span><span class="op" id="1817987">.</span><span class="ident" id="1817988">Rect</span><span class="op" id="1817992">.</span><span class="ident" id="1817993">Min</span><span class="op" id="1817996">.</span><span class="ident" id="1817997">X</span><span class="op" id="1817998">)</span><br>
<span class="lineno"></span><span class="op" id="1818000">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="1818003">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="1818080">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="1818152">func</span>&nbsp;<span class="op" id="1818157">(</span><span class="ident" id="1818158">p</span>&nbsp;<span class="op" id="1818160">*</span><span class="ident" id="1818161">YCbCr</span><span class="op" id="1818166">)</span>&nbsp;<span class="ident" id="1818168">SubImage</span><span class="op" id="1818176">(</span><span class="ident" id="1818177">r</span>&nbsp;<span class="ident" id="1818179">Rectangle</span><span class="op" id="1818188">)</span>&nbsp;<span class="ident" id="1818190">Image</span>&nbsp;<span class="op" id="1818196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1818199">r</span>&nbsp;<span class="op" id="1818201">=</span>&nbsp;<span class="ident" id="1818203">r</span><span class="op" id="1818204">.</span><span class="ident" id="1818205">Intersect</span><span class="op" id="1818214">(</span><span class="ident" id="1818215">p</span><span class="op" id="1818216">.</span><span class="ident" id="1818217">Rect</span><span class="op" id="1818221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1818224">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1818305">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1818387">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1818437">if</span>&nbsp;<span class="ident" id="1818440">r</span><span class="op" id="1818441">.</span><span class="ident" id="1818442">Empty</span><span class="op" id="1818447">(</span><span class="op" id="1818448">)</span>&nbsp;<span class="op" id="1818450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1818454">return</span>&nbsp;<span class="op" id="1818461">&amp;</span><span class="ident" id="1818462">YCbCr</span><span class="op" id="1818467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1818472">SubsampleRatio</span><span class="op" id="1818486">:</span>&nbsp;<span class="ident" id="1818488">p</span><span class="op" id="1818489">.</span><span class="ident" id="1818490">SubsampleRatio</span><span class="op" id="1818504">,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1818508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1818511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1818514">yi</span>&nbsp;<span class="op" id="1818517">:=</span>&nbsp;<span class="ident" id="1818520">p</span><span class="op" id="1818521">.</span><span class="ident" id="1818522">YOffset</span><span class="op" id="1818529">(</span><span class="ident" id="1818530">r</span><span class="op" id="1818531">.</span><span class="ident" id="1818532">Min</span><span class="op" id="1818535">.</span><span class="ident" id="1818536">X</span><span class="op" id="1818537">,</span>&nbsp;<span class="ident" id="1818539">r</span><span class="op" id="1818540">.</span><span class="ident" id="1818541">Min</span><span class="op" id="1818544">.</span><span class="ident" id="1818545">Y</span><span class="op" id="1818546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1818549">ci</span>&nbsp;<span class="op" id="1818552">:=</span>&nbsp;<span class="ident" id="1818555">p</span><span class="op" id="1818556">.</span><span class="ident" id="1818557">COffset</span><span class="op" id="1818564">(</span><span class="ident" id="1818565">r</span><span class="op" id="1818566">.</span><span class="ident" id="1818567">Min</span><span class="op" id="1818570">.</span><span class="ident" id="1818571">X</span><span class="op" id="1818572">,</span>&nbsp;<span class="ident" id="1818574">r</span><span class="op" id="1818575">.</span><span class="ident" id="1818576">Min</span><span class="op" id="1818579">.</span><span class="ident" id="1818580">Y</span><span class="op" id="1818581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1818584">return</span>&nbsp;<span class="op" id="1818591">&amp;</span><span class="ident" id="1818592">YCbCr</span><span class="op" id="1818597">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1818601">Y</span><span class="op" id="1818602">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1818617">p</span><span class="op" id="1818618">.</span><span class="ident" id="1818619">Y</span><span class="op" id="1818620">[</span><span class="ident" id="1818621">yi</span><span class="op" id="1818623">:</span><span class="op" id="1818624">]</span><span class="op" id="1818625">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1818629">Cb</span><span class="op" id="1818631">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1818645">p</span><span class="op" id="1818646">.</span><span class="ident" id="1818647">Cb</span><span class="op" id="1818649">[</span><span class="ident" id="1818650">ci</span><span class="op" id="1818652">:</span><span class="op" id="1818653">]</span><span class="op" id="1818654">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1818658">Cr</span><span class="op" id="1818660">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1818674">p</span><span class="op" id="1818675">.</span><span class="ident" id="1818676">Cr</span><span class="op" id="1818678">[</span><span class="ident" id="1818679">ci</span><span class="op" id="1818681">:</span><span class="op" id="1818682">]</span><span class="op" id="1818683">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1818687">SubsampleRatio</span><span class="op" id="1818701">:</span>&nbsp;<span class="ident" id="1818703">p</span><span class="op" id="1818704">.</span><span class="ident" id="1818705">SubsampleRatio</span><span class="op" id="1818719">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1818723">YStride</span><span class="op" id="1818730">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1818739">p</span><span class="op" id="1818740">.</span><span class="ident" id="1818741">YStride</span><span class="op" id="1818748">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1818752">CStride</span><span class="op" id="1818759">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1818768">p</span><span class="op" id="1818769">.</span><span class="ident" id="1818770">CStride</span><span class="op" id="1818777">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1818781">Rect</span><span class="op" id="1818785">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1818797">r</span><span class="op" id="1818798">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1818801">}</span><br>
<span class="lineno"></span><span class="op" id="1818803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="1818806">func</span>&nbsp;<span class="op" id="1818811">(</span><span class="ident" id="1818812">p</span>&nbsp;<span class="op" id="1818814">*</span><span class="ident" id="1818815">YCbCr</span><span class="op" id="1818820">)</span>&nbsp;<span class="ident" id="1818822">Opaque</span><span class="op" id="1818828">(</span><span class="op" id="1818829">)</span>&nbsp;<span class="builtintype" id="1818831">bool</span>&nbsp;<span class="op" id="1818836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1818839">return</span>&nbsp;<span class="builtintype" id="1818846">true</span><br>
<span class="lineno"></span><span class="op" id="1818851">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1818854">//&nbsp;NewYCbCr&nbsp;returns&nbsp;a&nbsp;new&nbsp;YCbCr&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds&nbsp;and&nbsp;subsample&nbsp;ratio.</span><br>
<span class="lineno">130</span><span class="keyword" id="1818929">func</span>&nbsp;<span class="ident" id="1818934">NewYCbCr</span><span class="op" id="1818942">(</span><span class="ident" id="1818943">r</span>&nbsp;<span class="ident" id="1818945">Rectangle</span><span class="op" id="1818954">,</span>&nbsp;<span class="ident" id="1818956">subsampleRatio</span>&nbsp;<span class="ident" id="1818971">YCbCrSubsampleRatio</span><span class="op" id="1818990">)</span>&nbsp;<span class="op" id="1818992">*</span><span class="ident" id="1818993">YCbCr</span>&nbsp;<span class="op" id="1818999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1819002">w</span><span class="op" id="1819003">,</span>&nbsp;<span class="ident" id="1819005">h</span><span class="op" id="1819006">,</span>&nbsp;<span class="ident" id="1819008">cw</span><span class="op" id="1819010">,</span>&nbsp;<span class="ident" id="1819012">ch</span>&nbsp;<span class="op" id="1819015">:=</span>&nbsp;<span class="ident" id="1819018">r</span><span class="op" id="1819019">.</span><span class="ident" id="1819020">Dx</span><span class="op" id="1819022">(</span><span class="op" id="1819023">)</span><span class="op" id="1819024">,</span>&nbsp;<span class="ident" id="1819026">r</span><span class="op" id="1819027">.</span><span class="ident" id="1819028">Dy</span><span class="op" id="1819030">(</span><span class="op" id="1819031">)</span><span class="op" id="1819032">,</span>&nbsp;<span class="num" id="1819034">0</span><span class="op" id="1819035">,</span>&nbsp;<span class="num" id="1819037">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1819040">switch</span>&nbsp;<span class="ident" id="1819047">subsampleRatio</span>&nbsp;<span class="op" id="1819062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1819065">case</span>&nbsp;<span class="ident" id="1819070">YCbCrSubsampleRatio422</span><span class="op" id="1819092">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1819096">cw</span>&nbsp;<span class="op" id="1819099">=</span>&nbsp;<span class="op" id="1819101">(</span><span class="ident" id="1819102">r</span><span class="op" id="1819103">.</span><span class="ident" id="1819104">Max</span><span class="op" id="1819107">.</span><span class="ident" id="1819108">X</span><span class="op" id="1819109">+</span><span class="num" id="1819110">1</span><span class="op" id="1819111">)</span><span class="op" id="1819112">/</span><span class="num" id="1819113">2</span>&nbsp;<span class="op" id="1819115">-</span>&nbsp;<span class="ident" id="1819117">r</span><span class="op" id="1819118">.</span><span class="ident" id="1819119">Min</span><span class="op" id="1819122">.</span><span class="ident" id="1819123">X</span><span class="op" id="1819124">/</span><span class="num" id="1819125">2</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1819129">ch</span>&nbsp;<span class="op" id="1819132">=</span>&nbsp;<span class="ident" id="1819134">h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1819137">case</span>&nbsp;<span class="ident" id="1819142">YCbCrSubsampleRatio420</span><span class="op" id="1819164">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1819168">cw</span>&nbsp;<span class="op" id="1819171">=</span>&nbsp;<span class="op" id="1819173">(</span><span class="ident" id="1819174">r</span><span class="op" id="1819175">.</span><span class="ident" id="1819176">Max</span><span class="op" id="1819179">.</span><span class="ident" id="1819180">X</span><span class="op" id="1819181">+</span><span class="num" id="1819182">1</span><span class="op" id="1819183">)</span><span class="op" id="1819184">/</span><span class="num" id="1819185">2</span>&nbsp;<span class="op" id="1819187">-</span>&nbsp;<span class="ident" id="1819189">r</span><span class="op" id="1819190">.</span><span class="ident" id="1819191">Min</span><span class="op" id="1819194">.</span><span class="ident" id="1819195">X</span><span class="op" id="1819196">/</span><span class="num" id="1819197">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1819201">ch</span>&nbsp;<span class="op" id="1819204">=</span>&nbsp;<span class="op" id="1819206">(</span><span class="ident" id="1819207">r</span><span class="op" id="1819208">.</span><span class="ident" id="1819209">Max</span><span class="op" id="1819212">.</span><span class="ident" id="1819213">Y</span><span class="op" id="1819214">+</span><span class="num" id="1819215">1</span><span class="op" id="1819216">)</span><span class="op" id="1819217">/</span><span class="num" id="1819218">2</span>&nbsp;<span class="op" id="1819220">-</span>&nbsp;<span class="ident" id="1819222">r</span><span class="op" id="1819223">.</span><span class="ident" id="1819224">Min</span><span class="op" id="1819227">.</span><span class="ident" id="1819228">Y</span><span class="op" id="1819229">/</span><span class="num" id="1819230">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1819233">case</span>&nbsp;<span class="ident" id="1819238">YCbCrSubsampleRatio440</span><span class="op" id="1819260">:</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1819264">cw</span>&nbsp;<span class="op" id="1819267">=</span>&nbsp;<span class="ident" id="1819269">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1819273">ch</span>&nbsp;<span class="op" id="1819276">=</span>&nbsp;<span class="op" id="1819278">(</span><span class="ident" id="1819279">r</span><span class="op" id="1819280">.</span><span class="ident" id="1819281">Max</span><span class="op" id="1819284">.</span><span class="ident" id="1819285">Y</span><span class="op" id="1819286">+</span><span class="num" id="1819287">1</span><span class="op" id="1819288">)</span><span class="op" id="1819289">/</span><span class="num" id="1819290">2</span>&nbsp;<span class="op" id="1819292">-</span>&nbsp;<span class="ident" id="1819294">r</span><span class="op" id="1819295">.</span><span class="ident" id="1819296">Min</span><span class="op" id="1819299">.</span><span class="ident" id="1819300">Y</span><span class="op" id="1819301">/</span><span class="num" id="1819302">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1819305">default</span><span class="op" id="1819312">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1819316">//&nbsp;Default&nbsp;to&nbsp;4:4:4&nbsp;subsampling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1819351">cw</span>&nbsp;<span class="op" id="1819354">=</span>&nbsp;<span class="ident" id="1819356">w</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1819360">ch</span>&nbsp;<span class="op" id="1819363">=</span>&nbsp;<span class="ident" id="1819365">h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1819368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1819371">b</span>&nbsp;<span class="op" id="1819373">:=</span>&nbsp;<span class="builtinfunc" id="1819376">make</span><span class="op" id="1819380">(</span><span class="op" id="1819381">[</span><span class="op" id="1819382">]</span><span class="builtintype" id="1819383">byte</span><span class="op" id="1819387">,</span>&nbsp;<span class="ident" id="1819389">w</span><span class="op" id="1819390">*</span><span class="ident" id="1819391">h</span><span class="op" id="1819392">+</span><span class="num" id="1819393">2</span><span class="op" id="1819394">*</span><span class="ident" id="1819395">cw</span><span class="op" id="1819397">*</span><span class="ident" id="1819398">ch</span><span class="op" id="1819400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1819403">return</span>&nbsp;<span class="op" id="1819410">&amp;</span><span class="ident" id="1819411">YCbCr</span><span class="op" id="1819416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1819420">Y</span><span class="op" id="1819421">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1819436">b</span><span class="op" id="1819437">[</span><span class="op" id="1819438">:</span><span class="ident" id="1819439">w</span><span class="op" id="1819440">*</span><span class="ident" id="1819441">h</span><span class="op" id="1819442">]</span><span class="op" id="1819443">,</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1819447">Cb</span><span class="op" id="1819449">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1819463">b</span><span class="op" id="1819464">[</span><span class="ident" id="1819465">w</span><span class="op" id="1819466">*</span><span class="ident" id="1819467">h</span><span class="op" id="1819468">+</span><span class="num" id="1819469">0</span><span class="op" id="1819470">*</span><span class="ident" id="1819471">cw</span><span class="op" id="1819473">*</span><span class="ident" id="1819474">ch</span>&nbsp;<span class="op" id="1819477">:</span>&nbsp;<span class="ident" id="1819479">w</span><span class="op" id="1819480">*</span><span class="ident" id="1819481">h</span><span class="op" id="1819482">+</span><span class="num" id="1819483">1</span><span class="op" id="1819484">*</span><span class="ident" id="1819485">cw</span><span class="op" id="1819487">*</span><span class="ident" id="1819488">ch</span><span class="op" id="1819490">]</span><span class="op" id="1819491">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1819495">Cr</span><span class="op" id="1819497">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1819511">b</span><span class="op" id="1819512">[</span><span class="ident" id="1819513">w</span><span class="op" id="1819514">*</span><span class="ident" id="1819515">h</span><span class="op" id="1819516">+</span><span class="num" id="1819517">1</span><span class="op" id="1819518">*</span><span class="ident" id="1819519">cw</span><span class="op" id="1819521">*</span><span class="ident" id="1819522">ch</span>&nbsp;<span class="op" id="1819525">:</span>&nbsp;<span class="ident" id="1819527">w</span><span class="op" id="1819528">*</span><span class="ident" id="1819529">h</span><span class="op" id="1819530">+</span><span class="num" id="1819531">2</span><span class="op" id="1819532">*</span><span class="ident" id="1819533">cw</span><span class="op" id="1819535">*</span><span class="ident" id="1819536">ch</span><span class="op" id="1819538">]</span><span class="op" id="1819539">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1819543">SubsampleRatio</span><span class="op" id="1819557">:</span>&nbsp;<span class="ident" id="1819559">subsampleRatio</span><span class="op" id="1819573">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1819577">YStride</span><span class="op" id="1819584">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1819593">w</span><span class="op" id="1819594">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1819598">CStride</span><span class="op" id="1819605">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1819614">cw</span><span class="op" id="1819616">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1819620">Rect</span><span class="op" id="1819624">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1819636">r</span><span class="op" id="1819637">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1819640">}</span><br>
<span class="lineno"></span><span class="op" id="1819642">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
