<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html" class="current">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7591352">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7591408">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7591462">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7591513">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;API&nbsp;tests&nbsp;across&nbsp;platforms&nbsp;and&nbsp;will&nbsp;never&nbsp;have&nbsp;a&nbsp;build</span><br>
<span class="lineno"></span><span class="comment" id="7591592">//&nbsp;tag.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7591601">package</span>&nbsp;<span class="ident" id="7591609">net</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="7591614">import</span>&nbsp;<span class="op" id="7591621">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7591624">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7591630">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7591641">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7591652">&#34;testing&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7591663">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7591670">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7591673">func</span>&nbsp;<span class="ident" id="7591678">packetConnTestData</span><span class="op" id="7591696">(</span><span class="ident" id="7591697">t</span>&nbsp;<span class="op" id="7591699">*</span><span class="ident" id="7591700">testing</span><span class="op" id="7591707">.</span><span class="ident" id="7591708">T</span><span class="op" id="7591709">,</span>&nbsp;<span class="ident" id="7591711">net</span>&nbsp;<span class="builtintype" id="7591715">string</span><span class="op" id="7591721">,</span>&nbsp;<span class="ident" id="7591723">i</span>&nbsp;<span class="builtintype" id="7591725">int</span><span class="op" id="7591728">)</span>&nbsp;<span class="op" id="7591730">(</span><span class="op" id="7591731">[</span><span class="op" id="7591732">]</span><span class="builtintype" id="7591733">byte</span><span class="op" id="7591737">,</span>&nbsp;<span class="keyword" id="7591739">func</span><span class="op" id="7591743">(</span><span class="op" id="7591744">)</span><span class="op" id="7591745">)</span>&nbsp;<span class="op" id="7591747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7591750">switch</span>&nbsp;<span class="ident" id="7591757">net</span>&nbsp;<span class="op" id="7591761">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7591764">case</span>&nbsp;<span class="string" id="7591769">&#34;udp&#34;</span><span class="op" id="7591774">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7591778">return</span>&nbsp;<span class="op" id="7591785">[</span><span class="op" id="7591786">]</span><span class="builtintype" id="7591787">byte</span><span class="op" id="7591791">(</span><span class="string" id="7591792">&#34;UDP&nbsp;PACKETCONN&nbsp;TEST&#34;</span><span class="op" id="7591813">)</span><span class="op" id="7591814">,</span>&nbsp;<span class="ident" id="7591816">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7591821">case</span>&nbsp;<span class="string" id="7591826">&#34;ip&#34;</span><span class="op" id="7591830">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7591834">if</span>&nbsp;<span class="ident" id="7591837">skip</span><span class="op" id="7591841">,</span>&nbsp;<span class="ident" id="7591843">skipmsg</span>&nbsp;<span class="op" id="7591851">:=</span>&nbsp;<span class="ident" id="7591854">skipRawSocketTest</span><span class="op" id="7591871">(</span><span class="ident" id="7591872">t</span><span class="op" id="7591873">)</span><span class="op" id="7591874">;</span>&nbsp;<span class="ident" id="7591876">skip</span>&nbsp;<span class="op" id="7591881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7591886">return</span>&nbsp;<span class="ident" id="7591893">nil</span><span class="op" id="7591896">,</span>&nbsp;<span class="keyword" id="7591898">func</span><span class="op" id="7591902">(</span><span class="op" id="7591903">)</span>&nbsp;<span class="op" id="7591905">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7591911">t</span><span class="op" id="7591912">.</span><span class="ident" id="7591913">Logf</span><span class="op" id="7591917">(</span><span class="ident" id="7591918">skipmsg</span><span class="op" id="7591925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7591930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7591934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7591938">b</span><span class="op" id="7591939">,</span>&nbsp;<span class="ident" id="7591941">err</span>&nbsp;<span class="op" id="7591945">:=</span>&nbsp;<span class="op" id="7591948">(</span><span class="op" id="7591949">&amp;</span><span class="ident" id="7591950">icmpMessage</span><span class="op" id="7591961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7591966">Type</span><span class="op" id="7591970">:</span>&nbsp;<span class="ident" id="7591972">icmpv4EchoRequest</span><span class="op" id="7591989">,</span>&nbsp;<span class="ident" id="7591991">Code</span><span class="op" id="7591995">:</span>&nbsp;<span class="num" id="7591997">0</span><span class="op" id="7591998">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7592003">Body</span><span class="op" id="7592007">:</span>&nbsp;<span class="op" id="7592009">&amp;</span><span class="ident" id="7592010">icmpEcho</span><span class="op" id="7592018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7592024">ID</span><span class="op" id="7592026">:</span>&nbsp;<span class="ident" id="7592028">os</span><span class="op" id="7592030">.</span><span class="ident" id="7592031">Getpid</span><span class="op" id="7592037">(</span><span class="op" id="7592038">)</span>&nbsp;<span class="op" id="7592040">&amp;</span>&nbsp;<span class="num" id="7592042">0xffff</span><span class="op" id="7592048">,</span>&nbsp;<span class="ident" id="7592050">Seq</span><span class="op" id="7592053">:</span>&nbsp;<span class="ident" id="7592055">i</span>&nbsp;<span class="op" id="7592057">+</span>&nbsp;<span class="num" id="7592059">1</span><span class="op" id="7592060">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7592066">Data</span><span class="op" id="7592070">:</span>&nbsp;<span class="op" id="7592072">[</span><span class="op" id="7592073">]</span><span class="builtintype" id="7592074">byte</span><span class="op" id="7592078">(</span><span class="string" id="7592079">&#34;IP&nbsp;PACKETCONN&nbsp;TEST&#34;</span><span class="op" id="7592099">)</span><span class="op" id="7592100">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7592105">}</span><span class="op" id="7592106">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7592110">}</span><span class="op" id="7592111">)</span><span class="op" id="7592112">.</span><span class="ident" id="7592113">Marshal</span><span class="op" id="7592120">(</span><span class="op" id="7592121">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7592125">if</span>&nbsp;<span class="ident" id="7592128">err</span>&nbsp;<span class="op" id="7592132">!=</span>&nbsp;<span class="ident" id="7592135">nil</span>&nbsp;<span class="op" id="7592139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7592144">return</span>&nbsp;<span class="ident" id="7592151">nil</span><span class="op" id="7592154">,</span>&nbsp;<span class="keyword" id="7592156">func</span><span class="op" id="7592160">(</span><span class="op" id="7592161">)</span>&nbsp;<span class="op" id="7592163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7592169">t</span><span class="op" id="7592170">.</span><span class="ident" id="7592171">Fatalf</span><span class="op" id="7592177">(</span><span class="string" id="7592178">&#34;icmpMessage.Marshal&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7592210">,</span>&nbsp;<span class="ident" id="7592212">err</span><span class="op" id="7592215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7592220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7592224">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7592228">return</span>&nbsp;<span class="ident" id="7592235">b</span><span class="op" id="7592236">,</span>&nbsp;<span class="ident" id="7592238">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7592243">case</span>&nbsp;<span class="string" id="7592248">&#34;unixgram&#34;</span><span class="op" id="7592258">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7592262">switch</span>&nbsp;<span class="ident" id="7592269">runtime</span><span class="op" id="7592276">.</span><span class="ident" id="7592277">GOOS</span>&nbsp;<span class="op" id="7592282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7592286">case</span>&nbsp;<span class="string" id="7592291">&#34;nacl&#34;</span><span class="op" id="7592297">,</span>&nbsp;<span class="string" id="7592299">&#34;plan9&#34;</span><span class="op" id="7592306">,</span>&nbsp;<span class="string" id="7592308">&#34;windows&#34;</span><span class="op" id="7592317">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7592322">return</span>&nbsp;<span class="ident" id="7592329">nil</span><span class="op" id="7592332">,</span>&nbsp;<span class="keyword" id="7592334">func</span><span class="op" id="7592338">(</span><span class="op" id="7592339">)</span>&nbsp;<span class="op" id="7592341">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7592347">t</span><span class="op" id="7592348">.</span><span class="ident" id="7592349">Logf</span><span class="op" id="7592353">(</span><span class="string" id="7592354">&#34;skipping&nbsp;%q&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7592378">,</span>&nbsp;<span class="ident" id="7592380">net</span><span class="op" id="7592383">,</span>&nbsp;<span class="ident" id="7592385">runtime</span><span class="op" id="7592392">.</span><span class="ident" id="7592393">GOOS</span><span class="op" id="7592397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7592402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7592406">default</span><span class="op" id="7592413">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7592418">return</span>&nbsp;<span class="op" id="7592425">[</span><span class="op" id="7592426">]</span><span class="builtintype" id="7592427">byte</span><span class="op" id="7592431">(</span><span class="string" id="7592432">&#34;UNIXGRAM&nbsp;PACKETCONN&nbsp;TEST&#34;</span><span class="op" id="7592458">)</span><span class="op" id="7592459">,</span>&nbsp;<span class="ident" id="7592461">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7592467">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7592470">default</span><span class="op" id="7592477">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7592481">return</span>&nbsp;<span class="ident" id="7592488">nil</span><span class="op" id="7592491">,</span>&nbsp;<span class="keyword" id="7592493">func</span><span class="op" id="7592497">(</span><span class="op" id="7592498">)</span>&nbsp;<span class="op" id="7592500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7592505">t</span><span class="op" id="7592506">.</span><span class="ident" id="7592507">Logf</span><span class="op" id="7592511">(</span><span class="string" id="7592512">&#34;skipping&nbsp;%q&nbsp;test&#34;</span><span class="op" id="7592530">,</span>&nbsp;<span class="ident" id="7592532">net</span><span class="op" id="7592535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7592539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7592542">}</span><br>
<span class="lineno">55</span><span class="op" id="7592544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7592547">var</span>&nbsp;<span class="ident" id="7592551">packetConnTests</span>&nbsp;<span class="op" id="7592567">=</span>&nbsp;<span class="op" id="7592569">[</span><span class="op" id="7592570">]</span><span class="keyword" id="7592571">struct</span>&nbsp;<span class="op" id="7592578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7592581">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7592587">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7592595">addr1</span>&nbsp;<span class="builtintype" id="7592601">string</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7592609">addr2</span>&nbsp;<span class="builtintype" id="7592615">string</span><br>
<span class="lineno"></span><span class="op" id="7592622">}</span><span class="op" id="7592623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7592626">{</span><span class="string" id="7592627">&#34;udp&#34;</span><span class="op" id="7592632">,</span>&nbsp;<span class="string" id="7592634">&#34;127.0.0.1:0&#34;</span><span class="op" id="7592647">,</span>&nbsp;<span class="string" id="7592649">&#34;127.0.0.1:0&#34;</span><span class="op" id="7592662">}</span><span class="op" id="7592663">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7592666">{</span><span class="string" id="7592667">&#34;ip:icmp&#34;</span><span class="op" id="7592676">,</span>&nbsp;<span class="string" id="7592678">&#34;127.0.0.1&#34;</span><span class="op" id="7592689">,</span>&nbsp;<span class="string" id="7592691">&#34;127.0.0.1&#34;</span><span class="op" id="7592702">}</span><span class="op" id="7592703">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7592706">{</span><span class="string" id="7592707">&#34;unixgram&#34;</span><span class="op" id="7592717">,</span>&nbsp;<span class="ident" id="7592719">testUnixAddr</span><span class="op" id="7592731">(</span><span class="op" id="7592732">)</span><span class="op" id="7592733">,</span>&nbsp;<span class="ident" id="7592735">testUnixAddr</span><span class="op" id="7592747">(</span><span class="op" id="7592748">)</span><span class="op" id="7592749">}</span><span class="op" id="7592750">,</span><br>
<span class="lineno">65</span><span class="op" id="7592752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7592755">func</span>&nbsp;<span class="ident" id="7592760">TestPacketConn</span><span class="op" id="7592774">(</span><span class="ident" id="7592775">t</span>&nbsp;<span class="op" id="7592777">*</span><span class="ident" id="7592778">testing</span><span class="op" id="7592785">.</span><span class="ident" id="7592786">T</span><span class="op" id="7592787">)</span>&nbsp;<span class="op" id="7592789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7592792">closer</span>&nbsp;<span class="op" id="7592799">:=</span>&nbsp;<span class="keyword" id="7592802">func</span><span class="op" id="7592806">(</span><span class="ident" id="7592807">c</span>&nbsp;<span class="ident" id="7592809">PacketConn</span><span class="op" id="7592819">,</span>&nbsp;<span class="ident" id="7592821">net</span><span class="op" id="7592824">,</span>&nbsp;<span class="ident" id="7592826">addr1</span><span class="op" id="7592831">,</span>&nbsp;<span class="ident" id="7592833">addr2</span>&nbsp;<span class="builtintype" id="7592839">string</span><span class="op" id="7592845">)</span>&nbsp;<span class="op" id="7592847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7592851">c</span><span class="op" id="7592852">.</span><span class="ident" id="7592853">Close</span><span class="op" id="7592858">(</span><span class="op" id="7592859">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7592863">switch</span>&nbsp;<span class="ident" id="7592870">net</span>&nbsp;<span class="op" id="7592874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7592878">case</span>&nbsp;<span class="string" id="7592883">&#34;unixgram&#34;</span><span class="op" id="7592893">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7592898">os</span><span class="op" id="7592900">.</span><span class="ident" id="7592901">Remove</span><span class="op" id="7592907">(</span><span class="ident" id="7592908">addr1</span><span class="op" id="7592913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7592918">os</span><span class="op" id="7592920">.</span><span class="ident" id="7592921">Remove</span><span class="op" id="7592927">(</span><span class="ident" id="7592928">addr2</span><span class="op" id="7592933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7592937">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7592940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7592944">for</span>&nbsp;<span class="ident" id="7592948">i</span><span class="op" id="7592949">,</span>&nbsp;<span class="ident" id="7592951">tt</span>&nbsp;<span class="op" id="7592954">:=</span>&nbsp;<span class="keyword" id="7592957">range</span>&nbsp;<span class="ident" id="7592963">packetConnTests</span>&nbsp;<span class="op" id="7592979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7592983">netstr</span>&nbsp;<span class="op" id="7592990">:=</span>&nbsp;<span class="ident" id="7592993">strings</span><span class="op" id="7593000">.</span><span class="ident" id="7593001">Split</span><span class="op" id="7593006">(</span><span class="ident" id="7593007">tt</span><span class="op" id="7593009">.</span><span class="ident" id="7593010">net</span><span class="op" id="7593013">,</span>&nbsp;<span class="string" id="7593015">&#34;:&#34;</span><span class="op" id="7593018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7593022">wb</span><span class="op" id="7593024">,</span>&nbsp;<span class="ident" id="7593026">skipOrFatalFn</span>&nbsp;<span class="op" id="7593040">:=</span>&nbsp;<span class="ident" id="7593043">packetConnTestData</span><span class="op" id="7593061">(</span><span class="ident" id="7593062">t</span><span class="op" id="7593063">,</span>&nbsp;<span class="ident" id="7593065">netstr</span><span class="op" id="7593071">[</span><span class="num" id="7593072">0</span><span class="op" id="7593073">]</span><span class="op" id="7593074">,</span>&nbsp;<span class="ident" id="7593076">i</span><span class="op" id="7593077">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7593081">if</span>&nbsp;<span class="ident" id="7593084">skipOrFatalFn</span>&nbsp;<span class="op" id="7593098">!=</span>&nbsp;<span class="ident" id="7593101">nil</span>&nbsp;<span class="op" id="7593105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7593110">skipOrFatalFn</span><span class="op" id="7593123">(</span><span class="op" id="7593124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7593129">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7593140">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7593145">c1</span><span class="op" id="7593147">,</span>&nbsp;<span class="ident" id="7593149">err</span>&nbsp;<span class="op" id="7593153">:=</span>&nbsp;<span class="ident" id="7593156">ListenPacket</span><span class="op" id="7593168">(</span><span class="ident" id="7593169">tt</span><span class="op" id="7593171">.</span><span class="ident" id="7593172">net</span><span class="op" id="7593175">,</span>&nbsp;<span class="ident" id="7593177">tt</span><span class="op" id="7593179">.</span><span class="ident" id="7593180">addr1</span><span class="op" id="7593185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7593189">if</span>&nbsp;<span class="ident" id="7593192">err</span>&nbsp;<span class="op" id="7593196">!=</span>&nbsp;<span class="ident" id="7593199">nil</span>&nbsp;<span class="op" id="7593203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7593208">t</span><span class="op" id="7593209">.</span><span class="ident" id="7593210">Fatalf</span><span class="op" id="7593216">(</span><span class="string" id="7593217">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7593242">,</span>&nbsp;<span class="ident" id="7593244">err</span><span class="op" id="7593247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7593251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7593255">defer</span>&nbsp;<span class="ident" id="7593261">closer</span><span class="op" id="7593267">(</span><span class="ident" id="7593268">c1</span><span class="op" id="7593270">,</span>&nbsp;<span class="ident" id="7593272">netstr</span><span class="op" id="7593278">[</span><span class="num" id="7593279">0</span><span class="op" id="7593280">]</span><span class="op" id="7593281">,</span>&nbsp;<span class="ident" id="7593283">tt</span><span class="op" id="7593285">.</span><span class="ident" id="7593286">addr1</span><span class="op" id="7593291">,</span>&nbsp;<span class="ident" id="7593293">tt</span><span class="op" id="7593295">.</span><span class="ident" id="7593296">addr2</span><span class="op" id="7593301">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7593305">c1</span><span class="op" id="7593307">.</span><span class="ident" id="7593308">LocalAddr</span><span class="op" id="7593317">(</span><span class="op" id="7593318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7593322">c1</span><span class="op" id="7593324">.</span><span class="ident" id="7593325">SetDeadline</span><span class="op" id="7593336">(</span><span class="ident" id="7593337">time</span><span class="op" id="7593341">.</span><span class="ident" id="7593342">Now</span><span class="op" id="7593345">(</span><span class="op" id="7593346">)</span><span class="op" id="7593347">.</span><span class="ident" id="7593348">Add</span><span class="op" id="7593351">(</span><span class="num" id="7593352">100</span>&nbsp;<span class="op" id="7593356">*</span>&nbsp;<span class="ident" id="7593358">time</span><span class="op" id="7593362">.</span><span class="ident" id="7593363">Millisecond</span><span class="op" id="7593374">)</span><span class="op" id="7593375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7593379">c1</span><span class="op" id="7593381">.</span><span class="ident" id="7593382">SetReadDeadline</span><span class="op" id="7593397">(</span><span class="ident" id="7593398">time</span><span class="op" id="7593402">.</span><span class="ident" id="7593403">Now</span><span class="op" id="7593406">(</span><span class="op" id="7593407">)</span><span class="op" id="7593408">.</span><span class="ident" id="7593409">Add</span><span class="op" id="7593412">(</span><span class="num" id="7593413">100</span>&nbsp;<span class="op" id="7593417">*</span>&nbsp;<span class="ident" id="7593419">time</span><span class="op" id="7593423">.</span><span class="ident" id="7593424">Millisecond</span><span class="op" id="7593435">)</span><span class="op" id="7593436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7593440">c1</span><span class="op" id="7593442">.</span><span class="ident" id="7593443">SetWriteDeadline</span><span class="op" id="7593459">(</span><span class="ident" id="7593460">time</span><span class="op" id="7593464">.</span><span class="ident" id="7593465">Now</span><span class="op" id="7593468">(</span><span class="op" id="7593469">)</span><span class="op" id="7593470">.</span><span class="ident" id="7593471">Add</span><span class="op" id="7593474">(</span><span class="num" id="7593475">100</span>&nbsp;<span class="op" id="7593479">*</span>&nbsp;<span class="ident" id="7593481">time</span><span class="op" id="7593485">.</span><span class="ident" id="7593486">Millisecond</span><span class="op" id="7593497">)</span><span class="op" id="7593498">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7593503">c2</span><span class="op" id="7593505">,</span>&nbsp;<span class="ident" id="7593507">err</span>&nbsp;<span class="op" id="7593511">:=</span>&nbsp;<span class="ident" id="7593514">ListenPacket</span><span class="op" id="7593526">(</span><span class="ident" id="7593527">tt</span><span class="op" id="7593529">.</span><span class="ident" id="7593530">net</span><span class="op" id="7593533">,</span>&nbsp;<span class="ident" id="7593535">tt</span><span class="op" id="7593537">.</span><span class="ident" id="7593538">addr2</span><span class="op" id="7593543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7593547">if</span>&nbsp;<span class="ident" id="7593550">err</span>&nbsp;<span class="op" id="7593554">!=</span>&nbsp;<span class="ident" id="7593557">nil</span>&nbsp;<span class="op" id="7593561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7593566">t</span><span class="op" id="7593567">.</span><span class="ident" id="7593568">Fatalf</span><span class="op" id="7593574">(</span><span class="string" id="7593575">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7593600">,</span>&nbsp;<span class="ident" id="7593602">err</span><span class="op" id="7593605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7593609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7593613">defer</span>&nbsp;<span class="ident" id="7593619">closer</span><span class="op" id="7593625">(</span><span class="ident" id="7593626">c2</span><span class="op" id="7593628">,</span>&nbsp;<span class="ident" id="7593630">netstr</span><span class="op" id="7593636">[</span><span class="num" id="7593637">0</span><span class="op" id="7593638">]</span><span class="op" id="7593639">,</span>&nbsp;<span class="ident" id="7593641">tt</span><span class="op" id="7593643">.</span><span class="ident" id="7593644">addr1</span><span class="op" id="7593649">,</span>&nbsp;<span class="ident" id="7593651">tt</span><span class="op" id="7593653">.</span><span class="ident" id="7593654">addr2</span><span class="op" id="7593659">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7593663">c2</span><span class="op" id="7593665">.</span><span class="ident" id="7593666">LocalAddr</span><span class="op" id="7593675">(</span><span class="op" id="7593676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7593680">c2</span><span class="op" id="7593682">.</span><span class="ident" id="7593683">SetDeadline</span><span class="op" id="7593694">(</span><span class="ident" id="7593695">time</span><span class="op" id="7593699">.</span><span class="ident" id="7593700">Now</span><span class="op" id="7593703">(</span><span class="op" id="7593704">)</span><span class="op" id="7593705">.</span><span class="ident" id="7593706">Add</span><span class="op" id="7593709">(</span><span class="num" id="7593710">100</span>&nbsp;<span class="op" id="7593714">*</span>&nbsp;<span class="ident" id="7593716">time</span><span class="op" id="7593720">.</span><span class="ident" id="7593721">Millisecond</span><span class="op" id="7593732">)</span><span class="op" id="7593733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7593737">c2</span><span class="op" id="7593739">.</span><span class="ident" id="7593740">SetReadDeadline</span><span class="op" id="7593755">(</span><span class="ident" id="7593756">time</span><span class="op" id="7593760">.</span><span class="ident" id="7593761">Now</span><span class="op" id="7593764">(</span><span class="op" id="7593765">)</span><span class="op" id="7593766">.</span><span class="ident" id="7593767">Add</span><span class="op" id="7593770">(</span><span class="num" id="7593771">100</span>&nbsp;<span class="op" id="7593775">*</span>&nbsp;<span class="ident" id="7593777">time</span><span class="op" id="7593781">.</span><span class="ident" id="7593782">Millisecond</span><span class="op" id="7593793">)</span><span class="op" id="7593794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7593798">c2</span><span class="op" id="7593800">.</span><span class="ident" id="7593801">SetWriteDeadline</span><span class="op" id="7593817">(</span><span class="ident" id="7593818">time</span><span class="op" id="7593822">.</span><span class="ident" id="7593823">Now</span><span class="op" id="7593826">(</span><span class="op" id="7593827">)</span><span class="op" id="7593828">.</span><span class="ident" id="7593829">Add</span><span class="op" id="7593832">(</span><span class="num" id="7593833">100</span>&nbsp;<span class="op" id="7593837">*</span>&nbsp;<span class="ident" id="7593839">time</span><span class="op" id="7593843">.</span><span class="ident" id="7593844">Millisecond</span><span class="op" id="7593855">)</span><span class="op" id="7593856">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7593861">if</span>&nbsp;<span class="ident" id="7593864">_</span><span class="op" id="7593865">,</span>&nbsp;<span class="ident" id="7593867">err</span>&nbsp;<span class="op" id="7593871">:=</span>&nbsp;<span class="ident" id="7593874">c1</span><span class="op" id="7593876">.</span><span class="ident" id="7593877">WriteTo</span><span class="op" id="7593884">(</span><span class="ident" id="7593885">wb</span><span class="op" id="7593887">,</span>&nbsp;<span class="ident" id="7593889">c2</span><span class="op" id="7593891">.</span><span class="ident" id="7593892">LocalAddr</span><span class="op" id="7593901">(</span><span class="op" id="7593902">)</span><span class="op" id="7593903">)</span><span class="op" id="7593904">;</span>&nbsp;<span class="ident" id="7593906">err</span>&nbsp;<span class="op" id="7593910">!=</span>&nbsp;<span class="ident" id="7593913">nil</span>&nbsp;<span class="op" id="7593917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7593922">t</span><span class="op" id="7593923">.</span><span class="ident" id="7593924">Fatalf</span><span class="op" id="7593930">(</span><span class="string" id="7593931">&#34;PacketConn.WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7593962">,</span>&nbsp;<span class="ident" id="7593964">err</span><span class="op" id="7593967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7593971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7593975">rb2</span>&nbsp;<span class="op" id="7593979">:=</span>&nbsp;<span class="builtinfunc" id="7593982">make</span><span class="op" id="7593986">(</span><span class="op" id="7593987">[</span><span class="op" id="7593988">]</span><span class="builtintype" id="7593989">byte</span><span class="op" id="7593993">,</span>&nbsp;<span class="num" id="7593995">128</span><span class="op" id="7593998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7594002">if</span>&nbsp;<span class="ident" id="7594005">_</span><span class="op" id="7594006">,</span>&nbsp;<span class="ident" id="7594008">_</span><span class="op" id="7594009">,</span>&nbsp;<span class="ident" id="7594011">err</span>&nbsp;<span class="op" id="7594015">:=</span>&nbsp;<span class="ident" id="7594018">c2</span><span class="op" id="7594020">.</span><span class="ident" id="7594021">ReadFrom</span><span class="op" id="7594029">(</span><span class="ident" id="7594030">rb2</span><span class="op" id="7594033">)</span><span class="op" id="7594034">;</span>&nbsp;<span class="ident" id="7594036">err</span>&nbsp;<span class="op" id="7594040">!=</span>&nbsp;<span class="ident" id="7594043">nil</span>&nbsp;<span class="op" id="7594047">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7594052">t</span><span class="op" id="7594053">.</span><span class="ident" id="7594054">Fatalf</span><span class="op" id="7594060">(</span><span class="string" id="7594061">&#34;PacketConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7594093">,</span>&nbsp;<span class="ident" id="7594095">err</span><span class="op" id="7594098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7594102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7594106">if</span>&nbsp;<span class="ident" id="7594109">_</span><span class="op" id="7594110">,</span>&nbsp;<span class="ident" id="7594112">err</span>&nbsp;<span class="op" id="7594116">:=</span>&nbsp;<span class="ident" id="7594119">c2</span><span class="op" id="7594121">.</span><span class="ident" id="7594122">WriteTo</span><span class="op" id="7594129">(</span><span class="ident" id="7594130">wb</span><span class="op" id="7594132">,</span>&nbsp;<span class="ident" id="7594134">c1</span><span class="op" id="7594136">.</span><span class="ident" id="7594137">LocalAddr</span><span class="op" id="7594146">(</span><span class="op" id="7594147">)</span><span class="op" id="7594148">)</span><span class="op" id="7594149">;</span>&nbsp;<span class="ident" id="7594151">err</span>&nbsp;<span class="op" id="7594155">!=</span>&nbsp;<span class="ident" id="7594158">nil</span>&nbsp;<span class="op" id="7594162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7594167">t</span><span class="op" id="7594168">.</span><span class="ident" id="7594169">Fatalf</span><span class="op" id="7594175">(</span><span class="string" id="7594176">&#34;PacketConn.WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7594207">,</span>&nbsp;<span class="ident" id="7594209">err</span><span class="op" id="7594212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7594216">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7594220">rb1</span>&nbsp;<span class="op" id="7594224">:=</span>&nbsp;<span class="builtinfunc" id="7594227">make</span><span class="op" id="7594231">(</span><span class="op" id="7594232">[</span><span class="op" id="7594233">]</span><span class="builtintype" id="7594234">byte</span><span class="op" id="7594238">,</span>&nbsp;<span class="num" id="7594240">128</span><span class="op" id="7594243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7594247">if</span>&nbsp;<span class="ident" id="7594250">_</span><span class="op" id="7594251">,</span>&nbsp;<span class="ident" id="7594253">_</span><span class="op" id="7594254">,</span>&nbsp;<span class="ident" id="7594256">err</span>&nbsp;<span class="op" id="7594260">:=</span>&nbsp;<span class="ident" id="7594263">c1</span><span class="op" id="7594265">.</span><span class="ident" id="7594266">ReadFrom</span><span class="op" id="7594274">(</span><span class="ident" id="7594275">rb1</span><span class="op" id="7594278">)</span><span class="op" id="7594279">;</span>&nbsp;<span class="ident" id="7594281">err</span>&nbsp;<span class="op" id="7594285">!=</span>&nbsp;<span class="ident" id="7594288">nil</span>&nbsp;<span class="op" id="7594292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7594297">t</span><span class="op" id="7594298">.</span><span class="ident" id="7594299">Fatalf</span><span class="op" id="7594305">(</span><span class="string" id="7594306">&#34;PacketConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7594338">,</span>&nbsp;<span class="ident" id="7594340">err</span><span class="op" id="7594343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7594347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7594350">}</span><br>
<span class="lineno">120</span><span class="op" id="7594352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7594355">func</span>&nbsp;<span class="ident" id="7594360">TestConnAndPacketConn</span><span class="op" id="7594381">(</span><span class="ident" id="7594382">t</span>&nbsp;<span class="op" id="7594384">*</span><span class="ident" id="7594385">testing</span><span class="op" id="7594392">.</span><span class="ident" id="7594393">T</span><span class="op" id="7594394">)</span>&nbsp;<span class="op" id="7594396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7594399">closer</span>&nbsp;<span class="op" id="7594406">:=</span>&nbsp;<span class="keyword" id="7594409">func</span><span class="op" id="7594413">(</span><span class="ident" id="7594414">c</span>&nbsp;<span class="ident" id="7594416">PacketConn</span><span class="op" id="7594426">,</span>&nbsp;<span class="ident" id="7594428">net</span><span class="op" id="7594431">,</span>&nbsp;<span class="ident" id="7594433">addr1</span><span class="op" id="7594438">,</span>&nbsp;<span class="ident" id="7594440">addr2</span>&nbsp;<span class="builtintype" id="7594446">string</span><span class="op" id="7594452">)</span>&nbsp;<span class="op" id="7594454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7594458">c</span><span class="op" id="7594459">.</span><span class="ident" id="7594460">Close</span><span class="op" id="7594465">(</span><span class="op" id="7594466">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7594470">switch</span>&nbsp;<span class="ident" id="7594477">net</span>&nbsp;<span class="op" id="7594481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7594485">case</span>&nbsp;<span class="string" id="7594490">&#34;unixgram&#34;</span><span class="op" id="7594500">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7594505">os</span><span class="op" id="7594507">.</span><span class="ident" id="7594508">Remove</span><span class="op" id="7594514">(</span><span class="ident" id="7594515">addr1</span><span class="op" id="7594520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7594525">os</span><span class="op" id="7594527">.</span><span class="ident" id="7594528">Remove</span><span class="op" id="7594534">(</span><span class="ident" id="7594535">addr2</span><span class="op" id="7594540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7594544">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7594547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7594551">for</span>&nbsp;<span class="ident" id="7594555">i</span><span class="op" id="7594556">,</span>&nbsp;<span class="ident" id="7594558">tt</span>&nbsp;<span class="op" id="7594561">:=</span>&nbsp;<span class="keyword" id="7594564">range</span>&nbsp;<span class="ident" id="7594570">packetConnTests</span>&nbsp;<span class="op" id="7594586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7594590">var</span>&nbsp;<span class="ident" id="7594594">wb</span>&nbsp;<span class="op" id="7594597">[</span><span class="op" id="7594598">]</span><span class="builtintype" id="7594599">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7594606">netstr</span>&nbsp;<span class="op" id="7594613">:=</span>&nbsp;<span class="ident" id="7594616">strings</span><span class="op" id="7594623">.</span><span class="ident" id="7594624">Split</span><span class="op" id="7594629">(</span><span class="ident" id="7594630">tt</span><span class="op" id="7594632">.</span><span class="ident" id="7594633">net</span><span class="op" id="7594636">,</span>&nbsp;<span class="string" id="7594638">&#34;:&#34;</span><span class="op" id="7594641">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7594645">wb</span><span class="op" id="7594647">,</span>&nbsp;<span class="ident" id="7594649">skipOrFatalFn</span>&nbsp;<span class="op" id="7594663">:=</span>&nbsp;<span class="ident" id="7594666">packetConnTestData</span><span class="op" id="7594684">(</span><span class="ident" id="7594685">t</span><span class="op" id="7594686">,</span>&nbsp;<span class="ident" id="7594688">netstr</span><span class="op" id="7594694">[</span><span class="num" id="7594695">0</span><span class="op" id="7594696">]</span><span class="op" id="7594697">,</span>&nbsp;<span class="ident" id="7594699">i</span><span class="op" id="7594700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7594704">if</span>&nbsp;<span class="ident" id="7594707">skipOrFatalFn</span>&nbsp;<span class="op" id="7594721">!=</span>&nbsp;<span class="ident" id="7594724">nil</span>&nbsp;<span class="op" id="7594728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7594733">skipOrFatalFn</span><span class="op" id="7594746">(</span><span class="op" id="7594747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7594752">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7594763">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7594768">c1</span><span class="op" id="7594770">,</span>&nbsp;<span class="ident" id="7594772">err</span>&nbsp;<span class="op" id="7594776">:=</span>&nbsp;<span class="ident" id="7594779">ListenPacket</span><span class="op" id="7594791">(</span><span class="ident" id="7594792">tt</span><span class="op" id="7594794">.</span><span class="ident" id="7594795">net</span><span class="op" id="7594798">,</span>&nbsp;<span class="ident" id="7594800">tt</span><span class="op" id="7594802">.</span><span class="ident" id="7594803">addr1</span><span class="op" id="7594808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7594812">if</span>&nbsp;<span class="ident" id="7594815">err</span>&nbsp;<span class="op" id="7594819">!=</span>&nbsp;<span class="ident" id="7594822">nil</span>&nbsp;<span class="op" id="7594826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7594831">t</span><span class="op" id="7594832">.</span><span class="ident" id="7594833">Fatalf</span><span class="op" id="7594839">(</span><span class="string" id="7594840">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7594865">,</span>&nbsp;<span class="ident" id="7594867">err</span><span class="op" id="7594870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7594874">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7594878">defer</span>&nbsp;<span class="ident" id="7594884">closer</span><span class="op" id="7594890">(</span><span class="ident" id="7594891">c1</span><span class="op" id="7594893">,</span>&nbsp;<span class="ident" id="7594895">netstr</span><span class="op" id="7594901">[</span><span class="num" id="7594902">0</span><span class="op" id="7594903">]</span><span class="op" id="7594904">,</span>&nbsp;<span class="ident" id="7594906">tt</span><span class="op" id="7594908">.</span><span class="ident" id="7594909">addr1</span><span class="op" id="7594914">,</span>&nbsp;<span class="ident" id="7594916">tt</span><span class="op" id="7594918">.</span><span class="ident" id="7594919">addr2</span><span class="op" id="7594924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7594928">c1</span><span class="op" id="7594930">.</span><span class="ident" id="7594931">LocalAddr</span><span class="op" id="7594940">(</span><span class="op" id="7594941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7594945">c1</span><span class="op" id="7594947">.</span><span class="ident" id="7594948">SetDeadline</span><span class="op" id="7594959">(</span><span class="ident" id="7594960">time</span><span class="op" id="7594964">.</span><span class="ident" id="7594965">Now</span><span class="op" id="7594968">(</span><span class="op" id="7594969">)</span><span class="op" id="7594970">.</span><span class="ident" id="7594971">Add</span><span class="op" id="7594974">(</span><span class="num" id="7594975">100</span>&nbsp;<span class="op" id="7594979">*</span>&nbsp;<span class="ident" id="7594981">time</span><span class="op" id="7594985">.</span><span class="ident" id="7594986">Millisecond</span><span class="op" id="7594997">)</span><span class="op" id="7594998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7595002">c1</span><span class="op" id="7595004">.</span><span class="ident" id="7595005">SetReadDeadline</span><span class="op" id="7595020">(</span><span class="ident" id="7595021">time</span><span class="op" id="7595025">.</span><span class="ident" id="7595026">Now</span><span class="op" id="7595029">(</span><span class="op" id="7595030">)</span><span class="op" id="7595031">.</span><span class="ident" id="7595032">Add</span><span class="op" id="7595035">(</span><span class="num" id="7595036">100</span>&nbsp;<span class="op" id="7595040">*</span>&nbsp;<span class="ident" id="7595042">time</span><span class="op" id="7595046">.</span><span class="ident" id="7595047">Millisecond</span><span class="op" id="7595058">)</span><span class="op" id="7595059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7595063">c1</span><span class="op" id="7595065">.</span><span class="ident" id="7595066">SetWriteDeadline</span><span class="op" id="7595082">(</span><span class="ident" id="7595083">time</span><span class="op" id="7595087">.</span><span class="ident" id="7595088">Now</span><span class="op" id="7595091">(</span><span class="op" id="7595092">)</span><span class="op" id="7595093">.</span><span class="ident" id="7595094">Add</span><span class="op" id="7595097">(</span><span class="num" id="7595098">100</span>&nbsp;<span class="op" id="7595102">*</span>&nbsp;<span class="ident" id="7595104">time</span><span class="op" id="7595108">.</span><span class="ident" id="7595109">Millisecond</span><span class="op" id="7595120">)</span><span class="op" id="7595121">)</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7595126">c2</span><span class="op" id="7595128">,</span>&nbsp;<span class="ident" id="7595130">err</span>&nbsp;<span class="op" id="7595134">:=</span>&nbsp;<span class="ident" id="7595137">Dial</span><span class="op" id="7595141">(</span><span class="ident" id="7595142">tt</span><span class="op" id="7595144">.</span><span class="ident" id="7595145">net</span><span class="op" id="7595148">,</span>&nbsp;<span class="ident" id="7595150">c1</span><span class="op" id="7595152">.</span><span class="ident" id="7595153">LocalAddr</span><span class="op" id="7595162">(</span><span class="op" id="7595163">)</span><span class="op" id="7595164">.</span><span class="ident" id="7595165">String</span><span class="op" id="7595171">(</span><span class="op" id="7595172">)</span><span class="op" id="7595173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7595177">if</span>&nbsp;<span class="ident" id="7595180">err</span>&nbsp;<span class="op" id="7595184">!=</span>&nbsp;<span class="ident" id="7595187">nil</span>&nbsp;<span class="op" id="7595191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7595196">t</span><span class="op" id="7595197">.</span><span class="ident" id="7595198">Fatalf</span><span class="op" id="7595204">(</span><span class="string" id="7595205">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7595222">,</span>&nbsp;<span class="ident" id="7595224">err</span><span class="op" id="7595227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7595231">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7595235">defer</span>&nbsp;<span class="ident" id="7595241">c2</span><span class="op" id="7595243">.</span><span class="ident" id="7595244">Close</span><span class="op" id="7595249">(</span><span class="op" id="7595250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7595254">c2</span><span class="op" id="7595256">.</span><span class="ident" id="7595257">LocalAddr</span><span class="op" id="7595266">(</span><span class="op" id="7595267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7595271">c2</span><span class="op" id="7595273">.</span><span class="ident" id="7595274">RemoteAddr</span><span class="op" id="7595284">(</span><span class="op" id="7595285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7595289">c2</span><span class="op" id="7595291">.</span><span class="ident" id="7595292">SetDeadline</span><span class="op" id="7595303">(</span><span class="ident" id="7595304">time</span><span class="op" id="7595308">.</span><span class="ident" id="7595309">Now</span><span class="op" id="7595312">(</span><span class="op" id="7595313">)</span><span class="op" id="7595314">.</span><span class="ident" id="7595315">Add</span><span class="op" id="7595318">(</span><span class="num" id="7595319">100</span>&nbsp;<span class="op" id="7595323">*</span>&nbsp;<span class="ident" id="7595325">time</span><span class="op" id="7595329">.</span><span class="ident" id="7595330">Millisecond</span><span class="op" id="7595341">)</span><span class="op" id="7595342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7595346">c2</span><span class="op" id="7595348">.</span><span class="ident" id="7595349">SetReadDeadline</span><span class="op" id="7595364">(</span><span class="ident" id="7595365">time</span><span class="op" id="7595369">.</span><span class="ident" id="7595370">Now</span><span class="op" id="7595373">(</span><span class="op" id="7595374">)</span><span class="op" id="7595375">.</span><span class="ident" id="7595376">Add</span><span class="op" id="7595379">(</span><span class="num" id="7595380">100</span>&nbsp;<span class="op" id="7595384">*</span>&nbsp;<span class="ident" id="7595386">time</span><span class="op" id="7595390">.</span><span class="ident" id="7595391">Millisecond</span><span class="op" id="7595402">)</span><span class="op" id="7595403">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7595407">c2</span><span class="op" id="7595409">.</span><span class="ident" id="7595410">SetWriteDeadline</span><span class="op" id="7595426">(</span><span class="ident" id="7595427">time</span><span class="op" id="7595431">.</span><span class="ident" id="7595432">Now</span><span class="op" id="7595435">(</span><span class="op" id="7595436">)</span><span class="op" id="7595437">.</span><span class="ident" id="7595438">Add</span><span class="op" id="7595441">(</span><span class="num" id="7595442">100</span>&nbsp;<span class="op" id="7595446">*</span>&nbsp;<span class="ident" id="7595448">time</span><span class="op" id="7595452">.</span><span class="ident" id="7595453">Millisecond</span><span class="op" id="7595464">)</span><span class="op" id="7595465">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7595470">if</span>&nbsp;<span class="ident" id="7595473">_</span><span class="op" id="7595474">,</span>&nbsp;<span class="ident" id="7595476">err</span>&nbsp;<span class="op" id="7595480">:=</span>&nbsp;<span class="ident" id="7595483">c2</span><span class="op" id="7595485">.</span><span class="ident" id="7595486">Write</span><span class="op" id="7595491">(</span><span class="ident" id="7595492">wb</span><span class="op" id="7595494">)</span><span class="op" id="7595495">;</span>&nbsp;<span class="ident" id="7595497">err</span>&nbsp;<span class="op" id="7595501">!=</span>&nbsp;<span class="ident" id="7595504">nil</span>&nbsp;<span class="op" id="7595508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7595513">t</span><span class="op" id="7595514">.</span><span class="ident" id="7595515">Fatalf</span><span class="op" id="7595521">(</span><span class="string" id="7595522">&#34;Conn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7595545">,</span>&nbsp;<span class="ident" id="7595547">err</span><span class="op" id="7595550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7595554">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7595558">rb1</span>&nbsp;<span class="op" id="7595562">:=</span>&nbsp;<span class="builtinfunc" id="7595565">make</span><span class="op" id="7595569">(</span><span class="op" id="7595570">[</span><span class="op" id="7595571">]</span><span class="builtintype" id="7595572">byte</span><span class="op" id="7595576">,</span>&nbsp;<span class="num" id="7595578">128</span><span class="op" id="7595581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7595585">if</span>&nbsp;<span class="ident" id="7595588">_</span><span class="op" id="7595589">,</span>&nbsp;<span class="ident" id="7595591">_</span><span class="op" id="7595592">,</span>&nbsp;<span class="ident" id="7595594">err</span>&nbsp;<span class="op" id="7595598">:=</span>&nbsp;<span class="ident" id="7595601">c1</span><span class="op" id="7595603">.</span><span class="ident" id="7595604">ReadFrom</span><span class="op" id="7595612">(</span><span class="ident" id="7595613">rb1</span><span class="op" id="7595616">)</span><span class="op" id="7595617">;</span>&nbsp;<span class="ident" id="7595619">err</span>&nbsp;<span class="op" id="7595623">!=</span>&nbsp;<span class="ident" id="7595626">nil</span>&nbsp;<span class="op" id="7595630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7595635">t</span><span class="op" id="7595636">.</span><span class="ident" id="7595637">Fatalf</span><span class="op" id="7595643">(</span><span class="string" id="7595644">&#34;PacketConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7595676">,</span>&nbsp;<span class="ident" id="7595678">err</span><span class="op" id="7595681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7595685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7595689">var</span>&nbsp;<span class="ident" id="7595693">dst</span>&nbsp;<span class="ident" id="7595697">Addr</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7595704">switch</span>&nbsp;<span class="ident" id="7595711">netstr</span><span class="op" id="7595717">[</span><span class="num" id="7595718">0</span><span class="op" id="7595719">]</span>&nbsp;<span class="op" id="7595721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7595725">case</span>&nbsp;<span class="string" id="7595730">&#34;ip&#34;</span><span class="op" id="7595734">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7595739">dst</span>&nbsp;<span class="op" id="7595743">=</span>&nbsp;<span class="op" id="7595745">&amp;</span><span class="ident" id="7595746">IPAddr</span><span class="op" id="7595752">{</span><span class="ident" id="7595753">IP</span><span class="op" id="7595755">:</span>&nbsp;<span class="ident" id="7595757">IPv4</span><span class="op" id="7595761">(</span><span class="num" id="7595762">127</span><span class="op" id="7595765">,</span>&nbsp;<span class="num" id="7595767">0</span><span class="op" id="7595768">,</span>&nbsp;<span class="num" id="7595770">0</span><span class="op" id="7595771">,</span>&nbsp;<span class="num" id="7595773">1</span><span class="op" id="7595774">)</span><span class="op" id="7595775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7595779">case</span>&nbsp;<span class="string" id="7595784">&#34;unixgram&#34;</span><span class="op" id="7595794">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7595799">continue</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7595810">default</span><span class="op" id="7595817">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7595822">dst</span>&nbsp;<span class="op" id="7595826">=</span>&nbsp;<span class="ident" id="7595828">c2</span><span class="op" id="7595830">.</span><span class="ident" id="7595831">LocalAddr</span><span class="op" id="7595840">(</span><span class="op" id="7595841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7595845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7595849">if</span>&nbsp;<span class="ident" id="7595852">_</span><span class="op" id="7595853">,</span>&nbsp;<span class="ident" id="7595855">err</span>&nbsp;<span class="op" id="7595859">:=</span>&nbsp;<span class="ident" id="7595862">c1</span><span class="op" id="7595864">.</span><span class="ident" id="7595865">WriteTo</span><span class="op" id="7595872">(</span><span class="ident" id="7595873">wb</span><span class="op" id="7595875">,</span>&nbsp;<span class="ident" id="7595877">dst</span><span class="op" id="7595880">)</span><span class="op" id="7595881">;</span>&nbsp;<span class="ident" id="7595883">err</span>&nbsp;<span class="op" id="7595887">!=</span>&nbsp;<span class="ident" id="7595890">nil</span>&nbsp;<span class="op" id="7595894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7595899">t</span><span class="op" id="7595900">.</span><span class="ident" id="7595901">Fatalf</span><span class="op" id="7595907">(</span><span class="string" id="7595908">&#34;PacketConn.WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7595939">,</span>&nbsp;<span class="ident" id="7595941">err</span><span class="op" id="7595944">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7595948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7595952">rb2</span>&nbsp;<span class="op" id="7595956">:=</span>&nbsp;<span class="builtinfunc" id="7595959">make</span><span class="op" id="7595963">(</span><span class="op" id="7595964">[</span><span class="op" id="7595965">]</span><span class="builtintype" id="7595966">byte</span><span class="op" id="7595970">,</span>&nbsp;<span class="num" id="7595972">128</span><span class="op" id="7595975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7595979">if</span>&nbsp;<span class="ident" id="7595982">_</span><span class="op" id="7595983">,</span>&nbsp;<span class="ident" id="7595985">err</span>&nbsp;<span class="op" id="7595989">:=</span>&nbsp;<span class="ident" id="7595992">c2</span><span class="op" id="7595994">.</span><span class="ident" id="7595995">Read</span><span class="op" id="7595999">(</span><span class="ident" id="7596000">rb2</span><span class="op" id="7596003">)</span><span class="op" id="7596004">;</span>&nbsp;<span class="ident" id="7596006">err</span>&nbsp;<span class="op" id="7596010">!=</span>&nbsp;<span class="ident" id="7596013">nil</span>&nbsp;<span class="op" id="7596017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7596022">t</span><span class="op" id="7596023">.</span><span class="ident" id="7596024">Fatalf</span><span class="op" id="7596030">(</span><span class="string" id="7596031">&#34;Conn.Read&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7596053">,</span>&nbsp;<span class="ident" id="7596055">err</span><span class="op" id="7596058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7596062">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7596065">}</span><br>
<span class="lineno"></span><span class="op" id="7596067">}</span>
</div>
</body>
</html>
