<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/gzip</h2>
<ul>
<li><a href="/gostd/compress/gzip/gunzip.go.html">gunzip.go</a></li>
<li><a href="/gostd/compress/gzip/gunzip_test.go.html">gunzip_test.go</a></li>
<li><a href="/gostd/compress/gzip/gzip.go.html">gzip.go</a></li>
<li><a href="/gostd/compress/gzip/gzip_test.go.html" class="current">gzip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6904963">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6905018">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6905072">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6905123">package</span>&nbsp;<span class="ident" id="6905131">gzip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6905137">import</span>&nbsp;<span class="op" id="6905144">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6905147">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6905156">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6905165">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6905178">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6905189">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6905196">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="6905199">//&nbsp;TestEmpty&nbsp;tests&nbsp;that&nbsp;an&nbsp;empty&nbsp;payload&nbsp;still&nbsp;forms&nbsp;a&nbsp;valid&nbsp;GZIP&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="6905273">func</span>&nbsp;<span class="ident" id="6905278">TestEmpty</span><span class="op" id="6905287">(</span><span class="ident" id="6905288">t</span>&nbsp;<span class="op" id="6905290">*</span><span class="ident" id="6905291">testing</span><span class="op" id="6905298">.</span><span class="ident" id="6905299">T</span><span class="op" id="6905300">)</span>&nbsp;<span class="op" id="6905302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6905305">buf</span>&nbsp;<span class="op" id="6905309">:=</span>&nbsp;<span class="builtinfunc" id="6905312">new</span><span class="op" id="6905315">(</span><span class="ident" id="6905316">bytes</span><span class="op" id="6905321">.</span><span class="ident" id="6905322">Buffer</span><span class="op" id="6905328">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6905332">if</span>&nbsp;<span class="ident" id="6905335">err</span>&nbsp;<span class="op" id="6905339">:=</span>&nbsp;<span class="ident" id="6905342">NewWriter</span><span class="op" id="6905351">(</span><span class="ident" id="6905352">buf</span><span class="op" id="6905355">)</span><span class="op" id="6905356">.</span><span class="ident" id="6905357">Close</span><span class="op" id="6905362">(</span><span class="op" id="6905363">)</span><span class="op" id="6905364">;</span>&nbsp;<span class="ident" id="6905366">err</span>&nbsp;<span class="op" id="6905370">!=</span>&nbsp;<span class="ident" id="6905373">nil</span>&nbsp;<span class="op" id="6905377">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6905381">t</span><span class="op" id="6905382">.</span><span class="ident" id="6905383">Fatalf</span><span class="op" id="6905389">(</span><span class="string" id="6905390">&#34;Writer.Close:&nbsp;%v&#34;</span><span class="op" id="6905408">,</span>&nbsp;<span class="ident" id="6905410">err</span><span class="op" id="6905413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6905416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6905420">r</span><span class="op" id="6905421">,</span>&nbsp;<span class="ident" id="6905423">err</span>&nbsp;<span class="op" id="6905427">:=</span>&nbsp;<span class="ident" id="6905430">NewReader</span><span class="op" id="6905439">(</span><span class="ident" id="6905440">buf</span><span class="op" id="6905443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6905446">if</span>&nbsp;<span class="ident" id="6905449">err</span>&nbsp;<span class="op" id="6905453">!=</span>&nbsp;<span class="ident" id="6905456">nil</span>&nbsp;<span class="op" id="6905460">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6905464">t</span><span class="op" id="6905465">.</span><span class="ident" id="6905466">Fatalf</span><span class="op" id="6905472">(</span><span class="string" id="6905473">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="6905488">,</span>&nbsp;<span class="ident" id="6905490">err</span><span class="op" id="6905493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6905496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6905499">b</span><span class="op" id="6905500">,</span>&nbsp;<span class="ident" id="6905502">err</span>&nbsp;<span class="op" id="6905506">:=</span>&nbsp;<span class="ident" id="6905509">ioutil</span><span class="op" id="6905515">.</span><span class="ident" id="6905516">ReadAll</span><span class="op" id="6905523">(</span><span class="ident" id="6905524">r</span><span class="op" id="6905525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6905528">if</span>&nbsp;<span class="ident" id="6905531">err</span>&nbsp;<span class="op" id="6905535">!=</span>&nbsp;<span class="ident" id="6905538">nil</span>&nbsp;<span class="op" id="6905542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6905546">t</span><span class="op" id="6905547">.</span><span class="ident" id="6905548">Fatalf</span><span class="op" id="6905554">(</span><span class="string" id="6905555">&#34;ReadAll:&nbsp;%v&#34;</span><span class="op" id="6905568">,</span>&nbsp;<span class="ident" id="6905570">err</span><span class="op" id="6905573">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6905576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6905579">if</span>&nbsp;<span class="builtinfunc" id="6905582">len</span><span class="op" id="6905585">(</span><span class="ident" id="6905586">b</span><span class="op" id="6905587">)</span>&nbsp;<span class="op" id="6905589">!=</span>&nbsp;<span class="num" id="6905592">0</span>&nbsp;<span class="op" id="6905594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6905598">t</span><span class="op" id="6905599">.</span><span class="ident" id="6905600">Fatalf</span><span class="op" id="6905606">(</span><span class="string" id="6905607">&#34;got&nbsp;%d&nbsp;bytes,&nbsp;want&nbsp;0&#34;</span><span class="op" id="6905629">,</span>&nbsp;<span class="builtinfunc" id="6905631">len</span><span class="op" id="6905634">(</span><span class="ident" id="6905635">b</span><span class="op" id="6905636">)</span><span class="op" id="6905637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6905640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6905643">if</span>&nbsp;<span class="ident" id="6905646">err</span>&nbsp;<span class="op" id="6905650">:=</span>&nbsp;<span class="ident" id="6905653">r</span><span class="op" id="6905654">.</span><span class="ident" id="6905655">Close</span><span class="op" id="6905660">(</span><span class="op" id="6905661">)</span><span class="op" id="6905662">;</span>&nbsp;<span class="ident" id="6905664">err</span>&nbsp;<span class="op" id="6905668">!=</span>&nbsp;<span class="ident" id="6905671">nil</span>&nbsp;<span class="op" id="6905675">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6905679">t</span><span class="op" id="6905680">.</span><span class="ident" id="6905681">Fatalf</span><span class="op" id="6905687">(</span><span class="string" id="6905688">&#34;Reader.Close:&nbsp;%v&#34;</span><span class="op" id="6905706">,</span>&nbsp;<span class="ident" id="6905708">err</span><span class="op" id="6905711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6905714">}</span><br>
<span class="lineno"></span><span class="op" id="6905716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6905719">//&nbsp;TestRoundTrip&nbsp;tests&nbsp;that&nbsp;gzipping&nbsp;and&nbsp;then&nbsp;gunzipping&nbsp;is&nbsp;the&nbsp;identity</span><br>
<span class="lineno">40</span><span class="comment" id="6905792">//&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="6905805">func</span>&nbsp;<span class="ident" id="6905810">TestRoundTrip</span><span class="op" id="6905823">(</span><span class="ident" id="6905824">t</span>&nbsp;<span class="op" id="6905826">*</span><span class="ident" id="6905827">testing</span><span class="op" id="6905834">.</span><span class="ident" id="6905835">T</span><span class="op" id="6905836">)</span>&nbsp;<span class="op" id="6905838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6905841">buf</span>&nbsp;<span class="op" id="6905845">:=</span>&nbsp;<span class="builtinfunc" id="6905848">new</span><span class="op" id="6905851">(</span><span class="ident" id="6905852">bytes</span><span class="op" id="6905857">.</span><span class="ident" id="6905858">Buffer</span><span class="op" id="6905864">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6905868">w</span>&nbsp;<span class="op" id="6905870">:=</span>&nbsp;<span class="ident" id="6905873">NewWriter</span><span class="op" id="6905882">(</span><span class="ident" id="6905883">buf</span><span class="op" id="6905886">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6905889">w</span><span class="op" id="6905890">.</span><span class="ident" id="6905891">Comment</span>&nbsp;<span class="op" id="6905899">=</span>&nbsp;<span class="string" id="6905901">&#34;comment&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6905912">w</span><span class="op" id="6905913">.</span><span class="ident" id="6905914">Extra</span>&nbsp;<span class="op" id="6905920">=</span>&nbsp;<span class="op" id="6905922">[</span><span class="op" id="6905923">]</span><span class="builtintype" id="6905924">byte</span><span class="op" id="6905928">(</span><span class="string" id="6905929">&#34;extra&#34;</span><span class="op" id="6905936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6905939">w</span><span class="op" id="6905940">.</span><span class="ident" id="6905941">ModTime</span>&nbsp;<span class="op" id="6905949">=</span>&nbsp;<span class="ident" id="6905951">time</span><span class="op" id="6905955">.</span><span class="ident" id="6905956">Unix</span><span class="op" id="6905960">(</span><span class="num" id="6905961">1e8</span><span class="op" id="6905964">,</span>&nbsp;<span class="num" id="6905966">0</span><span class="op" id="6905967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6905970">w</span><span class="op" id="6905971">.</span><span class="ident" id="6905972">Name</span>&nbsp;<span class="op" id="6905977">=</span>&nbsp;<span class="string" id="6905979">&#34;name&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6905987">if</span>&nbsp;<span class="ident" id="6905990">_</span><span class="op" id="6905991">,</span>&nbsp;<span class="ident" id="6905993">err</span>&nbsp;<span class="op" id="6905997">:=</span>&nbsp;<span class="ident" id="6906000">w</span><span class="op" id="6906001">.</span><span class="ident" id="6906002">Write</span><span class="op" id="6906007">(</span><span class="op" id="6906008">[</span><span class="op" id="6906009">]</span><span class="builtintype" id="6906010">byte</span><span class="op" id="6906014">(</span><span class="string" id="6906015">&#34;payload&#34;</span><span class="op" id="6906024">)</span><span class="op" id="6906025">)</span><span class="op" id="6906026">;</span>&nbsp;<span class="ident" id="6906028">err</span>&nbsp;<span class="op" id="6906032">!=</span>&nbsp;<span class="ident" id="6906035">nil</span>&nbsp;<span class="op" id="6906039">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6906043">t</span><span class="op" id="6906044">.</span><span class="ident" id="6906045">Fatalf</span><span class="op" id="6906051">(</span><span class="string" id="6906052">&#34;Write:&nbsp;%v&#34;</span><span class="op" id="6906063">,</span>&nbsp;<span class="ident" id="6906065">err</span><span class="op" id="6906068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6906071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6906074">if</span>&nbsp;<span class="ident" id="6906077">err</span>&nbsp;<span class="op" id="6906081">:=</span>&nbsp;<span class="ident" id="6906084">w</span><span class="op" id="6906085">.</span><span class="ident" id="6906086">Close</span><span class="op" id="6906091">(</span><span class="op" id="6906092">)</span><span class="op" id="6906093">;</span>&nbsp;<span class="ident" id="6906095">err</span>&nbsp;<span class="op" id="6906099">!=</span>&nbsp;<span class="ident" id="6906102">nil</span>&nbsp;<span class="op" id="6906106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6906110">t</span><span class="op" id="6906111">.</span><span class="ident" id="6906112">Fatalf</span><span class="op" id="6906118">(</span><span class="string" id="6906119">&#34;Writer.Close:&nbsp;%v&#34;</span><span class="op" id="6906137">,</span>&nbsp;<span class="ident" id="6906139">err</span><span class="op" id="6906142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6906145">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6906149">r</span><span class="op" id="6906150">,</span>&nbsp;<span class="ident" id="6906152">err</span>&nbsp;<span class="op" id="6906156">:=</span>&nbsp;<span class="ident" id="6906159">NewReader</span><span class="op" id="6906168">(</span><span class="ident" id="6906169">buf</span><span class="op" id="6906172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6906175">if</span>&nbsp;<span class="ident" id="6906178">err</span>&nbsp;<span class="op" id="6906182">!=</span>&nbsp;<span class="ident" id="6906185">nil</span>&nbsp;<span class="op" id="6906189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6906193">t</span><span class="op" id="6906194">.</span><span class="ident" id="6906195">Fatalf</span><span class="op" id="6906201">(</span><span class="string" id="6906202">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="6906217">,</span>&nbsp;<span class="ident" id="6906219">err</span><span class="op" id="6906222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6906225">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6906228">b</span><span class="op" id="6906229">,</span>&nbsp;<span class="ident" id="6906231">err</span>&nbsp;<span class="op" id="6906235">:=</span>&nbsp;<span class="ident" id="6906238">ioutil</span><span class="op" id="6906244">.</span><span class="ident" id="6906245">ReadAll</span><span class="op" id="6906252">(</span><span class="ident" id="6906253">r</span><span class="op" id="6906254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6906257">if</span>&nbsp;<span class="ident" id="6906260">err</span>&nbsp;<span class="op" id="6906264">!=</span>&nbsp;<span class="ident" id="6906267">nil</span>&nbsp;<span class="op" id="6906271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6906275">t</span><span class="op" id="6906276">.</span><span class="ident" id="6906277">Fatalf</span><span class="op" id="6906283">(</span><span class="string" id="6906284">&#34;ReadAll:&nbsp;%v&#34;</span><span class="op" id="6906297">,</span>&nbsp;<span class="ident" id="6906299">err</span><span class="op" id="6906302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6906305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6906308">if</span>&nbsp;<span class="builtintype" id="6906311">string</span><span class="op" id="6906317">(</span><span class="ident" id="6906318">b</span><span class="op" id="6906319">)</span>&nbsp;<span class="op" id="6906321">!=</span>&nbsp;<span class="string" id="6906324">&#34;payload&#34;</span>&nbsp;<span class="op" id="6906334">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6906338">t</span><span class="op" id="6906339">.</span><span class="ident" id="6906340">Fatalf</span><span class="op" id="6906346">(</span><span class="string" id="6906347">&#34;payload&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6906371">,</span>&nbsp;<span class="builtintype" id="6906373">string</span><span class="op" id="6906379">(</span><span class="ident" id="6906380">b</span><span class="op" id="6906381">)</span><span class="op" id="6906382">,</span>&nbsp;<span class="string" id="6906384">&#34;payload&#34;</span><span class="op" id="6906393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6906396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6906399">if</span>&nbsp;<span class="ident" id="6906402">r</span><span class="op" id="6906403">.</span><span class="ident" id="6906404">Comment</span>&nbsp;<span class="op" id="6906412">!=</span>&nbsp;<span class="string" id="6906415">&#34;comment&#34;</span>&nbsp;<span class="op" id="6906425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6906429">t</span><span class="op" id="6906430">.</span><span class="ident" id="6906431">Fatalf</span><span class="op" id="6906437">(</span><span class="string" id="6906438">&#34;comment&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6906462">,</span>&nbsp;<span class="ident" id="6906464">r</span><span class="op" id="6906465">.</span><span class="ident" id="6906466">Comment</span><span class="op" id="6906473">,</span>&nbsp;<span class="string" id="6906475">&#34;comment&#34;</span><span class="op" id="6906484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6906487">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6906490">if</span>&nbsp;<span class="builtintype" id="6906493">string</span><span class="op" id="6906499">(</span><span class="ident" id="6906500">r</span><span class="op" id="6906501">.</span><span class="ident" id="6906502">Extra</span><span class="op" id="6906507">)</span>&nbsp;<span class="op" id="6906509">!=</span>&nbsp;<span class="string" id="6906512">&#34;extra&#34;</span>&nbsp;<span class="op" id="6906520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6906524">t</span><span class="op" id="6906525">.</span><span class="ident" id="6906526">Fatalf</span><span class="op" id="6906532">(</span><span class="string" id="6906533">&#34;extra&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6906555">,</span>&nbsp;<span class="ident" id="6906557">r</span><span class="op" id="6906558">.</span><span class="ident" id="6906559">Extra</span><span class="op" id="6906564">,</span>&nbsp;<span class="string" id="6906566">&#34;extra&#34;</span><span class="op" id="6906573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6906576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6906579">if</span>&nbsp;<span class="ident" id="6906582">r</span><span class="op" id="6906583">.</span><span class="ident" id="6906584">ModTime</span><span class="op" id="6906591">.</span><span class="ident" id="6906592">Unix</span><span class="op" id="6906596">(</span><span class="op" id="6906597">)</span>&nbsp;<span class="op" id="6906599">!=</span>&nbsp;<span class="num" id="6906602">1e8</span>&nbsp;<span class="op" id="6906606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6906610">t</span><span class="op" id="6906611">.</span><span class="ident" id="6906612">Fatalf</span><span class="op" id="6906618">(</span><span class="string" id="6906619">&#34;mtime&nbsp;is&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="6906641">,</span>&nbsp;<span class="ident" id="6906643">r</span><span class="op" id="6906644">.</span><span class="ident" id="6906645">ModTime</span><span class="op" id="6906652">.</span><span class="ident" id="6906653">Unix</span><span class="op" id="6906657">(</span><span class="op" id="6906658">)</span><span class="op" id="6906659">,</span>&nbsp;<span class="builtintype" id="6906661">uint32</span><span class="op" id="6906667">(</span><span class="num" id="6906668">1e8</span><span class="op" id="6906671">)</span><span class="op" id="6906672">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6906675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6906678">if</span>&nbsp;<span class="ident" id="6906681">r</span><span class="op" id="6906682">.</span><span class="ident" id="6906683">Name</span>&nbsp;<span class="op" id="6906688">!=</span>&nbsp;<span class="string" id="6906691">&#34;name&#34;</span>&nbsp;<span class="op" id="6906698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6906702">t</span><span class="op" id="6906703">.</span><span class="ident" id="6906704">Fatalf</span><span class="op" id="6906710">(</span><span class="string" id="6906711">&#34;name&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6906732">,</span>&nbsp;<span class="ident" id="6906734">r</span><span class="op" id="6906735">.</span><span class="ident" id="6906736">Name</span><span class="op" id="6906740">,</span>&nbsp;<span class="string" id="6906742">&#34;name&#34;</span><span class="op" id="6906748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6906751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6906754">if</span>&nbsp;<span class="ident" id="6906757">err</span>&nbsp;<span class="op" id="6906761">:=</span>&nbsp;<span class="ident" id="6906764">r</span><span class="op" id="6906765">.</span><span class="ident" id="6906766">Close</span><span class="op" id="6906771">(</span><span class="op" id="6906772">)</span><span class="op" id="6906773">;</span>&nbsp;<span class="ident" id="6906775">err</span>&nbsp;<span class="op" id="6906779">!=</span>&nbsp;<span class="ident" id="6906782">nil</span>&nbsp;<span class="op" id="6906786">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6906790">t</span><span class="op" id="6906791">.</span><span class="ident" id="6906792">Fatalf</span><span class="op" id="6906798">(</span><span class="string" id="6906799">&#34;Reader.Close:&nbsp;%v&#34;</span><span class="op" id="6906817">,</span>&nbsp;<span class="ident" id="6906819">err</span><span class="op" id="6906822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6906825">}</span><br>
<span class="lineno"></span><span class="op" id="6906827">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6906830">//&nbsp;TestLatin1&nbsp;tests&nbsp;the&nbsp;internal&nbsp;functions&nbsp;for&nbsp;converting&nbsp;to&nbsp;and&nbsp;from&nbsp;Latin-1.</span><br>
<span class="lineno">85</span><span class="keyword" id="6906909">func</span>&nbsp;<span class="ident" id="6906914">TestLatin1</span><span class="op" id="6906924">(</span><span class="ident" id="6906925">t</span>&nbsp;<span class="op" id="6906927">*</span><span class="ident" id="6906928">testing</span><span class="op" id="6906935">.</span><span class="ident" id="6906936">T</span><span class="op" id="6906937">)</span>&nbsp;<span class="op" id="6906939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6906942">latin1</span>&nbsp;<span class="op" id="6906949">:=</span>&nbsp;<span class="op" id="6906952">[</span><span class="op" id="6906953">]</span><span class="builtintype" id="6906954">byte</span><span class="op" id="6906958">{</span><span class="num" id="6906959">0xc4</span><span class="op" id="6906963">,</span>&nbsp;<span class="string" id="6906965">&#39;u&#39;</span><span class="op" id="6906968">,</span>&nbsp;<span class="num" id="6906970">0xdf</span><span class="op" id="6906974">,</span>&nbsp;<span class="string" id="6906976">&#39;e&#39;</span><span class="op" id="6906979">,</span>&nbsp;<span class="string" id="6906981">&#39;r&#39;</span><span class="op" id="6906984">,</span>&nbsp;<span class="string" id="6906986">&#39;u&#39;</span><span class="op" id="6906989">,</span>&nbsp;<span class="string" id="6906991">&#39;n&#39;</span><span class="op" id="6906994">,</span>&nbsp;<span class="string" id="6906996">&#39;g&#39;</span><span class="op" id="6906999">,</span>&nbsp;<span class="num" id="6907001">0</span><span class="op" id="6907002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6907005">utf8</span>&nbsp;<span class="op" id="6907010">:=</span>&nbsp;<span class="string" id="6907013">&#34;Äußerung&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6907027">z</span>&nbsp;<span class="op" id="6907029">:=</span>&nbsp;<span class="ident" id="6907032">Reader</span><span class="op" id="6907038">{</span><span class="ident" id="6907039">r</span><span class="op" id="6907040">:</span>&nbsp;<span class="ident" id="6907042">bufio</span><span class="op" id="6907047">.</span><span class="ident" id="6907048">NewReader</span><span class="op" id="6907057">(</span><span class="ident" id="6907058">bytes</span><span class="op" id="6907063">.</span><span class="ident" id="6907064">NewReader</span><span class="op" id="6907073">(</span><span class="ident" id="6907074">latin1</span><span class="op" id="6907080">)</span><span class="op" id="6907081">)</span><span class="op" id="6907082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6907085">s</span><span class="op" id="6907086">,</span>&nbsp;<span class="ident" id="6907088">err</span>&nbsp;<span class="op" id="6907092">:=</span>&nbsp;<span class="ident" id="6907095">z</span><span class="op" id="6907096">.</span><span class="ident" id="6907097">readString</span><span class="op" id="6907107">(</span><span class="op" id="6907108">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6907111">if</span>&nbsp;<span class="ident" id="6907114">err</span>&nbsp;<span class="op" id="6907118">!=</span>&nbsp;<span class="ident" id="6907121">nil</span>&nbsp;<span class="op" id="6907125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6907129">t</span><span class="op" id="6907130">.</span><span class="ident" id="6907131">Fatalf</span><span class="op" id="6907137">(</span><span class="string" id="6907138">&#34;readString:&nbsp;%v&#34;</span><span class="op" id="6907154">,</span>&nbsp;<span class="ident" id="6907156">err</span><span class="op" id="6907159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6907162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6907165">if</span>&nbsp;<span class="ident" id="6907168">s</span>&nbsp;<span class="op" id="6907170">!=</span>&nbsp;<span class="ident" id="6907173">utf8</span>&nbsp;<span class="op" id="6907178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6907182">t</span><span class="op" id="6907183">.</span><span class="ident" id="6907184">Fatalf</span><span class="op" id="6907190">(</span><span class="string" id="6907191">&#34;read&nbsp;latin-1:&nbsp;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6907222">,</span>&nbsp;<span class="ident" id="6907224">s</span><span class="op" id="6907225">,</span>&nbsp;<span class="ident" id="6907227">utf8</span><span class="op" id="6907231">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6907234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6907238">buf</span>&nbsp;<span class="op" id="6907242">:=</span>&nbsp;<span class="ident" id="6907245">bytes</span><span class="op" id="6907250">.</span><span class="ident" id="6907251">NewBuffer</span><span class="op" id="6907260">(</span><span class="builtinfunc" id="6907261">make</span><span class="op" id="6907265">(</span><span class="op" id="6907266">[</span><span class="op" id="6907267">]</span><span class="builtintype" id="6907268">byte</span><span class="op" id="6907272">,</span>&nbsp;<span class="num" id="6907274">0</span><span class="op" id="6907275">,</span>&nbsp;<span class="builtinfunc" id="6907277">len</span><span class="op" id="6907280">(</span><span class="ident" id="6907281">latin1</span><span class="op" id="6907287">)</span><span class="op" id="6907288">)</span><span class="op" id="6907289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6907292">c</span>&nbsp;<span class="op" id="6907294">:=</span>&nbsp;<span class="ident" id="6907297">Writer</span><span class="op" id="6907303">{</span><span class="ident" id="6907304">w</span><span class="op" id="6907305">:</span>&nbsp;<span class="ident" id="6907307">buf</span><span class="op" id="6907310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6907313">if</span>&nbsp;<span class="ident" id="6907316">err</span>&nbsp;<span class="op" id="6907320">=</span>&nbsp;<span class="ident" id="6907322">c</span><span class="op" id="6907323">.</span><span class="ident" id="6907324">writeString</span><span class="op" id="6907335">(</span><span class="ident" id="6907336">utf8</span><span class="op" id="6907340">)</span><span class="op" id="6907341">;</span>&nbsp;<span class="ident" id="6907343">err</span>&nbsp;<span class="op" id="6907347">!=</span>&nbsp;<span class="ident" id="6907350">nil</span>&nbsp;<span class="op" id="6907354">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6907358">t</span><span class="op" id="6907359">.</span><span class="ident" id="6907360">Fatalf</span><span class="op" id="6907366">(</span><span class="string" id="6907367">&#34;writeString:&nbsp;%v&#34;</span><span class="op" id="6907384">,</span>&nbsp;<span class="ident" id="6907386">err</span><span class="op" id="6907389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6907392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6907395">s</span>&nbsp;<span class="op" id="6907397">=</span>&nbsp;<span class="ident" id="6907399">buf</span><span class="op" id="6907402">.</span><span class="ident" id="6907403">String</span><span class="op" id="6907409">(</span><span class="op" id="6907410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6907413">if</span>&nbsp;<span class="ident" id="6907416">s</span>&nbsp;<span class="op" id="6907418">!=</span>&nbsp;<span class="builtintype" id="6907421">string</span><span class="op" id="6907427">(</span><span class="ident" id="6907428">latin1</span><span class="op" id="6907434">)</span>&nbsp;<span class="op" id="6907436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6907440">t</span><span class="op" id="6907441">.</span><span class="ident" id="6907442">Fatalf</span><span class="op" id="6907448">(</span><span class="string" id="6907449">&#34;write&nbsp;utf-8:&nbsp;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6907479">,</span>&nbsp;<span class="ident" id="6907481">s</span><span class="op" id="6907482">,</span>&nbsp;<span class="builtintype" id="6907484">string</span><span class="op" id="6907490">(</span><span class="ident" id="6907491">latin1</span><span class="op" id="6907497">)</span><span class="op" id="6907498">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6907501">}</span><br>
<span class="lineno"></span><span class="op" id="6907503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6907506">//&nbsp;TestLatin1RoundTrip&nbsp;tests&nbsp;that&nbsp;metadata&nbsp;that&nbsp;is&nbsp;representable&nbsp;in&nbsp;Latin-1</span><br>
<span class="lineno"></span><span class="comment" id="6907582">//&nbsp;survives&nbsp;a&nbsp;round&nbsp;trip.</span><br>
<span class="lineno">110</span><span class="keyword" id="6907608">func</span>&nbsp;<span class="ident" id="6907613">TestLatin1RoundTrip</span><span class="op" id="6907632">(</span><span class="ident" id="6907633">t</span>&nbsp;<span class="op" id="6907635">*</span><span class="ident" id="6907636">testing</span><span class="op" id="6907643">.</span><span class="ident" id="6907644">T</span><span class="op" id="6907645">)</span>&nbsp;<span class="op" id="6907647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6907650">testCases</span>&nbsp;<span class="op" id="6907660">:=</span>&nbsp;<span class="op" id="6907663">[</span><span class="op" id="6907664">]</span><span class="keyword" id="6907665">struct</span>&nbsp;<span class="op" id="6907672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6907676">name</span>&nbsp;<span class="builtintype" id="6907681">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6907690">ok</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6907695">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6907701">}</span><span class="op" id="6907702">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6907706">{</span><span class="string" id="6907707">&#34;&#34;</span><span class="op" id="6907709">,</span>&nbsp;<span class="builtintype" id="6907711">true</span><span class="op" id="6907715">}</span><span class="op" id="6907716">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6907720">{</span><span class="string" id="6907721">&#34;ASCII&nbsp;is&nbsp;OK&#34;</span><span class="op" id="6907734">,</span>&nbsp;<span class="builtintype" id="6907736">true</span><span class="op" id="6907740">}</span><span class="op" id="6907741">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6907745">{</span><span class="string" id="6907746">&#34;unless&nbsp;it&nbsp;contains&nbsp;a&nbsp;NUL\x00&#34;</span><span class="op" id="6907776">,</span>&nbsp;<span class="builtintype" id="6907778">false</span><span class="op" id="6907783">}</span><span class="op" id="6907784">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6907788">{</span><span class="string" id="6907789">&#34;no&nbsp;matter&nbsp;where&nbsp;\x00&nbsp;occurs&#34;</span><span class="op" id="6907818">,</span>&nbsp;<span class="builtintype" id="6907820">false</span><span class="op" id="6907825">}</span><span class="op" id="6907826">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6907830">{</span><span class="string" id="6907831">&#34;\x00\x00\x00&#34;</span><span class="op" id="6907845">,</span>&nbsp;<span class="builtintype" id="6907847">false</span><span class="op" id="6907852">}</span><span class="op" id="6907853">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6907857">{</span><span class="string" id="6907858">&#34;Látin-1&nbsp;also&nbsp;passes&nbsp;(U+00E1)&#34;</span><span class="op" id="6907889">,</span>&nbsp;<span class="builtintype" id="6907891">true</span><span class="op" id="6907895">}</span><span class="op" id="6907896">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6907900">{</span><span class="string" id="6907901">&#34;but&nbsp;LĀtin&nbsp;Extended-A&nbsp;(U+0100)&nbsp;does&nbsp;not&#34;</span><span class="op" id="6907942">,</span>&nbsp;<span class="builtintype" id="6907944">false</span><span class="op" id="6907949">}</span><span class="op" id="6907950">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6907954">{</span><span class="string" id="6907955">&#34;neither&nbsp;does&nbsp;日本語&#34;</span><span class="op" id="6907979">,</span>&nbsp;<span class="builtintype" id="6907981">false</span><span class="op" id="6907986">}</span><span class="op" id="6907987">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6907991">{</span><span class="string" id="6907992">&#34;invalid&nbsp;UTF-8&nbsp;also&nbsp;\xffails&#34;</span><span class="op" id="6908021">,</span>&nbsp;<span class="builtintype" id="6908023">false</span><span class="op" id="6908028">}</span><span class="op" id="6908029">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6908033">{</span><span class="string" id="6908034">&#34;\x00&nbsp;as&nbsp;does&nbsp;Látin-1&nbsp;with&nbsp;NUL&#34;</span><span class="op" id="6908066">,</span>&nbsp;<span class="builtintype" id="6908068">false</span><span class="op" id="6908073">}</span><span class="op" id="6908074">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6908077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6908080">for</span>&nbsp;<span class="ident" id="6908084">_</span><span class="op" id="6908085">,</span>&nbsp;<span class="ident" id="6908087">tc</span>&nbsp;<span class="op" id="6908090">:=</span>&nbsp;<span class="keyword" id="6908093">range</span>&nbsp;<span class="ident" id="6908099">testCases</span>&nbsp;<span class="op" id="6908109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6908113">buf</span>&nbsp;<span class="op" id="6908117">:=</span>&nbsp;<span class="builtinfunc" id="6908120">new</span><span class="op" id="6908123">(</span><span class="ident" id="6908124">bytes</span><span class="op" id="6908129">.</span><span class="ident" id="6908130">Buffer</span><span class="op" id="6908136">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6908141">w</span>&nbsp;<span class="op" id="6908143">:=</span>&nbsp;<span class="ident" id="6908146">NewWriter</span><span class="op" id="6908155">(</span><span class="ident" id="6908156">buf</span><span class="op" id="6908159">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6908163">w</span><span class="op" id="6908164">.</span><span class="ident" id="6908165">Name</span>&nbsp;<span class="op" id="6908170">=</span>&nbsp;<span class="ident" id="6908172">tc</span><span class="op" id="6908174">.</span><span class="ident" id="6908175">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6908182">err</span>&nbsp;<span class="op" id="6908186">:=</span>&nbsp;<span class="ident" id="6908189">w</span><span class="op" id="6908190">.</span><span class="ident" id="6908191">Close</span><span class="op" id="6908196">(</span><span class="op" id="6908197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6908201">if</span>&nbsp;<span class="op" id="6908204">(</span><span class="ident" id="6908205">err</span>&nbsp;<span class="op" id="6908209">==</span>&nbsp;<span class="ident" id="6908212">nil</span><span class="op" id="6908215">)</span>&nbsp;<span class="op" id="6908217">!=</span>&nbsp;<span class="ident" id="6908220">tc</span><span class="op" id="6908222">.</span><span class="ident" id="6908223">ok</span>&nbsp;<span class="op" id="6908226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6908231">t</span><span class="op" id="6908232">.</span><span class="ident" id="6908233">Errorf</span><span class="op" id="6908239">(</span><span class="string" id="6908240">&#34;Writer.Close:&nbsp;name&nbsp;=&nbsp;%q,&nbsp;err&nbsp;=&nbsp;%v&#34;</span><span class="op" id="6908275">,</span>&nbsp;<span class="ident" id="6908277">tc</span><span class="op" id="6908279">.</span><span class="ident" id="6908280">name</span><span class="op" id="6908284">,</span>&nbsp;<span class="ident" id="6908286">err</span><span class="op" id="6908289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6908294">continue</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6908305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6908309">if</span>&nbsp;<span class="op" id="6908312">!</span><span class="ident" id="6908313">tc</span><span class="op" id="6908315">.</span><span class="ident" id="6908316">ok</span>&nbsp;<span class="op" id="6908319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6908324">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6908335">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6908340">r</span><span class="op" id="6908341">,</span>&nbsp;<span class="ident" id="6908343">err</span>&nbsp;<span class="op" id="6908347">:=</span>&nbsp;<span class="ident" id="6908350">NewReader</span><span class="op" id="6908359">(</span><span class="ident" id="6908360">buf</span><span class="op" id="6908363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6908367">if</span>&nbsp;<span class="ident" id="6908370">err</span>&nbsp;<span class="op" id="6908374">!=</span>&nbsp;<span class="ident" id="6908377">nil</span>&nbsp;<span class="op" id="6908381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6908386">t</span><span class="op" id="6908387">.</span><span class="ident" id="6908388">Errorf</span><span class="op" id="6908394">(</span><span class="string" id="6908395">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="6908410">,</span>&nbsp;<span class="ident" id="6908412">err</span><span class="op" id="6908415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6908420">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6908431">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6908435">_</span><span class="op" id="6908436">,</span>&nbsp;<span class="ident" id="6908438">err</span>&nbsp;<span class="op" id="6908442">=</span>&nbsp;<span class="ident" id="6908444">ioutil</span><span class="op" id="6908450">.</span><span class="ident" id="6908451">ReadAll</span><span class="op" id="6908458">(</span><span class="ident" id="6908459">r</span><span class="op" id="6908460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6908464">if</span>&nbsp;<span class="ident" id="6908467">err</span>&nbsp;<span class="op" id="6908471">!=</span>&nbsp;<span class="ident" id="6908474">nil</span>&nbsp;<span class="op" id="6908478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6908483">t</span><span class="op" id="6908484">.</span><span class="ident" id="6908485">Errorf</span><span class="op" id="6908491">(</span><span class="string" id="6908492">&#34;ReadAll:&nbsp;%v&#34;</span><span class="op" id="6908505">,</span>&nbsp;<span class="ident" id="6908507">err</span><span class="op" id="6908510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6908515">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6908526">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6908530">if</span>&nbsp;<span class="ident" id="6908533">r</span><span class="op" id="6908534">.</span><span class="ident" id="6908535">Name</span>&nbsp;<span class="op" id="6908540">!=</span>&nbsp;<span class="ident" id="6908543">tc</span><span class="op" id="6908545">.</span><span class="ident" id="6908546">name</span>&nbsp;<span class="op" id="6908551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6908556">t</span><span class="op" id="6908557">.</span><span class="ident" id="6908558">Errorf</span><span class="op" id="6908564">(</span><span class="string" id="6908565">&#34;name&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6908586">,</span>&nbsp;<span class="ident" id="6908588">r</span><span class="op" id="6908589">.</span><span class="ident" id="6908590">Name</span><span class="op" id="6908594">,</span>&nbsp;<span class="ident" id="6908596">tc</span><span class="op" id="6908598">.</span><span class="ident" id="6908599">name</span><span class="op" id="6908603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6908608">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6908619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6908623">if</span>&nbsp;<span class="ident" id="6908626">err</span>&nbsp;<span class="op" id="6908630">:=</span>&nbsp;<span class="ident" id="6908633">r</span><span class="op" id="6908634">.</span><span class="ident" id="6908635">Close</span><span class="op" id="6908640">(</span><span class="op" id="6908641">)</span><span class="op" id="6908642">;</span>&nbsp;<span class="ident" id="6908644">err</span>&nbsp;<span class="op" id="6908648">!=</span>&nbsp;<span class="ident" id="6908651">nil</span>&nbsp;<span class="op" id="6908655">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6908660">t</span><span class="op" id="6908661">.</span><span class="ident" id="6908662">Errorf</span><span class="op" id="6908668">(</span><span class="string" id="6908669">&#34;Reader.Close:&nbsp;%v&#34;</span><span class="op" id="6908687">,</span>&nbsp;<span class="ident" id="6908689">err</span><span class="op" id="6908692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6908697">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6908708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6908711">}</span><br>
<span class="lineno"></span><span class="op" id="6908713">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="keyword" id="6908716">func</span>&nbsp;<span class="ident" id="6908721">TestWriterFlush</span><span class="op" id="6908736">(</span><span class="ident" id="6908737">t</span>&nbsp;<span class="op" id="6908739">*</span><span class="ident" id="6908740">testing</span><span class="op" id="6908747">.</span><span class="ident" id="6908748">T</span><span class="op" id="6908749">)</span>&nbsp;<span class="op" id="6908751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6908754">buf</span>&nbsp;<span class="op" id="6908758">:=</span>&nbsp;<span class="builtinfunc" id="6908761">new</span><span class="op" id="6908764">(</span><span class="ident" id="6908765">bytes</span><span class="op" id="6908770">.</span><span class="ident" id="6908771">Buffer</span><span class="op" id="6908777">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6908781">w</span>&nbsp;<span class="op" id="6908783">:=</span>&nbsp;<span class="ident" id="6908786">NewWriter</span><span class="op" id="6908795">(</span><span class="ident" id="6908796">buf</span><span class="op" id="6908799">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6908802">w</span><span class="op" id="6908803">.</span><span class="ident" id="6908804">Comment</span>&nbsp;<span class="op" id="6908812">=</span>&nbsp;<span class="string" id="6908814">&#34;comment&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6908825">w</span><span class="op" id="6908826">.</span><span class="ident" id="6908827">Extra</span>&nbsp;<span class="op" id="6908833">=</span>&nbsp;<span class="op" id="6908835">[</span><span class="op" id="6908836">]</span><span class="builtintype" id="6908837">byte</span><span class="op" id="6908841">(</span><span class="string" id="6908842">&#34;extra&#34;</span><span class="op" id="6908849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6908852">w</span><span class="op" id="6908853">.</span><span class="ident" id="6908854">ModTime</span>&nbsp;<span class="op" id="6908862">=</span>&nbsp;<span class="ident" id="6908864">time</span><span class="op" id="6908868">.</span><span class="ident" id="6908869">Unix</span><span class="op" id="6908873">(</span><span class="num" id="6908874">1e8</span><span class="op" id="6908877">,</span>&nbsp;<span class="num" id="6908879">0</span><span class="op" id="6908880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6908883">w</span><span class="op" id="6908884">.</span><span class="ident" id="6908885">Name</span>&nbsp;<span class="op" id="6908890">=</span>&nbsp;<span class="string" id="6908892">&#34;name&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6908901">n0</span>&nbsp;<span class="op" id="6908904">:=</span>&nbsp;<span class="ident" id="6908907">buf</span><span class="op" id="6908910">.</span><span class="ident" id="6908911">Len</span><span class="op" id="6908914">(</span><span class="op" id="6908915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6908918">if</span>&nbsp;<span class="ident" id="6908921">n0</span>&nbsp;<span class="op" id="6908924">!=</span>&nbsp;<span class="num" id="6908927">0</span>&nbsp;<span class="op" id="6908929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6908933">t</span><span class="op" id="6908934">.</span><span class="ident" id="6908935">Fatalf</span><span class="op" id="6908941">(</span><span class="string" id="6908942">&#34;buffer&nbsp;size&nbsp;=&nbsp;%d&nbsp;before&nbsp;writes;&nbsp;want&nbsp;0&#34;</span><span class="op" id="6908982">,</span>&nbsp;<span class="ident" id="6908984">n0</span><span class="op" id="6908986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6908989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6908993">if</span>&nbsp;<span class="ident" id="6908996">err</span>&nbsp;<span class="op" id="6909000">:=</span>&nbsp;<span class="ident" id="6909003">w</span><span class="op" id="6909004">.</span><span class="ident" id="6909005">Flush</span><span class="op" id="6909010">(</span><span class="op" id="6909011">)</span><span class="op" id="6909012">;</span>&nbsp;<span class="ident" id="6909014">err</span>&nbsp;<span class="op" id="6909018">!=</span>&nbsp;<span class="ident" id="6909021">nil</span>&nbsp;<span class="op" id="6909025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6909029">t</span><span class="op" id="6909030">.</span><span class="ident" id="6909031">Fatal</span><span class="op" id="6909036">(</span><span class="ident" id="6909037">err</span><span class="op" id="6909040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6909043">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6909047">n1</span>&nbsp;<span class="op" id="6909050">:=</span>&nbsp;<span class="ident" id="6909053">buf</span><span class="op" id="6909056">.</span><span class="ident" id="6909057">Len</span><span class="op" id="6909060">(</span><span class="op" id="6909061">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6909064">if</span>&nbsp;<span class="ident" id="6909067">n1</span>&nbsp;<span class="op" id="6909070">==</span>&nbsp;<span class="num" id="6909073">0</span>&nbsp;<span class="op" id="6909075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6909079">t</span><span class="op" id="6909080">.</span><span class="ident" id="6909081">Fatal</span><span class="op" id="6909086">(</span><span class="string" id="6909087">&#34;no&nbsp;data&nbsp;after&nbsp;first&nbsp;flush&#34;</span><span class="op" id="6909114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6909117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6909121">w</span><span class="op" id="6909122">.</span><span class="ident" id="6909123">Write</span><span class="op" id="6909128">(</span><span class="op" id="6909129">[</span><span class="op" id="6909130">]</span><span class="builtintype" id="6909131">byte</span><span class="op" id="6909135">(</span><span class="string" id="6909136">&#34;x&#34;</span><span class="op" id="6909139">)</span><span class="op" id="6909140">)</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6909144">n2</span>&nbsp;<span class="op" id="6909147">:=</span>&nbsp;<span class="ident" id="6909150">buf</span><span class="op" id="6909153">.</span><span class="ident" id="6909154">Len</span><span class="op" id="6909157">(</span><span class="op" id="6909158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6909161">if</span>&nbsp;<span class="ident" id="6909164">n1</span>&nbsp;<span class="op" id="6909167">!=</span>&nbsp;<span class="ident" id="6909170">n2</span>&nbsp;<span class="op" id="6909173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6909177">t</span><span class="op" id="6909178">.</span><span class="ident" id="6909179">Fatalf</span><span class="op" id="6909185">(</span><span class="string" id="6909186">&#34;after&nbsp;writing&nbsp;a&nbsp;single&nbsp;byte,&nbsp;size&nbsp;changed&nbsp;from&nbsp;%d&nbsp;to&nbsp;%d;&nbsp;want&nbsp;no&nbsp;change&#34;</span><span class="op" id="6909259">,</span>&nbsp;<span class="ident" id="6909261">n1</span><span class="op" id="6909263">,</span>&nbsp;<span class="ident" id="6909265">n2</span><span class="op" id="6909267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6909270">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6909274">if</span>&nbsp;<span class="ident" id="6909277">err</span>&nbsp;<span class="op" id="6909281">:=</span>&nbsp;<span class="ident" id="6909284">w</span><span class="op" id="6909285">.</span><span class="ident" id="6909286">Flush</span><span class="op" id="6909291">(</span><span class="op" id="6909292">)</span><span class="op" id="6909293">;</span>&nbsp;<span class="ident" id="6909295">err</span>&nbsp;<span class="op" id="6909299">!=</span>&nbsp;<span class="ident" id="6909302">nil</span>&nbsp;<span class="op" id="6909306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6909310">t</span><span class="op" id="6909311">.</span><span class="ident" id="6909312">Fatal</span><span class="op" id="6909317">(</span><span class="ident" id="6909318">err</span><span class="op" id="6909321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6909324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6909328">n3</span>&nbsp;<span class="op" id="6909331">:=</span>&nbsp;<span class="ident" id="6909334">buf</span><span class="op" id="6909337">.</span><span class="ident" id="6909338">Len</span><span class="op" id="6909341">(</span><span class="op" id="6909342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6909345">if</span>&nbsp;<span class="ident" id="6909348">n2</span>&nbsp;<span class="op" id="6909351">==</span>&nbsp;<span class="ident" id="6909354">n3</span>&nbsp;<span class="op" id="6909357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6909361">t</span><span class="op" id="6909362">.</span><span class="ident" id="6909363">Fatal</span><span class="op" id="6909368">(</span><span class="string" id="6909369">&#34;Flush&nbsp;didn&#39;t&nbsp;flush&nbsp;any&nbsp;data&#34;</span><span class="op" id="6909398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6909401">}</span><br>
<span class="lineno"></span><span class="op" id="6909403">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="6909406">//&nbsp;Multiple&nbsp;gzip&nbsp;files&nbsp;concatenated&nbsp;form&nbsp;a&nbsp;valid&nbsp;gzip&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="6909466">func</span>&nbsp;<span class="ident" id="6909471">TestConcat</span><span class="op" id="6909481">(</span><span class="ident" id="6909482">t</span>&nbsp;<span class="op" id="6909484">*</span><span class="ident" id="6909485">testing</span><span class="op" id="6909492">.</span><span class="ident" id="6909493">T</span><span class="op" id="6909494">)</span>&nbsp;<span class="op" id="6909496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6909499">var</span>&nbsp;<span class="ident" id="6909503">buf</span>&nbsp;<span class="ident" id="6909507">bytes</span><span class="op" id="6909512">.</span><span class="ident" id="6909513">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6909521">w</span>&nbsp;<span class="op" id="6909523">:=</span>&nbsp;<span class="ident" id="6909526">NewWriter</span><span class="op" id="6909535">(</span><span class="op" id="6909536">&amp;</span><span class="ident" id="6909537">buf</span><span class="op" id="6909540">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6909543">w</span><span class="op" id="6909544">.</span><span class="ident" id="6909545">Write</span><span class="op" id="6909550">(</span><span class="op" id="6909551">[</span><span class="op" id="6909552">]</span><span class="builtintype" id="6909553">byte</span><span class="op" id="6909557">(</span><span class="string" id="6909558">&#34;hello&nbsp;&#34;</span><span class="op" id="6909566">)</span><span class="op" id="6909567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6909570">w</span><span class="op" id="6909571">.</span><span class="ident" id="6909572">Close</span><span class="op" id="6909577">(</span><span class="op" id="6909578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6909581">w</span>&nbsp;<span class="op" id="6909583">=</span>&nbsp;<span class="ident" id="6909585">NewWriter</span><span class="op" id="6909594">(</span><span class="op" id="6909595">&amp;</span><span class="ident" id="6909596">buf</span><span class="op" id="6909599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6909602">w</span><span class="op" id="6909603">.</span><span class="ident" id="6909604">Write</span><span class="op" id="6909609">(</span><span class="op" id="6909610">[</span><span class="op" id="6909611">]</span><span class="builtintype" id="6909612">byte</span><span class="op" id="6909616">(</span><span class="string" id="6909617">&#34;world\n&#34;</span><span class="op" id="6909626">)</span><span class="op" id="6909627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6909630">w</span><span class="op" id="6909631">.</span><span class="ident" id="6909632">Close</span><span class="op" id="6909637">(</span><span class="op" id="6909638">)</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6909642">r</span><span class="op" id="6909643">,</span>&nbsp;<span class="ident" id="6909645">err</span>&nbsp;<span class="op" id="6909649">:=</span>&nbsp;<span class="ident" id="6909652">NewReader</span><span class="op" id="6909661">(</span><span class="op" id="6909662">&amp;</span><span class="ident" id="6909663">buf</span><span class="op" id="6909666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6909669">data</span><span class="op" id="6909673">,</span>&nbsp;<span class="ident" id="6909675">err</span>&nbsp;<span class="op" id="6909679">:=</span>&nbsp;<span class="ident" id="6909682">ioutil</span><span class="op" id="6909688">.</span><span class="ident" id="6909689">ReadAll</span><span class="op" id="6909696">(</span><span class="ident" id="6909697">r</span><span class="op" id="6909698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6909701">if</span>&nbsp;<span class="builtintype" id="6909704">string</span><span class="op" id="6909710">(</span><span class="ident" id="6909711">data</span><span class="op" id="6909715">)</span>&nbsp;<span class="op" id="6909717">!=</span>&nbsp;<span class="string" id="6909720">&#34;hello&nbsp;world\n&#34;</span>&nbsp;<span class="op" id="6909736">||</span>&nbsp;<span class="ident" id="6909739">err</span>&nbsp;<span class="op" id="6909743">!=</span>&nbsp;<span class="ident" id="6909746">nil</span>&nbsp;<span class="op" id="6909750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6909754">t</span><span class="op" id="6909755">.</span><span class="ident" id="6909756">Fatalf</span><span class="op" id="6909762">(</span><span class="string" id="6909763">&#34;ReadAll&nbsp;=&nbsp;%q,&nbsp;%v,&nbsp;want&nbsp;%q,&nbsp;nil&#34;</span><span class="op" id="6909795">,</span>&nbsp;<span class="ident" id="6909797">data</span><span class="op" id="6909801">,</span>&nbsp;<span class="ident" id="6909803">err</span><span class="op" id="6909806">,</span>&nbsp;<span class="string" id="6909808">&#34;hello&nbsp;world&#34;</span><span class="op" id="6909821">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6909824">}</span><br>
<span class="lineno"></span><span class="op" id="6909826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6909829">func</span>&nbsp;<span class="ident" id="6909834">TestWriterReset</span><span class="op" id="6909849">(</span><span class="ident" id="6909850">t</span>&nbsp;<span class="op" id="6909852">*</span><span class="ident" id="6909853">testing</span><span class="op" id="6909860">.</span><span class="ident" id="6909861">T</span><span class="op" id="6909862">)</span>&nbsp;<span class="op" id="6909864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6909867">buf</span>&nbsp;<span class="op" id="6909871">:=</span>&nbsp;<span class="builtinfunc" id="6909874">new</span><span class="op" id="6909877">(</span><span class="ident" id="6909878">bytes</span><span class="op" id="6909883">.</span><span class="ident" id="6909884">Buffer</span><span class="op" id="6909890">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6909893">buf2</span>&nbsp;<span class="op" id="6909898">:=</span>&nbsp;<span class="builtinfunc" id="6909901">new</span><span class="op" id="6909904">(</span><span class="ident" id="6909905">bytes</span><span class="op" id="6909910">.</span><span class="ident" id="6909911">Buffer</span><span class="op" id="6909917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6909920">z</span>&nbsp;<span class="op" id="6909922">:=</span>&nbsp;<span class="ident" id="6909925">NewWriter</span><span class="op" id="6909934">(</span><span class="ident" id="6909935">buf</span><span class="op" id="6909938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6909941">msg</span>&nbsp;<span class="op" id="6909945">:=</span>&nbsp;<span class="op" id="6909948">[</span><span class="op" id="6909949">]</span><span class="builtintype" id="6909950">byte</span><span class="op" id="6909954">(</span><span class="string" id="6909955">&#34;hello&nbsp;world&#34;</span><span class="op" id="6909968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6909971">z</span><span class="op" id="6909972">.</span><span class="ident" id="6909973">Write</span><span class="op" id="6909978">(</span><span class="ident" id="6909979">msg</span><span class="op" id="6909982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6909985">z</span><span class="op" id="6909986">.</span><span class="ident" id="6909987">Close</span><span class="op" id="6909992">(</span><span class="op" id="6909993">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6909996">z</span><span class="op" id="6909997">.</span><span class="ident" id="6909998">Reset</span><span class="op" id="6910003">(</span><span class="ident" id="6910004">buf2</span><span class="op" id="6910008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6910011">z</span><span class="op" id="6910012">.</span><span class="ident" id="6910013">Write</span><span class="op" id="6910018">(</span><span class="ident" id="6910019">msg</span><span class="op" id="6910022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6910025">z</span><span class="op" id="6910026">.</span><span class="ident" id="6910027">Close</span><span class="op" id="6910032">(</span><span class="op" id="6910033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6910036">if</span>&nbsp;<span class="ident" id="6910039">buf</span><span class="op" id="6910042">.</span><span class="ident" id="6910043">String</span><span class="op" id="6910049">(</span><span class="op" id="6910050">)</span>&nbsp;<span class="op" id="6910052">!=</span>&nbsp;<span class="ident" id="6910055">buf2</span><span class="op" id="6910059">.</span><span class="ident" id="6910060">String</span><span class="op" id="6910066">(</span><span class="op" id="6910067">)</span>&nbsp;<span class="op" id="6910069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6910073">t</span><span class="op" id="6910074">.</span><span class="ident" id="6910075">Errorf</span><span class="op" id="6910081">(</span><span class="string" id="6910082">&#34;buf2&nbsp;%q&nbsp;!=&nbsp;original&nbsp;buf&nbsp;of&nbsp;%q&#34;</span><span class="op" id="6910113">,</span>&nbsp;<span class="ident" id="6910115">buf2</span><span class="op" id="6910119">.</span><span class="ident" id="6910120">String</span><span class="op" id="6910126">(</span><span class="op" id="6910127">)</span><span class="op" id="6910128">,</span>&nbsp;<span class="ident" id="6910130">buf</span><span class="op" id="6910133">.</span><span class="ident" id="6910134">String</span><span class="op" id="6910140">(</span><span class="op" id="6910141">)</span><span class="op" id="6910142">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6910145">}</span><br>
<span class="lineno"></span><span class="op" id="6910147">}</span>
</div>
</body>
</html>
