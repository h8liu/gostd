<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5681206">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5681261">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5681315">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5681366">package</span>&nbsp;<span class="ident" id="5681374">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5681379">import</span>&nbsp;<span class="op" id="5681386">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5681389">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5681398">&#34;encoding/binary&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5681417">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5681427">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5681435">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5681449">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5681455">&#34;os&#34;</span><br>
<span class="lineno">15</span><span class="op" id="5681460">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5681463">var</span>&nbsp;<span class="op" id="5681467">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681470">ErrFormat</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5681483">=</span>&nbsp;<span class="ident" id="5681485"><a href="/archive/zip/reader.go.html#5681417">errors</a></span><span class="op" id="5681491">.</span><span class="ident" id="5681492">New</span><span class="op" id="5681495">(</span><span class="string" id="5681496">&#34;zip:&nbsp;not&nbsp;a&nbsp;valid&nbsp;zip&nbsp;file&#34;</span><span class="op" id="5681523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681526">ErrAlgorithm</span>&nbsp;<span class="op" id="5681539">=</span>&nbsp;<span class="ident" id="5681541"><a href="/archive/zip/reader.go.html#5681417">errors</a></span><span class="op" id="5681547">.</span><span class="ident" id="5681548">New</span><span class="op" id="5681551">(</span><span class="string" id="5681552">&#34;zip:&nbsp;unsupported&nbsp;compression&nbsp;algorithm&#34;</span><span class="op" id="5681592">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681595">ErrChecksum</span>&nbsp;&nbsp;<span class="op" id="5681608">=</span>&nbsp;<span class="ident" id="5681610"><a href="/archive/zip/reader.go.html#5681417">errors</a></span><span class="op" id="5681616">.</span><span class="ident" id="5681617">New</span><span class="op" id="5681620">(</span><span class="string" id="5681621">&#34;zip:&nbsp;checksum&nbsp;error&#34;</span><span class="op" id="5681642">)</span><br>
<span class="lineno"></span><span class="op" id="5681644">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5681647">type</span>&nbsp;<span class="ident" id="5681652">Reader</span>&nbsp;<span class="keyword" id="5681659">struct</span>&nbsp;<span class="op" id="5681666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681669">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5681677"><a href="/archive/zip/reader.go.html#5681449">io</a></span><span class="op" id="5681679">.</span><span class="ident" id="5681680">ReaderAt</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681690">File</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5681698">[</span><span class="op" id="5681699">]</span><span class="op" id="5681700">*</span><span class="ident" id="5681701"><a href="/archive/zip/reader.go.html#5681778">File</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681707">Comment</span>&nbsp;<span class="builtintype" id="5681715">string</span><br>
<span class="lineno"></span><span class="op" id="5681722">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5681725">type</span>&nbsp;<span class="ident" id="5681730">ReadCloser</span>&nbsp;<span class="keyword" id="5681741">struct</span>&nbsp;<span class="op" id="5681748">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681751">f</span>&nbsp;<span class="op" id="5681753">*</span><span class="ident" id="5681754"><a href="/archive/zip/reader.go.html#5681455">os</a></span><span class="op" id="5681756">.</span><span class="ident" id="5681757">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681763"><a href="/archive/zip/reader.go.html#5681652">Reader</a></span><br>
<span class="lineno"></span><span class="op" id="5681770">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5681773">type</span>&nbsp;<span class="ident" id="5681778">File</span>&nbsp;<span class="keyword" id="5681783">struct</span>&nbsp;<span class="op" id="5681790">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681793"><a href="/archive/zip/struct.go.html#5698331">FileHeader</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681805">zipr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5681818"><a href="/archive/zip/reader.go.html#5681449">io</a></span><span class="op" id="5681820">.</span><span class="ident" id="5681821">ReaderAt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681831">zipsize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5681844">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681851">headerOffset</span>&nbsp;<span class="ident" id="5681864">int64</span><br>
<span class="lineno"></span><span class="op" id="5681870">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="5681873">func</span>&nbsp;<span class="op" id="5681878">(</span><span class="ident" id="5681879">f</span>&nbsp;<span class="op" id="5681881">*</span><span class="ident" id="5681882"><a href="/archive/zip/reader.go.html#5681778">File</a></span><span class="op" id="5681886">)</span>&nbsp;<span class="ident" id="5681888">hasDataDescriptor</span><span class="op" id="5681905">(</span><span class="op" id="5681906">)</span>&nbsp;<span class="builtintype" id="5681908">bool</span>&nbsp;<span class="op" id="5681913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5681916">return</span>&nbsp;<span class="ident" id="5681923"><a href="/archive/zip/reader.go.html#5681879">f</a></span><span class="op" id="5681924">.</span><span class="ident" id="5681925">Flags</span><span class="op" id="5681930">&amp;</span><span class="num" id="5681931">0x8</span>&nbsp;<span class="op" id="5681935">!=</span>&nbsp;<span class="num" id="5681938">0</span><br>
<span class="lineno"></span><span class="op" id="5681940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="5681943">//&nbsp;OpenReader&nbsp;will&nbsp;open&nbsp;the&nbsp;Zip&nbsp;file&nbsp;specified&nbsp;by&nbsp;name&nbsp;and&nbsp;return&nbsp;a&nbsp;ReadCloser.</span><br>
<span class="lineno"></span><span class="keyword" id="5682023">func</span>&nbsp;<span class="ident" id="5682028">OpenReader</span><span class="op" id="5682038">(</span><span class="ident" id="5682039">name</span>&nbsp;<span class="builtintype" id="5682044">string</span><span class="op" id="5682050">)</span>&nbsp;<span class="op" id="5682052">(</span><span class="op" id="5682053">*</span><span class="ident" id="5682054"><a href="/archive/zip/reader.go.html#5681730">ReadCloser</a></span><span class="op" id="5682064">,</span>&nbsp;<span class="builtintype" id="5682066">error</span><span class="op" id="5682071">)</span>&nbsp;<span class="op" id="5682073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682076">f</span><span class="op" id="5682077">,</span>&nbsp;<span class="ident" id="5682079">err</span>&nbsp;<span class="op" id="5682083">:=</span>&nbsp;<span class="ident" id="5682086"><a href="/archive/zip/reader.go.html#5681455">os</a></span><span class="op" id="5682088">.</span><span class="ident" id="5682089">Open</span><span class="op" id="5682093">(</span><span class="ident" id="5682094"><a href="/archive/zip/reader.go.html#5682039">name</a></span><span class="op" id="5682098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682101">if</span>&nbsp;<span class="ident" id="5682104"><a href="/archive/zip/reader.go.html#5682079">err</a></span>&nbsp;<span class="op" id="5682108">!=</span>&nbsp;<span class="ident" id="5682111">nil</span>&nbsp;<span class="op" id="5682115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682119">return</span>&nbsp;<span class="ident" id="5682126">nil</span><span class="op" id="5682129">,</span>&nbsp;<span class="ident" id="5682131"><a href="/archive/zip/reader.go.html#5682079">err</a></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5682136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682139">fi</span><span class="op" id="5682141">,</span>&nbsp;<span class="ident" id="5682143"><a href="/archive/zip/reader.go.html#5682079">err</a></span>&nbsp;<span class="op" id="5682147">:=</span>&nbsp;<span class="ident" id="5682150"><a href="/archive/zip/reader.go.html#5682076">f</a></span><span class="op" id="5682151">.</span><span class="ident" id="5682152">Stat</span><span class="op" id="5682156">(</span><span class="op" id="5682157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682160">if</span>&nbsp;<span class="ident" id="5682163"><a href="/archive/zip/reader.go.html#5682079">err</a></span>&nbsp;<span class="op" id="5682167">!=</span>&nbsp;<span class="ident" id="5682170">nil</span>&nbsp;<span class="op" id="5682174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682178"><a href="/archive/zip/reader.go.html#5682076">f</a></span><span class="op" id="5682179">.</span><span class="ident" id="5682180">Close</span><span class="op" id="5682185">(</span><span class="op" id="5682186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682190">return</span>&nbsp;<span class="ident" id="5682197">nil</span><span class="op" id="5682200">,</span>&nbsp;<span class="ident" id="5682202"><a href="/archive/zip/reader.go.html#5682079">err</a></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5682207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682210">r</span>&nbsp;<span class="op" id="5682212">:=</span>&nbsp;<span class="builtinfunc" id="5682215">new</span><span class="op" id="5682218">(</span><span class="ident" id="5682219"><a href="/archive/zip/reader.go.html#5681730">ReadCloser</a></span><span class="op" id="5682229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682232">if</span>&nbsp;<span class="ident" id="5682235">err</span>&nbsp;<span class="op" id="5682239">:=</span>&nbsp;<span class="ident" id="5682242"><a href="/archive/zip/reader.go.html#5682210">r</a></span><span class="op" id="5682243">.</span><span class="ident" id="5682244">init</span><span class="op" id="5682248">(</span><span class="ident" id="5682249"><a href="/archive/zip/reader.go.html#5682076">f</a></span><span class="op" id="5682250">,</span>&nbsp;<span class="ident" id="5682252"><a href="/archive/zip/reader.go.html#5682139">fi</a></span><span class="op" id="5682254">.</span><span class="ident" id="5682255">Size</span><span class="op" id="5682259">(</span><span class="op" id="5682260">)</span><span class="op" id="5682261">)</span><span class="op" id="5682262">;</span>&nbsp;<span class="ident" id="5682264"><a href="/archive/zip/reader.go.html#5682235">err</a></span>&nbsp;<span class="op" id="5682268">!=</span>&nbsp;<span class="ident" id="5682271">nil</span>&nbsp;<span class="op" id="5682275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682279"><a href="/archive/zip/reader.go.html#5682076">f</a></span><span class="op" id="5682280">.</span><span class="ident" id="5682281">Close</span><span class="op" id="5682286">(</span><span class="op" id="5682287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682291">return</span>&nbsp;<span class="ident" id="5682298">nil</span><span class="op" id="5682301">,</span>&nbsp;<span class="ident" id="5682303"><a href="/archive/zip/reader.go.html#5682235">err</a></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5682308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682311"><a href="/archive/zip/reader.go.html#5682210">r</a></span><span class="op" id="5682312">.</span><span class="ident" id="5682313">f</span>&nbsp;<span class="op" id="5682315">=</span>&nbsp;<span class="ident" id="5682317"><a href="/archive/zip/reader.go.html#5682076">f</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682320">return</span>&nbsp;<span class="ident" id="5682327"><a href="/archive/zip/reader.go.html#5682210">r</a></span><span class="op" id="5682328">,</span>&nbsp;<span class="ident" id="5682330">nil</span><br>
<span class="lineno"></span><span class="op" id="5682334">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="5682337">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;from&nbsp;r,&nbsp;which&nbsp;is&nbsp;assumed&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5682407">//&nbsp;have&nbsp;the&nbsp;given&nbsp;size&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="5682440">func</span>&nbsp;<span class="ident" id="5682445">NewReader</span><span class="op" id="5682454">(</span><span class="ident" id="5682455">r</span>&nbsp;<span class="ident" id="5682457"><a href="/archive/zip/reader.go.html#5681449">io</a></span><span class="op" id="5682459">.</span><span class="ident" id="5682460">ReaderAt</span><span class="op" id="5682468">,</span>&nbsp;<span class="ident" id="5682470">size</span>&nbsp;<span class="ident" id="5682475">int64</span><span class="op" id="5682480">)</span>&nbsp;<span class="op" id="5682482">(</span><span class="op" id="5682483">*</span><span class="ident" id="5682484"><a href="/archive/zip/reader.go.html#5681652">Reader</a></span><span class="op" id="5682490">,</span>&nbsp;<span class="builtintype" id="5682492">error</span><span class="op" id="5682497">)</span>&nbsp;<span class="op" id="5682499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682502">zr</span>&nbsp;<span class="op" id="5682505">:=</span>&nbsp;<span class="builtinfunc" id="5682508">new</span><span class="op" id="5682511">(</span><span class="ident" id="5682512"><a href="/archive/zip/reader.go.html#5681652">Reader</a></span><span class="op" id="5682518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682521">if</span>&nbsp;<span class="ident" id="5682524">err</span>&nbsp;<span class="op" id="5682528">:=</span>&nbsp;<span class="ident" id="5682531"><a href="/archive/zip/reader.go.html#5682502">zr</a></span><span class="op" id="5682533">.</span><span class="ident" id="5682534">init</span><span class="op" id="5682538">(</span><span class="ident" id="5682539"><a href="/archive/zip/reader.go.html#5682455">r</a></span><span class="op" id="5682540">,</span>&nbsp;<span class="ident" id="5682542"><a href="/archive/zip/reader.go.html#5682470">size</a></span><span class="op" id="5682546">)</span><span class="op" id="5682547">;</span>&nbsp;<span class="ident" id="5682549"><a href="/archive/zip/reader.go.html#5682524">err</a></span>&nbsp;<span class="op" id="5682553">!=</span>&nbsp;<span class="ident" id="5682556">nil</span>&nbsp;<span class="op" id="5682560">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682564">return</span>&nbsp;<span class="ident" id="5682571">nil</span><span class="op" id="5682574">,</span>&nbsp;<span class="ident" id="5682576"><a href="/archive/zip/reader.go.html#5682524">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5682581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682584">return</span>&nbsp;<span class="ident" id="5682591"><a href="/archive/zip/reader.go.html#5682502">zr</a></span><span class="op" id="5682593">,</span>&nbsp;<span class="ident" id="5682595">nil</span><br>
<span class="lineno"></span><span class="op" id="5682599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="5682602">func</span>&nbsp;<span class="op" id="5682607">(</span><span class="ident" id="5682608">z</span>&nbsp;<span class="op" id="5682610">*</span><span class="ident" id="5682611"><a href="/archive/zip/reader.go.html#5681652">Reader</a></span><span class="op" id="5682617">)</span>&nbsp;<span class="ident" id="5682619">init</span><span class="op" id="5682623">(</span><span class="ident" id="5682624">r</span>&nbsp;<span class="ident" id="5682626"><a href="/archive/zip/reader.go.html#5681449">io</a></span><span class="op" id="5682628">.</span><span class="ident" id="5682629">ReaderAt</span><span class="op" id="5682637">,</span>&nbsp;<span class="ident" id="5682639">size</span>&nbsp;<span class="ident" id="5682644">int64</span><span class="op" id="5682649">)</span>&nbsp;<span class="builtintype" id="5682651">error</span>&nbsp;<span class="op" id="5682657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682660">end</span><span class="op" id="5682663">,</span>&nbsp;<span class="ident" id="5682665">err</span>&nbsp;<span class="op" id="5682669">:=</span>&nbsp;<span class="ident" id="5682672"><a href="/archive/zip/reader.go.html#5689624">readDirectoryEnd</a></span><span class="op" id="5682688">(</span><span class="ident" id="5682689"><a href="/archive/zip/reader.go.html#5682624">r</a></span><span class="op" id="5682690">,</span>&nbsp;<span class="ident" id="5682692"><a href="/archive/zip/reader.go.html#5682639">size</a></span><span class="op" id="5682696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682699">if</span>&nbsp;<span class="ident" id="5682702"><a href="/archive/zip/reader.go.html#5682665">err</a></span>&nbsp;<span class="op" id="5682706">!=</span>&nbsp;<span class="ident" id="5682709">nil</span>&nbsp;<span class="op" id="5682713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682717">return</span>&nbsp;<span class="ident" id="5682724"><a href="/archive/zip/reader.go.html#5682665">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5682729">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682732"><a href="/archive/zip/reader.go.html#5682608">z</a></span><span class="op" id="5682733">.</span><span class="ident" id="5682734">r</span>&nbsp;<span class="op" id="5682736">=</span>&nbsp;<span class="ident" id="5682738"><a href="/archive/zip/reader.go.html#5682624">r</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682741"><a href="/archive/zip/reader.go.html#5682608">z</a></span><span class="op" id="5682742">.</span><span class="ident" id="5682743">File</span>&nbsp;<span class="op" id="5682748">=</span>&nbsp;<span class="builtinfunc" id="5682750">make</span><span class="op" id="5682754">(</span><span class="op" id="5682755">[</span><span class="op" id="5682756">]</span><span class="op" id="5682757">*</span><span class="ident" id="5682758"><a href="/archive/zip/reader.go.html#5681778">File</a></span><span class="op" id="5682762">,</span>&nbsp;<span class="num" id="5682764">0</span><span class="op" id="5682765">,</span>&nbsp;<span class="ident" id="5682767"><a href="/archive/zip/reader.go.html#5682660">end</a></span><span class="op" id="5682770">.</span><span class="ident" id="5682771">directoryRecords</span><span class="op" id="5682787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682790"><a href="/archive/zip/reader.go.html#5682608">z</a></span><span class="op" id="5682791">.</span><span class="ident" id="5682792">Comment</span>&nbsp;<span class="op" id="5682800">=</span>&nbsp;<span class="ident" id="5682802"><a href="/archive/zip/reader.go.html#5682660">end</a></span><span class="op" id="5682805">.</span><span class="ident" id="5682806">comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682815">rs</span>&nbsp;<span class="op" id="5682818">:=</span>&nbsp;<span class="ident" id="5682821"><a href="/archive/zip/reader.go.html#5681449">io</a></span><span class="op" id="5682823">.</span><span class="ident" id="5682824">NewSectionReader</span><span class="op" id="5682840">(</span><span class="ident" id="5682841"><a href="/archive/zip/reader.go.html#5682624">r</a></span><span class="op" id="5682842">,</span>&nbsp;<span class="num" id="5682844">0</span><span class="op" id="5682845">,</span>&nbsp;<span class="ident" id="5682847"><a href="/archive/zip/reader.go.html#5682639">size</a></span><span class="op" id="5682851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682854">if</span>&nbsp;<span class="ident" id="5682857">_</span><span class="op" id="5682858">,</span>&nbsp;<span class="ident" id="5682860"><a href="/archive/zip/reader.go.html#5682665">err</a></span>&nbsp;<span class="op" id="5682864">=</span>&nbsp;<span class="ident" id="5682866"><a href="/archive/zip/reader.go.html#5682815">rs</a></span><span class="op" id="5682868">.</span><span class="ident" id="5682869">Seek</span><span class="op" id="5682873">(</span><span class="ident" id="5682874">int64</span><span class="op" id="5682879">(</span><span class="ident" id="5682880"><a href="/archive/zip/reader.go.html#5682660">end</a></span><span class="op" id="5682883">.</span><span class="ident" id="5682884">directoryOffset</span><span class="op" id="5682899">)</span><span class="op" id="5682900">,</span>&nbsp;<span class="ident" id="5682902"><a href="/archive/zip/reader.go.html#5681455">os</a></span><span class="op" id="5682904">.</span><span class="ident" id="5682905">SEEK_SET</span><span class="op" id="5682913">)</span><span class="op" id="5682914">;</span>&nbsp;<span class="ident" id="5682916"><a href="/archive/zip/reader.go.html#5682665">err</a></span>&nbsp;<span class="op" id="5682920">!=</span>&nbsp;<span class="ident" id="5682923">nil</span>&nbsp;<span class="op" id="5682927">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682931">return</span>&nbsp;<span class="ident" id="5682938"><a href="/archive/zip/reader.go.html#5682665">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5682943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682946">buf</span>&nbsp;<span class="op" id="5682950">:=</span>&nbsp;<span class="ident" id="5682953"><a href="/archive/zip/reader.go.html#5681389">bufio</a></span><span class="op" id="5682958">.</span><span class="ident" id="5682959">NewReader</span><span class="op" id="5682968">(</span><span class="ident" id="5682969"><a href="/archive/zip/reader.go.html#5682815">rs</a></span><span class="op" id="5682971">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5682975">//&nbsp;The&nbsp;count&nbsp;of&nbsp;files&nbsp;inside&nbsp;a&nbsp;zip&nbsp;is&nbsp;truncated&nbsp;to&nbsp;fit&nbsp;in&nbsp;a&nbsp;uint16.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5683044">//&nbsp;Gloss&nbsp;over&nbsp;this&nbsp;by&nbsp;reading&nbsp;headers&nbsp;until&nbsp;we&nbsp;encounter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5683102">//&nbsp;a&nbsp;bad&nbsp;one,&nbsp;and&nbsp;then&nbsp;only&nbsp;report&nbsp;a&nbsp;ErrFormat&nbsp;or&nbsp;UnexpectedEOF&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5683170">//&nbsp;the&nbsp;file&nbsp;count&nbsp;modulo&nbsp;65536&nbsp;is&nbsp;incorrect.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683216">for</span>&nbsp;<span class="op" id="5683220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683224">f</span>&nbsp;<span class="op" id="5683226">:=</span>&nbsp;<span class="op" id="5683229">&amp;</span><span class="ident" id="5683230"><a href="/archive/zip/reader.go.html#5681778">File</a></span><span class="op" id="5683234">{</span><span class="ident" id="5683235">zipr</span><span class="op" id="5683239">:</span>&nbsp;<span class="ident" id="5683241"><a href="/archive/zip/reader.go.html#5682624">r</a></span><span class="op" id="5683242">,</span>&nbsp;<span class="ident" id="5683244">zipsize</span><span class="op" id="5683251">:</span>&nbsp;<span class="ident" id="5683253"><a href="/archive/zip/reader.go.html#5682639">size</a></span><span class="op" id="5683257">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683261"><a href="/archive/zip/reader.go.html#5682665">err</a></span>&nbsp;<span class="op" id="5683265">=</span>&nbsp;<span class="ident" id="5683267"><a href="/archive/zip/reader.go.html#5686450">readDirectoryHeader</a></span><span class="op" id="5683286">(</span><span class="ident" id="5683287"><a href="/archive/zip/reader.go.html#5683224">f</a></span><span class="op" id="5683288">,</span>&nbsp;<span class="ident" id="5683290"><a href="/archive/zip/reader.go.html#5682946">buf</a></span><span class="op" id="5683293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683297">if</span>&nbsp;<span class="ident" id="5683300"><a href="/archive/zip/reader.go.html#5682665">err</a></span>&nbsp;<span class="op" id="5683304">==</span>&nbsp;<span class="ident" id="5683307"><a href="/archive/zip/reader.go.html#5681470">ErrFormat</a></span>&nbsp;<span class="op" id="5683317">||</span>&nbsp;<span class="ident" id="5683320"><a href="/archive/zip/reader.go.html#5682665">err</a></span>&nbsp;<span class="op" id="5683324">==</span>&nbsp;<span class="ident" id="5683327"><a href="/archive/zip/reader.go.html#5681449">io</a></span><span class="op" id="5683329">.</span><span class="ident" id="5683330">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="5683347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683352">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5683360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683364">if</span>&nbsp;<span class="ident" id="5683367"><a href="/archive/zip/reader.go.html#5682665">err</a></span>&nbsp;<span class="op" id="5683371">!=</span>&nbsp;<span class="ident" id="5683374">nil</span>&nbsp;<span class="op" id="5683378">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683383">return</span>&nbsp;<span class="ident" id="5683390"><a href="/archive/zip/reader.go.html#5682665">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5683396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683400"><a href="/archive/zip/reader.go.html#5682608">z</a></span><span class="op" id="5683401">.</span><span class="ident" id="5683402">File</span>&nbsp;<span class="op" id="5683407">=</span>&nbsp;<span class="builtinfunc" id="5683409">append</span><span class="op" id="5683415">(</span><span class="ident" id="5683416"><a href="/archive/zip/reader.go.html#5682608">z</a></span><span class="op" id="5683417">.</span><span class="ident" id="5683418">File</span><span class="op" id="5683422">,</span>&nbsp;<span class="ident" id="5683424"><a href="/archive/zip/reader.go.html#5683224">f</a></span><span class="op" id="5683425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5683428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683431">if</span>&nbsp;<span class="builtintype" id="5683434">uint16</span><span class="op" id="5683440">(</span><span class="builtinfunc" id="5683441">len</span><span class="op" id="5683444">(</span><span class="ident" id="5683445"><a href="/archive/zip/reader.go.html#5682608">z</a></span><span class="op" id="5683446">.</span><span class="ident" id="5683447">File</span><span class="op" id="5683451">)</span><span class="op" id="5683452">)</span>&nbsp;<span class="op" id="5683454">!=</span>&nbsp;<span class="builtintype" id="5683457">uint16</span><span class="op" id="5683463">(</span><span class="ident" id="5683464"><a href="/archive/zip/reader.go.html#5682660">end</a></span><span class="op" id="5683467">.</span><span class="ident" id="5683468">directoryRecords</span><span class="op" id="5683484">)</span>&nbsp;<span class="op" id="5683486">{</span>&nbsp;<span class="comment" id="5683488">//&nbsp;only&nbsp;compare&nbsp;16&nbsp;bits&nbsp;here</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5683519">//&nbsp;Return&nbsp;the&nbsp;readDirectoryHeader&nbsp;error&nbsp;if&nbsp;we&nbsp;read</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5683572">//&nbsp;the&nbsp;wrong&nbsp;number&nbsp;of&nbsp;directory&nbsp;entries.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683616">return</span>&nbsp;<span class="ident" id="5683623"><a href="/archive/zip/reader.go.html#5682665">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5683628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683631">return</span>&nbsp;<span class="ident" id="5683638">nil</span><br>
<span class="lineno">110</span><span class="op" id="5683642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5683645">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Zip&nbsp;file,&nbsp;rendering&nbsp;it&nbsp;unusable&nbsp;for&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="keyword" id="5683706">func</span>&nbsp;<span class="op" id="5683711">(</span><span class="ident" id="5683712">rc</span>&nbsp;<span class="op" id="5683715">*</span><span class="ident" id="5683716"><a href="/archive/zip/reader.go.html#5681730">ReadCloser</a></span><span class="op" id="5683726">)</span>&nbsp;<span class="ident" id="5683728">Close</span><span class="op" id="5683733">(</span><span class="op" id="5683734">)</span>&nbsp;<span class="builtintype" id="5683736">error</span>&nbsp;<span class="op" id="5683742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683745">return</span>&nbsp;<span class="ident" id="5683752"><a href="/archive/zip/reader.go.html#5683712">rc</a></span><span class="op" id="5683754">.</span><span class="ident" id="5683755">f</span><span class="op" id="5683756">.</span><span class="ident" id="5683757">Close</span><span class="op" id="5683762">(</span><span class="op" id="5683763">)</span><br>
<span class="lineno">115</span><span class="op" id="5683765">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5683768">//&nbsp;DataOffset&nbsp;returns&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;file&#39;s&nbsp;possibly-compressed</span><br>
<span class="lineno"></span><span class="comment" id="5683835">//&nbsp;data,&nbsp;relative&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;zip&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="5683887">//</span><br>
<span class="lineno">120</span><span class="comment" id="5683890">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;instead&nbsp;use&nbsp;Open,&nbsp;which&nbsp;transparently</span><br>
<span class="lineno"></span><span class="comment" id="5683951">//&nbsp;decompresses&nbsp;data&nbsp;and&nbsp;verifies&nbsp;checksums.</span><br>
<span class="lineno"></span><span class="keyword" id="5683996">func</span>&nbsp;<span class="op" id="5684001">(</span><span class="ident" id="5684002">f</span>&nbsp;<span class="op" id="5684004">*</span><span class="ident" id="5684005"><a href="/archive/zip/reader.go.html#5681778">File</a></span><span class="op" id="5684009">)</span>&nbsp;<span class="ident" id="5684011">DataOffset</span><span class="op" id="5684021">(</span><span class="op" id="5684022">)</span>&nbsp;<span class="op" id="5684024">(</span><span class="ident" id="5684025">offset</span>&nbsp;<span class="ident" id="5684032">int64</span><span class="op" id="5684037">,</span>&nbsp;<span class="ident" id="5684039">err</span>&nbsp;<span class="builtintype" id="5684043">error</span><span class="op" id="5684048">)</span>&nbsp;<span class="op" id="5684050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684053">bodyOffset</span><span class="op" id="5684063">,</span>&nbsp;<span class="ident" id="5684065"><a href="/archive/zip/reader.go.html#5684039">err</a></span>&nbsp;<span class="op" id="5684069">:=</span>&nbsp;<span class="ident" id="5684072"><a href="/archive/zip/reader.go.html#5684002">f</a></span><span class="op" id="5684073">.</span><span class="ident" id="5684074">findBodyOffset</span><span class="op" id="5684088">(</span><span class="op" id="5684089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684092">if</span>&nbsp;<span class="ident" id="5684095"><a href="/archive/zip/reader.go.html#5684039">err</a></span>&nbsp;<span class="op" id="5684099">!=</span>&nbsp;<span class="ident" id="5684102">nil</span>&nbsp;<span class="op" id="5684106">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684110">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5684118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684121">return</span>&nbsp;<span class="ident" id="5684128"><a href="/archive/zip/reader.go.html#5684002">f</a></span><span class="op" id="5684129">.</span><span class="ident" id="5684130">headerOffset</span>&nbsp;<span class="op" id="5684143">+</span>&nbsp;<span class="ident" id="5684145"><a href="/archive/zip/reader.go.html#5684053">bodyOffset</a></span><span class="op" id="5684155">,</span>&nbsp;<span class="ident" id="5684157">nil</span><br>
<span class="lineno"></span><span class="op" id="5684161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="5684164">//&nbsp;Open&nbsp;returns&nbsp;a&nbsp;ReadCloser&nbsp;that&nbsp;provides&nbsp;access&nbsp;to&nbsp;the&nbsp;File&#39;s&nbsp;contents.</span><br>
<span class="lineno"></span><span class="comment" id="5684238">//&nbsp;Multiple&nbsp;files&nbsp;may&nbsp;be&nbsp;read&nbsp;concurrently.</span><br>
<span class="lineno"></span><span class="keyword" id="5684282">func</span>&nbsp;<span class="op" id="5684287">(</span><span class="ident" id="5684288">f</span>&nbsp;<span class="op" id="5684290">*</span><span class="ident" id="5684291"><a href="/archive/zip/reader.go.html#5681778">File</a></span><span class="op" id="5684295">)</span>&nbsp;<span class="ident" id="5684297">Open</span><span class="op" id="5684301">(</span><span class="op" id="5684302">)</span>&nbsp;<span class="op" id="5684304">(</span><span class="ident" id="5684305">rc</span>&nbsp;<span class="ident" id="5684308"><a href="/archive/zip/reader.go.html#5681449">io</a></span><span class="op" id="5684310">.</span><span class="ident" id="5684311">ReadCloser</span><span class="op" id="5684321">,</span>&nbsp;<span class="ident" id="5684323">err</span>&nbsp;<span class="builtintype" id="5684327">error</span><span class="op" id="5684332">)</span>&nbsp;<span class="op" id="5684334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684337">bodyOffset</span><span class="op" id="5684347">,</span>&nbsp;<span class="ident" id="5684349"><a href="/archive/zip/reader.go.html#5684323">err</a></span>&nbsp;<span class="op" id="5684353">:=</span>&nbsp;<span class="ident" id="5684356"><a href="/archive/zip/reader.go.html#5684288">f</a></span><span class="op" id="5684357">.</span><span class="ident" id="5684358">findBodyOffset</span><span class="op" id="5684372">(</span><span class="op" id="5684373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684376">if</span>&nbsp;<span class="ident" id="5684379"><a href="/archive/zip/reader.go.html#5684323">err</a></span>&nbsp;<span class="op" id="5684383">!=</span>&nbsp;<span class="ident" id="5684386">nil</span>&nbsp;<span class="op" id="5684390">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684394">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5684402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684405">size</span>&nbsp;<span class="op" id="5684410">:=</span>&nbsp;<span class="ident" id="5684413">int64</span><span class="op" id="5684418">(</span><span class="ident" id="5684419"><a href="/archive/zip/reader.go.html#5684288">f</a></span><span class="op" id="5684420">.</span><span class="ident" id="5684421">CompressedSize64</span><span class="op" id="5684437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684440">r</span>&nbsp;<span class="op" id="5684442">:=</span>&nbsp;<span class="ident" id="5684445"><a href="/archive/zip/reader.go.html#5681449">io</a></span><span class="op" id="5684447">.</span><span class="ident" id="5684448">NewSectionReader</span><span class="op" id="5684464">(</span><span class="ident" id="5684465"><a href="/archive/zip/reader.go.html#5684288">f</a></span><span class="op" id="5684466">.</span><span class="ident" id="5684467">zipr</span><span class="op" id="5684471">,</span>&nbsp;<span class="ident" id="5684473"><a href="/archive/zip/reader.go.html#5684288">f</a></span><span class="op" id="5684474">.</span><span class="ident" id="5684475">headerOffset</span><span class="op" id="5684487">+</span><span class="ident" id="5684488"><a href="/archive/zip/reader.go.html#5684337">bodyOffset</a></span><span class="op" id="5684498">,</span>&nbsp;<span class="ident" id="5684500"><a href="/archive/zip/reader.go.html#5684405">size</a></span><span class="op" id="5684504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684507">dcomp</span>&nbsp;<span class="op" id="5684513">:=</span>&nbsp;<span class="ident" id="5684516"><a href="/archive/zip/register.go.html#5696169">decompressor</a></span><span class="op" id="5684528">(</span><span class="ident" id="5684529"><a href="/archive/zip/reader.go.html#5684288">f</a></span><span class="op" id="5684530">.</span><span class="ident" id="5684531">Method</span><span class="op" id="5684537">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684540">if</span>&nbsp;<span class="ident" id="5684543"><a href="/archive/zip/reader.go.html#5684507">dcomp</a></span>&nbsp;<span class="op" id="5684549">==</span>&nbsp;<span class="ident" id="5684552">nil</span>&nbsp;<span class="op" id="5684556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684560"><a href="/archive/zip/reader.go.html#5684323">err</a></span>&nbsp;<span class="op" id="5684564">=</span>&nbsp;<span class="ident" id="5684566"><a href="/archive/zip/reader.go.html#5681526">ErrAlgorithm</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684581">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5684589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684592"><a href="/archive/zip/reader.go.html#5684305">rc</a></span>&nbsp;<span class="op" id="5684595">=</span>&nbsp;<span class="ident" id="5684597"><a href="/archive/zip/reader.go.html#5684507">dcomp</a></span><span class="op" id="5684602">(</span><span class="ident" id="5684603"><a href="/archive/zip/reader.go.html#5684440">r</a></span><span class="op" id="5684604">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684607">var</span>&nbsp;<span class="ident" id="5684611">desr</span>&nbsp;<span class="ident" id="5684616"><a href="/archive/zip/reader.go.html#5681449">io</a></span><span class="op" id="5684618">.</span><span class="ident" id="5684619">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684627">if</span>&nbsp;<span class="ident" id="5684630"><a href="/archive/zip/reader.go.html#5684288">f</a></span><span class="op" id="5684631">.</span><span class="ident" id="5684632">hasDataDescriptor</span><span class="op" id="5684649">(</span><span class="op" id="5684650">)</span>&nbsp;<span class="op" id="5684652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684656"><a href="/archive/zip/reader.go.html#5684611">desr</a></span>&nbsp;<span class="op" id="5684661">=</span>&nbsp;<span class="ident" id="5684663"><a href="/archive/zip/reader.go.html#5681449">io</a></span><span class="op" id="5684665">.</span><span class="ident" id="5684666">NewSectionReader</span><span class="op" id="5684682">(</span><span class="ident" id="5684683"><a href="/archive/zip/reader.go.html#5684288">f</a></span><span class="op" id="5684684">.</span><span class="ident" id="5684685">zipr</span><span class="op" id="5684689">,</span>&nbsp;<span class="ident" id="5684691"><a href="/archive/zip/reader.go.html#5684288">f</a></span><span class="op" id="5684692">.</span><span class="ident" id="5684693">headerOffset</span><span class="op" id="5684705">+</span><span class="ident" id="5684706"><a href="/archive/zip/reader.go.html#5684337">bodyOffset</a></span><span class="op" id="5684716">+</span><span class="ident" id="5684717"><a href="/archive/zip/reader.go.html#5684405">size</a></span><span class="op" id="5684721">,</span>&nbsp;<span class="ident" id="5684723"><a href="/archive/zip/struct.go.html#5697541">dataDescriptorLen</a></span><span class="op" id="5684740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5684743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684746"><a href="/archive/zip/reader.go.html#5684305">rc</a></span>&nbsp;<span class="op" id="5684749">=</span>&nbsp;<span class="op" id="5684751">&amp;</span><span class="ident" id="5684752"><a href="/archive/zip/reader.go.html#5684818">checksumReader</a></span><span class="op" id="5684766">{</span><span class="ident" id="5684767"><a href="/archive/zip/reader.go.html#5684305">rc</a></span><span class="op" id="5684769">,</span>&nbsp;<span class="ident" id="5684771"><a href="/archive/zip/reader.go.html#5681435">crc32</a></span><span class="op" id="5684776">.</span><span class="ident" id="5684777">NewIEEE</span><span class="op" id="5684784">(</span><span class="op" id="5684785">)</span><span class="op" id="5684786">,</span>&nbsp;<span class="ident" id="5684788"><a href="/archive/zip/reader.go.html#5684288">f</a></span><span class="op" id="5684789">,</span>&nbsp;<span class="ident" id="5684791"><a href="/archive/zip/reader.go.html#5684611">desr</a></span><span class="op" id="5684795">,</span>&nbsp;<span class="ident" id="5684797">nil</span><span class="op" id="5684800">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684803">return</span><br>
<span class="lineno"></span><span class="op" id="5684810">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5684813">type</span>&nbsp;<span class="ident" id="5684818">checksumReader</span>&nbsp;<span class="keyword" id="5684833">struct</span>&nbsp;<span class="op" id="5684840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684843">rc</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5684848"><a href="/archive/zip/reader.go.html#5681449">io</a></span><span class="op" id="5684850">.</span><span class="ident" id="5684851">ReadCloser</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684863">hash</span>&nbsp;<span class="ident" id="5684868"><a href="/archive/zip/reader.go.html#5681427">hash</a></span><span class="op" id="5684872">.</span><span class="ident" id="5684873">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684881">f</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5684886">*</span><span class="ident" id="5684887"><a href="/archive/zip/reader.go.html#5681778">File</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684893">desr</span>&nbsp;<span class="ident" id="5684898"><a href="/archive/zip/reader.go.html#5681449">io</a></span><span class="op" id="5684900">.</span><span class="ident" id="5684901">Reader</span>&nbsp;<span class="comment" id="5684908">//&nbsp;if&nbsp;non-nil,&nbsp;where&nbsp;to&nbsp;read&nbsp;the&nbsp;data&nbsp;descriptor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684958">err</span>&nbsp;&nbsp;<span class="builtintype" id="5684963">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5684973">//&nbsp;sticky&nbsp;error</span><br>
<span class="lineno"></span><span class="op" id="5684989">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="keyword" id="5684992">func</span>&nbsp;<span class="op" id="5684997">(</span><span class="ident" id="5684998">r</span>&nbsp;<span class="op" id="5685000">*</span><span class="ident" id="5685001"><a href="/archive/zip/reader.go.html#5684818">checksumReader</a></span><span class="op" id="5685015">)</span>&nbsp;<span class="ident" id="5685017">Read</span><span class="op" id="5685021">(</span><span class="ident" id="5685022">b</span>&nbsp;<span class="op" id="5685024">[</span><span class="op" id="5685025">]</span><span class="builtintype" id="5685026">byte</span><span class="op" id="5685030">)</span>&nbsp;<span class="op" id="5685032">(</span><span class="ident" id="5685033">n</span>&nbsp;<span class="builtintype" id="5685035">int</span><span class="op" id="5685038">,</span>&nbsp;<span class="ident" id="5685040">err</span>&nbsp;<span class="builtintype" id="5685044">error</span><span class="op" id="5685049">)</span>&nbsp;<span class="op" id="5685051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685054">if</span>&nbsp;<span class="ident" id="5685057"><a href="/archive/zip/reader.go.html#5684998">r</a></span><span class="op" id="5685058">.</span><span class="ident" id="5685059">err</span>&nbsp;<span class="op" id="5685063">!=</span>&nbsp;<span class="ident" id="5685066">nil</span>&nbsp;<span class="op" id="5685070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685074">return</span>&nbsp;<span class="num" id="5685081">0</span><span class="op" id="5685082">,</span>&nbsp;<span class="ident" id="5685084"><a href="/archive/zip/reader.go.html#5684998">r</a></span><span class="op" id="5685085">.</span><span class="ident" id="5685086">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5685091">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5685094"><a href="/archive/zip/reader.go.html#5685033">n</a></span><span class="op" id="5685095">,</span>&nbsp;<span class="ident" id="5685097"><a href="/archive/zip/reader.go.html#5685040">err</a></span>&nbsp;<span class="op" id="5685101">=</span>&nbsp;<span class="ident" id="5685103"><a href="/archive/zip/reader.go.html#5684998">r</a></span><span class="op" id="5685104">.</span><span class="ident" id="5685105">rc</span><span class="op" id="5685107">.</span><span class="ident" id="5685108">Read</span><span class="op" id="5685112">(</span><span class="ident" id="5685113"><a href="/archive/zip/reader.go.html#5685022">b</a></span><span class="op" id="5685114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5685117"><a href="/archive/zip/reader.go.html#5684998">r</a></span><span class="op" id="5685118">.</span><span class="ident" id="5685119">hash</span><span class="op" id="5685123">.</span><span class="ident" id="5685124">Write</span><span class="op" id="5685129">(</span><span class="ident" id="5685130"><a href="/archive/zip/reader.go.html#5685022">b</a></span><span class="op" id="5685131">[</span><span class="op" id="5685132">:</span><span class="ident" id="5685133"><a href="/archive/zip/reader.go.html#5685033">n</a></span><span class="op" id="5685134">]</span><span class="op" id="5685135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685138">if</span>&nbsp;<span class="ident" id="5685141"><a href="/archive/zip/reader.go.html#5685040">err</a></span>&nbsp;<span class="op" id="5685145">==</span>&nbsp;<span class="ident" id="5685148">nil</span>&nbsp;<span class="op" id="5685152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685156">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5685164">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685167">if</span>&nbsp;<span class="ident" id="5685170"><a href="/archive/zip/reader.go.html#5685040">err</a></span>&nbsp;<span class="op" id="5685174">==</span>&nbsp;<span class="ident" id="5685177"><a href="/archive/zip/reader.go.html#5681449">io</a></span><span class="op" id="5685179">.</span><span class="ident" id="5685180">EOF</span>&nbsp;<span class="op" id="5685184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685188">if</span>&nbsp;<span class="ident" id="5685191"><a href="/archive/zip/reader.go.html#5684998">r</a></span><span class="op" id="5685192">.</span><span class="ident" id="5685193">desr</span>&nbsp;<span class="op" id="5685198">!=</span>&nbsp;<span class="ident" id="5685201">nil</span>&nbsp;<span class="op" id="5685205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685210">if</span>&nbsp;<span class="ident" id="5685213">err1</span>&nbsp;<span class="op" id="5685218">:=</span>&nbsp;<span class="ident" id="5685221"><a href="/archive/zip/reader.go.html#5688346">readDataDescriptor</a></span><span class="op" id="5685239">(</span><span class="ident" id="5685240"><a href="/archive/zip/reader.go.html#5684998">r</a></span><span class="op" id="5685241">.</span><span class="ident" id="5685242">desr</span><span class="op" id="5685246">,</span>&nbsp;<span class="ident" id="5685248"><a href="/archive/zip/reader.go.html#5684998">r</a></span><span class="op" id="5685249">.</span><span class="ident" id="5685250">f</span><span class="op" id="5685251">)</span><span class="op" id="5685252">;</span>&nbsp;<span class="ident" id="5685254"><a href="/archive/zip/reader.go.html#5685213">err1</a></span>&nbsp;<span class="op" id="5685259">!=</span>&nbsp;<span class="ident" id="5685262">nil</span>&nbsp;<span class="op" id="5685266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5685272"><a href="/archive/zip/reader.go.html#5685040">err</a></span>&nbsp;<span class="op" id="5685276">=</span>&nbsp;<span class="ident" id="5685278"><a href="/archive/zip/reader.go.html#5685213">err1</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5685286">}</span>&nbsp;<span class="keyword" id="5685288">else</span>&nbsp;<span class="keyword" id="5685293">if</span>&nbsp;<span class="ident" id="5685296"><a href="/archive/zip/reader.go.html#5684998">r</a></span><span class="op" id="5685297">.</span><span class="ident" id="5685298">hash</span><span class="op" id="5685302">.</span><span class="ident" id="5685303">Sum32</span><span class="op" id="5685308">(</span><span class="op" id="5685309">)</span>&nbsp;<span class="op" id="5685311">!=</span>&nbsp;<span class="ident" id="5685314"><a href="/archive/zip/reader.go.html#5684998">r</a></span><span class="op" id="5685315">.</span><span class="ident" id="5685316">f</span><span class="op" id="5685317">.</span><span class="ident" id="5685318">CRC32</span>&nbsp;<span class="op" id="5685324">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5685330"><a href="/archive/zip/reader.go.html#5685040">err</a></span>&nbsp;<span class="op" id="5685334">=</span>&nbsp;<span class="ident" id="5685336"><a href="/archive/zip/reader.go.html#5681595">ErrChecksum</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5685351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5685355">}</span>&nbsp;<span class="keyword" id="5685357">else</span>&nbsp;<span class="op" id="5685362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5685367">//&nbsp;If&nbsp;there&#39;s&nbsp;not&nbsp;a&nbsp;data&nbsp;descriptor,&nbsp;we&nbsp;still&nbsp;compare</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5685424">//&nbsp;the&nbsp;CRC32&nbsp;of&nbsp;what&nbsp;we&#39;ve&nbsp;read&nbsp;against&nbsp;the&nbsp;file&nbsp;header</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5685483">//&nbsp;or&nbsp;TOC&#39;s&nbsp;CRC32,&nbsp;if&nbsp;it&nbsp;seems&nbsp;like&nbsp;it&nbsp;was&nbsp;set.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685534">if</span>&nbsp;<span class="ident" id="5685537"><a href="/archive/zip/reader.go.html#5684998">r</a></span><span class="op" id="5685538">.</span><span class="ident" id="5685539">f</span><span class="op" id="5685540">.</span><span class="ident" id="5685541">CRC32</span>&nbsp;<span class="op" id="5685547">!=</span>&nbsp;<span class="num" id="5685550">0</span>&nbsp;<span class="op" id="5685552">&amp;&amp;</span>&nbsp;<span class="ident" id="5685555"><a href="/archive/zip/reader.go.html#5684998">r</a></span><span class="op" id="5685556">.</span><span class="ident" id="5685557">hash</span><span class="op" id="5685561">.</span><span class="ident" id="5685562">Sum32</span><span class="op" id="5685567">(</span><span class="op" id="5685568">)</span>&nbsp;<span class="op" id="5685570">!=</span>&nbsp;<span class="ident" id="5685573"><a href="/archive/zip/reader.go.html#5684998">r</a></span><span class="op" id="5685574">.</span><span class="ident" id="5685575">f</span><span class="op" id="5685576">.</span><span class="ident" id="5685577">CRC32</span>&nbsp;<span class="op" id="5685583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5685589"><a href="/archive/zip/reader.go.html#5685040">err</a></span>&nbsp;<span class="op" id="5685593">=</span>&nbsp;<span class="ident" id="5685595"><a href="/archive/zip/reader.go.html#5681595">ErrChecksum</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5685610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5685614">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5685617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5685620"><a href="/archive/zip/reader.go.html#5684998">r</a></span><span class="op" id="5685621">.</span><span class="ident" id="5685622">err</span>&nbsp;<span class="op" id="5685626">=</span>&nbsp;<span class="ident" id="5685628"><a href="/archive/zip/reader.go.html#5685040">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685633">return</span><br>
<span class="lineno"></span><span class="op" id="5685640">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="5685643">func</span>&nbsp;<span class="op" id="5685648">(</span><span class="ident" id="5685649">r</span>&nbsp;<span class="op" id="5685651">*</span><span class="ident" id="5685652"><a href="/archive/zip/reader.go.html#5684818">checksumReader</a></span><span class="op" id="5685666">)</span>&nbsp;<span class="ident" id="5685668">Close</span><span class="op" id="5685673">(</span><span class="op" id="5685674">)</span>&nbsp;<span class="builtintype" id="5685676">error</span>&nbsp;<span class="op" id="5685682">{</span>&nbsp;<span class="keyword" id="5685684">return</span>&nbsp;<span class="ident" id="5685691"><a href="/archive/zip/reader.go.html#5685649">r</a></span><span class="op" id="5685692">.</span><span class="ident" id="5685693">rc</span><span class="op" id="5685695">.</span><span class="ident" id="5685696">Close</span><span class="op" id="5685701">(</span><span class="op" id="5685702">)</span>&nbsp;<span class="op" id="5685704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5685707">//&nbsp;findBodyOffset&nbsp;does&nbsp;the&nbsp;minimum&nbsp;work&nbsp;to&nbsp;verify&nbsp;the&nbsp;file&nbsp;has&nbsp;a&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="5685779">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;file&nbsp;body&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="5685816">func</span>&nbsp;<span class="op" id="5685821">(</span><span class="ident" id="5685822">f</span>&nbsp;<span class="op" id="5685824">*</span><span class="ident" id="5685825"><a href="/archive/zip/reader.go.html#5681778">File</a></span><span class="op" id="5685829">)</span>&nbsp;<span class="ident" id="5685831">findBodyOffset</span><span class="op" id="5685845">(</span><span class="op" id="5685846">)</span>&nbsp;<span class="op" id="5685848">(</span><span class="ident" id="5685849">int64</span><span class="op" id="5685854">,</span>&nbsp;<span class="builtintype" id="5685856">error</span><span class="op" id="5685861">)</span>&nbsp;<span class="op" id="5685863">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685866">var</span>&nbsp;<span class="ident" id="5685870">buf</span>&nbsp;<span class="op" id="5685874">[</span><span class="ident" id="5685875"><a href="/archive/zip/struct.go.html#5697357">fileHeaderLen</a></span><span class="op" id="5685888">]</span><span class="builtintype" id="5685889">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685895">if</span>&nbsp;<span class="ident" id="5685898">_</span><span class="op" id="5685899">,</span>&nbsp;<span class="ident" id="5685901">err</span>&nbsp;<span class="op" id="5685905">:=</span>&nbsp;<span class="ident" id="5685908"><a href="/archive/zip/reader.go.html#5685822">f</a></span><span class="op" id="5685909">.</span><span class="ident" id="5685910">zipr</span><span class="op" id="5685914">.</span><span class="ident" id="5685915">ReadAt</span><span class="op" id="5685921">(</span><span class="ident" id="5685922"><a href="/archive/zip/reader.go.html#5685870">buf</a></span><span class="op" id="5685925">[</span><span class="op" id="5685926">:</span><span class="op" id="5685927">]</span><span class="op" id="5685928">,</span>&nbsp;<span class="ident" id="5685930"><a href="/archive/zip/reader.go.html#5685822">f</a></span><span class="op" id="5685931">.</span><span class="ident" id="5685932">headerOffset</span><span class="op" id="5685944">)</span><span class="op" id="5685945">;</span>&nbsp;<span class="ident" id="5685947"><a href="/archive/zip/reader.go.html#5685901">err</a></span>&nbsp;<span class="op" id="5685951">!=</span>&nbsp;<span class="ident" id="5685954">nil</span>&nbsp;<span class="op" id="5685958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685962">return</span>&nbsp;<span class="num" id="5685969">0</span><span class="op" id="5685970">,</span>&nbsp;<span class="ident" id="5685972"><a href="/archive/zip/reader.go.html#5685901">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5685977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5685980">b</span>&nbsp;<span class="op" id="5685982">:=</span>&nbsp;<span class="ident" id="5685985"><a href="/archive/zip/reader.go.html#5693283">readBuf</a></span><span class="op" id="5685992">(</span><span class="ident" id="5685993"><a href="/archive/zip/reader.go.html#5685870">buf</a></span><span class="op" id="5685996">[</span><span class="op" id="5685997">:</span><span class="op" id="5685998">]</span><span class="op" id="5685999">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686002">if</span>&nbsp;<span class="ident" id="5686005">sig</span>&nbsp;<span class="op" id="5686009">:=</span>&nbsp;<span class="ident" id="5686012"><a href="/archive/zip/reader.go.html#5685980">b</a></span><span class="op" id="5686013">.</span><span class="builtintype" id="5686014">uint32</span><span class="op" id="5686020">(</span><span class="op" id="5686021">)</span><span class="op" id="5686022">;</span>&nbsp;<span class="ident" id="5686024"><a href="/archive/zip/reader.go.html#5686005">sig</a></span>&nbsp;<span class="op" id="5686028">!=</span>&nbsp;<span class="ident" id="5686031"><a href="/archive/zip/struct.go.html#5697077">fileHeaderSignature</a></span>&nbsp;<span class="op" id="5686051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686055">return</span>&nbsp;<span class="num" id="5686062">0</span><span class="op" id="5686063">,</span>&nbsp;<span class="ident" id="5686065"><a href="/archive/zip/reader.go.html#5681470">ErrFormat</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5686076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686079"><a href="/archive/zip/reader.go.html#5685980">b</a></span>&nbsp;<span class="op" id="5686081">=</span>&nbsp;<span class="ident" id="5686083"><a href="/archive/zip/reader.go.html#5685980">b</a></span><span class="op" id="5686084">[</span><span class="num" id="5686085">22</span><span class="op" id="5686087">:</span><span class="op" id="5686088">]</span>&nbsp;<span class="comment" id="5686090">//&nbsp;skip&nbsp;over&nbsp;most&nbsp;of&nbsp;the&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686123">filenameLen</span>&nbsp;<span class="op" id="5686135">:=</span>&nbsp;<span class="builtintype" id="5686138">int</span><span class="op" id="5686141">(</span><span class="ident" id="5686142"><a href="/archive/zip/reader.go.html#5685980">b</a></span><span class="op" id="5686143">.</span><span class="builtintype" id="5686144">uint16</span><span class="op" id="5686150">(</span><span class="op" id="5686151">)</span><span class="op" id="5686152">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686155">extraLen</span>&nbsp;<span class="op" id="5686164">:=</span>&nbsp;<span class="builtintype" id="5686167">int</span><span class="op" id="5686170">(</span><span class="ident" id="5686171"><a href="/archive/zip/reader.go.html#5685980">b</a></span><span class="op" id="5686172">.</span><span class="builtintype" id="5686173">uint16</span><span class="op" id="5686179">(</span><span class="op" id="5686180">)</span><span class="op" id="5686181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686184">return</span>&nbsp;<span class="ident" id="5686191">int64</span><span class="op" id="5686196">(</span><span class="ident" id="5686197"><a href="/archive/zip/struct.go.html#5697357">fileHeaderLen</a></span>&nbsp;<span class="op" id="5686211">+</span>&nbsp;<span class="ident" id="5686213"><a href="/archive/zip/reader.go.html#5686123">filenameLen</a></span>&nbsp;<span class="op" id="5686225">+</span>&nbsp;<span class="ident" id="5686227"><a href="/archive/zip/reader.go.html#5686155">extraLen</a></span><span class="op" id="5686235">)</span><span class="op" id="5686236">,</span>&nbsp;<span class="ident" id="5686238">nil</span><br>
<span class="lineno"></span><span class="op" id="5686242">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5686245">//&nbsp;readDirectoryHeader&nbsp;attempts&nbsp;to&nbsp;read&nbsp;a&nbsp;directory&nbsp;header&nbsp;from&nbsp;r.</span><br>
<span class="lineno">210</span><span class="comment" id="5686312">//&nbsp;It&nbsp;returns&nbsp;io.ErrUnexpectedEOF&nbsp;if&nbsp;it&nbsp;cannot&nbsp;read&nbsp;a&nbsp;complete&nbsp;header,</span><br>
<span class="lineno"></span><span class="comment" id="5686383">//&nbsp;and&nbsp;ErrFormat&nbsp;if&nbsp;it&nbsp;doesn&#39;t&nbsp;find&nbsp;a&nbsp;valid&nbsp;header&nbsp;signature.</span><br>
<span class="lineno"></span><span class="keyword" id="5686445">func</span>&nbsp;<span class="ident" id="5686450">readDirectoryHeader</span><span class="op" id="5686469">(</span><span class="ident" id="5686470">f</span>&nbsp;<span class="op" id="5686472">*</span><span class="ident" id="5686473"><a href="/archive/zip/reader.go.html#5681778">File</a></span><span class="op" id="5686477">,</span>&nbsp;<span class="ident" id="5686479">r</span>&nbsp;<span class="ident" id="5686481"><a href="/archive/zip/reader.go.html#5681449">io</a></span><span class="op" id="5686483">.</span><span class="ident" id="5686484">Reader</span><span class="op" id="5686490">)</span>&nbsp;<span class="builtintype" id="5686492">error</span>&nbsp;<span class="op" id="5686498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686501">var</span>&nbsp;<span class="ident" id="5686505">buf</span>&nbsp;<span class="op" id="5686509">[</span><span class="ident" id="5686510"><a href="/archive/zip/struct.go.html#5697418">directoryHeaderLen</a></span><span class="op" id="5686528">]</span><span class="builtintype" id="5686529">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686535">if</span>&nbsp;<span class="ident" id="5686538">_</span><span class="op" id="5686539">,</span>&nbsp;<span class="ident" id="5686541">err</span>&nbsp;<span class="op" id="5686545">:=</span>&nbsp;<span class="ident" id="5686548"><a href="/archive/zip/reader.go.html#5681449">io</a></span><span class="op" id="5686550">.</span><span class="ident" id="5686551">ReadFull</span><span class="op" id="5686559">(</span><span class="ident" id="5686560"><a href="/archive/zip/reader.go.html#5686479">r</a></span><span class="op" id="5686561">,</span>&nbsp;<span class="ident" id="5686563"><a href="/archive/zip/reader.go.html#5686505">buf</a></span><span class="op" id="5686566">[</span><span class="op" id="5686567">:</span><span class="op" id="5686568">]</span><span class="op" id="5686569">)</span><span class="op" id="5686570">;</span>&nbsp;<span class="ident" id="5686572"><a href="/archive/zip/reader.go.html#5686541">err</a></span>&nbsp;<span class="op" id="5686576">!=</span>&nbsp;<span class="ident" id="5686579">nil</span>&nbsp;<span class="op" id="5686583">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686587">return</span>&nbsp;<span class="ident" id="5686594"><a href="/archive/zip/reader.go.html#5686541">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5686599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686602">b</span>&nbsp;<span class="op" id="5686604">:=</span>&nbsp;<span class="ident" id="5686607"><a href="/archive/zip/reader.go.html#5693283">readBuf</a></span><span class="op" id="5686614">(</span><span class="ident" id="5686615"><a href="/archive/zip/reader.go.html#5686505">buf</a></span><span class="op" id="5686618">[</span><span class="op" id="5686619">:</span><span class="op" id="5686620">]</span><span class="op" id="5686621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686624">if</span>&nbsp;<span class="ident" id="5686627">sig</span>&nbsp;<span class="op" id="5686631">:=</span>&nbsp;<span class="ident" id="5686634"><a href="/archive/zip/reader.go.html#5686602">b</a></span><span class="op" id="5686635">.</span><span class="builtintype" id="5686636">uint32</span><span class="op" id="5686642">(</span><span class="op" id="5686643">)</span><span class="op" id="5686644">;</span>&nbsp;<span class="ident" id="5686646"><a href="/archive/zip/reader.go.html#5686627">sig</a></span>&nbsp;<span class="op" id="5686650">!=</span>&nbsp;<span class="ident" id="5686653"><a href="/archive/zip/struct.go.html#5697116">directoryHeaderSignature</a></span>&nbsp;<span class="op" id="5686678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686682">return</span>&nbsp;<span class="ident" id="5686689"><a href="/archive/zip/reader.go.html#5681470">ErrFormat</a></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5686700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686703"><a href="/archive/zip/reader.go.html#5686470">f</a></span><span class="op" id="5686704">.</span><span class="ident" id="5686705">CreatorVersion</span>&nbsp;<span class="op" id="5686720">=</span>&nbsp;<span class="ident" id="5686722"><a href="/archive/zip/reader.go.html#5686602">b</a></span><span class="op" id="5686723">.</span><span class="builtintype" id="5686724">uint16</span><span class="op" id="5686730">(</span><span class="op" id="5686731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686734"><a href="/archive/zip/reader.go.html#5686470">f</a></span><span class="op" id="5686735">.</span><span class="ident" id="5686736">ReaderVersion</span>&nbsp;<span class="op" id="5686750">=</span>&nbsp;<span class="ident" id="5686752"><a href="/archive/zip/reader.go.html#5686602">b</a></span><span class="op" id="5686753">.</span><span class="builtintype" id="5686754">uint16</span><span class="op" id="5686760">(</span><span class="op" id="5686761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686764"><a href="/archive/zip/reader.go.html#5686470">f</a></span><span class="op" id="5686765">.</span><span class="ident" id="5686766">Flags</span>&nbsp;<span class="op" id="5686772">=</span>&nbsp;<span class="ident" id="5686774"><a href="/archive/zip/reader.go.html#5686602">b</a></span><span class="op" id="5686775">.</span><span class="builtintype" id="5686776">uint16</span><span class="op" id="5686782">(</span><span class="op" id="5686783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686786"><a href="/archive/zip/reader.go.html#5686470">f</a></span><span class="op" id="5686787">.</span><span class="ident" id="5686788">Method</span>&nbsp;<span class="op" id="5686795">=</span>&nbsp;<span class="ident" id="5686797"><a href="/archive/zip/reader.go.html#5686602">b</a></span><span class="op" id="5686798">.</span><span class="builtintype" id="5686799">uint16</span><span class="op" id="5686805">(</span><span class="op" id="5686806">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686809"><a href="/archive/zip/reader.go.html#5686470">f</a></span><span class="op" id="5686810">.</span><span class="ident" id="5686811">ModifiedTime</span>&nbsp;<span class="op" id="5686824">=</span>&nbsp;<span class="ident" id="5686826"><a href="/archive/zip/reader.go.html#5686602">b</a></span><span class="op" id="5686827">.</span><span class="builtintype" id="5686828">uint16</span><span class="op" id="5686834">(</span><span class="op" id="5686835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686838"><a href="/archive/zip/reader.go.html#5686470">f</a></span><span class="op" id="5686839">.</span><span class="ident" id="5686840">ModifiedDate</span>&nbsp;<span class="op" id="5686853">=</span>&nbsp;<span class="ident" id="5686855"><a href="/archive/zip/reader.go.html#5686602">b</a></span><span class="op" id="5686856">.</span><span class="builtintype" id="5686857">uint16</span><span class="op" id="5686863">(</span><span class="op" id="5686864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686867"><a href="/archive/zip/reader.go.html#5686470">f</a></span><span class="op" id="5686868">.</span><span class="ident" id="5686869">CRC32</span>&nbsp;<span class="op" id="5686875">=</span>&nbsp;<span class="ident" id="5686877"><a href="/archive/zip/reader.go.html#5686602">b</a></span><span class="op" id="5686878">.</span><span class="builtintype" id="5686879">uint32</span><span class="op" id="5686885">(</span><span class="op" id="5686886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686889"><a href="/archive/zip/reader.go.html#5686470">f</a></span><span class="op" id="5686890">.</span><span class="ident" id="5686891">CompressedSize</span>&nbsp;<span class="op" id="5686906">=</span>&nbsp;<span class="ident" id="5686908"><a href="/archive/zip/reader.go.html#5686602">b</a></span><span class="op" id="5686909">.</span><span class="builtintype" id="5686910">uint32</span><span class="op" id="5686916">(</span><span class="op" id="5686917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686920"><a href="/archive/zip/reader.go.html#5686470">f</a></span><span class="op" id="5686921">.</span><span class="ident" id="5686922">UncompressedSize</span>&nbsp;<span class="op" id="5686939">=</span>&nbsp;<span class="ident" id="5686941"><a href="/archive/zip/reader.go.html#5686602">b</a></span><span class="op" id="5686942">.</span><span class="builtintype" id="5686943">uint32</span><span class="op" id="5686949">(</span><span class="op" id="5686950">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686953"><a href="/archive/zip/reader.go.html#5686470">f</a></span><span class="op" id="5686954">.</span><span class="ident" id="5686955">CompressedSize64</span>&nbsp;<span class="op" id="5686972">=</span>&nbsp;<span class="ident" id="5686974">uint64</span><span class="op" id="5686980">(</span><span class="ident" id="5686981"><a href="/archive/zip/reader.go.html#5686470">f</a></span><span class="op" id="5686982">.</span><span class="ident" id="5686983">CompressedSize</span><span class="op" id="5686997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687000"><a href="/archive/zip/reader.go.html#5686470">f</a></span><span class="op" id="5687001">.</span><span class="ident" id="5687002">UncompressedSize64</span>&nbsp;<span class="op" id="5687021">=</span>&nbsp;<span class="ident" id="5687023">uint64</span><span class="op" id="5687029">(</span><span class="ident" id="5687030"><a href="/archive/zip/reader.go.html#5686470">f</a></span><span class="op" id="5687031">.</span><span class="ident" id="5687032">UncompressedSize</span><span class="op" id="5687048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687051">filenameLen</span>&nbsp;<span class="op" id="5687063">:=</span>&nbsp;<span class="builtintype" id="5687066">int</span><span class="op" id="5687069">(</span><span class="ident" id="5687070"><a href="/archive/zip/reader.go.html#5686602">b</a></span><span class="op" id="5687071">.</span><span class="builtintype" id="5687072">uint16</span><span class="op" id="5687078">(</span><span class="op" id="5687079">)</span><span class="op" id="5687080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687083">extraLen</span>&nbsp;<span class="op" id="5687092">:=</span>&nbsp;<span class="builtintype" id="5687095">int</span><span class="op" id="5687098">(</span><span class="ident" id="5687099"><a href="/archive/zip/reader.go.html#5686602">b</a></span><span class="op" id="5687100">.</span><span class="builtintype" id="5687101">uint16</span><span class="op" id="5687107">(</span><span class="op" id="5687108">)</span><span class="op" id="5687109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687112">commentLen</span>&nbsp;<span class="op" id="5687123">:=</span>&nbsp;<span class="builtintype" id="5687126">int</span><span class="op" id="5687129">(</span><span class="ident" id="5687130"><a href="/archive/zip/reader.go.html#5686602">b</a></span><span class="op" id="5687131">.</span><span class="builtintype" id="5687132">uint16</span><span class="op" id="5687138">(</span><span class="op" id="5687139">)</span><span class="op" id="5687140">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687143"><a href="/archive/zip/reader.go.html#5686602">b</a></span>&nbsp;<span class="op" id="5687145">=</span>&nbsp;<span class="ident" id="5687147"><a href="/archive/zip/reader.go.html#5686602">b</a></span><span class="op" id="5687148">[</span><span class="num" id="5687149">4</span><span class="op" id="5687150">:</span><span class="op" id="5687151">]</span>&nbsp;<span class="comment" id="5687153">//&nbsp;skipped&nbsp;start&nbsp;disk&nbsp;number&nbsp;and&nbsp;internal&nbsp;attributes&nbsp;(2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687219"><a href="/archive/zip/reader.go.html#5686470">f</a></span><span class="op" id="5687220">.</span><span class="ident" id="5687221">ExternalAttrs</span>&nbsp;<span class="op" id="5687235">=</span>&nbsp;<span class="ident" id="5687237"><a href="/archive/zip/reader.go.html#5686602">b</a></span><span class="op" id="5687238">.</span><span class="builtintype" id="5687239">uint32</span><span class="op" id="5687245">(</span><span class="op" id="5687246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687249"><a href="/archive/zip/reader.go.html#5686470">f</a></span><span class="op" id="5687250">.</span><span class="ident" id="5687251">headerOffset</span>&nbsp;<span class="op" id="5687264">=</span>&nbsp;<span class="ident" id="5687266">int64</span><span class="op" id="5687271">(</span><span class="ident" id="5687272"><a href="/archive/zip/reader.go.html#5686602">b</a></span><span class="op" id="5687273">.</span><span class="builtintype" id="5687274">uint32</span><span class="op" id="5687280">(</span><span class="op" id="5687281">)</span><span class="op" id="5687282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687285">d</span>&nbsp;<span class="op" id="5687287">:=</span>&nbsp;<span class="builtinfunc" id="5687290">make</span><span class="op" id="5687294">(</span><span class="op" id="5687295">[</span><span class="op" id="5687296">]</span><span class="builtintype" id="5687297">byte</span><span class="op" id="5687301">,</span>&nbsp;<span class="ident" id="5687303"><a href="/archive/zip/reader.go.html#5687051">filenameLen</a></span><span class="op" id="5687314">+</span><span class="ident" id="5687315"><a href="/archive/zip/reader.go.html#5687083">extraLen</a></span><span class="op" id="5687323">+</span><span class="ident" id="5687324"><a href="/archive/zip/reader.go.html#5687112">commentLen</a></span><span class="op" id="5687334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687337">if</span>&nbsp;<span class="ident" id="5687340">_</span><span class="op" id="5687341">,</span>&nbsp;<span class="ident" id="5687343">err</span>&nbsp;<span class="op" id="5687347">:=</span>&nbsp;<span class="ident" id="5687350"><a href="/archive/zip/reader.go.html#5681449">io</a></span><span class="op" id="5687352">.</span><span class="ident" id="5687353">ReadFull</span><span class="op" id="5687361">(</span><span class="ident" id="5687362"><a href="/archive/zip/reader.go.html#5686479">r</a></span><span class="op" id="5687363">,</span>&nbsp;<span class="ident" id="5687365"><a href="/archive/zip/reader.go.html#5687285">d</a></span><span class="op" id="5687366">)</span><span class="op" id="5687367">;</span>&nbsp;<span class="ident" id="5687369"><a href="/archive/zip/reader.go.html#5687343">err</a></span>&nbsp;<span class="op" id="5687373">!=</span>&nbsp;<span class="ident" id="5687376">nil</span>&nbsp;<span class="op" id="5687380">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687384">return</span>&nbsp;<span class="ident" id="5687391"><a href="/archive/zip/reader.go.html#5687343">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5687396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687399"><a href="/archive/zip/reader.go.html#5686470">f</a></span><span class="op" id="5687400">.</span><span class="ident" id="5687401">Name</span>&nbsp;<span class="op" id="5687406">=</span>&nbsp;<span class="builtintype" id="5687408">string</span><span class="op" id="5687414">(</span><span class="ident" id="5687415"><a href="/archive/zip/reader.go.html#5687285">d</a></span><span class="op" id="5687416">[</span><span class="op" id="5687417">:</span><span class="ident" id="5687418"><a href="/archive/zip/reader.go.html#5687051">filenameLen</a></span><span class="op" id="5687429">]</span><span class="op" id="5687430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687433"><a href="/archive/zip/reader.go.html#5686470">f</a></span><span class="op" id="5687434">.</span><span class="ident" id="5687435">Extra</span>&nbsp;<span class="op" id="5687441">=</span>&nbsp;<span class="ident" id="5687443"><a href="/archive/zip/reader.go.html#5687285">d</a></span><span class="op" id="5687444">[</span><span class="ident" id="5687445"><a href="/archive/zip/reader.go.html#5687051">filenameLen</a></span>&nbsp;<span class="op" id="5687457">:</span>&nbsp;<span class="ident" id="5687459"><a href="/archive/zip/reader.go.html#5687051">filenameLen</a></span><span class="op" id="5687470">+</span><span class="ident" id="5687471"><a href="/archive/zip/reader.go.html#5687083">extraLen</a></span><span class="op" id="5687479">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687482"><a href="/archive/zip/reader.go.html#5686470">f</a></span><span class="op" id="5687483">.</span><span class="ident" id="5687484">Comment</span>&nbsp;<span class="op" id="5687492">=</span>&nbsp;<span class="builtintype" id="5687494">string</span><span class="op" id="5687500">(</span><span class="ident" id="5687501"><a href="/archive/zip/reader.go.html#5687285">d</a></span><span class="op" id="5687502">[</span><span class="ident" id="5687503"><a href="/archive/zip/reader.go.html#5687051">filenameLen</a></span><span class="op" id="5687514">+</span><span class="ident" id="5687515"><a href="/archive/zip/reader.go.html#5687083">extraLen</a></span><span class="op" id="5687523">:</span><span class="op" id="5687524">]</span><span class="op" id="5687525">)</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687529">if</span>&nbsp;<span class="builtinfunc" id="5687532">len</span><span class="op" id="5687535">(</span><span class="ident" id="5687536"><a href="/archive/zip/reader.go.html#5686470">f</a></span><span class="op" id="5687537">.</span><span class="ident" id="5687538">Extra</span><span class="op" id="5687543">)</span>&nbsp;<span class="op" id="5687545">&gt;</span>&nbsp;<span class="num" id="5687547">0</span>&nbsp;<span class="op" id="5687549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687553">b</span>&nbsp;<span class="op" id="5687555">:=</span>&nbsp;<span class="ident" id="5687558"><a href="/archive/zip/reader.go.html#5693283">readBuf</a></span><span class="op" id="5687565">(</span><span class="ident" id="5687566"><a href="/archive/zip/reader.go.html#5686470">f</a></span><span class="op" id="5687567">.</span><span class="ident" id="5687568">Extra</span><span class="op" id="5687573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687577">for</span>&nbsp;<span class="builtinfunc" id="5687581">len</span><span class="op" id="5687584">(</span><span class="ident" id="5687585"><a href="/archive/zip/reader.go.html#5687553">b</a></span><span class="op" id="5687586">)</span>&nbsp;<span class="op" id="5687588">&gt;=</span>&nbsp;<span class="num" id="5687591">4</span>&nbsp;<span class="op" id="5687593">{</span>&nbsp;<span class="comment" id="5687595">//&nbsp;need&nbsp;at&nbsp;least&nbsp;tag&nbsp;and&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687628">tag</span>&nbsp;<span class="op" id="5687632">:=</span>&nbsp;<span class="ident" id="5687635"><a href="/archive/zip/reader.go.html#5687553">b</a></span><span class="op" id="5687636">.</span><span class="builtintype" id="5687637">uint16</span><span class="op" id="5687643">(</span><span class="op" id="5687644">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687649">size</span>&nbsp;<span class="op" id="5687654">:=</span>&nbsp;<span class="ident" id="5687657"><a href="/archive/zip/reader.go.html#5687553">b</a></span><span class="op" id="5687658">.</span><span class="builtintype" id="5687659">uint16</span><span class="op" id="5687665">(</span><span class="op" id="5687666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687671">if</span>&nbsp;<span class="builtintype" id="5687674">int</span><span class="op" id="5687677">(</span><span class="ident" id="5687678"><a href="/archive/zip/reader.go.html#5687649">size</a></span><span class="op" id="5687682">)</span>&nbsp;<span class="op" id="5687684">&gt;</span>&nbsp;<span class="builtinfunc" id="5687686">len</span><span class="op" id="5687689">(</span><span class="ident" id="5687690"><a href="/archive/zip/reader.go.html#5687553">b</a></span><span class="op" id="5687691">)</span>&nbsp;<span class="op" id="5687693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687699">return</span>&nbsp;<span class="ident" id="5687706"><a href="/archive/zip/reader.go.html#5681470">ErrFormat</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5687719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687724">if</span>&nbsp;<span class="ident" id="5687727"><a href="/archive/zip/reader.go.html#5687628">tag</a></span>&nbsp;<span class="op" id="5687731">==</span>&nbsp;<span class="ident" id="5687734"><a href="/archive/zip/struct.go.html#5698176">zip64ExtraId</a></span>&nbsp;<span class="op" id="5687747">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5687753">//&nbsp;update&nbsp;directory&nbsp;values&nbsp;from&nbsp;the&nbsp;zip64&nbsp;extra&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687811">eb</span>&nbsp;<span class="op" id="5687814">:=</span>&nbsp;<span class="ident" id="5687817"><a href="/archive/zip/reader.go.html#5693283">readBuf</a></span><span class="op" id="5687824">(</span><span class="ident" id="5687825"><a href="/archive/zip/reader.go.html#5687553">b</a></span><span class="op" id="5687826">[</span><span class="op" id="5687827">:</span><span class="ident" id="5687828"><a href="/archive/zip/reader.go.html#5687649">size</a></span><span class="op" id="5687832">]</span><span class="op" id="5687833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687839">if</span>&nbsp;<span class="builtinfunc" id="5687842">len</span><span class="op" id="5687845">(</span><span class="ident" id="5687846"><a href="/archive/zip/reader.go.html#5687811">eb</a></span><span class="op" id="5687848">)</span>&nbsp;<span class="op" id="5687850">&gt;=</span>&nbsp;<span class="num" id="5687853">8</span>&nbsp;<span class="op" id="5687855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687862"><a href="/archive/zip/reader.go.html#5686470">f</a></span><span class="op" id="5687863">.</span><span class="ident" id="5687864">UncompressedSize64</span>&nbsp;<span class="op" id="5687883">=</span>&nbsp;<span class="ident" id="5687885"><a href="/archive/zip/reader.go.html#5687811">eb</a></span><span class="op" id="5687887">.</span><span class="ident" id="5687888">uint64</span><span class="op" id="5687894">(</span><span class="op" id="5687895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5687901">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687907">if</span>&nbsp;<span class="builtinfunc" id="5687910">len</span><span class="op" id="5687913">(</span><span class="ident" id="5687914"><a href="/archive/zip/reader.go.html#5687811">eb</a></span><span class="op" id="5687916">)</span>&nbsp;<span class="op" id="5687918">&gt;=</span>&nbsp;<span class="num" id="5687921">8</span>&nbsp;<span class="op" id="5687923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687930"><a href="/archive/zip/reader.go.html#5686470">f</a></span><span class="op" id="5687931">.</span><span class="ident" id="5687932">CompressedSize64</span>&nbsp;<span class="op" id="5687949">=</span>&nbsp;<span class="ident" id="5687951"><a href="/archive/zip/reader.go.html#5687811">eb</a></span><span class="op" id="5687953">.</span><span class="ident" id="5687954">uint64</span><span class="op" id="5687960">(</span><span class="op" id="5687961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5687967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687973">if</span>&nbsp;<span class="builtinfunc" id="5687976">len</span><span class="op" id="5687979">(</span><span class="ident" id="5687980"><a href="/archive/zip/reader.go.html#5687811">eb</a></span><span class="op" id="5687982">)</span>&nbsp;<span class="op" id="5687984">&gt;=</span>&nbsp;<span class="num" id="5687987">8</span>&nbsp;<span class="op" id="5687989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687996"><a href="/archive/zip/reader.go.html#5686470">f</a></span><span class="op" id="5687997">.</span><span class="ident" id="5687998">headerOffset</span>&nbsp;<span class="op" id="5688011">=</span>&nbsp;<span class="ident" id="5688013">int64</span><span class="op" id="5688018">(</span><span class="ident" id="5688019"><a href="/archive/zip/reader.go.html#5687811">eb</a></span><span class="op" id="5688021">.</span><span class="ident" id="5688022">uint64</span><span class="op" id="5688028">(</span><span class="op" id="5688029">)</span><span class="op" id="5688030">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5688036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5688041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688046"><a href="/archive/zip/reader.go.html#5687553">b</a></span>&nbsp;<span class="op" id="5688048">=</span>&nbsp;<span class="ident" id="5688050"><a href="/archive/zip/reader.go.html#5687553">b</a></span><span class="op" id="5688051">[</span><span class="ident" id="5688052"><a href="/archive/zip/reader.go.html#5687649">size</a></span><span class="op" id="5688056">:</span><span class="op" id="5688057">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5688061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5688065">//&nbsp;Should&nbsp;have&nbsp;consumed&nbsp;the&nbsp;whole&nbsp;header.</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5688109">//&nbsp;But&nbsp;popular&nbsp;zip&nbsp;&amp;&nbsp;JAR&nbsp;creation&nbsp;tools&nbsp;are&nbsp;broken&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5688166">//&nbsp;may&nbsp;pad&nbsp;extra&nbsp;zeros&nbsp;at&nbsp;the&nbsp;end,&nbsp;so&nbsp;accept&nbsp;those</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5688219">//&nbsp;too.&nbsp;See&nbsp;golang.org/issue/8186.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688256">for</span>&nbsp;<span class="ident" id="5688260">_</span><span class="op" id="5688261">,</span>&nbsp;<span class="ident" id="5688263">v</span>&nbsp;<span class="op" id="5688265">:=</span>&nbsp;<span class="keyword" id="5688268">range</span>&nbsp;<span class="ident" id="5688274"><a href="/archive/zip/reader.go.html#5687553">b</a></span>&nbsp;<span class="op" id="5688276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688281">if</span>&nbsp;<span class="ident" id="5688284"><a href="/archive/zip/reader.go.html#5688263">v</a></span>&nbsp;<span class="op" id="5688286">!=</span>&nbsp;<span class="num" id="5688289">0</span>&nbsp;<span class="op" id="5688291">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688297">return</span>&nbsp;<span class="ident" id="5688304"><a href="/archive/zip/reader.go.html#5681470">ErrFormat</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5688317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5688321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5688324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688327">return</span>&nbsp;<span class="ident" id="5688334">nil</span><br>
<span class="lineno">280</span><span class="op" id="5688338">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5688341">func</span>&nbsp;<span class="ident" id="5688346">readDataDescriptor</span><span class="op" id="5688364">(</span><span class="ident" id="5688365">r</span>&nbsp;<span class="ident" id="5688367"><a href="/archive/zip/reader.go.html#5681449">io</a></span><span class="op" id="5688369">.</span><span class="ident" id="5688370">Reader</span><span class="op" id="5688376">,</span>&nbsp;<span class="ident" id="5688378">f</span>&nbsp;<span class="op" id="5688380">*</span><span class="ident" id="5688381"><a href="/archive/zip/reader.go.html#5681778">File</a></span><span class="op" id="5688385">)</span>&nbsp;<span class="builtintype" id="5688387">error</span>&nbsp;<span class="op" id="5688393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688396">var</span>&nbsp;<span class="ident" id="5688400">buf</span>&nbsp;<span class="op" id="5688404">[</span><span class="ident" id="5688405"><a href="/archive/zip/struct.go.html#5697541">dataDescriptorLen</a></span><span class="op" id="5688422">]</span><span class="builtintype" id="5688423">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5688430">//&nbsp;The&nbsp;spec&nbsp;says:&nbsp;&#34;Although&nbsp;not&nbsp;originally&nbsp;assigned&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5688485">//&nbsp;signature,&nbsp;the&nbsp;value&nbsp;0x08074b50&nbsp;has&nbsp;commonly&nbsp;been&nbsp;adopted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5688547">//&nbsp;as&nbsp;a&nbsp;signature&nbsp;value&nbsp;for&nbsp;the&nbsp;data&nbsp;descriptor&nbsp;record.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5688604">//&nbsp;Implementers&nbsp;should&nbsp;be&nbsp;aware&nbsp;that&nbsp;ZIP&nbsp;files&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5688659">//&nbsp;encountered&nbsp;with&nbsp;or&nbsp;without&nbsp;this&nbsp;signature&nbsp;marking&nbsp;data</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5688719">//&nbsp;descriptors&nbsp;and&nbsp;should&nbsp;account&nbsp;for&nbsp;either&nbsp;case&nbsp;when&nbsp;reading</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5688783">//&nbsp;ZIP&nbsp;files&nbsp;to&nbsp;ensure&nbsp;compatibility.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5688823">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5688827">//&nbsp;dataDescriptorLen&nbsp;includes&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;signature&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5688888">//&nbsp;first&nbsp;read&nbsp;just&nbsp;those&nbsp;4&nbsp;bytes&nbsp;to&nbsp;see&nbsp;if&nbsp;it&nbsp;exists.</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688943">if</span>&nbsp;<span class="ident" id="5688946">_</span><span class="op" id="5688947">,</span>&nbsp;<span class="ident" id="5688949">err</span>&nbsp;<span class="op" id="5688953">:=</span>&nbsp;<span class="ident" id="5688956"><a href="/archive/zip/reader.go.html#5681449">io</a></span><span class="op" id="5688958">.</span><span class="ident" id="5688959">ReadFull</span><span class="op" id="5688967">(</span><span class="ident" id="5688968"><a href="/archive/zip/reader.go.html#5688365">r</a></span><span class="op" id="5688969">,</span>&nbsp;<span class="ident" id="5688971"><a href="/archive/zip/reader.go.html#5688400">buf</a></span><span class="op" id="5688974">[</span><span class="op" id="5688975">:</span><span class="num" id="5688976">4</span><span class="op" id="5688977">]</span><span class="op" id="5688978">)</span><span class="op" id="5688979">;</span>&nbsp;<span class="ident" id="5688981"><a href="/archive/zip/reader.go.html#5688949">err</a></span>&nbsp;<span class="op" id="5688985">!=</span>&nbsp;<span class="ident" id="5688988">nil</span>&nbsp;<span class="op" id="5688992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688996">return</span>&nbsp;<span class="ident" id="5689003"><a href="/archive/zip/reader.go.html#5688949">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5689008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689011">off</span>&nbsp;<span class="op" id="5689015">:=</span>&nbsp;<span class="num" id="5689018">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689021">maybeSig</span>&nbsp;<span class="op" id="5689030">:=</span>&nbsp;<span class="ident" id="5689033"><a href="/archive/zip/reader.go.html#5693283">readBuf</a></span><span class="op" id="5689040">(</span><span class="ident" id="5689041"><a href="/archive/zip/reader.go.html#5688400">buf</a></span><span class="op" id="5689044">[</span><span class="op" id="5689045">:</span><span class="num" id="5689046">4</span><span class="op" id="5689047">]</span><span class="op" id="5689048">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689051">if</span>&nbsp;<span class="ident" id="5689054"><a href="/archive/zip/reader.go.html#5689021">maybeSig</a></span><span class="op" id="5689062">.</span><span class="builtintype" id="5689063">uint32</span><span class="op" id="5689069">(</span><span class="op" id="5689070">)</span>&nbsp;<span class="op" id="5689072">!=</span>&nbsp;<span class="ident" id="5689075"><a href="/archive/zip/struct.go.html#5697272">dataDescriptorSignature</a></span>&nbsp;<span class="op" id="5689099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5689103">//&nbsp;No&nbsp;data&nbsp;descriptor&nbsp;signature.&nbsp;Keep&nbsp;these&nbsp;four</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5689154">//&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689166"><a href="/archive/zip/reader.go.html#5689011">off</a></span>&nbsp;<span class="op" id="5689170">+=</span>&nbsp;<span class="num" id="5689173">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5689176">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689179">if</span>&nbsp;<span class="ident" id="5689182">_</span><span class="op" id="5689183">,</span>&nbsp;<span class="ident" id="5689185">err</span>&nbsp;<span class="op" id="5689189">:=</span>&nbsp;<span class="ident" id="5689192"><a href="/archive/zip/reader.go.html#5681449">io</a></span><span class="op" id="5689194">.</span><span class="ident" id="5689195">ReadFull</span><span class="op" id="5689203">(</span><span class="ident" id="5689204"><a href="/archive/zip/reader.go.html#5688365">r</a></span><span class="op" id="5689205">,</span>&nbsp;<span class="ident" id="5689207"><a href="/archive/zip/reader.go.html#5688400">buf</a></span><span class="op" id="5689210">[</span><span class="ident" id="5689211"><a href="/archive/zip/reader.go.html#5689011">off</a></span><span class="op" id="5689214">:</span><span class="num" id="5689215">12</span><span class="op" id="5689217">]</span><span class="op" id="5689218">)</span><span class="op" id="5689219">;</span>&nbsp;<span class="ident" id="5689221"><a href="/archive/zip/reader.go.html#5689185">err</a></span>&nbsp;<span class="op" id="5689225">!=</span>&nbsp;<span class="ident" id="5689228">nil</span>&nbsp;<span class="op" id="5689232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689236">return</span>&nbsp;<span class="ident" id="5689243"><a href="/archive/zip/reader.go.html#5689185">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5689248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689251">b</span>&nbsp;<span class="op" id="5689253">:=</span>&nbsp;<span class="ident" id="5689256"><a href="/archive/zip/reader.go.html#5693283">readBuf</a></span><span class="op" id="5689263">(</span><span class="ident" id="5689264"><a href="/archive/zip/reader.go.html#5688400">buf</a></span><span class="op" id="5689267">[</span><span class="op" id="5689268">:</span><span class="num" id="5689269">12</span><span class="op" id="5689271">]</span><span class="op" id="5689272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689275">if</span>&nbsp;<span class="ident" id="5689278"><a href="/archive/zip/reader.go.html#5689251">b</a></span><span class="op" id="5689279">.</span><span class="builtintype" id="5689280">uint32</span><span class="op" id="5689286">(</span><span class="op" id="5689287">)</span>&nbsp;<span class="op" id="5689289">!=</span>&nbsp;<span class="ident" id="5689292"><a href="/archive/zip/reader.go.html#5688378">f</a></span><span class="op" id="5689293">.</span><span class="ident" id="5689294">CRC32</span>&nbsp;<span class="op" id="5689300">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689304">return</span>&nbsp;<span class="ident" id="5689311"><a href="/archive/zip/reader.go.html#5681595">ErrChecksum</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5689324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5689328">//&nbsp;The&nbsp;two&nbsp;sizes&nbsp;that&nbsp;follow&nbsp;here&nbsp;can&nbsp;be&nbsp;either&nbsp;32&nbsp;bits&nbsp;or&nbsp;64&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5689396">//&nbsp;but&nbsp;the&nbsp;spec&nbsp;is&nbsp;not&nbsp;very&nbsp;clear&nbsp;on&nbsp;this&nbsp;and&nbsp;different</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5689453">//&nbsp;interpretations&nbsp;has&nbsp;been&nbsp;made&nbsp;causing&nbsp;incompatibilities.&nbsp;We</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5689517">//&nbsp;already&nbsp;have&nbsp;the&nbsp;sizes&nbsp;from&nbsp;the&nbsp;central&nbsp;directory&nbsp;so&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5689581">//&nbsp;just&nbsp;ignore&nbsp;these.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689605">return</span>&nbsp;<span class="ident" id="5689612">nil</span><br>
<span class="lineno">320</span><span class="op" id="5689616">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5689619">func</span>&nbsp;<span class="ident" id="5689624">readDirectoryEnd</span><span class="op" id="5689640">(</span><span class="ident" id="5689641">r</span>&nbsp;<span class="ident" id="5689643"><a href="/archive/zip/reader.go.html#5681449">io</a></span><span class="op" id="5689645">.</span><span class="ident" id="5689646">ReaderAt</span><span class="op" id="5689654">,</span>&nbsp;<span class="ident" id="5689656">size</span>&nbsp;<span class="ident" id="5689661">int64</span><span class="op" id="5689666">)</span>&nbsp;<span class="op" id="5689668">(</span><span class="ident" id="5689669">dir</span>&nbsp;<span class="op" id="5689673">*</span><span class="ident" id="5689674"><a href="/archive/zip/struct.go.html#5700471">directoryEnd</a></span><span class="op" id="5689686">,</span>&nbsp;<span class="ident" id="5689688">err</span>&nbsp;<span class="builtintype" id="5689692">error</span><span class="op" id="5689697">)</span>&nbsp;<span class="op" id="5689699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5689702">//&nbsp;look&nbsp;for&nbsp;directoryEndSignature&nbsp;in&nbsp;the&nbsp;last&nbsp;1k,&nbsp;then&nbsp;in&nbsp;the&nbsp;last&nbsp;65k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689774">var</span>&nbsp;<span class="ident" id="5689778">buf</span>&nbsp;<span class="op" id="5689782">[</span><span class="op" id="5689783">]</span><span class="builtintype" id="5689784">byte</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689790">var</span>&nbsp;<span class="ident" id="5689794">directoryEndOffset</span>&nbsp;<span class="ident" id="5689813">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689820">for</span>&nbsp;<span class="ident" id="5689824">i</span><span class="op" id="5689825">,</span>&nbsp;<span class="ident" id="5689827">bLen</span>&nbsp;<span class="op" id="5689832">:=</span>&nbsp;<span class="keyword" id="5689835">range</span>&nbsp;<span class="op" id="5689841">[</span><span class="op" id="5689842">]</span><span class="ident" id="5689843">int64</span><span class="op" id="5689848">{</span><span class="num" id="5689849">1024</span><span class="op" id="5689853">,</span>&nbsp;<span class="num" id="5689855">65</span>&nbsp;<span class="op" id="5689858">*</span>&nbsp;<span class="num" id="5689860">1024</span><span class="op" id="5689864">}</span>&nbsp;<span class="op" id="5689866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689870">if</span>&nbsp;<span class="ident" id="5689873"><a href="/archive/zip/reader.go.html#5689827">bLen</a></span>&nbsp;<span class="op" id="5689878">&gt;</span>&nbsp;<span class="ident" id="5689880"><a href="/archive/zip/reader.go.html#5689656">size</a></span>&nbsp;<span class="op" id="5689885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689890"><a href="/archive/zip/reader.go.html#5689827">bLen</a></span>&nbsp;<span class="op" id="5689895">=</span>&nbsp;<span class="ident" id="5689897"><a href="/archive/zip/reader.go.html#5689656">size</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5689904">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689908"><a href="/archive/zip/reader.go.html#5689778">buf</a></span>&nbsp;<span class="op" id="5689912">=</span>&nbsp;<span class="builtinfunc" id="5689914">make</span><span class="op" id="5689918">(</span><span class="op" id="5689919">[</span><span class="op" id="5689920">]</span><span class="builtintype" id="5689921">byte</span><span class="op" id="5689925">,</span>&nbsp;<span class="builtintype" id="5689927">int</span><span class="op" id="5689930">(</span><span class="ident" id="5689931"><a href="/archive/zip/reader.go.html#5689827">bLen</a></span><span class="op" id="5689935">)</span><span class="op" id="5689936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689940">if</span>&nbsp;<span class="ident" id="5689943">_</span><span class="op" id="5689944">,</span>&nbsp;<span class="ident" id="5689946">err</span>&nbsp;<span class="op" id="5689950">:=</span>&nbsp;<span class="ident" id="5689953"><a href="/archive/zip/reader.go.html#5689641">r</a></span><span class="op" id="5689954">.</span><span class="ident" id="5689955">ReadAt</span><span class="op" id="5689961">(</span><span class="ident" id="5689962"><a href="/archive/zip/reader.go.html#5689778">buf</a></span><span class="op" id="5689965">,</span>&nbsp;<span class="ident" id="5689967"><a href="/archive/zip/reader.go.html#5689656">size</a></span><span class="op" id="5689971">-</span><span class="ident" id="5689972"><a href="/archive/zip/reader.go.html#5689827">bLen</a></span><span class="op" id="5689976">)</span><span class="op" id="5689977">;</span>&nbsp;<span class="ident" id="5689979"><a href="/archive/zip/reader.go.html#5689946">err</a></span>&nbsp;<span class="op" id="5689983">!=</span>&nbsp;<span class="ident" id="5689986">nil</span>&nbsp;<span class="op" id="5689990">&amp;&amp;</span>&nbsp;<span class="ident" id="5689993"><a href="/archive/zip/reader.go.html#5689946">err</a></span>&nbsp;<span class="op" id="5689997">!=</span>&nbsp;<span class="ident" id="5690000"><a href="/archive/zip/reader.go.html#5681449">io</a></span><span class="op" id="5690002">.</span><span class="ident" id="5690003">EOF</span>&nbsp;<span class="op" id="5690007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690012">return</span>&nbsp;<span class="ident" id="5690019">nil</span><span class="op" id="5690022">,</span>&nbsp;<span class="ident" id="5690024"><a href="/archive/zip/reader.go.html#5689946">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5690030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690034">if</span>&nbsp;<span class="ident" id="5690037">p</span>&nbsp;<span class="op" id="5690039">:=</span>&nbsp;<span class="ident" id="5690042"><a href="/archive/zip/reader.go.html#5692891">findSignatureInBlock</a></span><span class="op" id="5690062">(</span><span class="ident" id="5690063"><a href="/archive/zip/reader.go.html#5689778">buf</a></span><span class="op" id="5690066">)</span><span class="op" id="5690067">;</span>&nbsp;<span class="ident" id="5690069"><a href="/archive/zip/reader.go.html#5690037">p</a></span>&nbsp;<span class="op" id="5690071">&gt;=</span>&nbsp;<span class="num" id="5690074">0</span>&nbsp;<span class="op" id="5690076">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690081"><a href="/archive/zip/reader.go.html#5689778">buf</a></span>&nbsp;<span class="op" id="5690085">=</span>&nbsp;<span class="ident" id="5690087"><a href="/archive/zip/reader.go.html#5689778">buf</a></span><span class="op" id="5690090">[</span><span class="ident" id="5690091"><a href="/archive/zip/reader.go.html#5690037">p</a></span><span class="op" id="5690092">:</span><span class="op" id="5690093">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690098"><a href="/archive/zip/reader.go.html#5689794">directoryEndOffset</a></span>&nbsp;<span class="op" id="5690117">=</span>&nbsp;<span class="ident" id="5690119"><a href="/archive/zip/reader.go.html#5689656">size</a></span>&nbsp;<span class="op" id="5690124">-</span>&nbsp;<span class="ident" id="5690126"><a href="/archive/zip/reader.go.html#5689827">bLen</a></span>&nbsp;<span class="op" id="5690131">+</span>&nbsp;<span class="ident" id="5690133">int64</span><span class="op" id="5690138">(</span><span class="ident" id="5690139"><a href="/archive/zip/reader.go.html#5690037">p</a></span><span class="op" id="5690140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690145">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5690153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690157">if</span>&nbsp;<span class="ident" id="5690160"><a href="/archive/zip/reader.go.html#5689824">i</a></span>&nbsp;<span class="op" id="5690162">==</span>&nbsp;<span class="num" id="5690165">1</span>&nbsp;<span class="op" id="5690167">||</span>&nbsp;<span class="ident" id="5690170"><a href="/archive/zip/reader.go.html#5689827">bLen</a></span>&nbsp;<span class="op" id="5690175">==</span>&nbsp;<span class="ident" id="5690178"><a href="/archive/zip/reader.go.html#5689656">size</a></span>&nbsp;<span class="op" id="5690183">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690188">return</span>&nbsp;<span class="ident" id="5690195">nil</span><span class="op" id="5690198">,</span>&nbsp;<span class="ident" id="5690200"><a href="/archive/zip/reader.go.html#5681470">ErrFormat</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5690212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5690215">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5690219">//&nbsp;read&nbsp;header&nbsp;into&nbsp;struct</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690247">b</span>&nbsp;<span class="op" id="5690249">:=</span>&nbsp;<span class="ident" id="5690252"><a href="/archive/zip/reader.go.html#5693283">readBuf</a></span><span class="op" id="5690259">(</span><span class="ident" id="5690260"><a href="/archive/zip/reader.go.html#5689778">buf</a></span><span class="op" id="5690263">[</span><span class="num" id="5690264">4</span><span class="op" id="5690265">:</span><span class="op" id="5690266">]</span><span class="op" id="5690267">)</span>&nbsp;<span class="comment" id="5690269">//&nbsp;skip&nbsp;signature</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690288">d</span>&nbsp;<span class="op" id="5690290">:=</span>&nbsp;<span class="op" id="5690293">&amp;</span><span class="ident" id="5690294"><a href="/archive/zip/struct.go.html#5700471">directoryEnd</a></span><span class="op" id="5690306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690310">diskNbr</span><span class="op" id="5690317">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5690330">uint32</span><span class="op" id="5690336">(</span><span class="ident" id="5690337"><a href="/archive/zip/reader.go.html#5690247">b</a></span><span class="op" id="5690338">.</span><span class="builtintype" id="5690339">uint16</span><span class="op" id="5690345">(</span><span class="op" id="5690346">)</span><span class="op" id="5690347">)</span><span class="op" id="5690348">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690352">dirDiskNbr</span><span class="op" id="5690362">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5690372">uint32</span><span class="op" id="5690378">(</span><span class="ident" id="5690379"><a href="/archive/zip/reader.go.html#5690247">b</a></span><span class="op" id="5690380">.</span><span class="builtintype" id="5690381">uint16</span><span class="op" id="5690387">(</span><span class="op" id="5690388">)</span><span class="op" id="5690389">)</span><span class="op" id="5690390">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690394">dirRecordsThisDisk</span><span class="op" id="5690412">:</span>&nbsp;<span class="ident" id="5690414">uint64</span><span class="op" id="5690420">(</span><span class="ident" id="5690421"><a href="/archive/zip/reader.go.html#5690247">b</a></span><span class="op" id="5690422">.</span><span class="builtintype" id="5690423">uint16</span><span class="op" id="5690429">(</span><span class="op" id="5690430">)</span><span class="op" id="5690431">)</span><span class="op" id="5690432">,</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690436">directoryRecords</span><span class="op" id="5690452">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5690456">uint64</span><span class="op" id="5690462">(</span><span class="ident" id="5690463"><a href="/archive/zip/reader.go.html#5690247">b</a></span><span class="op" id="5690464">.</span><span class="builtintype" id="5690465">uint16</span><span class="op" id="5690471">(</span><span class="op" id="5690472">)</span><span class="op" id="5690473">)</span><span class="op" id="5690474">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690478">directorySize</span><span class="op" id="5690491">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5690498">uint64</span><span class="op" id="5690504">(</span><span class="ident" id="5690505"><a href="/archive/zip/reader.go.html#5690247">b</a></span><span class="op" id="5690506">.</span><span class="builtintype" id="5690507">uint32</span><span class="op" id="5690513">(</span><span class="op" id="5690514">)</span><span class="op" id="5690515">)</span><span class="op" id="5690516">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690520">directoryOffset</span><span class="op" id="5690535">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5690540">uint64</span><span class="op" id="5690546">(</span><span class="ident" id="5690547"><a href="/archive/zip/reader.go.html#5690247">b</a></span><span class="op" id="5690548">.</span><span class="builtintype" id="5690549">uint32</span><span class="op" id="5690555">(</span><span class="op" id="5690556">)</span><span class="op" id="5690557">)</span><span class="op" id="5690558">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690562">commentLen</span><span class="op" id="5690572">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5690582"><a href="/archive/zip/reader.go.html#5690247">b</a></span><span class="op" id="5690583">.</span><span class="builtintype" id="5690584">uint16</span><span class="op" id="5690590">(</span><span class="op" id="5690591">)</span><span class="op" id="5690592">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5690595">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690598">l</span>&nbsp;<span class="op" id="5690600">:=</span>&nbsp;<span class="builtintype" id="5690603">int</span><span class="op" id="5690606">(</span><span class="ident" id="5690607"><a href="/archive/zip/reader.go.html#5690288">d</a></span><span class="op" id="5690608">.</span><span class="ident" id="5690609">commentLen</span><span class="op" id="5690619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690622">if</span>&nbsp;<span class="ident" id="5690625"><a href="/archive/zip/reader.go.html#5690598">l</a></span>&nbsp;<span class="op" id="5690627">&gt;</span>&nbsp;<span class="builtinfunc" id="5690629">len</span><span class="op" id="5690632">(</span><span class="ident" id="5690633"><a href="/archive/zip/reader.go.html#5690247">b</a></span><span class="op" id="5690634">)</span>&nbsp;<span class="op" id="5690636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690640">return</span>&nbsp;<span class="ident" id="5690647">nil</span><span class="op" id="5690650">,</span>&nbsp;<span class="ident" id="5690652"><a href="/archive/zip/reader.go.html#5681417">errors</a></span><span class="op" id="5690658">.</span><span class="ident" id="5690659">New</span><span class="op" id="5690662">(</span><span class="string" id="5690663">&#34;zip:&nbsp;invalid&nbsp;comment&nbsp;length&#34;</span><span class="op" id="5690692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5690695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690698"><a href="/archive/zip/reader.go.html#5690288">d</a></span><span class="op" id="5690699">.</span><span class="ident" id="5690700">comment</span>&nbsp;<span class="op" id="5690708">=</span>&nbsp;<span class="builtintype" id="5690710">string</span><span class="op" id="5690716">(</span><span class="ident" id="5690717"><a href="/archive/zip/reader.go.html#5690247">b</a></span><span class="op" id="5690718">[</span><span class="op" id="5690719">:</span><span class="ident" id="5690720"><a href="/archive/zip/reader.go.html#5690598">l</a></span><span class="op" id="5690721">]</span><span class="op" id="5690722">)</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690726">p</span><span class="op" id="5690727">,</span>&nbsp;<span class="ident" id="5690729"><a href="/archive/zip/reader.go.html#5689688">err</a></span>&nbsp;<span class="op" id="5690733">:=</span>&nbsp;<span class="ident" id="5690736"><a href="/archive/zip/reader.go.html#5691202">findDirectory64End</a></span><span class="op" id="5690754">(</span><span class="ident" id="5690755"><a href="/archive/zip/reader.go.html#5689641">r</a></span><span class="op" id="5690756">,</span>&nbsp;<span class="ident" id="5690758"><a href="/archive/zip/reader.go.html#5689794">directoryEndOffset</a></span><span class="op" id="5690776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690779">if</span>&nbsp;<span class="ident" id="5690782"><a href="/archive/zip/reader.go.html#5689688">err</a></span>&nbsp;<span class="op" id="5690786">==</span>&nbsp;<span class="ident" id="5690789">nil</span>&nbsp;<span class="op" id="5690793">&amp;&amp;</span>&nbsp;<span class="ident" id="5690796"><a href="/archive/zip/reader.go.html#5690726">p</a></span>&nbsp;<span class="op" id="5690798">&gt;=</span>&nbsp;<span class="num" id="5690801">0</span>&nbsp;<span class="op" id="5690803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690807"><a href="/archive/zip/reader.go.html#5689688">err</a></span>&nbsp;<span class="op" id="5690811">=</span>&nbsp;<span class="ident" id="5690813"><a href="/archive/zip/reader.go.html#5691959">readDirectory64End</a></span><span class="op" id="5690831">(</span><span class="ident" id="5690832"><a href="/archive/zip/reader.go.html#5689641">r</a></span><span class="op" id="5690833">,</span>&nbsp;<span class="ident" id="5690835"><a href="/archive/zip/reader.go.html#5690726">p</a></span><span class="op" id="5690836">,</span>&nbsp;<span class="ident" id="5690838"><a href="/archive/zip/reader.go.html#5690288">d</a></span><span class="op" id="5690839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5690842">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690845">if</span>&nbsp;<span class="ident" id="5690848"><a href="/archive/zip/reader.go.html#5689688">err</a></span>&nbsp;<span class="op" id="5690852">!=</span>&nbsp;<span class="ident" id="5690855">nil</span>&nbsp;<span class="op" id="5690859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690863">return</span>&nbsp;<span class="ident" id="5690870">nil</span><span class="op" id="5690873">,</span>&nbsp;<span class="ident" id="5690875"><a href="/archive/zip/reader.go.html#5689688">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5690880">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5690884">//&nbsp;Make&nbsp;sure&nbsp;directoryOffset&nbsp;points&nbsp;to&nbsp;somewhere&nbsp;in&nbsp;our&nbsp;file.</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690947">if</span>&nbsp;<span class="ident" id="5690950">o</span>&nbsp;<span class="op" id="5690952">:=</span>&nbsp;<span class="ident" id="5690955">int64</span><span class="op" id="5690960">(</span><span class="ident" id="5690961"><a href="/archive/zip/reader.go.html#5690288">d</a></span><span class="op" id="5690962">.</span><span class="ident" id="5690963">directoryOffset</span><span class="op" id="5690978">)</span><span class="op" id="5690979">;</span>&nbsp;<span class="ident" id="5690981"><a href="/archive/zip/reader.go.html#5690950">o</a></span>&nbsp;<span class="op" id="5690983">&lt;</span>&nbsp;<span class="num" id="5690985">0</span>&nbsp;<span class="op" id="5690987">||</span>&nbsp;<span class="ident" id="5690990"><a href="/archive/zip/reader.go.html#5690950">o</a></span>&nbsp;<span class="op" id="5690992">&gt;=</span>&nbsp;<span class="ident" id="5690995"><a href="/archive/zip/reader.go.html#5689656">size</a></span>&nbsp;<span class="op" id="5691000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691004">return</span>&nbsp;<span class="ident" id="5691011">nil</span><span class="op" id="5691014">,</span>&nbsp;<span class="ident" id="5691016"><a href="/archive/zip/reader.go.html#5681470">ErrFormat</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5691027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691030">return</span>&nbsp;<span class="ident" id="5691037"><a href="/archive/zip/reader.go.html#5690288">d</a></span><span class="op" id="5691038">,</span>&nbsp;<span class="ident" id="5691040">nil</span><br>
<span class="lineno"></span><span class="op" id="5691044">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="comment" id="5691047">//&nbsp;findDirectory64End&nbsp;tries&nbsp;to&nbsp;read&nbsp;the&nbsp;zip64&nbsp;locator&nbsp;just&nbsp;before&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5691117">//&nbsp;directory&nbsp;end&nbsp;and&nbsp;returns&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;zip64&nbsp;directory&nbsp;end&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="5691187">//&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="5691197">func</span>&nbsp;<span class="ident" id="5691202">findDirectory64End</span><span class="op" id="5691220">(</span><span class="ident" id="5691221">r</span>&nbsp;<span class="ident" id="5691223"><a href="/archive/zip/reader.go.html#5681449">io</a></span><span class="op" id="5691225">.</span><span class="ident" id="5691226">ReaderAt</span><span class="op" id="5691234">,</span>&nbsp;<span class="ident" id="5691236">directoryEndOffset</span>&nbsp;<span class="ident" id="5691255">int64</span><span class="op" id="5691260">)</span>&nbsp;<span class="op" id="5691262">(</span><span class="ident" id="5691263">int64</span><span class="op" id="5691268">,</span>&nbsp;<span class="builtintype" id="5691270">error</span><span class="op" id="5691275">)</span>&nbsp;<span class="op" id="5691277">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691280">locOffset</span>&nbsp;<span class="op" id="5691290">:=</span>&nbsp;<span class="ident" id="5691293"><a href="/archive/zip/reader.go.html#5691236">directoryEndOffset</a></span>&nbsp;<span class="op" id="5691312">-</span>&nbsp;<span class="ident" id="5691314"><a href="/archive/zip/struct.go.html#5697718">directory64LocLen</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691333">if</span>&nbsp;<span class="ident" id="5691336"><a href="/archive/zip/reader.go.html#5691280">locOffset</a></span>&nbsp;<span class="op" id="5691346">&lt;</span>&nbsp;<span class="num" id="5691348">0</span>&nbsp;<span class="op" id="5691350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691354">return</span>&nbsp;<span class="op" id="5691361">-</span><span class="num" id="5691362">1</span><span class="op" id="5691363">,</span>&nbsp;<span class="ident" id="5691365">nil</span>&nbsp;<span class="comment" id="5691369">//&nbsp;no&nbsp;need&nbsp;to&nbsp;look&nbsp;for&nbsp;a&nbsp;header&nbsp;outside&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5691419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691422">buf</span>&nbsp;<span class="op" id="5691426">:=</span>&nbsp;<span class="builtinfunc" id="5691429">make</span><span class="op" id="5691433">(</span><span class="op" id="5691434">[</span><span class="op" id="5691435">]</span><span class="builtintype" id="5691436">byte</span><span class="op" id="5691440">,</span>&nbsp;<span class="ident" id="5691442"><a href="/archive/zip/struct.go.html#5697718">directory64LocLen</a></span><span class="op" id="5691459">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691462">if</span>&nbsp;<span class="ident" id="5691465">_</span><span class="op" id="5691466">,</span>&nbsp;<span class="ident" id="5691468">err</span>&nbsp;<span class="op" id="5691472">:=</span>&nbsp;<span class="ident" id="5691475"><a href="/archive/zip/reader.go.html#5691221">r</a></span><span class="op" id="5691476">.</span><span class="ident" id="5691477">ReadAt</span><span class="op" id="5691483">(</span><span class="ident" id="5691484"><a href="/archive/zip/reader.go.html#5691422">buf</a></span><span class="op" id="5691487">,</span>&nbsp;<span class="ident" id="5691489"><a href="/archive/zip/reader.go.html#5691280">locOffset</a></span><span class="op" id="5691498">)</span><span class="op" id="5691499">;</span>&nbsp;<span class="ident" id="5691501"><a href="/archive/zip/reader.go.html#5691468">err</a></span>&nbsp;<span class="op" id="5691505">!=</span>&nbsp;<span class="ident" id="5691508">nil</span>&nbsp;<span class="op" id="5691512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691516">return</span>&nbsp;<span class="op" id="5691523">-</span><span class="num" id="5691524">1</span><span class="op" id="5691525">,</span>&nbsp;<span class="ident" id="5691527"><a href="/archive/zip/reader.go.html#5691468">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5691532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691535">b</span>&nbsp;<span class="op" id="5691537">:=</span>&nbsp;<span class="ident" id="5691540"><a href="/archive/zip/reader.go.html#5693283">readBuf</a></span><span class="op" id="5691547">(</span><span class="ident" id="5691548"><a href="/archive/zip/reader.go.html#5691422">buf</a></span><span class="op" id="5691551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691554">if</span>&nbsp;<span class="ident" id="5691557">sig</span>&nbsp;<span class="op" id="5691561">:=</span>&nbsp;<span class="ident" id="5691564"><a href="/archive/zip/reader.go.html#5691535">b</a></span><span class="op" id="5691565">.</span><span class="builtintype" id="5691566">uint32</span><span class="op" id="5691572">(</span><span class="op" id="5691573">)</span><span class="op" id="5691574">;</span>&nbsp;<span class="ident" id="5691576"><a href="/archive/zip/reader.go.html#5691557">sig</a></span>&nbsp;<span class="op" id="5691580">!=</span>&nbsp;<span class="ident" id="5691583"><a href="/archive/zip/struct.go.html#5697194">directory64LocSignature</a></span>&nbsp;<span class="op" id="5691607">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691611">return</span>&nbsp;<span class="op" id="5691618">-</span><span class="num" id="5691619">1</span><span class="op" id="5691620">,</span>&nbsp;<span class="ident" id="5691622">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5691627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691630"><a href="/archive/zip/reader.go.html#5691535">b</a></span>&nbsp;<span class="op" id="5691632">=</span>&nbsp;<span class="ident" id="5691634"><a href="/archive/zip/reader.go.html#5691535">b</a></span><span class="op" id="5691635">[</span><span class="num" id="5691636">4</span><span class="op" id="5691637">:</span><span class="op" id="5691638">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5691646">//&nbsp;skip&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691727">p</span>&nbsp;<span class="op" id="5691729">:=</span>&nbsp;<span class="ident" id="5691732"><a href="/archive/zip/reader.go.html#5691535">b</a></span><span class="op" id="5691733">.</span><span class="ident" id="5691734">uint64</span><span class="op" id="5691740">(</span><span class="op" id="5691741">)</span>&nbsp;<span class="comment" id="5691743">//&nbsp;relative&nbsp;offset&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691808">return</span>&nbsp;<span class="ident" id="5691815">int64</span><span class="op" id="5691820">(</span><span class="ident" id="5691821"><a href="/archive/zip/reader.go.html#5691727">p</a></span><span class="op" id="5691822">)</span><span class="op" id="5691823">,</span>&nbsp;<span class="ident" id="5691825">nil</span><br>
<span class="lineno">395</span><span class="op" id="5691829">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5691832">//&nbsp;readDirectory64End&nbsp;reads&nbsp;the&nbsp;zip64&nbsp;directory&nbsp;end&nbsp;and&nbsp;updates&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5691900">//&nbsp;directory&nbsp;end&nbsp;with&nbsp;the&nbsp;zip64&nbsp;directory&nbsp;end&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5691954">func</span>&nbsp;<span class="ident" id="5691959">readDirectory64End</span><span class="op" id="5691977">(</span><span class="ident" id="5691978">r</span>&nbsp;<span class="ident" id="5691980"><a href="/archive/zip/reader.go.html#5681449">io</a></span><span class="op" id="5691982">.</span><span class="ident" id="5691983">ReaderAt</span><span class="op" id="5691991">,</span>&nbsp;<span class="ident" id="5691993">offset</span>&nbsp;<span class="ident" id="5692000">int64</span><span class="op" id="5692005">,</span>&nbsp;<span class="ident" id="5692007">d</span>&nbsp;<span class="op" id="5692009">*</span><span class="ident" id="5692010"><a href="/archive/zip/struct.go.html#5700471">directoryEnd</a></span><span class="op" id="5692022">)</span>&nbsp;<span class="op" id="5692024">(</span><span class="ident" id="5692025">err</span>&nbsp;<span class="builtintype" id="5692029">error</span><span class="op" id="5692034">)</span>&nbsp;<span class="op" id="5692036">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5692039">buf</span>&nbsp;<span class="op" id="5692043">:=</span>&nbsp;<span class="builtinfunc" id="5692046">make</span><span class="op" id="5692050">(</span><span class="op" id="5692051">[</span><span class="op" id="5692052">]</span><span class="builtintype" id="5692053">byte</span><span class="op" id="5692057">,</span>&nbsp;<span class="ident" id="5692059"><a href="/archive/zip/struct.go.html#5697760">directory64EndLen</a></span><span class="op" id="5692076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692079">if</span>&nbsp;<span class="ident" id="5692082">_</span><span class="op" id="5692083">,</span>&nbsp;<span class="ident" id="5692085">err</span>&nbsp;<span class="op" id="5692089">:=</span>&nbsp;<span class="ident" id="5692092"><a href="/archive/zip/reader.go.html#5691978">r</a></span><span class="op" id="5692093">.</span><span class="ident" id="5692094">ReadAt</span><span class="op" id="5692100">(</span><span class="ident" id="5692101"><a href="/archive/zip/reader.go.html#5692039">buf</a></span><span class="op" id="5692104">,</span>&nbsp;<span class="ident" id="5692106"><a href="/archive/zip/reader.go.html#5691993">offset</a></span><span class="op" id="5692112">)</span><span class="op" id="5692113">;</span>&nbsp;<span class="ident" id="5692115"><a href="/archive/zip/reader.go.html#5692085">err</a></span>&nbsp;<span class="op" id="5692119">!=</span>&nbsp;<span class="ident" id="5692122">nil</span>&nbsp;<span class="op" id="5692126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692130">return</span>&nbsp;<span class="ident" id="5692137"><a href="/archive/zip/reader.go.html#5692085">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5692142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5692146">b</span>&nbsp;<span class="op" id="5692148">:=</span>&nbsp;<span class="ident" id="5692151"><a href="/archive/zip/reader.go.html#5693283">readBuf</a></span><span class="op" id="5692158">(</span><span class="ident" id="5692159"><a href="/archive/zip/reader.go.html#5692039">buf</a></span><span class="op" id="5692162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692165">if</span>&nbsp;<span class="ident" id="5692168">sig</span>&nbsp;<span class="op" id="5692172">:=</span>&nbsp;<span class="ident" id="5692175"><a href="/archive/zip/reader.go.html#5692146">b</a></span><span class="op" id="5692176">.</span><span class="builtintype" id="5692177">uint32</span><span class="op" id="5692183">(</span><span class="op" id="5692184">)</span><span class="op" id="5692185">;</span>&nbsp;<span class="ident" id="5692187"><a href="/archive/zip/reader.go.html#5692168">sig</a></span>&nbsp;<span class="op" id="5692191">!=</span>&nbsp;<span class="ident" id="5692194"><a href="/archive/zip/struct.go.html#5697233">directory64EndSignature</a></span>&nbsp;<span class="op" id="5692218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692222">return</span>&nbsp;<span class="ident" id="5692229"><a href="/archive/zip/reader.go.html#5681470">ErrFormat</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5692240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5692244"><a href="/archive/zip/reader.go.html#5692146">b</a></span>&nbsp;<span class="op" id="5692246">=</span>&nbsp;<span class="ident" id="5692248"><a href="/archive/zip/reader.go.html#5692146">b</a></span><span class="op" id="5692249">[</span><span class="num" id="5692250">12</span><span class="op" id="5692252">:</span><span class="op" id="5692253">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5692278">//&nbsp;skip&nbsp;dir&nbsp;size,&nbsp;version&nbsp;and&nbsp;version&nbsp;needed&nbsp;(uint64&nbsp;+&nbsp;2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5692345"><a href="/archive/zip/reader.go.html#5692007">d</a></span><span class="op" id="5692346">.</span><span class="ident" id="5692347">diskNbr</span>&nbsp;<span class="op" id="5692355">=</span>&nbsp;<span class="ident" id="5692357"><a href="/archive/zip/reader.go.html#5692146">b</a></span><span class="op" id="5692358">.</span><span class="builtintype" id="5692359">uint32</span><span class="op" id="5692365">(</span><span class="op" id="5692366">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5692379">//&nbsp;number&nbsp;of&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5692403"><a href="/archive/zip/reader.go.html#5692007">d</a></span><span class="op" id="5692404">.</span><span class="ident" id="5692405">dirDiskNbr</span>&nbsp;<span class="op" id="5692416">=</span>&nbsp;<span class="ident" id="5692418"><a href="/archive/zip/reader.go.html#5692146">b</a></span><span class="op" id="5692419">.</span><span class="builtintype" id="5692420">uint32</span><span class="op" id="5692426">(</span><span class="op" id="5692427">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5692437">//&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5692500"><a href="/archive/zip/reader.go.html#5692007">d</a></span><span class="op" id="5692501">.</span><span class="ident" id="5692502">dirRecordsThisDisk</span>&nbsp;<span class="op" id="5692521">=</span>&nbsp;<span class="ident" id="5692523"><a href="/archive/zip/reader.go.html#5692146">b</a></span><span class="op" id="5692524">.</span><span class="ident" id="5692525">uint64</span><span class="op" id="5692531">(</span><span class="op" id="5692532">)</span>&nbsp;<span class="comment" id="5692534">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory&nbsp;on&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5692600"><a href="/archive/zip/reader.go.html#5692007">d</a></span><span class="op" id="5692601">.</span><span class="ident" id="5692602">directoryRecords</span>&nbsp;<span class="op" id="5692619">=</span>&nbsp;<span class="ident" id="5692621"><a href="/archive/zip/reader.go.html#5692146">b</a></span><span class="op" id="5692622">.</span><span class="ident" id="5692623">uint64</span><span class="op" id="5692629">(</span><span class="op" id="5692630">)</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5692634">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5692687"><a href="/archive/zip/reader.go.html#5692007">d</a></span><span class="op" id="5692688">.</span><span class="ident" id="5692689">directorySize</span>&nbsp;<span class="op" id="5692703">=</span>&nbsp;<span class="ident" id="5692705"><a href="/archive/zip/reader.go.html#5692146">b</a></span><span class="op" id="5692706">.</span><span class="ident" id="5692707">uint64</span><span class="op" id="5692713">(</span><span class="op" id="5692714">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5692721">//&nbsp;size&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5692755"><a href="/archive/zip/reader.go.html#5692007">d</a></span><span class="op" id="5692756">.</span><span class="ident" id="5692757">directoryOffset</span>&nbsp;<span class="op" id="5692773">=</span>&nbsp;<span class="ident" id="5692775"><a href="/archive/zip/reader.go.html#5692146">b</a></span><span class="op" id="5692776">.</span><span class="ident" id="5692777">uint64</span><span class="op" id="5692783">(</span><span class="op" id="5692784">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5692789">//&nbsp;offset&nbsp;of&nbsp;start&nbsp;of&nbsp;central&nbsp;directory&nbsp;with&nbsp;respect&nbsp;to&nbsp;the&nbsp;starting&nbsp;disk&nbsp;number</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692872">return</span>&nbsp;<span class="ident" id="5692879">nil</span><br>
<span class="lineno"></span><span class="op" id="5692883">}</span><br>
<span class="lineno">420</span><br>
<span class="lineno"></span><span class="keyword" id="5692886">func</span>&nbsp;<span class="ident" id="5692891">findSignatureInBlock</span><span class="op" id="5692911">(</span><span class="ident" id="5692912">b</span>&nbsp;<span class="op" id="5692914">[</span><span class="op" id="5692915">]</span><span class="builtintype" id="5692916">byte</span><span class="op" id="5692920">)</span>&nbsp;<span class="builtintype" id="5692922">int</span>&nbsp;<span class="op" id="5692926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692929">for</span>&nbsp;<span class="ident" id="5692933">i</span>&nbsp;<span class="op" id="5692935">:=</span>&nbsp;<span class="builtinfunc" id="5692938">len</span><span class="op" id="5692941">(</span><span class="ident" id="5692942"><a href="/archive/zip/reader.go.html#5692912">b</a></span><span class="op" id="5692943">)</span>&nbsp;<span class="op" id="5692945">-</span>&nbsp;<span class="ident" id="5692947"><a href="/archive/zip/struct.go.html#5697489">directoryEndLen</a></span><span class="op" id="5692962">;</span>&nbsp;<span class="ident" id="5692964"><a href="/archive/zip/reader.go.html#5692933">i</a></span>&nbsp;<span class="op" id="5692966">&gt;=</span>&nbsp;<span class="num" id="5692969">0</span><span class="op" id="5692970">;</span>&nbsp;<span class="ident" id="5692972"><a href="/archive/zip/reader.go.html#5692933">i</a></span><span class="op" id="5692973">--</span>&nbsp;<span class="op" id="5692976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5692980">//&nbsp;defined&nbsp;from&nbsp;directoryEndSignature&nbsp;in&nbsp;struct.go</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693033">if</span>&nbsp;<span class="ident" id="5693036"><a href="/archive/zip/reader.go.html#5692912">b</a></span><span class="op" id="5693037">[</span><span class="ident" id="5693038"><a href="/archive/zip/reader.go.html#5692933">i</a></span><span class="op" id="5693039">]</span>&nbsp;<span class="op" id="5693041">==</span>&nbsp;<span class="string" id="5693044">&#39;P&#39;</span>&nbsp;<span class="op" id="5693048">&amp;&amp;</span>&nbsp;<span class="ident" id="5693051"><a href="/archive/zip/reader.go.html#5692912">b</a></span><span class="op" id="5693052">[</span><span class="ident" id="5693053"><a href="/archive/zip/reader.go.html#5692933">i</a></span><span class="op" id="5693054">+</span><span class="num" id="5693055">1</span><span class="op" id="5693056">]</span>&nbsp;<span class="op" id="5693058">==</span>&nbsp;<span class="string" id="5693061">&#39;K&#39;</span>&nbsp;<span class="op" id="5693065">&amp;&amp;</span>&nbsp;<span class="ident" id="5693068"><a href="/archive/zip/reader.go.html#5692912">b</a></span><span class="op" id="5693069">[</span><span class="ident" id="5693070"><a href="/archive/zip/reader.go.html#5692933">i</a></span><span class="op" id="5693071">+</span><span class="num" id="5693072">2</span><span class="op" id="5693073">]</span>&nbsp;<span class="op" id="5693075">==</span>&nbsp;<span class="num" id="5693078">0x05</span>&nbsp;<span class="op" id="5693083">&amp;&amp;</span>&nbsp;<span class="ident" id="5693086"><a href="/archive/zip/reader.go.html#5692912">b</a></span><span class="op" id="5693087">[</span><span class="ident" id="5693088"><a href="/archive/zip/reader.go.html#5692933">i</a></span><span class="op" id="5693089">+</span><span class="num" id="5693090">3</span><span class="op" id="5693091">]</span>&nbsp;<span class="op" id="5693093">==</span>&nbsp;<span class="num" id="5693096">0x06</span>&nbsp;<span class="op" id="5693101">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5693106">//&nbsp;n&nbsp;is&nbsp;length&nbsp;of&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5693135">n</span>&nbsp;<span class="op" id="5693137">:=</span>&nbsp;<span class="builtintype" id="5693140">int</span><span class="op" id="5693143">(</span><span class="ident" id="5693144"><a href="/archive/zip/reader.go.html#5692912">b</a></span><span class="op" id="5693145">[</span><span class="ident" id="5693146"><a href="/archive/zip/reader.go.html#5692933">i</a></span><span class="op" id="5693147">+</span><span class="ident" id="5693148"><a href="/archive/zip/struct.go.html#5697489">directoryEndLen</a></span><span class="op" id="5693163">-</span><span class="num" id="5693164">2</span><span class="op" id="5693165">]</span><span class="op" id="5693166">)</span>&nbsp;<span class="op" id="5693168">|</span>&nbsp;<span class="builtintype" id="5693170">int</span><span class="op" id="5693173">(</span><span class="ident" id="5693174"><a href="/archive/zip/reader.go.html#5692912">b</a></span><span class="op" id="5693175">[</span><span class="ident" id="5693176"><a href="/archive/zip/reader.go.html#5692933">i</a></span><span class="op" id="5693177">+</span><span class="ident" id="5693178"><a href="/archive/zip/struct.go.html#5697489">directoryEndLen</a></span><span class="op" id="5693193">-</span><span class="num" id="5693194">1</span><span class="op" id="5693195">]</span><span class="op" id="5693196">)</span><span class="op" id="5693197">&lt;&lt;</span><span class="num" id="5693199">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693204">if</span>&nbsp;<span class="ident" id="5693207"><a href="/archive/zip/reader.go.html#5693135">n</a></span><span class="op" id="5693208">+</span><span class="ident" id="5693209"><a href="/archive/zip/struct.go.html#5697489">directoryEndLen</a></span><span class="op" id="5693224">+</span><span class="ident" id="5693225"><a href="/archive/zip/reader.go.html#5692933">i</a></span>&nbsp;<span class="op" id="5693227">&lt;=</span>&nbsp;<span class="builtinfunc" id="5693230">len</span><span class="op" id="5693233">(</span><span class="ident" id="5693234"><a href="/archive/zip/reader.go.html#5692912">b</a></span><span class="op" id="5693235">)</span>&nbsp;<span class="op" id="5693237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693243">return</span>&nbsp;<span class="ident" id="5693250"><a href="/archive/zip/reader.go.html#5692933">i</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5693255">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5693259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5693262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693265">return</span>&nbsp;<span class="op" id="5693272">-</span><span class="num" id="5693273">1</span><br>
<span class="lineno"></span><span class="op" id="5693275">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="keyword" id="5693278">type</span>&nbsp;<span class="ident" id="5693283">readBuf</span>&nbsp;<span class="op" id="5693291">[</span><span class="op" id="5693292">]</span><span class="builtintype" id="5693293">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5693299">func</span>&nbsp;<span class="op" id="5693304">(</span><span class="ident" id="5693305">b</span>&nbsp;<span class="op" id="5693307">*</span><span class="ident" id="5693308"><a href="/archive/zip/reader.go.html#5693283">readBuf</a></span><span class="op" id="5693315">)</span>&nbsp;<span class="builtintype" id="5693317">uint16</span><span class="op" id="5693323">(</span><span class="op" id="5693324">)</span>&nbsp;<span class="builtintype" id="5693326">uint16</span>&nbsp;<span class="op" id="5693333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5693336">v</span>&nbsp;<span class="op" id="5693338">:=</span>&nbsp;<span class="ident" id="5693341"><a href="/archive/zip/reader.go.html#5681398">binary</a></span><span class="op" id="5693347">.</span><span class="ident" id="5693348">LittleEndian</span><span class="op" id="5693360">.</span><span class="ident" id="5693361">Uint16</span><span class="op" id="5693367">(</span><span class="op" id="5693368">*</span><span class="ident" id="5693369"><a href="/archive/zip/reader.go.html#5693305">b</a></span><span class="op" id="5693370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5693373">*</span><span class="ident" id="5693374"><a href="/archive/zip/reader.go.html#5693305">b</a></span>&nbsp;<span class="op" id="5693376">=</span>&nbsp;<span class="op" id="5693378">(</span><span class="op" id="5693379">*</span><span class="ident" id="5693380"><a href="/archive/zip/reader.go.html#5693305">b</a></span><span class="op" id="5693381">)</span><span class="op" id="5693382">[</span><span class="num" id="5693383">2</span><span class="op" id="5693384">:</span><span class="op" id="5693385">]</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693388">return</span>&nbsp;<span class="ident" id="5693395"><a href="/archive/zip/reader.go.html#5693336">v</a></span><br>
<span class="lineno"></span><span class="op" id="5693397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5693400">func</span>&nbsp;<span class="op" id="5693405">(</span><span class="ident" id="5693406">b</span>&nbsp;<span class="op" id="5693408">*</span><span class="ident" id="5693409"><a href="/archive/zip/reader.go.html#5693283">readBuf</a></span><span class="op" id="5693416">)</span>&nbsp;<span class="builtintype" id="5693418">uint32</span><span class="op" id="5693424">(</span><span class="op" id="5693425">)</span>&nbsp;<span class="builtintype" id="5693427">uint32</span>&nbsp;<span class="op" id="5693434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5693437">v</span>&nbsp;<span class="op" id="5693439">:=</span>&nbsp;<span class="ident" id="5693442"><a href="/archive/zip/reader.go.html#5681398">binary</a></span><span class="op" id="5693448">.</span><span class="ident" id="5693449">LittleEndian</span><span class="op" id="5693461">.</span><span class="ident" id="5693462">Uint32</span><span class="op" id="5693468">(</span><span class="op" id="5693469">*</span><span class="ident" id="5693470"><a href="/archive/zip/reader.go.html#5693406">b</a></span><span class="op" id="5693471">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5693474">*</span><span class="ident" id="5693475"><a href="/archive/zip/reader.go.html#5693406">b</a></span>&nbsp;<span class="op" id="5693477">=</span>&nbsp;<span class="op" id="5693479">(</span><span class="op" id="5693480">*</span><span class="ident" id="5693481"><a href="/archive/zip/reader.go.html#5693406">b</a></span><span class="op" id="5693482">)</span><span class="op" id="5693483">[</span><span class="num" id="5693484">4</span><span class="op" id="5693485">:</span><span class="op" id="5693486">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693489">return</span>&nbsp;<span class="ident" id="5693496"><a href="/archive/zip/reader.go.html#5693437">v</a></span><br>
<span class="lineno"></span><span class="op" id="5693498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5693501">func</span>&nbsp;<span class="op" id="5693506">(</span><span class="ident" id="5693507">b</span>&nbsp;<span class="op" id="5693509">*</span><span class="ident" id="5693510"><a href="/archive/zip/reader.go.html#5693283">readBuf</a></span><span class="op" id="5693517">)</span>&nbsp;<span class="ident" id="5693519">uint64</span><span class="op" id="5693525">(</span><span class="op" id="5693526">)</span>&nbsp;<span class="ident" id="5693528">uint64</span>&nbsp;<span class="op" id="5693535">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5693538">v</span>&nbsp;<span class="op" id="5693540">:=</span>&nbsp;<span class="ident" id="5693543"><a href="/archive/zip/reader.go.html#5681398">binary</a></span><span class="op" id="5693549">.</span><span class="ident" id="5693550">LittleEndian</span><span class="op" id="5693562">.</span><span class="ident" id="5693563">Uint64</span><span class="op" id="5693569">(</span><span class="op" id="5693570">*</span><span class="ident" id="5693571"><a href="/archive/zip/reader.go.html#5693507">b</a></span><span class="op" id="5693572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5693575">*</span><span class="ident" id="5693576"><a href="/archive/zip/reader.go.html#5693507">b</a></span>&nbsp;<span class="op" id="5693578">=</span>&nbsp;<span class="op" id="5693580">(</span><span class="op" id="5693581">*</span><span class="ident" id="5693582"><a href="/archive/zip/reader.go.html#5693507">b</a></span><span class="op" id="5693583">)</span><span class="op" id="5693584">[</span><span class="num" id="5693585">8</span><span class="op" id="5693586">:</span><span class="op" id="5693587">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693590">return</span>&nbsp;<span class="ident" id="5693597"><a href="/archive/zip/reader.go.html#5693538">v</a></span><br>
<span class="lineno"></span><span class="op" id="5693599">}</span>
</div>
</body>
</html>
