<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html" class="current">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2495988">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2496044">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2496098">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2496149">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2496214">//&nbsp;Socket&nbsp;control&nbsp;messages</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2496242">package</span>&nbsp;<span class="ident" id="2496250">syscall</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="2496259">import</span>&nbsp;<span class="string" id="2496266">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2496276">//&nbsp;Round&nbsp;the&nbsp;length&nbsp;of&nbsp;a&nbsp;raw&nbsp;sockaddr&nbsp;up&nbsp;to&nbsp;align&nbsp;it&nbsp;properly.</span><br>
<span class="lineno"></span><span class="keyword" id="2496339">func</span>&nbsp;<span class="ident" id="2496344">cmsgAlignOf</span><span class="op" id="2496355">(</span><span class="ident" id="2496356">salen</span>&nbsp;<span class="builtintype" id="2496362">int</span><span class="op" id="2496365">)</span>&nbsp;<span class="builtintype" id="2496367">int</span>&nbsp;<span class="op" id="2496371">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2496374">salign</span>&nbsp;<span class="op" id="2496381">:=</span>&nbsp;<span class="ident" id="2496384">sizeofPtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2496395">//&nbsp;NOTE:&nbsp;It&nbsp;seems&nbsp;like&nbsp;64-bit&nbsp;Darwin&nbsp;and&nbsp;DragonFly&nbsp;BSD&nbsp;kernels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2496459">//&nbsp;still&nbsp;require&nbsp;32-bit&nbsp;aligned&nbsp;access&nbsp;to&nbsp;network&nbsp;subsystem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2496521">if</span>&nbsp;<span class="ident" id="2496524">darwin64Bit</span>&nbsp;<span class="op" id="2496536">||</span>&nbsp;<span class="ident" id="2496539">dragonfly64Bit</span>&nbsp;<span class="op" id="2496554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2496558">salign</span>&nbsp;<span class="op" id="2496565">=</span>&nbsp;<span class="num" id="2496567">4</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2496570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2496573">return</span>&nbsp;<span class="op" id="2496580">(</span><span class="ident" id="2496581">salen</span>&nbsp;<span class="op" id="2496587">+</span>&nbsp;<span class="ident" id="2496589">salign</span>&nbsp;<span class="op" id="2496596">-</span>&nbsp;<span class="num" id="2496598">1</span><span class="op" id="2496599">)</span>&nbsp;<span class="op" id="2496601">&amp;</span>&nbsp;<span class="op" id="2496603">^</span><span class="op" id="2496604">(</span><span class="ident" id="2496605">salign</span>&nbsp;<span class="op" id="2496612">-</span>&nbsp;<span class="num" id="2496614">1</span><span class="op" id="2496615">)</span><br>
<span class="lineno"></span><span class="op" id="2496617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2496620">//&nbsp;CmsgLen&nbsp;returns&nbsp;the&nbsp;value&nbsp;to&nbsp;store&nbsp;in&nbsp;the&nbsp;Len&nbsp;field&nbsp;of&nbsp;the&nbsp;Cmsghdr</span><br>
<span class="lineno">25</span><span class="comment" id="2496690">//&nbsp;structure,&nbsp;taking&nbsp;into&nbsp;account&nbsp;any&nbsp;necessary&nbsp;alignment.</span><br>
<span class="lineno"></span><span class="keyword" id="2496749">func</span>&nbsp;<span class="ident" id="2496754">CmsgLen</span><span class="op" id="2496761">(</span><span class="ident" id="2496762">datalen</span>&nbsp;<span class="builtintype" id="2496770">int</span><span class="op" id="2496773">)</span>&nbsp;<span class="builtintype" id="2496775">int</span>&nbsp;<span class="op" id="2496779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2496782">return</span>&nbsp;<span class="ident" id="2496789">cmsgAlignOf</span><span class="op" id="2496800">(</span><span class="ident" id="2496801">SizeofCmsghdr</span><span class="op" id="2496814">)</span>&nbsp;<span class="op" id="2496816">+</span>&nbsp;<span class="ident" id="2496818">datalen</span><br>
<span class="lineno"></span><span class="op" id="2496826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="2496829">//&nbsp;CmsgSpace&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;an&nbsp;ancillary&nbsp;element&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="2496896">//&nbsp;payload&nbsp;of&nbsp;the&nbsp;passed&nbsp;data&nbsp;length&nbsp;occupies.</span><br>
<span class="lineno"></span><span class="keyword" id="2496943">func</span>&nbsp;<span class="ident" id="2496948">CmsgSpace</span><span class="op" id="2496957">(</span><span class="ident" id="2496958">datalen</span>&nbsp;<span class="builtintype" id="2496966">int</span><span class="op" id="2496969">)</span>&nbsp;<span class="builtintype" id="2496971">int</span>&nbsp;<span class="op" id="2496975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2496978">return</span>&nbsp;<span class="ident" id="2496985">cmsgAlignOf</span><span class="op" id="2496996">(</span><span class="ident" id="2496997">SizeofCmsghdr</span><span class="op" id="2497010">)</span>&nbsp;<span class="op" id="2497012">+</span>&nbsp;<span class="ident" id="2497014">cmsgAlignOf</span><span class="op" id="2497025">(</span><span class="ident" id="2497026">datalen</span><span class="op" id="2497033">)</span><br>
<span class="lineno"></span><span class="op" id="2497035">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="2497038">func</span>&nbsp;<span class="ident" id="2497043">cmsgData</span><span class="op" id="2497051">(</span><span class="ident" id="2497052">h</span>&nbsp;<span class="op" id="2497054">*</span><span class="ident" id="2497055">Cmsghdr</span><span class="op" id="2497062">)</span>&nbsp;<span class="ident" id="2497064">unsafe</span><span class="op" id="2497070">.</span><span class="ident" id="2497071">Pointer</span>&nbsp;<span class="op" id="2497079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2497082">return</span>&nbsp;<span class="ident" id="2497089">unsafe</span><span class="op" id="2497095">.</span><span class="ident" id="2497096">Pointer</span><span class="op" id="2497103">(</span><span class="builtintype" id="2497104">uintptr</span><span class="op" id="2497111">(</span><span class="ident" id="2497112">unsafe</span><span class="op" id="2497118">.</span><span class="ident" id="2497119">Pointer</span><span class="op" id="2497126">(</span><span class="ident" id="2497127">h</span><span class="op" id="2497128">)</span><span class="op" id="2497129">)</span>&nbsp;<span class="op" id="2497131">+</span>&nbsp;<span class="builtintype" id="2497133">uintptr</span><span class="op" id="2497140">(</span><span class="ident" id="2497141">cmsgAlignOf</span><span class="op" id="2497152">(</span><span class="ident" id="2497153">SizeofCmsghdr</span><span class="op" id="2497166">)</span><span class="op" id="2497167">)</span><span class="op" id="2497168">)</span><br>
<span class="lineno"></span><span class="op" id="2497170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="2497173">//&nbsp;SocketControlMessage&nbsp;represents&nbsp;a&nbsp;socket&nbsp;control&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="2497234">type</span>&nbsp;<span class="ident" id="2497239">SocketControlMessage</span>&nbsp;<span class="keyword" id="2497260">struct</span>&nbsp;<span class="op" id="2497267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2497270">Header</span>&nbsp;<span class="ident" id="2497277">Cmsghdr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2497286">Data</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2497293">[</span><span class="op" id="2497294">]</span><span class="builtintype" id="2497295">byte</span><br>
<span class="lineno"></span><span class="op" id="2497300">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="2497303">//&nbsp;ParseSocketControlMessage&nbsp;parses&nbsp;b&nbsp;as&nbsp;an&nbsp;array&nbsp;of&nbsp;socket&nbsp;control</span><br>
<span class="lineno"></span><span class="comment" id="2497371">//&nbsp;messages.</span><br>
<span class="lineno"></span><span class="keyword" id="2497384">func</span>&nbsp;<span class="ident" id="2497389">ParseSocketControlMessage</span><span class="op" id="2497414">(</span><span class="ident" id="2497415">b</span>&nbsp;<span class="op" id="2497417">[</span><span class="op" id="2497418">]</span><span class="builtintype" id="2497419">byte</span><span class="op" id="2497423">)</span>&nbsp;<span class="op" id="2497425">(</span><span class="op" id="2497426">[</span><span class="op" id="2497427">]</span><span class="ident" id="2497428">SocketControlMessage</span><span class="op" id="2497448">,</span>&nbsp;<span class="builtintype" id="2497450">error</span><span class="op" id="2497455">)</span>&nbsp;<span class="op" id="2497457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2497460">var</span>&nbsp;<span class="ident" id="2497464">msgs</span>&nbsp;<span class="op" id="2497469">[</span><span class="op" id="2497470">]</span><span class="ident" id="2497471">SocketControlMessage</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2497493">i</span>&nbsp;<span class="op" id="2497495">:=</span>&nbsp;<span class="num" id="2497498">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2497501">for</span>&nbsp;<span class="ident" id="2497505">i</span><span class="op" id="2497506">+</span><span class="ident" id="2497507">CmsgLen</span><span class="op" id="2497514">(</span><span class="num" id="2497515">0</span><span class="op" id="2497516">)</span>&nbsp;<span class="op" id="2497518">&lt;=</span>&nbsp;<span class="builtinfunc" id="2497521">len</span><span class="op" id="2497524">(</span><span class="ident" id="2497525">b</span><span class="op" id="2497526">)</span>&nbsp;<span class="op" id="2497528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2497532">h</span><span class="op" id="2497533">,</span>&nbsp;<span class="ident" id="2497535">dbuf</span><span class="op" id="2497539">,</span>&nbsp;<span class="ident" id="2497541">err</span>&nbsp;<span class="op" id="2497545">:=</span>&nbsp;<span class="ident" id="2497548">socketControlMessageHeaderAndData</span><span class="op" id="2497581">(</span><span class="ident" id="2497582">b</span><span class="op" id="2497583">[</span><span class="ident" id="2497584">i</span><span class="op" id="2497585">:</span><span class="op" id="2497586">]</span><span class="op" id="2497587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2497591">if</span>&nbsp;<span class="ident" id="2497594">err</span>&nbsp;<span class="op" id="2497598">!=</span>&nbsp;<span class="builtintype" id="2497601">nil</span>&nbsp;<span class="op" id="2497605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2497610">return</span>&nbsp;<span class="builtintype" id="2497617">nil</span><span class="op" id="2497620">,</span>&nbsp;<span class="ident" id="2497622">err</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2497628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2497632">m</span>&nbsp;<span class="op" id="2497634">:=</span>&nbsp;<span class="ident" id="2497637">SocketControlMessage</span><span class="op" id="2497657">{</span><span class="ident" id="2497658">Header</span><span class="op" id="2497664">:</span>&nbsp;<span class="op" id="2497666">*</span><span class="ident" id="2497667">h</span><span class="op" id="2497668">,</span>&nbsp;<span class="ident" id="2497670">Data</span><span class="op" id="2497674">:</span>&nbsp;<span class="ident" id="2497676">dbuf</span><span class="op" id="2497680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2497684">msgs</span>&nbsp;<span class="op" id="2497689">=</span>&nbsp;<span class="builtinfunc" id="2497691">append</span><span class="op" id="2497697">(</span><span class="ident" id="2497698">msgs</span><span class="op" id="2497702">,</span>&nbsp;<span class="ident" id="2497704">m</span><span class="op" id="2497705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2497709">i</span>&nbsp;<span class="op" id="2497711">+=</span>&nbsp;<span class="ident" id="2497714">cmsgAlignOf</span><span class="op" id="2497725">(</span><span class="builtintype" id="2497726">int</span><span class="op" id="2497729">(</span><span class="ident" id="2497730">h</span><span class="op" id="2497731">.</span><span class="ident" id="2497732">Len</span><span class="op" id="2497735">)</span><span class="op" id="2497736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2497739">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2497742">return</span>&nbsp;<span class="ident" id="2497749">msgs</span><span class="op" id="2497753">,</span>&nbsp;<span class="builtintype" id="2497755">nil</span><br>
<span class="lineno"></span><span class="op" id="2497759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2497762">func</span>&nbsp;<span class="ident" id="2497767">socketControlMessageHeaderAndData</span><span class="op" id="2497800">(</span><span class="ident" id="2497801">b</span>&nbsp;<span class="op" id="2497803">[</span><span class="op" id="2497804">]</span><span class="builtintype" id="2497805">byte</span><span class="op" id="2497809">)</span>&nbsp;<span class="op" id="2497811">(</span><span class="op" id="2497812">*</span><span class="ident" id="2497813">Cmsghdr</span><span class="op" id="2497820">,</span>&nbsp;<span class="op" id="2497822">[</span><span class="op" id="2497823">]</span><span class="builtintype" id="2497824">byte</span><span class="op" id="2497828">,</span>&nbsp;<span class="builtintype" id="2497830">error</span><span class="op" id="2497835">)</span>&nbsp;<span class="op" id="2497837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2497840">h</span>&nbsp;<span class="op" id="2497842">:=</span>&nbsp;<span class="op" id="2497845">(</span><span class="op" id="2497846">*</span><span class="ident" id="2497847">Cmsghdr</span><span class="op" id="2497854">)</span><span class="op" id="2497855">(</span><span class="ident" id="2497856">unsafe</span><span class="op" id="2497862">.</span><span class="ident" id="2497863">Pointer</span><span class="op" id="2497870">(</span><span class="op" id="2497871">&amp;</span><span class="ident" id="2497872">b</span><span class="op" id="2497873">[</span><span class="num" id="2497874">0</span><span class="op" id="2497875">]</span><span class="op" id="2497876">)</span><span class="op" id="2497877">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2497880">if</span>&nbsp;<span class="ident" id="2497883">h</span><span class="op" id="2497884">.</span><span class="ident" id="2497885">Len</span>&nbsp;<span class="op" id="2497889">&lt;</span>&nbsp;<span class="ident" id="2497891">SizeofCmsghdr</span>&nbsp;<span class="op" id="2497905">||</span>&nbsp;<span class="builtintype" id="2497908">int</span><span class="op" id="2497911">(</span><span class="ident" id="2497912">h</span><span class="op" id="2497913">.</span><span class="ident" id="2497914">Len</span><span class="op" id="2497917">)</span>&nbsp;<span class="op" id="2497919">&gt;</span>&nbsp;<span class="builtinfunc" id="2497921">len</span><span class="op" id="2497924">(</span><span class="ident" id="2497925">b</span><span class="op" id="2497926">)</span>&nbsp;<span class="op" id="2497928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2497932">return</span>&nbsp;<span class="builtintype" id="2497939">nil</span><span class="op" id="2497942">,</span>&nbsp;<span class="builtintype" id="2497944">nil</span><span class="op" id="2497947">,</span>&nbsp;<span class="ident" id="2497949">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2497957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2497960">return</span>&nbsp;<span class="ident" id="2497967">h</span><span class="op" id="2497968">,</span>&nbsp;<span class="ident" id="2497970">b</span><span class="op" id="2497971">[</span><span class="ident" id="2497972">cmsgAlignOf</span><span class="op" id="2497983">(</span><span class="ident" id="2497984">SizeofCmsghdr</span><span class="op" id="2497997">)</span><span class="op" id="2497998">:</span><span class="ident" id="2497999">h</span><span class="op" id="2498000">.</span><span class="ident" id="2498001">Len</span><span class="op" id="2498004">]</span><span class="op" id="2498005">,</span>&nbsp;<span class="builtintype" id="2498007">nil</span><br>
<span class="lineno"></span><span class="op" id="2498011">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="2498014">//&nbsp;UnixRights&nbsp;encodes&nbsp;a&nbsp;set&nbsp;of&nbsp;open&nbsp;file&nbsp;descriptors&nbsp;into&nbsp;a&nbsp;socket</span><br>
<span class="lineno"></span><span class="comment" id="2498081">//&nbsp;control&nbsp;message&nbsp;for&nbsp;sending&nbsp;to&nbsp;another&nbsp;process.</span><br>
<span class="lineno"></span><span class="keyword" id="2498132">func</span>&nbsp;<span class="ident" id="2498137">UnixRights</span><span class="op" id="2498147">(</span><span class="ident" id="2498148">fds</span>&nbsp;<span class="op" id="2498152">...</span><span class="builtintype" id="2498155">int</span><span class="op" id="2498158">)</span>&nbsp;<span class="op" id="2498160">[</span><span class="op" id="2498161">]</span><span class="builtintype" id="2498162">byte</span>&nbsp;<span class="op" id="2498167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2498170">datalen</span>&nbsp;<span class="op" id="2498178">:=</span>&nbsp;<span class="builtinfunc" id="2498181">len</span><span class="op" id="2498184">(</span><span class="ident" id="2498185">fds</span><span class="op" id="2498188">)</span>&nbsp;<span class="op" id="2498190">*</span>&nbsp;<span class="num" id="2498192">4</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2498195">b</span>&nbsp;<span class="op" id="2498197">:=</span>&nbsp;<span class="builtinfunc" id="2498200">make</span><span class="op" id="2498204">(</span><span class="op" id="2498205">[</span><span class="op" id="2498206">]</span><span class="builtintype" id="2498207">byte</span><span class="op" id="2498211">,</span>&nbsp;<span class="ident" id="2498213">CmsgSpace</span><span class="op" id="2498222">(</span><span class="ident" id="2498223">datalen</span><span class="op" id="2498230">)</span><span class="op" id="2498231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2498234">h</span>&nbsp;<span class="op" id="2498236">:=</span>&nbsp;<span class="op" id="2498239">(</span><span class="op" id="2498240">*</span><span class="ident" id="2498241">Cmsghdr</span><span class="op" id="2498248">)</span><span class="op" id="2498249">(</span><span class="ident" id="2498250">unsafe</span><span class="op" id="2498256">.</span><span class="ident" id="2498257">Pointer</span><span class="op" id="2498264">(</span><span class="op" id="2498265">&amp;</span><span class="ident" id="2498266">b</span><span class="op" id="2498267">[</span><span class="num" id="2498268">0</span><span class="op" id="2498269">]</span><span class="op" id="2498270">)</span><span class="op" id="2498271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2498274">h</span><span class="op" id="2498275">.</span><span class="ident" id="2498276">Level</span>&nbsp;<span class="op" id="2498282">=</span>&nbsp;<span class="ident" id="2498284">SOL_SOCKET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2498296">h</span><span class="op" id="2498297">.</span><span class="ident" id="2498298">Type</span>&nbsp;<span class="op" id="2498303">=</span>&nbsp;<span class="ident" id="2498305">SCM_RIGHTS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2498317">h</span><span class="op" id="2498318">.</span><span class="ident" id="2498319">SetLen</span><span class="op" id="2498325">(</span><span class="ident" id="2498326">CmsgLen</span><span class="op" id="2498333">(</span><span class="ident" id="2498334">datalen</span><span class="op" id="2498341">)</span><span class="op" id="2498342">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2498345">data</span>&nbsp;<span class="op" id="2498350">:=</span>&nbsp;<span class="builtintype" id="2498353">uintptr</span><span class="op" id="2498360">(</span><span class="ident" id="2498361">cmsgData</span><span class="op" id="2498369">(</span><span class="ident" id="2498370">h</span><span class="op" id="2498371">)</span><span class="op" id="2498372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2498375">for</span>&nbsp;<span class="ident" id="2498379">_</span><span class="op" id="2498380">,</span>&nbsp;<span class="ident" id="2498382">fd</span>&nbsp;<span class="op" id="2498385">:=</span>&nbsp;<span class="keyword" id="2498388">range</span>&nbsp;<span class="ident" id="2498394">fds</span>&nbsp;<span class="op" id="2498398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2498402">*</span><span class="op" id="2498403">(</span><span class="op" id="2498404">*</span><span class="builtintype" id="2498405">int32</span><span class="op" id="2498410">)</span><span class="op" id="2498411">(</span><span class="ident" id="2498412">unsafe</span><span class="op" id="2498418">.</span><span class="ident" id="2498419">Pointer</span><span class="op" id="2498426">(</span><span class="ident" id="2498427">data</span><span class="op" id="2498431">)</span><span class="op" id="2498432">)</span>&nbsp;<span class="op" id="2498434">=</span>&nbsp;<span class="builtintype" id="2498436">int32</span><span class="op" id="2498441">(</span><span class="ident" id="2498442">fd</span><span class="op" id="2498444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2498448">data</span>&nbsp;<span class="op" id="2498453">+=</span>&nbsp;<span class="num" id="2498456">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2498459">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2498462">return</span>&nbsp;<span class="ident" id="2498469">b</span><br>
<span class="lineno"></span><span class="op" id="2498471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2498474">//&nbsp;ParseUnixRights&nbsp;decodes&nbsp;a&nbsp;socket&nbsp;control&nbsp;message&nbsp;that&nbsp;contains&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="2498543">//&nbsp;integer&nbsp;array&nbsp;of&nbsp;open&nbsp;file&nbsp;descriptors&nbsp;from&nbsp;another&nbsp;process.</span><br>
<span class="lineno">90</span><span class="keyword" id="2498607">func</span>&nbsp;<span class="ident" id="2498612">ParseUnixRights</span><span class="op" id="2498627">(</span><span class="ident" id="2498628">m</span>&nbsp;<span class="op" id="2498630">*</span><span class="ident" id="2498631">SocketControlMessage</span><span class="op" id="2498651">)</span>&nbsp;<span class="op" id="2498653">(</span><span class="op" id="2498654">[</span><span class="op" id="2498655">]</span><span class="builtintype" id="2498656">int</span><span class="op" id="2498659">,</span>&nbsp;<span class="builtintype" id="2498661">error</span><span class="op" id="2498666">)</span>&nbsp;<span class="op" id="2498668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2498671">if</span>&nbsp;<span class="ident" id="2498674">m</span><span class="op" id="2498675">.</span><span class="ident" id="2498676">Header</span><span class="op" id="2498682">.</span><span class="ident" id="2498683">Level</span>&nbsp;<span class="op" id="2498689">!=</span>&nbsp;<span class="ident" id="2498692">SOL_SOCKET</span>&nbsp;<span class="op" id="2498703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2498707">return</span>&nbsp;<span class="builtintype" id="2498714">nil</span><span class="op" id="2498717">,</span>&nbsp;<span class="ident" id="2498719">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2498727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2498730">if</span>&nbsp;<span class="ident" id="2498733">m</span><span class="op" id="2498734">.</span><span class="ident" id="2498735">Header</span><span class="op" id="2498741">.</span><span class="ident" id="2498742">Type</span>&nbsp;<span class="op" id="2498747">!=</span>&nbsp;<span class="ident" id="2498750">SCM_RIGHTS</span>&nbsp;<span class="op" id="2498761">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2498765">return</span>&nbsp;<span class="builtintype" id="2498772">nil</span><span class="op" id="2498775">,</span>&nbsp;<span class="ident" id="2498777">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2498785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2498788">fds</span>&nbsp;<span class="op" id="2498792">:=</span>&nbsp;<span class="builtinfunc" id="2498795">make</span><span class="op" id="2498799">(</span><span class="op" id="2498800">[</span><span class="op" id="2498801">]</span><span class="builtintype" id="2498802">int</span><span class="op" id="2498805">,</span>&nbsp;<span class="builtinfunc" id="2498807">len</span><span class="op" id="2498810">(</span><span class="ident" id="2498811">m</span><span class="op" id="2498812">.</span><span class="ident" id="2498813">Data</span><span class="op" id="2498817">)</span><span class="op" id="2498818">&gt;&gt;</span><span class="num" id="2498820">2</span><span class="op" id="2498821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2498824">for</span>&nbsp;<span class="ident" id="2498828">i</span><span class="op" id="2498829">,</span>&nbsp;<span class="ident" id="2498831">j</span>&nbsp;<span class="op" id="2498833">:=</span>&nbsp;<span class="num" id="2498836">0</span><span class="op" id="2498837">,</span>&nbsp;<span class="num" id="2498839">0</span><span class="op" id="2498840">;</span>&nbsp;<span class="ident" id="2498842">i</span>&nbsp;<span class="op" id="2498844">&lt;</span>&nbsp;<span class="builtinfunc" id="2498846">len</span><span class="op" id="2498849">(</span><span class="ident" id="2498850">m</span><span class="op" id="2498851">.</span><span class="ident" id="2498852">Data</span><span class="op" id="2498856">)</span><span class="op" id="2498857">;</span>&nbsp;<span class="ident" id="2498859">i</span>&nbsp;<span class="op" id="2498861">+=</span>&nbsp;<span class="num" id="2498864">4</span>&nbsp;<span class="op" id="2498866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2498870">fds</span><span class="op" id="2498873">[</span><span class="ident" id="2498874">j</span><span class="op" id="2498875">]</span>&nbsp;<span class="op" id="2498877">=</span>&nbsp;<span class="builtintype" id="2498879">int</span><span class="op" id="2498882">(</span><span class="op" id="2498883">*</span><span class="op" id="2498884">(</span><span class="op" id="2498885">*</span><span class="builtintype" id="2498886">int32</span><span class="op" id="2498891">)</span><span class="op" id="2498892">(</span><span class="ident" id="2498893">unsafe</span><span class="op" id="2498899">.</span><span class="ident" id="2498900">Pointer</span><span class="op" id="2498907">(</span><span class="op" id="2498908">&amp;</span><span class="ident" id="2498909">m</span><span class="op" id="2498910">.</span><span class="ident" id="2498911">Data</span><span class="op" id="2498915">[</span><span class="ident" id="2498916">i</span><span class="op" id="2498917">]</span><span class="op" id="2498918">)</span><span class="op" id="2498919">)</span><span class="op" id="2498920">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2498924">j</span><span class="op" id="2498925">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2498929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2498932">return</span>&nbsp;<span class="ident" id="2498939">fds</span><span class="op" id="2498942">,</span>&nbsp;<span class="builtintype" id="2498944">nil</span><br>
<span class="lineno"></span><span class="op" id="2498948">}</span>
</div>
</body>
</html>
