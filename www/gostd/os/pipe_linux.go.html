<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os</h2>
<ul>
<li><a href="/gostd/os/dir_unix.go.html">dir_unix.go</a></li>
<li><a href="/gostd/os/doc.go.html">doc.go</a></li>
<li><a href="/gostd/os/env.go.html">env.go</a></li>
<li><a href="/gostd/os/env_test.go.html">env_test.go</a></li>
<li><a href="/gostd/os/env_unix_test.go.html">env_unix_test.go</a></li>
<li><a href="/gostd/os/error.go.html">error.go</a></li>
<li><a href="/gostd/os/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/os/error_unix.go.html">error_unix.go</a></li>
<li><a href="/gostd/os/exec.go.html">exec.go</a></li>
<li><a href="/gostd/os/exec_posix.go.html">exec_posix.go</a></li>
<li><a href="/gostd/os/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/os/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/os/file.go.html">file.go</a></li>
<li><a href="/gostd/os/file_posix.go.html">file_posix.go</a></li>
<li><a href="/gostd/os/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/os/getwd.go.html">getwd.go</a></li>
<li><a href="/gostd/os/os_test.go.html">os_test.go</a></li>
<li><a href="/gostd/os/os_unix_test.go.html">os_unix_test.go</a></li>
<li><a href="/gostd/os/path.go.html">path.go</a></li>
<li><a href="/gostd/os/path_test.go.html">path_test.go</a></li>
<li><a href="/gostd/os/path_unix.go.html">path_unix.go</a></li>
<li><a href="/gostd/os/pipe_linux.go.html">pipe_linux.go</a></li>
<li><a href="/gostd/os/proc.go.html">proc.go</a></li>
<li><a href="/gostd/os/stat_linux.go.html">stat_linux.go</a></li>
<li><a href="/gostd/os/sys_linux.go.html">sys_linux.go</a></li>
<li><a href="/gostd/os/sys_unix.go.html">sys_unix.go</a></li>
<li><a href="/gostd/os/types.go.html">types.go</a></li>
<li><a href="/gostd/os/types_notwin.go.html">types_notwin.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2489233">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2489288">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2489342">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2489393">package</span>&nbsp;<span class="ident" id="2489401">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2489405">import</span>&nbsp;<span class="string" id="2489412">&#34;syscall&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2489423">//&nbsp;Pipe&nbsp;returns&nbsp;a&nbsp;connected&nbsp;pair&nbsp;of&nbsp;Files;&nbsp;reads&nbsp;from&nbsp;r&nbsp;return&nbsp;bytes&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno">10</span><span class="comment" id="2489506">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;files&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2489552">func</span>&nbsp;<span class="ident" id="2489557">Pipe</span><span class="op" id="2489561">(</span><span class="op" id="2489562">)</span>&nbsp;<span class="op" id="2489564">(</span><span class="ident" id="2489565">r</span>&nbsp;<span class="op" id="2489567">*</span><span class="ident" id="2489568">File</span><span class="op" id="2489572">,</span>&nbsp;<span class="ident" id="2489574">w</span>&nbsp;<span class="op" id="2489576">*</span><span class="ident" id="2489577">File</span><span class="op" id="2489581">,</span>&nbsp;<span class="ident" id="2489583">err</span>&nbsp;<span class="builtintype" id="2489587">error</span><span class="op" id="2489592">)</span>&nbsp;<span class="op" id="2489594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2489597">var</span>&nbsp;<span class="ident" id="2489601">p</span>&nbsp;<span class="op" id="2489603">[</span><span class="num" id="2489604">2</span><span class="op" id="2489605">]</span><span class="builtintype" id="2489606">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2489612">e</span>&nbsp;<span class="op" id="2489614">:=</span>&nbsp;<span class="ident" id="2489617">syscall</span><span class="op" id="2489624">.</span><span class="ident" id="2489625">Pipe2</span><span class="op" id="2489630">(</span><span class="ident" id="2489631">p</span><span class="op" id="2489632">[</span><span class="num" id="2489633">0</span><span class="op" id="2489634">:</span><span class="op" id="2489635">]</span><span class="op" id="2489636">,</span>&nbsp;<span class="ident" id="2489638">syscall</span><span class="op" id="2489645">.</span><span class="ident" id="2489646">O_CLOEXEC</span><span class="op" id="2489655">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2489658">//&nbsp;pipe2&nbsp;was&nbsp;added&nbsp;in&nbsp;2.6.27&nbsp;and&nbsp;our&nbsp;minimum&nbsp;requirement&nbsp;is&nbsp;2.6.23,&nbsp;so&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2489733">//&nbsp;might&nbsp;not&nbsp;be&nbsp;implemented.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2489763">if</span>&nbsp;<span class="ident" id="2489766">e</span>&nbsp;<span class="op" id="2489768">==</span>&nbsp;<span class="ident" id="2489771">syscall</span><span class="op" id="2489778">.</span><span class="ident" id="2489779">ENOSYS</span>&nbsp;<span class="op" id="2489786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2489790">//&nbsp;See&nbsp;../syscall/exec.go&nbsp;for&nbsp;description&nbsp;of&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2489843">syscall</span><span class="op" id="2489850">.</span><span class="ident" id="2489851">ForkLock</span><span class="op" id="2489859">.</span><span class="ident" id="2489860">RLock</span><span class="op" id="2489865">(</span><span class="op" id="2489866">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2489870">e</span>&nbsp;<span class="op" id="2489872">=</span>&nbsp;<span class="ident" id="2489874">syscall</span><span class="op" id="2489881">.</span><span class="ident" id="2489882">Pipe</span><span class="op" id="2489886">(</span><span class="ident" id="2489887">p</span><span class="op" id="2489888">[</span><span class="num" id="2489889">0</span><span class="op" id="2489890">:</span><span class="op" id="2489891">]</span><span class="op" id="2489892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2489896">if</span>&nbsp;<span class="ident" id="2489899">e</span>&nbsp;<span class="op" id="2489901">!=</span>&nbsp;<span class="ident" id="2489904">nil</span>&nbsp;<span class="op" id="2489908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2489913">syscall</span><span class="op" id="2489920">.</span><span class="ident" id="2489921">ForkLock</span><span class="op" id="2489929">.</span><span class="ident" id="2489930">RUnlock</span><span class="op" id="2489937">(</span><span class="op" id="2489938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2489943">return</span>&nbsp;<span class="ident" id="2489950">nil</span><span class="op" id="2489953">,</span>&nbsp;<span class="ident" id="2489955">nil</span><span class="op" id="2489958">,</span>&nbsp;<span class="ident" id="2489960">NewSyscallError</span><span class="op" id="2489975">(</span><span class="string" id="2489976">&#34;pipe&#34;</span><span class="op" id="2489982">,</span>&nbsp;<span class="ident" id="2489984">e</span><span class="op" id="2489985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2489989">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2489993">syscall</span><span class="op" id="2490000">.</span><span class="ident" id="2490001">CloseOnExec</span><span class="op" id="2490012">(</span><span class="ident" id="2490013">p</span><span class="op" id="2490014">[</span><span class="num" id="2490015">0</span><span class="op" id="2490016">]</span><span class="op" id="2490017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2490021">syscall</span><span class="op" id="2490028">.</span><span class="ident" id="2490029">CloseOnExec</span><span class="op" id="2490040">(</span><span class="ident" id="2490041">p</span><span class="op" id="2490042">[</span><span class="num" id="2490043">1</span><span class="op" id="2490044">]</span><span class="op" id="2490045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2490049">syscall</span><span class="op" id="2490056">.</span><span class="ident" id="2490057">ForkLock</span><span class="op" id="2490065">.</span><span class="ident" id="2490066">RUnlock</span><span class="op" id="2490073">(</span><span class="op" id="2490074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2490077">}</span>&nbsp;<span class="keyword" id="2490079">else</span>&nbsp;<span class="keyword" id="2490084">if</span>&nbsp;<span class="ident" id="2490087">e</span>&nbsp;<span class="op" id="2490089">!=</span>&nbsp;<span class="ident" id="2490092">nil</span>&nbsp;<span class="op" id="2490096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2490100">return</span>&nbsp;<span class="ident" id="2490107">nil</span><span class="op" id="2490110">,</span>&nbsp;<span class="ident" id="2490112">nil</span><span class="op" id="2490115">,</span>&nbsp;<span class="ident" id="2490117">NewSyscallError</span><span class="op" id="2490132">(</span><span class="string" id="2490133">&#34;pipe2&#34;</span><span class="op" id="2490140">,</span>&nbsp;<span class="ident" id="2490142">e</span><span class="op" id="2490143">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2490146">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2490150">return</span>&nbsp;<span class="ident" id="2490157">NewFile</span><span class="op" id="2490164">(</span><span class="builtintype" id="2490165">uintptr</span><span class="op" id="2490172">(</span><span class="ident" id="2490173">p</span><span class="op" id="2490174">[</span><span class="num" id="2490175">0</span><span class="op" id="2490176">]</span><span class="op" id="2490177">)</span><span class="op" id="2490178">,</span>&nbsp;<span class="string" id="2490180">&#34;|0&#34;</span><span class="op" id="2490184">)</span><span class="op" id="2490185">,</span>&nbsp;<span class="ident" id="2490187">NewFile</span><span class="op" id="2490194">(</span><span class="builtintype" id="2490195">uintptr</span><span class="op" id="2490202">(</span><span class="ident" id="2490203">p</span><span class="op" id="2490204">[</span><span class="num" id="2490205">1</span><span class="op" id="2490206">]</span><span class="op" id="2490207">)</span><span class="op" id="2490208">,</span>&nbsp;<span class="string" id="2490210">&#34;|1&#34;</span><span class="op" id="2490214">)</span><span class="op" id="2490215">,</span>&nbsp;<span class="ident" id="2490217">nil</span><br>
<span class="lineno"></span><span class="op" id="2490221">}</span>
</div>
</body>
</html>
