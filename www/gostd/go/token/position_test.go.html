<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/token</h2>
<ul>
<li><a href="/gostd/go/token/position.go.html">position.go</a></li>
<li><a href="/gostd/go/token/position_test.go.html">position_test.go</a></li>
<li><a href="/gostd/go/token/serialize.go.html">serialize.go</a></li>
<li><a href="/gostd/go/token/serialize_test.go.html">serialize_test.go</a></li>
<li><a href="/gostd/go/token/token.go.html">token.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7474880">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7474935">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7474989">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7475040">package</span>&nbsp;<span class="ident" id="7475048">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7475055">import</span>&nbsp;<span class="op" id="7475062">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7475065">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7475072">&#34;math/rand&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7475085">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7475093">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7475103">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7475106">func</span>&nbsp;<span class="ident" id="7475111">checkPos</span><span class="op" id="7475119">(</span><span class="ident" id="7475120">t</span>&nbsp;<span class="op" id="7475122">*</span><span class="ident" id="7475123">testing</span><span class="op" id="7475130">.</span><span class="ident" id="7475131">T</span><span class="op" id="7475132">,</span>&nbsp;<span class="ident" id="7475134">msg</span>&nbsp;<span class="builtintype" id="7475138">string</span><span class="op" id="7475144">,</span>&nbsp;<span class="ident" id="7475146">got</span><span class="op" id="7475149">,</span>&nbsp;<span class="ident" id="7475151">want</span>&nbsp;<span class="ident" id="7475156">Position</span><span class="op" id="7475164">)</span>&nbsp;<span class="op" id="7475166">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7475169">if</span>&nbsp;<span class="ident" id="7475172">got</span><span class="op" id="7475175">.</span><span class="ident" id="7475176">Filename</span>&nbsp;<span class="op" id="7475185">!=</span>&nbsp;<span class="ident" id="7475188">want</span><span class="op" id="7475192">.</span><span class="ident" id="7475193">Filename</span>&nbsp;<span class="op" id="7475202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7475206">t</span><span class="op" id="7475207">.</span><span class="ident" id="7475208">Errorf</span><span class="op" id="7475214">(</span><span class="string" id="7475215">&#34;%s:&nbsp;got&nbsp;filename&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7475247">,</span>&nbsp;<span class="ident" id="7475249">msg</span><span class="op" id="7475252">,</span>&nbsp;<span class="ident" id="7475254">got</span><span class="op" id="7475257">.</span><span class="ident" id="7475258">Filename</span><span class="op" id="7475266">,</span>&nbsp;<span class="ident" id="7475268">want</span><span class="op" id="7475272">.</span><span class="ident" id="7475273">Filename</span><span class="op" id="7475281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7475284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7475287">if</span>&nbsp;<span class="ident" id="7475290">got</span><span class="op" id="7475293">.</span><span class="ident" id="7475294">Offset</span>&nbsp;<span class="op" id="7475301">!=</span>&nbsp;<span class="ident" id="7475304">want</span><span class="op" id="7475308">.</span><span class="ident" id="7475309">Offset</span>&nbsp;<span class="op" id="7475316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7475320">t</span><span class="op" id="7475321">.</span><span class="ident" id="7475322">Errorf</span><span class="op" id="7475328">(</span><span class="string" id="7475329">&#34;%s:&nbsp;got&nbsp;offset&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7475359">,</span>&nbsp;<span class="ident" id="7475361">msg</span><span class="op" id="7475364">,</span>&nbsp;<span class="ident" id="7475366">got</span><span class="op" id="7475369">.</span><span class="ident" id="7475370">Offset</span><span class="op" id="7475376">,</span>&nbsp;<span class="ident" id="7475378">want</span><span class="op" id="7475382">.</span><span class="ident" id="7475383">Offset</span><span class="op" id="7475389">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7475392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7475395">if</span>&nbsp;<span class="ident" id="7475398">got</span><span class="op" id="7475401">.</span><span class="ident" id="7475402">Line</span>&nbsp;<span class="op" id="7475407">!=</span>&nbsp;<span class="ident" id="7475410">want</span><span class="op" id="7475414">.</span><span class="ident" id="7475415">Line</span>&nbsp;<span class="op" id="7475420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7475424">t</span><span class="op" id="7475425">.</span><span class="ident" id="7475426">Errorf</span><span class="op" id="7475432">(</span><span class="string" id="7475433">&#34;%s:&nbsp;got&nbsp;line&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7475461">,</span>&nbsp;<span class="ident" id="7475463">msg</span><span class="op" id="7475466">,</span>&nbsp;<span class="ident" id="7475468">got</span><span class="op" id="7475471">.</span><span class="ident" id="7475472">Line</span><span class="op" id="7475476">,</span>&nbsp;<span class="ident" id="7475478">want</span><span class="op" id="7475482">.</span><span class="ident" id="7475483">Line</span><span class="op" id="7475487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7475490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7475493">if</span>&nbsp;<span class="ident" id="7475496">got</span><span class="op" id="7475499">.</span><span class="ident" id="7475500">Column</span>&nbsp;<span class="op" id="7475507">!=</span>&nbsp;<span class="ident" id="7475510">want</span><span class="op" id="7475514">.</span><span class="ident" id="7475515">Column</span>&nbsp;<span class="op" id="7475522">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7475526">t</span><span class="op" id="7475527">.</span><span class="ident" id="7475528">Errorf</span><span class="op" id="7475534">(</span><span class="string" id="7475535">&#34;%s:&nbsp;got&nbsp;column&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7475565">,</span>&nbsp;<span class="ident" id="7475567">msg</span><span class="op" id="7475570">,</span>&nbsp;<span class="ident" id="7475572">got</span><span class="op" id="7475575">.</span><span class="ident" id="7475576">Column</span><span class="op" id="7475582">,</span>&nbsp;<span class="ident" id="7475584">want</span><span class="op" id="7475588">.</span><span class="ident" id="7475589">Column</span><span class="op" id="7475595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7475598">}</span><br>
<span class="lineno"></span><span class="op" id="7475600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7475603">func</span>&nbsp;<span class="ident" id="7475608">TestNoPos</span><span class="op" id="7475617">(</span><span class="ident" id="7475618">t</span>&nbsp;<span class="op" id="7475620">*</span><span class="ident" id="7475621">testing</span><span class="op" id="7475628">.</span><span class="ident" id="7475629">T</span><span class="op" id="7475630">)</span>&nbsp;<span class="op" id="7475632">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7475635">if</span>&nbsp;<span class="ident" id="7475638">NoPos</span><span class="op" id="7475643">.</span><span class="ident" id="7475644">IsValid</span><span class="op" id="7475651">(</span><span class="op" id="7475652">)</span>&nbsp;<span class="op" id="7475654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7475658">t</span><span class="op" id="7475659">.</span><span class="ident" id="7475660">Errorf</span><span class="op" id="7475666">(</span><span class="string" id="7475667">&#34;NoPos&nbsp;should&nbsp;not&nbsp;be&nbsp;valid&#34;</span><span class="op" id="7475694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7475697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7475700">var</span>&nbsp;<span class="ident" id="7475704">fset</span>&nbsp;<span class="op" id="7475709">*</span><span class="ident" id="7475710">FileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7475719">checkPos</span><span class="op" id="7475727">(</span><span class="ident" id="7475728">t</span><span class="op" id="7475729">,</span>&nbsp;<span class="string" id="7475731">&#34;nil&nbsp;NoPos&#34;</span><span class="op" id="7475742">,</span>&nbsp;<span class="ident" id="7475744">fset</span><span class="op" id="7475748">.</span><span class="ident" id="7475749">Position</span><span class="op" id="7475757">(</span><span class="ident" id="7475758">NoPos</span><span class="op" id="7475763">)</span><span class="op" id="7475764">,</span>&nbsp;<span class="ident" id="7475766">Position</span><span class="op" id="7475774">{</span><span class="op" id="7475775">}</span><span class="op" id="7475776">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7475779">fset</span>&nbsp;<span class="op" id="7475784">=</span>&nbsp;<span class="ident" id="7475786">NewFileSet</span><span class="op" id="7475796">(</span><span class="op" id="7475797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7475800">checkPos</span><span class="op" id="7475808">(</span><span class="ident" id="7475809">t</span><span class="op" id="7475810">,</span>&nbsp;<span class="string" id="7475812">&#34;fset&nbsp;NoPos&#34;</span><span class="op" id="7475824">,</span>&nbsp;<span class="ident" id="7475826">fset</span><span class="op" id="7475830">.</span><span class="ident" id="7475831">Position</span><span class="op" id="7475839">(</span><span class="ident" id="7475840">NoPos</span><span class="op" id="7475845">)</span><span class="op" id="7475846">,</span>&nbsp;<span class="ident" id="7475848">Position</span><span class="op" id="7475856">{</span><span class="op" id="7475857">}</span><span class="op" id="7475858">)</span><br>
<span class="lineno"></span><span class="op" id="7475860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7475863">var</span>&nbsp;<span class="ident" id="7475867">tests</span>&nbsp;<span class="op" id="7475873">=</span>&nbsp;<span class="op" id="7475875">[</span><span class="op" id="7475876">]</span><span class="keyword" id="7475877">struct</span>&nbsp;<span class="op" id="7475884">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7475887">filename</span>&nbsp;<span class="builtintype" id="7475896">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7475904">source</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7475913">[</span><span class="op" id="7475914">]</span><span class="builtintype" id="7475915">byte</span>&nbsp;<span class="comment" id="7475920">//&nbsp;may&nbsp;be&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7475935">size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7475944">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7475949">lines</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7475958">[</span><span class="op" id="7475959">]</span><span class="builtintype" id="7475960">int</span><br>
<span class="lineno"></span><span class="op" id="7475964">}</span><span class="op" id="7475965">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7475968">{</span><span class="string" id="7475969">&#34;a&#34;</span><span class="op" id="7475972">,</span>&nbsp;<span class="op" id="7475974">[</span><span class="op" id="7475975">]</span><span class="builtintype" id="7475976">byte</span><span class="op" id="7475980">{</span><span class="op" id="7475981">}</span><span class="op" id="7475982">,</span>&nbsp;<span class="num" id="7475984">0</span><span class="op" id="7475985">,</span>&nbsp;<span class="op" id="7475987">[</span><span class="op" id="7475988">]</span><span class="builtintype" id="7475989">int</span><span class="op" id="7475992">{</span><span class="op" id="7475993">}</span><span class="op" id="7475994">}</span><span class="op" id="7475995">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7475998">{</span><span class="string" id="7475999">&#34;b&#34;</span><span class="op" id="7476002">,</span>&nbsp;<span class="op" id="7476004">[</span><span class="op" id="7476005">]</span><span class="builtintype" id="7476006">byte</span><span class="op" id="7476010">(</span><span class="string" id="7476011">&#34;01234&#34;</span><span class="op" id="7476018">)</span><span class="op" id="7476019">,</span>&nbsp;<span class="num" id="7476021">5</span><span class="op" id="7476022">,</span>&nbsp;<span class="op" id="7476024">[</span><span class="op" id="7476025">]</span><span class="builtintype" id="7476026">int</span><span class="op" id="7476029">{</span><span class="num" id="7476030">0</span><span class="op" id="7476031">}</span><span class="op" id="7476032">}</span><span class="op" id="7476033">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7476036">{</span><span class="string" id="7476037">&#34;c&#34;</span><span class="op" id="7476040">,</span>&nbsp;<span class="op" id="7476042">[</span><span class="op" id="7476043">]</span><span class="builtintype" id="7476044">byte</span><span class="op" id="7476048">(</span><span class="string" id="7476049">&#34;\n\n\n\n\n\n\n\n\n&#34;</span><span class="op" id="7476069">)</span><span class="op" id="7476070">,</span>&nbsp;<span class="num" id="7476072">9</span><span class="op" id="7476073">,</span>&nbsp;<span class="op" id="7476075">[</span><span class="op" id="7476076">]</span><span class="builtintype" id="7476077">int</span><span class="op" id="7476080">{</span><span class="num" id="7476081">0</span><span class="op" id="7476082">,</span>&nbsp;<span class="num" id="7476084">1</span><span class="op" id="7476085">,</span>&nbsp;<span class="num" id="7476087">2</span><span class="op" id="7476088">,</span>&nbsp;<span class="num" id="7476090">3</span><span class="op" id="7476091">,</span>&nbsp;<span class="num" id="7476093">4</span><span class="op" id="7476094">,</span>&nbsp;<span class="num" id="7476096">5</span><span class="op" id="7476097">,</span>&nbsp;<span class="num" id="7476099">6</span><span class="op" id="7476100">,</span>&nbsp;<span class="num" id="7476102">7</span><span class="op" id="7476103">,</span>&nbsp;<span class="num" id="7476105">8</span><span class="op" id="7476106">}</span><span class="op" id="7476107">}</span><span class="op" id="7476108">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7476111">{</span><span class="string" id="7476112">&#34;d&#34;</span><span class="op" id="7476115">,</span>&nbsp;<span class="ident" id="7476117">nil</span><span class="op" id="7476120">,</span>&nbsp;<span class="num" id="7476122">100</span><span class="op" id="7476125">,</span>&nbsp;<span class="op" id="7476127">[</span><span class="op" id="7476128">]</span><span class="builtintype" id="7476129">int</span><span class="op" id="7476132">{</span><span class="num" id="7476133">0</span><span class="op" id="7476134">,</span>&nbsp;<span class="num" id="7476136">5</span><span class="op" id="7476137">,</span>&nbsp;<span class="num" id="7476139">10</span><span class="op" id="7476141">,</span>&nbsp;<span class="num" id="7476143">20</span><span class="op" id="7476145">,</span>&nbsp;<span class="num" id="7476147">30</span><span class="op" id="7476149">,</span>&nbsp;<span class="num" id="7476151">70</span><span class="op" id="7476153">,</span>&nbsp;<span class="num" id="7476155">71</span><span class="op" id="7476157">,</span>&nbsp;<span class="num" id="7476159">72</span><span class="op" id="7476161">,</span>&nbsp;<span class="num" id="7476163">80</span><span class="op" id="7476165">,</span>&nbsp;<span class="num" id="7476167">85</span><span class="op" id="7476169">,</span>&nbsp;<span class="num" id="7476171">90</span><span class="op" id="7476173">,</span>&nbsp;<span class="num" id="7476175">99</span><span class="op" id="7476177">}</span><span class="op" id="7476178">}</span><span class="op" id="7476179">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7476182">{</span><span class="string" id="7476183">&#34;e&#34;</span><span class="op" id="7476186">,</span>&nbsp;<span class="ident" id="7476188">nil</span><span class="op" id="7476191">,</span>&nbsp;<span class="num" id="7476193">777</span><span class="op" id="7476196">,</span>&nbsp;<span class="op" id="7476198">[</span><span class="op" id="7476199">]</span><span class="builtintype" id="7476200">int</span><span class="op" id="7476203">{</span><span class="num" id="7476204">0</span><span class="op" id="7476205">,</span>&nbsp;<span class="num" id="7476207">80</span><span class="op" id="7476209">,</span>&nbsp;<span class="num" id="7476211">100</span><span class="op" id="7476214">,</span>&nbsp;<span class="num" id="7476216">120</span><span class="op" id="7476219">,</span>&nbsp;<span class="num" id="7476221">130</span><span class="op" id="7476224">,</span>&nbsp;<span class="num" id="7476226">180</span><span class="op" id="7476229">,</span>&nbsp;<span class="num" id="7476231">267</span><span class="op" id="7476234">,</span>&nbsp;<span class="num" id="7476236">455</span><span class="op" id="7476239">,</span>&nbsp;<span class="num" id="7476241">500</span><span class="op" id="7476244">,</span>&nbsp;<span class="num" id="7476246">567</span><span class="op" id="7476249">,</span>&nbsp;<span class="num" id="7476251">620</span><span class="op" id="7476254">}</span><span class="op" id="7476255">}</span><span class="op" id="7476256">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7476259">{</span><span class="string" id="7476260">&#34;f&#34;</span><span class="op" id="7476263">,</span>&nbsp;<span class="op" id="7476265">[</span><span class="op" id="7476266">]</span><span class="builtintype" id="7476267">byte</span><span class="op" id="7476271">(</span><span class="string" id="7476272">&#34;package&nbsp;p\n\nimport&nbsp;\&#34;fmt\&#34;&#34;</span><span class="op" id="7476301">)</span><span class="op" id="7476302">,</span>&nbsp;<span class="num" id="7476304">23</span><span class="op" id="7476306">,</span>&nbsp;<span class="op" id="7476308">[</span><span class="op" id="7476309">]</span><span class="builtintype" id="7476310">int</span><span class="op" id="7476313">{</span><span class="num" id="7476314">0</span><span class="op" id="7476315">,</span>&nbsp;<span class="num" id="7476317">10</span><span class="op" id="7476319">,</span>&nbsp;<span class="num" id="7476321">11</span><span class="op" id="7476323">}</span><span class="op" id="7476324">}</span><span class="op" id="7476325">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7476328">{</span><span class="string" id="7476329">&#34;g&#34;</span><span class="op" id="7476332">,</span>&nbsp;<span class="op" id="7476334">[</span><span class="op" id="7476335">]</span><span class="builtintype" id="7476336">byte</span><span class="op" id="7476340">(</span><span class="string" id="7476341">&#34;package&nbsp;p\n\nimport&nbsp;\&#34;fmt\&#34;\n&#34;</span><span class="op" id="7476372">)</span><span class="op" id="7476373">,</span>&nbsp;<span class="num" id="7476375">24</span><span class="op" id="7476377">,</span>&nbsp;<span class="op" id="7476379">[</span><span class="op" id="7476380">]</span><span class="builtintype" id="7476381">int</span><span class="op" id="7476384">{</span><span class="num" id="7476385">0</span><span class="op" id="7476386">,</span>&nbsp;<span class="num" id="7476388">10</span><span class="op" id="7476390">,</span>&nbsp;<span class="num" id="7476392">11</span><span class="op" id="7476394">}</span><span class="op" id="7476395">}</span><span class="op" id="7476396">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7476399">{</span><span class="string" id="7476400">&#34;h&#34;</span><span class="op" id="7476403">,</span>&nbsp;<span class="op" id="7476405">[</span><span class="op" id="7476406">]</span><span class="builtintype" id="7476407">byte</span><span class="op" id="7476411">(</span><span class="string" id="7476412">&#34;package&nbsp;p\n\nimport&nbsp;\&#34;fmt\&#34;\n&nbsp;&#34;</span><span class="op" id="7476444">)</span><span class="op" id="7476445">,</span>&nbsp;<span class="num" id="7476447">25</span><span class="op" id="7476449">,</span>&nbsp;<span class="op" id="7476451">[</span><span class="op" id="7476452">]</span><span class="builtintype" id="7476453">int</span><span class="op" id="7476456">{</span><span class="num" id="7476457">0</span><span class="op" id="7476458">,</span>&nbsp;<span class="num" id="7476460">10</span><span class="op" id="7476462">,</span>&nbsp;<span class="num" id="7476464">11</span><span class="op" id="7476466">,</span>&nbsp;<span class="num" id="7476468">24</span><span class="op" id="7476470">}</span><span class="op" id="7476471">}</span><span class="op" id="7476472">,</span><br>
<span class="lineno"></span><span class="op" id="7476474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="7476477">func</span>&nbsp;<span class="ident" id="7476482">linecol</span><span class="op" id="7476489">(</span><span class="ident" id="7476490">lines</span>&nbsp;<span class="op" id="7476496">[</span><span class="op" id="7476497">]</span><span class="builtintype" id="7476498">int</span><span class="op" id="7476501">,</span>&nbsp;<span class="ident" id="7476503">offs</span>&nbsp;<span class="builtintype" id="7476508">int</span><span class="op" id="7476511">)</span>&nbsp;<span class="op" id="7476513">(</span><span class="builtintype" id="7476514">int</span><span class="op" id="7476517">,</span>&nbsp;<span class="builtintype" id="7476519">int</span><span class="op" id="7476522">)</span>&nbsp;<span class="op" id="7476524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7476527">prevLineOffs</span>&nbsp;<span class="op" id="7476540">:=</span>&nbsp;<span class="num" id="7476543">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7476546">for</span>&nbsp;<span class="ident" id="7476550">line</span><span class="op" id="7476554">,</span>&nbsp;<span class="ident" id="7476556">lineOffs</span>&nbsp;<span class="op" id="7476565">:=</span>&nbsp;<span class="keyword" id="7476568">range</span>&nbsp;<span class="ident" id="7476574">lines</span>&nbsp;<span class="op" id="7476580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7476584">if</span>&nbsp;<span class="ident" id="7476587">offs</span>&nbsp;<span class="op" id="7476592">&lt;</span>&nbsp;<span class="ident" id="7476594">lineOffs</span>&nbsp;<span class="op" id="7476603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7476608">return</span>&nbsp;<span class="ident" id="7476615">line</span><span class="op" id="7476619">,</span>&nbsp;<span class="ident" id="7476621">offs</span>&nbsp;<span class="op" id="7476626">-</span>&nbsp;<span class="ident" id="7476628">prevLineOffs</span>&nbsp;<span class="op" id="7476641">+</span>&nbsp;<span class="num" id="7476643">1</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7476647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7476651">prevLineOffs</span>&nbsp;<span class="op" id="7476664">=</span>&nbsp;<span class="ident" id="7476666">lineOffs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7476676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7476679">return</span>&nbsp;<span class="builtinfunc" id="7476686">len</span><span class="op" id="7476689">(</span><span class="ident" id="7476690">lines</span><span class="op" id="7476695">)</span><span class="op" id="7476696">,</span>&nbsp;<span class="ident" id="7476698">offs</span>&nbsp;<span class="op" id="7476703">-</span>&nbsp;<span class="ident" id="7476705">prevLineOffs</span>&nbsp;<span class="op" id="7476718">+</span>&nbsp;<span class="num" id="7476720">1</span><br>
<span class="lineno"></span><span class="op" id="7476722">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="7476725">func</span>&nbsp;<span class="ident" id="7476730">verifyPositions</span><span class="op" id="7476745">(</span><span class="ident" id="7476746">t</span>&nbsp;<span class="op" id="7476748">*</span><span class="ident" id="7476749">testing</span><span class="op" id="7476756">.</span><span class="ident" id="7476757">T</span><span class="op" id="7476758">,</span>&nbsp;<span class="ident" id="7476760">fset</span>&nbsp;<span class="op" id="7476765">*</span><span class="ident" id="7476766">FileSet</span><span class="op" id="7476773">,</span>&nbsp;<span class="ident" id="7476775">f</span>&nbsp;<span class="op" id="7476777">*</span><span class="ident" id="7476778">File</span><span class="op" id="7476782">,</span>&nbsp;<span class="ident" id="7476784">lines</span>&nbsp;<span class="op" id="7476790">[</span><span class="op" id="7476791">]</span><span class="builtintype" id="7476792">int</span><span class="op" id="7476795">)</span>&nbsp;<span class="op" id="7476797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7476800">for</span>&nbsp;<span class="ident" id="7476804">offs</span>&nbsp;<span class="op" id="7476809">:=</span>&nbsp;<span class="num" id="7476812">0</span><span class="op" id="7476813">;</span>&nbsp;<span class="ident" id="7476815">offs</span>&nbsp;<span class="op" id="7476820">&lt;</span>&nbsp;<span class="ident" id="7476822">f</span><span class="op" id="7476823">.</span><span class="ident" id="7476824">Size</span><span class="op" id="7476828">(</span><span class="op" id="7476829">)</span><span class="op" id="7476830">;</span>&nbsp;<span class="ident" id="7476832">offs</span><span class="op" id="7476836">++</span>&nbsp;<span class="op" id="7476839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7476843">p</span>&nbsp;<span class="op" id="7476845">:=</span>&nbsp;<span class="ident" id="7476848">f</span><span class="op" id="7476849">.</span><span class="ident" id="7476850">Pos</span><span class="op" id="7476853">(</span><span class="ident" id="7476854">offs</span><span class="op" id="7476858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7476862">offs2</span>&nbsp;<span class="op" id="7476868">:=</span>&nbsp;<span class="ident" id="7476871">f</span><span class="op" id="7476872">.</span><span class="ident" id="7476873">Offset</span><span class="op" id="7476879">(</span><span class="ident" id="7476880">p</span><span class="op" id="7476881">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7476885">if</span>&nbsp;<span class="ident" id="7476888">offs2</span>&nbsp;<span class="op" id="7476894">!=</span>&nbsp;<span class="ident" id="7476897">offs</span>&nbsp;<span class="op" id="7476902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7476907">t</span><span class="op" id="7476908">.</span><span class="ident" id="7476909">Errorf</span><span class="op" id="7476915">(</span><span class="string" id="7476916">&#34;%s,&nbsp;Offset:&nbsp;got&nbsp;offset&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7476952">,</span>&nbsp;<span class="ident" id="7476954">f</span><span class="op" id="7476955">.</span><span class="ident" id="7476956">Name</span><span class="op" id="7476960">(</span><span class="op" id="7476961">)</span><span class="op" id="7476962">,</span>&nbsp;<span class="ident" id="7476964">offs2</span><span class="op" id="7476969">,</span>&nbsp;<span class="ident" id="7476971">offs</span><span class="op" id="7476975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7476979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7476983">line</span><span class="op" id="7476987">,</span>&nbsp;<span class="ident" id="7476989">col</span>&nbsp;<span class="op" id="7476993">:=</span>&nbsp;<span class="ident" id="7476996">linecol</span><span class="op" id="7477003">(</span><span class="ident" id="7477004">lines</span><span class="op" id="7477009">,</span>&nbsp;<span class="ident" id="7477011">offs</span><span class="op" id="7477015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7477019">msg</span>&nbsp;<span class="op" id="7477023">:=</span>&nbsp;<span class="ident" id="7477026">fmt</span><span class="op" id="7477029">.</span><span class="ident" id="7477030">Sprintf</span><span class="op" id="7477037">(</span><span class="string" id="7477038">&#34;%s&nbsp;(offs&nbsp;=&nbsp;%d,&nbsp;p&nbsp;=&nbsp;%d)&#34;</span><span class="op" id="7477062">,</span>&nbsp;<span class="ident" id="7477064">f</span><span class="op" id="7477065">.</span><span class="ident" id="7477066">Name</span><span class="op" id="7477070">(</span><span class="op" id="7477071">)</span><span class="op" id="7477072">,</span>&nbsp;<span class="ident" id="7477074">offs</span><span class="op" id="7477078">,</span>&nbsp;<span class="ident" id="7477080">p</span><span class="op" id="7477081">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7477085">checkPos</span><span class="op" id="7477093">(</span><span class="ident" id="7477094">t</span><span class="op" id="7477095">,</span>&nbsp;<span class="ident" id="7477097">msg</span><span class="op" id="7477100">,</span>&nbsp;<span class="ident" id="7477102">f</span><span class="op" id="7477103">.</span><span class="ident" id="7477104">Position</span><span class="op" id="7477112">(</span><span class="ident" id="7477113">f</span><span class="op" id="7477114">.</span><span class="ident" id="7477115">Pos</span><span class="op" id="7477118">(</span><span class="ident" id="7477119">offs</span><span class="op" id="7477123">)</span><span class="op" id="7477124">)</span><span class="op" id="7477125">,</span>&nbsp;<span class="ident" id="7477127">Position</span><span class="op" id="7477135">{</span><span class="ident" id="7477136">f</span><span class="op" id="7477137">.</span><span class="ident" id="7477138">Name</span><span class="op" id="7477142">(</span><span class="op" id="7477143">)</span><span class="op" id="7477144">,</span>&nbsp;<span class="ident" id="7477146">offs</span><span class="op" id="7477150">,</span>&nbsp;<span class="ident" id="7477152">line</span><span class="op" id="7477156">,</span>&nbsp;<span class="ident" id="7477158">col</span><span class="op" id="7477161">}</span><span class="op" id="7477162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7477166">checkPos</span><span class="op" id="7477174">(</span><span class="ident" id="7477175">t</span><span class="op" id="7477176">,</span>&nbsp;<span class="ident" id="7477178">msg</span><span class="op" id="7477181">,</span>&nbsp;<span class="ident" id="7477183">fset</span><span class="op" id="7477187">.</span><span class="ident" id="7477188">Position</span><span class="op" id="7477196">(</span><span class="ident" id="7477197">p</span><span class="op" id="7477198">)</span><span class="op" id="7477199">,</span>&nbsp;<span class="ident" id="7477201">Position</span><span class="op" id="7477209">{</span><span class="ident" id="7477210">f</span><span class="op" id="7477211">.</span><span class="ident" id="7477212">Name</span><span class="op" id="7477216">(</span><span class="op" id="7477217">)</span><span class="op" id="7477218">,</span>&nbsp;<span class="ident" id="7477220">offs</span><span class="op" id="7477224">,</span>&nbsp;<span class="ident" id="7477226">line</span><span class="op" id="7477230">,</span>&nbsp;<span class="ident" id="7477232">col</span><span class="op" id="7477235">}</span><span class="op" id="7477236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7477239">}</span><br>
<span class="lineno"></span><span class="op" id="7477241">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="7477244">func</span>&nbsp;<span class="ident" id="7477249">makeTestSource</span><span class="op" id="7477263">(</span><span class="ident" id="7477264">size</span>&nbsp;<span class="builtintype" id="7477269">int</span><span class="op" id="7477272">,</span>&nbsp;<span class="ident" id="7477274">lines</span>&nbsp;<span class="op" id="7477280">[</span><span class="op" id="7477281">]</span><span class="builtintype" id="7477282">int</span><span class="op" id="7477285">)</span>&nbsp;<span class="op" id="7477287">[</span><span class="op" id="7477288">]</span><span class="builtintype" id="7477289">byte</span>&nbsp;<span class="op" id="7477294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7477297">src</span>&nbsp;<span class="op" id="7477301">:=</span>&nbsp;<span class="builtinfunc" id="7477304">make</span><span class="op" id="7477308">(</span><span class="op" id="7477309">[</span><span class="op" id="7477310">]</span><span class="builtintype" id="7477311">byte</span><span class="op" id="7477315">,</span>&nbsp;<span class="ident" id="7477317">size</span><span class="op" id="7477321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7477324">for</span>&nbsp;<span class="ident" id="7477328">_</span><span class="op" id="7477329">,</span>&nbsp;<span class="ident" id="7477331">offs</span>&nbsp;<span class="op" id="7477336">:=</span>&nbsp;<span class="keyword" id="7477339">range</span>&nbsp;<span class="ident" id="7477345">lines</span>&nbsp;<span class="op" id="7477351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7477355">if</span>&nbsp;<span class="ident" id="7477358">offs</span>&nbsp;<span class="op" id="7477363">&gt;</span>&nbsp;<span class="num" id="7477365">0</span>&nbsp;<span class="op" id="7477367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7477372">src</span><span class="op" id="7477375">[</span><span class="ident" id="7477376">offs</span><span class="op" id="7477380">-</span><span class="num" id="7477381">1</span><span class="op" id="7477382">]</span>&nbsp;<span class="op" id="7477384">=</span>&nbsp;<span class="string" id="7477386">&#39;\n&#39;</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7477393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7477396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7477399">return</span>&nbsp;<span class="ident" id="7477406">src</span><br>
<span class="lineno"></span><span class="op" id="7477410">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="7477413">func</span>&nbsp;<span class="ident" id="7477418">TestPositions</span><span class="op" id="7477431">(</span><span class="ident" id="7477432">t</span>&nbsp;<span class="op" id="7477434">*</span><span class="ident" id="7477435">testing</span><span class="op" id="7477442">.</span><span class="ident" id="7477443">T</span><span class="op" id="7477444">)</span>&nbsp;<span class="op" id="7477446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7477449">const</span>&nbsp;<span class="ident" id="7477455">delta</span>&nbsp;<span class="op" id="7477461">=</span>&nbsp;<span class="num" id="7477463">7</span>&nbsp;<span class="comment" id="7477465">//&nbsp;a&nbsp;non-zero&nbsp;base&nbsp;offset&nbsp;increment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7477502">fset</span>&nbsp;<span class="op" id="7477507">:=</span>&nbsp;<span class="ident" id="7477510">NewFileSet</span><span class="op" id="7477520">(</span><span class="op" id="7477521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7477524">for</span>&nbsp;<span class="ident" id="7477528">_</span><span class="op" id="7477529">,</span>&nbsp;<span class="ident" id="7477531">test</span>&nbsp;<span class="op" id="7477536">:=</span>&nbsp;<span class="keyword" id="7477539">range</span>&nbsp;<span class="ident" id="7477545">tests</span>&nbsp;<span class="op" id="7477551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7477555">//&nbsp;verify&nbsp;consistency&nbsp;of&nbsp;test&nbsp;case</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7477592">if</span>&nbsp;<span class="ident" id="7477595">test</span><span class="op" id="7477599">.</span><span class="ident" id="7477600">source</span>&nbsp;<span class="op" id="7477607">!=</span>&nbsp;<span class="ident" id="7477610">nil</span>&nbsp;<span class="op" id="7477614">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="7477617">len</span><span class="op" id="7477620">(</span><span class="ident" id="7477621">test</span><span class="op" id="7477625">.</span><span class="ident" id="7477626">source</span><span class="op" id="7477632">)</span>&nbsp;<span class="op" id="7477634">!=</span>&nbsp;<span class="ident" id="7477637">test</span><span class="op" id="7477641">.</span><span class="ident" id="7477642">size</span>&nbsp;<span class="op" id="7477647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7477652">t</span><span class="op" id="7477653">.</span><span class="ident" id="7477654">Errorf</span><span class="op" id="7477660">(</span><span class="string" id="7477661">&#34;%s:&nbsp;inconsistent&nbsp;test&nbsp;case:&nbsp;got&nbsp;file&nbsp;size&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7477716">,</span>&nbsp;<span class="ident" id="7477718">test</span><span class="op" id="7477722">.</span><span class="ident" id="7477723">filename</span><span class="op" id="7477731">,</span>&nbsp;<span class="builtinfunc" id="7477733">len</span><span class="op" id="7477736">(</span><span class="ident" id="7477737">test</span><span class="op" id="7477741">.</span><span class="ident" id="7477742">source</span><span class="op" id="7477748">)</span><span class="op" id="7477749">,</span>&nbsp;<span class="ident" id="7477751">test</span><span class="op" id="7477755">.</span><span class="ident" id="7477756">size</span><span class="op" id="7477760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7477764">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7477769">//&nbsp;add&nbsp;file&nbsp;and&nbsp;verify&nbsp;name&nbsp;and&nbsp;size</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7477808">f</span>&nbsp;<span class="op" id="7477810">:=</span>&nbsp;<span class="ident" id="7477813">fset</span><span class="op" id="7477817">.</span><span class="ident" id="7477818">AddFile</span><span class="op" id="7477825">(</span><span class="ident" id="7477826">test</span><span class="op" id="7477830">.</span><span class="ident" id="7477831">filename</span><span class="op" id="7477839">,</span>&nbsp;<span class="ident" id="7477841">fset</span><span class="op" id="7477845">.</span><span class="ident" id="7477846">Base</span><span class="op" id="7477850">(</span><span class="op" id="7477851">)</span><span class="op" id="7477852">+</span><span class="ident" id="7477853">delta</span><span class="op" id="7477858">,</span>&nbsp;<span class="ident" id="7477860">test</span><span class="op" id="7477864">.</span><span class="ident" id="7477865">size</span><span class="op" id="7477869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7477873">if</span>&nbsp;<span class="ident" id="7477876">f</span><span class="op" id="7477877">.</span><span class="ident" id="7477878">Name</span><span class="op" id="7477882">(</span><span class="op" id="7477883">)</span>&nbsp;<span class="op" id="7477885">!=</span>&nbsp;<span class="ident" id="7477888">test</span><span class="op" id="7477892">.</span><span class="ident" id="7477893">filename</span>&nbsp;<span class="op" id="7477902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7477907">t</span><span class="op" id="7477908">.</span><span class="ident" id="7477909">Errorf</span><span class="op" id="7477915">(</span><span class="string" id="7477916">&#34;got&nbsp;filename&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7477942">,</span>&nbsp;<span class="ident" id="7477944">f</span><span class="op" id="7477945">.</span><span class="ident" id="7477946">Name</span><span class="op" id="7477950">(</span><span class="op" id="7477951">)</span><span class="op" id="7477952">,</span>&nbsp;<span class="ident" id="7477954">test</span><span class="op" id="7477958">.</span><span class="ident" id="7477959">filename</span><span class="op" id="7477967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7477971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7477975">if</span>&nbsp;<span class="ident" id="7477978">f</span><span class="op" id="7477979">.</span><span class="ident" id="7477980">Size</span><span class="op" id="7477984">(</span><span class="op" id="7477985">)</span>&nbsp;<span class="op" id="7477987">!=</span>&nbsp;<span class="ident" id="7477990">test</span><span class="op" id="7477994">.</span><span class="ident" id="7477995">size</span>&nbsp;<span class="op" id="7478000">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7478005">t</span><span class="op" id="7478006">.</span><span class="ident" id="7478007">Errorf</span><span class="op" id="7478013">(</span><span class="string" id="7478014">&#34;%s:&nbsp;got&nbsp;file&nbsp;size&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7478045">,</span>&nbsp;<span class="ident" id="7478047">f</span><span class="op" id="7478048">.</span><span class="ident" id="7478049">Name</span><span class="op" id="7478053">(</span><span class="op" id="7478054">)</span><span class="op" id="7478055">,</span>&nbsp;<span class="ident" id="7478057">f</span><span class="op" id="7478058">.</span><span class="ident" id="7478059">Size</span><span class="op" id="7478063">(</span><span class="op" id="7478064">)</span><span class="op" id="7478065">,</span>&nbsp;<span class="ident" id="7478067">test</span><span class="op" id="7478071">.</span><span class="ident" id="7478072">size</span><span class="op" id="7478076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7478080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7478084">if</span>&nbsp;<span class="ident" id="7478087">fset</span><span class="op" id="7478091">.</span><span class="ident" id="7478092">File</span><span class="op" id="7478096">(</span><span class="ident" id="7478097">f</span><span class="op" id="7478098">.</span><span class="ident" id="7478099">Pos</span><span class="op" id="7478102">(</span><span class="num" id="7478103">0</span><span class="op" id="7478104">)</span><span class="op" id="7478105">)</span>&nbsp;<span class="op" id="7478107">!=</span>&nbsp;<span class="ident" id="7478110">f</span>&nbsp;<span class="op" id="7478112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7478117">t</span><span class="op" id="7478118">.</span><span class="ident" id="7478119">Errorf</span><span class="op" id="7478125">(</span><span class="string" id="7478126">&#34;%s:&nbsp;f.Pos(0)&nbsp;was&nbsp;not&nbsp;found&nbsp;in&nbsp;f&#34;</span><span class="op" id="7478159">,</span>&nbsp;<span class="ident" id="7478161">f</span><span class="op" id="7478162">.</span><span class="ident" id="7478163">Name</span><span class="op" id="7478167">(</span><span class="op" id="7478168">)</span><span class="op" id="7478169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7478173">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7478178">//&nbsp;add&nbsp;lines&nbsp;individually&nbsp;and&nbsp;verify&nbsp;all&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7478231">for</span>&nbsp;<span class="ident" id="7478235">i</span><span class="op" id="7478236">,</span>&nbsp;<span class="ident" id="7478238">offset</span>&nbsp;<span class="op" id="7478245">:=</span>&nbsp;<span class="keyword" id="7478248">range</span>&nbsp;<span class="ident" id="7478254">test</span><span class="op" id="7478258">.</span><span class="ident" id="7478259">lines</span>&nbsp;<span class="op" id="7478265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7478270">f</span><span class="op" id="7478271">.</span><span class="ident" id="7478272">AddLine</span><span class="op" id="7478279">(</span><span class="ident" id="7478280">offset</span><span class="op" id="7478286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7478291">if</span>&nbsp;<span class="ident" id="7478294">f</span><span class="op" id="7478295">.</span><span class="ident" id="7478296">LineCount</span><span class="op" id="7478305">(</span><span class="op" id="7478306">)</span>&nbsp;<span class="op" id="7478308">!=</span>&nbsp;<span class="ident" id="7478311">i</span><span class="op" id="7478312">+</span><span class="num" id="7478313">1</span>&nbsp;<span class="op" id="7478315">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7478321">t</span><span class="op" id="7478322">.</span><span class="ident" id="7478323">Errorf</span><span class="op" id="7478329">(</span><span class="string" id="7478330">&#34;%s,&nbsp;AddLine:&nbsp;got&nbsp;line&nbsp;count&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7478371">,</span>&nbsp;<span class="ident" id="7478373">f</span><span class="op" id="7478374">.</span><span class="ident" id="7478375">Name</span><span class="op" id="7478379">(</span><span class="op" id="7478380">)</span><span class="op" id="7478381">,</span>&nbsp;<span class="ident" id="7478383">f</span><span class="op" id="7478384">.</span><span class="ident" id="7478385">LineCount</span><span class="op" id="7478394">(</span><span class="op" id="7478395">)</span><span class="op" id="7478396">,</span>&nbsp;<span class="ident" id="7478398">i</span><span class="op" id="7478399">+</span><span class="num" id="7478400">1</span><span class="op" id="7478401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7478406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7478411">//&nbsp;adding&nbsp;the&nbsp;same&nbsp;offset&nbsp;again&nbsp;should&nbsp;be&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7478464">f</span><span class="op" id="7478465">.</span><span class="ident" id="7478466">AddLine</span><span class="op" id="7478473">(</span><span class="ident" id="7478474">offset</span><span class="op" id="7478480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7478485">if</span>&nbsp;<span class="ident" id="7478488">f</span><span class="op" id="7478489">.</span><span class="ident" id="7478490">LineCount</span><span class="op" id="7478499">(</span><span class="op" id="7478500">)</span>&nbsp;<span class="op" id="7478502">!=</span>&nbsp;<span class="ident" id="7478505">i</span><span class="op" id="7478506">+</span><span class="num" id="7478507">1</span>&nbsp;<span class="op" id="7478509">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7478515">t</span><span class="op" id="7478516">.</span><span class="ident" id="7478517">Errorf</span><span class="op" id="7478523">(</span><span class="string" id="7478524">&#34;%s,&nbsp;AddLine:&nbsp;got&nbsp;unchanged&nbsp;line&nbsp;count&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7478575">,</span>&nbsp;<span class="ident" id="7478577">f</span><span class="op" id="7478578">.</span><span class="ident" id="7478579">Name</span><span class="op" id="7478583">(</span><span class="op" id="7478584">)</span><span class="op" id="7478585">,</span>&nbsp;<span class="ident" id="7478587">f</span><span class="op" id="7478588">.</span><span class="ident" id="7478589">LineCount</span><span class="op" id="7478598">(</span><span class="op" id="7478599">)</span><span class="op" id="7478600">,</span>&nbsp;<span class="ident" id="7478602">i</span><span class="op" id="7478603">+</span><span class="num" id="7478604">1</span><span class="op" id="7478605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7478610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7478615">verifyPositions</span><span class="op" id="7478630">(</span><span class="ident" id="7478631">t</span><span class="op" id="7478632">,</span>&nbsp;<span class="ident" id="7478634">fset</span><span class="op" id="7478638">,</span>&nbsp;<span class="ident" id="7478640">f</span><span class="op" id="7478641">,</span>&nbsp;<span class="ident" id="7478643">test</span><span class="op" id="7478647">.</span><span class="ident" id="7478648">lines</span><span class="op" id="7478653">[</span><span class="num" id="7478654">0</span><span class="op" id="7478655">:</span><span class="ident" id="7478656">i</span><span class="op" id="7478657">+</span><span class="num" id="7478658">1</span><span class="op" id="7478659">]</span><span class="op" id="7478660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7478664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7478669">//&nbsp;add&nbsp;lines&nbsp;with&nbsp;SetLines&nbsp;and&nbsp;verify&nbsp;all&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7478723">if</span>&nbsp;<span class="ident" id="7478726">ok</span>&nbsp;<span class="op" id="7478729">:=</span>&nbsp;<span class="ident" id="7478732">f</span><span class="op" id="7478733">.</span><span class="ident" id="7478734">SetLines</span><span class="op" id="7478742">(</span><span class="ident" id="7478743">test</span><span class="op" id="7478747">.</span><span class="ident" id="7478748">lines</span><span class="op" id="7478753">)</span><span class="op" id="7478754">;</span>&nbsp;<span class="op" id="7478756">!</span><span class="ident" id="7478757">ok</span>&nbsp;<span class="op" id="7478760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7478765">t</span><span class="op" id="7478766">.</span><span class="ident" id="7478767">Errorf</span><span class="op" id="7478773">(</span><span class="string" id="7478774">&#34;%s:&nbsp;SetLines&nbsp;failed&#34;</span><span class="op" id="7478795">,</span>&nbsp;<span class="ident" id="7478797">f</span><span class="op" id="7478798">.</span><span class="ident" id="7478799">Name</span><span class="op" id="7478803">(</span><span class="op" id="7478804">)</span><span class="op" id="7478805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7478809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7478813">if</span>&nbsp;<span class="ident" id="7478816">f</span><span class="op" id="7478817">.</span><span class="ident" id="7478818">LineCount</span><span class="op" id="7478827">(</span><span class="op" id="7478828">)</span>&nbsp;<span class="op" id="7478830">!=</span>&nbsp;<span class="builtinfunc" id="7478833">len</span><span class="op" id="7478836">(</span><span class="ident" id="7478837">test</span><span class="op" id="7478841">.</span><span class="ident" id="7478842">lines</span><span class="op" id="7478847">)</span>&nbsp;<span class="op" id="7478849">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7478854">t</span><span class="op" id="7478855">.</span><span class="ident" id="7478856">Errorf</span><span class="op" id="7478862">(</span><span class="string" id="7478863">&#34;%s,&nbsp;SetLines:&nbsp;got&nbsp;line&nbsp;count&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7478905">,</span>&nbsp;<span class="ident" id="7478907">f</span><span class="op" id="7478908">.</span><span class="ident" id="7478909">Name</span><span class="op" id="7478913">(</span><span class="op" id="7478914">)</span><span class="op" id="7478915">,</span>&nbsp;<span class="ident" id="7478917">f</span><span class="op" id="7478918">.</span><span class="ident" id="7478919">LineCount</span><span class="op" id="7478928">(</span><span class="op" id="7478929">)</span><span class="op" id="7478930">,</span>&nbsp;<span class="builtinfunc" id="7478932">len</span><span class="op" id="7478935">(</span><span class="ident" id="7478936">test</span><span class="op" id="7478940">.</span><span class="ident" id="7478941">lines</span><span class="op" id="7478946">)</span><span class="op" id="7478947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7478951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7478955">verifyPositions</span><span class="op" id="7478970">(</span><span class="ident" id="7478971">t</span><span class="op" id="7478972">,</span>&nbsp;<span class="ident" id="7478974">fset</span><span class="op" id="7478978">,</span>&nbsp;<span class="ident" id="7478980">f</span><span class="op" id="7478981">,</span>&nbsp;<span class="ident" id="7478983">test</span><span class="op" id="7478987">.</span><span class="ident" id="7478988">lines</span><span class="op" id="7478993">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7478998">//&nbsp;add&nbsp;lines&nbsp;with&nbsp;SetLinesForContent&nbsp;and&nbsp;verify&nbsp;all&nbsp;positions</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7479062">src</span>&nbsp;<span class="op" id="7479066">:=</span>&nbsp;<span class="ident" id="7479069">test</span><span class="op" id="7479073">.</span><span class="ident" id="7479074">source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7479083">if</span>&nbsp;<span class="ident" id="7479086">src</span>&nbsp;<span class="op" id="7479090">==</span>&nbsp;<span class="ident" id="7479093">nil</span>&nbsp;<span class="op" id="7479097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7479102">//&nbsp;no&nbsp;test&nbsp;source&nbsp;available&nbsp;-&nbsp;create&nbsp;one&nbsp;from&nbsp;scratch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7479159">src</span>&nbsp;<span class="op" id="7479163">=</span>&nbsp;<span class="ident" id="7479165">makeTestSource</span><span class="op" id="7479179">(</span><span class="ident" id="7479180">test</span><span class="op" id="7479184">.</span><span class="ident" id="7479185">size</span><span class="op" id="7479189">,</span>&nbsp;<span class="ident" id="7479191">test</span><span class="op" id="7479195">.</span><span class="ident" id="7479196">lines</span><span class="op" id="7479201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7479205">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7479209">f</span><span class="op" id="7479210">.</span><span class="ident" id="7479211">SetLinesForContent</span><span class="op" id="7479229">(</span><span class="ident" id="7479230">src</span><span class="op" id="7479233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7479237">if</span>&nbsp;<span class="ident" id="7479240">f</span><span class="op" id="7479241">.</span><span class="ident" id="7479242">LineCount</span><span class="op" id="7479251">(</span><span class="op" id="7479252">)</span>&nbsp;<span class="op" id="7479254">!=</span>&nbsp;<span class="builtinfunc" id="7479257">len</span><span class="op" id="7479260">(</span><span class="ident" id="7479261">test</span><span class="op" id="7479265">.</span><span class="ident" id="7479266">lines</span><span class="op" id="7479271">)</span>&nbsp;<span class="op" id="7479273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7479278">t</span><span class="op" id="7479279">.</span><span class="ident" id="7479280">Errorf</span><span class="op" id="7479286">(</span><span class="string" id="7479287">&#34;%s,&nbsp;SetLinesForContent:&nbsp;got&nbsp;line&nbsp;count&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7479339">,</span>&nbsp;<span class="ident" id="7479341">f</span><span class="op" id="7479342">.</span><span class="ident" id="7479343">Name</span><span class="op" id="7479347">(</span><span class="op" id="7479348">)</span><span class="op" id="7479349">,</span>&nbsp;<span class="ident" id="7479351">f</span><span class="op" id="7479352">.</span><span class="ident" id="7479353">LineCount</span><span class="op" id="7479362">(</span><span class="op" id="7479363">)</span><span class="op" id="7479364">,</span>&nbsp;<span class="builtinfunc" id="7479366">len</span><span class="op" id="7479369">(</span><span class="ident" id="7479370">test</span><span class="op" id="7479374">.</span><span class="ident" id="7479375">lines</span><span class="op" id="7479380">)</span><span class="op" id="7479381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7479385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7479389">verifyPositions</span><span class="op" id="7479404">(</span><span class="ident" id="7479405">t</span><span class="op" id="7479406">,</span>&nbsp;<span class="ident" id="7479408">fset</span><span class="op" id="7479412">,</span>&nbsp;<span class="ident" id="7479414">f</span><span class="op" id="7479415">,</span>&nbsp;<span class="ident" id="7479417">test</span><span class="op" id="7479421">.</span><span class="ident" id="7479422">lines</span><span class="op" id="7479427">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7479430">}</span><br>
<span class="lineno"></span><span class="op" id="7479432">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7479435">func</span>&nbsp;<span class="ident" id="7479440">TestLineInfo</span><span class="op" id="7479452">(</span><span class="ident" id="7479453">t</span>&nbsp;<span class="op" id="7479455">*</span><span class="ident" id="7479456">testing</span><span class="op" id="7479463">.</span><span class="ident" id="7479464">T</span><span class="op" id="7479465">)</span>&nbsp;<span class="op" id="7479467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7479470">fset</span>&nbsp;<span class="op" id="7479475">:=</span>&nbsp;<span class="ident" id="7479478">NewFileSet</span><span class="op" id="7479488">(</span><span class="op" id="7479489">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7479492">f</span>&nbsp;<span class="op" id="7479494">:=</span>&nbsp;<span class="ident" id="7479497">fset</span><span class="op" id="7479501">.</span><span class="ident" id="7479502">AddFile</span><span class="op" id="7479509">(</span><span class="string" id="7479510">&#34;foo&#34;</span><span class="op" id="7479515">,</span>&nbsp;<span class="ident" id="7479517">fset</span><span class="op" id="7479521">.</span><span class="ident" id="7479522">Base</span><span class="op" id="7479526">(</span><span class="op" id="7479527">)</span><span class="op" id="7479528">,</span>&nbsp;<span class="num" id="7479530">500</span><span class="op" id="7479533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7479536">lines</span>&nbsp;<span class="op" id="7479542">:=</span>&nbsp;<span class="op" id="7479545">[</span><span class="op" id="7479546">]</span><span class="builtintype" id="7479547">int</span><span class="op" id="7479550">{</span><span class="num" id="7479551">0</span><span class="op" id="7479552">,</span>&nbsp;<span class="num" id="7479554">42</span><span class="op" id="7479556">,</span>&nbsp;<span class="num" id="7479558">77</span><span class="op" id="7479560">,</span>&nbsp;<span class="num" id="7479562">100</span><span class="op" id="7479565">,</span>&nbsp;<span class="num" id="7479567">210</span><span class="op" id="7479570">,</span>&nbsp;<span class="num" id="7479572">220</span><span class="op" id="7479575">,</span>&nbsp;<span class="num" id="7479577">277</span><span class="op" id="7479580">,</span>&nbsp;<span class="num" id="7479582">300</span><span class="op" id="7479585">,</span>&nbsp;<span class="num" id="7479587">333</span><span class="op" id="7479590">,</span>&nbsp;<span class="num" id="7479592">401</span><span class="op" id="7479595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7479598">//&nbsp;add&nbsp;lines&nbsp;individually&nbsp;and&nbsp;provide&nbsp;alternative&nbsp;line&nbsp;information</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7479666">for</span>&nbsp;<span class="ident" id="7479670">_</span><span class="op" id="7479671">,</span>&nbsp;<span class="ident" id="7479673">offs</span>&nbsp;<span class="op" id="7479678">:=</span>&nbsp;<span class="keyword" id="7479681">range</span>&nbsp;<span class="ident" id="7479687">lines</span>&nbsp;<span class="op" id="7479693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7479697">f</span><span class="op" id="7479698">.</span><span class="ident" id="7479699">AddLine</span><span class="op" id="7479706">(</span><span class="ident" id="7479707">offs</span><span class="op" id="7479711">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7479715">f</span><span class="op" id="7479716">.</span><span class="ident" id="7479717">AddLineInfo</span><span class="op" id="7479728">(</span><span class="ident" id="7479729">offs</span><span class="op" id="7479733">,</span>&nbsp;<span class="string" id="7479735">&#34;bar&#34;</span><span class="op" id="7479740">,</span>&nbsp;<span class="num" id="7479742">42</span><span class="op" id="7479744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7479747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7479750">//&nbsp;verify&nbsp;positions&nbsp;for&nbsp;all&nbsp;offsets</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7479787">for</span>&nbsp;<span class="ident" id="7479791">offs</span>&nbsp;<span class="op" id="7479796">:=</span>&nbsp;<span class="num" id="7479799">0</span><span class="op" id="7479800">;</span>&nbsp;<span class="ident" id="7479802">offs</span>&nbsp;<span class="op" id="7479807">&lt;=</span>&nbsp;<span class="ident" id="7479810">f</span><span class="op" id="7479811">.</span><span class="ident" id="7479812">Size</span><span class="op" id="7479816">(</span><span class="op" id="7479817">)</span><span class="op" id="7479818">;</span>&nbsp;<span class="ident" id="7479820">offs</span><span class="op" id="7479824">++</span>&nbsp;<span class="op" id="7479827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7479831">p</span>&nbsp;<span class="op" id="7479833">:=</span>&nbsp;<span class="ident" id="7479836">f</span><span class="op" id="7479837">.</span><span class="ident" id="7479838">Pos</span><span class="op" id="7479841">(</span><span class="ident" id="7479842">offs</span><span class="op" id="7479846">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7479850">_</span><span class="op" id="7479851">,</span>&nbsp;<span class="ident" id="7479853">col</span>&nbsp;<span class="op" id="7479857">:=</span>&nbsp;<span class="ident" id="7479860">linecol</span><span class="op" id="7479867">(</span><span class="ident" id="7479868">lines</span><span class="op" id="7479873">,</span>&nbsp;<span class="ident" id="7479875">offs</span><span class="op" id="7479879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7479883">msg</span>&nbsp;<span class="op" id="7479887">:=</span>&nbsp;<span class="ident" id="7479890">fmt</span><span class="op" id="7479893">.</span><span class="ident" id="7479894">Sprintf</span><span class="op" id="7479901">(</span><span class="string" id="7479902">&#34;%s&nbsp;(offs&nbsp;=&nbsp;%d,&nbsp;p&nbsp;=&nbsp;%d)&#34;</span><span class="op" id="7479926">,</span>&nbsp;<span class="ident" id="7479928">f</span><span class="op" id="7479929">.</span><span class="ident" id="7479930">Name</span><span class="op" id="7479934">(</span><span class="op" id="7479935">)</span><span class="op" id="7479936">,</span>&nbsp;<span class="ident" id="7479938">offs</span><span class="op" id="7479942">,</span>&nbsp;<span class="ident" id="7479944">p</span><span class="op" id="7479945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7479949">checkPos</span><span class="op" id="7479957">(</span><span class="ident" id="7479958">t</span><span class="op" id="7479959">,</span>&nbsp;<span class="ident" id="7479961">msg</span><span class="op" id="7479964">,</span>&nbsp;<span class="ident" id="7479966">f</span><span class="op" id="7479967">.</span><span class="ident" id="7479968">Position</span><span class="op" id="7479976">(</span><span class="ident" id="7479977">f</span><span class="op" id="7479978">.</span><span class="ident" id="7479979">Pos</span><span class="op" id="7479982">(</span><span class="ident" id="7479983">offs</span><span class="op" id="7479987">)</span><span class="op" id="7479988">)</span><span class="op" id="7479989">,</span>&nbsp;<span class="ident" id="7479991">Position</span><span class="op" id="7479999">{</span><span class="string" id="7480000">&#34;bar&#34;</span><span class="op" id="7480005">,</span>&nbsp;<span class="ident" id="7480007">offs</span><span class="op" id="7480011">,</span>&nbsp;<span class="num" id="7480013">42</span><span class="op" id="7480015">,</span>&nbsp;<span class="ident" id="7480017">col</span><span class="op" id="7480020">}</span><span class="op" id="7480021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7480025">checkPos</span><span class="op" id="7480033">(</span><span class="ident" id="7480034">t</span><span class="op" id="7480035">,</span>&nbsp;<span class="ident" id="7480037">msg</span><span class="op" id="7480040">,</span>&nbsp;<span class="ident" id="7480042">fset</span><span class="op" id="7480046">.</span><span class="ident" id="7480047">Position</span><span class="op" id="7480055">(</span><span class="ident" id="7480056">p</span><span class="op" id="7480057">)</span><span class="op" id="7480058">,</span>&nbsp;<span class="ident" id="7480060">Position</span><span class="op" id="7480068">{</span><span class="string" id="7480069">&#34;bar&#34;</span><span class="op" id="7480074">,</span>&nbsp;<span class="ident" id="7480076">offs</span><span class="op" id="7480080">,</span>&nbsp;<span class="num" id="7480082">42</span><span class="op" id="7480084">,</span>&nbsp;<span class="ident" id="7480086">col</span><span class="op" id="7480089">}</span><span class="op" id="7480090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7480093">}</span><br>
<span class="lineno">165</span><span class="op" id="7480095">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7480098">func</span>&nbsp;<span class="ident" id="7480103">TestFiles</span><span class="op" id="7480112">(</span><span class="ident" id="7480113">t</span>&nbsp;<span class="op" id="7480115">*</span><span class="ident" id="7480116">testing</span><span class="op" id="7480123">.</span><span class="ident" id="7480124">T</span><span class="op" id="7480125">)</span>&nbsp;<span class="op" id="7480127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7480130">fset</span>&nbsp;<span class="op" id="7480135">:=</span>&nbsp;<span class="ident" id="7480138">NewFileSet</span><span class="op" id="7480148">(</span><span class="op" id="7480149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7480152">for</span>&nbsp;<span class="ident" id="7480156">i</span><span class="op" id="7480157">,</span>&nbsp;<span class="ident" id="7480159">test</span>&nbsp;<span class="op" id="7480164">:=</span>&nbsp;<span class="keyword" id="7480167">range</span>&nbsp;<span class="ident" id="7480173">tests</span>&nbsp;<span class="op" id="7480179">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7480183">base</span>&nbsp;<span class="op" id="7480188">:=</span>&nbsp;<span class="ident" id="7480191">fset</span><span class="op" id="7480195">.</span><span class="ident" id="7480196">Base</span><span class="op" id="7480200">(</span><span class="op" id="7480201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7480205">if</span>&nbsp;<span class="ident" id="7480208">i</span><span class="op" id="7480209">%</span><span class="num" id="7480210">2</span>&nbsp;<span class="op" id="7480212">==</span>&nbsp;<span class="num" id="7480215">1</span>&nbsp;<span class="op" id="7480217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7480222">//&nbsp;Setting&nbsp;a&nbsp;negative&nbsp;base&nbsp;is&nbsp;equivalent&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7480269">//&nbsp;fset.Base(),&nbsp;so&nbsp;test&nbsp;some&nbsp;of&nbsp;each.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7480310">base</span>&nbsp;<span class="op" id="7480315">=</span>&nbsp;<span class="op" id="7480317">-</span><span class="num" id="7480318">1</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7480322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7480326">fset</span><span class="op" id="7480330">.</span><span class="ident" id="7480331">AddFile</span><span class="op" id="7480338">(</span><span class="ident" id="7480339">test</span><span class="op" id="7480343">.</span><span class="ident" id="7480344">filename</span><span class="op" id="7480352">,</span>&nbsp;<span class="ident" id="7480354">base</span><span class="op" id="7480358">,</span>&nbsp;<span class="ident" id="7480360">test</span><span class="op" id="7480364">.</span><span class="ident" id="7480365">size</span><span class="op" id="7480369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7480373">j</span>&nbsp;<span class="op" id="7480375">:=</span>&nbsp;<span class="num" id="7480378">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7480382">fset</span><span class="op" id="7480386">.</span><span class="ident" id="7480387">Iterate</span><span class="op" id="7480394">(</span><span class="keyword" id="7480395">func</span><span class="op" id="7480399">(</span><span class="ident" id="7480400">f</span>&nbsp;<span class="op" id="7480402">*</span><span class="ident" id="7480403">File</span><span class="op" id="7480407">)</span>&nbsp;<span class="builtintype" id="7480409">bool</span>&nbsp;<span class="op" id="7480414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7480419">if</span>&nbsp;<span class="ident" id="7480422">f</span><span class="op" id="7480423">.</span><span class="ident" id="7480424">Name</span><span class="op" id="7480428">(</span><span class="op" id="7480429">)</span>&nbsp;<span class="op" id="7480431">!=</span>&nbsp;<span class="ident" id="7480434">tests</span><span class="op" id="7480439">[</span><span class="ident" id="7480440">j</span><span class="op" id="7480441">]</span><span class="op" id="7480442">.</span><span class="ident" id="7480443">filename</span>&nbsp;<span class="op" id="7480452">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7480458">t</span><span class="op" id="7480459">.</span><span class="ident" id="7480460">Errorf</span><span class="op" id="7480466">(</span><span class="string" id="7480467">&#34;got&nbsp;filename&nbsp;=&nbsp;%s;&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7480495">,</span>&nbsp;<span class="ident" id="7480497">f</span><span class="op" id="7480498">.</span><span class="ident" id="7480499">Name</span><span class="op" id="7480503">(</span><span class="op" id="7480504">)</span><span class="op" id="7480505">,</span>&nbsp;<span class="ident" id="7480507">tests</span><span class="op" id="7480512">[</span><span class="ident" id="7480513">j</span><span class="op" id="7480514">]</span><span class="op" id="7480515">.</span><span class="ident" id="7480516">filename</span><span class="op" id="7480524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7480529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7480534">j</span><span class="op" id="7480535">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7480541">return</span>&nbsp;<span class="builtintype" id="7480548">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7480555">}</span><span class="op" id="7480556">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7480560">if</span>&nbsp;<span class="ident" id="7480563">j</span>&nbsp;<span class="op" id="7480565">!=</span>&nbsp;<span class="ident" id="7480568">i</span><span class="op" id="7480569">+</span><span class="num" id="7480570">1</span>&nbsp;<span class="op" id="7480572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7480577">t</span><span class="op" id="7480578">.</span><span class="ident" id="7480579">Errorf</span><span class="op" id="7480585">(</span><span class="string" id="7480586">&#34;got&nbsp;%d&nbsp;files;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7480609">,</span>&nbsp;<span class="ident" id="7480611">j</span><span class="op" id="7480612">,</span>&nbsp;<span class="ident" id="7480614">i</span><span class="op" id="7480615">+</span><span class="num" id="7480616">1</span><span class="op" id="7480617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7480621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7480624">}</span><br>
<span class="lineno"></span><span class="op" id="7480626">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment" id="7480629">//&nbsp;FileSet.File&nbsp;should&nbsp;return&nbsp;nil&nbsp;if&nbsp;Pos&nbsp;is&nbsp;past&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;FileSet.</span><br>
<span class="lineno"></span><span class="keyword" id="7480702">func</span>&nbsp;<span class="ident" id="7480707">TestFileSetPastEnd</span><span class="op" id="7480725">(</span><span class="ident" id="7480726">t</span>&nbsp;<span class="op" id="7480728">*</span><span class="ident" id="7480729">testing</span><span class="op" id="7480736">.</span><span class="ident" id="7480737">T</span><span class="op" id="7480738">)</span>&nbsp;<span class="op" id="7480740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7480743">fset</span>&nbsp;<span class="op" id="7480748">:=</span>&nbsp;<span class="ident" id="7480751">NewFileSet</span><span class="op" id="7480761">(</span><span class="op" id="7480762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7480765">for</span>&nbsp;<span class="ident" id="7480769">_</span><span class="op" id="7480770">,</span>&nbsp;<span class="ident" id="7480772">test</span>&nbsp;<span class="op" id="7480777">:=</span>&nbsp;<span class="keyword" id="7480780">range</span>&nbsp;<span class="ident" id="7480786">tests</span>&nbsp;<span class="op" id="7480792">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7480796">fset</span><span class="op" id="7480800">.</span><span class="ident" id="7480801">AddFile</span><span class="op" id="7480808">(</span><span class="ident" id="7480809">test</span><span class="op" id="7480813">.</span><span class="ident" id="7480814">filename</span><span class="op" id="7480822">,</span>&nbsp;<span class="ident" id="7480824">fset</span><span class="op" id="7480828">.</span><span class="ident" id="7480829">Base</span><span class="op" id="7480833">(</span><span class="op" id="7480834">)</span><span class="op" id="7480835">,</span>&nbsp;<span class="ident" id="7480837">test</span><span class="op" id="7480841">.</span><span class="ident" id="7480842">size</span><span class="op" id="7480846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7480849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7480852">if</span>&nbsp;<span class="ident" id="7480855">f</span>&nbsp;<span class="op" id="7480857">:=</span>&nbsp;<span class="ident" id="7480860">fset</span><span class="op" id="7480864">.</span><span class="ident" id="7480865">File</span><span class="op" id="7480869">(</span><span class="ident" id="7480870">Pos</span><span class="op" id="7480873">(</span><span class="ident" id="7480874">fset</span><span class="op" id="7480878">.</span><span class="ident" id="7480879">Base</span><span class="op" id="7480883">(</span><span class="op" id="7480884">)</span><span class="op" id="7480885">)</span><span class="op" id="7480886">)</span><span class="op" id="7480887">;</span>&nbsp;<span class="ident" id="7480889">f</span>&nbsp;<span class="op" id="7480891">!=</span>&nbsp;<span class="ident" id="7480894">nil</span>&nbsp;<span class="op" id="7480898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7480902">t</span><span class="op" id="7480903">.</span><span class="ident" id="7480904">Errorf</span><span class="op" id="7480910">(</span><span class="string" id="7480911">&#34;got&nbsp;%v,&nbsp;want&nbsp;nil&#34;</span><span class="op" id="7480929">,</span>&nbsp;<span class="ident" id="7480931">f</span><span class="op" id="7480932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7480935">}</span><br>
<span class="lineno">200</span><span class="op" id="7480937">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7480940">func</span>&nbsp;<span class="ident" id="7480945">TestFileSetCacheUnlikely</span><span class="op" id="7480969">(</span><span class="ident" id="7480970">t</span>&nbsp;<span class="op" id="7480972">*</span><span class="ident" id="7480973">testing</span><span class="op" id="7480980">.</span><span class="ident" id="7480981">T</span><span class="op" id="7480982">)</span>&nbsp;<span class="op" id="7480984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7480987">fset</span>&nbsp;<span class="op" id="7480992">:=</span>&nbsp;<span class="ident" id="7480995">NewFileSet</span><span class="op" id="7481005">(</span><span class="op" id="7481006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7481009">offsets</span>&nbsp;<span class="op" id="7481017">:=</span>&nbsp;<span class="builtinfunc" id="7481020">make</span><span class="op" id="7481024">(</span><span class="keyword" id="7481025">map</span><span class="op" id="7481028">[</span><span class="builtintype" id="7481029">string</span><span class="op" id="7481035">]</span><span class="builtintype" id="7481036">int</span><span class="op" id="7481039">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7481042">for</span>&nbsp;<span class="ident" id="7481046">_</span><span class="op" id="7481047">,</span>&nbsp;<span class="ident" id="7481049">test</span>&nbsp;<span class="op" id="7481054">:=</span>&nbsp;<span class="keyword" id="7481057">range</span>&nbsp;<span class="ident" id="7481063">tests</span>&nbsp;<span class="op" id="7481069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7481073">offsets</span><span class="op" id="7481080">[</span><span class="ident" id="7481081">test</span><span class="op" id="7481085">.</span><span class="ident" id="7481086">filename</span><span class="op" id="7481094">]</span>&nbsp;<span class="op" id="7481096">=</span>&nbsp;<span class="ident" id="7481098">fset</span><span class="op" id="7481102">.</span><span class="ident" id="7481103">Base</span><span class="op" id="7481107">(</span><span class="op" id="7481108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7481112">fset</span><span class="op" id="7481116">.</span><span class="ident" id="7481117">AddFile</span><span class="op" id="7481124">(</span><span class="ident" id="7481125">test</span><span class="op" id="7481129">.</span><span class="ident" id="7481130">filename</span><span class="op" id="7481138">,</span>&nbsp;<span class="ident" id="7481140">fset</span><span class="op" id="7481144">.</span><span class="ident" id="7481145">Base</span><span class="op" id="7481149">(</span><span class="op" id="7481150">)</span><span class="op" id="7481151">,</span>&nbsp;<span class="ident" id="7481153">test</span><span class="op" id="7481157">.</span><span class="ident" id="7481158">size</span><span class="op" id="7481162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7481165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7481168">for</span>&nbsp;<span class="ident" id="7481172">file</span><span class="op" id="7481176">,</span>&nbsp;<span class="ident" id="7481178">pos</span>&nbsp;<span class="op" id="7481182">:=</span>&nbsp;<span class="keyword" id="7481185">range</span>&nbsp;<span class="ident" id="7481191">offsets</span>&nbsp;<span class="op" id="7481199">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7481203">f</span>&nbsp;<span class="op" id="7481205">:=</span>&nbsp;<span class="ident" id="7481208">fset</span><span class="op" id="7481212">.</span><span class="ident" id="7481213">File</span><span class="op" id="7481217">(</span><span class="ident" id="7481218">Pos</span><span class="op" id="7481221">(</span><span class="ident" id="7481222">pos</span><span class="op" id="7481225">)</span><span class="op" id="7481226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7481230">if</span>&nbsp;<span class="ident" id="7481233">f</span><span class="op" id="7481234">.</span><span class="ident" id="7481235">Name</span><span class="op" id="7481239">(</span><span class="op" id="7481240">)</span>&nbsp;<span class="op" id="7481242">!=</span>&nbsp;<span class="ident" id="7481245">file</span>&nbsp;<span class="op" id="7481250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7481255">t</span><span class="op" id="7481256">.</span><span class="ident" id="7481257">Errorf</span><span class="op" id="7481263">(</span><span class="string" id="7481264">&#34;got&nbsp;%q&nbsp;at&nbsp;position&nbsp;%d,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7481296">,</span>&nbsp;<span class="ident" id="7481298">f</span><span class="op" id="7481299">.</span><span class="ident" id="7481300">Name</span><span class="op" id="7481304">(</span><span class="op" id="7481305">)</span><span class="op" id="7481306">,</span>&nbsp;<span class="ident" id="7481308">pos</span><span class="op" id="7481311">,</span>&nbsp;<span class="ident" id="7481313">file</span><span class="op" id="7481317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7481321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7481324">}</span><br>
<span class="lineno">215</span><span class="op" id="7481326">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7481329">//&nbsp;issue&nbsp;4345.&nbsp;Test&nbsp;concurrent&nbsp;use&nbsp;of&nbsp;FileSet.Pos&nbsp;does&nbsp;not&nbsp;trigger&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="7481398">//&nbsp;race&nbsp;in&nbsp;the&nbsp;FileSet&nbsp;position&nbsp;cache.</span><br>
<span class="lineno"></span><span class="keyword" id="7481437">func</span>&nbsp;<span class="ident" id="7481442">TestFileSetRace</span><span class="op" id="7481457">(</span><span class="ident" id="7481458">t</span>&nbsp;<span class="op" id="7481460">*</span><span class="ident" id="7481461">testing</span><span class="op" id="7481468">.</span><span class="ident" id="7481469">T</span><span class="op" id="7481470">)</span>&nbsp;<span class="op" id="7481472">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7481475">fset</span>&nbsp;<span class="op" id="7481480">:=</span>&nbsp;<span class="ident" id="7481483">NewFileSet</span><span class="op" id="7481493">(</span><span class="op" id="7481494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7481497">for</span>&nbsp;<span class="ident" id="7481501">i</span>&nbsp;<span class="op" id="7481503">:=</span>&nbsp;<span class="num" id="7481506">0</span><span class="op" id="7481507">;</span>&nbsp;<span class="ident" id="7481509">i</span>&nbsp;<span class="op" id="7481511">&lt;</span>&nbsp;<span class="num" id="7481513">100</span><span class="op" id="7481516">;</span>&nbsp;<span class="ident" id="7481518">i</span><span class="op" id="7481519">++</span>&nbsp;<span class="op" id="7481522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7481526">fset</span><span class="op" id="7481530">.</span><span class="ident" id="7481531">AddFile</span><span class="op" id="7481538">(</span><span class="ident" id="7481539">fmt</span><span class="op" id="7481542">.</span><span class="ident" id="7481543">Sprintf</span><span class="op" id="7481550">(</span><span class="string" id="7481551">&#34;file-%d&#34;</span><span class="op" id="7481560">,</span>&nbsp;<span class="ident" id="7481562">i</span><span class="op" id="7481563">)</span><span class="op" id="7481564">,</span>&nbsp;<span class="ident" id="7481566">fset</span><span class="op" id="7481570">.</span><span class="ident" id="7481571">Base</span><span class="op" id="7481575">(</span><span class="op" id="7481576">)</span><span class="op" id="7481577">,</span>&nbsp;<span class="num" id="7481579">1031</span><span class="op" id="7481583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7481586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7481589">max</span>&nbsp;<span class="op" id="7481593">:=</span>&nbsp;<span class="builtintype" id="7481596">int32</span><span class="op" id="7481601">(</span><span class="ident" id="7481602">fset</span><span class="op" id="7481606">.</span><span class="ident" id="7481607">Base</span><span class="op" id="7481611">(</span><span class="op" id="7481612">)</span><span class="op" id="7481613">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7481616">var</span>&nbsp;<span class="ident" id="7481620">stop</span>&nbsp;<span class="ident" id="7481625">sync</span><span class="op" id="7481629">.</span><span class="ident" id="7481630">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7481641">r</span>&nbsp;<span class="op" id="7481643">:=</span>&nbsp;<span class="ident" id="7481646">rand</span><span class="op" id="7481650">.</span><span class="ident" id="7481651">New</span><span class="op" id="7481654">(</span><span class="ident" id="7481655">rand</span><span class="op" id="7481659">.</span><span class="ident" id="7481660">NewSource</span><span class="op" id="7481669">(</span><span class="num" id="7481670">7</span><span class="op" id="7481671">)</span><span class="op" id="7481672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7481675">for</span>&nbsp;<span class="ident" id="7481679">i</span>&nbsp;<span class="op" id="7481681">:=</span>&nbsp;<span class="num" id="7481684">0</span><span class="op" id="7481685">;</span>&nbsp;<span class="ident" id="7481687">i</span>&nbsp;<span class="op" id="7481689">&lt;</span>&nbsp;<span class="num" id="7481691">2</span><span class="op" id="7481692">;</span>&nbsp;<span class="ident" id="7481694">i</span><span class="op" id="7481695">++</span>&nbsp;<span class="op" id="7481698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7481702">r</span>&nbsp;<span class="op" id="7481704">:=</span>&nbsp;<span class="ident" id="7481707">rand</span><span class="op" id="7481711">.</span><span class="ident" id="7481712">New</span><span class="op" id="7481715">(</span><span class="ident" id="7481716">rand</span><span class="op" id="7481720">.</span><span class="ident" id="7481721">NewSource</span><span class="op" id="7481730">(</span><span class="ident" id="7481731">r</span><span class="op" id="7481732">.</span><span class="ident" id="7481733">Int63</span><span class="op" id="7481738">(</span><span class="op" id="7481739">)</span><span class="op" id="7481740">)</span><span class="op" id="7481741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7481745">stop</span><span class="op" id="7481749">.</span><span class="ident" id="7481750">Add</span><span class="op" id="7481753">(</span><span class="num" id="7481754">1</span><span class="op" id="7481755">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7481759">go</span>&nbsp;<span class="keyword" id="7481762">func</span><span class="op" id="7481766">(</span><span class="op" id="7481767">)</span>&nbsp;<span class="op" id="7481769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7481774">for</span>&nbsp;<span class="ident" id="7481778">i</span>&nbsp;<span class="op" id="7481780">:=</span>&nbsp;<span class="num" id="7481783">0</span><span class="op" id="7481784">;</span>&nbsp;<span class="ident" id="7481786">i</span>&nbsp;<span class="op" id="7481788">&lt;</span>&nbsp;<span class="num" id="7481790">1000</span><span class="op" id="7481794">;</span>&nbsp;<span class="ident" id="7481796">i</span><span class="op" id="7481797">++</span>&nbsp;<span class="op" id="7481800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7481806">fset</span><span class="op" id="7481810">.</span><span class="ident" id="7481811">Position</span><span class="op" id="7481819">(</span><span class="ident" id="7481820">Pos</span><span class="op" id="7481823">(</span><span class="ident" id="7481824">r</span><span class="op" id="7481825">.</span><span class="ident" id="7481826">Int31n</span><span class="op" id="7481832">(</span><span class="ident" id="7481833">max</span><span class="op" id="7481836">)</span><span class="op" id="7481837">)</span><span class="op" id="7481838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7481843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7481848">stop</span><span class="op" id="7481852">.</span><span class="ident" id="7481853">Done</span><span class="op" id="7481857">(</span><span class="op" id="7481858">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7481862">}</span><span class="op" id="7481863">(</span><span class="op" id="7481864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7481867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7481870">stop</span><span class="op" id="7481874">.</span><span class="ident" id="7481875">Wait</span><span class="op" id="7481879">(</span><span class="op" id="7481880">)</span><br>
<span class="lineno"></span><span class="op" id="7481882">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="7481885">func</span>&nbsp;<span class="ident" id="7481890">TestPositionFor</span><span class="op" id="7481905">(</span><span class="ident" id="7481906">t</span>&nbsp;<span class="op" id="7481908">*</span><span class="ident" id="7481909">testing</span><span class="op" id="7481916">.</span><span class="ident" id="7481917">T</span><span class="op" id="7481918">)</span>&nbsp;<span class="op" id="7481920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7481923">src</span>&nbsp;<span class="op" id="7481927">:=</span>&nbsp;<span class="op" id="7481930">[</span><span class="op" id="7481931">]</span><span class="builtintype" id="7481932">byte</span><span class="op" id="7481936">(</span><span class="string" id="7481937">`<br>
<span class="lineno"></span>foo<br>
<span class="lineno"></span>b<br>
<span class="lineno"></span>ar<br>
<span class="lineno">245</span>//line&nbsp;:100<br>
<span class="lineno"></span>foobar<br>
<span class="lineno"></span>//line&nbsp;bar:3<br>
<span class="lineno"></span>done<br>
<span class="lineno"></span>`</span><span class="op" id="7481986">)</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7481990">const</span>&nbsp;<span class="ident" id="7481996">filename</span>&nbsp;<span class="op" id="7482005">=</span>&nbsp;<span class="string" id="7482007">&#34;foo&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7482014">fset</span>&nbsp;<span class="op" id="7482019">:=</span>&nbsp;<span class="ident" id="7482022">NewFileSet</span><span class="op" id="7482032">(</span><span class="op" id="7482033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7482036">f</span>&nbsp;<span class="op" id="7482038">:=</span>&nbsp;<span class="ident" id="7482041">fset</span><span class="op" id="7482045">.</span><span class="ident" id="7482046">AddFile</span><span class="op" id="7482053">(</span><span class="ident" id="7482054">filename</span><span class="op" id="7482062">,</span>&nbsp;<span class="ident" id="7482064">fset</span><span class="op" id="7482068">.</span><span class="ident" id="7482069">Base</span><span class="op" id="7482073">(</span><span class="op" id="7482074">)</span><span class="op" id="7482075">,</span>&nbsp;<span class="builtinfunc" id="7482077">len</span><span class="op" id="7482080">(</span><span class="ident" id="7482081">src</span><span class="op" id="7482084">)</span><span class="op" id="7482085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7482088">f</span><span class="op" id="7482089">.</span><span class="ident" id="7482090">SetLinesForContent</span><span class="op" id="7482108">(</span><span class="ident" id="7482109">src</span><span class="op" id="7482112">)</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7482116">//&nbsp;verify&nbsp;position&nbsp;info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7482141">for</span>&nbsp;<span class="ident" id="7482145">i</span><span class="op" id="7482146">,</span>&nbsp;<span class="ident" id="7482148">offs</span>&nbsp;<span class="op" id="7482153">:=</span>&nbsp;<span class="keyword" id="7482156">range</span>&nbsp;<span class="ident" id="7482162">f</span><span class="op" id="7482163">.</span><span class="ident" id="7482164">lines</span>&nbsp;<span class="op" id="7482170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7482174">got1</span>&nbsp;<span class="op" id="7482179">:=</span>&nbsp;<span class="ident" id="7482182">f</span><span class="op" id="7482183">.</span><span class="ident" id="7482184">PositionFor</span><span class="op" id="7482195">(</span><span class="ident" id="7482196">f</span><span class="op" id="7482197">.</span><span class="ident" id="7482198">Pos</span><span class="op" id="7482201">(</span><span class="ident" id="7482202">offs</span><span class="op" id="7482206">)</span><span class="op" id="7482207">,</span>&nbsp;<span class="builtintype" id="7482209">false</span><span class="op" id="7482214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7482218">got2</span>&nbsp;<span class="op" id="7482223">:=</span>&nbsp;<span class="ident" id="7482226">f</span><span class="op" id="7482227">.</span><span class="ident" id="7482228">PositionFor</span><span class="op" id="7482239">(</span><span class="ident" id="7482240">f</span><span class="op" id="7482241">.</span><span class="ident" id="7482242">Pos</span><span class="op" id="7482245">(</span><span class="ident" id="7482246">offs</span><span class="op" id="7482250">)</span><span class="op" id="7482251">,</span>&nbsp;<span class="builtintype" id="7482253">true</span><span class="op" id="7482257">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7482261">got3</span>&nbsp;<span class="op" id="7482266">:=</span>&nbsp;<span class="ident" id="7482269">f</span><span class="op" id="7482270">.</span><span class="ident" id="7482271">Position</span><span class="op" id="7482279">(</span><span class="ident" id="7482280">f</span><span class="op" id="7482281">.</span><span class="ident" id="7482282">Pos</span><span class="op" id="7482285">(</span><span class="ident" id="7482286">offs</span><span class="op" id="7482290">)</span><span class="op" id="7482291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7482295">want</span>&nbsp;<span class="op" id="7482300">:=</span>&nbsp;<span class="ident" id="7482303">Position</span><span class="op" id="7482311">{</span><span class="ident" id="7482312">filename</span><span class="op" id="7482320">,</span>&nbsp;<span class="ident" id="7482322">offs</span><span class="op" id="7482326">,</span>&nbsp;<span class="ident" id="7482328">i</span>&nbsp;<span class="op" id="7482330">+</span>&nbsp;<span class="num" id="7482332">1</span><span class="op" id="7482333">,</span>&nbsp;<span class="num" id="7482335">1</span><span class="op" id="7482336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7482340">checkPos</span><span class="op" id="7482348">(</span><span class="ident" id="7482349">t</span><span class="op" id="7482350">,</span>&nbsp;<span class="string" id="7482352">&#34;1.&nbsp;PositionFor&nbsp;unadjusted&#34;</span><span class="op" id="7482379">,</span>&nbsp;<span class="ident" id="7482381">got1</span><span class="op" id="7482385">,</span>&nbsp;<span class="ident" id="7482387">want</span><span class="op" id="7482391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7482395">checkPos</span><span class="op" id="7482403">(</span><span class="ident" id="7482404">t</span><span class="op" id="7482405">,</span>&nbsp;<span class="string" id="7482407">&#34;1.&nbsp;PositionFor&nbsp;adjusted&#34;</span><span class="op" id="7482432">,</span>&nbsp;<span class="ident" id="7482434">got2</span><span class="op" id="7482438">,</span>&nbsp;<span class="ident" id="7482440">want</span><span class="op" id="7482444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7482448">checkPos</span><span class="op" id="7482456">(</span><span class="ident" id="7482457">t</span><span class="op" id="7482458">,</span>&nbsp;<span class="string" id="7482460">&#34;1.&nbsp;Position&#34;</span><span class="op" id="7482473">,</span>&nbsp;<span class="ident" id="7482475">got3</span><span class="op" id="7482479">,</span>&nbsp;<span class="ident" id="7482481">want</span><span class="op" id="7482485">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7482488">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7482492">//&nbsp;manually&nbsp;add&nbsp;//line&nbsp;info&nbsp;on&nbsp;lines&nbsp;l1,&nbsp;l2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7482537">const</span>&nbsp;<span class="ident" id="7482543">l1</span><span class="op" id="7482545">,</span>&nbsp;<span class="ident" id="7482547">l2</span>&nbsp;<span class="op" id="7482550">=</span>&nbsp;<span class="num" id="7482552">5</span><span class="op" id="7482553">,</span>&nbsp;<span class="num" id="7482555">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7482558">f</span><span class="op" id="7482559">.</span><span class="ident" id="7482560">AddLineInfo</span><span class="op" id="7482571">(</span><span class="ident" id="7482572">f</span><span class="op" id="7482573">.</span><span class="ident" id="7482574">lines</span><span class="op" id="7482579">[</span><span class="ident" id="7482580">l1</span><span class="op" id="7482582">-</span><span class="num" id="7482583">1</span><span class="op" id="7482584">]</span><span class="op" id="7482585">,</span>&nbsp;<span class="string" id="7482587">&#34;&#34;</span><span class="op" id="7482589">,</span>&nbsp;<span class="num" id="7482591">100</span><span class="op" id="7482594">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7482597">f</span><span class="op" id="7482598">.</span><span class="ident" id="7482599">AddLineInfo</span><span class="op" id="7482610">(</span><span class="ident" id="7482611">f</span><span class="op" id="7482612">.</span><span class="ident" id="7482613">lines</span><span class="op" id="7482618">[</span><span class="ident" id="7482619">l2</span><span class="op" id="7482621">-</span><span class="num" id="7482622">1</span><span class="op" id="7482623">]</span><span class="op" id="7482624">,</span>&nbsp;<span class="string" id="7482626">&#34;bar&#34;</span><span class="op" id="7482631">,</span>&nbsp;<span class="num" id="7482633">3</span><span class="op" id="7482634">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7482638">//&nbsp;unadjusted&nbsp;position&nbsp;info&nbsp;must&nbsp;remain&nbsp;unchanged</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7482689">for</span>&nbsp;<span class="ident" id="7482693">i</span><span class="op" id="7482694">,</span>&nbsp;<span class="ident" id="7482696">offs</span>&nbsp;<span class="op" id="7482701">:=</span>&nbsp;<span class="keyword" id="7482704">range</span>&nbsp;<span class="ident" id="7482710">f</span><span class="op" id="7482711">.</span><span class="ident" id="7482712">lines</span>&nbsp;<span class="op" id="7482718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7482722">got1</span>&nbsp;<span class="op" id="7482727">:=</span>&nbsp;<span class="ident" id="7482730">f</span><span class="op" id="7482731">.</span><span class="ident" id="7482732">PositionFor</span><span class="op" id="7482743">(</span><span class="ident" id="7482744">f</span><span class="op" id="7482745">.</span><span class="ident" id="7482746">Pos</span><span class="op" id="7482749">(</span><span class="ident" id="7482750">offs</span><span class="op" id="7482754">)</span><span class="op" id="7482755">,</span>&nbsp;<span class="builtintype" id="7482757">false</span><span class="op" id="7482762">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7482766">want</span>&nbsp;<span class="op" id="7482771">:=</span>&nbsp;<span class="ident" id="7482774">Position</span><span class="op" id="7482782">{</span><span class="ident" id="7482783">filename</span><span class="op" id="7482791">,</span>&nbsp;<span class="ident" id="7482793">offs</span><span class="op" id="7482797">,</span>&nbsp;<span class="ident" id="7482799">i</span>&nbsp;<span class="op" id="7482801">+</span>&nbsp;<span class="num" id="7482803">1</span><span class="op" id="7482804">,</span>&nbsp;<span class="num" id="7482806">1</span><span class="op" id="7482807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7482811">checkPos</span><span class="op" id="7482819">(</span><span class="ident" id="7482820">t</span><span class="op" id="7482821">,</span>&nbsp;<span class="string" id="7482823">&#34;2.&nbsp;PositionFor&nbsp;unadjusted&#34;</span><span class="op" id="7482850">,</span>&nbsp;<span class="ident" id="7482852">got1</span><span class="op" id="7482856">,</span>&nbsp;<span class="ident" id="7482858">want</span><span class="op" id="7482862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7482865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7482869">//&nbsp;adjusted&nbsp;position&nbsp;info&nbsp;should&nbsp;have&nbsp;changed</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7482916">for</span>&nbsp;<span class="ident" id="7482920">i</span><span class="op" id="7482921">,</span>&nbsp;<span class="ident" id="7482923">offs</span>&nbsp;<span class="op" id="7482928">:=</span>&nbsp;<span class="keyword" id="7482931">range</span>&nbsp;<span class="ident" id="7482937">f</span><span class="op" id="7482938">.</span><span class="ident" id="7482939">lines</span>&nbsp;<span class="op" id="7482945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7482949">got2</span>&nbsp;<span class="op" id="7482954">:=</span>&nbsp;<span class="ident" id="7482957">f</span><span class="op" id="7482958">.</span><span class="ident" id="7482959">PositionFor</span><span class="op" id="7482970">(</span><span class="ident" id="7482971">f</span><span class="op" id="7482972">.</span><span class="ident" id="7482973">Pos</span><span class="op" id="7482976">(</span><span class="ident" id="7482977">offs</span><span class="op" id="7482981">)</span><span class="op" id="7482982">,</span>&nbsp;<span class="builtintype" id="7482984">true</span><span class="op" id="7482988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7482992">got3</span>&nbsp;<span class="op" id="7482997">:=</span>&nbsp;<span class="ident" id="7483000">f</span><span class="op" id="7483001">.</span><span class="ident" id="7483002">Position</span><span class="op" id="7483010">(</span><span class="ident" id="7483011">f</span><span class="op" id="7483012">.</span><span class="ident" id="7483013">Pos</span><span class="op" id="7483016">(</span><span class="ident" id="7483017">offs</span><span class="op" id="7483021">)</span><span class="op" id="7483022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7483026">want</span>&nbsp;<span class="op" id="7483031">:=</span>&nbsp;<span class="ident" id="7483034">Position</span><span class="op" id="7483042">{</span><span class="ident" id="7483043">filename</span><span class="op" id="7483051">,</span>&nbsp;<span class="ident" id="7483053">offs</span><span class="op" id="7483057">,</span>&nbsp;<span class="ident" id="7483059">i</span>&nbsp;<span class="op" id="7483061">+</span>&nbsp;<span class="num" id="7483063">1</span><span class="op" id="7483064">,</span>&nbsp;<span class="num" id="7483066">1</span><span class="op" id="7483067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7483071">//&nbsp;manually&nbsp;compute&nbsp;wanted&nbsp;filename&nbsp;and&nbsp;line</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7483118">line</span>&nbsp;<span class="op" id="7483123">:=</span>&nbsp;<span class="ident" id="7483126">want</span><span class="op" id="7483130">.</span><span class="ident" id="7483131">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7483138">if</span>&nbsp;<span class="ident" id="7483141">i</span><span class="op" id="7483142">+</span><span class="num" id="7483143">1</span>&nbsp;<span class="op" id="7483145">&gt;=</span>&nbsp;<span class="ident" id="7483148">l1</span>&nbsp;<span class="op" id="7483151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7483156">want</span><span class="op" id="7483160">.</span><span class="ident" id="7483161">Filename</span>&nbsp;<span class="op" id="7483170">=</span>&nbsp;<span class="string" id="7483172">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7483178">want</span><span class="op" id="7483182">.</span><span class="ident" id="7483183">Line</span>&nbsp;<span class="op" id="7483188">=</span>&nbsp;<span class="ident" id="7483190">line</span>&nbsp;<span class="op" id="7483195">-</span>&nbsp;<span class="ident" id="7483197">l1</span>&nbsp;<span class="op" id="7483200">+</span>&nbsp;<span class="num" id="7483202">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7483208">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7483212">if</span>&nbsp;<span class="ident" id="7483215">i</span><span class="op" id="7483216">+</span><span class="num" id="7483217">1</span>&nbsp;<span class="op" id="7483219">&gt;=</span>&nbsp;<span class="ident" id="7483222">l2</span>&nbsp;<span class="op" id="7483225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7483230">want</span><span class="op" id="7483234">.</span><span class="ident" id="7483235">Filename</span>&nbsp;<span class="op" id="7483244">=</span>&nbsp;<span class="string" id="7483246">&#34;bar&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7483255">want</span><span class="op" id="7483259">.</span><span class="ident" id="7483260">Line</span>&nbsp;<span class="op" id="7483265">=</span>&nbsp;<span class="ident" id="7483267">line</span>&nbsp;<span class="op" id="7483272">-</span>&nbsp;<span class="ident" id="7483274">l2</span>&nbsp;<span class="op" id="7483277">+</span>&nbsp;<span class="num" id="7483279">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7483283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7483287">checkPos</span><span class="op" id="7483295">(</span><span class="ident" id="7483296">t</span><span class="op" id="7483297">,</span>&nbsp;<span class="string" id="7483299">&#34;3.&nbsp;PositionFor&nbsp;adjusted&#34;</span><span class="op" id="7483324">,</span>&nbsp;<span class="ident" id="7483326">got2</span><span class="op" id="7483330">,</span>&nbsp;<span class="ident" id="7483332">want</span><span class="op" id="7483336">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7483340">checkPos</span><span class="op" id="7483348">(</span><span class="ident" id="7483349">t</span><span class="op" id="7483350">,</span>&nbsp;<span class="string" id="7483352">&#34;3.&nbsp;Position&#34;</span><span class="op" id="7483365">,</span>&nbsp;<span class="ident" id="7483367">got3</span><span class="op" id="7483371">,</span>&nbsp;<span class="ident" id="7483373">want</span><span class="op" id="7483377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7483380">}</span><br>
<span class="lineno"></span><span class="op" id="7483382">}</span>
</div>
</body>
</html>
