<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html" class="current">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6028985">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6029040">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6029094">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6029145">package</span>&nbsp;<span class="ident" id="6029153">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6029158">import</span>&nbsp;<span class="op" id="6029165">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6029168">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6029177">&#34;encoding/binary&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6029196">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6029206">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6029214">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6029228">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6029234">&#34;os&#34;</span><br>
<span class="lineno">15</span><span class="op" id="6029239">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6029242">var</span>&nbsp;<span class="op" id="6029246">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6029249">ErrFormat</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6029262">=</span>&nbsp;<span class="ident" id="6029264">errors</span><span class="op" id="6029270">.</span><span class="ident" id="6029271">New</span><span class="op" id="6029274">(</span><span class="string" id="6029275">&#34;zip:&nbsp;not&nbsp;a&nbsp;valid&nbsp;zip&nbsp;file&#34;</span><span class="op" id="6029302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6029305">ErrAlgorithm</span>&nbsp;<span class="op" id="6029318">=</span>&nbsp;<span class="ident" id="6029320">errors</span><span class="op" id="6029326">.</span><span class="ident" id="6029327">New</span><span class="op" id="6029330">(</span><span class="string" id="6029331">&#34;zip:&nbsp;unsupported&nbsp;compression&nbsp;algorithm&#34;</span><span class="op" id="6029371">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6029374">ErrChecksum</span>&nbsp;&nbsp;<span class="op" id="6029387">=</span>&nbsp;<span class="ident" id="6029389">errors</span><span class="op" id="6029395">.</span><span class="ident" id="6029396">New</span><span class="op" id="6029399">(</span><span class="string" id="6029400">&#34;zip:&nbsp;checksum&nbsp;error&#34;</span><span class="op" id="6029421">)</span><br>
<span class="lineno"></span><span class="op" id="6029423">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6029426">type</span>&nbsp;<span class="ident" id="6029431">Reader</span>&nbsp;<span class="keyword" id="6029438">struct</span>&nbsp;<span class="op" id="6029445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6029448">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6029456">io</span><span class="op" id="6029458">.</span><span class="ident" id="6029459">ReaderAt</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6029469">File</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6029477">[</span><span class="op" id="6029478">]</span><span class="op" id="6029479">*</span><span class="ident" id="6029480">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6029486">Comment</span>&nbsp;<span class="builtintype" id="6029494">string</span><br>
<span class="lineno"></span><span class="op" id="6029501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6029504">type</span>&nbsp;<span class="ident" id="6029509">ReadCloser</span>&nbsp;<span class="keyword" id="6029520">struct</span>&nbsp;<span class="op" id="6029527">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6029530">f</span>&nbsp;<span class="op" id="6029532">*</span><span class="ident" id="6029533">os</span><span class="op" id="6029535">.</span><span class="ident" id="6029536">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6029542">Reader</span><br>
<span class="lineno"></span><span class="op" id="6029549">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6029552">type</span>&nbsp;<span class="ident" id="6029557">File</span>&nbsp;<span class="keyword" id="6029562">struct</span>&nbsp;<span class="op" id="6029569">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6029572">FileHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6029584">zipr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6029597">io</span><span class="op" id="6029599">.</span><span class="ident" id="6029600">ReaderAt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6029610">zipsize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6029623">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6029630">headerOffset</span>&nbsp;<span class="ident" id="6029643">int64</span><br>
<span class="lineno"></span><span class="op" id="6029649">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="6029652">func</span>&nbsp;<span class="op" id="6029657">(</span><span class="ident" id="6029658">f</span>&nbsp;<span class="op" id="6029660">*</span><span class="ident" id="6029661">File</span><span class="op" id="6029665">)</span>&nbsp;<span class="ident" id="6029667">hasDataDescriptor</span><span class="op" id="6029684">(</span><span class="op" id="6029685">)</span>&nbsp;<span class="builtintype" id="6029687">bool</span>&nbsp;<span class="op" id="6029692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6029695">return</span>&nbsp;<span class="ident" id="6029702">f</span><span class="op" id="6029703">.</span><span class="ident" id="6029704">Flags</span><span class="op" id="6029709">&amp;</span><span class="num" id="6029710">0x8</span>&nbsp;<span class="op" id="6029714">!=</span>&nbsp;<span class="num" id="6029717">0</span><br>
<span class="lineno"></span><span class="op" id="6029719">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="6029722">//&nbsp;OpenReader&nbsp;will&nbsp;open&nbsp;the&nbsp;Zip&nbsp;file&nbsp;specified&nbsp;by&nbsp;name&nbsp;and&nbsp;return&nbsp;a&nbsp;ReadCloser.</span><br>
<span class="lineno"></span><span class="keyword" id="6029802">func</span>&nbsp;<span class="ident" id="6029807">OpenReader</span><span class="op" id="6029817">(</span><span class="ident" id="6029818">name</span>&nbsp;<span class="builtintype" id="6029823">string</span><span class="op" id="6029829">)</span>&nbsp;<span class="op" id="6029831">(</span><span class="op" id="6029832">*</span><span class="ident" id="6029833">ReadCloser</span><span class="op" id="6029843">,</span>&nbsp;<span class="builtintype" id="6029845">error</span><span class="op" id="6029850">)</span>&nbsp;<span class="op" id="6029852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6029855">f</span><span class="op" id="6029856">,</span>&nbsp;<span class="ident" id="6029858">err</span>&nbsp;<span class="op" id="6029862">:=</span>&nbsp;<span class="ident" id="6029865">os</span><span class="op" id="6029867">.</span><span class="ident" id="6029868">Open</span><span class="op" id="6029872">(</span><span class="ident" id="6029873">name</span><span class="op" id="6029877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6029880">if</span>&nbsp;<span class="ident" id="6029883">err</span>&nbsp;<span class="op" id="6029887">!=</span>&nbsp;<span class="builtintype" id="6029890">nil</span>&nbsp;<span class="op" id="6029894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6029898">return</span>&nbsp;<span class="builtintype" id="6029905">nil</span><span class="op" id="6029908">,</span>&nbsp;<span class="ident" id="6029910">err</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6029915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6029918">fi</span><span class="op" id="6029920">,</span>&nbsp;<span class="ident" id="6029922">err</span>&nbsp;<span class="op" id="6029926">:=</span>&nbsp;<span class="ident" id="6029929">f</span><span class="op" id="6029930">.</span><span class="ident" id="6029931">Stat</span><span class="op" id="6029935">(</span><span class="op" id="6029936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6029939">if</span>&nbsp;<span class="ident" id="6029942">err</span>&nbsp;<span class="op" id="6029946">!=</span>&nbsp;<span class="builtintype" id="6029949">nil</span>&nbsp;<span class="op" id="6029953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6029957">f</span><span class="op" id="6029958">.</span><span class="ident" id="6029959">Close</span><span class="op" id="6029964">(</span><span class="op" id="6029965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6029969">return</span>&nbsp;<span class="builtintype" id="6029976">nil</span><span class="op" id="6029979">,</span>&nbsp;<span class="ident" id="6029981">err</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6029986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6029989">r</span>&nbsp;<span class="op" id="6029991">:=</span>&nbsp;<span class="builtinfunc" id="6029994">new</span><span class="op" id="6029997">(</span><span class="ident" id="6029998">ReadCloser</span><span class="op" id="6030008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6030011">if</span>&nbsp;<span class="ident" id="6030014">err</span>&nbsp;<span class="op" id="6030018">:=</span>&nbsp;<span class="ident" id="6030021">r</span><span class="op" id="6030022">.</span><span class="ident" id="6030023">init</span><span class="op" id="6030027">(</span><span class="ident" id="6030028">f</span><span class="op" id="6030029">,</span>&nbsp;<span class="ident" id="6030031">fi</span><span class="op" id="6030033">.</span><span class="ident" id="6030034">Size</span><span class="op" id="6030038">(</span><span class="op" id="6030039">)</span><span class="op" id="6030040">)</span><span class="op" id="6030041">;</span>&nbsp;<span class="ident" id="6030043">err</span>&nbsp;<span class="op" id="6030047">!=</span>&nbsp;<span class="builtintype" id="6030050">nil</span>&nbsp;<span class="op" id="6030054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6030058">f</span><span class="op" id="6030059">.</span><span class="ident" id="6030060">Close</span><span class="op" id="6030065">(</span><span class="op" id="6030066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6030070">return</span>&nbsp;<span class="builtintype" id="6030077">nil</span><span class="op" id="6030080">,</span>&nbsp;<span class="ident" id="6030082">err</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6030087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6030090">r</span><span class="op" id="6030091">.</span><span class="ident" id="6030092">f</span>&nbsp;<span class="op" id="6030094">=</span>&nbsp;<span class="ident" id="6030096">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6030099">return</span>&nbsp;<span class="ident" id="6030106">r</span><span class="op" id="6030107">,</span>&nbsp;<span class="builtintype" id="6030109">nil</span><br>
<span class="lineno"></span><span class="op" id="6030113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="6030116">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;from&nbsp;r,&nbsp;which&nbsp;is&nbsp;assumed&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6030186">//&nbsp;have&nbsp;the&nbsp;given&nbsp;size&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="6030219">func</span>&nbsp;<span class="ident" id="6030224">NewReader</span><span class="op" id="6030233">(</span><span class="ident" id="6030234">r</span>&nbsp;<span class="ident" id="6030236">io</span><span class="op" id="6030238">.</span><span class="ident" id="6030239">ReaderAt</span><span class="op" id="6030247">,</span>&nbsp;<span class="ident" id="6030249">size</span>&nbsp;<span class="ident" id="6030254">int64</span><span class="op" id="6030259">)</span>&nbsp;<span class="op" id="6030261">(</span><span class="op" id="6030262">*</span><span class="ident" id="6030263">Reader</span><span class="op" id="6030269">,</span>&nbsp;<span class="builtintype" id="6030271">error</span><span class="op" id="6030276">)</span>&nbsp;<span class="op" id="6030278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6030281">zr</span>&nbsp;<span class="op" id="6030284">:=</span>&nbsp;<span class="builtinfunc" id="6030287">new</span><span class="op" id="6030290">(</span><span class="ident" id="6030291">Reader</span><span class="op" id="6030297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6030300">if</span>&nbsp;<span class="ident" id="6030303">err</span>&nbsp;<span class="op" id="6030307">:=</span>&nbsp;<span class="ident" id="6030310">zr</span><span class="op" id="6030312">.</span><span class="ident" id="6030313">init</span><span class="op" id="6030317">(</span><span class="ident" id="6030318">r</span><span class="op" id="6030319">,</span>&nbsp;<span class="ident" id="6030321">size</span><span class="op" id="6030325">)</span><span class="op" id="6030326">;</span>&nbsp;<span class="ident" id="6030328">err</span>&nbsp;<span class="op" id="6030332">!=</span>&nbsp;<span class="builtintype" id="6030335">nil</span>&nbsp;<span class="op" id="6030339">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6030343">return</span>&nbsp;<span class="builtintype" id="6030350">nil</span><span class="op" id="6030353">,</span>&nbsp;<span class="ident" id="6030355">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6030360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6030363">return</span>&nbsp;<span class="ident" id="6030370">zr</span><span class="op" id="6030372">,</span>&nbsp;<span class="builtintype" id="6030374">nil</span><br>
<span class="lineno"></span><span class="op" id="6030378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="6030381">func</span>&nbsp;<span class="op" id="6030386">(</span><span class="ident" id="6030387">z</span>&nbsp;<span class="op" id="6030389">*</span><span class="ident" id="6030390">Reader</span><span class="op" id="6030396">)</span>&nbsp;<span class="ident" id="6030398">init</span><span class="op" id="6030402">(</span><span class="ident" id="6030403">r</span>&nbsp;<span class="ident" id="6030405">io</span><span class="op" id="6030407">.</span><span class="ident" id="6030408">ReaderAt</span><span class="op" id="6030416">,</span>&nbsp;<span class="ident" id="6030418">size</span>&nbsp;<span class="ident" id="6030423">int64</span><span class="op" id="6030428">)</span>&nbsp;<span class="builtintype" id="6030430">error</span>&nbsp;<span class="op" id="6030436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6030439">end</span><span class="op" id="6030442">,</span>&nbsp;<span class="ident" id="6030444">err</span>&nbsp;<span class="op" id="6030448">:=</span>&nbsp;<span class="ident" id="6030451">readDirectoryEnd</span><span class="op" id="6030467">(</span><span class="ident" id="6030468">r</span><span class="op" id="6030469">,</span>&nbsp;<span class="ident" id="6030471">size</span><span class="op" id="6030475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6030478">if</span>&nbsp;<span class="ident" id="6030481">err</span>&nbsp;<span class="op" id="6030485">!=</span>&nbsp;<span class="builtintype" id="6030488">nil</span>&nbsp;<span class="op" id="6030492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6030496">return</span>&nbsp;<span class="ident" id="6030503">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6030508">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6030511">z</span><span class="op" id="6030512">.</span><span class="ident" id="6030513">r</span>&nbsp;<span class="op" id="6030515">=</span>&nbsp;<span class="ident" id="6030517">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6030520">z</span><span class="op" id="6030521">.</span><span class="ident" id="6030522">File</span>&nbsp;<span class="op" id="6030527">=</span>&nbsp;<span class="builtinfunc" id="6030529">make</span><span class="op" id="6030533">(</span><span class="op" id="6030534">[</span><span class="op" id="6030535">]</span><span class="op" id="6030536">*</span><span class="ident" id="6030537">File</span><span class="op" id="6030541">,</span>&nbsp;<span class="num" id="6030543">0</span><span class="op" id="6030544">,</span>&nbsp;<span class="ident" id="6030546">end</span><span class="op" id="6030549">.</span><span class="ident" id="6030550">directoryRecords</span><span class="op" id="6030566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6030569">z</span><span class="op" id="6030570">.</span><span class="ident" id="6030571">Comment</span>&nbsp;<span class="op" id="6030579">=</span>&nbsp;<span class="ident" id="6030581">end</span><span class="op" id="6030584">.</span><span class="ident" id="6030585">comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6030594">rs</span>&nbsp;<span class="op" id="6030597">:=</span>&nbsp;<span class="ident" id="6030600">io</span><span class="op" id="6030602">.</span><span class="ident" id="6030603">NewSectionReader</span><span class="op" id="6030619">(</span><span class="ident" id="6030620">r</span><span class="op" id="6030621">,</span>&nbsp;<span class="num" id="6030623">0</span><span class="op" id="6030624">,</span>&nbsp;<span class="ident" id="6030626">size</span><span class="op" id="6030630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6030633">if</span>&nbsp;<span class="ident" id="6030636">_</span><span class="op" id="6030637">,</span>&nbsp;<span class="ident" id="6030639">err</span>&nbsp;<span class="op" id="6030643">=</span>&nbsp;<span class="ident" id="6030645">rs</span><span class="op" id="6030647">.</span><span class="ident" id="6030648">Seek</span><span class="op" id="6030652">(</span><span class="ident" id="6030653">int64</span><span class="op" id="6030658">(</span><span class="ident" id="6030659">end</span><span class="op" id="6030662">.</span><span class="ident" id="6030663">directoryOffset</span><span class="op" id="6030678">)</span><span class="op" id="6030679">,</span>&nbsp;<span class="ident" id="6030681">os</span><span class="op" id="6030683">.</span><span class="ident" id="6030684">SEEK_SET</span><span class="op" id="6030692">)</span><span class="op" id="6030693">;</span>&nbsp;<span class="ident" id="6030695">err</span>&nbsp;<span class="op" id="6030699">!=</span>&nbsp;<span class="builtintype" id="6030702">nil</span>&nbsp;<span class="op" id="6030706">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6030710">return</span>&nbsp;<span class="ident" id="6030717">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6030722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6030725">buf</span>&nbsp;<span class="op" id="6030729">:=</span>&nbsp;<span class="ident" id="6030732">bufio</span><span class="op" id="6030737">.</span><span class="ident" id="6030738">NewReader</span><span class="op" id="6030747">(</span><span class="ident" id="6030748">rs</span><span class="op" id="6030750">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6030754">//&nbsp;The&nbsp;count&nbsp;of&nbsp;files&nbsp;inside&nbsp;a&nbsp;zip&nbsp;is&nbsp;truncated&nbsp;to&nbsp;fit&nbsp;in&nbsp;a&nbsp;uint16.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6030823">//&nbsp;Gloss&nbsp;over&nbsp;this&nbsp;by&nbsp;reading&nbsp;headers&nbsp;until&nbsp;we&nbsp;encounter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6030881">//&nbsp;a&nbsp;bad&nbsp;one,&nbsp;and&nbsp;then&nbsp;only&nbsp;report&nbsp;a&nbsp;ErrFormat&nbsp;or&nbsp;UnexpectedEOF&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6030949">//&nbsp;the&nbsp;file&nbsp;count&nbsp;modulo&nbsp;65536&nbsp;is&nbsp;incorrect.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6030995">for</span>&nbsp;<span class="op" id="6030999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6031003">f</span>&nbsp;<span class="op" id="6031005">:=</span>&nbsp;<span class="op" id="6031008">&amp;</span><span class="ident" id="6031009">File</span><span class="op" id="6031013">{</span><span class="ident" id="6031014">zipr</span><span class="op" id="6031018">:</span>&nbsp;<span class="ident" id="6031020">r</span><span class="op" id="6031021">,</span>&nbsp;<span class="ident" id="6031023">zipsize</span><span class="op" id="6031030">:</span>&nbsp;<span class="ident" id="6031032">size</span><span class="op" id="6031036">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6031040">err</span>&nbsp;<span class="op" id="6031044">=</span>&nbsp;<span class="ident" id="6031046">readDirectoryHeader</span><span class="op" id="6031065">(</span><span class="ident" id="6031066">f</span><span class="op" id="6031067">,</span>&nbsp;<span class="ident" id="6031069">buf</span><span class="op" id="6031072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6031076">if</span>&nbsp;<span class="ident" id="6031079">err</span>&nbsp;<span class="op" id="6031083">==</span>&nbsp;<span class="ident" id="6031086">ErrFormat</span>&nbsp;<span class="op" id="6031096">||</span>&nbsp;<span class="ident" id="6031099">err</span>&nbsp;<span class="op" id="6031103">==</span>&nbsp;<span class="ident" id="6031106">io</span><span class="op" id="6031108">.</span><span class="ident" id="6031109">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="6031126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6031131">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6031139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6031143">if</span>&nbsp;<span class="ident" id="6031146">err</span>&nbsp;<span class="op" id="6031150">!=</span>&nbsp;<span class="builtintype" id="6031153">nil</span>&nbsp;<span class="op" id="6031157">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6031162">return</span>&nbsp;<span class="ident" id="6031169">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6031175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6031179">z</span><span class="op" id="6031180">.</span><span class="ident" id="6031181">File</span>&nbsp;<span class="op" id="6031186">=</span>&nbsp;<span class="builtinfunc" id="6031188">append</span><span class="op" id="6031194">(</span><span class="ident" id="6031195">z</span><span class="op" id="6031196">.</span><span class="ident" id="6031197">File</span><span class="op" id="6031201">,</span>&nbsp;<span class="ident" id="6031203">f</span><span class="op" id="6031204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6031207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6031210">if</span>&nbsp;<span class="builtintype" id="6031213">uint16</span><span class="op" id="6031219">(</span><span class="builtinfunc" id="6031220">len</span><span class="op" id="6031223">(</span><span class="ident" id="6031224">z</span><span class="op" id="6031225">.</span><span class="ident" id="6031226">File</span><span class="op" id="6031230">)</span><span class="op" id="6031231">)</span>&nbsp;<span class="op" id="6031233">!=</span>&nbsp;<span class="builtintype" id="6031236">uint16</span><span class="op" id="6031242">(</span><span class="ident" id="6031243">end</span><span class="op" id="6031246">.</span><span class="ident" id="6031247">directoryRecords</span><span class="op" id="6031263">)</span>&nbsp;<span class="op" id="6031265">{</span>&nbsp;<span class="comment" id="6031267">//&nbsp;only&nbsp;compare&nbsp;16&nbsp;bits&nbsp;here</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6031298">//&nbsp;Return&nbsp;the&nbsp;readDirectoryHeader&nbsp;error&nbsp;if&nbsp;we&nbsp;read</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6031351">//&nbsp;the&nbsp;wrong&nbsp;number&nbsp;of&nbsp;directory&nbsp;entries.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6031395">return</span>&nbsp;<span class="ident" id="6031402">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6031407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6031410">return</span>&nbsp;<span class="builtintype" id="6031417">nil</span><br>
<span class="lineno">110</span><span class="op" id="6031421">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6031424">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Zip&nbsp;file,&nbsp;rendering&nbsp;it&nbsp;unusable&nbsp;for&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="keyword" id="6031485">func</span>&nbsp;<span class="op" id="6031490">(</span><span class="ident" id="6031491">rc</span>&nbsp;<span class="op" id="6031494">*</span><span class="ident" id="6031495">ReadCloser</span><span class="op" id="6031505">)</span>&nbsp;<span class="ident" id="6031507">Close</span><span class="op" id="6031512">(</span><span class="op" id="6031513">)</span>&nbsp;<span class="builtintype" id="6031515">error</span>&nbsp;<span class="op" id="6031521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6031524">return</span>&nbsp;<span class="ident" id="6031531">rc</span><span class="op" id="6031533">.</span><span class="ident" id="6031534">f</span><span class="op" id="6031535">.</span><span class="ident" id="6031536">Close</span><span class="op" id="6031541">(</span><span class="op" id="6031542">)</span><br>
<span class="lineno">115</span><span class="op" id="6031544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6031547">//&nbsp;DataOffset&nbsp;returns&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;file&#39;s&nbsp;possibly-compressed</span><br>
<span class="lineno"></span><span class="comment" id="6031614">//&nbsp;data,&nbsp;relative&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;zip&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="6031666">//</span><br>
<span class="lineno">120</span><span class="comment" id="6031669">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;instead&nbsp;use&nbsp;Open,&nbsp;which&nbsp;transparently</span><br>
<span class="lineno"></span><span class="comment" id="6031730">//&nbsp;decompresses&nbsp;data&nbsp;and&nbsp;verifies&nbsp;checksums.</span><br>
<span class="lineno"></span><span class="keyword" id="6031775">func</span>&nbsp;<span class="op" id="6031780">(</span><span class="ident" id="6031781">f</span>&nbsp;<span class="op" id="6031783">*</span><span class="ident" id="6031784">File</span><span class="op" id="6031788">)</span>&nbsp;<span class="ident" id="6031790">DataOffset</span><span class="op" id="6031800">(</span><span class="op" id="6031801">)</span>&nbsp;<span class="op" id="6031803">(</span><span class="ident" id="6031804">offset</span>&nbsp;<span class="ident" id="6031811">int64</span><span class="op" id="6031816">,</span>&nbsp;<span class="ident" id="6031818">err</span>&nbsp;<span class="builtintype" id="6031822">error</span><span class="op" id="6031827">)</span>&nbsp;<span class="op" id="6031829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6031832">bodyOffset</span><span class="op" id="6031842">,</span>&nbsp;<span class="ident" id="6031844">err</span>&nbsp;<span class="op" id="6031848">:=</span>&nbsp;<span class="ident" id="6031851">f</span><span class="op" id="6031852">.</span><span class="ident" id="6031853">findBodyOffset</span><span class="op" id="6031867">(</span><span class="op" id="6031868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6031871">if</span>&nbsp;<span class="ident" id="6031874">err</span>&nbsp;<span class="op" id="6031878">!=</span>&nbsp;<span class="builtintype" id="6031881">nil</span>&nbsp;<span class="op" id="6031885">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6031889">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6031897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6031900">return</span>&nbsp;<span class="ident" id="6031907">f</span><span class="op" id="6031908">.</span><span class="ident" id="6031909">headerOffset</span>&nbsp;<span class="op" id="6031922">+</span>&nbsp;<span class="ident" id="6031924">bodyOffset</span><span class="op" id="6031934">,</span>&nbsp;<span class="builtintype" id="6031936">nil</span><br>
<span class="lineno"></span><span class="op" id="6031940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="6031943">//&nbsp;Open&nbsp;returns&nbsp;a&nbsp;ReadCloser&nbsp;that&nbsp;provides&nbsp;access&nbsp;to&nbsp;the&nbsp;File&#39;s&nbsp;contents.</span><br>
<span class="lineno"></span><span class="comment" id="6032017">//&nbsp;Multiple&nbsp;files&nbsp;may&nbsp;be&nbsp;read&nbsp;concurrently.</span><br>
<span class="lineno"></span><span class="keyword" id="6032061">func</span>&nbsp;<span class="op" id="6032066">(</span><span class="ident" id="6032067">f</span>&nbsp;<span class="op" id="6032069">*</span><span class="ident" id="6032070">File</span><span class="op" id="6032074">)</span>&nbsp;<span class="ident" id="6032076">Open</span><span class="op" id="6032080">(</span><span class="op" id="6032081">)</span>&nbsp;<span class="op" id="6032083">(</span><span class="ident" id="6032084">rc</span>&nbsp;<span class="ident" id="6032087">io</span><span class="op" id="6032089">.</span><span class="ident" id="6032090">ReadCloser</span><span class="op" id="6032100">,</span>&nbsp;<span class="ident" id="6032102">err</span>&nbsp;<span class="builtintype" id="6032106">error</span><span class="op" id="6032111">)</span>&nbsp;<span class="op" id="6032113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6032116">bodyOffset</span><span class="op" id="6032126">,</span>&nbsp;<span class="ident" id="6032128">err</span>&nbsp;<span class="op" id="6032132">:=</span>&nbsp;<span class="ident" id="6032135">f</span><span class="op" id="6032136">.</span><span class="ident" id="6032137">findBodyOffset</span><span class="op" id="6032151">(</span><span class="op" id="6032152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6032155">if</span>&nbsp;<span class="ident" id="6032158">err</span>&nbsp;<span class="op" id="6032162">!=</span>&nbsp;<span class="builtintype" id="6032165">nil</span>&nbsp;<span class="op" id="6032169">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6032173">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6032181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6032184">size</span>&nbsp;<span class="op" id="6032189">:=</span>&nbsp;<span class="ident" id="6032192">int64</span><span class="op" id="6032197">(</span><span class="ident" id="6032198">f</span><span class="op" id="6032199">.</span><span class="ident" id="6032200">CompressedSize64</span><span class="op" id="6032216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6032219">r</span>&nbsp;<span class="op" id="6032221">:=</span>&nbsp;<span class="ident" id="6032224">io</span><span class="op" id="6032226">.</span><span class="ident" id="6032227">NewSectionReader</span><span class="op" id="6032243">(</span><span class="ident" id="6032244">f</span><span class="op" id="6032245">.</span><span class="ident" id="6032246">zipr</span><span class="op" id="6032250">,</span>&nbsp;<span class="ident" id="6032252">f</span><span class="op" id="6032253">.</span><span class="ident" id="6032254">headerOffset</span><span class="op" id="6032266">+</span><span class="ident" id="6032267">bodyOffset</span><span class="op" id="6032277">,</span>&nbsp;<span class="ident" id="6032279">size</span><span class="op" id="6032283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6032286">dcomp</span>&nbsp;<span class="op" id="6032292">:=</span>&nbsp;<span class="ident" id="6032295">decompressor</span><span class="op" id="6032307">(</span><span class="ident" id="6032308">f</span><span class="op" id="6032309">.</span><span class="ident" id="6032310">Method</span><span class="op" id="6032316">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6032319">if</span>&nbsp;<span class="ident" id="6032322">dcomp</span>&nbsp;<span class="op" id="6032328">==</span>&nbsp;<span class="builtintype" id="6032331">nil</span>&nbsp;<span class="op" id="6032335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6032339">err</span>&nbsp;<span class="op" id="6032343">=</span>&nbsp;<span class="ident" id="6032345">ErrAlgorithm</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6032360">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6032368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6032371">rc</span>&nbsp;<span class="op" id="6032374">=</span>&nbsp;<span class="ident" id="6032376">dcomp</span><span class="op" id="6032381">(</span><span class="ident" id="6032382">r</span><span class="op" id="6032383">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6032386">var</span>&nbsp;<span class="ident" id="6032390">desr</span>&nbsp;<span class="ident" id="6032395">io</span><span class="op" id="6032397">.</span><span class="ident" id="6032398">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6032406">if</span>&nbsp;<span class="ident" id="6032409">f</span><span class="op" id="6032410">.</span><span class="ident" id="6032411">hasDataDescriptor</span><span class="op" id="6032428">(</span><span class="op" id="6032429">)</span>&nbsp;<span class="op" id="6032431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6032435">desr</span>&nbsp;<span class="op" id="6032440">=</span>&nbsp;<span class="ident" id="6032442">io</span><span class="op" id="6032444">.</span><span class="ident" id="6032445">NewSectionReader</span><span class="op" id="6032461">(</span><span class="ident" id="6032462">f</span><span class="op" id="6032463">.</span><span class="ident" id="6032464">zipr</span><span class="op" id="6032468">,</span>&nbsp;<span class="ident" id="6032470">f</span><span class="op" id="6032471">.</span><span class="ident" id="6032472">headerOffset</span><span class="op" id="6032484">+</span><span class="ident" id="6032485">bodyOffset</span><span class="op" id="6032495">+</span><span class="ident" id="6032496">size</span><span class="op" id="6032500">,</span>&nbsp;<span class="ident" id="6032502">dataDescriptorLen</span><span class="op" id="6032519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6032522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6032525">rc</span>&nbsp;<span class="op" id="6032528">=</span>&nbsp;<span class="op" id="6032530">&amp;</span><span class="ident" id="6032531">checksumReader</span><span class="op" id="6032545">{</span><span class="ident" id="6032546">rc</span><span class="op" id="6032548">,</span>&nbsp;<span class="ident" id="6032550">crc32</span><span class="op" id="6032555">.</span><span class="ident" id="6032556">NewIEEE</span><span class="op" id="6032563">(</span><span class="op" id="6032564">)</span><span class="op" id="6032565">,</span>&nbsp;<span class="ident" id="6032567">f</span><span class="op" id="6032568">,</span>&nbsp;<span class="ident" id="6032570">desr</span><span class="op" id="6032574">,</span>&nbsp;<span class="builtintype" id="6032576">nil</span><span class="op" id="6032579">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6032582">return</span><br>
<span class="lineno"></span><span class="op" id="6032589">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6032592">type</span>&nbsp;<span class="ident" id="6032597">checksumReader</span>&nbsp;<span class="keyword" id="6032612">struct</span>&nbsp;<span class="op" id="6032619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6032622">rc</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6032627">io</span><span class="op" id="6032629">.</span><span class="ident" id="6032630">ReadCloser</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6032642">hash</span>&nbsp;<span class="ident" id="6032647">hash</span><span class="op" id="6032651">.</span><span class="ident" id="6032652">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6032660">f</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6032665">*</span><span class="ident" id="6032666">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6032672">desr</span>&nbsp;<span class="ident" id="6032677">io</span><span class="op" id="6032679">.</span><span class="ident" id="6032680">Reader</span>&nbsp;<span class="comment" id="6032687">//&nbsp;if&nbsp;non-nil,&nbsp;where&nbsp;to&nbsp;read&nbsp;the&nbsp;data&nbsp;descriptor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6032737">err</span>&nbsp;&nbsp;<span class="builtintype" id="6032742">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6032752">//&nbsp;sticky&nbsp;error</span><br>
<span class="lineno"></span><span class="op" id="6032768">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="keyword" id="6032771">func</span>&nbsp;<span class="op" id="6032776">(</span><span class="ident" id="6032777">r</span>&nbsp;<span class="op" id="6032779">*</span><span class="ident" id="6032780">checksumReader</span><span class="op" id="6032794">)</span>&nbsp;<span class="ident" id="6032796">Read</span><span class="op" id="6032800">(</span><span class="ident" id="6032801">b</span>&nbsp;<span class="op" id="6032803">[</span><span class="op" id="6032804">]</span><span class="builtintype" id="6032805">byte</span><span class="op" id="6032809">)</span>&nbsp;<span class="op" id="6032811">(</span><span class="ident" id="6032812">n</span>&nbsp;<span class="builtintype" id="6032814">int</span><span class="op" id="6032817">,</span>&nbsp;<span class="ident" id="6032819">err</span>&nbsp;<span class="builtintype" id="6032823">error</span><span class="op" id="6032828">)</span>&nbsp;<span class="op" id="6032830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6032833">if</span>&nbsp;<span class="ident" id="6032836">r</span><span class="op" id="6032837">.</span><span class="ident" id="6032838">err</span>&nbsp;<span class="op" id="6032842">!=</span>&nbsp;<span class="builtintype" id="6032845">nil</span>&nbsp;<span class="op" id="6032849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6032853">return</span>&nbsp;<span class="num" id="6032860">0</span><span class="op" id="6032861">,</span>&nbsp;<span class="ident" id="6032863">r</span><span class="op" id="6032864">.</span><span class="ident" id="6032865">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6032870">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6032873">n</span><span class="op" id="6032874">,</span>&nbsp;<span class="ident" id="6032876">err</span>&nbsp;<span class="op" id="6032880">=</span>&nbsp;<span class="ident" id="6032882">r</span><span class="op" id="6032883">.</span><span class="ident" id="6032884">rc</span><span class="op" id="6032886">.</span><span class="ident" id="6032887">Read</span><span class="op" id="6032891">(</span><span class="ident" id="6032892">b</span><span class="op" id="6032893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6032896">r</span><span class="op" id="6032897">.</span><span class="ident" id="6032898">hash</span><span class="op" id="6032902">.</span><span class="ident" id="6032903">Write</span><span class="op" id="6032908">(</span><span class="ident" id="6032909">b</span><span class="op" id="6032910">[</span><span class="op" id="6032911">:</span><span class="ident" id="6032912">n</span><span class="op" id="6032913">]</span><span class="op" id="6032914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6032917">if</span>&nbsp;<span class="ident" id="6032920">err</span>&nbsp;<span class="op" id="6032924">==</span>&nbsp;<span class="builtintype" id="6032927">nil</span>&nbsp;<span class="op" id="6032931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6032935">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6032943">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6032946">if</span>&nbsp;<span class="ident" id="6032949">err</span>&nbsp;<span class="op" id="6032953">==</span>&nbsp;<span class="ident" id="6032956">io</span><span class="op" id="6032958">.</span><span class="ident" id="6032959">EOF</span>&nbsp;<span class="op" id="6032963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6032967">if</span>&nbsp;<span class="ident" id="6032970">r</span><span class="op" id="6032971">.</span><span class="ident" id="6032972">desr</span>&nbsp;<span class="op" id="6032977">!=</span>&nbsp;<span class="builtintype" id="6032980">nil</span>&nbsp;<span class="op" id="6032984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6032989">if</span>&nbsp;<span class="ident" id="6032992">err1</span>&nbsp;<span class="op" id="6032997">:=</span>&nbsp;<span class="ident" id="6033000">readDataDescriptor</span><span class="op" id="6033018">(</span><span class="ident" id="6033019">r</span><span class="op" id="6033020">.</span><span class="ident" id="6033021">desr</span><span class="op" id="6033025">,</span>&nbsp;<span class="ident" id="6033027">r</span><span class="op" id="6033028">.</span><span class="ident" id="6033029">f</span><span class="op" id="6033030">)</span><span class="op" id="6033031">;</span>&nbsp;<span class="ident" id="6033033">err1</span>&nbsp;<span class="op" id="6033038">!=</span>&nbsp;<span class="builtintype" id="6033041">nil</span>&nbsp;<span class="op" id="6033045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6033051">err</span>&nbsp;<span class="op" id="6033055">=</span>&nbsp;<span class="ident" id="6033057">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6033065">}</span>&nbsp;<span class="keyword" id="6033067">else</span>&nbsp;<span class="keyword" id="6033072">if</span>&nbsp;<span class="ident" id="6033075">r</span><span class="op" id="6033076">.</span><span class="ident" id="6033077">hash</span><span class="op" id="6033081">.</span><span class="ident" id="6033082">Sum32</span><span class="op" id="6033087">(</span><span class="op" id="6033088">)</span>&nbsp;<span class="op" id="6033090">!=</span>&nbsp;<span class="ident" id="6033093">r</span><span class="op" id="6033094">.</span><span class="ident" id="6033095">f</span><span class="op" id="6033096">.</span><span class="ident" id="6033097">CRC32</span>&nbsp;<span class="op" id="6033103">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6033109">err</span>&nbsp;<span class="op" id="6033113">=</span>&nbsp;<span class="ident" id="6033115">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6033130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6033134">}</span>&nbsp;<span class="keyword" id="6033136">else</span>&nbsp;<span class="op" id="6033141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6033146">//&nbsp;If&nbsp;there&#39;s&nbsp;not&nbsp;a&nbsp;data&nbsp;descriptor,&nbsp;we&nbsp;still&nbsp;compare</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6033203">//&nbsp;the&nbsp;CRC32&nbsp;of&nbsp;what&nbsp;we&#39;ve&nbsp;read&nbsp;against&nbsp;the&nbsp;file&nbsp;header</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6033262">//&nbsp;or&nbsp;TOC&#39;s&nbsp;CRC32,&nbsp;if&nbsp;it&nbsp;seems&nbsp;like&nbsp;it&nbsp;was&nbsp;set.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6033313">if</span>&nbsp;<span class="ident" id="6033316">r</span><span class="op" id="6033317">.</span><span class="ident" id="6033318">f</span><span class="op" id="6033319">.</span><span class="ident" id="6033320">CRC32</span>&nbsp;<span class="op" id="6033326">!=</span>&nbsp;<span class="num" id="6033329">0</span>&nbsp;<span class="op" id="6033331">&amp;&amp;</span>&nbsp;<span class="ident" id="6033334">r</span><span class="op" id="6033335">.</span><span class="ident" id="6033336">hash</span><span class="op" id="6033340">.</span><span class="ident" id="6033341">Sum32</span><span class="op" id="6033346">(</span><span class="op" id="6033347">)</span>&nbsp;<span class="op" id="6033349">!=</span>&nbsp;<span class="ident" id="6033352">r</span><span class="op" id="6033353">.</span><span class="ident" id="6033354">f</span><span class="op" id="6033355">.</span><span class="ident" id="6033356">CRC32</span>&nbsp;<span class="op" id="6033362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6033368">err</span>&nbsp;<span class="op" id="6033372">=</span>&nbsp;<span class="ident" id="6033374">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6033389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6033393">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6033396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6033399">r</span><span class="op" id="6033400">.</span><span class="ident" id="6033401">err</span>&nbsp;<span class="op" id="6033405">=</span>&nbsp;<span class="ident" id="6033407">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6033412">return</span><br>
<span class="lineno"></span><span class="op" id="6033419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="6033422">func</span>&nbsp;<span class="op" id="6033427">(</span><span class="ident" id="6033428">r</span>&nbsp;<span class="op" id="6033430">*</span><span class="ident" id="6033431">checksumReader</span><span class="op" id="6033445">)</span>&nbsp;<span class="ident" id="6033447">Close</span><span class="op" id="6033452">(</span><span class="op" id="6033453">)</span>&nbsp;<span class="builtintype" id="6033455">error</span>&nbsp;<span class="op" id="6033461">{</span>&nbsp;<span class="keyword" id="6033463">return</span>&nbsp;<span class="ident" id="6033470">r</span><span class="op" id="6033471">.</span><span class="ident" id="6033472">rc</span><span class="op" id="6033474">.</span><span class="ident" id="6033475">Close</span><span class="op" id="6033480">(</span><span class="op" id="6033481">)</span>&nbsp;<span class="op" id="6033483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6033486">//&nbsp;findBodyOffset&nbsp;does&nbsp;the&nbsp;minimum&nbsp;work&nbsp;to&nbsp;verify&nbsp;the&nbsp;file&nbsp;has&nbsp;a&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="6033558">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;file&nbsp;body&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="6033595">func</span>&nbsp;<span class="op" id="6033600">(</span><span class="ident" id="6033601">f</span>&nbsp;<span class="op" id="6033603">*</span><span class="ident" id="6033604">File</span><span class="op" id="6033608">)</span>&nbsp;<span class="ident" id="6033610">findBodyOffset</span><span class="op" id="6033624">(</span><span class="op" id="6033625">)</span>&nbsp;<span class="op" id="6033627">(</span><span class="ident" id="6033628">int64</span><span class="op" id="6033633">,</span>&nbsp;<span class="builtintype" id="6033635">error</span><span class="op" id="6033640">)</span>&nbsp;<span class="op" id="6033642">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6033645">var</span>&nbsp;<span class="ident" id="6033649">buf</span>&nbsp;<span class="op" id="6033653">[</span><span class="ident" id="6033654">fileHeaderLen</span><span class="op" id="6033667">]</span><span class="builtintype" id="6033668">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6033674">if</span>&nbsp;<span class="ident" id="6033677">_</span><span class="op" id="6033678">,</span>&nbsp;<span class="ident" id="6033680">err</span>&nbsp;<span class="op" id="6033684">:=</span>&nbsp;<span class="ident" id="6033687">f</span><span class="op" id="6033688">.</span><span class="ident" id="6033689">zipr</span><span class="op" id="6033693">.</span><span class="ident" id="6033694">ReadAt</span><span class="op" id="6033700">(</span><span class="ident" id="6033701">buf</span><span class="op" id="6033704">[</span><span class="op" id="6033705">:</span><span class="op" id="6033706">]</span><span class="op" id="6033707">,</span>&nbsp;<span class="ident" id="6033709">f</span><span class="op" id="6033710">.</span><span class="ident" id="6033711">headerOffset</span><span class="op" id="6033723">)</span><span class="op" id="6033724">;</span>&nbsp;<span class="ident" id="6033726">err</span>&nbsp;<span class="op" id="6033730">!=</span>&nbsp;<span class="builtintype" id="6033733">nil</span>&nbsp;<span class="op" id="6033737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6033741">return</span>&nbsp;<span class="num" id="6033748">0</span><span class="op" id="6033749">,</span>&nbsp;<span class="ident" id="6033751">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6033756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6033759">b</span>&nbsp;<span class="op" id="6033761">:=</span>&nbsp;<span class="ident" id="6033764">readBuf</span><span class="op" id="6033771">(</span><span class="ident" id="6033772">buf</span><span class="op" id="6033775">[</span><span class="op" id="6033776">:</span><span class="op" id="6033777">]</span><span class="op" id="6033778">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6033781">if</span>&nbsp;<span class="ident" id="6033784">sig</span>&nbsp;<span class="op" id="6033788">:=</span>&nbsp;<span class="ident" id="6033791">b</span><span class="op" id="6033792">.</span><span class="builtintype" id="6033793">uint32</span><span class="op" id="6033799">(</span><span class="op" id="6033800">)</span><span class="op" id="6033801">;</span>&nbsp;<span class="ident" id="6033803">sig</span>&nbsp;<span class="op" id="6033807">!=</span>&nbsp;<span class="ident" id="6033810">fileHeaderSignature</span>&nbsp;<span class="op" id="6033830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6033834">return</span>&nbsp;<span class="num" id="6033841">0</span><span class="op" id="6033842">,</span>&nbsp;<span class="ident" id="6033844">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6033855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6033858">b</span>&nbsp;<span class="op" id="6033860">=</span>&nbsp;<span class="ident" id="6033862">b</span><span class="op" id="6033863">[</span><span class="num" id="6033864">22</span><span class="op" id="6033866">:</span><span class="op" id="6033867">]</span>&nbsp;<span class="comment" id="6033869">//&nbsp;skip&nbsp;over&nbsp;most&nbsp;of&nbsp;the&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6033902">filenameLen</span>&nbsp;<span class="op" id="6033914">:=</span>&nbsp;<span class="builtintype" id="6033917">int</span><span class="op" id="6033920">(</span><span class="ident" id="6033921">b</span><span class="op" id="6033922">.</span><span class="builtintype" id="6033923">uint16</span><span class="op" id="6033929">(</span><span class="op" id="6033930">)</span><span class="op" id="6033931">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6033934">extraLen</span>&nbsp;<span class="op" id="6033943">:=</span>&nbsp;<span class="builtintype" id="6033946">int</span><span class="op" id="6033949">(</span><span class="ident" id="6033950">b</span><span class="op" id="6033951">.</span><span class="builtintype" id="6033952">uint16</span><span class="op" id="6033958">(</span><span class="op" id="6033959">)</span><span class="op" id="6033960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6033963">return</span>&nbsp;<span class="ident" id="6033970">int64</span><span class="op" id="6033975">(</span><span class="ident" id="6033976">fileHeaderLen</span>&nbsp;<span class="op" id="6033990">+</span>&nbsp;<span class="ident" id="6033992">filenameLen</span>&nbsp;<span class="op" id="6034004">+</span>&nbsp;<span class="ident" id="6034006">extraLen</span><span class="op" id="6034014">)</span><span class="op" id="6034015">,</span>&nbsp;<span class="builtintype" id="6034017">nil</span><br>
<span class="lineno"></span><span class="op" id="6034021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6034024">//&nbsp;readDirectoryHeader&nbsp;attempts&nbsp;to&nbsp;read&nbsp;a&nbsp;directory&nbsp;header&nbsp;from&nbsp;r.</span><br>
<span class="lineno">210</span><span class="comment" id="6034091">//&nbsp;It&nbsp;returns&nbsp;io.ErrUnexpectedEOF&nbsp;if&nbsp;it&nbsp;cannot&nbsp;read&nbsp;a&nbsp;complete&nbsp;header,</span><br>
<span class="lineno"></span><span class="comment" id="6034162">//&nbsp;and&nbsp;ErrFormat&nbsp;if&nbsp;it&nbsp;doesn&#39;t&nbsp;find&nbsp;a&nbsp;valid&nbsp;header&nbsp;signature.</span><br>
<span class="lineno"></span><span class="keyword" id="6034224">func</span>&nbsp;<span class="ident" id="6034229">readDirectoryHeader</span><span class="op" id="6034248">(</span><span class="ident" id="6034249">f</span>&nbsp;<span class="op" id="6034251">*</span><span class="ident" id="6034252">File</span><span class="op" id="6034256">,</span>&nbsp;<span class="ident" id="6034258">r</span>&nbsp;<span class="ident" id="6034260">io</span><span class="op" id="6034262">.</span><span class="ident" id="6034263">Reader</span><span class="op" id="6034269">)</span>&nbsp;<span class="builtintype" id="6034271">error</span>&nbsp;<span class="op" id="6034277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6034280">var</span>&nbsp;<span class="ident" id="6034284">buf</span>&nbsp;<span class="op" id="6034288">[</span><span class="ident" id="6034289">directoryHeaderLen</span><span class="op" id="6034307">]</span><span class="builtintype" id="6034308">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6034314">if</span>&nbsp;<span class="ident" id="6034317">_</span><span class="op" id="6034318">,</span>&nbsp;<span class="ident" id="6034320">err</span>&nbsp;<span class="op" id="6034324">:=</span>&nbsp;<span class="ident" id="6034327">io</span><span class="op" id="6034329">.</span><span class="ident" id="6034330">ReadFull</span><span class="op" id="6034338">(</span><span class="ident" id="6034339">r</span><span class="op" id="6034340">,</span>&nbsp;<span class="ident" id="6034342">buf</span><span class="op" id="6034345">[</span><span class="op" id="6034346">:</span><span class="op" id="6034347">]</span><span class="op" id="6034348">)</span><span class="op" id="6034349">;</span>&nbsp;<span class="ident" id="6034351">err</span>&nbsp;<span class="op" id="6034355">!=</span>&nbsp;<span class="builtintype" id="6034358">nil</span>&nbsp;<span class="op" id="6034362">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6034366">return</span>&nbsp;<span class="ident" id="6034373">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6034378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6034381">b</span>&nbsp;<span class="op" id="6034383">:=</span>&nbsp;<span class="ident" id="6034386">readBuf</span><span class="op" id="6034393">(</span><span class="ident" id="6034394">buf</span><span class="op" id="6034397">[</span><span class="op" id="6034398">:</span><span class="op" id="6034399">]</span><span class="op" id="6034400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6034403">if</span>&nbsp;<span class="ident" id="6034406">sig</span>&nbsp;<span class="op" id="6034410">:=</span>&nbsp;<span class="ident" id="6034413">b</span><span class="op" id="6034414">.</span><span class="builtintype" id="6034415">uint32</span><span class="op" id="6034421">(</span><span class="op" id="6034422">)</span><span class="op" id="6034423">;</span>&nbsp;<span class="ident" id="6034425">sig</span>&nbsp;<span class="op" id="6034429">!=</span>&nbsp;<span class="ident" id="6034432">directoryHeaderSignature</span>&nbsp;<span class="op" id="6034457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6034461">return</span>&nbsp;<span class="ident" id="6034468">ErrFormat</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6034479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6034482">f</span><span class="op" id="6034483">.</span><span class="ident" id="6034484">CreatorVersion</span>&nbsp;<span class="op" id="6034499">=</span>&nbsp;<span class="ident" id="6034501">b</span><span class="op" id="6034502">.</span><span class="builtintype" id="6034503">uint16</span><span class="op" id="6034509">(</span><span class="op" id="6034510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6034513">f</span><span class="op" id="6034514">.</span><span class="ident" id="6034515">ReaderVersion</span>&nbsp;<span class="op" id="6034529">=</span>&nbsp;<span class="ident" id="6034531">b</span><span class="op" id="6034532">.</span><span class="builtintype" id="6034533">uint16</span><span class="op" id="6034539">(</span><span class="op" id="6034540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6034543">f</span><span class="op" id="6034544">.</span><span class="ident" id="6034545">Flags</span>&nbsp;<span class="op" id="6034551">=</span>&nbsp;<span class="ident" id="6034553">b</span><span class="op" id="6034554">.</span><span class="builtintype" id="6034555">uint16</span><span class="op" id="6034561">(</span><span class="op" id="6034562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6034565">f</span><span class="op" id="6034566">.</span><span class="ident" id="6034567">Method</span>&nbsp;<span class="op" id="6034574">=</span>&nbsp;<span class="ident" id="6034576">b</span><span class="op" id="6034577">.</span><span class="builtintype" id="6034578">uint16</span><span class="op" id="6034584">(</span><span class="op" id="6034585">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6034588">f</span><span class="op" id="6034589">.</span><span class="ident" id="6034590">ModifiedTime</span>&nbsp;<span class="op" id="6034603">=</span>&nbsp;<span class="ident" id="6034605">b</span><span class="op" id="6034606">.</span><span class="builtintype" id="6034607">uint16</span><span class="op" id="6034613">(</span><span class="op" id="6034614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6034617">f</span><span class="op" id="6034618">.</span><span class="ident" id="6034619">ModifiedDate</span>&nbsp;<span class="op" id="6034632">=</span>&nbsp;<span class="ident" id="6034634">b</span><span class="op" id="6034635">.</span><span class="builtintype" id="6034636">uint16</span><span class="op" id="6034642">(</span><span class="op" id="6034643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6034646">f</span><span class="op" id="6034647">.</span><span class="ident" id="6034648">CRC32</span>&nbsp;<span class="op" id="6034654">=</span>&nbsp;<span class="ident" id="6034656">b</span><span class="op" id="6034657">.</span><span class="builtintype" id="6034658">uint32</span><span class="op" id="6034664">(</span><span class="op" id="6034665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6034668">f</span><span class="op" id="6034669">.</span><span class="ident" id="6034670">CompressedSize</span>&nbsp;<span class="op" id="6034685">=</span>&nbsp;<span class="ident" id="6034687">b</span><span class="op" id="6034688">.</span><span class="builtintype" id="6034689">uint32</span><span class="op" id="6034695">(</span><span class="op" id="6034696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6034699">f</span><span class="op" id="6034700">.</span><span class="ident" id="6034701">UncompressedSize</span>&nbsp;<span class="op" id="6034718">=</span>&nbsp;<span class="ident" id="6034720">b</span><span class="op" id="6034721">.</span><span class="builtintype" id="6034722">uint32</span><span class="op" id="6034728">(</span><span class="op" id="6034729">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6034732">f</span><span class="op" id="6034733">.</span><span class="ident" id="6034734">CompressedSize64</span>&nbsp;<span class="op" id="6034751">=</span>&nbsp;<span class="ident" id="6034753">uint64</span><span class="op" id="6034759">(</span><span class="ident" id="6034760">f</span><span class="op" id="6034761">.</span><span class="ident" id="6034762">CompressedSize</span><span class="op" id="6034776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6034779">f</span><span class="op" id="6034780">.</span><span class="ident" id="6034781">UncompressedSize64</span>&nbsp;<span class="op" id="6034800">=</span>&nbsp;<span class="ident" id="6034802">uint64</span><span class="op" id="6034808">(</span><span class="ident" id="6034809">f</span><span class="op" id="6034810">.</span><span class="ident" id="6034811">UncompressedSize</span><span class="op" id="6034827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6034830">filenameLen</span>&nbsp;<span class="op" id="6034842">:=</span>&nbsp;<span class="builtintype" id="6034845">int</span><span class="op" id="6034848">(</span><span class="ident" id="6034849">b</span><span class="op" id="6034850">.</span><span class="builtintype" id="6034851">uint16</span><span class="op" id="6034857">(</span><span class="op" id="6034858">)</span><span class="op" id="6034859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6034862">extraLen</span>&nbsp;<span class="op" id="6034871">:=</span>&nbsp;<span class="builtintype" id="6034874">int</span><span class="op" id="6034877">(</span><span class="ident" id="6034878">b</span><span class="op" id="6034879">.</span><span class="builtintype" id="6034880">uint16</span><span class="op" id="6034886">(</span><span class="op" id="6034887">)</span><span class="op" id="6034888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6034891">commentLen</span>&nbsp;<span class="op" id="6034902">:=</span>&nbsp;<span class="builtintype" id="6034905">int</span><span class="op" id="6034908">(</span><span class="ident" id="6034909">b</span><span class="op" id="6034910">.</span><span class="builtintype" id="6034911">uint16</span><span class="op" id="6034917">(</span><span class="op" id="6034918">)</span><span class="op" id="6034919">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6034922">b</span>&nbsp;<span class="op" id="6034924">=</span>&nbsp;<span class="ident" id="6034926">b</span><span class="op" id="6034927">[</span><span class="num" id="6034928">4</span><span class="op" id="6034929">:</span><span class="op" id="6034930">]</span>&nbsp;<span class="comment" id="6034932">//&nbsp;skipped&nbsp;start&nbsp;disk&nbsp;number&nbsp;and&nbsp;internal&nbsp;attributes&nbsp;(2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6034998">f</span><span class="op" id="6034999">.</span><span class="ident" id="6035000">ExternalAttrs</span>&nbsp;<span class="op" id="6035014">=</span>&nbsp;<span class="ident" id="6035016">b</span><span class="op" id="6035017">.</span><span class="builtintype" id="6035018">uint32</span><span class="op" id="6035024">(</span><span class="op" id="6035025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6035028">f</span><span class="op" id="6035029">.</span><span class="ident" id="6035030">headerOffset</span>&nbsp;<span class="op" id="6035043">=</span>&nbsp;<span class="ident" id="6035045">int64</span><span class="op" id="6035050">(</span><span class="ident" id="6035051">b</span><span class="op" id="6035052">.</span><span class="builtintype" id="6035053">uint32</span><span class="op" id="6035059">(</span><span class="op" id="6035060">)</span><span class="op" id="6035061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6035064">d</span>&nbsp;<span class="op" id="6035066">:=</span>&nbsp;<span class="builtinfunc" id="6035069">make</span><span class="op" id="6035073">(</span><span class="op" id="6035074">[</span><span class="op" id="6035075">]</span><span class="builtintype" id="6035076">byte</span><span class="op" id="6035080">,</span>&nbsp;<span class="ident" id="6035082">filenameLen</span><span class="op" id="6035093">+</span><span class="ident" id="6035094">extraLen</span><span class="op" id="6035102">+</span><span class="ident" id="6035103">commentLen</span><span class="op" id="6035113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6035116">if</span>&nbsp;<span class="ident" id="6035119">_</span><span class="op" id="6035120">,</span>&nbsp;<span class="ident" id="6035122">err</span>&nbsp;<span class="op" id="6035126">:=</span>&nbsp;<span class="ident" id="6035129">io</span><span class="op" id="6035131">.</span><span class="ident" id="6035132">ReadFull</span><span class="op" id="6035140">(</span><span class="ident" id="6035141">r</span><span class="op" id="6035142">,</span>&nbsp;<span class="ident" id="6035144">d</span><span class="op" id="6035145">)</span><span class="op" id="6035146">;</span>&nbsp;<span class="ident" id="6035148">err</span>&nbsp;<span class="op" id="6035152">!=</span>&nbsp;<span class="builtintype" id="6035155">nil</span>&nbsp;<span class="op" id="6035159">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6035163">return</span>&nbsp;<span class="ident" id="6035170">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6035175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6035178">f</span><span class="op" id="6035179">.</span><span class="ident" id="6035180">Name</span>&nbsp;<span class="op" id="6035185">=</span>&nbsp;<span class="builtintype" id="6035187">string</span><span class="op" id="6035193">(</span><span class="ident" id="6035194">d</span><span class="op" id="6035195">[</span><span class="op" id="6035196">:</span><span class="ident" id="6035197">filenameLen</span><span class="op" id="6035208">]</span><span class="op" id="6035209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6035212">f</span><span class="op" id="6035213">.</span><span class="ident" id="6035214">Extra</span>&nbsp;<span class="op" id="6035220">=</span>&nbsp;<span class="ident" id="6035222">d</span><span class="op" id="6035223">[</span><span class="ident" id="6035224">filenameLen</span>&nbsp;<span class="op" id="6035236">:</span>&nbsp;<span class="ident" id="6035238">filenameLen</span><span class="op" id="6035249">+</span><span class="ident" id="6035250">extraLen</span><span class="op" id="6035258">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6035261">f</span><span class="op" id="6035262">.</span><span class="ident" id="6035263">Comment</span>&nbsp;<span class="op" id="6035271">=</span>&nbsp;<span class="builtintype" id="6035273">string</span><span class="op" id="6035279">(</span><span class="ident" id="6035280">d</span><span class="op" id="6035281">[</span><span class="ident" id="6035282">filenameLen</span><span class="op" id="6035293">+</span><span class="ident" id="6035294">extraLen</span><span class="op" id="6035302">:</span><span class="op" id="6035303">]</span><span class="op" id="6035304">)</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6035308">if</span>&nbsp;<span class="builtinfunc" id="6035311">len</span><span class="op" id="6035314">(</span><span class="ident" id="6035315">f</span><span class="op" id="6035316">.</span><span class="ident" id="6035317">Extra</span><span class="op" id="6035322">)</span>&nbsp;<span class="op" id="6035324">&gt;</span>&nbsp;<span class="num" id="6035326">0</span>&nbsp;<span class="op" id="6035328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6035332">b</span>&nbsp;<span class="op" id="6035334">:=</span>&nbsp;<span class="ident" id="6035337">readBuf</span><span class="op" id="6035344">(</span><span class="ident" id="6035345">f</span><span class="op" id="6035346">.</span><span class="ident" id="6035347">Extra</span><span class="op" id="6035352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6035356">for</span>&nbsp;<span class="builtinfunc" id="6035360">len</span><span class="op" id="6035363">(</span><span class="ident" id="6035364">b</span><span class="op" id="6035365">)</span>&nbsp;<span class="op" id="6035367">&gt;=</span>&nbsp;<span class="num" id="6035370">4</span>&nbsp;<span class="op" id="6035372">{</span>&nbsp;<span class="comment" id="6035374">//&nbsp;need&nbsp;at&nbsp;least&nbsp;tag&nbsp;and&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6035407">tag</span>&nbsp;<span class="op" id="6035411">:=</span>&nbsp;<span class="ident" id="6035414">b</span><span class="op" id="6035415">.</span><span class="builtintype" id="6035416">uint16</span><span class="op" id="6035422">(</span><span class="op" id="6035423">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6035428">size</span>&nbsp;<span class="op" id="6035433">:=</span>&nbsp;<span class="ident" id="6035436">b</span><span class="op" id="6035437">.</span><span class="builtintype" id="6035438">uint16</span><span class="op" id="6035444">(</span><span class="op" id="6035445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6035450">if</span>&nbsp;<span class="builtintype" id="6035453">int</span><span class="op" id="6035456">(</span><span class="ident" id="6035457">size</span><span class="op" id="6035461">)</span>&nbsp;<span class="op" id="6035463">&gt;</span>&nbsp;<span class="builtinfunc" id="6035465">len</span><span class="op" id="6035468">(</span><span class="ident" id="6035469">b</span><span class="op" id="6035470">)</span>&nbsp;<span class="op" id="6035472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6035478">return</span>&nbsp;<span class="ident" id="6035485">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6035498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6035503">if</span>&nbsp;<span class="ident" id="6035506">tag</span>&nbsp;<span class="op" id="6035510">==</span>&nbsp;<span class="ident" id="6035513">zip64ExtraId</span>&nbsp;<span class="op" id="6035526">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6035532">//&nbsp;update&nbsp;directory&nbsp;values&nbsp;from&nbsp;the&nbsp;zip64&nbsp;extra&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6035590">eb</span>&nbsp;<span class="op" id="6035593">:=</span>&nbsp;<span class="ident" id="6035596">readBuf</span><span class="op" id="6035603">(</span><span class="ident" id="6035604">b</span><span class="op" id="6035605">[</span><span class="op" id="6035606">:</span><span class="ident" id="6035607">size</span><span class="op" id="6035611">]</span><span class="op" id="6035612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6035618">if</span>&nbsp;<span class="builtinfunc" id="6035621">len</span><span class="op" id="6035624">(</span><span class="ident" id="6035625">eb</span><span class="op" id="6035627">)</span>&nbsp;<span class="op" id="6035629">&gt;=</span>&nbsp;<span class="num" id="6035632">8</span>&nbsp;<span class="op" id="6035634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6035641">f</span><span class="op" id="6035642">.</span><span class="ident" id="6035643">UncompressedSize64</span>&nbsp;<span class="op" id="6035662">=</span>&nbsp;<span class="ident" id="6035664">eb</span><span class="op" id="6035666">.</span><span class="ident" id="6035667">uint64</span><span class="op" id="6035673">(</span><span class="op" id="6035674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6035680">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6035686">if</span>&nbsp;<span class="builtinfunc" id="6035689">len</span><span class="op" id="6035692">(</span><span class="ident" id="6035693">eb</span><span class="op" id="6035695">)</span>&nbsp;<span class="op" id="6035697">&gt;=</span>&nbsp;<span class="num" id="6035700">8</span>&nbsp;<span class="op" id="6035702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6035709">f</span><span class="op" id="6035710">.</span><span class="ident" id="6035711">CompressedSize64</span>&nbsp;<span class="op" id="6035728">=</span>&nbsp;<span class="ident" id="6035730">eb</span><span class="op" id="6035732">.</span><span class="ident" id="6035733">uint64</span><span class="op" id="6035739">(</span><span class="op" id="6035740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6035746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6035752">if</span>&nbsp;<span class="builtinfunc" id="6035755">len</span><span class="op" id="6035758">(</span><span class="ident" id="6035759">eb</span><span class="op" id="6035761">)</span>&nbsp;<span class="op" id="6035763">&gt;=</span>&nbsp;<span class="num" id="6035766">8</span>&nbsp;<span class="op" id="6035768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6035775">f</span><span class="op" id="6035776">.</span><span class="ident" id="6035777">headerOffset</span>&nbsp;<span class="op" id="6035790">=</span>&nbsp;<span class="ident" id="6035792">int64</span><span class="op" id="6035797">(</span><span class="ident" id="6035798">eb</span><span class="op" id="6035800">.</span><span class="ident" id="6035801">uint64</span><span class="op" id="6035807">(</span><span class="op" id="6035808">)</span><span class="op" id="6035809">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6035815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6035820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6035825">b</span>&nbsp;<span class="op" id="6035827">=</span>&nbsp;<span class="ident" id="6035829">b</span><span class="op" id="6035830">[</span><span class="ident" id="6035831">size</span><span class="op" id="6035835">:</span><span class="op" id="6035836">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6035840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6035844">//&nbsp;Should&nbsp;have&nbsp;consumed&nbsp;the&nbsp;whole&nbsp;header.</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6035888">//&nbsp;But&nbsp;popular&nbsp;zip&nbsp;&amp;&nbsp;JAR&nbsp;creation&nbsp;tools&nbsp;are&nbsp;broken&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6035945">//&nbsp;may&nbsp;pad&nbsp;extra&nbsp;zeros&nbsp;at&nbsp;the&nbsp;end,&nbsp;so&nbsp;accept&nbsp;those</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6035998">//&nbsp;too.&nbsp;See&nbsp;golang.org/issue/8186.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6036035">for</span>&nbsp;<span class="ident" id="6036039">_</span><span class="op" id="6036040">,</span>&nbsp;<span class="ident" id="6036042">v</span>&nbsp;<span class="op" id="6036044">:=</span>&nbsp;<span class="keyword" id="6036047">range</span>&nbsp;<span class="ident" id="6036053">b</span>&nbsp;<span class="op" id="6036055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6036060">if</span>&nbsp;<span class="ident" id="6036063">v</span>&nbsp;<span class="op" id="6036065">!=</span>&nbsp;<span class="num" id="6036068">0</span>&nbsp;<span class="op" id="6036070">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6036076">return</span>&nbsp;<span class="ident" id="6036083">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6036096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6036100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6036103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6036106">return</span>&nbsp;<span class="builtintype" id="6036113">nil</span><br>
<span class="lineno">280</span><span class="op" id="6036117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6036120">func</span>&nbsp;<span class="ident" id="6036125">readDataDescriptor</span><span class="op" id="6036143">(</span><span class="ident" id="6036144">r</span>&nbsp;<span class="ident" id="6036146">io</span><span class="op" id="6036148">.</span><span class="ident" id="6036149">Reader</span><span class="op" id="6036155">,</span>&nbsp;<span class="ident" id="6036157">f</span>&nbsp;<span class="op" id="6036159">*</span><span class="ident" id="6036160">File</span><span class="op" id="6036164">)</span>&nbsp;<span class="builtintype" id="6036166">error</span>&nbsp;<span class="op" id="6036172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6036175">var</span>&nbsp;<span class="ident" id="6036179">buf</span>&nbsp;<span class="op" id="6036183">[</span><span class="ident" id="6036184">dataDescriptorLen</span><span class="op" id="6036201">]</span><span class="builtintype" id="6036202">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6036209">//&nbsp;The&nbsp;spec&nbsp;says:&nbsp;&#34;Although&nbsp;not&nbsp;originally&nbsp;assigned&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6036264">//&nbsp;signature,&nbsp;the&nbsp;value&nbsp;0x08074b50&nbsp;has&nbsp;commonly&nbsp;been&nbsp;adopted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6036326">//&nbsp;as&nbsp;a&nbsp;signature&nbsp;value&nbsp;for&nbsp;the&nbsp;data&nbsp;descriptor&nbsp;record.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6036383">//&nbsp;Implementers&nbsp;should&nbsp;be&nbsp;aware&nbsp;that&nbsp;ZIP&nbsp;files&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6036438">//&nbsp;encountered&nbsp;with&nbsp;or&nbsp;without&nbsp;this&nbsp;signature&nbsp;marking&nbsp;data</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6036498">//&nbsp;descriptors&nbsp;and&nbsp;should&nbsp;account&nbsp;for&nbsp;either&nbsp;case&nbsp;when&nbsp;reading</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6036562">//&nbsp;ZIP&nbsp;files&nbsp;to&nbsp;ensure&nbsp;compatibility.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6036602">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6036606">//&nbsp;dataDescriptorLen&nbsp;includes&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;signature&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6036667">//&nbsp;first&nbsp;read&nbsp;just&nbsp;those&nbsp;4&nbsp;bytes&nbsp;to&nbsp;see&nbsp;if&nbsp;it&nbsp;exists.</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6036722">if</span>&nbsp;<span class="ident" id="6036725">_</span><span class="op" id="6036726">,</span>&nbsp;<span class="ident" id="6036728">err</span>&nbsp;<span class="op" id="6036732">:=</span>&nbsp;<span class="ident" id="6036735">io</span><span class="op" id="6036737">.</span><span class="ident" id="6036738">ReadFull</span><span class="op" id="6036746">(</span><span class="ident" id="6036747">r</span><span class="op" id="6036748">,</span>&nbsp;<span class="ident" id="6036750">buf</span><span class="op" id="6036753">[</span><span class="op" id="6036754">:</span><span class="num" id="6036755">4</span><span class="op" id="6036756">]</span><span class="op" id="6036757">)</span><span class="op" id="6036758">;</span>&nbsp;<span class="ident" id="6036760">err</span>&nbsp;<span class="op" id="6036764">!=</span>&nbsp;<span class="builtintype" id="6036767">nil</span>&nbsp;<span class="op" id="6036771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6036775">return</span>&nbsp;<span class="ident" id="6036782">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6036787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6036790">off</span>&nbsp;<span class="op" id="6036794">:=</span>&nbsp;<span class="num" id="6036797">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6036800">maybeSig</span>&nbsp;<span class="op" id="6036809">:=</span>&nbsp;<span class="ident" id="6036812">readBuf</span><span class="op" id="6036819">(</span><span class="ident" id="6036820">buf</span><span class="op" id="6036823">[</span><span class="op" id="6036824">:</span><span class="num" id="6036825">4</span><span class="op" id="6036826">]</span><span class="op" id="6036827">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6036830">if</span>&nbsp;<span class="ident" id="6036833">maybeSig</span><span class="op" id="6036841">.</span><span class="builtintype" id="6036842">uint32</span><span class="op" id="6036848">(</span><span class="op" id="6036849">)</span>&nbsp;<span class="op" id="6036851">!=</span>&nbsp;<span class="ident" id="6036854">dataDescriptorSignature</span>&nbsp;<span class="op" id="6036878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6036882">//&nbsp;No&nbsp;data&nbsp;descriptor&nbsp;signature.&nbsp;Keep&nbsp;these&nbsp;four</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6036933">//&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6036945">off</span>&nbsp;<span class="op" id="6036949">+=</span>&nbsp;<span class="num" id="6036952">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6036955">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6036958">if</span>&nbsp;<span class="ident" id="6036961">_</span><span class="op" id="6036962">,</span>&nbsp;<span class="ident" id="6036964">err</span>&nbsp;<span class="op" id="6036968">:=</span>&nbsp;<span class="ident" id="6036971">io</span><span class="op" id="6036973">.</span><span class="ident" id="6036974">ReadFull</span><span class="op" id="6036982">(</span><span class="ident" id="6036983">r</span><span class="op" id="6036984">,</span>&nbsp;<span class="ident" id="6036986">buf</span><span class="op" id="6036989">[</span><span class="ident" id="6036990">off</span><span class="op" id="6036993">:</span><span class="num" id="6036994">12</span><span class="op" id="6036996">]</span><span class="op" id="6036997">)</span><span class="op" id="6036998">;</span>&nbsp;<span class="ident" id="6037000">err</span>&nbsp;<span class="op" id="6037004">!=</span>&nbsp;<span class="builtintype" id="6037007">nil</span>&nbsp;<span class="op" id="6037011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6037015">return</span>&nbsp;<span class="ident" id="6037022">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6037027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6037030">b</span>&nbsp;<span class="op" id="6037032">:=</span>&nbsp;<span class="ident" id="6037035">readBuf</span><span class="op" id="6037042">(</span><span class="ident" id="6037043">buf</span><span class="op" id="6037046">[</span><span class="op" id="6037047">:</span><span class="num" id="6037048">12</span><span class="op" id="6037050">]</span><span class="op" id="6037051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6037054">if</span>&nbsp;<span class="ident" id="6037057">b</span><span class="op" id="6037058">.</span><span class="builtintype" id="6037059">uint32</span><span class="op" id="6037065">(</span><span class="op" id="6037066">)</span>&nbsp;<span class="op" id="6037068">!=</span>&nbsp;<span class="ident" id="6037071">f</span><span class="op" id="6037072">.</span><span class="ident" id="6037073">CRC32</span>&nbsp;<span class="op" id="6037079">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6037083">return</span>&nbsp;<span class="ident" id="6037090">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6037103">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6037107">//&nbsp;The&nbsp;two&nbsp;sizes&nbsp;that&nbsp;follow&nbsp;here&nbsp;can&nbsp;be&nbsp;either&nbsp;32&nbsp;bits&nbsp;or&nbsp;64&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6037175">//&nbsp;but&nbsp;the&nbsp;spec&nbsp;is&nbsp;not&nbsp;very&nbsp;clear&nbsp;on&nbsp;this&nbsp;and&nbsp;different</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6037232">//&nbsp;interpretations&nbsp;has&nbsp;been&nbsp;made&nbsp;causing&nbsp;incompatibilities.&nbsp;We</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6037296">//&nbsp;already&nbsp;have&nbsp;the&nbsp;sizes&nbsp;from&nbsp;the&nbsp;central&nbsp;directory&nbsp;so&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6037360">//&nbsp;just&nbsp;ignore&nbsp;these.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6037384">return</span>&nbsp;<span class="builtintype" id="6037391">nil</span><br>
<span class="lineno">320</span><span class="op" id="6037395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6037398">func</span>&nbsp;<span class="ident" id="6037403">readDirectoryEnd</span><span class="op" id="6037419">(</span><span class="ident" id="6037420">r</span>&nbsp;<span class="ident" id="6037422">io</span><span class="op" id="6037424">.</span><span class="ident" id="6037425">ReaderAt</span><span class="op" id="6037433">,</span>&nbsp;<span class="ident" id="6037435">size</span>&nbsp;<span class="ident" id="6037440">int64</span><span class="op" id="6037445">)</span>&nbsp;<span class="op" id="6037447">(</span><span class="ident" id="6037448">dir</span>&nbsp;<span class="op" id="6037452">*</span><span class="ident" id="6037453">directoryEnd</span><span class="op" id="6037465">,</span>&nbsp;<span class="ident" id="6037467">err</span>&nbsp;<span class="builtintype" id="6037471">error</span><span class="op" id="6037476">)</span>&nbsp;<span class="op" id="6037478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6037481">//&nbsp;look&nbsp;for&nbsp;directoryEndSignature&nbsp;in&nbsp;the&nbsp;last&nbsp;1k,&nbsp;then&nbsp;in&nbsp;the&nbsp;last&nbsp;65k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6037553">var</span>&nbsp;<span class="ident" id="6037557">buf</span>&nbsp;<span class="op" id="6037561">[</span><span class="op" id="6037562">]</span><span class="builtintype" id="6037563">byte</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6037569">var</span>&nbsp;<span class="ident" id="6037573">directoryEndOffset</span>&nbsp;<span class="ident" id="6037592">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6037599">for</span>&nbsp;<span class="ident" id="6037603">i</span><span class="op" id="6037604">,</span>&nbsp;<span class="ident" id="6037606">bLen</span>&nbsp;<span class="op" id="6037611">:=</span>&nbsp;<span class="keyword" id="6037614">range</span>&nbsp;<span class="op" id="6037620">[</span><span class="op" id="6037621">]</span><span class="ident" id="6037622">int64</span><span class="op" id="6037627">{</span><span class="num" id="6037628">1024</span><span class="op" id="6037632">,</span>&nbsp;<span class="num" id="6037634">65</span>&nbsp;<span class="op" id="6037637">*</span>&nbsp;<span class="num" id="6037639">1024</span><span class="op" id="6037643">}</span>&nbsp;<span class="op" id="6037645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6037649">if</span>&nbsp;<span class="ident" id="6037652">bLen</span>&nbsp;<span class="op" id="6037657">&gt;</span>&nbsp;<span class="ident" id="6037659">size</span>&nbsp;<span class="op" id="6037664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6037669">bLen</span>&nbsp;<span class="op" id="6037674">=</span>&nbsp;<span class="ident" id="6037676">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6037683">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6037687">buf</span>&nbsp;<span class="op" id="6037691">=</span>&nbsp;<span class="builtinfunc" id="6037693">make</span><span class="op" id="6037697">(</span><span class="op" id="6037698">[</span><span class="op" id="6037699">]</span><span class="builtintype" id="6037700">byte</span><span class="op" id="6037704">,</span>&nbsp;<span class="builtintype" id="6037706">int</span><span class="op" id="6037709">(</span><span class="ident" id="6037710">bLen</span><span class="op" id="6037714">)</span><span class="op" id="6037715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6037719">if</span>&nbsp;<span class="ident" id="6037722">_</span><span class="op" id="6037723">,</span>&nbsp;<span class="ident" id="6037725">err</span>&nbsp;<span class="op" id="6037729">:=</span>&nbsp;<span class="ident" id="6037732">r</span><span class="op" id="6037733">.</span><span class="ident" id="6037734">ReadAt</span><span class="op" id="6037740">(</span><span class="ident" id="6037741">buf</span><span class="op" id="6037744">,</span>&nbsp;<span class="ident" id="6037746">size</span><span class="op" id="6037750">-</span><span class="ident" id="6037751">bLen</span><span class="op" id="6037755">)</span><span class="op" id="6037756">;</span>&nbsp;<span class="ident" id="6037758">err</span>&nbsp;<span class="op" id="6037762">!=</span>&nbsp;<span class="builtintype" id="6037765">nil</span>&nbsp;<span class="op" id="6037769">&amp;&amp;</span>&nbsp;<span class="ident" id="6037772">err</span>&nbsp;<span class="op" id="6037776">!=</span>&nbsp;<span class="ident" id="6037779">io</span><span class="op" id="6037781">.</span><span class="ident" id="6037782">EOF</span>&nbsp;<span class="op" id="6037786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6037791">return</span>&nbsp;<span class="builtintype" id="6037798">nil</span><span class="op" id="6037801">,</span>&nbsp;<span class="ident" id="6037803">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6037809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6037813">if</span>&nbsp;<span class="ident" id="6037816">p</span>&nbsp;<span class="op" id="6037818">:=</span>&nbsp;<span class="ident" id="6037821">findSignatureInBlock</span><span class="op" id="6037841">(</span><span class="ident" id="6037842">buf</span><span class="op" id="6037845">)</span><span class="op" id="6037846">;</span>&nbsp;<span class="ident" id="6037848">p</span>&nbsp;<span class="op" id="6037850">&gt;=</span>&nbsp;<span class="num" id="6037853">0</span>&nbsp;<span class="op" id="6037855">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6037860">buf</span>&nbsp;<span class="op" id="6037864">=</span>&nbsp;<span class="ident" id="6037866">buf</span><span class="op" id="6037869">[</span><span class="ident" id="6037870">p</span><span class="op" id="6037871">:</span><span class="op" id="6037872">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6037877">directoryEndOffset</span>&nbsp;<span class="op" id="6037896">=</span>&nbsp;<span class="ident" id="6037898">size</span>&nbsp;<span class="op" id="6037903">-</span>&nbsp;<span class="ident" id="6037905">bLen</span>&nbsp;<span class="op" id="6037910">+</span>&nbsp;<span class="ident" id="6037912">int64</span><span class="op" id="6037917">(</span><span class="ident" id="6037918">p</span><span class="op" id="6037919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6037924">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6037932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6037936">if</span>&nbsp;<span class="ident" id="6037939">i</span>&nbsp;<span class="op" id="6037941">==</span>&nbsp;<span class="num" id="6037944">1</span>&nbsp;<span class="op" id="6037946">||</span>&nbsp;<span class="ident" id="6037949">bLen</span>&nbsp;<span class="op" id="6037954">==</span>&nbsp;<span class="ident" id="6037957">size</span>&nbsp;<span class="op" id="6037962">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6037967">return</span>&nbsp;<span class="builtintype" id="6037974">nil</span><span class="op" id="6037977">,</span>&nbsp;<span class="ident" id="6037979">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6037991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6037994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6037998">//&nbsp;read&nbsp;header&nbsp;into&nbsp;struct</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6038026">b</span>&nbsp;<span class="op" id="6038028">:=</span>&nbsp;<span class="ident" id="6038031">readBuf</span><span class="op" id="6038038">(</span><span class="ident" id="6038039">buf</span><span class="op" id="6038042">[</span><span class="num" id="6038043">4</span><span class="op" id="6038044">:</span><span class="op" id="6038045">]</span><span class="op" id="6038046">)</span>&nbsp;<span class="comment" id="6038048">//&nbsp;skip&nbsp;signature</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6038067">d</span>&nbsp;<span class="op" id="6038069">:=</span>&nbsp;<span class="op" id="6038072">&amp;</span><span class="ident" id="6038073">directoryEnd</span><span class="op" id="6038085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6038089">diskNbr</span><span class="op" id="6038096">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6038109">uint32</span><span class="op" id="6038115">(</span><span class="ident" id="6038116">b</span><span class="op" id="6038117">.</span><span class="builtintype" id="6038118">uint16</span><span class="op" id="6038124">(</span><span class="op" id="6038125">)</span><span class="op" id="6038126">)</span><span class="op" id="6038127">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6038131">dirDiskNbr</span><span class="op" id="6038141">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6038151">uint32</span><span class="op" id="6038157">(</span><span class="ident" id="6038158">b</span><span class="op" id="6038159">.</span><span class="builtintype" id="6038160">uint16</span><span class="op" id="6038166">(</span><span class="op" id="6038167">)</span><span class="op" id="6038168">)</span><span class="op" id="6038169">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6038173">dirRecordsThisDisk</span><span class="op" id="6038191">:</span>&nbsp;<span class="ident" id="6038193">uint64</span><span class="op" id="6038199">(</span><span class="ident" id="6038200">b</span><span class="op" id="6038201">.</span><span class="builtintype" id="6038202">uint16</span><span class="op" id="6038208">(</span><span class="op" id="6038209">)</span><span class="op" id="6038210">)</span><span class="op" id="6038211">,</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6038215">directoryRecords</span><span class="op" id="6038231">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6038235">uint64</span><span class="op" id="6038241">(</span><span class="ident" id="6038242">b</span><span class="op" id="6038243">.</span><span class="builtintype" id="6038244">uint16</span><span class="op" id="6038250">(</span><span class="op" id="6038251">)</span><span class="op" id="6038252">)</span><span class="op" id="6038253">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6038257">directorySize</span><span class="op" id="6038270">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6038277">uint64</span><span class="op" id="6038283">(</span><span class="ident" id="6038284">b</span><span class="op" id="6038285">.</span><span class="builtintype" id="6038286">uint32</span><span class="op" id="6038292">(</span><span class="op" id="6038293">)</span><span class="op" id="6038294">)</span><span class="op" id="6038295">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6038299">directoryOffset</span><span class="op" id="6038314">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6038319">uint64</span><span class="op" id="6038325">(</span><span class="ident" id="6038326">b</span><span class="op" id="6038327">.</span><span class="builtintype" id="6038328">uint32</span><span class="op" id="6038334">(</span><span class="op" id="6038335">)</span><span class="op" id="6038336">)</span><span class="op" id="6038337">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6038341">commentLen</span><span class="op" id="6038351">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6038361">b</span><span class="op" id="6038362">.</span><span class="builtintype" id="6038363">uint16</span><span class="op" id="6038369">(</span><span class="op" id="6038370">)</span><span class="op" id="6038371">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6038374">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6038377">l</span>&nbsp;<span class="op" id="6038379">:=</span>&nbsp;<span class="builtintype" id="6038382">int</span><span class="op" id="6038385">(</span><span class="ident" id="6038386">d</span><span class="op" id="6038387">.</span><span class="ident" id="6038388">commentLen</span><span class="op" id="6038398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6038401">if</span>&nbsp;<span class="ident" id="6038404">l</span>&nbsp;<span class="op" id="6038406">&gt;</span>&nbsp;<span class="builtinfunc" id="6038408">len</span><span class="op" id="6038411">(</span><span class="ident" id="6038412">b</span><span class="op" id="6038413">)</span>&nbsp;<span class="op" id="6038415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6038419">return</span>&nbsp;<span class="builtintype" id="6038426">nil</span><span class="op" id="6038429">,</span>&nbsp;<span class="ident" id="6038431">errors</span><span class="op" id="6038437">.</span><span class="ident" id="6038438">New</span><span class="op" id="6038441">(</span><span class="string" id="6038442">&#34;zip:&nbsp;invalid&nbsp;comment&nbsp;length&#34;</span><span class="op" id="6038471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6038474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6038477">d</span><span class="op" id="6038478">.</span><span class="ident" id="6038479">comment</span>&nbsp;<span class="op" id="6038487">=</span>&nbsp;<span class="builtintype" id="6038489">string</span><span class="op" id="6038495">(</span><span class="ident" id="6038496">b</span><span class="op" id="6038497">[</span><span class="op" id="6038498">:</span><span class="ident" id="6038499">l</span><span class="op" id="6038500">]</span><span class="op" id="6038501">)</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6038505">p</span><span class="op" id="6038506">,</span>&nbsp;<span class="ident" id="6038508">err</span>&nbsp;<span class="op" id="6038512">:=</span>&nbsp;<span class="ident" id="6038515">findDirectory64End</span><span class="op" id="6038533">(</span><span class="ident" id="6038534">r</span><span class="op" id="6038535">,</span>&nbsp;<span class="ident" id="6038537">directoryEndOffset</span><span class="op" id="6038555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6038558">if</span>&nbsp;<span class="ident" id="6038561">err</span>&nbsp;<span class="op" id="6038565">==</span>&nbsp;<span class="builtintype" id="6038568">nil</span>&nbsp;<span class="op" id="6038572">&amp;&amp;</span>&nbsp;<span class="ident" id="6038575">p</span>&nbsp;<span class="op" id="6038577">&gt;=</span>&nbsp;<span class="num" id="6038580">0</span>&nbsp;<span class="op" id="6038582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6038586">err</span>&nbsp;<span class="op" id="6038590">=</span>&nbsp;<span class="ident" id="6038592">readDirectory64End</span><span class="op" id="6038610">(</span><span class="ident" id="6038611">r</span><span class="op" id="6038612">,</span>&nbsp;<span class="ident" id="6038614">p</span><span class="op" id="6038615">,</span>&nbsp;<span class="ident" id="6038617">d</span><span class="op" id="6038618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6038621">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6038624">if</span>&nbsp;<span class="ident" id="6038627">err</span>&nbsp;<span class="op" id="6038631">!=</span>&nbsp;<span class="builtintype" id="6038634">nil</span>&nbsp;<span class="op" id="6038638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6038642">return</span>&nbsp;<span class="builtintype" id="6038649">nil</span><span class="op" id="6038652">,</span>&nbsp;<span class="ident" id="6038654">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6038659">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6038663">//&nbsp;Make&nbsp;sure&nbsp;directoryOffset&nbsp;points&nbsp;to&nbsp;somewhere&nbsp;in&nbsp;our&nbsp;file.</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6038726">if</span>&nbsp;<span class="ident" id="6038729">o</span>&nbsp;<span class="op" id="6038731">:=</span>&nbsp;<span class="ident" id="6038734">int64</span><span class="op" id="6038739">(</span><span class="ident" id="6038740">d</span><span class="op" id="6038741">.</span><span class="ident" id="6038742">directoryOffset</span><span class="op" id="6038757">)</span><span class="op" id="6038758">;</span>&nbsp;<span class="ident" id="6038760">o</span>&nbsp;<span class="op" id="6038762">&lt;</span>&nbsp;<span class="num" id="6038764">0</span>&nbsp;<span class="op" id="6038766">||</span>&nbsp;<span class="ident" id="6038769">o</span>&nbsp;<span class="op" id="6038771">&gt;=</span>&nbsp;<span class="ident" id="6038774">size</span>&nbsp;<span class="op" id="6038779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6038783">return</span>&nbsp;<span class="builtintype" id="6038790">nil</span><span class="op" id="6038793">,</span>&nbsp;<span class="ident" id="6038795">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6038806">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6038809">return</span>&nbsp;<span class="ident" id="6038816">d</span><span class="op" id="6038817">,</span>&nbsp;<span class="builtintype" id="6038819">nil</span><br>
<span class="lineno"></span><span class="op" id="6038823">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="comment" id="6038826">//&nbsp;findDirectory64End&nbsp;tries&nbsp;to&nbsp;read&nbsp;the&nbsp;zip64&nbsp;locator&nbsp;just&nbsp;before&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6038896">//&nbsp;directory&nbsp;end&nbsp;and&nbsp;returns&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;zip64&nbsp;directory&nbsp;end&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="6038966">//&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="6038976">func</span>&nbsp;<span class="ident" id="6038981">findDirectory64End</span><span class="op" id="6038999">(</span><span class="ident" id="6039000">r</span>&nbsp;<span class="ident" id="6039002">io</span><span class="op" id="6039004">.</span><span class="ident" id="6039005">ReaderAt</span><span class="op" id="6039013">,</span>&nbsp;<span class="ident" id="6039015">directoryEndOffset</span>&nbsp;<span class="ident" id="6039034">int64</span><span class="op" id="6039039">)</span>&nbsp;<span class="op" id="6039041">(</span><span class="ident" id="6039042">int64</span><span class="op" id="6039047">,</span>&nbsp;<span class="builtintype" id="6039049">error</span><span class="op" id="6039054">)</span>&nbsp;<span class="op" id="6039056">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6039059">locOffset</span>&nbsp;<span class="op" id="6039069">:=</span>&nbsp;<span class="ident" id="6039072">directoryEndOffset</span>&nbsp;<span class="op" id="6039091">-</span>&nbsp;<span class="ident" id="6039093">directory64LocLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6039112">if</span>&nbsp;<span class="ident" id="6039115">locOffset</span>&nbsp;<span class="op" id="6039125">&lt;</span>&nbsp;<span class="num" id="6039127">0</span>&nbsp;<span class="op" id="6039129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6039133">return</span>&nbsp;<span class="op" id="6039140">-</span><span class="num" id="6039141">1</span><span class="op" id="6039142">,</span>&nbsp;<span class="builtintype" id="6039144">nil</span>&nbsp;<span class="comment" id="6039148">//&nbsp;no&nbsp;need&nbsp;to&nbsp;look&nbsp;for&nbsp;a&nbsp;header&nbsp;outside&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6039198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6039201">buf</span>&nbsp;<span class="op" id="6039205">:=</span>&nbsp;<span class="builtinfunc" id="6039208">make</span><span class="op" id="6039212">(</span><span class="op" id="6039213">[</span><span class="op" id="6039214">]</span><span class="builtintype" id="6039215">byte</span><span class="op" id="6039219">,</span>&nbsp;<span class="ident" id="6039221">directory64LocLen</span><span class="op" id="6039238">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6039241">if</span>&nbsp;<span class="ident" id="6039244">_</span><span class="op" id="6039245">,</span>&nbsp;<span class="ident" id="6039247">err</span>&nbsp;<span class="op" id="6039251">:=</span>&nbsp;<span class="ident" id="6039254">r</span><span class="op" id="6039255">.</span><span class="ident" id="6039256">ReadAt</span><span class="op" id="6039262">(</span><span class="ident" id="6039263">buf</span><span class="op" id="6039266">,</span>&nbsp;<span class="ident" id="6039268">locOffset</span><span class="op" id="6039277">)</span><span class="op" id="6039278">;</span>&nbsp;<span class="ident" id="6039280">err</span>&nbsp;<span class="op" id="6039284">!=</span>&nbsp;<span class="builtintype" id="6039287">nil</span>&nbsp;<span class="op" id="6039291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6039295">return</span>&nbsp;<span class="op" id="6039302">-</span><span class="num" id="6039303">1</span><span class="op" id="6039304">,</span>&nbsp;<span class="ident" id="6039306">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6039311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6039314">b</span>&nbsp;<span class="op" id="6039316">:=</span>&nbsp;<span class="ident" id="6039319">readBuf</span><span class="op" id="6039326">(</span><span class="ident" id="6039327">buf</span><span class="op" id="6039330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6039333">if</span>&nbsp;<span class="ident" id="6039336">sig</span>&nbsp;<span class="op" id="6039340">:=</span>&nbsp;<span class="ident" id="6039343">b</span><span class="op" id="6039344">.</span><span class="builtintype" id="6039345">uint32</span><span class="op" id="6039351">(</span><span class="op" id="6039352">)</span><span class="op" id="6039353">;</span>&nbsp;<span class="ident" id="6039355">sig</span>&nbsp;<span class="op" id="6039359">!=</span>&nbsp;<span class="ident" id="6039362">directory64LocSignature</span>&nbsp;<span class="op" id="6039386">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6039390">return</span>&nbsp;<span class="op" id="6039397">-</span><span class="num" id="6039398">1</span><span class="op" id="6039399">,</span>&nbsp;<span class="builtintype" id="6039401">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6039406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6039409">b</span>&nbsp;<span class="op" id="6039411">=</span>&nbsp;<span class="ident" id="6039413">b</span><span class="op" id="6039414">[</span><span class="num" id="6039415">4</span><span class="op" id="6039416">:</span><span class="op" id="6039417">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6039425">//&nbsp;skip&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6039506">p</span>&nbsp;<span class="op" id="6039508">:=</span>&nbsp;<span class="ident" id="6039511">b</span><span class="op" id="6039512">.</span><span class="ident" id="6039513">uint64</span><span class="op" id="6039519">(</span><span class="op" id="6039520">)</span>&nbsp;<span class="comment" id="6039522">//&nbsp;relative&nbsp;offset&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6039587">return</span>&nbsp;<span class="ident" id="6039594">int64</span><span class="op" id="6039599">(</span><span class="ident" id="6039600">p</span><span class="op" id="6039601">)</span><span class="op" id="6039602">,</span>&nbsp;<span class="builtintype" id="6039604">nil</span><br>
<span class="lineno">395</span><span class="op" id="6039608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6039611">//&nbsp;readDirectory64End&nbsp;reads&nbsp;the&nbsp;zip64&nbsp;directory&nbsp;end&nbsp;and&nbsp;updates&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6039679">//&nbsp;directory&nbsp;end&nbsp;with&nbsp;the&nbsp;zip64&nbsp;directory&nbsp;end&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="6039733">func</span>&nbsp;<span class="ident" id="6039738">readDirectory64End</span><span class="op" id="6039756">(</span><span class="ident" id="6039757">r</span>&nbsp;<span class="ident" id="6039759">io</span><span class="op" id="6039761">.</span><span class="ident" id="6039762">ReaderAt</span><span class="op" id="6039770">,</span>&nbsp;<span class="ident" id="6039772">offset</span>&nbsp;<span class="ident" id="6039779">int64</span><span class="op" id="6039784">,</span>&nbsp;<span class="ident" id="6039786">d</span>&nbsp;<span class="op" id="6039788">*</span><span class="ident" id="6039789">directoryEnd</span><span class="op" id="6039801">)</span>&nbsp;<span class="op" id="6039803">(</span><span class="ident" id="6039804">err</span>&nbsp;<span class="builtintype" id="6039808">error</span><span class="op" id="6039813">)</span>&nbsp;<span class="op" id="6039815">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6039818">buf</span>&nbsp;<span class="op" id="6039822">:=</span>&nbsp;<span class="builtinfunc" id="6039825">make</span><span class="op" id="6039829">(</span><span class="op" id="6039830">[</span><span class="op" id="6039831">]</span><span class="builtintype" id="6039832">byte</span><span class="op" id="6039836">,</span>&nbsp;<span class="ident" id="6039838">directory64EndLen</span><span class="op" id="6039855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6039858">if</span>&nbsp;<span class="ident" id="6039861">_</span><span class="op" id="6039862">,</span>&nbsp;<span class="ident" id="6039864">err</span>&nbsp;<span class="op" id="6039868">:=</span>&nbsp;<span class="ident" id="6039871">r</span><span class="op" id="6039872">.</span><span class="ident" id="6039873">ReadAt</span><span class="op" id="6039879">(</span><span class="ident" id="6039880">buf</span><span class="op" id="6039883">,</span>&nbsp;<span class="ident" id="6039885">offset</span><span class="op" id="6039891">)</span><span class="op" id="6039892">;</span>&nbsp;<span class="ident" id="6039894">err</span>&nbsp;<span class="op" id="6039898">!=</span>&nbsp;<span class="builtintype" id="6039901">nil</span>&nbsp;<span class="op" id="6039905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6039909">return</span>&nbsp;<span class="ident" id="6039916">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6039921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6039925">b</span>&nbsp;<span class="op" id="6039927">:=</span>&nbsp;<span class="ident" id="6039930">readBuf</span><span class="op" id="6039937">(</span><span class="ident" id="6039938">buf</span><span class="op" id="6039941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6039944">if</span>&nbsp;<span class="ident" id="6039947">sig</span>&nbsp;<span class="op" id="6039951">:=</span>&nbsp;<span class="ident" id="6039954">b</span><span class="op" id="6039955">.</span><span class="builtintype" id="6039956">uint32</span><span class="op" id="6039962">(</span><span class="op" id="6039963">)</span><span class="op" id="6039964">;</span>&nbsp;<span class="ident" id="6039966">sig</span>&nbsp;<span class="op" id="6039970">!=</span>&nbsp;<span class="ident" id="6039973">directory64EndSignature</span>&nbsp;<span class="op" id="6039997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6040001">return</span>&nbsp;<span class="ident" id="6040008">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6040019">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6040023">b</span>&nbsp;<span class="op" id="6040025">=</span>&nbsp;<span class="ident" id="6040027">b</span><span class="op" id="6040028">[</span><span class="num" id="6040029">12</span><span class="op" id="6040031">:</span><span class="op" id="6040032">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6040057">//&nbsp;skip&nbsp;dir&nbsp;size,&nbsp;version&nbsp;and&nbsp;version&nbsp;needed&nbsp;(uint64&nbsp;+&nbsp;2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6040124">d</span><span class="op" id="6040125">.</span><span class="ident" id="6040126">diskNbr</span>&nbsp;<span class="op" id="6040134">=</span>&nbsp;<span class="ident" id="6040136">b</span><span class="op" id="6040137">.</span><span class="builtintype" id="6040138">uint32</span><span class="op" id="6040144">(</span><span class="op" id="6040145">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6040158">//&nbsp;number&nbsp;of&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6040182">d</span><span class="op" id="6040183">.</span><span class="ident" id="6040184">dirDiskNbr</span>&nbsp;<span class="op" id="6040195">=</span>&nbsp;<span class="ident" id="6040197">b</span><span class="op" id="6040198">.</span><span class="builtintype" id="6040199">uint32</span><span class="op" id="6040205">(</span><span class="op" id="6040206">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6040216">//&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6040279">d</span><span class="op" id="6040280">.</span><span class="ident" id="6040281">dirRecordsThisDisk</span>&nbsp;<span class="op" id="6040300">=</span>&nbsp;<span class="ident" id="6040302">b</span><span class="op" id="6040303">.</span><span class="ident" id="6040304">uint64</span><span class="op" id="6040310">(</span><span class="op" id="6040311">)</span>&nbsp;<span class="comment" id="6040313">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory&nbsp;on&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6040379">d</span><span class="op" id="6040380">.</span><span class="ident" id="6040381">directoryRecords</span>&nbsp;<span class="op" id="6040398">=</span>&nbsp;<span class="ident" id="6040400">b</span><span class="op" id="6040401">.</span><span class="ident" id="6040402">uint64</span><span class="op" id="6040408">(</span><span class="op" id="6040409">)</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6040413">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6040466">d</span><span class="op" id="6040467">.</span><span class="ident" id="6040468">directorySize</span>&nbsp;<span class="op" id="6040482">=</span>&nbsp;<span class="ident" id="6040484">b</span><span class="op" id="6040485">.</span><span class="ident" id="6040486">uint64</span><span class="op" id="6040492">(</span><span class="op" id="6040493">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6040500">//&nbsp;size&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6040534">d</span><span class="op" id="6040535">.</span><span class="ident" id="6040536">directoryOffset</span>&nbsp;<span class="op" id="6040552">=</span>&nbsp;<span class="ident" id="6040554">b</span><span class="op" id="6040555">.</span><span class="ident" id="6040556">uint64</span><span class="op" id="6040562">(</span><span class="op" id="6040563">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6040568">//&nbsp;offset&nbsp;of&nbsp;start&nbsp;of&nbsp;central&nbsp;directory&nbsp;with&nbsp;respect&nbsp;to&nbsp;the&nbsp;starting&nbsp;disk&nbsp;number</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6040651">return</span>&nbsp;<span class="builtintype" id="6040658">nil</span><br>
<span class="lineno"></span><span class="op" id="6040662">}</span><br>
<span class="lineno">420</span><br>
<span class="lineno"></span><span class="keyword" id="6040665">func</span>&nbsp;<span class="ident" id="6040670">findSignatureInBlock</span><span class="op" id="6040690">(</span><span class="ident" id="6040691">b</span>&nbsp;<span class="op" id="6040693">[</span><span class="op" id="6040694">]</span><span class="builtintype" id="6040695">byte</span><span class="op" id="6040699">)</span>&nbsp;<span class="builtintype" id="6040701">int</span>&nbsp;<span class="op" id="6040705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6040708">for</span>&nbsp;<span class="ident" id="6040712">i</span>&nbsp;<span class="op" id="6040714">:=</span>&nbsp;<span class="builtinfunc" id="6040717">len</span><span class="op" id="6040720">(</span><span class="ident" id="6040721">b</span><span class="op" id="6040722">)</span>&nbsp;<span class="op" id="6040724">-</span>&nbsp;<span class="ident" id="6040726">directoryEndLen</span><span class="op" id="6040741">;</span>&nbsp;<span class="ident" id="6040743">i</span>&nbsp;<span class="op" id="6040745">&gt;=</span>&nbsp;<span class="num" id="6040748">0</span><span class="op" id="6040749">;</span>&nbsp;<span class="ident" id="6040751">i</span><span class="op" id="6040752">--</span>&nbsp;<span class="op" id="6040755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6040759">//&nbsp;defined&nbsp;from&nbsp;directoryEndSignature&nbsp;in&nbsp;struct.go</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6040812">if</span>&nbsp;<span class="ident" id="6040815">b</span><span class="op" id="6040816">[</span><span class="ident" id="6040817">i</span><span class="op" id="6040818">]</span>&nbsp;<span class="op" id="6040820">==</span>&nbsp;<span class="string" id="6040823">&#39;P&#39;</span>&nbsp;<span class="op" id="6040827">&amp;&amp;</span>&nbsp;<span class="ident" id="6040830">b</span><span class="op" id="6040831">[</span><span class="ident" id="6040832">i</span><span class="op" id="6040833">+</span><span class="num" id="6040834">1</span><span class="op" id="6040835">]</span>&nbsp;<span class="op" id="6040837">==</span>&nbsp;<span class="string" id="6040840">&#39;K&#39;</span>&nbsp;<span class="op" id="6040844">&amp;&amp;</span>&nbsp;<span class="ident" id="6040847">b</span><span class="op" id="6040848">[</span><span class="ident" id="6040849">i</span><span class="op" id="6040850">+</span><span class="num" id="6040851">2</span><span class="op" id="6040852">]</span>&nbsp;<span class="op" id="6040854">==</span>&nbsp;<span class="num" id="6040857">0x05</span>&nbsp;<span class="op" id="6040862">&amp;&amp;</span>&nbsp;<span class="ident" id="6040865">b</span><span class="op" id="6040866">[</span><span class="ident" id="6040867">i</span><span class="op" id="6040868">+</span><span class="num" id="6040869">3</span><span class="op" id="6040870">]</span>&nbsp;<span class="op" id="6040872">==</span>&nbsp;<span class="num" id="6040875">0x06</span>&nbsp;<span class="op" id="6040880">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6040885">//&nbsp;n&nbsp;is&nbsp;length&nbsp;of&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6040914">n</span>&nbsp;<span class="op" id="6040916">:=</span>&nbsp;<span class="builtintype" id="6040919">int</span><span class="op" id="6040922">(</span><span class="ident" id="6040923">b</span><span class="op" id="6040924">[</span><span class="ident" id="6040925">i</span><span class="op" id="6040926">+</span><span class="ident" id="6040927">directoryEndLen</span><span class="op" id="6040942">-</span><span class="num" id="6040943">2</span><span class="op" id="6040944">]</span><span class="op" id="6040945">)</span>&nbsp;<span class="op" id="6040947">|</span>&nbsp;<span class="builtintype" id="6040949">int</span><span class="op" id="6040952">(</span><span class="ident" id="6040953">b</span><span class="op" id="6040954">[</span><span class="ident" id="6040955">i</span><span class="op" id="6040956">+</span><span class="ident" id="6040957">directoryEndLen</span><span class="op" id="6040972">-</span><span class="num" id="6040973">1</span><span class="op" id="6040974">]</span><span class="op" id="6040975">)</span><span class="op" id="6040976">&lt;&lt;</span><span class="num" id="6040978">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6040983">if</span>&nbsp;<span class="ident" id="6040986">n</span><span class="op" id="6040987">+</span><span class="ident" id="6040988">directoryEndLen</span><span class="op" id="6041003">+</span><span class="ident" id="6041004">i</span>&nbsp;<span class="op" id="6041006">&lt;=</span>&nbsp;<span class="builtinfunc" id="6041009">len</span><span class="op" id="6041012">(</span><span class="ident" id="6041013">b</span><span class="op" id="6041014">)</span>&nbsp;<span class="op" id="6041016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6041022">return</span>&nbsp;<span class="ident" id="6041029">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6041034">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6041038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6041041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6041044">return</span>&nbsp;<span class="op" id="6041051">-</span><span class="num" id="6041052">1</span><br>
<span class="lineno"></span><span class="op" id="6041054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="keyword" id="6041057">type</span>&nbsp;<span class="ident" id="6041062">readBuf</span>&nbsp;<span class="op" id="6041070">[</span><span class="op" id="6041071">]</span><span class="builtintype" id="6041072">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6041078">func</span>&nbsp;<span class="op" id="6041083">(</span><span class="ident" id="6041084">b</span>&nbsp;<span class="op" id="6041086">*</span><span class="ident" id="6041087">readBuf</span><span class="op" id="6041094">)</span>&nbsp;<span class="builtintype" id="6041096">uint16</span><span class="op" id="6041102">(</span><span class="op" id="6041103">)</span>&nbsp;<span class="builtintype" id="6041105">uint16</span>&nbsp;<span class="op" id="6041112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6041115">v</span>&nbsp;<span class="op" id="6041117">:=</span>&nbsp;<span class="ident" id="6041120">binary</span><span class="op" id="6041126">.</span><span class="ident" id="6041127">LittleEndian</span><span class="op" id="6041139">.</span><span class="ident" id="6041140">Uint16</span><span class="op" id="6041146">(</span><span class="op" id="6041147">*</span><span class="ident" id="6041148">b</span><span class="op" id="6041149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6041152">*</span><span class="ident" id="6041153">b</span>&nbsp;<span class="op" id="6041155">=</span>&nbsp;<span class="op" id="6041157">(</span><span class="op" id="6041158">*</span><span class="ident" id="6041159">b</span><span class="op" id="6041160">)</span><span class="op" id="6041161">[</span><span class="num" id="6041162">2</span><span class="op" id="6041163">:</span><span class="op" id="6041164">]</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6041167">return</span>&nbsp;<span class="ident" id="6041174">v</span><br>
<span class="lineno"></span><span class="op" id="6041176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6041179">func</span>&nbsp;<span class="op" id="6041184">(</span><span class="ident" id="6041185">b</span>&nbsp;<span class="op" id="6041187">*</span><span class="ident" id="6041188">readBuf</span><span class="op" id="6041195">)</span>&nbsp;<span class="builtintype" id="6041197">uint32</span><span class="op" id="6041203">(</span><span class="op" id="6041204">)</span>&nbsp;<span class="builtintype" id="6041206">uint32</span>&nbsp;<span class="op" id="6041213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6041216">v</span>&nbsp;<span class="op" id="6041218">:=</span>&nbsp;<span class="ident" id="6041221">binary</span><span class="op" id="6041227">.</span><span class="ident" id="6041228">LittleEndian</span><span class="op" id="6041240">.</span><span class="ident" id="6041241">Uint32</span><span class="op" id="6041247">(</span><span class="op" id="6041248">*</span><span class="ident" id="6041249">b</span><span class="op" id="6041250">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6041253">*</span><span class="ident" id="6041254">b</span>&nbsp;<span class="op" id="6041256">=</span>&nbsp;<span class="op" id="6041258">(</span><span class="op" id="6041259">*</span><span class="ident" id="6041260">b</span><span class="op" id="6041261">)</span><span class="op" id="6041262">[</span><span class="num" id="6041263">4</span><span class="op" id="6041264">:</span><span class="op" id="6041265">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6041268">return</span>&nbsp;<span class="ident" id="6041275">v</span><br>
<span class="lineno"></span><span class="op" id="6041277">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6041280">func</span>&nbsp;<span class="op" id="6041285">(</span><span class="ident" id="6041286">b</span>&nbsp;<span class="op" id="6041288">*</span><span class="ident" id="6041289">readBuf</span><span class="op" id="6041296">)</span>&nbsp;<span class="ident" id="6041298">uint64</span><span class="op" id="6041304">(</span><span class="op" id="6041305">)</span>&nbsp;<span class="ident" id="6041307">uint64</span>&nbsp;<span class="op" id="6041314">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6041317">v</span>&nbsp;<span class="op" id="6041319">:=</span>&nbsp;<span class="ident" id="6041322">binary</span><span class="op" id="6041328">.</span><span class="ident" id="6041329">LittleEndian</span><span class="op" id="6041341">.</span><span class="ident" id="6041342">Uint64</span><span class="op" id="6041348">(</span><span class="op" id="6041349">*</span><span class="ident" id="6041350">b</span><span class="op" id="6041351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6041354">*</span><span class="ident" id="6041355">b</span>&nbsp;<span class="op" id="6041357">=</span>&nbsp;<span class="op" id="6041359">(</span><span class="op" id="6041360">*</span><span class="ident" id="6041361">b</span><span class="op" id="6041362">)</span><span class="op" id="6041363">[</span><span class="num" id="6041364">8</span><span class="op" id="6041365">:</span><span class="op" id="6041366">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6041369">return</span>&nbsp;<span class="ident" id="6041376">v</span><br>
<span class="lineno"></span><span class="op" id="6041378">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
