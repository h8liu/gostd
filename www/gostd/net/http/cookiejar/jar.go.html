<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/cookiejar</h2>
<ul>
<li><a href="/gostd/net/http/cookiejar/jar.go.html" class="current">jar.go</a></li>
<li><a href="/gostd/net/http/cookiejar/jar_test.go.html">jar_test.go</a></li>
<li><a href="/gostd/net/http/cookiejar/punycode.go.html">punycode.go</a></li>
<li><a href="/gostd/net/http/cookiejar/punycode_test.go.html">punycode_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5465780">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5465835">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5465889">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5465940">//&nbsp;Package&nbsp;cookiejar&nbsp;implements&nbsp;an&nbsp;in-memory&nbsp;RFC&nbsp;6265-compliant&nbsp;http.CookieJar.</span><br>
<span class="lineno"></span><span class="keyword" id="5466020">package</span>&nbsp;<span class="ident" id="5466028">cookiejar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5466039">import</span>&nbsp;<span class="op" id="5466046">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5466049">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5466059">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5466066">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5466073">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5466085">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5466096">&#34;sort&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5466104">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5466115">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5466123">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="5466130">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="5466133">//&nbsp;PublicSuffixList&nbsp;provides&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;a&nbsp;domain.&nbsp;For&nbsp;example:</span><br>
<span class="lineno"></span><span class="comment" id="5466206">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;&#34;example.com&#34;&nbsp;is&nbsp;&#34;com&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5466261">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;&#34;foo1.foo2.foo3.co.uk&#34;&nbsp;is&nbsp;&#34;co.uk&#34;,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5466331">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;&#34;bar.pvt.k12.ma.us&#34;&nbsp;is&nbsp;&#34;pvt.k12.ma.us&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="5466402">//</span><br>
<span class="lineno">25</span><span class="comment" id="5466405">//&nbsp;Implementations&nbsp;of&nbsp;PublicSuffixList&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="5466479">//&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="comment" id="5466503">//</span><br>
<span class="lineno"></span><span class="comment" id="5466506">//&nbsp;An&nbsp;implementation&nbsp;that&nbsp;always&nbsp;returns&nbsp;&#34;&#34;&nbsp;is&nbsp;valid&nbsp;and&nbsp;may&nbsp;be&nbsp;useful&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5466581">//&nbsp;testing&nbsp;but&nbsp;it&nbsp;is&nbsp;not&nbsp;secure:&nbsp;it&nbsp;means&nbsp;that&nbsp;the&nbsp;HTTP&nbsp;server&nbsp;for&nbsp;foo.com&nbsp;can</span><br>
<span class="lineno">30</span><span class="comment" id="5466660">//&nbsp;set&nbsp;a&nbsp;cookie&nbsp;for&nbsp;bar.com.</span><br>
<span class="lineno"></span><span class="comment" id="5466689">//</span><br>
<span class="lineno"></span><span class="comment" id="5466692">//&nbsp;A&nbsp;public&nbsp;suffix&nbsp;list&nbsp;implementation&nbsp;is&nbsp;in&nbsp;the&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="5466749">//&nbsp;golang.org/x/net/publicsuffix.</span><br>
<span class="lineno"></span><span class="keyword" id="5466783">type</span>&nbsp;<span class="ident" id="5466788">PublicSuffixList</span>&nbsp;<span class="keyword" id="5466805">interface</span>&nbsp;<span class="op" id="5466815">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5466818">//&nbsp;PublicSuffix&nbsp;returns&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;domain.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5466872">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5466876">//&nbsp;TODO:&nbsp;specify&nbsp;which&nbsp;of&nbsp;the&nbsp;caller&nbsp;and&nbsp;callee&nbsp;is&nbsp;responsible&nbsp;for&nbsp;IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5466947">//&nbsp;addresses,&nbsp;for&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;dots,&nbsp;for&nbsp;case&nbsp;sensitivity,&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5467019">//&nbsp;for&nbsp;IDN/Punycode.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467041">PublicSuffix</span><span class="op" id="5467053">(</span><span class="ident" id="5467054">domain</span>&nbsp;<span class="builtintype" id="5467061">string</span><span class="op" id="5467067">)</span>&nbsp;<span class="builtintype" id="5467069">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5467078">//&nbsp;String&nbsp;returns&nbsp;a&nbsp;description&nbsp;of&nbsp;the&nbsp;source&nbsp;of&nbsp;this&nbsp;public&nbsp;suffix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5467147">//&nbsp;list.&nbsp;The&nbsp;description&nbsp;will&nbsp;typically&nbsp;contain&nbsp;something&nbsp;like&nbsp;a&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5467218">//&nbsp;stamp&nbsp;or&nbsp;version&nbsp;number.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467247">String</span><span class="op" id="5467253">(</span><span class="op" id="5467254">)</span>&nbsp;<span class="builtintype" id="5467256">string</span><br>
<span class="lineno"></span><span class="op" id="5467263">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5467266">//&nbsp;Options&nbsp;are&nbsp;the&nbsp;options&nbsp;for&nbsp;creating&nbsp;a&nbsp;new&nbsp;Jar.</span><br>
<span class="lineno"></span><span class="keyword" id="5467317">type</span>&nbsp;<span class="ident" id="5467322">Options</span>&nbsp;<span class="keyword" id="5467330">struct</span>&nbsp;<span class="op" id="5467337">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5467340">//&nbsp;PublicSuffixList&nbsp;is&nbsp;the&nbsp;public&nbsp;suffix&nbsp;list&nbsp;that&nbsp;determines&nbsp;whether</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5467411">//&nbsp;an&nbsp;HTTP&nbsp;server&nbsp;can&nbsp;set&nbsp;a&nbsp;cookie&nbsp;for&nbsp;a&nbsp;domain.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5467461">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5467465">//&nbsp;A&nbsp;nil&nbsp;value&nbsp;is&nbsp;valid&nbsp;and&nbsp;may&nbsp;be&nbsp;useful&nbsp;for&nbsp;testing&nbsp;but&nbsp;it&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5467534">//&nbsp;secure:&nbsp;it&nbsp;means&nbsp;that&nbsp;the&nbsp;HTTP&nbsp;server&nbsp;for&nbsp;foo.co.uk&nbsp;can&nbsp;set&nbsp;a&nbsp;cookie</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5467607">//&nbsp;for&nbsp;bar.co.uk.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467626">PublicSuffixList</span>&nbsp;<span class="ident" id="5467643">PublicSuffixList</span><br>
<span class="lineno"></span><span class="op" id="5467660">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5467663">//&nbsp;Jar&nbsp;implements&nbsp;the&nbsp;http.CookieJar&nbsp;interface&nbsp;from&nbsp;the&nbsp;net/http&nbsp;package.</span><br>
<span class="lineno">60</span><span class="keyword" id="5467737">type</span>&nbsp;<span class="ident" id="5467742">Jar</span>&nbsp;<span class="keyword" id="5467746">struct</span>&nbsp;<span class="op" id="5467753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467756">psList</span>&nbsp;<span class="ident" id="5467763">PublicSuffixList</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5467782">//&nbsp;mu&nbsp;locks&nbsp;the&nbsp;remaining&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467817">mu</span>&nbsp;<span class="ident" id="5467820">sync</span><span class="op" id="5467824">.</span><span class="ident" id="5467825">Mutex</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5467833">//&nbsp;entries&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;entries,&nbsp;keyed&nbsp;by&nbsp;their&nbsp;eTLD+1&nbsp;and&nbsp;subkeyed&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5467904">//&nbsp;their&nbsp;name/domain/path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467932">entries</span>&nbsp;<span class="keyword" id="5467940">map</span><span class="op" id="5467943">[</span><span class="builtintype" id="5467944">string</span><span class="op" id="5467950">]</span><span class="keyword" id="5467951">map</span><span class="op" id="5467954">[</span><span class="builtintype" id="5467955">string</span><span class="op" id="5467961">]</span><span class="ident" id="5467962">entry</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5467970">//&nbsp;nextSeqNum&nbsp;is&nbsp;the&nbsp;next&nbsp;sequence&nbsp;number&nbsp;assigned&nbsp;to&nbsp;a&nbsp;new&nbsp;cookie</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5468038">//&nbsp;created&nbsp;SetCookies.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5468062">nextSeqNum</span>&nbsp;<span class="ident" id="5468073">uint64</span><br>
<span class="lineno"></span><span class="op" id="5468080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="5468083">//&nbsp;New&nbsp;returns&nbsp;a&nbsp;new&nbsp;cookie&nbsp;jar.&nbsp;A&nbsp;nil&nbsp;*Options&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;a&nbsp;zero</span><br>
<span class="lineno"></span><span class="comment" id="5468155">//&nbsp;Options.</span><br>
<span class="lineno"></span><span class="keyword" id="5468167">func</span>&nbsp;<span class="ident" id="5468172">New</span><span class="op" id="5468175">(</span><span class="ident" id="5468176">o</span>&nbsp;<span class="op" id="5468178">*</span><span class="ident" id="5468179">Options</span><span class="op" id="5468186">)</span>&nbsp;<span class="op" id="5468188">(</span><span class="op" id="5468189">*</span><span class="ident" id="5468190">Jar</span><span class="op" id="5468193">,</span>&nbsp;<span class="builtintype" id="5468195">error</span><span class="op" id="5468200">)</span>&nbsp;<span class="op" id="5468202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5468205">jar</span>&nbsp;<span class="op" id="5468209">:=</span>&nbsp;<span class="op" id="5468212">&amp;</span><span class="ident" id="5468213">Jar</span><span class="op" id="5468216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5468220">entries</span><span class="op" id="5468227">:</span>&nbsp;<span class="builtinfunc" id="5468229">make</span><span class="op" id="5468233">(</span><span class="keyword" id="5468234">map</span><span class="op" id="5468237">[</span><span class="builtintype" id="5468238">string</span><span class="op" id="5468244">]</span><span class="keyword" id="5468245">map</span><span class="op" id="5468248">[</span><span class="builtintype" id="5468249">string</span><span class="op" id="5468255">]</span><span class="ident" id="5468256">entry</span><span class="op" id="5468261">)</span><span class="op" id="5468262">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5468265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5468268">if</span>&nbsp;<span class="ident" id="5468271">o</span>&nbsp;<span class="op" id="5468273">!=</span>&nbsp;<span class="ident" id="5468276">nil</span>&nbsp;<span class="op" id="5468280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5468284">jar</span><span class="op" id="5468287">.</span><span class="ident" id="5468288">psList</span>&nbsp;<span class="op" id="5468295">=</span>&nbsp;<span class="ident" id="5468297">o</span><span class="op" id="5468298">.</span><span class="ident" id="5468299">PublicSuffixList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5468317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5468320">return</span>&nbsp;<span class="ident" id="5468327">jar</span><span class="op" id="5468330">,</span>&nbsp;<span class="ident" id="5468332">nil</span><br>
<span class="lineno">85</span><span class="op" id="5468336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5468339">//&nbsp;entry&nbsp;is&nbsp;the&nbsp;internal&nbsp;representation&nbsp;of&nbsp;a&nbsp;cookie.</span><br>
<span class="lineno"></span><span class="comment" id="5468392">//</span><br>
<span class="lineno"></span><span class="comment" id="5468395">//&nbsp;This&nbsp;struct&nbsp;type&nbsp;is&nbsp;not&nbsp;used&nbsp;outside&nbsp;of&nbsp;this&nbsp;package&nbsp;per&nbsp;se,&nbsp;but&nbsp;the&nbsp;exported</span><br>
<span class="lineno">90</span><span class="comment" id="5468476">//&nbsp;fields&nbsp;are&nbsp;those&nbsp;of&nbsp;RFC&nbsp;6265.</span><br>
<span class="lineno"></span><span class="keyword" id="5468509">type</span>&nbsp;<span class="ident" id="5468514">entry</span>&nbsp;<span class="keyword" id="5468520">struct</span>&nbsp;<span class="op" id="5468527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5468530">Name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5468541">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5468549">Value</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5468560">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5468568">Domain</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5468579">string</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5468587">Path</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5468598">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5468606">Secure</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5468617">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5468623">HttpOnly</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5468634">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5468640">Persistent</span>&nbsp;<span class="builtintype" id="5468651">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5468657">HostOnly</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5468668">bool</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5468674">Expires</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5468685">time</span><span class="op" id="5468689">.</span><span class="ident" id="5468690">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5468696">Creation</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5468707">time</span><span class="op" id="5468711">.</span><span class="ident" id="5468712">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5468718">LastAccess</span>&nbsp;<span class="ident" id="5468729">time</span><span class="op" id="5468733">.</span><span class="ident" id="5468734">Time</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5468741">//&nbsp;seqNum&nbsp;is&nbsp;a&nbsp;sequence&nbsp;number&nbsp;so&nbsp;that&nbsp;Cookies&nbsp;returns&nbsp;cookies&nbsp;in&nbsp;a</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5468810">//&nbsp;deterministic&nbsp;order,&nbsp;even&nbsp;for&nbsp;cookies&nbsp;that&nbsp;have&nbsp;equal&nbsp;Path&nbsp;length&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5468884">//&nbsp;equal&nbsp;Creation&nbsp;time.&nbsp;This&nbsp;simplifies&nbsp;testing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5468934">seqNum</span>&nbsp;<span class="ident" id="5468941">uint64</span><br>
<span class="lineno"></span><span class="op" id="5468948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="5468951">//&nbsp;Id&nbsp;returns&nbsp;the&nbsp;domain;path;name&nbsp;triple&nbsp;of&nbsp;e&nbsp;as&nbsp;an&nbsp;id.</span><br>
<span class="lineno"></span><span class="keyword" id="5469008">func</span>&nbsp;<span class="op" id="5469013">(</span><span class="ident" id="5469014">e</span>&nbsp;<span class="op" id="5469016">*</span><span class="ident" id="5469017">entry</span><span class="op" id="5469022">)</span>&nbsp;<span class="ident" id="5469024">id</span><span class="op" id="5469026">(</span><span class="op" id="5469027">)</span>&nbsp;<span class="builtintype" id="5469029">string</span>&nbsp;<span class="op" id="5469036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5469039">return</span>&nbsp;<span class="ident" id="5469046">fmt</span><span class="op" id="5469049">.</span><span class="ident" id="5469050">Sprintf</span><span class="op" id="5469057">(</span><span class="string" id="5469058">&#34;%s;%s;%s&#34;</span><span class="op" id="5469068">,</span>&nbsp;<span class="ident" id="5469070">e</span><span class="op" id="5469071">.</span><span class="ident" id="5469072">Domain</span><span class="op" id="5469078">,</span>&nbsp;<span class="ident" id="5469080">e</span><span class="op" id="5469081">.</span><span class="ident" id="5469082">Path</span><span class="op" id="5469086">,</span>&nbsp;<span class="ident" id="5469088">e</span><span class="op" id="5469089">.</span><span class="ident" id="5469090">Name</span><span class="op" id="5469094">)</span><br>
<span class="lineno"></span><span class="op" id="5469096">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="5469099">//&nbsp;shouldSend&nbsp;determines&nbsp;whether&nbsp;e&#39;s&nbsp;cookie&nbsp;qualifies&nbsp;to&nbsp;be&nbsp;included&nbsp;in&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5469173">//&nbsp;request&nbsp;to&nbsp;host/path.&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;check&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5469248">//&nbsp;cookie&nbsp;is&nbsp;expired.</span><br>
<span class="lineno"></span><span class="keyword" id="5469270">func</span>&nbsp;<span class="op" id="5469275">(</span><span class="ident" id="5469276">e</span>&nbsp;<span class="op" id="5469278">*</span><span class="ident" id="5469279">entry</span><span class="op" id="5469284">)</span>&nbsp;<span class="ident" id="5469286">shouldSend</span><span class="op" id="5469296">(</span><span class="ident" id="5469297">https</span>&nbsp;<span class="builtintype" id="5469303">bool</span><span class="op" id="5469307">,</span>&nbsp;<span class="ident" id="5469309">host</span><span class="op" id="5469313">,</span>&nbsp;<span class="ident" id="5469315">path</span>&nbsp;<span class="builtintype" id="5469320">string</span><span class="op" id="5469326">)</span>&nbsp;<span class="builtintype" id="5469328">bool</span>&nbsp;<span class="op" id="5469333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5469336">return</span>&nbsp;<span class="ident" id="5469343">e</span><span class="op" id="5469344">.</span><span class="ident" id="5469345">domainMatch</span><span class="op" id="5469356">(</span><span class="ident" id="5469357">host</span><span class="op" id="5469361">)</span>&nbsp;<span class="op" id="5469363">&amp;&amp;</span>&nbsp;<span class="ident" id="5469366">e</span><span class="op" id="5469367">.</span><span class="ident" id="5469368">pathMatch</span><span class="op" id="5469377">(</span><span class="ident" id="5469378">path</span><span class="op" id="5469382">)</span>&nbsp;<span class="op" id="5469384">&amp;&amp;</span>&nbsp;<span class="op" id="5469387">(</span><span class="ident" id="5469388">https</span>&nbsp;<span class="op" id="5469394">||</span>&nbsp;<span class="op" id="5469397">!</span><span class="ident" id="5469398">e</span><span class="op" id="5469399">.</span><span class="ident" id="5469400">Secure</span><span class="op" id="5469406">)</span><br>
<span class="lineno">120</span><span class="op" id="5469408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5469411">//&nbsp;domainMatch&nbsp;implements&nbsp;&#34;domain-match&#34;&nbsp;of&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.1.3.</span><br>
<span class="lineno"></span><span class="keyword" id="5469479">func</span>&nbsp;<span class="op" id="5469484">(</span><span class="ident" id="5469485">e</span>&nbsp;<span class="op" id="5469487">*</span><span class="ident" id="5469488">entry</span><span class="op" id="5469493">)</span>&nbsp;<span class="ident" id="5469495">domainMatch</span><span class="op" id="5469506">(</span><span class="ident" id="5469507">host</span>&nbsp;<span class="builtintype" id="5469512">string</span><span class="op" id="5469518">)</span>&nbsp;<span class="builtintype" id="5469520">bool</span>&nbsp;<span class="op" id="5469525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5469528">if</span>&nbsp;<span class="ident" id="5469531">e</span><span class="op" id="5469532">.</span><span class="ident" id="5469533">Domain</span>&nbsp;<span class="op" id="5469540">==</span>&nbsp;<span class="ident" id="5469543">host</span>&nbsp;<span class="op" id="5469548">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5469552">return</span>&nbsp;<span class="builtintype" id="5469559">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5469565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5469568">return</span>&nbsp;<span class="op" id="5469575">!</span><span class="ident" id="5469576">e</span><span class="op" id="5469577">.</span><span class="ident" id="5469578">HostOnly</span>&nbsp;<span class="op" id="5469587">&amp;&amp;</span>&nbsp;<span class="ident" id="5469590">hasDotSuffix</span><span class="op" id="5469602">(</span><span class="ident" id="5469603">host</span><span class="op" id="5469607">,</span>&nbsp;<span class="ident" id="5469609">e</span><span class="op" id="5469610">.</span><span class="ident" id="5469611">Domain</span><span class="op" id="5469617">)</span><br>
<span class="lineno"></span><span class="op" id="5469619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="5469622">//&nbsp;pathMatch&nbsp;implements&nbsp;&#34;path-match&#34;&nbsp;according&nbsp;to&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.1.4.</span><br>
<span class="lineno"></span><span class="keyword" id="5469696">func</span>&nbsp;<span class="op" id="5469701">(</span><span class="ident" id="5469702">e</span>&nbsp;<span class="op" id="5469704">*</span><span class="ident" id="5469705">entry</span><span class="op" id="5469710">)</span>&nbsp;<span class="ident" id="5469712">pathMatch</span><span class="op" id="5469721">(</span><span class="ident" id="5469722">requestPath</span>&nbsp;<span class="builtintype" id="5469734">string</span><span class="op" id="5469740">)</span>&nbsp;<span class="builtintype" id="5469742">bool</span>&nbsp;<span class="op" id="5469747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5469750">if</span>&nbsp;<span class="ident" id="5469753">requestPath</span>&nbsp;<span class="op" id="5469765">==</span>&nbsp;<span class="ident" id="5469768">e</span><span class="op" id="5469769">.</span><span class="ident" id="5469770">Path</span>&nbsp;<span class="op" id="5469775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5469779">return</span>&nbsp;<span class="builtintype" id="5469786">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5469792">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5469795">if</span>&nbsp;<span class="ident" id="5469798">strings</span><span class="op" id="5469805">.</span><span class="ident" id="5469806">HasPrefix</span><span class="op" id="5469815">(</span><span class="ident" id="5469816">requestPath</span><span class="op" id="5469827">,</span>&nbsp;<span class="ident" id="5469829">e</span><span class="op" id="5469830">.</span><span class="ident" id="5469831">Path</span><span class="op" id="5469835">)</span>&nbsp;<span class="op" id="5469837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5469841">if</span>&nbsp;<span class="ident" id="5469844">e</span><span class="op" id="5469845">.</span><span class="ident" id="5469846">Path</span><span class="op" id="5469850">[</span><span class="builtinfunc" id="5469851">len</span><span class="op" id="5469854">(</span><span class="ident" id="5469855">e</span><span class="op" id="5469856">.</span><span class="ident" id="5469857">Path</span><span class="op" id="5469861">)</span><span class="op" id="5469862">-</span><span class="num" id="5469863">1</span><span class="op" id="5469864">]</span>&nbsp;<span class="op" id="5469866">==</span>&nbsp;<span class="string" id="5469869">&#39;/&#39;</span>&nbsp;<span class="op" id="5469873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5469878">return</span>&nbsp;<span class="builtintype" id="5469885">true</span>&nbsp;<span class="comment" id="5469890">//&nbsp;The&nbsp;&#34;/any/&#34;&nbsp;matches&nbsp;&#34;/any/path&#34;&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5469933">}</span>&nbsp;<span class="keyword" id="5469935">else</span>&nbsp;<span class="keyword" id="5469940">if</span>&nbsp;<span class="ident" id="5469943">requestPath</span><span class="op" id="5469954">[</span><span class="builtinfunc" id="5469955">len</span><span class="op" id="5469958">(</span><span class="ident" id="5469959">e</span><span class="op" id="5469960">.</span><span class="ident" id="5469961">Path</span><span class="op" id="5469965">)</span><span class="op" id="5469966">]</span>&nbsp;<span class="op" id="5469968">==</span>&nbsp;<span class="string" id="5469971">&#39;/&#39;</span>&nbsp;<span class="op" id="5469975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5469980">return</span>&nbsp;<span class="builtintype" id="5469987">true</span>&nbsp;<span class="comment" id="5469992">//&nbsp;The&nbsp;&#34;/any&#34;&nbsp;matches&nbsp;&#34;/any/path&#34;&nbsp;case.</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5470034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5470037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5470040">return</span>&nbsp;<span class="builtintype" id="5470047">false</span><br>
<span class="lineno"></span><span class="op" id="5470053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="5470056">//&nbsp;hasDotSuffix&nbsp;reports&nbsp;whether&nbsp;s&nbsp;ends&nbsp;in&nbsp;&#34;.&#34;+suffix.</span><br>
<span class="lineno"></span><span class="keyword" id="5470110">func</span>&nbsp;<span class="ident" id="5470115">hasDotSuffix</span><span class="op" id="5470127">(</span><span class="ident" id="5470128">s</span><span class="op" id="5470129">,</span>&nbsp;<span class="ident" id="5470131">suffix</span>&nbsp;<span class="builtintype" id="5470138">string</span><span class="op" id="5470144">)</span>&nbsp;<span class="builtintype" id="5470146">bool</span>&nbsp;<span class="op" id="5470151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5470154">return</span>&nbsp;<span class="builtinfunc" id="5470161">len</span><span class="op" id="5470164">(</span><span class="ident" id="5470165">s</span><span class="op" id="5470166">)</span>&nbsp;<span class="op" id="5470168">&gt;</span>&nbsp;<span class="builtinfunc" id="5470170">len</span><span class="op" id="5470173">(</span><span class="ident" id="5470174">suffix</span><span class="op" id="5470180">)</span>&nbsp;<span class="op" id="5470182">&amp;&amp;</span>&nbsp;<span class="ident" id="5470185">s</span><span class="op" id="5470186">[</span><span class="builtinfunc" id="5470187">len</span><span class="op" id="5470190">(</span><span class="ident" id="5470191">s</span><span class="op" id="5470192">)</span><span class="op" id="5470193">-</span><span class="builtinfunc" id="5470194">len</span><span class="op" id="5470197">(</span><span class="ident" id="5470198">suffix</span><span class="op" id="5470204">)</span><span class="op" id="5470205">-</span><span class="num" id="5470206">1</span><span class="op" id="5470207">]</span>&nbsp;<span class="op" id="5470209">==</span>&nbsp;<span class="string" id="5470212">&#39;.&#39;</span>&nbsp;<span class="op" id="5470216">&amp;&amp;</span>&nbsp;<span class="ident" id="5470219">s</span><span class="op" id="5470220">[</span><span class="builtinfunc" id="5470221">len</span><span class="op" id="5470224">(</span><span class="ident" id="5470225">s</span><span class="op" id="5470226">)</span><span class="op" id="5470227">-</span><span class="builtinfunc" id="5470228">len</span><span class="op" id="5470231">(</span><span class="ident" id="5470232">suffix</span><span class="op" id="5470238">)</span><span class="op" id="5470239">:</span><span class="op" id="5470240">]</span>&nbsp;<span class="op" id="5470242">==</span>&nbsp;<span class="ident" id="5470245">suffix</span><br>
<span class="lineno"></span><span class="op" id="5470252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="5470255">//&nbsp;byPathLength&nbsp;is&nbsp;a&nbsp;[]entry&nbsp;sort.Interface&nbsp;that&nbsp;sorts&nbsp;according&nbsp;to&nbsp;RFC&nbsp;6265</span><br>
<span class="lineno"></span><span class="comment" id="5470332">//&nbsp;section&nbsp;5.4&nbsp;point&nbsp;2:&nbsp;by&nbsp;longest&nbsp;path&nbsp;and&nbsp;then&nbsp;by&nbsp;earliest&nbsp;creation&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="5470408">type</span>&nbsp;<span class="ident" id="5470413">byPathLength</span>&nbsp;<span class="op" id="5470426">[</span><span class="op" id="5470427">]</span><span class="ident" id="5470428">entry</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5470435">func</span>&nbsp;<span class="op" id="5470440">(</span><span class="ident" id="5470441">s</span>&nbsp;<span class="ident" id="5470443">byPathLength</span><span class="op" id="5470455">)</span>&nbsp;<span class="ident" id="5470457">Len</span><span class="op" id="5470460">(</span><span class="op" id="5470461">)</span>&nbsp;<span class="builtintype" id="5470463">int</span>&nbsp;<span class="op" id="5470467">{</span>&nbsp;<span class="keyword" id="5470469">return</span>&nbsp;<span class="builtinfunc" id="5470476">len</span><span class="op" id="5470479">(</span><span class="ident" id="5470480">s</span><span class="op" id="5470481">)</span>&nbsp;<span class="op" id="5470483">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="5470486">func</span>&nbsp;<span class="op" id="5470491">(</span><span class="ident" id="5470492">s</span>&nbsp;<span class="ident" id="5470494">byPathLength</span><span class="op" id="5470506">)</span>&nbsp;<span class="ident" id="5470508">Less</span><span class="op" id="5470512">(</span><span class="ident" id="5470513">i</span><span class="op" id="5470514">,</span>&nbsp;<span class="ident" id="5470516">j</span>&nbsp;<span class="builtintype" id="5470518">int</span><span class="op" id="5470521">)</span>&nbsp;<span class="builtintype" id="5470523">bool</span>&nbsp;<span class="op" id="5470528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5470531">if</span>&nbsp;<span class="builtinfunc" id="5470534">len</span><span class="op" id="5470537">(</span><span class="ident" id="5470538">s</span><span class="op" id="5470539">[</span><span class="ident" id="5470540">i</span><span class="op" id="5470541">]</span><span class="op" id="5470542">.</span><span class="ident" id="5470543">Path</span><span class="op" id="5470547">)</span>&nbsp;<span class="op" id="5470549">!=</span>&nbsp;<span class="builtinfunc" id="5470552">len</span><span class="op" id="5470555">(</span><span class="ident" id="5470556">s</span><span class="op" id="5470557">[</span><span class="ident" id="5470558">j</span><span class="op" id="5470559">]</span><span class="op" id="5470560">.</span><span class="ident" id="5470561">Path</span><span class="op" id="5470565">)</span>&nbsp;<span class="op" id="5470567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5470571">return</span>&nbsp;<span class="builtinfunc" id="5470578">len</span><span class="op" id="5470581">(</span><span class="ident" id="5470582">s</span><span class="op" id="5470583">[</span><span class="ident" id="5470584">i</span><span class="op" id="5470585">]</span><span class="op" id="5470586">.</span><span class="ident" id="5470587">Path</span><span class="op" id="5470591">)</span>&nbsp;<span class="op" id="5470593">&gt;</span>&nbsp;<span class="builtinfunc" id="5470595">len</span><span class="op" id="5470598">(</span><span class="ident" id="5470599">s</span><span class="op" id="5470600">[</span><span class="ident" id="5470601">j</span><span class="op" id="5470602">]</span><span class="op" id="5470603">.</span><span class="ident" id="5470604">Path</span><span class="op" id="5470608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5470611">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5470614">if</span>&nbsp;<span class="op" id="5470617">!</span><span class="ident" id="5470618">s</span><span class="op" id="5470619">[</span><span class="ident" id="5470620">i</span><span class="op" id="5470621">]</span><span class="op" id="5470622">.</span><span class="ident" id="5470623">Creation</span><span class="op" id="5470631">.</span><span class="ident" id="5470632">Equal</span><span class="op" id="5470637">(</span><span class="ident" id="5470638">s</span><span class="op" id="5470639">[</span><span class="ident" id="5470640">j</span><span class="op" id="5470641">]</span><span class="op" id="5470642">.</span><span class="ident" id="5470643">Creation</span><span class="op" id="5470651">)</span>&nbsp;<span class="op" id="5470653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5470657">return</span>&nbsp;<span class="ident" id="5470664">s</span><span class="op" id="5470665">[</span><span class="ident" id="5470666">i</span><span class="op" id="5470667">]</span><span class="op" id="5470668">.</span><span class="ident" id="5470669">Creation</span><span class="op" id="5470677">.</span><span class="ident" id="5470678">Before</span><span class="op" id="5470684">(</span><span class="ident" id="5470685">s</span><span class="op" id="5470686">[</span><span class="ident" id="5470687">j</span><span class="op" id="5470688">]</span><span class="op" id="5470689">.</span><span class="ident" id="5470690">Creation</span><span class="op" id="5470698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5470701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5470704">return</span>&nbsp;<span class="ident" id="5470711">s</span><span class="op" id="5470712">[</span><span class="ident" id="5470713">i</span><span class="op" id="5470714">]</span><span class="op" id="5470715">.</span><span class="ident" id="5470716">seqNum</span>&nbsp;<span class="op" id="5470723">&lt;</span>&nbsp;<span class="ident" id="5470725">s</span><span class="op" id="5470726">[</span><span class="ident" id="5470727">j</span><span class="op" id="5470728">]</span><span class="op" id="5470729">.</span><span class="ident" id="5470730">seqNum</span><br>
<span class="lineno"></span><span class="op" id="5470737">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="5470740">func</span>&nbsp;<span class="op" id="5470745">(</span><span class="ident" id="5470746">s</span>&nbsp;<span class="ident" id="5470748">byPathLength</span><span class="op" id="5470760">)</span>&nbsp;<span class="ident" id="5470762">Swap</span><span class="op" id="5470766">(</span><span class="ident" id="5470767">i</span><span class="op" id="5470768">,</span>&nbsp;<span class="ident" id="5470770">j</span>&nbsp;<span class="builtintype" id="5470772">int</span><span class="op" id="5470775">)</span>&nbsp;<span class="op" id="5470777">{</span>&nbsp;<span class="ident" id="5470779">s</span><span class="op" id="5470780">[</span><span class="ident" id="5470781">i</span><span class="op" id="5470782">]</span><span class="op" id="5470783">,</span>&nbsp;<span class="ident" id="5470785">s</span><span class="op" id="5470786">[</span><span class="ident" id="5470787">j</span><span class="op" id="5470788">]</span>&nbsp;<span class="op" id="5470790">=</span>&nbsp;<span class="ident" id="5470792">s</span><span class="op" id="5470793">[</span><span class="ident" id="5470794">j</span><span class="op" id="5470795">]</span><span class="op" id="5470796">,</span>&nbsp;<span class="ident" id="5470798">s</span><span class="op" id="5470799">[</span><span class="ident" id="5470800">i</span><span class="op" id="5470801">]</span>&nbsp;<span class="op" id="5470803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5470806">//&nbsp;Cookies&nbsp;implements&nbsp;the&nbsp;Cookies&nbsp;method&nbsp;of&nbsp;the&nbsp;http.CookieJar&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="5470880">//</span><br>
<span class="lineno">170</span><span class="comment" id="5470883">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;empty&nbsp;slice&nbsp;if&nbsp;the&nbsp;URL&#39;s&nbsp;scheme&nbsp;is&nbsp;not&nbsp;HTTP&nbsp;or&nbsp;HTTPS.</span><br>
<span class="lineno"></span><span class="keyword" id="5470954">func</span>&nbsp;<span class="op" id="5470959">(</span><span class="ident" id="5470960">j</span>&nbsp;<span class="op" id="5470962">*</span><span class="ident" id="5470963">Jar</span><span class="op" id="5470966">)</span>&nbsp;<span class="ident" id="5470968">Cookies</span><span class="op" id="5470975">(</span><span class="ident" id="5470976">u</span>&nbsp;<span class="op" id="5470978">*</span><span class="ident" id="5470979">url</span><span class="op" id="5470982">.</span><span class="ident" id="5470983">URL</span><span class="op" id="5470986">)</span>&nbsp;<span class="op" id="5470988">(</span><span class="ident" id="5470989">cookies</span>&nbsp;<span class="op" id="5470997">[</span><span class="op" id="5470998">]</span><span class="op" id="5470999">*</span><span class="ident" id="5471000">http</span><span class="op" id="5471004">.</span><span class="ident" id="5471005">Cookie</span><span class="op" id="5471011">)</span>&nbsp;<span class="op" id="5471013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471016">return</span>&nbsp;<span class="ident" id="5471023">j</span><span class="op" id="5471024">.</span><span class="ident" id="5471025">cookies</span><span class="op" id="5471032">(</span><span class="ident" id="5471033">u</span><span class="op" id="5471034">,</span>&nbsp;<span class="ident" id="5471036">time</span><span class="op" id="5471040">.</span><span class="ident" id="5471041">Now</span><span class="op" id="5471044">(</span><span class="op" id="5471045">)</span><span class="op" id="5471046">)</span><br>
<span class="lineno"></span><span class="op" id="5471048">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="5471051">//&nbsp;cookies&nbsp;is&nbsp;like&nbsp;Cookies&nbsp;but&nbsp;takes&nbsp;the&nbsp;current&nbsp;time&nbsp;as&nbsp;a&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="keyword" id="5471121">func</span>&nbsp;<span class="op" id="5471126">(</span><span class="ident" id="5471127">j</span>&nbsp;<span class="op" id="5471129">*</span><span class="ident" id="5471130">Jar</span><span class="op" id="5471133">)</span>&nbsp;<span class="ident" id="5471135">cookies</span><span class="op" id="5471142">(</span><span class="ident" id="5471143">u</span>&nbsp;<span class="op" id="5471145">*</span><span class="ident" id="5471146">url</span><span class="op" id="5471149">.</span><span class="ident" id="5471150">URL</span><span class="op" id="5471153">,</span>&nbsp;<span class="ident" id="5471155">now</span>&nbsp;<span class="ident" id="5471159">time</span><span class="op" id="5471163">.</span><span class="ident" id="5471164">Time</span><span class="op" id="5471168">)</span>&nbsp;<span class="op" id="5471170">(</span><span class="ident" id="5471171">cookies</span>&nbsp;<span class="op" id="5471179">[</span><span class="op" id="5471180">]</span><span class="op" id="5471181">*</span><span class="ident" id="5471182">http</span><span class="op" id="5471186">.</span><span class="ident" id="5471187">Cookie</span><span class="op" id="5471193">)</span>&nbsp;<span class="op" id="5471195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471198">if</span>&nbsp;<span class="ident" id="5471201">u</span><span class="op" id="5471202">.</span><span class="ident" id="5471203">Scheme</span>&nbsp;<span class="op" id="5471210">!=</span>&nbsp;<span class="string" id="5471213">&#34;http&#34;</span>&nbsp;<span class="op" id="5471220">&amp;&amp;</span>&nbsp;<span class="ident" id="5471223">u</span><span class="op" id="5471224">.</span><span class="ident" id="5471225">Scheme</span>&nbsp;<span class="op" id="5471232">!=</span>&nbsp;<span class="string" id="5471235">&#34;https&#34;</span>&nbsp;<span class="op" id="5471243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471247">return</span>&nbsp;<span class="ident" id="5471254">cookies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5471263">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5471266">host</span><span class="op" id="5471270">,</span>&nbsp;<span class="ident" id="5471272">err</span>&nbsp;<span class="op" id="5471276">:=</span>&nbsp;<span class="ident" id="5471279">canonicalHost</span><span class="op" id="5471292">(</span><span class="ident" id="5471293">u</span><span class="op" id="5471294">.</span><span class="ident" id="5471295">Host</span><span class="op" id="5471299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471302">if</span>&nbsp;<span class="ident" id="5471305">err</span>&nbsp;<span class="op" id="5471309">!=</span>&nbsp;<span class="ident" id="5471312">nil</span>&nbsp;<span class="op" id="5471316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471320">return</span>&nbsp;<span class="ident" id="5471327">cookies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5471336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5471339">key</span>&nbsp;<span class="op" id="5471343">:=</span>&nbsp;<span class="ident" id="5471346">jarKey</span><span class="op" id="5471352">(</span><span class="ident" id="5471353">host</span><span class="op" id="5471357">,</span>&nbsp;<span class="ident" id="5471359">j</span><span class="op" id="5471360">.</span><span class="ident" id="5471361">psList</span><span class="op" id="5471367">)</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5471371">j</span><span class="op" id="5471372">.</span><span class="ident" id="5471373">mu</span><span class="op" id="5471375">.</span><span class="ident" id="5471376">Lock</span><span class="op" id="5471380">(</span><span class="op" id="5471381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471384">defer</span>&nbsp;<span class="ident" id="5471390">j</span><span class="op" id="5471391">.</span><span class="ident" id="5471392">mu</span><span class="op" id="5471394">.</span><span class="ident" id="5471395">Unlock</span><span class="op" id="5471401">(</span><span class="op" id="5471402">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5471406">submap</span>&nbsp;<span class="op" id="5471413">:=</span>&nbsp;<span class="ident" id="5471416">j</span><span class="op" id="5471417">.</span><span class="ident" id="5471418">entries</span><span class="op" id="5471425">[</span><span class="ident" id="5471426">key</span><span class="op" id="5471429">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471432">if</span>&nbsp;<span class="ident" id="5471435">submap</span>&nbsp;<span class="op" id="5471442">==</span>&nbsp;<span class="ident" id="5471445">nil</span>&nbsp;<span class="op" id="5471449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471453">return</span>&nbsp;<span class="ident" id="5471460">cookies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5471469">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5471473">https</span>&nbsp;<span class="op" id="5471479">:=</span>&nbsp;<span class="ident" id="5471482">u</span><span class="op" id="5471483">.</span><span class="ident" id="5471484">Scheme</span>&nbsp;<span class="op" id="5471491">==</span>&nbsp;<span class="string" id="5471494">&#34;https&#34;</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5471503">path</span>&nbsp;<span class="op" id="5471508">:=</span>&nbsp;<span class="ident" id="5471511">u</span><span class="op" id="5471512">.</span><span class="ident" id="5471513">Path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471519">if</span>&nbsp;<span class="ident" id="5471522">path</span>&nbsp;<span class="op" id="5471527">==</span>&nbsp;<span class="string" id="5471530">&#34;&#34;</span>&nbsp;<span class="op" id="5471533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5471537">path</span>&nbsp;<span class="op" id="5471542">=</span>&nbsp;<span class="string" id="5471544">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5471549">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5471553">modified</span>&nbsp;<span class="op" id="5471562">:=</span>&nbsp;<span class="builtintype" id="5471565">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471572">var</span>&nbsp;<span class="ident" id="5471576">selected</span>&nbsp;<span class="op" id="5471585">[</span><span class="op" id="5471586">]</span><span class="ident" id="5471587">entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471594">for</span>&nbsp;<span class="ident" id="5471598">id</span><span class="op" id="5471600">,</span>&nbsp;<span class="ident" id="5471602">e</span>&nbsp;<span class="op" id="5471604">:=</span>&nbsp;<span class="keyword" id="5471607">range</span>&nbsp;<span class="ident" id="5471613">submap</span>&nbsp;<span class="op" id="5471620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471624">if</span>&nbsp;<span class="ident" id="5471627">e</span><span class="op" id="5471628">.</span><span class="ident" id="5471629">Persistent</span>&nbsp;<span class="op" id="5471640">&amp;&amp;</span>&nbsp;<span class="op" id="5471643">!</span><span class="ident" id="5471644">e</span><span class="op" id="5471645">.</span><span class="ident" id="5471646">Expires</span><span class="op" id="5471653">.</span><span class="ident" id="5471654">After</span><span class="op" id="5471659">(</span><span class="ident" id="5471660">now</span><span class="op" id="5471663">)</span>&nbsp;<span class="op" id="5471665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5471670">delete</span><span class="op" id="5471676">(</span><span class="ident" id="5471677">submap</span><span class="op" id="5471683">,</span>&nbsp;<span class="ident" id="5471685">id</span><span class="op" id="5471687">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5471692">modified</span>&nbsp;<span class="op" id="5471701">=</span>&nbsp;<span class="builtintype" id="5471703">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471711">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5471722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471726">if</span>&nbsp;<span class="op" id="5471729">!</span><span class="ident" id="5471730">e</span><span class="op" id="5471731">.</span><span class="ident" id="5471732">shouldSend</span><span class="op" id="5471742">(</span><span class="ident" id="5471743">https</span><span class="op" id="5471748">,</span>&nbsp;<span class="ident" id="5471750">host</span><span class="op" id="5471754">,</span>&nbsp;<span class="ident" id="5471756">path</span><span class="op" id="5471760">)</span>&nbsp;<span class="op" id="5471762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471767">continue</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5471778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5471782">e</span><span class="op" id="5471783">.</span><span class="ident" id="5471784">LastAccess</span>&nbsp;<span class="op" id="5471795">=</span>&nbsp;<span class="ident" id="5471797">now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5471803">submap</span><span class="op" id="5471809">[</span><span class="ident" id="5471810">id</span><span class="op" id="5471812">]</span>&nbsp;<span class="op" id="5471814">=</span>&nbsp;<span class="ident" id="5471816">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5471820">selected</span>&nbsp;<span class="op" id="5471829">=</span>&nbsp;<span class="builtinfunc" id="5471831">append</span><span class="op" id="5471837">(</span><span class="ident" id="5471838">selected</span><span class="op" id="5471846">,</span>&nbsp;<span class="ident" id="5471848">e</span><span class="op" id="5471849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5471853">modified</span>&nbsp;<span class="op" id="5471862">=</span>&nbsp;<span class="builtintype" id="5471864">true</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5471870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471873">if</span>&nbsp;<span class="ident" id="5471876">modified</span>&nbsp;<span class="op" id="5471885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471889">if</span>&nbsp;<span class="builtinfunc" id="5471892">len</span><span class="op" id="5471895">(</span><span class="ident" id="5471896">submap</span><span class="op" id="5471902">)</span>&nbsp;<span class="op" id="5471904">==</span>&nbsp;<span class="num" id="5471907">0</span>&nbsp;<span class="op" id="5471909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5471914">delete</span><span class="op" id="5471920">(</span><span class="ident" id="5471921">j</span><span class="op" id="5471922">.</span><span class="ident" id="5471923">entries</span><span class="op" id="5471930">,</span>&nbsp;<span class="ident" id="5471932">key</span><span class="op" id="5471935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5471939">}</span>&nbsp;<span class="keyword" id="5471941">else</span>&nbsp;<span class="op" id="5471946">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5471951">j</span><span class="op" id="5471952">.</span><span class="ident" id="5471953">entries</span><span class="op" id="5471960">[</span><span class="ident" id="5471961">key</span><span class="op" id="5471964">]</span>&nbsp;<span class="op" id="5471966">=</span>&nbsp;<span class="ident" id="5471968">submap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5471977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5471980">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5471984">sort</span><span class="op" id="5471988">.</span><span class="ident" id="5471989">Sort</span><span class="op" id="5471993">(</span><span class="ident" id="5471994">byPathLength</span><span class="op" id="5472006">(</span><span class="ident" id="5472007">selected</span><span class="op" id="5472015">)</span><span class="op" id="5472016">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5472019">for</span>&nbsp;<span class="ident" id="5472023">_</span><span class="op" id="5472024">,</span>&nbsp;<span class="ident" id="5472026">e</span>&nbsp;<span class="op" id="5472028">:=</span>&nbsp;<span class="keyword" id="5472031">range</span>&nbsp;<span class="ident" id="5472037">selected</span>&nbsp;<span class="op" id="5472046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5472050">cookies</span>&nbsp;<span class="op" id="5472058">=</span>&nbsp;<span class="builtinfunc" id="5472060">append</span><span class="op" id="5472066">(</span><span class="ident" id="5472067">cookies</span><span class="op" id="5472074">,</span>&nbsp;<span class="op" id="5472076">&amp;</span><span class="ident" id="5472077">http</span><span class="op" id="5472081">.</span><span class="ident" id="5472082">Cookie</span><span class="op" id="5472088">{</span><span class="ident" id="5472089">Name</span><span class="op" id="5472093">:</span>&nbsp;<span class="ident" id="5472095">e</span><span class="op" id="5472096">.</span><span class="ident" id="5472097">Name</span><span class="op" id="5472101">,</span>&nbsp;<span class="ident" id="5472103">Value</span><span class="op" id="5472108">:</span>&nbsp;<span class="ident" id="5472110">e</span><span class="op" id="5472111">.</span><span class="ident" id="5472112">Value</span><span class="op" id="5472117">}</span><span class="op" id="5472118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5472121">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5472125">return</span>&nbsp;<span class="ident" id="5472132">cookies</span><br>
<span class="lineno">230</span><span class="op" id="5472140">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5472143">//&nbsp;SetCookies&nbsp;implements&nbsp;the&nbsp;SetCookies&nbsp;method&nbsp;of&nbsp;the&nbsp;http.CookieJar&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="5472223">//</span><br>
<span class="lineno"></span><span class="comment" id="5472226">//&nbsp;It&nbsp;does&nbsp;nothing&nbsp;if&nbsp;the&nbsp;URL&#39;s&nbsp;scheme&nbsp;is&nbsp;not&nbsp;HTTP&nbsp;or&nbsp;HTTPS.</span><br>
<span class="lineno">235</span><span class="keyword" id="5472287">func</span>&nbsp;<span class="op" id="5472292">(</span><span class="ident" id="5472293">j</span>&nbsp;<span class="op" id="5472295">*</span><span class="ident" id="5472296">Jar</span><span class="op" id="5472299">)</span>&nbsp;<span class="ident" id="5472301">SetCookies</span><span class="op" id="5472311">(</span><span class="ident" id="5472312">u</span>&nbsp;<span class="op" id="5472314">*</span><span class="ident" id="5472315">url</span><span class="op" id="5472318">.</span><span class="ident" id="5472319">URL</span><span class="op" id="5472322">,</span>&nbsp;<span class="ident" id="5472324">cookies</span>&nbsp;<span class="op" id="5472332">[</span><span class="op" id="5472333">]</span><span class="op" id="5472334">*</span><span class="ident" id="5472335">http</span><span class="op" id="5472339">.</span><span class="ident" id="5472340">Cookie</span><span class="op" id="5472346">)</span>&nbsp;<span class="op" id="5472348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5472351">j</span><span class="op" id="5472352">.</span><span class="ident" id="5472353">setCookies</span><span class="op" id="5472363">(</span><span class="ident" id="5472364">u</span><span class="op" id="5472365">,</span>&nbsp;<span class="ident" id="5472367">cookies</span><span class="op" id="5472374">,</span>&nbsp;<span class="ident" id="5472376">time</span><span class="op" id="5472380">.</span><span class="ident" id="5472381">Now</span><span class="op" id="5472384">(</span><span class="op" id="5472385">)</span><span class="op" id="5472386">)</span><br>
<span class="lineno"></span><span class="op" id="5472388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5472391">//&nbsp;setCookies&nbsp;is&nbsp;like&nbsp;SetCookies&nbsp;but&nbsp;takes&nbsp;the&nbsp;current&nbsp;time&nbsp;as&nbsp;parameter.</span><br>
<span class="lineno">240</span><span class="keyword" id="5472465">func</span>&nbsp;<span class="op" id="5472470">(</span><span class="ident" id="5472471">j</span>&nbsp;<span class="op" id="5472473">*</span><span class="ident" id="5472474">Jar</span><span class="op" id="5472477">)</span>&nbsp;<span class="ident" id="5472479">setCookies</span><span class="op" id="5472489">(</span><span class="ident" id="5472490">u</span>&nbsp;<span class="op" id="5472492">*</span><span class="ident" id="5472493">url</span><span class="op" id="5472496">.</span><span class="ident" id="5472497">URL</span><span class="op" id="5472500">,</span>&nbsp;<span class="ident" id="5472502">cookies</span>&nbsp;<span class="op" id="5472510">[</span><span class="op" id="5472511">]</span><span class="op" id="5472512">*</span><span class="ident" id="5472513">http</span><span class="op" id="5472517">.</span><span class="ident" id="5472518">Cookie</span><span class="op" id="5472524">,</span>&nbsp;<span class="ident" id="5472526">now</span>&nbsp;<span class="ident" id="5472530">time</span><span class="op" id="5472534">.</span><span class="ident" id="5472535">Time</span><span class="op" id="5472539">)</span>&nbsp;<span class="op" id="5472541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5472544">if</span>&nbsp;<span class="builtinfunc" id="5472547">len</span><span class="op" id="5472550">(</span><span class="ident" id="5472551">cookies</span><span class="op" id="5472558">)</span>&nbsp;<span class="op" id="5472560">==</span>&nbsp;<span class="num" id="5472563">0</span>&nbsp;<span class="op" id="5472565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5472569">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5472577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5472580">if</span>&nbsp;<span class="ident" id="5472583">u</span><span class="op" id="5472584">.</span><span class="ident" id="5472585">Scheme</span>&nbsp;<span class="op" id="5472592">!=</span>&nbsp;<span class="string" id="5472595">&#34;http&#34;</span>&nbsp;<span class="op" id="5472602">&amp;&amp;</span>&nbsp;<span class="ident" id="5472605">u</span><span class="op" id="5472606">.</span><span class="ident" id="5472607">Scheme</span>&nbsp;<span class="op" id="5472614">!=</span>&nbsp;<span class="string" id="5472617">&#34;https&#34;</span>&nbsp;<span class="op" id="5472625">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5472629">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5472637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5472640">host</span><span class="op" id="5472644">,</span>&nbsp;<span class="ident" id="5472646">err</span>&nbsp;<span class="op" id="5472650">:=</span>&nbsp;<span class="ident" id="5472653">canonicalHost</span><span class="op" id="5472666">(</span><span class="ident" id="5472667">u</span><span class="op" id="5472668">.</span><span class="ident" id="5472669">Host</span><span class="op" id="5472673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5472676">if</span>&nbsp;<span class="ident" id="5472679">err</span>&nbsp;<span class="op" id="5472683">!=</span>&nbsp;<span class="ident" id="5472686">nil</span>&nbsp;<span class="op" id="5472690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5472694">return</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5472702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5472705">key</span>&nbsp;<span class="op" id="5472709">:=</span>&nbsp;<span class="ident" id="5472712">jarKey</span><span class="op" id="5472718">(</span><span class="ident" id="5472719">host</span><span class="op" id="5472723">,</span>&nbsp;<span class="ident" id="5472725">j</span><span class="op" id="5472726">.</span><span class="ident" id="5472727">psList</span><span class="op" id="5472733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5472736">defPath</span>&nbsp;<span class="op" id="5472744">:=</span>&nbsp;<span class="ident" id="5472747">defaultPath</span><span class="op" id="5472758">(</span><span class="ident" id="5472759">u</span><span class="op" id="5472760">.</span><span class="ident" id="5472761">Path</span><span class="op" id="5472765">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5472769">j</span><span class="op" id="5472770">.</span><span class="ident" id="5472771">mu</span><span class="op" id="5472773">.</span><span class="ident" id="5472774">Lock</span><span class="op" id="5472778">(</span><span class="op" id="5472779">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5472782">defer</span>&nbsp;<span class="ident" id="5472788">j</span><span class="op" id="5472789">.</span><span class="ident" id="5472790">mu</span><span class="op" id="5472792">.</span><span class="ident" id="5472793">Unlock</span><span class="op" id="5472799">(</span><span class="op" id="5472800">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5472804">submap</span>&nbsp;<span class="op" id="5472811">:=</span>&nbsp;<span class="ident" id="5472814">j</span><span class="op" id="5472815">.</span><span class="ident" id="5472816">entries</span><span class="op" id="5472823">[</span><span class="ident" id="5472824">key</span><span class="op" id="5472827">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5472831">modified</span>&nbsp;<span class="op" id="5472840">:=</span>&nbsp;<span class="builtintype" id="5472843">false</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5472850">for</span>&nbsp;<span class="ident" id="5472854">_</span><span class="op" id="5472855">,</span>&nbsp;<span class="ident" id="5472857">cookie</span>&nbsp;<span class="op" id="5472864">:=</span>&nbsp;<span class="keyword" id="5472867">range</span>&nbsp;<span class="ident" id="5472873">cookies</span>&nbsp;<span class="op" id="5472881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5472885">e</span><span class="op" id="5472886">,</span>&nbsp;<span class="ident" id="5472888">remove</span><span class="op" id="5472894">,</span>&nbsp;<span class="ident" id="5472896">err</span>&nbsp;<span class="op" id="5472900">:=</span>&nbsp;<span class="ident" id="5472903">j</span><span class="op" id="5472904">.</span><span class="ident" id="5472905">newEntry</span><span class="op" id="5472913">(</span><span class="ident" id="5472914">cookie</span><span class="op" id="5472920">,</span>&nbsp;<span class="ident" id="5472922">now</span><span class="op" id="5472925">,</span>&nbsp;<span class="ident" id="5472927">defPath</span><span class="op" id="5472934">,</span>&nbsp;<span class="ident" id="5472936">host</span><span class="op" id="5472940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5472944">if</span>&nbsp;<span class="ident" id="5472947">err</span>&nbsp;<span class="op" id="5472951">!=</span>&nbsp;<span class="ident" id="5472954">nil</span>&nbsp;<span class="op" id="5472958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5472963">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5472974">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5472978">id</span>&nbsp;<span class="op" id="5472981">:=</span>&nbsp;<span class="ident" id="5472984">e</span><span class="op" id="5472985">.</span><span class="ident" id="5472986">id</span><span class="op" id="5472988">(</span><span class="op" id="5472989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5472993">if</span>&nbsp;<span class="ident" id="5472996">remove</span>&nbsp;<span class="op" id="5473003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473008">if</span>&nbsp;<span class="ident" id="5473011">submap</span>&nbsp;<span class="op" id="5473018">!=</span>&nbsp;<span class="ident" id="5473021">nil</span>&nbsp;<span class="op" id="5473025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473031">if</span>&nbsp;<span class="ident" id="5473034">_</span><span class="op" id="5473035">,</span>&nbsp;<span class="ident" id="5473037">ok</span>&nbsp;<span class="op" id="5473040">:=</span>&nbsp;<span class="ident" id="5473043">submap</span><span class="op" id="5473049">[</span><span class="ident" id="5473050">id</span><span class="op" id="5473052">]</span><span class="op" id="5473053">;</span>&nbsp;<span class="ident" id="5473055">ok</span>&nbsp;<span class="op" id="5473058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5473065">delete</span><span class="op" id="5473071">(</span><span class="ident" id="5473072">submap</span><span class="op" id="5473078">,</span>&nbsp;<span class="ident" id="5473080">id</span><span class="op" id="5473082">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473089">modified</span>&nbsp;<span class="op" id="5473098">=</span>&nbsp;<span class="builtintype" id="5473100">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5473109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5473114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473119">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5473130">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473134">if</span>&nbsp;<span class="ident" id="5473137">submap</span>&nbsp;<span class="op" id="5473144">==</span>&nbsp;<span class="ident" id="5473147">nil</span>&nbsp;<span class="op" id="5473151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473156">submap</span>&nbsp;<span class="op" id="5473163">=</span>&nbsp;<span class="builtinfunc" id="5473165">make</span><span class="op" id="5473169">(</span><span class="keyword" id="5473170">map</span><span class="op" id="5473173">[</span><span class="builtintype" id="5473174">string</span><span class="op" id="5473180">]</span><span class="ident" id="5473181">entry</span><span class="op" id="5473186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5473190">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473195">if</span>&nbsp;<span class="ident" id="5473198">old</span><span class="op" id="5473201">,</span>&nbsp;<span class="ident" id="5473203">ok</span>&nbsp;<span class="op" id="5473206">:=</span>&nbsp;<span class="ident" id="5473209">submap</span><span class="op" id="5473215">[</span><span class="ident" id="5473216">id</span><span class="op" id="5473218">]</span><span class="op" id="5473219">;</span>&nbsp;<span class="ident" id="5473221">ok</span>&nbsp;<span class="op" id="5473224">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473229">e</span><span class="op" id="5473230">.</span><span class="ident" id="5473231">Creation</span>&nbsp;<span class="op" id="5473240">=</span>&nbsp;<span class="ident" id="5473242">old</span><span class="op" id="5473245">.</span><span class="ident" id="5473246">Creation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473258">e</span><span class="op" id="5473259">.</span><span class="ident" id="5473260">seqNum</span>&nbsp;<span class="op" id="5473267">=</span>&nbsp;<span class="ident" id="5473269">old</span><span class="op" id="5473272">.</span><span class="ident" id="5473273">seqNum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5473282">}</span>&nbsp;<span class="keyword" id="5473284">else</span>&nbsp;<span class="op" id="5473289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473294">e</span><span class="op" id="5473295">.</span><span class="ident" id="5473296">Creation</span>&nbsp;<span class="op" id="5473305">=</span>&nbsp;<span class="ident" id="5473307">now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473314">e</span><span class="op" id="5473315">.</span><span class="ident" id="5473316">seqNum</span>&nbsp;<span class="op" id="5473323">=</span>&nbsp;<span class="ident" id="5473325">j</span><span class="op" id="5473326">.</span><span class="ident" id="5473327">nextSeqNum</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473341">j</span><span class="op" id="5473342">.</span><span class="ident" id="5473343">nextSeqNum</span><span class="op" id="5473353">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5473358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473362">e</span><span class="op" id="5473363">.</span><span class="ident" id="5473364">LastAccess</span>&nbsp;<span class="op" id="5473375">=</span>&nbsp;<span class="ident" id="5473377">now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473383">submap</span><span class="op" id="5473389">[</span><span class="ident" id="5473390">id</span><span class="op" id="5473392">]</span>&nbsp;<span class="op" id="5473394">=</span>&nbsp;<span class="ident" id="5473396">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473400">modified</span>&nbsp;<span class="op" id="5473409">=</span>&nbsp;<span class="builtintype" id="5473411">true</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5473417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473421">if</span>&nbsp;<span class="ident" id="5473424">modified</span>&nbsp;<span class="op" id="5473433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473437">if</span>&nbsp;<span class="builtinfunc" id="5473440">len</span><span class="op" id="5473443">(</span><span class="ident" id="5473444">submap</span><span class="op" id="5473450">)</span>&nbsp;<span class="op" id="5473452">==</span>&nbsp;<span class="num" id="5473455">0</span>&nbsp;<span class="op" id="5473457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5473462">delete</span><span class="op" id="5473468">(</span><span class="ident" id="5473469">j</span><span class="op" id="5473470">.</span><span class="ident" id="5473471">entries</span><span class="op" id="5473478">,</span>&nbsp;<span class="ident" id="5473480">key</span><span class="op" id="5473483">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5473487">}</span>&nbsp;<span class="keyword" id="5473489">else</span>&nbsp;<span class="op" id="5473494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473499">j</span><span class="op" id="5473500">.</span><span class="ident" id="5473501">entries</span><span class="op" id="5473508">[</span><span class="ident" id="5473509">key</span><span class="op" id="5473512">]</span>&nbsp;<span class="op" id="5473514">=</span>&nbsp;<span class="ident" id="5473516">submap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5473525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5473528">}</span><br>
<span class="lineno"></span><span class="op" id="5473530">}</span><br>
<span class="lineno">300</span><br>
<span class="lineno"></span><span class="comment" id="5473533">//&nbsp;canonicalHost&nbsp;strips&nbsp;port&nbsp;from&nbsp;host&nbsp;if&nbsp;present&nbsp;and&nbsp;returns&nbsp;the&nbsp;canonicalized</span><br>
<span class="lineno"></span><span class="comment" id="5473613">//&nbsp;host&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="5473627">func</span>&nbsp;<span class="ident" id="5473632">canonicalHost</span><span class="op" id="5473645">(</span><span class="ident" id="5473646">host</span>&nbsp;<span class="builtintype" id="5473651">string</span><span class="op" id="5473657">)</span>&nbsp;<span class="op" id="5473659">(</span><span class="builtintype" id="5473660">string</span><span class="op" id="5473666">,</span>&nbsp;<span class="builtintype" id="5473668">error</span><span class="op" id="5473673">)</span>&nbsp;<span class="op" id="5473675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473678">var</span>&nbsp;<span class="ident" id="5473682">err</span>&nbsp;<span class="builtintype" id="5473686">error</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473693">host</span>&nbsp;<span class="op" id="5473698">=</span>&nbsp;<span class="ident" id="5473700">strings</span><span class="op" id="5473707">.</span><span class="ident" id="5473708">ToLower</span><span class="op" id="5473715">(</span><span class="ident" id="5473716">host</span><span class="op" id="5473720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473723">if</span>&nbsp;<span class="ident" id="5473726">hasPort</span><span class="op" id="5473733">(</span><span class="ident" id="5473734">host</span><span class="op" id="5473738">)</span>&nbsp;<span class="op" id="5473740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473744">host</span><span class="op" id="5473748">,</span>&nbsp;<span class="ident" id="5473750">_</span><span class="op" id="5473751">,</span>&nbsp;<span class="ident" id="5473753">err</span>&nbsp;<span class="op" id="5473757">=</span>&nbsp;<span class="ident" id="5473759">net</span><span class="op" id="5473762">.</span><span class="ident" id="5473763">SplitHostPort</span><span class="op" id="5473776">(</span><span class="ident" id="5473777">host</span><span class="op" id="5473781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473785">if</span>&nbsp;<span class="ident" id="5473788">err</span>&nbsp;<span class="op" id="5473792">!=</span>&nbsp;<span class="ident" id="5473795">nil</span>&nbsp;<span class="op" id="5473799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473804">return</span>&nbsp;<span class="string" id="5473811">&#34;&#34;</span><span class="op" id="5473813">,</span>&nbsp;<span class="ident" id="5473815">err</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5473821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5473824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473827">if</span>&nbsp;<span class="ident" id="5473830">strings</span><span class="op" id="5473837">.</span><span class="ident" id="5473838">HasSuffix</span><span class="op" id="5473847">(</span><span class="ident" id="5473848">host</span><span class="op" id="5473852">,</span>&nbsp;<span class="string" id="5473854">&#34;.&#34;</span><span class="op" id="5473857">)</span>&nbsp;<span class="op" id="5473859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5473863">//&nbsp;Strip&nbsp;trailing&nbsp;dot&nbsp;from&nbsp;fully&nbsp;qualified&nbsp;domain&nbsp;names.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473922">host</span>&nbsp;<span class="op" id="5473927">=</span>&nbsp;<span class="ident" id="5473929">host</span><span class="op" id="5473933">[</span><span class="op" id="5473934">:</span><span class="builtinfunc" id="5473935">len</span><span class="op" id="5473938">(</span><span class="ident" id="5473939">host</span><span class="op" id="5473943">)</span><span class="op" id="5473944">-</span><span class="num" id="5473945">1</span><span class="op" id="5473946">]</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5473949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473952">return</span>&nbsp;<span class="ident" id="5473959">toASCII</span><span class="op" id="5473966">(</span><span class="ident" id="5473967">host</span><span class="op" id="5473971">)</span><br>
<span class="lineno"></span><span class="op" id="5473973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5473976">//&nbsp;hasPort&nbsp;reports&nbsp;whether&nbsp;host&nbsp;contains&nbsp;a&nbsp;port&nbsp;number.&nbsp;host&nbsp;may&nbsp;be&nbsp;a&nbsp;host</span><br>
<span class="lineno">320</span><span class="comment" id="5474051">//&nbsp;name,&nbsp;an&nbsp;IPv4&nbsp;or&nbsp;an&nbsp;IPv6&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="5474088">func</span>&nbsp;<span class="ident" id="5474093">hasPort</span><span class="op" id="5474100">(</span><span class="ident" id="5474101">host</span>&nbsp;<span class="builtintype" id="5474106">string</span><span class="op" id="5474112">)</span>&nbsp;<span class="builtintype" id="5474114">bool</span>&nbsp;<span class="op" id="5474119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5474122">colons</span>&nbsp;<span class="op" id="5474129">:=</span>&nbsp;<span class="ident" id="5474132">strings</span><span class="op" id="5474139">.</span><span class="ident" id="5474140">Count</span><span class="op" id="5474145">(</span><span class="ident" id="5474146">host</span><span class="op" id="5474150">,</span>&nbsp;<span class="string" id="5474152">&#34;:&#34;</span><span class="op" id="5474155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474158">if</span>&nbsp;<span class="ident" id="5474161">colons</span>&nbsp;<span class="op" id="5474168">==</span>&nbsp;<span class="num" id="5474171">0</span>&nbsp;<span class="op" id="5474173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474177">return</span>&nbsp;<span class="builtintype" id="5474184">false</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5474191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474194">if</span>&nbsp;<span class="ident" id="5474197">colons</span>&nbsp;<span class="op" id="5474204">==</span>&nbsp;<span class="num" id="5474207">1</span>&nbsp;<span class="op" id="5474209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474213">return</span>&nbsp;<span class="builtintype" id="5474220">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5474226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474229">return</span>&nbsp;<span class="ident" id="5474236">host</span><span class="op" id="5474240">[</span><span class="num" id="5474241">0</span><span class="op" id="5474242">]</span>&nbsp;<span class="op" id="5474244">==</span>&nbsp;<span class="string" id="5474247">&#39;[&#39;</span>&nbsp;<span class="op" id="5474251">&amp;&amp;</span>&nbsp;<span class="ident" id="5474254">strings</span><span class="op" id="5474261">.</span><span class="ident" id="5474262">Contains</span><span class="op" id="5474270">(</span><span class="ident" id="5474271">host</span><span class="op" id="5474275">,</span>&nbsp;<span class="string" id="5474277">&#34;]:&#34;</span><span class="op" id="5474281">)</span><br>
<span class="lineno">330</span><span class="op" id="5474283">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5474286">//&nbsp;jarKey&nbsp;returns&nbsp;the&nbsp;key&nbsp;to&nbsp;use&nbsp;for&nbsp;a&nbsp;jar.</span><br>
<span class="lineno"></span><span class="keyword" id="5474330">func</span>&nbsp;<span class="ident" id="5474335">jarKey</span><span class="op" id="5474341">(</span><span class="ident" id="5474342">host</span>&nbsp;<span class="builtintype" id="5474347">string</span><span class="op" id="5474353">,</span>&nbsp;<span class="ident" id="5474355">psl</span>&nbsp;<span class="ident" id="5474359">PublicSuffixList</span><span class="op" id="5474375">)</span>&nbsp;<span class="builtintype" id="5474377">string</span>&nbsp;<span class="op" id="5474384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474387">if</span>&nbsp;<span class="ident" id="5474390">isIP</span><span class="op" id="5474394">(</span><span class="ident" id="5474395">host</span><span class="op" id="5474399">)</span>&nbsp;<span class="op" id="5474401">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474405">return</span>&nbsp;<span class="ident" id="5474412">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5474418">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474422">var</span>&nbsp;<span class="ident" id="5474426">i</span>&nbsp;<span class="builtintype" id="5474428">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474433">if</span>&nbsp;<span class="ident" id="5474436">psl</span>&nbsp;<span class="op" id="5474440">==</span>&nbsp;<span class="ident" id="5474443">nil</span>&nbsp;<span class="op" id="5474447">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5474451">i</span>&nbsp;<span class="op" id="5474453">=</span>&nbsp;<span class="ident" id="5474455">strings</span><span class="op" id="5474462">.</span><span class="ident" id="5474463">LastIndex</span><span class="op" id="5474472">(</span><span class="ident" id="5474473">host</span><span class="op" id="5474477">,</span>&nbsp;<span class="string" id="5474479">&#34;.&#34;</span><span class="op" id="5474482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474486">if</span>&nbsp;<span class="ident" id="5474489">i</span>&nbsp;<span class="op" id="5474491">==</span>&nbsp;<span class="op" id="5474494">-</span><span class="num" id="5474495">1</span>&nbsp;<span class="op" id="5474497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474502">return</span>&nbsp;<span class="ident" id="5474509">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5474516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5474519">}</span>&nbsp;<span class="keyword" id="5474521">else</span>&nbsp;<span class="op" id="5474526">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5474530">suffix</span>&nbsp;<span class="op" id="5474537">:=</span>&nbsp;<span class="ident" id="5474540">psl</span><span class="op" id="5474543">.</span><span class="ident" id="5474544">PublicSuffix</span><span class="op" id="5474556">(</span><span class="ident" id="5474557">host</span><span class="op" id="5474561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474565">if</span>&nbsp;<span class="ident" id="5474568">suffix</span>&nbsp;<span class="op" id="5474575">==</span>&nbsp;<span class="ident" id="5474578">host</span>&nbsp;<span class="op" id="5474583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474588">return</span>&nbsp;<span class="ident" id="5474595">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5474602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5474606">i</span>&nbsp;<span class="op" id="5474608">=</span>&nbsp;<span class="builtinfunc" id="5474610">len</span><span class="op" id="5474613">(</span><span class="ident" id="5474614">host</span><span class="op" id="5474618">)</span>&nbsp;<span class="op" id="5474620">-</span>&nbsp;<span class="builtinfunc" id="5474622">len</span><span class="op" id="5474625">(</span><span class="ident" id="5474626">suffix</span><span class="op" id="5474632">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474636">if</span>&nbsp;<span class="ident" id="5474639">i</span>&nbsp;<span class="op" id="5474641">&lt;=</span>&nbsp;<span class="num" id="5474644">0</span>&nbsp;<span class="op" id="5474646">||</span>&nbsp;<span class="ident" id="5474649">host</span><span class="op" id="5474653">[</span><span class="ident" id="5474654">i</span><span class="op" id="5474655">-</span><span class="num" id="5474656">1</span><span class="op" id="5474657">]</span>&nbsp;<span class="op" id="5474659">!=</span>&nbsp;<span class="string" id="5474662">&#39;.&#39;</span>&nbsp;<span class="op" id="5474666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5474671">//&nbsp;The&nbsp;provided&nbsp;public&nbsp;suffix&nbsp;list&nbsp;psl&nbsp;is&nbsp;broken.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5474724">//&nbsp;Storing&nbsp;cookies&nbsp;under&nbsp;host&nbsp;is&nbsp;a&nbsp;safe&nbsp;stopgap.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474776">return</span>&nbsp;<span class="ident" id="5474783">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5474790">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5474793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5474796">prevDot</span>&nbsp;<span class="op" id="5474804">:=</span>&nbsp;<span class="ident" id="5474807">strings</span><span class="op" id="5474814">.</span><span class="ident" id="5474815">LastIndex</span><span class="op" id="5474824">(</span><span class="ident" id="5474825">host</span><span class="op" id="5474829">[</span><span class="op" id="5474830">:</span><span class="ident" id="5474831">i</span><span class="op" id="5474832">-</span><span class="num" id="5474833">1</span><span class="op" id="5474834">]</span><span class="op" id="5474835">,</span>&nbsp;<span class="string" id="5474837">&#34;.&#34;</span><span class="op" id="5474840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474843">return</span>&nbsp;<span class="ident" id="5474850">host</span><span class="op" id="5474854">[</span><span class="ident" id="5474855">prevDot</span><span class="op" id="5474862">+</span><span class="num" id="5474863">1</span><span class="op" id="5474864">:</span><span class="op" id="5474865">]</span><br>
<span class="lineno"></span><span class="op" id="5474867">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span><span class="comment" id="5474870">//&nbsp;isIP&nbsp;reports&nbsp;whether&nbsp;host&nbsp;is&nbsp;an&nbsp;IP&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="5474917">func</span>&nbsp;<span class="ident" id="5474922">isIP</span><span class="op" id="5474926">(</span><span class="ident" id="5474927">host</span>&nbsp;<span class="builtintype" id="5474932">string</span><span class="op" id="5474938">)</span>&nbsp;<span class="builtintype" id="5474940">bool</span>&nbsp;<span class="op" id="5474945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474948">return</span>&nbsp;<span class="ident" id="5474955">net</span><span class="op" id="5474958">.</span><span class="ident" id="5474959">ParseIP</span><span class="op" id="5474966">(</span><span class="ident" id="5474967">host</span><span class="op" id="5474971">)</span>&nbsp;<span class="op" id="5474973">!=</span>&nbsp;<span class="ident" id="5474976">nil</span><br>
<span class="lineno"></span><span class="op" id="5474980">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="5474983">//&nbsp;defaultPath&nbsp;returns&nbsp;the&nbsp;directory&nbsp;part&nbsp;of&nbsp;an&nbsp;URL&#39;s&nbsp;path&nbsp;according&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5475055">//&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.1.4.</span><br>
<span class="lineno"></span><span class="keyword" id="5475082">func</span>&nbsp;<span class="ident" id="5475087">defaultPath</span><span class="op" id="5475098">(</span><span class="ident" id="5475099">path</span>&nbsp;<span class="builtintype" id="5475104">string</span><span class="op" id="5475110">)</span>&nbsp;<span class="builtintype" id="5475112">string</span>&nbsp;<span class="op" id="5475119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5475122">if</span>&nbsp;<span class="builtinfunc" id="5475125">len</span><span class="op" id="5475128">(</span><span class="ident" id="5475129">path</span><span class="op" id="5475133">)</span>&nbsp;<span class="op" id="5475135">==</span>&nbsp;<span class="num" id="5475138">0</span>&nbsp;<span class="op" id="5475140">||</span>&nbsp;<span class="ident" id="5475143">path</span><span class="op" id="5475147">[</span><span class="num" id="5475148">0</span><span class="op" id="5475149">]</span>&nbsp;<span class="op" id="5475151">!=</span>&nbsp;<span class="string" id="5475154">&#39;/&#39;</span>&nbsp;<span class="op" id="5475158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5475162">return</span>&nbsp;<span class="string" id="5475169">&#34;/&#34;</span>&nbsp;<span class="comment" id="5475173">//&nbsp;Path&nbsp;is&nbsp;empty&nbsp;or&nbsp;malformed.</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5475205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5475209">i</span>&nbsp;<span class="op" id="5475211">:=</span>&nbsp;<span class="ident" id="5475214">strings</span><span class="op" id="5475221">.</span><span class="ident" id="5475222">LastIndex</span><span class="op" id="5475231">(</span><span class="ident" id="5475232">path</span><span class="op" id="5475236">,</span>&nbsp;<span class="string" id="5475238">&#34;/&#34;</span><span class="op" id="5475241">)</span>&nbsp;<span class="comment" id="5475243">//&nbsp;Path&nbsp;starts&nbsp;with&nbsp;&#34;/&#34;,&nbsp;so&nbsp;i&nbsp;!=&nbsp;-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5475281">if</span>&nbsp;<span class="ident" id="5475284">i</span>&nbsp;<span class="op" id="5475286">==</span>&nbsp;<span class="num" id="5475289">0</span>&nbsp;<span class="op" id="5475291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5475295">return</span>&nbsp;<span class="string" id="5475302">&#34;/&#34;</span>&nbsp;<span class="comment" id="5475306">//&nbsp;Path&nbsp;has&nbsp;the&nbsp;form&nbsp;&#34;/abc&#34;.</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5475336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5475339">return</span>&nbsp;<span class="ident" id="5475346">path</span><span class="op" id="5475350">[</span><span class="op" id="5475351">:</span><span class="ident" id="5475352">i</span><span class="op" id="5475353">]</span>&nbsp;<span class="comment" id="5475355">//&nbsp;Path&nbsp;is&nbsp;either&nbsp;of&nbsp;form&nbsp;&#34;/abc/xyz&#34;&nbsp;or&nbsp;&#34;/abc/xyz/&#34;.</span><br>
<span class="lineno"></span><span class="op" id="5475408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5475411">//&nbsp;newEntry&nbsp;creates&nbsp;an&nbsp;entry&nbsp;from&nbsp;a&nbsp;http.Cookie&nbsp;c.&nbsp;now&nbsp;is&nbsp;the&nbsp;current&nbsp;time&nbsp;and</span><br>
<span class="lineno">380</span><span class="comment" id="5475490">//&nbsp;is&nbsp;compared&nbsp;to&nbsp;c.Expires&nbsp;to&nbsp;determine&nbsp;deletion&nbsp;of&nbsp;c.&nbsp;defPath&nbsp;and&nbsp;host&nbsp;are&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5475571">//&nbsp;default-path&nbsp;and&nbsp;the&nbsp;canonical&nbsp;host&nbsp;name&nbsp;of&nbsp;the&nbsp;URL&nbsp;c&nbsp;was&nbsp;received&nbsp;from.</span><br>
<span class="lineno"></span><span class="comment" id="5475647">//</span><br>
<span class="lineno"></span><span class="comment" id="5475650">//&nbsp;remove&nbsp;records&nbsp;whether&nbsp;the&nbsp;jar&nbsp;should&nbsp;delete&nbsp;this&nbsp;cookie,&nbsp;as&nbsp;it&nbsp;has&nbsp;already</span><br>
<span class="lineno"></span><span class="comment" id="5475729">//&nbsp;expired&nbsp;with&nbsp;respect&nbsp;to&nbsp;now.&nbsp;In&nbsp;this&nbsp;case,&nbsp;e&nbsp;may&nbsp;be&nbsp;incomplete,&nbsp;but&nbsp;it&nbsp;will</span><br>
<span class="lineno">385</span><span class="comment" id="5475808">//&nbsp;be&nbsp;valid&nbsp;to&nbsp;call&nbsp;e.id&nbsp;(which&nbsp;depends&nbsp;on&nbsp;e&#39;s&nbsp;Name,&nbsp;Domain&nbsp;and&nbsp;Path).</span><br>
<span class="lineno"></span><span class="comment" id="5475879">//</span><br>
<span class="lineno"></span><span class="comment" id="5475882">//&nbsp;A&nbsp;malformed&nbsp;c.Domain&nbsp;will&nbsp;result&nbsp;in&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="5475931">func</span>&nbsp;<span class="op" id="5475936">(</span><span class="ident" id="5475937">j</span>&nbsp;<span class="op" id="5475939">*</span><span class="ident" id="5475940">Jar</span><span class="op" id="5475943">)</span>&nbsp;<span class="ident" id="5475945">newEntry</span><span class="op" id="5475953">(</span><span class="ident" id="5475954">c</span>&nbsp;<span class="op" id="5475956">*</span><span class="ident" id="5475957">http</span><span class="op" id="5475961">.</span><span class="ident" id="5475962">Cookie</span><span class="op" id="5475968">,</span>&nbsp;<span class="ident" id="5475970">now</span>&nbsp;<span class="ident" id="5475974">time</span><span class="op" id="5475978">.</span><span class="ident" id="5475979">Time</span><span class="op" id="5475983">,</span>&nbsp;<span class="ident" id="5475985">defPath</span><span class="op" id="5475992">,</span>&nbsp;<span class="ident" id="5475994">host</span>&nbsp;<span class="builtintype" id="5475999">string</span><span class="op" id="5476005">)</span>&nbsp;<span class="op" id="5476007">(</span><span class="ident" id="5476008">e</span>&nbsp;<span class="ident" id="5476010">entry</span><span class="op" id="5476015">,</span>&nbsp;<span class="ident" id="5476017">remove</span>&nbsp;<span class="builtintype" id="5476024">bool</span><span class="op" id="5476028">,</span>&nbsp;<span class="ident" id="5476030">err</span>&nbsp;<span class="builtintype" id="5476034">error</span><span class="op" id="5476039">)</span>&nbsp;<span class="op" id="5476041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476044">e</span><span class="op" id="5476045">.</span><span class="ident" id="5476046">Name</span>&nbsp;<span class="op" id="5476051">=</span>&nbsp;<span class="ident" id="5476053">c</span><span class="op" id="5476054">.</span><span class="ident" id="5476055">Name</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476062">if</span>&nbsp;<span class="ident" id="5476065">c</span><span class="op" id="5476066">.</span><span class="ident" id="5476067">Path</span>&nbsp;<span class="op" id="5476072">==</span>&nbsp;<span class="string" id="5476075">&#34;&#34;</span>&nbsp;<span class="op" id="5476078">||</span>&nbsp;<span class="ident" id="5476081">c</span><span class="op" id="5476082">.</span><span class="ident" id="5476083">Path</span><span class="op" id="5476087">[</span><span class="num" id="5476088">0</span><span class="op" id="5476089">]</span>&nbsp;<span class="op" id="5476091">!=</span>&nbsp;<span class="string" id="5476094">&#39;/&#39;</span>&nbsp;<span class="op" id="5476098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476102">e</span><span class="op" id="5476103">.</span><span class="ident" id="5476104">Path</span>&nbsp;<span class="op" id="5476109">=</span>&nbsp;<span class="ident" id="5476111">defPath</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5476120">}</span>&nbsp;<span class="keyword" id="5476122">else</span>&nbsp;<span class="op" id="5476127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476131">e</span><span class="op" id="5476132">.</span><span class="ident" id="5476133">Path</span>&nbsp;<span class="op" id="5476138">=</span>&nbsp;<span class="ident" id="5476140">c</span><span class="op" id="5476141">.</span><span class="ident" id="5476142">Path</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5476148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476152">e</span><span class="op" id="5476153">.</span><span class="ident" id="5476154">Domain</span><span class="op" id="5476160">,</span>&nbsp;<span class="ident" id="5476162">e</span><span class="op" id="5476163">.</span><span class="ident" id="5476164">HostOnly</span><span class="op" id="5476172">,</span>&nbsp;<span class="ident" id="5476174">err</span>&nbsp;<span class="op" id="5476178">=</span>&nbsp;<span class="ident" id="5476180">j</span><span class="op" id="5476181">.</span><span class="ident" id="5476182">domainAndType</span><span class="op" id="5476195">(</span><span class="ident" id="5476196">host</span><span class="op" id="5476200">,</span>&nbsp;<span class="ident" id="5476202">c</span><span class="op" id="5476203">.</span><span class="ident" id="5476204">Domain</span><span class="op" id="5476210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476213">if</span>&nbsp;<span class="ident" id="5476216">err</span>&nbsp;<span class="op" id="5476220">!=</span>&nbsp;<span class="ident" id="5476223">nil</span>&nbsp;<span class="op" id="5476227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476231">return</span>&nbsp;<span class="ident" id="5476238">e</span><span class="op" id="5476239">,</span>&nbsp;<span class="builtintype" id="5476241">false</span><span class="op" id="5476246">,</span>&nbsp;<span class="ident" id="5476248">err</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5476253">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5476257">//&nbsp;MaxAge&nbsp;takes&nbsp;precedence&nbsp;over&nbsp;Expires.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476299">if</span>&nbsp;<span class="ident" id="5476302">c</span><span class="op" id="5476303">.</span><span class="ident" id="5476304">MaxAge</span>&nbsp;<span class="op" id="5476311">&lt;</span>&nbsp;<span class="num" id="5476313">0</span>&nbsp;<span class="op" id="5476315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476319">return</span>&nbsp;<span class="ident" id="5476326">e</span><span class="op" id="5476327">,</span>&nbsp;<span class="builtintype" id="5476329">true</span><span class="op" id="5476333">,</span>&nbsp;<span class="ident" id="5476335">nil</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5476340">}</span>&nbsp;<span class="keyword" id="5476342">else</span>&nbsp;<span class="keyword" id="5476347">if</span>&nbsp;<span class="ident" id="5476350">c</span><span class="op" id="5476351">.</span><span class="ident" id="5476352">MaxAge</span>&nbsp;<span class="op" id="5476359">&gt;</span>&nbsp;<span class="num" id="5476361">0</span>&nbsp;<span class="op" id="5476363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476367">e</span><span class="op" id="5476368">.</span><span class="ident" id="5476369">Expires</span>&nbsp;<span class="op" id="5476377">=</span>&nbsp;<span class="ident" id="5476379">now</span><span class="op" id="5476382">.</span><span class="ident" id="5476383">Add</span><span class="op" id="5476386">(</span><span class="ident" id="5476387">time</span><span class="op" id="5476391">.</span><span class="ident" id="5476392">Duration</span><span class="op" id="5476400">(</span><span class="ident" id="5476401">c</span><span class="op" id="5476402">.</span><span class="ident" id="5476403">MaxAge</span><span class="op" id="5476409">)</span>&nbsp;<span class="op" id="5476411">*</span>&nbsp;<span class="ident" id="5476413">time</span><span class="op" id="5476417">.</span><span class="ident" id="5476418">Second</span><span class="op" id="5476424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476428">e</span><span class="op" id="5476429">.</span><span class="ident" id="5476430">Persistent</span>&nbsp;<span class="op" id="5476441">=</span>&nbsp;<span class="builtintype" id="5476443">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5476449">}</span>&nbsp;<span class="keyword" id="5476451">else</span>&nbsp;<span class="op" id="5476456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476460">if</span>&nbsp;<span class="ident" id="5476463">c</span><span class="op" id="5476464">.</span><span class="ident" id="5476465">Expires</span><span class="op" id="5476472">.</span><span class="ident" id="5476473">IsZero</span><span class="op" id="5476479">(</span><span class="op" id="5476480">)</span>&nbsp;<span class="op" id="5476482">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476487">e</span><span class="op" id="5476488">.</span><span class="ident" id="5476489">Expires</span>&nbsp;<span class="op" id="5476497">=</span>&nbsp;<span class="ident" id="5476499">endOfTime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476512">e</span><span class="op" id="5476513">.</span><span class="ident" id="5476514">Persistent</span>&nbsp;<span class="op" id="5476525">=</span>&nbsp;<span class="builtintype" id="5476527">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5476535">}</span>&nbsp;<span class="keyword" id="5476537">else</span>&nbsp;<span class="op" id="5476542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476547">if</span>&nbsp;<span class="op" id="5476550">!</span><span class="ident" id="5476551">c</span><span class="op" id="5476552">.</span><span class="ident" id="5476553">Expires</span><span class="op" id="5476560">.</span><span class="ident" id="5476561">After</span><span class="op" id="5476566">(</span><span class="ident" id="5476567">now</span><span class="op" id="5476570">)</span>&nbsp;<span class="op" id="5476572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476578">return</span>&nbsp;<span class="ident" id="5476585">e</span><span class="op" id="5476586">,</span>&nbsp;<span class="builtintype" id="5476588">true</span><span class="op" id="5476592">,</span>&nbsp;<span class="ident" id="5476594">nil</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5476601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476606">e</span><span class="op" id="5476607">.</span><span class="ident" id="5476608">Expires</span>&nbsp;<span class="op" id="5476616">=</span>&nbsp;<span class="ident" id="5476618">c</span><span class="op" id="5476619">.</span><span class="ident" id="5476620">Expires</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476631">e</span><span class="op" id="5476632">.</span><span class="ident" id="5476633">Persistent</span>&nbsp;<span class="op" id="5476644">=</span>&nbsp;<span class="builtintype" id="5476646">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5476653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5476656">}</span><br>
<span class="lineno">420</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476660">e</span><span class="op" id="5476661">.</span><span class="ident" id="5476662">Value</span>&nbsp;<span class="op" id="5476668">=</span>&nbsp;<span class="ident" id="5476670">c</span><span class="op" id="5476671">.</span><span class="ident" id="5476672">Value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476679">e</span><span class="op" id="5476680">.</span><span class="ident" id="5476681">Secure</span>&nbsp;<span class="op" id="5476688">=</span>&nbsp;<span class="ident" id="5476690">c</span><span class="op" id="5476691">.</span><span class="ident" id="5476692">Secure</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476700">e</span><span class="op" id="5476701">.</span><span class="ident" id="5476702">HttpOnly</span>&nbsp;<span class="op" id="5476711">=</span>&nbsp;<span class="ident" id="5476713">c</span><span class="op" id="5476714">.</span><span class="ident" id="5476715">HttpOnly</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476726">return</span>&nbsp;<span class="ident" id="5476733">e</span><span class="op" id="5476734">,</span>&nbsp;<span class="builtintype" id="5476736">false</span><span class="op" id="5476741">,</span>&nbsp;<span class="ident" id="5476743">nil</span><br>
<span class="lineno"></span><span class="op" id="5476747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5476750">var</span>&nbsp;<span class="op" id="5476754">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476757">errIllegalDomain</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5476776">=</span>&nbsp;<span class="ident" id="5476778">errors</span><span class="op" id="5476784">.</span><span class="ident" id="5476785">New</span><span class="op" id="5476788">(</span><span class="string" id="5476789">&#34;cookiejar:&nbsp;illegal&nbsp;cookie&nbsp;domain&nbsp;attribute&#34;</span><span class="op" id="5476833">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476836">errMalformedDomain</span>&nbsp;<span class="op" id="5476855">=</span>&nbsp;<span class="ident" id="5476857">errors</span><span class="op" id="5476863">.</span><span class="ident" id="5476864">New</span><span class="op" id="5476867">(</span><span class="string" id="5476868">&#34;cookiejar:&nbsp;malformed&nbsp;cookie&nbsp;domain&nbsp;attribute&#34;</span><span class="op" id="5476914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476917">errNoHostname</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5476936">=</span>&nbsp;<span class="ident" id="5476938">errors</span><span class="op" id="5476944">.</span><span class="ident" id="5476945">New</span><span class="op" id="5476948">(</span><span class="string" id="5476949">&#34;cookiejar:&nbsp;no&nbsp;host&nbsp;name&nbsp;available&nbsp;(IP&nbsp;only)&#34;</span><span class="op" id="5476994">)</span><br>
<span class="lineno"></span><span class="op" id="5476996">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5476999">//&nbsp;endOfTime&nbsp;is&nbsp;the&nbsp;time&nbsp;when&nbsp;session&nbsp;(non-persistent)&nbsp;cookies&nbsp;expire.</span><br>
<span class="lineno">435</span><span class="comment" id="5477070">//&nbsp;This&nbsp;instant&nbsp;is&nbsp;representable&nbsp;in&nbsp;most&nbsp;date/time&nbsp;formats&nbsp;(not&nbsp;just</span><br>
<span class="lineno"></span><span class="comment" id="5477139">//&nbsp;Go&#39;s&nbsp;time.Time)&nbsp;and&nbsp;should&nbsp;be&nbsp;far&nbsp;enough&nbsp;in&nbsp;the&nbsp;future.</span><br>
<span class="lineno"></span><span class="keyword" id="5477198">var</span>&nbsp;<span class="ident" id="5477202">endOfTime</span>&nbsp;<span class="op" id="5477212">=</span>&nbsp;<span class="ident" id="5477214">time</span><span class="op" id="5477218">.</span><span class="ident" id="5477219">Date</span><span class="op" id="5477223">(</span><span class="num" id="5477224">9999</span><span class="op" id="5477228">,</span>&nbsp;<span class="num" id="5477230">12</span><span class="op" id="5477232">,</span>&nbsp;<span class="num" id="5477234">31</span><span class="op" id="5477236">,</span>&nbsp;<span class="num" id="5477238">23</span><span class="op" id="5477240">,</span>&nbsp;<span class="num" id="5477242">59</span><span class="op" id="5477244">,</span>&nbsp;<span class="num" id="5477246">59</span><span class="op" id="5477248">,</span>&nbsp;<span class="num" id="5477250">0</span><span class="op" id="5477251">,</span>&nbsp;<span class="ident" id="5477253">time</span><span class="op" id="5477257">.</span><span class="ident" id="5477258">UTC</span><span class="op" id="5477261">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5477264">//&nbsp;domainAndType&nbsp;determines&nbsp;the&nbsp;cookie&#39;s&nbsp;domain&nbsp;and&nbsp;hostOnly&nbsp;attribute.</span><br>
<span class="lineno">440</span><span class="keyword" id="5477336">func</span>&nbsp;<span class="op" id="5477341">(</span><span class="ident" id="5477342">j</span>&nbsp;<span class="op" id="5477344">*</span><span class="ident" id="5477345">Jar</span><span class="op" id="5477348">)</span>&nbsp;<span class="ident" id="5477350">domainAndType</span><span class="op" id="5477363">(</span><span class="ident" id="5477364">host</span><span class="op" id="5477368">,</span>&nbsp;<span class="ident" id="5477370">domain</span>&nbsp;<span class="builtintype" id="5477377">string</span><span class="op" id="5477383">)</span>&nbsp;<span class="op" id="5477385">(</span><span class="builtintype" id="5477386">string</span><span class="op" id="5477392">,</span>&nbsp;<span class="builtintype" id="5477394">bool</span><span class="op" id="5477398">,</span>&nbsp;<span class="builtintype" id="5477400">error</span><span class="op" id="5477405">)</span>&nbsp;<span class="op" id="5477407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5477410">if</span>&nbsp;<span class="ident" id="5477413">domain</span>&nbsp;<span class="op" id="5477420">==</span>&nbsp;<span class="string" id="5477423">&#34;&#34;</span>&nbsp;<span class="op" id="5477426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5477430">//&nbsp;No&nbsp;domain&nbsp;attribute&nbsp;in&nbsp;the&nbsp;SetCookie&nbsp;header&nbsp;indicates&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5477491">//&nbsp;host&nbsp;cookie.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5477509">return</span>&nbsp;<span class="ident" id="5477516">host</span><span class="op" id="5477520">,</span>&nbsp;<span class="builtintype" id="5477522">true</span><span class="op" id="5477526">,</span>&nbsp;<span class="ident" id="5477528">nil</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5477533">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5477537">if</span>&nbsp;<span class="ident" id="5477540">isIP</span><span class="op" id="5477544">(</span><span class="ident" id="5477545">host</span><span class="op" id="5477549">)</span>&nbsp;<span class="op" id="5477551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5477555">//&nbsp;According&nbsp;to&nbsp;RFC&nbsp;6265&nbsp;domain-matching&nbsp;includes&nbsp;not&nbsp;being</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5477617">//&nbsp;an&nbsp;IP&nbsp;address.</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5477637">//&nbsp;TODO:&nbsp;This&nbsp;might&nbsp;be&nbsp;relaxed&nbsp;as&nbsp;in&nbsp;common&nbsp;browsers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5477693">return</span>&nbsp;<span class="string" id="5477700">&#34;&#34;</span><span class="op" id="5477702">,</span>&nbsp;<span class="builtintype" id="5477704">false</span><span class="op" id="5477709">,</span>&nbsp;<span class="ident" id="5477711">errNoHostname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5477726">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5477730">//&nbsp;From&nbsp;here&nbsp;on:&nbsp;If&nbsp;the&nbsp;cookie&nbsp;is&nbsp;valid,&nbsp;it&nbsp;is&nbsp;a&nbsp;domain&nbsp;cookie&nbsp;(with</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5477800">//&nbsp;the&nbsp;one&nbsp;exception&nbsp;of&nbsp;a&nbsp;public&nbsp;suffix&nbsp;below).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5477849">//&nbsp;See&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.2.3.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5477881">if</span>&nbsp;<span class="ident" id="5477884">domain</span><span class="op" id="5477890">[</span><span class="num" id="5477891">0</span><span class="op" id="5477892">]</span>&nbsp;<span class="op" id="5477894">==</span>&nbsp;<span class="string" id="5477897">&#39;.&#39;</span>&nbsp;<span class="op" id="5477901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477905">domain</span>&nbsp;<span class="op" id="5477912">=</span>&nbsp;<span class="ident" id="5477914">domain</span><span class="op" id="5477920">[</span><span class="num" id="5477921">1</span><span class="op" id="5477922">:</span><span class="op" id="5477923">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5477926">}</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5477930">if</span>&nbsp;<span class="builtinfunc" id="5477933">len</span><span class="op" id="5477936">(</span><span class="ident" id="5477937">domain</span><span class="op" id="5477943">)</span>&nbsp;<span class="op" id="5477945">==</span>&nbsp;<span class="num" id="5477948">0</span>&nbsp;<span class="op" id="5477950">||</span>&nbsp;<span class="ident" id="5477953">domain</span><span class="op" id="5477959">[</span><span class="num" id="5477960">0</span><span class="op" id="5477961">]</span>&nbsp;<span class="op" id="5477963">==</span>&nbsp;<span class="string" id="5477966">&#39;.&#39;</span>&nbsp;<span class="op" id="5477970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5477974">//&nbsp;Received&nbsp;either&nbsp;&#34;Domain=.&#34;&nbsp;or&nbsp;&#34;Domain=..some.thing&#34;,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5478032">//&nbsp;both&nbsp;are&nbsp;illegal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5478055">return</span>&nbsp;<span class="string" id="5478062">&#34;&#34;</span><span class="op" id="5478064">,</span>&nbsp;<span class="builtintype" id="5478066">false</span><span class="op" id="5478071">,</span>&nbsp;<span class="ident" id="5478073">errMalformedDomain</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5478093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5478096">domain</span>&nbsp;<span class="op" id="5478103">=</span>&nbsp;<span class="ident" id="5478105">strings</span><span class="op" id="5478112">.</span><span class="ident" id="5478113">ToLower</span><span class="op" id="5478120">(</span><span class="ident" id="5478121">domain</span><span class="op" id="5478127">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5478131">if</span>&nbsp;<span class="ident" id="5478134">domain</span><span class="op" id="5478140">[</span><span class="builtinfunc" id="5478141">len</span><span class="op" id="5478144">(</span><span class="ident" id="5478145">domain</span><span class="op" id="5478151">)</span><span class="op" id="5478152">-</span><span class="num" id="5478153">1</span><span class="op" id="5478154">]</span>&nbsp;<span class="op" id="5478156">==</span>&nbsp;<span class="string" id="5478159">&#39;.&#39;</span>&nbsp;<span class="op" id="5478163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5478167">//&nbsp;We&nbsp;received&nbsp;stuff&nbsp;like&nbsp;&#34;Domain=www.example.com.&#34;.</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5478222">//&nbsp;Browsers&nbsp;do&nbsp;handle&nbsp;such&nbsp;stuff&nbsp;(actually&nbsp;differently)&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5478284">//&nbsp;RFC&nbsp;6265&nbsp;seems&nbsp;to&nbsp;be&nbsp;clear&nbsp;here&nbsp;(e.g.&nbsp;section&nbsp;4.1.2.3)&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5478347">//&nbsp;requiring&nbsp;a&nbsp;reject.&nbsp;&nbsp;4.1.2.3&nbsp;is&nbsp;not&nbsp;normative,&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5478403">//&nbsp;&#34;Domain&nbsp;Matching&#34;&nbsp;(5.1.3)&nbsp;and&nbsp;&#34;Canonicalized&nbsp;Host&nbsp;Names&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5478465">//&nbsp;(5.1.2)&nbsp;are.</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5478483">return</span>&nbsp;<span class="string" id="5478490">&#34;&#34;</span><span class="op" id="5478492">,</span>&nbsp;<span class="builtintype" id="5478494">false</span><span class="op" id="5478499">,</span>&nbsp;<span class="ident" id="5478501">errMalformedDomain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5478521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5478525">//&nbsp;See&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.3&nbsp;#5.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5478558">if</span>&nbsp;<span class="ident" id="5478561">j</span><span class="op" id="5478562">.</span><span class="ident" id="5478563">psList</span>&nbsp;<span class="op" id="5478570">!=</span>&nbsp;<span class="ident" id="5478573">nil</span>&nbsp;<span class="op" id="5478577">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5478581">if</span>&nbsp;<span class="ident" id="5478584">ps</span>&nbsp;<span class="op" id="5478587">:=</span>&nbsp;<span class="ident" id="5478590">j</span><span class="op" id="5478591">.</span><span class="ident" id="5478592">psList</span><span class="op" id="5478598">.</span><span class="ident" id="5478599">PublicSuffix</span><span class="op" id="5478611">(</span><span class="ident" id="5478612">domain</span><span class="op" id="5478618">)</span><span class="op" id="5478619">;</span>&nbsp;<span class="ident" id="5478621">ps</span>&nbsp;<span class="op" id="5478624">!=</span>&nbsp;<span class="string" id="5478627">&#34;&#34;</span>&nbsp;<span class="op" id="5478630">&amp;&amp;</span>&nbsp;<span class="op" id="5478633">!</span><span class="ident" id="5478634">hasDotSuffix</span><span class="op" id="5478646">(</span><span class="ident" id="5478647">domain</span><span class="op" id="5478653">,</span>&nbsp;<span class="ident" id="5478655">ps</span><span class="op" id="5478657">)</span>&nbsp;<span class="op" id="5478659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5478664">if</span>&nbsp;<span class="ident" id="5478667">host</span>&nbsp;<span class="op" id="5478672">==</span>&nbsp;<span class="ident" id="5478675">domain</span>&nbsp;<span class="op" id="5478682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5478688">//&nbsp;This&nbsp;is&nbsp;the&nbsp;one&nbsp;exception&nbsp;in&nbsp;which&nbsp;a&nbsp;cookie</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5478739">//&nbsp;with&nbsp;a&nbsp;domain&nbsp;attribute&nbsp;is&nbsp;a&nbsp;host&nbsp;cookie.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5478788">return</span>&nbsp;<span class="ident" id="5478795">host</span><span class="op" id="5478799">,</span>&nbsp;<span class="builtintype" id="5478801">true</span><span class="op" id="5478805">,</span>&nbsp;<span class="ident" id="5478807">nil</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5478814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5478819">return</span>&nbsp;<span class="string" id="5478826">&#34;&#34;</span><span class="op" id="5478828">,</span>&nbsp;<span class="builtintype" id="5478830">false</span><span class="op" id="5478835">,</span>&nbsp;<span class="ident" id="5478837">errIllegalDomain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5478856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5478859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5478863">//&nbsp;The&nbsp;domain&nbsp;must&nbsp;domain-match&nbsp;host:&nbsp;www.mycompany.com&nbsp;cannot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5478927">//&nbsp;set&nbsp;cookies&nbsp;for&nbsp;.ourcompetitors.com.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5478968">if</span>&nbsp;<span class="ident" id="5478971">host</span>&nbsp;<span class="op" id="5478976">!=</span>&nbsp;<span class="ident" id="5478979">domain</span>&nbsp;<span class="op" id="5478986">&amp;&amp;</span>&nbsp;<span class="op" id="5478989">!</span><span class="ident" id="5478990">hasDotSuffix</span><span class="op" id="5479002">(</span><span class="ident" id="5479003">host</span><span class="op" id="5479007">,</span>&nbsp;<span class="ident" id="5479009">domain</span><span class="op" id="5479015">)</span>&nbsp;<span class="op" id="5479017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5479021">return</span>&nbsp;<span class="string" id="5479028">&#34;&#34;</span><span class="op" id="5479030">,</span>&nbsp;<span class="builtintype" id="5479032">false</span><span class="op" id="5479037">,</span>&nbsp;<span class="ident" id="5479039">errIllegalDomain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5479057">}</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5479061">return</span>&nbsp;<span class="ident" id="5479068">domain</span><span class="op" id="5479074">,</span>&nbsp;<span class="builtintype" id="5479076">false</span><span class="op" id="5479081">,</span>&nbsp;<span class="ident" id="5479083">nil</span><br>
<span class="lineno"></span><span class="op" id="5479087">}</span>
</div>
</body>
</html>
