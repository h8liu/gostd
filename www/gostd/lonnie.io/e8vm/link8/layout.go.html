<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>lonnie.io/e8vm/link8</h2>
<ul>
<li><a href="/gostd/lonnie.io/e8vm/link8/func.go.html">func.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/layout.go.html">layout.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/link.go.html">link.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/linker.go.html">linker.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/package.go.html">package.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/pkg_sym.go.html">pkg_sym.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/symbol.go.html">symbol.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/trace_used.go.html">trace_used.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/var.go.html">var.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/writer.go.html">writer.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="keyword" id="4813002">package</span>&nbsp;<span class="ident" id="4813010">link8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4813017">import</span>&nbsp;<span class="op" id="4813024">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4813027">&#34;fmt&#34;</span><br>
<span class="lineno">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4813035">&#34;lonnie.io/e8vm/arch8&#34;</span><br>
<span class="lineno"></span><span class="op" id="4813058">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4813061">func</span>&nbsp;<span class="ident" id="4813066">layout</span><span class="op" id="4813072">(</span><span class="ident" id="4813073">used</span>&nbsp;<span class="op" id="4813078">[</span><span class="op" id="4813079">]</span><span class="ident" id="4813080">pkgSym</span><span class="op" id="4813086">)</span>&nbsp;<span class="op" id="4813088">(</span><span class="ident" id="4813089">funcs</span><span class="op" id="4813094">,</span>&nbsp;<span class="ident" id="4813096">vars</span>&nbsp;<span class="op" id="4813101">[</span><span class="op" id="4813102">]</span><span class="ident" id="4813103">pkgSym</span><span class="op" id="4813109">,</span>&nbsp;<span class="ident" id="4813111">e</span>&nbsp;<span class="builtintype" id="4813113">error</span><span class="op" id="4813118">)</span>&nbsp;<span class="op" id="4813120">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4813123">//&nbsp;code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4813132">pt</span>&nbsp;<span class="op" id="4813135">:=</span>&nbsp;<span class="builtintype" id="4813138">uint32</span><span class="op" id="4813144">(</span><span class="ident" id="4813145">arch8</span><span class="op" id="4813150">.</span><span class="ident" id="4813151">InitPC</span><span class="op" id="4813157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4813160">codeMax</span>&nbsp;<span class="op" id="4813168">:=</span>&nbsp;<span class="builtintype" id="4813171">uint32</span><span class="op" id="4813177">(</span><span class="num" id="4813178">0xffffffff</span><span class="op" id="4813188">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4813192">for</span>&nbsp;<span class="ident" id="4813196">_</span><span class="op" id="4813197">,</span>&nbsp;<span class="ident" id="4813199">ps</span>&nbsp;<span class="op" id="4813202">:=</span>&nbsp;<span class="keyword" id="4813205">range</span>&nbsp;<span class="ident" id="4813211">used</span>&nbsp;<span class="op" id="4813216">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4813220">typ</span>&nbsp;<span class="op" id="4813224">:=</span>&nbsp;<span class="ident" id="4813227">ps</span><span class="op" id="4813229">.</span><span class="ident" id="4813230">Type</span><span class="op" id="4813234">(</span><span class="op" id="4813235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4813239">switch</span>&nbsp;<span class="ident" id="4813246">typ</span>&nbsp;<span class="op" id="4813250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4813254">case</span>&nbsp;<span class="ident" id="4813259">SymFunc</span><span class="op" id="4813266">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4813271">funcs</span>&nbsp;<span class="op" id="4813277">=</span>&nbsp;<span class="builtinfunc" id="4813279">append</span><span class="op" id="4813285">(</span><span class="ident" id="4813286">funcs</span><span class="op" id="4813291">,</span>&nbsp;<span class="ident" id="4813293">ps</span><span class="op" id="4813295">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4813301">f</span>&nbsp;<span class="op" id="4813303">:=</span>&nbsp;<span class="ident" id="4813306">ps</span><span class="op" id="4813308">.</span><span class="ident" id="4813309">Func</span><span class="op" id="4813313">(</span><span class="op" id="4813314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4813319">f</span><span class="op" id="4813320">.</span><span class="ident" id="4813321">addr</span>&nbsp;<span class="op" id="4813326">=</span>&nbsp;<span class="ident" id="4813328">pt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4813334">size</span>&nbsp;<span class="op" id="4813339">:=</span>&nbsp;<span class="ident" id="4813342">f</span><span class="op" id="4813343">.</span><span class="ident" id="4813344">Size</span><span class="op" id="4813348">(</span><span class="op" id="4813349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4813354">if</span>&nbsp;<span class="ident" id="4813357">size</span>&nbsp;<span class="op" id="4813362">&gt;</span>&nbsp;<span class="ident" id="4813364">codeMax</span><span class="op" id="4813371">-</span><span class="ident" id="4813372">pt</span>&nbsp;<span class="op" id="4813375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4813381">return</span>&nbsp;<span class="ident" id="4813388">nil</span><span class="op" id="4813391">,</span>&nbsp;<span class="ident" id="4813393">nil</span><span class="op" id="4813396">,</span>&nbsp;<span class="ident" id="4813398">fmt</span><span class="op" id="4813401">.</span><span class="ident" id="4813402">Errorf</span><span class="op" id="4813408">(</span><span class="string" id="4813409">&#34;code&nbsp;section&nbsp;too&nbsp;large&#34;</span><span class="op" id="4813433">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4813438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4813443">pt</span>&nbsp;<span class="op" id="4813446">+=</span>&nbsp;<span class="ident" id="4813449">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4813456">case</span>&nbsp;<span class="ident" id="4813461">SymVar</span><span class="op" id="4813467">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4813472">vars</span>&nbsp;<span class="op" id="4813477">=</span>&nbsp;<span class="builtinfunc" id="4813479">append</span><span class="op" id="4813485">(</span><span class="ident" id="4813486">vars</span><span class="op" id="4813490">,</span>&nbsp;<span class="ident" id="4813492">ps</span><span class="op" id="4813494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4813498">default</span><span class="op" id="4813505">:</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4813510">panic</span><span class="op" id="4813515">(</span><span class="string" id="4813516">&#34;bug&#34;</span><span class="op" id="4813521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4813525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4813528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4813532">dataMax</span>&nbsp;<span class="op" id="4813540">:=</span>&nbsp;<span class="builtintype" id="4813543">uint32</span><span class="op" id="4813549">(</span><span class="num" id="4813550">0xffffffff</span><span class="op" id="4813560">)</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4813564">for</span>&nbsp;<span class="ident" id="4813568">_</span><span class="op" id="4813569">,</span>&nbsp;<span class="ident" id="4813571">ps</span>&nbsp;<span class="op" id="4813574">:=</span>&nbsp;<span class="keyword" id="4813577">range</span>&nbsp;<span class="ident" id="4813583">vars</span>&nbsp;<span class="op" id="4813588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4813592">if</span>&nbsp;<span class="ident" id="4813595">ps</span><span class="op" id="4813597">.</span><span class="ident" id="4813598">Type</span><span class="op" id="4813602">(</span><span class="op" id="4813603">)</span>&nbsp;<span class="op" id="4813605">!=</span>&nbsp;<span class="ident" id="4813608">SymVar</span>&nbsp;<span class="op" id="4813615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4813620">panic</span><span class="op" id="4813625">(</span><span class="string" id="4813626">&#34;bug&#34;</span><span class="op" id="4813631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4813635">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4813640">v</span>&nbsp;<span class="op" id="4813642">:=</span>&nbsp;<span class="ident" id="4813645">ps</span><span class="op" id="4813647">.</span><span class="ident" id="4813648">Var</span><span class="op" id="4813651">(</span><span class="op" id="4813652">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4813657">if</span>&nbsp;<span class="ident" id="4813660">v</span><span class="op" id="4813661">.</span><span class="ident" id="4813662">align</span>&nbsp;<span class="op" id="4813668">&gt;</span>&nbsp;<span class="num" id="4813670">1</span>&nbsp;<span class="op" id="4813672">&amp;&amp;</span>&nbsp;<span class="ident" id="4813675">pt</span><span class="op" id="4813677">%</span><span class="ident" id="4813678">v</span><span class="op" id="4813679">.</span><span class="ident" id="4813680">align</span>&nbsp;<span class="op" id="4813686">!=</span>&nbsp;<span class="num" id="4813689">0</span>&nbsp;<span class="op" id="4813691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4813696">v</span><span class="op" id="4813697">.</span><span class="ident" id="4813698">prePad</span>&nbsp;<span class="op" id="4813705">=</span>&nbsp;<span class="ident" id="4813707">v</span><span class="op" id="4813708">.</span><span class="ident" id="4813709">align</span>&nbsp;<span class="op" id="4813715">-</span>&nbsp;<span class="ident" id="4813717">pt</span><span class="op" id="4813719">%</span><span class="ident" id="4813720">v</span><span class="op" id="4813721">.</span><span class="ident" id="4813722">align</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4813731">pt</span>&nbsp;<span class="op" id="4813734">+=</span>&nbsp;<span class="ident" id="4813737">v</span><span class="op" id="4813738">.</span><span class="ident" id="4813739">prePad</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4813748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4813752">if</span>&nbsp;<span class="ident" id="4813755">v</span><span class="op" id="4813756">.</span><span class="ident" id="4813757">align</span>&nbsp;<span class="op" id="4813763">&gt;</span>&nbsp;<span class="num" id="4813765">1</span>&nbsp;<span class="op" id="4813767">&amp;&amp;</span>&nbsp;<span class="ident" id="4813770">pt</span><span class="op" id="4813772">%</span><span class="ident" id="4813773">v</span><span class="op" id="4813774">.</span><span class="ident" id="4813775">align</span>&nbsp;<span class="op" id="4813781">!=</span>&nbsp;<span class="num" id="4813784">0</span>&nbsp;<span class="op" id="4813786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4813791">panic</span><span class="op" id="4813796">(</span><span class="string" id="4813797">&#34;bug&#34;</span><span class="op" id="4813802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4813806">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4813811">v</span><span class="op" id="4813812">.</span><span class="ident" id="4813813">addr</span>&nbsp;<span class="op" id="4813818">=</span>&nbsp;<span class="ident" id="4813820">pt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4813825">size</span>&nbsp;<span class="op" id="4813830">:=</span>&nbsp;<span class="ident" id="4813833">v</span><span class="op" id="4813834">.</span><span class="ident" id="4813835">Size</span><span class="op" id="4813839">(</span><span class="op" id="4813840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4813844">if</span>&nbsp;<span class="ident" id="4813847">size</span>&nbsp;<span class="op" id="4813852">&gt;</span>&nbsp;<span class="ident" id="4813854">dataMax</span><span class="op" id="4813861">-</span><span class="ident" id="4813862">pt</span>&nbsp;<span class="op" id="4813865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4813870">return</span>&nbsp;<span class="ident" id="4813877">nil</span><span class="op" id="4813880">,</span>&nbsp;<span class="ident" id="4813882">nil</span><span class="op" id="4813885">,</span>&nbsp;<span class="ident" id="4813887">fmt</span><span class="op" id="4813890">.</span><span class="ident" id="4813891">Errorf</span><span class="op" id="4813897">(</span><span class="string" id="4813898">&#34;binary&nbsp;too&nbsp;large&#34;</span><span class="op" id="4813916">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4813920">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4813925">pt</span>&nbsp;<span class="op" id="4813928">+=</span>&nbsp;<span class="ident" id="4813931">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4813937">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4813941">return</span><br>
<span class="lineno"></span><span class="op" id="4813948">}</span>
</div>
</body>
</html>
