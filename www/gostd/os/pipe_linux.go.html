<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os</h2>
<ul>
<li><a href="/gostd/os/dir_unix.go.html">dir_unix.go</a></li>
<li><a href="/gostd/os/doc.go.html">doc.go</a></li>
<li><a href="/gostd/os/env.go.html">env.go</a></li>
<li><a href="/gostd/os/env_test.go.html">env_test.go</a></li>
<li><a href="/gostd/os/env_unix_test.go.html">env_unix_test.go</a></li>
<li><a href="/gostd/os/error.go.html">error.go</a></li>
<li><a href="/gostd/os/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/os/error_unix.go.html">error_unix.go</a></li>
<li><a href="/gostd/os/exec.go.html">exec.go</a></li>
<li><a href="/gostd/os/exec_posix.go.html">exec_posix.go</a></li>
<li><a href="/gostd/os/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/os/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/os/file.go.html">file.go</a></li>
<li><a href="/gostd/os/file_posix.go.html">file_posix.go</a></li>
<li><a href="/gostd/os/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/os/getwd.go.html">getwd.go</a></li>
<li><a href="/gostd/os/os_test.go.html">os_test.go</a></li>
<li><a href="/gostd/os/os_unix_test.go.html">os_unix_test.go</a></li>
<li><a href="/gostd/os/path.go.html">path.go</a></li>
<li><a href="/gostd/os/path_test.go.html">path_test.go</a></li>
<li><a href="/gostd/os/path_unix.go.html">path_unix.go</a></li>
<li><a href="/gostd/os/pipe_linux.go.html">pipe_linux.go</a></li>
<li><a href="/gostd/os/proc.go.html">proc.go</a></li>
<li><a href="/gostd/os/stat_linux.go.html">stat_linux.go</a></li>
<li><a href="/gostd/os/sys_linux.go.html">sys_linux.go</a></li>
<li><a href="/gostd/os/sys_unix.go.html">sys_unix.go</a></li>
<li><a href="/gostd/os/types.go.html">types.go</a></li>
<li><a href="/gostd/os/types_notwin.go.html">types_notwin.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2352146">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2352201">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2352255">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2352306">package</span>&nbsp;<span class="ident" id="2352314">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2352318">import</span>&nbsp;<span class="string" id="2352325">&#34;syscall&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2352336">//&nbsp;Pipe&nbsp;returns&nbsp;a&nbsp;connected&nbsp;pair&nbsp;of&nbsp;Files;&nbsp;reads&nbsp;from&nbsp;r&nbsp;return&nbsp;bytes&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno">10</span><span class="comment" id="2352419">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;files&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2352465">func</span>&nbsp;<span class="ident" id="2352470">Pipe</span><span class="op" id="2352474">(</span><span class="op" id="2352475">)</span>&nbsp;<span class="op" id="2352477">(</span><span class="ident" id="2352478">r</span>&nbsp;<span class="op" id="2352480">*</span><span class="ident" id="2352481">File</span><span class="op" id="2352485">,</span>&nbsp;<span class="ident" id="2352487">w</span>&nbsp;<span class="op" id="2352489">*</span><span class="ident" id="2352490">File</span><span class="op" id="2352494">,</span>&nbsp;<span class="ident" id="2352496">err</span>&nbsp;<span class="builtintype" id="2352500">error</span><span class="op" id="2352505">)</span>&nbsp;<span class="op" id="2352507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2352510">var</span>&nbsp;<span class="ident" id="2352514">p</span>&nbsp;<span class="op" id="2352516">[</span><span class="num" id="2352517">2</span><span class="op" id="2352518">]</span><span class="builtintype" id="2352519">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2352525">e</span>&nbsp;<span class="op" id="2352527">:=</span>&nbsp;<span class="ident" id="2352530">syscall</span><span class="op" id="2352537">.</span><span class="ident" id="2352538">Pipe2</span><span class="op" id="2352543">(</span><span class="ident" id="2352544">p</span><span class="op" id="2352545">[</span><span class="num" id="2352546">0</span><span class="op" id="2352547">:</span><span class="op" id="2352548">]</span><span class="op" id="2352549">,</span>&nbsp;<span class="ident" id="2352551">syscall</span><span class="op" id="2352558">.</span><span class="ident" id="2352559">O_CLOEXEC</span><span class="op" id="2352568">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2352571">//&nbsp;pipe2&nbsp;was&nbsp;added&nbsp;in&nbsp;2.6.27&nbsp;and&nbsp;our&nbsp;minimum&nbsp;requirement&nbsp;is&nbsp;2.6.23,&nbsp;so&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2352646">//&nbsp;might&nbsp;not&nbsp;be&nbsp;implemented.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2352676">if</span>&nbsp;<span class="ident" id="2352679">e</span>&nbsp;<span class="op" id="2352681">==</span>&nbsp;<span class="ident" id="2352684">syscall</span><span class="op" id="2352691">.</span><span class="ident" id="2352692">ENOSYS</span>&nbsp;<span class="op" id="2352699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2352703">//&nbsp;See&nbsp;../syscall/exec.go&nbsp;for&nbsp;description&nbsp;of&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2352756">syscall</span><span class="op" id="2352763">.</span><span class="ident" id="2352764">ForkLock</span><span class="op" id="2352772">.</span><span class="ident" id="2352773">RLock</span><span class="op" id="2352778">(</span><span class="op" id="2352779">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2352783">e</span>&nbsp;<span class="op" id="2352785">=</span>&nbsp;<span class="ident" id="2352787">syscall</span><span class="op" id="2352794">.</span><span class="ident" id="2352795">Pipe</span><span class="op" id="2352799">(</span><span class="ident" id="2352800">p</span><span class="op" id="2352801">[</span><span class="num" id="2352802">0</span><span class="op" id="2352803">:</span><span class="op" id="2352804">]</span><span class="op" id="2352805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2352809">if</span>&nbsp;<span class="ident" id="2352812">e</span>&nbsp;<span class="op" id="2352814">!=</span>&nbsp;<span class="ident" id="2352817">nil</span>&nbsp;<span class="op" id="2352821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2352826">syscall</span><span class="op" id="2352833">.</span><span class="ident" id="2352834">ForkLock</span><span class="op" id="2352842">.</span><span class="ident" id="2352843">RUnlock</span><span class="op" id="2352850">(</span><span class="op" id="2352851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2352856">return</span>&nbsp;<span class="ident" id="2352863">nil</span><span class="op" id="2352866">,</span>&nbsp;<span class="ident" id="2352868">nil</span><span class="op" id="2352871">,</span>&nbsp;<span class="ident" id="2352873">NewSyscallError</span><span class="op" id="2352888">(</span><span class="string" id="2352889">&#34;pipe&#34;</span><span class="op" id="2352895">,</span>&nbsp;<span class="ident" id="2352897">e</span><span class="op" id="2352898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2352902">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2352906">syscall</span><span class="op" id="2352913">.</span><span class="ident" id="2352914">CloseOnExec</span><span class="op" id="2352925">(</span><span class="ident" id="2352926">p</span><span class="op" id="2352927">[</span><span class="num" id="2352928">0</span><span class="op" id="2352929">]</span><span class="op" id="2352930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2352934">syscall</span><span class="op" id="2352941">.</span><span class="ident" id="2352942">CloseOnExec</span><span class="op" id="2352953">(</span><span class="ident" id="2352954">p</span><span class="op" id="2352955">[</span><span class="num" id="2352956">1</span><span class="op" id="2352957">]</span><span class="op" id="2352958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2352962">syscall</span><span class="op" id="2352969">.</span><span class="ident" id="2352970">ForkLock</span><span class="op" id="2352978">.</span><span class="ident" id="2352979">RUnlock</span><span class="op" id="2352986">(</span><span class="op" id="2352987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2352990">}</span>&nbsp;<span class="keyword" id="2352992">else</span>&nbsp;<span class="keyword" id="2352997">if</span>&nbsp;<span class="ident" id="2353000">e</span>&nbsp;<span class="op" id="2353002">!=</span>&nbsp;<span class="ident" id="2353005">nil</span>&nbsp;<span class="op" id="2353009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2353013">return</span>&nbsp;<span class="ident" id="2353020">nil</span><span class="op" id="2353023">,</span>&nbsp;<span class="ident" id="2353025">nil</span><span class="op" id="2353028">,</span>&nbsp;<span class="ident" id="2353030">NewSyscallError</span><span class="op" id="2353045">(</span><span class="string" id="2353046">&#34;pipe2&#34;</span><span class="op" id="2353053">,</span>&nbsp;<span class="ident" id="2353055">e</span><span class="op" id="2353056">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2353059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2353063">return</span>&nbsp;<span class="ident" id="2353070">NewFile</span><span class="op" id="2353077">(</span><span class="builtintype" id="2353078">uintptr</span><span class="op" id="2353085">(</span><span class="ident" id="2353086">p</span><span class="op" id="2353087">[</span><span class="num" id="2353088">0</span><span class="op" id="2353089">]</span><span class="op" id="2353090">)</span><span class="op" id="2353091">,</span>&nbsp;<span class="string" id="2353093">&#34;|0&#34;</span><span class="op" id="2353097">)</span><span class="op" id="2353098">,</span>&nbsp;<span class="ident" id="2353100">NewFile</span><span class="op" id="2353107">(</span><span class="builtintype" id="2353108">uintptr</span><span class="op" id="2353115">(</span><span class="ident" id="2353116">p</span><span class="op" id="2353117">[</span><span class="num" id="2353118">1</span><span class="op" id="2353119">]</span><span class="op" id="2353120">)</span><span class="op" id="2353121">,</span>&nbsp;<span class="string" id="2353123">&#34;|1&#34;</span><span class="op" id="2353127">)</span><span class="op" id="2353128">,</span>&nbsp;<span class="ident" id="2353130">nil</span><br>
<span class="lineno"></span><span class="op" id="2353134">}</span>
</div>
</body>
</html>
