<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4366342">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4366397">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4366451">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4366502">/*<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspPackage&nbsp;rpc&nbsp;provides&nbsp;access&nbsp;to&nbsp;the&nbsp;exported&nbsp;methods&nbsp;of&nbsp;an&nbsp;object&nbsp;across&nbsp;a<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspnetwork&nbsp;or&nbsp;other&nbsp;I/O&nbsp;connection.&nbsp;&nbsp;A&nbsp;server&nbsp;registers&nbsp;an&nbsp;object,&nbsp;making&nbsp;it&nbsp;visible<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspas&nbsp;a&nbsp;service&nbsp;with&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;type&nbsp;of&nbsp;the&nbsp;object.&nbsp;&nbsp;After&nbsp;registration,&nbsp;exported<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspmethods&nbsp;of&nbsp;the&nbsp;object&nbsp;will&nbsp;be&nbsp;accessible&nbsp;remotely.&nbsp;&nbsp;A&nbsp;server&nbsp;may&nbsp;register&nbsp;multiple<br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbspobjects&nbsp;(services)&nbsp;of&nbsp;different&nbsp;types&nbsp;but&nbsp;it&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;register&nbsp;multiple<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspobjects&nbsp;of&nbsp;the&nbsp;same&nbsp;type.<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspOnly&nbsp;methods&nbsp;that&nbsp;satisfy&nbsp;these&nbsp;criteria&nbsp;will&nbsp;be&nbsp;made&nbsp;available&nbsp;for&nbsp;remote&nbsp;access;<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspother&nbsp;methods&nbsp;will&nbsp;be&nbsp;ignored:<br>
<span class="lineno">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;method&nbsp;is&nbsp;exported.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;method&nbsp;has&nbsp;two&nbsp;arguments,&nbsp;both&nbsp;exported&nbsp;(or&nbsp;builtin)&nbsp;types.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;method&#39;s&nbsp;second&nbsp;argument&nbsp;is&nbsp;a&nbsp;pointer.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;method&nbsp;has&nbsp;return&nbsp;type&nbsp;error.<br>
<span class="lineno">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspIn&nbsp;effect,&nbsp;the&nbsp;method&nbsp;must&nbsp;look&nbsp;schematically&nbsp;like<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;(t&nbsp;*T)&nbsp;MethodName(argType&nbsp;T1,&nbsp;replyType&nbsp;*T2)&nbsp;error<br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbspwhere&nbsp;T,&nbsp;T1&nbsp;and&nbsp;T2&nbsp;can&nbsp;be&nbsp;marshaled&nbsp;by&nbsp;encoding/gob.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspThese&nbsp;requirements&nbsp;apply&nbsp;even&nbsp;if&nbsp;a&nbsp;different&nbsp;codec&nbsp;is&nbsp;used.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp(In&nbsp;the&nbsp;future,&nbsp;these&nbsp;requirements&nbsp;may&nbsp;soften&nbsp;for&nbsp;custom&nbsp;codecs.)<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspThe&nbsp;method&#39;s&nbsp;first&nbsp;argument&nbsp;represents&nbsp;the&nbsp;arguments&nbsp;provided&nbsp;by&nbsp;the&nbsp;caller;&nbsp;the<br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbspsecond&nbsp;argument&nbsp;represents&nbsp;the&nbsp;result&nbsp;parameters&nbsp;to&nbsp;be&nbsp;returned&nbsp;to&nbsp;the&nbsp;caller.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspThe&nbsp;method&#39;s&nbsp;return&nbsp;value,&nbsp;if&nbsp;non-nil,&nbsp;is&nbsp;passed&nbsp;back&nbsp;as&nbsp;a&nbsp;string&nbsp;that&nbsp;the&nbsp;client<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspsees&nbsp;as&nbsp;if&nbsp;created&nbsp;by&nbsp;errors.New.&nbsp;&nbsp;If&nbsp;an&nbsp;error&nbsp;is&nbsp;returned,&nbsp;the&nbsp;reply&nbsp;parameter<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspwill&nbsp;not&nbsp;be&nbsp;sent&nbsp;back&nbsp;to&nbsp;the&nbsp;client.<br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbspThe&nbsp;server&nbsp;may&nbsp;handle&nbsp;requests&nbsp;on&nbsp;a&nbsp;single&nbsp;connection&nbsp;by&nbsp;calling&nbsp;ServeConn.&nbsp;&nbsp;More<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsptypically&nbsp;it&nbsp;will&nbsp;create&nbsp;a&nbsp;network&nbsp;listener&nbsp;and&nbsp;call&nbsp;Accept&nbsp;or,&nbsp;for&nbsp;an&nbsp;HTTP<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsplistener,&nbsp;HandleHTTP&nbsp;and&nbsp;http.Serve.<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspA&nbsp;client&nbsp;wishing&nbsp;to&nbsp;use&nbsp;the&nbsp;service&nbsp;establishes&nbsp;a&nbsp;connection&nbsp;and&nbsp;then&nbsp;invokes<br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbspNewClient&nbsp;on&nbsp;the&nbsp;connection.&nbsp;&nbsp;The&nbsp;convenience&nbsp;function&nbsp;Dial&nbsp;(DialHTTP)&nbsp;performs<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspboth&nbsp;steps&nbsp;for&nbsp;a&nbsp;raw&nbsp;network&nbsp;connection&nbsp;(an&nbsp;HTTP&nbsp;connection).&nbsp;&nbsp;The&nbsp;resulting<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspClient&nbsp;object&nbsp;has&nbsp;two&nbsp;methods,&nbsp;Call&nbsp;and&nbsp;Go,&nbsp;that&nbsp;specify&nbsp;the&nbsp;service&nbsp;and&nbsp;method&nbsp;to<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspcall,&nbsp;a&nbsp;pointer&nbsp;containing&nbsp;the&nbsp;arguments,&nbsp;and&nbsp;a&nbsp;pointer&nbsp;to&nbsp;receive&nbsp;the&nbsp;result<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspparameters.<br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspThe&nbsp;Call&nbsp;method&nbsp;waits&nbsp;for&nbsp;the&nbsp;remote&nbsp;call&nbsp;to&nbsp;complete&nbsp;while&nbsp;the&nbsp;Go&nbsp;method<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsplaunches&nbsp;the&nbsp;call&nbsp;asynchronously&nbsp;and&nbsp;signals&nbsp;completion&nbsp;using&nbsp;the&nbsp;Call<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspstructure&#39;s&nbsp;Done&nbsp;channel.<br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbspUnless&nbsp;an&nbsp;explicit&nbsp;codec&nbsp;is&nbsp;set&nbsp;up,&nbsp;package&nbsp;encoding/gob&nbsp;is&nbsp;used&nbsp;to<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsptransport&nbsp;the&nbsp;data.<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspHere&nbsp;is&nbsp;a&nbsp;simple&nbsp;example.&nbsp;&nbsp;A&nbsp;server&nbsp;wishes&nbsp;to&nbsp;export&nbsp;an&nbsp;object&nbsp;of&nbsp;type&nbsp;Arith:<br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsppackage&nbsp;server<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsptype&nbsp;Args&nbsp;struct&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspA,&nbsp;B&nbsp;int<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsptype&nbsp;Quotient&nbsp;struct&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspQuo,&nbsp;Rem&nbsp;int<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsptype&nbsp;Arith&nbsp;int<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;(t&nbsp;*Arith)&nbsp;Multiply(args&nbsp;*Args,&nbsp;reply&nbsp;*int)&nbsp;error&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp*reply&nbsp;=&nbsp;args.A&nbsp;*&nbsp;args.B<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;nil<br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;(t&nbsp;*Arith)&nbsp;Divide(args&nbsp;*Args,&nbsp;quo&nbsp;*Quotient)&nbsp;error&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspif&nbsp;args.B&nbsp;==&nbsp;0&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;errors.New(&#34;divide&nbsp;by&nbsp;zero&#34;)<br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspquo.Quo&nbsp;=&nbsp;args.A&nbsp;/&nbsp;args.B<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspquo.Rem&nbsp;=&nbsp;args.A&nbsp;%&nbsp;args.B<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;nil<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspThe&nbsp;server&nbsp;calls&nbsp;(for&nbsp;HTTP&nbsp;service):<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsparith&nbsp;:=&nbsp;new(Arith)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsprpc.Register(arith)<br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsprpc.HandleHTTP()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspl,&nbsp;e&nbsp;:=&nbsp;net.Listen(&#34;tcp&#34;,&nbsp;&#34;:1234&#34;)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspif&nbsp;e&nbsp;!=&nbsp;nil&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsplog.Fatal(&#34;listen&nbsp;error:&#34;,&nbsp;e)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;http.Serve(l,&nbsp;nil)<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspAt&nbsp;this&nbsp;point,&nbsp;clients&nbsp;can&nbsp;see&nbsp;a&nbsp;service&nbsp;&#34;Arith&#34;&nbsp;with&nbsp;methods&nbsp;&#34;Arith.Multiply&#34;&nbsp;and<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&#34;Arith.Divide&#34;.&nbsp;&nbsp;To&nbsp;invoke&nbsp;one,&nbsp;a&nbsp;client&nbsp;first&nbsp;dials&nbsp;the&nbsp;server:<br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspclient,&nbsp;err&nbsp;:=&nbsp;rpc.DialHTTP(&#34;tcp&#34;,&nbsp;serverAddress&nbsp;+&nbsp;&#34;:1234&#34;)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspif&nbsp;err&nbsp;!=&nbsp;nil&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsplog.Fatal(&#34;dialing:&#34;,&nbsp;err)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbspThen&nbsp;it&nbsp;can&nbsp;make&nbsp;a&nbsp;remote&nbsp;call:<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;Synchronous&nbsp;call<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspargs&nbsp;:=&nbsp;&amp;server.Args{7,8}<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspvar&nbsp;reply&nbsp;int<br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsperr&nbsp;=&nbsp;client.Call(&#34;Arith.Multiply&#34;,&nbsp;args,&nbsp;&amp;reply)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspif&nbsp;err&nbsp;!=&nbsp;nil&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsplog.Fatal(&#34;arith&nbsp;error:&#34;,&nbsp;err)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspfmt.Printf(&#34;Arith:&nbsp;%d*%d=%d&#34;,&nbsp;args.A,&nbsp;args.B,&nbsp;reply)<br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspor<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;Asynchronous&nbsp;call<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspquotient&nbsp;:=&nbsp;new(Quotient)<br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspdivCall&nbsp;:=&nbsp;client.Go(&#34;Arith.Divide&#34;,&nbsp;args,&nbsp;quotient,&nbsp;nil)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreplyCall&nbsp;:=&nbsp;&lt;-divCall.Done&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;will&nbsp;be&nbsp;equal&nbsp;to&nbsp;divCall<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;check&nbsp;errors,&nbsp;print,&nbsp;etc.<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspA&nbsp;server&nbsp;implementation&nbsp;will&nbsp;often&nbsp;provide&nbsp;a&nbsp;simple,&nbsp;type-safe&nbsp;wrapper&nbsp;for&nbsp;the<br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbspclient.<br>
<span class="lineno"></span>*/</span><br>
<span class="lineno"></span><span class="keyword" id="4370331">package</span>&nbsp;<span class="ident" id="4370339">rpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4370344">import</span>&nbsp;<span class="op" id="4370351">(</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4370354">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4370363">&#34;encoding/gob&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4370379">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4370389">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4370395">&#34;log&#34;</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4370402">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4370409">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4370421">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4370432">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4370443">&#34;sync&#34;</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4370451">&#34;unicode&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4370462">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="4370477">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4370480">const</span>&nbsp;<span class="op" id="4370486">(</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4370489">//&nbsp;Defaults&nbsp;used&nbsp;by&nbsp;HandleHTTP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4370521">DefaultRPCPath</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4370538">=</span>&nbsp;<span class="string" id="4370540">&#34;/_goRPC_&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4370552">DefaultDebugPath</span>&nbsp;<span class="op" id="4370569">=</span>&nbsp;<span class="string" id="4370571">&#34;/debug/rpc&#34;</span><br>
<span class="lineno"></span><span class="op" id="4370584">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="4370587">//&nbsp;Precompute&nbsp;the&nbsp;reflect&nbsp;type&nbsp;for&nbsp;error.&nbsp;&nbsp;Can&#39;t&nbsp;use&nbsp;error&nbsp;directly</span><br>
<span class="lineno"></span><span class="comment" id="4370655">//&nbsp;because&nbsp;Typeof&nbsp;takes&nbsp;an&nbsp;empty&nbsp;interface&nbsp;value.&nbsp;&nbsp;This&nbsp;is&nbsp;annoying.</span><br>
<span class="lineno"></span><span class="keyword" id="4370724">var</span>&nbsp;<span class="ident" id="4370728">typeOfError</span>&nbsp;<span class="op" id="4370740">=</span>&nbsp;<span class="ident" id="4370742">reflect</span><span class="op" id="4370749">.</span><span class="ident" id="4370750">TypeOf</span><span class="op" id="4370756">(</span><span class="op" id="4370757">(</span><span class="op" id="4370758">*</span><span class="builtintype" id="4370759">error</span><span class="op" id="4370764">)</span><span class="op" id="4370765">(</span><span class="ident" id="4370766">nil</span><span class="op" id="4370769">)</span><span class="op" id="4370770">)</span><span class="op" id="4370771">.</span><span class="ident" id="4370772">Elem</span><span class="op" id="4370776">(</span><span class="op" id="4370777">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4370780">type</span>&nbsp;<span class="ident" id="4370785">methodType</span>&nbsp;<span class="keyword" id="4370796">struct</span>&nbsp;<span class="op" id="4370803">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4370806">sync</span><span class="op" id="4370810">.</span><span class="ident" id="4370811">Mutex</span>&nbsp;<span class="comment" id="4370817">//&nbsp;protects&nbsp;counters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4370839">method</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4370850">reflect</span><span class="op" id="4370857">.</span><span class="ident" id="4370858">Method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4370866">ArgType</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4370877">reflect</span><span class="op" id="4370884">.</span><span class="ident" id="4370885">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4370891">ReplyType</span>&nbsp;&nbsp;<span class="ident" id="4370902">reflect</span><span class="op" id="4370909">.</span><span class="ident" id="4370910">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4370916">numCalls</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4370927">uint</span><br>
<span class="lineno">155</span><span class="op" id="4370932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4370935">type</span>&nbsp;<span class="ident" id="4370940">service</span>&nbsp;<span class="keyword" id="4370948">struct</span>&nbsp;<span class="op" id="4370955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4370958">name</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4370965">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4370988">//&nbsp;name&nbsp;of&nbsp;service</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4371008">rcvr</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4371015">reflect</span><span class="op" id="4371022">.</span><span class="ident" id="4371023">Value</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4371038">//&nbsp;receiver&nbsp;of&nbsp;methods&nbsp;for&nbsp;the&nbsp;service</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4371078">typ</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4371085">reflect</span><span class="op" id="4371092">.</span><span class="ident" id="4371093">Type</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4371108">//&nbsp;type&nbsp;of&nbsp;the&nbsp;receiver</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4371133">method</span>&nbsp;<span class="keyword" id="4371140">map</span><span class="op" id="4371143">[</span><span class="builtintype" id="4371144">string</span><span class="op" id="4371150">]</span><span class="op" id="4371151">*</span><span class="ident" id="4371152">methodType</span>&nbsp;<span class="comment" id="4371163">//&nbsp;registered&nbsp;methods</span><br>
<span class="lineno"></span><span class="op" id="4371185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4371188">//&nbsp;Request&nbsp;is&nbsp;a&nbsp;header&nbsp;written&nbsp;before&nbsp;every&nbsp;RPC&nbsp;call.&nbsp;&nbsp;It&nbsp;is&nbsp;used&nbsp;internally</span><br>
<span class="lineno">165</span><span class="comment" id="4371265">//&nbsp;but&nbsp;documented&nbsp;here&nbsp;as&nbsp;an&nbsp;aid&nbsp;to&nbsp;debugging,&nbsp;such&nbsp;as&nbsp;when&nbsp;analyzing</span><br>
<span class="lineno"></span><span class="comment" id="4371335">//&nbsp;network&nbsp;traffic.</span><br>
<span class="lineno"></span><span class="keyword" id="4371355">type</span>&nbsp;<span class="ident" id="4371360">Request</span>&nbsp;<span class="keyword" id="4371368">struct</span>&nbsp;<span class="op" id="4371375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4371378">ServiceMethod</span>&nbsp;<span class="builtintype" id="4371392">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4371401">//&nbsp;format:&nbsp;&#34;Service.Method&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4371430">Seq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4371444">uint64</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4371453">//&nbsp;sequence&nbsp;number&nbsp;chosen&nbsp;by&nbsp;client</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4371490">next</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4371504">*</span><span class="ident" id="4371505">Request</span>&nbsp;<span class="comment" id="4371513">//&nbsp;for&nbsp;free&nbsp;list&nbsp;in&nbsp;Server</span><br>
<span class="lineno"></span><span class="op" id="4371540">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4371543">//&nbsp;Response&nbsp;is&nbsp;a&nbsp;header&nbsp;written&nbsp;before&nbsp;every&nbsp;RPC&nbsp;return.&nbsp;&nbsp;It&nbsp;is&nbsp;used&nbsp;internally</span><br>
<span class="lineno"></span><span class="comment" id="4371623">//&nbsp;but&nbsp;documented&nbsp;here&nbsp;as&nbsp;an&nbsp;aid&nbsp;to&nbsp;debugging,&nbsp;such&nbsp;as&nbsp;when&nbsp;analyzing</span><br>
<span class="lineno">175</span><span class="comment" id="4371693">//&nbsp;network&nbsp;traffic.</span><br>
<span class="lineno"></span><span class="keyword" id="4371713">type</span>&nbsp;<span class="ident" id="4371718">Response</span>&nbsp;<span class="keyword" id="4371727">struct</span>&nbsp;<span class="op" id="4371734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4371737">ServiceMethod</span>&nbsp;<span class="builtintype" id="4371751">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4371761">//&nbsp;echoes&nbsp;that&nbsp;of&nbsp;the&nbsp;Request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4371792">Seq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4371806">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4371816">//&nbsp;echoes&nbsp;that&nbsp;of&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4371847">Error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4371861">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4371871">//&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4371890">next</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4371904">*</span><span class="ident" id="4371905">Response</span>&nbsp;<span class="comment" id="4371914">//&nbsp;for&nbsp;free&nbsp;list&nbsp;in&nbsp;Server</span><br>
<span class="lineno"></span><span class="op" id="4371941">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4371944">//&nbsp;Server&nbsp;represents&nbsp;an&nbsp;RPC&nbsp;Server.</span><br>
<span class="lineno"></span><span class="keyword" id="4371980">type</span>&nbsp;<span class="ident" id="4371985">Server</span>&nbsp;<span class="keyword" id="4371992">struct</span>&nbsp;<span class="op" id="4371999">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4372002">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4372013">sync</span><span class="op" id="4372017">.</span><span class="ident" id="4372018">RWMutex</span>&nbsp;<span class="comment" id="4372026">//&nbsp;protects&nbsp;the&nbsp;serviceMap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4372054">serviceMap</span>&nbsp;<span class="keyword" id="4372065">map</span><span class="op" id="4372068">[</span><span class="builtintype" id="4372069">string</span><span class="op" id="4372075">]</span><span class="op" id="4372076">*</span><span class="ident" id="4372077">service</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4372086">reqLock</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4372097">sync</span><span class="op" id="4372101">.</span><span class="ident" id="4372102">Mutex</span>&nbsp;<span class="comment" id="4372108">//&nbsp;protects&nbsp;freeReq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4372129">freeReq</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4372140">*</span><span class="ident" id="4372141">Request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4372150">respLock</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4372161">sync</span><span class="op" id="4372165">.</span><span class="ident" id="4372166">Mutex</span>&nbsp;<span class="comment" id="4372172">//&nbsp;protects&nbsp;freeResp</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4372194">freeResp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4372205">*</span><span class="ident" id="4372206">Response</span><br>
<span class="lineno"></span><span class="op" id="4372215">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4372218">//&nbsp;NewServer&nbsp;returns&nbsp;a&nbsp;new&nbsp;Server.</span><br>
<span class="lineno"></span><span class="keyword" id="4372253">func</span>&nbsp;<span class="ident" id="4372258">NewServer</span><span class="op" id="4372267">(</span><span class="op" id="4372268">)</span>&nbsp;<span class="op" id="4372270">*</span><span class="ident" id="4372271">Server</span>&nbsp;<span class="op" id="4372278">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4372281">return</span>&nbsp;<span class="op" id="4372288">&amp;</span><span class="ident" id="4372289">Server</span><span class="op" id="4372295">{</span><span class="ident" id="4372296">serviceMap</span><span class="op" id="4372306">:</span>&nbsp;<span class="builtinfunc" id="4372308">make</span><span class="op" id="4372312">(</span><span class="keyword" id="4372313">map</span><span class="op" id="4372316">[</span><span class="builtintype" id="4372317">string</span><span class="op" id="4372323">]</span><span class="op" id="4372324">*</span><span class="ident" id="4372325">service</span><span class="op" id="4372332">)</span><span class="op" id="4372333">}</span><br>
<span class="lineno"></span><span class="op" id="4372335">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4372338">//&nbsp;DefaultServer&nbsp;is&nbsp;the&nbsp;default&nbsp;instance&nbsp;of&nbsp;*Server.</span><br>
<span class="lineno"></span><span class="keyword" id="4372391">var</span>&nbsp;<span class="ident" id="4372395">DefaultServer</span>&nbsp;<span class="op" id="4372409">=</span>&nbsp;<span class="ident" id="4372411">NewServer</span><span class="op" id="4372420">(</span><span class="op" id="4372421">)</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="4372424">//&nbsp;Is&nbsp;this&nbsp;an&nbsp;exported&nbsp;-&nbsp;upper&nbsp;case&nbsp;-&nbsp;name?</span><br>
<span class="lineno"></span><span class="keyword" id="4372468">func</span>&nbsp;<span class="ident" id="4372473">isExported</span><span class="op" id="4372483">(</span><span class="ident" id="4372484">name</span>&nbsp;<span class="builtintype" id="4372489">string</span><span class="op" id="4372495">)</span>&nbsp;<span class="builtintype" id="4372497">bool</span>&nbsp;<span class="op" id="4372502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="4372505">rune</span><span class="op" id="4372509">,</span>&nbsp;<span class="ident" id="4372511">_</span>&nbsp;<span class="op" id="4372513">:=</span>&nbsp;<span class="ident" id="4372516">utf8</span><span class="op" id="4372520">.</span><span class="ident" id="4372521">DecodeRuneInString</span><span class="op" id="4372539">(</span><span class="ident" id="4372540">name</span><span class="op" id="4372544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4372547">return</span>&nbsp;<span class="ident" id="4372554">unicode</span><span class="op" id="4372561">.</span><span class="ident" id="4372562">IsUpper</span><span class="op" id="4372569">(</span><span class="builtintype" id="4372570">rune</span><span class="op" id="4372574">)</span><br>
<span class="lineno">205</span><span class="op" id="4372576">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4372579">//&nbsp;Is&nbsp;this&nbsp;type&nbsp;exported&nbsp;or&nbsp;a&nbsp;builtin?</span><br>
<span class="lineno"></span><span class="keyword" id="4372618">func</span>&nbsp;<span class="ident" id="4372623">isExportedOrBuiltinType</span><span class="op" id="4372646">(</span><span class="ident" id="4372647">t</span>&nbsp;<span class="ident" id="4372649">reflect</span><span class="op" id="4372656">.</span><span class="ident" id="4372657">Type</span><span class="op" id="4372661">)</span>&nbsp;<span class="builtintype" id="4372663">bool</span>&nbsp;<span class="op" id="4372668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4372671">for</span>&nbsp;<span class="ident" id="4372675">t</span><span class="op" id="4372676">.</span><span class="ident" id="4372677">Kind</span><span class="op" id="4372681">(</span><span class="op" id="4372682">)</span>&nbsp;<span class="op" id="4372684">==</span>&nbsp;<span class="ident" id="4372687">reflect</span><span class="op" id="4372694">.</span><span class="ident" id="4372695">Ptr</span>&nbsp;<span class="op" id="4372699">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4372703">t</span>&nbsp;<span class="op" id="4372705">=</span>&nbsp;<span class="ident" id="4372707">t</span><span class="op" id="4372708">.</span><span class="ident" id="4372709">Elem</span><span class="op" id="4372713">(</span><span class="op" id="4372714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4372717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4372720">//&nbsp;PkgPath&nbsp;will&nbsp;be&nbsp;non-empty&nbsp;even&nbsp;for&nbsp;an&nbsp;exported&nbsp;type,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4372777">//&nbsp;so&nbsp;we&nbsp;need&nbsp;to&nbsp;check&nbsp;the&nbsp;type&nbsp;name&nbsp;as&nbsp;well.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4372824">return</span>&nbsp;<span class="ident" id="4372831">isExported</span><span class="op" id="4372841">(</span><span class="ident" id="4372842">t</span><span class="op" id="4372843">.</span><span class="ident" id="4372844">Name</span><span class="op" id="4372848">(</span><span class="op" id="4372849">)</span><span class="op" id="4372850">)</span>&nbsp;<span class="op" id="4372852">||</span>&nbsp;<span class="ident" id="4372855">t</span><span class="op" id="4372856">.</span><span class="ident" id="4372857">PkgPath</span><span class="op" id="4372864">(</span><span class="op" id="4372865">)</span>&nbsp;<span class="op" id="4372867">==</span>&nbsp;<span class="string" id="4372870">&#34;&#34;</span><br>
<span class="lineno">215</span><span class="op" id="4372873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4372876">//&nbsp;Register&nbsp;publishes&nbsp;in&nbsp;the&nbsp;server&nbsp;the&nbsp;set&nbsp;of&nbsp;methods&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4372938">//&nbsp;receiver&nbsp;value&nbsp;that&nbsp;satisfy&nbsp;the&nbsp;following&nbsp;conditions:</span><br>
<span class="lineno"></span><span class="comment" id="4372995">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;exported&nbsp;method</span><br>
<span class="lineno">220</span><span class="comment" id="4373016">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;two&nbsp;arguments,&nbsp;both&nbsp;of&nbsp;exported&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="4373058">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;second&nbsp;argument&nbsp;is&nbsp;a&nbsp;pointer</span><br>
<span class="lineno"></span><span class="comment" id="4373096">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;one&nbsp;return&nbsp;value,&nbsp;of&nbsp;type&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="4373133">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;error&nbsp;if&nbsp;the&nbsp;receiver&nbsp;is&nbsp;not&nbsp;an&nbsp;exported&nbsp;type&nbsp;or&nbsp;has</span><br>
<span class="lineno"></span><span class="comment" id="4373203">//&nbsp;no&nbsp;suitable&nbsp;methods.&nbsp;It&nbsp;also&nbsp;logs&nbsp;the&nbsp;error&nbsp;using&nbsp;package&nbsp;log.</span><br>
<span class="lineno">225</span><span class="comment" id="4373269">//&nbsp;The&nbsp;client&nbsp;accesses&nbsp;each&nbsp;method&nbsp;using&nbsp;a&nbsp;string&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;Type.Method&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="4373346">//&nbsp;where&nbsp;Type&nbsp;is&nbsp;the&nbsp;receiver&#39;s&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="4373393">func</span>&nbsp;<span class="op" id="4373398">(</span><span class="ident" id="4373399">server</span>&nbsp;<span class="op" id="4373406">*</span><span class="ident" id="4373407">Server</span><span class="op" id="4373413">)</span>&nbsp;<span class="ident" id="4373415">Register</span><span class="op" id="4373423">(</span><span class="ident" id="4373424">rcvr</span>&nbsp;<span class="keyword" id="4373429">interface</span><span class="op" id="4373438">{</span><span class="op" id="4373439">}</span><span class="op" id="4373440">)</span>&nbsp;<span class="builtintype" id="4373442">error</span>&nbsp;<span class="op" id="4373448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4373451">return</span>&nbsp;<span class="ident" id="4373458">server</span><span class="op" id="4373464">.</span><span class="ident" id="4373465">register</span><span class="op" id="4373473">(</span><span class="ident" id="4373474">rcvr</span><span class="op" id="4373478">,</span>&nbsp;<span class="string" id="4373480">&#34;&#34;</span><span class="op" id="4373482">,</span>&nbsp;<span class="builtintype" id="4373484">false</span><span class="op" id="4373489">)</span><br>
<span class="lineno"></span><span class="op" id="4373491">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="4373494">//&nbsp;RegisterName&nbsp;is&nbsp;like&nbsp;Register&nbsp;but&nbsp;uses&nbsp;the&nbsp;provided&nbsp;name&nbsp;for&nbsp;the&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="4373567">//&nbsp;instead&nbsp;of&nbsp;the&nbsp;receiver&#39;s&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="4373611">func</span>&nbsp;<span class="op" id="4373616">(</span><span class="ident" id="4373617">server</span>&nbsp;<span class="op" id="4373624">*</span><span class="ident" id="4373625">Server</span><span class="op" id="4373631">)</span>&nbsp;<span class="ident" id="4373633">RegisterName</span><span class="op" id="4373645">(</span><span class="ident" id="4373646">name</span>&nbsp;<span class="builtintype" id="4373651">string</span><span class="op" id="4373657">,</span>&nbsp;<span class="ident" id="4373659">rcvr</span>&nbsp;<span class="keyword" id="4373664">interface</span><span class="op" id="4373673">{</span><span class="op" id="4373674">}</span><span class="op" id="4373675">)</span>&nbsp;<span class="builtintype" id="4373677">error</span>&nbsp;<span class="op" id="4373683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4373686">return</span>&nbsp;<span class="ident" id="4373693">server</span><span class="op" id="4373699">.</span><span class="ident" id="4373700">register</span><span class="op" id="4373708">(</span><span class="ident" id="4373709">rcvr</span><span class="op" id="4373713">,</span>&nbsp;<span class="ident" id="4373715">name</span><span class="op" id="4373719">,</span>&nbsp;<span class="builtintype" id="4373721">true</span><span class="op" id="4373725">)</span><br>
<span class="lineno">235</span><span class="op" id="4373727">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4373730">func</span>&nbsp;<span class="op" id="4373735">(</span><span class="ident" id="4373736">server</span>&nbsp;<span class="op" id="4373743">*</span><span class="ident" id="4373744">Server</span><span class="op" id="4373750">)</span>&nbsp;<span class="ident" id="4373752">register</span><span class="op" id="4373760">(</span><span class="ident" id="4373761">rcvr</span>&nbsp;<span class="keyword" id="4373766">interface</span><span class="op" id="4373775">{</span><span class="op" id="4373776">}</span><span class="op" id="4373777">,</span>&nbsp;<span class="ident" id="4373779">name</span>&nbsp;<span class="builtintype" id="4373784">string</span><span class="op" id="4373790">,</span>&nbsp;<span class="ident" id="4373792">useName</span>&nbsp;<span class="builtintype" id="4373800">bool</span><span class="op" id="4373804">)</span>&nbsp;<span class="builtintype" id="4373806">error</span>&nbsp;<span class="op" id="4373812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4373815">server</span><span class="op" id="4373821">.</span><span class="ident" id="4373822">mu</span><span class="op" id="4373824">.</span><span class="ident" id="4373825">Lock</span><span class="op" id="4373829">(</span><span class="op" id="4373830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4373833">defer</span>&nbsp;<span class="ident" id="4373839">server</span><span class="op" id="4373845">.</span><span class="ident" id="4373846">mu</span><span class="op" id="4373848">.</span><span class="ident" id="4373849">Unlock</span><span class="op" id="4373855">(</span><span class="op" id="4373856">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4373859">if</span>&nbsp;<span class="ident" id="4373862">server</span><span class="op" id="4373868">.</span><span class="ident" id="4373869">serviceMap</span>&nbsp;<span class="op" id="4373880">==</span>&nbsp;<span class="ident" id="4373883">nil</span>&nbsp;<span class="op" id="4373887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4373891">server</span><span class="op" id="4373897">.</span><span class="ident" id="4373898">serviceMap</span>&nbsp;<span class="op" id="4373909">=</span>&nbsp;<span class="builtinfunc" id="4373911">make</span><span class="op" id="4373915">(</span><span class="keyword" id="4373916">map</span><span class="op" id="4373919">[</span><span class="builtintype" id="4373920">string</span><span class="op" id="4373926">]</span><span class="op" id="4373927">*</span><span class="ident" id="4373928">service</span><span class="op" id="4373935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4373938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4373941">s</span>&nbsp;<span class="op" id="4373943">:=</span>&nbsp;<span class="builtinfunc" id="4373946">new</span><span class="op" id="4373949">(</span><span class="ident" id="4373950">service</span><span class="op" id="4373957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4373960">s</span><span class="op" id="4373961">.</span><span class="ident" id="4373962">typ</span>&nbsp;<span class="op" id="4373966">=</span>&nbsp;<span class="ident" id="4373968">reflect</span><span class="op" id="4373975">.</span><span class="ident" id="4373976">TypeOf</span><span class="op" id="4373982">(</span><span class="ident" id="4373983">rcvr</span><span class="op" id="4373987">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4373990">s</span><span class="op" id="4373991">.</span><span class="ident" id="4373992">rcvr</span>&nbsp;<span class="op" id="4373997">=</span>&nbsp;<span class="ident" id="4373999">reflect</span><span class="op" id="4374006">.</span><span class="ident" id="4374007">ValueOf</span><span class="op" id="4374014">(</span><span class="ident" id="4374015">rcvr</span><span class="op" id="4374019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4374022">sname</span>&nbsp;<span class="op" id="4374028">:=</span>&nbsp;<span class="ident" id="4374031">reflect</span><span class="op" id="4374038">.</span><span class="ident" id="4374039">Indirect</span><span class="op" id="4374047">(</span><span class="ident" id="4374048">s</span><span class="op" id="4374049">.</span><span class="ident" id="4374050">rcvr</span><span class="op" id="4374054">)</span><span class="op" id="4374055">.</span><span class="ident" id="4374056">Type</span><span class="op" id="4374060">(</span><span class="op" id="4374061">)</span><span class="op" id="4374062">.</span><span class="ident" id="4374063">Name</span><span class="op" id="4374067">(</span><span class="op" id="4374068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4374071">if</span>&nbsp;<span class="ident" id="4374074">useName</span>&nbsp;<span class="op" id="4374082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4374086">sname</span>&nbsp;<span class="op" id="4374092">=</span>&nbsp;<span class="ident" id="4374094">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4374100">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4374103">if</span>&nbsp;<span class="ident" id="4374106">sname</span>&nbsp;<span class="op" id="4374112">==</span>&nbsp;<span class="string" id="4374115">&#34;&#34;</span>&nbsp;<span class="op" id="4374118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4374122">s</span>&nbsp;<span class="op" id="4374124">:=</span>&nbsp;<span class="string" id="4374127">&#34;rpc.Register:&nbsp;no&nbsp;service&nbsp;name&nbsp;for&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="4374169">+</span>&nbsp;<span class="ident" id="4374171">s</span><span class="op" id="4374172">.</span><span class="ident" id="4374173">typ</span><span class="op" id="4374176">.</span><span class="ident" id="4374177">String</span><span class="op" id="4374183">(</span><span class="op" id="4374184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4374188">log</span><span class="op" id="4374191">.</span><span class="ident" id="4374192">Print</span><span class="op" id="4374197">(</span><span class="ident" id="4374198">s</span><span class="op" id="4374199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4374203">return</span>&nbsp;<span class="ident" id="4374210">errors</span><span class="op" id="4374216">.</span><span class="ident" id="4374217">New</span><span class="op" id="4374220">(</span><span class="ident" id="4374221">s</span><span class="op" id="4374222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4374225">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4374228">if</span>&nbsp;<span class="op" id="4374231">!</span><span class="ident" id="4374232">isExported</span><span class="op" id="4374242">(</span><span class="ident" id="4374243">sname</span><span class="op" id="4374248">)</span>&nbsp;<span class="op" id="4374250">&amp;&amp;</span>&nbsp;<span class="op" id="4374253">!</span><span class="ident" id="4374254">useName</span>&nbsp;<span class="op" id="4374262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4374266">s</span>&nbsp;<span class="op" id="4374268">:=</span>&nbsp;<span class="string" id="4374271">&#34;rpc.Register:&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="4374293">+</span>&nbsp;<span class="ident" id="4374295">sname</span>&nbsp;<span class="op" id="4374301">+</span>&nbsp;<span class="string" id="4374303">&#34;&nbsp;is&nbsp;not&nbsp;exported&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4374324">log</span><span class="op" id="4374327">.</span><span class="ident" id="4374328">Print</span><span class="op" id="4374333">(</span><span class="ident" id="4374334">s</span><span class="op" id="4374335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4374339">return</span>&nbsp;<span class="ident" id="4374346">errors</span><span class="op" id="4374352">.</span><span class="ident" id="4374353">New</span><span class="op" id="4374356">(</span><span class="ident" id="4374357">s</span><span class="op" id="4374358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4374361">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4374364">if</span>&nbsp;<span class="ident" id="4374367">_</span><span class="op" id="4374368">,</span>&nbsp;<span class="ident" id="4374370">present</span>&nbsp;<span class="op" id="4374378">:=</span>&nbsp;<span class="ident" id="4374381">server</span><span class="op" id="4374387">.</span><span class="ident" id="4374388">serviceMap</span><span class="op" id="4374398">[</span><span class="ident" id="4374399">sname</span><span class="op" id="4374404">]</span><span class="op" id="4374405">;</span>&nbsp;<span class="ident" id="4374407">present</span>&nbsp;<span class="op" id="4374415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4374419">return</span>&nbsp;<span class="ident" id="4374426">errors</span><span class="op" id="4374432">.</span><span class="ident" id="4374433">New</span><span class="op" id="4374436">(</span><span class="string" id="4374437">&#34;rpc:&nbsp;service&nbsp;already&nbsp;defined:&nbsp;&#34;</span>&nbsp;<span class="op" id="4374470">+</span>&nbsp;<span class="ident" id="4374472">sname</span><span class="op" id="4374477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4374480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4374483">s</span><span class="op" id="4374484">.</span><span class="ident" id="4374485">name</span>&nbsp;<span class="op" id="4374490">=</span>&nbsp;<span class="ident" id="4374492">sname</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4374500">//&nbsp;Install&nbsp;the&nbsp;methods</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4374524">s</span><span class="op" id="4374525">.</span><span class="ident" id="4374526">method</span>&nbsp;<span class="op" id="4374533">=</span>&nbsp;<span class="ident" id="4374535">suitableMethods</span><span class="op" id="4374550">(</span><span class="ident" id="4374551">s</span><span class="op" id="4374552">.</span><span class="ident" id="4374553">typ</span><span class="op" id="4374556">,</span>&nbsp;<span class="builtintype" id="4374558">true</span><span class="op" id="4374562">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4374566">if</span>&nbsp;<span class="builtinfunc" id="4374569">len</span><span class="op" id="4374572">(</span><span class="ident" id="4374573">s</span><span class="op" id="4374574">.</span><span class="ident" id="4374575">method</span><span class="op" id="4374581">)</span>&nbsp;<span class="op" id="4374583">==</span>&nbsp;<span class="num" id="4374586">0</span>&nbsp;<span class="op" id="4374588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4374592">str</span>&nbsp;<span class="op" id="4374596">:=</span>&nbsp;<span class="string" id="4374599">&#34;&#34;</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4374605">//&nbsp;To&nbsp;help&nbsp;the&nbsp;user,&nbsp;see&nbsp;if&nbsp;a&nbsp;pointer&nbsp;receiver&nbsp;would&nbsp;work.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4374666">method</span>&nbsp;<span class="op" id="4374673">:=</span>&nbsp;<span class="ident" id="4374676">suitableMethods</span><span class="op" id="4374691">(</span><span class="ident" id="4374692">reflect</span><span class="op" id="4374699">.</span><span class="ident" id="4374700">PtrTo</span><span class="op" id="4374705">(</span><span class="ident" id="4374706">s</span><span class="op" id="4374707">.</span><span class="ident" id="4374708">typ</span><span class="op" id="4374711">)</span><span class="op" id="4374712">,</span>&nbsp;<span class="builtintype" id="4374714">false</span><span class="op" id="4374719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4374723">if</span>&nbsp;<span class="builtinfunc" id="4374726">len</span><span class="op" id="4374729">(</span><span class="ident" id="4374730">method</span><span class="op" id="4374736">)</span>&nbsp;<span class="op" id="4374738">!=</span>&nbsp;<span class="num" id="4374741">0</span>&nbsp;<span class="op" id="4374743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4374748">str</span>&nbsp;<span class="op" id="4374752">=</span>&nbsp;<span class="string" id="4374754">&#34;rpc.Register:&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="4374776">+</span>&nbsp;<span class="ident" id="4374778">sname</span>&nbsp;<span class="op" id="4374784">+</span>&nbsp;<span class="string" id="4374786">&#34;&nbsp;has&nbsp;no&nbsp;exported&nbsp;methods&nbsp;of&nbsp;suitable&nbsp;type&nbsp;(hint:&nbsp;pass&nbsp;a&nbsp;pointer&nbsp;to&nbsp;value&nbsp;of&nbsp;that&nbsp;type)&#34;</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4374877">}</span>&nbsp;<span class="keyword" id="4374879">else</span>&nbsp;<span class="op" id="4374884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4374889">str</span>&nbsp;<span class="op" id="4374893">=</span>&nbsp;<span class="string" id="4374895">&#34;rpc.Register:&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="4374917">+</span>&nbsp;<span class="ident" id="4374919">sname</span>&nbsp;<span class="op" id="4374925">+</span>&nbsp;<span class="string" id="4374927">&#34;&nbsp;has&nbsp;no&nbsp;exported&nbsp;methods&nbsp;of&nbsp;suitable&nbsp;type&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4374973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4374977">log</span><span class="op" id="4374980">.</span><span class="ident" id="4374981">Print</span><span class="op" id="4374986">(</span><span class="ident" id="4374987">str</span><span class="op" id="4374990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4374994">return</span>&nbsp;<span class="ident" id="4375001">errors</span><span class="op" id="4375007">.</span><span class="ident" id="4375008">New</span><span class="op" id="4375011">(</span><span class="ident" id="4375012">str</span><span class="op" id="4375015">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4375018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4375021">server</span><span class="op" id="4375027">.</span><span class="ident" id="4375028">serviceMap</span><span class="op" id="4375038">[</span><span class="ident" id="4375039">s</span><span class="op" id="4375040">.</span><span class="ident" id="4375041">name</span><span class="op" id="4375045">]</span>&nbsp;<span class="op" id="4375047">=</span>&nbsp;<span class="ident" id="4375049">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4375052">return</span>&nbsp;<span class="ident" id="4375059">nil</span><br>
<span class="lineno"></span><span class="op" id="4375063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="comment" id="4375066">//&nbsp;suitableMethods&nbsp;returns&nbsp;suitable&nbsp;Rpc&nbsp;methods&nbsp;of&nbsp;typ,&nbsp;it&nbsp;will&nbsp;report</span><br>
<span class="lineno"></span><span class="comment" id="4375137">//&nbsp;error&nbsp;using&nbsp;log&nbsp;if&nbsp;reportErr&nbsp;is&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="4375178">func</span>&nbsp;<span class="ident" id="4375183">suitableMethods</span><span class="op" id="4375198">(</span><span class="ident" id="4375199">typ</span>&nbsp;<span class="ident" id="4375203">reflect</span><span class="op" id="4375210">.</span><span class="ident" id="4375211">Type</span><span class="op" id="4375215">,</span>&nbsp;<span class="ident" id="4375217">reportErr</span>&nbsp;<span class="builtintype" id="4375227">bool</span><span class="op" id="4375231">)</span>&nbsp;<span class="keyword" id="4375233">map</span><span class="op" id="4375236">[</span><span class="builtintype" id="4375237">string</span><span class="op" id="4375243">]</span><span class="op" id="4375244">*</span><span class="ident" id="4375245">methodType</span>&nbsp;<span class="op" id="4375256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4375259">methods</span>&nbsp;<span class="op" id="4375267">:=</span>&nbsp;<span class="builtinfunc" id="4375270">make</span><span class="op" id="4375274">(</span><span class="keyword" id="4375275">map</span><span class="op" id="4375278">[</span><span class="builtintype" id="4375279">string</span><span class="op" id="4375285">]</span><span class="op" id="4375286">*</span><span class="ident" id="4375287">methodType</span><span class="op" id="4375297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4375300">for</span>&nbsp;<span class="ident" id="4375304">m</span>&nbsp;<span class="op" id="4375306">:=</span>&nbsp;<span class="num" id="4375309">0</span><span class="op" id="4375310">;</span>&nbsp;<span class="ident" id="4375312">m</span>&nbsp;<span class="op" id="4375314">&lt;</span>&nbsp;<span class="ident" id="4375316">typ</span><span class="op" id="4375319">.</span><span class="ident" id="4375320">NumMethod</span><span class="op" id="4375329">(</span><span class="op" id="4375330">)</span><span class="op" id="4375331">;</span>&nbsp;<span class="ident" id="4375333">m</span><span class="op" id="4375334">++</span>&nbsp;<span class="op" id="4375337">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4375341">method</span>&nbsp;<span class="op" id="4375348">:=</span>&nbsp;<span class="ident" id="4375351">typ</span><span class="op" id="4375354">.</span><span class="ident" id="4375355">Method</span><span class="op" id="4375361">(</span><span class="ident" id="4375362">m</span><span class="op" id="4375363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4375367">mtype</span>&nbsp;<span class="op" id="4375373">:=</span>&nbsp;<span class="ident" id="4375376">method</span><span class="op" id="4375382">.</span><span class="ident" id="4375383">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4375390">mname</span>&nbsp;<span class="op" id="4375396">:=</span>&nbsp;<span class="ident" id="4375399">method</span><span class="op" id="4375405">.</span><span class="ident" id="4375406">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4375413">//&nbsp;Method&nbsp;must&nbsp;be&nbsp;exported.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4375443">if</span>&nbsp;<span class="ident" id="4375446">method</span><span class="op" id="4375452">.</span><span class="ident" id="4375453">PkgPath</span>&nbsp;<span class="op" id="4375461">!=</span>&nbsp;<span class="string" id="4375464">&#34;&#34;</span>&nbsp;<span class="op" id="4375467">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4375472">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4375483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4375487">//&nbsp;Method&nbsp;needs&nbsp;three&nbsp;ins:&nbsp;receiver,&nbsp;*args,&nbsp;*reply.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4375541">if</span>&nbsp;<span class="ident" id="4375544">mtype</span><span class="op" id="4375549">.</span><span class="ident" id="4375550">NumIn</span><span class="op" id="4375555">(</span><span class="op" id="4375556">)</span>&nbsp;<span class="op" id="4375558">!=</span>&nbsp;<span class="num" id="4375561">3</span>&nbsp;<span class="op" id="4375563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4375568">if</span>&nbsp;<span class="ident" id="4375571">reportErr</span>&nbsp;<span class="op" id="4375581">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4375587">log</span><span class="op" id="4375590">.</span><span class="ident" id="4375591">Println</span><span class="op" id="4375598">(</span><span class="string" id="4375599">&#34;method&#34;</span><span class="op" id="4375607">,</span>&nbsp;<span class="ident" id="4375609">mname</span><span class="op" id="4375614">,</span>&nbsp;<span class="string" id="4375616">&#34;has&nbsp;wrong&nbsp;number&nbsp;of&nbsp;ins:&#34;</span><span class="op" id="4375642">,</span>&nbsp;<span class="ident" id="4375644">mtype</span><span class="op" id="4375649">.</span><span class="ident" id="4375650">NumIn</span><span class="op" id="4375655">(</span><span class="op" id="4375656">)</span><span class="op" id="4375657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4375662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4375667">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4375678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4375682">//&nbsp;First&nbsp;arg&nbsp;need&nbsp;not&nbsp;be&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4375720">argType</span>&nbsp;<span class="op" id="4375728">:=</span>&nbsp;<span class="ident" id="4375731">mtype</span><span class="op" id="4375736">.</span><span class="ident" id="4375737">In</span><span class="op" id="4375739">(</span><span class="num" id="4375740">1</span><span class="op" id="4375741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4375745">if</span>&nbsp;<span class="op" id="4375748">!</span><span class="ident" id="4375749">isExportedOrBuiltinType</span><span class="op" id="4375772">(</span><span class="ident" id="4375773">argType</span><span class="op" id="4375780">)</span>&nbsp;<span class="op" id="4375782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4375787">if</span>&nbsp;<span class="ident" id="4375790">reportErr</span>&nbsp;<span class="op" id="4375800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4375806">log</span><span class="op" id="4375809">.</span><span class="ident" id="4375810">Println</span><span class="op" id="4375817">(</span><span class="ident" id="4375818">mname</span><span class="op" id="4375823">,</span>&nbsp;<span class="string" id="4375825">&#34;argument&nbsp;type&nbsp;not&nbsp;exported:&#34;</span><span class="op" id="4375854">,</span>&nbsp;<span class="ident" id="4375856">argType</span><span class="op" id="4375863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4375868">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4375873">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4375884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4375888">//&nbsp;Second&nbsp;arg&nbsp;must&nbsp;be&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4375923">replyType</span>&nbsp;<span class="op" id="4375933">:=</span>&nbsp;<span class="ident" id="4375936">mtype</span><span class="op" id="4375941">.</span><span class="ident" id="4375942">In</span><span class="op" id="4375944">(</span><span class="num" id="4375945">2</span><span class="op" id="4375946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4375950">if</span>&nbsp;<span class="ident" id="4375953">replyType</span><span class="op" id="4375962">.</span><span class="ident" id="4375963">Kind</span><span class="op" id="4375967">(</span><span class="op" id="4375968">)</span>&nbsp;<span class="op" id="4375970">!=</span>&nbsp;<span class="ident" id="4375973">reflect</span><span class="op" id="4375980">.</span><span class="ident" id="4375981">Ptr</span>&nbsp;<span class="op" id="4375985">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4375990">if</span>&nbsp;<span class="ident" id="4375993">reportErr</span>&nbsp;<span class="op" id="4376003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4376009">log</span><span class="op" id="4376012">.</span><span class="ident" id="4376013">Println</span><span class="op" id="4376020">(</span><span class="string" id="4376021">&#34;method&#34;</span><span class="op" id="4376029">,</span>&nbsp;<span class="ident" id="4376031">mname</span><span class="op" id="4376036">,</span>&nbsp;<span class="string" id="4376038">&#34;reply&nbsp;type&nbsp;not&nbsp;a&nbsp;pointer:&#34;</span><span class="op" id="4376065">,</span>&nbsp;<span class="ident" id="4376067">replyType</span><span class="op" id="4376076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4376081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4376086">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4376097">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4376101">//&nbsp;Reply&nbsp;type&nbsp;must&nbsp;be&nbsp;exported.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4376135">if</span>&nbsp;<span class="op" id="4376138">!</span><span class="ident" id="4376139">isExportedOrBuiltinType</span><span class="op" id="4376162">(</span><span class="ident" id="4376163">replyType</span><span class="op" id="4376172">)</span>&nbsp;<span class="op" id="4376174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4376179">if</span>&nbsp;<span class="ident" id="4376182">reportErr</span>&nbsp;<span class="op" id="4376192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4376198">log</span><span class="op" id="4376201">.</span><span class="ident" id="4376202">Println</span><span class="op" id="4376209">(</span><span class="string" id="4376210">&#34;method&#34;</span><span class="op" id="4376218">,</span>&nbsp;<span class="ident" id="4376220">mname</span><span class="op" id="4376225">,</span>&nbsp;<span class="string" id="4376227">&#34;reply&nbsp;type&nbsp;not&nbsp;exported:&#34;</span><span class="op" id="4376253">,</span>&nbsp;<span class="ident" id="4376255">replyType</span><span class="op" id="4376264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4376269">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4376274">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4376285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4376289">//&nbsp;Method&nbsp;needs&nbsp;one&nbsp;out.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4376316">if</span>&nbsp;<span class="ident" id="4376319">mtype</span><span class="op" id="4376324">.</span><span class="ident" id="4376325">NumOut</span><span class="op" id="4376331">(</span><span class="op" id="4376332">)</span>&nbsp;<span class="op" id="4376334">!=</span>&nbsp;<span class="num" id="4376337">1</span>&nbsp;<span class="op" id="4376339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4376344">if</span>&nbsp;<span class="ident" id="4376347">reportErr</span>&nbsp;<span class="op" id="4376357">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4376363">log</span><span class="op" id="4376366">.</span><span class="ident" id="4376367">Println</span><span class="op" id="4376374">(</span><span class="string" id="4376375">&#34;method&#34;</span><span class="op" id="4376383">,</span>&nbsp;<span class="ident" id="4376385">mname</span><span class="op" id="4376390">,</span>&nbsp;<span class="string" id="4376392">&#34;has&nbsp;wrong&nbsp;number&nbsp;of&nbsp;outs:&#34;</span><span class="op" id="4376419">,</span>&nbsp;<span class="ident" id="4376421">mtype</span><span class="op" id="4376426">.</span><span class="ident" id="4376427">NumOut</span><span class="op" id="4376433">(</span><span class="op" id="4376434">)</span><span class="op" id="4376435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4376440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4376445">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4376456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4376460">//&nbsp;The&nbsp;return&nbsp;type&nbsp;of&nbsp;the&nbsp;method&nbsp;must&nbsp;be&nbsp;error.</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4376510">if</span>&nbsp;<span class="ident" id="4376513">returnType</span>&nbsp;<span class="op" id="4376524">:=</span>&nbsp;<span class="ident" id="4376527">mtype</span><span class="op" id="4376532">.</span><span class="ident" id="4376533">Out</span><span class="op" id="4376536">(</span><span class="num" id="4376537">0</span><span class="op" id="4376538">)</span><span class="op" id="4376539">;</span>&nbsp;<span class="ident" id="4376541">returnType</span>&nbsp;<span class="op" id="4376552">!=</span>&nbsp;<span class="ident" id="4376555">typeOfError</span>&nbsp;<span class="op" id="4376567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4376572">if</span>&nbsp;<span class="ident" id="4376575">reportErr</span>&nbsp;<span class="op" id="4376585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4376591">log</span><span class="op" id="4376594">.</span><span class="ident" id="4376595">Println</span><span class="op" id="4376602">(</span><span class="string" id="4376603">&#34;method&#34;</span><span class="op" id="4376611">,</span>&nbsp;<span class="ident" id="4376613">mname</span><span class="op" id="4376618">,</span>&nbsp;<span class="string" id="4376620">&#34;returns&#34;</span><span class="op" id="4376629">,</span>&nbsp;<span class="ident" id="4376631">returnType</span><span class="op" id="4376641">.</span><span class="ident" id="4376642">String</span><span class="op" id="4376648">(</span><span class="op" id="4376649">)</span><span class="op" id="4376650">,</span>&nbsp;<span class="string" id="4376652">&#34;not&nbsp;error&#34;</span><span class="op" id="4376663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4376668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4376673">continue</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4376684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4376688">methods</span><span class="op" id="4376695">[</span><span class="ident" id="4376696">mname</span><span class="op" id="4376701">]</span>&nbsp;<span class="op" id="4376703">=</span>&nbsp;<span class="op" id="4376705">&amp;</span><span class="ident" id="4376706">methodType</span><span class="op" id="4376716">{</span><span class="ident" id="4376717">method</span><span class="op" id="4376723">:</span>&nbsp;<span class="ident" id="4376725">method</span><span class="op" id="4376731">,</span>&nbsp;<span class="ident" id="4376733">ArgType</span><span class="op" id="4376740">:</span>&nbsp;<span class="ident" id="4376742">argType</span><span class="op" id="4376749">,</span>&nbsp;<span class="ident" id="4376751">ReplyType</span><span class="op" id="4376760">:</span>&nbsp;<span class="ident" id="4376762">replyType</span><span class="op" id="4376771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4376774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4376777">return</span>&nbsp;<span class="ident" id="4376784">methods</span><br>
<span class="lineno"></span><span class="op" id="4376792">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="comment" id="4376795">//&nbsp;A&nbsp;value&nbsp;sent&nbsp;as&nbsp;a&nbsp;placeholder&nbsp;for&nbsp;the&nbsp;server&#39;s&nbsp;response&nbsp;value&nbsp;when&nbsp;the&nbsp;server</span><br>
<span class="lineno"></span><span class="comment" id="4376876">//&nbsp;receives&nbsp;an&nbsp;invalid&nbsp;request.&nbsp;It&nbsp;is&nbsp;never&nbsp;decoded&nbsp;by&nbsp;the&nbsp;client&nbsp;since&nbsp;the&nbsp;Response</span><br>
<span class="lineno"></span><span class="comment" id="4376961">//&nbsp;contains&nbsp;an&nbsp;error&nbsp;when&nbsp;it&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="4376999">var</span>&nbsp;<span class="ident" id="4377003">invalidRequest</span>&nbsp;<span class="op" id="4377018">=</span>&nbsp;<span class="keyword" id="4377020">struct</span><span class="op" id="4377026">{</span><span class="op" id="4377027">}</span><span class="op" id="4377028">{</span><span class="op" id="4377029">}</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span><span class="keyword" id="4377032">func</span>&nbsp;<span class="op" id="4377037">(</span><span class="ident" id="4377038">server</span>&nbsp;<span class="op" id="4377045">*</span><span class="ident" id="4377046">Server</span><span class="op" id="4377052">)</span>&nbsp;<span class="ident" id="4377054">sendResponse</span><span class="op" id="4377066">(</span><span class="ident" id="4377067">sending</span>&nbsp;<span class="op" id="4377075">*</span><span class="ident" id="4377076">sync</span><span class="op" id="4377080">.</span><span class="ident" id="4377081">Mutex</span><span class="op" id="4377086">,</span>&nbsp;<span class="ident" id="4377088">req</span>&nbsp;<span class="op" id="4377092">*</span><span class="ident" id="4377093">Request</span><span class="op" id="4377100">,</span>&nbsp;<span class="ident" id="4377102">reply</span>&nbsp;<span class="keyword" id="4377108">interface</span><span class="op" id="4377117">{</span><span class="op" id="4377118">}</span><span class="op" id="4377119">,</span>&nbsp;<span class="ident" id="4377121">codec</span>&nbsp;<span class="ident" id="4377127">ServerCodec</span><span class="op" id="4377138">,</span>&nbsp;<span class="ident" id="4377140">errmsg</span>&nbsp;<span class="builtintype" id="4377147">string</span><span class="op" id="4377153">)</span>&nbsp;<span class="op" id="4377155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377158">resp</span>&nbsp;<span class="op" id="4377163">:=</span>&nbsp;<span class="ident" id="4377166">server</span><span class="op" id="4377172">.</span><span class="ident" id="4377173">getResponse</span><span class="op" id="4377184">(</span><span class="op" id="4377185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4377188">//&nbsp;Encode&nbsp;the&nbsp;response&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377219">resp</span><span class="op" id="4377223">.</span><span class="ident" id="4377224">ServiceMethod</span>&nbsp;<span class="op" id="4377238">=</span>&nbsp;<span class="ident" id="4377240">req</span><span class="op" id="4377243">.</span><span class="ident" id="4377244">ServiceMethod</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4377259">if</span>&nbsp;<span class="ident" id="4377262">errmsg</span>&nbsp;<span class="op" id="4377269">!=</span>&nbsp;<span class="string" id="4377272">&#34;&#34;</span>&nbsp;<span class="op" id="4377275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377279">resp</span><span class="op" id="4377283">.</span><span class="ident" id="4377284">Error</span>&nbsp;<span class="op" id="4377290">=</span>&nbsp;<span class="ident" id="4377292">errmsg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377301">reply</span>&nbsp;<span class="op" id="4377307">=</span>&nbsp;<span class="ident" id="4377309">invalidRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4377325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377328">resp</span><span class="op" id="4377332">.</span><span class="ident" id="4377333">Seq</span>&nbsp;<span class="op" id="4377337">=</span>&nbsp;<span class="ident" id="4377339">req</span><span class="op" id="4377342">.</span><span class="ident" id="4377343">Seq</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377348">sending</span><span class="op" id="4377355">.</span><span class="ident" id="4377356">Lock</span><span class="op" id="4377360">(</span><span class="op" id="4377361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377364">err</span>&nbsp;<span class="op" id="4377368">:=</span>&nbsp;<span class="ident" id="4377371">codec</span><span class="op" id="4377376">.</span><span class="ident" id="4377377">WriteResponse</span><span class="op" id="4377390">(</span><span class="ident" id="4377391">resp</span><span class="op" id="4377395">,</span>&nbsp;<span class="ident" id="4377397">reply</span><span class="op" id="4377402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4377405">if</span>&nbsp;<span class="ident" id="4377408">debugLog</span>&nbsp;<span class="op" id="4377417">&amp;&amp;</span>&nbsp;<span class="ident" id="4377420">err</span>&nbsp;<span class="op" id="4377424">!=</span>&nbsp;<span class="ident" id="4377427">nil</span>&nbsp;<span class="op" id="4377431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377435">log</span><span class="op" id="4377438">.</span><span class="ident" id="4377439">Println</span><span class="op" id="4377446">(</span><span class="string" id="4377447">&#34;rpc:&nbsp;writing&nbsp;response:&#34;</span><span class="op" id="4377471">,</span>&nbsp;<span class="ident" id="4377473">err</span><span class="op" id="4377476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4377479">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377482">sending</span><span class="op" id="4377489">.</span><span class="ident" id="4377490">Unlock</span><span class="op" id="4377496">(</span><span class="op" id="4377497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377500">server</span><span class="op" id="4377506">.</span><span class="ident" id="4377507">freeResponse</span><span class="op" id="4377519">(</span><span class="ident" id="4377520">resp</span><span class="op" id="4377524">)</span><br>
<span class="lineno"></span><span class="op" id="4377526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4377529">func</span>&nbsp;<span class="op" id="4377534">(</span><span class="ident" id="4377535">m</span>&nbsp;<span class="op" id="4377537">*</span><span class="ident" id="4377538">methodType</span><span class="op" id="4377548">)</span>&nbsp;<span class="ident" id="4377550">NumCalls</span><span class="op" id="4377558">(</span><span class="op" id="4377559">)</span>&nbsp;<span class="op" id="4377561">(</span><span class="ident" id="4377562">n</span>&nbsp;<span class="builtintype" id="4377564">uint</span><span class="op" id="4377568">)</span>&nbsp;<span class="op" id="4377570">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377573">m</span><span class="op" id="4377574">.</span><span class="ident" id="4377575">Lock</span><span class="op" id="4377579">(</span><span class="op" id="4377580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377583">n</span>&nbsp;<span class="op" id="4377585">=</span>&nbsp;<span class="ident" id="4377587">m</span><span class="op" id="4377588">.</span><span class="ident" id="4377589">numCalls</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377599">m</span><span class="op" id="4377600">.</span><span class="ident" id="4377601">Unlock</span><span class="op" id="4377607">(</span><span class="op" id="4377608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4377611">return</span>&nbsp;<span class="ident" id="4377618">n</span><br>
<span class="lineno"></span><span class="op" id="4377620">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="keyword" id="4377623">func</span>&nbsp;<span class="op" id="4377628">(</span><span class="ident" id="4377629">s</span>&nbsp;<span class="op" id="4377631">*</span><span class="ident" id="4377632">service</span><span class="op" id="4377639">)</span>&nbsp;<span class="ident" id="4377641">call</span><span class="op" id="4377645">(</span><span class="ident" id="4377646">server</span>&nbsp;<span class="op" id="4377653">*</span><span class="ident" id="4377654">Server</span><span class="op" id="4377660">,</span>&nbsp;<span class="ident" id="4377662">sending</span>&nbsp;<span class="op" id="4377670">*</span><span class="ident" id="4377671">sync</span><span class="op" id="4377675">.</span><span class="ident" id="4377676">Mutex</span><span class="op" id="4377681">,</span>&nbsp;<span class="ident" id="4377683">mtype</span>&nbsp;<span class="op" id="4377689">*</span><span class="ident" id="4377690">methodType</span><span class="op" id="4377700">,</span>&nbsp;<span class="ident" id="4377702">req</span>&nbsp;<span class="op" id="4377706">*</span><span class="ident" id="4377707">Request</span><span class="op" id="4377714">,</span>&nbsp;<span class="ident" id="4377716">argv</span><span class="op" id="4377720">,</span>&nbsp;<span class="ident" id="4377722">replyv</span>&nbsp;<span class="ident" id="4377729">reflect</span><span class="op" id="4377736">.</span><span class="ident" id="4377737">Value</span><span class="op" id="4377742">,</span>&nbsp;<span class="ident" id="4377744">codec</span>&nbsp;<span class="ident" id="4377750">ServerCodec</span><span class="op" id="4377761">)</span>&nbsp;<span class="op" id="4377763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377766">mtype</span><span class="op" id="4377771">.</span><span class="ident" id="4377772">Lock</span><span class="op" id="4377776">(</span><span class="op" id="4377777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377780">mtype</span><span class="op" id="4377785">.</span><span class="ident" id="4377786">numCalls</span><span class="op" id="4377794">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377798">mtype</span><span class="op" id="4377803">.</span><span class="ident" id="4377804">Unlock</span><span class="op" id="4377810">(</span><span class="op" id="4377811">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377814">function</span>&nbsp;<span class="op" id="4377823">:=</span>&nbsp;<span class="ident" id="4377826">mtype</span><span class="op" id="4377831">.</span><span class="ident" id="4377832">method</span><span class="op" id="4377838">.</span><span class="ident" id="4377839">Func</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4377845">//&nbsp;Invoke&nbsp;the&nbsp;method,&nbsp;providing&nbsp;a&nbsp;new&nbsp;value&nbsp;for&nbsp;the&nbsp;reply.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377905">returnValues</span>&nbsp;<span class="op" id="4377918">:=</span>&nbsp;<span class="ident" id="4377921">function</span><span class="op" id="4377929">.</span><span class="ident" id="4377930">Call</span><span class="op" id="4377934">(</span><span class="op" id="4377935">[</span><span class="op" id="4377936">]</span><span class="ident" id="4377937">reflect</span><span class="op" id="4377944">.</span><span class="ident" id="4377945">Value</span><span class="op" id="4377950">{</span><span class="ident" id="4377951">s</span><span class="op" id="4377952">.</span><span class="ident" id="4377953">rcvr</span><span class="op" id="4377957">,</span>&nbsp;<span class="ident" id="4377959">argv</span><span class="op" id="4377963">,</span>&nbsp;<span class="ident" id="4377965">replyv</span><span class="op" id="4377971">}</span><span class="op" id="4377972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4377975">//&nbsp;The&nbsp;return&nbsp;value&nbsp;for&nbsp;the&nbsp;method&nbsp;is&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4378024">errInter</span>&nbsp;<span class="op" id="4378033">:=</span>&nbsp;<span class="ident" id="4378036">returnValues</span><span class="op" id="4378048">[</span><span class="num" id="4378049">0</span><span class="op" id="4378050">]</span><span class="op" id="4378051">.</span><span class="ident" id="4378052">Interface</span><span class="op" id="4378061">(</span><span class="op" id="4378062">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4378065">errmsg</span>&nbsp;<span class="op" id="4378072">:=</span>&nbsp;<span class="string" id="4378075">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4378079">if</span>&nbsp;<span class="ident" id="4378082">errInter</span>&nbsp;<span class="op" id="4378091">!=</span>&nbsp;<span class="ident" id="4378094">nil</span>&nbsp;<span class="op" id="4378098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4378102">errmsg</span>&nbsp;<span class="op" id="4378109">=</span>&nbsp;<span class="ident" id="4378111">errInter</span><span class="op" id="4378119">.</span><span class="op" id="4378120">(</span><span class="builtintype" id="4378121">error</span><span class="op" id="4378126">)</span><span class="op" id="4378127">.</span><span class="ident" id="4378128">Error</span><span class="op" id="4378133">(</span><span class="op" id="4378134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4378137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4378140">server</span><span class="op" id="4378146">.</span><span class="ident" id="4378147">sendResponse</span><span class="op" id="4378159">(</span><span class="ident" id="4378160">sending</span><span class="op" id="4378167">,</span>&nbsp;<span class="ident" id="4378169">req</span><span class="op" id="4378172">,</span>&nbsp;<span class="ident" id="4378174">replyv</span><span class="op" id="4378180">.</span><span class="ident" id="4378181">Interface</span><span class="op" id="4378190">(</span><span class="op" id="4378191">)</span><span class="op" id="4378192">,</span>&nbsp;<span class="ident" id="4378194">codec</span><span class="op" id="4378199">,</span>&nbsp;<span class="ident" id="4378201">errmsg</span><span class="op" id="4378207">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4378210">server</span><span class="op" id="4378216">.</span><span class="ident" id="4378217">freeRequest</span><span class="op" id="4378228">(</span><span class="ident" id="4378229">req</span><span class="op" id="4378232">)</span><br>
<span class="lineno"></span><span class="op" id="4378234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4378237">type</span>&nbsp;<span class="ident" id="4378242">gobServerCodec</span>&nbsp;<span class="keyword" id="4378257">struct</span>&nbsp;<span class="op" id="4378264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4378267">rwc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4378274">io</span><span class="op" id="4378276">.</span><span class="ident" id="4378277">ReadWriteCloser</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4378294">dec</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4378301">*</span><span class="ident" id="4378302">gob</span><span class="op" id="4378305">.</span><span class="ident" id="4378306">Decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4378315">enc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4378322">*</span><span class="ident" id="4378323">gob</span><span class="op" id="4378326">.</span><span class="ident" id="4378327">Encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4378336">encBuf</span>&nbsp;<span class="op" id="4378343">*</span><span class="ident" id="4378344">bufio</span><span class="op" id="4378349">.</span><span class="ident" id="4378350">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4378358">closed</span>&nbsp;<span class="builtintype" id="4378365">bool</span><br>
<span class="lineno"></span><span class="op" id="4378370">}</span><br>
<span class="lineno">400</span><br>
<span class="lineno"></span><span class="keyword" id="4378373">func</span>&nbsp;<span class="op" id="4378378">(</span><span class="ident" id="4378379">c</span>&nbsp;<span class="op" id="4378381">*</span><span class="ident" id="4378382">gobServerCodec</span><span class="op" id="4378396">)</span>&nbsp;<span class="ident" id="4378398">ReadRequestHeader</span><span class="op" id="4378415">(</span><span class="ident" id="4378416">r</span>&nbsp;<span class="op" id="4378418">*</span><span class="ident" id="4378419">Request</span><span class="op" id="4378426">)</span>&nbsp;<span class="builtintype" id="4378428">error</span>&nbsp;<span class="op" id="4378434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4378437">return</span>&nbsp;<span class="ident" id="4378444">c</span><span class="op" id="4378445">.</span><span class="ident" id="4378446">dec</span><span class="op" id="4378449">.</span><span class="ident" id="4378450">Decode</span><span class="op" id="4378456">(</span><span class="ident" id="4378457">r</span><span class="op" id="4378458">)</span><br>
<span class="lineno"></span><span class="op" id="4378460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span><span class="keyword" id="4378463">func</span>&nbsp;<span class="op" id="4378468">(</span><span class="ident" id="4378469">c</span>&nbsp;<span class="op" id="4378471">*</span><span class="ident" id="4378472">gobServerCodec</span><span class="op" id="4378486">)</span>&nbsp;<span class="ident" id="4378488">ReadRequestBody</span><span class="op" id="4378503">(</span><span class="ident" id="4378504">body</span>&nbsp;<span class="keyword" id="4378509">interface</span><span class="op" id="4378518">{</span><span class="op" id="4378519">}</span><span class="op" id="4378520">)</span>&nbsp;<span class="builtintype" id="4378522">error</span>&nbsp;<span class="op" id="4378528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4378531">return</span>&nbsp;<span class="ident" id="4378538">c</span><span class="op" id="4378539">.</span><span class="ident" id="4378540">dec</span><span class="op" id="4378543">.</span><span class="ident" id="4378544">Decode</span><span class="op" id="4378550">(</span><span class="ident" id="4378551">body</span><span class="op" id="4378555">)</span><br>
<span class="lineno"></span><span class="op" id="4378557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4378560">func</span>&nbsp;<span class="op" id="4378565">(</span><span class="ident" id="4378566">c</span>&nbsp;<span class="op" id="4378568">*</span><span class="ident" id="4378569">gobServerCodec</span><span class="op" id="4378583">)</span>&nbsp;<span class="ident" id="4378585">WriteResponse</span><span class="op" id="4378598">(</span><span class="ident" id="4378599">r</span>&nbsp;<span class="op" id="4378601">*</span><span class="ident" id="4378602">Response</span><span class="op" id="4378610">,</span>&nbsp;<span class="ident" id="4378612">body</span>&nbsp;<span class="keyword" id="4378617">interface</span><span class="op" id="4378626">{</span><span class="op" id="4378627">}</span><span class="op" id="4378628">)</span>&nbsp;<span class="op" id="4378630">(</span><span class="ident" id="4378631">err</span>&nbsp;<span class="builtintype" id="4378635">error</span><span class="op" id="4378640">)</span>&nbsp;<span class="op" id="4378642">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4378645">if</span>&nbsp;<span class="ident" id="4378648">err</span>&nbsp;<span class="op" id="4378652">=</span>&nbsp;<span class="ident" id="4378654">c</span><span class="op" id="4378655">.</span><span class="ident" id="4378656">enc</span><span class="op" id="4378659">.</span><span class="ident" id="4378660">Encode</span><span class="op" id="4378666">(</span><span class="ident" id="4378667">r</span><span class="op" id="4378668">)</span><span class="op" id="4378669">;</span>&nbsp;<span class="ident" id="4378671">err</span>&nbsp;<span class="op" id="4378675">!=</span>&nbsp;<span class="ident" id="4378678">nil</span>&nbsp;<span class="op" id="4378682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4378686">if</span>&nbsp;<span class="ident" id="4378689">c</span><span class="op" id="4378690">.</span><span class="ident" id="4378691">encBuf</span><span class="op" id="4378697">.</span><span class="ident" id="4378698">Flush</span><span class="op" id="4378703">(</span><span class="op" id="4378704">)</span>&nbsp;<span class="op" id="4378706">==</span>&nbsp;<span class="ident" id="4378709">nil</span>&nbsp;<span class="op" id="4378713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4378718">//&nbsp;Gob&nbsp;couldn&#39;t&nbsp;encode&nbsp;the&nbsp;header.&nbsp;Should&nbsp;not&nbsp;happen,&nbsp;so&nbsp;if&nbsp;it&nbsp;does,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4378790">//&nbsp;shut&nbsp;down&nbsp;the&nbsp;connection&nbsp;to&nbsp;signal&nbsp;that&nbsp;the&nbsp;connection&nbsp;is&nbsp;broken.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4378862">log</span><span class="op" id="4378865">.</span><span class="ident" id="4378866">Println</span><span class="op" id="4378873">(</span><span class="string" id="4378874">&#34;rpc:&nbsp;gob&nbsp;error&nbsp;encoding&nbsp;response:&#34;</span><span class="op" id="4378909">,</span>&nbsp;<span class="ident" id="4378911">err</span><span class="op" id="4378914">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4378919">c</span><span class="op" id="4378920">.</span><span class="ident" id="4378921">Close</span><span class="op" id="4378926">(</span><span class="op" id="4378927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4378931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4378935">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4378943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4378946">if</span>&nbsp;<span class="ident" id="4378949">err</span>&nbsp;<span class="op" id="4378953">=</span>&nbsp;<span class="ident" id="4378955">c</span><span class="op" id="4378956">.</span><span class="ident" id="4378957">enc</span><span class="op" id="4378960">.</span><span class="ident" id="4378961">Encode</span><span class="op" id="4378967">(</span><span class="ident" id="4378968">body</span><span class="op" id="4378972">)</span><span class="op" id="4378973">;</span>&nbsp;<span class="ident" id="4378975">err</span>&nbsp;<span class="op" id="4378979">!=</span>&nbsp;<span class="ident" id="4378982">nil</span>&nbsp;<span class="op" id="4378986">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4378990">if</span>&nbsp;<span class="ident" id="4378993">c</span><span class="op" id="4378994">.</span><span class="ident" id="4378995">encBuf</span><span class="op" id="4379001">.</span><span class="ident" id="4379002">Flush</span><span class="op" id="4379007">(</span><span class="op" id="4379008">)</span>&nbsp;<span class="op" id="4379010">==</span>&nbsp;<span class="ident" id="4379013">nil</span>&nbsp;<span class="op" id="4379017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4379022">//&nbsp;Was&nbsp;a&nbsp;gob&nbsp;problem&nbsp;encoding&nbsp;the&nbsp;body&nbsp;but&nbsp;the&nbsp;header&nbsp;has&nbsp;been&nbsp;written.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4379097">//&nbsp;Shut&nbsp;down&nbsp;the&nbsp;connection&nbsp;to&nbsp;signal&nbsp;that&nbsp;the&nbsp;connection&nbsp;is&nbsp;broken.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4379169">log</span><span class="op" id="4379172">.</span><span class="ident" id="4379173">Println</span><span class="op" id="4379180">(</span><span class="string" id="4379181">&#34;rpc:&nbsp;gob&nbsp;error&nbsp;encoding&nbsp;body:&#34;</span><span class="op" id="4379212">,</span>&nbsp;<span class="ident" id="4379214">err</span><span class="op" id="4379217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4379222">c</span><span class="op" id="4379223">.</span><span class="ident" id="4379224">Close</span><span class="op" id="4379229">(</span><span class="op" id="4379230">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4379234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4379238">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4379246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4379249">return</span>&nbsp;<span class="ident" id="4379256">c</span><span class="op" id="4379257">.</span><span class="ident" id="4379258">encBuf</span><span class="op" id="4379264">.</span><span class="ident" id="4379265">Flush</span><span class="op" id="4379270">(</span><span class="op" id="4379271">)</span><br>
<span class="lineno"></span><span class="op" id="4379273">}</span><br>
<span class="lineno">430</span><br>
<span class="lineno"></span><span class="keyword" id="4379276">func</span>&nbsp;<span class="op" id="4379281">(</span><span class="ident" id="4379282">c</span>&nbsp;<span class="op" id="4379284">*</span><span class="ident" id="4379285">gobServerCodec</span><span class="op" id="4379299">)</span>&nbsp;<span class="ident" id="4379301">Close</span><span class="op" id="4379306">(</span><span class="op" id="4379307">)</span>&nbsp;<span class="builtintype" id="4379309">error</span>&nbsp;<span class="op" id="4379315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4379318">if</span>&nbsp;<span class="ident" id="4379321">c</span><span class="op" id="4379322">.</span><span class="ident" id="4379323">closed</span>&nbsp;<span class="op" id="4379330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4379334">//&nbsp;Only&nbsp;call&nbsp;c.rwc.Close&nbsp;once;&nbsp;otherwise&nbsp;the&nbsp;semantics&nbsp;are&nbsp;undefined.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4379406">return</span>&nbsp;<span class="ident" id="4379413">nil</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4379418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4379421">c</span><span class="op" id="4379422">.</span><span class="ident" id="4379423">closed</span>&nbsp;<span class="op" id="4379430">=</span>&nbsp;<span class="builtintype" id="4379432">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4379438">return</span>&nbsp;<span class="ident" id="4379445">c</span><span class="op" id="4379446">.</span><span class="ident" id="4379447">rwc</span><span class="op" id="4379450">.</span><span class="ident" id="4379451">Close</span><span class="op" id="4379456">(</span><span class="op" id="4379457">)</span><br>
<span class="lineno"></span><span class="op" id="4379459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span><span class="comment" id="4379462">//&nbsp;ServeConn&nbsp;runs&nbsp;the&nbsp;server&nbsp;on&nbsp;a&nbsp;single&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="4379515">//&nbsp;ServeConn&nbsp;blocks,&nbsp;serving&nbsp;the&nbsp;connection&nbsp;until&nbsp;the&nbsp;client&nbsp;hangs&nbsp;up.</span><br>
<span class="lineno"></span><span class="comment" id="4379586">//&nbsp;The&nbsp;caller&nbsp;typically&nbsp;invokes&nbsp;ServeConn&nbsp;in&nbsp;a&nbsp;go&nbsp;statement.</span><br>
<span class="lineno"></span><span class="comment" id="4379647">//&nbsp;ServeConn&nbsp;uses&nbsp;the&nbsp;gob&nbsp;wire&nbsp;format&nbsp;(see&nbsp;package&nbsp;gob)&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4379710">//&nbsp;connection.&nbsp;&nbsp;To&nbsp;use&nbsp;an&nbsp;alternate&nbsp;codec,&nbsp;use&nbsp;ServeCodec.</span><br>
<span class="lineno">445</span><span class="keyword" id="4379769">func</span>&nbsp;<span class="op" id="4379774">(</span><span class="ident" id="4379775">server</span>&nbsp;<span class="op" id="4379782">*</span><span class="ident" id="4379783">Server</span><span class="op" id="4379789">)</span>&nbsp;<span class="ident" id="4379791">ServeConn</span><span class="op" id="4379800">(</span><span class="ident" id="4379801">conn</span>&nbsp;<span class="ident" id="4379806">io</span><span class="op" id="4379808">.</span><span class="ident" id="4379809">ReadWriteCloser</span><span class="op" id="4379824">)</span>&nbsp;<span class="op" id="4379826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4379829">buf</span>&nbsp;<span class="op" id="4379833">:=</span>&nbsp;<span class="ident" id="4379836">bufio</span><span class="op" id="4379841">.</span><span class="ident" id="4379842">NewWriter</span><span class="op" id="4379851">(</span><span class="ident" id="4379852">conn</span><span class="op" id="4379856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4379859">srv</span>&nbsp;<span class="op" id="4379863">:=</span>&nbsp;<span class="op" id="4379866">&amp;</span><span class="ident" id="4379867">gobServerCodec</span><span class="op" id="4379881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4379885">rwc</span><span class="op" id="4379888">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4379893">conn</span><span class="op" id="4379897">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4379901">dec</span><span class="op" id="4379904">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4379909">gob</span><span class="op" id="4379912">.</span><span class="ident" id="4379913">NewDecoder</span><span class="op" id="4379923">(</span><span class="ident" id="4379924">conn</span><span class="op" id="4379928">)</span><span class="op" id="4379929">,</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4379933">enc</span><span class="op" id="4379936">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4379941">gob</span><span class="op" id="4379944">.</span><span class="ident" id="4379945">NewEncoder</span><span class="op" id="4379955">(</span><span class="ident" id="4379956">buf</span><span class="op" id="4379959">)</span><span class="op" id="4379960">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4379964">encBuf</span><span class="op" id="4379970">:</span>&nbsp;<span class="ident" id="4379972">buf</span><span class="op" id="4379975">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4379978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4379981">server</span><span class="op" id="4379987">.</span><span class="ident" id="4379988">ServeCodec</span><span class="op" id="4379998">(</span><span class="ident" id="4379999">srv</span><span class="op" id="4380002">)</span><br>
<span class="lineno"></span><span class="op" id="4380004">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="comment" id="4380007">//&nbsp;ServeCodec&nbsp;is&nbsp;like&nbsp;ServeConn&nbsp;but&nbsp;uses&nbsp;the&nbsp;specified&nbsp;codec&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4380071">//&nbsp;decode&nbsp;requests&nbsp;and&nbsp;encode&nbsp;responses.</span><br>
<span class="lineno"></span><span class="keyword" id="4380112">func</span>&nbsp;<span class="op" id="4380117">(</span><span class="ident" id="4380118">server</span>&nbsp;<span class="op" id="4380125">*</span><span class="ident" id="4380126">Server</span><span class="op" id="4380132">)</span>&nbsp;<span class="ident" id="4380134">ServeCodec</span><span class="op" id="4380144">(</span><span class="ident" id="4380145">codec</span>&nbsp;<span class="ident" id="4380151">ServerCodec</span><span class="op" id="4380162">)</span>&nbsp;<span class="op" id="4380164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4380167">sending</span>&nbsp;<span class="op" id="4380175">:=</span>&nbsp;<span class="builtinfunc" id="4380178">new</span><span class="op" id="4380181">(</span><span class="ident" id="4380182">sync</span><span class="op" id="4380186">.</span><span class="ident" id="4380187">Mutex</span><span class="op" id="4380192">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4380195">for</span>&nbsp;<span class="op" id="4380199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4380203">service</span><span class="op" id="4380210">,</span>&nbsp;<span class="ident" id="4380212">mtype</span><span class="op" id="4380217">,</span>&nbsp;<span class="ident" id="4380219">req</span><span class="op" id="4380222">,</span>&nbsp;<span class="ident" id="4380224">argv</span><span class="op" id="4380228">,</span>&nbsp;<span class="ident" id="4380230">replyv</span><span class="op" id="4380236">,</span>&nbsp;<span class="ident" id="4380238">keepReading</span><span class="op" id="4380249">,</span>&nbsp;<span class="ident" id="4380251">err</span>&nbsp;<span class="op" id="4380255">:=</span>&nbsp;<span class="ident" id="4380258">server</span><span class="op" id="4380264">.</span><span class="ident" id="4380265">readRequest</span><span class="op" id="4380276">(</span><span class="ident" id="4380277">codec</span><span class="op" id="4380282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4380286">if</span>&nbsp;<span class="ident" id="4380289">err</span>&nbsp;<span class="op" id="4380293">!=</span>&nbsp;<span class="ident" id="4380296">nil</span>&nbsp;<span class="op" id="4380300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4380305">if</span>&nbsp;<span class="ident" id="4380308">debugLog</span>&nbsp;<span class="op" id="4380317">&amp;&amp;</span>&nbsp;<span class="ident" id="4380320">err</span>&nbsp;<span class="op" id="4380324">!=</span>&nbsp;<span class="ident" id="4380327">io</span><span class="op" id="4380329">.</span><span class="ident" id="4380330">EOF</span>&nbsp;<span class="op" id="4380334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4380340">log</span><span class="op" id="4380343">.</span><span class="ident" id="4380344">Println</span><span class="op" id="4380351">(</span><span class="string" id="4380352">&#34;rpc:&#34;</span><span class="op" id="4380358">,</span>&nbsp;<span class="ident" id="4380360">err</span><span class="op" id="4380363">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4380368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4380373">if</span>&nbsp;<span class="op" id="4380376">!</span><span class="ident" id="4380377">keepReading</span>&nbsp;<span class="op" id="4380389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4380395">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4380404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4380409">//&nbsp;send&nbsp;a&nbsp;response&nbsp;if&nbsp;we&nbsp;actually&nbsp;managed&nbsp;to&nbsp;read&nbsp;a&nbsp;header.</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4380472">if</span>&nbsp;<span class="ident" id="4380475">req</span>&nbsp;<span class="op" id="4380479">!=</span>&nbsp;<span class="ident" id="4380482">nil</span>&nbsp;<span class="op" id="4380486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4380492">server</span><span class="op" id="4380498">.</span><span class="ident" id="4380499">sendResponse</span><span class="op" id="4380511">(</span><span class="ident" id="4380512">sending</span><span class="op" id="4380519">,</span>&nbsp;<span class="ident" id="4380521">req</span><span class="op" id="4380524">,</span>&nbsp;<span class="ident" id="4380526">invalidRequest</span><span class="op" id="4380540">,</span>&nbsp;<span class="ident" id="4380542">codec</span><span class="op" id="4380547">,</span>&nbsp;<span class="ident" id="4380549">err</span><span class="op" id="4380552">.</span><span class="ident" id="4380553">Error</span><span class="op" id="4380558">(</span><span class="op" id="4380559">)</span><span class="op" id="4380560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4380566">server</span><span class="op" id="4380572">.</span><span class="ident" id="4380573">freeRequest</span><span class="op" id="4380584">(</span><span class="ident" id="4380585">req</span><span class="op" id="4380588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4380593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4380598">continue</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4380609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4380613">go</span>&nbsp;<span class="ident" id="4380616">service</span><span class="op" id="4380623">.</span><span class="ident" id="4380624">call</span><span class="op" id="4380628">(</span><span class="ident" id="4380629">server</span><span class="op" id="4380635">,</span>&nbsp;<span class="ident" id="4380637">sending</span><span class="op" id="4380644">,</span>&nbsp;<span class="ident" id="4380646">mtype</span><span class="op" id="4380651">,</span>&nbsp;<span class="ident" id="4380653">req</span><span class="op" id="4380656">,</span>&nbsp;<span class="ident" id="4380658">argv</span><span class="op" id="4380662">,</span>&nbsp;<span class="ident" id="4380664">replyv</span><span class="op" id="4380670">,</span>&nbsp;<span class="ident" id="4380672">codec</span><span class="op" id="4380677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4380680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4380683">codec</span><span class="op" id="4380688">.</span><span class="ident" id="4380689">Close</span><span class="op" id="4380694">(</span><span class="op" id="4380695">)</span><br>
<span class="lineno"></span><span class="op" id="4380697">}</span><br>
<span class="lineno">480</span><br>
<span class="lineno"></span><span class="comment" id="4380700">//&nbsp;ServeRequest&nbsp;is&nbsp;like&nbsp;ServeCodec&nbsp;but&nbsp;synchronously&nbsp;serves&nbsp;a&nbsp;single&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="4380778">//&nbsp;It&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;codec&nbsp;upon&nbsp;completion.</span><br>
<span class="lineno"></span><span class="keyword" id="4380826">func</span>&nbsp;<span class="op" id="4380831">(</span><span class="ident" id="4380832">server</span>&nbsp;<span class="op" id="4380839">*</span><span class="ident" id="4380840">Server</span><span class="op" id="4380846">)</span>&nbsp;<span class="ident" id="4380848">ServeRequest</span><span class="op" id="4380860">(</span><span class="ident" id="4380861">codec</span>&nbsp;<span class="ident" id="4380867">ServerCodec</span><span class="op" id="4380878">)</span>&nbsp;<span class="builtintype" id="4380880">error</span>&nbsp;<span class="op" id="4380886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4380889">sending</span>&nbsp;<span class="op" id="4380897">:=</span>&nbsp;<span class="builtinfunc" id="4380900">new</span><span class="op" id="4380903">(</span><span class="ident" id="4380904">sync</span><span class="op" id="4380908">.</span><span class="ident" id="4380909">Mutex</span><span class="op" id="4380914">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4380917">service</span><span class="op" id="4380924">,</span>&nbsp;<span class="ident" id="4380926">mtype</span><span class="op" id="4380931">,</span>&nbsp;<span class="ident" id="4380933">req</span><span class="op" id="4380936">,</span>&nbsp;<span class="ident" id="4380938">argv</span><span class="op" id="4380942">,</span>&nbsp;<span class="ident" id="4380944">replyv</span><span class="op" id="4380950">,</span>&nbsp;<span class="ident" id="4380952">keepReading</span><span class="op" id="4380963">,</span>&nbsp;<span class="ident" id="4380965">err</span>&nbsp;<span class="op" id="4380969">:=</span>&nbsp;<span class="ident" id="4380972">server</span><span class="op" id="4380978">.</span><span class="ident" id="4380979">readRequest</span><span class="op" id="4380990">(</span><span class="ident" id="4380991">codec</span><span class="op" id="4380996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4380999">if</span>&nbsp;<span class="ident" id="4381002">err</span>&nbsp;<span class="op" id="4381006">!=</span>&nbsp;<span class="ident" id="4381009">nil</span>&nbsp;<span class="op" id="4381013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4381017">if</span>&nbsp;<span class="op" id="4381020">!</span><span class="ident" id="4381021">keepReading</span>&nbsp;<span class="op" id="4381033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4381038">return</span>&nbsp;<span class="ident" id="4381045">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4381051">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4381055">//&nbsp;send&nbsp;a&nbsp;response&nbsp;if&nbsp;we&nbsp;actually&nbsp;managed&nbsp;to&nbsp;read&nbsp;a&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4381117">if</span>&nbsp;<span class="ident" id="4381120">req</span>&nbsp;<span class="op" id="4381124">!=</span>&nbsp;<span class="ident" id="4381127">nil</span>&nbsp;<span class="op" id="4381131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4381136">server</span><span class="op" id="4381142">.</span><span class="ident" id="4381143">sendResponse</span><span class="op" id="4381155">(</span><span class="ident" id="4381156">sending</span><span class="op" id="4381163">,</span>&nbsp;<span class="ident" id="4381165">req</span><span class="op" id="4381168">,</span>&nbsp;<span class="ident" id="4381170">invalidRequest</span><span class="op" id="4381184">,</span>&nbsp;<span class="ident" id="4381186">codec</span><span class="op" id="4381191">,</span>&nbsp;<span class="ident" id="4381193">err</span><span class="op" id="4381196">.</span><span class="ident" id="4381197">Error</span><span class="op" id="4381202">(</span><span class="op" id="4381203">)</span><span class="op" id="4381204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4381209">server</span><span class="op" id="4381215">.</span><span class="ident" id="4381216">freeRequest</span><span class="op" id="4381227">(</span><span class="ident" id="4381228">req</span><span class="op" id="4381231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4381235">}</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4381239">return</span>&nbsp;<span class="ident" id="4381246">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4381251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4381254">service</span><span class="op" id="4381261">.</span><span class="ident" id="4381262">call</span><span class="op" id="4381266">(</span><span class="ident" id="4381267">server</span><span class="op" id="4381273">,</span>&nbsp;<span class="ident" id="4381275">sending</span><span class="op" id="4381282">,</span>&nbsp;<span class="ident" id="4381284">mtype</span><span class="op" id="4381289">,</span>&nbsp;<span class="ident" id="4381291">req</span><span class="op" id="4381294">,</span>&nbsp;<span class="ident" id="4381296">argv</span><span class="op" id="4381300">,</span>&nbsp;<span class="ident" id="4381302">replyv</span><span class="op" id="4381308">,</span>&nbsp;<span class="ident" id="4381310">codec</span><span class="op" id="4381315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4381318">return</span>&nbsp;<span class="ident" id="4381325">nil</span><br>
<span class="lineno"></span><span class="op" id="4381329">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="keyword" id="4381332">func</span>&nbsp;<span class="op" id="4381337">(</span><span class="ident" id="4381338">server</span>&nbsp;<span class="op" id="4381345">*</span><span class="ident" id="4381346">Server</span><span class="op" id="4381352">)</span>&nbsp;<span class="ident" id="4381354">getRequest</span><span class="op" id="4381364">(</span><span class="op" id="4381365">)</span>&nbsp;<span class="op" id="4381367">*</span><span class="ident" id="4381368">Request</span>&nbsp;<span class="op" id="4381376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4381379">server</span><span class="op" id="4381385">.</span><span class="ident" id="4381386">reqLock</span><span class="op" id="4381393">.</span><span class="ident" id="4381394">Lock</span><span class="op" id="4381398">(</span><span class="op" id="4381399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4381402">req</span>&nbsp;<span class="op" id="4381406">:=</span>&nbsp;<span class="ident" id="4381409">server</span><span class="op" id="4381415">.</span><span class="ident" id="4381416">freeReq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4381425">if</span>&nbsp;<span class="ident" id="4381428">req</span>&nbsp;<span class="op" id="4381432">==</span>&nbsp;<span class="ident" id="4381435">nil</span>&nbsp;<span class="op" id="4381439">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4381443">req</span>&nbsp;<span class="op" id="4381447">=</span>&nbsp;<span class="builtinfunc" id="4381449">new</span><span class="op" id="4381452">(</span><span class="ident" id="4381453">Request</span><span class="op" id="4381460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4381463">}</span>&nbsp;<span class="keyword" id="4381465">else</span>&nbsp;<span class="op" id="4381470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4381474">server</span><span class="op" id="4381480">.</span><span class="ident" id="4381481">freeReq</span>&nbsp;<span class="op" id="4381489">=</span>&nbsp;<span class="ident" id="4381491">req</span><span class="op" id="4381494">.</span><span class="ident" id="4381495">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4381502">*</span><span class="ident" id="4381503">req</span>&nbsp;<span class="op" id="4381507">=</span>&nbsp;<span class="ident" id="4381509">Request</span><span class="op" id="4381516">{</span><span class="op" id="4381517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4381520">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4381523">server</span><span class="op" id="4381529">.</span><span class="ident" id="4381530">reqLock</span><span class="op" id="4381537">.</span><span class="ident" id="4381538">Unlock</span><span class="op" id="4381544">(</span><span class="op" id="4381545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4381548">return</span>&nbsp;<span class="ident" id="4381555">req</span><br>
<span class="lineno"></span><span class="op" id="4381559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4381562">func</span>&nbsp;<span class="op" id="4381567">(</span><span class="ident" id="4381568">server</span>&nbsp;<span class="op" id="4381575">*</span><span class="ident" id="4381576">Server</span><span class="op" id="4381582">)</span>&nbsp;<span class="ident" id="4381584">freeRequest</span><span class="op" id="4381595">(</span><span class="ident" id="4381596">req</span>&nbsp;<span class="op" id="4381600">*</span><span class="ident" id="4381601">Request</span><span class="op" id="4381608">)</span>&nbsp;<span class="op" id="4381610">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4381613">server</span><span class="op" id="4381619">.</span><span class="ident" id="4381620">reqLock</span><span class="op" id="4381627">.</span><span class="ident" id="4381628">Lock</span><span class="op" id="4381632">(</span><span class="op" id="4381633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4381636">req</span><span class="op" id="4381639">.</span><span class="ident" id="4381640">next</span>&nbsp;<span class="op" id="4381645">=</span>&nbsp;<span class="ident" id="4381647">server</span><span class="op" id="4381653">.</span><span class="ident" id="4381654">freeReq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4381663">server</span><span class="op" id="4381669">.</span><span class="ident" id="4381670">freeReq</span>&nbsp;<span class="op" id="4381678">=</span>&nbsp;<span class="ident" id="4381680">req</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4381685">server</span><span class="op" id="4381691">.</span><span class="ident" id="4381692">reqLock</span><span class="op" id="4381699">.</span><span class="ident" id="4381700">Unlock</span><span class="op" id="4381706">(</span><span class="op" id="4381707">)</span><br>
<span class="lineno"></span><span class="op" id="4381709">}</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span><span class="keyword" id="4381712">func</span>&nbsp;<span class="op" id="4381717">(</span><span class="ident" id="4381718">server</span>&nbsp;<span class="op" id="4381725">*</span><span class="ident" id="4381726">Server</span><span class="op" id="4381732">)</span>&nbsp;<span class="ident" id="4381734">getResponse</span><span class="op" id="4381745">(</span><span class="op" id="4381746">)</span>&nbsp;<span class="op" id="4381748">*</span><span class="ident" id="4381749">Response</span>&nbsp;<span class="op" id="4381758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4381761">server</span><span class="op" id="4381767">.</span><span class="ident" id="4381768">respLock</span><span class="op" id="4381776">.</span><span class="ident" id="4381777">Lock</span><span class="op" id="4381781">(</span><span class="op" id="4381782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4381785">resp</span>&nbsp;<span class="op" id="4381790">:=</span>&nbsp;<span class="ident" id="4381793">server</span><span class="op" id="4381799">.</span><span class="ident" id="4381800">freeResp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4381810">if</span>&nbsp;<span class="ident" id="4381813">resp</span>&nbsp;<span class="op" id="4381818">==</span>&nbsp;<span class="ident" id="4381821">nil</span>&nbsp;<span class="op" id="4381825">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4381829">resp</span>&nbsp;<span class="op" id="4381834">=</span>&nbsp;<span class="builtinfunc" id="4381836">new</span><span class="op" id="4381839">(</span><span class="ident" id="4381840">Response</span><span class="op" id="4381848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4381851">}</span>&nbsp;<span class="keyword" id="4381853">else</span>&nbsp;<span class="op" id="4381858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4381862">server</span><span class="op" id="4381868">.</span><span class="ident" id="4381869">freeResp</span>&nbsp;<span class="op" id="4381878">=</span>&nbsp;<span class="ident" id="4381880">resp</span><span class="op" id="4381884">.</span><span class="ident" id="4381885">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4381892">*</span><span class="ident" id="4381893">resp</span>&nbsp;<span class="op" id="4381898">=</span>&nbsp;<span class="ident" id="4381900">Response</span><span class="op" id="4381908">{</span><span class="op" id="4381909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4381912">}</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4381915">server</span><span class="op" id="4381921">.</span><span class="ident" id="4381922">respLock</span><span class="op" id="4381930">.</span><span class="ident" id="4381931">Unlock</span><span class="op" id="4381937">(</span><span class="op" id="4381938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4381941">return</span>&nbsp;<span class="ident" id="4381948">resp</span><br>
<span class="lineno"></span><span class="op" id="4381953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4381956">func</span>&nbsp;<span class="op" id="4381961">(</span><span class="ident" id="4381962">server</span>&nbsp;<span class="op" id="4381969">*</span><span class="ident" id="4381970">Server</span><span class="op" id="4381976">)</span>&nbsp;<span class="ident" id="4381978">freeResponse</span><span class="op" id="4381990">(</span><span class="ident" id="4381991">resp</span>&nbsp;<span class="op" id="4381996">*</span><span class="ident" id="4381997">Response</span><span class="op" id="4382005">)</span>&nbsp;<span class="op" id="4382007">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4382010">server</span><span class="op" id="4382016">.</span><span class="ident" id="4382017">respLock</span><span class="op" id="4382025">.</span><span class="ident" id="4382026">Lock</span><span class="op" id="4382030">(</span><span class="op" id="4382031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4382034">resp</span><span class="op" id="4382038">.</span><span class="ident" id="4382039">next</span>&nbsp;<span class="op" id="4382044">=</span>&nbsp;<span class="ident" id="4382046">server</span><span class="op" id="4382052">.</span><span class="ident" id="4382053">freeResp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4382063">server</span><span class="op" id="4382069">.</span><span class="ident" id="4382070">freeResp</span>&nbsp;<span class="op" id="4382079">=</span>&nbsp;<span class="ident" id="4382081">resp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4382087">server</span><span class="op" id="4382093">.</span><span class="ident" id="4382094">respLock</span><span class="op" id="4382102">.</span><span class="ident" id="4382103">Unlock</span><span class="op" id="4382109">(</span><span class="op" id="4382110">)</span><br>
<span class="lineno"></span><span class="op" id="4382112">}</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span><span class="keyword" id="4382115">func</span>&nbsp;<span class="op" id="4382120">(</span><span class="ident" id="4382121">server</span>&nbsp;<span class="op" id="4382128">*</span><span class="ident" id="4382129">Server</span><span class="op" id="4382135">)</span>&nbsp;<span class="ident" id="4382137">readRequest</span><span class="op" id="4382148">(</span><span class="ident" id="4382149">codec</span>&nbsp;<span class="ident" id="4382155">ServerCodec</span><span class="op" id="4382166">)</span>&nbsp;<span class="op" id="4382168">(</span><span class="ident" id="4382169">service</span>&nbsp;<span class="op" id="4382177">*</span><span class="ident" id="4382178">service</span><span class="op" id="4382185">,</span>&nbsp;<span class="ident" id="4382187">mtype</span>&nbsp;<span class="op" id="4382193">*</span><span class="ident" id="4382194">methodType</span><span class="op" id="4382204">,</span>&nbsp;<span class="ident" id="4382206">req</span>&nbsp;<span class="op" id="4382210">*</span><span class="ident" id="4382211">Request</span><span class="op" id="4382218">,</span>&nbsp;<span class="ident" id="4382220">argv</span><span class="op" id="4382224">,</span>&nbsp;<span class="ident" id="4382226">replyv</span>&nbsp;<span class="ident" id="4382233">reflect</span><span class="op" id="4382240">.</span><span class="ident" id="4382241">Value</span><span class="op" id="4382246">,</span>&nbsp;<span class="ident" id="4382248">keepReading</span>&nbsp;<span class="builtintype" id="4382260">bool</span><span class="op" id="4382264">,</span>&nbsp;<span class="ident" id="4382266">err</span>&nbsp;<span class="builtintype" id="4382270">error</span><span class="op" id="4382275">)</span>&nbsp;<span class="op" id="4382277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4382280">service</span><span class="op" id="4382287">,</span>&nbsp;<span class="ident" id="4382289">mtype</span><span class="op" id="4382294">,</span>&nbsp;<span class="ident" id="4382296">req</span><span class="op" id="4382299">,</span>&nbsp;<span class="ident" id="4382301">keepReading</span><span class="op" id="4382312">,</span>&nbsp;<span class="ident" id="4382314">err</span>&nbsp;<span class="op" id="4382318">=</span>&nbsp;<span class="ident" id="4382320">server</span><span class="op" id="4382326">.</span><span class="ident" id="4382327">readRequestHeader</span><span class="op" id="4382344">(</span><span class="ident" id="4382345">codec</span><span class="op" id="4382350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4382353">if</span>&nbsp;<span class="ident" id="4382356">err</span>&nbsp;<span class="op" id="4382360">!=</span>&nbsp;<span class="ident" id="4382363">nil</span>&nbsp;<span class="op" id="4382367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4382371">if</span>&nbsp;<span class="op" id="4382374">!</span><span class="ident" id="4382375">keepReading</span>&nbsp;<span class="op" id="4382387">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4382392">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4382401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4382405">//&nbsp;discard&nbsp;body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4382423">codec</span><span class="op" id="4382428">.</span><span class="ident" id="4382429">ReadRequestBody</span><span class="op" id="4382444">(</span><span class="ident" id="4382445">nil</span><span class="op" id="4382448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4382452">return</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4382460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4382464">//&nbsp;Decode&nbsp;the&nbsp;argument&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4382495">argIsValue</span>&nbsp;<span class="op" id="4382506">:=</span>&nbsp;<span class="builtintype" id="4382509">false</span>&nbsp;<span class="comment" id="4382515">//&nbsp;if&nbsp;true,&nbsp;need&nbsp;to&nbsp;indirect&nbsp;before&nbsp;calling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4382561">if</span>&nbsp;<span class="ident" id="4382564">mtype</span><span class="op" id="4382569">.</span><span class="ident" id="4382570">ArgType</span><span class="op" id="4382577">.</span><span class="ident" id="4382578">Kind</span><span class="op" id="4382582">(</span><span class="op" id="4382583">)</span>&nbsp;<span class="op" id="4382585">==</span>&nbsp;<span class="ident" id="4382588">reflect</span><span class="op" id="4382595">.</span><span class="ident" id="4382596">Ptr</span>&nbsp;<span class="op" id="4382600">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4382604">argv</span>&nbsp;<span class="op" id="4382609">=</span>&nbsp;<span class="ident" id="4382611">reflect</span><span class="op" id="4382618">.</span><span class="ident" id="4382619">New</span><span class="op" id="4382622">(</span><span class="ident" id="4382623">mtype</span><span class="op" id="4382628">.</span><span class="ident" id="4382629">ArgType</span><span class="op" id="4382636">.</span><span class="ident" id="4382637">Elem</span><span class="op" id="4382641">(</span><span class="op" id="4382642">)</span><span class="op" id="4382643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4382646">}</span>&nbsp;<span class="keyword" id="4382648">else</span>&nbsp;<span class="op" id="4382653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4382657">argv</span>&nbsp;<span class="op" id="4382662">=</span>&nbsp;<span class="ident" id="4382664">reflect</span><span class="op" id="4382671">.</span><span class="ident" id="4382672">New</span><span class="op" id="4382675">(</span><span class="ident" id="4382676">mtype</span><span class="op" id="4382681">.</span><span class="ident" id="4382682">ArgType</span><span class="op" id="4382689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4382693">argIsValue</span>&nbsp;<span class="op" id="4382704">=</span>&nbsp;<span class="builtintype" id="4382706">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4382712">}</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4382715">//&nbsp;argv&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;a&nbsp;pointer&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4382756">if</span>&nbsp;<span class="ident" id="4382759">err</span>&nbsp;<span class="op" id="4382763">=</span>&nbsp;<span class="ident" id="4382765">codec</span><span class="op" id="4382770">.</span><span class="ident" id="4382771">ReadRequestBody</span><span class="op" id="4382786">(</span><span class="ident" id="4382787">argv</span><span class="op" id="4382791">.</span><span class="ident" id="4382792">Interface</span><span class="op" id="4382801">(</span><span class="op" id="4382802">)</span><span class="op" id="4382803">)</span><span class="op" id="4382804">;</span>&nbsp;<span class="ident" id="4382806">err</span>&nbsp;<span class="op" id="4382810">!=</span>&nbsp;<span class="ident" id="4382813">nil</span>&nbsp;<span class="op" id="4382817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4382821">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4382829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4382832">if</span>&nbsp;<span class="ident" id="4382835">argIsValue</span>&nbsp;<span class="op" id="4382846">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4382850">argv</span>&nbsp;<span class="op" id="4382855">=</span>&nbsp;<span class="ident" id="4382857">argv</span><span class="op" id="4382861">.</span><span class="ident" id="4382862">Elem</span><span class="op" id="4382866">(</span><span class="op" id="4382867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4382870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4382874">replyv</span>&nbsp;<span class="op" id="4382881">=</span>&nbsp;<span class="ident" id="4382883">reflect</span><span class="op" id="4382890">.</span><span class="ident" id="4382891">New</span><span class="op" id="4382894">(</span><span class="ident" id="4382895">mtype</span><span class="op" id="4382900">.</span><span class="ident" id="4382901">ReplyType</span><span class="op" id="4382910">.</span><span class="ident" id="4382911">Elem</span><span class="op" id="4382915">(</span><span class="op" id="4382916">)</span><span class="op" id="4382917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4382920">return</span><br>
<span class="lineno">570</span><span class="op" id="4382927">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4382930">func</span>&nbsp;<span class="op" id="4382935">(</span><span class="ident" id="4382936">server</span>&nbsp;<span class="op" id="4382943">*</span><span class="ident" id="4382944">Server</span><span class="op" id="4382950">)</span>&nbsp;<span class="ident" id="4382952">readRequestHeader</span><span class="op" id="4382969">(</span><span class="ident" id="4382970">codec</span>&nbsp;<span class="ident" id="4382976">ServerCodec</span><span class="op" id="4382987">)</span>&nbsp;<span class="op" id="4382989">(</span><span class="ident" id="4382990">service</span>&nbsp;<span class="op" id="4382998">*</span><span class="ident" id="4382999">service</span><span class="op" id="4383006">,</span>&nbsp;<span class="ident" id="4383008">mtype</span>&nbsp;<span class="op" id="4383014">*</span><span class="ident" id="4383015">methodType</span><span class="op" id="4383025">,</span>&nbsp;<span class="ident" id="4383027">req</span>&nbsp;<span class="op" id="4383031">*</span><span class="ident" id="4383032">Request</span><span class="op" id="4383039">,</span>&nbsp;<span class="ident" id="4383041">keepReading</span>&nbsp;<span class="builtintype" id="4383053">bool</span><span class="op" id="4383057">,</span>&nbsp;<span class="ident" id="4383059">err</span>&nbsp;<span class="builtintype" id="4383063">error</span><span class="op" id="4383068">)</span>&nbsp;<span class="op" id="4383070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4383073">//&nbsp;Grab&nbsp;the&nbsp;request&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383102">req</span>&nbsp;<span class="op" id="4383106">=</span>&nbsp;<span class="ident" id="4383108">server</span><span class="op" id="4383114">.</span><span class="ident" id="4383115">getRequest</span><span class="op" id="4383125">(</span><span class="op" id="4383126">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383129">err</span>&nbsp;<span class="op" id="4383133">=</span>&nbsp;<span class="ident" id="4383135">codec</span><span class="op" id="4383140">.</span><span class="ident" id="4383141">ReadRequestHeader</span><span class="op" id="4383158">(</span><span class="ident" id="4383159">req</span><span class="op" id="4383162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4383165">if</span>&nbsp;<span class="ident" id="4383168">err</span>&nbsp;<span class="op" id="4383172">!=</span>&nbsp;<span class="ident" id="4383175">nil</span>&nbsp;<span class="op" id="4383179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383183">req</span>&nbsp;<span class="op" id="4383187">=</span>&nbsp;<span class="ident" id="4383189">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4383195">if</span>&nbsp;<span class="ident" id="4383198">err</span>&nbsp;<span class="op" id="4383202">==</span>&nbsp;<span class="ident" id="4383205">io</span><span class="op" id="4383207">.</span><span class="ident" id="4383208">EOF</span>&nbsp;<span class="op" id="4383212">||</span>&nbsp;<span class="ident" id="4383215">err</span>&nbsp;<span class="op" id="4383219">==</span>&nbsp;<span class="ident" id="4383222">io</span><span class="op" id="4383224">.</span><span class="ident" id="4383225">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="4383242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4383247">return</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4383256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383260">err</span>&nbsp;<span class="op" id="4383264">=</span>&nbsp;<span class="ident" id="4383266">errors</span><span class="op" id="4383272">.</span><span class="ident" id="4383273">New</span><span class="op" id="4383276">(</span><span class="string" id="4383277">&#34;rpc:&nbsp;server&nbsp;cannot&nbsp;decode&nbsp;request:&nbsp;&#34;</span>&nbsp;<span class="op" id="4383315">+</span>&nbsp;<span class="ident" id="4383317">err</span><span class="op" id="4383320">.</span><span class="ident" id="4383321">Error</span><span class="op" id="4383326">(</span><span class="op" id="4383327">)</span><span class="op" id="4383328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4383332">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4383340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4383344">//&nbsp;We&nbsp;read&nbsp;the&nbsp;header&nbsp;successfully.&nbsp;&nbsp;If&nbsp;we&nbsp;see&nbsp;an&nbsp;error&nbsp;now,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4383406">//&nbsp;we&nbsp;can&nbsp;still&nbsp;recover&nbsp;and&nbsp;move&nbsp;on&nbsp;to&nbsp;the&nbsp;next&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383464">keepReading</span>&nbsp;<span class="op" id="4383476">=</span>&nbsp;<span class="builtintype" id="4383478">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383485">dot</span>&nbsp;<span class="op" id="4383489">:=</span>&nbsp;<span class="ident" id="4383492">strings</span><span class="op" id="4383499">.</span><span class="ident" id="4383500">LastIndex</span><span class="op" id="4383509">(</span><span class="ident" id="4383510">req</span><span class="op" id="4383513">.</span><span class="ident" id="4383514">ServiceMethod</span><span class="op" id="4383527">,</span>&nbsp;<span class="string" id="4383529">&#34;.&#34;</span><span class="op" id="4383532">)</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4383535">if</span>&nbsp;<span class="ident" id="4383538">dot</span>&nbsp;<span class="op" id="4383542">&lt;</span>&nbsp;<span class="num" id="4383544">0</span>&nbsp;<span class="op" id="4383546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383550">err</span>&nbsp;<span class="op" id="4383554">=</span>&nbsp;<span class="ident" id="4383556">errors</span><span class="op" id="4383562">.</span><span class="ident" id="4383563">New</span><span class="op" id="4383566">(</span><span class="string" id="4383567">&#34;rpc:&nbsp;service/method&nbsp;request&nbsp;ill-formed:&nbsp;&#34;</span>&nbsp;<span class="op" id="4383610">+</span>&nbsp;<span class="ident" id="4383612">req</span><span class="op" id="4383615">.</span><span class="ident" id="4383616">ServiceMethod</span><span class="op" id="4383629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4383633">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4383641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383644">serviceName</span>&nbsp;<span class="op" id="4383656">:=</span>&nbsp;<span class="ident" id="4383659">req</span><span class="op" id="4383662">.</span><span class="ident" id="4383663">ServiceMethod</span><span class="op" id="4383676">[</span><span class="op" id="4383677">:</span><span class="ident" id="4383678">dot</span><span class="op" id="4383681">]</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383684">methodName</span>&nbsp;<span class="op" id="4383695">:=</span>&nbsp;<span class="ident" id="4383698">req</span><span class="op" id="4383701">.</span><span class="ident" id="4383702">ServiceMethod</span><span class="op" id="4383715">[</span><span class="ident" id="4383716">dot</span><span class="op" id="4383719">+</span><span class="num" id="4383720">1</span><span class="op" id="4383721">:</span><span class="op" id="4383722">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4383726">//&nbsp;Look&nbsp;up&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383751">server</span><span class="op" id="4383757">.</span><span class="ident" id="4383758">mu</span><span class="op" id="4383760">.</span><span class="ident" id="4383761">RLock</span><span class="op" id="4383766">(</span><span class="op" id="4383767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383770">service</span>&nbsp;<span class="op" id="4383778">=</span>&nbsp;<span class="ident" id="4383780">server</span><span class="op" id="4383786">.</span><span class="ident" id="4383787">serviceMap</span><span class="op" id="4383797">[</span><span class="ident" id="4383798">serviceName</span><span class="op" id="4383809">]</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383812">server</span><span class="op" id="4383818">.</span><span class="ident" id="4383819">mu</span><span class="op" id="4383821">.</span><span class="ident" id="4383822">RUnlock</span><span class="op" id="4383829">(</span><span class="op" id="4383830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4383833">if</span>&nbsp;<span class="ident" id="4383836">service</span>&nbsp;<span class="op" id="4383844">==</span>&nbsp;<span class="ident" id="4383847">nil</span>&nbsp;<span class="op" id="4383851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383855">err</span>&nbsp;<span class="op" id="4383859">=</span>&nbsp;<span class="ident" id="4383861">errors</span><span class="op" id="4383867">.</span><span class="ident" id="4383868">New</span><span class="op" id="4383871">(</span><span class="string" id="4383872">&#34;rpc:&nbsp;can&#39;t&nbsp;find&nbsp;service&nbsp;&#34;</span>&nbsp;<span class="op" id="4383899">+</span>&nbsp;<span class="ident" id="4383901">req</span><span class="op" id="4383904">.</span><span class="ident" id="4383905">ServiceMethod</span><span class="op" id="4383918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4383922">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4383930">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383933">mtype</span>&nbsp;<span class="op" id="4383939">=</span>&nbsp;<span class="ident" id="4383941">service</span><span class="op" id="4383948">.</span><span class="ident" id="4383949">method</span><span class="op" id="4383955">[</span><span class="ident" id="4383956">methodName</span><span class="op" id="4383966">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4383969">if</span>&nbsp;<span class="ident" id="4383972">mtype</span>&nbsp;<span class="op" id="4383978">==</span>&nbsp;<span class="ident" id="4383981">nil</span>&nbsp;<span class="op" id="4383985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383989">err</span>&nbsp;<span class="op" id="4383993">=</span>&nbsp;<span class="ident" id="4383995">errors</span><span class="op" id="4384001">.</span><span class="ident" id="4384002">New</span><span class="op" id="4384005">(</span><span class="string" id="4384006">&#34;rpc:&nbsp;can&#39;t&nbsp;find&nbsp;method&nbsp;&#34;</span>&nbsp;<span class="op" id="4384032">+</span>&nbsp;<span class="ident" id="4384034">req</span><span class="op" id="4384037">.</span><span class="ident" id="4384038">ServiceMethod</span><span class="op" id="4384051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4384054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4384057">return</span><br>
<span class="lineno">610</span><span class="op" id="4384064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4384067">//&nbsp;Accept&nbsp;accepts&nbsp;connections&nbsp;on&nbsp;the&nbsp;listener&nbsp;and&nbsp;serves&nbsp;requests</span><br>
<span class="lineno"></span><span class="comment" id="4384133">//&nbsp;for&nbsp;each&nbsp;incoming&nbsp;connection.&nbsp;&nbsp;Accept&nbsp;blocks;&nbsp;the&nbsp;caller&nbsp;typically</span><br>
<span class="lineno"></span><span class="comment" id="4384203">//&nbsp;invokes&nbsp;it&nbsp;in&nbsp;a&nbsp;go&nbsp;statement.</span><br>
<span class="lineno">615</span><span class="keyword" id="4384236">func</span>&nbsp;<span class="op" id="4384241">(</span><span class="ident" id="4384242">server</span>&nbsp;<span class="op" id="4384249">*</span><span class="ident" id="4384250">Server</span><span class="op" id="4384256">)</span>&nbsp;<span class="ident" id="4384258">Accept</span><span class="op" id="4384264">(</span><span class="ident" id="4384265">lis</span>&nbsp;<span class="ident" id="4384269">net</span><span class="op" id="4384272">.</span><span class="ident" id="4384273">Listener</span><span class="op" id="4384281">)</span>&nbsp;<span class="op" id="4384283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4384286">for</span>&nbsp;<span class="op" id="4384290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4384294">conn</span><span class="op" id="4384298">,</span>&nbsp;<span class="ident" id="4384300">err</span>&nbsp;<span class="op" id="4384304">:=</span>&nbsp;<span class="ident" id="4384307">lis</span><span class="op" id="4384310">.</span><span class="ident" id="4384311">Accept</span><span class="op" id="4384317">(</span><span class="op" id="4384318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4384322">if</span>&nbsp;<span class="ident" id="4384325">err</span>&nbsp;<span class="op" id="4384329">!=</span>&nbsp;<span class="ident" id="4384332">nil</span>&nbsp;<span class="op" id="4384336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4384341">log</span><span class="op" id="4384344">.</span><span class="ident" id="4384345">Fatal</span><span class="op" id="4384350">(</span><span class="string" id="4384351">&#34;rpc.Serve:&nbsp;accept:&#34;</span><span class="op" id="4384371">,</span>&nbsp;<span class="ident" id="4384373">err</span><span class="op" id="4384376">.</span><span class="ident" id="4384377">Error</span><span class="op" id="4384382">(</span><span class="op" id="4384383">)</span><span class="op" id="4384384">)</span>&nbsp;<span class="comment" id="4384386">//&nbsp;TODO(r):&nbsp;exit?</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4384406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4384410">go</span>&nbsp;<span class="ident" id="4384413">server</span><span class="op" id="4384419">.</span><span class="ident" id="4384420">ServeConn</span><span class="op" id="4384429">(</span><span class="ident" id="4384430">conn</span><span class="op" id="4384434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4384437">}</span><br>
<span class="lineno"></span><span class="op" id="4384439">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">625</span><span class="comment" id="4384442">//&nbsp;Register&nbsp;publishes&nbsp;the&nbsp;receiver&#39;s&nbsp;methods&nbsp;in&nbsp;the&nbsp;DefaultServer.</span><br>
<span class="lineno"></span><span class="keyword" id="4384509">func</span>&nbsp;<span class="ident" id="4384514">Register</span><span class="op" id="4384522">(</span><span class="ident" id="4384523">rcvr</span>&nbsp;<span class="keyword" id="4384528">interface</span><span class="op" id="4384537">{</span><span class="op" id="4384538">}</span><span class="op" id="4384539">)</span>&nbsp;<span class="builtintype" id="4384541">error</span>&nbsp;<span class="op" id="4384547">{</span>&nbsp;<span class="keyword" id="4384549">return</span>&nbsp;<span class="ident" id="4384556">DefaultServer</span><span class="op" id="4384569">.</span><span class="ident" id="4384570">Register</span><span class="op" id="4384578">(</span><span class="ident" id="4384579">rcvr</span><span class="op" id="4384583">)</span>&nbsp;<span class="op" id="4384585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4384588">//&nbsp;RegisterName&nbsp;is&nbsp;like&nbsp;Register&nbsp;but&nbsp;uses&nbsp;the&nbsp;provided&nbsp;name&nbsp;for&nbsp;the&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="4384661">//&nbsp;instead&nbsp;of&nbsp;the&nbsp;receiver&#39;s&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno">630</span><span class="keyword" id="4384705">func</span>&nbsp;<span class="ident" id="4384710">RegisterName</span><span class="op" id="4384722">(</span><span class="ident" id="4384723">name</span>&nbsp;<span class="builtintype" id="4384728">string</span><span class="op" id="4384734">,</span>&nbsp;<span class="ident" id="4384736">rcvr</span>&nbsp;<span class="keyword" id="4384741">interface</span><span class="op" id="4384750">{</span><span class="op" id="4384751">}</span><span class="op" id="4384752">)</span>&nbsp;<span class="builtintype" id="4384754">error</span>&nbsp;<span class="op" id="4384760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4384763">return</span>&nbsp;<span class="ident" id="4384770">DefaultServer</span><span class="op" id="4384783">.</span><span class="ident" id="4384784">RegisterName</span><span class="op" id="4384796">(</span><span class="ident" id="4384797">name</span><span class="op" id="4384801">,</span>&nbsp;<span class="ident" id="4384803">rcvr</span><span class="op" id="4384807">)</span><br>
<span class="lineno"></span><span class="op" id="4384809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4384812">//&nbsp;A&nbsp;ServerCodec&nbsp;implements&nbsp;reading&nbsp;of&nbsp;RPC&nbsp;requests&nbsp;and&nbsp;writing&nbsp;of</span><br>
<span class="lineno">635</span><span class="comment" id="4384879">//&nbsp;RPC&nbsp;responses&nbsp;for&nbsp;the&nbsp;server&nbsp;side&nbsp;of&nbsp;an&nbsp;RPC&nbsp;session.</span><br>
<span class="lineno"></span><span class="comment" id="4384935">//&nbsp;The&nbsp;server&nbsp;calls&nbsp;ReadRequestHeader&nbsp;and&nbsp;ReadRequestBody&nbsp;in&nbsp;pairs</span><br>
<span class="lineno"></span><span class="comment" id="4385002">//&nbsp;to&nbsp;read&nbsp;requests&nbsp;from&nbsp;the&nbsp;connection,&nbsp;and&nbsp;it&nbsp;calls&nbsp;WriteResponse&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4385073">//&nbsp;write&nbsp;a&nbsp;response&nbsp;back.&nbsp;&nbsp;The&nbsp;server&nbsp;calls&nbsp;Close&nbsp;when&nbsp;finished&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4385146">//&nbsp;connection.&nbsp;ReadRequestBody&nbsp;may&nbsp;be&nbsp;called&nbsp;with&nbsp;a&nbsp;nil</span><br>
<span class="lineno">640</span><span class="comment" id="4385202">//&nbsp;argument&nbsp;to&nbsp;force&nbsp;the&nbsp;body&nbsp;of&nbsp;the&nbsp;request&nbsp;to&nbsp;be&nbsp;read&nbsp;and&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="keyword" id="4385273">type</span>&nbsp;<span class="ident" id="4385278">ServerCodec</span>&nbsp;<span class="keyword" id="4385290">interface</span>&nbsp;<span class="op" id="4385300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4385303">ReadRequestHeader</span><span class="op" id="4385320">(</span><span class="op" id="4385321">*</span><span class="ident" id="4385322">Request</span><span class="op" id="4385329">)</span>&nbsp;<span class="builtintype" id="4385331">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4385338">ReadRequestBody</span><span class="op" id="4385353">(</span><span class="keyword" id="4385354">interface</span><span class="op" id="4385363">{</span><span class="op" id="4385364">}</span><span class="op" id="4385365">)</span>&nbsp;<span class="builtintype" id="4385367">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4385374">//&nbsp;WriteResponse&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4385448">WriteResponse</span><span class="op" id="4385461">(</span><span class="op" id="4385462">*</span><span class="ident" id="4385463">Response</span><span class="op" id="4385471">,</span>&nbsp;<span class="keyword" id="4385473">interface</span><span class="op" id="4385482">{</span><span class="op" id="4385483">}</span><span class="op" id="4385484">)</span>&nbsp;<span class="builtintype" id="4385486">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4385494">Close</span><span class="op" id="4385499">(</span><span class="op" id="4385500">)</span>&nbsp;<span class="builtintype" id="4385502">error</span><br>
<span class="lineno"></span><span class="op" id="4385508">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">650</span><span class="comment" id="4385511">//&nbsp;ServeConn&nbsp;runs&nbsp;the&nbsp;DefaultServer&nbsp;on&nbsp;a&nbsp;single&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="4385571">//&nbsp;ServeConn&nbsp;blocks,&nbsp;serving&nbsp;the&nbsp;connection&nbsp;until&nbsp;the&nbsp;client&nbsp;hangs&nbsp;up.</span><br>
<span class="lineno"></span><span class="comment" id="4385642">//&nbsp;The&nbsp;caller&nbsp;typically&nbsp;invokes&nbsp;ServeConn&nbsp;in&nbsp;a&nbsp;go&nbsp;statement.</span><br>
<span class="lineno"></span><span class="comment" id="4385703">//&nbsp;ServeConn&nbsp;uses&nbsp;the&nbsp;gob&nbsp;wire&nbsp;format&nbsp;(see&nbsp;package&nbsp;gob)&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4385766">//&nbsp;connection.&nbsp;&nbsp;To&nbsp;use&nbsp;an&nbsp;alternate&nbsp;codec,&nbsp;use&nbsp;ServeCodec.</span><br>
<span class="lineno">655</span><span class="keyword" id="4385825">func</span>&nbsp;<span class="ident" id="4385830">ServeConn</span><span class="op" id="4385839">(</span><span class="ident" id="4385840">conn</span>&nbsp;<span class="ident" id="4385845">io</span><span class="op" id="4385847">.</span><span class="ident" id="4385848">ReadWriteCloser</span><span class="op" id="4385863">)</span>&nbsp;<span class="op" id="4385865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4385868">DefaultServer</span><span class="op" id="4385881">.</span><span class="ident" id="4385882">ServeConn</span><span class="op" id="4385891">(</span><span class="ident" id="4385892">conn</span><span class="op" id="4385896">)</span><br>
<span class="lineno"></span><span class="op" id="4385898">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4385901">//&nbsp;ServeCodec&nbsp;is&nbsp;like&nbsp;ServeConn&nbsp;but&nbsp;uses&nbsp;the&nbsp;specified&nbsp;codec&nbsp;to</span><br>
<span class="lineno">660</span><span class="comment" id="4385965">//&nbsp;decode&nbsp;requests&nbsp;and&nbsp;encode&nbsp;responses.</span><br>
<span class="lineno"></span><span class="keyword" id="4386006">func</span>&nbsp;<span class="ident" id="4386011">ServeCodec</span><span class="op" id="4386021">(</span><span class="ident" id="4386022">codec</span>&nbsp;<span class="ident" id="4386028">ServerCodec</span><span class="op" id="4386039">)</span>&nbsp;<span class="op" id="4386041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4386044">DefaultServer</span><span class="op" id="4386057">.</span><span class="ident" id="4386058">ServeCodec</span><span class="op" id="4386068">(</span><span class="ident" id="4386069">codec</span><span class="op" id="4386074">)</span><br>
<span class="lineno"></span><span class="op" id="4386076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">665</span><span class="comment" id="4386079">//&nbsp;ServeRequest&nbsp;is&nbsp;like&nbsp;ServeCodec&nbsp;but&nbsp;synchronously&nbsp;serves&nbsp;a&nbsp;single&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="4386157">//&nbsp;It&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;codec&nbsp;upon&nbsp;completion.</span><br>
<span class="lineno"></span><span class="keyword" id="4386205">func</span>&nbsp;<span class="ident" id="4386210">ServeRequest</span><span class="op" id="4386222">(</span><span class="ident" id="4386223">codec</span>&nbsp;<span class="ident" id="4386229">ServerCodec</span><span class="op" id="4386240">)</span>&nbsp;<span class="builtintype" id="4386242">error</span>&nbsp;<span class="op" id="4386248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4386251">return</span>&nbsp;<span class="ident" id="4386258">DefaultServer</span><span class="op" id="4386271">.</span><span class="ident" id="4386272">ServeRequest</span><span class="op" id="4386284">(</span><span class="ident" id="4386285">codec</span><span class="op" id="4386290">)</span><br>
<span class="lineno"></span><span class="op" id="4386292">}</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span><span class="comment" id="4386295">//&nbsp;Accept&nbsp;accepts&nbsp;connections&nbsp;on&nbsp;the&nbsp;listener&nbsp;and&nbsp;serves&nbsp;requests</span><br>
<span class="lineno"></span><span class="comment" id="4386361">//&nbsp;to&nbsp;DefaultServer&nbsp;for&nbsp;each&nbsp;incoming&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="4386411">//&nbsp;Accept&nbsp;blocks;&nbsp;the&nbsp;caller&nbsp;typically&nbsp;invokes&nbsp;it&nbsp;in&nbsp;a&nbsp;go&nbsp;statement.</span><br>
<span class="lineno"></span><span class="keyword" id="4386480">func</span>&nbsp;<span class="ident" id="4386485">Accept</span><span class="op" id="4386491">(</span><span class="ident" id="4386492">lis</span>&nbsp;<span class="ident" id="4386496">net</span><span class="op" id="4386499">.</span><span class="ident" id="4386500">Listener</span><span class="op" id="4386508">)</span>&nbsp;<span class="op" id="4386510">{</span>&nbsp;<span class="ident" id="4386512">DefaultServer</span><span class="op" id="4386525">.</span><span class="ident" id="4386526">Accept</span><span class="op" id="4386532">(</span><span class="ident" id="4386533">lis</span><span class="op" id="4386536">)</span>&nbsp;<span class="op" id="4386538">}</span><br>
<span class="lineno">675</span><br>
<span class="lineno"></span><span class="comment" id="4386541">//&nbsp;Can&nbsp;connect&nbsp;to&nbsp;RPC&nbsp;service&nbsp;using&nbsp;HTTP&nbsp;CONNECT&nbsp;to&nbsp;rpcPath.</span><br>
<span class="lineno"></span><span class="keyword" id="4386602">var</span>&nbsp;<span class="ident" id="4386606">connected</span>&nbsp;<span class="op" id="4386616">=</span>&nbsp;<span class="string" id="4386618">&#34;200&nbsp;Connected&nbsp;to&nbsp;Go&nbsp;RPC&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4386645">//&nbsp;ServeHTTP&nbsp;implements&nbsp;an&nbsp;http.Handler&nbsp;that&nbsp;answers&nbsp;RPC&nbsp;requests.</span><br>
<span class="lineno">680</span><span class="keyword" id="4386712">func</span>&nbsp;<span class="op" id="4386717">(</span><span class="ident" id="4386718">server</span>&nbsp;<span class="op" id="4386725">*</span><span class="ident" id="4386726">Server</span><span class="op" id="4386732">)</span>&nbsp;<span class="ident" id="4386734">ServeHTTP</span><span class="op" id="4386743">(</span><span class="ident" id="4386744">w</span>&nbsp;<span class="ident" id="4386746">http</span><span class="op" id="4386750">.</span><span class="ident" id="4386751">ResponseWriter</span><span class="op" id="4386765">,</span>&nbsp;<span class="ident" id="4386767">req</span>&nbsp;<span class="op" id="4386771">*</span><span class="ident" id="4386772">http</span><span class="op" id="4386776">.</span><span class="ident" id="4386777">Request</span><span class="op" id="4386784">)</span>&nbsp;<span class="op" id="4386786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4386789">if</span>&nbsp;<span class="ident" id="4386792">req</span><span class="op" id="4386795">.</span><span class="ident" id="4386796">Method</span>&nbsp;<span class="op" id="4386803">!=</span>&nbsp;<span class="string" id="4386806">&#34;CONNECT&#34;</span>&nbsp;<span class="op" id="4386816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4386820">w</span><span class="op" id="4386821">.</span><span class="ident" id="4386822">Header</span><span class="op" id="4386828">(</span><span class="op" id="4386829">)</span><span class="op" id="4386830">.</span><span class="ident" id="4386831">Set</span><span class="op" id="4386834">(</span><span class="string" id="4386835">&#34;Content-Type&#34;</span><span class="op" id="4386849">,</span>&nbsp;<span class="string" id="4386851">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="4386878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4386882">w</span><span class="op" id="4386883">.</span><span class="ident" id="4386884">WriteHeader</span><span class="op" id="4386895">(</span><span class="ident" id="4386896">http</span><span class="op" id="4386900">.</span><span class="ident" id="4386901">StatusMethodNotAllowed</span><span class="op" id="4386923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4386927">io</span><span class="op" id="4386929">.</span><span class="ident" id="4386930">WriteString</span><span class="op" id="4386941">(</span><span class="ident" id="4386942">w</span><span class="op" id="4386943">,</span>&nbsp;<span class="string" id="4386945">&#34;405&nbsp;must&nbsp;CONNECT\n&#34;</span><span class="op" id="4386965">)</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4386969">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4386977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4386980">conn</span><span class="op" id="4386984">,</span>&nbsp;<span class="ident" id="4386986">_</span><span class="op" id="4386987">,</span>&nbsp;<span class="ident" id="4386989">err</span>&nbsp;<span class="op" id="4386993">:=</span>&nbsp;<span class="ident" id="4386996">w</span><span class="op" id="4386997">.</span><span class="op" id="4386998">(</span><span class="ident" id="4386999">http</span><span class="op" id="4387003">.</span><span class="ident" id="4387004">Hijacker</span><span class="op" id="4387012">)</span><span class="op" id="4387013">.</span><span class="ident" id="4387014">Hijack</span><span class="op" id="4387020">(</span><span class="op" id="4387021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4387024">if</span>&nbsp;<span class="ident" id="4387027">err</span>&nbsp;<span class="op" id="4387031">!=</span>&nbsp;<span class="ident" id="4387034">nil</span>&nbsp;<span class="op" id="4387038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4387042">log</span><span class="op" id="4387045">.</span><span class="ident" id="4387046">Print</span><span class="op" id="4387051">(</span><span class="string" id="4387052">&#34;rpc&nbsp;hijacking&nbsp;&#34;</span><span class="op" id="4387068">,</span>&nbsp;<span class="ident" id="4387070">req</span><span class="op" id="4387073">.</span><span class="ident" id="4387074">RemoteAddr</span><span class="op" id="4387084">,</span>&nbsp;<span class="string" id="4387086">&#34;:&nbsp;&#34;</span><span class="op" id="4387090">,</span>&nbsp;<span class="ident" id="4387092">err</span><span class="op" id="4387095">.</span><span class="ident" id="4387096">Error</span><span class="op" id="4387101">(</span><span class="op" id="4387102">)</span><span class="op" id="4387103">)</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4387107">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4387115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4387118">io</span><span class="op" id="4387120">.</span><span class="ident" id="4387121">WriteString</span><span class="op" id="4387132">(</span><span class="ident" id="4387133">conn</span><span class="op" id="4387137">,</span>&nbsp;<span class="string" id="4387139">&#34;HTTP/1.0&nbsp;&#34;</span><span class="op" id="4387150">+</span><span class="ident" id="4387151">connected</span><span class="op" id="4387160">+</span><span class="string" id="4387161">&#34;\n\n&#34;</span><span class="op" id="4387167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4387170">server</span><span class="op" id="4387176">.</span><span class="ident" id="4387177">ServeConn</span><span class="op" id="4387186">(</span><span class="ident" id="4387187">conn</span><span class="op" id="4387191">)</span><br>
<span class="lineno"></span><span class="op" id="4387193">}</span><br>
<span class="lineno">695</span><br>
<span class="lineno"></span><span class="comment" id="4387196">//&nbsp;HandleHTTP&nbsp;registers&nbsp;an&nbsp;HTTP&nbsp;handler&nbsp;for&nbsp;RPC&nbsp;messages&nbsp;on&nbsp;rpcPath,</span><br>
<span class="lineno"></span><span class="comment" id="4387265">//&nbsp;and&nbsp;a&nbsp;debugging&nbsp;handler&nbsp;on&nbsp;debugPath.</span><br>
<span class="lineno"></span><span class="comment" id="4387306">//&nbsp;It&nbsp;is&nbsp;still&nbsp;necessary&nbsp;to&nbsp;invoke&nbsp;http.Serve(),&nbsp;typically&nbsp;in&nbsp;a&nbsp;go&nbsp;statement.</span><br>
<span class="lineno"></span><span class="keyword" id="4387384">func</span>&nbsp;<span class="op" id="4387389">(</span><span class="ident" id="4387390">server</span>&nbsp;<span class="op" id="4387397">*</span><span class="ident" id="4387398">Server</span><span class="op" id="4387404">)</span>&nbsp;<span class="ident" id="4387406">HandleHTTP</span><span class="op" id="4387416">(</span><span class="ident" id="4387417">rpcPath</span><span class="op" id="4387424">,</span>&nbsp;<span class="ident" id="4387426">debugPath</span>&nbsp;<span class="builtintype" id="4387436">string</span><span class="op" id="4387442">)</span>&nbsp;<span class="op" id="4387444">{</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4387447">http</span><span class="op" id="4387451">.</span><span class="ident" id="4387452">Handle</span><span class="op" id="4387458">(</span><span class="ident" id="4387459">rpcPath</span><span class="op" id="4387466">,</span>&nbsp;<span class="ident" id="4387468">server</span><span class="op" id="4387474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4387477">http</span><span class="op" id="4387481">.</span><span class="ident" id="4387482">Handle</span><span class="op" id="4387488">(</span><span class="ident" id="4387489">debugPath</span><span class="op" id="4387498">,</span>&nbsp;<span class="ident" id="4387500">debugHTTP</span><span class="op" id="4387509">{</span><span class="ident" id="4387510">server</span><span class="op" id="4387516">}</span><span class="op" id="4387517">)</span><br>
<span class="lineno"></span><span class="op" id="4387519">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4387522">//&nbsp;HandleHTTP&nbsp;registers&nbsp;an&nbsp;HTTP&nbsp;handler&nbsp;for&nbsp;RPC&nbsp;messages&nbsp;to&nbsp;DefaultServer</span><br>
<span class="lineno">705</span><span class="comment" id="4387596">//&nbsp;on&nbsp;DefaultRPCPath&nbsp;and&nbsp;a&nbsp;debugging&nbsp;handler&nbsp;on&nbsp;DefaultDebugPath.</span><br>
<span class="lineno"></span><span class="comment" id="4387662">//&nbsp;It&nbsp;is&nbsp;still&nbsp;necessary&nbsp;to&nbsp;invoke&nbsp;http.Serve(),&nbsp;typically&nbsp;in&nbsp;a&nbsp;go&nbsp;statement.</span><br>
<span class="lineno"></span><span class="keyword" id="4387740">func</span>&nbsp;<span class="ident" id="4387745">HandleHTTP</span><span class="op" id="4387755">(</span><span class="op" id="4387756">)</span>&nbsp;<span class="op" id="4387758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4387761">DefaultServer</span><span class="op" id="4387774">.</span><span class="ident" id="4387775">HandleHTTP</span><span class="op" id="4387785">(</span><span class="ident" id="4387786">DefaultRPCPath</span><span class="op" id="4387800">,</span>&nbsp;<span class="ident" id="4387802">DefaultDebugPath</span><span class="op" id="4387818">)</span><br>
<span class="lineno"></span><span class="op" id="4387820">}</span>
</div>
</body>
</html>
