<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/subtle</h2>
<ul>
<li><a href="/gostd/crypto/subtle/constant_time.go.html">constant_time.go</a></li>
<li><a href="/gostd/crypto/subtle/constant_time_test.go.html">constant_time_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7695739">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7695794">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7695848">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7695899">package</span>&nbsp;<span class="ident" id="7695907">subtle</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7695915">import</span>&nbsp;<span class="op" id="7695922">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7695925">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7695936">&#34;testing/quick&#34;</span><br>
<span class="lineno">10</span><span class="op" id="7695952">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7695955">type</span>&nbsp;<span class="ident" id="7695960">TestConstantTimeCompareStruct</span>&nbsp;<span class="keyword" id="7695990">struct</span>&nbsp;<span class="op" id="7695997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7696000">a</span><span class="op" id="7696001">,</span>&nbsp;<span class="ident" id="7696003">b</span>&nbsp;<span class="op" id="7696005">[</span><span class="op" id="7696006">]</span><span class="builtintype" id="7696007">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7696013">out</span>&nbsp;&nbsp;<span class="builtintype" id="7696018">int</span><br>
<span class="lineno">15</span><span class="op" id="7696022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7696025">var</span>&nbsp;<span class="ident" id="7696029">testConstantTimeCompareData</span>&nbsp;<span class="op" id="7696057">=</span>&nbsp;<span class="op" id="7696059">[</span><span class="op" id="7696060">]</span><span class="ident" id="7696061">TestConstantTimeCompareStruct</span><span class="op" id="7696090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7696093">{</span><span class="op" id="7696094">[</span><span class="op" id="7696095">]</span><span class="builtintype" id="7696096">byte</span><span class="op" id="7696100">{</span><span class="op" id="7696101">}</span><span class="op" id="7696102">,</span>&nbsp;<span class="op" id="7696104">[</span><span class="op" id="7696105">]</span><span class="builtintype" id="7696106">byte</span><span class="op" id="7696110">{</span><span class="op" id="7696111">}</span><span class="op" id="7696112">,</span>&nbsp;<span class="num" id="7696114">1</span><span class="op" id="7696115">}</span><span class="op" id="7696116">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7696119">{</span><span class="op" id="7696120">[</span><span class="op" id="7696121">]</span><span class="builtintype" id="7696122">byte</span><span class="op" id="7696126">{</span><span class="num" id="7696127">0x11</span><span class="op" id="7696131">}</span><span class="op" id="7696132">,</span>&nbsp;<span class="op" id="7696134">[</span><span class="op" id="7696135">]</span><span class="builtintype" id="7696136">byte</span><span class="op" id="7696140">{</span><span class="num" id="7696141">0x11</span><span class="op" id="7696145">}</span><span class="op" id="7696146">,</span>&nbsp;<span class="num" id="7696148">1</span><span class="op" id="7696149">}</span><span class="op" id="7696150">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7696153">{</span><span class="op" id="7696154">[</span><span class="op" id="7696155">]</span><span class="builtintype" id="7696156">byte</span><span class="op" id="7696160">{</span><span class="num" id="7696161">0x12</span><span class="op" id="7696165">}</span><span class="op" id="7696166">,</span>&nbsp;<span class="op" id="7696168">[</span><span class="op" id="7696169">]</span><span class="builtintype" id="7696170">byte</span><span class="op" id="7696174">{</span><span class="num" id="7696175">0x11</span><span class="op" id="7696179">}</span><span class="op" id="7696180">,</span>&nbsp;<span class="num" id="7696182">0</span><span class="op" id="7696183">}</span><span class="op" id="7696184">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7696187">{</span><span class="op" id="7696188">[</span><span class="op" id="7696189">]</span><span class="builtintype" id="7696190">byte</span><span class="op" id="7696194">{</span><span class="num" id="7696195">0x11</span><span class="op" id="7696199">}</span><span class="op" id="7696200">,</span>&nbsp;<span class="op" id="7696202">[</span><span class="op" id="7696203">]</span><span class="builtintype" id="7696204">byte</span><span class="op" id="7696208">{</span><span class="num" id="7696209">0x11</span><span class="op" id="7696213">,</span>&nbsp;<span class="num" id="7696215">0x12</span><span class="op" id="7696219">}</span><span class="op" id="7696220">,</span>&nbsp;<span class="num" id="7696222">0</span><span class="op" id="7696223">}</span><span class="op" id="7696224">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7696227">{</span><span class="op" id="7696228">[</span><span class="op" id="7696229">]</span><span class="builtintype" id="7696230">byte</span><span class="op" id="7696234">{</span><span class="num" id="7696235">0x11</span><span class="op" id="7696239">,</span>&nbsp;<span class="num" id="7696241">0x12</span><span class="op" id="7696245">}</span><span class="op" id="7696246">,</span>&nbsp;<span class="op" id="7696248">[</span><span class="op" id="7696249">]</span><span class="builtintype" id="7696250">byte</span><span class="op" id="7696254">{</span><span class="num" id="7696255">0x11</span><span class="op" id="7696259">}</span><span class="op" id="7696260">,</span>&nbsp;<span class="num" id="7696262">0</span><span class="op" id="7696263">}</span><span class="op" id="7696264">,</span><br>
<span class="lineno"></span><span class="op" id="7696266">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="7696269">func</span>&nbsp;<span class="ident" id="7696274">TestConstantTimeCompare</span><span class="op" id="7696297">(</span><span class="ident" id="7696298">t</span>&nbsp;<span class="op" id="7696300">*</span><span class="ident" id="7696301">testing</span><span class="op" id="7696308">.</span><span class="ident" id="7696309">T</span><span class="op" id="7696310">)</span>&nbsp;<span class="op" id="7696312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7696315">for</span>&nbsp;<span class="ident" id="7696319">i</span><span class="op" id="7696320">,</span>&nbsp;<span class="ident" id="7696322">test</span>&nbsp;<span class="op" id="7696327">:=</span>&nbsp;<span class="keyword" id="7696330">range</span>&nbsp;<span class="ident" id="7696336">testConstantTimeCompareData</span>&nbsp;<span class="op" id="7696364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7696368">if</span>&nbsp;<span class="ident" id="7696371">r</span>&nbsp;<span class="op" id="7696373">:=</span>&nbsp;<span class="ident" id="7696376">ConstantTimeCompare</span><span class="op" id="7696395">(</span><span class="ident" id="7696396">test</span><span class="op" id="7696400">.</span><span class="ident" id="7696401">a</span><span class="op" id="7696402">,</span>&nbsp;<span class="ident" id="7696404">test</span><span class="op" id="7696408">.</span><span class="ident" id="7696409">b</span><span class="op" id="7696410">)</span><span class="op" id="7696411">;</span>&nbsp;<span class="ident" id="7696413">r</span>&nbsp;<span class="op" id="7696415">!=</span>&nbsp;<span class="ident" id="7696418">test</span><span class="op" id="7696422">.</span><span class="ident" id="7696423">out</span>&nbsp;<span class="op" id="7696427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7696432">t</span><span class="op" id="7696433">.</span><span class="ident" id="7696434">Errorf</span><span class="op" id="7696440">(</span><span class="string" id="7696441">&#34;#%d&nbsp;bad&nbsp;result&nbsp;(got&nbsp;%x,&nbsp;want&nbsp;%x)&#34;</span><span class="op" id="7696475">,</span>&nbsp;<span class="ident" id="7696477">i</span><span class="op" id="7696478">,</span>&nbsp;<span class="ident" id="7696480">r</span><span class="op" id="7696481">,</span>&nbsp;<span class="ident" id="7696483">test</span><span class="op" id="7696487">.</span><span class="ident" id="7696488">out</span><span class="op" id="7696491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7696495">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7696498">}</span><br>
<span class="lineno"></span><span class="op" id="7696500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7696503">type</span>&nbsp;<span class="ident" id="7696508">TestConstantTimeByteEqStruct</span>&nbsp;<span class="keyword" id="7696537">struct</span>&nbsp;<span class="op" id="7696544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7696547">a</span><span class="op" id="7696548">,</span>&nbsp;<span class="ident" id="7696550">b</span>&nbsp;<span class="builtintype" id="7696552">uint8</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7696559">out</span>&nbsp;&nbsp;<span class="builtintype" id="7696564">int</span><br>
<span class="lineno"></span><span class="op" id="7696568">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7696571">var</span>&nbsp;<span class="ident" id="7696575">testConstandTimeByteEqData</span>&nbsp;<span class="op" id="7696602">=</span>&nbsp;<span class="op" id="7696604">[</span><span class="op" id="7696605">]</span><span class="ident" id="7696606">TestConstantTimeByteEqStruct</span><span class="op" id="7696634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7696637">{</span><span class="num" id="7696638">0</span><span class="op" id="7696639">,</span>&nbsp;<span class="num" id="7696641">0</span><span class="op" id="7696642">,</span>&nbsp;<span class="num" id="7696644">1</span><span class="op" id="7696645">}</span><span class="op" id="7696646">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7696649">{</span><span class="num" id="7696650">0</span><span class="op" id="7696651">,</span>&nbsp;<span class="num" id="7696653">1</span><span class="op" id="7696654">,</span>&nbsp;<span class="num" id="7696656">0</span><span class="op" id="7696657">}</span><span class="op" id="7696658">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7696661">{</span><span class="num" id="7696662">1</span><span class="op" id="7696663">,</span>&nbsp;<span class="num" id="7696665">0</span><span class="op" id="7696666">,</span>&nbsp;<span class="num" id="7696668">0</span><span class="op" id="7696669">}</span><span class="op" id="7696670">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7696673">{</span><span class="num" id="7696674">0xff</span><span class="op" id="7696678">,</span>&nbsp;<span class="num" id="7696680">0xff</span><span class="op" id="7696684">,</span>&nbsp;<span class="num" id="7696686">1</span><span class="op" id="7696687">}</span><span class="op" id="7696688">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7696691">{</span><span class="num" id="7696692">0xff</span><span class="op" id="7696696">,</span>&nbsp;<span class="num" id="7696698">0xfe</span><span class="op" id="7696702">,</span>&nbsp;<span class="num" id="7696704">0</span><span class="op" id="7696705">}</span><span class="op" id="7696706">,</span><br>
<span class="lineno"></span><span class="op" id="7696708">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="7696711">func</span>&nbsp;<span class="ident" id="7696716">byteEq</span><span class="op" id="7696722">(</span><span class="ident" id="7696723">a</span><span class="op" id="7696724">,</span>&nbsp;<span class="ident" id="7696726">b</span>&nbsp;<span class="builtintype" id="7696728">uint8</span><span class="op" id="7696733">)</span>&nbsp;<span class="builtintype" id="7696735">int</span>&nbsp;<span class="op" id="7696739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7696742">if</span>&nbsp;<span class="ident" id="7696745">a</span>&nbsp;<span class="op" id="7696747">==</span>&nbsp;<span class="ident" id="7696750">b</span>&nbsp;<span class="op" id="7696752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7696756">return</span>&nbsp;<span class="num" id="7696763">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7696766">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7696769">return</span>&nbsp;<span class="num" id="7696776">0</span><br>
<span class="lineno"></span><span class="op" id="7696778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7696781">func</span>&nbsp;<span class="ident" id="7696786">TestConstantTimeByteEq</span><span class="op" id="7696808">(</span><span class="ident" id="7696809">t</span>&nbsp;<span class="op" id="7696811">*</span><span class="ident" id="7696812">testing</span><span class="op" id="7696819">.</span><span class="ident" id="7696820">T</span><span class="op" id="7696821">)</span>&nbsp;<span class="op" id="7696823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7696826">for</span>&nbsp;<span class="ident" id="7696830">i</span><span class="op" id="7696831">,</span>&nbsp;<span class="ident" id="7696833">test</span>&nbsp;<span class="op" id="7696838">:=</span>&nbsp;<span class="keyword" id="7696841">range</span>&nbsp;<span class="ident" id="7696847">testConstandTimeByteEqData</span>&nbsp;<span class="op" id="7696874">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7696878">if</span>&nbsp;<span class="ident" id="7696881">r</span>&nbsp;<span class="op" id="7696883">:=</span>&nbsp;<span class="ident" id="7696886">ConstantTimeByteEq</span><span class="op" id="7696904">(</span><span class="ident" id="7696905">test</span><span class="op" id="7696909">.</span><span class="ident" id="7696910">a</span><span class="op" id="7696911">,</span>&nbsp;<span class="ident" id="7696913">test</span><span class="op" id="7696917">.</span><span class="ident" id="7696918">b</span><span class="op" id="7696919">)</span><span class="op" id="7696920">;</span>&nbsp;<span class="ident" id="7696922">r</span>&nbsp;<span class="op" id="7696924">!=</span>&nbsp;<span class="ident" id="7696927">test</span><span class="op" id="7696931">.</span><span class="ident" id="7696932">out</span>&nbsp;<span class="op" id="7696936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7696941">t</span><span class="op" id="7696942">.</span><span class="ident" id="7696943">Errorf</span><span class="op" id="7696949">(</span><span class="string" id="7696950">&#34;#%d&nbsp;bad&nbsp;result&nbsp;(got&nbsp;%x,&nbsp;want&nbsp;%x)&#34;</span><span class="op" id="7696984">,</span>&nbsp;<span class="ident" id="7696986">i</span><span class="op" id="7696987">,</span>&nbsp;<span class="ident" id="7696989">r</span><span class="op" id="7696990">,</span>&nbsp;<span class="ident" id="7696992">test</span><span class="op" id="7696996">.</span><span class="ident" id="7696997">out</span><span class="op" id="7697000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7697004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7697007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7697010">err</span>&nbsp;<span class="op" id="7697014">:=</span>&nbsp;<span class="ident" id="7697017">quick</span><span class="op" id="7697022">.</span><span class="ident" id="7697023">CheckEqual</span><span class="op" id="7697033">(</span><span class="ident" id="7697034">ConstantTimeByteEq</span><span class="op" id="7697052">,</span>&nbsp;<span class="ident" id="7697054">byteEq</span><span class="op" id="7697060">,</span>&nbsp;<span class="ident" id="7697062">nil</span><span class="op" id="7697065">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7697068">if</span>&nbsp;<span class="ident" id="7697071">err</span>&nbsp;<span class="op" id="7697075">!=</span>&nbsp;<span class="ident" id="7697078">nil</span>&nbsp;<span class="op" id="7697082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7697086">t</span><span class="op" id="7697087">.</span><span class="ident" id="7697088">Error</span><span class="op" id="7697093">(</span><span class="ident" id="7697094">err</span><span class="op" id="7697097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7697100">}</span><br>
<span class="lineno"></span><span class="op" id="7697102">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="7697105">func</span>&nbsp;<span class="ident" id="7697110">eq</span><span class="op" id="7697112">(</span><span class="ident" id="7697113">a</span><span class="op" id="7697114">,</span>&nbsp;<span class="ident" id="7697116">b</span>&nbsp;<span class="builtintype" id="7697118">int32</span><span class="op" id="7697123">)</span>&nbsp;<span class="builtintype" id="7697125">int</span>&nbsp;<span class="op" id="7697129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7697132">if</span>&nbsp;<span class="ident" id="7697135">a</span>&nbsp;<span class="op" id="7697137">==</span>&nbsp;<span class="ident" id="7697140">b</span>&nbsp;<span class="op" id="7697142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7697146">return</span>&nbsp;<span class="num" id="7697153">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7697156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7697159">return</span>&nbsp;<span class="num" id="7697166">0</span><br>
<span class="lineno">70</span><span class="op" id="7697168">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7697171">func</span>&nbsp;<span class="ident" id="7697176">TestConstantTimeEq</span><span class="op" id="7697194">(</span><span class="ident" id="7697195">t</span>&nbsp;<span class="op" id="7697197">*</span><span class="ident" id="7697198">testing</span><span class="op" id="7697205">.</span><span class="ident" id="7697206">T</span><span class="op" id="7697207">)</span>&nbsp;<span class="op" id="7697209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7697212">err</span>&nbsp;<span class="op" id="7697216">:=</span>&nbsp;<span class="ident" id="7697219">quick</span><span class="op" id="7697224">.</span><span class="ident" id="7697225">CheckEqual</span><span class="op" id="7697235">(</span><span class="ident" id="7697236">ConstantTimeEq</span><span class="op" id="7697250">,</span>&nbsp;<span class="ident" id="7697252">eq</span><span class="op" id="7697254">,</span>&nbsp;<span class="ident" id="7697256">nil</span><span class="op" id="7697259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7697262">if</span>&nbsp;<span class="ident" id="7697265">err</span>&nbsp;<span class="op" id="7697269">!=</span>&nbsp;<span class="ident" id="7697272">nil</span>&nbsp;<span class="op" id="7697276">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7697280">t</span><span class="op" id="7697281">.</span><span class="ident" id="7697282">Error</span><span class="op" id="7697287">(</span><span class="ident" id="7697288">err</span><span class="op" id="7697291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7697294">}</span><br>
<span class="lineno"></span><span class="op" id="7697296">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7697299">func</span>&nbsp;<span class="ident" id="7697304">makeCopy</span><span class="op" id="7697312">(</span><span class="ident" id="7697313">v</span>&nbsp;<span class="builtintype" id="7697315">int</span><span class="op" id="7697318">,</span>&nbsp;<span class="ident" id="7697320">x</span><span class="op" id="7697321">,</span>&nbsp;<span class="ident" id="7697323">y</span>&nbsp;<span class="op" id="7697325">[</span><span class="op" id="7697326">]</span><span class="builtintype" id="7697327">byte</span><span class="op" id="7697331">)</span>&nbsp;<span class="op" id="7697333">[</span><span class="op" id="7697334">]</span><span class="builtintype" id="7697335">byte</span>&nbsp;<span class="op" id="7697340">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7697343">if</span>&nbsp;<span class="builtinfunc" id="7697346">len</span><span class="op" id="7697349">(</span><span class="ident" id="7697350">x</span><span class="op" id="7697351">)</span>&nbsp;<span class="op" id="7697353">&gt;</span>&nbsp;<span class="builtinfunc" id="7697355">len</span><span class="op" id="7697358">(</span><span class="ident" id="7697359">y</span><span class="op" id="7697360">)</span>&nbsp;<span class="op" id="7697362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7697366">x</span>&nbsp;<span class="op" id="7697368">=</span>&nbsp;<span class="ident" id="7697370">x</span><span class="op" id="7697371">[</span><span class="num" id="7697372">0</span><span class="op" id="7697373">:</span><span class="builtinfunc" id="7697374">len</span><span class="op" id="7697377">(</span><span class="ident" id="7697378">y</span><span class="op" id="7697379">)</span><span class="op" id="7697380">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7697383">}</span>&nbsp;<span class="keyword" id="7697385">else</span>&nbsp;<span class="op" id="7697390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7697394">y</span>&nbsp;<span class="op" id="7697396">=</span>&nbsp;<span class="ident" id="7697398">y</span><span class="op" id="7697399">[</span><span class="num" id="7697400">0</span><span class="op" id="7697401">:</span><span class="builtinfunc" id="7697402">len</span><span class="op" id="7697405">(</span><span class="ident" id="7697406">x</span><span class="op" id="7697407">)</span><span class="op" id="7697408">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7697411">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7697414">if</span>&nbsp;<span class="ident" id="7697417">v</span>&nbsp;<span class="op" id="7697419">==</span>&nbsp;<span class="num" id="7697422">1</span>&nbsp;<span class="op" id="7697424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7697428">copy</span><span class="op" id="7697432">(</span><span class="ident" id="7697433">x</span><span class="op" id="7697434">,</span>&nbsp;<span class="ident" id="7697436">y</span><span class="op" id="7697437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7697440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7697443">return</span>&nbsp;<span class="ident" id="7697450">x</span><br>
<span class="lineno"></span><span class="op" id="7697452">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="7697455">func</span>&nbsp;<span class="ident" id="7697460">constantTimeCopyWrapper</span><span class="op" id="7697483">(</span><span class="ident" id="7697484">v</span>&nbsp;<span class="builtintype" id="7697486">int</span><span class="op" id="7697489">,</span>&nbsp;<span class="ident" id="7697491">x</span><span class="op" id="7697492">,</span>&nbsp;<span class="ident" id="7697494">y</span>&nbsp;<span class="op" id="7697496">[</span><span class="op" id="7697497">]</span><span class="builtintype" id="7697498">byte</span><span class="op" id="7697502">)</span>&nbsp;<span class="op" id="7697504">[</span><span class="op" id="7697505">]</span><span class="builtintype" id="7697506">byte</span>&nbsp;<span class="op" id="7697511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7697514">if</span>&nbsp;<span class="builtinfunc" id="7697517">len</span><span class="op" id="7697520">(</span><span class="ident" id="7697521">x</span><span class="op" id="7697522">)</span>&nbsp;<span class="op" id="7697524">&gt;</span>&nbsp;<span class="builtinfunc" id="7697526">len</span><span class="op" id="7697529">(</span><span class="ident" id="7697530">y</span><span class="op" id="7697531">)</span>&nbsp;<span class="op" id="7697533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7697537">x</span>&nbsp;<span class="op" id="7697539">=</span>&nbsp;<span class="ident" id="7697541">x</span><span class="op" id="7697542">[</span><span class="num" id="7697543">0</span><span class="op" id="7697544">:</span><span class="builtinfunc" id="7697545">len</span><span class="op" id="7697548">(</span><span class="ident" id="7697549">y</span><span class="op" id="7697550">)</span><span class="op" id="7697551">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7697554">}</span>&nbsp;<span class="keyword" id="7697556">else</span>&nbsp;<span class="op" id="7697561">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7697565">y</span>&nbsp;<span class="op" id="7697567">=</span>&nbsp;<span class="ident" id="7697569">y</span><span class="op" id="7697570">[</span><span class="num" id="7697571">0</span><span class="op" id="7697572">:</span><span class="builtinfunc" id="7697573">len</span><span class="op" id="7697576">(</span><span class="ident" id="7697577">x</span><span class="op" id="7697578">)</span><span class="op" id="7697579">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7697582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7697585">v</span>&nbsp;<span class="op" id="7697587">&amp;=</span>&nbsp;<span class="num" id="7697590">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7697593">ConstantTimeCopy</span><span class="op" id="7697609">(</span><span class="ident" id="7697610">v</span><span class="op" id="7697611">,</span>&nbsp;<span class="ident" id="7697613">x</span><span class="op" id="7697614">,</span>&nbsp;<span class="ident" id="7697616">y</span><span class="op" id="7697617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7697620">return</span>&nbsp;<span class="ident" id="7697627">x</span><br>
<span class="lineno">100</span><span class="op" id="7697629">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7697632">func</span>&nbsp;<span class="ident" id="7697637">TestConstantTimeCopy</span><span class="op" id="7697657">(</span><span class="ident" id="7697658">t</span>&nbsp;<span class="op" id="7697660">*</span><span class="ident" id="7697661">testing</span><span class="op" id="7697668">.</span><span class="ident" id="7697669">T</span><span class="op" id="7697670">)</span>&nbsp;<span class="op" id="7697672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7697675">err</span>&nbsp;<span class="op" id="7697679">:=</span>&nbsp;<span class="ident" id="7697682">quick</span><span class="op" id="7697687">.</span><span class="ident" id="7697688">CheckEqual</span><span class="op" id="7697698">(</span><span class="ident" id="7697699">constantTimeCopyWrapper</span><span class="op" id="7697722">,</span>&nbsp;<span class="ident" id="7697724">makeCopy</span><span class="op" id="7697732">,</span>&nbsp;<span class="ident" id="7697734">nil</span><span class="op" id="7697737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7697740">if</span>&nbsp;<span class="ident" id="7697743">err</span>&nbsp;<span class="op" id="7697747">!=</span>&nbsp;<span class="ident" id="7697750">nil</span>&nbsp;<span class="op" id="7697754">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7697758">t</span><span class="op" id="7697759">.</span><span class="ident" id="7697760">Error</span><span class="op" id="7697765">(</span><span class="ident" id="7697766">err</span><span class="op" id="7697769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7697772">}</span><br>
<span class="lineno"></span><span class="op" id="7697774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7697777">var</span>&nbsp;<span class="ident" id="7697781">lessOrEqTests</span>&nbsp;<span class="op" id="7697795">=</span>&nbsp;<span class="op" id="7697797">[</span><span class="op" id="7697798">]</span><span class="keyword" id="7697799">struct</span>&nbsp;<span class="op" id="7697806">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7697809">x</span><span class="op" id="7697810">,</span>&nbsp;<span class="ident" id="7697812">y</span><span class="op" id="7697813">,</span>&nbsp;<span class="ident" id="7697815">result</span>&nbsp;<span class="builtintype" id="7697822">int</span><br>
<span class="lineno"></span><span class="op" id="7697826">}</span><span class="op" id="7697827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7697830">{</span><span class="num" id="7697831">0</span><span class="op" id="7697832">,</span>&nbsp;<span class="num" id="7697834">0</span><span class="op" id="7697835">,</span>&nbsp;<span class="num" id="7697837">1</span><span class="op" id="7697838">}</span><span class="op" id="7697839">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7697842">{</span><span class="num" id="7697843">1</span><span class="op" id="7697844">,</span>&nbsp;<span class="num" id="7697846">0</span><span class="op" id="7697847">,</span>&nbsp;<span class="num" id="7697849">0</span><span class="op" id="7697850">}</span><span class="op" id="7697851">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7697854">{</span><span class="num" id="7697855">0</span><span class="op" id="7697856">,</span>&nbsp;<span class="num" id="7697858">1</span><span class="op" id="7697859">,</span>&nbsp;<span class="num" id="7697861">1</span><span class="op" id="7697862">}</span><span class="op" id="7697863">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7697866">{</span><span class="num" id="7697867">10</span><span class="op" id="7697869">,</span>&nbsp;<span class="num" id="7697871">20</span><span class="op" id="7697873">,</span>&nbsp;<span class="num" id="7697875">1</span><span class="op" id="7697876">}</span><span class="op" id="7697877">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7697880">{</span><span class="num" id="7697881">20</span><span class="op" id="7697883">,</span>&nbsp;<span class="num" id="7697885">10</span><span class="op" id="7697887">,</span>&nbsp;<span class="num" id="7697889">0</span><span class="op" id="7697890">}</span><span class="op" id="7697891">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7697894">{</span><span class="num" id="7697895">10</span><span class="op" id="7697897">,</span>&nbsp;<span class="num" id="7697899">10</span><span class="op" id="7697901">,</span>&nbsp;<span class="num" id="7697903">1</span><span class="op" id="7697904">}</span><span class="op" id="7697905">,</span><br>
<span class="lineno"></span><span class="op" id="7697907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="7697910">func</span>&nbsp;<span class="ident" id="7697915">TestConstantTimeLessOrEq</span><span class="op" id="7697939">(</span><span class="ident" id="7697940">t</span>&nbsp;<span class="op" id="7697942">*</span><span class="ident" id="7697943">testing</span><span class="op" id="7697950">.</span><span class="ident" id="7697951">T</span><span class="op" id="7697952">)</span>&nbsp;<span class="op" id="7697954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7697957">for</span>&nbsp;<span class="ident" id="7697961">i</span><span class="op" id="7697962">,</span>&nbsp;<span class="ident" id="7697964">test</span>&nbsp;<span class="op" id="7697969">:=</span>&nbsp;<span class="keyword" id="7697972">range</span>&nbsp;<span class="ident" id="7697978">lessOrEqTests</span>&nbsp;<span class="op" id="7697992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7697996">result</span>&nbsp;<span class="op" id="7698003">:=</span>&nbsp;<span class="ident" id="7698006">ConstantTimeLessOrEq</span><span class="op" id="7698026">(</span><span class="ident" id="7698027">test</span><span class="op" id="7698031">.</span><span class="ident" id="7698032">x</span><span class="op" id="7698033">,</span>&nbsp;<span class="ident" id="7698035">test</span><span class="op" id="7698039">.</span><span class="ident" id="7698040">y</span><span class="op" id="7698041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7698045">if</span>&nbsp;<span class="ident" id="7698048">result</span>&nbsp;<span class="op" id="7698055">!=</span>&nbsp;<span class="ident" id="7698058">test</span><span class="op" id="7698062">.</span><span class="ident" id="7698063">result</span>&nbsp;<span class="op" id="7698070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7698075">t</span><span class="op" id="7698076">.</span><span class="ident" id="7698077">Errorf</span><span class="op" id="7698083">(</span><span class="string" id="7698084">&#34;#%d:&nbsp;%d&nbsp;&lt;=&nbsp;%d&nbsp;gave&nbsp;%d,&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="7698120">,</span>&nbsp;<span class="ident" id="7698122">i</span><span class="op" id="7698123">,</span>&nbsp;<span class="ident" id="7698125">test</span><span class="op" id="7698129">.</span><span class="ident" id="7698130">x</span><span class="op" id="7698131">,</span>&nbsp;<span class="ident" id="7698133">test</span><span class="op" id="7698137">.</span><span class="ident" id="7698138">y</span><span class="op" id="7698139">,</span>&nbsp;<span class="ident" id="7698141">result</span><span class="op" id="7698147">,</span>&nbsp;<span class="ident" id="7698149">test</span><span class="op" id="7698153">.</span><span class="ident" id="7698154">result</span><span class="op" id="7698160">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7698164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7698167">}</span><br>
<span class="lineno"></span><span class="op" id="7698169">}</span>
</div>
</body>
</html>
