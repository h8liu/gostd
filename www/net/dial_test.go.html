<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6769844">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6769899">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6769953">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6770004">package</span>&nbsp;<span class="ident" id="6770012">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6770017">import</span>&nbsp;<span class="op" id="6770024">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6770027">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6770036">&#34;flag&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6770044">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6770051">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6770057">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6770063">&#34;os/exec&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6770074">&#34;reflect&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6770085">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6770095">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6770106">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6770117">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6770125">&#34;testing&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6770136">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6770143">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6770146">func</span>&nbsp;<span class="ident" id="6770151">newLocalListener</span><span class="op" id="6770167">(</span><span class="ident" id="6770168">t</span>&nbsp;<span class="op" id="6770170">*</span><span class="ident" id="6770171"><a href="/net/dial_test.go.html#6770125">testing</a></span><span class="op" id="6770178">.</span><span class="ident" id="6770179">T</span><span class="op" id="6770180">)</span>&nbsp;<span class="ident" id="6770182"><a href="/net/net.go.html#2658762">Listener</a></span>&nbsp;<span class="op" id="6770191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6770194">ln</span><span class="op" id="6770196">,</span>&nbsp;<span class="ident" id="6770198">err</span>&nbsp;<span class="op" id="6770202">:=</span>&nbsp;<span class="ident" id="6770205"><a href="/net/dial.go.html#2525176">Listen</a></span><span class="op" id="6770211">(</span><span class="string" id="6770212">&#34;tcp&#34;</span><span class="op" id="6770217">,</span>&nbsp;<span class="string" id="6770219">&#34;127.0.0.1:0&#34;</span><span class="op" id="6770232">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6770235">if</span>&nbsp;<span class="ident" id="6770238"><a href="/net/dial_test.go.html#6770198">err</a></span>&nbsp;<span class="op" id="6770242">!=</span>&nbsp;<span class="ident" id="6770245">nil</span>&nbsp;<span class="op" id="6770249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6770253"><a href="/net/dial_test.go.html#6770194">ln</a></span><span class="op" id="6770255">,</span>&nbsp;<span class="ident" id="6770257"><a href="/net/dial_test.go.html#6770198">err</a></span>&nbsp;<span class="op" id="6770261">=</span>&nbsp;<span class="ident" id="6770263"><a href="/net/dial.go.html#2525176">Listen</a></span><span class="op" id="6770269">(</span><span class="string" id="6770270">&#34;tcp6&#34;</span><span class="op" id="6770276">,</span>&nbsp;<span class="string" id="6770278">&#34;[::1]:0&#34;</span><span class="op" id="6770287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6770290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6770293">if</span>&nbsp;<span class="ident" id="6770296"><a href="/net/dial_test.go.html#6770198">err</a></span>&nbsp;<span class="op" id="6770300">!=</span>&nbsp;<span class="ident" id="6770303">nil</span>&nbsp;<span class="op" id="6770307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6770311"><a href="/net/dial_test.go.html#6770168">t</a></span><span class="op" id="6770312">.</span><span class="ident" id="6770313">Fatal</span><span class="op" id="6770318">(</span><span class="ident" id="6770319"><a href="/net/dial_test.go.html#6770198">err</a></span><span class="op" id="6770322">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6770325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6770328">return</span>&nbsp;<span class="ident" id="6770335"><a href="/net/dial_test.go.html#6770194">ln</a></span><br>
<span class="lineno"></span><span class="op" id="6770338">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6770341">func</span>&nbsp;<span class="ident" id="6770346">TestDialTimeout</span><span class="op" id="6770361">(</span><span class="ident" id="6770362">t</span>&nbsp;<span class="op" id="6770364">*</span><span class="ident" id="6770365"><a href="/net/dial_test.go.html#6770125">testing</a></span><span class="op" id="6770372">.</span><span class="ident" id="6770373">T</span><span class="op" id="6770374">)</span>&nbsp;<span class="op" id="6770376">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6770379">origBacklog</span>&nbsp;<span class="op" id="6770391">:=</span>&nbsp;<span class="ident" id="6770394"><a href="/net/net.go.html#2658567">listenerBacklog</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6770411">defer</span>&nbsp;<span class="keyword" id="6770417">func</span><span class="op" id="6770421">(</span><span class="op" id="6770422">)</span>&nbsp;<span class="op" id="6770424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6770428"><a href="/net/net.go.html#2658567">listenerBacklog</a></span>&nbsp;<span class="op" id="6770444">=</span>&nbsp;<span class="ident" id="6770446"><a href="/net/dial_test.go.html#6770379">origBacklog</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6770459">}</span><span class="op" id="6770460">(</span><span class="op" id="6770461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6770464"><a href="/net/net.go.html#2658567">listenerBacklog</a></span>&nbsp;<span class="op" id="6770480">=</span>&nbsp;<span class="num" id="6770482">1</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6770486">ln</span>&nbsp;<span class="op" id="6770489">:=</span>&nbsp;<span class="ident" id="6770492"><a href="/net/dial_test.go.html#6770151">newLocalListener</a></span><span class="op" id="6770508">(</span><span class="ident" id="6770509"><a href="/net/dial_test.go.html#6770362">t</a></span><span class="op" id="6770510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6770513">defer</span>&nbsp;<span class="ident" id="6770519"><a href="/net/dial_test.go.html#6770486">ln</a></span><span class="op" id="6770521">.</span><span class="ident" id="6770522">Close</span><span class="op" id="6770527">(</span><span class="op" id="6770528">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6770532">errc</span>&nbsp;<span class="op" id="6770537">:=</span>&nbsp;<span class="builtinfunc" id="6770540">make</span><span class="op" id="6770544">(</span><span class="keyword" id="6770545">chan</span>&nbsp;<span class="builtintype" id="6770550">error</span><span class="op" id="6770555">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6770559">numConns</span>&nbsp;<span class="op" id="6770568">:=</span>&nbsp;<span class="ident" id="6770571"><a href="/net/net.go.html#2658567">listenerBacklog</a></span>&nbsp;<span class="op" id="6770587">+</span>&nbsp;<span class="num" id="6770589">100</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6770595">//&nbsp;TODO(bradfitz):&nbsp;It&#39;s&nbsp;hard&nbsp;to&nbsp;test&nbsp;this&nbsp;in&nbsp;a&nbsp;portable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6770652">//&nbsp;way.&nbsp;This&nbsp;is&nbsp;unfortunate,&nbsp;but&nbsp;works&nbsp;for&nbsp;now.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6770701">switch</span>&nbsp;<span class="ident" id="6770708"><a href="/net/dial_test.go.html#6770095">runtime</a></span><span class="op" id="6770715">.</span><span class="ident" id="6770716">GOOS</span>&nbsp;<span class="op" id="6770721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6770724">case</span>&nbsp;<span class="string" id="6770729">&#34;linux&#34;</span><span class="op" id="6770736">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6770740">//&nbsp;The&nbsp;kernel&nbsp;will&nbsp;start&nbsp;accepting&nbsp;TCP&nbsp;connections&nbsp;before&nbsp;userspace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6770810">//&nbsp;gets&nbsp;a&nbsp;chance&nbsp;to&nbsp;not&nbsp;accept&nbsp;them,&nbsp;so&nbsp;fire&nbsp;off&nbsp;a&nbsp;bunch&nbsp;to&nbsp;fill&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6770880">//&nbsp;the&nbsp;kernel&#39;s&nbsp;backlog.&nbsp;&nbsp;Then&nbsp;we&nbsp;test&nbsp;we&nbsp;get&nbsp;a&nbsp;failure&nbsp;after&nbsp;that.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6770950">for</span>&nbsp;<span class="ident" id="6770954">i</span>&nbsp;<span class="op" id="6770956">:=</span>&nbsp;<span class="num" id="6770959">0</span><span class="op" id="6770960">;</span>&nbsp;<span class="ident" id="6770962"><a href="/net/dial_test.go.html#6770954">i</a></span>&nbsp;<span class="op" id="6770964">&lt;</span>&nbsp;<span class="ident" id="6770966"><a href="/net/dial_test.go.html#6770559">numConns</a></span><span class="op" id="6770974">;</span>&nbsp;<span class="ident" id="6770976"><a href="/net/dial_test.go.html#6770954">i</a></span><span class="op" id="6770977">++</span>&nbsp;<span class="op" id="6770980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6770985">go</span>&nbsp;<span class="keyword" id="6770988">func</span><span class="op" id="6770992">(</span><span class="op" id="6770993">)</span>&nbsp;<span class="op" id="6770995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6771001">_</span><span class="op" id="6771002">,</span>&nbsp;<span class="ident" id="6771004">err</span>&nbsp;<span class="op" id="6771008">:=</span>&nbsp;<span class="ident" id="6771011"><a href="/net/dial.go.html#2521724">DialTimeout</a></span><span class="op" id="6771022">(</span><span class="string" id="6771023">&#34;tcp&#34;</span><span class="op" id="6771028">,</span>&nbsp;<span class="ident" id="6771030"><a href="/net/dial_test.go.html#6770486">ln</a></span><span class="op" id="6771032">.</span><span class="ident" id="6771033">Addr</span><span class="op" id="6771037">(</span><span class="op" id="6771038">)</span><span class="op" id="6771039">.</span><span class="ident" id="6771040">String</span><span class="op" id="6771046">(</span><span class="op" id="6771047">)</span><span class="op" id="6771048">,</span>&nbsp;<span class="num" id="6771050">200</span><span class="op" id="6771053">*</span><span class="ident" id="6771054"><a href="/net/dial_test.go.html#6770136">time</a></span><span class="op" id="6771058">.</span><span class="ident" id="6771059">Millisecond</span><span class="op" id="6771070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6771076"><a href="/net/dial_test.go.html#6770532">errc</a></span>&nbsp;<span class="op" id="6771081">&lt;-</span>&nbsp;<span class="ident" id="6771084"><a href="/net/dial_test.go.html#6771004">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6771091">}</span><span class="op" id="6771092">(</span><span class="op" id="6771093">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6771097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6771100">case</span>&nbsp;<span class="string" id="6771105">&#34;darwin&#34;</span><span class="op" id="6771113">,</span>&nbsp;<span class="string" id="6771115">&#34;plan9&#34;</span><span class="op" id="6771122">,</span>&nbsp;<span class="string" id="6771124">&#34;windows&#34;</span><span class="op" id="6771133">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6771137">//&nbsp;At&nbsp;least&nbsp;OS&nbsp;X&nbsp;10.7&nbsp;seems&nbsp;to&nbsp;accept&nbsp;any&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6771191">//&nbsp;connections,&nbsp;ignoring&nbsp;listen&#39;s&nbsp;backlog,&nbsp;so&nbsp;resort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6771246">//&nbsp;to&nbsp;connecting&nbsp;to&nbsp;a&nbsp;hopefully-dead&nbsp;127/8&nbsp;address.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6771300">//&nbsp;Same&nbsp;for&nbsp;windows.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6771323">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6771328">//&nbsp;Use&nbsp;an&nbsp;IANA&nbsp;reserved&nbsp;port&nbsp;(49151)&nbsp;instead&nbsp;of&nbsp;80,&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6771390">//&nbsp;on&nbsp;our&nbsp;386&nbsp;builder,&nbsp;this&nbsp;Dial&nbsp;succeeds,&nbsp;connecting</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6771446">//&nbsp;to&nbsp;an&nbsp;IIS&nbsp;web&nbsp;server&nbsp;somewhere.&nbsp;&nbsp;The&nbsp;data&nbsp;center</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6771500">//&nbsp;or&nbsp;VM&nbsp;or&nbsp;firewall&nbsp;must&nbsp;be&nbsp;stealing&nbsp;the&nbsp;TCP&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6771560">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6771565">//&nbsp;IANA&nbsp;Service&nbsp;Name&nbsp;and&nbsp;Transport&nbsp;Protocol&nbsp;Port&nbsp;Number&nbsp;Registry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6771632">//&nbsp;&lt;http://www.iana.org/assignments/service-names-port-numbers/service-names-port-numbers.xml&gt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6771729">go</span>&nbsp;<span class="keyword" id="6771732">func</span><span class="op" id="6771736">(</span><span class="op" id="6771737">)</span>&nbsp;<span class="op" id="6771739">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6771744">c</span><span class="op" id="6771745">,</span>&nbsp;<span class="ident" id="6771747">err</span>&nbsp;<span class="op" id="6771751">:=</span>&nbsp;<span class="ident" id="6771754"><a href="/net/dial.go.html#2521724">DialTimeout</a></span><span class="op" id="6771765">(</span><span class="string" id="6771766">&#34;tcp&#34;</span><span class="op" id="6771771">,</span>&nbsp;<span class="string" id="6771773">&#34;127.0.71.111:49151&#34;</span><span class="op" id="6771793">,</span>&nbsp;<span class="num" id="6771795">200</span><span class="op" id="6771798">*</span><span class="ident" id="6771799"><a href="/net/dial_test.go.html#6770136">time</a></span><span class="op" id="6771803">.</span><span class="ident" id="6771804">Millisecond</span><span class="op" id="6771815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6771820">if</span>&nbsp;<span class="ident" id="6771823"><a href="/net/dial_test.go.html#6771747">err</a></span>&nbsp;<span class="op" id="6771827">==</span>&nbsp;<span class="ident" id="6771830">nil</span>&nbsp;<span class="op" id="6771834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6771840"><a href="/net/dial_test.go.html#6771747">err</a></span>&nbsp;<span class="op" id="6771844">=</span>&nbsp;<span class="ident" id="6771846"><a href="/net/dial_test.go.html#6770044">fmt</a></span><span class="op" id="6771849">.</span><span class="ident" id="6771850">Errorf</span><span class="op" id="6771856">(</span><span class="string" id="6771857">&#34;unexpected:&nbsp;connected&nbsp;to&nbsp;%s!&#34;</span><span class="op" id="6771887">,</span>&nbsp;<span class="ident" id="6771889"><a href="/net/dial_test.go.html#6771744">c</a></span><span class="op" id="6771890">.</span><span class="ident" id="6771891">RemoteAddr</span><span class="op" id="6771901">(</span><span class="op" id="6771902">)</span><span class="op" id="6771903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6771909"><a href="/net/dial_test.go.html#6771744">c</a></span><span class="op" id="6771910">.</span><span class="ident" id="6771911">Close</span><span class="op" id="6771916">(</span><span class="op" id="6771917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6771922">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6771927"><a href="/net/dial_test.go.html#6770532">errc</a></span>&nbsp;<span class="op" id="6771932">&lt;-</span>&nbsp;<span class="ident" id="6771935"><a href="/net/dial_test.go.html#6771747">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6771941">}</span><span class="op" id="6771942">(</span><span class="op" id="6771943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6771946">default</span><span class="op" id="6771953">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6771957">//&nbsp;TODO(bradfitz):</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6771978">//&nbsp;OpenBSD&nbsp;may&nbsp;have&nbsp;a&nbsp;reject&nbsp;route&nbsp;to&nbsp;127/8&nbsp;except&nbsp;127.0.0.1/32</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6772044">//&nbsp;by&nbsp;default.&nbsp;FreeBSD&nbsp;likely&nbsp;works,&nbsp;but&nbsp;is&nbsp;untested.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6772100">//&nbsp;TODO(rsc):</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6772116">//&nbsp;The&nbsp;timeout&nbsp;never&nbsp;happens&nbsp;on&nbsp;Windows.&nbsp;&nbsp;Why?&nbsp;&nbsp;Issue&nbsp;3016.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6772178"><a href="/net/dial_test.go.html#6770362">t</a></span><span class="op" id="6772179">.</span><span class="ident" id="6772180">Skipf</span><span class="op" id="6772185">(</span><span class="string" id="6772186">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q;&nbsp;untested.&#34;</span><span class="op" id="6772218">,</span>&nbsp;<span class="ident" id="6772220"><a href="/net/dial_test.go.html#6770095">runtime</a></span><span class="op" id="6772227">.</span><span class="ident" id="6772228">GOOS</span><span class="op" id="6772232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6772235">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6772239">connected</span>&nbsp;<span class="op" id="6772249">:=</span>&nbsp;<span class="num" id="6772252">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6772255">for</span>&nbsp;<span class="op" id="6772259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6772263">select</span>&nbsp;<span class="op" id="6772270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6772274">case</span>&nbsp;<span class="op" id="6772279">&lt;-</span><span class="ident" id="6772281"><a href="/net/dial_test.go.html#6770136">time</a></span><span class="op" id="6772285">.</span><span class="ident" id="6772286">After</span><span class="op" id="6772291">(</span><span class="num" id="6772292">15</span>&nbsp;<span class="op" id="6772295">*</span>&nbsp;<span class="ident" id="6772297"><a href="/net/dial_test.go.html#6770136">time</a></span><span class="op" id="6772301">.</span><span class="ident" id="6772302">Second</span><span class="op" id="6772308">)</span><span class="op" id="6772309">:</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6772314"><a href="/net/dial_test.go.html#6770362">t</a></span><span class="op" id="6772315">.</span><span class="ident" id="6772316">Fatal</span><span class="op" id="6772321">(</span><span class="string" id="6772322">&#34;too&nbsp;slow&#34;</span><span class="op" id="6772332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6772336">case</span>&nbsp;<span class="ident" id="6772341">err</span>&nbsp;<span class="op" id="6772345">:=</span>&nbsp;<span class="op" id="6772348">&lt;-</span><span class="ident" id="6772350"><a href="/net/dial_test.go.html#6770532">errc</a></span><span class="op" id="6772354">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6772359">if</span>&nbsp;<span class="ident" id="6772362"><a href="/net/dial_test.go.html#6772341">err</a></span>&nbsp;<span class="op" id="6772366">==</span>&nbsp;<span class="ident" id="6772369">nil</span>&nbsp;<span class="op" id="6772373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6772379"><a href="/net/dial_test.go.html#6772239">connected</a></span><span class="op" id="6772388">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6772395">if</span>&nbsp;<span class="ident" id="6772398"><a href="/net/dial_test.go.html#6772239">connected</a></span>&nbsp;<span class="op" id="6772408">==</span>&nbsp;<span class="ident" id="6772411"><a href="/net/dial_test.go.html#6770559">numConns</a></span>&nbsp;<span class="op" id="6772420">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6772427"><a href="/net/dial_test.go.html#6770362">t</a></span><span class="op" id="6772428">.</span><span class="ident" id="6772429">Fatal</span><span class="op" id="6772434">(</span><span class="string" id="6772435">&#34;all&nbsp;connections&nbsp;connected;&nbsp;expected&nbsp;some&nbsp;to&nbsp;time&nbsp;out&#34;</span><span class="op" id="6772489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6772495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6772500">}</span>&nbsp;<span class="keyword" id="6772502">else</span>&nbsp;<span class="op" id="6772507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6772513">terr</span><span class="op" id="6772517">,</span>&nbsp;<span class="ident" id="6772519">ok</span>&nbsp;<span class="op" id="6772522">:=</span>&nbsp;<span class="ident" id="6772525"><a href="/net/dial_test.go.html#6772341">err</a></span><span class="op" id="6772528">.</span><span class="op" id="6772529">(</span><span class="ident" id="6772530"><a href="/net/net.go.html#2660366">timeout</a></span><span class="op" id="6772537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6772543">if</span>&nbsp;<span class="op" id="6772546">!</span><span class="ident" id="6772547"><a href="/net/dial_test.go.html#6772519">ok</a></span>&nbsp;<span class="op" id="6772550">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6772557"><a href="/net/dial_test.go.html#6770362">t</a></span><span class="op" id="6772558">.</span><span class="ident" id="6772559">Fatalf</span><span class="op" id="6772565">(</span><span class="string" id="6772566">&#34;got&nbsp;error&nbsp;%q;&nbsp;want&nbsp;error&nbsp;with&nbsp;timeout&nbsp;interface&#34;</span><span class="op" id="6772615">,</span>&nbsp;<span class="ident" id="6772617"><a href="/net/dial_test.go.html#6772341">err</a></span><span class="op" id="6772620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6772626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6772632">if</span>&nbsp;<span class="op" id="6772635">!</span><span class="ident" id="6772636"><a href="/net/dial_test.go.html#6772513">terr</a></span><span class="op" id="6772640">.</span><span class="ident" id="6772641">Timeout</span><span class="op" id="6772648">(</span><span class="op" id="6772649">)</span>&nbsp;<span class="op" id="6772651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6772658"><a href="/net/dial_test.go.html#6770362">t</a></span><span class="op" id="6772659">.</span><span class="ident" id="6772660">Fatalf</span><span class="op" id="6772666">(</span><span class="string" id="6772667">&#34;got&nbsp;error&nbsp;%q;&nbsp;not&nbsp;a&nbsp;timeout&#34;</span><span class="op" id="6772696">,</span>&nbsp;<span class="ident" id="6772698"><a href="/net/dial_test.go.html#6772341">err</a></span><span class="op" id="6772701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6772707">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6772713">//&nbsp;Pass.&nbsp;We&nbsp;saw&nbsp;a&nbsp;timeout&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6772750">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6772760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6772764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6772767">}</span><br>
<span class="lineno">115</span><span class="op" id="6772769">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6772772">func</span>&nbsp;<span class="ident" id="6772777">TestSelfConnect</span><span class="op" id="6772792">(</span><span class="ident" id="6772793">t</span>&nbsp;<span class="op" id="6772795">*</span><span class="ident" id="6772796"><a href="/net/dial_test.go.html#6770125">testing</a></span><span class="op" id="6772803">.</span><span class="ident" id="6772804">T</span><span class="op" id="6772805">)</span>&nbsp;<span class="op" id="6772807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6772810">if</span>&nbsp;<span class="ident" id="6772813"><a href="/net/dial_test.go.html#6770095">runtime</a></span><span class="op" id="6772820">.</span><span class="ident" id="6772821">GOOS</span>&nbsp;<span class="op" id="6772826">==</span>&nbsp;<span class="string" id="6772829">&#34;windows&#34;</span>&nbsp;<span class="op" id="6772839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6772843">//&nbsp;TODO(brainman):&nbsp;do&nbsp;not&nbsp;know&nbsp;why&nbsp;it&nbsp;hangs.</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6772890"><a href="/net/dial_test.go.html#6772793">t</a></span><span class="op" id="6772891">.</span><span class="ident" id="6772892">Skip</span><span class="op" id="6772896">(</span><span class="string" id="6772897">&#34;skipping&nbsp;known-broken&nbsp;test&nbsp;on&nbsp;windows&#34;</span><span class="op" id="6772936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6772939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6772943">//&nbsp;Test&nbsp;that&nbsp;Dial&nbsp;does&nbsp;not&nbsp;honor&nbsp;self-connects.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6772992">//&nbsp;See&nbsp;the&nbsp;comment&nbsp;in&nbsp;DialTCP.</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6773025">//&nbsp;Find&nbsp;a&nbsp;port&nbsp;that&nbsp;would&nbsp;be&nbsp;used&nbsp;as&nbsp;a&nbsp;local&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6773080">l</span><span class="op" id="6773081">,</span>&nbsp;<span class="ident" id="6773083">err</span>&nbsp;<span class="op" id="6773087">:=</span>&nbsp;<span class="ident" id="6773090"><a href="/net/dial.go.html#2525176">Listen</a></span><span class="op" id="6773096">(</span><span class="string" id="6773097">&#34;tcp&#34;</span><span class="op" id="6773102">,</span>&nbsp;<span class="string" id="6773104">&#34;127.0.0.1:0&#34;</span><span class="op" id="6773117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6773120">if</span>&nbsp;<span class="ident" id="6773123"><a href="/net/dial_test.go.html#6773083">err</a></span>&nbsp;<span class="op" id="6773127">!=</span>&nbsp;<span class="ident" id="6773130">nil</span>&nbsp;<span class="op" id="6773134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6773138"><a href="/net/dial_test.go.html#6772793">t</a></span><span class="op" id="6773139">.</span><span class="ident" id="6773140">Fatal</span><span class="op" id="6773145">(</span><span class="ident" id="6773146"><a href="/net/dial_test.go.html#6773083">err</a></span><span class="op" id="6773149">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6773152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6773155">c</span><span class="op" id="6773156">,</span>&nbsp;<span class="ident" id="6773158"><a href="/net/dial_test.go.html#6773083">err</a></span>&nbsp;<span class="op" id="6773162">:=</span>&nbsp;<span class="ident" id="6773165"><a href="/net/dial.go.html#2521518">Dial</a></span><span class="op" id="6773169">(</span><span class="string" id="6773170">&#34;tcp&#34;</span><span class="op" id="6773175">,</span>&nbsp;<span class="ident" id="6773177"><a href="/net/dial_test.go.html#6773080">l</a></span><span class="op" id="6773178">.</span><span class="ident" id="6773179">Addr</span><span class="op" id="6773183">(</span><span class="op" id="6773184">)</span><span class="op" id="6773185">.</span><span class="ident" id="6773186">String</span><span class="op" id="6773192">(</span><span class="op" id="6773193">)</span><span class="op" id="6773194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6773197">if</span>&nbsp;<span class="ident" id="6773200"><a href="/net/dial_test.go.html#6773083">err</a></span>&nbsp;<span class="op" id="6773204">!=</span>&nbsp;<span class="ident" id="6773207">nil</span>&nbsp;<span class="op" id="6773211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6773215"><a href="/net/dial_test.go.html#6772793">t</a></span><span class="op" id="6773216">.</span><span class="ident" id="6773217">Fatal</span><span class="op" id="6773222">(</span><span class="ident" id="6773223"><a href="/net/dial_test.go.html#6773083">err</a></span><span class="op" id="6773226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6773229">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6773232">addr</span>&nbsp;<span class="op" id="6773237">:=</span>&nbsp;<span class="ident" id="6773240"><a href="/net/dial_test.go.html#6773155">c</a></span><span class="op" id="6773241">.</span><span class="ident" id="6773242">LocalAddr</span><span class="op" id="6773251">(</span><span class="op" id="6773252">)</span><span class="op" id="6773253">.</span><span class="ident" id="6773254">String</span><span class="op" id="6773260">(</span><span class="op" id="6773261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6773264"><a href="/net/dial_test.go.html#6773155">c</a></span><span class="op" id="6773265">.</span><span class="ident" id="6773266">Close</span><span class="op" id="6773271">(</span><span class="op" id="6773272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6773275"><a href="/net/dial_test.go.html#6773080">l</a></span><span class="op" id="6773276">.</span><span class="ident" id="6773277">Close</span><span class="op" id="6773282">(</span><span class="op" id="6773283">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6773287">//&nbsp;Try&nbsp;to&nbsp;connect&nbsp;to&nbsp;that&nbsp;address&nbsp;repeatedly.</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6773334">n</span>&nbsp;<span class="op" id="6773336">:=</span>&nbsp;<span class="num" id="6773339">100000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6773347">if</span>&nbsp;<span class="ident" id="6773350"><a href="/net/dial_test.go.html#6770125">testing</a></span><span class="op" id="6773357">.</span><span class="ident" id="6773358">Short</span><span class="op" id="6773363">(</span><span class="op" id="6773364">)</span>&nbsp;<span class="op" id="6773366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6773370"><a href="/net/dial_test.go.html#6773334">n</a></span>&nbsp;<span class="op" id="6773372">=</span>&nbsp;<span class="num" id="6773374">1000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6773380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6773383">switch</span>&nbsp;<span class="ident" id="6773390"><a href="/net/dial_test.go.html#6770095">runtime</a></span><span class="op" id="6773397">.</span><span class="ident" id="6773398">GOOS</span>&nbsp;<span class="op" id="6773403">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6773406">case</span>&nbsp;<span class="string" id="6773411">&#34;darwin&#34;</span><span class="op" id="6773419">,</span>&nbsp;<span class="string" id="6773421">&#34;dragonfly&#34;</span><span class="op" id="6773432">,</span>&nbsp;<span class="string" id="6773434">&#34;freebsd&#34;</span><span class="op" id="6773443">,</span>&nbsp;<span class="string" id="6773445">&#34;netbsd&#34;</span><span class="op" id="6773453">,</span>&nbsp;<span class="string" id="6773455">&#34;openbsd&#34;</span><span class="op" id="6773464">,</span>&nbsp;<span class="string" id="6773466">&#34;plan9&#34;</span><span class="op" id="6773473">,</span>&nbsp;<span class="string" id="6773475">&#34;solaris&#34;</span><span class="op" id="6773484">,</span>&nbsp;<span class="string" id="6773486">&#34;windows&#34;</span><span class="op" id="6773495">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6773499">//&nbsp;Non-Linux&nbsp;systems&nbsp;take&nbsp;a&nbsp;long&nbsp;time&nbsp;to&nbsp;figure</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6773549">//&nbsp;out&nbsp;that&nbsp;there&nbsp;is&nbsp;nothing&nbsp;listening&nbsp;on&nbsp;localhost.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6773604"><a href="/net/dial_test.go.html#6773334">n</a></span>&nbsp;<span class="op" id="6773606">=</span>&nbsp;<span class="num" id="6773608">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6773613">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6773616">for</span>&nbsp;<span class="ident" id="6773620">i</span>&nbsp;<span class="op" id="6773622">:=</span>&nbsp;<span class="num" id="6773625">0</span><span class="op" id="6773626">;</span>&nbsp;<span class="ident" id="6773628"><a href="/net/dial_test.go.html#6773620">i</a></span>&nbsp;<span class="op" id="6773630">&lt;</span>&nbsp;<span class="ident" id="6773632"><a href="/net/dial_test.go.html#6773334">n</a></span><span class="op" id="6773633">;</span>&nbsp;<span class="ident" id="6773635"><a href="/net/dial_test.go.html#6773620">i</a></span><span class="op" id="6773636">++</span>&nbsp;<span class="op" id="6773639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6773643">c</span><span class="op" id="6773644">,</span>&nbsp;<span class="ident" id="6773646">err</span>&nbsp;<span class="op" id="6773650">:=</span>&nbsp;<span class="ident" id="6773653"><a href="/net/dial.go.html#2521724">DialTimeout</a></span><span class="op" id="6773664">(</span><span class="string" id="6773665">&#34;tcp&#34;</span><span class="op" id="6773670">,</span>&nbsp;<span class="ident" id="6773672"><a href="/net/dial_test.go.html#6773232">addr</a></span><span class="op" id="6773676">,</span>&nbsp;<span class="ident" id="6773678"><a href="/net/dial_test.go.html#6770136">time</a></span><span class="op" id="6773682">.</span><span class="ident" id="6773683">Millisecond</span><span class="op" id="6773694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6773698">if</span>&nbsp;<span class="ident" id="6773701"><a href="/net/dial_test.go.html#6773646">err</a></span>&nbsp;<span class="op" id="6773705">==</span>&nbsp;<span class="ident" id="6773708">nil</span>&nbsp;<span class="op" id="6773712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6773717">if</span>&nbsp;<span class="ident" id="6773720"><a href="/net/dial_test.go.html#6773643">c</a></span><span class="op" id="6773721">.</span><span class="ident" id="6773722">LocalAddr</span><span class="op" id="6773731">(</span><span class="op" id="6773732">)</span><span class="op" id="6773733">.</span><span class="ident" id="6773734">String</span><span class="op" id="6773740">(</span><span class="op" id="6773741">)</span>&nbsp;<span class="op" id="6773743">==</span>&nbsp;<span class="ident" id="6773746"><a href="/net/dial_test.go.html#6773232">addr</a></span>&nbsp;<span class="op" id="6773751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6773757"><a href="/net/dial_test.go.html#6772793">t</a></span><span class="op" id="6773758">.</span><span class="ident" id="6773759">Errorf</span><span class="op" id="6773765">(</span><span class="string" id="6773766">&#34;#%d:&nbsp;Dial&nbsp;%q&nbsp;self-connect&#34;</span><span class="op" id="6773793">,</span>&nbsp;<span class="ident" id="6773795"><a href="/net/dial_test.go.html#6773620">i</a></span><span class="op" id="6773796">,</span>&nbsp;<span class="ident" id="6773798"><a href="/net/dial_test.go.html#6773232">addr</a></span><span class="op" id="6773802">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6773807">}</span>&nbsp;<span class="keyword" id="6773809">else</span>&nbsp;<span class="op" id="6773814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6773820"><a href="/net/dial_test.go.html#6772793">t</a></span><span class="op" id="6773821">.</span><span class="ident" id="6773822">Logf</span><span class="op" id="6773826">(</span><span class="string" id="6773827">&#34;#%d:&nbsp;Dial&nbsp;%q&nbsp;succeeded&nbsp;-&nbsp;possibly&nbsp;racing&nbsp;with&nbsp;other&nbsp;listener&#34;</span><span class="op" id="6773889">,</span>&nbsp;<span class="ident" id="6773891"><a href="/net/dial_test.go.html#6773620">i</a></span><span class="op" id="6773892">,</span>&nbsp;<span class="ident" id="6773894"><a href="/net/dial_test.go.html#6773232">addr</a></span><span class="op" id="6773898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6773903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6773908"><a href="/net/dial_test.go.html#6773643">c</a></span><span class="op" id="6773909">.</span><span class="ident" id="6773910">Close</span><span class="op" id="6773915">(</span><span class="op" id="6773916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6773920">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6773923">}</span><br>
<span class="lineno"></span><span class="op" id="6773925">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6773928">var</span>&nbsp;<span class="ident" id="6773932">runErrorTest</span>&nbsp;<span class="op" id="6773945">=</span>&nbsp;<span class="ident" id="6773947"><a href="/net/dial_test.go.html#6770036">flag</a></span><span class="op" id="6773951">.</span><span class="ident" id="6773952">Bool</span><span class="op" id="6773956">(</span><span class="string" id="6773957">&#34;run_error_test&#34;</span><span class="op" id="6773973">,</span>&nbsp;<span class="ident" id="6773975">false</span><span class="op" id="6773980">,</span>&nbsp;<span class="string" id="6773982">&#34;let&nbsp;TestDialError&nbsp;check&nbsp;for&nbsp;dns&nbsp;errors&#34;</span><span class="op" id="6774022">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="keyword" id="6774025">type</span>&nbsp;<span class="ident" id="6774030">DialErrorTest</span>&nbsp;<span class="keyword" id="6774044">struct</span>&nbsp;<span class="op" id="6774051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6774054">Net</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6774062">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6774070">Raddr</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6774078">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6774086">Pattern</span>&nbsp;<span class="builtintype" id="6774094">string</span><br>
<span class="lineno"></span><span class="op" id="6774101">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="6774104">var</span>&nbsp;<span class="ident" id="6774108">dialErrorTests</span>&nbsp;<span class="op" id="6774123">=</span>&nbsp;<span class="op" id="6774125">[</span><span class="op" id="6774126">]</span><span class="ident" id="6774127"><a href="/net/dial_test.go.html#6774030">DialErrorTest</a></span><span class="op" id="6774140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6774143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6774147">&#34;datakit&#34;</span><span class="op" id="6774156">,</span>&nbsp;<span class="string" id="6774158">&#34;mh/astro/r70&#34;</span><span class="op" id="6774172">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6774176">&#34;dial&nbsp;datakit&nbsp;mh/astro/r70:&nbsp;unknown&nbsp;network&nbsp;datakit&#34;</span><span class="op" id="6774228">,</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6774231">}</span><span class="op" id="6774232">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6774235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6774239">&#34;tcp&#34;</span><span class="op" id="6774244">,</span>&nbsp;<span class="string" id="6774246">&#34;127.0.0.1:☺&#34;</span><span class="op" id="6774261">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6774265">&#34;dial&nbsp;tcp&nbsp;127.0.0.1:☺:&nbsp;unknown&nbsp;port&nbsp;tcp/☺&#34;</span><span class="op" id="6774311">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6774314">}</span><span class="op" id="6774315">,</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6774318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6774322">&#34;tcp&#34;</span><span class="op" id="6774327">,</span>&nbsp;<span class="string" id="6774329">&#34;no-such-name.google.com.:80&#34;</span><span class="op" id="6774358">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6774362">&#34;dial&nbsp;tcp&nbsp;no-such-name.google.com.:80:&nbsp;lookup&nbsp;no-such-name.google.com.(&nbsp;on&nbsp;.*)?:&nbsp;no&nbsp;(.*)&#34;</span><span class="op" id="6774451">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6774454">}</span><span class="op" id="6774455">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6774458">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6774462">&#34;tcp&#34;</span><span class="op" id="6774467">,</span>&nbsp;<span class="string" id="6774469">&#34;no-such-name.no-such-top-level-domain.:80&#34;</span><span class="op" id="6774512">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6774516">&#34;dial&nbsp;tcp&nbsp;no-such-name.no-such-top-level-domain.:80:&nbsp;lookup&nbsp;no-such-name.no-such-top-level-domain.(&nbsp;on&nbsp;.*)?:&nbsp;no&nbsp;(.*)&#34;</span><span class="op" id="6774633">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6774636">}</span><span class="op" id="6774637">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6774640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6774644">&#34;tcp&#34;</span><span class="op" id="6774649">,</span>&nbsp;<span class="string" id="6774651">&#34;no-such-name:80&#34;</span><span class="op" id="6774668">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6774672">`dial&nbsp;tcp&nbsp;no-such-name:80:&nbsp;lookup&nbsp;no-such-name\.(.*\.)?(&nbsp;on&nbsp;.*)?:&nbsp;no&nbsp;(.*)`</span><span class="op" id="6774746">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6774749">}</span><span class="op" id="6774750">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6774753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6774757">&#34;tcp&#34;</span><span class="op" id="6774762">,</span>&nbsp;<span class="string" id="6774764">&#34;mh/astro/r70:http&#34;</span><span class="op" id="6774783">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6774787">&#34;dial&nbsp;tcp&nbsp;mh/astro/r70:http:&nbsp;lookup&nbsp;mh/astro/r70:&nbsp;invalid&nbsp;domain&nbsp;name&#34;</span><span class="op" id="6774857">,</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6774860">}</span><span class="op" id="6774861">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6774864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6774868">&#34;unix&#34;</span><span class="op" id="6774874">,</span>&nbsp;<span class="string" id="6774876">&#34;/etc/file-not-found&#34;</span><span class="op" id="6774897">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6774901">&#34;dial&nbsp;unix&nbsp;/etc/file-not-found:&nbsp;no&nbsp;such&nbsp;file&nbsp;or&nbsp;directory&#34;</span><span class="op" id="6774959">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6774962">}</span><span class="op" id="6774963">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6774966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6774970">&#34;unix&#34;</span><span class="op" id="6774976">,</span>&nbsp;<span class="string" id="6774978">&#34;/etc/&#34;</span><span class="op" id="6774985">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6774989">&#34;dial&nbsp;unix&nbsp;/etc/:&nbsp;(permission&nbsp;denied|socket&nbsp;operation&nbsp;on&nbsp;non-socket|connection&nbsp;refused)&#34;</span><span class="op" id="6775077">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6775080">}</span><span class="op" id="6775081">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6775084">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6775088">&#34;unixpacket&#34;</span><span class="op" id="6775100">,</span>&nbsp;<span class="string" id="6775102">&#34;/etc/file-not-found&#34;</span><span class="op" id="6775123">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6775127">&#34;dial&nbsp;unixpacket&nbsp;/etc/file-not-found:&nbsp;no&nbsp;such&nbsp;file&nbsp;or&nbsp;directory&#34;</span><span class="op" id="6775191">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6775194">}</span><span class="op" id="6775195">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6775198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6775202">&#34;unixpacket&#34;</span><span class="op" id="6775214">,</span>&nbsp;<span class="string" id="6775216">&#34;/etc/&#34;</span><span class="op" id="6775223">,</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6775227">&#34;dial&nbsp;unixpacket&nbsp;/etc/:&nbsp;(permission&nbsp;denied|socket&nbsp;operation&nbsp;on&nbsp;non-socket|connection&nbsp;refused)&#34;</span><span class="op" id="6775321">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6775324">}</span><span class="op" id="6775325">,</span><br>
<span class="lineno"></span><span class="op" id="6775327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6775330">var</span>&nbsp;<span class="ident" id="6775334">duplicateErrorPattern</span>&nbsp;<span class="op" id="6775356">=</span>&nbsp;<span class="string" id="6775358">`dial&nbsp;(.*)&nbsp;dial&nbsp;(.*)`</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="keyword" id="6775381">func</span>&nbsp;<span class="ident" id="6775386">TestDialError</span><span class="op" id="6775399">(</span><span class="ident" id="6775400">t</span>&nbsp;<span class="op" id="6775402">*</span><span class="ident" id="6775403"><a href="/net/dial_test.go.html#6770125">testing</a></span><span class="op" id="6775410">.</span><span class="ident" id="6775411">T</span><span class="op" id="6775412">)</span>&nbsp;<span class="op" id="6775414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6775417">if</span>&nbsp;<span class="op" id="6775420">!</span><span class="op" id="6775421">*</span><span class="ident" id="6775422"><a href="/net/dial_test.go.html#6773932">runErrorTest</a></span>&nbsp;<span class="op" id="6775435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6775439"><a href="/net/dial_test.go.html#6775400">t</a></span><span class="op" id="6775440">.</span><span class="ident" id="6775441">Logf</span><span class="op" id="6775445">(</span><span class="string" id="6775446">&#34;test&nbsp;disabled;&nbsp;use&nbsp;-run_error_test&nbsp;to&nbsp;enable&#34;</span><span class="op" id="6775492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6775496">return</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6775504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6775507">for</span>&nbsp;<span class="ident" id="6775511">i</span><span class="op" id="6775512">,</span>&nbsp;<span class="ident" id="6775514">tt</span>&nbsp;<span class="op" id="6775517">:=</span>&nbsp;<span class="keyword" id="6775520">range</span>&nbsp;<span class="ident" id="6775526"><a href="/net/dial_test.go.html#6774108">dialErrorTests</a></span>&nbsp;<span class="op" id="6775541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6775545">c</span><span class="op" id="6775546">,</span>&nbsp;<span class="ident" id="6775548">err</span>&nbsp;<span class="op" id="6775552">:=</span>&nbsp;<span class="ident" id="6775555"><a href="/net/dial.go.html#2521518">Dial</a></span><span class="op" id="6775559">(</span><span class="ident" id="6775560"><a href="/net/dial_test.go.html#6775514">tt</a></span><span class="op" id="6775562">.</span><span class="ident" id="6775563">Net</span><span class="op" id="6775566">,</span>&nbsp;<span class="ident" id="6775568"><a href="/net/dial_test.go.html#6775514">tt</a></span><span class="op" id="6775570">.</span><span class="ident" id="6775571">Raddr</span><span class="op" id="6775576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6775580">if</span>&nbsp;<span class="ident" id="6775583"><a href="/net/dial_test.go.html#6775545">c</a></span>&nbsp;<span class="op" id="6775585">!=</span>&nbsp;<span class="ident" id="6775588">nil</span>&nbsp;<span class="op" id="6775592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6775597"><a href="/net/dial_test.go.html#6775545">c</a></span><span class="op" id="6775598">.</span><span class="ident" id="6775599">Close</span><span class="op" id="6775604">(</span><span class="op" id="6775605">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6775609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6775613">if</span>&nbsp;<span class="ident" id="6775616"><a href="/net/dial_test.go.html#6775548">err</a></span>&nbsp;<span class="op" id="6775620">==</span>&nbsp;<span class="ident" id="6775623">nil</span>&nbsp;<span class="op" id="6775627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6775632"><a href="/net/dial_test.go.html#6775400">t</a></span><span class="op" id="6775633">.</span><span class="ident" id="6775634">Errorf</span><span class="op" id="6775640">(</span><span class="string" id="6775641">&#34;#%d:&nbsp;nil&nbsp;error,&nbsp;want&nbsp;match&nbsp;for&nbsp;%#q&#34;</span><span class="op" id="6775677">,</span>&nbsp;<span class="ident" id="6775679"><a href="/net/dial_test.go.html#6775511">i</a></span><span class="op" id="6775680">,</span>&nbsp;<span class="ident" id="6775682"><a href="/net/dial_test.go.html#6775514">tt</a></span><span class="op" id="6775684">.</span><span class="ident" id="6775685">Pattern</span><span class="op" id="6775692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6775697">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6775708">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6775712">s</span>&nbsp;<span class="op" id="6775714">:=</span>&nbsp;<span class="ident" id="6775717"><a href="/net/dial_test.go.html#6775548">err</a></span><span class="op" id="6775720">.</span><span class="ident" id="6775721">Error</span><span class="op" id="6775726">(</span><span class="op" id="6775727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6775731">match</span><span class="op" id="6775736">,</span>&nbsp;<span class="ident" id="6775738">_</span>&nbsp;<span class="op" id="6775740">:=</span>&nbsp;<span class="ident" id="6775743"><a href="/net/dial_test.go.html#6770085">regexp</a></span><span class="op" id="6775749">.</span><span class="ident" id="6775750">MatchString</span><span class="op" id="6775761">(</span><span class="ident" id="6775762"><a href="/net/dial_test.go.html#6775514">tt</a></span><span class="op" id="6775764">.</span><span class="ident" id="6775765">Pattern</span><span class="op" id="6775772">,</span>&nbsp;<span class="ident" id="6775774"><a href="/net/dial_test.go.html#6775712">s</a></span><span class="op" id="6775775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6775779">if</span>&nbsp;<span class="op" id="6775782">!</span><span class="ident" id="6775783"><a href="/net/dial_test.go.html#6775731">match</a></span>&nbsp;<span class="op" id="6775789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6775794"><a href="/net/dial_test.go.html#6775400">t</a></span><span class="op" id="6775795">.</span><span class="ident" id="6775796">Errorf</span><span class="op" id="6775802">(</span><span class="string" id="6775803">&#34;#%d:&nbsp;%q,&nbsp;want&nbsp;match&nbsp;for&nbsp;%#q&#34;</span><span class="op" id="6775832">,</span>&nbsp;<span class="ident" id="6775834"><a href="/net/dial_test.go.html#6775511">i</a></span><span class="op" id="6775835">,</span>&nbsp;<span class="ident" id="6775837"><a href="/net/dial_test.go.html#6775712">s</a></span><span class="op" id="6775838">,</span>&nbsp;<span class="ident" id="6775840"><a href="/net/dial_test.go.html#6775514">tt</a></span><span class="op" id="6775842">.</span><span class="ident" id="6775843">Pattern</span><span class="op" id="6775850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6775854">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6775858"><a href="/net/dial_test.go.html#6775731">match</a></span><span class="op" id="6775863">,</span>&nbsp;<span class="ident" id="6775865">_</span>&nbsp;<span class="op" id="6775867">=</span>&nbsp;<span class="ident" id="6775869"><a href="/net/dial_test.go.html#6770085">regexp</a></span><span class="op" id="6775875">.</span><span class="ident" id="6775876">MatchString</span><span class="op" id="6775887">(</span><span class="ident" id="6775888"><a href="/net/dial_test.go.html#6775334">duplicateErrorPattern</a></span><span class="op" id="6775909">,</span>&nbsp;<span class="ident" id="6775911"><a href="/net/dial_test.go.html#6775712">s</a></span><span class="op" id="6775912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6775916">if</span>&nbsp;<span class="ident" id="6775919"><a href="/net/dial_test.go.html#6775731">match</a></span>&nbsp;<span class="op" id="6775925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6775930"><a href="/net/dial_test.go.html#6775400">t</a></span><span class="op" id="6775931">.</span><span class="ident" id="6775932">Errorf</span><span class="op" id="6775938">(</span><span class="string" id="6775939">&#34;#%d:&nbsp;%q,&nbsp;duplicate&nbsp;error&nbsp;return&nbsp;from&nbsp;Dial&#34;</span><span class="op" id="6775982">,</span>&nbsp;<span class="ident" id="6775984"><a href="/net/dial_test.go.html#6775511">i</a></span><span class="op" id="6775985">,</span>&nbsp;<span class="ident" id="6775987"><a href="/net/dial_test.go.html#6775712">s</a></span><span class="op" id="6775988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6775992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6775995">}</span><br>
<span class="lineno">240</span><span class="op" id="6775997">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6776000">var</span>&nbsp;<span class="ident" id="6776004">invalidDialAndListenArgTests</span>&nbsp;<span class="op" id="6776033">=</span>&nbsp;<span class="op" id="6776035">[</span><span class="op" id="6776036">]</span><span class="keyword" id="6776037">struct</span>&nbsp;<span class="op" id="6776044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6776047">net</span>&nbsp;&nbsp;<span class="builtintype" id="6776052">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6776060">addr</span>&nbsp;<span class="builtintype" id="6776065">string</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6776073">err</span>&nbsp;&nbsp;<span class="builtintype" id="6776078">error</span><br>
<span class="lineno"></span><span class="op" id="6776084">}</span><span class="op" id="6776085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6776088">{</span><span class="string" id="6776089">&#34;foo&#34;</span><span class="op" id="6776094">,</span>&nbsp;<span class="string" id="6776096">&#34;bar&#34;</span><span class="op" id="6776101">,</span>&nbsp;<span class="op" id="6776103">&amp;</span><span class="ident" id="6776104"><a href="/net/net.go.html#2659621">OpError</a></span><span class="op" id="6776111">{</span><span class="ident" id="6776112">Op</span><span class="op" id="6776114">:</span>&nbsp;<span class="string" id="6776116">&#34;dial&#34;</span><span class="op" id="6776122">,</span>&nbsp;<span class="ident" id="6776124">Net</span><span class="op" id="6776127">:</span>&nbsp;<span class="string" id="6776129">&#34;foo&#34;</span><span class="op" id="6776134">,</span>&nbsp;<span class="ident" id="6776136">Addr</span><span class="op" id="6776140">:</span>&nbsp;<span class="ident" id="6776142">nil</span><span class="op" id="6776145">,</span>&nbsp;<span class="ident" id="6776147">Err</span><span class="op" id="6776150">:</span>&nbsp;<span class="ident" id="6776152"><a href="/net/net.go.html#2661008">UnknownNetworkError</a></span><span class="op" id="6776171">(</span><span class="string" id="6776172">&#34;foo&#34;</span><span class="op" id="6776177">)</span><span class="op" id="6776178">}</span><span class="op" id="6776179">}</span><span class="op" id="6776180">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6776183">{</span><span class="string" id="6776184">&#34;baz&#34;</span><span class="op" id="6776189">,</span>&nbsp;<span class="string" id="6776191">&#34;&#34;</span><span class="op" id="6776193">,</span>&nbsp;<span class="op" id="6776195">&amp;</span><span class="ident" id="6776196"><a href="/net/net.go.html#2659621">OpError</a></span><span class="op" id="6776203">{</span><span class="ident" id="6776204">Op</span><span class="op" id="6776206">:</span>&nbsp;<span class="string" id="6776208">&#34;listen&#34;</span><span class="op" id="6776216">,</span>&nbsp;<span class="ident" id="6776218">Net</span><span class="op" id="6776221">:</span>&nbsp;<span class="string" id="6776223">&#34;baz&#34;</span><span class="op" id="6776228">,</span>&nbsp;<span class="ident" id="6776230">Addr</span><span class="op" id="6776234">:</span>&nbsp;<span class="ident" id="6776236">nil</span><span class="op" id="6776239">,</span>&nbsp;<span class="ident" id="6776241">Err</span><span class="op" id="6776244">:</span>&nbsp;<span class="ident" id="6776246"><a href="/net/net.go.html#2661008">UnknownNetworkError</a></span><span class="op" id="6776265">(</span><span class="string" id="6776266">&#34;baz&#34;</span><span class="op" id="6776271">)</span><span class="op" id="6776272">}</span><span class="op" id="6776273">}</span><span class="op" id="6776274">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6776277">{</span><span class="string" id="6776278">&#34;tcp&#34;</span><span class="op" id="6776283">,</span>&nbsp;<span class="string" id="6776285">&#34;&#34;</span><span class="op" id="6776287">,</span>&nbsp;<span class="op" id="6776289">&amp;</span><span class="ident" id="6776290"><a href="/net/net.go.html#2659621">OpError</a></span><span class="op" id="6776297">{</span><span class="ident" id="6776298">Op</span><span class="op" id="6776300">:</span>&nbsp;<span class="string" id="6776302">&#34;dial&#34;</span><span class="op" id="6776308">,</span>&nbsp;<span class="ident" id="6776310">Net</span><span class="op" id="6776313">:</span>&nbsp;<span class="string" id="6776315">&#34;tcp&#34;</span><span class="op" id="6776320">,</span>&nbsp;<span class="ident" id="6776322">Addr</span><span class="op" id="6776326">:</span>&nbsp;<span class="ident" id="6776328">nil</span><span class="op" id="6776331">,</span>&nbsp;<span class="ident" id="6776333">Err</span><span class="op" id="6776336">:</span>&nbsp;<span class="ident" id="6776338"><a href="/net/net.go.html#2659161">errMissingAddress</a></span><span class="op" id="6776355">}</span><span class="op" id="6776356">}</span><span class="op" id="6776357">,</span><br>
<span class="lineno">250</span><span class="op" id="6776359">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6776362">func</span>&nbsp;<span class="ident" id="6776367">TestInvalidDialAndListenArgs</span><span class="op" id="6776395">(</span><span class="ident" id="6776396">t</span>&nbsp;<span class="op" id="6776398">*</span><span class="ident" id="6776399"><a href="/net/dial_test.go.html#6770125">testing</a></span><span class="op" id="6776406">.</span><span class="ident" id="6776407">T</span><span class="op" id="6776408">)</span>&nbsp;<span class="op" id="6776410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6776413">for</span>&nbsp;<span class="ident" id="6776417">_</span><span class="op" id="6776418">,</span>&nbsp;<span class="ident" id="6776420">tt</span>&nbsp;<span class="op" id="6776423">:=</span>&nbsp;<span class="keyword" id="6776426">range</span>&nbsp;<span class="ident" id="6776432"><a href="/net/dial_test.go.html#6776004">invalidDialAndListenArgTests</a></span>&nbsp;<span class="op" id="6776461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6776465">var</span>&nbsp;<span class="ident" id="6776469">err</span>&nbsp;<span class="builtintype" id="6776473">error</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6776481">switch</span>&nbsp;<span class="ident" id="6776488"><a href="/net/dial_test.go.html#6776420">tt</a></span><span class="op" id="6776490">.</span><span class="ident" id="6776491">err</span><span class="op" id="6776494">.</span><span class="op" id="6776495">(</span><span class="op" id="6776496">*</span><span class="ident" id="6776497"><a href="/net/net.go.html#2659621">OpError</a></span><span class="op" id="6776504">)</span><span class="op" id="6776505">.</span><span class="ident" id="6776506">Op</span>&nbsp;<span class="op" id="6776509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6776513">case</span>&nbsp;<span class="string" id="6776518">&#34;dial&#34;</span><span class="op" id="6776524">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6776529">_</span><span class="op" id="6776530">,</span>&nbsp;<span class="ident" id="6776532"><a href="/net/dial_test.go.html#6776469">err</a></span>&nbsp;<span class="op" id="6776536">=</span>&nbsp;<span class="ident" id="6776538"><a href="/net/dial.go.html#2521518">Dial</a></span><span class="op" id="6776542">(</span><span class="ident" id="6776543"><a href="/net/dial_test.go.html#6776420">tt</a></span><span class="op" id="6776545">.</span><span class="ident" id="6776546">net</span><span class="op" id="6776549">,</span>&nbsp;<span class="ident" id="6776551"><a href="/net/dial_test.go.html#6776420">tt</a></span><span class="op" id="6776553">.</span><span class="ident" id="6776554">addr</span><span class="op" id="6776558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6776562">case</span>&nbsp;<span class="string" id="6776567">&#34;listen&#34;</span><span class="op" id="6776575">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6776580">_</span><span class="op" id="6776581">,</span>&nbsp;<span class="ident" id="6776583"><a href="/net/dial_test.go.html#6776469">err</a></span>&nbsp;<span class="op" id="6776587">=</span>&nbsp;<span class="ident" id="6776589"><a href="/net/dial.go.html#2525176">Listen</a></span><span class="op" id="6776595">(</span><span class="ident" id="6776596"><a href="/net/dial_test.go.html#6776420">tt</a></span><span class="op" id="6776598">.</span><span class="ident" id="6776599">net</span><span class="op" id="6776602">,</span>&nbsp;<span class="ident" id="6776604"><a href="/net/dial_test.go.html#6776420">tt</a></span><span class="op" id="6776606">.</span><span class="ident" id="6776607">addr</span><span class="op" id="6776611">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6776615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6776619">if</span>&nbsp;<span class="op" id="6776622">!</span><span class="ident" id="6776623"><a href="/net/dial_test.go.html#6770074">reflect</a></span><span class="op" id="6776630">.</span><span class="ident" id="6776631">DeepEqual</span><span class="op" id="6776640">(</span><span class="ident" id="6776641"><a href="/net/dial_test.go.html#6776420">tt</a></span><span class="op" id="6776643">.</span><span class="ident" id="6776644">err</span><span class="op" id="6776647">,</span>&nbsp;<span class="ident" id="6776649"><a href="/net/dial_test.go.html#6776469">err</a></span><span class="op" id="6776652">)</span>&nbsp;<span class="op" id="6776654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6776659"><a href="/net/dial_test.go.html#6776396">t</a></span><span class="op" id="6776660">.</span><span class="ident" id="6776661">Fatalf</span><span class="op" id="6776667">(</span><span class="string" id="6776668">&#34;got&nbsp;%#v;&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="6776691">,</span>&nbsp;<span class="ident" id="6776693"><a href="/net/dial_test.go.html#6776469">err</a></span><span class="op" id="6776696">,</span>&nbsp;<span class="ident" id="6776698"><a href="/net/dial_test.go.html#6776420">tt</a></span><span class="op" id="6776700">.</span><span class="ident" id="6776701">err</span><span class="op" id="6776704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6776708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6776711">}</span><br>
<span class="lineno">265</span><span class="op" id="6776713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6776716">func</span>&nbsp;<span class="ident" id="6776721">TestDialTimeoutFDLeak</span><span class="op" id="6776742">(</span><span class="ident" id="6776743">t</span>&nbsp;<span class="op" id="6776745">*</span><span class="ident" id="6776746"><a href="/net/dial_test.go.html#6770125">testing</a></span><span class="op" id="6776753">.</span><span class="ident" id="6776754">T</span><span class="op" id="6776755">)</span>&nbsp;<span class="op" id="6776757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6776760">if</span>&nbsp;<span class="ident" id="6776763"><a href="/net/dial_test.go.html#6770095">runtime</a></span><span class="op" id="6776770">.</span><span class="ident" id="6776771">GOOS</span>&nbsp;<span class="op" id="6776776">!=</span>&nbsp;<span class="string" id="6776779">&#34;linux&#34;</span>&nbsp;<span class="op" id="6776787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6776791">//&nbsp;TODO(bradfitz):&nbsp;test&nbsp;on&nbsp;other&nbsp;platforms</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6776836"><a href="/net/dial_test.go.html#6776743">t</a></span><span class="op" id="6776837">.</span><span class="ident" id="6776838">Skipf</span><span class="op" id="6776843">(</span><span class="string" id="6776844">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6776865">,</span>&nbsp;<span class="ident" id="6776867"><a href="/net/dial_test.go.html#6770095">runtime</a></span><span class="op" id="6776874">.</span><span class="ident" id="6776875">GOOS</span><span class="op" id="6776879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6776882">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6776886">ln</span>&nbsp;<span class="op" id="6776889">:=</span>&nbsp;<span class="ident" id="6776892"><a href="/net/dial_test.go.html#6770151">newLocalListener</a></span><span class="op" id="6776908">(</span><span class="ident" id="6776909"><a href="/net/dial_test.go.html#6776743">t</a></span><span class="op" id="6776910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6776913">defer</span>&nbsp;<span class="ident" id="6776919"><a href="/net/dial_test.go.html#6776886">ln</a></span><span class="op" id="6776921">.</span><span class="ident" id="6776922">Close</span><span class="op" id="6776927">(</span><span class="op" id="6776928">)</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6776932">type</span>&nbsp;<span class="ident" id="6776937">connErr</span>&nbsp;<span class="keyword" id="6776945">struct</span>&nbsp;<span class="op" id="6776952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6776956">conn</span>&nbsp;<span class="ident" id="6776961"><a href="/net/net.go.html#2652476">Conn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6776968">err</span>&nbsp;&nbsp;<span class="builtintype" id="6776973">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6776980">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6776983">dials</span>&nbsp;<span class="op" id="6776989">:=</span>&nbsp;<span class="ident" id="6776992"><a href="/net/net.go.html#2658567">listenerBacklog</a></span>&nbsp;<span class="op" id="6777008">+</span>&nbsp;<span class="num" id="6777010">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6777015">//&nbsp;used&nbsp;to&nbsp;be&nbsp;listenerBacklog&nbsp;+&nbsp;5,&nbsp;but&nbsp;was&nbsp;found&nbsp;to&nbsp;be&nbsp;unreliable,&nbsp;issue&nbsp;4384.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6777095">maxGoodConnect</span>&nbsp;<span class="op" id="6777110">:=</span>&nbsp;<span class="ident" id="6777113"><a href="/net/net.go.html#2658567">listenerBacklog</a></span>&nbsp;<span class="op" id="6777129">+</span>&nbsp;<span class="ident" id="6777131"><a href="/net/dial_test.go.html#6770095">runtime</a></span><span class="op" id="6777138">.</span><span class="ident" id="6777139">NumCPU</span><span class="op" id="6777145">(</span><span class="op" id="6777146">)</span><span class="op" id="6777147">*</span><span class="num" id="6777148">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6777152">resc</span>&nbsp;<span class="op" id="6777157">:=</span>&nbsp;<span class="builtinfunc" id="6777160">make</span><span class="op" id="6777164">(</span><span class="keyword" id="6777165">chan</span>&nbsp;<span class="ident" id="6777170"><a href="/net/dial_test.go.html#6776937">connErr</a></span><span class="op" id="6777177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6777180">for</span>&nbsp;<span class="ident" id="6777184">i</span>&nbsp;<span class="op" id="6777186">:=</span>&nbsp;<span class="num" id="6777189">0</span><span class="op" id="6777190">;</span>&nbsp;<span class="ident" id="6777192"><a href="/net/dial_test.go.html#6777184">i</a></span>&nbsp;<span class="op" id="6777194">&lt;</span>&nbsp;<span class="ident" id="6777196"><a href="/net/dial_test.go.html#6776983">dials</a></span><span class="op" id="6777201">;</span>&nbsp;<span class="ident" id="6777203"><a href="/net/dial_test.go.html#6777184">i</a></span><span class="op" id="6777204">++</span>&nbsp;<span class="op" id="6777207">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6777211">go</span>&nbsp;<span class="keyword" id="6777214">func</span><span class="op" id="6777218">(</span><span class="op" id="6777219">)</span>&nbsp;<span class="op" id="6777221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6777226">conn</span><span class="op" id="6777230">,</span>&nbsp;<span class="ident" id="6777232">err</span>&nbsp;<span class="op" id="6777236">:=</span>&nbsp;<span class="ident" id="6777239"><a href="/net/dial.go.html#2521724">DialTimeout</a></span><span class="op" id="6777250">(</span><span class="string" id="6777251">&#34;tcp&#34;</span><span class="op" id="6777256">,</span>&nbsp;<span class="ident" id="6777258"><a href="/net/dial_test.go.html#6776886">ln</a></span><span class="op" id="6777260">.</span><span class="ident" id="6777261">Addr</span><span class="op" id="6777265">(</span><span class="op" id="6777266">)</span><span class="op" id="6777267">.</span><span class="ident" id="6777268">String</span><span class="op" id="6777274">(</span><span class="op" id="6777275">)</span><span class="op" id="6777276">,</span>&nbsp;<span class="num" id="6777278">500</span><span class="op" id="6777281">*</span><span class="ident" id="6777282"><a href="/net/dial_test.go.html#6770136">time</a></span><span class="op" id="6777286">.</span><span class="ident" id="6777287">Millisecond</span><span class="op" id="6777298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6777303"><a href="/net/dial_test.go.html#6777152">resc</a></span>&nbsp;<span class="op" id="6777308">&lt;-</span>&nbsp;<span class="ident" id="6777311"><a href="/net/dial_test.go.html#6776937">connErr</a></span><span class="op" id="6777318">{</span><span class="ident" id="6777319"><a href="/net/dial_test.go.html#6777226">conn</a></span><span class="op" id="6777323">,</span>&nbsp;<span class="ident" id="6777325"><a href="/net/dial_test.go.html#6777232">err</a></span><span class="op" id="6777328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6777332">}</span><span class="op" id="6777333">(</span><span class="op" id="6777334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6777337">}</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6777341">var</span>&nbsp;<span class="ident" id="6777345">firstErr</span>&nbsp;<span class="builtintype" id="6777354">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6777362">var</span>&nbsp;<span class="ident" id="6777366">ngood</span>&nbsp;<span class="builtintype" id="6777372">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6777377">var</span>&nbsp;<span class="ident" id="6777381">toClose</span>&nbsp;<span class="op" id="6777389">[</span><span class="op" id="6777390">]</span><span class="ident" id="6777391"><a href="/net/dial_test.go.html#6770051">io</a></span><span class="op" id="6777393">.</span><span class="ident" id="6777394">Closer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6777402">for</span>&nbsp;<span class="ident" id="6777406">i</span>&nbsp;<span class="op" id="6777408">:=</span>&nbsp;<span class="num" id="6777411">0</span><span class="op" id="6777412">;</span>&nbsp;<span class="ident" id="6777414"><a href="/net/dial_test.go.html#6777406">i</a></span>&nbsp;<span class="op" id="6777416">&lt;</span>&nbsp;<span class="ident" id="6777418"><a href="/net/dial_test.go.html#6776983">dials</a></span><span class="op" id="6777423">;</span>&nbsp;<span class="ident" id="6777425"><a href="/net/dial_test.go.html#6777406">i</a></span><span class="op" id="6777426">++</span>&nbsp;<span class="op" id="6777429">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6777433">ce</span>&nbsp;<span class="op" id="6777436">:=</span>&nbsp;<span class="op" id="6777439">&lt;-</span><span class="ident" id="6777441"><a href="/net/dial_test.go.html#6777152">resc</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6777448">if</span>&nbsp;<span class="ident" id="6777451"><a href="/net/dial_test.go.html#6777433">ce</a></span><span class="op" id="6777453">.</span><span class="ident" id="6777454">err</span>&nbsp;<span class="op" id="6777458">==</span>&nbsp;<span class="ident" id="6777461">nil</span>&nbsp;<span class="op" id="6777465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6777470"><a href="/net/dial_test.go.html#6777366">ngood</a></span><span class="op" id="6777475">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6777481">if</span>&nbsp;<span class="ident" id="6777484"><a href="/net/dial_test.go.html#6777366">ngood</a></span>&nbsp;<span class="op" id="6777490">&gt;</span>&nbsp;<span class="ident" id="6777492"><a href="/net/dial_test.go.html#6777095">maxGoodConnect</a></span>&nbsp;<span class="op" id="6777507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6777513"><a href="/net/dial_test.go.html#6776743">t</a></span><span class="op" id="6777514">.</span><span class="ident" id="6777515">Errorf</span><span class="op" id="6777521">(</span><span class="string" id="6777522">&#34;%d&nbsp;good&nbsp;connects;&nbsp;expected&nbsp;at&nbsp;most&nbsp;%d&#34;</span><span class="op" id="6777561">,</span>&nbsp;<span class="ident" id="6777563"><a href="/net/dial_test.go.html#6777366">ngood</a></span><span class="op" id="6777568">,</span>&nbsp;<span class="ident" id="6777570"><a href="/net/dial_test.go.html#6777095">maxGoodConnect</a></span><span class="op" id="6777584">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6777589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6777594"><a href="/net/dial_test.go.html#6777381">toClose</a></span>&nbsp;<span class="op" id="6777602">=</span>&nbsp;<span class="builtinfunc" id="6777604">append</span><span class="op" id="6777610">(</span><span class="ident" id="6777611"><a href="/net/dial_test.go.html#6777381">toClose</a></span><span class="op" id="6777618">,</span>&nbsp;<span class="ident" id="6777620"><a href="/net/dial_test.go.html#6777433">ce</a></span><span class="op" id="6777622">.</span><span class="ident" id="6777623">conn</span><span class="op" id="6777627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6777632">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6777643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6777647">err</span>&nbsp;<span class="op" id="6777651">:=</span>&nbsp;<span class="ident" id="6777654"><a href="/net/dial_test.go.html#6777433">ce</a></span><span class="op" id="6777656">.</span><span class="ident" id="6777657">err</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6777663">if</span>&nbsp;<span class="ident" id="6777666"><a href="/net/dial_test.go.html#6777345">firstErr</a></span>&nbsp;<span class="op" id="6777675">==</span>&nbsp;<span class="string" id="6777678">&#34;&#34;</span>&nbsp;<span class="op" id="6777681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6777686"><a href="/net/dial_test.go.html#6777345">firstErr</a></span>&nbsp;<span class="op" id="6777695">=</span>&nbsp;<span class="ident" id="6777697"><a href="/net/dial_test.go.html#6777647">err</a></span><span class="op" id="6777700">.</span><span class="ident" id="6777701">Error</span><span class="op" id="6777706">(</span><span class="op" id="6777707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6777711">}</span>&nbsp;<span class="keyword" id="6777713">else</span>&nbsp;<span class="keyword" id="6777718">if</span>&nbsp;<span class="ident" id="6777721"><a href="/net/dial_test.go.html#6777647">err</a></span><span class="op" id="6777724">.</span><span class="ident" id="6777725">Error</span><span class="op" id="6777730">(</span><span class="op" id="6777731">)</span>&nbsp;<span class="op" id="6777733">!=</span>&nbsp;<span class="ident" id="6777736"><a href="/net/dial_test.go.html#6777345">firstErr</a></span>&nbsp;<span class="op" id="6777745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6777750"><a href="/net/dial_test.go.html#6776743">t</a></span><span class="op" id="6777751">.</span><span class="ident" id="6777752">Fatalf</span><span class="op" id="6777758">(</span><span class="string" id="6777759">&#34;inconsistent&nbsp;error&nbsp;messages:&nbsp;first&nbsp;was&nbsp;%q,&nbsp;then&nbsp;later&nbsp;%q&#34;</span><span class="op" id="6777817">,</span>&nbsp;<span class="ident" id="6777819"><a href="/net/dial_test.go.html#6777345">firstErr</a></span><span class="op" id="6777827">,</span>&nbsp;<span class="ident" id="6777829"><a href="/net/dial_test.go.html#6777647">err</a></span><span class="op" id="6777832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6777836">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6777839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6777842">for</span>&nbsp;<span class="ident" id="6777846">_</span><span class="op" id="6777847">,</span>&nbsp;<span class="ident" id="6777849">c</span>&nbsp;<span class="op" id="6777851">:=</span>&nbsp;<span class="keyword" id="6777854">range</span>&nbsp;<span class="ident" id="6777860"><a href="/net/dial_test.go.html#6777381">toClose</a></span>&nbsp;<span class="op" id="6777868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6777872"><a href="/net/dial_test.go.html#6777849">c</a></span><span class="op" id="6777873">.</span><span class="ident" id="6777874">Close</span><span class="op" id="6777879">(</span><span class="op" id="6777880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6777883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6777886">for</span>&nbsp;<span class="ident" id="6777890">i</span>&nbsp;<span class="op" id="6777892">:=</span>&nbsp;<span class="num" id="6777895">0</span><span class="op" id="6777896">;</span>&nbsp;<span class="ident" id="6777898"><a href="/net/dial_test.go.html#6777890">i</a></span>&nbsp;<span class="op" id="6777900">&lt;</span>&nbsp;<span class="num" id="6777902">100</span><span class="op" id="6777905">;</span>&nbsp;<span class="ident" id="6777907"><a href="/net/dial_test.go.html#6777890">i</a></span><span class="op" id="6777908">++</span>&nbsp;<span class="op" id="6777911">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6777915">if</span>&nbsp;<span class="ident" id="6777918">got</span>&nbsp;<span class="op" id="6777922">:=</span>&nbsp;<span class="ident" id="6777925"><a href="/net/dial_test.go.html#6780698">numFD</a></span><span class="op" id="6777930">(</span><span class="op" id="6777931">)</span><span class="op" id="6777932">;</span>&nbsp;<span class="ident" id="6777934"><a href="/net/dial_test.go.html#6777918">got</a></span>&nbsp;<span class="op" id="6777938">&lt;</span>&nbsp;<span class="ident" id="6777940"><a href="/net/dial_test.go.html#6776983">dials</a></span>&nbsp;<span class="op" id="6777946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6777951">//&nbsp;Test&nbsp;passes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6777970">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6777979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6777983"><a href="/net/dial_test.go.html#6770136">time</a></span><span class="op" id="6777987">.</span><span class="ident" id="6777988">Sleep</span><span class="op" id="6777993">(</span><span class="num" id="6777994">10</span>&nbsp;<span class="op" id="6777997">*</span>&nbsp;<span class="ident" id="6777999"><a href="/net/dial_test.go.html#6770136">time</a></span><span class="op" id="6778003">.</span><span class="ident" id="6778004">Millisecond</span><span class="op" id="6778015">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6778018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6778021">if</span>&nbsp;<span class="ident" id="6778024">got</span>&nbsp;<span class="op" id="6778028">:=</span>&nbsp;<span class="ident" id="6778031"><a href="/net/dial_test.go.html#6780698">numFD</a></span><span class="op" id="6778036">(</span><span class="op" id="6778037">)</span><span class="op" id="6778038">;</span>&nbsp;<span class="ident" id="6778040"><a href="/net/dial_test.go.html#6778024">got</a></span>&nbsp;<span class="op" id="6778044">&gt;=</span>&nbsp;<span class="ident" id="6778047"><a href="/net/dial_test.go.html#6776983">dials</a></span>&nbsp;<span class="op" id="6778053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6778057"><a href="/net/dial_test.go.html#6776743">t</a></span><span class="op" id="6778058">.</span><span class="ident" id="6778059">Errorf</span><span class="op" id="6778065">(</span><span class="string" id="6778066">&#34;num&nbsp;fds&nbsp;after&nbsp;%d&nbsp;timeouts&nbsp;=&nbsp;%d;&nbsp;want&nbsp;&lt;%d&#34;</span><span class="op" id="6778108">,</span>&nbsp;<span class="ident" id="6778110"><a href="/net/dial_test.go.html#6776983">dials</a></span><span class="op" id="6778115">,</span>&nbsp;<span class="ident" id="6778117"><a href="/net/dial_test.go.html#6778024">got</a></span><span class="op" id="6778120">,</span>&nbsp;<span class="ident" id="6778122"><a href="/net/dial_test.go.html#6776983">dials</a></span><span class="op" id="6778127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6778130">}</span><br>
<span class="lineno"></span><span class="op" id="6778132">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="keyword" id="6778135">func</span>&nbsp;<span class="ident" id="6778140">numTCP</span><span class="op" id="6778146">(</span><span class="op" id="6778147">)</span>&nbsp;<span class="op" id="6778149">(</span><span class="ident" id="6778150">ntcp</span><span class="op" id="6778154">,</span>&nbsp;<span class="ident" id="6778156">nopen</span><span class="op" id="6778161">,</span>&nbsp;<span class="ident" id="6778163">nclose</span>&nbsp;<span class="builtintype" id="6778170">int</span><span class="op" id="6778173">,</span>&nbsp;<span class="ident" id="6778175">err</span>&nbsp;<span class="builtintype" id="6778179">error</span><span class="op" id="6778184">)</span>&nbsp;<span class="op" id="6778186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6778189">lsof</span><span class="op" id="6778193">,</span>&nbsp;<span class="ident" id="6778195"><a href="/net/dial_test.go.html#6778175">err</a></span>&nbsp;<span class="op" id="6778199">:=</span>&nbsp;<span class="ident" id="6778202"><a href="/net/dial_test.go.html#6770063">exec</a></span><span class="op" id="6778206">.</span><span class="ident" id="6778207">Command</span><span class="op" id="6778214">(</span><span class="string" id="6778215">&#34;lsof&#34;</span><span class="op" id="6778221">,</span>&nbsp;<span class="string" id="6778223">&#34;-n&#34;</span><span class="op" id="6778227">,</span>&nbsp;<span class="string" id="6778229">&#34;-p&#34;</span><span class="op" id="6778233">,</span>&nbsp;<span class="ident" id="6778235"><a href="/net/dial_test.go.html#6770106">strconv</a></span><span class="op" id="6778242">.</span><span class="ident" id="6778243">Itoa</span><span class="op" id="6778247">(</span><span class="ident" id="6778248"><a href="/net/dial_test.go.html#6770057">os</a></span><span class="op" id="6778250">.</span><span class="ident" id="6778251">Getpid</span><span class="op" id="6778257">(</span><span class="op" id="6778258">)</span><span class="op" id="6778259">)</span><span class="op" id="6778260">)</span><span class="op" id="6778261">.</span><span class="ident" id="6778262">Output</span><span class="op" id="6778268">(</span><span class="op" id="6778269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6778272">if</span>&nbsp;<span class="ident" id="6778275"><a href="/net/dial_test.go.html#6778175">err</a></span>&nbsp;<span class="op" id="6778279">!=</span>&nbsp;<span class="ident" id="6778282">nil</span>&nbsp;<span class="op" id="6778286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6778290">return</span>&nbsp;<span class="num" id="6778297">0</span><span class="op" id="6778298">,</span>&nbsp;<span class="num" id="6778300">0</span><span class="op" id="6778301">,</span>&nbsp;<span class="num" id="6778303">0</span><span class="op" id="6778304">,</span>&nbsp;<span class="ident" id="6778306"><a href="/net/dial_test.go.html#6778175">err</a></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6778311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6778314"><a href="/net/dial_test.go.html#6778150">ntcp</a></span>&nbsp;<span class="op" id="6778319">+=</span>&nbsp;<span class="ident" id="6778322"><a href="/net/dial_test.go.html#6770027">bytes</a></span><span class="op" id="6778327">.</span><span class="ident" id="6778328">Count</span><span class="op" id="6778333">(</span><span class="ident" id="6778334"><a href="/net/dial_test.go.html#6778189">lsof</a></span><span class="op" id="6778338">,</span>&nbsp;<span class="op" id="6778340">[</span><span class="op" id="6778341">]</span><span class="builtintype" id="6778342">byte</span><span class="op" id="6778346">(</span><span class="string" id="6778347">&#34;TCP&#34;</span><span class="op" id="6778352">)</span><span class="op" id="6778353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6778356">for</span>&nbsp;<span class="ident" id="6778360">_</span><span class="op" id="6778361">,</span>&nbsp;<span class="ident" id="6778363">state</span>&nbsp;<span class="op" id="6778369">:=</span>&nbsp;<span class="keyword" id="6778372">range</span>&nbsp;<span class="op" id="6778378">[</span><span class="op" id="6778379">]</span><span class="builtintype" id="6778380">string</span><span class="op" id="6778386">{</span><span class="string" id="6778387">&#34;LISTEN&#34;</span><span class="op" id="6778395">,</span>&nbsp;<span class="string" id="6778397">&#34;SYN_SENT&#34;</span><span class="op" id="6778407">,</span>&nbsp;<span class="string" id="6778409">&#34;SYN_RECEIVED&#34;</span><span class="op" id="6778423">,</span>&nbsp;<span class="string" id="6778425">&#34;ESTABLISHED&#34;</span><span class="op" id="6778438">}</span>&nbsp;<span class="op" id="6778440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6778444"><a href="/net/dial_test.go.html#6778156">nopen</a></span>&nbsp;<span class="op" id="6778450">+=</span>&nbsp;<span class="ident" id="6778453"><a href="/net/dial_test.go.html#6770027">bytes</a></span><span class="op" id="6778458">.</span><span class="ident" id="6778459">Count</span><span class="op" id="6778464">(</span><span class="ident" id="6778465"><a href="/net/dial_test.go.html#6778189">lsof</a></span><span class="op" id="6778469">,</span>&nbsp;<span class="op" id="6778471">[</span><span class="op" id="6778472">]</span><span class="builtintype" id="6778473">byte</span><span class="op" id="6778477">(</span><span class="ident" id="6778478"><a href="/net/dial_test.go.html#6778363">state</a></span><span class="op" id="6778483">)</span><span class="op" id="6778484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6778487">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6778490">for</span>&nbsp;<span class="ident" id="6778494">_</span><span class="op" id="6778495">,</span>&nbsp;<span class="ident" id="6778497">state</span>&nbsp;<span class="op" id="6778503">:=</span>&nbsp;<span class="keyword" id="6778506">range</span>&nbsp;<span class="op" id="6778512">[</span><span class="op" id="6778513">]</span><span class="builtintype" id="6778514">string</span><span class="op" id="6778520">{</span><span class="string" id="6778521">&#34;CLOSED&#34;</span><span class="op" id="6778529">,</span>&nbsp;<span class="string" id="6778531">&#34;CLOSE_WAIT&#34;</span><span class="op" id="6778543">,</span>&nbsp;<span class="string" id="6778545">&#34;LAST_ACK&#34;</span><span class="op" id="6778555">,</span>&nbsp;<span class="string" id="6778557">&#34;FIN_WAIT_1&#34;</span><span class="op" id="6778569">,</span>&nbsp;<span class="string" id="6778571">&#34;FIN_WAIT_2&#34;</span><span class="op" id="6778583">,</span>&nbsp;<span class="string" id="6778585">&#34;CLOSING&#34;</span><span class="op" id="6778594">,</span>&nbsp;<span class="string" id="6778596">&#34;TIME_WAIT&#34;</span><span class="op" id="6778607">}</span>&nbsp;<span class="op" id="6778609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6778613"><a href="/net/dial_test.go.html#6778163">nclose</a></span>&nbsp;<span class="op" id="6778620">+=</span>&nbsp;<span class="ident" id="6778623"><a href="/net/dial_test.go.html#6770027">bytes</a></span><span class="op" id="6778628">.</span><span class="ident" id="6778629">Count</span><span class="op" id="6778634">(</span><span class="ident" id="6778635"><a href="/net/dial_test.go.html#6778189">lsof</a></span><span class="op" id="6778639">,</span>&nbsp;<span class="op" id="6778641">[</span><span class="op" id="6778642">]</span><span class="builtintype" id="6778643">byte</span><span class="op" id="6778647">(</span><span class="ident" id="6778648"><a href="/net/dial_test.go.html#6778497">state</a></span><span class="op" id="6778653">)</span><span class="op" id="6778654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6778657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6778660">return</span>&nbsp;<span class="ident" id="6778667"><a href="/net/dial_test.go.html#6778150">ntcp</a></span><span class="op" id="6778671">,</span>&nbsp;<span class="ident" id="6778673"><a href="/net/dial_test.go.html#6778156">nopen</a></span><span class="op" id="6778678">,</span>&nbsp;<span class="ident" id="6778680"><a href="/net/dial_test.go.html#6778163">nclose</a></span><span class="op" id="6778686">,</span>&nbsp;<span class="ident" id="6778688">nil</span><br>
<span class="lineno"></span><span class="op" id="6778692">}</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span><span class="keyword" id="6778695">func</span>&nbsp;<span class="ident" id="6778700">TestDialMultiFDLeak</span><span class="op" id="6778719">(</span><span class="ident" id="6778720">t</span>&nbsp;<span class="op" id="6778722">*</span><span class="ident" id="6778723"><a href="/net/dial_test.go.html#6770125">testing</a></span><span class="op" id="6778730">.</span><span class="ident" id="6778731">T</span><span class="op" id="6778732">)</span>&nbsp;<span class="op" id="6778734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6778737"><a href="/net/dial_test.go.html#6778720">t</a></span><span class="op" id="6778738">.</span><span class="ident" id="6778739">Skip</span><span class="op" id="6778743">(</span><span class="string" id="6778744">&#34;flaky&nbsp;test&nbsp;-&nbsp;golang.org/issue/8764&#34;</span><span class="op" id="6778780">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6778784">if</span>&nbsp;<span class="op" id="6778787">!</span><span class="ident" id="6778788"><a href="/net/ipsock.go.html#2627659">supportsIPv4</a></span>&nbsp;<span class="op" id="6778801">||</span>&nbsp;<span class="op" id="6778804">!</span><span class="ident" id="6778805"><a href="/net/ipsock.go.html#2627769">supportsIPv6</a></span>&nbsp;<span class="op" id="6778818">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6778822"><a href="/net/dial_test.go.html#6778720">t</a></span><span class="op" id="6778823">.</span><span class="ident" id="6778824">Skip</span><span class="op" id="6778828">(</span><span class="string" id="6778829">&#34;neither&nbsp;ipv4&nbsp;nor&nbsp;ipv6&nbsp;is&nbsp;supported&#34;</span><span class="op" id="6778865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6778868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6778872">halfDeadServer</span>&nbsp;<span class="op" id="6778887">:=</span>&nbsp;<span class="keyword" id="6778890">func</span><span class="op" id="6778894">(</span><span class="ident" id="6778895">dss</span>&nbsp;<span class="op" id="6778899">*</span><span class="ident" id="6778900"><a href="/net/mockserver_test.go.html#6866861">dualStackServer</a></span><span class="op" id="6778915">,</span>&nbsp;<span class="ident" id="6778917">ln</span>&nbsp;<span class="ident" id="6778920"><a href="/net/net.go.html#2658762">Listener</a></span><span class="op" id="6778928">)</span>&nbsp;<span class="op" id="6778930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6778934">for</span>&nbsp;<span class="op" id="6778938">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6778943">if</span>&nbsp;<span class="ident" id="6778946">c</span><span class="op" id="6778947">,</span>&nbsp;<span class="ident" id="6778949">err</span>&nbsp;<span class="op" id="6778953">:=</span>&nbsp;<span class="ident" id="6778956"><a href="/net/dial_test.go.html#6778917">ln</a></span><span class="op" id="6778958">.</span><span class="ident" id="6778959">Accept</span><span class="op" id="6778965">(</span><span class="op" id="6778966">)</span><span class="op" id="6778967">;</span>&nbsp;<span class="ident" id="6778969"><a href="/net/dial_test.go.html#6778949">err</a></span>&nbsp;<span class="op" id="6778973">!=</span>&nbsp;<span class="ident" id="6778976">nil</span>&nbsp;<span class="op" id="6778980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6778986">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6778996">}</span>&nbsp;<span class="keyword" id="6778998">else</span>&nbsp;<span class="op" id="6779003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6779009">//&nbsp;It&nbsp;just&nbsp;keeps&nbsp;established</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6779042">//&nbsp;connections&nbsp;like&nbsp;a&nbsp;half-dead&nbsp;server</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6779085">//&nbsp;does.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6779098"><a href="/net/dial_test.go.html#6778895">dss</a></span><span class="op" id="6779101">.</span><span class="ident" id="6779102">putConn</span><span class="op" id="6779109">(</span><span class="ident" id="6779110"><a href="/net/dial_test.go.html#6778946">c</a></span><span class="op" id="6779111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6779116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6779120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6779123">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6779126">dss</span><span class="op" id="6779129">,</span>&nbsp;<span class="ident" id="6779131">err</span>&nbsp;<span class="op" id="6779135">:=</span>&nbsp;<span class="ident" id="6779138"><a href="/net/mockserver_test.go.html#6867832">newDualStackServer</a></span><span class="op" id="6779156">(</span><span class="op" id="6779157">[</span><span class="op" id="6779158">]</span><span class="ident" id="6779159"><a href="/net/mockserver_test.go.html#6866791">streamListener</a></span><span class="op" id="6779173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6779177">{</span><span class="ident" id="6779178">net</span><span class="op" id="6779181">:</span>&nbsp;<span class="string" id="6779183">&#34;tcp4&#34;</span><span class="op" id="6779189">,</span>&nbsp;<span class="ident" id="6779191">addr</span><span class="op" id="6779195">:</span>&nbsp;<span class="string" id="6779197">&#34;127.0.0.1&#34;</span><span class="op" id="6779208">}</span><span class="op" id="6779209">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6779213">{</span><span class="ident" id="6779214">net</span><span class="op" id="6779217">:</span>&nbsp;<span class="string" id="6779219">&#34;tcp6&#34;</span><span class="op" id="6779225">,</span>&nbsp;<span class="ident" id="6779227">addr</span><span class="op" id="6779231">:</span>&nbsp;<span class="string" id="6779233">&#34;[::1]&#34;</span><span class="op" id="6779240">}</span><span class="op" id="6779241">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6779244">}</span><span class="op" id="6779245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6779248">if</span>&nbsp;<span class="ident" id="6779251"><a href="/net/dial_test.go.html#6779131">err</a></span>&nbsp;<span class="op" id="6779255">!=</span>&nbsp;<span class="ident" id="6779258">nil</span>&nbsp;<span class="op" id="6779262">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6779266"><a href="/net/dial_test.go.html#6778720">t</a></span><span class="op" id="6779267">.</span><span class="ident" id="6779268">Fatalf</span><span class="op" id="6779274">(</span><span class="string" id="6779275">&#34;newDualStackServer&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6779306">,</span>&nbsp;<span class="ident" id="6779308"><a href="/net/dial_test.go.html#6779131">err</a></span><span class="op" id="6779311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6779314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6779317">defer</span>&nbsp;<span class="ident" id="6779323"><a href="/net/dial_test.go.html#6779126">dss</a></span><span class="op" id="6779326">.</span><span class="ident" id="6779327">teardown</span><span class="op" id="6779335">(</span><span class="op" id="6779336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6779339">if</span>&nbsp;<span class="ident" id="6779342">err</span>&nbsp;<span class="op" id="6779346">:=</span>&nbsp;<span class="ident" id="6779349"><a href="/net/dial_test.go.html#6779126">dss</a></span><span class="op" id="6779352">.</span><span class="ident" id="6779353">buildup</span><span class="op" id="6779360">(</span><span class="ident" id="6779361"><a href="/net/dial_test.go.html#6778872">halfDeadServer</a></span><span class="op" id="6779375">)</span><span class="op" id="6779376">;</span>&nbsp;<span class="ident" id="6779378"><a href="/net/dial_test.go.html#6779342">err</a></span>&nbsp;<span class="op" id="6779382">!=</span>&nbsp;<span class="ident" id="6779385">nil</span>&nbsp;<span class="op" id="6779389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6779393"><a href="/net/dial_test.go.html#6778720">t</a></span><span class="op" id="6779394">.</span><span class="ident" id="6779395">Fatalf</span><span class="op" id="6779401">(</span><span class="string" id="6779402">&#34;dualStackServer.buildup&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6779438">,</span>&nbsp;<span class="ident" id="6779440"><a href="/net/dial_test.go.html#6779342">err</a></span><span class="op" id="6779443">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6779446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6779450">_</span><span class="op" id="6779451">,</span>&nbsp;<span class="ident" id="6779453">before</span><span class="op" id="6779459">,</span>&nbsp;<span class="ident" id="6779461">_</span><span class="op" id="6779462">,</span>&nbsp;<span class="ident" id="6779464"><a href="/net/dial_test.go.html#6779131">err</a></span>&nbsp;<span class="op" id="6779468">:=</span>&nbsp;<span class="ident" id="6779471"><a href="/net/dial_test.go.html#6778140">numTCP</a></span><span class="op" id="6779477">(</span><span class="op" id="6779478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6779481">if</span>&nbsp;<span class="ident" id="6779484"><a href="/net/dial_test.go.html#6779131">err</a></span>&nbsp;<span class="op" id="6779488">!=</span>&nbsp;<span class="ident" id="6779491">nil</span>&nbsp;<span class="op" id="6779495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6779499"><a href="/net/dial_test.go.html#6778720">t</a></span><span class="op" id="6779500">.</span><span class="ident" id="6779501">Skipf</span><span class="op" id="6779506">(</span><span class="string" id="6779507">&#34;skipping&nbsp;test;&nbsp;error&nbsp;finding&nbsp;or&nbsp;running&nbsp;lsof:&nbsp;%v&#34;</span><span class="op" id="6779557">,</span>&nbsp;<span class="ident" id="6779559"><a href="/net/dial_test.go.html#6779131">err</a></span><span class="op" id="6779562">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6779565">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6779569">var</span>&nbsp;<span class="ident" id="6779573">wg</span>&nbsp;<span class="ident" id="6779576"><a href="/net/dial_test.go.html#6770117">sync</a></span><span class="op" id="6779580">.</span><span class="ident" id="6779581">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6779592">portnum</span><span class="op" id="6779599">,</span>&nbsp;<span class="ident" id="6779601">_</span><span class="op" id="6779602">,</span>&nbsp;<span class="ident" id="6779604">_</span>&nbsp;<span class="op" id="6779606">:=</span>&nbsp;<span class="ident" id="6779609"><a href="/net/parse.go.html#2665011">dtoi</a></span><span class="op" id="6779613">(</span><span class="ident" id="6779614"><a href="/net/dial_test.go.html#6779126">dss</a></span><span class="op" id="6779617">.</span><span class="ident" id="6779618">port</span><span class="op" id="6779622">,</span>&nbsp;<span class="num" id="6779624">0</span><span class="op" id="6779625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6779628">ras</span>&nbsp;<span class="op" id="6779632">:=</span>&nbsp;<span class="ident" id="6779635"><a href="/net/ipsock.go.html#2628430">addrList</a></span><span class="op" id="6779643">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6779647">//&nbsp;Losers&nbsp;that&nbsp;will&nbsp;fail&nbsp;to&nbsp;connect,&nbsp;see&nbsp;RFC&nbsp;6890.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6779700">&amp;</span><span class="ident" id="6779701"><a href="/net/tcpsock.go.html#2691528">TCPAddr</a></span><span class="op" id="6779708">{</span><span class="ident" id="6779709">IP</span><span class="op" id="6779711">:</span>&nbsp;<span class="ident" id="6779713"><a href="/net/ip.go.html#2604600">IPv4</a></span><span class="op" id="6779717">(</span><span class="num" id="6779718">198</span><span class="op" id="6779721">,</span>&nbsp;<span class="num" id="6779723">18</span><span class="op" id="6779725">,</span>&nbsp;<span class="num" id="6779727">0</span><span class="op" id="6779728">,</span>&nbsp;<span class="num" id="6779730">254</span><span class="op" id="6779733">)</span><span class="op" id="6779734">,</span>&nbsp;<span class="ident" id="6779736">Port</span><span class="op" id="6779740">:</span>&nbsp;<span class="ident" id="6779742"><a href="/net/dial_test.go.html#6779592">portnum</a></span><span class="op" id="6779749">}</span><span class="op" id="6779750">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6779754">&amp;</span><span class="ident" id="6779755"><a href="/net/tcpsock.go.html#2691528">TCPAddr</a></span><span class="op" id="6779762">{</span><span class="ident" id="6779763">IP</span><span class="op" id="6779765">:</span>&nbsp;<span class="ident" id="6779767"><a href="/net/ip.go.html#2617916">ParseIP</a></span><span class="op" id="6779774">(</span><span class="string" id="6779775">&#34;2001:2::254&#34;</span><span class="op" id="6779788">)</span><span class="op" id="6779789">,</span>&nbsp;<span class="ident" id="6779791">Port</span><span class="op" id="6779795">:</span>&nbsp;<span class="ident" id="6779797"><a href="/net/dial_test.go.html#6779592">portnum</a></span><span class="op" id="6779804">}</span><span class="op" id="6779805">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6779810">//&nbsp;Winner&nbsp;candidates&nbsp;of&nbsp;this&nbsp;race.</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6779847">&amp;</span><span class="ident" id="6779848"><a href="/net/tcpsock.go.html#2691528">TCPAddr</a></span><span class="op" id="6779855">{</span><span class="ident" id="6779856">IP</span><span class="op" id="6779858">:</span>&nbsp;<span class="ident" id="6779860"><a href="/net/ip.go.html#2604600">IPv4</a></span><span class="op" id="6779864">(</span><span class="num" id="6779865">127</span><span class="op" id="6779868">,</span>&nbsp;<span class="num" id="6779870">0</span><span class="op" id="6779871">,</span>&nbsp;<span class="num" id="6779873">0</span><span class="op" id="6779874">,</span>&nbsp;<span class="num" id="6779876">1</span><span class="op" id="6779877">)</span><span class="op" id="6779878">,</span>&nbsp;<span class="ident" id="6779880">Port</span><span class="op" id="6779884">:</span>&nbsp;<span class="ident" id="6779886"><a href="/net/dial_test.go.html#6779592">portnum</a></span><span class="op" id="6779893">}</span><span class="op" id="6779894">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6779898">&amp;</span><span class="ident" id="6779899"><a href="/net/tcpsock.go.html#2691528">TCPAddr</a></span><span class="op" id="6779906">{</span><span class="ident" id="6779907">IP</span><span class="op" id="6779909">:</span>&nbsp;<span class="ident" id="6779911"><a href="/net/ip.go.html#2605971">IPv6loopback</a></span><span class="op" id="6779923">,</span>&nbsp;<span class="ident" id="6779925">Port</span><span class="op" id="6779929">:</span>&nbsp;<span class="ident" id="6779931"><a href="/net/dial_test.go.html#6779592">portnum</a></span><span class="op" id="6779938">}</span><span class="op" id="6779939">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6779944">//&nbsp;Losers&nbsp;that&nbsp;will&nbsp;have&nbsp;established&nbsp;connections.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6779996">&amp;</span><span class="ident" id="6779997"><a href="/net/tcpsock.go.html#2691528">TCPAddr</a></span><span class="op" id="6780004">{</span><span class="ident" id="6780005">IP</span><span class="op" id="6780007">:</span>&nbsp;<span class="ident" id="6780009"><a href="/net/ip.go.html#2604600">IPv4</a></span><span class="op" id="6780013">(</span><span class="num" id="6780014">127</span><span class="op" id="6780017">,</span>&nbsp;<span class="num" id="6780019">0</span><span class="op" id="6780020">,</span>&nbsp;<span class="num" id="6780022">0</span><span class="op" id="6780023">,</span>&nbsp;<span class="num" id="6780025">1</span><span class="op" id="6780026">)</span><span class="op" id="6780027">,</span>&nbsp;<span class="ident" id="6780029">Port</span><span class="op" id="6780033">:</span>&nbsp;<span class="ident" id="6780035"><a href="/net/dial_test.go.html#6779592">portnum</a></span><span class="op" id="6780042">}</span><span class="op" id="6780043">,</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6780047">&amp;</span><span class="ident" id="6780048"><a href="/net/tcpsock.go.html#2691528">TCPAddr</a></span><span class="op" id="6780055">{</span><span class="ident" id="6780056">IP</span><span class="op" id="6780058">:</span>&nbsp;<span class="ident" id="6780060"><a href="/net/ip.go.html#2605971">IPv6loopback</a></span><span class="op" id="6780072">,</span>&nbsp;<span class="ident" id="6780074">Port</span><span class="op" id="6780078">:</span>&nbsp;<span class="ident" id="6780080"><a href="/net/dial_test.go.html#6779592">portnum</a></span><span class="op" id="6780087">}</span><span class="op" id="6780088">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6780091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6780094">const</span>&nbsp;<span class="ident" id="6780100">T1</span>&nbsp;<span class="op" id="6780103">=</span>&nbsp;<span class="num" id="6780105">10</span>&nbsp;<span class="op" id="6780108">*</span>&nbsp;<span class="ident" id="6780110"><a href="/net/dial_test.go.html#6770136">time</a></span><span class="op" id="6780114">.</span><span class="ident" id="6780115">Millisecond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6780128">const</span>&nbsp;<span class="ident" id="6780134">T2</span>&nbsp;<span class="op" id="6780137">=</span>&nbsp;<span class="num" id="6780139">2</span>&nbsp;<span class="op" id="6780141">*</span>&nbsp;<span class="ident" id="6780143"><a href="/net/dial_test.go.html#6780100">T1</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6780147">const</span>&nbsp;<span class="ident" id="6780153">N</span>&nbsp;<span class="op" id="6780155">=</span>&nbsp;<span class="num" id="6780157">10</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6780161">for</span>&nbsp;<span class="ident" id="6780165">i</span>&nbsp;<span class="op" id="6780167">:=</span>&nbsp;<span class="num" id="6780170">0</span><span class="op" id="6780171">;</span>&nbsp;<span class="ident" id="6780173"><a href="/net/dial_test.go.html#6780165">i</a></span>&nbsp;<span class="op" id="6780175">&lt;</span>&nbsp;<span class="ident" id="6780177"><a href="/net/dial_test.go.html#6780153">N</a></span><span class="op" id="6780178">;</span>&nbsp;<span class="ident" id="6780180"><a href="/net/dial_test.go.html#6780165">i</a></span><span class="op" id="6780181">++</span>&nbsp;<span class="op" id="6780184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6780188"><a href="/net/dial_test.go.html#6779573">wg</a></span><span class="op" id="6780190">.</span><span class="ident" id="6780191">Add</span><span class="op" id="6780194">(</span><span class="num" id="6780195">1</span><span class="op" id="6780196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6780200">go</span>&nbsp;<span class="keyword" id="6780203">func</span><span class="op" id="6780207">(</span><span class="op" id="6780208">)</span>&nbsp;<span class="op" id="6780210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6780215">defer</span>&nbsp;<span class="ident" id="6780221"><a href="/net/dial_test.go.html#6779573">wg</a></span><span class="op" id="6780223">.</span><span class="ident" id="6780224">Done</span><span class="op" id="6780228">(</span><span class="op" id="6780229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6780234">if</span>&nbsp;<span class="ident" id="6780237">c</span><span class="op" id="6780238">,</span>&nbsp;<span class="ident" id="6780240">err</span>&nbsp;<span class="op" id="6780244">:=</span>&nbsp;<span class="ident" id="6780247"><a href="/net/dial.go.html#2523087">dialMulti</a></span><span class="op" id="6780256">(</span><span class="string" id="6780257">&#34;tcp&#34;</span><span class="op" id="6780262">,</span>&nbsp;<span class="string" id="6780264">&#34;fast&nbsp;failover&nbsp;test&#34;</span><span class="op" id="6780284">,</span>&nbsp;<span class="ident" id="6780286">nil</span><span class="op" id="6780289">,</span>&nbsp;<span class="ident" id="6780291"><a href="/net/dial_test.go.html#6779628">ras</a></span><span class="op" id="6780294">,</span>&nbsp;<span class="ident" id="6780296"><a href="/net/dial_test.go.html#6770136">time</a></span><span class="op" id="6780300">.</span><span class="ident" id="6780301">Now</span><span class="op" id="6780304">(</span><span class="op" id="6780305">)</span><span class="op" id="6780306">.</span><span class="ident" id="6780307">Add</span><span class="op" id="6780310">(</span><span class="ident" id="6780311"><a href="/net/dial_test.go.html#6780100">T1</a></span><span class="op" id="6780313">)</span><span class="op" id="6780314">)</span><span class="op" id="6780315">;</span>&nbsp;<span class="ident" id="6780317"><a href="/net/dial_test.go.html#6780240">err</a></span>&nbsp;<span class="op" id="6780321">==</span>&nbsp;<span class="ident" id="6780324">nil</span>&nbsp;<span class="op" id="6780328">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6780334"><a href="/net/dial_test.go.html#6780237">c</a></span><span class="op" id="6780335">.</span><span class="ident" id="6780336">Close</span><span class="op" id="6780341">(</span><span class="op" id="6780342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6780347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6780351">}</span><span class="op" id="6780352">(</span><span class="op" id="6780353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6780356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6780359"><a href="/net/dial_test.go.html#6779573">wg</a></span><span class="op" id="6780361">.</span><span class="ident" id="6780362">Wait</span><span class="op" id="6780366">(</span><span class="op" id="6780367">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6780370"><a href="/net/dial_test.go.html#6770136">time</a></span><span class="op" id="6780374">.</span><span class="ident" id="6780375">Sleep</span><span class="op" id="6780380">(</span><span class="ident" id="6780381"><a href="/net/dial_test.go.html#6780134">T2</a></span><span class="op" id="6780383">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6780387">ntcp</span><span class="op" id="6780391">,</span>&nbsp;<span class="ident" id="6780393">after</span><span class="op" id="6780398">,</span>&nbsp;<span class="ident" id="6780400">nclose</span><span class="op" id="6780406">,</span>&nbsp;<span class="ident" id="6780408"><a href="/net/dial_test.go.html#6779131">err</a></span>&nbsp;<span class="op" id="6780412">:=</span>&nbsp;<span class="ident" id="6780415"><a href="/net/dial_test.go.html#6778140">numTCP</a></span><span class="op" id="6780421">(</span><span class="op" id="6780422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6780425">if</span>&nbsp;<span class="ident" id="6780428"><a href="/net/dial_test.go.html#6779131">err</a></span>&nbsp;<span class="op" id="6780432">!=</span>&nbsp;<span class="ident" id="6780435">nil</span>&nbsp;<span class="op" id="6780439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6780443"><a href="/net/dial_test.go.html#6778720">t</a></span><span class="op" id="6780444">.</span><span class="ident" id="6780445">Skipf</span><span class="op" id="6780450">(</span><span class="string" id="6780451">&#34;skipping&nbsp;test;&nbsp;error&nbsp;finding&nbsp;or&nbsp;running&nbsp;lsof:&nbsp;%v&#34;</span><span class="op" id="6780501">,</span>&nbsp;<span class="ident" id="6780503"><a href="/net/dial_test.go.html#6779131">err</a></span><span class="op" id="6780506">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6780509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6780512"><a href="/net/dial_test.go.html#6778720">t</a></span><span class="op" id="6780513">.</span><span class="ident" id="6780514">Logf</span><span class="op" id="6780518">(</span><span class="string" id="6780519">&#34;tcp&nbsp;sessions:&nbsp;%v,&nbsp;open&nbsp;sessions:&nbsp;%v,&nbsp;closing&nbsp;sessions:&nbsp;%v&#34;</span><span class="op" id="6780578">,</span>&nbsp;<span class="ident" id="6780580"><a href="/net/dial_test.go.html#6780387">ntcp</a></span><span class="op" id="6780584">,</span>&nbsp;<span class="ident" id="6780586"><a href="/net/dial_test.go.html#6780393">after</a></span><span class="op" id="6780591">,</span>&nbsp;<span class="ident" id="6780593"><a href="/net/dial_test.go.html#6780400">nclose</a></span><span class="op" id="6780599">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6780603">if</span>&nbsp;<span class="ident" id="6780606"><a href="/net/dial_test.go.html#6780393">after</a></span>&nbsp;<span class="op" id="6780612">!=</span>&nbsp;<span class="ident" id="6780615"><a href="/net/dial_test.go.html#6779453">before</a></span>&nbsp;<span class="op" id="6780622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6780626"><a href="/net/dial_test.go.html#6778720">t</a></span><span class="op" id="6780627">.</span><span class="ident" id="6780628">Fatalf</span><span class="op" id="6780634">(</span><span class="string" id="6780635">&#34;got&nbsp;%v&nbsp;open&nbsp;sessions;&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6780670">,</span>&nbsp;<span class="ident" id="6780672"><a href="/net/dial_test.go.html#6780393">after</a></span><span class="op" id="6780677">,</span>&nbsp;<span class="ident" id="6780679"><a href="/net/dial_test.go.html#6779453">before</a></span><span class="op" id="6780685">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6780688">}</span><br>
<span class="lineno"></span><span class="op" id="6780690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6780693">func</span>&nbsp;<span class="ident" id="6780698">numFD</span><span class="op" id="6780703">(</span><span class="op" id="6780704">)</span>&nbsp;<span class="builtintype" id="6780706">int</span>&nbsp;<span class="op" id="6780710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6780713">if</span>&nbsp;<span class="ident" id="6780716"><a href="/net/dial_test.go.html#6770095">runtime</a></span><span class="op" id="6780723">.</span><span class="ident" id="6780724">GOOS</span>&nbsp;<span class="op" id="6780729">==</span>&nbsp;<span class="string" id="6780732">&#34;linux&#34;</span>&nbsp;<span class="op" id="6780740">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6780744">f</span><span class="op" id="6780745">,</span>&nbsp;<span class="ident" id="6780747">err</span>&nbsp;<span class="op" id="6780751">:=</span>&nbsp;<span class="ident" id="6780754"><a href="/net/dial_test.go.html#6770057">os</a></span><span class="op" id="6780756">.</span><span class="ident" id="6780757">Open</span><span class="op" id="6780761">(</span><span class="string" id="6780762">&#34;/proc/self/fd&#34;</span><span class="op" id="6780777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6780781">if</span>&nbsp;<span class="ident" id="6780784"><a href="/net/dial_test.go.html#6780747">err</a></span>&nbsp;<span class="op" id="6780788">!=</span>&nbsp;<span class="ident" id="6780791">nil</span>&nbsp;<span class="op" id="6780795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6780800">panic</span><span class="op" id="6780805">(</span><span class="ident" id="6780806"><a href="/net/dial_test.go.html#6780747">err</a></span><span class="op" id="6780809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6780813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6780817">defer</span>&nbsp;<span class="ident" id="6780823"><a href="/net/dial_test.go.html#6780744">f</a></span><span class="op" id="6780824">.</span><span class="ident" id="6780825">Close</span><span class="op" id="6780830">(</span><span class="op" id="6780831">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6780835">names</span><span class="op" id="6780840">,</span>&nbsp;<span class="ident" id="6780842"><a href="/net/dial_test.go.html#6780747">err</a></span>&nbsp;<span class="op" id="6780846">:=</span>&nbsp;<span class="ident" id="6780849"><a href="/net/dial_test.go.html#6780744">f</a></span><span class="op" id="6780850">.</span><span class="ident" id="6780851">Readdirnames</span><span class="op" id="6780863">(</span><span class="num" id="6780864">0</span><span class="op" id="6780865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6780869">if</span>&nbsp;<span class="ident" id="6780872"><a href="/net/dial_test.go.html#6780747">err</a></span>&nbsp;<span class="op" id="6780876">!=</span>&nbsp;<span class="ident" id="6780879">nil</span>&nbsp;<span class="op" id="6780883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6780888">panic</span><span class="op" id="6780893">(</span><span class="ident" id="6780894"><a href="/net/dial_test.go.html#6780747">err</a></span><span class="op" id="6780897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6780901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6780905">return</span>&nbsp;<span class="builtinfunc" id="6780912">len</span><span class="op" id="6780915">(</span><span class="ident" id="6780916"><a href="/net/dial_test.go.html#6780835">names</a></span><span class="op" id="6780921">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6780924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6780927">//&nbsp;All&nbsp;tests&nbsp;using&nbsp;this&nbsp;should&nbsp;be&nbsp;skipped&nbsp;anyway,&nbsp;but:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6780983">panic</span><span class="op" id="6780988">(</span><span class="string" id="6780989">&#34;numFDs&nbsp;not&nbsp;implemented&nbsp;on&nbsp;&#34;</span>&nbsp;<span class="op" id="6781018">+</span>&nbsp;<span class="ident" id="6781020"><a href="/net/dial_test.go.html#6770095">runtime</a></span><span class="op" id="6781027">.</span><span class="ident" id="6781028">GOOS</span><span class="op" id="6781032">)</span><br>
<span class="lineno"></span><span class="op" id="6781034">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="keyword" id="6781037">func</span>&nbsp;<span class="ident" id="6781042">TestDialer</span><span class="op" id="6781052">(</span><span class="ident" id="6781053">t</span>&nbsp;<span class="op" id="6781055">*</span><span class="ident" id="6781056"><a href="/net/dial_test.go.html#6770125">testing</a></span><span class="op" id="6781063">.</span><span class="ident" id="6781064">T</span><span class="op" id="6781065">)</span>&nbsp;<span class="op" id="6781067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6781070">ln</span><span class="op" id="6781072">,</span>&nbsp;<span class="ident" id="6781074">err</span>&nbsp;<span class="op" id="6781078">:=</span>&nbsp;<span class="ident" id="6781081"><a href="/net/dial.go.html#2525176">Listen</a></span><span class="op" id="6781087">(</span><span class="string" id="6781088">&#34;tcp4&#34;</span><span class="op" id="6781094">,</span>&nbsp;<span class="string" id="6781096">&#34;127.0.0.1:0&#34;</span><span class="op" id="6781109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6781112">if</span>&nbsp;<span class="ident" id="6781115"><a href="/net/dial_test.go.html#6781074">err</a></span>&nbsp;<span class="op" id="6781119">!=</span>&nbsp;<span class="ident" id="6781122">nil</span>&nbsp;<span class="op" id="6781126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6781130"><a href="/net/dial_test.go.html#6781053">t</a></span><span class="op" id="6781131">.</span><span class="ident" id="6781132">Fatalf</span><span class="op" id="6781138">(</span><span class="string" id="6781139">&#34;Listen&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6781158">,</span>&nbsp;<span class="ident" id="6781160"><a href="/net/dial_test.go.html#6781074">err</a></span><span class="op" id="6781163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6781166">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6781169">defer</span>&nbsp;<span class="ident" id="6781175"><a href="/net/dial_test.go.html#6781070">ln</a></span><span class="op" id="6781177">.</span><span class="ident" id="6781178">Close</span><span class="op" id="6781183">(</span><span class="op" id="6781184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6781187">ch</span>&nbsp;<span class="op" id="6781190">:=</span>&nbsp;<span class="builtinfunc" id="6781193">make</span><span class="op" id="6781197">(</span><span class="keyword" id="6781198">chan</span>&nbsp;<span class="builtintype" id="6781203">error</span><span class="op" id="6781208">,</span>&nbsp;<span class="num" id="6781210">1</span><span class="op" id="6781211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6781214">go</span>&nbsp;<span class="keyword" id="6781217">func</span><span class="op" id="6781221">(</span><span class="op" id="6781222">)</span>&nbsp;<span class="op" id="6781224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6781228">c</span><span class="op" id="6781229">,</span>&nbsp;<span class="ident" id="6781231">err</span>&nbsp;<span class="op" id="6781235">:=</span>&nbsp;<span class="ident" id="6781238"><a href="/net/dial_test.go.html#6781070">ln</a></span><span class="op" id="6781240">.</span><span class="ident" id="6781241">Accept</span><span class="op" id="6781247">(</span><span class="op" id="6781248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6781252">if</span>&nbsp;<span class="ident" id="6781255"><a href="/net/dial_test.go.html#6781231">err</a></span>&nbsp;<span class="op" id="6781259">!=</span>&nbsp;<span class="ident" id="6781262">nil</span>&nbsp;<span class="op" id="6781266">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6781271"><a href="/net/dial_test.go.html#6781187">ch</a></span>&nbsp;<span class="op" id="6781274">&lt;-</span>&nbsp;<span class="ident" id="6781277"><a href="/net/dial_test.go.html#6770044">fmt</a></span><span class="op" id="6781280">.</span><span class="ident" id="6781281">Errorf</span><span class="op" id="6781287">(</span><span class="string" id="6781288">&#34;Accept&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6781307">,</span>&nbsp;<span class="ident" id="6781309"><a href="/net/dial_test.go.html#6781231">err</a></span><span class="op" id="6781312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6781317">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6781326">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6781330">defer</span>&nbsp;<span class="ident" id="6781336"><a href="/net/dial_test.go.html#6781228">c</a></span><span class="op" id="6781337">.</span><span class="ident" id="6781338">Close</span><span class="op" id="6781343">(</span><span class="op" id="6781344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6781348"><a href="/net/dial_test.go.html#6781187">ch</a></span>&nbsp;<span class="op" id="6781351">&lt;-</span>&nbsp;<span class="ident" id="6781354">nil</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6781359">}</span><span class="op" id="6781360">(</span><span class="op" id="6781361">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6781365">laddr</span><span class="op" id="6781370">,</span>&nbsp;<span class="ident" id="6781372"><a href="/net/dial_test.go.html#6781074">err</a></span>&nbsp;<span class="op" id="6781376">:=</span>&nbsp;<span class="ident" id="6781379"><a href="/net/tcpsock.go.html#2692376">ResolveTCPAddr</a></span><span class="op" id="6781393">(</span><span class="string" id="6781394">&#34;tcp4&#34;</span><span class="op" id="6781400">,</span>&nbsp;<span class="string" id="6781402">&#34;127.0.0.1:0&#34;</span><span class="op" id="6781415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6781418">if</span>&nbsp;<span class="ident" id="6781421"><a href="/net/dial_test.go.html#6781074">err</a></span>&nbsp;<span class="op" id="6781425">!=</span>&nbsp;<span class="ident" id="6781428">nil</span>&nbsp;<span class="op" id="6781432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6781436"><a href="/net/dial_test.go.html#6781053">t</a></span><span class="op" id="6781437">.</span><span class="ident" id="6781438">Fatalf</span><span class="op" id="6781444">(</span><span class="string" id="6781445">&#34;ResolveTCPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6781472">,</span>&nbsp;<span class="ident" id="6781474"><a href="/net/dial_test.go.html#6781074">err</a></span><span class="op" id="6781477">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6781480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6781483">d</span>&nbsp;<span class="op" id="6781485">:=</span>&nbsp;<span class="op" id="6781488">&amp;</span><span class="ident" id="6781489"><a href="/net/dial.go.html#2517815">Dialer</a></span><span class="op" id="6781495">{</span><span class="ident" id="6781496">LocalAddr</span><span class="op" id="6781505">:</span>&nbsp;<span class="ident" id="6781507"><a href="/net/dial_test.go.html#6781365">laddr</a></span><span class="op" id="6781512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6781515">c</span><span class="op" id="6781516">,</span>&nbsp;<span class="ident" id="6781518"><a href="/net/dial_test.go.html#6781074">err</a></span>&nbsp;<span class="op" id="6781522">:=</span>&nbsp;<span class="ident" id="6781525"><a href="/net/dial_test.go.html#6781483">d</a></span><span class="op" id="6781526">.</span><span class="ident" id="6781527">Dial</span><span class="op" id="6781531">(</span><span class="string" id="6781532">&#34;tcp4&#34;</span><span class="op" id="6781538">,</span>&nbsp;<span class="ident" id="6781540"><a href="/net/dial_test.go.html#6781070">ln</a></span><span class="op" id="6781542">.</span><span class="ident" id="6781543">Addr</span><span class="op" id="6781547">(</span><span class="op" id="6781548">)</span><span class="op" id="6781549">.</span><span class="ident" id="6781550">String</span><span class="op" id="6781556">(</span><span class="op" id="6781557">)</span><span class="op" id="6781558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6781561">if</span>&nbsp;<span class="ident" id="6781564"><a href="/net/dial_test.go.html#6781074">err</a></span>&nbsp;<span class="op" id="6781568">!=</span>&nbsp;<span class="ident" id="6781571">nil</span>&nbsp;<span class="op" id="6781575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6781579"><a href="/net/dial_test.go.html#6781053">t</a></span><span class="op" id="6781580">.</span><span class="ident" id="6781581">Fatalf</span><span class="op" id="6781587">(</span><span class="string" id="6781588">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6781605">,</span>&nbsp;<span class="ident" id="6781607"><a href="/net/dial_test.go.html#6781074">err</a></span><span class="op" id="6781610">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6781613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6781616">defer</span>&nbsp;<span class="ident" id="6781622"><a href="/net/dial_test.go.html#6781515">c</a></span><span class="op" id="6781623">.</span><span class="ident" id="6781624">Close</span><span class="op" id="6781629">(</span><span class="op" id="6781630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6781633"><a href="/net/dial_test.go.html#6781515">c</a></span><span class="op" id="6781634">.</span><span class="ident" id="6781635">Read</span><span class="op" id="6781639">(</span><span class="builtinfunc" id="6781640">make</span><span class="op" id="6781644">(</span><span class="op" id="6781645">[</span><span class="op" id="6781646">]</span><span class="builtintype" id="6781647">byte</span><span class="op" id="6781651">,</span>&nbsp;<span class="num" id="6781653">1</span><span class="op" id="6781654">)</span><span class="op" id="6781655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6781658"><a href="/net/dial_test.go.html#6781074">err</a></span>&nbsp;<span class="op" id="6781662">=</span>&nbsp;<span class="op" id="6781664">&lt;-</span><span class="ident" id="6781666"><a href="/net/dial_test.go.html#6781187">ch</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6781670">if</span>&nbsp;<span class="ident" id="6781673"><a href="/net/dial_test.go.html#6781074">err</a></span>&nbsp;<span class="op" id="6781677">!=</span>&nbsp;<span class="ident" id="6781680">nil</span>&nbsp;<span class="op" id="6781684">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6781688"><a href="/net/dial_test.go.html#6781053">t</a></span><span class="op" id="6781689">.</span><span class="ident" id="6781690">Error</span><span class="op" id="6781695">(</span><span class="ident" id="6781696"><a href="/net/dial_test.go.html#6781074">err</a></span><span class="op" id="6781699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6781702">}</span><br>
<span class="lineno"></span><span class="op" id="6781704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6781707">func</span>&nbsp;<span class="ident" id="6781712">TestDialDualStackLocalhost</span><span class="op" id="6781738">(</span><span class="ident" id="6781739">t</span>&nbsp;<span class="op" id="6781741">*</span><span class="ident" id="6781742"><a href="/net/dial_test.go.html#6770125">testing</a></span><span class="op" id="6781749">.</span><span class="ident" id="6781750">T</span><span class="op" id="6781751">)</span>&nbsp;<span class="op" id="6781753">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6781756">switch</span>&nbsp;<span class="ident" id="6781763"><a href="/net/dial_test.go.html#6770095">runtime</a></span><span class="op" id="6781770">.</span><span class="ident" id="6781771">GOOS</span>&nbsp;<span class="op" id="6781776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6781779">case</span>&nbsp;<span class="string" id="6781784">&#34;nacl&#34;</span><span class="op" id="6781790">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6781794"><a href="/net/dial_test.go.html#6781739">t</a></span><span class="op" id="6781795">.</span><span class="ident" id="6781796">Skipf</span><span class="op" id="6781801">(</span><span class="string" id="6781802">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6781823">,</span>&nbsp;<span class="ident" id="6781825"><a href="/net/dial_test.go.html#6770095">runtime</a></span><span class="op" id="6781832">.</span><span class="ident" id="6781833">GOOS</span><span class="op" id="6781837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6781840">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6781844">if</span>&nbsp;<span class="ident" id="6781847">ips</span><span class="op" id="6781850">,</span>&nbsp;<span class="ident" id="6781852">err</span>&nbsp;<span class="op" id="6781856">:=</span>&nbsp;<span class="ident" id="6781859"><a href="/net/lookup.go.html#2642100">LookupIP</a></span><span class="op" id="6781867">(</span><span class="string" id="6781868">&#34;localhost&#34;</span><span class="op" id="6781879">)</span><span class="op" id="6781880">;</span>&nbsp;<span class="ident" id="6781882"><a href="/net/dial_test.go.html#6781852">err</a></span>&nbsp;<span class="op" id="6781886">!=</span>&nbsp;<span class="ident" id="6781889">nil</span>&nbsp;<span class="op" id="6781893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6781897"><a href="/net/dial_test.go.html#6781739">t</a></span><span class="op" id="6781898">.</span><span class="ident" id="6781899">Fatalf</span><span class="op" id="6781905">(</span><span class="string" id="6781906">&#34;LookupIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6781927">,</span>&nbsp;<span class="ident" id="6781929"><a href="/net/dial_test.go.html#6781852">err</a></span><span class="op" id="6781932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6781935">}</span>&nbsp;<span class="keyword" id="6781937">else</span>&nbsp;<span class="keyword" id="6781942">if</span>&nbsp;<span class="builtinfunc" id="6781945">len</span><span class="op" id="6781948">(</span><span class="ident" id="6781949"><a href="/net/dial_test.go.html#6781847">ips</a></span><span class="op" id="6781952">)</span>&nbsp;<span class="op" id="6781954">&lt;</span>&nbsp;<span class="num" id="6781956">2</span>&nbsp;<span class="op" id="6781958">||</span>&nbsp;<span class="op" id="6781961">!</span><span class="ident" id="6781962"><a href="/net/ipsock.go.html#2627659">supportsIPv4</a></span>&nbsp;<span class="op" id="6781975">||</span>&nbsp;<span class="op" id="6781978">!</span><span class="ident" id="6781979"><a href="/net/ipsock.go.html#2627769">supportsIPv6</a></span>&nbsp;<span class="op" id="6781992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6781996"><a href="/net/dial_test.go.html#6781739">t</a></span><span class="op" id="6781997">.</span><span class="ident" id="6781998">Skip</span><span class="op" id="6782002">(</span><span class="string" id="6782003">&#34;localhost&nbsp;doesn&#39;t&nbsp;have&nbsp;a&nbsp;pair&nbsp;of&nbsp;different&nbsp;address&nbsp;family&nbsp;IP&nbsp;addresses&#34;</span><span class="op" id="6782075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6782078">}</span><br>
<span class="lineno">480</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6782082">touchAndByeServer</span>&nbsp;<span class="op" id="6782100">:=</span>&nbsp;<span class="keyword" id="6782103">func</span><span class="op" id="6782107">(</span><span class="ident" id="6782108">dss</span>&nbsp;<span class="op" id="6782112">*</span><span class="ident" id="6782113"><a href="/net/mockserver_test.go.html#6866861">dualStackServer</a></span><span class="op" id="6782128">,</span>&nbsp;<span class="ident" id="6782130">ln</span>&nbsp;<span class="ident" id="6782133"><a href="/net/net.go.html#2658762">Listener</a></span><span class="op" id="6782141">)</span>&nbsp;<span class="op" id="6782143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6782147">for</span>&nbsp;<span class="op" id="6782151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6782156">if</span>&nbsp;<span class="ident" id="6782159">c</span><span class="op" id="6782160">,</span>&nbsp;<span class="ident" id="6782162">err</span>&nbsp;<span class="op" id="6782166">:=</span>&nbsp;<span class="ident" id="6782169"><a href="/net/dial_test.go.html#6782130">ln</a></span><span class="op" id="6782171">.</span><span class="ident" id="6782172">Accept</span><span class="op" id="6782178">(</span><span class="op" id="6782179">)</span><span class="op" id="6782180">;</span>&nbsp;<span class="ident" id="6782182"><a href="/net/dial_test.go.html#6782162">err</a></span>&nbsp;<span class="op" id="6782186">!=</span>&nbsp;<span class="ident" id="6782189">nil</span>&nbsp;<span class="op" id="6782193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6782199">return</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6782209">}</span>&nbsp;<span class="keyword" id="6782211">else</span>&nbsp;<span class="op" id="6782216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6782222"><a href="/net/dial_test.go.html#6782159">c</a></span><span class="op" id="6782223">.</span><span class="ident" id="6782224">Close</span><span class="op" id="6782229">(</span><span class="op" id="6782230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6782235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6782239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6782242">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6782245">dss</span><span class="op" id="6782248">,</span>&nbsp;<span class="ident" id="6782250">err</span>&nbsp;<span class="op" id="6782254">:=</span>&nbsp;<span class="ident" id="6782257"><a href="/net/mockserver_test.go.html#6867832">newDualStackServer</a></span><span class="op" id="6782275">(</span><span class="op" id="6782276">[</span><span class="op" id="6782277">]</span><span class="ident" id="6782278"><a href="/net/mockserver_test.go.html#6866791">streamListener</a></span><span class="op" id="6782292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6782296">{</span><span class="ident" id="6782297">net</span><span class="op" id="6782300">:</span>&nbsp;<span class="string" id="6782302">&#34;tcp4&#34;</span><span class="op" id="6782308">,</span>&nbsp;<span class="ident" id="6782310">addr</span><span class="op" id="6782314">:</span>&nbsp;<span class="string" id="6782316">&#34;127.0.0.1&#34;</span><span class="op" id="6782327">}</span><span class="op" id="6782328">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6782332">{</span><span class="ident" id="6782333">net</span><span class="op" id="6782336">:</span>&nbsp;<span class="string" id="6782338">&#34;tcp6&#34;</span><span class="op" id="6782344">,</span>&nbsp;<span class="ident" id="6782346">addr</span><span class="op" id="6782350">:</span>&nbsp;<span class="string" id="6782352">&#34;[::1]&#34;</span><span class="op" id="6782359">}</span><span class="op" id="6782360">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6782363">}</span><span class="op" id="6782364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6782367">if</span>&nbsp;<span class="ident" id="6782370"><a href="/net/dial_test.go.html#6782250">err</a></span>&nbsp;<span class="op" id="6782374">!=</span>&nbsp;<span class="ident" id="6782377">nil</span>&nbsp;<span class="op" id="6782381">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6782385"><a href="/net/dial_test.go.html#6781739">t</a></span><span class="op" id="6782386">.</span><span class="ident" id="6782387">Fatalf</span><span class="op" id="6782393">(</span><span class="string" id="6782394">&#34;newDualStackServer&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6782425">,</span>&nbsp;<span class="ident" id="6782427"><a href="/net/dial_test.go.html#6782250">err</a></span><span class="op" id="6782430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6782433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6782436">defer</span>&nbsp;<span class="ident" id="6782442"><a href="/net/dial_test.go.html#6782245">dss</a></span><span class="op" id="6782445">.</span><span class="ident" id="6782446">teardown</span><span class="op" id="6782454">(</span><span class="op" id="6782455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6782458">if</span>&nbsp;<span class="ident" id="6782461">err</span>&nbsp;<span class="op" id="6782465">:=</span>&nbsp;<span class="ident" id="6782468"><a href="/net/dial_test.go.html#6782245">dss</a></span><span class="op" id="6782471">.</span><span class="ident" id="6782472">buildup</span><span class="op" id="6782479">(</span><span class="ident" id="6782480"><a href="/net/dial_test.go.html#6782082">touchAndByeServer</a></span><span class="op" id="6782497">)</span><span class="op" id="6782498">;</span>&nbsp;<span class="ident" id="6782500"><a href="/net/dial_test.go.html#6782461">err</a></span>&nbsp;<span class="op" id="6782504">!=</span>&nbsp;<span class="ident" id="6782507">nil</span>&nbsp;<span class="op" id="6782511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6782515"><a href="/net/dial_test.go.html#6781739">t</a></span><span class="op" id="6782516">.</span><span class="ident" id="6782517">Fatalf</span><span class="op" id="6782523">(</span><span class="string" id="6782524">&#34;dualStackServer.buildup&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6782560">,</span>&nbsp;<span class="ident" id="6782562"><a href="/net/dial_test.go.html#6782461">err</a></span><span class="op" id="6782565">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6782568">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6782572">d</span>&nbsp;<span class="op" id="6782574">:=</span>&nbsp;<span class="op" id="6782577">&amp;</span><span class="ident" id="6782578"><a href="/net/dial.go.html#2517815">Dialer</a></span><span class="op" id="6782584">{</span><span class="ident" id="6782585">DualStack</span><span class="op" id="6782594">:</span>&nbsp;<span class="ident" id="6782596">true</span><span class="op" id="6782600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6782603">for</span>&nbsp;<span class="keyword" id="6782607">range</span>&nbsp;<span class="ident" id="6782613"><a href="/net/dial_test.go.html#6782245">dss</a></span><span class="op" id="6782616">.</span><span class="ident" id="6782617">lns</span>&nbsp;<span class="op" id="6782621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6782625">if</span>&nbsp;<span class="ident" id="6782628">c</span><span class="op" id="6782629">,</span>&nbsp;<span class="ident" id="6782631">err</span>&nbsp;<span class="op" id="6782635">:=</span>&nbsp;<span class="ident" id="6782638"><a href="/net/dial_test.go.html#6782572">d</a></span><span class="op" id="6782639">.</span><span class="ident" id="6782640">Dial</span><span class="op" id="6782644">(</span><span class="string" id="6782645">&#34;tcp&#34;</span><span class="op" id="6782650">,</span>&nbsp;<span class="string" id="6782652">&#34;localhost:&#34;</span><span class="op" id="6782664">+</span><span class="ident" id="6782665"><a href="/net/dial_test.go.html#6782245">dss</a></span><span class="op" id="6782668">.</span><span class="ident" id="6782669">port</span><span class="op" id="6782673">)</span><span class="op" id="6782674">;</span>&nbsp;<span class="ident" id="6782676"><a href="/net/dial_test.go.html#6782631">err</a></span>&nbsp;<span class="op" id="6782680">!=</span>&nbsp;<span class="ident" id="6782683">nil</span>&nbsp;<span class="op" id="6782687">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6782692"><a href="/net/dial_test.go.html#6781739">t</a></span><span class="op" id="6782693">.</span><span class="ident" id="6782694">Errorf</span><span class="op" id="6782700">(</span><span class="string" id="6782701">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6782718">,</span>&nbsp;<span class="ident" id="6782720"><a href="/net/dial_test.go.html#6782631">err</a></span><span class="op" id="6782723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6782727">}</span>&nbsp;<span class="keyword" id="6782729">else</span>&nbsp;<span class="op" id="6782734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6782739">if</span>&nbsp;<span class="ident" id="6782742">addr</span>&nbsp;<span class="op" id="6782747">:=</span>&nbsp;<span class="ident" id="6782750"><a href="/net/dial_test.go.html#6782628">c</a></span><span class="op" id="6782751">.</span><span class="ident" id="6782752">LocalAddr</span><span class="op" id="6782761">(</span><span class="op" id="6782762">)</span><span class="op" id="6782763">.</span><span class="op" id="6782764">(</span><span class="op" id="6782765">*</span><span class="ident" id="6782766"><a href="/net/tcpsock.go.html#2691528">TCPAddr</a></span><span class="op" id="6782773">)</span><span class="op" id="6782774">;</span>&nbsp;<span class="ident" id="6782776"><a href="/net/dial_test.go.html#6782742">addr</a></span><span class="op" id="6782780">.</span><span class="ident" id="6782781">IP</span><span class="op" id="6782783">.</span><span class="ident" id="6782784">To4</span><span class="op" id="6782787">(</span><span class="op" id="6782788">)</span>&nbsp;<span class="op" id="6782790">!=</span>&nbsp;<span class="ident" id="6782793">nil</span>&nbsp;<span class="op" id="6782797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6782803"><a href="/net/dial_test.go.html#6782245">dss</a></span><span class="op" id="6782806">.</span><span class="ident" id="6782807">teardownNetwork</span><span class="op" id="6782822">(</span><span class="string" id="6782823">&#34;tcp4&#34;</span><span class="op" id="6782829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6782834">}</span>&nbsp;<span class="keyword" id="6782836">else</span>&nbsp;<span class="keyword" id="6782841">if</span>&nbsp;<span class="ident" id="6782844"><a href="/net/dial_test.go.html#6782742">addr</a></span><span class="op" id="6782848">.</span><span class="ident" id="6782849">IP</span><span class="op" id="6782851">.</span><span class="ident" id="6782852">To16</span><span class="op" id="6782856">(</span><span class="op" id="6782857">)</span>&nbsp;<span class="op" id="6782859">!=</span>&nbsp;<span class="ident" id="6782862">nil</span>&nbsp;<span class="op" id="6782866">&amp;&amp;</span>&nbsp;<span class="ident" id="6782869"><a href="/net/dial_test.go.html#6782742">addr</a></span><span class="op" id="6782873">.</span><span class="ident" id="6782874">IP</span><span class="op" id="6782876">.</span><span class="ident" id="6782877">To4</span><span class="op" id="6782880">(</span><span class="op" id="6782881">)</span>&nbsp;<span class="op" id="6782883">==</span>&nbsp;<span class="ident" id="6782886">nil</span>&nbsp;<span class="op" id="6782890">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6782896"><a href="/net/dial_test.go.html#6782245">dss</a></span><span class="op" id="6782899">.</span><span class="ident" id="6782900">teardownNetwork</span><span class="op" id="6782915">(</span><span class="string" id="6782916">&#34;tcp6&#34;</span><span class="op" id="6782922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6782927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6782932"><a href="/net/dial_test.go.html#6782628">c</a></span><span class="op" id="6782933">.</span><span class="ident" id="6782934">Close</span><span class="op" id="6782939">(</span><span class="op" id="6782940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6782944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6782947">}</span><br>
<span class="lineno">515</span><span class="op" id="6782949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6782952">func</span>&nbsp;<span class="ident" id="6782957">TestDialerKeepAlive</span><span class="op" id="6782976">(</span><span class="ident" id="6782977">t</span>&nbsp;<span class="op" id="6782979">*</span><span class="ident" id="6782980"><a href="/net/dial_test.go.html#6770125">testing</a></span><span class="op" id="6782987">.</span><span class="ident" id="6782988">T</span><span class="op" id="6782989">)</span>&nbsp;<span class="op" id="6782991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6782994">ln</span>&nbsp;<span class="op" id="6782997">:=</span>&nbsp;<span class="ident" id="6783000"><a href="/net/dial_test.go.html#6770151">newLocalListener</a></span><span class="op" id="6783016">(</span><span class="ident" id="6783017"><a href="/net/dial_test.go.html#6782977">t</a></span><span class="op" id="6783018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6783021">defer</span>&nbsp;<span class="ident" id="6783027"><a href="/net/dial_test.go.html#6782994">ln</a></span><span class="op" id="6783029">.</span><span class="ident" id="6783030">Close</span><span class="op" id="6783035">(</span><span class="op" id="6783036">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6783039">defer</span>&nbsp;<span class="keyword" id="6783045">func</span><span class="op" id="6783049">(</span><span class="op" id="6783050">)</span>&nbsp;<span class="op" id="6783052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6783056"><a href="/net/dial.go.html#2522790">testHookSetKeepAlive</a></span>&nbsp;<span class="op" id="6783077">=</span>&nbsp;<span class="keyword" id="6783079">func</span><span class="op" id="6783083">(</span><span class="op" id="6783084">)</span>&nbsp;<span class="op" id="6783086">{</span><span class="op" id="6783087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6783090">}</span><span class="op" id="6783091">(</span><span class="op" id="6783092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6783095">go</span>&nbsp;<span class="keyword" id="6783098">func</span><span class="op" id="6783102">(</span><span class="op" id="6783103">)</span>&nbsp;<span class="op" id="6783105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6783109">for</span>&nbsp;<span class="op" id="6783113">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6783118">c</span><span class="op" id="6783119">,</span>&nbsp;<span class="ident" id="6783121">err</span>&nbsp;<span class="op" id="6783125">:=</span>&nbsp;<span class="ident" id="6783128"><a href="/net/dial_test.go.html#6782994">ln</a></span><span class="op" id="6783130">.</span><span class="ident" id="6783131">Accept</span><span class="op" id="6783137">(</span><span class="op" id="6783138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6783143">if</span>&nbsp;<span class="ident" id="6783146"><a href="/net/dial_test.go.html#6783121">err</a></span>&nbsp;<span class="op" id="6783150">!=</span>&nbsp;<span class="ident" id="6783153">nil</span>&nbsp;<span class="op" id="6783157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6783163">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6783173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6783178"><a href="/net/dial_test.go.html#6783118">c</a></span><span class="op" id="6783179">.</span><span class="ident" id="6783180">Close</span><span class="op" id="6783185">(</span><span class="op" id="6783186">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6783190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6783193">}</span><span class="op" id="6783194">(</span><span class="op" id="6783195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6783198">for</span>&nbsp;<span class="ident" id="6783202">_</span><span class="op" id="6783203">,</span>&nbsp;<span class="ident" id="6783205">keepAlive</span>&nbsp;<span class="op" id="6783215">:=</span>&nbsp;<span class="keyword" id="6783218">range</span>&nbsp;<span class="op" id="6783224">[</span><span class="op" id="6783225">]</span><span class="builtintype" id="6783226">bool</span><span class="op" id="6783230">{</span><span class="ident" id="6783231">false</span><span class="op" id="6783236">,</span>&nbsp;<span class="ident" id="6783238">true</span><span class="op" id="6783242">}</span>&nbsp;<span class="op" id="6783244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6783248">got</span>&nbsp;<span class="op" id="6783252">:=</span>&nbsp;<span class="ident" id="6783255">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6783263"><a href="/net/dial.go.html#2522790">testHookSetKeepAlive</a></span>&nbsp;<span class="op" id="6783284">=</span>&nbsp;<span class="keyword" id="6783286">func</span><span class="op" id="6783290">(</span><span class="op" id="6783291">)</span>&nbsp;<span class="op" id="6783293">{</span>&nbsp;<span class="ident" id="6783295"><a href="/net/dial_test.go.html#6783248">got</a></span>&nbsp;<span class="op" id="6783299">=</span>&nbsp;<span class="ident" id="6783301">true</span>&nbsp;<span class="op" id="6783306">}</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6783310">var</span>&nbsp;<span class="ident" id="6783314">d</span>&nbsp;<span class="ident" id="6783316"><a href="/net/dial.go.html#2517815">Dialer</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6783325">if</span>&nbsp;<span class="ident" id="6783328"><a href="/net/dial_test.go.html#6783205">keepAlive</a></span>&nbsp;<span class="op" id="6783338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6783343"><a href="/net/dial_test.go.html#6783314">d</a></span><span class="op" id="6783344">.</span><span class="ident" id="6783345">KeepAlive</span>&nbsp;<span class="op" id="6783355">=</span>&nbsp;<span class="num" id="6783357">30</span>&nbsp;<span class="op" id="6783360">*</span>&nbsp;<span class="ident" id="6783362"><a href="/net/dial_test.go.html#6770136">time</a></span><span class="op" id="6783366">.</span><span class="ident" id="6783367">Second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6783376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6783380">c</span><span class="op" id="6783381">,</span>&nbsp;<span class="ident" id="6783383">err</span>&nbsp;<span class="op" id="6783387">:=</span>&nbsp;<span class="ident" id="6783390"><a href="/net/dial_test.go.html#6783314">d</a></span><span class="op" id="6783391">.</span><span class="ident" id="6783392">Dial</span><span class="op" id="6783396">(</span><span class="string" id="6783397">&#34;tcp&#34;</span><span class="op" id="6783402">,</span>&nbsp;<span class="ident" id="6783404"><a href="/net/dial_test.go.html#6782994">ln</a></span><span class="op" id="6783406">.</span><span class="ident" id="6783407">Addr</span><span class="op" id="6783411">(</span><span class="op" id="6783412">)</span><span class="op" id="6783413">.</span><span class="ident" id="6783414">String</span><span class="op" id="6783420">(</span><span class="op" id="6783421">)</span><span class="op" id="6783422">)</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6783426">if</span>&nbsp;<span class="ident" id="6783429"><a href="/net/dial_test.go.html#6783383">err</a></span>&nbsp;<span class="op" id="6783433">!=</span>&nbsp;<span class="ident" id="6783436">nil</span>&nbsp;<span class="op" id="6783440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6783445"><a href="/net/dial_test.go.html#6782977">t</a></span><span class="op" id="6783446">.</span><span class="ident" id="6783447">Fatal</span><span class="op" id="6783452">(</span><span class="ident" id="6783453"><a href="/net/dial_test.go.html#6783383">err</a></span><span class="op" id="6783456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6783460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6783464"><a href="/net/dial_test.go.html#6783380">c</a></span><span class="op" id="6783465">.</span><span class="ident" id="6783466">Close</span><span class="op" id="6783471">(</span><span class="op" id="6783472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6783476">if</span>&nbsp;<span class="ident" id="6783479"><a href="/net/dial_test.go.html#6783248">got</a></span>&nbsp;<span class="op" id="6783483">!=</span>&nbsp;<span class="ident" id="6783486"><a href="/net/dial_test.go.html#6783205">keepAlive</a></span>&nbsp;<span class="op" id="6783496">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6783501"><a href="/net/dial_test.go.html#6782977">t</a></span><span class="op" id="6783502">.</span><span class="ident" id="6783503">Errorf</span><span class="op" id="6783509">(</span><span class="string" id="6783510">&#34;Dialer.KeepAlive&nbsp;=&nbsp;%v:&nbsp;SetKeepAlive&nbsp;called&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6783568">,</span>&nbsp;<span class="ident" id="6783570"><a href="/net/dial_test.go.html#6783314">d</a></span><span class="op" id="6783571">.</span><span class="ident" id="6783572">KeepAlive</span><span class="op" id="6783581">,</span>&nbsp;<span class="ident" id="6783583"><a href="/net/dial_test.go.html#6783248">got</a></span><span class="op" id="6783586">,</span>&nbsp;<span class="op" id="6783588">!</span><span class="ident" id="6783589"><a href="/net/dial_test.go.html#6783248">got</a></span><span class="op" id="6783592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6783596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6783599">}</span><br>
<span class="lineno"></span><span class="op" id="6783601">}</span>
</div>
</body>
</html>
