<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/gob</h2>
<ul>
<li><a href="/gostd/encoding/gob/codec_test.go.html">codec_test.go</a></li>
<li><a href="/gostd/encoding/gob/dec_helpers.go.html">dec_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/gob/decoder.go.html">decoder.go</a></li>
<li><a href="/gostd/encoding/gob/doc.go.html">doc.go</a></li>
<li><a href="/gostd/encoding/gob/enc_helpers.go.html">enc_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/gob/encoder.go.html">encoder.go</a></li>
<li><a href="/gostd/encoding/gob/encoder_test.go.html">encoder_test.go</a></li>
<li><a href="/gostd/encoding/gob/error.go.html">error.go</a></li>
<li><a href="/gostd/encoding/gob/example_encdec_test.go.html">example_encdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_interface_test.go.html">example_interface_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/gob/gobencdec_test.go.html">gobencdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/timing_test.go.html">timing_test.go</a></li>
<li><a href="/gostd/encoding/gob/type.go.html">type.go</a></li>
<li><a href="/gostd/encoding/gob/type_test.go.html">type_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4938917">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4938972">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4939026">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4939077">//go:generate&nbsp;go&nbsp;run&nbsp;decgen.go&nbsp;-output&nbsp;dec_helpers.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4939132">package</span>&nbsp;<span class="ident" id="4939140">gob</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4939145">import</span>&nbsp;<span class="op" id="4939152">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4939155">&#34;encoding&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4939167">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4939177">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4939183">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4939191">&#34;reflect&#34;</span><br>
<span class="lineno">15</span><span class="op" id="4939201">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4939204">var</span>&nbsp;<span class="op" id="4939208">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4939211">errBadUint</span>&nbsp;<span class="op" id="4939222">=</span>&nbsp;<span class="ident" id="4939224">errors</span><span class="op" id="4939230">.</span><span class="ident" id="4939231">New</span><span class="op" id="4939234">(</span><span class="string" id="4939235">&#34;gob:&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="4939279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4939282">errBadType</span>&nbsp;<span class="op" id="4939293">=</span>&nbsp;<span class="ident" id="4939295">errors</span><span class="op" id="4939301">.</span><span class="ident" id="4939302">New</span><span class="op" id="4939305">(</span><span class="string" id="4939306">&#34;gob:&nbsp;unknown&nbsp;type&nbsp;id&nbsp;or&nbsp;corrupted&nbsp;data&#34;</span><span class="op" id="4939346">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4939349">errRange</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4939360">=</span>&nbsp;<span class="ident" id="4939362">errors</span><span class="op" id="4939368">.</span><span class="ident" id="4939369">New</span><span class="op" id="4939372">(</span><span class="string" id="4939373">&#34;gob:&nbsp;bad&nbsp;data:&nbsp;field&nbsp;numbers&nbsp;out&nbsp;of&nbsp;bounds&#34;</span><span class="op" id="4939417">)</span><br>
<span class="lineno"></span><span class="op" id="4939419">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4939422">type</span>&nbsp;<span class="ident" id="4939427">decHelper</span>&nbsp;<span class="keyword" id="4939437">func</span><span class="op" id="4939441">(</span><span class="ident" id="4939442">state</span>&nbsp;<span class="op" id="4939448">*</span><span class="ident" id="4939449">decoderState</span><span class="op" id="4939461">,</span>&nbsp;<span class="ident" id="4939463">v</span>&nbsp;<span class="ident" id="4939465">reflect</span><span class="op" id="4939472">.</span><span class="ident" id="4939473">Value</span><span class="op" id="4939478">,</span>&nbsp;<span class="ident" id="4939480">length</span>&nbsp;<span class="builtintype" id="4939487">int</span><span class="op" id="4939490">,</span>&nbsp;<span class="ident" id="4939492">ovfl</span>&nbsp;<span class="builtintype" id="4939497">error</span><span class="op" id="4939502">)</span>&nbsp;<span class="builtintype" id="4939504">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="4939510">//&nbsp;decoderState&nbsp;is&nbsp;the&nbsp;execution&nbsp;state&nbsp;of&nbsp;an&nbsp;instance&nbsp;of&nbsp;the&nbsp;decoder.&nbsp;A&nbsp;new&nbsp;state</span><br>
<span class="lineno"></span><span class="comment" id="4939592">//&nbsp;is&nbsp;created&nbsp;for&nbsp;nested&nbsp;objects.</span><br>
<span class="lineno"></span><span class="keyword" id="4939626">type</span>&nbsp;<span class="ident" id="4939631">decoderState</span>&nbsp;<span class="keyword" id="4939644">struct</span>&nbsp;<span class="op" id="4939651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4939654">dec</span>&nbsp;<span class="op" id="4939658">*</span><span class="ident" id="4939659">Decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4939668">//&nbsp;The&nbsp;buffer&nbsp;is&nbsp;stored&nbsp;with&nbsp;an&nbsp;extra&nbsp;indirection&nbsp;because&nbsp;it&nbsp;may&nbsp;be&nbsp;replaced</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4939746">//&nbsp;if&nbsp;we&nbsp;load&nbsp;a&nbsp;type&nbsp;during&nbsp;decode&nbsp;(when&nbsp;reading&nbsp;an&nbsp;interface&nbsp;value).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4939817">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4939826">*</span><span class="ident" id="4939827">decBuffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4939838">fieldnum</span>&nbsp;<span class="builtintype" id="4939847">int</span>&nbsp;<span class="comment" id="4939851">//&nbsp;the&nbsp;last&nbsp;field&nbsp;number&nbsp;read.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4939883">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4939892">[</span><span class="op" id="4939893">]</span><span class="builtintype" id="4939894">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4939900">next</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4939909">*</span><span class="ident" id="4939910">decoderState</span>&nbsp;<span class="comment" id="4939923">//&nbsp;for&nbsp;free&nbsp;list</span><br>
<span class="lineno">35</span><span class="op" id="4939940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4939943">//&nbsp;decBuffer&nbsp;is&nbsp;an&nbsp;extremely&nbsp;simple,&nbsp;fast&nbsp;implementation&nbsp;of&nbsp;a&nbsp;read-only&nbsp;byte&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="4940028">//&nbsp;It&nbsp;is&nbsp;initialized&nbsp;by&nbsp;calling&nbsp;Size&nbsp;and&nbsp;then&nbsp;copying&nbsp;the&nbsp;data&nbsp;into&nbsp;the&nbsp;slice&nbsp;returned&nbsp;by&nbsp;Bytes().</span><br>
<span class="lineno"></span><span class="keyword" id="4940127">type</span>&nbsp;<span class="ident" id="4940132">decBuffer</span>&nbsp;<span class="keyword" id="4940142">struct</span>&nbsp;<span class="op" id="4940149">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4940152">data</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4940159">[</span><span class="op" id="4940160">]</span><span class="builtintype" id="4940161">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4940167">offset</span>&nbsp;<span class="builtintype" id="4940174">int</span>&nbsp;<span class="comment" id="4940178">//&nbsp;Read&nbsp;offset.</span><br>
<span class="lineno"></span><span class="op" id="4940194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4940197">func</span>&nbsp;<span class="op" id="4940202">(</span><span class="ident" id="4940203">d</span>&nbsp;<span class="op" id="4940205">*</span><span class="ident" id="4940206">decBuffer</span><span class="op" id="4940215">)</span>&nbsp;<span class="ident" id="4940217">Read</span><span class="op" id="4940221">(</span><span class="ident" id="4940222">p</span>&nbsp;<span class="op" id="4940224">[</span><span class="op" id="4940225">]</span><span class="builtintype" id="4940226">byte</span><span class="op" id="4940230">)</span>&nbsp;<span class="op" id="4940232">(</span><span class="builtintype" id="4940233">int</span><span class="op" id="4940236">,</span>&nbsp;<span class="builtintype" id="4940238">error</span><span class="op" id="4940243">)</span>&nbsp;<span class="op" id="4940245">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4940248">n</span>&nbsp;<span class="op" id="4940250">:=</span>&nbsp;<span class="builtinfunc" id="4940253">copy</span><span class="op" id="4940257">(</span><span class="ident" id="4940258">p</span><span class="op" id="4940259">,</span>&nbsp;<span class="ident" id="4940261">d</span><span class="op" id="4940262">.</span><span class="ident" id="4940263">data</span><span class="op" id="4940267">[</span><span class="ident" id="4940268">d</span><span class="op" id="4940269">.</span><span class="ident" id="4940270">offset</span><span class="op" id="4940276">:</span><span class="op" id="4940277">]</span><span class="op" id="4940278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4940281">if</span>&nbsp;<span class="ident" id="4940284">n</span>&nbsp;<span class="op" id="4940286">==</span>&nbsp;<span class="num" id="4940289">0</span>&nbsp;<span class="op" id="4940291">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4940294">len</span><span class="op" id="4940297">(</span><span class="ident" id="4940298">p</span><span class="op" id="4940299">)</span>&nbsp;<span class="op" id="4940301">!=</span>&nbsp;<span class="num" id="4940304">0</span>&nbsp;<span class="op" id="4940306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4940310">return</span>&nbsp;<span class="num" id="4940317">0</span><span class="op" id="4940318">,</span>&nbsp;<span class="ident" id="4940320">io</span><span class="op" id="4940322">.</span><span class="ident" id="4940323">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4940328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4940331">d</span><span class="op" id="4940332">.</span><span class="ident" id="4940333">offset</span>&nbsp;<span class="op" id="4940340">+=</span>&nbsp;<span class="ident" id="4940343">n</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4940346">return</span>&nbsp;<span class="ident" id="4940353">n</span><span class="op" id="4940354">,</span>&nbsp;<span class="ident" id="4940356">nil</span><br>
<span class="lineno"></span><span class="op" id="4940360">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4940363">func</span>&nbsp;<span class="op" id="4940368">(</span><span class="ident" id="4940369">d</span>&nbsp;<span class="op" id="4940371">*</span><span class="ident" id="4940372">decBuffer</span><span class="op" id="4940381">)</span>&nbsp;<span class="ident" id="4940383">Drop</span><span class="op" id="4940387">(</span><span class="ident" id="4940388">n</span>&nbsp;<span class="builtintype" id="4940390">int</span><span class="op" id="4940393">)</span>&nbsp;<span class="op" id="4940395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4940398">if</span>&nbsp;<span class="ident" id="4940401">n</span>&nbsp;<span class="op" id="4940403">&gt;</span>&nbsp;<span class="ident" id="4940405">d</span><span class="op" id="4940406">.</span><span class="ident" id="4940407">Len</span><span class="op" id="4940410">(</span><span class="op" id="4940411">)</span>&nbsp;<span class="op" id="4940413">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4940417">panic</span><span class="op" id="4940422">(</span><span class="string" id="4940423">&#34;drop&#34;</span><span class="op" id="4940429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4940432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4940435">d</span><span class="op" id="4940436">.</span><span class="ident" id="4940437">offset</span>&nbsp;<span class="op" id="4940444">+=</span>&nbsp;<span class="ident" id="4940447">n</span><br>
<span class="lineno"></span><span class="op" id="4940449">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="4940452">//&nbsp;Size&nbsp;grows&nbsp;the&nbsp;buffer&nbsp;to&nbsp;exactly&nbsp;n&nbsp;bytes,&nbsp;so&nbsp;d.Bytes()&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="4940515">//&nbsp;return&nbsp;a&nbsp;slice&nbsp;of&nbsp;length&nbsp;n.&nbsp;Existing&nbsp;data&nbsp;is&nbsp;first&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="keyword" id="4940580">func</span>&nbsp;<span class="op" id="4940585">(</span><span class="ident" id="4940586">d</span>&nbsp;<span class="op" id="4940588">*</span><span class="ident" id="4940589">decBuffer</span><span class="op" id="4940598">)</span>&nbsp;<span class="ident" id="4940600">Size</span><span class="op" id="4940604">(</span><span class="ident" id="4940605">n</span>&nbsp;<span class="builtintype" id="4940607">int</span><span class="op" id="4940610">)</span>&nbsp;<span class="op" id="4940612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4940615">d</span><span class="op" id="4940616">.</span><span class="ident" id="4940617">Reset</span><span class="op" id="4940622">(</span><span class="op" id="4940623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4940626">if</span>&nbsp;<span class="builtinfunc" id="4940629">cap</span><span class="op" id="4940632">(</span><span class="ident" id="4940633">d</span><span class="op" id="4940634">.</span><span class="ident" id="4940635">data</span><span class="op" id="4940639">)</span>&nbsp;<span class="op" id="4940641">&lt;</span>&nbsp;<span class="ident" id="4940643">n</span>&nbsp;<span class="op" id="4940645">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4940649">d</span><span class="op" id="4940650">.</span><span class="ident" id="4940651">data</span>&nbsp;<span class="op" id="4940656">=</span>&nbsp;<span class="builtinfunc" id="4940658">make</span><span class="op" id="4940662">(</span><span class="op" id="4940663">[</span><span class="op" id="4940664">]</span><span class="builtintype" id="4940665">byte</span><span class="op" id="4940669">,</span>&nbsp;<span class="ident" id="4940671">n</span><span class="op" id="4940672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4940675">}</span>&nbsp;<span class="keyword" id="4940677">else</span>&nbsp;<span class="op" id="4940682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4940686">d</span><span class="op" id="4940687">.</span><span class="ident" id="4940688">data</span>&nbsp;<span class="op" id="4940693">=</span>&nbsp;<span class="ident" id="4940695">d</span><span class="op" id="4940696">.</span><span class="ident" id="4940697">data</span><span class="op" id="4940701">[</span><span class="num" id="4940702">0</span><span class="op" id="4940703">:</span><span class="ident" id="4940704">n</span><span class="op" id="4940705">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4940708">}</span><br>
<span class="lineno"></span><span class="op" id="4940710">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="4940713">func</span>&nbsp;<span class="op" id="4940718">(</span><span class="ident" id="4940719">d</span>&nbsp;<span class="op" id="4940721">*</span><span class="ident" id="4940722">decBuffer</span><span class="op" id="4940731">)</span>&nbsp;<span class="ident" id="4940733">ReadByte</span><span class="op" id="4940741">(</span><span class="op" id="4940742">)</span>&nbsp;<span class="op" id="4940744">(</span><span class="builtintype" id="4940745">byte</span><span class="op" id="4940749">,</span>&nbsp;<span class="builtintype" id="4940751">error</span><span class="op" id="4940756">)</span>&nbsp;<span class="op" id="4940758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4940761">if</span>&nbsp;<span class="ident" id="4940764">d</span><span class="op" id="4940765">.</span><span class="ident" id="4940766">offset</span>&nbsp;<span class="op" id="4940773">&gt;=</span>&nbsp;<span class="builtinfunc" id="4940776">len</span><span class="op" id="4940779">(</span><span class="ident" id="4940780">d</span><span class="op" id="4940781">.</span><span class="ident" id="4940782">data</span><span class="op" id="4940786">)</span>&nbsp;<span class="op" id="4940788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4940792">return</span>&nbsp;<span class="num" id="4940799">0</span><span class="op" id="4940800">,</span>&nbsp;<span class="ident" id="4940802">io</span><span class="op" id="4940804">.</span><span class="ident" id="4940805">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4940810">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4940813">c</span>&nbsp;<span class="op" id="4940815">:=</span>&nbsp;<span class="ident" id="4940818">d</span><span class="op" id="4940819">.</span><span class="ident" id="4940820">data</span><span class="op" id="4940824">[</span><span class="ident" id="4940825">d</span><span class="op" id="4940826">.</span><span class="ident" id="4940827">offset</span><span class="op" id="4940833">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4940836">d</span><span class="op" id="4940837">.</span><span class="ident" id="4940838">offset</span><span class="op" id="4940844">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4940848">return</span>&nbsp;<span class="ident" id="4940855">c</span><span class="op" id="4940856">,</span>&nbsp;<span class="ident" id="4940858">nil</span><br>
<span class="lineno"></span><span class="op" id="4940862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="4940865">func</span>&nbsp;<span class="op" id="4940870">(</span><span class="ident" id="4940871">d</span>&nbsp;<span class="op" id="4940873">*</span><span class="ident" id="4940874">decBuffer</span><span class="op" id="4940883">)</span>&nbsp;<span class="ident" id="4940885">Len</span><span class="op" id="4940888">(</span><span class="op" id="4940889">)</span>&nbsp;<span class="builtintype" id="4940891">int</span>&nbsp;<span class="op" id="4940895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4940898">return</span>&nbsp;<span class="builtinfunc" id="4940905">len</span><span class="op" id="4940908">(</span><span class="ident" id="4940909">d</span><span class="op" id="4940910">.</span><span class="ident" id="4940911">data</span><span class="op" id="4940915">)</span>&nbsp;<span class="op" id="4940917">-</span>&nbsp;<span class="ident" id="4940919">d</span><span class="op" id="4940920">.</span><span class="ident" id="4940921">offset</span><br>
<span class="lineno"></span><span class="op" id="4940928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4940931">func</span>&nbsp;<span class="op" id="4940936">(</span><span class="ident" id="4940937">d</span>&nbsp;<span class="op" id="4940939">*</span><span class="ident" id="4940940">decBuffer</span><span class="op" id="4940949">)</span>&nbsp;<span class="ident" id="4940951">Bytes</span><span class="op" id="4940956">(</span><span class="op" id="4940957">)</span>&nbsp;<span class="op" id="4940959">[</span><span class="op" id="4940960">]</span><span class="builtintype" id="4940961">byte</span>&nbsp;<span class="op" id="4940966">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4940969">return</span>&nbsp;<span class="ident" id="4940976">d</span><span class="op" id="4940977">.</span><span class="ident" id="4940978">data</span><span class="op" id="4940982">[</span><span class="ident" id="4940983">d</span><span class="op" id="4940984">.</span><span class="ident" id="4940985">offset</span><span class="op" id="4940991">:</span><span class="op" id="4940992">]</span><br>
<span class="lineno"></span><span class="op" id="4940994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4940997">func</span>&nbsp;<span class="op" id="4941002">(</span><span class="ident" id="4941003">d</span>&nbsp;<span class="op" id="4941005">*</span><span class="ident" id="4941006">decBuffer</span><span class="op" id="4941015">)</span>&nbsp;<span class="ident" id="4941017">Reset</span><span class="op" id="4941022">(</span><span class="op" id="4941023">)</span>&nbsp;<span class="op" id="4941025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4941028">d</span><span class="op" id="4941029">.</span><span class="ident" id="4941030">data</span>&nbsp;<span class="op" id="4941035">=</span>&nbsp;<span class="ident" id="4941037">d</span><span class="op" id="4941038">.</span><span class="ident" id="4941039">data</span><span class="op" id="4941043">[</span><span class="num" id="4941044">0</span><span class="op" id="4941045">:</span><span class="num" id="4941046">0</span><span class="op" id="4941047">]</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4941050">d</span><span class="op" id="4941051">.</span><span class="ident" id="4941052">offset</span>&nbsp;<span class="op" id="4941059">=</span>&nbsp;<span class="num" id="4941061">0</span><br>
<span class="lineno"></span><span class="op" id="4941063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4941066">//&nbsp;We&nbsp;pass&nbsp;the&nbsp;bytes.Buffer&nbsp;separately&nbsp;for&nbsp;easier&nbsp;testing&nbsp;of&nbsp;the&nbsp;infrastructure</span><br>
<span class="lineno"></span><span class="comment" id="4941146">//&nbsp;without&nbsp;requiring&nbsp;a&nbsp;full&nbsp;Decoder.</span><br>
<span class="lineno">95</span><span class="keyword" id="4941183">func</span>&nbsp;<span class="op" id="4941188">(</span><span class="ident" id="4941189">dec</span>&nbsp;<span class="op" id="4941193">*</span><span class="ident" id="4941194">Decoder</span><span class="op" id="4941201">)</span>&nbsp;<span class="ident" id="4941203">newDecoderState</span><span class="op" id="4941218">(</span><span class="ident" id="4941219">buf</span>&nbsp;<span class="op" id="4941223">*</span><span class="ident" id="4941224">decBuffer</span><span class="op" id="4941233">)</span>&nbsp;<span class="op" id="4941235">*</span><span class="ident" id="4941236">decoderState</span>&nbsp;<span class="op" id="4941249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4941252">d</span>&nbsp;<span class="op" id="4941254">:=</span>&nbsp;<span class="ident" id="4941257">dec</span><span class="op" id="4941260">.</span><span class="ident" id="4941261">freeList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4941271">if</span>&nbsp;<span class="ident" id="4941274">d</span>&nbsp;<span class="op" id="4941276">==</span>&nbsp;<span class="ident" id="4941279">nil</span>&nbsp;<span class="op" id="4941283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4941287">d</span>&nbsp;<span class="op" id="4941289">=</span>&nbsp;<span class="builtinfunc" id="4941291">new</span><span class="op" id="4941294">(</span><span class="ident" id="4941295">decoderState</span><span class="op" id="4941307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4941311">d</span><span class="op" id="4941312">.</span><span class="ident" id="4941313">dec</span>&nbsp;<span class="op" id="4941317">=</span>&nbsp;<span class="ident" id="4941319">dec</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4941325">d</span><span class="op" id="4941326">.</span><span class="ident" id="4941327">buf</span>&nbsp;<span class="op" id="4941331">=</span>&nbsp;<span class="builtinfunc" id="4941333">make</span><span class="op" id="4941337">(</span><span class="op" id="4941338">[</span><span class="op" id="4941339">]</span><span class="builtintype" id="4941340">byte</span><span class="op" id="4941344">,</span>&nbsp;<span class="ident" id="4941346">uint64Size</span><span class="op" id="4941356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4941359">}</span>&nbsp;<span class="keyword" id="4941361">else</span>&nbsp;<span class="op" id="4941366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4941370">dec</span><span class="op" id="4941373">.</span><span class="ident" id="4941374">freeList</span>&nbsp;<span class="op" id="4941383">=</span>&nbsp;<span class="ident" id="4941385">d</span><span class="op" id="4941386">.</span><span class="ident" id="4941387">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4941393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4941396">d</span><span class="op" id="4941397">.</span><span class="ident" id="4941398">b</span>&nbsp;<span class="op" id="4941400">=</span>&nbsp;<span class="ident" id="4941402">buf</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4941407">return</span>&nbsp;<span class="ident" id="4941414">d</span><br>
<span class="lineno"></span><span class="op" id="4941416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4941419">func</span>&nbsp;<span class="op" id="4941424">(</span><span class="ident" id="4941425">dec</span>&nbsp;<span class="op" id="4941429">*</span><span class="ident" id="4941430">Decoder</span><span class="op" id="4941437">)</span>&nbsp;<span class="ident" id="4941439">freeDecoderState</span><span class="op" id="4941455">(</span><span class="ident" id="4941456">d</span>&nbsp;<span class="op" id="4941458">*</span><span class="ident" id="4941459">decoderState</span><span class="op" id="4941471">)</span>&nbsp;<span class="op" id="4941473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4941476">d</span><span class="op" id="4941477">.</span><span class="ident" id="4941478">next</span>&nbsp;<span class="op" id="4941483">=</span>&nbsp;<span class="ident" id="4941485">dec</span><span class="op" id="4941488">.</span><span class="ident" id="4941489">freeList</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4941499">dec</span><span class="op" id="4941502">.</span><span class="ident" id="4941503">freeList</span>&nbsp;<span class="op" id="4941512">=</span>&nbsp;<span class="ident" id="4941514">d</span><br>
<span class="lineno"></span><span class="op" id="4941516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4941519">func</span>&nbsp;<span class="ident" id="4941524">overflow</span><span class="op" id="4941532">(</span><span class="ident" id="4941533">name</span>&nbsp;<span class="builtintype" id="4941538">string</span><span class="op" id="4941544">)</span>&nbsp;<span class="builtintype" id="4941546">error</span>&nbsp;<span class="op" id="4941552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4941555">return</span>&nbsp;<span class="ident" id="4941562">errors</span><span class="op" id="4941568">.</span><span class="ident" id="4941569">New</span><span class="op" id="4941572">(</span><span class="string" id="4941573">`value&nbsp;for&nbsp;&#34;`</span>&nbsp;<span class="op" id="4941587">+</span>&nbsp;<span class="ident" id="4941589">name</span>&nbsp;<span class="op" id="4941594">+</span>&nbsp;<span class="string" id="4941596">`&#34;&nbsp;out&nbsp;of&nbsp;range`</span><span class="op" id="4941612">)</span><br>
<span class="lineno">115</span><span class="op" id="4941614">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4941617">//&nbsp;decodeUintReader&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;from&nbsp;an&nbsp;io.Reader.</span><br>
<span class="lineno"></span><span class="comment" id="4941690">//&nbsp;Used&nbsp;only&nbsp;by&nbsp;the&nbsp;Decoder&nbsp;to&nbsp;read&nbsp;the&nbsp;message&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="4941746">func</span>&nbsp;<span class="ident" id="4941751">decodeUintReader</span><span class="op" id="4941767">(</span><span class="ident" id="4941768">r</span>&nbsp;<span class="ident" id="4941770">io</span><span class="op" id="4941772">.</span><span class="ident" id="4941773">Reader</span><span class="op" id="4941779">,</span>&nbsp;<span class="ident" id="4941781">buf</span>&nbsp;<span class="op" id="4941785">[</span><span class="op" id="4941786">]</span><span class="builtintype" id="4941787">byte</span><span class="op" id="4941791">)</span>&nbsp;<span class="op" id="4941793">(</span><span class="ident" id="4941794">x</span>&nbsp;<span class="ident" id="4941796">uint64</span><span class="op" id="4941802">,</span>&nbsp;<span class="ident" id="4941804">width</span>&nbsp;<span class="builtintype" id="4941810">int</span><span class="op" id="4941813">,</span>&nbsp;<span class="ident" id="4941815">err</span>&nbsp;<span class="builtintype" id="4941819">error</span><span class="op" id="4941824">)</span>&nbsp;<span class="op" id="4941826">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4941829">width</span>&nbsp;<span class="op" id="4941835">=</span>&nbsp;<span class="num" id="4941837">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4941840">n</span><span class="op" id="4941841">,</span>&nbsp;<span class="ident" id="4941843">err</span>&nbsp;<span class="op" id="4941847">:=</span>&nbsp;<span class="ident" id="4941850">io</span><span class="op" id="4941852">.</span><span class="ident" id="4941853">ReadFull</span><span class="op" id="4941861">(</span><span class="ident" id="4941862">r</span><span class="op" id="4941863">,</span>&nbsp;<span class="ident" id="4941865">buf</span><span class="op" id="4941868">[</span><span class="num" id="4941869">0</span><span class="op" id="4941870">:</span><span class="ident" id="4941871">width</span><span class="op" id="4941876">]</span><span class="op" id="4941877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4941880">if</span>&nbsp;<span class="ident" id="4941883">n</span>&nbsp;<span class="op" id="4941885">==</span>&nbsp;<span class="num" id="4941888">0</span>&nbsp;<span class="op" id="4941890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4941894">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4941902">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4941905">b</span>&nbsp;<span class="op" id="4941907">:=</span>&nbsp;<span class="ident" id="4941910">buf</span><span class="op" id="4941913">[</span><span class="num" id="4941914">0</span><span class="op" id="4941915">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4941918">if</span>&nbsp;<span class="ident" id="4941921">b</span>&nbsp;<span class="op" id="4941923">&lt;=</span>&nbsp;<span class="num" id="4941926">0x7f</span>&nbsp;<span class="op" id="4941931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4941935">return</span>&nbsp;<span class="ident" id="4941942">uint64</span><span class="op" id="4941948">(</span><span class="ident" id="4941949">b</span><span class="op" id="4941950">)</span><span class="op" id="4941951">,</span>&nbsp;<span class="ident" id="4941953">width</span><span class="op" id="4941958">,</span>&nbsp;<span class="ident" id="4941960">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4941965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4941968">n</span>&nbsp;<span class="op" id="4941970">=</span>&nbsp;<span class="op" id="4941972">-</span><span class="builtintype" id="4941973">int</span><span class="op" id="4941976">(</span><span class="builtintype" id="4941977">int8</span><span class="op" id="4941981">(</span><span class="ident" id="4941982">b</span><span class="op" id="4941983">)</span><span class="op" id="4941984">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4941987">if</span>&nbsp;<span class="ident" id="4941990">n</span>&nbsp;<span class="op" id="4941992">&gt;</span>&nbsp;<span class="ident" id="4941994">uint64Size</span>&nbsp;<span class="op" id="4942005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4942009">err</span>&nbsp;<span class="op" id="4942013">=</span>&nbsp;<span class="ident" id="4942015">errBadUint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4942028">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4942036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4942039">width</span><span class="op" id="4942044">,</span>&nbsp;<span class="ident" id="4942046">err</span>&nbsp;<span class="op" id="4942050">=</span>&nbsp;<span class="ident" id="4942052">io</span><span class="op" id="4942054">.</span><span class="ident" id="4942055">ReadFull</span><span class="op" id="4942063">(</span><span class="ident" id="4942064">r</span><span class="op" id="4942065">,</span>&nbsp;<span class="ident" id="4942067">buf</span><span class="op" id="4942070">[</span><span class="num" id="4942071">0</span><span class="op" id="4942072">:</span><span class="ident" id="4942073">n</span><span class="op" id="4942074">]</span><span class="op" id="4942075">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4942078">if</span>&nbsp;<span class="ident" id="4942081">err</span>&nbsp;<span class="op" id="4942085">!=</span>&nbsp;<span class="ident" id="4942088">nil</span>&nbsp;<span class="op" id="4942092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4942096">if</span>&nbsp;<span class="ident" id="4942099">err</span>&nbsp;<span class="op" id="4942103">==</span>&nbsp;<span class="ident" id="4942106">io</span><span class="op" id="4942108">.</span><span class="ident" id="4942109">EOF</span>&nbsp;<span class="op" id="4942113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4942118">err</span>&nbsp;<span class="op" id="4942122">=</span>&nbsp;<span class="ident" id="4942124">io</span><span class="op" id="4942126">.</span><span class="ident" id="4942127">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4942146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4942150">return</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4942158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4942161">//&nbsp;Could&nbsp;check&nbsp;that&nbsp;the&nbsp;high&nbsp;byte&nbsp;is&nbsp;zero&nbsp;but&nbsp;it&#39;s&nbsp;not&nbsp;worth&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4942227">for</span>&nbsp;<span class="ident" id="4942231">_</span><span class="op" id="4942232">,</span>&nbsp;<span class="ident" id="4942234">b</span>&nbsp;<span class="op" id="4942236">:=</span>&nbsp;<span class="keyword" id="4942239">range</span>&nbsp;<span class="ident" id="4942245">buf</span><span class="op" id="4942248">[</span><span class="num" id="4942249">0</span><span class="op" id="4942250">:</span><span class="ident" id="4942251">width</span><span class="op" id="4942256">]</span>&nbsp;<span class="op" id="4942258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4942262">x</span>&nbsp;<span class="op" id="4942264">=</span>&nbsp;<span class="ident" id="4942266">x</span><span class="op" id="4942267">&lt;&lt;</span><span class="num" id="4942269">8</span>&nbsp;<span class="op" id="4942271">|</span>&nbsp;<span class="ident" id="4942273">uint64</span><span class="op" id="4942279">(</span><span class="ident" id="4942280">b</span><span class="op" id="4942281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4942284">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4942287">width</span><span class="op" id="4942292">++</span>&nbsp;<span class="comment" id="4942295">//&nbsp;+1&nbsp;for&nbsp;length&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4942318">return</span><br>
<span class="lineno"></span><span class="op" id="4942325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4942328">//&nbsp;decodeUint&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;from&nbsp;state.r.</span><br>
<span class="lineno">150</span><span class="comment" id="4942390">//&nbsp;Does&nbsp;not&nbsp;check&nbsp;for&nbsp;overflow.</span><br>
<span class="lineno"></span><span class="keyword" id="4942422">func</span>&nbsp;<span class="op" id="4942427">(</span><span class="ident" id="4942428">state</span>&nbsp;<span class="op" id="4942434">*</span><span class="ident" id="4942435">decoderState</span><span class="op" id="4942447">)</span>&nbsp;<span class="ident" id="4942449">decodeUint</span><span class="op" id="4942459">(</span><span class="op" id="4942460">)</span>&nbsp;<span class="op" id="4942462">(</span><span class="ident" id="4942463">x</span>&nbsp;<span class="ident" id="4942465">uint64</span><span class="op" id="4942471">)</span>&nbsp;<span class="op" id="4942473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4942476">b</span><span class="op" id="4942477">,</span>&nbsp;<span class="ident" id="4942479">err</span>&nbsp;<span class="op" id="4942483">:=</span>&nbsp;<span class="ident" id="4942486">state</span><span class="op" id="4942491">.</span><span class="ident" id="4942492">b</span><span class="op" id="4942493">.</span><span class="ident" id="4942494">ReadByte</span><span class="op" id="4942502">(</span><span class="op" id="4942503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4942506">if</span>&nbsp;<span class="ident" id="4942509">err</span>&nbsp;<span class="op" id="4942513">!=</span>&nbsp;<span class="ident" id="4942516">nil</span>&nbsp;<span class="op" id="4942520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4942524">error_</span><span class="op" id="4942530">(</span><span class="ident" id="4942531">err</span><span class="op" id="4942534">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4942537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4942540">if</span>&nbsp;<span class="ident" id="4942543">b</span>&nbsp;<span class="op" id="4942545">&lt;=</span>&nbsp;<span class="num" id="4942548">0x7f</span>&nbsp;<span class="op" id="4942553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4942557">return</span>&nbsp;<span class="ident" id="4942564">uint64</span><span class="op" id="4942570">(</span><span class="ident" id="4942571">b</span><span class="op" id="4942572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4942575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4942578">n</span>&nbsp;<span class="op" id="4942580">:=</span>&nbsp;<span class="op" id="4942583">-</span><span class="builtintype" id="4942584">int</span><span class="op" id="4942587">(</span><span class="builtintype" id="4942588">int8</span><span class="op" id="4942592">(</span><span class="ident" id="4942593">b</span><span class="op" id="4942594">)</span><span class="op" id="4942595">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4942598">if</span>&nbsp;<span class="ident" id="4942601">n</span>&nbsp;<span class="op" id="4942603">&gt;</span>&nbsp;<span class="ident" id="4942605">uint64Size</span>&nbsp;<span class="op" id="4942616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4942620">error_</span><span class="op" id="4942626">(</span><span class="ident" id="4942627">errBadUint</span><span class="op" id="4942637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4942640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4942643">width</span><span class="op" id="4942648">,</span>&nbsp;<span class="ident" id="4942650">err</span>&nbsp;<span class="op" id="4942654">:=</span>&nbsp;<span class="ident" id="4942657">state</span><span class="op" id="4942662">.</span><span class="ident" id="4942663">b</span><span class="op" id="4942664">.</span><span class="ident" id="4942665">Read</span><span class="op" id="4942669">(</span><span class="ident" id="4942670">state</span><span class="op" id="4942675">.</span><span class="ident" id="4942676">buf</span><span class="op" id="4942679">[</span><span class="num" id="4942680">0</span><span class="op" id="4942681">:</span><span class="ident" id="4942682">n</span><span class="op" id="4942683">]</span><span class="op" id="4942684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4942687">if</span>&nbsp;<span class="ident" id="4942690">err</span>&nbsp;<span class="op" id="4942694">!=</span>&nbsp;<span class="ident" id="4942697">nil</span>&nbsp;<span class="op" id="4942701">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4942705">error_</span><span class="op" id="4942711">(</span><span class="ident" id="4942712">err</span><span class="op" id="4942715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4942718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4942721">//&nbsp;Don&#39;t&nbsp;need&nbsp;to&nbsp;check&nbsp;error;&nbsp;it&#39;s&nbsp;safe&nbsp;to&nbsp;loop&nbsp;regardless.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4942782">//&nbsp;Could&nbsp;check&nbsp;that&nbsp;the&nbsp;high&nbsp;byte&nbsp;is&nbsp;zero&nbsp;but&nbsp;it&#39;s&nbsp;not&nbsp;worth&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4942848">for</span>&nbsp;<span class="ident" id="4942852">_</span><span class="op" id="4942853">,</span>&nbsp;<span class="ident" id="4942855">b</span>&nbsp;<span class="op" id="4942857">:=</span>&nbsp;<span class="keyword" id="4942860">range</span>&nbsp;<span class="ident" id="4942866">state</span><span class="op" id="4942871">.</span><span class="ident" id="4942872">buf</span><span class="op" id="4942875">[</span><span class="num" id="4942876">0</span><span class="op" id="4942877">:</span><span class="ident" id="4942878">width</span><span class="op" id="4942883">]</span>&nbsp;<span class="op" id="4942885">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4942889">x</span>&nbsp;<span class="op" id="4942891">=</span>&nbsp;<span class="ident" id="4942893">x</span><span class="op" id="4942894">&lt;&lt;</span><span class="num" id="4942896">8</span>&nbsp;<span class="op" id="4942898">|</span>&nbsp;<span class="ident" id="4942900">uint64</span><span class="op" id="4942906">(</span><span class="ident" id="4942907">b</span><span class="op" id="4942908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4942911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4942914">return</span>&nbsp;<span class="ident" id="4942921">x</span><br>
<span class="lineno"></span><span class="op" id="4942923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="4942926">//&nbsp;decodeInt&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;signed&nbsp;integer&nbsp;from&nbsp;state.r.</span><br>
<span class="lineno"></span><span class="comment" id="4942985">//&nbsp;Does&nbsp;not&nbsp;check&nbsp;for&nbsp;overflow.</span><br>
<span class="lineno"></span><span class="keyword" id="4943017">func</span>&nbsp;<span class="op" id="4943022">(</span><span class="ident" id="4943023">state</span>&nbsp;<span class="op" id="4943029">*</span><span class="ident" id="4943030">decoderState</span><span class="op" id="4943042">)</span>&nbsp;<span class="ident" id="4943044">decodeInt</span><span class="op" id="4943053">(</span><span class="op" id="4943054">)</span>&nbsp;<span class="ident" id="4943056">int64</span>&nbsp;<span class="op" id="4943062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4943065">x</span>&nbsp;<span class="op" id="4943067">:=</span>&nbsp;<span class="ident" id="4943070">state</span><span class="op" id="4943075">.</span><span class="ident" id="4943076">decodeUint</span><span class="op" id="4943086">(</span><span class="op" id="4943087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4943090">if</span>&nbsp;<span class="ident" id="4943093">x</span><span class="op" id="4943094">&amp;</span><span class="num" id="4943095">1</span>&nbsp;<span class="op" id="4943097">!=</span>&nbsp;<span class="num" id="4943100">0</span>&nbsp;<span class="op" id="4943102">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4943106">return</span>&nbsp;<span class="op" id="4943113">^</span><span class="ident" id="4943114">int64</span><span class="op" id="4943119">(</span><span class="ident" id="4943120">x</span>&nbsp;<span class="op" id="4943122">&gt;&gt;</span>&nbsp;<span class="num" id="4943125">1</span><span class="op" id="4943126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4943129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4943132">return</span>&nbsp;<span class="ident" id="4943139">int64</span><span class="op" id="4943144">(</span><span class="ident" id="4943145">x</span>&nbsp;<span class="op" id="4943147">&gt;&gt;</span>&nbsp;<span class="num" id="4943150">1</span><span class="op" id="4943151">)</span><br>
<span class="lineno"></span><span class="op" id="4943153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="4943156">//&nbsp;decOp&nbsp;is&nbsp;the&nbsp;signature&nbsp;of&nbsp;a&nbsp;decoding&nbsp;operator&nbsp;for&nbsp;a&nbsp;given&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="4943223">type</span>&nbsp;<span class="ident" id="4943228">decOp</span>&nbsp;<span class="keyword" id="4943234">func</span><span class="op" id="4943238">(</span><span class="ident" id="4943239">i</span>&nbsp;<span class="op" id="4943241">*</span><span class="ident" id="4943242">decInstr</span><span class="op" id="4943250">,</span>&nbsp;<span class="ident" id="4943252">state</span>&nbsp;<span class="op" id="4943258">*</span><span class="ident" id="4943259">decoderState</span><span class="op" id="4943271">,</span>&nbsp;<span class="ident" id="4943273">v</span>&nbsp;<span class="ident" id="4943275">reflect</span><span class="op" id="4943282">.</span><span class="ident" id="4943283">Value</span><span class="op" id="4943288">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4943291">//&nbsp;The&nbsp;&#39;instructions&#39;&nbsp;of&nbsp;the&nbsp;decoding&nbsp;machine</span><br>
<span class="lineno"></span><span class="keyword" id="4943337">type</span>&nbsp;<span class="ident" id="4943342">decInstr</span>&nbsp;<span class="keyword" id="4943351">struct</span>&nbsp;<span class="op" id="4943358">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4943361">op</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4943367">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4943374">field</span>&nbsp;<span class="builtintype" id="4943380">int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4943386">//&nbsp;field&nbsp;number&nbsp;of&nbsp;the&nbsp;wire&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4943420">index</span>&nbsp;<span class="op" id="4943426">[</span><span class="op" id="4943427">]</span><span class="builtintype" id="4943428">int</span>&nbsp;<span class="comment" id="4943432">//&nbsp;field&nbsp;access&nbsp;indices&nbsp;for&nbsp;destination&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4943478">ovfl</span>&nbsp;&nbsp;<span class="builtintype" id="4943484">error</span>&nbsp;<span class="comment" id="4943490">//&nbsp;error&nbsp;message&nbsp;for&nbsp;overflow/underflow&nbsp;(for&nbsp;arrays,&nbsp;of&nbsp;the&nbsp;elements)</span><br>
<span class="lineno"></span><span class="op" id="4943560">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="comment" id="4943563">//&nbsp;ignoreUint&nbsp;discards&nbsp;a&nbsp;uint&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="4943620">func</span>&nbsp;<span class="ident" id="4943625">ignoreUint</span><span class="op" id="4943635">(</span><span class="ident" id="4943636">i</span>&nbsp;<span class="op" id="4943638">*</span><span class="ident" id="4943639">decInstr</span><span class="op" id="4943647">,</span>&nbsp;<span class="ident" id="4943649">state</span>&nbsp;<span class="op" id="4943655">*</span><span class="ident" id="4943656">decoderState</span><span class="op" id="4943668">,</span>&nbsp;<span class="ident" id="4943670">v</span>&nbsp;<span class="ident" id="4943672">reflect</span><span class="op" id="4943679">.</span><span class="ident" id="4943680">Value</span><span class="op" id="4943685">)</span>&nbsp;<span class="op" id="4943687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4943690">state</span><span class="op" id="4943695">.</span><span class="ident" id="4943696">decodeUint</span><span class="op" id="4943706">(</span><span class="op" id="4943707">)</span><br>
<span class="lineno"></span><span class="op" id="4943709">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="4943712">//&nbsp;ignoreTwoUints&nbsp;discards&nbsp;a&nbsp;uint&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.&nbsp;It&#39;s&nbsp;used&nbsp;to&nbsp;skip</span><br>
<span class="lineno"></span><span class="comment" id="4943791">//&nbsp;complex&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="4943810">func</span>&nbsp;<span class="ident" id="4943815">ignoreTwoUints</span><span class="op" id="4943829">(</span><span class="ident" id="4943830">i</span>&nbsp;<span class="op" id="4943832">*</span><span class="ident" id="4943833">decInstr</span><span class="op" id="4943841">,</span>&nbsp;<span class="ident" id="4943843">state</span>&nbsp;<span class="op" id="4943849">*</span><span class="ident" id="4943850">decoderState</span><span class="op" id="4943862">,</span>&nbsp;<span class="ident" id="4943864">v</span>&nbsp;<span class="ident" id="4943866">reflect</span><span class="op" id="4943873">.</span><span class="ident" id="4943874">Value</span><span class="op" id="4943879">)</span>&nbsp;<span class="op" id="4943881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4943884">state</span><span class="op" id="4943889">.</span><span class="ident" id="4943890">decodeUint</span><span class="op" id="4943900">(</span><span class="op" id="4943901">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4943904">state</span><span class="op" id="4943909">.</span><span class="ident" id="4943910">decodeUint</span><span class="op" id="4943920">(</span><span class="op" id="4943921">)</span><br>
<span class="lineno"></span><span class="op" id="4943923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4943926">//&nbsp;Since&nbsp;the&nbsp;encoder&nbsp;writes&nbsp;no&nbsp;zeros,&nbsp;if&nbsp;we&nbsp;arrive&nbsp;at&nbsp;a&nbsp;decoder&nbsp;we&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="4943998">//&nbsp;a&nbsp;value&nbsp;to&nbsp;extract&nbsp;and&nbsp;store.&nbsp;&nbsp;The&nbsp;field&nbsp;number&nbsp;has&nbsp;already&nbsp;been&nbsp;read</span><br>
<span class="lineno">210</span><span class="comment" id="4944071">//&nbsp;(it&#39;s&nbsp;how&nbsp;we&nbsp;knew&nbsp;to&nbsp;call&nbsp;this&nbsp;decoder).</span><br>
<span class="lineno"></span><span class="comment" id="4944115">//&nbsp;Each&nbsp;decoder&nbsp;is&nbsp;responsible&nbsp;for&nbsp;handling&nbsp;any&nbsp;indirections&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="4944187">//&nbsp;with&nbsp;the&nbsp;data&nbsp;structure.&nbsp;&nbsp;If&nbsp;any&nbsp;pointer&nbsp;so&nbsp;reached&nbsp;is&nbsp;nil,&nbsp;allocation&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="4944266">//&nbsp;be&nbsp;done.</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="4944279">//&nbsp;decAlloc&nbsp;takes&nbsp;a&nbsp;value&nbsp;and&nbsp;returns&nbsp;a&nbsp;settable&nbsp;value&nbsp;that&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="4944343">//&nbsp;be&nbsp;assigned&nbsp;to.&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;a&nbsp;pointer,&nbsp;decAlloc&nbsp;guarantees&nbsp;it&nbsp;points&nbsp;to&nbsp;storage.</span><br>
<span class="lineno"></span><span class="comment" id="4944431">//&nbsp;The&nbsp;callers&nbsp;to&nbsp;the&nbsp;individual&nbsp;decoders&nbsp;are&nbsp;expected&nbsp;to&nbsp;have&nbsp;used&nbsp;decAlloc.</span><br>
<span class="lineno"></span><span class="comment" id="4944509">//&nbsp;The&nbsp;individual&nbsp;decoders&nbsp;don&#39;t&nbsp;need&nbsp;to&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="4944554">func</span>&nbsp;<span class="ident" id="4944559">decAlloc</span><span class="op" id="4944567">(</span><span class="ident" id="4944568">v</span>&nbsp;<span class="ident" id="4944570">reflect</span><span class="op" id="4944577">.</span><span class="ident" id="4944578">Value</span><span class="op" id="4944583">)</span>&nbsp;<span class="ident" id="4944585">reflect</span><span class="op" id="4944592">.</span><span class="ident" id="4944593">Value</span>&nbsp;<span class="op" id="4944599">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4944602">for</span>&nbsp;<span class="ident" id="4944606">v</span><span class="op" id="4944607">.</span><span class="ident" id="4944608">Kind</span><span class="op" id="4944612">(</span><span class="op" id="4944613">)</span>&nbsp;<span class="op" id="4944615">==</span>&nbsp;<span class="ident" id="4944618">reflect</span><span class="op" id="4944625">.</span><span class="ident" id="4944626">Ptr</span>&nbsp;<span class="op" id="4944630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4944634">if</span>&nbsp;<span class="ident" id="4944637">v</span><span class="op" id="4944638">.</span><span class="ident" id="4944639">IsNil</span><span class="op" id="4944644">(</span><span class="op" id="4944645">)</span>&nbsp;<span class="op" id="4944647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4944652">v</span><span class="op" id="4944653">.</span><span class="ident" id="4944654">Set</span><span class="op" id="4944657">(</span><span class="ident" id="4944658">reflect</span><span class="op" id="4944665">.</span><span class="ident" id="4944666">New</span><span class="op" id="4944669">(</span><span class="ident" id="4944670">v</span><span class="op" id="4944671">.</span><span class="ident" id="4944672">Type</span><span class="op" id="4944676">(</span><span class="op" id="4944677">)</span><span class="op" id="4944678">.</span><span class="ident" id="4944679">Elem</span><span class="op" id="4944683">(</span><span class="op" id="4944684">)</span><span class="op" id="4944685">)</span><span class="op" id="4944686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4944690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4944694">v</span>&nbsp;<span class="op" id="4944696">=</span>&nbsp;<span class="ident" id="4944698">v</span><span class="op" id="4944699">.</span><span class="ident" id="4944700">Elem</span><span class="op" id="4944704">(</span><span class="op" id="4944705">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4944708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4944711">return</span>&nbsp;<span class="ident" id="4944718">v</span><br>
<span class="lineno"></span><span class="op" id="4944720">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4944723">//&nbsp;decBool&nbsp;decodes&nbsp;a&nbsp;uint&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;boolean&nbsp;in&nbsp;value.</span><br>
<span class="lineno">230</span><span class="keyword" id="4944786">func</span>&nbsp;<span class="ident" id="4944791">decBool</span><span class="op" id="4944798">(</span><span class="ident" id="4944799">i</span>&nbsp;<span class="op" id="4944801">*</span><span class="ident" id="4944802">decInstr</span><span class="op" id="4944810">,</span>&nbsp;<span class="ident" id="4944812">state</span>&nbsp;<span class="op" id="4944818">*</span><span class="ident" id="4944819">decoderState</span><span class="op" id="4944831">,</span>&nbsp;<span class="ident" id="4944833">value</span>&nbsp;<span class="ident" id="4944839">reflect</span><span class="op" id="4944846">.</span><span class="ident" id="4944847">Value</span><span class="op" id="4944852">)</span>&nbsp;<span class="op" id="4944854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4944857">value</span><span class="op" id="4944862">.</span><span class="ident" id="4944863">SetBool</span><span class="op" id="4944870">(</span><span class="ident" id="4944871">state</span><span class="op" id="4944876">.</span><span class="ident" id="4944877">decodeUint</span><span class="op" id="4944887">(</span><span class="op" id="4944888">)</span>&nbsp;<span class="op" id="4944890">!=</span>&nbsp;<span class="num" id="4944893">0</span><span class="op" id="4944894">)</span><br>
<span class="lineno"></span><span class="op" id="4944896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4944899">//&nbsp;decInt8&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int8&nbsp;in&nbsp;value.</span><br>
<span class="lineno">235</span><span class="keyword" id="4944964">func</span>&nbsp;<span class="ident" id="4944969">decInt8</span><span class="op" id="4944976">(</span><span class="ident" id="4944977">i</span>&nbsp;<span class="op" id="4944979">*</span><span class="ident" id="4944980">decInstr</span><span class="op" id="4944988">,</span>&nbsp;<span class="ident" id="4944990">state</span>&nbsp;<span class="op" id="4944996">*</span><span class="ident" id="4944997">decoderState</span><span class="op" id="4945009">,</span>&nbsp;<span class="ident" id="4945011">value</span>&nbsp;<span class="ident" id="4945017">reflect</span><span class="op" id="4945024">.</span><span class="ident" id="4945025">Value</span><span class="op" id="4945030">)</span>&nbsp;<span class="op" id="4945032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4945035">v</span>&nbsp;<span class="op" id="4945037">:=</span>&nbsp;<span class="ident" id="4945040">state</span><span class="op" id="4945045">.</span><span class="ident" id="4945046">decodeInt</span><span class="op" id="4945055">(</span><span class="op" id="4945056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4945059">if</span>&nbsp;<span class="ident" id="4945062">v</span>&nbsp;<span class="op" id="4945064">&lt;</span>&nbsp;<span class="ident" id="4945066">math</span><span class="op" id="4945070">.</span><span class="ident" id="4945071">MinInt8</span>&nbsp;<span class="op" id="4945079">||</span>&nbsp;<span class="ident" id="4945082">math</span><span class="op" id="4945086">.</span><span class="ident" id="4945087">MaxInt8</span>&nbsp;<span class="op" id="4945095">&lt;</span>&nbsp;<span class="ident" id="4945097">v</span>&nbsp;<span class="op" id="4945099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4945103">error_</span><span class="op" id="4945109">(</span><span class="ident" id="4945110">i</span><span class="op" id="4945111">.</span><span class="ident" id="4945112">ovfl</span><span class="op" id="4945116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4945119">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4945122">value</span><span class="op" id="4945127">.</span><span class="ident" id="4945128">SetInt</span><span class="op" id="4945134">(</span><span class="ident" id="4945135">v</span><span class="op" id="4945136">)</span><br>
<span class="lineno"></span><span class="op" id="4945138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4945141">//&nbsp;decUint8&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint8&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4945216">func</span>&nbsp;<span class="ident" id="4945221">decUint8</span><span class="op" id="4945229">(</span><span class="ident" id="4945230">i</span>&nbsp;<span class="op" id="4945232">*</span><span class="ident" id="4945233">decInstr</span><span class="op" id="4945241">,</span>&nbsp;<span class="ident" id="4945243">state</span>&nbsp;<span class="op" id="4945249">*</span><span class="ident" id="4945250">decoderState</span><span class="op" id="4945262">,</span>&nbsp;<span class="ident" id="4945264">value</span>&nbsp;<span class="ident" id="4945270">reflect</span><span class="op" id="4945277">.</span><span class="ident" id="4945278">Value</span><span class="op" id="4945283">)</span>&nbsp;<span class="op" id="4945285">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4945288">v</span>&nbsp;<span class="op" id="4945290">:=</span>&nbsp;<span class="ident" id="4945293">state</span><span class="op" id="4945298">.</span><span class="ident" id="4945299">decodeUint</span><span class="op" id="4945309">(</span><span class="op" id="4945310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4945313">if</span>&nbsp;<span class="ident" id="4945316">math</span><span class="op" id="4945320">.</span><span class="ident" id="4945321">MaxUint8</span>&nbsp;<span class="op" id="4945330">&lt;</span>&nbsp;<span class="ident" id="4945332">v</span>&nbsp;<span class="op" id="4945334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4945338">error_</span><span class="op" id="4945344">(</span><span class="ident" id="4945345">i</span><span class="op" id="4945346">.</span><span class="ident" id="4945347">ovfl</span><span class="op" id="4945351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4945354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4945357">value</span><span class="op" id="4945362">.</span><span class="ident" id="4945363">SetUint</span><span class="op" id="4945370">(</span><span class="ident" id="4945371">v</span><span class="op" id="4945372">)</span><br>
<span class="lineno">250</span><span class="op" id="4945374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4945377">//&nbsp;decInt16&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int16&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4945444">func</span>&nbsp;<span class="ident" id="4945449">decInt16</span><span class="op" id="4945457">(</span><span class="ident" id="4945458">i</span>&nbsp;<span class="op" id="4945460">*</span><span class="ident" id="4945461">decInstr</span><span class="op" id="4945469">,</span>&nbsp;<span class="ident" id="4945471">state</span>&nbsp;<span class="op" id="4945477">*</span><span class="ident" id="4945478">decoderState</span><span class="op" id="4945490">,</span>&nbsp;<span class="ident" id="4945492">value</span>&nbsp;<span class="ident" id="4945498">reflect</span><span class="op" id="4945505">.</span><span class="ident" id="4945506">Value</span><span class="op" id="4945511">)</span>&nbsp;<span class="op" id="4945513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4945516">v</span>&nbsp;<span class="op" id="4945518">:=</span>&nbsp;<span class="ident" id="4945521">state</span><span class="op" id="4945526">.</span><span class="ident" id="4945527">decodeInt</span><span class="op" id="4945536">(</span><span class="op" id="4945537">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4945540">if</span>&nbsp;<span class="ident" id="4945543">v</span>&nbsp;<span class="op" id="4945545">&lt;</span>&nbsp;<span class="ident" id="4945547">math</span><span class="op" id="4945551">.</span><span class="ident" id="4945552">MinInt16</span>&nbsp;<span class="op" id="4945561">||</span>&nbsp;<span class="ident" id="4945564">math</span><span class="op" id="4945568">.</span><span class="ident" id="4945569">MaxInt16</span>&nbsp;<span class="op" id="4945578">&lt;</span>&nbsp;<span class="ident" id="4945580">v</span>&nbsp;<span class="op" id="4945582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4945586">error_</span><span class="op" id="4945592">(</span><span class="ident" id="4945593">i</span><span class="op" id="4945594">.</span><span class="ident" id="4945595">ovfl</span><span class="op" id="4945599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4945602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4945605">value</span><span class="op" id="4945610">.</span><span class="ident" id="4945611">SetInt</span><span class="op" id="4945617">(</span><span class="ident" id="4945618">v</span><span class="op" id="4945619">)</span><br>
<span class="lineno"></span><span class="op" id="4945621">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="comment" id="4945624">//&nbsp;decUint16&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint16&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4945701">func</span>&nbsp;<span class="ident" id="4945706">decUint16</span><span class="op" id="4945715">(</span><span class="ident" id="4945716">i</span>&nbsp;<span class="op" id="4945718">*</span><span class="ident" id="4945719">decInstr</span><span class="op" id="4945727">,</span>&nbsp;<span class="ident" id="4945729">state</span>&nbsp;<span class="op" id="4945735">*</span><span class="ident" id="4945736">decoderState</span><span class="op" id="4945748">,</span>&nbsp;<span class="ident" id="4945750">value</span>&nbsp;<span class="ident" id="4945756">reflect</span><span class="op" id="4945763">.</span><span class="ident" id="4945764">Value</span><span class="op" id="4945769">)</span>&nbsp;<span class="op" id="4945771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4945774">v</span>&nbsp;<span class="op" id="4945776">:=</span>&nbsp;<span class="ident" id="4945779">state</span><span class="op" id="4945784">.</span><span class="ident" id="4945785">decodeUint</span><span class="op" id="4945795">(</span><span class="op" id="4945796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4945799">if</span>&nbsp;<span class="ident" id="4945802">math</span><span class="op" id="4945806">.</span><span class="ident" id="4945807">MaxUint16</span>&nbsp;<span class="op" id="4945817">&lt;</span>&nbsp;<span class="ident" id="4945819">v</span>&nbsp;<span class="op" id="4945821">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4945825">error_</span><span class="op" id="4945831">(</span><span class="ident" id="4945832">i</span><span class="op" id="4945833">.</span><span class="ident" id="4945834">ovfl</span><span class="op" id="4945838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4945841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4945844">value</span><span class="op" id="4945849">.</span><span class="ident" id="4945850">SetUint</span><span class="op" id="4945857">(</span><span class="ident" id="4945858">v</span><span class="op" id="4945859">)</span><br>
<span class="lineno"></span><span class="op" id="4945861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="4945864">//&nbsp;decInt32&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int32&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4945931">func</span>&nbsp;<span class="ident" id="4945936">decInt32</span><span class="op" id="4945944">(</span><span class="ident" id="4945945">i</span>&nbsp;<span class="op" id="4945947">*</span><span class="ident" id="4945948">decInstr</span><span class="op" id="4945956">,</span>&nbsp;<span class="ident" id="4945958">state</span>&nbsp;<span class="op" id="4945964">*</span><span class="ident" id="4945965">decoderState</span><span class="op" id="4945977">,</span>&nbsp;<span class="ident" id="4945979">value</span>&nbsp;<span class="ident" id="4945985">reflect</span><span class="op" id="4945992">.</span><span class="ident" id="4945993">Value</span><span class="op" id="4945998">)</span>&nbsp;<span class="op" id="4946000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4946003">v</span>&nbsp;<span class="op" id="4946005">:=</span>&nbsp;<span class="ident" id="4946008">state</span><span class="op" id="4946013">.</span><span class="ident" id="4946014">decodeInt</span><span class="op" id="4946023">(</span><span class="op" id="4946024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4946027">if</span>&nbsp;<span class="ident" id="4946030">v</span>&nbsp;<span class="op" id="4946032">&lt;</span>&nbsp;<span class="ident" id="4946034">math</span><span class="op" id="4946038">.</span><span class="ident" id="4946039">MinInt32</span>&nbsp;<span class="op" id="4946048">||</span>&nbsp;<span class="ident" id="4946051">math</span><span class="op" id="4946055">.</span><span class="ident" id="4946056">MaxInt32</span>&nbsp;<span class="op" id="4946065">&lt;</span>&nbsp;<span class="ident" id="4946067">v</span>&nbsp;<span class="op" id="4946069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4946073">error_</span><span class="op" id="4946079">(</span><span class="ident" id="4946080">i</span><span class="op" id="4946081">.</span><span class="ident" id="4946082">ovfl</span><span class="op" id="4946086">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4946089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4946092">value</span><span class="op" id="4946097">.</span><span class="ident" id="4946098">SetInt</span><span class="op" id="4946104">(</span><span class="ident" id="4946105">v</span><span class="op" id="4946106">)</span><br>
<span class="lineno"></span><span class="op" id="4946108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4946111">//&nbsp;decUint32&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint32&nbsp;in&nbsp;value.</span><br>
<span class="lineno">280</span><span class="keyword" id="4946188">func</span>&nbsp;<span class="ident" id="4946193">decUint32</span><span class="op" id="4946202">(</span><span class="ident" id="4946203">i</span>&nbsp;<span class="op" id="4946205">*</span><span class="ident" id="4946206">decInstr</span><span class="op" id="4946214">,</span>&nbsp;<span class="ident" id="4946216">state</span>&nbsp;<span class="op" id="4946222">*</span><span class="ident" id="4946223">decoderState</span><span class="op" id="4946235">,</span>&nbsp;<span class="ident" id="4946237">value</span>&nbsp;<span class="ident" id="4946243">reflect</span><span class="op" id="4946250">.</span><span class="ident" id="4946251">Value</span><span class="op" id="4946256">)</span>&nbsp;<span class="op" id="4946258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4946261">v</span>&nbsp;<span class="op" id="4946263">:=</span>&nbsp;<span class="ident" id="4946266">state</span><span class="op" id="4946271">.</span><span class="ident" id="4946272">decodeUint</span><span class="op" id="4946282">(</span><span class="op" id="4946283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4946286">if</span>&nbsp;<span class="ident" id="4946289">math</span><span class="op" id="4946293">.</span><span class="ident" id="4946294">MaxUint32</span>&nbsp;<span class="op" id="4946304">&lt;</span>&nbsp;<span class="ident" id="4946306">v</span>&nbsp;<span class="op" id="4946308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4946312">error_</span><span class="op" id="4946318">(</span><span class="ident" id="4946319">i</span><span class="op" id="4946320">.</span><span class="ident" id="4946321">ovfl</span><span class="op" id="4946325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4946328">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4946331">value</span><span class="op" id="4946336">.</span><span class="ident" id="4946337">SetUint</span><span class="op" id="4946344">(</span><span class="ident" id="4946345">v</span><span class="op" id="4946346">)</span><br>
<span class="lineno"></span><span class="op" id="4946348">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4946351">//&nbsp;decInt64&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int64&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4946418">func</span>&nbsp;<span class="ident" id="4946423">decInt64</span><span class="op" id="4946431">(</span><span class="ident" id="4946432">i</span>&nbsp;<span class="op" id="4946434">*</span><span class="ident" id="4946435">decInstr</span><span class="op" id="4946443">,</span>&nbsp;<span class="ident" id="4946445">state</span>&nbsp;<span class="op" id="4946451">*</span><span class="ident" id="4946452">decoderState</span><span class="op" id="4946464">,</span>&nbsp;<span class="ident" id="4946466">value</span>&nbsp;<span class="ident" id="4946472">reflect</span><span class="op" id="4946479">.</span><span class="ident" id="4946480">Value</span><span class="op" id="4946485">)</span>&nbsp;<span class="op" id="4946487">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4946490">v</span>&nbsp;<span class="op" id="4946492">:=</span>&nbsp;<span class="ident" id="4946495">state</span><span class="op" id="4946500">.</span><span class="ident" id="4946501">decodeInt</span><span class="op" id="4946510">(</span><span class="op" id="4946511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4946514">value</span><span class="op" id="4946519">.</span><span class="ident" id="4946520">SetInt</span><span class="op" id="4946526">(</span><span class="ident" id="4946527">v</span><span class="op" id="4946528">)</span><br>
<span class="lineno"></span><span class="op" id="4946530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4946533">//&nbsp;decUint64&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint64&nbsp;in&nbsp;value.</span><br>
<span class="lineno">295</span><span class="keyword" id="4946610">func</span>&nbsp;<span class="ident" id="4946615">decUint64</span><span class="op" id="4946624">(</span><span class="ident" id="4946625">i</span>&nbsp;<span class="op" id="4946627">*</span><span class="ident" id="4946628">decInstr</span><span class="op" id="4946636">,</span>&nbsp;<span class="ident" id="4946638">state</span>&nbsp;<span class="op" id="4946644">*</span><span class="ident" id="4946645">decoderState</span><span class="op" id="4946657">,</span>&nbsp;<span class="ident" id="4946659">value</span>&nbsp;<span class="ident" id="4946665">reflect</span><span class="op" id="4946672">.</span><span class="ident" id="4946673">Value</span><span class="op" id="4946678">)</span>&nbsp;<span class="op" id="4946680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4946683">v</span>&nbsp;<span class="op" id="4946685">:=</span>&nbsp;<span class="ident" id="4946688">state</span><span class="op" id="4946693">.</span><span class="ident" id="4946694">decodeUint</span><span class="op" id="4946704">(</span><span class="op" id="4946705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4946708">value</span><span class="op" id="4946713">.</span><span class="ident" id="4946714">SetUint</span><span class="op" id="4946721">(</span><span class="ident" id="4946722">v</span><span class="op" id="4946723">)</span><br>
<span class="lineno"></span><span class="op" id="4946725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="comment" id="4946728">//&nbsp;Floating-point&nbsp;numbers&nbsp;are&nbsp;transmitted&nbsp;as&nbsp;uint64s&nbsp;holding&nbsp;the&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="4946798">//&nbsp;of&nbsp;the&nbsp;underlying&nbsp;representation.&nbsp;&nbsp;They&nbsp;are&nbsp;sent&nbsp;byte-reversed,&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="4946870">//&nbsp;the&nbsp;exponent&nbsp;end&nbsp;coming&nbsp;out&nbsp;first,&nbsp;so&nbsp;integer&nbsp;floating&nbsp;point&nbsp;numbers</span><br>
<span class="lineno"></span><span class="comment" id="4946942">//&nbsp;(for&nbsp;example)&nbsp;transmit&nbsp;more&nbsp;compactly.&nbsp;&nbsp;This&nbsp;routine&nbsp;does&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4947007">//&nbsp;unswizzling.</span><br>
<span class="lineno">305</span><span class="keyword" id="4947023">func</span>&nbsp;<span class="ident" id="4947028">float64FromBits</span><span class="op" id="4947043">(</span><span class="ident" id="4947044">u</span>&nbsp;<span class="ident" id="4947046">uint64</span><span class="op" id="4947052">)</span>&nbsp;<span class="builtintype" id="4947054">float64</span>&nbsp;<span class="op" id="4947062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4947065">var</span>&nbsp;<span class="ident" id="4947069">v</span>&nbsp;<span class="ident" id="4947071">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4947079">for</span>&nbsp;<span class="ident" id="4947083">i</span>&nbsp;<span class="op" id="4947085">:=</span>&nbsp;<span class="num" id="4947088">0</span><span class="op" id="4947089">;</span>&nbsp;<span class="ident" id="4947091">i</span>&nbsp;<span class="op" id="4947093">&lt;</span>&nbsp;<span class="num" id="4947095">8</span><span class="op" id="4947096">;</span>&nbsp;<span class="ident" id="4947098">i</span><span class="op" id="4947099">++</span>&nbsp;<span class="op" id="4947102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4947106">v</span>&nbsp;<span class="op" id="4947108">&lt;&lt;=</span>&nbsp;<span class="num" id="4947112">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4947116">v</span>&nbsp;<span class="op" id="4947118">|=</span>&nbsp;<span class="ident" id="4947121">u</span>&nbsp;<span class="op" id="4947123">&amp;</span>&nbsp;<span class="num" id="4947125">0xFF</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4947132">u</span>&nbsp;<span class="op" id="4947134">&gt;&gt;=</span>&nbsp;<span class="num" id="4947138">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4947141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4947144">return</span>&nbsp;<span class="ident" id="4947151">math</span><span class="op" id="4947155">.</span><span class="ident" id="4947156">Float64frombits</span><span class="op" id="4947171">(</span><span class="ident" id="4947172">v</span><span class="op" id="4947173">)</span><br>
<span class="lineno"></span><span class="op" id="4947175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="comment" id="4947178">//&nbsp;float32FromBits&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer,&nbsp;treats&nbsp;it&nbsp;as&nbsp;a&nbsp;32-bit&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="4947263">//&nbsp;number,&nbsp;and&nbsp;returns&nbsp;it.&nbsp;It&#39;s&nbsp;a&nbsp;helper&nbsp;function&nbsp;for&nbsp;float32&nbsp;and&nbsp;complex64.</span><br>
<span class="lineno"></span><span class="comment" id="4947340">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;float64&nbsp;because&nbsp;that&#39;s&nbsp;what&nbsp;reflection&nbsp;needs,&nbsp;but&nbsp;its&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="4947417">//&nbsp;value&nbsp;is&nbsp;known&nbsp;to&nbsp;be&nbsp;accurately&nbsp;representable&nbsp;in&nbsp;a&nbsp;float32.</span><br>
<span class="lineno"></span><span class="keyword" id="4947480">func</span>&nbsp;<span class="ident" id="4947485">float32FromBits</span><span class="op" id="4947500">(</span><span class="ident" id="4947501">u</span>&nbsp;<span class="ident" id="4947503">uint64</span><span class="op" id="4947509">,</span>&nbsp;<span class="ident" id="4947511">ovfl</span>&nbsp;<span class="builtintype" id="4947516">error</span><span class="op" id="4947521">)</span>&nbsp;<span class="builtintype" id="4947523">float64</span>&nbsp;<span class="op" id="4947531">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4947534">v</span>&nbsp;<span class="op" id="4947536">:=</span>&nbsp;<span class="ident" id="4947539">float64FromBits</span><span class="op" id="4947554">(</span><span class="ident" id="4947555">u</span><span class="op" id="4947556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4947559">av</span>&nbsp;<span class="op" id="4947562">:=</span>&nbsp;<span class="ident" id="4947565">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4947568">if</span>&nbsp;<span class="ident" id="4947571">av</span>&nbsp;<span class="op" id="4947574">&lt;</span>&nbsp;<span class="num" id="4947576">0</span>&nbsp;<span class="op" id="4947578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4947582">av</span>&nbsp;<span class="op" id="4947585">=</span>&nbsp;<span class="op" id="4947587">-</span><span class="ident" id="4947588">av</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4947592">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4947595">//&nbsp;+Inf&nbsp;is&nbsp;OK&nbsp;in&nbsp;both&nbsp;32-&nbsp;and&nbsp;64-bit&nbsp;floats.&nbsp;&nbsp;Underflow&nbsp;is&nbsp;always&nbsp;OK.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4947666">if</span>&nbsp;<span class="ident" id="4947669">math</span><span class="op" id="4947673">.</span><span class="ident" id="4947674">MaxFloat32</span>&nbsp;<span class="op" id="4947685">&lt;</span>&nbsp;<span class="ident" id="4947687">av</span>&nbsp;<span class="op" id="4947690">&amp;&amp;</span>&nbsp;<span class="ident" id="4947693">av</span>&nbsp;<span class="op" id="4947696">&lt;=</span>&nbsp;<span class="ident" id="4947699">math</span><span class="op" id="4947703">.</span><span class="ident" id="4947704">MaxFloat64</span>&nbsp;<span class="op" id="4947715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4947719">error_</span><span class="op" id="4947725">(</span><span class="ident" id="4947726">ovfl</span><span class="op" id="4947730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4947733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4947736">return</span>&nbsp;<span class="ident" id="4947743">v</span><br>
<span class="lineno">330</span><span class="op" id="4947745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4947748">//&nbsp;decFloat32&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer,&nbsp;treats&nbsp;it&nbsp;as&nbsp;a&nbsp;32-bit&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="4947828">//&nbsp;number,&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4947863">func</span>&nbsp;<span class="ident" id="4947868">decFloat32</span><span class="op" id="4947878">(</span><span class="ident" id="4947879">i</span>&nbsp;<span class="op" id="4947881">*</span><span class="ident" id="4947882">decInstr</span><span class="op" id="4947890">,</span>&nbsp;<span class="ident" id="4947892">state</span>&nbsp;<span class="op" id="4947898">*</span><span class="ident" id="4947899">decoderState</span><span class="op" id="4947911">,</span>&nbsp;<span class="ident" id="4947913">value</span>&nbsp;<span class="ident" id="4947919">reflect</span><span class="op" id="4947926">.</span><span class="ident" id="4947927">Value</span><span class="op" id="4947932">)</span>&nbsp;<span class="op" id="4947934">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4947937">value</span><span class="op" id="4947942">.</span><span class="ident" id="4947943">SetFloat</span><span class="op" id="4947951">(</span><span class="ident" id="4947952">float32FromBits</span><span class="op" id="4947967">(</span><span class="ident" id="4947968">state</span><span class="op" id="4947973">.</span><span class="ident" id="4947974">decodeUint</span><span class="op" id="4947984">(</span><span class="op" id="4947985">)</span><span class="op" id="4947986">,</span>&nbsp;<span class="ident" id="4947988">i</span><span class="op" id="4947989">.</span><span class="ident" id="4947990">ovfl</span><span class="op" id="4947994">)</span><span class="op" id="4947995">)</span><br>
<span class="lineno"></span><span class="op" id="4947997">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4948000">//&nbsp;decFloat64&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer,&nbsp;treats&nbsp;it&nbsp;as&nbsp;a&nbsp;64-bit&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="4948080">//&nbsp;number,&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno">340</span><span class="keyword" id="4948115">func</span>&nbsp;<span class="ident" id="4948120">decFloat64</span><span class="op" id="4948130">(</span><span class="ident" id="4948131">i</span>&nbsp;<span class="op" id="4948133">*</span><span class="ident" id="4948134">decInstr</span><span class="op" id="4948142">,</span>&nbsp;<span class="ident" id="4948144">state</span>&nbsp;<span class="op" id="4948150">*</span><span class="ident" id="4948151">decoderState</span><span class="op" id="4948163">,</span>&nbsp;<span class="ident" id="4948165">value</span>&nbsp;<span class="ident" id="4948171">reflect</span><span class="op" id="4948178">.</span><span class="ident" id="4948179">Value</span><span class="op" id="4948184">)</span>&nbsp;<span class="op" id="4948186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4948189">value</span><span class="op" id="4948194">.</span><span class="ident" id="4948195">SetFloat</span><span class="op" id="4948203">(</span><span class="ident" id="4948204">float64FromBits</span><span class="op" id="4948219">(</span><span class="ident" id="4948220">state</span><span class="op" id="4948225">.</span><span class="ident" id="4948226">decodeUint</span><span class="op" id="4948236">(</span><span class="op" id="4948237">)</span><span class="op" id="4948238">)</span><span class="op" id="4948239">)</span><br>
<span class="lineno"></span><span class="op" id="4948241">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4948244">//&nbsp;decComplex64&nbsp;decodes&nbsp;a&nbsp;pair&nbsp;of&nbsp;unsigned&nbsp;integers,&nbsp;treats&nbsp;them&nbsp;as&nbsp;a</span><br>
<span class="lineno">345</span><span class="comment" id="4948314">//&nbsp;pair&nbsp;of&nbsp;floating&nbsp;point&nbsp;numbers,&nbsp;and&nbsp;stores&nbsp;them&nbsp;as&nbsp;a&nbsp;complex64&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4948390">//&nbsp;The&nbsp;real&nbsp;part&nbsp;comes&nbsp;first.</span><br>
<span class="lineno"></span><span class="keyword" id="4948420">func</span>&nbsp;<span class="ident" id="4948425">decComplex64</span><span class="op" id="4948437">(</span><span class="ident" id="4948438">i</span>&nbsp;<span class="op" id="4948440">*</span><span class="ident" id="4948441">decInstr</span><span class="op" id="4948449">,</span>&nbsp;<span class="ident" id="4948451">state</span>&nbsp;<span class="op" id="4948457">*</span><span class="ident" id="4948458">decoderState</span><span class="op" id="4948470">,</span>&nbsp;<span class="ident" id="4948472">value</span>&nbsp;<span class="ident" id="4948478">reflect</span><span class="op" id="4948485">.</span><span class="ident" id="4948486">Value</span><span class="op" id="4948491">)</span>&nbsp;<span class="op" id="4948493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4948496">real</span>&nbsp;<span class="op" id="4948501">:=</span>&nbsp;<span class="ident" id="4948504">float32FromBits</span><span class="op" id="4948519">(</span><span class="ident" id="4948520">state</span><span class="op" id="4948525">.</span><span class="ident" id="4948526">decodeUint</span><span class="op" id="4948536">(</span><span class="op" id="4948537">)</span><span class="op" id="4948538">,</span>&nbsp;<span class="ident" id="4948540">i</span><span class="op" id="4948541">.</span><span class="ident" id="4948542">ovfl</span><span class="op" id="4948546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4948549">imag</span>&nbsp;<span class="op" id="4948554">:=</span>&nbsp;<span class="ident" id="4948557">float32FromBits</span><span class="op" id="4948572">(</span><span class="ident" id="4948573">state</span><span class="op" id="4948578">.</span><span class="ident" id="4948579">decodeUint</span><span class="op" id="4948589">(</span><span class="op" id="4948590">)</span><span class="op" id="4948591">,</span>&nbsp;<span class="ident" id="4948593">i</span><span class="op" id="4948594">.</span><span class="ident" id="4948595">ovfl</span><span class="op" id="4948599">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4948602">value</span><span class="op" id="4948607">.</span><span class="ident" id="4948608">SetComplex</span><span class="op" id="4948618">(</span><span class="builtinfunc" id="4948619">complex</span><span class="op" id="4948626">(</span><span class="builtinfunc" id="4948627">real</span><span class="op" id="4948631">,</span>&nbsp;<span class="builtinfunc" id="4948633">imag</span><span class="op" id="4948637">)</span><span class="op" id="4948638">)</span><br>
<span class="lineno"></span><span class="op" id="4948640">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4948643">//&nbsp;decComplex128&nbsp;decodes&nbsp;a&nbsp;pair&nbsp;of&nbsp;unsigned&nbsp;integers,&nbsp;treats&nbsp;them&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4948714">//&nbsp;pair&nbsp;of&nbsp;floating&nbsp;point&nbsp;numbers,&nbsp;and&nbsp;stores&nbsp;them&nbsp;as&nbsp;a&nbsp;complex128&nbsp;in&nbsp;value.</span><br>
<span class="lineno">355</span><span class="comment" id="4948791">//&nbsp;The&nbsp;real&nbsp;part&nbsp;comes&nbsp;first.</span><br>
<span class="lineno"></span><span class="keyword" id="4948821">func</span>&nbsp;<span class="ident" id="4948826">decComplex128</span><span class="op" id="4948839">(</span><span class="ident" id="4948840">i</span>&nbsp;<span class="op" id="4948842">*</span><span class="ident" id="4948843">decInstr</span><span class="op" id="4948851">,</span>&nbsp;<span class="ident" id="4948853">state</span>&nbsp;<span class="op" id="4948859">*</span><span class="ident" id="4948860">decoderState</span><span class="op" id="4948872">,</span>&nbsp;<span class="ident" id="4948874">value</span>&nbsp;<span class="ident" id="4948880">reflect</span><span class="op" id="4948887">.</span><span class="ident" id="4948888">Value</span><span class="op" id="4948893">)</span>&nbsp;<span class="op" id="4948895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4948898">real</span>&nbsp;<span class="op" id="4948903">:=</span>&nbsp;<span class="ident" id="4948906">float64FromBits</span><span class="op" id="4948921">(</span><span class="ident" id="4948922">state</span><span class="op" id="4948927">.</span><span class="ident" id="4948928">decodeUint</span><span class="op" id="4948938">(</span><span class="op" id="4948939">)</span><span class="op" id="4948940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4948943">imag</span>&nbsp;<span class="op" id="4948948">:=</span>&nbsp;<span class="ident" id="4948951">float64FromBits</span><span class="op" id="4948966">(</span><span class="ident" id="4948967">state</span><span class="op" id="4948972">.</span><span class="ident" id="4948973">decodeUint</span><span class="op" id="4948983">(</span><span class="op" id="4948984">)</span><span class="op" id="4948985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4948988">value</span><span class="op" id="4948993">.</span><span class="ident" id="4948994">SetComplex</span><span class="op" id="4949004">(</span><span class="builtinfunc" id="4949005">complex</span><span class="op" id="4949012">(</span><span class="builtinfunc" id="4949013">real</span><span class="op" id="4949017">,</span>&nbsp;<span class="builtinfunc" id="4949019">imag</span><span class="op" id="4949023">)</span><span class="op" id="4949024">)</span><br>
<span class="lineno">360</span><span class="op" id="4949026">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4949029">//&nbsp;decUint8Slice&nbsp;decodes&nbsp;a&nbsp;byte&nbsp;slice&nbsp;and&nbsp;stores&nbsp;in&nbsp;value&nbsp;a&nbsp;slice&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="4949102">//&nbsp;describing&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="4949126">//&nbsp;uint8&nbsp;slices&nbsp;are&nbsp;encoded&nbsp;as&nbsp;an&nbsp;unsigned&nbsp;count&nbsp;followed&nbsp;by&nbsp;the&nbsp;raw&nbsp;bytes.</span><br>
<span class="lineno">365</span><span class="keyword" id="4949202">func</span>&nbsp;<span class="ident" id="4949207">decUint8Slice</span><span class="op" id="4949220">(</span><span class="ident" id="4949221">i</span>&nbsp;<span class="op" id="4949223">*</span><span class="ident" id="4949224">decInstr</span><span class="op" id="4949232">,</span>&nbsp;<span class="ident" id="4949234">state</span>&nbsp;<span class="op" id="4949240">*</span><span class="ident" id="4949241">decoderState</span><span class="op" id="4949253">,</span>&nbsp;<span class="ident" id="4949255">value</span>&nbsp;<span class="ident" id="4949261">reflect</span><span class="op" id="4949268">.</span><span class="ident" id="4949269">Value</span><span class="op" id="4949274">)</span>&nbsp;<span class="op" id="4949276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4949279">u</span>&nbsp;<span class="op" id="4949281">:=</span>&nbsp;<span class="ident" id="4949284">state</span><span class="op" id="4949289">.</span><span class="ident" id="4949290">decodeUint</span><span class="op" id="4949300">(</span><span class="op" id="4949301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4949304">n</span>&nbsp;<span class="op" id="4949306">:=</span>&nbsp;<span class="builtintype" id="4949309">int</span><span class="op" id="4949312">(</span><span class="ident" id="4949313">u</span><span class="op" id="4949314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4949317">if</span>&nbsp;<span class="ident" id="4949320">n</span>&nbsp;<span class="op" id="4949322">&lt;</span>&nbsp;<span class="num" id="4949324">0</span>&nbsp;<span class="op" id="4949326">||</span>&nbsp;<span class="ident" id="4949329">uint64</span><span class="op" id="4949335">(</span><span class="ident" id="4949336">n</span><span class="op" id="4949337">)</span>&nbsp;<span class="op" id="4949339">!=</span>&nbsp;<span class="ident" id="4949342">u</span>&nbsp;<span class="op" id="4949344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4949348">errorf</span><span class="op" id="4949354">(</span><span class="string" id="4949355">&#34;length&nbsp;of&nbsp;%s&nbsp;exceeds&nbsp;input&nbsp;size&nbsp;(%d&nbsp;bytes)&#34;</span><span class="op" id="4949399">,</span>&nbsp;<span class="ident" id="4949401">value</span><span class="op" id="4949406">.</span><span class="ident" id="4949407">Type</span><span class="op" id="4949411">(</span><span class="op" id="4949412">)</span><span class="op" id="4949413">,</span>&nbsp;<span class="ident" id="4949415">u</span><span class="op" id="4949416">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4949419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4949422">if</span>&nbsp;<span class="ident" id="4949425">n</span>&nbsp;<span class="op" id="4949427">&gt;</span>&nbsp;<span class="ident" id="4949429">state</span><span class="op" id="4949434">.</span><span class="ident" id="4949435">b</span><span class="op" id="4949436">.</span><span class="ident" id="4949437">Len</span><span class="op" id="4949440">(</span><span class="op" id="4949441">)</span>&nbsp;<span class="op" id="4949443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4949447">errorf</span><span class="op" id="4949453">(</span><span class="string" id="4949454">&#34;%s&nbsp;data&nbsp;too&nbsp;long&nbsp;for&nbsp;buffer:&nbsp;%d&#34;</span><span class="op" id="4949487">,</span>&nbsp;<span class="ident" id="4949489">value</span><span class="op" id="4949494">.</span><span class="ident" id="4949495">Type</span><span class="op" id="4949499">(</span><span class="op" id="4949500">)</span><span class="op" id="4949501">,</span>&nbsp;<span class="ident" id="4949503">n</span><span class="op" id="4949504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4949507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4949510">if</span>&nbsp;<span class="ident" id="4949513">n</span>&nbsp;<span class="op" id="4949515">&gt;</span>&nbsp;<span class="ident" id="4949517">tooBig</span>&nbsp;<span class="op" id="4949524">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4949528">errorf</span><span class="op" id="4949534">(</span><span class="string" id="4949535">&#34;byte&nbsp;slice&nbsp;too&nbsp;big:&nbsp;%d&#34;</span><span class="op" id="4949559">,</span>&nbsp;<span class="ident" id="4949561">n</span><span class="op" id="4949562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4949565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4949568">if</span>&nbsp;<span class="ident" id="4949571">value</span><span class="op" id="4949576">.</span><span class="ident" id="4949577">Cap</span><span class="op" id="4949580">(</span><span class="op" id="4949581">)</span>&nbsp;<span class="op" id="4949583">&lt;</span>&nbsp;<span class="ident" id="4949585">n</span>&nbsp;<span class="op" id="4949587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4949591">value</span><span class="op" id="4949596">.</span><span class="ident" id="4949597">Set</span><span class="op" id="4949600">(</span><span class="ident" id="4949601">reflect</span><span class="op" id="4949608">.</span><span class="ident" id="4949609">MakeSlice</span><span class="op" id="4949618">(</span><span class="ident" id="4949619">value</span><span class="op" id="4949624">.</span><span class="ident" id="4949625">Type</span><span class="op" id="4949629">(</span><span class="op" id="4949630">)</span><span class="op" id="4949631">,</span>&nbsp;<span class="ident" id="4949633">n</span><span class="op" id="4949634">,</span>&nbsp;<span class="ident" id="4949636">n</span><span class="op" id="4949637">)</span><span class="op" id="4949638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4949641">}</span>&nbsp;<span class="keyword" id="4949643">else</span>&nbsp;<span class="op" id="4949648">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4949652">value</span><span class="op" id="4949657">.</span><span class="ident" id="4949658">Set</span><span class="op" id="4949661">(</span><span class="ident" id="4949662">value</span><span class="op" id="4949667">.</span><span class="ident" id="4949668">Slice</span><span class="op" id="4949673">(</span><span class="num" id="4949674">0</span><span class="op" id="4949675">,</span>&nbsp;<span class="ident" id="4949677">n</span><span class="op" id="4949678">)</span><span class="op" id="4949679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4949682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4949685">if</span>&nbsp;<span class="ident" id="4949688">_</span><span class="op" id="4949689">,</span>&nbsp;<span class="ident" id="4949691">err</span>&nbsp;<span class="op" id="4949695">:=</span>&nbsp;<span class="ident" id="4949698">state</span><span class="op" id="4949703">.</span><span class="ident" id="4949704">b</span><span class="op" id="4949705">.</span><span class="ident" id="4949706">Read</span><span class="op" id="4949710">(</span><span class="ident" id="4949711">value</span><span class="op" id="4949716">.</span><span class="ident" id="4949717">Bytes</span><span class="op" id="4949722">(</span><span class="op" id="4949723">)</span><span class="op" id="4949724">)</span><span class="op" id="4949725">;</span>&nbsp;<span class="ident" id="4949727">err</span>&nbsp;<span class="op" id="4949731">!=</span>&nbsp;<span class="ident" id="4949734">nil</span>&nbsp;<span class="op" id="4949738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4949742">errorf</span><span class="op" id="4949748">(</span><span class="string" id="4949749">&#34;error&nbsp;decoding&nbsp;[]byte:&nbsp;%s&#34;</span><span class="op" id="4949776">,</span>&nbsp;<span class="ident" id="4949778">err</span><span class="op" id="4949781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4949784">}</span><br>
<span class="lineno">385</span><span class="op" id="4949786">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4949789">//&nbsp;decString&nbsp;decodes&nbsp;byte&nbsp;array&nbsp;and&nbsp;stores&nbsp;in&nbsp;value&nbsp;a&nbsp;string&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="4949857">//&nbsp;describing&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="4949881">//&nbsp;Strings&nbsp;are&nbsp;encoded&nbsp;as&nbsp;an&nbsp;unsigned&nbsp;count&nbsp;followed&nbsp;by&nbsp;the&nbsp;raw&nbsp;bytes.</span><br>
<span class="lineno">390</span><span class="keyword" id="4949952">func</span>&nbsp;<span class="ident" id="4949957">decString</span><span class="op" id="4949966">(</span><span class="ident" id="4949967">i</span>&nbsp;<span class="op" id="4949969">*</span><span class="ident" id="4949970">decInstr</span><span class="op" id="4949978">,</span>&nbsp;<span class="ident" id="4949980">state</span>&nbsp;<span class="op" id="4949986">*</span><span class="ident" id="4949987">decoderState</span><span class="op" id="4949999">,</span>&nbsp;<span class="ident" id="4950001">value</span>&nbsp;<span class="ident" id="4950007">reflect</span><span class="op" id="4950014">.</span><span class="ident" id="4950015">Value</span><span class="op" id="4950020">)</span>&nbsp;<span class="op" id="4950022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4950025">u</span>&nbsp;<span class="op" id="4950027">:=</span>&nbsp;<span class="ident" id="4950030">state</span><span class="op" id="4950035">.</span><span class="ident" id="4950036">decodeUint</span><span class="op" id="4950046">(</span><span class="op" id="4950047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4950050">n</span>&nbsp;<span class="op" id="4950052">:=</span>&nbsp;<span class="builtintype" id="4950055">int</span><span class="op" id="4950058">(</span><span class="ident" id="4950059">u</span><span class="op" id="4950060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4950063">if</span>&nbsp;<span class="ident" id="4950066">n</span>&nbsp;<span class="op" id="4950068">&lt;</span>&nbsp;<span class="num" id="4950070">0</span>&nbsp;<span class="op" id="4950072">||</span>&nbsp;<span class="ident" id="4950075">uint64</span><span class="op" id="4950081">(</span><span class="ident" id="4950082">n</span><span class="op" id="4950083">)</span>&nbsp;<span class="op" id="4950085">!=</span>&nbsp;<span class="ident" id="4950088">u</span>&nbsp;<span class="op" id="4950090">||</span>&nbsp;<span class="ident" id="4950093">n</span>&nbsp;<span class="op" id="4950095">&gt;</span>&nbsp;<span class="ident" id="4950097">state</span><span class="op" id="4950102">.</span><span class="ident" id="4950103">b</span><span class="op" id="4950104">.</span><span class="ident" id="4950105">Len</span><span class="op" id="4950108">(</span><span class="op" id="4950109">)</span>&nbsp;<span class="op" id="4950111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4950115">errorf</span><span class="op" id="4950121">(</span><span class="string" id="4950122">&#34;length&nbsp;of&nbsp;%s&nbsp;exceeds&nbsp;input&nbsp;size&nbsp;(%d&nbsp;bytes)&#34;</span><span class="op" id="4950166">,</span>&nbsp;<span class="ident" id="4950168">value</span><span class="op" id="4950173">.</span><span class="ident" id="4950174">Type</span><span class="op" id="4950178">(</span><span class="op" id="4950179">)</span><span class="op" id="4950180">,</span>&nbsp;<span class="ident" id="4950182">u</span><span class="op" id="4950183">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4950186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4950189">if</span>&nbsp;<span class="ident" id="4950192">n</span>&nbsp;<span class="op" id="4950194">&gt;</span>&nbsp;<span class="ident" id="4950196">state</span><span class="op" id="4950201">.</span><span class="ident" id="4950202">b</span><span class="op" id="4950203">.</span><span class="ident" id="4950204">Len</span><span class="op" id="4950207">(</span><span class="op" id="4950208">)</span>&nbsp;<span class="op" id="4950210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4950214">errorf</span><span class="op" id="4950220">(</span><span class="string" id="4950221">&#34;%s&nbsp;data&nbsp;too&nbsp;long&nbsp;for&nbsp;buffer:&nbsp;%d&#34;</span><span class="op" id="4950254">,</span>&nbsp;<span class="ident" id="4950256">value</span><span class="op" id="4950261">.</span><span class="ident" id="4950262">Type</span><span class="op" id="4950266">(</span><span class="op" id="4950267">)</span><span class="op" id="4950268">,</span>&nbsp;<span class="ident" id="4950270">n</span><span class="op" id="4950271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4950274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4950277">//&nbsp;Read&nbsp;the&nbsp;data.</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4950296">data</span>&nbsp;<span class="op" id="4950301">:=</span>&nbsp;<span class="builtinfunc" id="4950304">make</span><span class="op" id="4950308">(</span><span class="op" id="4950309">[</span><span class="op" id="4950310">]</span><span class="builtintype" id="4950311">byte</span><span class="op" id="4950315">,</span>&nbsp;<span class="ident" id="4950317">n</span><span class="op" id="4950318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4950321">if</span>&nbsp;<span class="ident" id="4950324">_</span><span class="op" id="4950325">,</span>&nbsp;<span class="ident" id="4950327">err</span>&nbsp;<span class="op" id="4950331">:=</span>&nbsp;<span class="ident" id="4950334">state</span><span class="op" id="4950339">.</span><span class="ident" id="4950340">b</span><span class="op" id="4950341">.</span><span class="ident" id="4950342">Read</span><span class="op" id="4950346">(</span><span class="ident" id="4950347">data</span><span class="op" id="4950351">)</span><span class="op" id="4950352">;</span>&nbsp;<span class="ident" id="4950354">err</span>&nbsp;<span class="op" id="4950358">!=</span>&nbsp;<span class="ident" id="4950361">nil</span>&nbsp;<span class="op" id="4950365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4950369">errorf</span><span class="op" id="4950375">(</span><span class="string" id="4950376">&#34;error&nbsp;decoding&nbsp;string:&nbsp;%s&#34;</span><span class="op" id="4950403">,</span>&nbsp;<span class="ident" id="4950405">err</span><span class="op" id="4950408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4950411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4950414">value</span><span class="op" id="4950419">.</span><span class="ident" id="4950420">SetString</span><span class="op" id="4950429">(</span><span class="builtintype" id="4950430">string</span><span class="op" id="4950436">(</span><span class="ident" id="4950437">data</span><span class="op" id="4950441">)</span><span class="op" id="4950442">)</span><br>
<span class="lineno">405</span><span class="op" id="4950444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4950447">//&nbsp;ignoreUint8Array&nbsp;skips&nbsp;over&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;byte&nbsp;slice&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="4950531">func</span>&nbsp;<span class="ident" id="4950536">ignoreUint8Array</span><span class="op" id="4950552">(</span><span class="ident" id="4950553">i</span>&nbsp;<span class="op" id="4950555">*</span><span class="ident" id="4950556">decInstr</span><span class="op" id="4950564">,</span>&nbsp;<span class="ident" id="4950566">state</span>&nbsp;<span class="op" id="4950572">*</span><span class="ident" id="4950573">decoderState</span><span class="op" id="4950585">,</span>&nbsp;<span class="ident" id="4950587">value</span>&nbsp;<span class="ident" id="4950593">reflect</span><span class="op" id="4950600">.</span><span class="ident" id="4950601">Value</span><span class="op" id="4950606">)</span>&nbsp;<span class="op" id="4950608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4950611">b</span>&nbsp;<span class="op" id="4950613">:=</span>&nbsp;<span class="builtinfunc" id="4950616">make</span><span class="op" id="4950620">(</span><span class="op" id="4950621">[</span><span class="op" id="4950622">]</span><span class="builtintype" id="4950623">byte</span><span class="op" id="4950627">,</span>&nbsp;<span class="ident" id="4950629">state</span><span class="op" id="4950634">.</span><span class="ident" id="4950635">decodeUint</span><span class="op" id="4950645">(</span><span class="op" id="4950646">)</span><span class="op" id="4950647">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4950650">state</span><span class="op" id="4950655">.</span><span class="ident" id="4950656">b</span><span class="op" id="4950657">.</span><span class="ident" id="4950658">Read</span><span class="op" id="4950662">(</span><span class="ident" id="4950663">b</span><span class="op" id="4950664">)</span><br>
<span class="lineno"></span><span class="op" id="4950666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4950669">//&nbsp;Execution&nbsp;engine</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="comment" id="4950690">//&nbsp;The&nbsp;encoder&nbsp;engine&nbsp;is&nbsp;an&nbsp;array&nbsp;of&nbsp;instructions&nbsp;indexed&nbsp;by&nbsp;field&nbsp;number&nbsp;of&nbsp;the&nbsp;incoming</span><br>
<span class="lineno"></span><span class="comment" id="4950780">//&nbsp;decoder.&nbsp;&nbsp;It&nbsp;is&nbsp;executed&nbsp;with&nbsp;random&nbsp;access&nbsp;according&nbsp;to&nbsp;field&nbsp;number.</span><br>
<span class="lineno"></span><span class="keyword" id="4950854">type</span>&nbsp;<span class="ident" id="4950859">decEngine</span>&nbsp;<span class="keyword" id="4950869">struct</span>&nbsp;<span class="op" id="4950876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4950879">instr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4950888">[</span><span class="op" id="4950889">]</span><span class="ident" id="4950890">decInstr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4950900">numInstr</span>&nbsp;<span class="builtintype" id="4950909">int</span>&nbsp;<span class="comment" id="4950913">//&nbsp;the&nbsp;number&nbsp;of&nbsp;active&nbsp;instructions</span><br>
<span class="lineno">420</span><span class="op" id="4950950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4950953">//&nbsp;decodeSingle&nbsp;decodes&nbsp;a&nbsp;top-level&nbsp;value&nbsp;that&nbsp;is&nbsp;not&nbsp;a&nbsp;struct&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4951040">//&nbsp;Such&nbsp;values&nbsp;are&nbsp;preceded&nbsp;by&nbsp;a&nbsp;zero,&nbsp;making&nbsp;them&nbsp;have&nbsp;the&nbsp;memory&nbsp;layout&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4951119">//&nbsp;struct&nbsp;field&nbsp;(although&nbsp;with&nbsp;an&nbsp;illegal&nbsp;field&nbsp;number).</span><br>
<span class="lineno">425</span><span class="keyword" id="4951176">func</span>&nbsp;<span class="op" id="4951181">(</span><span class="ident" id="4951182">dec</span>&nbsp;<span class="op" id="4951186">*</span><span class="ident" id="4951187">Decoder</span><span class="op" id="4951194">)</span>&nbsp;<span class="ident" id="4951196">decodeSingle</span><span class="op" id="4951208">(</span><span class="ident" id="4951209">engine</span>&nbsp;<span class="op" id="4951216">*</span><span class="ident" id="4951217">decEngine</span><span class="op" id="4951226">,</span>&nbsp;<span class="ident" id="4951228">ut</span>&nbsp;<span class="op" id="4951231">*</span><span class="ident" id="4951232">userTypeInfo</span><span class="op" id="4951244">,</span>&nbsp;<span class="ident" id="4951246">value</span>&nbsp;<span class="ident" id="4951252">reflect</span><span class="op" id="4951259">.</span><span class="ident" id="4951260">Value</span><span class="op" id="4951265">)</span>&nbsp;<span class="op" id="4951267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4951270">state</span>&nbsp;<span class="op" id="4951276">:=</span>&nbsp;<span class="ident" id="4951279">dec</span><span class="op" id="4951282">.</span><span class="ident" id="4951283">newDecoderState</span><span class="op" id="4951298">(</span><span class="op" id="4951299">&amp;</span><span class="ident" id="4951300">dec</span><span class="op" id="4951303">.</span><span class="ident" id="4951304">buf</span><span class="op" id="4951307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4951310">defer</span>&nbsp;<span class="ident" id="4951316">dec</span><span class="op" id="4951319">.</span><span class="ident" id="4951320">freeDecoderState</span><span class="op" id="4951336">(</span><span class="ident" id="4951337">state</span><span class="op" id="4951342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4951345">state</span><span class="op" id="4951350">.</span><span class="ident" id="4951351">fieldnum</span>&nbsp;<span class="op" id="4951360">=</span>&nbsp;<span class="ident" id="4951362">singletonField</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4951378">if</span>&nbsp;<span class="ident" id="4951381">state</span><span class="op" id="4951386">.</span><span class="ident" id="4951387">decodeUint</span><span class="op" id="4951397">(</span><span class="op" id="4951398">)</span>&nbsp;<span class="op" id="4951400">!=</span>&nbsp;<span class="num" id="4951403">0</span>&nbsp;<span class="op" id="4951405">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4951409">errorf</span><span class="op" id="4951415">(</span><span class="string" id="4951416">&#34;decode:&nbsp;corrupted&nbsp;data:&nbsp;non-zero&nbsp;delta&nbsp;for&nbsp;singleton&#34;</span><span class="op" id="4951470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4951473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4951476">instr</span>&nbsp;<span class="op" id="4951482">:=</span>&nbsp;<span class="op" id="4951485">&amp;</span><span class="ident" id="4951486">engine</span><span class="op" id="4951492">.</span><span class="ident" id="4951493">instr</span><span class="op" id="4951498">[</span><span class="ident" id="4951499">singletonField</span><span class="op" id="4951513">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4951516">instr</span><span class="op" id="4951521">.</span><span class="ident" id="4951522">op</span><span class="op" id="4951524">(</span><span class="ident" id="4951525">instr</span><span class="op" id="4951530">,</span>&nbsp;<span class="ident" id="4951532">state</span><span class="op" id="4951537">,</span>&nbsp;<span class="ident" id="4951539">value</span><span class="op" id="4951544">)</span><br>
<span class="lineno"></span><span class="op" id="4951546">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span><span class="comment" id="4951549">//&nbsp;decodeStruct&nbsp;decodes&nbsp;a&nbsp;top-level&nbsp;struct&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4951616">//&nbsp;Indir&nbsp;is&nbsp;for&nbsp;the&nbsp;value,&nbsp;not&nbsp;the&nbsp;type.&nbsp;&nbsp;At&nbsp;the&nbsp;time&nbsp;of&nbsp;the&nbsp;call&nbsp;it&nbsp;may</span><br>
<span class="lineno"></span><span class="comment" id="4951689">//&nbsp;differ&nbsp;from&nbsp;ut.indir,&nbsp;which&nbsp;was&nbsp;computed&nbsp;when&nbsp;the&nbsp;engine&nbsp;was&nbsp;built.</span><br>
<span class="lineno"></span><span class="comment" id="4951760">//&nbsp;This&nbsp;state&nbsp;cannot&nbsp;arise&nbsp;for&nbsp;decodeSingle,&nbsp;which&nbsp;is&nbsp;called&nbsp;directly</span><br>
<span class="lineno">440</span><span class="comment" id="4951830">//&nbsp;from&nbsp;the&nbsp;user&#39;s&nbsp;value,&nbsp;not&nbsp;from&nbsp;the&nbsp;innards&nbsp;of&nbsp;an&nbsp;engine.</span><br>
<span class="lineno"></span><span class="keyword" id="4951891">func</span>&nbsp;<span class="op" id="4951896">(</span><span class="ident" id="4951897">dec</span>&nbsp;<span class="op" id="4951901">*</span><span class="ident" id="4951902">Decoder</span><span class="op" id="4951909">)</span>&nbsp;<span class="ident" id="4951911">decodeStruct</span><span class="op" id="4951923">(</span><span class="ident" id="4951924">engine</span>&nbsp;<span class="op" id="4951931">*</span><span class="ident" id="4951932">decEngine</span><span class="op" id="4951941">,</span>&nbsp;<span class="ident" id="4951943">ut</span>&nbsp;<span class="op" id="4951946">*</span><span class="ident" id="4951947">userTypeInfo</span><span class="op" id="4951959">,</span>&nbsp;<span class="ident" id="4951961">value</span>&nbsp;<span class="ident" id="4951967">reflect</span><span class="op" id="4951974">.</span><span class="ident" id="4951975">Value</span><span class="op" id="4951980">)</span>&nbsp;<span class="op" id="4951982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4951985">state</span>&nbsp;<span class="op" id="4951991">:=</span>&nbsp;<span class="ident" id="4951994">dec</span><span class="op" id="4951997">.</span><span class="ident" id="4951998">newDecoderState</span><span class="op" id="4952013">(</span><span class="op" id="4952014">&amp;</span><span class="ident" id="4952015">dec</span><span class="op" id="4952018">.</span><span class="ident" id="4952019">buf</span><span class="op" id="4952022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4952025">defer</span>&nbsp;<span class="ident" id="4952031">dec</span><span class="op" id="4952034">.</span><span class="ident" id="4952035">freeDecoderState</span><span class="op" id="4952051">(</span><span class="ident" id="4952052">state</span><span class="op" id="4952057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4952060">state</span><span class="op" id="4952065">.</span><span class="ident" id="4952066">fieldnum</span>&nbsp;<span class="op" id="4952075">=</span>&nbsp;<span class="op" id="4952077">-</span><span class="num" id="4952078">1</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4952081">for</span>&nbsp;<span class="ident" id="4952085">state</span><span class="op" id="4952090">.</span><span class="ident" id="4952091">b</span><span class="op" id="4952092">.</span><span class="ident" id="4952093">Len</span><span class="op" id="4952096">(</span><span class="op" id="4952097">)</span>&nbsp;<span class="op" id="4952099">&gt;</span>&nbsp;<span class="num" id="4952101">0</span>&nbsp;<span class="op" id="4952103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4952107">delta</span>&nbsp;<span class="op" id="4952113">:=</span>&nbsp;<span class="builtintype" id="4952116">int</span><span class="op" id="4952119">(</span><span class="ident" id="4952120">state</span><span class="op" id="4952125">.</span><span class="ident" id="4952126">decodeUint</span><span class="op" id="4952136">(</span><span class="op" id="4952137">)</span><span class="op" id="4952138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4952142">if</span>&nbsp;<span class="ident" id="4952145">delta</span>&nbsp;<span class="op" id="4952151">&lt;</span>&nbsp;<span class="num" id="4952153">0</span>&nbsp;<span class="op" id="4952155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4952160">errorf</span><span class="op" id="4952166">(</span><span class="string" id="4952167">&#34;decode:&nbsp;corrupted&nbsp;data:&nbsp;negative&nbsp;delta&#34;</span><span class="op" id="4952207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4952211">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4952215">if</span>&nbsp;<span class="ident" id="4952218">delta</span>&nbsp;<span class="op" id="4952224">==</span>&nbsp;<span class="num" id="4952227">0</span>&nbsp;<span class="op" id="4952229">{</span>&nbsp;<span class="comment" id="4952231">//&nbsp;struct&nbsp;terminator&nbsp;is&nbsp;zero&nbsp;delta&nbsp;fieldnum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4952278">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4952286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4952290">fieldnum</span>&nbsp;<span class="op" id="4952299">:=</span>&nbsp;<span class="ident" id="4952302">state</span><span class="op" id="4952307">.</span><span class="ident" id="4952308">fieldnum</span>&nbsp;<span class="op" id="4952317">+</span>&nbsp;<span class="ident" id="4952319">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4952327">if</span>&nbsp;<span class="ident" id="4952330">fieldnum</span>&nbsp;<span class="op" id="4952339">&gt;=</span>&nbsp;<span class="builtinfunc" id="4952342">len</span><span class="op" id="4952345">(</span><span class="ident" id="4952346">engine</span><span class="op" id="4952352">.</span><span class="ident" id="4952353">instr</span><span class="op" id="4952358">)</span>&nbsp;<span class="op" id="4952360">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4952365">error_</span><span class="op" id="4952371">(</span><span class="ident" id="4952372">errRange</span><span class="op" id="4952380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4952385">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4952393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4952397">instr</span>&nbsp;<span class="op" id="4952403">:=</span>&nbsp;<span class="op" id="4952406">&amp;</span><span class="ident" id="4952407">engine</span><span class="op" id="4952413">.</span><span class="ident" id="4952414">instr</span><span class="op" id="4952419">[</span><span class="ident" id="4952420">fieldnum</span><span class="op" id="4952428">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4952432">var</span>&nbsp;<span class="ident" id="4952436">field</span>&nbsp;<span class="ident" id="4952442">reflect</span><span class="op" id="4952449">.</span><span class="ident" id="4952450">Value</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4952458">if</span>&nbsp;<span class="ident" id="4952461">instr</span><span class="op" id="4952466">.</span><span class="ident" id="4952467">index</span>&nbsp;<span class="op" id="4952473">!=</span>&nbsp;<span class="ident" id="4952476">nil</span>&nbsp;<span class="op" id="4952480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4952485">//&nbsp;Otherwise&nbsp;the&nbsp;field&nbsp;is&nbsp;unknown&nbsp;to&nbsp;us&nbsp;and&nbsp;instr.op&nbsp;is&nbsp;an&nbsp;ignore&nbsp;op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4952558">field</span>&nbsp;<span class="op" id="4952564">=</span>&nbsp;<span class="ident" id="4952566">value</span><span class="op" id="4952571">.</span><span class="ident" id="4952572">FieldByIndex</span><span class="op" id="4952584">(</span><span class="ident" id="4952585">instr</span><span class="op" id="4952590">.</span><span class="ident" id="4952591">index</span><span class="op" id="4952596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4952601">if</span>&nbsp;<span class="ident" id="4952604">field</span><span class="op" id="4952609">.</span><span class="ident" id="4952610">Kind</span><span class="op" id="4952614">(</span><span class="op" id="4952615">)</span>&nbsp;<span class="op" id="4952617">==</span>&nbsp;<span class="ident" id="4952620">reflect</span><span class="op" id="4952627">.</span><span class="ident" id="4952628">Ptr</span>&nbsp;<span class="op" id="4952632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4952638">field</span>&nbsp;<span class="op" id="4952644">=</span>&nbsp;<span class="ident" id="4952646">decAlloc</span><span class="op" id="4952654">(</span><span class="ident" id="4952655">field</span><span class="op" id="4952660">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4952665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4952669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4952673">instr</span><span class="op" id="4952678">.</span><span class="ident" id="4952679">op</span><span class="op" id="4952681">(</span><span class="ident" id="4952682">instr</span><span class="op" id="4952687">,</span>&nbsp;<span class="ident" id="4952689">state</span><span class="op" id="4952694">,</span>&nbsp;<span class="ident" id="4952696">field</span><span class="op" id="4952701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4952705">state</span><span class="op" id="4952710">.</span><span class="ident" id="4952711">fieldnum</span>&nbsp;<span class="op" id="4952720">=</span>&nbsp;<span class="ident" id="4952722">fieldnum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4952732">}</span><br>
<span class="lineno">470</span><span class="op" id="4952734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4952737">var</span>&nbsp;<span class="ident" id="4952741">noValue</span>&nbsp;<span class="ident" id="4952749">reflect</span><span class="op" id="4952756">.</span><span class="ident" id="4952757">Value</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4952764">//&nbsp;ignoreStruct&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;struct&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno">475</span><span class="keyword" id="4952832">func</span>&nbsp;<span class="op" id="4952837">(</span><span class="ident" id="4952838">dec</span>&nbsp;<span class="op" id="4952842">*</span><span class="ident" id="4952843">Decoder</span><span class="op" id="4952850">)</span>&nbsp;<span class="ident" id="4952852">ignoreStruct</span><span class="op" id="4952864">(</span><span class="ident" id="4952865">engine</span>&nbsp;<span class="op" id="4952872">*</span><span class="ident" id="4952873">decEngine</span><span class="op" id="4952882">)</span>&nbsp;<span class="op" id="4952884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4952887">state</span>&nbsp;<span class="op" id="4952893">:=</span>&nbsp;<span class="ident" id="4952896">dec</span><span class="op" id="4952899">.</span><span class="ident" id="4952900">newDecoderState</span><span class="op" id="4952915">(</span><span class="op" id="4952916">&amp;</span><span class="ident" id="4952917">dec</span><span class="op" id="4952920">.</span><span class="ident" id="4952921">buf</span><span class="op" id="4952924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4952927">defer</span>&nbsp;<span class="ident" id="4952933">dec</span><span class="op" id="4952936">.</span><span class="ident" id="4952937">freeDecoderState</span><span class="op" id="4952953">(</span><span class="ident" id="4952954">state</span><span class="op" id="4952959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4952962">state</span><span class="op" id="4952967">.</span><span class="ident" id="4952968">fieldnum</span>&nbsp;<span class="op" id="4952977">=</span>&nbsp;<span class="op" id="4952979">-</span><span class="num" id="4952980">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4952983">for</span>&nbsp;<span class="ident" id="4952987">state</span><span class="op" id="4952992">.</span><span class="ident" id="4952993">b</span><span class="op" id="4952994">.</span><span class="ident" id="4952995">Len</span><span class="op" id="4952998">(</span><span class="op" id="4952999">)</span>&nbsp;<span class="op" id="4953001">&gt;</span>&nbsp;<span class="num" id="4953003">0</span>&nbsp;<span class="op" id="4953005">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953009">delta</span>&nbsp;<span class="op" id="4953015">:=</span>&nbsp;<span class="builtintype" id="4953018">int</span><span class="op" id="4953021">(</span><span class="ident" id="4953022">state</span><span class="op" id="4953027">.</span><span class="ident" id="4953028">decodeUint</span><span class="op" id="4953038">(</span><span class="op" id="4953039">)</span><span class="op" id="4953040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4953044">if</span>&nbsp;<span class="ident" id="4953047">delta</span>&nbsp;<span class="op" id="4953053">&lt;</span>&nbsp;<span class="num" id="4953055">0</span>&nbsp;<span class="op" id="4953057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953062">errorf</span><span class="op" id="4953068">(</span><span class="string" id="4953069">&#34;ignore&nbsp;decode:&nbsp;corrupted&nbsp;data:&nbsp;negative&nbsp;delta&#34;</span><span class="op" id="4953116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4953120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4953124">if</span>&nbsp;<span class="ident" id="4953127">delta</span>&nbsp;<span class="op" id="4953133">==</span>&nbsp;<span class="num" id="4953136">0</span>&nbsp;<span class="op" id="4953138">{</span>&nbsp;<span class="comment" id="4953140">//&nbsp;struct&nbsp;terminator&nbsp;is&nbsp;zero&nbsp;delta&nbsp;fieldnum</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4953187">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4953195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953199">fieldnum</span>&nbsp;<span class="op" id="4953208">:=</span>&nbsp;<span class="ident" id="4953211">state</span><span class="op" id="4953216">.</span><span class="ident" id="4953217">fieldnum</span>&nbsp;<span class="op" id="4953226">+</span>&nbsp;<span class="ident" id="4953228">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4953236">if</span>&nbsp;<span class="ident" id="4953239">fieldnum</span>&nbsp;<span class="op" id="4953248">&gt;=</span>&nbsp;<span class="builtinfunc" id="4953251">len</span><span class="op" id="4953254">(</span><span class="ident" id="4953255">engine</span><span class="op" id="4953261">.</span><span class="ident" id="4953262">instr</span><span class="op" id="4953267">)</span>&nbsp;<span class="op" id="4953269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953274">error_</span><span class="op" id="4953280">(</span><span class="ident" id="4953281">errRange</span><span class="op" id="4953289">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4953293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953297">instr</span>&nbsp;<span class="op" id="4953303">:=</span>&nbsp;<span class="op" id="4953306">&amp;</span><span class="ident" id="4953307">engine</span><span class="op" id="4953313">.</span><span class="ident" id="4953314">instr</span><span class="op" id="4953319">[</span><span class="ident" id="4953320">fieldnum</span><span class="op" id="4953328">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953332">instr</span><span class="op" id="4953337">.</span><span class="ident" id="4953338">op</span><span class="op" id="4953340">(</span><span class="ident" id="4953341">instr</span><span class="op" id="4953346">,</span>&nbsp;<span class="ident" id="4953348">state</span><span class="op" id="4953353">,</span>&nbsp;<span class="ident" id="4953355">noValue</span><span class="op" id="4953362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953366">state</span><span class="op" id="4953371">.</span><span class="ident" id="4953372">fieldnum</span>&nbsp;<span class="op" id="4953381">=</span>&nbsp;<span class="ident" id="4953383">fieldnum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4953393">}</span><br>
<span class="lineno">495</span><span class="op" id="4953395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4953398">//&nbsp;ignoreSingle&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;top-level&nbsp;non-struct&nbsp;value&nbsp;with&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="4953473">//&nbsp;destination.&nbsp;It&#39;s&nbsp;used&nbsp;when&nbsp;calling&nbsp;Decode&nbsp;with&nbsp;a&nbsp;nil&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4953537">func</span>&nbsp;<span class="op" id="4953542">(</span><span class="ident" id="4953543">dec</span>&nbsp;<span class="op" id="4953547">*</span><span class="ident" id="4953548">Decoder</span><span class="op" id="4953555">)</span>&nbsp;<span class="ident" id="4953557">ignoreSingle</span><span class="op" id="4953569">(</span><span class="ident" id="4953570">engine</span>&nbsp;<span class="op" id="4953577">*</span><span class="ident" id="4953578">decEngine</span><span class="op" id="4953587">)</span>&nbsp;<span class="op" id="4953589">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953592">state</span>&nbsp;<span class="op" id="4953598">:=</span>&nbsp;<span class="ident" id="4953601">dec</span><span class="op" id="4953604">.</span><span class="ident" id="4953605">newDecoderState</span><span class="op" id="4953620">(</span><span class="op" id="4953621">&amp;</span><span class="ident" id="4953622">dec</span><span class="op" id="4953625">.</span><span class="ident" id="4953626">buf</span><span class="op" id="4953629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4953632">defer</span>&nbsp;<span class="ident" id="4953638">dec</span><span class="op" id="4953641">.</span><span class="ident" id="4953642">freeDecoderState</span><span class="op" id="4953658">(</span><span class="ident" id="4953659">state</span><span class="op" id="4953664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953667">state</span><span class="op" id="4953672">.</span><span class="ident" id="4953673">fieldnum</span>&nbsp;<span class="op" id="4953682">=</span>&nbsp;<span class="ident" id="4953684">singletonField</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953700">delta</span>&nbsp;<span class="op" id="4953706">:=</span>&nbsp;<span class="builtintype" id="4953709">int</span><span class="op" id="4953712">(</span><span class="ident" id="4953713">state</span><span class="op" id="4953718">.</span><span class="ident" id="4953719">decodeUint</span><span class="op" id="4953729">(</span><span class="op" id="4953730">)</span><span class="op" id="4953731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4953734">if</span>&nbsp;<span class="ident" id="4953737">delta</span>&nbsp;<span class="op" id="4953743">!=</span>&nbsp;<span class="num" id="4953746">0</span>&nbsp;<span class="op" id="4953748">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953752">errorf</span><span class="op" id="4953758">(</span><span class="string" id="4953759">&#34;decode:&nbsp;corrupted&nbsp;data:&nbsp;non-zero&nbsp;delta&nbsp;for&nbsp;singleton&#34;</span><span class="op" id="4953813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4953816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953819">instr</span>&nbsp;<span class="op" id="4953825">:=</span>&nbsp;<span class="op" id="4953828">&amp;</span><span class="ident" id="4953829">engine</span><span class="op" id="4953835">.</span><span class="ident" id="4953836">instr</span><span class="op" id="4953841">[</span><span class="ident" id="4953842">singletonField</span><span class="op" id="4953856">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953859">instr</span><span class="op" id="4953864">.</span><span class="ident" id="4953865">op</span><span class="op" id="4953867">(</span><span class="ident" id="4953868">instr</span><span class="op" id="4953873">,</span>&nbsp;<span class="ident" id="4953875">state</span><span class="op" id="4953880">,</span>&nbsp;<span class="ident" id="4953882">noValue</span><span class="op" id="4953889">)</span><br>
<span class="lineno"></span><span class="op" id="4953891">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span><span class="comment" id="4953894">//&nbsp;decodeArrayHelper&nbsp;does&nbsp;the&nbsp;work&nbsp;for&nbsp;decoding&nbsp;arrays&nbsp;and&nbsp;slices.</span><br>
<span class="lineno"></span><span class="keyword" id="4953961">func</span>&nbsp;<span class="op" id="4953966">(</span><span class="ident" id="4953967">dec</span>&nbsp;<span class="op" id="4953971">*</span><span class="ident" id="4953972">Decoder</span><span class="op" id="4953979">)</span>&nbsp;<span class="ident" id="4953981">decodeArrayHelper</span><span class="op" id="4953998">(</span><span class="ident" id="4953999">state</span>&nbsp;<span class="op" id="4954005">*</span><span class="ident" id="4954006">decoderState</span><span class="op" id="4954018">,</span>&nbsp;<span class="ident" id="4954020">value</span>&nbsp;<span class="ident" id="4954026">reflect</span><span class="op" id="4954033">.</span><span class="ident" id="4954034">Value</span><span class="op" id="4954039">,</span>&nbsp;<span class="ident" id="4954041">elemOp</span>&nbsp;<span class="ident" id="4954048">decOp</span><span class="op" id="4954053">,</span>&nbsp;<span class="ident" id="4954055">length</span>&nbsp;<span class="builtintype" id="4954062">int</span><span class="op" id="4954065">,</span>&nbsp;<span class="ident" id="4954067">ovfl</span>&nbsp;<span class="builtintype" id="4954072">error</span><span class="op" id="4954077">,</span>&nbsp;<span class="ident" id="4954079">helper</span>&nbsp;<span class="ident" id="4954086">decHelper</span><span class="op" id="4954095">)</span>&nbsp;<span class="op" id="4954097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4954100">if</span>&nbsp;<span class="ident" id="4954103">helper</span>&nbsp;<span class="op" id="4954110">!=</span>&nbsp;<span class="ident" id="4954113">nil</span>&nbsp;<span class="op" id="4954117">&amp;&amp;</span>&nbsp;<span class="ident" id="4954120">helper</span><span class="op" id="4954126">(</span><span class="ident" id="4954127">state</span><span class="op" id="4954132">,</span>&nbsp;<span class="ident" id="4954134">value</span><span class="op" id="4954139">,</span>&nbsp;<span class="ident" id="4954141">length</span><span class="op" id="4954147">,</span>&nbsp;<span class="ident" id="4954149">ovfl</span><span class="op" id="4954153">)</span>&nbsp;<span class="op" id="4954155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4954159">return</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4954167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4954170">instr</span>&nbsp;<span class="op" id="4954176">:=</span>&nbsp;<span class="op" id="4954179">&amp;</span><span class="ident" id="4954180">decInstr</span><span class="op" id="4954188">{</span><span class="ident" id="4954189">elemOp</span><span class="op" id="4954195">,</span>&nbsp;<span class="num" id="4954197">0</span><span class="op" id="4954198">,</span>&nbsp;<span class="ident" id="4954200">nil</span><span class="op" id="4954203">,</span>&nbsp;<span class="ident" id="4954205">ovfl</span><span class="op" id="4954209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4954212">isPtr</span>&nbsp;<span class="op" id="4954218">:=</span>&nbsp;<span class="ident" id="4954221">value</span><span class="op" id="4954226">.</span><span class="ident" id="4954227">Type</span><span class="op" id="4954231">(</span><span class="op" id="4954232">)</span><span class="op" id="4954233">.</span><span class="ident" id="4954234">Elem</span><span class="op" id="4954238">(</span><span class="op" id="4954239">)</span><span class="op" id="4954240">.</span><span class="ident" id="4954241">Kind</span><span class="op" id="4954245">(</span><span class="op" id="4954246">)</span>&nbsp;<span class="op" id="4954248">==</span>&nbsp;<span class="ident" id="4954251">reflect</span><span class="op" id="4954258">.</span><span class="ident" id="4954259">Ptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4954264">for</span>&nbsp;<span class="ident" id="4954268">i</span>&nbsp;<span class="op" id="4954270">:=</span>&nbsp;<span class="num" id="4954273">0</span><span class="op" id="4954274">;</span>&nbsp;<span class="ident" id="4954276">i</span>&nbsp;<span class="op" id="4954278">&lt;</span>&nbsp;<span class="ident" id="4954280">length</span><span class="op" id="4954286">;</span>&nbsp;<span class="ident" id="4954288">i</span><span class="op" id="4954289">++</span>&nbsp;<span class="op" id="4954292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4954296">if</span>&nbsp;<span class="ident" id="4954299">state</span><span class="op" id="4954304">.</span><span class="ident" id="4954305">b</span><span class="op" id="4954306">.</span><span class="ident" id="4954307">Len</span><span class="op" id="4954310">(</span><span class="op" id="4954311">)</span>&nbsp;<span class="op" id="4954313">==</span>&nbsp;<span class="num" id="4954316">0</span>&nbsp;<span class="op" id="4954318">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4954323">errorf</span><span class="op" id="4954329">(</span><span class="string" id="4954330">&#34;decoding&nbsp;array&nbsp;or&nbsp;slice:&nbsp;length&nbsp;exceeds&nbsp;input&nbsp;size&nbsp;(%d&nbsp;elements)&#34;</span><span class="op" id="4954396">,</span>&nbsp;<span class="ident" id="4954398">length</span><span class="op" id="4954404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4954408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4954412">v</span>&nbsp;<span class="op" id="4954414">:=</span>&nbsp;<span class="ident" id="4954417">value</span><span class="op" id="4954422">.</span><span class="ident" id="4954423">Index</span><span class="op" id="4954428">(</span><span class="ident" id="4954429">i</span><span class="op" id="4954430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4954434">if</span>&nbsp;<span class="ident" id="4954437">isPtr</span>&nbsp;<span class="op" id="4954443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4954448">v</span>&nbsp;<span class="op" id="4954450">=</span>&nbsp;<span class="ident" id="4954452">decAlloc</span><span class="op" id="4954460">(</span><span class="ident" id="4954461">v</span><span class="op" id="4954462">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4954466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4954470">elemOp</span><span class="op" id="4954476">(</span><span class="ident" id="4954477">instr</span><span class="op" id="4954482">,</span>&nbsp;<span class="ident" id="4954484">state</span><span class="op" id="4954489">,</span>&nbsp;<span class="ident" id="4954491">v</span><span class="op" id="4954492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4954495">}</span><br>
<span class="lineno"></span><span class="op" id="4954497">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="comment" id="4954500">//&nbsp;decodeArray&nbsp;decodes&nbsp;an&nbsp;array&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4954556">//&nbsp;The&nbsp;length&nbsp;is&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;preceding&nbsp;the&nbsp;elements.&nbsp;&nbsp;Even&nbsp;though&nbsp;the&nbsp;length&nbsp;is&nbsp;redundant</span><br>
<span class="lineno"></span><span class="comment" id="4954654">//&nbsp;(it&#39;s&nbsp;part&nbsp;of&nbsp;the&nbsp;type),&nbsp;it&#39;s&nbsp;a&nbsp;useful&nbsp;check&nbsp;and&nbsp;is&nbsp;included&nbsp;in&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="4954735">func</span>&nbsp;<span class="op" id="4954740">(</span><span class="ident" id="4954741">dec</span>&nbsp;<span class="op" id="4954745">*</span><span class="ident" id="4954746">Decoder</span><span class="op" id="4954753">)</span>&nbsp;<span class="ident" id="4954755">decodeArray</span><span class="op" id="4954766">(</span><span class="ident" id="4954767">atyp</span>&nbsp;<span class="ident" id="4954772">reflect</span><span class="op" id="4954779">.</span><span class="ident" id="4954780">Type</span><span class="op" id="4954784">,</span>&nbsp;<span class="ident" id="4954786">state</span>&nbsp;<span class="op" id="4954792">*</span><span class="ident" id="4954793">decoderState</span><span class="op" id="4954805">,</span>&nbsp;<span class="ident" id="4954807">value</span>&nbsp;<span class="ident" id="4954813">reflect</span><span class="op" id="4954820">.</span><span class="ident" id="4954821">Value</span><span class="op" id="4954826">,</span>&nbsp;<span class="ident" id="4954828">elemOp</span>&nbsp;<span class="ident" id="4954835">decOp</span><span class="op" id="4954840">,</span>&nbsp;<span class="ident" id="4954842">length</span>&nbsp;<span class="builtintype" id="4954849">int</span><span class="op" id="4954852">,</span>&nbsp;<span class="ident" id="4954854">ovfl</span>&nbsp;<span class="builtintype" id="4954859">error</span><span class="op" id="4954864">,</span>&nbsp;<span class="ident" id="4954866">helper</span>&nbsp;<span class="ident" id="4954873">decHelper</span><span class="op" id="4954882">)</span>&nbsp;<span class="op" id="4954884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4954887">if</span>&nbsp;<span class="ident" id="4954890">n</span>&nbsp;<span class="op" id="4954892">:=</span>&nbsp;<span class="ident" id="4954895">state</span><span class="op" id="4954900">.</span><span class="ident" id="4954901">decodeUint</span><span class="op" id="4954911">(</span><span class="op" id="4954912">)</span><span class="op" id="4954913">;</span>&nbsp;<span class="ident" id="4954915">n</span>&nbsp;<span class="op" id="4954917">!=</span>&nbsp;<span class="ident" id="4954920">uint64</span><span class="op" id="4954926">(</span><span class="ident" id="4954927">length</span><span class="op" id="4954933">)</span>&nbsp;<span class="op" id="4954935">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4954939">errorf</span><span class="op" id="4954945">(</span><span class="string" id="4954946">&#34;length&nbsp;mismatch&nbsp;in&nbsp;decodeArray&#34;</span><span class="op" id="4954978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4954981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4954984">dec</span><span class="op" id="4954987">.</span><span class="ident" id="4954988">decodeArrayHelper</span><span class="op" id="4955005">(</span><span class="ident" id="4955006">state</span><span class="op" id="4955011">,</span>&nbsp;<span class="ident" id="4955013">value</span><span class="op" id="4955018">,</span>&nbsp;<span class="ident" id="4955020">elemOp</span><span class="op" id="4955026">,</span>&nbsp;<span class="ident" id="4955028">length</span><span class="op" id="4955034">,</span>&nbsp;<span class="ident" id="4955036">ovfl</span><span class="op" id="4955040">,</span>&nbsp;<span class="ident" id="4955042">helper</span><span class="op" id="4955048">)</span><br>
<span class="lineno"></span><span class="op" id="4955050">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">540</span><span class="comment" id="4955053">//&nbsp;decodeIntoValue&nbsp;is&nbsp;a&nbsp;helper&nbsp;for&nbsp;map&nbsp;decoding.</span><br>
<span class="lineno"></span><span class="keyword" id="4955102">func</span>&nbsp;<span class="ident" id="4955107">decodeIntoValue</span><span class="op" id="4955122">(</span><span class="ident" id="4955123">state</span>&nbsp;<span class="op" id="4955129">*</span><span class="ident" id="4955130">decoderState</span><span class="op" id="4955142">,</span>&nbsp;<span class="ident" id="4955144">op</span>&nbsp;<span class="ident" id="4955147">decOp</span><span class="op" id="4955152">,</span>&nbsp;<span class="ident" id="4955154">isPtr</span>&nbsp;<span class="builtintype" id="4955160">bool</span><span class="op" id="4955164">,</span>&nbsp;<span class="ident" id="4955166">value</span>&nbsp;<span class="ident" id="4955172">reflect</span><span class="op" id="4955179">.</span><span class="ident" id="4955180">Value</span><span class="op" id="4955185">,</span>&nbsp;<span class="ident" id="4955187">ovfl</span>&nbsp;<span class="builtintype" id="4955192">error</span><span class="op" id="4955197">)</span>&nbsp;<span class="ident" id="4955199">reflect</span><span class="op" id="4955206">.</span><span class="ident" id="4955207">Value</span>&nbsp;<span class="op" id="4955213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4955216">instr</span>&nbsp;<span class="op" id="4955222">:=</span>&nbsp;<span class="op" id="4955225">&amp;</span><span class="ident" id="4955226">decInstr</span><span class="op" id="4955234">{</span><span class="ident" id="4955235">op</span><span class="op" id="4955237">,</span>&nbsp;<span class="num" id="4955239">0</span><span class="op" id="4955240">,</span>&nbsp;<span class="ident" id="4955242">nil</span><span class="op" id="4955245">,</span>&nbsp;<span class="ident" id="4955247">ovfl</span><span class="op" id="4955251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4955254">v</span>&nbsp;<span class="op" id="4955256">:=</span>&nbsp;<span class="ident" id="4955259">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4955266">if</span>&nbsp;<span class="ident" id="4955269">isPtr</span>&nbsp;<span class="op" id="4955275">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4955279">v</span>&nbsp;<span class="op" id="4955281">=</span>&nbsp;<span class="ident" id="4955283">decAlloc</span><span class="op" id="4955291">(</span><span class="ident" id="4955292">value</span><span class="op" id="4955297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4955300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4955303">op</span><span class="op" id="4955305">(</span><span class="ident" id="4955306">instr</span><span class="op" id="4955311">,</span>&nbsp;<span class="ident" id="4955313">state</span><span class="op" id="4955318">,</span>&nbsp;<span class="ident" id="4955320">v</span><span class="op" id="4955321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4955324">return</span>&nbsp;<span class="ident" id="4955331">value</span><br>
<span class="lineno"></span><span class="op" id="4955337">}</span><br>
<span class="lineno">550</span><br>
<span class="lineno"></span><span class="comment" id="4955340">//&nbsp;decodeMap&nbsp;decodes&nbsp;a&nbsp;map&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4955391">//&nbsp;Maps&nbsp;are&nbsp;encoded&nbsp;as&nbsp;a&nbsp;length&nbsp;followed&nbsp;by&nbsp;key:value&nbsp;pairs.</span><br>
<span class="lineno"></span><span class="comment" id="4955452">//&nbsp;Because&nbsp;the&nbsp;internals&nbsp;of&nbsp;maps&nbsp;are&nbsp;not&nbsp;visible&nbsp;to&nbsp;us,&nbsp;we&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="4955516">//&nbsp;use&nbsp;reflection&nbsp;rather&nbsp;than&nbsp;pointer&nbsp;magic.</span><br>
<span class="lineno">555</span><span class="keyword" id="4955561">func</span>&nbsp;<span class="op" id="4955566">(</span><span class="ident" id="4955567">dec</span>&nbsp;<span class="op" id="4955571">*</span><span class="ident" id="4955572">Decoder</span><span class="op" id="4955579">)</span>&nbsp;<span class="ident" id="4955581">decodeMap</span><span class="op" id="4955590">(</span><span class="ident" id="4955591">mtyp</span>&nbsp;<span class="ident" id="4955596">reflect</span><span class="op" id="4955603">.</span><span class="ident" id="4955604">Type</span><span class="op" id="4955608">,</span>&nbsp;<span class="ident" id="4955610">state</span>&nbsp;<span class="op" id="4955616">*</span><span class="ident" id="4955617">decoderState</span><span class="op" id="4955629">,</span>&nbsp;<span class="ident" id="4955631">value</span>&nbsp;<span class="ident" id="4955637">reflect</span><span class="op" id="4955644">.</span><span class="ident" id="4955645">Value</span><span class="op" id="4955650">,</span>&nbsp;<span class="ident" id="4955652">keyOp</span><span class="op" id="4955657">,</span>&nbsp;<span class="ident" id="4955659">elemOp</span>&nbsp;<span class="ident" id="4955666">decOp</span><span class="op" id="4955671">,</span>&nbsp;<span class="ident" id="4955673">ovfl</span>&nbsp;<span class="builtintype" id="4955678">error</span><span class="op" id="4955683">)</span>&nbsp;<span class="op" id="4955685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4955688">if</span>&nbsp;<span class="ident" id="4955691">value</span><span class="op" id="4955696">.</span><span class="ident" id="4955697">IsNil</span><span class="op" id="4955702">(</span><span class="op" id="4955703">)</span>&nbsp;<span class="op" id="4955705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4955709">//&nbsp;Allocate&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4955728">value</span><span class="op" id="4955733">.</span><span class="ident" id="4955734">Set</span><span class="op" id="4955737">(</span><span class="ident" id="4955738">reflect</span><span class="op" id="4955745">.</span><span class="ident" id="4955746">MakeMap</span><span class="op" id="4955753">(</span><span class="ident" id="4955754">mtyp</span><span class="op" id="4955758">)</span><span class="op" id="4955759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4955762">}</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4955765">n</span>&nbsp;<span class="op" id="4955767">:=</span>&nbsp;<span class="builtintype" id="4955770">int</span><span class="op" id="4955773">(</span><span class="ident" id="4955774">state</span><span class="op" id="4955779">.</span><span class="ident" id="4955780">decodeUint</span><span class="op" id="4955790">(</span><span class="op" id="4955791">)</span><span class="op" id="4955792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4955795">keyIsPtr</span>&nbsp;<span class="op" id="4955804">:=</span>&nbsp;<span class="ident" id="4955807">mtyp</span><span class="op" id="4955811">.</span><span class="ident" id="4955812">Key</span><span class="op" id="4955815">(</span><span class="op" id="4955816">)</span><span class="op" id="4955817">.</span><span class="ident" id="4955818">Kind</span><span class="op" id="4955822">(</span><span class="op" id="4955823">)</span>&nbsp;<span class="op" id="4955825">==</span>&nbsp;<span class="ident" id="4955828">reflect</span><span class="op" id="4955835">.</span><span class="ident" id="4955836">Ptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4955841">elemIsPtr</span>&nbsp;<span class="op" id="4955851">:=</span>&nbsp;<span class="ident" id="4955854">mtyp</span><span class="op" id="4955858">.</span><span class="ident" id="4955859">Elem</span><span class="op" id="4955863">(</span><span class="op" id="4955864">)</span><span class="op" id="4955865">.</span><span class="ident" id="4955866">Kind</span><span class="op" id="4955870">(</span><span class="op" id="4955871">)</span>&nbsp;<span class="op" id="4955873">==</span>&nbsp;<span class="ident" id="4955876">reflect</span><span class="op" id="4955883">.</span><span class="ident" id="4955884">Ptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4955889">for</span>&nbsp;<span class="ident" id="4955893">i</span>&nbsp;<span class="op" id="4955895">:=</span>&nbsp;<span class="num" id="4955898">0</span><span class="op" id="4955899">;</span>&nbsp;<span class="ident" id="4955901">i</span>&nbsp;<span class="op" id="4955903">&lt;</span>&nbsp;<span class="ident" id="4955905">n</span><span class="op" id="4955906">;</span>&nbsp;<span class="ident" id="4955908">i</span><span class="op" id="4955909">++</span>&nbsp;<span class="op" id="4955912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4955916">key</span>&nbsp;<span class="op" id="4955920">:=</span>&nbsp;<span class="ident" id="4955923">decodeIntoValue</span><span class="op" id="4955938">(</span><span class="ident" id="4955939">state</span><span class="op" id="4955944">,</span>&nbsp;<span class="ident" id="4955946">keyOp</span><span class="op" id="4955951">,</span>&nbsp;<span class="ident" id="4955953">keyIsPtr</span><span class="op" id="4955961">,</span>&nbsp;<span class="ident" id="4955963">allocValue</span><span class="op" id="4955973">(</span><span class="ident" id="4955974">mtyp</span><span class="op" id="4955978">.</span><span class="ident" id="4955979">Key</span><span class="op" id="4955982">(</span><span class="op" id="4955983">)</span><span class="op" id="4955984">)</span><span class="op" id="4955985">,</span>&nbsp;<span class="ident" id="4955987">ovfl</span><span class="op" id="4955991">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4955995">elem</span>&nbsp;<span class="op" id="4956000">:=</span>&nbsp;<span class="ident" id="4956003">decodeIntoValue</span><span class="op" id="4956018">(</span><span class="ident" id="4956019">state</span><span class="op" id="4956024">,</span>&nbsp;<span class="ident" id="4956026">elemOp</span><span class="op" id="4956032">,</span>&nbsp;<span class="ident" id="4956034">elemIsPtr</span><span class="op" id="4956043">,</span>&nbsp;<span class="ident" id="4956045">allocValue</span><span class="op" id="4956055">(</span><span class="ident" id="4956056">mtyp</span><span class="op" id="4956060">.</span><span class="ident" id="4956061">Elem</span><span class="op" id="4956065">(</span><span class="op" id="4956066">)</span><span class="op" id="4956067">)</span><span class="op" id="4956068">,</span>&nbsp;<span class="ident" id="4956070">ovfl</span><span class="op" id="4956074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4956078">value</span><span class="op" id="4956083">.</span><span class="ident" id="4956084">SetMapIndex</span><span class="op" id="4956095">(</span><span class="ident" id="4956096">key</span><span class="op" id="4956099">,</span>&nbsp;<span class="ident" id="4956101">elem</span><span class="op" id="4956105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4956108">}</span><br>
<span class="lineno"></span><span class="op" id="4956110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">570</span><span class="comment" id="4956113">//&nbsp;ignoreArrayHelper&nbsp;does&nbsp;the&nbsp;work&nbsp;for&nbsp;discarding&nbsp;arrays&nbsp;and&nbsp;slices.</span><br>
<span class="lineno"></span><span class="keyword" id="4956182">func</span>&nbsp;<span class="op" id="4956187">(</span><span class="ident" id="4956188">dec</span>&nbsp;<span class="op" id="4956192">*</span><span class="ident" id="4956193">Decoder</span><span class="op" id="4956200">)</span>&nbsp;<span class="ident" id="4956202">ignoreArrayHelper</span><span class="op" id="4956219">(</span><span class="ident" id="4956220">state</span>&nbsp;<span class="op" id="4956226">*</span><span class="ident" id="4956227">decoderState</span><span class="op" id="4956239">,</span>&nbsp;<span class="ident" id="4956241">elemOp</span>&nbsp;<span class="ident" id="4956248">decOp</span><span class="op" id="4956253">,</span>&nbsp;<span class="ident" id="4956255">length</span>&nbsp;<span class="builtintype" id="4956262">int</span><span class="op" id="4956265">)</span>&nbsp;<span class="op" id="4956267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4956270">instr</span>&nbsp;<span class="op" id="4956276">:=</span>&nbsp;<span class="op" id="4956279">&amp;</span><span class="ident" id="4956280">decInstr</span><span class="op" id="4956288">{</span><span class="ident" id="4956289">elemOp</span><span class="op" id="4956295">,</span>&nbsp;<span class="num" id="4956297">0</span><span class="op" id="4956298">,</span>&nbsp;<span class="ident" id="4956300">nil</span><span class="op" id="4956303">,</span>&nbsp;<span class="ident" id="4956305">errors</span><span class="op" id="4956311">.</span><span class="ident" id="4956312">New</span><span class="op" id="4956315">(</span><span class="string" id="4956316">&#34;no&nbsp;error&#34;</span><span class="op" id="4956326">)</span><span class="op" id="4956327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4956330">for</span>&nbsp;<span class="ident" id="4956334">i</span>&nbsp;<span class="op" id="4956336">:=</span>&nbsp;<span class="num" id="4956339">0</span><span class="op" id="4956340">;</span>&nbsp;<span class="ident" id="4956342">i</span>&nbsp;<span class="op" id="4956344">&lt;</span>&nbsp;<span class="ident" id="4956346">length</span><span class="op" id="4956352">;</span>&nbsp;<span class="ident" id="4956354">i</span><span class="op" id="4956355">++</span>&nbsp;<span class="op" id="4956358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4956362">elemOp</span><span class="op" id="4956368">(</span><span class="ident" id="4956369">instr</span><span class="op" id="4956374">,</span>&nbsp;<span class="ident" id="4956376">state</span><span class="op" id="4956381">,</span>&nbsp;<span class="ident" id="4956383">noValue</span><span class="op" id="4956390">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4956393">}</span><br>
<span class="lineno"></span><span class="op" id="4956395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4956398">//&nbsp;ignoreArray&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;an&nbsp;array&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="4956471">func</span>&nbsp;<span class="op" id="4956476">(</span><span class="ident" id="4956477">dec</span>&nbsp;<span class="op" id="4956481">*</span><span class="ident" id="4956482">Decoder</span><span class="op" id="4956489">)</span>&nbsp;<span class="ident" id="4956491">ignoreArray</span><span class="op" id="4956502">(</span><span class="ident" id="4956503">state</span>&nbsp;<span class="op" id="4956509">*</span><span class="ident" id="4956510">decoderState</span><span class="op" id="4956522">,</span>&nbsp;<span class="ident" id="4956524">elemOp</span>&nbsp;<span class="ident" id="4956531">decOp</span><span class="op" id="4956536">,</span>&nbsp;<span class="ident" id="4956538">length</span>&nbsp;<span class="builtintype" id="4956545">int</span><span class="op" id="4956548">)</span>&nbsp;<span class="op" id="4956550">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4956553">if</span>&nbsp;<span class="ident" id="4956556">n</span>&nbsp;<span class="op" id="4956558">:=</span>&nbsp;<span class="ident" id="4956561">state</span><span class="op" id="4956566">.</span><span class="ident" id="4956567">decodeUint</span><span class="op" id="4956577">(</span><span class="op" id="4956578">)</span><span class="op" id="4956579">;</span>&nbsp;<span class="ident" id="4956581">n</span>&nbsp;<span class="op" id="4956583">!=</span>&nbsp;<span class="ident" id="4956586">uint64</span><span class="op" id="4956592">(</span><span class="ident" id="4956593">length</span><span class="op" id="4956599">)</span>&nbsp;<span class="op" id="4956601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4956605">errorf</span><span class="op" id="4956611">(</span><span class="string" id="4956612">&#34;length&nbsp;mismatch&nbsp;in&nbsp;ignoreArray&#34;</span><span class="op" id="4956644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4956647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4956650">dec</span><span class="op" id="4956653">.</span><span class="ident" id="4956654">ignoreArrayHelper</span><span class="op" id="4956671">(</span><span class="ident" id="4956672">state</span><span class="op" id="4956677">,</span>&nbsp;<span class="ident" id="4956679">elemOp</span><span class="op" id="4956685">,</span>&nbsp;<span class="ident" id="4956687">length</span><span class="op" id="4956693">)</span><br>
<span class="lineno"></span><span class="op" id="4956695">}</span><br>
<span class="lineno">585</span><br>
<span class="lineno"></span><span class="comment" id="4956698">//&nbsp;ignoreMap&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;map&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="4956766">func</span>&nbsp;<span class="op" id="4956771">(</span><span class="ident" id="4956772">dec</span>&nbsp;<span class="op" id="4956776">*</span><span class="ident" id="4956777">Decoder</span><span class="op" id="4956784">)</span>&nbsp;<span class="ident" id="4956786">ignoreMap</span><span class="op" id="4956795">(</span><span class="ident" id="4956796">state</span>&nbsp;<span class="op" id="4956802">*</span><span class="ident" id="4956803">decoderState</span><span class="op" id="4956815">,</span>&nbsp;<span class="ident" id="4956817">keyOp</span><span class="op" id="4956822">,</span>&nbsp;<span class="ident" id="4956824">elemOp</span>&nbsp;<span class="ident" id="4956831">decOp</span><span class="op" id="4956836">)</span>&nbsp;<span class="op" id="4956838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4956841">n</span>&nbsp;<span class="op" id="4956843">:=</span>&nbsp;<span class="builtintype" id="4956846">int</span><span class="op" id="4956849">(</span><span class="ident" id="4956850">state</span><span class="op" id="4956855">.</span><span class="ident" id="4956856">decodeUint</span><span class="op" id="4956866">(</span><span class="op" id="4956867">)</span><span class="op" id="4956868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4956871">keyInstr</span>&nbsp;<span class="op" id="4956880">:=</span>&nbsp;<span class="op" id="4956883">&amp;</span><span class="ident" id="4956884">decInstr</span><span class="op" id="4956892">{</span><span class="ident" id="4956893">keyOp</span><span class="op" id="4956898">,</span>&nbsp;<span class="num" id="4956900">0</span><span class="op" id="4956901">,</span>&nbsp;<span class="ident" id="4956903">nil</span><span class="op" id="4956906">,</span>&nbsp;<span class="ident" id="4956908">errors</span><span class="op" id="4956914">.</span><span class="ident" id="4956915">New</span><span class="op" id="4956918">(</span><span class="string" id="4956919">&#34;no&nbsp;error&#34;</span><span class="op" id="4956929">)</span><span class="op" id="4956930">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4956933">elemInstr</span>&nbsp;<span class="op" id="4956943">:=</span>&nbsp;<span class="op" id="4956946">&amp;</span><span class="ident" id="4956947">decInstr</span><span class="op" id="4956955">{</span><span class="ident" id="4956956">elemOp</span><span class="op" id="4956962">,</span>&nbsp;<span class="num" id="4956964">0</span><span class="op" id="4956965">,</span>&nbsp;<span class="ident" id="4956967">nil</span><span class="op" id="4956970">,</span>&nbsp;<span class="ident" id="4956972">errors</span><span class="op" id="4956978">.</span><span class="ident" id="4956979">New</span><span class="op" id="4956982">(</span><span class="string" id="4956983">&#34;no&nbsp;error&#34;</span><span class="op" id="4956993">)</span><span class="op" id="4956994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4956997">for</span>&nbsp;<span class="ident" id="4957001">i</span>&nbsp;<span class="op" id="4957003">:=</span>&nbsp;<span class="num" id="4957006">0</span><span class="op" id="4957007">;</span>&nbsp;<span class="ident" id="4957009">i</span>&nbsp;<span class="op" id="4957011">&lt;</span>&nbsp;<span class="ident" id="4957013">n</span><span class="op" id="4957014">;</span>&nbsp;<span class="ident" id="4957016">i</span><span class="op" id="4957017">++</span>&nbsp;<span class="op" id="4957020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4957024">keyOp</span><span class="op" id="4957029">(</span><span class="ident" id="4957030">keyInstr</span><span class="op" id="4957038">,</span>&nbsp;<span class="ident" id="4957040">state</span><span class="op" id="4957045">,</span>&nbsp;<span class="ident" id="4957047">noValue</span><span class="op" id="4957054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4957058">elemOp</span><span class="op" id="4957064">(</span><span class="ident" id="4957065">elemInstr</span><span class="op" id="4957074">,</span>&nbsp;<span class="ident" id="4957076">state</span><span class="op" id="4957081">,</span>&nbsp;<span class="ident" id="4957083">noValue</span><span class="op" id="4957090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4957093">}</span><br>
<span class="lineno">595</span><span class="op" id="4957095">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4957098">//&nbsp;decodeSlice&nbsp;decodes&nbsp;a&nbsp;slice&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4957153">//&nbsp;Slices&nbsp;are&nbsp;encoded&nbsp;as&nbsp;an&nbsp;unsigned&nbsp;length&nbsp;followed&nbsp;by&nbsp;the&nbsp;elements.</span><br>
<span class="lineno"></span><span class="keyword" id="4957223">func</span>&nbsp;<span class="op" id="4957228">(</span><span class="ident" id="4957229">dec</span>&nbsp;<span class="op" id="4957233">*</span><span class="ident" id="4957234">Decoder</span><span class="op" id="4957241">)</span>&nbsp;<span class="ident" id="4957243">decodeSlice</span><span class="op" id="4957254">(</span><span class="ident" id="4957255">state</span>&nbsp;<span class="op" id="4957261">*</span><span class="ident" id="4957262">decoderState</span><span class="op" id="4957274">,</span>&nbsp;<span class="ident" id="4957276">value</span>&nbsp;<span class="ident" id="4957282">reflect</span><span class="op" id="4957289">.</span><span class="ident" id="4957290">Value</span><span class="op" id="4957295">,</span>&nbsp;<span class="ident" id="4957297">elemOp</span>&nbsp;<span class="ident" id="4957304">decOp</span><span class="op" id="4957309">,</span>&nbsp;<span class="ident" id="4957311">ovfl</span>&nbsp;<span class="builtintype" id="4957316">error</span><span class="op" id="4957321">,</span>&nbsp;<span class="ident" id="4957323">helper</span>&nbsp;<span class="ident" id="4957330">decHelper</span><span class="op" id="4957339">)</span>&nbsp;<span class="op" id="4957341">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4957344">u</span>&nbsp;<span class="op" id="4957346">:=</span>&nbsp;<span class="ident" id="4957349">state</span><span class="op" id="4957354">.</span><span class="ident" id="4957355">decodeUint</span><span class="op" id="4957365">(</span><span class="op" id="4957366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4957369">typ</span>&nbsp;<span class="op" id="4957373">:=</span>&nbsp;<span class="ident" id="4957376">value</span><span class="op" id="4957381">.</span><span class="ident" id="4957382">Type</span><span class="op" id="4957386">(</span><span class="op" id="4957387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4957390">size</span>&nbsp;<span class="op" id="4957395">:=</span>&nbsp;<span class="ident" id="4957398">uint64</span><span class="op" id="4957404">(</span><span class="ident" id="4957405">typ</span><span class="op" id="4957408">.</span><span class="ident" id="4957409">Elem</span><span class="op" id="4957413">(</span><span class="op" id="4957414">)</span><span class="op" id="4957415">.</span><span class="ident" id="4957416">Size</span><span class="op" id="4957420">(</span><span class="op" id="4957421">)</span><span class="op" id="4957422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4957425">nBytes</span>&nbsp;<span class="op" id="4957432">:=</span>&nbsp;<span class="ident" id="4957435">u</span>&nbsp;<span class="op" id="4957437">*</span>&nbsp;<span class="ident" id="4957439">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4957445">n</span>&nbsp;<span class="op" id="4957447">:=</span>&nbsp;<span class="builtintype" id="4957450">int</span><span class="op" id="4957453">(</span><span class="ident" id="4957454">u</span><span class="op" id="4957455">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4957458">//&nbsp;Take&nbsp;care&nbsp;with&nbsp;overflow&nbsp;in&nbsp;this&nbsp;calculation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4957507">if</span>&nbsp;<span class="ident" id="4957510">n</span>&nbsp;<span class="op" id="4957512">&lt;</span>&nbsp;<span class="num" id="4957514">0</span>&nbsp;<span class="op" id="4957516">||</span>&nbsp;<span class="ident" id="4957519">uint64</span><span class="op" id="4957525">(</span><span class="ident" id="4957526">n</span><span class="op" id="4957527">)</span>&nbsp;<span class="op" id="4957529">!=</span>&nbsp;<span class="ident" id="4957532">u</span>&nbsp;<span class="op" id="4957534">||</span>&nbsp;<span class="ident" id="4957537">nBytes</span>&nbsp;<span class="op" id="4957544">&gt;</span>&nbsp;<span class="ident" id="4957546">tooBig</span>&nbsp;<span class="op" id="4957553">||</span>&nbsp;<span class="op" id="4957556">(</span><span class="ident" id="4957557">size</span>&nbsp;<span class="op" id="4957562">&gt;</span>&nbsp;<span class="num" id="4957564">0</span>&nbsp;<span class="op" id="4957566">&amp;&amp;</span>&nbsp;<span class="ident" id="4957569">nBytes</span><span class="op" id="4957575">/</span><span class="ident" id="4957576">size</span>&nbsp;<span class="op" id="4957581">!=</span>&nbsp;<span class="ident" id="4957584">u</span><span class="op" id="4957585">)</span>&nbsp;<span class="op" id="4957587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4957591">//&nbsp;We&nbsp;don&#39;t&nbsp;check&nbsp;n&nbsp;against&nbsp;buffer&nbsp;length&nbsp;here&nbsp;because&nbsp;if&nbsp;it&#39;s&nbsp;a&nbsp;slice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4957664">//&nbsp;of&nbsp;interfaces,&nbsp;there&nbsp;will&nbsp;be&nbsp;buffer&nbsp;reloads.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4957714">errorf</span><span class="op" id="4957720">(</span><span class="string" id="4957721">&#34;%s&nbsp;slice&nbsp;too&nbsp;big:&nbsp;%d&nbsp;elements&nbsp;of&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="4957764">,</span>&nbsp;<span class="ident" id="4957766">typ</span><span class="op" id="4957769">.</span><span class="ident" id="4957770">Elem</span><span class="op" id="4957774">(</span><span class="op" id="4957775">)</span><span class="op" id="4957776">,</span>&nbsp;<span class="ident" id="4957778">u</span><span class="op" id="4957779">,</span>&nbsp;<span class="ident" id="4957781">size</span><span class="op" id="4957785">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4957788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4957791">if</span>&nbsp;<span class="ident" id="4957794">value</span><span class="op" id="4957799">.</span><span class="ident" id="4957800">Cap</span><span class="op" id="4957803">(</span><span class="op" id="4957804">)</span>&nbsp;<span class="op" id="4957806">&lt;</span>&nbsp;<span class="ident" id="4957808">n</span>&nbsp;<span class="op" id="4957810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4957814">value</span><span class="op" id="4957819">.</span><span class="ident" id="4957820">Set</span><span class="op" id="4957823">(</span><span class="ident" id="4957824">reflect</span><span class="op" id="4957831">.</span><span class="ident" id="4957832">MakeSlice</span><span class="op" id="4957841">(</span><span class="ident" id="4957842">typ</span><span class="op" id="4957845">,</span>&nbsp;<span class="ident" id="4957847">n</span><span class="op" id="4957848">,</span>&nbsp;<span class="ident" id="4957850">n</span><span class="op" id="4957851">)</span><span class="op" id="4957852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4957855">}</span>&nbsp;<span class="keyword" id="4957857">else</span>&nbsp;<span class="op" id="4957862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4957866">value</span><span class="op" id="4957871">.</span><span class="ident" id="4957872">Set</span><span class="op" id="4957875">(</span><span class="ident" id="4957876">value</span><span class="op" id="4957881">.</span><span class="ident" id="4957882">Slice</span><span class="op" id="4957887">(</span><span class="num" id="4957888">0</span><span class="op" id="4957889">,</span>&nbsp;<span class="ident" id="4957891">n</span><span class="op" id="4957892">)</span><span class="op" id="4957893">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4957896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4957899">dec</span><span class="op" id="4957902">.</span><span class="ident" id="4957903">decodeArrayHelper</span><span class="op" id="4957920">(</span><span class="ident" id="4957921">state</span><span class="op" id="4957926">,</span>&nbsp;<span class="ident" id="4957928">value</span><span class="op" id="4957933">,</span>&nbsp;<span class="ident" id="4957935">elemOp</span><span class="op" id="4957941">,</span>&nbsp;<span class="ident" id="4957943">n</span><span class="op" id="4957944">,</span>&nbsp;<span class="ident" id="4957946">ovfl</span><span class="op" id="4957950">,</span>&nbsp;<span class="ident" id="4957952">helper</span><span class="op" id="4957958">)</span><br>
<span class="lineno"></span><span class="op" id="4957960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4957963">//&nbsp;ignoreSlice&nbsp;skips&nbsp;over&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;slice&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno">620</span><span class="keyword" id="4958037">func</span>&nbsp;<span class="op" id="4958042">(</span><span class="ident" id="4958043">dec</span>&nbsp;<span class="op" id="4958047">*</span><span class="ident" id="4958048">Decoder</span><span class="op" id="4958055">)</span>&nbsp;<span class="ident" id="4958057">ignoreSlice</span><span class="op" id="4958068">(</span><span class="ident" id="4958069">state</span>&nbsp;<span class="op" id="4958075">*</span><span class="ident" id="4958076">decoderState</span><span class="op" id="4958088">,</span>&nbsp;<span class="ident" id="4958090">elemOp</span>&nbsp;<span class="ident" id="4958097">decOp</span><span class="op" id="4958102">)</span>&nbsp;<span class="op" id="4958104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4958107">dec</span><span class="op" id="4958110">.</span><span class="ident" id="4958111">ignoreArrayHelper</span><span class="op" id="4958128">(</span><span class="ident" id="4958129">state</span><span class="op" id="4958134">,</span>&nbsp;<span class="ident" id="4958136">elemOp</span><span class="op" id="4958142">,</span>&nbsp;<span class="builtintype" id="4958144">int</span><span class="op" id="4958147">(</span><span class="ident" id="4958148">state</span><span class="op" id="4958153">.</span><span class="ident" id="4958154">decodeUint</span><span class="op" id="4958164">(</span><span class="op" id="4958165">)</span><span class="op" id="4958166">)</span><span class="op" id="4958167">)</span><br>
<span class="lineno"></span><span class="op" id="4958169">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4958172">//&nbsp;decodeInterface&nbsp;decodes&nbsp;an&nbsp;interface&nbsp;value&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno">625</span><span class="comment" id="4958242">//&nbsp;Interfaces&nbsp;are&nbsp;encoded&nbsp;as&nbsp;the&nbsp;name&nbsp;of&nbsp;a&nbsp;concrete&nbsp;type&nbsp;followed&nbsp;by&nbsp;a&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4958320">//&nbsp;If&nbsp;the&nbsp;name&nbsp;is&nbsp;empty,&nbsp;the&nbsp;value&nbsp;is&nbsp;nil&nbsp;and&nbsp;no&nbsp;value&nbsp;is&nbsp;sent.</span><br>
<span class="lineno"></span><span class="keyword" id="4958384">func</span>&nbsp;<span class="op" id="4958389">(</span><span class="ident" id="4958390">dec</span>&nbsp;<span class="op" id="4958394">*</span><span class="ident" id="4958395">Decoder</span><span class="op" id="4958402">)</span>&nbsp;<span class="ident" id="4958404">decodeInterface</span><span class="op" id="4958419">(</span><span class="ident" id="4958420">ityp</span>&nbsp;<span class="ident" id="4958425">reflect</span><span class="op" id="4958432">.</span><span class="ident" id="4958433">Type</span><span class="op" id="4958437">,</span>&nbsp;<span class="ident" id="4958439">state</span>&nbsp;<span class="op" id="4958445">*</span><span class="ident" id="4958446">decoderState</span><span class="op" id="4958458">,</span>&nbsp;<span class="ident" id="4958460">value</span>&nbsp;<span class="ident" id="4958466">reflect</span><span class="op" id="4958473">.</span><span class="ident" id="4958474">Value</span><span class="op" id="4958479">)</span>&nbsp;<span class="op" id="4958481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4958484">//&nbsp;Read&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4958524">nr</span>&nbsp;<span class="op" id="4958527">:=</span>&nbsp;<span class="ident" id="4958530">state</span><span class="op" id="4958535">.</span><span class="ident" id="4958536">decodeUint</span><span class="op" id="4958546">(</span><span class="op" id="4958547">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958550">if</span>&nbsp;<span class="ident" id="4958553">nr</span>&nbsp;<span class="op" id="4958556">&lt;</span>&nbsp;<span class="num" id="4958558">0</span>&nbsp;<span class="op" id="4958560">||</span>&nbsp;<span class="ident" id="4958563">nr</span>&nbsp;<span class="op" id="4958566">&gt;</span>&nbsp;<span class="num" id="4958568">1</span><span class="op" id="4958569">&lt;&lt;</span><span class="num" id="4958571">31</span>&nbsp;<span class="op" id="4958574">{</span>&nbsp;<span class="comment" id="4958576">//&nbsp;zero&nbsp;is&nbsp;permissible&nbsp;for&nbsp;anonymous&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4958621">errorf</span><span class="op" id="4958627">(</span><span class="string" id="4958628">&#34;invalid&nbsp;type&nbsp;name&nbsp;length&nbsp;%d&#34;</span><span class="op" id="4958657">,</span>&nbsp;<span class="ident" id="4958659">nr</span><span class="op" id="4958661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4958664">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958667">if</span>&nbsp;<span class="ident" id="4958670">nr</span>&nbsp;<span class="op" id="4958673">&gt;</span>&nbsp;<span class="ident" id="4958675">uint64</span><span class="op" id="4958681">(</span><span class="ident" id="4958682">state</span><span class="op" id="4958687">.</span><span class="ident" id="4958688">b</span><span class="op" id="4958689">.</span><span class="ident" id="4958690">Len</span><span class="op" id="4958693">(</span><span class="op" id="4958694">)</span><span class="op" id="4958695">)</span>&nbsp;<span class="op" id="4958697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4958701">errorf</span><span class="op" id="4958707">(</span><span class="string" id="4958708">&#34;invalid&nbsp;type&nbsp;name&nbsp;length&nbsp;%d:&nbsp;exceeds&nbsp;input&nbsp;size&#34;</span><span class="op" id="4958757">,</span>&nbsp;<span class="ident" id="4958759">nr</span><span class="op" id="4958761">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4958764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4958767">b</span>&nbsp;<span class="op" id="4958769">:=</span>&nbsp;<span class="builtinfunc" id="4958772">make</span><span class="op" id="4958776">(</span><span class="op" id="4958777">[</span><span class="op" id="4958778">]</span><span class="builtintype" id="4958779">byte</span><span class="op" id="4958783">,</span>&nbsp;<span class="ident" id="4958785">nr</span><span class="op" id="4958787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4958790">state</span><span class="op" id="4958795">.</span><span class="ident" id="4958796">b</span><span class="op" id="4958797">.</span><span class="ident" id="4958798">Read</span><span class="op" id="4958802">(</span><span class="ident" id="4958803">b</span><span class="op" id="4958804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4958807">name</span>&nbsp;<span class="op" id="4958812">:=</span>&nbsp;<span class="builtintype" id="4958815">string</span><span class="op" id="4958821">(</span><span class="ident" id="4958822">b</span><span class="op" id="4958823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4958826">//&nbsp;Allocate&nbsp;the&nbsp;destination&nbsp;interface&nbsp;value.</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958872">if</span>&nbsp;<span class="ident" id="4958875">name</span>&nbsp;<span class="op" id="4958880">==</span>&nbsp;<span class="string" id="4958883">&#34;&#34;</span>&nbsp;<span class="op" id="4958886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4958890">//&nbsp;Copy&nbsp;the&nbsp;nil&nbsp;interface&nbsp;value&nbsp;to&nbsp;the&nbsp;target.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4958939">value</span><span class="op" id="4958944">.</span><span class="ident" id="4958945">Set</span><span class="op" id="4958948">(</span><span class="ident" id="4958949">reflect</span><span class="op" id="4958956">.</span><span class="ident" id="4958957">Zero</span><span class="op" id="4958961">(</span><span class="ident" id="4958962">value</span><span class="op" id="4958967">.</span><span class="ident" id="4958968">Type</span><span class="op" id="4958972">(</span><span class="op" id="4958973">)</span><span class="op" id="4958974">)</span><span class="op" id="4958975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958979">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4958987">}</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958990">if</span>&nbsp;<span class="builtinfunc" id="4958993">len</span><span class="op" id="4958996">(</span><span class="ident" id="4958997">name</span><span class="op" id="4959001">)</span>&nbsp;<span class="op" id="4959003">&gt;</span>&nbsp;<span class="num" id="4959005">1024</span>&nbsp;<span class="op" id="4959010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4959014">errorf</span><span class="op" id="4959020">(</span><span class="string" id="4959021">&#34;name&nbsp;too&nbsp;long&nbsp;(%d&nbsp;bytes):&nbsp;%.20q...&#34;</span><span class="op" id="4959057">,</span>&nbsp;<span class="builtinfunc" id="4959059">len</span><span class="op" id="4959062">(</span><span class="ident" id="4959063">name</span><span class="op" id="4959067">)</span><span class="op" id="4959068">,</span>&nbsp;<span class="ident" id="4959070">name</span><span class="op" id="4959074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4959077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4959080">//&nbsp;The&nbsp;concrete&nbsp;type&nbsp;must&nbsp;be&nbsp;registered.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4959122">registerLock</span><span class="op" id="4959134">.</span><span class="ident" id="4959135">RLock</span><span class="op" id="4959140">(</span><span class="op" id="4959141">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4959144">typ</span><span class="op" id="4959147">,</span>&nbsp;<span class="ident" id="4959149">ok</span>&nbsp;<span class="op" id="4959152">:=</span>&nbsp;<span class="ident" id="4959155">nameToConcreteType</span><span class="op" id="4959173">[</span><span class="ident" id="4959174">name</span><span class="op" id="4959178">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4959181">registerLock</span><span class="op" id="4959193">.</span><span class="ident" id="4959194">RUnlock</span><span class="op" id="4959201">(</span><span class="op" id="4959202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4959205">if</span>&nbsp;<span class="op" id="4959208">!</span><span class="ident" id="4959209">ok</span>&nbsp;<span class="op" id="4959212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4959216">errorf</span><span class="op" id="4959222">(</span><span class="string" id="4959223">&#34;name&nbsp;not&nbsp;registered&nbsp;for&nbsp;interface:&nbsp;%q&#34;</span><span class="op" id="4959262">,</span>&nbsp;<span class="ident" id="4959264">name</span><span class="op" id="4959268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4959271">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4959274">//&nbsp;Read&nbsp;the&nbsp;type&nbsp;id&nbsp;of&nbsp;the&nbsp;concrete&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4959318">concreteId</span>&nbsp;<span class="op" id="4959329">:=</span>&nbsp;<span class="ident" id="4959332">dec</span><span class="op" id="4959335">.</span><span class="ident" id="4959336">decodeTypeSequence</span><span class="op" id="4959354">(</span><span class="builtintype" id="4959355">true</span><span class="op" id="4959359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4959362">if</span>&nbsp;<span class="ident" id="4959365">concreteId</span>&nbsp;<span class="op" id="4959376">&lt;</span>&nbsp;<span class="num" id="4959378">0</span>&nbsp;<span class="op" id="4959380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4959384">error_</span><span class="op" id="4959390">(</span><span class="ident" id="4959391">dec</span><span class="op" id="4959394">.</span><span class="ident" id="4959395">err</span><span class="op" id="4959398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4959401">}</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4959404">//&nbsp;Byte&nbsp;count&nbsp;of&nbsp;value&nbsp;is&nbsp;next;&nbsp;we&nbsp;don&#39;t&nbsp;care&nbsp;what&nbsp;it&nbsp;is&nbsp;(it&#39;s&nbsp;there</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4959474">//&nbsp;in&nbsp;case&nbsp;we&nbsp;want&nbsp;to&nbsp;ignore&nbsp;the&nbsp;value&nbsp;by&nbsp;skipping&nbsp;it&nbsp;completely).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4959542">state</span><span class="op" id="4959547">.</span><span class="ident" id="4959548">decodeUint</span><span class="op" id="4959558">(</span><span class="op" id="4959559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4959562">//&nbsp;Read&nbsp;the&nbsp;concrete&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4959591">v</span>&nbsp;<span class="op" id="4959593">:=</span>&nbsp;<span class="ident" id="4959596">allocValue</span><span class="op" id="4959606">(</span><span class="ident" id="4959607">typ</span><span class="op" id="4959610">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4959613">dec</span><span class="op" id="4959616">.</span><span class="ident" id="4959617">decodeValue</span><span class="op" id="4959628">(</span><span class="ident" id="4959629">concreteId</span><span class="op" id="4959639">,</span>&nbsp;<span class="ident" id="4959641">v</span><span class="op" id="4959642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4959645">if</span>&nbsp;<span class="ident" id="4959648">dec</span><span class="op" id="4959651">.</span><span class="ident" id="4959652">err</span>&nbsp;<span class="op" id="4959656">!=</span>&nbsp;<span class="ident" id="4959659">nil</span>&nbsp;<span class="op" id="4959663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4959667">error_</span><span class="op" id="4959673">(</span><span class="ident" id="4959674">dec</span><span class="op" id="4959677">.</span><span class="ident" id="4959678">err</span><span class="op" id="4959681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4959684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4959687">//&nbsp;Assign&nbsp;the&nbsp;concrete&nbsp;value&nbsp;to&nbsp;the&nbsp;interface.</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4959735">//&nbsp;Tread&nbsp;carefully;&nbsp;it&nbsp;might&nbsp;not&nbsp;satisfy&nbsp;the&nbsp;interface.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4959792">if</span>&nbsp;<span class="op" id="4959795">!</span><span class="ident" id="4959796">typ</span><span class="op" id="4959799">.</span><span class="ident" id="4959800">AssignableTo</span><span class="op" id="4959812">(</span><span class="ident" id="4959813">ityp</span><span class="op" id="4959817">)</span>&nbsp;<span class="op" id="4959819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4959823">errorf</span><span class="op" id="4959829">(</span><span class="string" id="4959830">&#34;%s&nbsp;is&nbsp;not&nbsp;assignable&nbsp;to&nbsp;type&nbsp;%s&#34;</span><span class="op" id="4959863">,</span>&nbsp;<span class="ident" id="4959865">typ</span><span class="op" id="4959868">,</span>&nbsp;<span class="ident" id="4959870">ityp</span><span class="op" id="4959874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4959877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4959880">//&nbsp;Copy&nbsp;the&nbsp;interface&nbsp;value&nbsp;to&nbsp;the&nbsp;target.</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4959924">value</span><span class="op" id="4959929">.</span><span class="ident" id="4959930">Set</span><span class="op" id="4959933">(</span><span class="ident" id="4959934">v</span><span class="op" id="4959935">)</span><br>
<span class="lineno"></span><span class="op" id="4959937">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4959940">//&nbsp;ignoreInterface&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;an&nbsp;interface&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="4960021">func</span>&nbsp;<span class="op" id="4960026">(</span><span class="ident" id="4960027">dec</span>&nbsp;<span class="op" id="4960031">*</span><span class="ident" id="4960032">Decoder</span><span class="op" id="4960039">)</span>&nbsp;<span class="ident" id="4960041">ignoreInterface</span><span class="op" id="4960056">(</span><span class="ident" id="4960057">state</span>&nbsp;<span class="op" id="4960063">*</span><span class="ident" id="4960064">decoderState</span><span class="op" id="4960076">)</span>&nbsp;<span class="op" id="4960078">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4960081">//&nbsp;Read&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960121">b</span>&nbsp;<span class="op" id="4960123">:=</span>&nbsp;<span class="builtinfunc" id="4960126">make</span><span class="op" id="4960130">(</span><span class="op" id="4960131">[</span><span class="op" id="4960132">]</span><span class="builtintype" id="4960133">byte</span><span class="op" id="4960137">,</span>&nbsp;<span class="ident" id="4960139">state</span><span class="op" id="4960144">.</span><span class="ident" id="4960145">decodeUint</span><span class="op" id="4960155">(</span><span class="op" id="4960156">)</span><span class="op" id="4960157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960160">_</span><span class="op" id="4960161">,</span>&nbsp;<span class="ident" id="4960163">err</span>&nbsp;<span class="op" id="4960167">:=</span>&nbsp;<span class="ident" id="4960170">state</span><span class="op" id="4960175">.</span><span class="ident" id="4960176">b</span><span class="op" id="4960177">.</span><span class="ident" id="4960178">Read</span><span class="op" id="4960182">(</span><span class="ident" id="4960183">b</span><span class="op" id="4960184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4960187">if</span>&nbsp;<span class="ident" id="4960190">err</span>&nbsp;<span class="op" id="4960194">!=</span>&nbsp;<span class="ident" id="4960197">nil</span>&nbsp;<span class="op" id="4960201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960205">error_</span><span class="op" id="4960211">(</span><span class="ident" id="4960212">err</span><span class="op" id="4960215">)</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4960218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960221">id</span>&nbsp;<span class="op" id="4960224">:=</span>&nbsp;<span class="ident" id="4960227">dec</span><span class="op" id="4960230">.</span><span class="ident" id="4960231">decodeTypeSequence</span><span class="op" id="4960249">(</span><span class="builtintype" id="4960250">true</span><span class="op" id="4960254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4960257">if</span>&nbsp;<span class="ident" id="4960260">id</span>&nbsp;<span class="op" id="4960263">&lt;</span>&nbsp;<span class="num" id="4960265">0</span>&nbsp;<span class="op" id="4960267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960271">error_</span><span class="op" id="4960277">(</span><span class="ident" id="4960278">dec</span><span class="op" id="4960281">.</span><span class="ident" id="4960282">err</span><span class="op" id="4960285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4960288">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4960291">//&nbsp;At&nbsp;this&nbsp;point,&nbsp;the&nbsp;decoder&nbsp;buffer&nbsp;contains&nbsp;a&nbsp;delimited&nbsp;value.&nbsp;Just&nbsp;toss&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960371">state</span><span class="op" id="4960376">.</span><span class="ident" id="4960377">b</span><span class="op" id="4960378">.</span><span class="ident" id="4960379">Drop</span><span class="op" id="4960383">(</span><span class="builtintype" id="4960384">int</span><span class="op" id="4960387">(</span><span class="ident" id="4960388">state</span><span class="op" id="4960393">.</span><span class="ident" id="4960394">decodeUint</span><span class="op" id="4960404">(</span><span class="op" id="4960405">)</span><span class="op" id="4960406">)</span><span class="op" id="4960407">)</span><br>
<span class="lineno"></span><span class="op" id="4960409">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4960412">//&nbsp;decodeGobDecoder&nbsp;decodes&nbsp;something&nbsp;implementing&nbsp;the&nbsp;GobDecoder&nbsp;interface.</span><br>
<span class="lineno">695</span><span class="comment" id="4960489">//&nbsp;The&nbsp;data&nbsp;is&nbsp;encoded&nbsp;as&nbsp;a&nbsp;byte&nbsp;slice.</span><br>
<span class="lineno"></span><span class="keyword" id="4960529">func</span>&nbsp;<span class="op" id="4960534">(</span><span class="ident" id="4960535">dec</span>&nbsp;<span class="op" id="4960539">*</span><span class="ident" id="4960540">Decoder</span><span class="op" id="4960547">)</span>&nbsp;<span class="ident" id="4960549">decodeGobDecoder</span><span class="op" id="4960565">(</span><span class="ident" id="4960566">ut</span>&nbsp;<span class="op" id="4960569">*</span><span class="ident" id="4960570">userTypeInfo</span><span class="op" id="4960582">,</span>&nbsp;<span class="ident" id="4960584">state</span>&nbsp;<span class="op" id="4960590">*</span><span class="ident" id="4960591">decoderState</span><span class="op" id="4960603">,</span>&nbsp;<span class="ident" id="4960605">value</span>&nbsp;<span class="ident" id="4960611">reflect</span><span class="op" id="4960618">.</span><span class="ident" id="4960619">Value</span><span class="op" id="4960624">)</span>&nbsp;<span class="op" id="4960626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4960629">//&nbsp;Read&nbsp;the&nbsp;bytes&nbsp;for&nbsp;the&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960663">b</span>&nbsp;<span class="op" id="4960665">:=</span>&nbsp;<span class="builtinfunc" id="4960668">make</span><span class="op" id="4960672">(</span><span class="op" id="4960673">[</span><span class="op" id="4960674">]</span><span class="builtintype" id="4960675">byte</span><span class="op" id="4960679">,</span>&nbsp;<span class="ident" id="4960681">state</span><span class="op" id="4960686">.</span><span class="ident" id="4960687">decodeUint</span><span class="op" id="4960697">(</span><span class="op" id="4960698">)</span><span class="op" id="4960699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960702">_</span><span class="op" id="4960703">,</span>&nbsp;<span class="ident" id="4960705">err</span>&nbsp;<span class="op" id="4960709">:=</span>&nbsp;<span class="ident" id="4960712">state</span><span class="op" id="4960717">.</span><span class="ident" id="4960718">b</span><span class="op" id="4960719">.</span><span class="ident" id="4960720">Read</span><span class="op" id="4960724">(</span><span class="ident" id="4960725">b</span><span class="op" id="4960726">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4960729">if</span>&nbsp;<span class="ident" id="4960732">err</span>&nbsp;<span class="op" id="4960736">!=</span>&nbsp;<span class="ident" id="4960739">nil</span>&nbsp;<span class="op" id="4960743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960747">error_</span><span class="op" id="4960753">(</span><span class="ident" id="4960754">err</span><span class="op" id="4960757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4960760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4960763">//&nbsp;We&nbsp;know&nbsp;it&#39;s&nbsp;one&nbsp;of&nbsp;these.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4960794">switch</span>&nbsp;<span class="ident" id="4960801">ut</span><span class="op" id="4960803">.</span><span class="ident" id="4960804">externalDec</span>&nbsp;<span class="op" id="4960816">{</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4960819">case</span>&nbsp;<span class="ident" id="4960824">xGob</span><span class="op" id="4960828">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960832">err</span>&nbsp;<span class="op" id="4960836">=</span>&nbsp;<span class="ident" id="4960838">value</span><span class="op" id="4960843">.</span><span class="ident" id="4960844">Interface</span><span class="op" id="4960853">(</span><span class="op" id="4960854">)</span><span class="op" id="4960855">.</span><span class="op" id="4960856">(</span><span class="ident" id="4960857">GobDecoder</span><span class="op" id="4960867">)</span><span class="op" id="4960868">.</span><span class="ident" id="4960869">GobDecode</span><span class="op" id="4960878">(</span><span class="ident" id="4960879">b</span><span class="op" id="4960880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4960883">case</span>&nbsp;<span class="ident" id="4960888">xBinary</span><span class="op" id="4960895">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960899">err</span>&nbsp;<span class="op" id="4960903">=</span>&nbsp;<span class="ident" id="4960905">value</span><span class="op" id="4960910">.</span><span class="ident" id="4960911">Interface</span><span class="op" id="4960920">(</span><span class="op" id="4960921">)</span><span class="op" id="4960922">.</span><span class="op" id="4960923">(</span><span class="ident" id="4960924">encoding</span><span class="op" id="4960932">.</span><span class="ident" id="4960933">BinaryUnmarshaler</span><span class="op" id="4960950">)</span><span class="op" id="4960951">.</span><span class="ident" id="4960952">UnmarshalBinary</span><span class="op" id="4960967">(</span><span class="ident" id="4960968">b</span><span class="op" id="4960969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4960972">case</span>&nbsp;<span class="ident" id="4960977">xText</span><span class="op" id="4960982">:</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960986">err</span>&nbsp;<span class="op" id="4960990">=</span>&nbsp;<span class="ident" id="4960992">value</span><span class="op" id="4960997">.</span><span class="ident" id="4960998">Interface</span><span class="op" id="4961007">(</span><span class="op" id="4961008">)</span><span class="op" id="4961009">.</span><span class="op" id="4961010">(</span><span class="ident" id="4961011">encoding</span><span class="op" id="4961019">.</span><span class="ident" id="4961020">TextUnmarshaler</span><span class="op" id="4961035">)</span><span class="op" id="4961036">.</span><span class="ident" id="4961037">UnmarshalText</span><span class="op" id="4961050">(</span><span class="ident" id="4961051">b</span><span class="op" id="4961052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4961055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4961058">if</span>&nbsp;<span class="ident" id="4961061">err</span>&nbsp;<span class="op" id="4961065">!=</span>&nbsp;<span class="ident" id="4961068">nil</span>&nbsp;<span class="op" id="4961072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4961076">error_</span><span class="op" id="4961082">(</span><span class="ident" id="4961083">err</span><span class="op" id="4961086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4961089">}</span><br>
<span class="lineno">715</span><span class="op" id="4961091">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4961094">//&nbsp;ignoreGobDecoder&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;GobDecoder&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="4961176">func</span>&nbsp;<span class="op" id="4961181">(</span><span class="ident" id="4961182">dec</span>&nbsp;<span class="op" id="4961186">*</span><span class="ident" id="4961187">Decoder</span><span class="op" id="4961194">)</span>&nbsp;<span class="ident" id="4961196">ignoreGobDecoder</span><span class="op" id="4961212">(</span><span class="ident" id="4961213">state</span>&nbsp;<span class="op" id="4961219">*</span><span class="ident" id="4961220">decoderState</span><span class="op" id="4961232">)</span>&nbsp;<span class="op" id="4961234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4961237">//&nbsp;Read&nbsp;the&nbsp;bytes&nbsp;for&nbsp;the&nbsp;value.</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4961271">b</span>&nbsp;<span class="op" id="4961273">:=</span>&nbsp;<span class="builtinfunc" id="4961276">make</span><span class="op" id="4961280">(</span><span class="op" id="4961281">[</span><span class="op" id="4961282">]</span><span class="builtintype" id="4961283">byte</span><span class="op" id="4961287">,</span>&nbsp;<span class="ident" id="4961289">state</span><span class="op" id="4961294">.</span><span class="ident" id="4961295">decodeUint</span><span class="op" id="4961305">(</span><span class="op" id="4961306">)</span><span class="op" id="4961307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4961310">_</span><span class="op" id="4961311">,</span>&nbsp;<span class="ident" id="4961313">err</span>&nbsp;<span class="op" id="4961317">:=</span>&nbsp;<span class="ident" id="4961320">state</span><span class="op" id="4961325">.</span><span class="ident" id="4961326">b</span><span class="op" id="4961327">.</span><span class="ident" id="4961328">Read</span><span class="op" id="4961332">(</span><span class="ident" id="4961333">b</span><span class="op" id="4961334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4961337">if</span>&nbsp;<span class="ident" id="4961340">err</span>&nbsp;<span class="op" id="4961344">!=</span>&nbsp;<span class="ident" id="4961347">nil</span>&nbsp;<span class="op" id="4961351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4961355">error_</span><span class="op" id="4961361">(</span><span class="ident" id="4961362">err</span><span class="op" id="4961365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4961368">}</span><br>
<span class="lineno">725</span><span class="op" id="4961370">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4961373">//&nbsp;Index&nbsp;by&nbsp;Go&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="4961395">var</span>&nbsp;<span class="ident" id="4961399">decOpTable</span>&nbsp;<span class="op" id="4961410">=</span>&nbsp;<span class="op" id="4961412">[</span><span class="op" id="4961413">...</span><span class="op" id="4961416">]</span><span class="ident" id="4961417">decOp</span><span class="op" id="4961422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4961425">reflect</span><span class="op" id="4961432">.</span><span class="ident" id="4961433">Bool</span><span class="op" id="4961437">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4961445">decBool</span><span class="op" id="4961452">,</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4961455">reflect</span><span class="op" id="4961462">.</span><span class="ident" id="4961463">Int8</span><span class="op" id="4961467">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4961475">decInt8</span><span class="op" id="4961482">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4961485">reflect</span><span class="op" id="4961492">.</span><span class="ident" id="4961493">Int16</span><span class="op" id="4961498">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4961505">decInt16</span><span class="op" id="4961513">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4961516">reflect</span><span class="op" id="4961523">.</span><span class="ident" id="4961524">Int32</span><span class="op" id="4961529">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4961536">decInt32</span><span class="op" id="4961544">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4961547">reflect</span><span class="op" id="4961554">.</span><span class="ident" id="4961555">Int64</span><span class="op" id="4961560">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4961567">decInt64</span><span class="op" id="4961575">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4961578">reflect</span><span class="op" id="4961585">.</span><span class="ident" id="4961586">Uint8</span><span class="op" id="4961591">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4961598">decUint8</span><span class="op" id="4961606">,</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4961609">reflect</span><span class="op" id="4961616">.</span><span class="ident" id="4961617">Uint16</span><span class="op" id="4961623">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4961629">decUint16</span><span class="op" id="4961638">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4961641">reflect</span><span class="op" id="4961648">.</span><span class="ident" id="4961649">Uint32</span><span class="op" id="4961655">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4961661">decUint32</span><span class="op" id="4961670">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4961673">reflect</span><span class="op" id="4961680">.</span><span class="ident" id="4961681">Uint64</span><span class="op" id="4961687">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4961693">decUint64</span><span class="op" id="4961702">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4961705">reflect</span><span class="op" id="4961712">.</span><span class="ident" id="4961713">Float32</span><span class="op" id="4961720">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4961725">decFloat32</span><span class="op" id="4961735">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4961738">reflect</span><span class="op" id="4961745">.</span><span class="ident" id="4961746">Float64</span><span class="op" id="4961753">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4961758">decFloat64</span><span class="op" id="4961768">,</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4961771">reflect</span><span class="op" id="4961778">.</span><span class="ident" id="4961779">Complex64</span><span class="op" id="4961788">:</span>&nbsp;&nbsp;<span class="ident" id="4961791">decComplex64</span><span class="op" id="4961803">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4961806">reflect</span><span class="op" id="4961813">.</span><span class="ident" id="4961814">Complex128</span><span class="op" id="4961824">:</span>&nbsp;<span class="ident" id="4961826">decComplex128</span><span class="op" id="4961839">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4961842">reflect</span><span class="op" id="4961849">.</span><span class="ident" id="4961850">String</span><span class="op" id="4961856">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4961862">decString</span><span class="op" id="4961871">,</span><br>
<span class="lineno"></span><span class="op" id="4961873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">745</span><span class="comment" id="4961876">//&nbsp;Indexed&nbsp;by&nbsp;gob&nbsp;types.&nbsp;&nbsp;tComplex&nbsp;will&nbsp;be&nbsp;added&nbsp;during&nbsp;type.init().</span><br>
<span class="lineno"></span><span class="keyword" id="4961945">var</span>&nbsp;<span class="ident" id="4961949">decIgnoreOpMap</span>&nbsp;<span class="op" id="4961964">=</span>&nbsp;<span class="keyword" id="4961966">map</span><span class="op" id="4961969">[</span><span class="ident" id="4961970">typeId</span><span class="op" id="4961976">]</span><span class="ident" id="4961977">decOp</span><span class="op" id="4961982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4961985">tBool</span><span class="op" id="4961990">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4961995">ignoreUint</span><span class="op" id="4962005">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4962008">tInt</span><span class="op" id="4962012">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4962018">ignoreUint</span><span class="op" id="4962028">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4962031">tUint</span><span class="op" id="4962036">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4962041">ignoreUint</span><span class="op" id="4962051">,</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4962054">tFloat</span><span class="op" id="4962060">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4962064">ignoreUint</span><span class="op" id="4962074">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4962077">tBytes</span><span class="op" id="4962083">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4962087">ignoreUint8Array</span><span class="op" id="4962103">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4962106">tString</span><span class="op" id="4962113">:</span>&nbsp;&nbsp;<span class="ident" id="4962116">ignoreUint8Array</span><span class="op" id="4962132">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4962135">tComplex</span><span class="op" id="4962143">:</span>&nbsp;<span class="ident" id="4962145">ignoreTwoUints</span><span class="op" id="4962159">,</span><br>
<span class="lineno"></span><span class="op" id="4962161">}</span><br>
<span class="lineno">755</span><br>
<span class="lineno"></span><span class="comment" id="4962164">//&nbsp;decOpFor&nbsp;returns&nbsp;the&nbsp;decoding&nbsp;op&nbsp;for&nbsp;the&nbsp;base&nbsp;type&nbsp;under&nbsp;rt&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4962231">//&nbsp;the&nbsp;indirection&nbsp;count&nbsp;to&nbsp;reach&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="4962269">func</span>&nbsp;<span class="op" id="4962274">(</span><span class="ident" id="4962275">dec</span>&nbsp;<span class="op" id="4962279">*</span><span class="ident" id="4962280">Decoder</span><span class="op" id="4962287">)</span>&nbsp;<span class="ident" id="4962289">decOpFor</span><span class="op" id="4962297">(</span><span class="ident" id="4962298">wireId</span>&nbsp;<span class="ident" id="4962305">typeId</span><span class="op" id="4962311">,</span>&nbsp;<span class="ident" id="4962313">rt</span>&nbsp;<span class="ident" id="4962316">reflect</span><span class="op" id="4962323">.</span><span class="ident" id="4962324">Type</span><span class="op" id="4962328">,</span>&nbsp;<span class="ident" id="4962330">name</span>&nbsp;<span class="builtintype" id="4962335">string</span><span class="op" id="4962341">,</span>&nbsp;<span class="ident" id="4962343">inProgress</span>&nbsp;<span class="keyword" id="4962354">map</span><span class="op" id="4962357">[</span><span class="ident" id="4962358">reflect</span><span class="op" id="4962365">.</span><span class="ident" id="4962366">Type</span><span class="op" id="4962370">]</span><span class="op" id="4962371">*</span><span class="ident" id="4962372">decOp</span><span class="op" id="4962377">)</span>&nbsp;<span class="op" id="4962379">*</span><span class="ident" id="4962380">decOp</span>&nbsp;<span class="op" id="4962386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4962389">ut</span>&nbsp;<span class="op" id="4962392">:=</span>&nbsp;<span class="ident" id="4962395">userType</span><span class="op" id="4962403">(</span><span class="ident" id="4962404">rt</span><span class="op" id="4962406">)</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4962409">//&nbsp;If&nbsp;the&nbsp;type&nbsp;implements&nbsp;GobEncoder,&nbsp;we&nbsp;handle&nbsp;it&nbsp;without&nbsp;further&nbsp;processing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4962489">if</span>&nbsp;<span class="ident" id="4962492">ut</span><span class="op" id="4962494">.</span><span class="ident" id="4962495">externalDec</span>&nbsp;<span class="op" id="4962507">!=</span>&nbsp;<span class="num" id="4962510">0</span>&nbsp;<span class="op" id="4962512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4962516">return</span>&nbsp;<span class="ident" id="4962523">dec</span><span class="op" id="4962526">.</span><span class="ident" id="4962527">gobDecodeOpFor</span><span class="op" id="4962541">(</span><span class="ident" id="4962542">ut</span><span class="op" id="4962544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4962547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4962551">//&nbsp;If&nbsp;this&nbsp;type&nbsp;is&nbsp;already&nbsp;in&nbsp;progress,&nbsp;it&#39;s&nbsp;a&nbsp;recursive&nbsp;type&nbsp;(e.g.&nbsp;map[string]*T).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4962636">//&nbsp;Return&nbsp;the&nbsp;pointer&nbsp;to&nbsp;the&nbsp;op&nbsp;we&#39;re&nbsp;already&nbsp;building.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4962693">if</span>&nbsp;<span class="ident" id="4962696">opPtr</span>&nbsp;<span class="op" id="4962702">:=</span>&nbsp;<span class="ident" id="4962705">inProgress</span><span class="op" id="4962715">[</span><span class="ident" id="4962716">rt</span><span class="op" id="4962718">]</span><span class="op" id="4962719">;</span>&nbsp;<span class="ident" id="4962721">opPtr</span>&nbsp;<span class="op" id="4962727">!=</span>&nbsp;<span class="ident" id="4962730">nil</span>&nbsp;<span class="op" id="4962734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4962738">return</span>&nbsp;<span class="ident" id="4962745">opPtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4962752">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4962755">typ</span>&nbsp;<span class="op" id="4962759">:=</span>&nbsp;<span class="ident" id="4962762">ut</span><span class="op" id="4962764">.</span><span class="ident" id="4962765">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4962771">var</span>&nbsp;<span class="ident" id="4962775">op</span>&nbsp;<span class="ident" id="4962778">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4962785">k</span>&nbsp;<span class="op" id="4962787">:=</span>&nbsp;<span class="ident" id="4962790">typ</span><span class="op" id="4962793">.</span><span class="ident" id="4962794">Kind</span><span class="op" id="4962798">(</span><span class="op" id="4962799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4962802">if</span>&nbsp;<span class="builtintype" id="4962805">int</span><span class="op" id="4962808">(</span><span class="ident" id="4962809">k</span><span class="op" id="4962810">)</span>&nbsp;<span class="op" id="4962812">&lt;</span>&nbsp;<span class="builtinfunc" id="4962814">len</span><span class="op" id="4962817">(</span><span class="ident" id="4962818">decOpTable</span><span class="op" id="4962828">)</span>&nbsp;<span class="op" id="4962830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4962834">op</span>&nbsp;<span class="op" id="4962837">=</span>&nbsp;<span class="ident" id="4962839">decOpTable</span><span class="op" id="4962849">[</span><span class="ident" id="4962850">k</span><span class="op" id="4962851">]</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4962854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4962857">if</span>&nbsp;<span class="ident" id="4962860">op</span>&nbsp;<span class="op" id="4962863">==</span>&nbsp;<span class="ident" id="4962866">nil</span>&nbsp;<span class="op" id="4962870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4962874">inProgress</span><span class="op" id="4962884">[</span><span class="ident" id="4962885">rt</span><span class="op" id="4962887">]</span>&nbsp;<span class="op" id="4962889">=</span>&nbsp;<span class="op" id="4962891">&amp;</span><span class="ident" id="4962892">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4962897">//&nbsp;Special&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4962916">switch</span>&nbsp;<span class="ident" id="4962923">t</span>&nbsp;<span class="op" id="4962925">:=</span>&nbsp;<span class="ident" id="4962928">typ</span><span class="op" id="4962931">;</span>&nbsp;<span class="ident" id="4962933">t</span><span class="op" id="4962934">.</span><span class="ident" id="4962935">Kind</span><span class="op" id="4962939">(</span><span class="op" id="4962940">)</span>&nbsp;<span class="op" id="4962942">{</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4962946">case</span>&nbsp;<span class="ident" id="4962951">reflect</span><span class="op" id="4962958">.</span><span class="ident" id="4962959">Array</span><span class="op" id="4962964">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4962969">name</span>&nbsp;<span class="op" id="4962974">=</span>&nbsp;<span class="string" id="4962976">&#34;element&nbsp;of&nbsp;&#34;</span>&nbsp;<span class="op" id="4962990">+</span>&nbsp;<span class="ident" id="4962992">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4963000">elemId</span>&nbsp;<span class="op" id="4963007">:=</span>&nbsp;<span class="ident" id="4963010">dec</span><span class="op" id="4963013">.</span><span class="ident" id="4963014">wireType</span><span class="op" id="4963022">[</span><span class="ident" id="4963023">wireId</span><span class="op" id="4963029">]</span><span class="op" id="4963030">.</span><span class="ident" id="4963031">ArrayT</span><span class="op" id="4963037">.</span><span class="ident" id="4963038">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4963046">elemOp</span>&nbsp;<span class="op" id="4963053">:=</span>&nbsp;<span class="ident" id="4963056">dec</span><span class="op" id="4963059">.</span><span class="ident" id="4963060">decOpFor</span><span class="op" id="4963068">(</span><span class="ident" id="4963069">elemId</span><span class="op" id="4963075">,</span>&nbsp;<span class="ident" id="4963077">t</span><span class="op" id="4963078">.</span><span class="ident" id="4963079">Elem</span><span class="op" id="4963083">(</span><span class="op" id="4963084">)</span><span class="op" id="4963085">,</span>&nbsp;<span class="ident" id="4963087">name</span><span class="op" id="4963091">,</span>&nbsp;<span class="ident" id="4963093">inProgress</span><span class="op" id="4963103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4963108">ovfl</span>&nbsp;<span class="op" id="4963113">:=</span>&nbsp;<span class="ident" id="4963116">overflow</span><span class="op" id="4963124">(</span><span class="ident" id="4963125">name</span><span class="op" id="4963129">)</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4963134">helper</span>&nbsp;<span class="op" id="4963141">:=</span>&nbsp;<span class="ident" id="4963144">decArrayHelper</span><span class="op" id="4963158">[</span><span class="ident" id="4963159">t</span><span class="op" id="4963160">.</span><span class="ident" id="4963161">Elem</span><span class="op" id="4963165">(</span><span class="op" id="4963166">)</span><span class="op" id="4963167">.</span><span class="ident" id="4963168">Kind</span><span class="op" id="4963172">(</span><span class="op" id="4963173">)</span><span class="op" id="4963174">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4963179">op</span>&nbsp;<span class="op" id="4963182">=</span>&nbsp;<span class="keyword" id="4963184">func</span><span class="op" id="4963188">(</span><span class="ident" id="4963189">i</span>&nbsp;<span class="op" id="4963191">*</span><span class="ident" id="4963192">decInstr</span><span class="op" id="4963200">,</span>&nbsp;<span class="ident" id="4963202">state</span>&nbsp;<span class="op" id="4963208">*</span><span class="ident" id="4963209">decoderState</span><span class="op" id="4963221">,</span>&nbsp;<span class="ident" id="4963223">value</span>&nbsp;<span class="ident" id="4963229">reflect</span><span class="op" id="4963236">.</span><span class="ident" id="4963237">Value</span><span class="op" id="4963242">)</span>&nbsp;<span class="op" id="4963244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4963250">state</span><span class="op" id="4963255">.</span><span class="ident" id="4963256">dec</span><span class="op" id="4963259">.</span><span class="ident" id="4963260">decodeArray</span><span class="op" id="4963271">(</span><span class="ident" id="4963272">t</span><span class="op" id="4963273">,</span>&nbsp;<span class="ident" id="4963275">state</span><span class="op" id="4963280">,</span>&nbsp;<span class="ident" id="4963282">value</span><span class="op" id="4963287">,</span>&nbsp;<span class="op" id="4963289">*</span><span class="ident" id="4963290">elemOp</span><span class="op" id="4963296">,</span>&nbsp;<span class="ident" id="4963298">t</span><span class="op" id="4963299">.</span><span class="ident" id="4963300">Len</span><span class="op" id="4963303">(</span><span class="op" id="4963304">)</span><span class="op" id="4963305">,</span>&nbsp;<span class="ident" id="4963307">ovfl</span><span class="op" id="4963311">,</span>&nbsp;<span class="ident" id="4963313">helper</span><span class="op" id="4963319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4963324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4963329">case</span>&nbsp;<span class="ident" id="4963334">reflect</span><span class="op" id="4963341">.</span><span class="ident" id="4963342">Map</span><span class="op" id="4963345">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4963350">keyId</span>&nbsp;<span class="op" id="4963356">:=</span>&nbsp;<span class="ident" id="4963359">dec</span><span class="op" id="4963362">.</span><span class="ident" id="4963363">wireType</span><span class="op" id="4963371">[</span><span class="ident" id="4963372">wireId</span><span class="op" id="4963378">]</span><span class="op" id="4963379">.</span><span class="ident" id="4963380">MapT</span><span class="op" id="4963384">.</span><span class="ident" id="4963385">Key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4963392">elemId</span>&nbsp;<span class="op" id="4963399">:=</span>&nbsp;<span class="ident" id="4963402">dec</span><span class="op" id="4963405">.</span><span class="ident" id="4963406">wireType</span><span class="op" id="4963414">[</span><span class="ident" id="4963415">wireId</span><span class="op" id="4963421">]</span><span class="op" id="4963422">.</span><span class="ident" id="4963423">MapT</span><span class="op" id="4963427">.</span><span class="ident" id="4963428">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4963436">keyOp</span>&nbsp;<span class="op" id="4963442">:=</span>&nbsp;<span class="ident" id="4963445">dec</span><span class="op" id="4963448">.</span><span class="ident" id="4963449">decOpFor</span><span class="op" id="4963457">(</span><span class="ident" id="4963458">keyId</span><span class="op" id="4963463">,</span>&nbsp;<span class="ident" id="4963465">t</span><span class="op" id="4963466">.</span><span class="ident" id="4963467">Key</span><span class="op" id="4963470">(</span><span class="op" id="4963471">)</span><span class="op" id="4963472">,</span>&nbsp;<span class="string" id="4963474">&#34;key&nbsp;of&nbsp;&#34;</span><span class="op" id="4963483">+</span><span class="ident" id="4963484">name</span><span class="op" id="4963488">,</span>&nbsp;<span class="ident" id="4963490">inProgress</span><span class="op" id="4963500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4963505">elemOp</span>&nbsp;<span class="op" id="4963512">:=</span>&nbsp;<span class="ident" id="4963515">dec</span><span class="op" id="4963518">.</span><span class="ident" id="4963519">decOpFor</span><span class="op" id="4963527">(</span><span class="ident" id="4963528">elemId</span><span class="op" id="4963534">,</span>&nbsp;<span class="ident" id="4963536">t</span><span class="op" id="4963537">.</span><span class="ident" id="4963538">Elem</span><span class="op" id="4963542">(</span><span class="op" id="4963543">)</span><span class="op" id="4963544">,</span>&nbsp;<span class="string" id="4963546">&#34;element&nbsp;of&nbsp;&#34;</span><span class="op" id="4963559">+</span><span class="ident" id="4963560">name</span><span class="op" id="4963564">,</span>&nbsp;<span class="ident" id="4963566">inProgress</span><span class="op" id="4963576">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4963581">ovfl</span>&nbsp;<span class="op" id="4963586">:=</span>&nbsp;<span class="ident" id="4963589">overflow</span><span class="op" id="4963597">(</span><span class="ident" id="4963598">name</span><span class="op" id="4963602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4963607">op</span>&nbsp;<span class="op" id="4963610">=</span>&nbsp;<span class="keyword" id="4963612">func</span><span class="op" id="4963616">(</span><span class="ident" id="4963617">i</span>&nbsp;<span class="op" id="4963619">*</span><span class="ident" id="4963620">decInstr</span><span class="op" id="4963628">,</span>&nbsp;<span class="ident" id="4963630">state</span>&nbsp;<span class="op" id="4963636">*</span><span class="ident" id="4963637">decoderState</span><span class="op" id="4963649">,</span>&nbsp;<span class="ident" id="4963651">value</span>&nbsp;<span class="ident" id="4963657">reflect</span><span class="op" id="4963664">.</span><span class="ident" id="4963665">Value</span><span class="op" id="4963670">)</span>&nbsp;<span class="op" id="4963672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4963678">state</span><span class="op" id="4963683">.</span><span class="ident" id="4963684">dec</span><span class="op" id="4963687">.</span><span class="ident" id="4963688">decodeMap</span><span class="op" id="4963697">(</span><span class="ident" id="4963698">t</span><span class="op" id="4963699">,</span>&nbsp;<span class="ident" id="4963701">state</span><span class="op" id="4963706">,</span>&nbsp;<span class="ident" id="4963708">value</span><span class="op" id="4963713">,</span>&nbsp;<span class="op" id="4963715">*</span><span class="ident" id="4963716">keyOp</span><span class="op" id="4963721">,</span>&nbsp;<span class="op" id="4963723">*</span><span class="ident" id="4963724">elemOp</span><span class="op" id="4963730">,</span>&nbsp;<span class="ident" id="4963732">ovfl</span><span class="op" id="4963736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4963741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4963746">case</span>&nbsp;<span class="ident" id="4963751">reflect</span><span class="op" id="4963758">.</span><span class="ident" id="4963759">Slice</span><span class="op" id="4963764">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4963769">name</span>&nbsp;<span class="op" id="4963774">=</span>&nbsp;<span class="string" id="4963776">&#34;element&nbsp;of&nbsp;&#34;</span>&nbsp;<span class="op" id="4963790">+</span>&nbsp;<span class="ident" id="4963792">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4963800">if</span>&nbsp;<span class="ident" id="4963803">t</span><span class="op" id="4963804">.</span><span class="ident" id="4963805">Elem</span><span class="op" id="4963809">(</span><span class="op" id="4963810">)</span><span class="op" id="4963811">.</span><span class="ident" id="4963812">Kind</span><span class="op" id="4963816">(</span><span class="op" id="4963817">)</span>&nbsp;<span class="op" id="4963819">==</span>&nbsp;<span class="ident" id="4963822">reflect</span><span class="op" id="4963829">.</span><span class="ident" id="4963830">Uint8</span>&nbsp;<span class="op" id="4963836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4963842">op</span>&nbsp;<span class="op" id="4963845">=</span>&nbsp;<span class="ident" id="4963847">decUint8Slice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4963865">break</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4963874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4963879">var</span>&nbsp;<span class="ident" id="4963883">elemId</span>&nbsp;<span class="ident" id="4963890">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4963900">if</span>&nbsp;<span class="ident" id="4963903">tt</span><span class="op" id="4963905">,</span>&nbsp;<span class="ident" id="4963907">ok</span>&nbsp;<span class="op" id="4963910">:=</span>&nbsp;<span class="ident" id="4963913">builtinIdToType</span><span class="op" id="4963928">[</span><span class="ident" id="4963929">wireId</span><span class="op" id="4963935">]</span><span class="op" id="4963936">;</span>&nbsp;<span class="ident" id="4963938">ok</span>&nbsp;<span class="op" id="4963941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4963947">elemId</span>&nbsp;<span class="op" id="4963954">=</span>&nbsp;<span class="ident" id="4963956">tt</span><span class="op" id="4963958">.</span><span class="op" id="4963959">(</span><span class="op" id="4963960">*</span><span class="ident" id="4963961">sliceType</span><span class="op" id="4963970">)</span><span class="op" id="4963971">.</span><span class="ident" id="4963972">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4963980">}</span>&nbsp;<span class="keyword" id="4963982">else</span>&nbsp;<span class="op" id="4963987">{</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4963993">elemId</span>&nbsp;<span class="op" id="4964000">=</span>&nbsp;<span class="ident" id="4964002">dec</span><span class="op" id="4964005">.</span><span class="ident" id="4964006">wireType</span><span class="op" id="4964014">[</span><span class="ident" id="4964015">wireId</span><span class="op" id="4964021">]</span><span class="op" id="4964022">.</span><span class="ident" id="4964023">SliceT</span><span class="op" id="4964029">.</span><span class="ident" id="4964030">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4964038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4964043">elemOp</span>&nbsp;<span class="op" id="4964050">:=</span>&nbsp;<span class="ident" id="4964053">dec</span><span class="op" id="4964056">.</span><span class="ident" id="4964057">decOpFor</span><span class="op" id="4964065">(</span><span class="ident" id="4964066">elemId</span><span class="op" id="4964072">,</span>&nbsp;<span class="ident" id="4964074">t</span><span class="op" id="4964075">.</span><span class="ident" id="4964076">Elem</span><span class="op" id="4964080">(</span><span class="op" id="4964081">)</span><span class="op" id="4964082">,</span>&nbsp;<span class="ident" id="4964084">name</span><span class="op" id="4964088">,</span>&nbsp;<span class="ident" id="4964090">inProgress</span><span class="op" id="4964100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4964105">ovfl</span>&nbsp;<span class="op" id="4964110">:=</span>&nbsp;<span class="ident" id="4964113">overflow</span><span class="op" id="4964121">(</span><span class="ident" id="4964122">name</span><span class="op" id="4964126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4964131">helper</span>&nbsp;<span class="op" id="4964138">:=</span>&nbsp;<span class="ident" id="4964141">decSliceHelper</span><span class="op" id="4964155">[</span><span class="ident" id="4964156">t</span><span class="op" id="4964157">.</span><span class="ident" id="4964158">Elem</span><span class="op" id="4964162">(</span><span class="op" id="4964163">)</span><span class="op" id="4964164">.</span><span class="ident" id="4964165">Kind</span><span class="op" id="4964169">(</span><span class="op" id="4964170">)</span><span class="op" id="4964171">]</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4964176">op</span>&nbsp;<span class="op" id="4964179">=</span>&nbsp;<span class="keyword" id="4964181">func</span><span class="op" id="4964185">(</span><span class="ident" id="4964186">i</span>&nbsp;<span class="op" id="4964188">*</span><span class="ident" id="4964189">decInstr</span><span class="op" id="4964197">,</span>&nbsp;<span class="ident" id="4964199">state</span>&nbsp;<span class="op" id="4964205">*</span><span class="ident" id="4964206">decoderState</span><span class="op" id="4964218">,</span>&nbsp;<span class="ident" id="4964220">value</span>&nbsp;<span class="ident" id="4964226">reflect</span><span class="op" id="4964233">.</span><span class="ident" id="4964234">Value</span><span class="op" id="4964239">)</span>&nbsp;<span class="op" id="4964241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4964247">state</span><span class="op" id="4964252">.</span><span class="ident" id="4964253">dec</span><span class="op" id="4964256">.</span><span class="ident" id="4964257">decodeSlice</span><span class="op" id="4964268">(</span><span class="ident" id="4964269">state</span><span class="op" id="4964274">,</span>&nbsp;<span class="ident" id="4964276">value</span><span class="op" id="4964281">,</span>&nbsp;<span class="op" id="4964283">*</span><span class="ident" id="4964284">elemOp</span><span class="op" id="4964290">,</span>&nbsp;<span class="ident" id="4964292">ovfl</span><span class="op" id="4964296">,</span>&nbsp;<span class="ident" id="4964298">helper</span><span class="op" id="4964304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4964309">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4964314">case</span>&nbsp;<span class="ident" id="4964319">reflect</span><span class="op" id="4964326">.</span><span class="ident" id="4964327">Struct</span><span class="op" id="4964333">:</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4964338">//&nbsp;Generate&nbsp;a&nbsp;closure&nbsp;that&nbsp;calls&nbsp;out&nbsp;to&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;nested&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4964413">ut</span>&nbsp;<span class="op" id="4964416">:=</span>&nbsp;<span class="ident" id="4964419">userType</span><span class="op" id="4964427">(</span><span class="ident" id="4964428">typ</span><span class="op" id="4964431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4964436">enginePtr</span><span class="op" id="4964445">,</span>&nbsp;<span class="ident" id="4964447">err</span>&nbsp;<span class="op" id="4964451">:=</span>&nbsp;<span class="ident" id="4964454">dec</span><span class="op" id="4964457">.</span><span class="ident" id="4964458">getDecEnginePtr</span><span class="op" id="4964473">(</span><span class="ident" id="4964474">wireId</span><span class="op" id="4964480">,</span>&nbsp;<span class="ident" id="4964482">ut</span><span class="op" id="4964484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4964489">if</span>&nbsp;<span class="ident" id="4964492">err</span>&nbsp;<span class="op" id="4964496">!=</span>&nbsp;<span class="ident" id="4964499">nil</span>&nbsp;<span class="op" id="4964503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4964509">error_</span><span class="op" id="4964515">(</span><span class="ident" id="4964516">err</span><span class="op" id="4964519">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4964524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4964529">op</span>&nbsp;<span class="op" id="4964532">=</span>&nbsp;<span class="keyword" id="4964534">func</span><span class="op" id="4964538">(</span><span class="ident" id="4964539">i</span>&nbsp;<span class="op" id="4964541">*</span><span class="ident" id="4964542">decInstr</span><span class="op" id="4964550">,</span>&nbsp;<span class="ident" id="4964552">state</span>&nbsp;<span class="op" id="4964558">*</span><span class="ident" id="4964559">decoderState</span><span class="op" id="4964571">,</span>&nbsp;<span class="ident" id="4964573">value</span>&nbsp;<span class="ident" id="4964579">reflect</span><span class="op" id="4964586">.</span><span class="ident" id="4964587">Value</span><span class="op" id="4964592">)</span>&nbsp;<span class="op" id="4964594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4964600">//&nbsp;indirect&nbsp;through&nbsp;enginePtr&nbsp;to&nbsp;delay&nbsp;evaluation&nbsp;for&nbsp;recursive&nbsp;structs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4964677">dec</span><span class="op" id="4964680">.</span><span class="ident" id="4964681">decodeStruct</span><span class="op" id="4964693">(</span><span class="op" id="4964694">*</span><span class="ident" id="4964695">enginePtr</span><span class="op" id="4964704">,</span>&nbsp;<span class="ident" id="4964706">ut</span><span class="op" id="4964708">,</span>&nbsp;<span class="ident" id="4964710">value</span><span class="op" id="4964715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4964720">}</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4964724">case</span>&nbsp;<span class="ident" id="4964729">reflect</span><span class="op" id="4964736">.</span><span class="ident" id="4964737">Interface</span><span class="op" id="4964746">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4964751">op</span>&nbsp;<span class="op" id="4964754">=</span>&nbsp;<span class="keyword" id="4964756">func</span><span class="op" id="4964760">(</span><span class="ident" id="4964761">i</span>&nbsp;<span class="op" id="4964763">*</span><span class="ident" id="4964764">decInstr</span><span class="op" id="4964772">,</span>&nbsp;<span class="ident" id="4964774">state</span>&nbsp;<span class="op" id="4964780">*</span><span class="ident" id="4964781">decoderState</span><span class="op" id="4964793">,</span>&nbsp;<span class="ident" id="4964795">value</span>&nbsp;<span class="ident" id="4964801">reflect</span><span class="op" id="4964808">.</span><span class="ident" id="4964809">Value</span><span class="op" id="4964814">)</span>&nbsp;<span class="op" id="4964816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4964822">state</span><span class="op" id="4964827">.</span><span class="ident" id="4964828">dec</span><span class="op" id="4964831">.</span><span class="ident" id="4964832">decodeInterface</span><span class="op" id="4964847">(</span><span class="ident" id="4964848">t</span><span class="op" id="4964849">,</span>&nbsp;<span class="ident" id="4964851">state</span><span class="op" id="4964856">,</span>&nbsp;<span class="ident" id="4964858">value</span><span class="op" id="4964863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4964868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4964872">}</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4964875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4964878">if</span>&nbsp;<span class="ident" id="4964881">op</span>&nbsp;<span class="op" id="4964884">==</span>&nbsp;<span class="ident" id="4964887">nil</span>&nbsp;<span class="op" id="4964891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4964895">errorf</span><span class="op" id="4964901">(</span><span class="string" id="4964902">&#34;decode&nbsp;can&#39;t&nbsp;handle&nbsp;type&nbsp;%s&#34;</span><span class="op" id="4964931">,</span>&nbsp;<span class="ident" id="4964933">rt</span><span class="op" id="4964935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4964938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4964941">return</span>&nbsp;<span class="op" id="4964948">&amp;</span><span class="ident" id="4964949">op</span><br>
<span class="lineno">840</span><span class="op" id="4964952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4964955">//&nbsp;decIgnoreOpFor&nbsp;returns&nbsp;the&nbsp;decoding&nbsp;op&nbsp;for&nbsp;a&nbsp;field&nbsp;that&nbsp;has&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="4965034">func</span>&nbsp;<span class="op" id="4965039">(</span><span class="ident" id="4965040">dec</span>&nbsp;<span class="op" id="4965044">*</span><span class="ident" id="4965045">Decoder</span><span class="op" id="4965052">)</span>&nbsp;<span class="ident" id="4965054">decIgnoreOpFor</span><span class="op" id="4965068">(</span><span class="ident" id="4965069">wireId</span>&nbsp;<span class="ident" id="4965076">typeId</span><span class="op" id="4965082">)</span>&nbsp;<span class="ident" id="4965084">decOp</span>&nbsp;<span class="op" id="4965090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4965093">op</span><span class="op" id="4965095">,</span>&nbsp;<span class="ident" id="4965097">ok</span>&nbsp;<span class="op" id="4965100">:=</span>&nbsp;<span class="ident" id="4965103">decIgnoreOpMap</span><span class="op" id="4965117">[</span><span class="ident" id="4965118">wireId</span><span class="op" id="4965124">]</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4965127">if</span>&nbsp;<span class="op" id="4965130">!</span><span class="ident" id="4965131">ok</span>&nbsp;<span class="op" id="4965134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4965138">if</span>&nbsp;<span class="ident" id="4965141">wireId</span>&nbsp;<span class="op" id="4965148">==</span>&nbsp;<span class="ident" id="4965151">tInterface</span>&nbsp;<span class="op" id="4965162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4965167">//&nbsp;Special&nbsp;case&nbsp;because&nbsp;it&#39;s&nbsp;a&nbsp;method:&nbsp;the&nbsp;ignored&nbsp;item&nbsp;might</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4965232">//&nbsp;define&nbsp;types&nbsp;and&nbsp;we&nbsp;need&nbsp;to&nbsp;record&nbsp;their&nbsp;state&nbsp;in&nbsp;the&nbsp;decoder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4965301">op</span>&nbsp;<span class="op" id="4965304">=</span>&nbsp;<span class="keyword" id="4965306">func</span><span class="op" id="4965310">(</span><span class="ident" id="4965311">i</span>&nbsp;<span class="op" id="4965313">*</span><span class="ident" id="4965314">decInstr</span><span class="op" id="4965322">,</span>&nbsp;<span class="ident" id="4965324">state</span>&nbsp;<span class="op" id="4965330">*</span><span class="ident" id="4965331">decoderState</span><span class="op" id="4965343">,</span>&nbsp;<span class="ident" id="4965345">value</span>&nbsp;<span class="ident" id="4965351">reflect</span><span class="op" id="4965358">.</span><span class="ident" id="4965359">Value</span><span class="op" id="4965364">)</span>&nbsp;<span class="op" id="4965366">{</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4965372">state</span><span class="op" id="4965377">.</span><span class="ident" id="4965378">dec</span><span class="op" id="4965381">.</span><span class="ident" id="4965382">ignoreInterface</span><span class="op" id="4965397">(</span><span class="ident" id="4965398">state</span><span class="op" id="4965403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4965408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4965413">return</span>&nbsp;<span class="ident" id="4965420">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4965425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4965429">//&nbsp;Special&nbsp;cases</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4965448">wire</span>&nbsp;<span class="op" id="4965453">:=</span>&nbsp;<span class="ident" id="4965456">dec</span><span class="op" id="4965459">.</span><span class="ident" id="4965460">wireType</span><span class="op" id="4965468">[</span><span class="ident" id="4965469">wireId</span><span class="op" id="4965475">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4965479">switch</span>&nbsp;<span class="op" id="4965486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4965490">case</span>&nbsp;<span class="ident" id="4965495">wire</span>&nbsp;<span class="op" id="4965500">==</span>&nbsp;<span class="ident" id="4965503">nil</span><span class="op" id="4965506">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4965511">errorf</span><span class="op" id="4965517">(</span><span class="string" id="4965518">&#34;bad&nbsp;data:&nbsp;undefined&nbsp;type&nbsp;%s&#34;</span><span class="op" id="4965547">,</span>&nbsp;<span class="ident" id="4965549">wireId</span><span class="op" id="4965555">.</span><span class="builtintype" id="4965556">string</span><span class="op" id="4965562">(</span><span class="op" id="4965563">)</span><span class="op" id="4965564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4965568">case</span>&nbsp;<span class="ident" id="4965573">wire</span><span class="op" id="4965577">.</span><span class="ident" id="4965578">ArrayT</span>&nbsp;<span class="op" id="4965585">!=</span>&nbsp;<span class="ident" id="4965588">nil</span><span class="op" id="4965591">:</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4965596">elemId</span>&nbsp;<span class="op" id="4965603">:=</span>&nbsp;<span class="ident" id="4965606">wire</span><span class="op" id="4965610">.</span><span class="ident" id="4965611">ArrayT</span><span class="op" id="4965617">.</span><span class="ident" id="4965618">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4965626">elemOp</span>&nbsp;<span class="op" id="4965633">:=</span>&nbsp;<span class="ident" id="4965636">dec</span><span class="op" id="4965639">.</span><span class="ident" id="4965640">decIgnoreOpFor</span><span class="op" id="4965654">(</span><span class="ident" id="4965655">elemId</span><span class="op" id="4965661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4965666">op</span>&nbsp;<span class="op" id="4965669">=</span>&nbsp;<span class="keyword" id="4965671">func</span><span class="op" id="4965675">(</span><span class="ident" id="4965676">i</span>&nbsp;<span class="op" id="4965678">*</span><span class="ident" id="4965679">decInstr</span><span class="op" id="4965687">,</span>&nbsp;<span class="ident" id="4965689">state</span>&nbsp;<span class="op" id="4965695">*</span><span class="ident" id="4965696">decoderState</span><span class="op" id="4965708">,</span>&nbsp;<span class="ident" id="4965710">value</span>&nbsp;<span class="ident" id="4965716">reflect</span><span class="op" id="4965723">.</span><span class="ident" id="4965724">Value</span><span class="op" id="4965729">)</span>&nbsp;<span class="op" id="4965731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4965737">state</span><span class="op" id="4965742">.</span><span class="ident" id="4965743">dec</span><span class="op" id="4965746">.</span><span class="ident" id="4965747">ignoreArray</span><span class="op" id="4965758">(</span><span class="ident" id="4965759">state</span><span class="op" id="4965764">,</span>&nbsp;<span class="ident" id="4965766">elemOp</span><span class="op" id="4965772">,</span>&nbsp;<span class="ident" id="4965774">wire</span><span class="op" id="4965778">.</span><span class="ident" id="4965779">ArrayT</span><span class="op" id="4965785">.</span><span class="ident" id="4965786">Len</span><span class="op" id="4965789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4965794">}</span><br>
<span class="lineno">865</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4965799">case</span>&nbsp;<span class="ident" id="4965804">wire</span><span class="op" id="4965808">.</span><span class="ident" id="4965809">MapT</span>&nbsp;<span class="op" id="4965814">!=</span>&nbsp;<span class="ident" id="4965817">nil</span><span class="op" id="4965820">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4965825">keyId</span>&nbsp;<span class="op" id="4965831">:=</span>&nbsp;<span class="ident" id="4965834">dec</span><span class="op" id="4965837">.</span><span class="ident" id="4965838">wireType</span><span class="op" id="4965846">[</span><span class="ident" id="4965847">wireId</span><span class="op" id="4965853">]</span><span class="op" id="4965854">.</span><span class="ident" id="4965855">MapT</span><span class="op" id="4965859">.</span><span class="ident" id="4965860">Key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4965867">elemId</span>&nbsp;<span class="op" id="4965874">:=</span>&nbsp;<span class="ident" id="4965877">dec</span><span class="op" id="4965880">.</span><span class="ident" id="4965881">wireType</span><span class="op" id="4965889">[</span><span class="ident" id="4965890">wireId</span><span class="op" id="4965896">]</span><span class="op" id="4965897">.</span><span class="ident" id="4965898">MapT</span><span class="op" id="4965902">.</span><span class="ident" id="4965903">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4965911">keyOp</span>&nbsp;<span class="op" id="4965917">:=</span>&nbsp;<span class="ident" id="4965920">dec</span><span class="op" id="4965923">.</span><span class="ident" id="4965924">decIgnoreOpFor</span><span class="op" id="4965938">(</span><span class="ident" id="4965939">keyId</span><span class="op" id="4965944">)</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4965949">elemOp</span>&nbsp;<span class="op" id="4965956">:=</span>&nbsp;<span class="ident" id="4965959">dec</span><span class="op" id="4965962">.</span><span class="ident" id="4965963">decIgnoreOpFor</span><span class="op" id="4965977">(</span><span class="ident" id="4965978">elemId</span><span class="op" id="4965984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4965989">op</span>&nbsp;<span class="op" id="4965992">=</span>&nbsp;<span class="keyword" id="4965994">func</span><span class="op" id="4965998">(</span><span class="ident" id="4965999">i</span>&nbsp;<span class="op" id="4966001">*</span><span class="ident" id="4966002">decInstr</span><span class="op" id="4966010">,</span>&nbsp;<span class="ident" id="4966012">state</span>&nbsp;<span class="op" id="4966018">*</span><span class="ident" id="4966019">decoderState</span><span class="op" id="4966031">,</span>&nbsp;<span class="ident" id="4966033">value</span>&nbsp;<span class="ident" id="4966039">reflect</span><span class="op" id="4966046">.</span><span class="ident" id="4966047">Value</span><span class="op" id="4966052">)</span>&nbsp;<span class="op" id="4966054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4966060">state</span><span class="op" id="4966065">.</span><span class="ident" id="4966066">dec</span><span class="op" id="4966069">.</span><span class="ident" id="4966070">ignoreMap</span><span class="op" id="4966079">(</span><span class="ident" id="4966080">state</span><span class="op" id="4966085">,</span>&nbsp;<span class="ident" id="4966087">keyOp</span><span class="op" id="4966092">,</span>&nbsp;<span class="ident" id="4966094">elemOp</span><span class="op" id="4966100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4966105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4966110">case</span>&nbsp;<span class="ident" id="4966115">wire</span><span class="op" id="4966119">.</span><span class="ident" id="4966120">SliceT</span>&nbsp;<span class="op" id="4966127">!=</span>&nbsp;<span class="ident" id="4966130">nil</span><span class="op" id="4966133">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4966138">elemId</span>&nbsp;<span class="op" id="4966145">:=</span>&nbsp;<span class="ident" id="4966148">wire</span><span class="op" id="4966152">.</span><span class="ident" id="4966153">SliceT</span><span class="op" id="4966159">.</span><span class="ident" id="4966160">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4966168">elemOp</span>&nbsp;<span class="op" id="4966175">:=</span>&nbsp;<span class="ident" id="4966178">dec</span><span class="op" id="4966181">.</span><span class="ident" id="4966182">decIgnoreOpFor</span><span class="op" id="4966196">(</span><span class="ident" id="4966197">elemId</span><span class="op" id="4966203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4966208">op</span>&nbsp;<span class="op" id="4966211">=</span>&nbsp;<span class="keyword" id="4966213">func</span><span class="op" id="4966217">(</span><span class="ident" id="4966218">i</span>&nbsp;<span class="op" id="4966220">*</span><span class="ident" id="4966221">decInstr</span><span class="op" id="4966229">,</span>&nbsp;<span class="ident" id="4966231">state</span>&nbsp;<span class="op" id="4966237">*</span><span class="ident" id="4966238">decoderState</span><span class="op" id="4966250">,</span>&nbsp;<span class="ident" id="4966252">value</span>&nbsp;<span class="ident" id="4966258">reflect</span><span class="op" id="4966265">.</span><span class="ident" id="4966266">Value</span><span class="op" id="4966271">)</span>&nbsp;<span class="op" id="4966273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4966279">state</span><span class="op" id="4966284">.</span><span class="ident" id="4966285">dec</span><span class="op" id="4966288">.</span><span class="ident" id="4966289">ignoreSlice</span><span class="op" id="4966300">(</span><span class="ident" id="4966301">state</span><span class="op" id="4966306">,</span>&nbsp;<span class="ident" id="4966308">elemOp</span><span class="op" id="4966314">)</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4966319">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4966324">case</span>&nbsp;<span class="ident" id="4966329">wire</span><span class="op" id="4966333">.</span><span class="ident" id="4966334">StructT</span>&nbsp;<span class="op" id="4966342">!=</span>&nbsp;<span class="ident" id="4966345">nil</span><span class="op" id="4966348">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4966353">//&nbsp;Generate&nbsp;a&nbsp;closure&nbsp;that&nbsp;calls&nbsp;out&nbsp;to&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;nested&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4966428">enginePtr</span><span class="op" id="4966437">,</span>&nbsp;<span class="ident" id="4966439">err</span>&nbsp;<span class="op" id="4966443">:=</span>&nbsp;<span class="ident" id="4966446">dec</span><span class="op" id="4966449">.</span><span class="ident" id="4966450">getIgnoreEnginePtr</span><span class="op" id="4966468">(</span><span class="ident" id="4966469">wireId</span><span class="op" id="4966475">)</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4966480">if</span>&nbsp;<span class="ident" id="4966483">err</span>&nbsp;<span class="op" id="4966487">!=</span>&nbsp;<span class="ident" id="4966490">nil</span>&nbsp;<span class="op" id="4966494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4966500">error_</span><span class="op" id="4966506">(</span><span class="ident" id="4966507">err</span><span class="op" id="4966510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4966515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4966520">op</span>&nbsp;<span class="op" id="4966523">=</span>&nbsp;<span class="keyword" id="4966525">func</span><span class="op" id="4966529">(</span><span class="ident" id="4966530">i</span>&nbsp;<span class="op" id="4966532">*</span><span class="ident" id="4966533">decInstr</span><span class="op" id="4966541">,</span>&nbsp;<span class="ident" id="4966543">state</span>&nbsp;<span class="op" id="4966549">*</span><span class="ident" id="4966550">decoderState</span><span class="op" id="4966562">,</span>&nbsp;<span class="ident" id="4966564">value</span>&nbsp;<span class="ident" id="4966570">reflect</span><span class="op" id="4966577">.</span><span class="ident" id="4966578">Value</span><span class="op" id="4966583">)</span>&nbsp;<span class="op" id="4966585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4966591">//&nbsp;indirect&nbsp;through&nbsp;enginePtr&nbsp;to&nbsp;delay&nbsp;evaluation&nbsp;for&nbsp;recursive&nbsp;structs</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4966667">state</span><span class="op" id="4966672">.</span><span class="ident" id="4966673">dec</span><span class="op" id="4966676">.</span><span class="ident" id="4966677">ignoreStruct</span><span class="op" id="4966689">(</span><span class="op" id="4966690">*</span><span class="ident" id="4966691">enginePtr</span><span class="op" id="4966700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4966705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4966710">case</span>&nbsp;<span class="ident" id="4966715">wire</span><span class="op" id="4966719">.</span><span class="ident" id="4966720">GobEncoderT</span>&nbsp;<span class="op" id="4966732">!=</span>&nbsp;<span class="ident" id="4966735">nil</span><span class="op" id="4966738">,</span>&nbsp;<span class="ident" id="4966740">wire</span><span class="op" id="4966744">.</span><span class="ident" id="4966745">BinaryMarshalerT</span>&nbsp;<span class="op" id="4966762">!=</span>&nbsp;<span class="ident" id="4966765">nil</span><span class="op" id="4966768">,</span>&nbsp;<span class="ident" id="4966770">wire</span><span class="op" id="4966774">.</span><span class="ident" id="4966775">TextMarshalerT</span>&nbsp;<span class="op" id="4966790">!=</span>&nbsp;<span class="ident" id="4966793">nil</span><span class="op" id="4966796">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4966801">op</span>&nbsp;<span class="op" id="4966804">=</span>&nbsp;<span class="keyword" id="4966806">func</span><span class="op" id="4966810">(</span><span class="ident" id="4966811">i</span>&nbsp;<span class="op" id="4966813">*</span><span class="ident" id="4966814">decInstr</span><span class="op" id="4966822">,</span>&nbsp;<span class="ident" id="4966824">state</span>&nbsp;<span class="op" id="4966830">*</span><span class="ident" id="4966831">decoderState</span><span class="op" id="4966843">,</span>&nbsp;<span class="ident" id="4966845">value</span>&nbsp;<span class="ident" id="4966851">reflect</span><span class="op" id="4966858">.</span><span class="ident" id="4966859">Value</span><span class="op" id="4966864">)</span>&nbsp;<span class="op" id="4966866">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4966872">state</span><span class="op" id="4966877">.</span><span class="ident" id="4966878">dec</span><span class="op" id="4966881">.</span><span class="ident" id="4966882">ignoreGobDecoder</span><span class="op" id="4966898">(</span><span class="ident" id="4966899">state</span><span class="op" id="4966904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4966909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4966913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4966916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4966919">if</span>&nbsp;<span class="ident" id="4966922">op</span>&nbsp;<span class="op" id="4966925">==</span>&nbsp;<span class="ident" id="4966928">nil</span>&nbsp;<span class="op" id="4966932">{</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4966936">errorf</span><span class="op" id="4966942">(</span><span class="string" id="4966943">&#34;bad&nbsp;data:&nbsp;ignore&nbsp;can&#39;t&nbsp;handle&nbsp;type&nbsp;%s&#34;</span><span class="op" id="4966982">,</span>&nbsp;<span class="ident" id="4966984">wireId</span><span class="op" id="4966990">.</span><span class="builtintype" id="4966991">string</span><span class="op" id="4966997">(</span><span class="op" id="4966998">)</span><span class="op" id="4966999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4967002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4967005">return</span>&nbsp;<span class="ident" id="4967012">op</span><br>
<span class="lineno"></span><span class="op" id="4967015">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">905</span><span class="comment" id="4967018">//&nbsp;gobDecodeOpFor&nbsp;returns&nbsp;the&nbsp;op&nbsp;for&nbsp;a&nbsp;type&nbsp;that&nbsp;is&nbsp;known&nbsp;to&nbsp;implement</span><br>
<span class="lineno"></span><span class="comment" id="4967089">//&nbsp;GobDecoder.</span><br>
<span class="lineno"></span><span class="keyword" id="4967104">func</span>&nbsp;<span class="op" id="4967109">(</span><span class="ident" id="4967110">dec</span>&nbsp;<span class="op" id="4967114">*</span><span class="ident" id="4967115">Decoder</span><span class="op" id="4967122">)</span>&nbsp;<span class="ident" id="4967124">gobDecodeOpFor</span><span class="op" id="4967138">(</span><span class="ident" id="4967139">ut</span>&nbsp;<span class="op" id="4967142">*</span><span class="ident" id="4967143">userTypeInfo</span><span class="op" id="4967155">)</span>&nbsp;<span class="op" id="4967157">*</span><span class="ident" id="4967158">decOp</span>&nbsp;<span class="op" id="4967164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4967167">rcvrType</span>&nbsp;<span class="op" id="4967176">:=</span>&nbsp;<span class="ident" id="4967179">ut</span><span class="op" id="4967181">.</span><span class="ident" id="4967182">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4967188">if</span>&nbsp;<span class="ident" id="4967191">ut</span><span class="op" id="4967193">.</span><span class="ident" id="4967194">decIndir</span>&nbsp;<span class="op" id="4967203">==</span>&nbsp;<span class="op" id="4967206">-</span><span class="num" id="4967207">1</span>&nbsp;<span class="op" id="4967209">{</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4967213">rcvrType</span>&nbsp;<span class="op" id="4967222">=</span>&nbsp;<span class="ident" id="4967224">reflect</span><span class="op" id="4967231">.</span><span class="ident" id="4967232">PtrTo</span><span class="op" id="4967237">(</span><span class="ident" id="4967238">rcvrType</span><span class="op" id="4967246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4967249">}</span>&nbsp;<span class="keyword" id="4967251">else</span>&nbsp;<span class="keyword" id="4967256">if</span>&nbsp;<span class="ident" id="4967259">ut</span><span class="op" id="4967261">.</span><span class="ident" id="4967262">decIndir</span>&nbsp;<span class="op" id="4967271">&gt;</span>&nbsp;<span class="num" id="4967273">0</span>&nbsp;<span class="op" id="4967275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4967279">for</span>&nbsp;<span class="ident" id="4967283">i</span>&nbsp;<span class="op" id="4967285">:=</span>&nbsp;<span class="builtintype" id="4967288">int8</span><span class="op" id="4967292">(</span><span class="num" id="4967293">0</span><span class="op" id="4967294">)</span><span class="op" id="4967295">;</span>&nbsp;<span class="ident" id="4967297">i</span>&nbsp;<span class="op" id="4967299">&lt;</span>&nbsp;<span class="ident" id="4967301">ut</span><span class="op" id="4967303">.</span><span class="ident" id="4967304">decIndir</span><span class="op" id="4967312">;</span>&nbsp;<span class="ident" id="4967314">i</span><span class="op" id="4967315">++</span>&nbsp;<span class="op" id="4967318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4967323">rcvrType</span>&nbsp;<span class="op" id="4967332">=</span>&nbsp;<span class="ident" id="4967334">rcvrType</span><span class="op" id="4967342">.</span><span class="ident" id="4967343">Elem</span><span class="op" id="4967347">(</span><span class="op" id="4967348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4967352">}</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4967355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4967358">var</span>&nbsp;<span class="ident" id="4967362">op</span>&nbsp;<span class="ident" id="4967365">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4967372">op</span>&nbsp;<span class="op" id="4967375">=</span>&nbsp;<span class="keyword" id="4967377">func</span><span class="op" id="4967381">(</span><span class="ident" id="4967382">i</span>&nbsp;<span class="op" id="4967384">*</span><span class="ident" id="4967385">decInstr</span><span class="op" id="4967393">,</span>&nbsp;<span class="ident" id="4967395">state</span>&nbsp;<span class="op" id="4967401">*</span><span class="ident" id="4967402">decoderState</span><span class="op" id="4967414">,</span>&nbsp;<span class="ident" id="4967416">value</span>&nbsp;<span class="ident" id="4967422">reflect</span><span class="op" id="4967429">.</span><span class="ident" id="4967430">Value</span><span class="op" id="4967435">)</span>&nbsp;<span class="op" id="4967437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4967441">//&nbsp;We&nbsp;now&nbsp;have&nbsp;the&nbsp;base&nbsp;type.&nbsp;We&nbsp;need&nbsp;its&nbsp;address&nbsp;if&nbsp;the&nbsp;receiver&nbsp;is&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4967523">if</span>&nbsp;<span class="ident" id="4967526">value</span><span class="op" id="4967531">.</span><span class="ident" id="4967532">Kind</span><span class="op" id="4967536">(</span><span class="op" id="4967537">)</span>&nbsp;<span class="op" id="4967539">!=</span>&nbsp;<span class="ident" id="4967542">reflect</span><span class="op" id="4967549">.</span><span class="ident" id="4967550">Ptr</span>&nbsp;<span class="op" id="4967554">&amp;&amp;</span>&nbsp;<span class="ident" id="4967557">rcvrType</span><span class="op" id="4967565">.</span><span class="ident" id="4967566">Kind</span><span class="op" id="4967570">(</span><span class="op" id="4967571">)</span>&nbsp;<span class="op" id="4967573">==</span>&nbsp;<span class="ident" id="4967576">reflect</span><span class="op" id="4967583">.</span><span class="ident" id="4967584">Ptr</span>&nbsp;<span class="op" id="4967588">{</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4967593">value</span>&nbsp;<span class="op" id="4967599">=</span>&nbsp;<span class="ident" id="4967601">value</span><span class="op" id="4967606">.</span><span class="ident" id="4967607">Addr</span><span class="op" id="4967611">(</span><span class="op" id="4967612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4967616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4967620">state</span><span class="op" id="4967625">.</span><span class="ident" id="4967626">dec</span><span class="op" id="4967629">.</span><span class="ident" id="4967630">decodeGobDecoder</span><span class="op" id="4967646">(</span><span class="ident" id="4967647">ut</span><span class="op" id="4967649">,</span>&nbsp;<span class="ident" id="4967651">state</span><span class="op" id="4967656">,</span>&nbsp;<span class="ident" id="4967658">value</span><span class="op" id="4967663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4967666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4967669">return</span>&nbsp;<span class="op" id="4967676">&amp;</span><span class="ident" id="4967677">op</span><br>
<span class="lineno">925</span><span class="op" id="4967680">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4967683">//&nbsp;compatibleType&nbsp;asks:&nbsp;Are&nbsp;these&nbsp;two&nbsp;gob&nbsp;Types&nbsp;compatible?</span><br>
<span class="lineno"></span><span class="comment" id="4967743">//&nbsp;Answers&nbsp;the&nbsp;question&nbsp;for&nbsp;basic&nbsp;types,&nbsp;arrays,&nbsp;maps&nbsp;and&nbsp;slices,&nbsp;plus</span><br>
<span class="lineno"></span><span class="comment" id="4967814">//&nbsp;GobEncoder/Decoder&nbsp;pairs.</span><br>
<span class="lineno">930</span><span class="comment" id="4967843">//&nbsp;Structs&nbsp;are&nbsp;considered&nbsp;ok;&nbsp;fields&nbsp;will&nbsp;be&nbsp;checked&nbsp;later.</span><br>
<span class="lineno"></span><span class="keyword" id="4967903">func</span>&nbsp;<span class="op" id="4967908">(</span><span class="ident" id="4967909">dec</span>&nbsp;<span class="op" id="4967913">*</span><span class="ident" id="4967914">Decoder</span><span class="op" id="4967921">)</span>&nbsp;<span class="ident" id="4967923">compatibleType</span><span class="op" id="4967937">(</span><span class="ident" id="4967938">fr</span>&nbsp;<span class="ident" id="4967941">reflect</span><span class="op" id="4967948">.</span><span class="ident" id="4967949">Type</span><span class="op" id="4967953">,</span>&nbsp;<span class="ident" id="4967955">fw</span>&nbsp;<span class="ident" id="4967958">typeId</span><span class="op" id="4967964">,</span>&nbsp;<span class="ident" id="4967966">inProgress</span>&nbsp;<span class="keyword" id="4967977">map</span><span class="op" id="4967980">[</span><span class="ident" id="4967981">reflect</span><span class="op" id="4967988">.</span><span class="ident" id="4967989">Type</span><span class="op" id="4967993">]</span><span class="ident" id="4967994">typeId</span><span class="op" id="4968000">)</span>&nbsp;<span class="builtintype" id="4968002">bool</span>&nbsp;<span class="op" id="4968007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4968010">if</span>&nbsp;<span class="ident" id="4968013">rhs</span><span class="op" id="4968016">,</span>&nbsp;<span class="ident" id="4968018">ok</span>&nbsp;<span class="op" id="4968021">:=</span>&nbsp;<span class="ident" id="4968024">inProgress</span><span class="op" id="4968034">[</span><span class="ident" id="4968035">fr</span><span class="op" id="4968037">]</span><span class="op" id="4968038">;</span>&nbsp;<span class="ident" id="4968040">ok</span>&nbsp;<span class="op" id="4968043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4968047">return</span>&nbsp;<span class="ident" id="4968054">rhs</span>&nbsp;<span class="op" id="4968058">==</span>&nbsp;<span class="ident" id="4968061">fw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4968065">}</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4968068">inProgress</span><span class="op" id="4968078">[</span><span class="ident" id="4968079">fr</span><span class="op" id="4968081">]</span>&nbsp;<span class="op" id="4968083">=</span>&nbsp;<span class="ident" id="4968085">fw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4968089">ut</span>&nbsp;<span class="op" id="4968092">:=</span>&nbsp;<span class="ident" id="4968095">userType</span><span class="op" id="4968103">(</span><span class="ident" id="4968104">fr</span><span class="op" id="4968106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4968109">wire</span><span class="op" id="4968113">,</span>&nbsp;<span class="ident" id="4968115">ok</span>&nbsp;<span class="op" id="4968118">:=</span>&nbsp;<span class="ident" id="4968121">dec</span><span class="op" id="4968124">.</span><span class="ident" id="4968125">wireType</span><span class="op" id="4968133">[</span><span class="ident" id="4968134">fw</span><span class="op" id="4968136">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4968139">//&nbsp;If&nbsp;wire&nbsp;was&nbsp;encoded&nbsp;with&nbsp;an&nbsp;encoding&nbsp;method,&nbsp;fr&nbsp;must&nbsp;have&nbsp;that&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4968214">//&nbsp;And&nbsp;if&nbsp;not,&nbsp;it&nbsp;must&nbsp;not.</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4968243">//&nbsp;At&nbsp;most&nbsp;one&nbsp;of&nbsp;the&nbsp;booleans&nbsp;in&nbsp;ut&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4968289">//&nbsp;We&nbsp;could&nbsp;possibly&nbsp;relax&nbsp;this&nbsp;constraint&nbsp;in&nbsp;the&nbsp;future&nbsp;in&nbsp;order&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4968359">//&nbsp;choose&nbsp;the&nbsp;decoding&nbsp;method&nbsp;using&nbsp;the&nbsp;data&nbsp;in&nbsp;the&nbsp;wireType.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4968422">//&nbsp;The&nbsp;parentheses&nbsp;look&nbsp;odd&nbsp;but&nbsp;are&nbsp;correct.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4968468">if</span>&nbsp;<span class="op" id="4968471">(</span><span class="ident" id="4968472">ut</span><span class="op" id="4968474">.</span><span class="ident" id="4968475">externalDec</span>&nbsp;<span class="op" id="4968487">==</span>&nbsp;<span class="ident" id="4968490">xGob</span><span class="op" id="4968494">)</span>&nbsp;<span class="op" id="4968496">!=</span>&nbsp;<span class="op" id="4968499">(</span><span class="ident" id="4968500">ok</span>&nbsp;<span class="op" id="4968503">&amp;&amp;</span>&nbsp;<span class="ident" id="4968506">wire</span><span class="op" id="4968510">.</span><span class="ident" id="4968511">GobEncoderT</span>&nbsp;<span class="op" id="4968523">!=</span>&nbsp;<span class="ident" id="4968526">nil</span><span class="op" id="4968529">)</span>&nbsp;<span class="op" id="4968531">||</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4968536">(</span><span class="ident" id="4968537">ut</span><span class="op" id="4968539">.</span><span class="ident" id="4968540">externalDec</span>&nbsp;<span class="op" id="4968552">==</span>&nbsp;<span class="ident" id="4968555">xBinary</span><span class="op" id="4968562">)</span>&nbsp;<span class="op" id="4968564">!=</span>&nbsp;<span class="op" id="4968567">(</span><span class="ident" id="4968568">ok</span>&nbsp;<span class="op" id="4968571">&amp;&amp;</span>&nbsp;<span class="ident" id="4968574">wire</span><span class="op" id="4968578">.</span><span class="ident" id="4968579">BinaryMarshalerT</span>&nbsp;<span class="op" id="4968596">!=</span>&nbsp;<span class="ident" id="4968599">nil</span><span class="op" id="4968602">)</span>&nbsp;<span class="op" id="4968604">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4968609">(</span><span class="ident" id="4968610">ut</span><span class="op" id="4968612">.</span><span class="ident" id="4968613">externalDec</span>&nbsp;<span class="op" id="4968625">==</span>&nbsp;<span class="ident" id="4968628">xText</span><span class="op" id="4968633">)</span>&nbsp;<span class="op" id="4968635">!=</span>&nbsp;<span class="op" id="4968638">(</span><span class="ident" id="4968639">ok</span>&nbsp;<span class="op" id="4968642">&amp;&amp;</span>&nbsp;<span class="ident" id="4968645">wire</span><span class="op" id="4968649">.</span><span class="ident" id="4968650">TextMarshalerT</span>&nbsp;<span class="op" id="4968665">!=</span>&nbsp;<span class="ident" id="4968668">nil</span><span class="op" id="4968671">)</span>&nbsp;<span class="op" id="4968673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4968677">return</span>&nbsp;<span class="builtintype" id="4968684">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4968691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4968694">if</span>&nbsp;<span class="ident" id="4968697">ut</span><span class="op" id="4968699">.</span><span class="ident" id="4968700">externalDec</span>&nbsp;<span class="op" id="4968712">!=</span>&nbsp;<span class="num" id="4968715">0</span>&nbsp;<span class="op" id="4968717">{</span>&nbsp;<span class="comment" id="4968719">//&nbsp;This&nbsp;test&nbsp;trumps&nbsp;all&nbsp;others.</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4968753">return</span>&nbsp;<span class="builtintype" id="4968760">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4968766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4968769">switch</span>&nbsp;<span class="ident" id="4968776">t</span>&nbsp;<span class="op" id="4968778">:=</span>&nbsp;<span class="ident" id="4968781">ut</span><span class="op" id="4968783">.</span><span class="ident" id="4968784">base</span><span class="op" id="4968788">;</span>&nbsp;<span class="ident" id="4968790">t</span><span class="op" id="4968791">.</span><span class="ident" id="4968792">Kind</span><span class="op" id="4968796">(</span><span class="op" id="4968797">)</span>&nbsp;<span class="op" id="4968799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4968802">default</span><span class="op" id="4968809">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4968813">//&nbsp;chan,&nbsp;etc:&nbsp;cannot&nbsp;handle.</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4968844">return</span>&nbsp;<span class="builtintype" id="4968851">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4968858">case</span>&nbsp;<span class="ident" id="4968863">reflect</span><span class="op" id="4968870">.</span><span class="ident" id="4968871">Bool</span><span class="op" id="4968875">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4968879">return</span>&nbsp;<span class="ident" id="4968886">fw</span>&nbsp;<span class="op" id="4968889">==</span>&nbsp;<span class="ident" id="4968892">tBool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4968899">case</span>&nbsp;<span class="ident" id="4968904">reflect</span><span class="op" id="4968911">.</span><span class="ident" id="4968912">Int</span><span class="op" id="4968915">,</span>&nbsp;<span class="ident" id="4968917">reflect</span><span class="op" id="4968924">.</span><span class="ident" id="4968925">Int8</span><span class="op" id="4968929">,</span>&nbsp;<span class="ident" id="4968931">reflect</span><span class="op" id="4968938">.</span><span class="ident" id="4968939">Int16</span><span class="op" id="4968944">,</span>&nbsp;<span class="ident" id="4968946">reflect</span><span class="op" id="4968953">.</span><span class="ident" id="4968954">Int32</span><span class="op" id="4968959">,</span>&nbsp;<span class="ident" id="4968961">reflect</span><span class="op" id="4968968">.</span><span class="ident" id="4968969">Int64</span><span class="op" id="4968974">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4968978">return</span>&nbsp;<span class="ident" id="4968985">fw</span>&nbsp;<span class="op" id="4968988">==</span>&nbsp;<span class="ident" id="4968991">tInt</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4968997">case</span>&nbsp;<span class="ident" id="4969002">reflect</span><span class="op" id="4969009">.</span><span class="ident" id="4969010">Uint</span><span class="op" id="4969014">,</span>&nbsp;<span class="ident" id="4969016">reflect</span><span class="op" id="4969023">.</span><span class="ident" id="4969024">Uint8</span><span class="op" id="4969029">,</span>&nbsp;<span class="ident" id="4969031">reflect</span><span class="op" id="4969038">.</span><span class="ident" id="4969039">Uint16</span><span class="op" id="4969045">,</span>&nbsp;<span class="ident" id="4969047">reflect</span><span class="op" id="4969054">.</span><span class="ident" id="4969055">Uint32</span><span class="op" id="4969061">,</span>&nbsp;<span class="ident" id="4969063">reflect</span><span class="op" id="4969070">.</span><span class="ident" id="4969071">Uint64</span><span class="op" id="4969077">,</span>&nbsp;<span class="ident" id="4969079">reflect</span><span class="op" id="4969086">.</span><span class="ident" id="4969087">Uintptr</span><span class="op" id="4969094">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969098">return</span>&nbsp;<span class="ident" id="4969105">fw</span>&nbsp;<span class="op" id="4969108">==</span>&nbsp;<span class="ident" id="4969111">tUint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969118">case</span>&nbsp;<span class="ident" id="4969123">reflect</span><span class="op" id="4969130">.</span><span class="ident" id="4969131">Float32</span><span class="op" id="4969138">,</span>&nbsp;<span class="ident" id="4969140">reflect</span><span class="op" id="4969147">.</span><span class="ident" id="4969148">Float64</span><span class="op" id="4969155">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969159">return</span>&nbsp;<span class="ident" id="4969166">fw</span>&nbsp;<span class="op" id="4969169">==</span>&nbsp;<span class="ident" id="4969172">tFloat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969180">case</span>&nbsp;<span class="ident" id="4969185">reflect</span><span class="op" id="4969192">.</span><span class="ident" id="4969193">Complex64</span><span class="op" id="4969202">,</span>&nbsp;<span class="ident" id="4969204">reflect</span><span class="op" id="4969211">.</span><span class="ident" id="4969212">Complex128</span><span class="op" id="4969222">:</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969226">return</span>&nbsp;<span class="ident" id="4969233">fw</span>&nbsp;<span class="op" id="4969236">==</span>&nbsp;<span class="ident" id="4969239">tComplex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969249">case</span>&nbsp;<span class="ident" id="4969254">reflect</span><span class="op" id="4969261">.</span><span class="ident" id="4969262">String</span><span class="op" id="4969268">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969272">return</span>&nbsp;<span class="ident" id="4969279">fw</span>&nbsp;<span class="op" id="4969282">==</span>&nbsp;<span class="ident" id="4969285">tString</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969294">case</span>&nbsp;<span class="ident" id="4969299">reflect</span><span class="op" id="4969306">.</span><span class="ident" id="4969307">Interface</span><span class="op" id="4969316">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969320">return</span>&nbsp;<span class="ident" id="4969327">fw</span>&nbsp;<span class="op" id="4969330">==</span>&nbsp;<span class="ident" id="4969333">tInterface</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969345">case</span>&nbsp;<span class="ident" id="4969350">reflect</span><span class="op" id="4969357">.</span><span class="ident" id="4969358">Array</span><span class="op" id="4969363">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969367">if</span>&nbsp;<span class="op" id="4969370">!</span><span class="ident" id="4969371">ok</span>&nbsp;<span class="op" id="4969374">||</span>&nbsp;<span class="ident" id="4969377">wire</span><span class="op" id="4969381">.</span><span class="ident" id="4969382">ArrayT</span>&nbsp;<span class="op" id="4969389">==</span>&nbsp;<span class="ident" id="4969392">nil</span>&nbsp;<span class="op" id="4969396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969401">return</span>&nbsp;<span class="builtintype" id="4969408">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4969416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4969420">array</span>&nbsp;<span class="op" id="4969426">:=</span>&nbsp;<span class="ident" id="4969429">wire</span><span class="op" id="4969433">.</span><span class="ident" id="4969434">ArrayT</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969443">return</span>&nbsp;<span class="ident" id="4969450">t</span><span class="op" id="4969451">.</span><span class="ident" id="4969452">Len</span><span class="op" id="4969455">(</span><span class="op" id="4969456">)</span>&nbsp;<span class="op" id="4969458">==</span>&nbsp;<span class="ident" id="4969461">array</span><span class="op" id="4969466">.</span><span class="ident" id="4969467">Len</span>&nbsp;<span class="op" id="4969471">&amp;&amp;</span>&nbsp;<span class="ident" id="4969474">dec</span><span class="op" id="4969477">.</span><span class="ident" id="4969478">compatibleType</span><span class="op" id="4969492">(</span><span class="ident" id="4969493">t</span><span class="op" id="4969494">.</span><span class="ident" id="4969495">Elem</span><span class="op" id="4969499">(</span><span class="op" id="4969500">)</span><span class="op" id="4969501">,</span>&nbsp;<span class="ident" id="4969503">array</span><span class="op" id="4969508">.</span><span class="ident" id="4969509">Elem</span><span class="op" id="4969513">,</span>&nbsp;<span class="ident" id="4969515">inProgress</span><span class="op" id="4969525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969528">case</span>&nbsp;<span class="ident" id="4969533">reflect</span><span class="op" id="4969540">.</span><span class="ident" id="4969541">Map</span><span class="op" id="4969544">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969548">if</span>&nbsp;<span class="op" id="4969551">!</span><span class="ident" id="4969552">ok</span>&nbsp;<span class="op" id="4969555">||</span>&nbsp;<span class="ident" id="4969558">wire</span><span class="op" id="4969562">.</span><span class="ident" id="4969563">MapT</span>&nbsp;<span class="op" id="4969568">==</span>&nbsp;<span class="ident" id="4969571">nil</span>&nbsp;<span class="op" id="4969575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969580">return</span>&nbsp;<span class="builtintype" id="4969587">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4969595">}</span><br>
<span class="lineno">980</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4969599">MapType</span>&nbsp;<span class="op" id="4969607">:=</span>&nbsp;<span class="ident" id="4969610">wire</span><span class="op" id="4969614">.</span><span class="ident" id="4969615">MapT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969622">return</span>&nbsp;<span class="ident" id="4969629">dec</span><span class="op" id="4969632">.</span><span class="ident" id="4969633">compatibleType</span><span class="op" id="4969647">(</span><span class="ident" id="4969648">t</span><span class="op" id="4969649">.</span><span class="ident" id="4969650">Key</span><span class="op" id="4969653">(</span><span class="op" id="4969654">)</span><span class="op" id="4969655">,</span>&nbsp;<span class="ident" id="4969657">MapType</span><span class="op" id="4969664">.</span><span class="ident" id="4969665">Key</span><span class="op" id="4969668">,</span>&nbsp;<span class="ident" id="4969670">inProgress</span><span class="op" id="4969680">)</span>&nbsp;<span class="op" id="4969682">&amp;&amp;</span>&nbsp;<span class="ident" id="4969685">dec</span><span class="op" id="4969688">.</span><span class="ident" id="4969689">compatibleType</span><span class="op" id="4969703">(</span><span class="ident" id="4969704">t</span><span class="op" id="4969705">.</span><span class="ident" id="4969706">Elem</span><span class="op" id="4969710">(</span><span class="op" id="4969711">)</span><span class="op" id="4969712">,</span>&nbsp;<span class="ident" id="4969714">MapType</span><span class="op" id="4969721">.</span><span class="ident" id="4969722">Elem</span><span class="op" id="4969726">,</span>&nbsp;<span class="ident" id="4969728">inProgress</span><span class="op" id="4969738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969741">case</span>&nbsp;<span class="ident" id="4969746">reflect</span><span class="op" id="4969753">.</span><span class="ident" id="4969754">Slice</span><span class="op" id="4969759">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4969763">//&nbsp;Is&nbsp;it&nbsp;an&nbsp;array&nbsp;of&nbsp;bytes?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969793">if</span>&nbsp;<span class="ident" id="4969796">t</span><span class="op" id="4969797">.</span><span class="ident" id="4969798">Elem</span><span class="op" id="4969802">(</span><span class="op" id="4969803">)</span><span class="op" id="4969804">.</span><span class="ident" id="4969805">Kind</span><span class="op" id="4969809">(</span><span class="op" id="4969810">)</span>&nbsp;<span class="op" id="4969812">==</span>&nbsp;<span class="ident" id="4969815">reflect</span><span class="op" id="4969822">.</span><span class="ident" id="4969823">Uint8</span>&nbsp;<span class="op" id="4969829">{</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969834">return</span>&nbsp;<span class="ident" id="4969841">fw</span>&nbsp;<span class="op" id="4969844">==</span>&nbsp;<span class="ident" id="4969847">tBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4969856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4969860">//&nbsp;Extract&nbsp;and&nbsp;compare&nbsp;element&nbsp;types.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969900">var</span>&nbsp;<span class="ident" id="4969904">sw</span>&nbsp;<span class="op" id="4969907">*</span><span class="ident" id="4969908">sliceType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969920">if</span>&nbsp;<span class="ident" id="4969923">tt</span><span class="op" id="4969925">,</span>&nbsp;<span class="ident" id="4969927">ok</span>&nbsp;<span class="op" id="4969930">:=</span>&nbsp;<span class="ident" id="4969933">builtinIdToType</span><span class="op" id="4969948">[</span><span class="ident" id="4969949">fw</span><span class="op" id="4969951">]</span><span class="op" id="4969952">;</span>&nbsp;<span class="ident" id="4969954">ok</span>&nbsp;<span class="op" id="4969957">{</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4969962">sw</span><span class="op" id="4969964">,</span>&nbsp;<span class="ident" id="4969966">_</span>&nbsp;<span class="op" id="4969968">=</span>&nbsp;<span class="ident" id="4969970">tt</span><span class="op" id="4969972">.</span><span class="op" id="4969973">(</span><span class="op" id="4969974">*</span><span class="ident" id="4969975">sliceType</span><span class="op" id="4969984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4969988">}</span>&nbsp;<span class="keyword" id="4969990">else</span>&nbsp;<span class="keyword" id="4969995">if</span>&nbsp;<span class="ident" id="4969998">wire</span>&nbsp;<span class="op" id="4970003">!=</span>&nbsp;<span class="ident" id="4970006">nil</span>&nbsp;<span class="op" id="4970010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4970015">sw</span>&nbsp;<span class="op" id="4970018">=</span>&nbsp;<span class="ident" id="4970020">wire</span><span class="op" id="4970024">.</span><span class="ident" id="4970025">SliceT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4970034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4970038">elem</span>&nbsp;<span class="op" id="4970043">:=</span>&nbsp;<span class="ident" id="4970046">userType</span><span class="op" id="4970054">(</span><span class="ident" id="4970055">t</span><span class="op" id="4970056">.</span><span class="ident" id="4970057">Elem</span><span class="op" id="4970061">(</span><span class="op" id="4970062">)</span><span class="op" id="4970063">)</span><span class="op" id="4970064">.</span><span class="ident" id="4970065">base</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4970072">return</span>&nbsp;<span class="ident" id="4970079">sw</span>&nbsp;<span class="op" id="4970082">!=</span>&nbsp;<span class="ident" id="4970085">nil</span>&nbsp;<span class="op" id="4970089">&amp;&amp;</span>&nbsp;<span class="ident" id="4970092">dec</span><span class="op" id="4970095">.</span><span class="ident" id="4970096">compatibleType</span><span class="op" id="4970110">(</span><span class="ident" id="4970111">elem</span><span class="op" id="4970115">,</span>&nbsp;<span class="ident" id="4970117">sw</span><span class="op" id="4970119">.</span><span class="ident" id="4970120">Elem</span><span class="op" id="4970124">,</span>&nbsp;<span class="ident" id="4970126">inProgress</span><span class="op" id="4970136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4970139">case</span>&nbsp;<span class="ident" id="4970144">reflect</span><span class="op" id="4970151">.</span><span class="ident" id="4970152">Struct</span><span class="op" id="4970158">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4970162">return</span>&nbsp;<span class="builtintype" id="4970169">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4970175">}</span><br>
<span class="lineno"></span><span class="op" id="4970177">}</span><br>
<span class="lineno">1000</span><br>
<span class="lineno"></span><span class="comment" id="4970180">//&nbsp;typeString&nbsp;returns&nbsp;a&nbsp;human-readable&nbsp;description&nbsp;of&nbsp;the&nbsp;type&nbsp;identified&nbsp;by&nbsp;remoteId.</span><br>
<span class="lineno"></span><span class="keyword" id="4970267">func</span>&nbsp;<span class="op" id="4970272">(</span><span class="ident" id="4970273">dec</span>&nbsp;<span class="op" id="4970277">*</span><span class="ident" id="4970278">Decoder</span><span class="op" id="4970285">)</span>&nbsp;<span class="ident" id="4970287">typeString</span><span class="op" id="4970297">(</span><span class="ident" id="4970298">remoteId</span>&nbsp;<span class="ident" id="4970307">typeId</span><span class="op" id="4970313">)</span>&nbsp;<span class="builtintype" id="4970315">string</span>&nbsp;<span class="op" id="4970322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4970325">if</span>&nbsp;<span class="ident" id="4970328">t</span>&nbsp;<span class="op" id="4970330">:=</span>&nbsp;<span class="ident" id="4970333">idToType</span><span class="op" id="4970341">[</span><span class="ident" id="4970342">remoteId</span><span class="op" id="4970350">]</span><span class="op" id="4970351">;</span>&nbsp;<span class="ident" id="4970353">t</span>&nbsp;<span class="op" id="4970355">!=</span>&nbsp;<span class="ident" id="4970358">nil</span>&nbsp;<span class="op" id="4970362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4970366">//&nbsp;globally&nbsp;known&nbsp;type.</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4970392">return</span>&nbsp;<span class="ident" id="4970399">t</span><span class="op" id="4970400">.</span><span class="builtintype" id="4970401">string</span><span class="op" id="4970407">(</span><span class="op" id="4970408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4970411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4970414">return</span>&nbsp;<span class="ident" id="4970421">dec</span><span class="op" id="4970424">.</span><span class="ident" id="4970425">wireType</span><span class="op" id="4970433">[</span><span class="ident" id="4970434">remoteId</span><span class="op" id="4970442">]</span><span class="op" id="4970443">.</span><span class="builtintype" id="4970444">string</span><span class="op" id="4970450">(</span><span class="op" id="4970451">)</span><br>
<span class="lineno"></span><span class="op" id="4970453">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1010</span><span class="comment" id="4970456">//&nbsp;compileSingle&nbsp;compiles&nbsp;the&nbsp;decoder&nbsp;engine&nbsp;for&nbsp;a&nbsp;non-struct&nbsp;top-level&nbsp;value,&nbsp;including</span><br>
<span class="lineno"></span><span class="comment" id="4970545">//&nbsp;GobDecoders.</span><br>
<span class="lineno"></span><span class="keyword" id="4970561">func</span>&nbsp;<span class="op" id="4970566">(</span><span class="ident" id="4970567">dec</span>&nbsp;<span class="op" id="4970571">*</span><span class="ident" id="4970572">Decoder</span><span class="op" id="4970579">)</span>&nbsp;<span class="ident" id="4970581">compileSingle</span><span class="op" id="4970594">(</span><span class="ident" id="4970595">remoteId</span>&nbsp;<span class="ident" id="4970604">typeId</span><span class="op" id="4970610">,</span>&nbsp;<span class="ident" id="4970612">ut</span>&nbsp;<span class="op" id="4970615">*</span><span class="ident" id="4970616">userTypeInfo</span><span class="op" id="4970628">)</span>&nbsp;<span class="op" id="4970630">(</span><span class="ident" id="4970631">engine</span>&nbsp;<span class="op" id="4970638">*</span><span class="ident" id="4970639">decEngine</span><span class="op" id="4970648">,</span>&nbsp;<span class="ident" id="4970650">err</span>&nbsp;<span class="builtintype" id="4970654">error</span><span class="op" id="4970659">)</span>&nbsp;<span class="op" id="4970661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4970664">rt</span>&nbsp;<span class="op" id="4970667">:=</span>&nbsp;<span class="ident" id="4970670">ut</span><span class="op" id="4970672">.</span><span class="ident" id="4970673">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4970679">engine</span>&nbsp;<span class="op" id="4970686">=</span>&nbsp;<span class="builtinfunc" id="4970688">new</span><span class="op" id="4970691">(</span><span class="ident" id="4970692">decEngine</span><span class="op" id="4970701">)</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4970704">engine</span><span class="op" id="4970710">.</span><span class="ident" id="4970711">instr</span>&nbsp;<span class="op" id="4970717">=</span>&nbsp;<span class="builtinfunc" id="4970719">make</span><span class="op" id="4970723">(</span><span class="op" id="4970724">[</span><span class="op" id="4970725">]</span><span class="ident" id="4970726">decInstr</span><span class="op" id="4970734">,</span>&nbsp;<span class="num" id="4970736">1</span><span class="op" id="4970737">)</span>&nbsp;<span class="comment" id="4970739">//&nbsp;one&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4970752">name</span>&nbsp;<span class="op" id="4970757">:=</span>&nbsp;<span class="ident" id="4970760">rt</span><span class="op" id="4970762">.</span><span class="ident" id="4970763">String</span><span class="op" id="4970769">(</span><span class="op" id="4970770">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4970787">//&nbsp;best&nbsp;we&nbsp;can&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4970806">if</span>&nbsp;<span class="op" id="4970809">!</span><span class="ident" id="4970810">dec</span><span class="op" id="4970813">.</span><span class="ident" id="4970814">compatibleType</span><span class="op" id="4970828">(</span><span class="ident" id="4970829">rt</span><span class="op" id="4970831">,</span>&nbsp;<span class="ident" id="4970833">remoteId</span><span class="op" id="4970841">,</span>&nbsp;<span class="builtinfunc" id="4970843">make</span><span class="op" id="4970847">(</span><span class="keyword" id="4970848">map</span><span class="op" id="4970851">[</span><span class="ident" id="4970852">reflect</span><span class="op" id="4970859">.</span><span class="ident" id="4970860">Type</span><span class="op" id="4970864">]</span><span class="ident" id="4970865">typeId</span><span class="op" id="4970871">)</span><span class="op" id="4970872">)</span>&nbsp;<span class="op" id="4970874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4970878">remoteType</span>&nbsp;<span class="op" id="4970889">:=</span>&nbsp;<span class="ident" id="4970892">dec</span><span class="op" id="4970895">.</span><span class="ident" id="4970896">typeString</span><span class="op" id="4970906">(</span><span class="ident" id="4970907">remoteId</span><span class="op" id="4970915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4970919">//&nbsp;Common&nbsp;confusing&nbsp;case:&nbsp;local&nbsp;interface&nbsp;type,&nbsp;remote&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4970991">if</span>&nbsp;<span class="ident" id="4970994">ut</span><span class="op" id="4970996">.</span><span class="ident" id="4970997">base</span><span class="op" id="4971001">.</span><span class="ident" id="4971002">Kind</span><span class="op" id="4971006">(</span><span class="op" id="4971007">)</span>&nbsp;<span class="op" id="4971009">==</span>&nbsp;<span class="ident" id="4971012">reflect</span><span class="op" id="4971019">.</span><span class="ident" id="4971020">Interface</span>&nbsp;<span class="op" id="4971030">&amp;&amp;</span>&nbsp;<span class="ident" id="4971033">remoteId</span>&nbsp;<span class="op" id="4971042">!=</span>&nbsp;<span class="ident" id="4971045">tInterface</span>&nbsp;<span class="op" id="4971056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4971061">return</span>&nbsp;<span class="ident" id="4971068">nil</span><span class="op" id="4971071">,</span>&nbsp;<span class="ident" id="4971073">errors</span><span class="op" id="4971079">.</span><span class="ident" id="4971080">New</span><span class="op" id="4971083">(</span><span class="string" id="4971084">&#34;gob:&nbsp;local&nbsp;interface&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="4971113">+</span>&nbsp;<span class="ident" id="4971115">name</span>&nbsp;<span class="op" id="4971120">+</span>&nbsp;<span class="string" id="4971122">&#34;&nbsp;can&nbsp;only&nbsp;be&nbsp;decoded&nbsp;from&nbsp;remote&nbsp;interface&nbsp;type;&nbsp;received&nbsp;concrete&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="4971197">+</span>&nbsp;<span class="ident" id="4971199">remoteType</span><span class="op" id="4971209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4971213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4971217">return</span>&nbsp;<span class="ident" id="4971224">nil</span><span class="op" id="4971227">,</span>&nbsp;<span class="ident" id="4971229">errors</span><span class="op" id="4971235">.</span><span class="ident" id="4971236">New</span><span class="op" id="4971239">(</span><span class="string" id="4971240">&#34;gob:&nbsp;decoding&nbsp;into&nbsp;local&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="4971273">+</span>&nbsp;<span class="ident" id="4971275">name</span>&nbsp;<span class="op" id="4971280">+</span>&nbsp;<span class="string" id="4971282">&#34;,&nbsp;received&nbsp;remote&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="4971308">+</span>&nbsp;<span class="ident" id="4971310">remoteType</span><span class="op" id="4971320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4971323">}</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4971326">op</span>&nbsp;<span class="op" id="4971329">:=</span>&nbsp;<span class="ident" id="4971332">dec</span><span class="op" id="4971335">.</span><span class="ident" id="4971336">decOpFor</span><span class="op" id="4971344">(</span><span class="ident" id="4971345">remoteId</span><span class="op" id="4971353">,</span>&nbsp;<span class="ident" id="4971355">rt</span><span class="op" id="4971357">,</span>&nbsp;<span class="ident" id="4971359">name</span><span class="op" id="4971363">,</span>&nbsp;<span class="builtinfunc" id="4971365">make</span><span class="op" id="4971369">(</span><span class="keyword" id="4971370">map</span><span class="op" id="4971373">[</span><span class="ident" id="4971374">reflect</span><span class="op" id="4971381">.</span><span class="ident" id="4971382">Type</span><span class="op" id="4971386">]</span><span class="op" id="4971387">*</span><span class="ident" id="4971388">decOp</span><span class="op" id="4971393">)</span><span class="op" id="4971394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4971397">ovfl</span>&nbsp;<span class="op" id="4971402">:=</span>&nbsp;<span class="ident" id="4971405">errors</span><span class="op" id="4971411">.</span><span class="ident" id="4971412">New</span><span class="op" id="4971415">(</span><span class="string" id="4971416">`value&nbsp;for&nbsp;&#34;`</span>&nbsp;<span class="op" id="4971430">+</span>&nbsp;<span class="ident" id="4971432">name</span>&nbsp;<span class="op" id="4971437">+</span>&nbsp;<span class="string" id="4971439">`&#34;&nbsp;out&nbsp;of&nbsp;range`</span><span class="op" id="4971455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4971458">engine</span><span class="op" id="4971464">.</span><span class="ident" id="4971465">instr</span><span class="op" id="4971470">[</span><span class="ident" id="4971471">singletonField</span><span class="op" id="4971485">]</span>&nbsp;<span class="op" id="4971487">=</span>&nbsp;<span class="ident" id="4971489">decInstr</span><span class="op" id="4971497">{</span><span class="op" id="4971498">*</span><span class="ident" id="4971499">op</span><span class="op" id="4971501">,</span>&nbsp;<span class="ident" id="4971503">singletonField</span><span class="op" id="4971517">,</span>&nbsp;<span class="ident" id="4971519">nil</span><span class="op" id="4971522">,</span>&nbsp;<span class="ident" id="4971524">ovfl</span><span class="op" id="4971528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4971531">engine</span><span class="op" id="4971537">.</span><span class="ident" id="4971538">numInstr</span>&nbsp;<span class="op" id="4971547">=</span>&nbsp;<span class="num" id="4971549">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4971552">return</span><br>
<span class="lineno">1030</span><span class="op" id="4971559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4971562">//&nbsp;compileIgnoreSingle&nbsp;compiles&nbsp;the&nbsp;decoder&nbsp;engine&nbsp;for&nbsp;a&nbsp;non-struct&nbsp;top-level&nbsp;value&nbsp;that&nbsp;will&nbsp;be&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="keyword" id="4971670">func</span>&nbsp;<span class="op" id="4971675">(</span><span class="ident" id="4971676">dec</span>&nbsp;<span class="op" id="4971680">*</span><span class="ident" id="4971681">Decoder</span><span class="op" id="4971688">)</span>&nbsp;<span class="ident" id="4971690">compileIgnoreSingle</span><span class="op" id="4971709">(</span><span class="ident" id="4971710">remoteId</span>&nbsp;<span class="ident" id="4971719">typeId</span><span class="op" id="4971725">)</span>&nbsp;<span class="op" id="4971727">(</span><span class="ident" id="4971728">engine</span>&nbsp;<span class="op" id="4971735">*</span><span class="ident" id="4971736">decEngine</span><span class="op" id="4971745">,</span>&nbsp;<span class="ident" id="4971747">err</span>&nbsp;<span class="builtintype" id="4971751">error</span><span class="op" id="4971756">)</span>&nbsp;<span class="op" id="4971758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4971761">engine</span>&nbsp;<span class="op" id="4971768">=</span>&nbsp;<span class="builtinfunc" id="4971770">new</span><span class="op" id="4971773">(</span><span class="ident" id="4971774">decEngine</span><span class="op" id="4971783">)</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4971786">engine</span><span class="op" id="4971792">.</span><span class="ident" id="4971793">instr</span>&nbsp;<span class="op" id="4971799">=</span>&nbsp;<span class="builtinfunc" id="4971801">make</span><span class="op" id="4971805">(</span><span class="op" id="4971806">[</span><span class="op" id="4971807">]</span><span class="ident" id="4971808">decInstr</span><span class="op" id="4971816">,</span>&nbsp;<span class="num" id="4971818">1</span><span class="op" id="4971819">)</span>&nbsp;<span class="comment" id="4971821">//&nbsp;one&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4971834">op</span>&nbsp;<span class="op" id="4971837">:=</span>&nbsp;<span class="ident" id="4971840">dec</span><span class="op" id="4971843">.</span><span class="ident" id="4971844">decIgnoreOpFor</span><span class="op" id="4971858">(</span><span class="ident" id="4971859">remoteId</span><span class="op" id="4971867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4971870">ovfl</span>&nbsp;<span class="op" id="4971875">:=</span>&nbsp;<span class="ident" id="4971878">overflow</span><span class="op" id="4971886">(</span><span class="ident" id="4971887">dec</span><span class="op" id="4971890">.</span><span class="ident" id="4971891">typeString</span><span class="op" id="4971901">(</span><span class="ident" id="4971902">remoteId</span><span class="op" id="4971910">)</span><span class="op" id="4971911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4971914">engine</span><span class="op" id="4971920">.</span><span class="ident" id="4971921">instr</span><span class="op" id="4971926">[</span><span class="num" id="4971927">0</span><span class="op" id="4971928">]</span>&nbsp;<span class="op" id="4971930">=</span>&nbsp;<span class="ident" id="4971932">decInstr</span><span class="op" id="4971940">{</span><span class="ident" id="4971941">op</span><span class="op" id="4971943">,</span>&nbsp;<span class="num" id="4971945">0</span><span class="op" id="4971946">,</span>&nbsp;<span class="ident" id="4971948">nil</span><span class="op" id="4971951">,</span>&nbsp;<span class="ident" id="4971953">ovfl</span><span class="op" id="4971957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4971960">engine</span><span class="op" id="4971966">.</span><span class="ident" id="4971967">numInstr</span>&nbsp;<span class="op" id="4971976">=</span>&nbsp;<span class="num" id="4971978">1</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4971981">return</span><br>
<span class="lineno"></span><span class="op" id="4971988">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4971991">//&nbsp;compileDec&nbsp;compiles&nbsp;the&nbsp;decoder&nbsp;engine&nbsp;for&nbsp;a&nbsp;value.&nbsp;&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;not&nbsp;a&nbsp;struct,</span><br>
<span class="lineno"></span><span class="comment" id="4972077">//&nbsp;it&nbsp;calls&nbsp;out&nbsp;to&nbsp;compileSingle.</span><br>
<span class="lineno">1045</span><span class="keyword" id="4972111">func</span>&nbsp;<span class="op" id="4972116">(</span><span class="ident" id="4972117">dec</span>&nbsp;<span class="op" id="4972121">*</span><span class="ident" id="4972122">Decoder</span><span class="op" id="4972129">)</span>&nbsp;<span class="ident" id="4972131">compileDec</span><span class="op" id="4972141">(</span><span class="ident" id="4972142">remoteId</span>&nbsp;<span class="ident" id="4972151">typeId</span><span class="op" id="4972157">,</span>&nbsp;<span class="ident" id="4972159">ut</span>&nbsp;<span class="op" id="4972162">*</span><span class="ident" id="4972163">userTypeInfo</span><span class="op" id="4972175">)</span>&nbsp;<span class="op" id="4972177">(</span><span class="ident" id="4972178">engine</span>&nbsp;<span class="op" id="4972185">*</span><span class="ident" id="4972186">decEngine</span><span class="op" id="4972195">,</span>&nbsp;<span class="ident" id="4972197">err</span>&nbsp;<span class="builtintype" id="4972201">error</span><span class="op" id="4972206">)</span>&nbsp;<span class="op" id="4972208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972211">rt</span>&nbsp;<span class="op" id="4972214">:=</span>&nbsp;<span class="ident" id="4972217">ut</span><span class="op" id="4972219">.</span><span class="ident" id="4972220">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972226">srt</span>&nbsp;<span class="op" id="4972230">:=</span>&nbsp;<span class="ident" id="4972233">rt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4972237">if</span>&nbsp;<span class="ident" id="4972240">srt</span><span class="op" id="4972243">.</span><span class="ident" id="4972244">Kind</span><span class="op" id="4972248">(</span><span class="op" id="4972249">)</span>&nbsp;<span class="op" id="4972251">!=</span>&nbsp;<span class="ident" id="4972254">reflect</span><span class="op" id="4972261">.</span><span class="ident" id="4972262">Struct</span>&nbsp;<span class="op" id="4972269">||</span>&nbsp;<span class="ident" id="4972272">ut</span><span class="op" id="4972274">.</span><span class="ident" id="4972275">externalDec</span>&nbsp;<span class="op" id="4972287">!=</span>&nbsp;<span class="num" id="4972290">0</span>&nbsp;<span class="op" id="4972292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4972296">return</span>&nbsp;<span class="ident" id="4972303">dec</span><span class="op" id="4972306">.</span><span class="ident" id="4972307">compileSingle</span><span class="op" id="4972320">(</span><span class="ident" id="4972321">remoteId</span><span class="op" id="4972329">,</span>&nbsp;<span class="ident" id="4972331">ut</span><span class="op" id="4972333">)</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4972336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4972339">var</span>&nbsp;<span class="ident" id="4972343">wireStruct</span>&nbsp;<span class="op" id="4972354">*</span><span class="ident" id="4972355">structType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4972367">//&nbsp;Builtin&nbsp;types&nbsp;can&nbsp;come&nbsp;from&nbsp;global&nbsp;pool;&nbsp;the&nbsp;rest&nbsp;must&nbsp;be&nbsp;defined&nbsp;by&nbsp;the&nbsp;decoder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4972453">//&nbsp;Also&nbsp;we&nbsp;know&nbsp;we&#39;re&nbsp;decoding&nbsp;a&nbsp;struct&nbsp;now,&nbsp;so&nbsp;the&nbsp;client&nbsp;must&nbsp;have&nbsp;sent&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4972533">if</span>&nbsp;<span class="ident" id="4972536">t</span><span class="op" id="4972537">,</span>&nbsp;<span class="ident" id="4972539">ok</span>&nbsp;<span class="op" id="4972542">:=</span>&nbsp;<span class="ident" id="4972545">builtinIdToType</span><span class="op" id="4972560">[</span><span class="ident" id="4972561">remoteId</span><span class="op" id="4972569">]</span><span class="op" id="4972570">;</span>&nbsp;<span class="ident" id="4972572">ok</span>&nbsp;<span class="op" id="4972575">{</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972579">wireStruct</span><span class="op" id="4972589">,</span>&nbsp;<span class="ident" id="4972591">_</span>&nbsp;<span class="op" id="4972593">=</span>&nbsp;<span class="ident" id="4972595">t</span><span class="op" id="4972596">.</span><span class="op" id="4972597">(</span><span class="op" id="4972598">*</span><span class="ident" id="4972599">structType</span><span class="op" id="4972609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4972612">}</span>&nbsp;<span class="keyword" id="4972614">else</span>&nbsp;<span class="op" id="4972619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972623">wire</span>&nbsp;<span class="op" id="4972628">:=</span>&nbsp;<span class="ident" id="4972631">dec</span><span class="op" id="4972634">.</span><span class="ident" id="4972635">wireType</span><span class="op" id="4972643">[</span><span class="ident" id="4972644">remoteId</span><span class="op" id="4972652">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4972656">if</span>&nbsp;<span class="ident" id="4972659">wire</span>&nbsp;<span class="op" id="4972664">==</span>&nbsp;<span class="ident" id="4972667">nil</span>&nbsp;<span class="op" id="4972671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972676">error_</span><span class="op" id="4972682">(</span><span class="ident" id="4972683">errBadType</span><span class="op" id="4972693">)</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4972697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972701">wireStruct</span>&nbsp;<span class="op" id="4972712">=</span>&nbsp;<span class="ident" id="4972714">wire</span><span class="op" id="4972718">.</span><span class="ident" id="4972719">StructT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4972728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4972731">if</span>&nbsp;<span class="ident" id="4972734">wireStruct</span>&nbsp;<span class="op" id="4972745">==</span>&nbsp;<span class="ident" id="4972748">nil</span>&nbsp;<span class="op" id="4972752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972756">errorf</span><span class="op" id="4972762">(</span><span class="string" id="4972763">&#34;type&nbsp;mismatch&nbsp;in&nbsp;decoder:&nbsp;want&nbsp;struct&nbsp;type&nbsp;%s;&nbsp;got&nbsp;non-struct&#34;</span><span class="op" id="4972826">,</span>&nbsp;<span class="ident" id="4972828">rt</span><span class="op" id="4972830">)</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4972833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972836">engine</span>&nbsp;<span class="op" id="4972843">=</span>&nbsp;<span class="builtinfunc" id="4972845">new</span><span class="op" id="4972848">(</span><span class="ident" id="4972849">decEngine</span><span class="op" id="4972858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972861">engine</span><span class="op" id="4972867">.</span><span class="ident" id="4972868">instr</span>&nbsp;<span class="op" id="4972874">=</span>&nbsp;<span class="builtinfunc" id="4972876">make</span><span class="op" id="4972880">(</span><span class="op" id="4972881">[</span><span class="op" id="4972882">]</span><span class="ident" id="4972883">decInstr</span><span class="op" id="4972891">,</span>&nbsp;<span class="builtinfunc" id="4972893">len</span><span class="op" id="4972896">(</span><span class="ident" id="4972897">wireStruct</span><span class="op" id="4972907">.</span><span class="ident" id="4972908">Field</span><span class="op" id="4972913">)</span><span class="op" id="4972914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972917">seen</span>&nbsp;<span class="op" id="4972922">:=</span>&nbsp;<span class="builtinfunc" id="4972925">make</span><span class="op" id="4972929">(</span><span class="keyword" id="4972930">map</span><span class="op" id="4972933">[</span><span class="ident" id="4972934">reflect</span><span class="op" id="4972941">.</span><span class="ident" id="4972942">Type</span><span class="op" id="4972946">]</span><span class="op" id="4972947">*</span><span class="ident" id="4972948">decOp</span><span class="op" id="4972953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4972956">//&nbsp;Loop&nbsp;over&nbsp;the&nbsp;fields&nbsp;of&nbsp;the&nbsp;wire&nbsp;type.</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4972999">for</span>&nbsp;<span class="ident" id="4973003">fieldnum</span>&nbsp;<span class="op" id="4973012">:=</span>&nbsp;<span class="num" id="4973015">0</span><span class="op" id="4973016">;</span>&nbsp;<span class="ident" id="4973018">fieldnum</span>&nbsp;<span class="op" id="4973027">&lt;</span>&nbsp;<span class="builtinfunc" id="4973029">len</span><span class="op" id="4973032">(</span><span class="ident" id="4973033">wireStruct</span><span class="op" id="4973043">.</span><span class="ident" id="4973044">Field</span><span class="op" id="4973049">)</span><span class="op" id="4973050">;</span>&nbsp;<span class="ident" id="4973052">fieldnum</span><span class="op" id="4973060">++</span>&nbsp;<span class="op" id="4973063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4973067">wireField</span>&nbsp;<span class="op" id="4973077">:=</span>&nbsp;<span class="ident" id="4973080">wireStruct</span><span class="op" id="4973090">.</span><span class="ident" id="4973091">Field</span><span class="op" id="4973096">[</span><span class="ident" id="4973097">fieldnum</span><span class="op" id="4973105">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4973109">if</span>&nbsp;<span class="ident" id="4973112">wireField</span><span class="op" id="4973121">.</span><span class="ident" id="4973122">Name</span>&nbsp;<span class="op" id="4973127">==</span>&nbsp;<span class="string" id="4973130">&#34;&#34;</span>&nbsp;<span class="op" id="4973133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4973138">errorf</span><span class="op" id="4973144">(</span><span class="string" id="4973145">&#34;empty&nbsp;name&nbsp;for&nbsp;remote&nbsp;field&nbsp;of&nbsp;type&nbsp;%s&#34;</span><span class="op" id="4973185">,</span>&nbsp;<span class="ident" id="4973187">wireStruct</span><span class="op" id="4973197">.</span><span class="ident" id="4973198">Name</span><span class="op" id="4973202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4973206">}</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4973210">ovfl</span>&nbsp;<span class="op" id="4973215">:=</span>&nbsp;<span class="ident" id="4973218">overflow</span><span class="op" id="4973226">(</span><span class="ident" id="4973227">wireField</span><span class="op" id="4973236">.</span><span class="ident" id="4973237">Name</span><span class="op" id="4973241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4973245">//&nbsp;Find&nbsp;the&nbsp;field&nbsp;of&nbsp;the&nbsp;local&nbsp;type&nbsp;with&nbsp;the&nbsp;same&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4973303">localField</span><span class="op" id="4973313">,</span>&nbsp;<span class="ident" id="4973315">present</span>&nbsp;<span class="op" id="4973323">:=</span>&nbsp;<span class="ident" id="4973326">srt</span><span class="op" id="4973329">.</span><span class="ident" id="4973330">FieldByName</span><span class="op" id="4973341">(</span><span class="ident" id="4973342">wireField</span><span class="op" id="4973351">.</span><span class="ident" id="4973352">Name</span><span class="op" id="4973356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4973360">//&nbsp;TODO(r):&nbsp;anonymous&nbsp;names</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4973390">if</span>&nbsp;<span class="op" id="4973393">!</span><span class="ident" id="4973394">present</span>&nbsp;<span class="op" id="4973402">||</span>&nbsp;<span class="op" id="4973405">!</span><span class="ident" id="4973406">isExported</span><span class="op" id="4973416">(</span><span class="ident" id="4973417">wireField</span><span class="op" id="4973426">.</span><span class="ident" id="4973427">Name</span><span class="op" id="4973431">)</span>&nbsp;<span class="op" id="4973433">{</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4973438">op</span>&nbsp;<span class="op" id="4973441">:=</span>&nbsp;<span class="ident" id="4973444">dec</span><span class="op" id="4973447">.</span><span class="ident" id="4973448">decIgnoreOpFor</span><span class="op" id="4973462">(</span><span class="ident" id="4973463">wireField</span><span class="op" id="4973472">.</span><span class="ident" id="4973473">Id</span><span class="op" id="4973475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4973480">engine</span><span class="op" id="4973486">.</span><span class="ident" id="4973487">instr</span><span class="op" id="4973492">[</span><span class="ident" id="4973493">fieldnum</span><span class="op" id="4973501">]</span>&nbsp;<span class="op" id="4973503">=</span>&nbsp;<span class="ident" id="4973505">decInstr</span><span class="op" id="4973513">{</span><span class="ident" id="4973514">op</span><span class="op" id="4973516">,</span>&nbsp;<span class="ident" id="4973518">fieldnum</span><span class="op" id="4973526">,</span>&nbsp;<span class="ident" id="4973528">nil</span><span class="op" id="4973531">,</span>&nbsp;<span class="ident" id="4973533">ovfl</span><span class="op" id="4973537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4973542">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4973553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4973557">if</span>&nbsp;<span class="op" id="4973560">!</span><span class="ident" id="4973561">dec</span><span class="op" id="4973564">.</span><span class="ident" id="4973565">compatibleType</span><span class="op" id="4973579">(</span><span class="ident" id="4973580">localField</span><span class="op" id="4973590">.</span><span class="ident" id="4973591">Type</span><span class="op" id="4973595">,</span>&nbsp;<span class="ident" id="4973597">wireField</span><span class="op" id="4973606">.</span><span class="ident" id="4973607">Id</span><span class="op" id="4973609">,</span>&nbsp;<span class="builtinfunc" id="4973611">make</span><span class="op" id="4973615">(</span><span class="keyword" id="4973616">map</span><span class="op" id="4973619">[</span><span class="ident" id="4973620">reflect</span><span class="op" id="4973627">.</span><span class="ident" id="4973628">Type</span><span class="op" id="4973632">]</span><span class="ident" id="4973633">typeId</span><span class="op" id="4973639">)</span><span class="op" id="4973640">)</span>&nbsp;<span class="op" id="4973642">{</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4973647">errorf</span><span class="op" id="4973653">(</span><span class="string" id="4973654">&#34;wrong&nbsp;type&nbsp;(%s)&nbsp;for&nbsp;received&nbsp;field&nbsp;%s.%s&#34;</span><span class="op" id="4973696">,</span>&nbsp;<span class="ident" id="4973698">localField</span><span class="op" id="4973708">.</span><span class="ident" id="4973709">Type</span><span class="op" id="4973713">,</span>&nbsp;<span class="ident" id="4973715">wireStruct</span><span class="op" id="4973725">.</span><span class="ident" id="4973726">Name</span><span class="op" id="4973730">,</span>&nbsp;<span class="ident" id="4973732">wireField</span><span class="op" id="4973741">.</span><span class="ident" id="4973742">Name</span><span class="op" id="4973746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4973750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4973754">op</span>&nbsp;<span class="op" id="4973757">:=</span>&nbsp;<span class="ident" id="4973760">dec</span><span class="op" id="4973763">.</span><span class="ident" id="4973764">decOpFor</span><span class="op" id="4973772">(</span><span class="ident" id="4973773">wireField</span><span class="op" id="4973782">.</span><span class="ident" id="4973783">Id</span><span class="op" id="4973785">,</span>&nbsp;<span class="ident" id="4973787">localField</span><span class="op" id="4973797">.</span><span class="ident" id="4973798">Type</span><span class="op" id="4973802">,</span>&nbsp;<span class="ident" id="4973804">localField</span><span class="op" id="4973814">.</span><span class="ident" id="4973815">Name</span><span class="op" id="4973819">,</span>&nbsp;<span class="ident" id="4973821">seen</span><span class="op" id="4973825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4973829">engine</span><span class="op" id="4973835">.</span><span class="ident" id="4973836">instr</span><span class="op" id="4973841">[</span><span class="ident" id="4973842">fieldnum</span><span class="op" id="4973850">]</span>&nbsp;<span class="op" id="4973852">=</span>&nbsp;<span class="ident" id="4973854">decInstr</span><span class="op" id="4973862">{</span><span class="op" id="4973863">*</span><span class="ident" id="4973864">op</span><span class="op" id="4973866">,</span>&nbsp;<span class="ident" id="4973868">fieldnum</span><span class="op" id="4973876">,</span>&nbsp;<span class="ident" id="4973878">localField</span><span class="op" id="4973888">.</span><span class="ident" id="4973889">Index</span><span class="op" id="4973894">,</span>&nbsp;<span class="ident" id="4973896">ovfl</span><span class="op" id="4973900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4973904">engine</span><span class="op" id="4973910">.</span><span class="ident" id="4973911">numInstr</span><span class="op" id="4973919">++</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4973923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4973926">return</span><br>
<span class="lineno"></span><span class="op" id="4973933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4973936">//&nbsp;getDecEnginePtr&nbsp;returns&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;specified&nbsp;type.</span><br>
<span class="lineno">1095</span><span class="keyword" id="4973998">func</span>&nbsp;<span class="op" id="4974003">(</span><span class="ident" id="4974004">dec</span>&nbsp;<span class="op" id="4974008">*</span><span class="ident" id="4974009">Decoder</span><span class="op" id="4974016">)</span>&nbsp;<span class="ident" id="4974018">getDecEnginePtr</span><span class="op" id="4974033">(</span><span class="ident" id="4974034">remoteId</span>&nbsp;<span class="ident" id="4974043">typeId</span><span class="op" id="4974049">,</span>&nbsp;<span class="ident" id="4974051">ut</span>&nbsp;<span class="op" id="4974054">*</span><span class="ident" id="4974055">userTypeInfo</span><span class="op" id="4974067">)</span>&nbsp;<span class="op" id="4974069">(</span><span class="ident" id="4974070">enginePtr</span>&nbsp;<span class="op" id="4974080">*</span><span class="op" id="4974081">*</span><span class="ident" id="4974082">decEngine</span><span class="op" id="4974091">,</span>&nbsp;<span class="ident" id="4974093">err</span>&nbsp;<span class="builtintype" id="4974097">error</span><span class="op" id="4974102">)</span>&nbsp;<span class="op" id="4974104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4974107">rt</span>&nbsp;<span class="op" id="4974110">:=</span>&nbsp;<span class="ident" id="4974113">ut</span><span class="op" id="4974115">.</span><span class="ident" id="4974116">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4974122">decoderMap</span><span class="op" id="4974132">,</span>&nbsp;<span class="ident" id="4974134">ok</span>&nbsp;<span class="op" id="4974137">:=</span>&nbsp;<span class="ident" id="4974140">dec</span><span class="op" id="4974143">.</span><span class="ident" id="4974144">decoderCache</span><span class="op" id="4974156">[</span><span class="ident" id="4974157">rt</span><span class="op" id="4974159">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4974162">if</span>&nbsp;<span class="op" id="4974165">!</span><span class="ident" id="4974166">ok</span>&nbsp;<span class="op" id="4974169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4974173">decoderMap</span>&nbsp;<span class="op" id="4974184">=</span>&nbsp;<span class="builtinfunc" id="4974186">make</span><span class="op" id="4974190">(</span><span class="keyword" id="4974191">map</span><span class="op" id="4974194">[</span><span class="ident" id="4974195">typeId</span><span class="op" id="4974201">]</span><span class="op" id="4974202">*</span><span class="op" id="4974203">*</span><span class="ident" id="4974204">decEngine</span><span class="op" id="4974213">)</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4974217">dec</span><span class="op" id="4974220">.</span><span class="ident" id="4974221">decoderCache</span><span class="op" id="4974233">[</span><span class="ident" id="4974234">rt</span><span class="op" id="4974236">]</span>&nbsp;<span class="op" id="4974238">=</span>&nbsp;<span class="ident" id="4974240">decoderMap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4974252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4974255">if</span>&nbsp;<span class="ident" id="4974258">enginePtr</span><span class="op" id="4974267">,</span>&nbsp;<span class="ident" id="4974269">ok</span>&nbsp;<span class="op" id="4974272">=</span>&nbsp;<span class="ident" id="4974274">decoderMap</span><span class="op" id="4974284">[</span><span class="ident" id="4974285">remoteId</span><span class="op" id="4974293">]</span><span class="op" id="4974294">;</span>&nbsp;<span class="op" id="4974296">!</span><span class="ident" id="4974297">ok</span>&nbsp;<span class="op" id="4974300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4974304">//&nbsp;To&nbsp;handle&nbsp;recursive&nbsp;types,&nbsp;mark&nbsp;this&nbsp;engine&nbsp;as&nbsp;underway&nbsp;before&nbsp;compiling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4974383">enginePtr</span>&nbsp;<span class="op" id="4974393">=</span>&nbsp;<span class="builtinfunc" id="4974395">new</span><span class="op" id="4974398">(</span><span class="op" id="4974399">*</span><span class="ident" id="4974400">decEngine</span><span class="op" id="4974409">)</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4974413">decoderMap</span><span class="op" id="4974423">[</span><span class="ident" id="4974424">remoteId</span><span class="op" id="4974432">]</span>&nbsp;<span class="op" id="4974434">=</span>&nbsp;<span class="ident" id="4974436">enginePtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4974448">*</span><span class="ident" id="4974449">enginePtr</span><span class="op" id="4974458">,</span>&nbsp;<span class="ident" id="4974460">err</span>&nbsp;<span class="op" id="4974464">=</span>&nbsp;<span class="ident" id="4974466">dec</span><span class="op" id="4974469">.</span><span class="ident" id="4974470">compileDec</span><span class="op" id="4974480">(</span><span class="ident" id="4974481">remoteId</span><span class="op" id="4974489">,</span>&nbsp;<span class="ident" id="4974491">ut</span><span class="op" id="4974493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4974497">if</span>&nbsp;<span class="ident" id="4974500">err</span>&nbsp;<span class="op" id="4974504">!=</span>&nbsp;<span class="ident" id="4974507">nil</span>&nbsp;<span class="op" id="4974511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4974516">delete</span><span class="op" id="4974522">(</span><span class="ident" id="4974523">decoderMap</span><span class="op" id="4974533">,</span>&nbsp;<span class="ident" id="4974535">remoteId</span><span class="op" id="4974543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4974547">}</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4974550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4974553">return</span><br>
<span class="lineno"></span><span class="op" id="4974560">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4974563">//&nbsp;emptyStruct&nbsp;is&nbsp;the&nbsp;type&nbsp;we&nbsp;compile&nbsp;into&nbsp;when&nbsp;ignoring&nbsp;a&nbsp;struct&nbsp;value.</span><br>
<span class="lineno">1115</span><span class="keyword" id="4974636">type</span>&nbsp;<span class="ident" id="4974641">emptyStruct</span>&nbsp;<span class="keyword" id="4974653">struct</span><span class="op" id="4974659">{</span><span class="op" id="4974660">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4974663">var</span>&nbsp;<span class="ident" id="4974667">emptyStructType</span>&nbsp;<span class="op" id="4974683">=</span>&nbsp;<span class="ident" id="4974685">reflect</span><span class="op" id="4974692">.</span><span class="ident" id="4974693">TypeOf</span><span class="op" id="4974699">(</span><span class="ident" id="4974700">emptyStruct</span><span class="op" id="4974711">{</span><span class="op" id="4974712">}</span><span class="op" id="4974713">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4974716">//&nbsp;getDecEnginePtr&nbsp;returns&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;specified&nbsp;type&nbsp;when&nbsp;the&nbsp;value&nbsp;is&nbsp;to&nbsp;be&nbsp;discarded.</span><br>
<span class="lineno">1120</span><span class="keyword" id="4974812">func</span>&nbsp;<span class="op" id="4974817">(</span><span class="ident" id="4974818">dec</span>&nbsp;<span class="op" id="4974822">*</span><span class="ident" id="4974823">Decoder</span><span class="op" id="4974830">)</span>&nbsp;<span class="ident" id="4974832">getIgnoreEnginePtr</span><span class="op" id="4974850">(</span><span class="ident" id="4974851">wireId</span>&nbsp;<span class="ident" id="4974858">typeId</span><span class="op" id="4974864">)</span>&nbsp;<span class="op" id="4974866">(</span><span class="ident" id="4974867">enginePtr</span>&nbsp;<span class="op" id="4974877">*</span><span class="op" id="4974878">*</span><span class="ident" id="4974879">decEngine</span><span class="op" id="4974888">,</span>&nbsp;<span class="ident" id="4974890">err</span>&nbsp;<span class="builtintype" id="4974894">error</span><span class="op" id="4974899">)</span>&nbsp;<span class="op" id="4974901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4974904">var</span>&nbsp;<span class="ident" id="4974908">ok</span>&nbsp;<span class="builtintype" id="4974911">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4974917">if</span>&nbsp;<span class="ident" id="4974920">enginePtr</span><span class="op" id="4974929">,</span>&nbsp;<span class="ident" id="4974931">ok</span>&nbsp;<span class="op" id="4974934">=</span>&nbsp;<span class="ident" id="4974936">dec</span><span class="op" id="4974939">.</span><span class="ident" id="4974940">ignorerCache</span><span class="op" id="4974952">[</span><span class="ident" id="4974953">wireId</span><span class="op" id="4974959">]</span><span class="op" id="4974960">;</span>&nbsp;<span class="op" id="4974962">!</span><span class="ident" id="4974963">ok</span>&nbsp;<span class="op" id="4974966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4974970">//&nbsp;To&nbsp;handle&nbsp;recursive&nbsp;types,&nbsp;mark&nbsp;this&nbsp;engine&nbsp;as&nbsp;underway&nbsp;before&nbsp;compiling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4975049">enginePtr</span>&nbsp;<span class="op" id="4975059">=</span>&nbsp;<span class="builtinfunc" id="4975061">new</span><span class="op" id="4975064">(</span><span class="op" id="4975065">*</span><span class="ident" id="4975066">decEngine</span><span class="op" id="4975075">)</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4975079">dec</span><span class="op" id="4975082">.</span><span class="ident" id="4975083">ignorerCache</span><span class="op" id="4975095">[</span><span class="ident" id="4975096">wireId</span><span class="op" id="4975102">]</span>&nbsp;<span class="op" id="4975104">=</span>&nbsp;<span class="ident" id="4975106">enginePtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4975118">wire</span>&nbsp;<span class="op" id="4975123">:=</span>&nbsp;<span class="ident" id="4975126">dec</span><span class="op" id="4975129">.</span><span class="ident" id="4975130">wireType</span><span class="op" id="4975138">[</span><span class="ident" id="4975139">wireId</span><span class="op" id="4975145">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975149">if</span>&nbsp;<span class="ident" id="4975152">wire</span>&nbsp;<span class="op" id="4975157">!=</span>&nbsp;<span class="ident" id="4975160">nil</span>&nbsp;<span class="op" id="4975164">&amp;&amp;</span>&nbsp;<span class="ident" id="4975167">wire</span><span class="op" id="4975171">.</span><span class="ident" id="4975172">StructT</span>&nbsp;<span class="op" id="4975180">!=</span>&nbsp;<span class="ident" id="4975183">nil</span>&nbsp;<span class="op" id="4975187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4975192">*</span><span class="ident" id="4975193">enginePtr</span><span class="op" id="4975202">,</span>&nbsp;<span class="ident" id="4975204">err</span>&nbsp;<span class="op" id="4975208">=</span>&nbsp;<span class="ident" id="4975210">dec</span><span class="op" id="4975213">.</span><span class="ident" id="4975214">compileDec</span><span class="op" id="4975224">(</span><span class="ident" id="4975225">wireId</span><span class="op" id="4975231">,</span>&nbsp;<span class="ident" id="4975233">userType</span><span class="op" id="4975241">(</span><span class="ident" id="4975242">emptyStructType</span><span class="op" id="4975257">)</span><span class="op" id="4975258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4975262">}</span>&nbsp;<span class="keyword" id="4975264">else</span>&nbsp;<span class="op" id="4975269">{</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4975274">*</span><span class="ident" id="4975275">enginePtr</span><span class="op" id="4975284">,</span>&nbsp;<span class="ident" id="4975286">err</span>&nbsp;<span class="op" id="4975290">=</span>&nbsp;<span class="ident" id="4975292">dec</span><span class="op" id="4975295">.</span><span class="ident" id="4975296">compileIgnoreSingle</span><span class="op" id="4975315">(</span><span class="ident" id="4975316">wireId</span><span class="op" id="4975322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4975326">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975330">if</span>&nbsp;<span class="ident" id="4975333">err</span>&nbsp;<span class="op" id="4975337">!=</span>&nbsp;<span class="ident" id="4975340">nil</span>&nbsp;<span class="op" id="4975344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4975349">delete</span><span class="op" id="4975355">(</span><span class="ident" id="4975356">dec</span><span class="op" id="4975359">.</span><span class="ident" id="4975360">ignorerCache</span><span class="op" id="4975372">,</span>&nbsp;<span class="ident" id="4975374">wireId</span><span class="op" id="4975380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4975384">}</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4975387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975390">return</span><br>
<span class="lineno"></span><span class="op" id="4975397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4975400">//&nbsp;decodeValue&nbsp;decodes&nbsp;the&nbsp;data&nbsp;stream&nbsp;representing&nbsp;a&nbsp;value&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno">1140</span><span class="keyword" id="4975484">func</span>&nbsp;<span class="op" id="4975489">(</span><span class="ident" id="4975490">dec</span>&nbsp;<span class="op" id="4975494">*</span><span class="ident" id="4975495">Decoder</span><span class="op" id="4975502">)</span>&nbsp;<span class="ident" id="4975504">decodeValue</span><span class="op" id="4975515">(</span><span class="ident" id="4975516">wireId</span>&nbsp;<span class="ident" id="4975523">typeId</span><span class="op" id="4975529">,</span>&nbsp;<span class="ident" id="4975531">value</span>&nbsp;<span class="ident" id="4975537">reflect</span><span class="op" id="4975544">.</span><span class="ident" id="4975545">Value</span><span class="op" id="4975550">)</span>&nbsp;<span class="op" id="4975552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975555">defer</span>&nbsp;<span class="ident" id="4975561">catchError</span><span class="op" id="4975571">(</span><span class="op" id="4975572">&amp;</span><span class="ident" id="4975573">dec</span><span class="op" id="4975576">.</span><span class="ident" id="4975577">err</span><span class="op" id="4975580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4975583">//&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;nil,&nbsp;it&nbsp;means&nbsp;we&nbsp;should&nbsp;just&nbsp;ignore&nbsp;this&nbsp;item.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975650">if</span>&nbsp;<span class="op" id="4975653">!</span><span class="ident" id="4975654">value</span><span class="op" id="4975659">.</span><span class="ident" id="4975660">IsValid</span><span class="op" id="4975667">(</span><span class="op" id="4975668">)</span>&nbsp;<span class="op" id="4975670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4975674">dec</span><span class="op" id="4975677">.</span><span class="ident" id="4975678">decodeIgnoredValue</span><span class="op" id="4975696">(</span><span class="ident" id="4975697">wireId</span><span class="op" id="4975703">)</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975707">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4975715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4975718">//&nbsp;Dereference&nbsp;down&nbsp;to&nbsp;the&nbsp;underlying&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4975763">ut</span>&nbsp;<span class="op" id="4975766">:=</span>&nbsp;<span class="ident" id="4975769">userType</span><span class="op" id="4975777">(</span><span class="ident" id="4975778">value</span><span class="op" id="4975783">.</span><span class="ident" id="4975784">Type</span><span class="op" id="4975788">(</span><span class="op" id="4975789">)</span><span class="op" id="4975790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4975793">base</span>&nbsp;<span class="op" id="4975798">:=</span>&nbsp;<span class="ident" id="4975801">ut</span><span class="op" id="4975803">.</span><span class="ident" id="4975804">base</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975810">var</span>&nbsp;<span class="ident" id="4975814">enginePtr</span>&nbsp;<span class="op" id="4975824">*</span><span class="op" id="4975825">*</span><span class="ident" id="4975826">decEngine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4975837">enginePtr</span><span class="op" id="4975846">,</span>&nbsp;<span class="ident" id="4975848">dec</span><span class="op" id="4975851">.</span><span class="ident" id="4975852">err</span>&nbsp;<span class="op" id="4975856">=</span>&nbsp;<span class="ident" id="4975858">dec</span><span class="op" id="4975861">.</span><span class="ident" id="4975862">getDecEnginePtr</span><span class="op" id="4975877">(</span><span class="ident" id="4975878">wireId</span><span class="op" id="4975884">,</span>&nbsp;<span class="ident" id="4975886">ut</span><span class="op" id="4975888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975891">if</span>&nbsp;<span class="ident" id="4975894">dec</span><span class="op" id="4975897">.</span><span class="ident" id="4975898">err</span>&nbsp;<span class="op" id="4975902">!=</span>&nbsp;<span class="ident" id="4975905">nil</span>&nbsp;<span class="op" id="4975909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975913">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4975921">}</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4975924">value</span>&nbsp;<span class="op" id="4975930">=</span>&nbsp;<span class="ident" id="4975932">decAlloc</span><span class="op" id="4975940">(</span><span class="ident" id="4975941">value</span><span class="op" id="4975946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4975949">engine</span>&nbsp;<span class="op" id="4975956">:=</span>&nbsp;<span class="op" id="4975959">*</span><span class="ident" id="4975960">enginePtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975971">if</span>&nbsp;<span class="ident" id="4975974">st</span>&nbsp;<span class="op" id="4975977">:=</span>&nbsp;<span class="ident" id="4975980">base</span><span class="op" id="4975984">;</span>&nbsp;<span class="ident" id="4975986">st</span><span class="op" id="4975988">.</span><span class="ident" id="4975989">Kind</span><span class="op" id="4975993">(</span><span class="op" id="4975994">)</span>&nbsp;<span class="op" id="4975996">==</span>&nbsp;<span class="ident" id="4975999">reflect</span><span class="op" id="4976006">.</span><span class="ident" id="4976007">Struct</span>&nbsp;<span class="op" id="4976014">&amp;&amp;</span>&nbsp;<span class="ident" id="4976017">ut</span><span class="op" id="4976019">.</span><span class="ident" id="4976020">externalDec</span>&nbsp;<span class="op" id="4976032">==</span>&nbsp;<span class="num" id="4976035">0</span>&nbsp;<span class="op" id="4976037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976041">if</span>&nbsp;<span class="ident" id="4976044">engine</span><span class="op" id="4976050">.</span><span class="ident" id="4976051">numInstr</span>&nbsp;<span class="op" id="4976060">==</span>&nbsp;<span class="num" id="4976063">0</span>&nbsp;<span class="op" id="4976065">&amp;&amp;</span>&nbsp;<span class="ident" id="4976068">st</span><span class="op" id="4976070">.</span><span class="ident" id="4976071">NumField</span><span class="op" id="4976079">(</span><span class="op" id="4976080">)</span>&nbsp;<span class="op" id="4976082">&gt;</span>&nbsp;<span class="num" id="4976084">0</span>&nbsp;<span class="op" id="4976086">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976092">dec</span><span class="op" id="4976095">.</span><span class="ident" id="4976096">wireType</span><span class="op" id="4976104">[</span><span class="ident" id="4976105">wireId</span><span class="op" id="4976111">]</span>&nbsp;<span class="op" id="4976113">!=</span>&nbsp;<span class="ident" id="4976116">nil</span>&nbsp;<span class="op" id="4976120">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4976123">len</span><span class="op" id="4976126">(</span><span class="ident" id="4976127">dec</span><span class="op" id="4976130">.</span><span class="ident" id="4976131">wireType</span><span class="op" id="4976139">[</span><span class="ident" id="4976140">wireId</span><span class="op" id="4976146">]</span><span class="op" id="4976147">.</span><span class="ident" id="4976148">StructT</span><span class="op" id="4976155">.</span><span class="ident" id="4976156">Field</span><span class="op" id="4976161">)</span>&nbsp;<span class="op" id="4976163">&gt;</span>&nbsp;<span class="num" id="4976165">0</span>&nbsp;<span class="op" id="4976167">{</span><br>
<span class="lineno">1160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976172">name</span>&nbsp;<span class="op" id="4976177">:=</span>&nbsp;<span class="ident" id="4976180">base</span><span class="op" id="4976184">.</span><span class="ident" id="4976185">Name</span><span class="op" id="4976189">(</span><span class="op" id="4976190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976195">errorf</span><span class="op" id="4976201">(</span><span class="string" id="4976202">&#34;type&nbsp;mismatch:&nbsp;no&nbsp;fields&nbsp;matched&nbsp;compiling&nbsp;decoder&nbsp;for&nbsp;%s&#34;</span><span class="op" id="4976261">,</span>&nbsp;<span class="ident" id="4976263">name</span><span class="op" id="4976267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4976271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976275">dec</span><span class="op" id="4976278">.</span><span class="ident" id="4976279">decodeStruct</span><span class="op" id="4976291">(</span><span class="ident" id="4976292">engine</span><span class="op" id="4976298">,</span>&nbsp;<span class="ident" id="4976300">ut</span><span class="op" id="4976302">,</span>&nbsp;<span class="ident" id="4976304">value</span><span class="op" id="4976309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4976312">}</span>&nbsp;<span class="keyword" id="4976314">else</span>&nbsp;<span class="op" id="4976319">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976323">dec</span><span class="op" id="4976326">.</span><span class="ident" id="4976327">decodeSingle</span><span class="op" id="4976339">(</span><span class="ident" id="4976340">engine</span><span class="op" id="4976346">,</span>&nbsp;<span class="ident" id="4976348">ut</span><span class="op" id="4976350">,</span>&nbsp;<span class="ident" id="4976352">value</span><span class="op" id="4976357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4976360">}</span><br>
<span class="lineno"></span><span class="op" id="4976362">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4976365">//&nbsp;decodeIgnoredValue&nbsp;decodes&nbsp;the&nbsp;data&nbsp;stream&nbsp;representing&nbsp;a&nbsp;value&nbsp;of&nbsp;the&nbsp;specified&nbsp;type&nbsp;and&nbsp;discards&nbsp;it.</span><br>
<span class="lineno">1170</span><span class="keyword" id="4976471">func</span>&nbsp;<span class="op" id="4976476">(</span><span class="ident" id="4976477">dec</span>&nbsp;<span class="op" id="4976481">*</span><span class="ident" id="4976482">Decoder</span><span class="op" id="4976489">)</span>&nbsp;<span class="ident" id="4976491">decodeIgnoredValue</span><span class="op" id="4976509">(</span><span class="ident" id="4976510">wireId</span>&nbsp;<span class="ident" id="4976517">typeId</span><span class="op" id="4976523">)</span>&nbsp;<span class="op" id="4976525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976528">var</span>&nbsp;<span class="ident" id="4976532">enginePtr</span>&nbsp;<span class="op" id="4976542">*</span><span class="op" id="4976543">*</span><span class="ident" id="4976544">decEngine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976555">enginePtr</span><span class="op" id="4976564">,</span>&nbsp;<span class="ident" id="4976566">dec</span><span class="op" id="4976569">.</span><span class="ident" id="4976570">err</span>&nbsp;<span class="op" id="4976574">=</span>&nbsp;<span class="ident" id="4976576">dec</span><span class="op" id="4976579">.</span><span class="ident" id="4976580">getIgnoreEnginePtr</span><span class="op" id="4976598">(</span><span class="ident" id="4976599">wireId</span><span class="op" id="4976605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976608">if</span>&nbsp;<span class="ident" id="4976611">dec</span><span class="op" id="4976614">.</span><span class="ident" id="4976615">err</span>&nbsp;<span class="op" id="4976619">!=</span>&nbsp;<span class="ident" id="4976622">nil</span>&nbsp;<span class="op" id="4976626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976630">return</span><br>
<span class="lineno">1175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4976638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976641">wire</span>&nbsp;<span class="op" id="4976646">:=</span>&nbsp;<span class="ident" id="4976649">dec</span><span class="op" id="4976652">.</span><span class="ident" id="4976653">wireType</span><span class="op" id="4976661">[</span><span class="ident" id="4976662">wireId</span><span class="op" id="4976668">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976671">if</span>&nbsp;<span class="ident" id="4976674">wire</span>&nbsp;<span class="op" id="4976679">!=</span>&nbsp;<span class="ident" id="4976682">nil</span>&nbsp;<span class="op" id="4976686">&amp;&amp;</span>&nbsp;<span class="ident" id="4976689">wire</span><span class="op" id="4976693">.</span><span class="ident" id="4976694">StructT</span>&nbsp;<span class="op" id="4976702">!=</span>&nbsp;<span class="ident" id="4976705">nil</span>&nbsp;<span class="op" id="4976709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976713">dec</span><span class="op" id="4976716">.</span><span class="ident" id="4976717">ignoreStruct</span><span class="op" id="4976729">(</span><span class="op" id="4976730">*</span><span class="ident" id="4976731">enginePtr</span><span class="op" id="4976740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4976743">}</span>&nbsp;<span class="keyword" id="4976745">else</span>&nbsp;<span class="op" id="4976750">{</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976754">dec</span><span class="op" id="4976757">.</span><span class="ident" id="4976758">ignoreSingle</span><span class="op" id="4976770">(</span><span class="op" id="4976771">*</span><span class="ident" id="4976772">enginePtr</span><span class="op" id="4976781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4976784">}</span><br>
<span class="lineno"></span><span class="op" id="4976786">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4976789">func</span>&nbsp;<span class="ident" id="4976794">init</span><span class="op" id="4976798">(</span><span class="op" id="4976799">)</span>&nbsp;<span class="op" id="4976801">{</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976804">var</span>&nbsp;<span class="ident" id="4976808">iop</span><span class="op" id="4976811">,</span>&nbsp;<span class="ident" id="4976813">uop</span>&nbsp;<span class="ident" id="4976817">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976824">switch</span>&nbsp;<span class="ident" id="4976831">reflect</span><span class="op" id="4976838">.</span><span class="ident" id="4976839">TypeOf</span><span class="op" id="4976845">(</span><span class="builtintype" id="4976846">int</span><span class="op" id="4976849">(</span><span class="num" id="4976850">0</span><span class="op" id="4976851">)</span><span class="op" id="4976852">)</span><span class="op" id="4976853">.</span><span class="ident" id="4976854">Bits</span><span class="op" id="4976858">(</span><span class="op" id="4976859">)</span>&nbsp;<span class="op" id="4976861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976864">case</span>&nbsp;<span class="num" id="4976869">32</span><span class="op" id="4976871">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976875">iop</span>&nbsp;<span class="op" id="4976879">=</span>&nbsp;<span class="ident" id="4976881">decInt32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976892">uop</span>&nbsp;<span class="op" id="4976896">=</span>&nbsp;<span class="ident" id="4976898">decUint32</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976909">case</span>&nbsp;<span class="num" id="4976914">64</span><span class="op" id="4976916">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976920">iop</span>&nbsp;<span class="op" id="4976924">=</span>&nbsp;<span class="ident" id="4976926">decInt64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976937">uop</span>&nbsp;<span class="op" id="4976941">=</span>&nbsp;<span class="ident" id="4976943">decUint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976954">default</span><span class="op" id="4976961">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4976965">panic</span><span class="op" id="4976970">(</span><span class="string" id="4976971">&#34;gob:&nbsp;unknown&nbsp;size&nbsp;of&nbsp;int/uint&#34;</span><span class="op" id="4977002">)</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4977005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977008">decOpTable</span><span class="op" id="4977018">[</span><span class="ident" id="4977019">reflect</span><span class="op" id="4977026">.</span><span class="ident" id="4977027">Int</span><span class="op" id="4977030">]</span>&nbsp;<span class="op" id="4977032">=</span>&nbsp;<span class="ident" id="4977034">iop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977039">decOpTable</span><span class="op" id="4977049">[</span><span class="ident" id="4977050">reflect</span><span class="op" id="4977057">.</span><span class="ident" id="4977058">Uint</span><span class="op" id="4977062">]</span>&nbsp;<span class="op" id="4977064">=</span>&nbsp;<span class="ident" id="4977066">uop</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4977072">//&nbsp;Finally&nbsp;uintptr</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4977092">switch</span>&nbsp;<span class="ident" id="4977099">reflect</span><span class="op" id="4977106">.</span><span class="ident" id="4977107">TypeOf</span><span class="op" id="4977113">(</span><span class="builtintype" id="4977114">uintptr</span><span class="op" id="4977121">(</span><span class="num" id="4977122">0</span><span class="op" id="4977123">)</span><span class="op" id="4977124">)</span><span class="op" id="4977125">.</span><span class="ident" id="4977126">Bits</span><span class="op" id="4977130">(</span><span class="op" id="4977131">)</span>&nbsp;<span class="op" id="4977133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4977136">case</span>&nbsp;<span class="num" id="4977141">32</span><span class="op" id="4977143">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977147">uop</span>&nbsp;<span class="op" id="4977151">=</span>&nbsp;<span class="ident" id="4977153">decUint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4977164">case</span>&nbsp;<span class="num" id="4977169">64</span><span class="op" id="4977171">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977175">uop</span>&nbsp;<span class="op" id="4977179">=</span>&nbsp;<span class="ident" id="4977181">decUint64</span><br>
<span class="lineno">1205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4977192">default</span><span class="op" id="4977199">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4977203">panic</span><span class="op" id="4977208">(</span><span class="string" id="4977209">&#34;gob:&nbsp;unknown&nbsp;size&nbsp;of&nbsp;uintptr&#34;</span><span class="op" id="4977239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4977242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977245">decOpTable</span><span class="op" id="4977255">[</span><span class="ident" id="4977256">reflect</span><span class="op" id="4977263">.</span><span class="ident" id="4977264">Uintptr</span><span class="op" id="4977271">]</span>&nbsp;<span class="op" id="4977273">=</span>&nbsp;<span class="ident" id="4977275">uop</span><br>
<span class="lineno"></span><span class="op" id="4977279">}</span><br>
<span class="lineno">1210</span><br>
<span class="lineno"></span><span class="comment" id="4977282">//&nbsp;Gob&nbsp;depends&nbsp;on&nbsp;being&nbsp;able&nbsp;to&nbsp;take&nbsp;the&nbsp;address</span><br>
<span class="lineno"></span><span class="comment" id="4977331">//&nbsp;of&nbsp;zeroed&nbsp;Values&nbsp;it&nbsp;creates,&nbsp;so&nbsp;use&nbsp;this&nbsp;wrapper&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="4977391">//&nbsp;of&nbsp;the&nbsp;standard&nbsp;reflect.Zero.</span><br>
<span class="lineno"></span><span class="comment" id="4977424">//&nbsp;Each&nbsp;call&nbsp;allocates&nbsp;once.</span><br>
<span class="lineno">1215</span><span class="keyword" id="4977453">func</span>&nbsp;<span class="ident" id="4977458">allocValue</span><span class="op" id="4977468">(</span><span class="ident" id="4977469">t</span>&nbsp;<span class="ident" id="4977471">reflect</span><span class="op" id="4977478">.</span><span class="ident" id="4977479">Type</span><span class="op" id="4977483">)</span>&nbsp;<span class="ident" id="4977485">reflect</span><span class="op" id="4977492">.</span><span class="ident" id="4977493">Value</span>&nbsp;<span class="op" id="4977499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4977502">return</span>&nbsp;<span class="ident" id="4977509">reflect</span><span class="op" id="4977516">.</span><span class="ident" id="4977517">New</span><span class="op" id="4977520">(</span><span class="ident" id="4977521">t</span><span class="op" id="4977522">)</span><span class="op" id="4977523">.</span><span class="ident" id="4977524">Elem</span><span class="op" id="4977528">(</span><span class="op" id="4977529">)</span><br>
<span class="lineno"></span><span class="op" id="4977531">}</span>
</div>
</body>
</html>
