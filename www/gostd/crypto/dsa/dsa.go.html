<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/dsa</h2>
<ul>
<li><a href="/gostd/crypto/dsa/dsa.go.html" class="current">dsa.go</a></li>
<li><a href="/gostd/crypto/dsa/dsa_test.go.html">dsa_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4174189">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4174244">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4174298">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4174349">//&nbsp;Package&nbsp;dsa&nbsp;implements&nbsp;the&nbsp;Digital&nbsp;Signature&nbsp;Algorithm,&nbsp;as&nbsp;defined&nbsp;in&nbsp;FIPS&nbsp;186-3.</span><br>
<span class="lineno"></span><span class="keyword" id="4174434">package</span>&nbsp;<span class="ident" id="4174442">dsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4174447">import</span>&nbsp;<span class="op" id="4174454">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4174457">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4174467">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4174473">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="4174484">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4174487">//&nbsp;Parameters&nbsp;represents&nbsp;the&nbsp;domain&nbsp;parameters&nbsp;for&nbsp;a&nbsp;key.&nbsp;These&nbsp;parameters&nbsp;can</span><br>
<span class="lineno">15</span><span class="comment" id="4174566">//&nbsp;be&nbsp;shared&nbsp;across&nbsp;many&nbsp;keys.&nbsp;The&nbsp;bit&nbsp;length&nbsp;of&nbsp;Q&nbsp;must&nbsp;be&nbsp;a&nbsp;multiple&nbsp;of&nbsp;8.</span><br>
<span class="lineno"></span><span class="keyword" id="4174642">type</span>&nbsp;<span class="ident" id="4174647">Parameters</span>&nbsp;<span class="keyword" id="4174658">struct</span>&nbsp;<span class="op" id="4174665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4174668">P</span><span class="op" id="4174669">,</span>&nbsp;<span class="ident" id="4174671">Q</span><span class="op" id="4174672">,</span>&nbsp;<span class="ident" id="4174674">G</span>&nbsp;<span class="op" id="4174676">*</span><span class="ident" id="4174677">big</span><span class="op" id="4174680">.</span><span class="ident" id="4174681">Int</span><br>
<span class="lineno"></span><span class="op" id="4174685">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="4174688">//&nbsp;PublicKey&nbsp;represents&nbsp;a&nbsp;DSA&nbsp;public&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4174730">type</span>&nbsp;<span class="ident" id="4174735">PublicKey</span>&nbsp;<span class="keyword" id="4174745">struct</span>&nbsp;<span class="op" id="4174752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4174755">Parameters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4174767">Y</span>&nbsp;<span class="op" id="4174769">*</span><span class="ident" id="4174770">big</span><span class="op" id="4174773">.</span><span class="ident" id="4174774">Int</span><br>
<span class="lineno"></span><span class="op" id="4174778">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="4174781">//&nbsp;PrivateKey&nbsp;represents&nbsp;a&nbsp;DSA&nbsp;private&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4174825">type</span>&nbsp;<span class="ident" id="4174830">PrivateKey</span>&nbsp;<span class="keyword" id="4174841">struct</span>&nbsp;<span class="op" id="4174848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4174851">PublicKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4174862">X</span>&nbsp;<span class="op" id="4174864">*</span><span class="ident" id="4174865">big</span><span class="op" id="4174868">.</span><span class="ident" id="4174869">Int</span><br>
<span class="lineno">30</span><span class="op" id="4174873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4174876">//&nbsp;ErrInvalidPublicKey&nbsp;results&nbsp;when&nbsp;a&nbsp;public&nbsp;key&nbsp;is&nbsp;not&nbsp;usable&nbsp;by&nbsp;this&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="4174953">//&nbsp;FIPS&nbsp;is&nbsp;quite&nbsp;strict&nbsp;about&nbsp;the&nbsp;format&nbsp;of&nbsp;DSA&nbsp;keys,&nbsp;but&nbsp;other&nbsp;code&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="4175029">//&nbsp;less&nbsp;so.&nbsp;Thus,&nbsp;when&nbsp;using&nbsp;keys&nbsp;which&nbsp;may&nbsp;have&nbsp;been&nbsp;generated&nbsp;by&nbsp;other&nbsp;code,</span><br>
<span class="lineno">35</span><span class="comment" id="4175108">//&nbsp;this&nbsp;error&nbsp;must&nbsp;be&nbsp;handled.</span><br>
<span class="lineno"></span><span class="keyword" id="4175139">var</span>&nbsp;<span class="ident" id="4175143">ErrInvalidPublicKey</span>&nbsp;<span class="op" id="4175163">=</span>&nbsp;<span class="ident" id="4175165">errors</span><span class="op" id="4175171">.</span><span class="ident" id="4175172">New</span><span class="op" id="4175175">(</span><span class="string" id="4175176">&#34;crypto/dsa:&nbsp;invalid&nbsp;public&nbsp;key&#34;</span><span class="op" id="4175208">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4175211">//&nbsp;ParameterSizes&nbsp;is&nbsp;a&nbsp;enumeration&nbsp;of&nbsp;the&nbsp;acceptable&nbsp;bit&nbsp;lengths&nbsp;of&nbsp;the&nbsp;primes</span><br>
<span class="lineno"></span><span class="comment" id="4175290">//&nbsp;in&nbsp;a&nbsp;set&nbsp;of&nbsp;DSA&nbsp;parameters.&nbsp;See&nbsp;FIPS&nbsp;186-3,&nbsp;section&nbsp;4.2.</span><br>
<span class="lineno">40</span><span class="keyword" id="4175350">type</span>&nbsp;<span class="ident" id="4175355">ParameterSizes</span>&nbsp;<span class="builtintype" id="4175370">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4175375">const</span>&nbsp;<span class="op" id="4175381">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4175384">L1024N160</span>&nbsp;<span class="ident" id="4175394">ParameterSizes</span>&nbsp;<span class="op" id="4175409">=</span>&nbsp;<span class="ident" id="4175411">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4175417">L2048N224</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4175428">L2048N256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4175439">L3072N256</span><br>
<span class="lineno"></span><span class="op" id="4175449">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4175452">//&nbsp;numMRTests&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;Miller-Rabin&nbsp;primality&nbsp;tests&nbsp;that&nbsp;we&nbsp;perform.&nbsp;We</span><br>
<span class="lineno">50</span><span class="comment" id="4175532">//&nbsp;pick&nbsp;the&nbsp;largest&nbsp;recommended&nbsp;number&nbsp;from&nbsp;table&nbsp;C.1&nbsp;of&nbsp;FIPS&nbsp;186-3.</span><br>
<span class="lineno"></span><span class="keyword" id="4175601">const</span>&nbsp;<span class="ident" id="4175607">numMRTests</span>&nbsp;<span class="op" id="4175618">=</span>&nbsp;<span class="num" id="4175620">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4175624">//&nbsp;GenerateParameters&nbsp;puts&nbsp;a&nbsp;random,&nbsp;valid&nbsp;set&nbsp;of&nbsp;DSA&nbsp;parameters&nbsp;into&nbsp;params.</span><br>
<span class="lineno"></span><span class="comment" id="4175702">//&nbsp;This&nbsp;function&nbsp;takes&nbsp;many&nbsp;seconds,&nbsp;even&nbsp;on&nbsp;fast&nbsp;machines.</span><br>
<span class="lineno">55</span><span class="keyword" id="4175762">func</span>&nbsp;<span class="ident" id="4175767">GenerateParameters</span><span class="op" id="4175785">(</span><span class="ident" id="4175786">params</span>&nbsp;<span class="op" id="4175793">*</span><span class="ident" id="4175794">Parameters</span><span class="op" id="4175804">,</span>&nbsp;<span class="ident" id="4175806">rand</span>&nbsp;<span class="ident" id="4175811">io</span><span class="op" id="4175813">.</span><span class="ident" id="4175814">Reader</span><span class="op" id="4175820">,</span>&nbsp;<span class="ident" id="4175822">sizes</span>&nbsp;<span class="ident" id="4175828">ParameterSizes</span><span class="op" id="4175842">)</span>&nbsp;<span class="op" id="4175844">(</span><span class="ident" id="4175845">err</span>&nbsp;<span class="builtintype" id="4175849">error</span><span class="op" id="4175854">)</span>&nbsp;<span class="op" id="4175856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4175859">//&nbsp;This&nbsp;function&nbsp;doesn&#39;t&nbsp;follow&nbsp;FIPS&nbsp;186-3&nbsp;exactly&nbsp;in&nbsp;that&nbsp;it&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4175930">//&nbsp;use&nbsp;a&nbsp;verification&nbsp;seed&nbsp;to&nbsp;generate&nbsp;the&nbsp;primes.&nbsp;The&nbsp;verification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4175999">//&nbsp;seed&nbsp;doesn&#39;t&nbsp;appear&nbsp;to&nbsp;be&nbsp;exported&nbsp;or&nbsp;used&nbsp;by&nbsp;other&nbsp;code&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4176064">//&nbsp;omitting&nbsp;it&nbsp;makes&nbsp;the&nbsp;code&nbsp;cleaner.</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4176105">var</span>&nbsp;<span class="ident" id="4176109">L</span><span class="op" id="4176110">,</span>&nbsp;<span class="ident" id="4176112">N</span>&nbsp;<span class="builtintype" id="4176114">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4176119">switch</span>&nbsp;<span class="ident" id="4176126">sizes</span>&nbsp;<span class="op" id="4176132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4176135">case</span>&nbsp;<span class="ident" id="4176140">L1024N160</span><span class="op" id="4176149">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4176153">L</span>&nbsp;<span class="op" id="4176155">=</span>&nbsp;<span class="num" id="4176157">1024</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4176164">N</span>&nbsp;<span class="op" id="4176166">=</span>&nbsp;<span class="num" id="4176168">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4176173">case</span>&nbsp;<span class="ident" id="4176178">L2048N224</span><span class="op" id="4176187">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4176191">L</span>&nbsp;<span class="op" id="4176193">=</span>&nbsp;<span class="num" id="4176195">2048</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4176202">N</span>&nbsp;<span class="op" id="4176204">=</span>&nbsp;<span class="num" id="4176206">224</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4176211">case</span>&nbsp;<span class="ident" id="4176216">L2048N256</span><span class="op" id="4176225">:</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4176229">L</span>&nbsp;<span class="op" id="4176231">=</span>&nbsp;<span class="num" id="4176233">2048</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4176240">N</span>&nbsp;<span class="op" id="4176242">=</span>&nbsp;<span class="num" id="4176244">256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4176249">case</span>&nbsp;<span class="ident" id="4176254">L3072N256</span><span class="op" id="4176263">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4176267">L</span>&nbsp;<span class="op" id="4176269">=</span>&nbsp;<span class="num" id="4176271">3072</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4176278">N</span>&nbsp;<span class="op" id="4176280">=</span>&nbsp;<span class="num" id="4176282">256</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4176287">default</span><span class="op" id="4176294">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4176298">return</span>&nbsp;<span class="ident" id="4176305">errors</span><span class="op" id="4176311">.</span><span class="ident" id="4176312">New</span><span class="op" id="4176315">(</span><span class="string" id="4176316">&#34;crypto/dsa:&nbsp;invalid&nbsp;ParameterSizes&#34;</span><span class="op" id="4176352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4176355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4176359">qBytes</span>&nbsp;<span class="op" id="4176366">:=</span>&nbsp;<span class="builtinfunc" id="4176369">make</span><span class="op" id="4176373">(</span><span class="op" id="4176374">[</span><span class="op" id="4176375">]</span><span class="builtintype" id="4176376">byte</span><span class="op" id="4176380">,</span>&nbsp;<span class="ident" id="4176382">N</span><span class="op" id="4176383">/</span><span class="num" id="4176384">8</span><span class="op" id="4176385">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4176388">pBytes</span>&nbsp;<span class="op" id="4176395">:=</span>&nbsp;<span class="builtinfunc" id="4176398">make</span><span class="op" id="4176402">(</span><span class="op" id="4176403">[</span><span class="op" id="4176404">]</span><span class="builtintype" id="4176405">byte</span><span class="op" id="4176409">,</span>&nbsp;<span class="ident" id="4176411">L</span><span class="op" id="4176412">/</span><span class="num" id="4176413">8</span><span class="op" id="4176414">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4176418">q</span>&nbsp;<span class="op" id="4176420">:=</span>&nbsp;<span class="builtinfunc" id="4176423">new</span><span class="op" id="4176426">(</span><span class="ident" id="4176427">big</span><span class="op" id="4176430">.</span><span class="ident" id="4176431">Int</span><span class="op" id="4176434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4176437">p</span>&nbsp;<span class="op" id="4176439">:=</span>&nbsp;<span class="builtinfunc" id="4176442">new</span><span class="op" id="4176445">(</span><span class="ident" id="4176446">big</span><span class="op" id="4176449">.</span><span class="ident" id="4176450">Int</span><span class="op" id="4176453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4176456">rem</span>&nbsp;<span class="op" id="4176460">:=</span>&nbsp;<span class="builtinfunc" id="4176463">new</span><span class="op" id="4176466">(</span><span class="ident" id="4176467">big</span><span class="op" id="4176470">.</span><span class="ident" id="4176471">Int</span><span class="op" id="4176474">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4176477">one</span>&nbsp;<span class="op" id="4176481">:=</span>&nbsp;<span class="builtinfunc" id="4176484">new</span><span class="op" id="4176487">(</span><span class="ident" id="4176488">big</span><span class="op" id="4176491">.</span><span class="ident" id="4176492">Int</span><span class="op" id="4176495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4176498">one</span><span class="op" id="4176501">.</span><span class="ident" id="4176502">SetInt64</span><span class="op" id="4176510">(</span><span class="num" id="4176511">1</span><span class="op" id="4176512">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="4176515">GeneratePrimes</span><span class="op" id="4176529">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4176532">for</span>&nbsp;<span class="op" id="4176536">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4176540">_</span><span class="op" id="4176541">,</span>&nbsp;<span class="ident" id="4176543">err</span>&nbsp;<span class="op" id="4176547">=</span>&nbsp;<span class="ident" id="4176549">io</span><span class="op" id="4176551">.</span><span class="ident" id="4176552">ReadFull</span><span class="op" id="4176560">(</span><span class="ident" id="4176561">rand</span><span class="op" id="4176565">,</span>&nbsp;<span class="ident" id="4176567">qBytes</span><span class="op" id="4176573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4176577">if</span>&nbsp;<span class="ident" id="4176580">err</span>&nbsp;<span class="op" id="4176584">!=</span>&nbsp;<span class="builtintype" id="4176587">nil</span>&nbsp;<span class="op" id="4176591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4176596">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4176605">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4176610">qBytes</span><span class="op" id="4176616">[</span><span class="builtinfunc" id="4176617">len</span><span class="op" id="4176620">(</span><span class="ident" id="4176621">qBytes</span><span class="op" id="4176627">)</span><span class="op" id="4176628">-</span><span class="num" id="4176629">1</span><span class="op" id="4176630">]</span>&nbsp;<span class="op" id="4176632">|=</span>&nbsp;<span class="num" id="4176635">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4176639">qBytes</span><span class="op" id="4176645">[</span><span class="num" id="4176646">0</span><span class="op" id="4176647">]</span>&nbsp;<span class="op" id="4176649">|=</span>&nbsp;<span class="num" id="4176652">0x80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4176659">q</span><span class="op" id="4176660">.</span><span class="ident" id="4176661">SetBytes</span><span class="op" id="4176669">(</span><span class="ident" id="4176670">qBytes</span><span class="op" id="4176676">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4176681">if</span>&nbsp;<span class="op" id="4176684">!</span><span class="ident" id="4176685">q</span><span class="op" id="4176686">.</span><span class="ident" id="4176687">ProbablyPrime</span><span class="op" id="4176700">(</span><span class="ident" id="4176701">numMRTests</span><span class="op" id="4176711">)</span>&nbsp;<span class="op" id="4176713">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4176718">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4176729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4176734">for</span>&nbsp;<span class="ident" id="4176738">i</span>&nbsp;<span class="op" id="4176740">:=</span>&nbsp;<span class="num" id="4176743">0</span><span class="op" id="4176744">;</span>&nbsp;<span class="ident" id="4176746">i</span>&nbsp;<span class="op" id="4176748">&lt;</span>&nbsp;<span class="num" id="4176750">4</span><span class="op" id="4176751">*</span><span class="ident" id="4176752">L</span><span class="op" id="4176753">;</span>&nbsp;<span class="ident" id="4176755">i</span><span class="op" id="4176756">++</span>&nbsp;<span class="op" id="4176759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4176764">_</span><span class="op" id="4176765">,</span>&nbsp;<span class="ident" id="4176767">err</span>&nbsp;<span class="op" id="4176771">=</span>&nbsp;<span class="ident" id="4176773">io</span><span class="op" id="4176775">.</span><span class="ident" id="4176776">ReadFull</span><span class="op" id="4176784">(</span><span class="ident" id="4176785">rand</span><span class="op" id="4176789">,</span>&nbsp;<span class="ident" id="4176791">pBytes</span><span class="op" id="4176797">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4176802">if</span>&nbsp;<span class="ident" id="4176805">err</span>&nbsp;<span class="op" id="4176809">!=</span>&nbsp;<span class="builtintype" id="4176812">nil</span>&nbsp;<span class="op" id="4176816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4176822">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4176832">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4176838">pBytes</span><span class="op" id="4176844">[</span><span class="builtinfunc" id="4176845">len</span><span class="op" id="4176848">(</span><span class="ident" id="4176849">pBytes</span><span class="op" id="4176855">)</span><span class="op" id="4176856">-</span><span class="num" id="4176857">1</span><span class="op" id="4176858">]</span>&nbsp;<span class="op" id="4176860">|=</span>&nbsp;<span class="num" id="4176863">1</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4176868">pBytes</span><span class="op" id="4176874">[</span><span class="num" id="4176875">0</span><span class="op" id="4176876">]</span>&nbsp;<span class="op" id="4176878">|=</span>&nbsp;<span class="num" id="4176881">0x80</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4176890">p</span><span class="op" id="4176891">.</span><span class="ident" id="4176892">SetBytes</span><span class="op" id="4176900">(</span><span class="ident" id="4176901">pBytes</span><span class="op" id="4176907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4176912">rem</span><span class="op" id="4176915">.</span><span class="ident" id="4176916">Mod</span><span class="op" id="4176919">(</span><span class="ident" id="4176920">p</span><span class="op" id="4176921">,</span>&nbsp;<span class="ident" id="4176923">q</span><span class="op" id="4176924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4176929">rem</span><span class="op" id="4176932">.</span><span class="ident" id="4176933">Sub</span><span class="op" id="4176936">(</span><span class="ident" id="4176937">rem</span><span class="op" id="4176940">,</span>&nbsp;<span class="ident" id="4176942">one</span><span class="op" id="4176945">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4176950">p</span><span class="op" id="4176951">.</span><span class="ident" id="4176952">Sub</span><span class="op" id="4176955">(</span><span class="ident" id="4176956">p</span><span class="op" id="4176957">,</span>&nbsp;<span class="ident" id="4176959">rem</span><span class="op" id="4176962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4176967">if</span>&nbsp;<span class="ident" id="4176970">p</span><span class="op" id="4176971">.</span><span class="ident" id="4176972">BitLen</span><span class="op" id="4176978">(</span><span class="op" id="4176979">)</span>&nbsp;<span class="op" id="4176981">&lt;</span>&nbsp;<span class="ident" id="4176983">L</span>&nbsp;<span class="op" id="4176985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4176991">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4177003">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4177009">if</span>&nbsp;<span class="op" id="4177012">!</span><span class="ident" id="4177013">p</span><span class="op" id="4177014">.</span><span class="ident" id="4177015">ProbablyPrime</span><span class="op" id="4177028">(</span><span class="ident" id="4177029">numMRTests</span><span class="op" id="4177039">)</span>&nbsp;<span class="op" id="4177041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4177047">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4177059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4177065">params</span><span class="op" id="4177071">.</span><span class="ident" id="4177072">P</span>&nbsp;<span class="op" id="4177074">=</span>&nbsp;<span class="ident" id="4177076">p</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4177081">params</span><span class="op" id="4177087">.</span><span class="ident" id="4177088">Q</span>&nbsp;<span class="op" id="4177090">=</span>&nbsp;<span class="ident" id="4177092">q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4177097">break</span>&nbsp;<span class="ident" id="4177103">GeneratePrimes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4177120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4177123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4177127">h</span>&nbsp;<span class="op" id="4177129">:=</span>&nbsp;<span class="builtinfunc" id="4177132">new</span><span class="op" id="4177135">(</span><span class="ident" id="4177136">big</span><span class="op" id="4177139">.</span><span class="ident" id="4177140">Int</span><span class="op" id="4177143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4177146">h</span><span class="op" id="4177147">.</span><span class="ident" id="4177148">SetInt64</span><span class="op" id="4177156">(</span><span class="num" id="4177157">2</span><span class="op" id="4177158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4177161">g</span>&nbsp;<span class="op" id="4177163">:=</span>&nbsp;<span class="builtinfunc" id="4177166">new</span><span class="op" id="4177169">(</span><span class="ident" id="4177170">big</span><span class="op" id="4177173">.</span><span class="ident" id="4177174">Int</span><span class="op" id="4177177">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4177181">pm1</span>&nbsp;<span class="op" id="4177185">:=</span>&nbsp;<span class="builtinfunc" id="4177188">new</span><span class="op" id="4177191">(</span><span class="ident" id="4177192">big</span><span class="op" id="4177195">.</span><span class="ident" id="4177196">Int</span><span class="op" id="4177199">)</span><span class="op" id="4177200">.</span><span class="ident" id="4177201">Sub</span><span class="op" id="4177204">(</span><span class="ident" id="4177205">p</span><span class="op" id="4177206">,</span>&nbsp;<span class="ident" id="4177208">one</span><span class="op" id="4177211">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4177214">e</span>&nbsp;<span class="op" id="4177216">:=</span>&nbsp;<span class="builtinfunc" id="4177219">new</span><span class="op" id="4177222">(</span><span class="ident" id="4177223">big</span><span class="op" id="4177226">.</span><span class="ident" id="4177227">Int</span><span class="op" id="4177230">)</span><span class="op" id="4177231">.</span><span class="ident" id="4177232">Div</span><span class="op" id="4177235">(</span><span class="ident" id="4177236">pm1</span><span class="op" id="4177239">,</span>&nbsp;<span class="ident" id="4177241">q</span><span class="op" id="4177242">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4177246">for</span>&nbsp;<span class="op" id="4177250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4177254">g</span><span class="op" id="4177255">.</span><span class="ident" id="4177256">Exp</span><span class="op" id="4177259">(</span><span class="ident" id="4177260">h</span><span class="op" id="4177261">,</span>&nbsp;<span class="ident" id="4177263">e</span><span class="op" id="4177264">,</span>&nbsp;<span class="ident" id="4177266">p</span><span class="op" id="4177267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4177271">if</span>&nbsp;<span class="ident" id="4177274">g</span><span class="op" id="4177275">.</span><span class="ident" id="4177276">Cmp</span><span class="op" id="4177279">(</span><span class="ident" id="4177280">one</span><span class="op" id="4177283">)</span>&nbsp;<span class="op" id="4177285">==</span>&nbsp;<span class="num" id="4177288">0</span>&nbsp;<span class="op" id="4177290">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4177295">h</span><span class="op" id="4177296">.</span><span class="ident" id="4177297">Add</span><span class="op" id="4177300">(</span><span class="ident" id="4177301">h</span><span class="op" id="4177302">,</span>&nbsp;<span class="ident" id="4177304">one</span><span class="op" id="4177307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4177312">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4177323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4177328">params</span><span class="op" id="4177334">.</span><span class="ident" id="4177335">G</span>&nbsp;<span class="op" id="4177337">=</span>&nbsp;<span class="ident" id="4177339">g</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4177343">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4177351">}</span><br>
<span class="lineno"></span><span class="op" id="4177353">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4177356">//&nbsp;GenerateKey&nbsp;generates&nbsp;a&nbsp;public&amp;private&nbsp;key&nbsp;pair.&nbsp;The&nbsp;Parameters&nbsp;of&nbsp;the</span><br>
<span class="lineno">150</span><span class="comment" id="4177430">//&nbsp;PrivateKey&nbsp;must&nbsp;already&nbsp;be&nbsp;valid&nbsp;(see&nbsp;GenerateParameters).</span><br>
<span class="lineno"></span><span class="keyword" id="4177492">func</span>&nbsp;<span class="ident" id="4177497">GenerateKey</span><span class="op" id="4177508">(</span><span class="ident" id="4177509">priv</span>&nbsp;<span class="op" id="4177514">*</span><span class="ident" id="4177515">PrivateKey</span><span class="op" id="4177525">,</span>&nbsp;<span class="ident" id="4177527">rand</span>&nbsp;<span class="ident" id="4177532">io</span><span class="op" id="4177534">.</span><span class="ident" id="4177535">Reader</span><span class="op" id="4177541">)</span>&nbsp;<span class="builtintype" id="4177543">error</span>&nbsp;<span class="op" id="4177549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4177552">if</span>&nbsp;<span class="ident" id="4177555">priv</span><span class="op" id="4177559">.</span><span class="ident" id="4177560">P</span>&nbsp;<span class="op" id="4177562">==</span>&nbsp;<span class="builtintype" id="4177565">nil</span>&nbsp;<span class="op" id="4177569">||</span>&nbsp;<span class="ident" id="4177572">priv</span><span class="op" id="4177576">.</span><span class="ident" id="4177577">Q</span>&nbsp;<span class="op" id="4177579">==</span>&nbsp;<span class="builtintype" id="4177582">nil</span>&nbsp;<span class="op" id="4177586">||</span>&nbsp;<span class="ident" id="4177589">priv</span><span class="op" id="4177593">.</span><span class="ident" id="4177594">G</span>&nbsp;<span class="op" id="4177596">==</span>&nbsp;<span class="builtintype" id="4177599">nil</span>&nbsp;<span class="op" id="4177603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4177607">return</span>&nbsp;<span class="ident" id="4177614">errors</span><span class="op" id="4177620">.</span><span class="ident" id="4177621">New</span><span class="op" id="4177624">(</span><span class="string" id="4177625">&#34;crypto/dsa:&nbsp;parameters&nbsp;not&nbsp;set&nbsp;up&nbsp;before&nbsp;generating&nbsp;key&#34;</span><span class="op" id="4177682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4177685">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4177689">x</span>&nbsp;<span class="op" id="4177691">:=</span>&nbsp;<span class="builtinfunc" id="4177694">new</span><span class="op" id="4177697">(</span><span class="ident" id="4177698">big</span><span class="op" id="4177701">.</span><span class="ident" id="4177702">Int</span><span class="op" id="4177705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4177708">xBytes</span>&nbsp;<span class="op" id="4177715">:=</span>&nbsp;<span class="builtinfunc" id="4177718">make</span><span class="op" id="4177722">(</span><span class="op" id="4177723">[</span><span class="op" id="4177724">]</span><span class="builtintype" id="4177725">byte</span><span class="op" id="4177729">,</span>&nbsp;<span class="ident" id="4177731">priv</span><span class="op" id="4177735">.</span><span class="ident" id="4177736">Q</span><span class="op" id="4177737">.</span><span class="ident" id="4177738">BitLen</span><span class="op" id="4177744">(</span><span class="op" id="4177745">)</span><span class="op" id="4177746">/</span><span class="num" id="4177747">8</span><span class="op" id="4177748">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4177752">for</span>&nbsp;<span class="op" id="4177756">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4177760">_</span><span class="op" id="4177761">,</span>&nbsp;<span class="ident" id="4177763">err</span>&nbsp;<span class="op" id="4177767">:=</span>&nbsp;<span class="ident" id="4177770">io</span><span class="op" id="4177772">.</span><span class="ident" id="4177773">ReadFull</span><span class="op" id="4177781">(</span><span class="ident" id="4177782">rand</span><span class="op" id="4177786">,</span>&nbsp;<span class="ident" id="4177788">xBytes</span><span class="op" id="4177794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4177798">if</span>&nbsp;<span class="ident" id="4177801">err</span>&nbsp;<span class="op" id="4177805">!=</span>&nbsp;<span class="builtintype" id="4177808">nil</span>&nbsp;<span class="op" id="4177812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4177817">return</span>&nbsp;<span class="ident" id="4177824">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4177830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4177834">x</span><span class="op" id="4177835">.</span><span class="ident" id="4177836">SetBytes</span><span class="op" id="4177844">(</span><span class="ident" id="4177845">xBytes</span><span class="op" id="4177851">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4177855">if</span>&nbsp;<span class="ident" id="4177858">x</span><span class="op" id="4177859">.</span><span class="ident" id="4177860">Sign</span><span class="op" id="4177864">(</span><span class="op" id="4177865">)</span>&nbsp;<span class="op" id="4177867">!=</span>&nbsp;<span class="num" id="4177870">0</span>&nbsp;<span class="op" id="4177872">&amp;&amp;</span>&nbsp;<span class="ident" id="4177875">x</span><span class="op" id="4177876">.</span><span class="ident" id="4177877">Cmp</span><span class="op" id="4177880">(</span><span class="ident" id="4177881">priv</span><span class="op" id="4177885">.</span><span class="ident" id="4177886">Q</span><span class="op" id="4177887">)</span>&nbsp;<span class="op" id="4177889">&lt;</span>&nbsp;<span class="num" id="4177891">0</span>&nbsp;<span class="op" id="4177893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4177898">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4177906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4177909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4177913">priv</span><span class="op" id="4177917">.</span><span class="ident" id="4177918">X</span>&nbsp;<span class="op" id="4177920">=</span>&nbsp;<span class="ident" id="4177922">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4177925">priv</span><span class="op" id="4177929">.</span><span class="ident" id="4177930">Y</span>&nbsp;<span class="op" id="4177932">=</span>&nbsp;<span class="builtinfunc" id="4177934">new</span><span class="op" id="4177937">(</span><span class="ident" id="4177938">big</span><span class="op" id="4177941">.</span><span class="ident" id="4177942">Int</span><span class="op" id="4177945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4177948">priv</span><span class="op" id="4177952">.</span><span class="ident" id="4177953">Y</span><span class="op" id="4177954">.</span><span class="ident" id="4177955">Exp</span><span class="op" id="4177958">(</span><span class="ident" id="4177959">priv</span><span class="op" id="4177963">.</span><span class="ident" id="4177964">G</span><span class="op" id="4177965">,</span>&nbsp;<span class="ident" id="4177967">x</span><span class="op" id="4177968">,</span>&nbsp;<span class="ident" id="4177970">priv</span><span class="op" id="4177974">.</span><span class="ident" id="4177975">P</span><span class="op" id="4177976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4177979">return</span>&nbsp;<span class="builtintype" id="4177986">nil</span><br>
<span class="lineno"></span><span class="op" id="4177990">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="4177993">//&nbsp;fermatInverse&nbsp;calculates&nbsp;the&nbsp;inverse&nbsp;of&nbsp;k&nbsp;in&nbsp;GF(P)&nbsp;using&nbsp;Fermat&#39;s&nbsp;method.</span><br>
<span class="lineno"></span><span class="comment" id="4178070">//&nbsp;This&nbsp;has&nbsp;better&nbsp;constant-time&nbsp;properties&nbsp;than&nbsp;Euclid&#39;s&nbsp;method&nbsp;(implemented</span><br>
<span class="lineno"></span><span class="comment" id="4178148">//&nbsp;in&nbsp;math/big.Int.ModInverse)&nbsp;although&nbsp;math/big&nbsp;itself&nbsp;isn&#39;t&nbsp;strictly</span><br>
<span class="lineno"></span><span class="comment" id="4178219">//&nbsp;constant-time&nbsp;so&nbsp;it&#39;s&nbsp;not&nbsp;perfect.</span><br>
<span class="lineno">180</span><span class="keyword" id="4178257">func</span>&nbsp;<span class="ident" id="4178262">fermatInverse</span><span class="op" id="4178275">(</span><span class="ident" id="4178276">k</span><span class="op" id="4178277">,</span>&nbsp;<span class="ident" id="4178279">P</span>&nbsp;<span class="op" id="4178281">*</span><span class="ident" id="4178282">big</span><span class="op" id="4178285">.</span><span class="ident" id="4178286">Int</span><span class="op" id="4178289">)</span>&nbsp;<span class="op" id="4178291">*</span><span class="ident" id="4178292">big</span><span class="op" id="4178295">.</span><span class="ident" id="4178296">Int</span>&nbsp;<span class="op" id="4178300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4178303">two</span>&nbsp;<span class="op" id="4178307">:=</span>&nbsp;<span class="ident" id="4178310">big</span><span class="op" id="4178313">.</span><span class="ident" id="4178314">NewInt</span><span class="op" id="4178320">(</span><span class="num" id="4178321">2</span><span class="op" id="4178322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4178325">pMinus2</span>&nbsp;<span class="op" id="4178333">:=</span>&nbsp;<span class="builtinfunc" id="4178336">new</span><span class="op" id="4178339">(</span><span class="ident" id="4178340">big</span><span class="op" id="4178343">.</span><span class="ident" id="4178344">Int</span><span class="op" id="4178347">)</span><span class="op" id="4178348">.</span><span class="ident" id="4178349">Sub</span><span class="op" id="4178352">(</span><span class="ident" id="4178353">P</span><span class="op" id="4178354">,</span>&nbsp;<span class="ident" id="4178356">two</span><span class="op" id="4178359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4178362">return</span>&nbsp;<span class="builtinfunc" id="4178369">new</span><span class="op" id="4178372">(</span><span class="ident" id="4178373">big</span><span class="op" id="4178376">.</span><span class="ident" id="4178377">Int</span><span class="op" id="4178380">)</span><span class="op" id="4178381">.</span><span class="ident" id="4178382">Exp</span><span class="op" id="4178385">(</span><span class="ident" id="4178386">k</span><span class="op" id="4178387">,</span>&nbsp;<span class="ident" id="4178389">pMinus2</span><span class="op" id="4178396">,</span>&nbsp;<span class="ident" id="4178398">P</span><span class="op" id="4178399">)</span><br>
<span class="lineno"></span><span class="op" id="4178401">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="comment" id="4178404">//&nbsp;Sign&nbsp;signs&nbsp;an&nbsp;arbitrary&nbsp;length&nbsp;hash&nbsp;(which&nbsp;should&nbsp;be&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4178484">//&nbsp;larger&nbsp;message)&nbsp;using&nbsp;the&nbsp;private&nbsp;key,&nbsp;priv.&nbsp;It&nbsp;returns&nbsp;the&nbsp;signature&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4178562">//&nbsp;pair&nbsp;of&nbsp;integers.&nbsp;The&nbsp;security&nbsp;of&nbsp;the&nbsp;private&nbsp;key&nbsp;depends&nbsp;on&nbsp;the&nbsp;entropy&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4178641">//&nbsp;rand.</span><br>
<span class="lineno">190</span><span class="comment" id="4178650">//</span><br>
<span class="lineno"></span><span class="comment" id="4178653">//&nbsp;Note&nbsp;that&nbsp;FIPS&nbsp;186-3&nbsp;section&nbsp;4.6&nbsp;specifies&nbsp;that&nbsp;the&nbsp;hash&nbsp;should&nbsp;be&nbsp;truncated</span><br>
<span class="lineno"></span><span class="comment" id="4178733">//&nbsp;to&nbsp;the&nbsp;byte-length&nbsp;of&nbsp;the&nbsp;subgroup.&nbsp;This&nbsp;function&nbsp;does&nbsp;not&nbsp;perform&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4178808">//&nbsp;truncation&nbsp;itself.</span><br>
<span class="lineno"></span><span class="keyword" id="4178830">func</span>&nbsp;<span class="ident" id="4178835">Sign</span><span class="op" id="4178839">(</span><span class="ident" id="4178840">rand</span>&nbsp;<span class="ident" id="4178845">io</span><span class="op" id="4178847">.</span><span class="ident" id="4178848">Reader</span><span class="op" id="4178854">,</span>&nbsp;<span class="ident" id="4178856">priv</span>&nbsp;<span class="op" id="4178861">*</span><span class="ident" id="4178862">PrivateKey</span><span class="op" id="4178872">,</span>&nbsp;<span class="ident" id="4178874">hash</span>&nbsp;<span class="op" id="4178879">[</span><span class="op" id="4178880">]</span><span class="builtintype" id="4178881">byte</span><span class="op" id="4178885">)</span>&nbsp;<span class="op" id="4178887">(</span><span class="ident" id="4178888">r</span><span class="op" id="4178889">,</span>&nbsp;<span class="ident" id="4178891">s</span>&nbsp;<span class="op" id="4178893">*</span><span class="ident" id="4178894">big</span><span class="op" id="4178897">.</span><span class="ident" id="4178898">Int</span><span class="op" id="4178901">,</span>&nbsp;<span class="ident" id="4178903">err</span>&nbsp;<span class="builtintype" id="4178907">error</span><span class="op" id="4178912">)</span>&nbsp;<span class="op" id="4178914">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4178917">//&nbsp;FIPS&nbsp;186-3,&nbsp;section&nbsp;4.6</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4178946">n</span>&nbsp;<span class="op" id="4178948">:=</span>&nbsp;<span class="ident" id="4178951">priv</span><span class="op" id="4178955">.</span><span class="ident" id="4178956">Q</span><span class="op" id="4178957">.</span><span class="ident" id="4178958">BitLen</span><span class="op" id="4178964">(</span><span class="op" id="4178965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4178968">if</span>&nbsp;<span class="ident" id="4178971">n</span><span class="op" id="4178972">&amp;</span><span class="num" id="4178973">7</span>&nbsp;<span class="op" id="4178975">!=</span>&nbsp;<span class="num" id="4178978">0</span>&nbsp;<span class="op" id="4178980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4178984">err</span>&nbsp;<span class="op" id="4178988">=</span>&nbsp;<span class="ident" id="4178990">ErrInvalidPublicKey</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4179012">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4179020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4179023">n</span>&nbsp;<span class="op" id="4179025">&gt;&gt;=</span>&nbsp;<span class="num" id="4179029">3</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4179033">for</span>&nbsp;<span class="op" id="4179037">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4179041">k</span>&nbsp;<span class="op" id="4179043">:=</span>&nbsp;<span class="builtinfunc" id="4179046">new</span><span class="op" id="4179049">(</span><span class="ident" id="4179050">big</span><span class="op" id="4179053">.</span><span class="ident" id="4179054">Int</span><span class="op" id="4179057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4179061">buf</span>&nbsp;<span class="op" id="4179065">:=</span>&nbsp;<span class="builtinfunc" id="4179068">make</span><span class="op" id="4179072">(</span><span class="op" id="4179073">[</span><span class="op" id="4179074">]</span><span class="builtintype" id="4179075">byte</span><span class="op" id="4179079">,</span>&nbsp;<span class="ident" id="4179081">n</span><span class="op" id="4179082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4179086">for</span>&nbsp;<span class="op" id="4179090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4179095">_</span><span class="op" id="4179096">,</span>&nbsp;<span class="ident" id="4179098">err</span>&nbsp;<span class="op" id="4179102">=</span>&nbsp;<span class="ident" id="4179104">io</span><span class="op" id="4179106">.</span><span class="ident" id="4179107">ReadFull</span><span class="op" id="4179115">(</span><span class="ident" id="4179116">rand</span><span class="op" id="4179120">,</span>&nbsp;<span class="ident" id="4179122">buf</span><span class="op" id="4179125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4179130">if</span>&nbsp;<span class="ident" id="4179133">err</span>&nbsp;<span class="op" id="4179137">!=</span>&nbsp;<span class="builtintype" id="4179140">nil</span>&nbsp;<span class="op" id="4179144">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4179150">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4179160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4179165">k</span><span class="op" id="4179166">.</span><span class="ident" id="4179167">SetBytes</span><span class="op" id="4179175">(</span><span class="ident" id="4179176">buf</span><span class="op" id="4179179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4179184">if</span>&nbsp;<span class="ident" id="4179187">k</span><span class="op" id="4179188">.</span><span class="ident" id="4179189">Sign</span><span class="op" id="4179193">(</span><span class="op" id="4179194">)</span>&nbsp;<span class="op" id="4179196">&gt;</span>&nbsp;<span class="num" id="4179198">0</span>&nbsp;<span class="op" id="4179200">&amp;&amp;</span>&nbsp;<span class="ident" id="4179203">k</span><span class="op" id="4179204">.</span><span class="ident" id="4179205">Cmp</span><span class="op" id="4179208">(</span><span class="ident" id="4179209">priv</span><span class="op" id="4179213">.</span><span class="ident" id="4179214">Q</span><span class="op" id="4179215">)</span>&nbsp;<span class="op" id="4179217">&lt;</span>&nbsp;<span class="num" id="4179219">0</span>&nbsp;<span class="op" id="4179221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4179227">break</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4179236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4179240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4179245">kInv</span>&nbsp;<span class="op" id="4179250">:=</span>&nbsp;<span class="ident" id="4179253">fermatInverse</span><span class="op" id="4179266">(</span><span class="ident" id="4179267">k</span><span class="op" id="4179268">,</span>&nbsp;<span class="ident" id="4179270">priv</span><span class="op" id="4179274">.</span><span class="ident" id="4179275">Q</span><span class="op" id="4179276">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4179281">r</span>&nbsp;<span class="op" id="4179283">=</span>&nbsp;<span class="builtinfunc" id="4179285">new</span><span class="op" id="4179288">(</span><span class="ident" id="4179289">big</span><span class="op" id="4179292">.</span><span class="ident" id="4179293">Int</span><span class="op" id="4179296">)</span><span class="op" id="4179297">.</span><span class="ident" id="4179298">Exp</span><span class="op" id="4179301">(</span><span class="ident" id="4179302">priv</span><span class="op" id="4179306">.</span><span class="ident" id="4179307">G</span><span class="op" id="4179308">,</span>&nbsp;<span class="ident" id="4179310">k</span><span class="op" id="4179311">,</span>&nbsp;<span class="ident" id="4179313">priv</span><span class="op" id="4179317">.</span><span class="ident" id="4179318">P</span><span class="op" id="4179319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4179323">r</span><span class="op" id="4179324">.</span><span class="ident" id="4179325">Mod</span><span class="op" id="4179328">(</span><span class="ident" id="4179329">r</span><span class="op" id="4179330">,</span>&nbsp;<span class="ident" id="4179332">priv</span><span class="op" id="4179336">.</span><span class="ident" id="4179337">Q</span><span class="op" id="4179338">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4179343">if</span>&nbsp;<span class="ident" id="4179346">r</span><span class="op" id="4179347">.</span><span class="ident" id="4179348">Sign</span><span class="op" id="4179352">(</span><span class="op" id="4179353">)</span>&nbsp;<span class="op" id="4179355">==</span>&nbsp;<span class="num" id="4179358">0</span>&nbsp;<span class="op" id="4179360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4179365">continue</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4179376">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4179381">z</span>&nbsp;<span class="op" id="4179383">:=</span>&nbsp;<span class="ident" id="4179386">k</span><span class="op" id="4179387">.</span><span class="ident" id="4179388">SetBytes</span><span class="op" id="4179396">(</span><span class="ident" id="4179397">hash</span><span class="op" id="4179401">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4179406">s</span>&nbsp;<span class="op" id="4179408">=</span>&nbsp;<span class="builtinfunc" id="4179410">new</span><span class="op" id="4179413">(</span><span class="ident" id="4179414">big</span><span class="op" id="4179417">.</span><span class="ident" id="4179418">Int</span><span class="op" id="4179421">)</span><span class="op" id="4179422">.</span><span class="ident" id="4179423">Mul</span><span class="op" id="4179426">(</span><span class="ident" id="4179427">priv</span><span class="op" id="4179431">.</span><span class="ident" id="4179432">X</span><span class="op" id="4179433">,</span>&nbsp;<span class="ident" id="4179435">r</span><span class="op" id="4179436">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4179440">s</span><span class="op" id="4179441">.</span><span class="ident" id="4179442">Add</span><span class="op" id="4179445">(</span><span class="ident" id="4179446">s</span><span class="op" id="4179447">,</span>&nbsp;<span class="ident" id="4179449">z</span><span class="op" id="4179450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4179454">s</span><span class="op" id="4179455">.</span><span class="ident" id="4179456">Mod</span><span class="op" id="4179459">(</span><span class="ident" id="4179460">s</span><span class="op" id="4179461">,</span>&nbsp;<span class="ident" id="4179463">priv</span><span class="op" id="4179467">.</span><span class="ident" id="4179468">Q</span><span class="op" id="4179469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4179473">s</span><span class="op" id="4179474">.</span><span class="ident" id="4179475">Mul</span><span class="op" id="4179478">(</span><span class="ident" id="4179479">s</span><span class="op" id="4179480">,</span>&nbsp;<span class="ident" id="4179482">kInv</span><span class="op" id="4179486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4179490">s</span><span class="op" id="4179491">.</span><span class="ident" id="4179492">Mod</span><span class="op" id="4179495">(</span><span class="ident" id="4179496">s</span><span class="op" id="4179497">,</span>&nbsp;<span class="ident" id="4179499">priv</span><span class="op" id="4179503">.</span><span class="ident" id="4179504">Q</span><span class="op" id="4179505">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4179510">if</span>&nbsp;<span class="ident" id="4179513">s</span><span class="op" id="4179514">.</span><span class="ident" id="4179515">Sign</span><span class="op" id="4179519">(</span><span class="op" id="4179520">)</span>&nbsp;<span class="op" id="4179522">!=</span>&nbsp;<span class="num" id="4179525">0</span>&nbsp;<span class="op" id="4179527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4179532">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4179540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4179543">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4179547">return</span><br>
<span class="lineno"></span><span class="op" id="4179554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4179557">//&nbsp;Verify&nbsp;verifies&nbsp;the&nbsp;signature&nbsp;in&nbsp;r,&nbsp;s&nbsp;of&nbsp;hash&nbsp;using&nbsp;the&nbsp;public&nbsp;key,&nbsp;pub.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="4179636">//&nbsp;reports&nbsp;whether&nbsp;the&nbsp;signature&nbsp;is&nbsp;valid.</span><br>
<span class="lineno">245</span><span class="comment" id="4179679">//</span><br>
<span class="lineno"></span><span class="comment" id="4179682">//&nbsp;Note&nbsp;that&nbsp;FIPS&nbsp;186-3&nbsp;section&nbsp;4.6&nbsp;specifies&nbsp;that&nbsp;the&nbsp;hash&nbsp;should&nbsp;be&nbsp;truncated</span><br>
<span class="lineno"></span><span class="comment" id="4179762">//&nbsp;to&nbsp;the&nbsp;byte-length&nbsp;of&nbsp;the&nbsp;subgroup.&nbsp;This&nbsp;function&nbsp;does&nbsp;not&nbsp;perform&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4179837">//&nbsp;truncation&nbsp;itself.</span><br>
<span class="lineno"></span><span class="keyword" id="4179859">func</span>&nbsp;<span class="ident" id="4179864">Verify</span><span class="op" id="4179870">(</span><span class="ident" id="4179871">pub</span>&nbsp;<span class="op" id="4179875">*</span><span class="ident" id="4179876">PublicKey</span><span class="op" id="4179885">,</span>&nbsp;<span class="ident" id="4179887">hash</span>&nbsp;<span class="op" id="4179892">[</span><span class="op" id="4179893">]</span><span class="builtintype" id="4179894">byte</span><span class="op" id="4179898">,</span>&nbsp;<span class="ident" id="4179900">r</span><span class="op" id="4179901">,</span>&nbsp;<span class="ident" id="4179903">s</span>&nbsp;<span class="op" id="4179905">*</span><span class="ident" id="4179906">big</span><span class="op" id="4179909">.</span><span class="ident" id="4179910">Int</span><span class="op" id="4179913">)</span>&nbsp;<span class="builtintype" id="4179915">bool</span>&nbsp;<span class="op" id="4179920">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4179923">//&nbsp;FIPS&nbsp;186-3,&nbsp;section&nbsp;4.7</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4179952">if</span>&nbsp;<span class="ident" id="4179955">r</span><span class="op" id="4179956">.</span><span class="ident" id="4179957">Sign</span><span class="op" id="4179961">(</span><span class="op" id="4179962">)</span>&nbsp;<span class="op" id="4179964">&lt;</span>&nbsp;<span class="num" id="4179966">1</span>&nbsp;<span class="op" id="4179968">||</span>&nbsp;<span class="ident" id="4179971">r</span><span class="op" id="4179972">.</span><span class="ident" id="4179973">Cmp</span><span class="op" id="4179976">(</span><span class="ident" id="4179977">pub</span><span class="op" id="4179980">.</span><span class="ident" id="4179981">Q</span><span class="op" id="4179982">)</span>&nbsp;<span class="op" id="4179984">&gt;=</span>&nbsp;<span class="num" id="4179987">0</span>&nbsp;<span class="op" id="4179989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4179993">return</span>&nbsp;<span class="builtintype" id="4180000">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4180007">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4180010">if</span>&nbsp;<span class="ident" id="4180013">s</span><span class="op" id="4180014">.</span><span class="ident" id="4180015">Sign</span><span class="op" id="4180019">(</span><span class="op" id="4180020">)</span>&nbsp;<span class="op" id="4180022">&lt;</span>&nbsp;<span class="num" id="4180024">1</span>&nbsp;<span class="op" id="4180026">||</span>&nbsp;<span class="ident" id="4180029">s</span><span class="op" id="4180030">.</span><span class="ident" id="4180031">Cmp</span><span class="op" id="4180034">(</span><span class="ident" id="4180035">pub</span><span class="op" id="4180038">.</span><span class="ident" id="4180039">Q</span><span class="op" id="4180040">)</span>&nbsp;<span class="op" id="4180042">&gt;=</span>&nbsp;<span class="num" id="4180045">0</span>&nbsp;<span class="op" id="4180047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4180051">return</span>&nbsp;<span class="builtintype" id="4180058">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4180065">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4180069">w</span>&nbsp;<span class="op" id="4180071">:=</span>&nbsp;<span class="builtinfunc" id="4180074">new</span><span class="op" id="4180077">(</span><span class="ident" id="4180078">big</span><span class="op" id="4180081">.</span><span class="ident" id="4180082">Int</span><span class="op" id="4180085">)</span><span class="op" id="4180086">.</span><span class="ident" id="4180087">ModInverse</span><span class="op" id="4180097">(</span><span class="ident" id="4180098">s</span><span class="op" id="4180099">,</span>&nbsp;<span class="ident" id="4180101">pub</span><span class="op" id="4180104">.</span><span class="ident" id="4180105">Q</span><span class="op" id="4180106">)</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4180110">n</span>&nbsp;<span class="op" id="4180112">:=</span>&nbsp;<span class="ident" id="4180115">pub</span><span class="op" id="4180118">.</span><span class="ident" id="4180119">Q</span><span class="op" id="4180120">.</span><span class="ident" id="4180121">BitLen</span><span class="op" id="4180127">(</span><span class="op" id="4180128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4180131">if</span>&nbsp;<span class="ident" id="4180134">n</span><span class="op" id="4180135">&amp;</span><span class="num" id="4180136">7</span>&nbsp;<span class="op" id="4180138">!=</span>&nbsp;<span class="num" id="4180141">0</span>&nbsp;<span class="op" id="4180143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4180147">return</span>&nbsp;<span class="builtintype" id="4180154">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4180161">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4180164">z</span>&nbsp;<span class="op" id="4180166">:=</span>&nbsp;<span class="builtinfunc" id="4180169">new</span><span class="op" id="4180172">(</span><span class="ident" id="4180173">big</span><span class="op" id="4180176">.</span><span class="ident" id="4180177">Int</span><span class="op" id="4180180">)</span><span class="op" id="4180181">.</span><span class="ident" id="4180182">SetBytes</span><span class="op" id="4180190">(</span><span class="ident" id="4180191">hash</span><span class="op" id="4180195">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4180199">u1</span>&nbsp;<span class="op" id="4180202">:=</span>&nbsp;<span class="builtinfunc" id="4180205">new</span><span class="op" id="4180208">(</span><span class="ident" id="4180209">big</span><span class="op" id="4180212">.</span><span class="ident" id="4180213">Int</span><span class="op" id="4180216">)</span><span class="op" id="4180217">.</span><span class="ident" id="4180218">Mul</span><span class="op" id="4180221">(</span><span class="ident" id="4180222">z</span><span class="op" id="4180223">,</span>&nbsp;<span class="ident" id="4180225">w</span><span class="op" id="4180226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4180229">u1</span><span class="op" id="4180231">.</span><span class="ident" id="4180232">Mod</span><span class="op" id="4180235">(</span><span class="ident" id="4180236">u1</span><span class="op" id="4180238">,</span>&nbsp;<span class="ident" id="4180240">pub</span><span class="op" id="4180243">.</span><span class="ident" id="4180244">Q</span><span class="op" id="4180245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4180248">u2</span>&nbsp;<span class="op" id="4180251">:=</span>&nbsp;<span class="ident" id="4180254">w</span><span class="op" id="4180255">.</span><span class="ident" id="4180256">Mul</span><span class="op" id="4180259">(</span><span class="ident" id="4180260">r</span><span class="op" id="4180261">,</span>&nbsp;<span class="ident" id="4180263">w</span><span class="op" id="4180264">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4180267">u2</span><span class="op" id="4180269">.</span><span class="ident" id="4180270">Mod</span><span class="op" id="4180273">(</span><span class="ident" id="4180274">u2</span><span class="op" id="4180276">,</span>&nbsp;<span class="ident" id="4180278">pub</span><span class="op" id="4180281">.</span><span class="ident" id="4180282">Q</span><span class="op" id="4180283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4180286">v</span>&nbsp;<span class="op" id="4180288">:=</span>&nbsp;<span class="ident" id="4180291">u1</span><span class="op" id="4180293">.</span><span class="ident" id="4180294">Exp</span><span class="op" id="4180297">(</span><span class="ident" id="4180298">pub</span><span class="op" id="4180301">.</span><span class="ident" id="4180302">G</span><span class="op" id="4180303">,</span>&nbsp;<span class="ident" id="4180305">u1</span><span class="op" id="4180307">,</span>&nbsp;<span class="ident" id="4180309">pub</span><span class="op" id="4180312">.</span><span class="ident" id="4180313">P</span><span class="op" id="4180314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4180317">u2</span><span class="op" id="4180319">.</span><span class="ident" id="4180320">Exp</span><span class="op" id="4180323">(</span><span class="ident" id="4180324">pub</span><span class="op" id="4180327">.</span><span class="ident" id="4180328">Y</span><span class="op" id="4180329">,</span>&nbsp;<span class="ident" id="4180331">u2</span><span class="op" id="4180333">,</span>&nbsp;<span class="ident" id="4180335">pub</span><span class="op" id="4180338">.</span><span class="ident" id="4180339">P</span><span class="op" id="4180340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4180343">v</span><span class="op" id="4180344">.</span><span class="ident" id="4180345">Mul</span><span class="op" id="4180348">(</span><span class="ident" id="4180349">v</span><span class="op" id="4180350">,</span>&nbsp;<span class="ident" id="4180352">u2</span><span class="op" id="4180354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4180357">v</span><span class="op" id="4180358">.</span><span class="ident" id="4180359">Mod</span><span class="op" id="4180362">(</span><span class="ident" id="4180363">v</span><span class="op" id="4180364">,</span>&nbsp;<span class="ident" id="4180366">pub</span><span class="op" id="4180369">.</span><span class="ident" id="4180370">P</span><span class="op" id="4180371">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4180374">v</span><span class="op" id="4180375">.</span><span class="ident" id="4180376">Mod</span><span class="op" id="4180379">(</span><span class="ident" id="4180380">v</span><span class="op" id="4180381">,</span>&nbsp;<span class="ident" id="4180383">pub</span><span class="op" id="4180386">.</span><span class="ident" id="4180387">Q</span><span class="op" id="4180388">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4180392">return</span>&nbsp;<span class="ident" id="4180399">v</span><span class="op" id="4180400">.</span><span class="ident" id="4180401">Cmp</span><span class="op" id="4180404">(</span><span class="ident" id="4180405">r</span><span class="op" id="4180406">)</span>&nbsp;<span class="op" id="4180408">==</span>&nbsp;<span class="num" id="4180411">0</span><br>
<span class="lineno"></span><span class="op" id="4180413">}</span>
</div>
</body>
</html>
