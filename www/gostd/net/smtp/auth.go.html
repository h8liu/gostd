<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/smtp</h2>
<ul>
<li><a href="/gostd/net/smtp/auth.go.html" class="current">auth.go</a></li>
<li><a href="/gostd/net/smtp/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/smtp/smtp.go.html">smtp.go</a></li>
<li><a href="/gostd/net/smtp/smtp_test.go.html">smtp_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6274695">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6274750">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6274804">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6274855">package</span>&nbsp;<span class="ident" id="6274863">smtp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6274869">import</span>&nbsp;<span class="op" id="6274876">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6274879">&#34;crypto/hmac&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6274894">&#34;crypto/md5&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6274908">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6274918">&#34;fmt&#34;</span><br>
<span class="lineno"></span><span class="op" id="6274924">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6274927">//&nbsp;Auth&nbsp;is&nbsp;implemented&nbsp;by&nbsp;an&nbsp;SMTP&nbsp;authentication&nbsp;mechanism.</span><br>
<span class="lineno">15</span><span class="keyword" id="6274987">type</span>&nbsp;<span class="ident" id="6274992">Auth</span>&nbsp;<span class="keyword" id="6274997">interface</span>&nbsp;<span class="op" id="6275007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6275010">//&nbsp;Start&nbsp;begins&nbsp;an&nbsp;authentication&nbsp;with&nbsp;a&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6275060">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;authentication&nbsp;protocol</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6275115">//&nbsp;and&nbsp;optionally&nbsp;data&nbsp;to&nbsp;include&nbsp;in&nbsp;the&nbsp;initial&nbsp;AUTH&nbsp;message</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6275178">//&nbsp;sent&nbsp;to&nbsp;the&nbsp;server.&nbsp;It&nbsp;can&nbsp;return&nbsp;proto&nbsp;==&nbsp;&#34;&#34;&nbsp;to&nbsp;indicate</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6275240">//&nbsp;that&nbsp;the&nbsp;authentication&nbsp;should&nbsp;be&nbsp;skipped.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6275287">//&nbsp;If&nbsp;it&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;error,&nbsp;the&nbsp;SMTP&nbsp;client&nbsp;aborts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6275345">//&nbsp;the&nbsp;authentication&nbsp;attempt&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6275403">Start</span><span class="op" id="6275408">(</span><span class="ident" id="6275409">server</span>&nbsp;<span class="op" id="6275416">*</span><span class="ident" id="6275417">ServerInfo</span><span class="op" id="6275427">)</span>&nbsp;<span class="op" id="6275429">(</span><span class="ident" id="6275430">proto</span>&nbsp;<span class="builtintype" id="6275436">string</span><span class="op" id="6275442">,</span>&nbsp;<span class="ident" id="6275444">toServer</span>&nbsp;<span class="op" id="6275453">[</span><span class="op" id="6275454">]</span><span class="builtintype" id="6275455">byte</span><span class="op" id="6275459">,</span>&nbsp;<span class="ident" id="6275461">err</span>&nbsp;<span class="builtintype" id="6275465">error</span><span class="op" id="6275470">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6275474">//&nbsp;Next&nbsp;continues&nbsp;the&nbsp;authentication.&nbsp;The&nbsp;server&nbsp;has&nbsp;just&nbsp;sent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6275538">//&nbsp;the&nbsp;fromServer&nbsp;data.&nbsp;If&nbsp;more&nbsp;is&nbsp;true,&nbsp;the&nbsp;server&nbsp;expects&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6275601">//&nbsp;response,&nbsp;which&nbsp;Next&nbsp;should&nbsp;return&nbsp;as&nbsp;toServer;&nbsp;otherwise</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6275663">//&nbsp;Next&nbsp;should&nbsp;return&nbsp;toServer&nbsp;==&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6275703">//&nbsp;If&nbsp;Next&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;error,&nbsp;the&nbsp;SMTP&nbsp;client&nbsp;aborts</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6275763">//&nbsp;the&nbsp;authentication&nbsp;attempt&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6275821">Next</span><span class="op" id="6275825">(</span><span class="ident" id="6275826">fromServer</span>&nbsp;<span class="op" id="6275837">[</span><span class="op" id="6275838">]</span><span class="builtintype" id="6275839">byte</span><span class="op" id="6275843">,</span>&nbsp;<span class="ident" id="6275845">more</span>&nbsp;<span class="builtintype" id="6275850">bool</span><span class="op" id="6275854">)</span>&nbsp;<span class="op" id="6275856">(</span><span class="ident" id="6275857">toServer</span>&nbsp;<span class="op" id="6275866">[</span><span class="op" id="6275867">]</span><span class="builtintype" id="6275868">byte</span><span class="op" id="6275872">,</span>&nbsp;<span class="ident" id="6275874">err</span>&nbsp;<span class="builtintype" id="6275878">error</span><span class="op" id="6275883">)</span><br>
<span class="lineno"></span><span class="op" id="6275885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6275888">//&nbsp;ServerInfo&nbsp;records&nbsp;information&nbsp;about&nbsp;an&nbsp;SMTP&nbsp;server.</span><br>
<span class="lineno">35</span><span class="keyword" id="6275944">type</span>&nbsp;<span class="ident" id="6275949">ServerInfo</span>&nbsp;<span class="keyword" id="6275960">struct</span>&nbsp;<span class="op" id="6275967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6275970">Name</span>&nbsp;<span class="builtintype" id="6275975">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6275984">//&nbsp;SMTP&nbsp;server&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6276005">TLS</span>&nbsp;&nbsp;<span class="builtintype" id="6276010">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6276019">//&nbsp;using&nbsp;TLS,&nbsp;with&nbsp;valid&nbsp;certificate&nbsp;for&nbsp;Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6276066">Auth</span>&nbsp;<span class="op" id="6276071">[</span><span class="op" id="6276072">]</span><span class="builtintype" id="6276073">string</span>&nbsp;<span class="comment" id="6276080">//&nbsp;advertised&nbsp;authentication&nbsp;mechanisms</span><br>
<span class="lineno"></span><span class="op" id="6276120">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="6276123">type</span>&nbsp;<span class="ident" id="6276128">plainAuth</span>&nbsp;<span class="keyword" id="6276138">struct</span>&nbsp;<span class="op" id="6276145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6276148">identity</span><span class="op" id="6276156">,</span>&nbsp;<span class="ident" id="6276158">username</span><span class="op" id="6276166">,</span>&nbsp;<span class="ident" id="6276168">password</span>&nbsp;<span class="builtintype" id="6276177">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6276185">host</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6276214">string</span><br>
<span class="lineno"></span><span class="op" id="6276221">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="6276224">//&nbsp;PlainAuth&nbsp;returns&nbsp;an&nbsp;Auth&nbsp;that&nbsp;implements&nbsp;the&nbsp;PLAIN&nbsp;authentication</span><br>
<span class="lineno"></span><span class="comment" id="6276294">//&nbsp;mechanism&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4616.</span><br>
<span class="lineno"></span><span class="comment" id="6276331">//&nbsp;The&nbsp;returned&nbsp;Auth&nbsp;uses&nbsp;the&nbsp;given&nbsp;username&nbsp;and&nbsp;password&nbsp;to&nbsp;authenticate</span><br>
<span class="lineno"></span><span class="comment" id="6276405">//&nbsp;on&nbsp;TLS&nbsp;connections&nbsp;to&nbsp;host&nbsp;and&nbsp;act&nbsp;as&nbsp;identity.&nbsp;Usually&nbsp;identity&nbsp;will&nbsp;be</span><br>
<span class="lineno">50</span><span class="comment" id="6276481">//&nbsp;left&nbsp;blank&nbsp;to&nbsp;act&nbsp;as&nbsp;username.</span><br>
<span class="lineno"></span><span class="keyword" id="6276515">func</span>&nbsp;<span class="ident" id="6276520">PlainAuth</span><span class="op" id="6276529">(</span><span class="ident" id="6276530">identity</span><span class="op" id="6276538">,</span>&nbsp;<span class="ident" id="6276540">username</span><span class="op" id="6276548">,</span>&nbsp;<span class="ident" id="6276550">password</span><span class="op" id="6276558">,</span>&nbsp;<span class="ident" id="6276560">host</span>&nbsp;<span class="builtintype" id="6276565">string</span><span class="op" id="6276571">)</span>&nbsp;<span class="ident" id="6276573">Auth</span>&nbsp;<span class="op" id="6276578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6276581">return</span>&nbsp;<span class="op" id="6276588">&amp;</span><span class="ident" id="6276589">plainAuth</span><span class="op" id="6276598">{</span><span class="ident" id="6276599">identity</span><span class="op" id="6276607">,</span>&nbsp;<span class="ident" id="6276609">username</span><span class="op" id="6276617">,</span>&nbsp;<span class="ident" id="6276619">password</span><span class="op" id="6276627">,</span>&nbsp;<span class="ident" id="6276629">host</span><span class="op" id="6276633">}</span><br>
<span class="lineno"></span><span class="op" id="6276635">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="6276638">func</span>&nbsp;<span class="op" id="6276643">(</span><span class="ident" id="6276644">a</span>&nbsp;<span class="op" id="6276646">*</span><span class="ident" id="6276647">plainAuth</span><span class="op" id="6276656">)</span>&nbsp;<span class="ident" id="6276658">Start</span><span class="op" id="6276663">(</span><span class="ident" id="6276664">server</span>&nbsp;<span class="op" id="6276671">*</span><span class="ident" id="6276672">ServerInfo</span><span class="op" id="6276682">)</span>&nbsp;<span class="op" id="6276684">(</span><span class="builtintype" id="6276685">string</span><span class="op" id="6276691">,</span>&nbsp;<span class="op" id="6276693">[</span><span class="op" id="6276694">]</span><span class="builtintype" id="6276695">byte</span><span class="op" id="6276699">,</span>&nbsp;<span class="builtintype" id="6276701">error</span><span class="op" id="6276706">)</span>&nbsp;<span class="op" id="6276708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6276711">if</span>&nbsp;<span class="op" id="6276714">!</span><span class="ident" id="6276715">server</span><span class="op" id="6276721">.</span><span class="ident" id="6276722">TLS</span>&nbsp;<span class="op" id="6276726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6276730">advertised</span>&nbsp;<span class="op" id="6276741">:=</span>&nbsp;<span class="builtintype" id="6276744">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6276752">for</span>&nbsp;<span class="ident" id="6276756">_</span><span class="op" id="6276757">,</span>&nbsp;<span class="ident" id="6276759">mechanism</span>&nbsp;<span class="op" id="6276769">:=</span>&nbsp;<span class="keyword" id="6276772">range</span>&nbsp;<span class="ident" id="6276778">server</span><span class="op" id="6276784">.</span><span class="ident" id="6276785">Auth</span>&nbsp;<span class="op" id="6276790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6276795">if</span>&nbsp;<span class="ident" id="6276798">mechanism</span>&nbsp;<span class="op" id="6276808">==</span>&nbsp;<span class="string" id="6276811">&#34;PLAIN&#34;</span>&nbsp;<span class="op" id="6276819">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6276825">advertised</span>&nbsp;<span class="op" id="6276836">=</span>&nbsp;<span class="builtintype" id="6276838">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6276847">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6276856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6276860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6276864">if</span>&nbsp;<span class="op" id="6276867">!</span><span class="ident" id="6276868">advertised</span>&nbsp;<span class="op" id="6276879">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6276884">return</span>&nbsp;<span class="string" id="6276891">&#34;&#34;</span><span class="op" id="6276893">,</span>&nbsp;<span class="ident" id="6276895">nil</span><span class="op" id="6276898">,</span>&nbsp;<span class="ident" id="6276900">errors</span><span class="op" id="6276906">.</span><span class="ident" id="6276907">New</span><span class="op" id="6276910">(</span><span class="string" id="6276911">&#34;unencrypted&nbsp;connection&#34;</span><span class="op" id="6276935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6276939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6276942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6276945">if</span>&nbsp;<span class="ident" id="6276948">server</span><span class="op" id="6276954">.</span><span class="ident" id="6276955">Name</span>&nbsp;<span class="op" id="6276960">!=</span>&nbsp;<span class="ident" id="6276963">a</span><span class="op" id="6276964">.</span><span class="ident" id="6276965">host</span>&nbsp;<span class="op" id="6276970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6276974">return</span>&nbsp;<span class="string" id="6276981">&#34;&#34;</span><span class="op" id="6276983">,</span>&nbsp;<span class="ident" id="6276985">nil</span><span class="op" id="6276988">,</span>&nbsp;<span class="ident" id="6276990">errors</span><span class="op" id="6276996">.</span><span class="ident" id="6276997">New</span><span class="op" id="6277000">(</span><span class="string" id="6277001">&#34;wrong&nbsp;host&nbsp;name&#34;</span><span class="op" id="6277018">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6277021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6277024">resp</span>&nbsp;<span class="op" id="6277029">:=</span>&nbsp;<span class="op" id="6277032">[</span><span class="op" id="6277033">]</span><span class="builtintype" id="6277034">byte</span><span class="op" id="6277038">(</span><span class="ident" id="6277039">a</span><span class="op" id="6277040">.</span><span class="ident" id="6277041">identity</span>&nbsp;<span class="op" id="6277050">+</span>&nbsp;<span class="string" id="6277052">&#34;\x00&#34;</span>&nbsp;<span class="op" id="6277059">+</span>&nbsp;<span class="ident" id="6277061">a</span><span class="op" id="6277062">.</span><span class="ident" id="6277063">username</span>&nbsp;<span class="op" id="6277072">+</span>&nbsp;<span class="string" id="6277074">&#34;\x00&#34;</span>&nbsp;<span class="op" id="6277081">+</span>&nbsp;<span class="ident" id="6277083">a</span><span class="op" id="6277084">.</span><span class="ident" id="6277085">password</span><span class="op" id="6277093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6277096">return</span>&nbsp;<span class="string" id="6277103">&#34;PLAIN&#34;</span><span class="op" id="6277110">,</span>&nbsp;<span class="ident" id="6277112">resp</span><span class="op" id="6277116">,</span>&nbsp;<span class="ident" id="6277118">nil</span><br>
<span class="lineno"></span><span class="op" id="6277122">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="6277125">func</span>&nbsp;<span class="op" id="6277130">(</span><span class="ident" id="6277131">a</span>&nbsp;<span class="op" id="6277133">*</span><span class="ident" id="6277134">plainAuth</span><span class="op" id="6277143">)</span>&nbsp;<span class="ident" id="6277145">Next</span><span class="op" id="6277149">(</span><span class="ident" id="6277150">fromServer</span>&nbsp;<span class="op" id="6277161">[</span><span class="op" id="6277162">]</span><span class="builtintype" id="6277163">byte</span><span class="op" id="6277167">,</span>&nbsp;<span class="ident" id="6277169">more</span>&nbsp;<span class="builtintype" id="6277174">bool</span><span class="op" id="6277178">)</span>&nbsp;<span class="op" id="6277180">(</span><span class="op" id="6277181">[</span><span class="op" id="6277182">]</span><span class="builtintype" id="6277183">byte</span><span class="op" id="6277187">,</span>&nbsp;<span class="builtintype" id="6277189">error</span><span class="op" id="6277194">)</span>&nbsp;<span class="op" id="6277196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6277199">if</span>&nbsp;<span class="ident" id="6277202">more</span>&nbsp;<span class="op" id="6277207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6277211">//&nbsp;We&#39;ve&nbsp;already&nbsp;sent&nbsp;everything.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6277247">return</span>&nbsp;<span class="ident" id="6277254">nil</span><span class="op" id="6277257">,</span>&nbsp;<span class="ident" id="6277259">errors</span><span class="op" id="6277265">.</span><span class="ident" id="6277266">New</span><span class="op" id="6277269">(</span><span class="string" id="6277270">&#34;unexpected&nbsp;server&nbsp;challenge&#34;</span><span class="op" id="6277299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6277302">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6277305">return</span>&nbsp;<span class="ident" id="6277312">nil</span><span class="op" id="6277315">,</span>&nbsp;<span class="ident" id="6277317">nil</span><br>
<span class="lineno"></span><span class="op" id="6277321">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6277324">type</span>&nbsp;<span class="ident" id="6277329">cramMD5Auth</span>&nbsp;<span class="keyword" id="6277341">struct</span>&nbsp;<span class="op" id="6277348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6277351">username</span><span class="op" id="6277359">,</span>&nbsp;<span class="ident" id="6277361">secret</span>&nbsp;<span class="builtintype" id="6277368">string</span><br>
<span class="lineno">85</span><span class="op" id="6277375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6277378">//&nbsp;CRAMMD5Auth&nbsp;returns&nbsp;an&nbsp;Auth&nbsp;that&nbsp;implements&nbsp;the&nbsp;CRAM-MD5&nbsp;authentication</span><br>
<span class="lineno"></span><span class="comment" id="6277453">//&nbsp;mechanism&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;2195.</span><br>
<span class="lineno"></span><span class="comment" id="6277490">//&nbsp;The&nbsp;returned&nbsp;Auth&nbsp;uses&nbsp;the&nbsp;given&nbsp;username&nbsp;and&nbsp;secret&nbsp;to&nbsp;authenticate</span><br>
<span class="lineno">90</span><span class="comment" id="6277562">//&nbsp;to&nbsp;the&nbsp;server&nbsp;using&nbsp;the&nbsp;challenge-response&nbsp;mechanism.</span><br>
<span class="lineno"></span><span class="keyword" id="6277619">func</span>&nbsp;<span class="ident" id="6277624">CRAMMD5Auth</span><span class="op" id="6277635">(</span><span class="ident" id="6277636">username</span><span class="op" id="6277644">,</span>&nbsp;<span class="ident" id="6277646">secret</span>&nbsp;<span class="builtintype" id="6277653">string</span><span class="op" id="6277659">)</span>&nbsp;<span class="ident" id="6277661">Auth</span>&nbsp;<span class="op" id="6277666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6277669">return</span>&nbsp;<span class="op" id="6277676">&amp;</span><span class="ident" id="6277677">cramMD5Auth</span><span class="op" id="6277688">{</span><span class="ident" id="6277689">username</span><span class="op" id="6277697">,</span>&nbsp;<span class="ident" id="6277699">secret</span><span class="op" id="6277705">}</span><br>
<span class="lineno"></span><span class="op" id="6277707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="6277710">func</span>&nbsp;<span class="op" id="6277715">(</span><span class="ident" id="6277716">a</span>&nbsp;<span class="op" id="6277718">*</span><span class="ident" id="6277719">cramMD5Auth</span><span class="op" id="6277730">)</span>&nbsp;<span class="ident" id="6277732">Start</span><span class="op" id="6277737">(</span><span class="ident" id="6277738">server</span>&nbsp;<span class="op" id="6277745">*</span><span class="ident" id="6277746">ServerInfo</span><span class="op" id="6277756">)</span>&nbsp;<span class="op" id="6277758">(</span><span class="builtintype" id="6277759">string</span><span class="op" id="6277765">,</span>&nbsp;<span class="op" id="6277767">[</span><span class="op" id="6277768">]</span><span class="builtintype" id="6277769">byte</span><span class="op" id="6277773">,</span>&nbsp;<span class="builtintype" id="6277775">error</span><span class="op" id="6277780">)</span>&nbsp;<span class="op" id="6277782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6277785">return</span>&nbsp;<span class="string" id="6277792">&#34;CRAM-MD5&#34;</span><span class="op" id="6277802">,</span>&nbsp;<span class="ident" id="6277804">nil</span><span class="op" id="6277807">,</span>&nbsp;<span class="ident" id="6277809">nil</span><br>
<span class="lineno"></span><span class="op" id="6277813">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6277816">func</span>&nbsp;<span class="op" id="6277821">(</span><span class="ident" id="6277822">a</span>&nbsp;<span class="op" id="6277824">*</span><span class="ident" id="6277825">cramMD5Auth</span><span class="op" id="6277836">)</span>&nbsp;<span class="ident" id="6277838">Next</span><span class="op" id="6277842">(</span><span class="ident" id="6277843">fromServer</span>&nbsp;<span class="op" id="6277854">[</span><span class="op" id="6277855">]</span><span class="builtintype" id="6277856">byte</span><span class="op" id="6277860">,</span>&nbsp;<span class="ident" id="6277862">more</span>&nbsp;<span class="builtintype" id="6277867">bool</span><span class="op" id="6277871">)</span>&nbsp;<span class="op" id="6277873">(</span><span class="op" id="6277874">[</span><span class="op" id="6277875">]</span><span class="builtintype" id="6277876">byte</span><span class="op" id="6277880">,</span>&nbsp;<span class="builtintype" id="6277882">error</span><span class="op" id="6277887">)</span>&nbsp;<span class="op" id="6277889">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6277892">if</span>&nbsp;<span class="ident" id="6277895">more</span>&nbsp;<span class="op" id="6277900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6277904">d</span>&nbsp;<span class="op" id="6277906">:=</span>&nbsp;<span class="ident" id="6277909">hmac</span><span class="op" id="6277913">.</span><span class="ident" id="6277914">New</span><span class="op" id="6277917">(</span><span class="ident" id="6277918">md5</span><span class="op" id="6277921">.</span><span class="ident" id="6277922">New</span><span class="op" id="6277925">,</span>&nbsp;<span class="op" id="6277927">[</span><span class="op" id="6277928">]</span><span class="builtintype" id="6277929">byte</span><span class="op" id="6277933">(</span><span class="ident" id="6277934">a</span><span class="op" id="6277935">.</span><span class="ident" id="6277936">secret</span><span class="op" id="6277942">)</span><span class="op" id="6277943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6277947">d</span><span class="op" id="6277948">.</span><span class="ident" id="6277949">Write</span><span class="op" id="6277954">(</span><span class="ident" id="6277955">fromServer</span><span class="op" id="6277965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6277969">s</span>&nbsp;<span class="op" id="6277971">:=</span>&nbsp;<span class="builtinfunc" id="6277974">make</span><span class="op" id="6277978">(</span><span class="op" id="6277979">[</span><span class="op" id="6277980">]</span><span class="builtintype" id="6277981">byte</span><span class="op" id="6277985">,</span>&nbsp;<span class="num" id="6277987">0</span><span class="op" id="6277988">,</span>&nbsp;<span class="ident" id="6277990">d</span><span class="op" id="6277991">.</span><span class="ident" id="6277992">Size</span><span class="op" id="6277996">(</span><span class="op" id="6277997">)</span><span class="op" id="6277998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6278002">return</span>&nbsp;<span class="op" id="6278009">[</span><span class="op" id="6278010">]</span><span class="builtintype" id="6278011">byte</span><span class="op" id="6278015">(</span><span class="ident" id="6278016">fmt</span><span class="op" id="6278019">.</span><span class="ident" id="6278020">Sprintf</span><span class="op" id="6278027">(</span><span class="string" id="6278028">&#34;%s&nbsp;%x&#34;</span><span class="op" id="6278035">,</span>&nbsp;<span class="ident" id="6278037">a</span><span class="op" id="6278038">.</span><span class="ident" id="6278039">username</span><span class="op" id="6278047">,</span>&nbsp;<span class="ident" id="6278049">d</span><span class="op" id="6278050">.</span><span class="ident" id="6278051">Sum</span><span class="op" id="6278054">(</span><span class="ident" id="6278055">s</span><span class="op" id="6278056">)</span><span class="op" id="6278057">)</span><span class="op" id="6278058">)</span><span class="op" id="6278059">,</span>&nbsp;<span class="ident" id="6278061">nil</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6278066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6278069">return</span>&nbsp;<span class="ident" id="6278076">nil</span><span class="op" id="6278079">,</span>&nbsp;<span class="ident" id="6278081">nil</span><br>
<span class="lineno"></span><span class="op" id="6278085">}</span>
</div>
</body>
</html>
