<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>text/scanner</h2>
<ul>
<li><a href="/gostd/text/scanner/scanner.go.html" class="current">scanner.go</a></li>
<li><a href="/gostd/text/scanner/scanner_test.go.html">scanner_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5108610">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5108665">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5108719">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5108770">//&nbsp;Package&nbsp;scanner&nbsp;provides&nbsp;a&nbsp;scanner&nbsp;and&nbsp;tokenizer&nbsp;for&nbsp;UTF-8-encoded&nbsp;text.</span><br>
<span class="lineno"></span><span class="comment" id="5108846">//&nbsp;It&nbsp;takes&nbsp;an&nbsp;io.Reader&nbsp;providing&nbsp;the&nbsp;source,&nbsp;which&nbsp;then&nbsp;can&nbsp;be&nbsp;tokenized</span><br>
<span class="lineno"></span><span class="comment" id="5108921">//&nbsp;through&nbsp;repeated&nbsp;calls&nbsp;to&nbsp;the&nbsp;Scan&nbsp;function.&nbsp;&nbsp;For&nbsp;compatibility&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="5108993">//&nbsp;existing&nbsp;tools,&nbsp;the&nbsp;NUL&nbsp;character&nbsp;is&nbsp;not&nbsp;allowed.&nbsp;If&nbsp;the&nbsp;first&nbsp;character</span><br>
<span class="lineno"></span><span class="comment" id="5109069">//&nbsp;in&nbsp;the&nbsp;source&nbsp;is&nbsp;a&nbsp;UTF-8&nbsp;encoded&nbsp;byte&nbsp;order&nbsp;mark&nbsp;(BOM),&nbsp;it&nbsp;is&nbsp;discarded.</span><br>
<span class="lineno">10</span><span class="comment" id="5109145">//</span><br>
<span class="lineno"></span><span class="comment" id="5109148">//&nbsp;By&nbsp;default,&nbsp;a&nbsp;Scanner&nbsp;skips&nbsp;white&nbsp;space&nbsp;and&nbsp;Go&nbsp;comments&nbsp;and&nbsp;recognizes&nbsp;all</span><br>
<span class="lineno"></span><span class="comment" id="5109226">//&nbsp;literals&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;Go&nbsp;language&nbsp;specification.&nbsp;&nbsp;It&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="5109294">//&nbsp;customized&nbsp;to&nbsp;recognize&nbsp;only&nbsp;a&nbsp;subset&nbsp;of&nbsp;those&nbsp;literals&nbsp;and&nbsp;to&nbsp;recognize</span><br>
<span class="lineno"></span><span class="comment" id="5109370">//&nbsp;different&nbsp;identifier&nbsp;and&nbsp;white&nbsp;space&nbsp;characters.</span><br>
<span class="lineno">15</span><span class="comment" id="5109422">//</span><br>
<span class="lineno"></span><span class="comment" id="5109425">//&nbsp;Basic&nbsp;usage&nbsp;pattern:</span><br>
<span class="lineno"></span><span class="comment" id="5109449">//</span><br>
<span class="lineno"></span><span class="comment" id="5109452">//&nbsp;&nbsp;&nbsp;&nbspvar&nbsp;s&nbsp;scanner.Scanner</span><br>
<span class="lineno"></span><span class="comment" id="5109477">//&nbsp;&nbsp;&nbsp;&nbsps.Init(src)</span><br>
<span class="lineno">20</span><span class="comment" id="5109492">//&nbsp;&nbsp;&nbsp;&nbsptok&nbsp;:=&nbsp;s.Scan()</span><br>
<span class="lineno"></span><span class="comment" id="5109511">//&nbsp;&nbsp;&nbsp;&nbspfor&nbsp;tok&nbsp;!=&nbsp;scanner.EOF&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="5109539">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;do&nbsp;something&nbsp;with&nbsp;tok</span><br>
<span class="lineno"></span><span class="comment" id="5109568">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsptok&nbsp;=&nbsp;s.Scan()</span><br>
<span class="lineno"></span><span class="comment" id="5109587">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno">25</span><span class="comment" id="5109592">//</span><br>
<span class="lineno"></span><span class="keyword" id="5109595">package</span>&nbsp;<span class="ident" id="5109603">scanner</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5109612">import</span>&nbsp;<span class="op" id="5109619">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5109622">&#34;bytes&#34;</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5109631">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5109638">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5109644">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5109650">&#34;unicode&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5109661">&#34;unicode/utf8&#34;</span><br>
<span class="lineno">35</span><span class="op" id="5109676">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5109679">//&nbsp;A&nbsp;source&nbsp;position&nbsp;is&nbsp;represented&nbsp;by&nbsp;a&nbsp;Position&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5109736">//&nbsp;A&nbsp;position&nbsp;is&nbsp;valid&nbsp;if&nbsp;Line&nbsp;&gt;&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="5109772">type</span>&nbsp;<span class="ident" id="5109777">Position</span>&nbsp;<span class="keyword" id="5109786">struct</span>&nbsp;<span class="op" id="5109793">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5109796">Filename</span>&nbsp;<span class="builtintype" id="5109805">string</span>&nbsp;<span class="comment" id="5109812">//&nbsp;filename,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5109833">Offset</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5109842">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5109849">//&nbsp;byte&nbsp;offset,&nbsp;starting&nbsp;at&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5109880">Line</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5109889">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5109896">//&nbsp;line&nbsp;number,&nbsp;starting&nbsp;at&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5109927">Column</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5109936">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5109943">//&nbsp;column&nbsp;number,&nbsp;starting&nbsp;at&nbsp;1&nbsp;(character&nbsp;count&nbsp;per&nbsp;line)</span><br>
<span class="lineno"></span><span class="op" id="5110002">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="5110005">//&nbsp;IsValid&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;position&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="5110055">func</span>&nbsp;<span class="op" id="5110060">(</span><span class="ident" id="5110061">pos</span>&nbsp;<span class="op" id="5110065">*</span><span class="ident" id="5110066">Position</span><span class="op" id="5110074">)</span>&nbsp;<span class="ident" id="5110076">IsValid</span><span class="op" id="5110083">(</span><span class="op" id="5110084">)</span>&nbsp;<span class="builtintype" id="5110086">bool</span>&nbsp;<span class="op" id="5110091">{</span>&nbsp;<span class="keyword" id="5110093">return</span>&nbsp;<span class="ident" id="5110100">pos</span><span class="op" id="5110103">.</span><span class="ident" id="5110104">Line</span>&nbsp;<span class="op" id="5110109">&gt;</span>&nbsp;<span class="num" id="5110111">0</span>&nbsp;<span class="op" id="5110113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5110116">func</span>&nbsp;<span class="op" id="5110121">(</span><span class="ident" id="5110122">pos</span>&nbsp;<span class="ident" id="5110126">Position</span><span class="op" id="5110134">)</span>&nbsp;<span class="ident" id="5110136">String</span><span class="op" id="5110142">(</span><span class="op" id="5110143">)</span>&nbsp;<span class="builtintype" id="5110145">string</span>&nbsp;<span class="op" id="5110152">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5110155">s</span>&nbsp;<span class="op" id="5110157">:=</span>&nbsp;<span class="ident" id="5110160">pos</span><span class="op" id="5110163">.</span><span class="ident" id="5110164">Filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5110174">if</span>&nbsp;<span class="ident" id="5110177">pos</span><span class="op" id="5110180">.</span><span class="ident" id="5110181">IsValid</span><span class="op" id="5110188">(</span><span class="op" id="5110189">)</span>&nbsp;<span class="op" id="5110191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5110195">if</span>&nbsp;<span class="ident" id="5110198">s</span>&nbsp;<span class="op" id="5110200">!=</span>&nbsp;<span class="string" id="5110203">&#34;&#34;</span>&nbsp;<span class="op" id="5110206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5110211">s</span>&nbsp;<span class="op" id="5110213">+=</span>&nbsp;<span class="string" id="5110216">&#34;:&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5110222">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5110226">s</span>&nbsp;<span class="op" id="5110228">+=</span>&nbsp;<span class="ident" id="5110231">fmt</span><span class="op" id="5110234">.</span><span class="ident" id="5110235">Sprintf</span><span class="op" id="5110242">(</span><span class="string" id="5110243">&#34;%d:%d&#34;</span><span class="op" id="5110250">,</span>&nbsp;<span class="ident" id="5110252">pos</span><span class="op" id="5110255">.</span><span class="ident" id="5110256">Line</span><span class="op" id="5110260">,</span>&nbsp;<span class="ident" id="5110262">pos</span><span class="op" id="5110265">.</span><span class="ident" id="5110266">Column</span><span class="op" id="5110272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5110275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5110278">if</span>&nbsp;<span class="ident" id="5110281">s</span>&nbsp;<span class="op" id="5110283">==</span>&nbsp;<span class="string" id="5110286">&#34;&#34;</span>&nbsp;<span class="op" id="5110289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5110293">s</span>&nbsp;<span class="op" id="5110295">=</span>&nbsp;<span class="string" id="5110297">&#34;???&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5110304">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5110307">return</span>&nbsp;<span class="ident" id="5110314">s</span><br>
<span class="lineno"></span><span class="op" id="5110316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5110319">//&nbsp;Predefined&nbsp;mode&nbsp;bits&nbsp;to&nbsp;control&nbsp;recognition&nbsp;of&nbsp;tokens.&nbsp;For&nbsp;instance,</span><br>
<span class="lineno"></span><span class="comment" id="5110391">//&nbsp;to&nbsp;configure&nbsp;a&nbsp;Scanner&nbsp;such&nbsp;that&nbsp;it&nbsp;only&nbsp;recognizes&nbsp;(Go)&nbsp;identifiers,</span><br>
<span class="lineno">65</span><span class="comment" id="5110464">//&nbsp;integers,&nbsp;and&nbsp;skips&nbsp;comments,&nbsp;set&nbsp;the&nbsp;Scanner&#39;s&nbsp;Mode&nbsp;field&nbsp;to:</span><br>
<span class="lineno"></span><span class="comment" id="5110530">//</span><br>
<span class="lineno"></span><span class="comment" id="5110533">//&nbsp;&nbsp;&nbsp;&nbspScanIdents&nbsp;|&nbsp;ScanInts&nbsp;|&nbsp;SkipComments</span><br>
<span class="lineno"></span><span class="comment" id="5110573">//</span><br>
<span class="lineno"></span><span class="comment" id="5110576">//&nbsp;With&nbsp;the&nbsp;exceptions&nbsp;of&nbsp;comments,&nbsp;which&nbsp;are&nbsp;skipped&nbsp;if&nbsp;SkipComments&nbsp;is</span><br>
<span class="lineno">70</span><span class="comment" id="5110649">//&nbsp;set,&nbsp;unrecognized&nbsp;tokens&nbsp;are&nbsp;not&nbsp;ignored.&nbsp;Instead,&nbsp;the&nbsp;scanner&nbsp;simply</span><br>
<span class="lineno"></span><span class="comment" id="5110722">//&nbsp;returns&nbsp;the&nbsp;respective&nbsp;individual&nbsp;characters&nbsp;(or&nbsp;possibly&nbsp;sub-tokens).</span><br>
<span class="lineno"></span><span class="comment" id="5110796">//&nbsp;For&nbsp;instance,&nbsp;if&nbsp;the&nbsp;mode&nbsp;is&nbsp;ScanIdents&nbsp;(not&nbsp;ScanStrings),&nbsp;the&nbsp;string</span><br>
<span class="lineno"></span><span class="comment" id="5110869">//&nbsp;&#34;foo&#34;&nbsp;is&nbsp;scanned&nbsp;as&nbsp;the&nbsp;token&nbsp;sequence&nbsp;&#39;&#34;&#39;&nbsp;Ident&nbsp;&#39;&#34;&#39;.</span><br>
<span class="lineno"></span><span class="comment" id="5110926">//</span><br>
<span class="lineno">75</span><span class="keyword" id="5110929">const</span>&nbsp;<span class="op" id="5110935">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5110938">ScanIdents</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5110953">=</span>&nbsp;<span class="num" id="5110955">1</span>&nbsp;<span class="op" id="5110957">&lt;&lt;</span>&nbsp;<span class="op" id="5110960">-</span><span class="ident" id="5110961">Ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5110968">ScanInts</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5110983">=</span>&nbsp;<span class="num" id="5110985">1</span>&nbsp;<span class="op" id="5110987">&lt;&lt;</span>&nbsp;<span class="op" id="5110990">-</span><span class="ident" id="5110991">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5110996">ScanFloats</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5111011">=</span>&nbsp;<span class="num" id="5111013">1</span>&nbsp;<span class="op" id="5111015">&lt;&lt;</span>&nbsp;<span class="op" id="5111018">-</span><span class="ident" id="5111019">Float</span>&nbsp;<span class="comment" id="5111025">//&nbsp;includes&nbsp;Ints</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5111043">ScanChars</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5111058">=</span>&nbsp;<span class="num" id="5111060">1</span>&nbsp;<span class="op" id="5111062">&lt;&lt;</span>&nbsp;<span class="op" id="5111065">-</span><span class="ident" id="5111066">Char</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5111072">ScanStrings</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5111087">=</span>&nbsp;<span class="num" id="5111089">1</span>&nbsp;<span class="op" id="5111091">&lt;&lt;</span>&nbsp;<span class="op" id="5111094">-</span><span class="ident" id="5111095">String</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5111103">ScanRawStrings</span>&nbsp;<span class="op" id="5111118">=</span>&nbsp;<span class="num" id="5111120">1</span>&nbsp;<span class="op" id="5111122">&lt;&lt;</span>&nbsp;<span class="op" id="5111125">-</span><span class="ident" id="5111126">RawString</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5111137">ScanComments</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5111152">=</span>&nbsp;<span class="num" id="5111154">1</span>&nbsp;<span class="op" id="5111156">&lt;&lt;</span>&nbsp;<span class="op" id="5111159">-</span><span class="ident" id="5111160">Comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5111169">SkipComments</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5111184">=</span>&nbsp;<span class="num" id="5111186">1</span>&nbsp;<span class="op" id="5111188">&lt;&lt;</span>&nbsp;<span class="op" id="5111191">-</span><span class="ident" id="5111192">skipComment</span>&nbsp;<span class="comment" id="5111204">//&nbsp;if&nbsp;set&nbsp;with&nbsp;ScanComments,&nbsp;comments&nbsp;become&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5111262">GoTokens</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5111277">=</span>&nbsp;<span class="ident" id="5111279">ScanIdents</span>&nbsp;<span class="op" id="5111290">|</span>&nbsp;<span class="ident" id="5111292">ScanFloats</span>&nbsp;<span class="op" id="5111303">|</span>&nbsp;<span class="ident" id="5111305">ScanChars</span>&nbsp;<span class="op" id="5111315">|</span>&nbsp;<span class="ident" id="5111317">ScanStrings</span>&nbsp;<span class="op" id="5111329">|</span>&nbsp;<span class="ident" id="5111331">ScanRawStrings</span>&nbsp;<span class="op" id="5111346">|</span>&nbsp;<span class="ident" id="5111348">ScanComments</span>&nbsp;<span class="op" id="5111361">|</span>&nbsp;<span class="ident" id="5111363">SkipComments</span><br>
<span class="lineno">85</span><span class="op" id="5111376">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5111379">//&nbsp;The&nbsp;result&nbsp;of&nbsp;Scan&nbsp;is&nbsp;one&nbsp;of&nbsp;the&nbsp;following&nbsp;tokens&nbsp;or&nbsp;a&nbsp;Unicode&nbsp;character.</span><br>
<span class="lineno"></span><span class="keyword" id="5111456">const</span>&nbsp;<span class="op" id="5111462">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5111465">EOF</span>&nbsp;<span class="op" id="5111469">=</span>&nbsp;<span class="op" id="5111471">-</span><span class="op" id="5111472">(</span><span class="ident" id="5111473">iota</span>&nbsp;<span class="op" id="5111478">+</span>&nbsp;<span class="num" id="5111480">1</span><span class="op" id="5111481">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5111484">Ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5111491">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5111496">Float</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5111503">Char</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5111509">String</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5111517">RawString</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5111528">Comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5111537">skipComment</span><br>
<span class="lineno"></span><span class="op" id="5111549">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="5111552">var</span>&nbsp;<span class="ident" id="5111556">tokenString</span>&nbsp;<span class="op" id="5111568">=</span>&nbsp;<span class="keyword" id="5111570">map</span><span class="op" id="5111573">[</span><span class="builtintype" id="5111574">rune</span><span class="op" id="5111578">]</span><span class="builtintype" id="5111579">string</span><span class="op" id="5111585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5111588">EOF</span><span class="op" id="5111591">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5111599">&#34;EOF&#34;</span><span class="op" id="5111604">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5111607">Ident</span><span class="op" id="5111612">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5111618">&#34;Ident&#34;</span><span class="op" id="5111625">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5111628">Int</span><span class="op" id="5111631">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5111639">&#34;Int&#34;</span><span class="op" id="5111644">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5111647">Float</span><span class="op" id="5111652">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5111658">&#34;Float&#34;</span><span class="op" id="5111665">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5111668">Char</span><span class="op" id="5111672">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5111679">&#34;Char&#34;</span><span class="op" id="5111685">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5111688">String</span><span class="op" id="5111694">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5111699">&#34;String&#34;</span><span class="op" id="5111707">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5111710">RawString</span><span class="op" id="5111719">:</span>&nbsp;<span class="string" id="5111721">&#34;RawString&#34;</span><span class="op" id="5111732">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5111735">Comment</span><span class="op" id="5111742">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="5111746">&#34;Comment&#34;</span><span class="op" id="5111755">,</span><br>
<span class="lineno"></span><span class="op" id="5111757">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="5111760">//&nbsp;TokenString&nbsp;returns&nbsp;a&nbsp;printable&nbsp;string&nbsp;for&nbsp;a&nbsp;token&nbsp;or&nbsp;Unicode&nbsp;character.</span><br>
<span class="lineno"></span><span class="keyword" id="5111836">func</span>&nbsp;<span class="ident" id="5111841">TokenString</span><span class="op" id="5111852">(</span><span class="ident" id="5111853">tok</span>&nbsp;<span class="builtintype" id="5111857">rune</span><span class="op" id="5111861">)</span>&nbsp;<span class="builtintype" id="5111863">string</span>&nbsp;<span class="op" id="5111870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5111873">if</span>&nbsp;<span class="ident" id="5111876">s</span><span class="op" id="5111877">,</span>&nbsp;<span class="ident" id="5111879">found</span>&nbsp;<span class="op" id="5111885">:=</span>&nbsp;<span class="ident" id="5111888">tokenString</span><span class="op" id="5111899">[</span><span class="ident" id="5111900">tok</span><span class="op" id="5111903">]</span><span class="op" id="5111904">;</span>&nbsp;<span class="ident" id="5111906">found</span>&nbsp;<span class="op" id="5111912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5111916">return</span>&nbsp;<span class="ident" id="5111923">s</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5111926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5111929">return</span>&nbsp;<span class="ident" id="5111936">fmt</span><span class="op" id="5111939">.</span><span class="ident" id="5111940">Sprintf</span><span class="op" id="5111947">(</span><span class="string" id="5111948">&#34;%q&#34;</span><span class="op" id="5111952">,</span>&nbsp;<span class="builtintype" id="5111954">string</span><span class="op" id="5111960">(</span><span class="ident" id="5111961">tok</span><span class="op" id="5111964">)</span><span class="op" id="5111965">)</span><br>
<span class="lineno"></span><span class="op" id="5111967">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5111970">//&nbsp;GoWhitespace&nbsp;is&nbsp;the&nbsp;default&nbsp;value&nbsp;for&nbsp;the&nbsp;Scanner&#39;s&nbsp;Whitespace&nbsp;field.</span><br>
<span class="lineno">120</span><span class="comment" id="5112043">//&nbsp;Its&nbsp;value&nbsp;selects&nbsp;Go&#39;s&nbsp;white&nbsp;space&nbsp;characters.</span><br>
<span class="lineno"></span><span class="keyword" id="5112093">const</span>&nbsp;<span class="ident" id="5112099">GoWhitespace</span>&nbsp;<span class="op" id="5112112">=</span>&nbsp;<span class="num" id="5112114">1</span><span class="op" id="5112115">&lt;&lt;</span><span class="string" id="5112117">&#39;\t&#39;</span>&nbsp;<span class="op" id="5112122">|</span>&nbsp;<span class="num" id="5112124">1</span><span class="op" id="5112125">&lt;&lt;</span><span class="string" id="5112127">&#39;\n&#39;</span>&nbsp;<span class="op" id="5112132">|</span>&nbsp;<span class="num" id="5112134">1</span><span class="op" id="5112135">&lt;&lt;</span><span class="string" id="5112137">&#39;\r&#39;</span>&nbsp;<span class="op" id="5112142">|</span>&nbsp;<span class="num" id="5112144">1</span><span class="op" id="5112145">&lt;&lt;</span><span class="string" id="5112147">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5112152">const</span>&nbsp;<span class="ident" id="5112158">bufLen</span>&nbsp;<span class="op" id="5112165">=</span>&nbsp;<span class="num" id="5112167">1024</span>&nbsp;<span class="comment" id="5112172">//&nbsp;at&nbsp;least&nbsp;utf8.UTFMax</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="5112197">//&nbsp;A&nbsp;Scanner&nbsp;implements&nbsp;reading&nbsp;of&nbsp;Unicode&nbsp;characters&nbsp;and&nbsp;tokens&nbsp;from&nbsp;an&nbsp;io.Reader.</span><br>
<span class="lineno"></span><span class="keyword" id="5112281">type</span>&nbsp;<span class="ident" id="5112286">Scanner</span>&nbsp;<span class="keyword" id="5112294">struct</span>&nbsp;<span class="op" id="5112301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5112304">//&nbsp;Input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5112314">src</span>&nbsp;<span class="ident" id="5112318">io</span><span class="op" id="5112320">.</span><span class="ident" id="5112321">Reader</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5112330">//&nbsp;Source&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5112348">srcBuf</span>&nbsp;<span class="op" id="5112355">[</span><span class="ident" id="5112356">bufLen</span>&nbsp;<span class="op" id="5112363">+</span>&nbsp;<span class="num" id="5112365">1</span><span class="op" id="5112366">]</span><span class="builtintype" id="5112367">byte</span>&nbsp;<span class="comment" id="5112372">//&nbsp;+1&nbsp;for&nbsp;sentinel&nbsp;for&nbsp;common&nbsp;case&nbsp;of&nbsp;s.next()</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5112420">srcPos</span>&nbsp;<span class="builtintype" id="5112427">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5112444">//&nbsp;reading&nbsp;position&nbsp;(srcBuf&nbsp;index)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5112480">srcEnd</span>&nbsp;<span class="builtintype" id="5112487">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5112504">//&nbsp;source&nbsp;end&nbsp;(srcBuf&nbsp;index)</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5112535">//&nbsp;Source&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5112555">srcBufOffset</span>&nbsp;<span class="builtintype" id="5112568">int</span>&nbsp;<span class="comment" id="5112572">//&nbsp;byte&nbsp;offset&nbsp;of&nbsp;srcBuf[0]&nbsp;in&nbsp;source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5112611">line</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5112624">int</span>&nbsp;<span class="comment" id="5112628">//&nbsp;line&nbsp;count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5112643">column</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5112656">int</span>&nbsp;<span class="comment" id="5112660">//&nbsp;character&nbsp;count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5112680">lastLineLen</span>&nbsp;&nbsp;<span class="builtintype" id="5112693">int</span>&nbsp;<span class="comment" id="5112697">//&nbsp;length&nbsp;of&nbsp;last&nbsp;line&nbsp;in&nbsp;characters&nbsp;(for&nbsp;correct&nbsp;column&nbsp;reporting)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5112766">lastCharLen</span>&nbsp;&nbsp;<span class="builtintype" id="5112779">int</span>&nbsp;<span class="comment" id="5112783">//&nbsp;length&nbsp;of&nbsp;last&nbsp;character&nbsp;in&nbsp;bytes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5112822">//&nbsp;Token&nbsp;text&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5112844">//&nbsp;Typically,&nbsp;token&nbsp;text&nbsp;is&nbsp;stored&nbsp;completely&nbsp;in&nbsp;srcBuf,&nbsp;but&nbsp;in&nbsp;general</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5112917">//&nbsp;the&nbsp;token&nbsp;text&#39;s&nbsp;head&nbsp;may&nbsp;be&nbsp;buffered&nbsp;in&nbsp;tokBuf&nbsp;while&nbsp;the&nbsp;token&nbsp;text&#39;s</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5112992">//&nbsp;tail&nbsp;is&nbsp;stored&nbsp;in&nbsp;srcBuf.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5113022">tokBuf</span>&nbsp;<span class="ident" id="5113029">bytes</span><span class="op" id="5113034">.</span><span class="ident" id="5113035">Buffer</span>&nbsp;<span class="comment" id="5113042">//&nbsp;token&nbsp;text&nbsp;head&nbsp;that&nbsp;is&nbsp;not&nbsp;in&nbsp;srcBuf&nbsp;anymore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5113092">tokPos</span>&nbsp;<span class="builtintype" id="5113099">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5113112">//&nbsp;token&nbsp;text&nbsp;tail&nbsp;position&nbsp;(srcBuf&nbsp;index);&nbsp;valid&nbsp;if&nbsp;&gt;=&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5113171">tokEnd</span>&nbsp;<span class="builtintype" id="5113178">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5113191">//&nbsp;token&nbsp;text&nbsp;tail&nbsp;end&nbsp;(srcBuf&nbsp;index)</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5113231">//&nbsp;One&nbsp;character&nbsp;look-ahead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5113260">ch</span>&nbsp;<span class="builtintype" id="5113263">rune</span>&nbsp;<span class="comment" id="5113268">//&nbsp;character&nbsp;before&nbsp;current&nbsp;srcPos</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5113305">//&nbsp;Error&nbsp;is&nbsp;called&nbsp;for&nbsp;each&nbsp;error&nbsp;encountered.&nbsp;If&nbsp;no&nbsp;Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5113365">//&nbsp;function&nbsp;is&nbsp;set,&nbsp;the&nbsp;error&nbsp;is&nbsp;reported&nbsp;to&nbsp;os.Stderr.</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5113422">Error</span>&nbsp;<span class="keyword" id="5113428">func</span><span class="op" id="5113432">(</span><span class="ident" id="5113433">s</span>&nbsp;<span class="op" id="5113435">*</span><span class="ident" id="5113436">Scanner</span><span class="op" id="5113443">,</span>&nbsp;<span class="ident" id="5113445">msg</span>&nbsp;<span class="builtintype" id="5113449">string</span><span class="op" id="5113455">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5113459">//&nbsp;ErrorCount&nbsp;is&nbsp;incremented&nbsp;by&nbsp;one&nbsp;for&nbsp;each&nbsp;error&nbsp;encountered.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5113524">ErrorCount</span>&nbsp;<span class="builtintype" id="5113535">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5113541">//&nbsp;The&nbsp;Mode&nbsp;field&nbsp;controls&nbsp;which&nbsp;tokens&nbsp;are&nbsp;recognized.&nbsp;For&nbsp;instance,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5113612">//&nbsp;to&nbsp;recognize&nbsp;Ints,&nbsp;set&nbsp;the&nbsp;ScanInts&nbsp;bit&nbsp;in&nbsp;Mode.&nbsp;The&nbsp;field&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5113682">//&nbsp;changed&nbsp;at&nbsp;any&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5113707">Mode</span>&nbsp;<span class="builtintype" id="5113712">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5113719">//&nbsp;The&nbsp;Whitespace&nbsp;field&nbsp;controls&nbsp;which&nbsp;characters&nbsp;are&nbsp;recognized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5113785">//&nbsp;as&nbsp;white&nbsp;space.&nbsp;To&nbsp;recognize&nbsp;a&nbsp;character&nbsp;ch&nbsp;&lt;=&nbsp;&#39;&nbsp;&#39;&nbsp;as&nbsp;white&nbsp;space,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5113856">//&nbsp;set&nbsp;the&nbsp;ch&#39;th&nbsp;bit&nbsp;in&nbsp;Whitespace&nbsp;(the&nbsp;Scanner&#39;s&nbsp;behavior&nbsp;is&nbsp;undefined</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5113929">//&nbsp;for&nbsp;values&nbsp;ch&nbsp;&gt;&nbsp;&#39;&nbsp;&#39;).&nbsp;The&nbsp;field&nbsp;may&nbsp;be&nbsp;changed&nbsp;at&nbsp;any&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5113993">Whitespace</span>&nbsp;<span class="ident" id="5114004">uint64</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5114013">//&nbsp;IsIdentRune&nbsp;is&nbsp;a&nbsp;predicate&nbsp;controlling&nbsp;the&nbsp;characters&nbsp;accepted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5114080">//&nbsp;as&nbsp;the&nbsp;ith&nbsp;rune&nbsp;in&nbsp;an&nbsp;identifier.&nbsp;The&nbsp;set&nbsp;of&nbsp;valid&nbsp;characters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5114146">//&nbsp;must&nbsp;not&nbsp;intersect&nbsp;with&nbsp;the&nbsp;set&nbsp;of&nbsp;white&nbsp;space&nbsp;characters.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5114209">//&nbsp;If&nbsp;no&nbsp;IsIdentRune&nbsp;function&nbsp;is&nbsp;set,&nbsp;regular&nbsp;Go&nbsp;identifiers&nbsp;are</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5114275">//&nbsp;accepted&nbsp;instead.&nbsp;The&nbsp;field&nbsp;may&nbsp;be&nbsp;changed&nbsp;at&nbsp;any&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5114335">IsIdentRune</span>&nbsp;<span class="keyword" id="5114347">func</span><span class="op" id="5114351">(</span><span class="ident" id="5114352">ch</span>&nbsp;<span class="builtintype" id="5114355">rune</span><span class="op" id="5114359">,</span>&nbsp;<span class="ident" id="5114361">i</span>&nbsp;<span class="builtintype" id="5114363">int</span><span class="op" id="5114366">)</span>&nbsp;<span class="builtintype" id="5114368">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5114375">//&nbsp;Start&nbsp;position&nbsp;of&nbsp;most&nbsp;recently&nbsp;scanned&nbsp;token;&nbsp;set&nbsp;by&nbsp;Scan.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5114439">//&nbsp;Calling&nbsp;Init&nbsp;or&nbsp;Next&nbsp;invalidates&nbsp;the&nbsp;position&nbsp;(Line&nbsp;==&nbsp;0).</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5114502">//&nbsp;The&nbsp;Filename&nbsp;field&nbsp;is&nbsp;always&nbsp;left&nbsp;untouched&nbsp;by&nbsp;the&nbsp;Scanner.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5114566">//&nbsp;If&nbsp;an&nbsp;error&nbsp;is&nbsp;reported&nbsp;(via&nbsp;Error)&nbsp;and&nbsp;Position&nbsp;is&nbsp;invalid,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5114631">//&nbsp;the&nbsp;scanner&nbsp;is&nbsp;not&nbsp;inside&nbsp;a&nbsp;token.&nbsp;Call&nbsp;Pos&nbsp;to&nbsp;obtain&nbsp;an&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5114698">//&nbsp;position&nbsp;in&nbsp;that&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5114725">Position</span><br>
<span class="lineno">185</span><span class="op" id="5114734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5114737">//&nbsp;Init&nbsp;initializes&nbsp;a&nbsp;Scanner&nbsp;with&nbsp;a&nbsp;new&nbsp;source&nbsp;and&nbsp;returns&nbsp;s.</span><br>
<span class="lineno"></span><span class="comment" id="5114800">//&nbsp;Error&nbsp;is&nbsp;set&nbsp;to&nbsp;nil,&nbsp;ErrorCount&nbsp;is&nbsp;set&nbsp;to&nbsp;0,&nbsp;Mode&nbsp;is&nbsp;set&nbsp;to&nbsp;GoTokens,</span><br>
<span class="lineno"></span><span class="comment" id="5114873">//&nbsp;and&nbsp;Whitespace&nbsp;is&nbsp;set&nbsp;to&nbsp;GoWhitespace.</span><br>
<span class="lineno">190</span><span class="keyword" id="5114915">func</span>&nbsp;<span class="op" id="5114920">(</span><span class="ident" id="5114921">s</span>&nbsp;<span class="op" id="5114923">*</span><span class="ident" id="5114924">Scanner</span><span class="op" id="5114931">)</span>&nbsp;<span class="ident" id="5114933">Init</span><span class="op" id="5114937">(</span><span class="ident" id="5114938">src</span>&nbsp;<span class="ident" id="5114942">io</span><span class="op" id="5114944">.</span><span class="ident" id="5114945">Reader</span><span class="op" id="5114951">)</span>&nbsp;<span class="op" id="5114953">*</span><span class="ident" id="5114954">Scanner</span>&nbsp;<span class="op" id="5114962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5114965">s</span><span class="op" id="5114966">.</span><span class="ident" id="5114967">src</span>&nbsp;<span class="op" id="5114971">=</span>&nbsp;<span class="ident" id="5114973">src</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5114979">//&nbsp;initialize&nbsp;source&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5115008">//&nbsp;(the&nbsp;first&nbsp;call&nbsp;to&nbsp;next()&nbsp;will&nbsp;fill&nbsp;it&nbsp;by&nbsp;calling&nbsp;src.Read)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115072">s</span><span class="op" id="5115073">.</span><span class="ident" id="5115074">srcBuf</span><span class="op" id="5115080">[</span><span class="num" id="5115081">0</span><span class="op" id="5115082">]</span>&nbsp;<span class="op" id="5115084">=</span>&nbsp;<span class="ident" id="5115086">utf8</span><span class="op" id="5115090">.</span><span class="ident" id="5115091">RuneSelf</span>&nbsp;<span class="comment" id="5115100">//&nbsp;sentinel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115113">s</span><span class="op" id="5115114">.</span><span class="ident" id="5115115">srcPos</span>&nbsp;<span class="op" id="5115122">=</span>&nbsp;<span class="num" id="5115124">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115127">s</span><span class="op" id="5115128">.</span><span class="ident" id="5115129">srcEnd</span>&nbsp;<span class="op" id="5115136">=</span>&nbsp;<span class="num" id="5115138">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5115142">//&nbsp;initialize&nbsp;source&nbsp;position</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115173">s</span><span class="op" id="5115174">.</span><span class="ident" id="5115175">srcBufOffset</span>&nbsp;<span class="op" id="5115188">=</span>&nbsp;<span class="num" id="5115190">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115193">s</span><span class="op" id="5115194">.</span><span class="ident" id="5115195">line</span>&nbsp;<span class="op" id="5115200">=</span>&nbsp;<span class="num" id="5115202">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115205">s</span><span class="op" id="5115206">.</span><span class="ident" id="5115207">column</span>&nbsp;<span class="op" id="5115214">=</span>&nbsp;<span class="num" id="5115216">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115219">s</span><span class="op" id="5115220">.</span><span class="ident" id="5115221">lastLineLen</span>&nbsp;<span class="op" id="5115233">=</span>&nbsp;<span class="num" id="5115235">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115238">s</span><span class="op" id="5115239">.</span><span class="ident" id="5115240">lastCharLen</span>&nbsp;<span class="op" id="5115252">=</span>&nbsp;<span class="num" id="5115254">0</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5115258">//&nbsp;initialize&nbsp;token&nbsp;text&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5115291">//&nbsp;(required&nbsp;for&nbsp;first&nbsp;call&nbsp;to&nbsp;next()).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115332">s</span><span class="op" id="5115333">.</span><span class="ident" id="5115334">tokPos</span>&nbsp;<span class="op" id="5115341">=</span>&nbsp;<span class="op" id="5115343">-</span><span class="num" id="5115344">1</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5115348">//&nbsp;initialize&nbsp;one&nbsp;character&nbsp;look-ahead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115388">s</span><span class="op" id="5115389">.</span><span class="ident" id="5115390">ch</span>&nbsp;<span class="op" id="5115393">=</span>&nbsp;<span class="op" id="5115395">-</span><span class="num" id="5115396">1</span>&nbsp;<span class="comment" id="5115398">//&nbsp;no&nbsp;char&nbsp;read&nbsp;yet</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5115420">//&nbsp;initialize&nbsp;public&nbsp;fields</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115449">s</span><span class="op" id="5115450">.</span><span class="ident" id="5115451">Error</span>&nbsp;<span class="op" id="5115457">=</span>&nbsp;<span class="ident" id="5115459">nil</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115464">s</span><span class="op" id="5115465">.</span><span class="ident" id="5115466">ErrorCount</span>&nbsp;<span class="op" id="5115477">=</span>&nbsp;<span class="num" id="5115479">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115482">s</span><span class="op" id="5115483">.</span><span class="ident" id="5115484">Mode</span>&nbsp;<span class="op" id="5115489">=</span>&nbsp;<span class="ident" id="5115491">GoTokens</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115501">s</span><span class="op" id="5115502">.</span><span class="ident" id="5115503">Whitespace</span>&nbsp;<span class="op" id="5115514">=</span>&nbsp;<span class="ident" id="5115516">GoWhitespace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115530">s</span><span class="op" id="5115531">.</span><span class="ident" id="5115532">Line</span>&nbsp;<span class="op" id="5115537">=</span>&nbsp;<span class="num" id="5115539">0</span>&nbsp;<span class="comment" id="5115541">//&nbsp;invalidate&nbsp;token&nbsp;position</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5115572">return</span>&nbsp;<span class="ident" id="5115579">s</span><br>
<span class="lineno"></span><span class="op" id="5115581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5115584">//&nbsp;next&nbsp;reads&nbsp;and&nbsp;returns&nbsp;the&nbsp;next&nbsp;Unicode&nbsp;character.&nbsp;It&nbsp;is&nbsp;designed&nbsp;such</span><br>
<span class="lineno"></span><span class="comment" id="5115658">//&nbsp;that&nbsp;only&nbsp;a&nbsp;minimal&nbsp;amount&nbsp;of&nbsp;work&nbsp;needs&nbsp;to&nbsp;be&nbsp;done&nbsp;in&nbsp;the&nbsp;common&nbsp;ASCII</span><br>
<span class="lineno">225</span><span class="comment" id="5115733">//&nbsp;case&nbsp;(one&nbsp;test&nbsp;to&nbsp;check&nbsp;for&nbsp;both&nbsp;ASCII&nbsp;and&nbsp;end-of-buffer,&nbsp;and&nbsp;one&nbsp;test</span><br>
<span class="lineno"></span><span class="comment" id="5115807">//&nbsp;to&nbsp;check&nbsp;for&nbsp;newlines).</span><br>
<span class="lineno"></span><span class="keyword" id="5115834">func</span>&nbsp;<span class="op" id="5115839">(</span><span class="ident" id="5115840">s</span>&nbsp;<span class="op" id="5115842">*</span><span class="ident" id="5115843">Scanner</span><span class="op" id="5115850">)</span>&nbsp;<span class="ident" id="5115852">next</span><span class="op" id="5115856">(</span><span class="op" id="5115857">)</span>&nbsp;<span class="builtintype" id="5115859">rune</span>&nbsp;<span class="op" id="5115864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115867">ch</span><span class="op" id="5115869">,</span>&nbsp;<span class="ident" id="5115871">width</span>&nbsp;<span class="op" id="5115877">:=</span>&nbsp;<span class="builtintype" id="5115880">rune</span><span class="op" id="5115884">(</span><span class="ident" id="5115885">s</span><span class="op" id="5115886">.</span><span class="ident" id="5115887">srcBuf</span><span class="op" id="5115893">[</span><span class="ident" id="5115894">s</span><span class="op" id="5115895">.</span><span class="ident" id="5115896">srcPos</span><span class="op" id="5115902">]</span><span class="op" id="5115903">)</span><span class="op" id="5115904">,</span>&nbsp;<span class="num" id="5115906">1</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5115910">if</span>&nbsp;<span class="ident" id="5115913">ch</span>&nbsp;<span class="op" id="5115916">&gt;=</span>&nbsp;<span class="ident" id="5115919">utf8</span><span class="op" id="5115923">.</span><span class="ident" id="5115924">RuneSelf</span>&nbsp;<span class="op" id="5115933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5115937">//&nbsp;uncommon&nbsp;case:&nbsp;not&nbsp;ASCII&nbsp;or&nbsp;not&nbsp;enough&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5115987">for</span>&nbsp;<span class="ident" id="5115991">s</span><span class="op" id="5115992">.</span><span class="ident" id="5115993">srcPos</span><span class="op" id="5115999">+</span><span class="ident" id="5116000">utf8</span><span class="op" id="5116004">.</span><span class="ident" id="5116005">UTFMax</span>&nbsp;<span class="op" id="5116012">&gt;</span>&nbsp;<span class="ident" id="5116014">s</span><span class="op" id="5116015">.</span><span class="ident" id="5116016">srcEnd</span>&nbsp;<span class="op" id="5116023">&amp;&amp;</span>&nbsp;<span class="op" id="5116026">!</span><span class="ident" id="5116027">utf8</span><span class="op" id="5116031">.</span><span class="ident" id="5116032">FullRune</span><span class="op" id="5116040">(</span><span class="ident" id="5116041">s</span><span class="op" id="5116042">.</span><span class="ident" id="5116043">srcBuf</span><span class="op" id="5116049">[</span><span class="ident" id="5116050">s</span><span class="op" id="5116051">.</span><span class="ident" id="5116052">srcPos</span><span class="op" id="5116058">:</span><span class="ident" id="5116059">s</span><span class="op" id="5116060">.</span><span class="ident" id="5116061">srcEnd</span><span class="op" id="5116067">]</span><span class="op" id="5116068">)</span>&nbsp;<span class="op" id="5116070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5116075">//&nbsp;not&nbsp;enough&nbsp;bytes:&nbsp;read&nbsp;some&nbsp;more,&nbsp;but&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5116125">//&nbsp;save&nbsp;away&nbsp;token&nbsp;text&nbsp;if&nbsp;any</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5116159">if</span>&nbsp;<span class="ident" id="5116162">s</span><span class="op" id="5116163">.</span><span class="ident" id="5116164">tokPos</span>&nbsp;<span class="op" id="5116171">&gt;=</span>&nbsp;<span class="num" id="5116174">0</span>&nbsp;<span class="op" id="5116176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5116182">s</span><span class="op" id="5116183">.</span><span class="ident" id="5116184">tokBuf</span><span class="op" id="5116190">.</span><span class="ident" id="5116191">Write</span><span class="op" id="5116196">(</span><span class="ident" id="5116197">s</span><span class="op" id="5116198">.</span><span class="ident" id="5116199">srcBuf</span><span class="op" id="5116205">[</span><span class="ident" id="5116206">s</span><span class="op" id="5116207">.</span><span class="ident" id="5116208">tokPos</span><span class="op" id="5116214">:</span><span class="ident" id="5116215">s</span><span class="op" id="5116216">.</span><span class="ident" id="5116217">srcPos</span><span class="op" id="5116223">]</span><span class="op" id="5116224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5116230">s</span><span class="op" id="5116231">.</span><span class="ident" id="5116232">tokPos</span>&nbsp;<span class="op" id="5116239">=</span>&nbsp;<span class="num" id="5116241">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5116247">//&nbsp;s.tokEnd&nbsp;is&nbsp;set&nbsp;by&nbsp;Scan()</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5116279">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5116284">//&nbsp;move&nbsp;unread&nbsp;bytes&nbsp;to&nbsp;beginning&nbsp;of&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5116331">copy</span><span class="op" id="5116335">(</span><span class="ident" id="5116336">s</span><span class="op" id="5116337">.</span><span class="ident" id="5116338">srcBuf</span><span class="op" id="5116344">[</span><span class="num" id="5116345">0</span><span class="op" id="5116346">:</span><span class="op" id="5116347">]</span><span class="op" id="5116348">,</span>&nbsp;<span class="ident" id="5116350">s</span><span class="op" id="5116351">.</span><span class="ident" id="5116352">srcBuf</span><span class="op" id="5116358">[</span><span class="ident" id="5116359">s</span><span class="op" id="5116360">.</span><span class="ident" id="5116361">srcPos</span><span class="op" id="5116367">:</span><span class="ident" id="5116368">s</span><span class="op" id="5116369">.</span><span class="ident" id="5116370">srcEnd</span><span class="op" id="5116376">]</span><span class="op" id="5116377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5116382">s</span><span class="op" id="5116383">.</span><span class="ident" id="5116384">srcBufOffset</span>&nbsp;<span class="op" id="5116397">+=</span>&nbsp;<span class="ident" id="5116400">s</span><span class="op" id="5116401">.</span><span class="ident" id="5116402">srcPos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5116412">//&nbsp;read&nbsp;more&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5116434">//&nbsp;(an&nbsp;io.Reader&nbsp;must&nbsp;return&nbsp;io.EOF&nbsp;when&nbsp;it&nbsp;reaches</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5116489">//&nbsp;the&nbsp;end&nbsp;of&nbsp;what&nbsp;it&nbsp;is&nbsp;reading&nbsp;-&nbsp;simply&nbsp;returning</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5116544">//&nbsp;n&nbsp;==&nbsp;0&nbsp;will&nbsp;make&nbsp;this&nbsp;loop&nbsp;retry&nbsp;forever;&nbsp;but&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5116600">//&nbsp;error&nbsp;is&nbsp;in&nbsp;the&nbsp;reader&nbsp;implementation&nbsp;in&nbsp;that&nbsp;case)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5116658">i</span>&nbsp;<span class="op" id="5116660">:=</span>&nbsp;<span class="ident" id="5116663">s</span><span class="op" id="5116664">.</span><span class="ident" id="5116665">srcEnd</span>&nbsp;<span class="op" id="5116672">-</span>&nbsp;<span class="ident" id="5116674">s</span><span class="op" id="5116675">.</span><span class="ident" id="5116676">srcPos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5116686">n</span><span class="op" id="5116687">,</span>&nbsp;<span class="ident" id="5116689">err</span>&nbsp;<span class="op" id="5116693">:=</span>&nbsp;<span class="ident" id="5116696">s</span><span class="op" id="5116697">.</span><span class="ident" id="5116698">src</span><span class="op" id="5116701">.</span><span class="ident" id="5116702">Read</span><span class="op" id="5116706">(</span><span class="ident" id="5116707">s</span><span class="op" id="5116708">.</span><span class="ident" id="5116709">srcBuf</span><span class="op" id="5116715">[</span><span class="ident" id="5116716">i</span><span class="op" id="5116717">:</span><span class="ident" id="5116718">bufLen</span><span class="op" id="5116724">]</span><span class="op" id="5116725">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5116730">s</span><span class="op" id="5116731">.</span><span class="ident" id="5116732">srcPos</span>&nbsp;<span class="op" id="5116739">=</span>&nbsp;<span class="num" id="5116741">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5116746">s</span><span class="op" id="5116747">.</span><span class="ident" id="5116748">srcEnd</span>&nbsp;<span class="op" id="5116755">=</span>&nbsp;<span class="ident" id="5116757">i</span>&nbsp;<span class="op" id="5116759">+</span>&nbsp;<span class="ident" id="5116761">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5116766">s</span><span class="op" id="5116767">.</span><span class="ident" id="5116768">srcBuf</span><span class="op" id="5116774">[</span><span class="ident" id="5116775">s</span><span class="op" id="5116776">.</span><span class="ident" id="5116777">srcEnd</span><span class="op" id="5116783">]</span>&nbsp;<span class="op" id="5116785">=</span>&nbsp;<span class="ident" id="5116787">utf8</span><span class="op" id="5116791">.</span><span class="ident" id="5116792">RuneSelf</span>&nbsp;<span class="comment" id="5116801">//&nbsp;sentinel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5116816">if</span>&nbsp;<span class="ident" id="5116819">err</span>&nbsp;<span class="op" id="5116823">!=</span>&nbsp;<span class="ident" id="5116826">nil</span>&nbsp;<span class="op" id="5116830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5116836">if</span>&nbsp;<span class="ident" id="5116839">err</span>&nbsp;<span class="op" id="5116843">!=</span>&nbsp;<span class="ident" id="5116846">io</span><span class="op" id="5116848">.</span><span class="ident" id="5116849">EOF</span>&nbsp;<span class="op" id="5116853">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5116860">s</span><span class="op" id="5116861">.</span><span class="builtintype" id="5116862">error</span><span class="op" id="5116867">(</span><span class="ident" id="5116868">err</span><span class="op" id="5116871">.</span><span class="ident" id="5116872">Error</span><span class="op" id="5116877">(</span><span class="op" id="5116878">)</span><span class="op" id="5116879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5116885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5116891">if</span>&nbsp;<span class="ident" id="5116894">s</span><span class="op" id="5116895">.</span><span class="ident" id="5116896">srcEnd</span>&nbsp;<span class="op" id="5116903">==</span>&nbsp;<span class="num" id="5116906">0</span>&nbsp;<span class="op" id="5116908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5116915">if</span>&nbsp;<span class="ident" id="5116918">s</span><span class="op" id="5116919">.</span><span class="ident" id="5116920">lastCharLen</span>&nbsp;<span class="op" id="5116932">&gt;</span>&nbsp;<span class="num" id="5116934">0</span>&nbsp;<span class="op" id="5116936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5116944">//&nbsp;previous&nbsp;character&nbsp;was&nbsp;not&nbsp;EOF</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5116984">s</span><span class="op" id="5116985">.</span><span class="ident" id="5116986">column</span><span class="op" id="5116992">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5117000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5117007">s</span><span class="op" id="5117008">.</span><span class="ident" id="5117009">lastCharLen</span>&nbsp;<span class="op" id="5117021">=</span>&nbsp;<span class="num" id="5117023">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117030">return</span>&nbsp;<span class="ident" id="5117037">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5117045">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5117051">//&nbsp;If&nbsp;err&nbsp;==&nbsp;EOF,&nbsp;we&nbsp;won&#39;t&nbsp;be&nbsp;getting&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5117098">//&nbsp;bytes;&nbsp;break&nbsp;to&nbsp;avoid&nbsp;infinite&nbsp;loop.&nbsp;If</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5117145">//&nbsp;err&nbsp;is&nbsp;something&nbsp;else,&nbsp;we&nbsp;don&#39;t&nbsp;know&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5117192">//&nbsp;we&nbsp;can&nbsp;get&nbsp;more&nbsp;bytes;&nbsp;thus&nbsp;also&nbsp;break.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117239">break</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5117248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5117252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5117256">//&nbsp;at&nbsp;least&nbsp;one&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5117279">ch</span>&nbsp;<span class="op" id="5117282">=</span>&nbsp;<span class="builtintype" id="5117284">rune</span><span class="op" id="5117288">(</span><span class="ident" id="5117289">s</span><span class="op" id="5117290">.</span><span class="ident" id="5117291">srcBuf</span><span class="op" id="5117297">[</span><span class="ident" id="5117298">s</span><span class="op" id="5117299">.</span><span class="ident" id="5117300">srcPos</span><span class="op" id="5117306">]</span><span class="op" id="5117307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117311">if</span>&nbsp;<span class="ident" id="5117314">ch</span>&nbsp;<span class="op" id="5117317">&gt;=</span>&nbsp;<span class="ident" id="5117320">utf8</span><span class="op" id="5117324">.</span><span class="ident" id="5117325">RuneSelf</span>&nbsp;<span class="op" id="5117334">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5117339">//&nbsp;uncommon&nbsp;case:&nbsp;not&nbsp;ASCII</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5117370">ch</span><span class="op" id="5117372">,</span>&nbsp;<span class="ident" id="5117374">width</span>&nbsp;<span class="op" id="5117380">=</span>&nbsp;<span class="ident" id="5117382">utf8</span><span class="op" id="5117386">.</span><span class="ident" id="5117387">DecodeRune</span><span class="op" id="5117397">(</span><span class="ident" id="5117398">s</span><span class="op" id="5117399">.</span><span class="ident" id="5117400">srcBuf</span><span class="op" id="5117406">[</span><span class="ident" id="5117407">s</span><span class="op" id="5117408">.</span><span class="ident" id="5117409">srcPos</span><span class="op" id="5117415">:</span><span class="ident" id="5117416">s</span><span class="op" id="5117417">.</span><span class="ident" id="5117418">srcEnd</span><span class="op" id="5117424">]</span><span class="op" id="5117425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117430">if</span>&nbsp;<span class="ident" id="5117433">ch</span>&nbsp;<span class="op" id="5117436">==</span>&nbsp;<span class="ident" id="5117439">utf8</span><span class="op" id="5117443">.</span><span class="ident" id="5117444">RuneError</span>&nbsp;<span class="op" id="5117454">&amp;&amp;</span>&nbsp;<span class="ident" id="5117457">width</span>&nbsp;<span class="op" id="5117463">==</span>&nbsp;<span class="num" id="5117466">1</span>&nbsp;<span class="op" id="5117468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5117474">//&nbsp;advance&nbsp;for&nbsp;correct&nbsp;error&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5117516">s</span><span class="op" id="5117517">.</span><span class="ident" id="5117518">srcPos</span>&nbsp;<span class="op" id="5117525">+=</span>&nbsp;<span class="ident" id="5117528">width</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5117538">s</span><span class="op" id="5117539">.</span><span class="ident" id="5117540">lastCharLen</span>&nbsp;<span class="op" id="5117552">=</span>&nbsp;<span class="ident" id="5117554">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5117564">s</span><span class="op" id="5117565">.</span><span class="ident" id="5117566">column</span><span class="op" id="5117572">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5117579">s</span><span class="op" id="5117580">.</span><span class="builtintype" id="5117581">error</span><span class="op" id="5117586">(</span><span class="string" id="5117587">&#34;illegal&nbsp;UTF-8&nbsp;encoding&#34;</span><span class="op" id="5117611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117617">return</span>&nbsp;<span class="ident" id="5117624">ch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5117630">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5117634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5117637">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5117641">//&nbsp;advance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5117653">s</span><span class="op" id="5117654">.</span><span class="ident" id="5117655">srcPos</span>&nbsp;<span class="op" id="5117662">+=</span>&nbsp;<span class="ident" id="5117665">width</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5117672">s</span><span class="op" id="5117673">.</span><span class="ident" id="5117674">lastCharLen</span>&nbsp;<span class="op" id="5117686">=</span>&nbsp;<span class="ident" id="5117688">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5117695">s</span><span class="op" id="5117696">.</span><span class="ident" id="5117697">column</span><span class="op" id="5117703">++</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5117708">//&nbsp;special&nbsp;situations</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117731">switch</span>&nbsp;<span class="ident" id="5117738">ch</span>&nbsp;<span class="op" id="5117741">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117744">case</span>&nbsp;<span class="num" id="5117749">0</span><span class="op" id="5117750">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5117754">//&nbsp;for&nbsp;compatibility&nbsp;with&nbsp;other&nbsp;tools</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5117794">s</span><span class="op" id="5117795">.</span><span class="builtintype" id="5117796">error</span><span class="op" id="5117801">(</span><span class="string" id="5117802">&#34;illegal&nbsp;character&nbsp;NUL&#34;</span><span class="op" id="5117825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117828">case</span>&nbsp;<span class="string" id="5117833">&#39;\n&#39;</span><span class="op" id="5117837">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5117841">s</span><span class="op" id="5117842">.</span><span class="ident" id="5117843">line</span><span class="op" id="5117847">++</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5117852">s</span><span class="op" id="5117853">.</span><span class="ident" id="5117854">lastLineLen</span>&nbsp;<span class="op" id="5117866">=</span>&nbsp;<span class="ident" id="5117868">s</span><span class="op" id="5117869">.</span><span class="ident" id="5117870">column</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5117879">s</span><span class="op" id="5117880">.</span><span class="ident" id="5117881">column</span>&nbsp;<span class="op" id="5117888">=</span>&nbsp;<span class="num" id="5117890">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5117893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117897">return</span>&nbsp;<span class="ident" id="5117904">ch</span><br>
<span class="lineno">305</span><span class="op" id="5117907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5117910">//&nbsp;Next&nbsp;reads&nbsp;and&nbsp;returns&nbsp;the&nbsp;next&nbsp;Unicode&nbsp;character.</span><br>
<span class="lineno"></span><span class="comment" id="5117964">//&nbsp;It&nbsp;returns&nbsp;EOF&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;source.&nbsp;It&nbsp;reports</span><br>
<span class="lineno"></span><span class="comment" id="5118019">//&nbsp;a&nbsp;read&nbsp;error&nbsp;by&nbsp;calling&nbsp;s.Error,&nbsp;if&nbsp;not&nbsp;nil;&nbsp;otherwise</span><br>
<span class="lineno">310</span><span class="comment" id="5118077">//&nbsp;it&nbsp;prints&nbsp;an&nbsp;error&nbsp;message&nbsp;to&nbsp;os.Stderr.&nbsp;Next&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="5118135">//&nbsp;update&nbsp;the&nbsp;Scanner&#39;s&nbsp;Position&nbsp;field;&nbsp;use&nbsp;Pos()&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5118188">//&nbsp;get&nbsp;the&nbsp;current&nbsp;position.</span><br>
<span class="lineno"></span><span class="keyword" id="5118217">func</span>&nbsp;<span class="op" id="5118222">(</span><span class="ident" id="5118223">s</span>&nbsp;<span class="op" id="5118225">*</span><span class="ident" id="5118226">Scanner</span><span class="op" id="5118233">)</span>&nbsp;<span class="ident" id="5118235">Next</span><span class="op" id="5118239">(</span><span class="op" id="5118240">)</span>&nbsp;<span class="builtintype" id="5118242">rune</span>&nbsp;<span class="op" id="5118247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5118250">s</span><span class="op" id="5118251">.</span><span class="ident" id="5118252">tokPos</span>&nbsp;<span class="op" id="5118259">=</span>&nbsp;<span class="op" id="5118261">-</span><span class="num" id="5118262">1</span>&nbsp;<span class="comment" id="5118264">//&nbsp;don&#39;t&nbsp;collect&nbsp;token&nbsp;text</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5118293">s</span><span class="op" id="5118294">.</span><span class="ident" id="5118295">Line</span>&nbsp;<span class="op" id="5118300">=</span>&nbsp;<span class="num" id="5118302">0</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5118307">//&nbsp;invalidate&nbsp;token&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5118337">ch</span>&nbsp;<span class="op" id="5118340">:=</span>&nbsp;<span class="ident" id="5118343">s</span><span class="op" id="5118344">.</span><span class="ident" id="5118345">Peek</span><span class="op" id="5118349">(</span><span class="op" id="5118350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5118353">s</span><span class="op" id="5118354">.</span><span class="ident" id="5118355">ch</span>&nbsp;<span class="op" id="5118358">=</span>&nbsp;<span class="ident" id="5118360">s</span><span class="op" id="5118361">.</span><span class="ident" id="5118362">next</span><span class="op" id="5118366">(</span><span class="op" id="5118367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118370">return</span>&nbsp;<span class="ident" id="5118377">ch</span><br>
<span class="lineno"></span><span class="op" id="5118380">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span><span class="comment" id="5118383">//&nbsp;Peek&nbsp;returns&nbsp;the&nbsp;next&nbsp;Unicode&nbsp;character&nbsp;in&nbsp;the&nbsp;source&nbsp;without&nbsp;advancing</span><br>
<span class="lineno"></span><span class="comment" id="5118458">//&nbsp;the&nbsp;scanner.&nbsp;It&nbsp;returns&nbsp;EOF&nbsp;if&nbsp;the&nbsp;scanner&#39;s&nbsp;position&nbsp;is&nbsp;at&nbsp;the&nbsp;last</span><br>
<span class="lineno"></span><span class="comment" id="5118530">//&nbsp;character&nbsp;of&nbsp;the&nbsp;source.</span><br>
<span class="lineno"></span><span class="keyword" id="5118558">func</span>&nbsp;<span class="op" id="5118563">(</span><span class="ident" id="5118564">s</span>&nbsp;<span class="op" id="5118566">*</span><span class="ident" id="5118567">Scanner</span><span class="op" id="5118574">)</span>&nbsp;<span class="ident" id="5118576">Peek</span><span class="op" id="5118580">(</span><span class="op" id="5118581">)</span>&nbsp;<span class="builtintype" id="5118583">rune</span>&nbsp;<span class="op" id="5118588">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118591">if</span>&nbsp;<span class="ident" id="5118594">s</span><span class="op" id="5118595">.</span><span class="ident" id="5118596">ch</span>&nbsp;<span class="op" id="5118599">&lt;</span>&nbsp;<span class="num" id="5118601">0</span>&nbsp;<span class="op" id="5118603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5118607">//&nbsp;this&nbsp;code&nbsp;is&nbsp;only&nbsp;run&nbsp;for&nbsp;the&nbsp;very&nbsp;first&nbsp;character</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5118663">s</span><span class="op" id="5118664">.</span><span class="ident" id="5118665">ch</span>&nbsp;<span class="op" id="5118668">=</span>&nbsp;<span class="ident" id="5118670">s</span><span class="op" id="5118671">.</span><span class="ident" id="5118672">next</span><span class="op" id="5118676">(</span><span class="op" id="5118677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118681">if</span>&nbsp;<span class="ident" id="5118684">s</span><span class="op" id="5118685">.</span><span class="ident" id="5118686">ch</span>&nbsp;<span class="op" id="5118689">==</span>&nbsp;<span class="string" id="5118692">&#39;\uFEFF&#39;</span>&nbsp;<span class="op" id="5118701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5118706">s</span><span class="op" id="5118707">.</span><span class="ident" id="5118708">ch</span>&nbsp;<span class="op" id="5118711">=</span>&nbsp;<span class="ident" id="5118713">s</span><span class="op" id="5118714">.</span><span class="ident" id="5118715">next</span><span class="op" id="5118719">(</span><span class="op" id="5118720">)</span>&nbsp;<span class="comment" id="5118722">//&nbsp;ignore&nbsp;BOM</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5118738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5118741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118744">return</span>&nbsp;<span class="ident" id="5118751">s</span><span class="op" id="5118752">.</span><span class="ident" id="5118753">ch</span><br>
<span class="lineno"></span><span class="op" id="5118756">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="keyword" id="5118759">func</span>&nbsp;<span class="op" id="5118764">(</span><span class="ident" id="5118765">s</span>&nbsp;<span class="op" id="5118767">*</span><span class="ident" id="5118768">Scanner</span><span class="op" id="5118775">)</span>&nbsp;<span class="builtintype" id="5118777">error</span><span class="op" id="5118782">(</span><span class="ident" id="5118783">msg</span>&nbsp;<span class="builtintype" id="5118787">string</span><span class="op" id="5118793">)</span>&nbsp;<span class="op" id="5118795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5118798">s</span><span class="op" id="5118799">.</span><span class="ident" id="5118800">ErrorCount</span><span class="op" id="5118810">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118814">if</span>&nbsp;<span class="ident" id="5118817">s</span><span class="op" id="5118818">.</span><span class="ident" id="5118819">Error</span>&nbsp;<span class="op" id="5118825">!=</span>&nbsp;<span class="ident" id="5118828">nil</span>&nbsp;<span class="op" id="5118832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5118836">s</span><span class="op" id="5118837">.</span><span class="ident" id="5118838">Error</span><span class="op" id="5118843">(</span><span class="ident" id="5118844">s</span><span class="op" id="5118845">,</span>&nbsp;<span class="ident" id="5118847">msg</span><span class="op" id="5118850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118854">return</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5118862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5118865">pos</span>&nbsp;<span class="op" id="5118869">:=</span>&nbsp;<span class="ident" id="5118872">s</span><span class="op" id="5118873">.</span><span class="ident" id="5118874">Position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118884">if</span>&nbsp;<span class="op" id="5118887">!</span><span class="ident" id="5118888">pos</span><span class="op" id="5118891">.</span><span class="ident" id="5118892">IsValid</span><span class="op" id="5118899">(</span><span class="op" id="5118900">)</span>&nbsp;<span class="op" id="5118902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5118906">pos</span>&nbsp;<span class="op" id="5118910">=</span>&nbsp;<span class="ident" id="5118912">s</span><span class="op" id="5118913">.</span><span class="ident" id="5118914">Pos</span><span class="op" id="5118917">(</span><span class="op" id="5118918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5118921">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5118924">fmt</span><span class="op" id="5118927">.</span><span class="ident" id="5118928">Fprintf</span><span class="op" id="5118935">(</span><span class="ident" id="5118936">os</span><span class="op" id="5118938">.</span><span class="ident" id="5118939">Stderr</span><span class="op" id="5118945">,</span>&nbsp;<span class="string" id="5118947">&#34;%s:&nbsp;%s\n&#34;</span><span class="op" id="5118957">,</span>&nbsp;<span class="ident" id="5118959">pos</span><span class="op" id="5118962">,</span>&nbsp;<span class="ident" id="5118964">msg</span><span class="op" id="5118967">)</span><br>
<span class="lineno"></span><span class="op" id="5118969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5118972">func</span>&nbsp;<span class="op" id="5118977">(</span><span class="ident" id="5118978">s</span>&nbsp;<span class="op" id="5118980">*</span><span class="ident" id="5118981">Scanner</span><span class="op" id="5118988">)</span>&nbsp;<span class="ident" id="5118990">isIdentRune</span><span class="op" id="5119001">(</span><span class="ident" id="5119002">ch</span>&nbsp;<span class="builtintype" id="5119005">rune</span><span class="op" id="5119009">,</span>&nbsp;<span class="ident" id="5119011">i</span>&nbsp;<span class="builtintype" id="5119013">int</span><span class="op" id="5119016">)</span>&nbsp;<span class="builtintype" id="5119018">bool</span>&nbsp;<span class="op" id="5119023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119026">if</span>&nbsp;<span class="ident" id="5119029">s</span><span class="op" id="5119030">.</span><span class="ident" id="5119031">IsIdentRune</span>&nbsp;<span class="op" id="5119043">!=</span>&nbsp;<span class="ident" id="5119046">nil</span>&nbsp;<span class="op" id="5119050">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119054">return</span>&nbsp;<span class="ident" id="5119061">s</span><span class="op" id="5119062">.</span><span class="ident" id="5119063">IsIdentRune</span><span class="op" id="5119074">(</span><span class="ident" id="5119075">ch</span><span class="op" id="5119077">,</span>&nbsp;<span class="ident" id="5119079">i</span><span class="op" id="5119080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5119083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119086">return</span>&nbsp;<span class="ident" id="5119093">ch</span>&nbsp;<span class="op" id="5119096">==</span>&nbsp;<span class="string" id="5119099">&#39;_&#39;</span>&nbsp;<span class="op" id="5119103">||</span>&nbsp;<span class="ident" id="5119106">unicode</span><span class="op" id="5119113">.</span><span class="ident" id="5119114">IsLetter</span><span class="op" id="5119122">(</span><span class="ident" id="5119123">ch</span><span class="op" id="5119125">)</span>&nbsp;<span class="op" id="5119127">||</span>&nbsp;<span class="ident" id="5119130">unicode</span><span class="op" id="5119137">.</span><span class="ident" id="5119138">IsDigit</span><span class="op" id="5119145">(</span><span class="ident" id="5119146">ch</span><span class="op" id="5119148">)</span>&nbsp;<span class="op" id="5119150">&amp;&amp;</span>&nbsp;<span class="ident" id="5119153">i</span>&nbsp;<span class="op" id="5119155">&gt;</span>&nbsp;<span class="num" id="5119157">0</span><br>
<span class="lineno"></span><span class="op" id="5119159">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="keyword" id="5119162">func</span>&nbsp;<span class="op" id="5119167">(</span><span class="ident" id="5119168">s</span>&nbsp;<span class="op" id="5119170">*</span><span class="ident" id="5119171">Scanner</span><span class="op" id="5119178">)</span>&nbsp;<span class="ident" id="5119180">scanIdentifier</span><span class="op" id="5119194">(</span><span class="op" id="5119195">)</span>&nbsp;<span class="builtintype" id="5119197">rune</span>&nbsp;<span class="op" id="5119202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5119205">//&nbsp;we&nbsp;know&nbsp;the&nbsp;zero&#39;th&nbsp;rune&nbsp;is&nbsp;OK;&nbsp;start&nbsp;scanning&nbsp;at&nbsp;the&nbsp;next&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5119272">ch</span>&nbsp;<span class="op" id="5119275">:=</span>&nbsp;<span class="ident" id="5119278">s</span><span class="op" id="5119279">.</span><span class="ident" id="5119280">next</span><span class="op" id="5119284">(</span><span class="op" id="5119285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119288">for</span>&nbsp;<span class="ident" id="5119292">i</span>&nbsp;<span class="op" id="5119294">:=</span>&nbsp;<span class="num" id="5119297">1</span><span class="op" id="5119298">;</span>&nbsp;<span class="ident" id="5119300">s</span><span class="op" id="5119301">.</span><span class="ident" id="5119302">isIdentRune</span><span class="op" id="5119313">(</span><span class="ident" id="5119314">ch</span><span class="op" id="5119316">,</span>&nbsp;<span class="ident" id="5119318">i</span><span class="op" id="5119319">)</span><span class="op" id="5119320">;</span>&nbsp;<span class="ident" id="5119322">i</span><span class="op" id="5119323">++</span>&nbsp;<span class="op" id="5119326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5119330">ch</span>&nbsp;<span class="op" id="5119333">=</span>&nbsp;<span class="ident" id="5119335">s</span><span class="op" id="5119336">.</span><span class="ident" id="5119337">next</span><span class="op" id="5119341">(</span><span class="op" id="5119342">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5119345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119348">return</span>&nbsp;<span class="ident" id="5119355">ch</span><br>
<span class="lineno"></span><span class="op" id="5119358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5119361">func</span>&nbsp;<span class="ident" id="5119366">digitVal</span><span class="op" id="5119374">(</span><span class="ident" id="5119375">ch</span>&nbsp;<span class="builtintype" id="5119378">rune</span><span class="op" id="5119382">)</span>&nbsp;<span class="builtintype" id="5119384">int</span>&nbsp;<span class="op" id="5119388">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119391">switch</span>&nbsp;<span class="op" id="5119398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119401">case</span>&nbsp;<span class="string" id="5119406">&#39;0&#39;</span>&nbsp;<span class="op" id="5119410">&lt;=</span>&nbsp;<span class="ident" id="5119413">ch</span>&nbsp;<span class="op" id="5119416">&amp;&amp;</span>&nbsp;<span class="ident" id="5119419">ch</span>&nbsp;<span class="op" id="5119422">&lt;=</span>&nbsp;<span class="string" id="5119425">&#39;9&#39;</span><span class="op" id="5119428">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119432">return</span>&nbsp;<span class="builtintype" id="5119439">int</span><span class="op" id="5119442">(</span><span class="ident" id="5119443">ch</span>&nbsp;<span class="op" id="5119446">-</span>&nbsp;<span class="string" id="5119448">&#39;0&#39;</span><span class="op" id="5119451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119454">case</span>&nbsp;<span class="string" id="5119459">&#39;a&#39;</span>&nbsp;<span class="op" id="5119463">&lt;=</span>&nbsp;<span class="ident" id="5119466">ch</span>&nbsp;<span class="op" id="5119469">&amp;&amp;</span>&nbsp;<span class="ident" id="5119472">ch</span>&nbsp;<span class="op" id="5119475">&lt;=</span>&nbsp;<span class="string" id="5119478">&#39;f&#39;</span><span class="op" id="5119481">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119485">return</span>&nbsp;<span class="builtintype" id="5119492">int</span><span class="op" id="5119495">(</span><span class="ident" id="5119496">ch</span>&nbsp;<span class="op" id="5119499">-</span>&nbsp;<span class="string" id="5119501">&#39;a&#39;</span>&nbsp;<span class="op" id="5119505">+</span>&nbsp;<span class="num" id="5119507">10</span><span class="op" id="5119509">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119512">case</span>&nbsp;<span class="string" id="5119517">&#39;A&#39;</span>&nbsp;<span class="op" id="5119521">&lt;=</span>&nbsp;<span class="ident" id="5119524">ch</span>&nbsp;<span class="op" id="5119527">&amp;&amp;</span>&nbsp;<span class="ident" id="5119530">ch</span>&nbsp;<span class="op" id="5119533">&lt;=</span>&nbsp;<span class="string" id="5119536">&#39;F&#39;</span><span class="op" id="5119539">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119543">return</span>&nbsp;<span class="builtintype" id="5119550">int</span><span class="op" id="5119553">(</span><span class="ident" id="5119554">ch</span>&nbsp;<span class="op" id="5119557">-</span>&nbsp;<span class="string" id="5119559">&#39;A&#39;</span>&nbsp;<span class="op" id="5119563">+</span>&nbsp;<span class="num" id="5119565">10</span><span class="op" id="5119567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5119570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119573">return</span>&nbsp;<span class="num" id="5119580">16</span>&nbsp;<span class="comment" id="5119583">//&nbsp;larger&nbsp;than&nbsp;any&nbsp;legal&nbsp;digit&nbsp;val</span><br>
<span class="lineno"></span><span class="op" id="5119618">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="keyword" id="5119621">func</span>&nbsp;<span class="ident" id="5119626">isDecimal</span><span class="op" id="5119635">(</span><span class="ident" id="5119636">ch</span>&nbsp;<span class="builtintype" id="5119639">rune</span><span class="op" id="5119643">)</span>&nbsp;<span class="builtintype" id="5119645">bool</span>&nbsp;<span class="op" id="5119650">{</span>&nbsp;<span class="keyword" id="5119652">return</span>&nbsp;<span class="string" id="5119659">&#39;0&#39;</span>&nbsp;<span class="op" id="5119663">&lt;=</span>&nbsp;<span class="ident" id="5119666">ch</span>&nbsp;<span class="op" id="5119669">&amp;&amp;</span>&nbsp;<span class="ident" id="5119672">ch</span>&nbsp;<span class="op" id="5119675">&lt;=</span>&nbsp;<span class="string" id="5119678">&#39;9&#39;</span>&nbsp;<span class="op" id="5119682">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5119685">func</span>&nbsp;<span class="op" id="5119690">(</span><span class="ident" id="5119691">s</span>&nbsp;<span class="op" id="5119693">*</span><span class="ident" id="5119694">Scanner</span><span class="op" id="5119701">)</span>&nbsp;<span class="ident" id="5119703">scanMantissa</span><span class="op" id="5119715">(</span><span class="ident" id="5119716">ch</span>&nbsp;<span class="builtintype" id="5119719">rune</span><span class="op" id="5119723">)</span>&nbsp;<span class="builtintype" id="5119725">rune</span>&nbsp;<span class="op" id="5119730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119733">for</span>&nbsp;<span class="ident" id="5119737">isDecimal</span><span class="op" id="5119746">(</span><span class="ident" id="5119747">ch</span><span class="op" id="5119749">)</span>&nbsp;<span class="op" id="5119751">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5119755">ch</span>&nbsp;<span class="op" id="5119758">=</span>&nbsp;<span class="ident" id="5119760">s</span><span class="op" id="5119761">.</span><span class="ident" id="5119762">next</span><span class="op" id="5119766">(</span><span class="op" id="5119767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5119770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119773">return</span>&nbsp;<span class="ident" id="5119780">ch</span><br>
<span class="lineno"></span><span class="op" id="5119783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="keyword" id="5119786">func</span>&nbsp;<span class="op" id="5119791">(</span><span class="ident" id="5119792">s</span>&nbsp;<span class="op" id="5119794">*</span><span class="ident" id="5119795">Scanner</span><span class="op" id="5119802">)</span>&nbsp;<span class="ident" id="5119804">scanFraction</span><span class="op" id="5119816">(</span><span class="ident" id="5119817">ch</span>&nbsp;<span class="builtintype" id="5119820">rune</span><span class="op" id="5119824">)</span>&nbsp;<span class="builtintype" id="5119826">rune</span>&nbsp;<span class="op" id="5119831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119834">if</span>&nbsp;<span class="ident" id="5119837">ch</span>&nbsp;<span class="op" id="5119840">==</span>&nbsp;<span class="string" id="5119843">&#39;.&#39;</span>&nbsp;<span class="op" id="5119847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5119851">ch</span>&nbsp;<span class="op" id="5119854">=</span>&nbsp;<span class="ident" id="5119856">s</span><span class="op" id="5119857">.</span><span class="ident" id="5119858">scanMantissa</span><span class="op" id="5119870">(</span><span class="ident" id="5119871">s</span><span class="op" id="5119872">.</span><span class="ident" id="5119873">next</span><span class="op" id="5119877">(</span><span class="op" id="5119878">)</span><span class="op" id="5119879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5119882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119885">return</span>&nbsp;<span class="ident" id="5119892">ch</span><br>
<span class="lineno">390</span><span class="op" id="5119895">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5119898">func</span>&nbsp;<span class="op" id="5119903">(</span><span class="ident" id="5119904">s</span>&nbsp;<span class="op" id="5119906">*</span><span class="ident" id="5119907">Scanner</span><span class="op" id="5119914">)</span>&nbsp;<span class="ident" id="5119916">scanExponent</span><span class="op" id="5119928">(</span><span class="ident" id="5119929">ch</span>&nbsp;<span class="builtintype" id="5119932">rune</span><span class="op" id="5119936">)</span>&nbsp;<span class="builtintype" id="5119938">rune</span>&nbsp;<span class="op" id="5119943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119946">if</span>&nbsp;<span class="ident" id="5119949">ch</span>&nbsp;<span class="op" id="5119952">==</span>&nbsp;<span class="string" id="5119955">&#39;e&#39;</span>&nbsp;<span class="op" id="5119959">||</span>&nbsp;<span class="ident" id="5119962">ch</span>&nbsp;<span class="op" id="5119965">==</span>&nbsp;<span class="string" id="5119968">&#39;E&#39;</span>&nbsp;<span class="op" id="5119972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5119976">ch</span>&nbsp;<span class="op" id="5119979">=</span>&nbsp;<span class="ident" id="5119981">s</span><span class="op" id="5119982">.</span><span class="ident" id="5119983">next</span><span class="op" id="5119987">(</span><span class="op" id="5119988">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119992">if</span>&nbsp;<span class="ident" id="5119995">ch</span>&nbsp;<span class="op" id="5119998">==</span>&nbsp;<span class="string" id="5120001">&#39;-&#39;</span>&nbsp;<span class="op" id="5120005">||</span>&nbsp;<span class="ident" id="5120008">ch</span>&nbsp;<span class="op" id="5120011">==</span>&nbsp;<span class="string" id="5120014">&#39;+&#39;</span>&nbsp;<span class="op" id="5120018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5120023">ch</span>&nbsp;<span class="op" id="5120026">=</span>&nbsp;<span class="ident" id="5120028">s</span><span class="op" id="5120029">.</span><span class="ident" id="5120030">next</span><span class="op" id="5120034">(</span><span class="op" id="5120035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5120039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5120043">ch</span>&nbsp;<span class="op" id="5120046">=</span>&nbsp;<span class="ident" id="5120048">s</span><span class="op" id="5120049">.</span><span class="ident" id="5120050">scanMantissa</span><span class="op" id="5120062">(</span><span class="ident" id="5120063">ch</span><span class="op" id="5120065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5120068">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5120071">return</span>&nbsp;<span class="ident" id="5120078">ch</span><br>
<span class="lineno"></span><span class="op" id="5120081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5120084">func</span>&nbsp;<span class="op" id="5120089">(</span><span class="ident" id="5120090">s</span>&nbsp;<span class="op" id="5120092">*</span><span class="ident" id="5120093">Scanner</span><span class="op" id="5120100">)</span>&nbsp;<span class="ident" id="5120102">scanNumber</span><span class="op" id="5120112">(</span><span class="ident" id="5120113">ch</span>&nbsp;<span class="builtintype" id="5120116">rune</span><span class="op" id="5120120">)</span>&nbsp;<span class="op" id="5120122">(</span><span class="builtintype" id="5120123">rune</span><span class="op" id="5120127">,</span>&nbsp;<span class="builtintype" id="5120129">rune</span><span class="op" id="5120133">)</span>&nbsp;<span class="op" id="5120135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5120138">//&nbsp;isDecimal(ch)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5120156">if</span>&nbsp;<span class="ident" id="5120159">ch</span>&nbsp;<span class="op" id="5120162">==</span>&nbsp;<span class="string" id="5120165">&#39;0&#39;</span>&nbsp;<span class="op" id="5120169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5120173">//&nbsp;int&nbsp;or&nbsp;float</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5120191">ch</span>&nbsp;<span class="op" id="5120194">=</span>&nbsp;<span class="ident" id="5120196">s</span><span class="op" id="5120197">.</span><span class="ident" id="5120198">next</span><span class="op" id="5120202">(</span><span class="op" id="5120203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5120207">if</span>&nbsp;<span class="ident" id="5120210">ch</span>&nbsp;<span class="op" id="5120213">==</span>&nbsp;<span class="string" id="5120216">&#39;x&#39;</span>&nbsp;<span class="op" id="5120220">||</span>&nbsp;<span class="ident" id="5120223">ch</span>&nbsp;<span class="op" id="5120226">==</span>&nbsp;<span class="string" id="5120229">&#39;X&#39;</span>&nbsp;<span class="op" id="5120233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5120238">//&nbsp;hexadecimal&nbsp;int</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5120260">ch</span>&nbsp;<span class="op" id="5120263">=</span>&nbsp;<span class="ident" id="5120265">s</span><span class="op" id="5120266">.</span><span class="ident" id="5120267">next</span><span class="op" id="5120271">(</span><span class="op" id="5120272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5120277">hasMantissa</span>&nbsp;<span class="op" id="5120289">:=</span>&nbsp;<span class="builtintype" id="5120292">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5120301">for</span>&nbsp;<span class="ident" id="5120305">digitVal</span><span class="op" id="5120313">(</span><span class="ident" id="5120314">ch</span><span class="op" id="5120316">)</span>&nbsp;<span class="op" id="5120318">&lt;</span>&nbsp;<span class="num" id="5120320">16</span>&nbsp;<span class="op" id="5120323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5120329">ch</span>&nbsp;<span class="op" id="5120332">=</span>&nbsp;<span class="ident" id="5120334">s</span><span class="op" id="5120335">.</span><span class="ident" id="5120336">next</span><span class="op" id="5120340">(</span><span class="op" id="5120341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5120347">hasMantissa</span>&nbsp;<span class="op" id="5120359">=</span>&nbsp;<span class="builtintype" id="5120361">true</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5120369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5120374">if</span>&nbsp;<span class="op" id="5120377">!</span><span class="ident" id="5120378">hasMantissa</span>&nbsp;<span class="op" id="5120390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5120396">s</span><span class="op" id="5120397">.</span><span class="builtintype" id="5120398">error</span><span class="op" id="5120403">(</span><span class="string" id="5120404">&#34;illegal&nbsp;hexadecimal&nbsp;number&#34;</span><span class="op" id="5120432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5120437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5120441">}</span>&nbsp;<span class="keyword" id="5120443">else</span>&nbsp;<span class="op" id="5120448">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5120453">//&nbsp;octal&nbsp;int&nbsp;or&nbsp;float</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5120478">has8or9</span>&nbsp;<span class="op" id="5120486">:=</span>&nbsp;<span class="builtintype" id="5120489">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5120498">for</span>&nbsp;<span class="ident" id="5120502">isDecimal</span><span class="op" id="5120511">(</span><span class="ident" id="5120512">ch</span><span class="op" id="5120514">)</span>&nbsp;<span class="op" id="5120516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5120522">if</span>&nbsp;<span class="ident" id="5120525">ch</span>&nbsp;<span class="op" id="5120528">&gt;</span>&nbsp;<span class="string" id="5120530">&#39;7&#39;</span>&nbsp;<span class="op" id="5120534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5120541">has8or9</span>&nbsp;<span class="op" id="5120549">=</span>&nbsp;<span class="builtintype" id="5120551">true</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5120560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5120566">ch</span>&nbsp;<span class="op" id="5120569">=</span>&nbsp;<span class="ident" id="5120571">s</span><span class="op" id="5120572">.</span><span class="ident" id="5120573">next</span><span class="op" id="5120577">(</span><span class="op" id="5120578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5120583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5120588">if</span>&nbsp;<span class="ident" id="5120591">s</span><span class="op" id="5120592">.</span><span class="ident" id="5120593">Mode</span><span class="op" id="5120597">&amp;</span><span class="ident" id="5120598">ScanFloats</span>&nbsp;<span class="op" id="5120609">!=</span>&nbsp;<span class="num" id="5120612">0</span>&nbsp;<span class="op" id="5120614">&amp;&amp;</span>&nbsp;<span class="op" id="5120617">(</span><span class="ident" id="5120618">ch</span>&nbsp;<span class="op" id="5120621">==</span>&nbsp;<span class="string" id="5120624">&#39;.&#39;</span>&nbsp;<span class="op" id="5120628">||</span>&nbsp;<span class="ident" id="5120631">ch</span>&nbsp;<span class="op" id="5120634">==</span>&nbsp;<span class="string" id="5120637">&#39;e&#39;</span>&nbsp;<span class="op" id="5120641">||</span>&nbsp;<span class="ident" id="5120644">ch</span>&nbsp;<span class="op" id="5120647">==</span>&nbsp;<span class="string" id="5120650">&#39;E&#39;</span><span class="op" id="5120653">)</span>&nbsp;<span class="op" id="5120655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5120661">//&nbsp;float</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5120674">ch</span>&nbsp;<span class="op" id="5120677">=</span>&nbsp;<span class="ident" id="5120679">s</span><span class="op" id="5120680">.</span><span class="ident" id="5120681">scanFraction</span><span class="op" id="5120693">(</span><span class="ident" id="5120694">ch</span><span class="op" id="5120696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5120702">ch</span>&nbsp;<span class="op" id="5120705">=</span>&nbsp;<span class="ident" id="5120707">s</span><span class="op" id="5120708">.</span><span class="ident" id="5120709">scanExponent</span><span class="op" id="5120721">(</span><span class="ident" id="5120722">ch</span><span class="op" id="5120724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5120730">return</span>&nbsp;<span class="ident" id="5120737">Float</span><span class="op" id="5120742">,</span>&nbsp;<span class="ident" id="5120744">ch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5120750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5120755">//&nbsp;octal&nbsp;int</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5120771">if</span>&nbsp;<span class="ident" id="5120774">has8or9</span>&nbsp;<span class="op" id="5120782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5120788">s</span><span class="op" id="5120789">.</span><span class="builtintype" id="5120790">error</span><span class="op" id="5120795">(</span><span class="string" id="5120796">&#34;illegal&nbsp;octal&nbsp;number&#34;</span><span class="op" id="5120818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5120823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5120827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5120831">return</span>&nbsp;<span class="ident" id="5120838">Int</span><span class="op" id="5120841">,</span>&nbsp;<span class="ident" id="5120843">ch</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5120847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5120850">//&nbsp;decimal&nbsp;int&nbsp;or&nbsp;float</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5120875">ch</span>&nbsp;<span class="op" id="5120878">=</span>&nbsp;<span class="ident" id="5120880">s</span><span class="op" id="5120881">.</span><span class="ident" id="5120882">scanMantissa</span><span class="op" id="5120894">(</span><span class="ident" id="5120895">ch</span><span class="op" id="5120897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5120900">if</span>&nbsp;<span class="ident" id="5120903">s</span><span class="op" id="5120904">.</span><span class="ident" id="5120905">Mode</span><span class="op" id="5120909">&amp;</span><span class="ident" id="5120910">ScanFloats</span>&nbsp;<span class="op" id="5120921">!=</span>&nbsp;<span class="num" id="5120924">0</span>&nbsp;<span class="op" id="5120926">&amp;&amp;</span>&nbsp;<span class="op" id="5120929">(</span><span class="ident" id="5120930">ch</span>&nbsp;<span class="op" id="5120933">==</span>&nbsp;<span class="string" id="5120936">&#39;.&#39;</span>&nbsp;<span class="op" id="5120940">||</span>&nbsp;<span class="ident" id="5120943">ch</span>&nbsp;<span class="op" id="5120946">==</span>&nbsp;<span class="string" id="5120949">&#39;e&#39;</span>&nbsp;<span class="op" id="5120953">||</span>&nbsp;<span class="ident" id="5120956">ch</span>&nbsp;<span class="op" id="5120959">==</span>&nbsp;<span class="string" id="5120962">&#39;E&#39;</span><span class="op" id="5120965">)</span>&nbsp;<span class="op" id="5120967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5120971">//&nbsp;float</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5120982">ch</span>&nbsp;<span class="op" id="5120985">=</span>&nbsp;<span class="ident" id="5120987">s</span><span class="op" id="5120988">.</span><span class="ident" id="5120989">scanFraction</span><span class="op" id="5121001">(</span><span class="ident" id="5121002">ch</span><span class="op" id="5121004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5121008">ch</span>&nbsp;<span class="op" id="5121011">=</span>&nbsp;<span class="ident" id="5121013">s</span><span class="op" id="5121014">.</span><span class="ident" id="5121015">scanExponent</span><span class="op" id="5121027">(</span><span class="ident" id="5121028">ch</span><span class="op" id="5121030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5121034">return</span>&nbsp;<span class="ident" id="5121041">Float</span><span class="op" id="5121046">,</span>&nbsp;<span class="ident" id="5121048">ch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5121052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5121055">return</span>&nbsp;<span class="ident" id="5121062">Int</span><span class="op" id="5121065">,</span>&nbsp;<span class="ident" id="5121067">ch</span><br>
<span class="lineno">450</span><span class="op" id="5121070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5121073">func</span>&nbsp;<span class="op" id="5121078">(</span><span class="ident" id="5121079">s</span>&nbsp;<span class="op" id="5121081">*</span><span class="ident" id="5121082">Scanner</span><span class="op" id="5121089">)</span>&nbsp;<span class="ident" id="5121091">scanDigits</span><span class="op" id="5121101">(</span><span class="ident" id="5121102">ch</span>&nbsp;<span class="builtintype" id="5121105">rune</span><span class="op" id="5121109">,</span>&nbsp;<span class="ident" id="5121111">base</span><span class="op" id="5121115">,</span>&nbsp;<span class="ident" id="5121117">n</span>&nbsp;<span class="builtintype" id="5121119">int</span><span class="op" id="5121122">)</span>&nbsp;<span class="builtintype" id="5121124">rune</span>&nbsp;<span class="op" id="5121129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5121132">for</span>&nbsp;<span class="ident" id="5121136">n</span>&nbsp;<span class="op" id="5121138">&gt;</span>&nbsp;<span class="num" id="5121140">0</span>&nbsp;<span class="op" id="5121142">&amp;&amp;</span>&nbsp;<span class="ident" id="5121145">digitVal</span><span class="op" id="5121153">(</span><span class="ident" id="5121154">ch</span><span class="op" id="5121156">)</span>&nbsp;<span class="op" id="5121158">&lt;</span>&nbsp;<span class="ident" id="5121160">base</span>&nbsp;<span class="op" id="5121165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5121169">ch</span>&nbsp;<span class="op" id="5121172">=</span>&nbsp;<span class="ident" id="5121174">s</span><span class="op" id="5121175">.</span><span class="ident" id="5121176">next</span><span class="op" id="5121180">(</span><span class="op" id="5121181">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5121185">n</span><span class="op" id="5121186">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5121190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5121193">if</span>&nbsp;<span class="ident" id="5121196">n</span>&nbsp;<span class="op" id="5121198">&gt;</span>&nbsp;<span class="num" id="5121200">0</span>&nbsp;<span class="op" id="5121202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5121206">s</span><span class="op" id="5121207">.</span><span class="builtintype" id="5121208">error</span><span class="op" id="5121213">(</span><span class="string" id="5121214">&#34;illegal&nbsp;char&nbsp;escape&#34;</span><span class="op" id="5121235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5121238">}</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5121241">return</span>&nbsp;<span class="ident" id="5121248">ch</span><br>
<span class="lineno"></span><span class="op" id="5121251">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5121254">func</span>&nbsp;<span class="op" id="5121259">(</span><span class="ident" id="5121260">s</span>&nbsp;<span class="op" id="5121262">*</span><span class="ident" id="5121263">Scanner</span><span class="op" id="5121270">)</span>&nbsp;<span class="ident" id="5121272">scanEscape</span><span class="op" id="5121282">(</span><span class="ident" id="5121283">quote</span>&nbsp;<span class="builtintype" id="5121289">rune</span><span class="op" id="5121293">)</span>&nbsp;<span class="builtintype" id="5121295">rune</span>&nbsp;<span class="op" id="5121300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5121303">ch</span>&nbsp;<span class="op" id="5121306">:=</span>&nbsp;<span class="ident" id="5121309">s</span><span class="op" id="5121310">.</span><span class="ident" id="5121311">next</span><span class="op" id="5121315">(</span><span class="op" id="5121316">)</span>&nbsp;<span class="comment" id="5121318">//&nbsp;read&nbsp;character&nbsp;after&nbsp;&#39;/&#39;</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5121347">switch</span>&nbsp;<span class="ident" id="5121354">ch</span>&nbsp;<span class="op" id="5121357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5121360">case</span>&nbsp;<span class="string" id="5121365">&#39;a&#39;</span><span class="op" id="5121368">,</span>&nbsp;<span class="string" id="5121370">&#39;b&#39;</span><span class="op" id="5121373">,</span>&nbsp;<span class="string" id="5121375">&#39;f&#39;</span><span class="op" id="5121378">,</span>&nbsp;<span class="string" id="5121380">&#39;n&#39;</span><span class="op" id="5121383">,</span>&nbsp;<span class="string" id="5121385">&#39;r&#39;</span><span class="op" id="5121388">,</span>&nbsp;<span class="string" id="5121390">&#39;t&#39;</span><span class="op" id="5121393">,</span>&nbsp;<span class="string" id="5121395">&#39;v&#39;</span><span class="op" id="5121398">,</span>&nbsp;<span class="string" id="5121400">&#39;\\&#39;</span><span class="op" id="5121404">,</span>&nbsp;<span class="ident" id="5121406">quote</span><span class="op" id="5121411">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5121415">//&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5121434">ch</span>&nbsp;<span class="op" id="5121437">=</span>&nbsp;<span class="ident" id="5121439">s</span><span class="op" id="5121440">.</span><span class="ident" id="5121441">next</span><span class="op" id="5121445">(</span><span class="op" id="5121446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5121449">case</span>&nbsp;<span class="string" id="5121454">&#39;0&#39;</span><span class="op" id="5121457">,</span>&nbsp;<span class="string" id="5121459">&#39;1&#39;</span><span class="op" id="5121462">,</span>&nbsp;<span class="string" id="5121464">&#39;2&#39;</span><span class="op" id="5121467">,</span>&nbsp;<span class="string" id="5121469">&#39;3&#39;</span><span class="op" id="5121472">,</span>&nbsp;<span class="string" id="5121474">&#39;4&#39;</span><span class="op" id="5121477">,</span>&nbsp;<span class="string" id="5121479">&#39;5&#39;</span><span class="op" id="5121482">,</span>&nbsp;<span class="string" id="5121484">&#39;6&#39;</span><span class="op" id="5121487">,</span>&nbsp;<span class="string" id="5121489">&#39;7&#39;</span><span class="op" id="5121492">:</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5121496">ch</span>&nbsp;<span class="op" id="5121499">=</span>&nbsp;<span class="ident" id="5121501">s</span><span class="op" id="5121502">.</span><span class="ident" id="5121503">scanDigits</span><span class="op" id="5121513">(</span><span class="ident" id="5121514">ch</span><span class="op" id="5121516">,</span>&nbsp;<span class="num" id="5121518">8</span><span class="op" id="5121519">,</span>&nbsp;<span class="num" id="5121521">3</span><span class="op" id="5121522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5121525">case</span>&nbsp;<span class="string" id="5121530">&#39;x&#39;</span><span class="op" id="5121533">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5121537">ch</span>&nbsp;<span class="op" id="5121540">=</span>&nbsp;<span class="ident" id="5121542">s</span><span class="op" id="5121543">.</span><span class="ident" id="5121544">scanDigits</span><span class="op" id="5121554">(</span><span class="ident" id="5121555">s</span><span class="op" id="5121556">.</span><span class="ident" id="5121557">next</span><span class="op" id="5121561">(</span><span class="op" id="5121562">)</span><span class="op" id="5121563">,</span>&nbsp;<span class="num" id="5121565">16</span><span class="op" id="5121567">,</span>&nbsp;<span class="num" id="5121569">2</span><span class="op" id="5121570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5121573">case</span>&nbsp;<span class="string" id="5121578">&#39;u&#39;</span><span class="op" id="5121581">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5121585">ch</span>&nbsp;<span class="op" id="5121588">=</span>&nbsp;<span class="ident" id="5121590">s</span><span class="op" id="5121591">.</span><span class="ident" id="5121592">scanDigits</span><span class="op" id="5121602">(</span><span class="ident" id="5121603">s</span><span class="op" id="5121604">.</span><span class="ident" id="5121605">next</span><span class="op" id="5121609">(</span><span class="op" id="5121610">)</span><span class="op" id="5121611">,</span>&nbsp;<span class="num" id="5121613">16</span><span class="op" id="5121615">,</span>&nbsp;<span class="num" id="5121617">4</span><span class="op" id="5121618">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5121621">case</span>&nbsp;<span class="string" id="5121626">&#39;U&#39;</span><span class="op" id="5121629">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5121633">ch</span>&nbsp;<span class="op" id="5121636">=</span>&nbsp;<span class="ident" id="5121638">s</span><span class="op" id="5121639">.</span><span class="ident" id="5121640">scanDigits</span><span class="op" id="5121650">(</span><span class="ident" id="5121651">s</span><span class="op" id="5121652">.</span><span class="ident" id="5121653">next</span><span class="op" id="5121657">(</span><span class="op" id="5121658">)</span><span class="op" id="5121659">,</span>&nbsp;<span class="num" id="5121661">16</span><span class="op" id="5121663">,</span>&nbsp;<span class="num" id="5121665">8</span><span class="op" id="5121666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5121669">default</span><span class="op" id="5121676">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5121680">s</span><span class="op" id="5121681">.</span><span class="builtintype" id="5121682">error</span><span class="op" id="5121687">(</span><span class="string" id="5121688">&#34;illegal&nbsp;char&nbsp;escape&#34;</span><span class="op" id="5121709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5121712">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5121715">return</span>&nbsp;<span class="ident" id="5121722">ch</span><br>
<span class="lineno"></span><span class="op" id="5121725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5121728">func</span>&nbsp;<span class="op" id="5121733">(</span><span class="ident" id="5121734">s</span>&nbsp;<span class="op" id="5121736">*</span><span class="ident" id="5121737">Scanner</span><span class="op" id="5121744">)</span>&nbsp;<span class="ident" id="5121746">scanString</span><span class="op" id="5121756">(</span><span class="ident" id="5121757">quote</span>&nbsp;<span class="builtintype" id="5121763">rune</span><span class="op" id="5121767">)</span>&nbsp;<span class="op" id="5121769">(</span><span class="ident" id="5121770">n</span>&nbsp;<span class="builtintype" id="5121772">int</span><span class="op" id="5121775">)</span>&nbsp;<span class="op" id="5121777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5121780">ch</span>&nbsp;<span class="op" id="5121783">:=</span>&nbsp;<span class="ident" id="5121786">s</span><span class="op" id="5121787">.</span><span class="ident" id="5121788">next</span><span class="op" id="5121792">(</span><span class="op" id="5121793">)</span>&nbsp;<span class="comment" id="5121795">//&nbsp;read&nbsp;character&nbsp;after&nbsp;quote</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5121826">for</span>&nbsp;<span class="ident" id="5121830">ch</span>&nbsp;<span class="op" id="5121833">!=</span>&nbsp;<span class="ident" id="5121836">quote</span>&nbsp;<span class="op" id="5121842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5121846">if</span>&nbsp;<span class="ident" id="5121849">ch</span>&nbsp;<span class="op" id="5121852">==</span>&nbsp;<span class="string" id="5121855">&#39;\n&#39;</span>&nbsp;<span class="op" id="5121860">||</span>&nbsp;<span class="ident" id="5121863">ch</span>&nbsp;<span class="op" id="5121866">&lt;</span>&nbsp;<span class="num" id="5121868">0</span>&nbsp;<span class="op" id="5121870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5121875">s</span><span class="op" id="5121876">.</span><span class="builtintype" id="5121877">error</span><span class="op" id="5121882">(</span><span class="string" id="5121883">&#34;literal&nbsp;not&nbsp;terminated&#34;</span><span class="op" id="5121907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5121912">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5121921">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5121925">if</span>&nbsp;<span class="ident" id="5121928">ch</span>&nbsp;<span class="op" id="5121931">==</span>&nbsp;<span class="string" id="5121934">&#39;\\&#39;</span>&nbsp;<span class="op" id="5121939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5121944">ch</span>&nbsp;<span class="op" id="5121947">=</span>&nbsp;<span class="ident" id="5121949">s</span><span class="op" id="5121950">.</span><span class="ident" id="5121951">scanEscape</span><span class="op" id="5121961">(</span><span class="ident" id="5121962">quote</span><span class="op" id="5121967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5121971">}</span>&nbsp;<span class="keyword" id="5121973">else</span>&nbsp;<span class="op" id="5121978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5121983">ch</span>&nbsp;<span class="op" id="5121986">=</span>&nbsp;<span class="ident" id="5121988">s</span><span class="op" id="5121989">.</span><span class="ident" id="5121990">next</span><span class="op" id="5121994">(</span><span class="op" id="5121995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5121999">}</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5122003">n</span><span class="op" id="5122004">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5122008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5122011">return</span><br>
<span class="lineno"></span><span class="op" id="5122018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span><span class="keyword" id="5122021">func</span>&nbsp;<span class="op" id="5122026">(</span><span class="ident" id="5122027">s</span>&nbsp;<span class="op" id="5122029">*</span><span class="ident" id="5122030">Scanner</span><span class="op" id="5122037">)</span>&nbsp;<span class="ident" id="5122039">scanRawString</span><span class="op" id="5122052">(</span><span class="op" id="5122053">)</span>&nbsp;<span class="op" id="5122055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5122058">ch</span>&nbsp;<span class="op" id="5122061">:=</span>&nbsp;<span class="ident" id="5122064">s</span><span class="op" id="5122065">.</span><span class="ident" id="5122066">next</span><span class="op" id="5122070">(</span><span class="op" id="5122071">)</span>&nbsp;<span class="comment" id="5122073">//&nbsp;read&nbsp;character&nbsp;after&nbsp;&#39;`&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5122102">for</span>&nbsp;<span class="ident" id="5122106">ch</span>&nbsp;<span class="op" id="5122109">!=</span>&nbsp;<span class="string" id="5122112">&#39;`&#39;</span>&nbsp;<span class="op" id="5122116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5122120">if</span>&nbsp;<span class="ident" id="5122123">ch</span>&nbsp;<span class="op" id="5122126">&lt;</span>&nbsp;<span class="num" id="5122128">0</span>&nbsp;<span class="op" id="5122130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5122135">s</span><span class="op" id="5122136">.</span><span class="builtintype" id="5122137">error</span><span class="op" id="5122142">(</span><span class="string" id="5122143">&#34;literal&nbsp;not&nbsp;terminated&#34;</span><span class="op" id="5122167">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5122172">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5122181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5122185">ch</span>&nbsp;<span class="op" id="5122188">=</span>&nbsp;<span class="ident" id="5122190">s</span><span class="op" id="5122191">.</span><span class="ident" id="5122192">next</span><span class="op" id="5122196">(</span><span class="op" id="5122197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5122200">}</span><br>
<span class="lineno"></span><span class="op" id="5122202">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span><span class="keyword" id="5122205">func</span>&nbsp;<span class="op" id="5122210">(</span><span class="ident" id="5122211">s</span>&nbsp;<span class="op" id="5122213">*</span><span class="ident" id="5122214">Scanner</span><span class="op" id="5122221">)</span>&nbsp;<span class="ident" id="5122223">scanChar</span><span class="op" id="5122231">(</span><span class="op" id="5122232">)</span>&nbsp;<span class="op" id="5122234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5122237">if</span>&nbsp;<span class="ident" id="5122240">s</span><span class="op" id="5122241">.</span><span class="ident" id="5122242">scanString</span><span class="op" id="5122252">(</span><span class="string" id="5122253">&#39;\&#39;&#39;</span><span class="op" id="5122257">)</span>&nbsp;<span class="op" id="5122259">!=</span>&nbsp;<span class="num" id="5122262">1</span>&nbsp;<span class="op" id="5122264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5122268">s</span><span class="op" id="5122269">.</span><span class="builtintype" id="5122270">error</span><span class="op" id="5122275">(</span><span class="string" id="5122276">&#34;illegal&nbsp;char&nbsp;literal&#34;</span><span class="op" id="5122298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5122301">}</span><br>
<span class="lineno">515</span><span class="op" id="5122303">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5122306">func</span>&nbsp;<span class="op" id="5122311">(</span><span class="ident" id="5122312">s</span>&nbsp;<span class="op" id="5122314">*</span><span class="ident" id="5122315">Scanner</span><span class="op" id="5122322">)</span>&nbsp;<span class="ident" id="5122324">scanComment</span><span class="op" id="5122335">(</span><span class="ident" id="5122336">ch</span>&nbsp;<span class="builtintype" id="5122339">rune</span><span class="op" id="5122343">)</span>&nbsp;<span class="builtintype" id="5122345">rune</span>&nbsp;<span class="op" id="5122350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5122353">//&nbsp;ch&nbsp;==&nbsp;&#39;/&#39;&nbsp;||&nbsp;ch&nbsp;==&nbsp;&#39;*&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5122380">if</span>&nbsp;<span class="ident" id="5122383">ch</span>&nbsp;<span class="op" id="5122386">==</span>&nbsp;<span class="string" id="5122389">&#39;/&#39;</span>&nbsp;<span class="op" id="5122393">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5122397">//&nbsp;line&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5122415">ch</span>&nbsp;<span class="op" id="5122418">=</span>&nbsp;<span class="ident" id="5122420">s</span><span class="op" id="5122421">.</span><span class="ident" id="5122422">next</span><span class="op" id="5122426">(</span><span class="op" id="5122427">)</span>&nbsp;<span class="comment" id="5122429">//&nbsp;read&nbsp;character&nbsp;after&nbsp;&#34;//&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5122460">for</span>&nbsp;<span class="ident" id="5122464">ch</span>&nbsp;<span class="op" id="5122467">!=</span>&nbsp;<span class="string" id="5122470">&#39;\n&#39;</span>&nbsp;<span class="op" id="5122475">&amp;&amp;</span>&nbsp;<span class="ident" id="5122478">ch</span>&nbsp;<span class="op" id="5122481">&gt;=</span>&nbsp;<span class="num" id="5122484">0</span>&nbsp;<span class="op" id="5122486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5122491">ch</span>&nbsp;<span class="op" id="5122494">=</span>&nbsp;<span class="ident" id="5122496">s</span><span class="op" id="5122497">.</span><span class="ident" id="5122498">next</span><span class="op" id="5122502">(</span><span class="op" id="5122503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5122507">}</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5122511">return</span>&nbsp;<span class="ident" id="5122518">ch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5122522">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5122526">//&nbsp;general&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5122546">ch</span>&nbsp;<span class="op" id="5122549">=</span>&nbsp;<span class="ident" id="5122551">s</span><span class="op" id="5122552">.</span><span class="ident" id="5122553">next</span><span class="op" id="5122557">(</span><span class="op" id="5122558">)</span>&nbsp;<span class="comment" id="5122560">//&nbsp;read&nbsp;character&nbsp;after&nbsp;&#34;/*&#34;</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5122590">for</span>&nbsp;<span class="op" id="5122594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5122598">if</span>&nbsp;<span class="ident" id="5122601">ch</span>&nbsp;<span class="op" id="5122604">&lt;</span>&nbsp;<span class="num" id="5122606">0</span>&nbsp;<span class="op" id="5122608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5122613">s</span><span class="op" id="5122614">.</span><span class="builtintype" id="5122615">error</span><span class="op" id="5122620">(</span><span class="string" id="5122621">&#34;comment&nbsp;not&nbsp;terminated&#34;</span><span class="op" id="5122645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5122650">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5122658">}</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5122662">ch0</span>&nbsp;<span class="op" id="5122666">:=</span>&nbsp;<span class="ident" id="5122669">ch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5122674">ch</span>&nbsp;<span class="op" id="5122677">=</span>&nbsp;<span class="ident" id="5122679">s</span><span class="op" id="5122680">.</span><span class="ident" id="5122681">next</span><span class="op" id="5122685">(</span><span class="op" id="5122686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5122690">if</span>&nbsp;<span class="ident" id="5122693">ch0</span>&nbsp;<span class="op" id="5122697">==</span>&nbsp;<span class="string" id="5122700">&#39;*&#39;</span>&nbsp;<span class="op" id="5122704">&amp;&amp;</span>&nbsp;<span class="ident" id="5122707">ch</span>&nbsp;<span class="op" id="5122710">==</span>&nbsp;<span class="string" id="5122713">&#39;/&#39;</span>&nbsp;<span class="op" id="5122717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5122722">ch</span>&nbsp;<span class="op" id="5122725">=</span>&nbsp;<span class="ident" id="5122727">s</span><span class="op" id="5122728">.</span><span class="ident" id="5122729">next</span><span class="op" id="5122733">(</span><span class="op" id="5122734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5122739">break</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5122747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5122750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5122753">return</span>&nbsp;<span class="ident" id="5122760">ch</span><br>
<span class="lineno"></span><span class="op" id="5122763">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">545</span><span class="comment" id="5122766">//&nbsp;Scan&nbsp;reads&nbsp;the&nbsp;next&nbsp;token&nbsp;or&nbsp;Unicode&nbsp;character&nbsp;from&nbsp;source&nbsp;and&nbsp;returns&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="5122844">//&nbsp;It&nbsp;only&nbsp;recognizes&nbsp;tokens&nbsp;t&nbsp;for&nbsp;which&nbsp;the&nbsp;respective&nbsp;Mode&nbsp;bit&nbsp;(1&lt;&lt;-t)&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="comment" id="5122925">//&nbsp;It&nbsp;returns&nbsp;EOF&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;source.&nbsp;It&nbsp;reports&nbsp;scanner&nbsp;errors&nbsp;(read&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5123005">//&nbsp;token&nbsp;errors)&nbsp;by&nbsp;calling&nbsp;s.Error,&nbsp;if&nbsp;not&nbsp;nil;&nbsp;otherwise&nbsp;it&nbsp;prints&nbsp;an&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="5123083">//&nbsp;message&nbsp;to&nbsp;os.Stderr.</span><br>
<span class="lineno">550</span><span class="keyword" id="5123108">func</span>&nbsp;<span class="op" id="5123113">(</span><span class="ident" id="5123114">s</span>&nbsp;<span class="op" id="5123116">*</span><span class="ident" id="5123117">Scanner</span><span class="op" id="5123124">)</span>&nbsp;<span class="ident" id="5123126">Scan</span><span class="op" id="5123130">(</span><span class="op" id="5123131">)</span>&nbsp;<span class="builtintype" id="5123133">rune</span>&nbsp;<span class="op" id="5123138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5123141">ch</span>&nbsp;<span class="op" id="5123144">:=</span>&nbsp;<span class="ident" id="5123147">s</span><span class="op" id="5123148">.</span><span class="ident" id="5123149">Peek</span><span class="op" id="5123153">(</span><span class="op" id="5123154">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5123158">//&nbsp;reset&nbsp;token&nbsp;text&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5123188">s</span><span class="op" id="5123189">.</span><span class="ident" id="5123190">tokPos</span>&nbsp;<span class="op" id="5123197">=</span>&nbsp;<span class="op" id="5123199">-</span><span class="num" id="5123200">1</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5123203">s</span><span class="op" id="5123204">.</span><span class="ident" id="5123205">Line</span>&nbsp;<span class="op" id="5123210">=</span>&nbsp;<span class="num" id="5123212">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="5123215">redo</span><span class="op" id="5123219">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5123222">//&nbsp;skip&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5123243">for</span>&nbsp;<span class="ident" id="5123247">s</span><span class="op" id="5123248">.</span><span class="ident" id="5123249">Whitespace</span><span class="op" id="5123259">&amp;</span><span class="op" id="5123260">(</span><span class="num" id="5123261">1</span><span class="op" id="5123262">&lt;&lt;</span><span class="builtintype" id="5123264">uint</span><span class="op" id="5123268">(</span><span class="ident" id="5123269">ch</span><span class="op" id="5123271">)</span><span class="op" id="5123272">)</span>&nbsp;<span class="op" id="5123274">!=</span>&nbsp;<span class="num" id="5123277">0</span>&nbsp;<span class="op" id="5123279">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5123283">ch</span>&nbsp;<span class="op" id="5123286">=</span>&nbsp;<span class="ident" id="5123288">s</span><span class="op" id="5123289">.</span><span class="ident" id="5123290">next</span><span class="op" id="5123294">(</span><span class="op" id="5123295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5123298">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5123302">//&nbsp;start&nbsp;collecting&nbsp;token&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5123334">s</span><span class="op" id="5123335">.</span><span class="ident" id="5123336">tokBuf</span><span class="op" id="5123342">.</span><span class="ident" id="5123343">Reset</span><span class="op" id="5123348">(</span><span class="op" id="5123349">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5123352">s</span><span class="op" id="5123353">.</span><span class="ident" id="5123354">tokPos</span>&nbsp;<span class="op" id="5123361">=</span>&nbsp;<span class="ident" id="5123363">s</span><span class="op" id="5123364">.</span><span class="ident" id="5123365">srcPos</span>&nbsp;<span class="op" id="5123372">-</span>&nbsp;<span class="ident" id="5123374">s</span><span class="op" id="5123375">.</span><span class="ident" id="5123376">lastCharLen</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5123390">//&nbsp;set&nbsp;token&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5123413">//&nbsp;(this&nbsp;is&nbsp;a&nbsp;slightly&nbsp;optimized&nbsp;version&nbsp;of&nbsp;the&nbsp;code&nbsp;in&nbsp;Pos())</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5123477">s</span><span class="op" id="5123478">.</span><span class="ident" id="5123479">Offset</span>&nbsp;<span class="op" id="5123486">=</span>&nbsp;<span class="ident" id="5123488">s</span><span class="op" id="5123489">.</span><span class="ident" id="5123490">srcBufOffset</span>&nbsp;<span class="op" id="5123503">+</span>&nbsp;<span class="ident" id="5123505">s</span><span class="op" id="5123506">.</span><span class="ident" id="5123507">tokPos</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5123515">if</span>&nbsp;<span class="ident" id="5123518">s</span><span class="op" id="5123519">.</span><span class="ident" id="5123520">column</span>&nbsp;<span class="op" id="5123527">&gt;</span>&nbsp;<span class="num" id="5123529">0</span>&nbsp;<span class="op" id="5123531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5123535">//&nbsp;common&nbsp;case:&nbsp;last&nbsp;character&nbsp;was&nbsp;not&nbsp;a&nbsp;&#39;\n&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5123583">s</span><span class="op" id="5123584">.</span><span class="ident" id="5123585">Line</span>&nbsp;<span class="op" id="5123590">=</span>&nbsp;<span class="ident" id="5123592">s</span><span class="op" id="5123593">.</span><span class="ident" id="5123594">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5123601">s</span><span class="op" id="5123602">.</span><span class="ident" id="5123603">Column</span>&nbsp;<span class="op" id="5123610">=</span>&nbsp;<span class="ident" id="5123612">s</span><span class="op" id="5123613">.</span><span class="ident" id="5123614">column</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5123622">}</span>&nbsp;<span class="keyword" id="5123624">else</span>&nbsp;<span class="op" id="5123629">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5123633">//&nbsp;last&nbsp;character&nbsp;was&nbsp;a&nbsp;&#39;\n&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5123664">//&nbsp;(we&nbsp;cannot&nbsp;be&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5123714">//&nbsp;since&nbsp;we&nbsp;have&nbsp;called&nbsp;next()&nbsp;at&nbsp;least&nbsp;once)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5123762">s</span><span class="op" id="5123763">.</span><span class="ident" id="5123764">Line</span>&nbsp;<span class="op" id="5123769">=</span>&nbsp;<span class="ident" id="5123771">s</span><span class="op" id="5123772">.</span><span class="ident" id="5123773">line</span>&nbsp;<span class="op" id="5123778">-</span>&nbsp;<span class="num" id="5123780">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5123784">s</span><span class="op" id="5123785">.</span><span class="ident" id="5123786">Column</span>&nbsp;<span class="op" id="5123793">=</span>&nbsp;<span class="ident" id="5123795">s</span><span class="op" id="5123796">.</span><span class="ident" id="5123797">lastLineLen</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5123810">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5123814">//&nbsp;determine&nbsp;token&nbsp;value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5123840">tok</span>&nbsp;<span class="op" id="5123844">:=</span>&nbsp;<span class="ident" id="5123847">ch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5123851">switch</span>&nbsp;<span class="op" id="5123858">{</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5123861">case</span>&nbsp;<span class="ident" id="5123866">s</span><span class="op" id="5123867">.</span><span class="ident" id="5123868">isIdentRune</span><span class="op" id="5123879">(</span><span class="ident" id="5123880">ch</span><span class="op" id="5123882">,</span>&nbsp;<span class="num" id="5123884">0</span><span class="op" id="5123885">)</span><span class="op" id="5123886">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5123890">if</span>&nbsp;<span class="ident" id="5123893">s</span><span class="op" id="5123894">.</span><span class="ident" id="5123895">Mode</span><span class="op" id="5123899">&amp;</span><span class="ident" id="5123900">ScanIdents</span>&nbsp;<span class="op" id="5123911">!=</span>&nbsp;<span class="num" id="5123914">0</span>&nbsp;<span class="op" id="5123916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5123921">tok</span>&nbsp;<span class="op" id="5123925">=</span>&nbsp;<span class="ident" id="5123927">Ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5123936">ch</span>&nbsp;<span class="op" id="5123939">=</span>&nbsp;<span class="ident" id="5123941">s</span><span class="op" id="5123942">.</span><span class="ident" id="5123943">scanIdentifier</span><span class="op" id="5123957">(</span><span class="op" id="5123958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5123962">}</span>&nbsp;<span class="keyword" id="5123964">else</span>&nbsp;<span class="op" id="5123969">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5123974">ch</span>&nbsp;<span class="op" id="5123977">=</span>&nbsp;<span class="ident" id="5123979">s</span><span class="op" id="5123980">.</span><span class="ident" id="5123981">next</span><span class="op" id="5123985">(</span><span class="op" id="5123986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5123990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5123993">case</span>&nbsp;<span class="ident" id="5123998">isDecimal</span><span class="op" id="5124007">(</span><span class="ident" id="5124008">ch</span><span class="op" id="5124010">)</span><span class="op" id="5124011">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5124015">if</span>&nbsp;<span class="ident" id="5124018">s</span><span class="op" id="5124019">.</span><span class="ident" id="5124020">Mode</span><span class="op" id="5124024">&amp;</span><span class="op" id="5124025">(</span><span class="ident" id="5124026">ScanInts</span><span class="op" id="5124034">|</span><span class="ident" id="5124035">ScanFloats</span><span class="op" id="5124045">)</span>&nbsp;<span class="op" id="5124047">!=</span>&nbsp;<span class="num" id="5124050">0</span>&nbsp;<span class="op" id="5124052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124057">tok</span><span class="op" id="5124060">,</span>&nbsp;<span class="ident" id="5124062">ch</span>&nbsp;<span class="op" id="5124065">=</span>&nbsp;<span class="ident" id="5124067">s</span><span class="op" id="5124068">.</span><span class="ident" id="5124069">scanNumber</span><span class="op" id="5124079">(</span><span class="ident" id="5124080">ch</span><span class="op" id="5124082">)</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5124086">}</span>&nbsp;<span class="keyword" id="5124088">else</span>&nbsp;<span class="op" id="5124093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124098">ch</span>&nbsp;<span class="op" id="5124101">=</span>&nbsp;<span class="ident" id="5124103">s</span><span class="op" id="5124104">.</span><span class="ident" id="5124105">next</span><span class="op" id="5124109">(</span><span class="op" id="5124110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5124114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5124117">default</span><span class="op" id="5124124">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5124128">switch</span>&nbsp;<span class="ident" id="5124135">ch</span>&nbsp;<span class="op" id="5124138">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5124142">case</span>&nbsp;<span class="string" id="5124147">&#39;&#34;&#39;</span><span class="op" id="5124150">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5124155">if</span>&nbsp;<span class="ident" id="5124158">s</span><span class="op" id="5124159">.</span><span class="ident" id="5124160">Mode</span><span class="op" id="5124164">&amp;</span><span class="ident" id="5124165">ScanStrings</span>&nbsp;<span class="op" id="5124177">!=</span>&nbsp;<span class="num" id="5124180">0</span>&nbsp;<span class="op" id="5124182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124188">s</span><span class="op" id="5124189">.</span><span class="ident" id="5124190">scanString</span><span class="op" id="5124200">(</span><span class="string" id="5124201">&#39;&#34;&#39;</span><span class="op" id="5124204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124210">tok</span>&nbsp;<span class="op" id="5124214">=</span>&nbsp;<span class="ident" id="5124216">String</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5124226">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124231">ch</span>&nbsp;<span class="op" id="5124234">=</span>&nbsp;<span class="ident" id="5124236">s</span><span class="op" id="5124237">.</span><span class="ident" id="5124238">next</span><span class="op" id="5124242">(</span><span class="op" id="5124243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5124247">case</span>&nbsp;<span class="string" id="5124252">&#39;\&#39;&#39;</span><span class="op" id="5124256">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5124261">if</span>&nbsp;<span class="ident" id="5124264">s</span><span class="op" id="5124265">.</span><span class="ident" id="5124266">Mode</span><span class="op" id="5124270">&amp;</span><span class="ident" id="5124271">ScanChars</span>&nbsp;<span class="op" id="5124281">!=</span>&nbsp;<span class="num" id="5124284">0</span>&nbsp;<span class="op" id="5124286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124292">s</span><span class="op" id="5124293">.</span><span class="ident" id="5124294">scanChar</span><span class="op" id="5124302">(</span><span class="op" id="5124303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124309">tok</span>&nbsp;<span class="op" id="5124313">=</span>&nbsp;<span class="ident" id="5124315">Char</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5124323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124328">ch</span>&nbsp;<span class="op" id="5124331">=</span>&nbsp;<span class="ident" id="5124333">s</span><span class="op" id="5124334">.</span><span class="ident" id="5124335">next</span><span class="op" id="5124339">(</span><span class="op" id="5124340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5124344">case</span>&nbsp;<span class="string" id="5124349">&#39;.&#39;</span><span class="op" id="5124352">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124357">ch</span>&nbsp;<span class="op" id="5124360">=</span>&nbsp;<span class="ident" id="5124362">s</span><span class="op" id="5124363">.</span><span class="ident" id="5124364">next</span><span class="op" id="5124368">(</span><span class="op" id="5124369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5124374">if</span>&nbsp;<span class="ident" id="5124377">isDecimal</span><span class="op" id="5124386">(</span><span class="ident" id="5124387">ch</span><span class="op" id="5124389">)</span>&nbsp;<span class="op" id="5124391">&amp;&amp;</span>&nbsp;<span class="ident" id="5124394">s</span><span class="op" id="5124395">.</span><span class="ident" id="5124396">Mode</span><span class="op" id="5124400">&amp;</span><span class="ident" id="5124401">ScanFloats</span>&nbsp;<span class="op" id="5124412">!=</span>&nbsp;<span class="num" id="5124415">0</span>&nbsp;<span class="op" id="5124417">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124423">tok</span>&nbsp;<span class="op" id="5124427">=</span>&nbsp;<span class="ident" id="5124429">Float</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124439">ch</span>&nbsp;<span class="op" id="5124442">=</span>&nbsp;<span class="ident" id="5124444">s</span><span class="op" id="5124445">.</span><span class="ident" id="5124446">scanMantissa</span><span class="op" id="5124458">(</span><span class="ident" id="5124459">ch</span><span class="op" id="5124461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124467">ch</span>&nbsp;<span class="op" id="5124470">=</span>&nbsp;<span class="ident" id="5124472">s</span><span class="op" id="5124473">.</span><span class="ident" id="5124474">scanExponent</span><span class="op" id="5124486">(</span><span class="ident" id="5124487">ch</span><span class="op" id="5124489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5124494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5124498">case</span>&nbsp;<span class="string" id="5124503">&#39;/&#39;</span><span class="op" id="5124506">:</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124511">ch</span>&nbsp;<span class="op" id="5124514">=</span>&nbsp;<span class="ident" id="5124516">s</span><span class="op" id="5124517">.</span><span class="ident" id="5124518">next</span><span class="op" id="5124522">(</span><span class="op" id="5124523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5124528">if</span>&nbsp;<span class="op" id="5124531">(</span><span class="ident" id="5124532">ch</span>&nbsp;<span class="op" id="5124535">==</span>&nbsp;<span class="string" id="5124538">&#39;/&#39;</span>&nbsp;<span class="op" id="5124542">||</span>&nbsp;<span class="ident" id="5124545">ch</span>&nbsp;<span class="op" id="5124548">==</span>&nbsp;<span class="string" id="5124551">&#39;*&#39;</span><span class="op" id="5124554">)</span>&nbsp;<span class="op" id="5124556">&amp;&amp;</span>&nbsp;<span class="ident" id="5124559">s</span><span class="op" id="5124560">.</span><span class="ident" id="5124561">Mode</span><span class="op" id="5124565">&amp;</span><span class="ident" id="5124566">ScanComments</span>&nbsp;<span class="op" id="5124579">!=</span>&nbsp;<span class="num" id="5124582">0</span>&nbsp;<span class="op" id="5124584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5124590">if</span>&nbsp;<span class="ident" id="5124593">s</span><span class="op" id="5124594">.</span><span class="ident" id="5124595">Mode</span><span class="op" id="5124599">&amp;</span><span class="ident" id="5124600">SkipComments</span>&nbsp;<span class="op" id="5124613">!=</span>&nbsp;<span class="num" id="5124616">0</span>&nbsp;<span class="op" id="5124618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124625">s</span><span class="op" id="5124626">.</span><span class="ident" id="5124627">tokPos</span>&nbsp;<span class="op" id="5124634">=</span>&nbsp;<span class="op" id="5124636">-</span><span class="num" id="5124637">1</span>&nbsp;<span class="comment" id="5124639">//&nbsp;don&#39;t&nbsp;collect&nbsp;token&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124672">ch</span>&nbsp;<span class="op" id="5124675">=</span>&nbsp;<span class="ident" id="5124677">s</span><span class="op" id="5124678">.</span><span class="ident" id="5124679">scanComment</span><span class="op" id="5124690">(</span><span class="ident" id="5124691">ch</span><span class="op" id="5124693">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5124700">goto</span>&nbsp;<span class="ident" id="5124705">redo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5124714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124720">ch</span>&nbsp;<span class="op" id="5124723">=</span>&nbsp;<span class="ident" id="5124725">s</span><span class="op" id="5124726">.</span><span class="ident" id="5124727">scanComment</span><span class="op" id="5124738">(</span><span class="ident" id="5124739">ch</span><span class="op" id="5124741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124747">tok</span>&nbsp;<span class="op" id="5124751">=</span>&nbsp;<span class="ident" id="5124753">Comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5124764">}</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5124768">case</span>&nbsp;<span class="string" id="5124773">&#39;`&#39;</span><span class="op" id="5124776">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5124781">if</span>&nbsp;<span class="ident" id="5124784">s</span><span class="op" id="5124785">.</span><span class="ident" id="5124786">Mode</span><span class="op" id="5124790">&amp;</span><span class="ident" id="5124791">ScanRawStrings</span>&nbsp;<span class="op" id="5124806">!=</span>&nbsp;<span class="num" id="5124809">0</span>&nbsp;<span class="op" id="5124811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124817">s</span><span class="op" id="5124818">.</span><span class="ident" id="5124819">scanRawString</span><span class="op" id="5124832">(</span><span class="op" id="5124833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124839">tok</span>&nbsp;<span class="op" id="5124843">=</span>&nbsp;<span class="ident" id="5124845">String</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5124855">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124860">ch</span>&nbsp;<span class="op" id="5124863">=</span>&nbsp;<span class="ident" id="5124865">s</span><span class="op" id="5124866">.</span><span class="ident" id="5124867">next</span><span class="op" id="5124871">(</span><span class="op" id="5124872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5124876">default</span><span class="op" id="5124883">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124888">ch</span>&nbsp;<span class="op" id="5124891">=</span>&nbsp;<span class="ident" id="5124893">s</span><span class="op" id="5124894">.</span><span class="ident" id="5124895">next</span><span class="op" id="5124899">(</span><span class="op" id="5124900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5124904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5124907">}</span><br>
<span class="lineno">640</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5124911">//&nbsp;end&nbsp;of&nbsp;token&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124933">s</span><span class="op" id="5124934">.</span><span class="ident" id="5124935">tokEnd</span>&nbsp;<span class="op" id="5124942">=</span>&nbsp;<span class="ident" id="5124944">s</span><span class="op" id="5124945">.</span><span class="ident" id="5124946">srcPos</span>&nbsp;<span class="op" id="5124953">-</span>&nbsp;<span class="ident" id="5124955">s</span><span class="op" id="5124956">.</span><span class="ident" id="5124957">lastCharLen</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124971">s</span><span class="op" id="5124972">.</span><span class="ident" id="5124973">ch</span>&nbsp;<span class="op" id="5124976">=</span>&nbsp;<span class="ident" id="5124978">ch</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5124982">return</span>&nbsp;<span class="ident" id="5124989">tok</span><br>
<span class="lineno"></span><span class="op" id="5124993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5124996">//&nbsp;Pos&nbsp;returns&nbsp;the&nbsp;position&nbsp;of&nbsp;the&nbsp;character&nbsp;immediately&nbsp;after</span><br>
<span class="lineno"></span><span class="comment" id="5125059">//&nbsp;the&nbsp;character&nbsp;or&nbsp;token&nbsp;returned&nbsp;by&nbsp;the&nbsp;last&nbsp;call&nbsp;to&nbsp;Next&nbsp;or&nbsp;Scan.</span><br>
<span class="lineno">650</span><span class="keyword" id="5125128">func</span>&nbsp;<span class="op" id="5125133">(</span><span class="ident" id="5125134">s</span>&nbsp;<span class="op" id="5125136">*</span><span class="ident" id="5125137">Scanner</span><span class="op" id="5125144">)</span>&nbsp;<span class="ident" id="5125146">Pos</span><span class="op" id="5125149">(</span><span class="op" id="5125150">)</span>&nbsp;<span class="op" id="5125152">(</span><span class="ident" id="5125153">pos</span>&nbsp;<span class="ident" id="5125157">Position</span><span class="op" id="5125165">)</span>&nbsp;<span class="op" id="5125167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125170">pos</span><span class="op" id="5125173">.</span><span class="ident" id="5125174">Filename</span>&nbsp;<span class="op" id="5125183">=</span>&nbsp;<span class="ident" id="5125185">s</span><span class="op" id="5125186">.</span><span class="ident" id="5125187">Filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125197">pos</span><span class="op" id="5125200">.</span><span class="ident" id="5125201">Offset</span>&nbsp;<span class="op" id="5125208">=</span>&nbsp;<span class="ident" id="5125210">s</span><span class="op" id="5125211">.</span><span class="ident" id="5125212">srcBufOffset</span>&nbsp;<span class="op" id="5125225">+</span>&nbsp;<span class="ident" id="5125227">s</span><span class="op" id="5125228">.</span><span class="ident" id="5125229">srcPos</span>&nbsp;<span class="op" id="5125236">-</span>&nbsp;<span class="ident" id="5125238">s</span><span class="op" id="5125239">.</span><span class="ident" id="5125240">lastCharLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5125253">switch</span>&nbsp;<span class="op" id="5125260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5125263">case</span>&nbsp;<span class="ident" id="5125268">s</span><span class="op" id="5125269">.</span><span class="ident" id="5125270">column</span>&nbsp;<span class="op" id="5125277">&gt;</span>&nbsp;<span class="num" id="5125279">0</span><span class="op" id="5125280">:</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5125284">//&nbsp;common&nbsp;case:&nbsp;last&nbsp;character&nbsp;was&nbsp;not&nbsp;a&nbsp;&#39;\n&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125332">pos</span><span class="op" id="5125335">.</span><span class="ident" id="5125336">Line</span>&nbsp;<span class="op" id="5125341">=</span>&nbsp;<span class="ident" id="5125343">s</span><span class="op" id="5125344">.</span><span class="ident" id="5125345">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125352">pos</span><span class="op" id="5125355">.</span><span class="ident" id="5125356">Column</span>&nbsp;<span class="op" id="5125363">=</span>&nbsp;<span class="ident" id="5125365">s</span><span class="op" id="5125366">.</span><span class="ident" id="5125367">column</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5125375">case</span>&nbsp;<span class="ident" id="5125380">s</span><span class="op" id="5125381">.</span><span class="ident" id="5125382">lastLineLen</span>&nbsp;<span class="op" id="5125394">&gt;</span>&nbsp;<span class="num" id="5125396">0</span><span class="op" id="5125397">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5125401">//&nbsp;last&nbsp;character&nbsp;was&nbsp;a&nbsp;&#39;\n&#39;</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125432">pos</span><span class="op" id="5125435">.</span><span class="ident" id="5125436">Line</span>&nbsp;<span class="op" id="5125441">=</span>&nbsp;<span class="ident" id="5125443">s</span><span class="op" id="5125444">.</span><span class="ident" id="5125445">line</span>&nbsp;<span class="op" id="5125450">-</span>&nbsp;<span class="num" id="5125452">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125456">pos</span><span class="op" id="5125459">.</span><span class="ident" id="5125460">Column</span>&nbsp;<span class="op" id="5125467">=</span>&nbsp;<span class="ident" id="5125469">s</span><span class="op" id="5125470">.</span><span class="ident" id="5125471">lastLineLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5125484">default</span><span class="op" id="5125491">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5125495">//&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125531">pos</span><span class="op" id="5125534">.</span><span class="ident" id="5125535">Line</span>&nbsp;<span class="op" id="5125540">=</span>&nbsp;<span class="num" id="5125542">1</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125546">pos</span><span class="op" id="5125549">.</span><span class="ident" id="5125550">Column</span>&nbsp;<span class="op" id="5125557">=</span>&nbsp;<span class="num" id="5125559">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5125562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5125565">return</span><br>
<span class="lineno"></span><span class="op" id="5125572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">670</span><span class="comment" id="5125575">//&nbsp;TokenText&nbsp;returns&nbsp;the&nbsp;string&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;most&nbsp;recently&nbsp;scanned&nbsp;token.</span><br>
<span class="lineno"></span><span class="comment" id="5125657">//&nbsp;Valid&nbsp;after&nbsp;calling&nbsp;Scan().</span><br>
<span class="lineno"></span><span class="keyword" id="5125688">func</span>&nbsp;<span class="op" id="5125693">(</span><span class="ident" id="5125694">s</span>&nbsp;<span class="op" id="5125696">*</span><span class="ident" id="5125697">Scanner</span><span class="op" id="5125704">)</span>&nbsp;<span class="ident" id="5125706">TokenText</span><span class="op" id="5125715">(</span><span class="op" id="5125716">)</span>&nbsp;<span class="builtintype" id="5125718">string</span>&nbsp;<span class="op" id="5125725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5125728">if</span>&nbsp;<span class="ident" id="5125731">s</span><span class="op" id="5125732">.</span><span class="ident" id="5125733">tokPos</span>&nbsp;<span class="op" id="5125740">&lt;</span>&nbsp;<span class="num" id="5125742">0</span>&nbsp;<span class="op" id="5125744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5125748">//&nbsp;no&nbsp;token&nbsp;text</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5125767">return</span>&nbsp;<span class="string" id="5125774">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5125778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5125782">if</span>&nbsp;<span class="ident" id="5125785">s</span><span class="op" id="5125786">.</span><span class="ident" id="5125787">tokEnd</span>&nbsp;<span class="op" id="5125794">&lt;</span>&nbsp;<span class="num" id="5125796">0</span>&nbsp;<span class="op" id="5125798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5125802">//&nbsp;if&nbsp;EOF&nbsp;was&nbsp;reached,&nbsp;s.tokEnd&nbsp;is&nbsp;set&nbsp;to&nbsp;-1&nbsp;(s.srcPos&nbsp;==&nbsp;0)</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125865">s</span><span class="op" id="5125866">.</span><span class="ident" id="5125867">tokEnd</span>&nbsp;<span class="op" id="5125874">=</span>&nbsp;<span class="ident" id="5125876">s</span><span class="op" id="5125877">.</span><span class="ident" id="5125878">tokPos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5125886">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5125890">if</span>&nbsp;<span class="ident" id="5125893">s</span><span class="op" id="5125894">.</span><span class="ident" id="5125895">tokBuf</span><span class="op" id="5125901">.</span><span class="ident" id="5125902">Len</span><span class="op" id="5125905">(</span><span class="op" id="5125906">)</span>&nbsp;<span class="op" id="5125908">==</span>&nbsp;<span class="num" id="5125911">0</span>&nbsp;<span class="op" id="5125913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5125917">//&nbsp;common&nbsp;case:&nbsp;the&nbsp;entire&nbsp;token&nbsp;text&nbsp;is&nbsp;still&nbsp;in&nbsp;srcBuf</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5125976">return</span>&nbsp;<span class="builtintype" id="5125983">string</span><span class="op" id="5125989">(</span><span class="ident" id="5125990">s</span><span class="op" id="5125991">.</span><span class="ident" id="5125992">srcBuf</span><span class="op" id="5125998">[</span><span class="ident" id="5125999">s</span><span class="op" id="5126000">.</span><span class="ident" id="5126001">tokPos</span><span class="op" id="5126007">:</span><span class="ident" id="5126008">s</span><span class="op" id="5126009">.</span><span class="ident" id="5126010">tokEnd</span><span class="op" id="5126016">]</span><span class="op" id="5126017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5126020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5126024">//&nbsp;part&nbsp;of&nbsp;the&nbsp;token&nbsp;text&nbsp;was&nbsp;saved&nbsp;in&nbsp;tokBuf:&nbsp;save&nbsp;the&nbsp;rest&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5126089">//&nbsp;tokBuf&nbsp;as&nbsp;well&nbsp;and&nbsp;return&nbsp;its&nbsp;content</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5126131">s</span><span class="op" id="5126132">.</span><span class="ident" id="5126133">tokBuf</span><span class="op" id="5126139">.</span><span class="ident" id="5126140">Write</span><span class="op" id="5126145">(</span><span class="ident" id="5126146">s</span><span class="op" id="5126147">.</span><span class="ident" id="5126148">srcBuf</span><span class="op" id="5126154">[</span><span class="ident" id="5126155">s</span><span class="op" id="5126156">.</span><span class="ident" id="5126157">tokPos</span><span class="op" id="5126163">:</span><span class="ident" id="5126164">s</span><span class="op" id="5126165">.</span><span class="ident" id="5126166">tokEnd</span><span class="op" id="5126172">]</span><span class="op" id="5126173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5126176">s</span><span class="op" id="5126177">.</span><span class="ident" id="5126178">tokPos</span>&nbsp;<span class="op" id="5126185">=</span>&nbsp;<span class="ident" id="5126187">s</span><span class="op" id="5126188">.</span><span class="ident" id="5126189">tokEnd</span>&nbsp;<span class="comment" id="5126196">//&nbsp;ensure&nbsp;idempotency&nbsp;of&nbsp;TokenText()&nbsp;call</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5126239">return</span>&nbsp;<span class="ident" id="5126246">s</span><span class="op" id="5126247">.</span><span class="ident" id="5126248">tokBuf</span><span class="op" id="5126254">.</span><span class="ident" id="5126255">String</span><span class="op" id="5126261">(</span><span class="op" id="5126262">)</span><br>
<span class="lineno"></span><span class="op" id="5126264">}</span>
</div>
</body>
</html>
