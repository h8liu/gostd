<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7766223">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7766278">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7766332">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7766383">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7766448">package</span>&nbsp;<span class="ident" id="7766456">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7766461">import</span>&nbsp;<span class="op" id="7766468">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7766471">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7766477">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7766490">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7766496">&#34;path&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7766504">&#34;reflect&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7766515">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7766526">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7766533">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7766536">var</span>&nbsp;<span class="ident" id="7766540">dnsTransportFallbackTests</span>&nbsp;<span class="op" id="7766566">=</span>&nbsp;<span class="op" id="7766568">[</span><span class="op" id="7766569">]</span><span class="keyword" id="7766570">struct</span>&nbsp;<span class="op" id="7766577">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7766580">server</span>&nbsp;&nbsp;<span class="builtintype" id="7766588">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7766596">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7766604">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7766612">qtype</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7766620">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7766628">timeout</span>&nbsp;<span class="builtintype" id="7766636">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7766641">rcode</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7766649">int</span><br>
<span class="lineno">25</span><span class="op" id="7766653">}</span><span class="op" id="7766654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7766657">//&nbsp;Querying&nbsp;&#34;com.&#34;&nbsp;with&nbsp;qtype=255&nbsp;usually&nbsp;makes&nbsp;an&nbsp;answer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7766716">//&nbsp;which&nbsp;requires&nbsp;more&nbsp;than&nbsp;512&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7766756">{</span><span class="string" id="7766757">&#34;8.8.8.8:53&#34;</span><span class="op" id="7766769">,</span>&nbsp;<span class="string" id="7766771">&#34;com.&#34;</span><span class="op" id="7766777">,</span>&nbsp;<span class="ident" id="7766779">dnsTypeALL</span><span class="op" id="7766789">,</span>&nbsp;<span class="num" id="7766791">2</span><span class="op" id="7766792">,</span>&nbsp;<span class="ident" id="7766794">dnsRcodeSuccess</span><span class="op" id="7766809">}</span><span class="op" id="7766810">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7766813">{</span><span class="string" id="7766814">&#34;8.8.4.4:53&#34;</span><span class="op" id="7766826">,</span>&nbsp;<span class="string" id="7766828">&#34;com.&#34;</span><span class="op" id="7766834">,</span>&nbsp;<span class="ident" id="7766836">dnsTypeALL</span><span class="op" id="7766846">,</span>&nbsp;<span class="num" id="7766848">4</span><span class="op" id="7766849">,</span>&nbsp;<span class="ident" id="7766851">dnsRcodeSuccess</span><span class="op" id="7766866">}</span><span class="op" id="7766867">,</span><br>
<span class="lineno">30</span><span class="op" id="7766869">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7766872">func</span>&nbsp;<span class="ident" id="7766877">TestDNSTransportFallback</span><span class="op" id="7766901">(</span><span class="ident" id="7766902">t</span>&nbsp;<span class="op" id="7766904">*</span><span class="ident" id="7766905">testing</span><span class="op" id="7766912">.</span><span class="ident" id="7766913">T</span><span class="op" id="7766914">)</span>&nbsp;<span class="op" id="7766916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7766919">if</span>&nbsp;<span class="ident" id="7766922">testing</span><span class="op" id="7766929">.</span><span class="ident" id="7766930">Short</span><span class="op" id="7766935">(</span><span class="op" id="7766936">)</span>&nbsp;<span class="op" id="7766938">||</span>&nbsp;<span class="op" id="7766941">!</span><span class="op" id="7766942">*</span><span class="ident" id="7766943">testExternal</span>&nbsp;<span class="op" id="7766956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7766960">t</span><span class="op" id="7766961">.</span><span class="ident" id="7766962">Skip</span><span class="op" id="7766966">(</span><span class="string" id="7766967">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="7767008">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7767011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7767015">for</span>&nbsp;<span class="ident" id="7767019">_</span><span class="op" id="7767020">,</span>&nbsp;<span class="ident" id="7767022">tt</span>&nbsp;<span class="op" id="7767025">:=</span>&nbsp;<span class="keyword" id="7767028">range</span>&nbsp;<span class="ident" id="7767034">dnsTransportFallbackTests</span>&nbsp;<span class="op" id="7767060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7767064">timeout</span>&nbsp;<span class="op" id="7767072">:=</span>&nbsp;<span class="ident" id="7767075">time</span><span class="op" id="7767079">.</span><span class="ident" id="7767080">Duration</span><span class="op" id="7767088">(</span><span class="ident" id="7767089">tt</span><span class="op" id="7767091">.</span><span class="ident" id="7767092">timeout</span><span class="op" id="7767099">)</span>&nbsp;<span class="op" id="7767101">*</span>&nbsp;<span class="ident" id="7767103">time</span><span class="op" id="7767107">.</span><span class="ident" id="7767108">Second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7767117">msg</span><span class="op" id="7767120">,</span>&nbsp;<span class="ident" id="7767122">err</span>&nbsp;<span class="op" id="7767126">:=</span>&nbsp;<span class="ident" id="7767129">exchange</span><span class="op" id="7767137">(</span><span class="ident" id="7767138">tt</span><span class="op" id="7767140">.</span><span class="ident" id="7767141">server</span><span class="op" id="7767147">,</span>&nbsp;<span class="ident" id="7767149">tt</span><span class="op" id="7767151">.</span><span class="ident" id="7767152">name</span><span class="op" id="7767156">,</span>&nbsp;<span class="ident" id="7767158">tt</span><span class="op" id="7767160">.</span><span class="ident" id="7767161">qtype</span><span class="op" id="7767166">,</span>&nbsp;<span class="ident" id="7767168">timeout</span><span class="op" id="7767175">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7767179">if</span>&nbsp;<span class="ident" id="7767182">err</span>&nbsp;<span class="op" id="7767186">!=</span>&nbsp;<span class="ident" id="7767189">nil</span>&nbsp;<span class="op" id="7767193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7767198">t</span><span class="op" id="7767199">.</span><span class="ident" id="7767200">Error</span><span class="op" id="7767205">(</span><span class="ident" id="7767206">err</span><span class="op" id="7767209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7767214">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7767225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7767229">switch</span>&nbsp;<span class="ident" id="7767236">msg</span><span class="op" id="7767239">.</span><span class="ident" id="7767240">rcode</span>&nbsp;<span class="op" id="7767246">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7767250">case</span>&nbsp;<span class="ident" id="7767255">tt</span><span class="op" id="7767257">.</span><span class="ident" id="7767258">rcode</span><span class="op" id="7767263">,</span>&nbsp;<span class="ident" id="7767265">dnsRcodeServerFailure</span><span class="op" id="7767286">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7767290">default</span><span class="op" id="7767297">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7767302">t</span><span class="op" id="7767303">.</span><span class="ident" id="7767304">Errorf</span><span class="op" id="7767310">(</span><span class="string" id="7767311">&#34;got&nbsp;%v&nbsp;from&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7767336">,</span>&nbsp;<span class="ident" id="7767338">msg</span><span class="op" id="7767341">.</span><span class="ident" id="7767342">rcode</span><span class="op" id="7767347">,</span>&nbsp;<span class="ident" id="7767349">tt</span><span class="op" id="7767351">.</span><span class="ident" id="7767352">server</span><span class="op" id="7767358">,</span>&nbsp;<span class="ident" id="7767360">tt</span><span class="op" id="7767362">.</span><span class="ident" id="7767363">rcode</span><span class="op" id="7767368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7767373">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7767384">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7767387">}</span><br>
<span class="lineno"></span><span class="op" id="7767389">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7767392">//&nbsp;See&nbsp;RFC&nbsp;6761&nbsp;for&nbsp;further&nbsp;information&nbsp;about&nbsp;the&nbsp;reserved,&nbsp;pseudo</span><br>
<span class="lineno"></span><span class="comment" id="7767459">//&nbsp;domain&nbsp;names.</span><br>
<span class="lineno">55</span><span class="keyword" id="7767476">var</span>&nbsp;<span class="ident" id="7767480">specialDomainNameTests</span>&nbsp;<span class="op" id="7767503">=</span>&nbsp;<span class="op" id="7767505">[</span><span class="op" id="7767506">]</span><span class="keyword" id="7767507">struct</span>&nbsp;<span class="op" id="7767514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7767517">name</span>&nbsp;&nbsp;<span class="builtintype" id="7767523">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7767531">qtype</span>&nbsp;<span class="builtintype" id="7767537">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7767545">rcode</span>&nbsp;<span class="builtintype" id="7767551">int</span><br>
<span class="lineno"></span><span class="op" id="7767555">}</span><span class="op" id="7767556">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7767559">//&nbsp;Name&nbsp;resoltion&nbsp;APIs&nbsp;and&nbsp;libraries&nbsp;should&nbsp;not&nbsp;recongnize&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7767623">//&nbsp;followings&nbsp;as&nbsp;special.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7767650">{</span><span class="string" id="7767651">&#34;1.0.168.192.in-addr.arpa.&#34;</span><span class="op" id="7767678">,</span>&nbsp;<span class="ident" id="7767680">dnsTypePTR</span><span class="op" id="7767690">,</span>&nbsp;<span class="ident" id="7767692">dnsRcodeNameError</span><span class="op" id="7767709">}</span><span class="op" id="7767710">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7767713">{</span><span class="string" id="7767714">&#34;test.&#34;</span><span class="op" id="7767721">,</span>&nbsp;<span class="ident" id="7767723">dnsTypeALL</span><span class="op" id="7767733">,</span>&nbsp;<span class="ident" id="7767735">dnsRcodeNameError</span><span class="op" id="7767752">}</span><span class="op" id="7767753">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7767756">{</span><span class="string" id="7767757">&#34;example.com.&#34;</span><span class="op" id="7767771">,</span>&nbsp;<span class="ident" id="7767773">dnsTypeALL</span><span class="op" id="7767783">,</span>&nbsp;<span class="ident" id="7767785">dnsRcodeSuccess</span><span class="op" id="7767800">}</span><span class="op" id="7767801">,</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7767805">//&nbsp;Name&nbsp;resoltion&nbsp;APIs&nbsp;and&nbsp;libraries&nbsp;should&nbsp;recongnize&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7767865">//&nbsp;followings&nbsp;as&nbsp;special&nbsp;and&nbsp;should&nbsp;not&nbsp;send&nbsp;any&nbsp;queries.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7767924">//&nbsp;Though,&nbsp;we&nbsp;test&nbsp;those&nbsp;names&nbsp;here&nbsp;for&nbsp;verifying&nbsp;nagative</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7767984">//&nbsp;answers&nbsp;at&nbsp;DNS&nbsp;query-response&nbsp;interaction&nbsp;level.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7768037">{</span><span class="string" id="7768038">&#34;localhost.&#34;</span><span class="op" id="7768050">,</span>&nbsp;<span class="ident" id="7768052">dnsTypeALL</span><span class="op" id="7768062">,</span>&nbsp;<span class="ident" id="7768064">dnsRcodeNameError</span><span class="op" id="7768081">}</span><span class="op" id="7768082">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7768085">{</span><span class="string" id="7768086">&#34;invalid.&#34;</span><span class="op" id="7768096">,</span>&nbsp;<span class="ident" id="7768098">dnsTypeALL</span><span class="op" id="7768108">,</span>&nbsp;<span class="ident" id="7768110">dnsRcodeNameError</span><span class="op" id="7768127">}</span><span class="op" id="7768128">,</span><br>
<span class="lineno"></span><span class="op" id="7768130">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7768133">func</span>&nbsp;<span class="ident" id="7768138">TestSpecialDomainName</span><span class="op" id="7768159">(</span><span class="ident" id="7768160">t</span>&nbsp;<span class="op" id="7768162">*</span><span class="ident" id="7768163">testing</span><span class="op" id="7768170">.</span><span class="ident" id="7768171">T</span><span class="op" id="7768172">)</span>&nbsp;<span class="op" id="7768174">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7768177">if</span>&nbsp;<span class="ident" id="7768180">testing</span><span class="op" id="7768187">.</span><span class="ident" id="7768188">Short</span><span class="op" id="7768193">(</span><span class="op" id="7768194">)</span>&nbsp;<span class="op" id="7768196">||</span>&nbsp;<span class="op" id="7768199">!</span><span class="op" id="7768200">*</span><span class="ident" id="7768201">testExternal</span>&nbsp;<span class="op" id="7768214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7768218">t</span><span class="op" id="7768219">.</span><span class="ident" id="7768220">Skip</span><span class="op" id="7768224">(</span><span class="string" id="7768225">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="7768266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7768269">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7768273">server</span>&nbsp;<span class="op" id="7768280">:=</span>&nbsp;<span class="string" id="7768283">&#34;8.8.8.8:53&#34;</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7768297">for</span>&nbsp;<span class="ident" id="7768301">_</span><span class="op" id="7768302">,</span>&nbsp;<span class="ident" id="7768304">tt</span>&nbsp;<span class="op" id="7768307">:=</span>&nbsp;<span class="keyword" id="7768310">range</span>&nbsp;<span class="ident" id="7768316">specialDomainNameTests</span>&nbsp;<span class="op" id="7768339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7768343">msg</span><span class="op" id="7768346">,</span>&nbsp;<span class="ident" id="7768348">err</span>&nbsp;<span class="op" id="7768352">:=</span>&nbsp;<span class="ident" id="7768355">exchange</span><span class="op" id="7768363">(</span><span class="ident" id="7768364">server</span><span class="op" id="7768370">,</span>&nbsp;<span class="ident" id="7768372">tt</span><span class="op" id="7768374">.</span><span class="ident" id="7768375">name</span><span class="op" id="7768379">,</span>&nbsp;<span class="ident" id="7768381">tt</span><span class="op" id="7768383">.</span><span class="ident" id="7768384">qtype</span><span class="op" id="7768389">,</span>&nbsp;<span class="num" id="7768391">0</span><span class="op" id="7768392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7768396">if</span>&nbsp;<span class="ident" id="7768399">err</span>&nbsp;<span class="op" id="7768403">!=</span>&nbsp;<span class="ident" id="7768406">nil</span>&nbsp;<span class="op" id="7768410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7768415">t</span><span class="op" id="7768416">.</span><span class="ident" id="7768417">Error</span><span class="op" id="7768422">(</span><span class="ident" id="7768423">err</span><span class="op" id="7768426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7768431">continue</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7768442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7768446">switch</span>&nbsp;<span class="ident" id="7768453">msg</span><span class="op" id="7768456">.</span><span class="ident" id="7768457">rcode</span>&nbsp;<span class="op" id="7768463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7768467">case</span>&nbsp;<span class="ident" id="7768472">tt</span><span class="op" id="7768474">.</span><span class="ident" id="7768475">rcode</span><span class="op" id="7768480">,</span>&nbsp;<span class="ident" id="7768482">dnsRcodeServerFailure</span><span class="op" id="7768503">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7768507">default</span><span class="op" id="7768514">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7768519">t</span><span class="op" id="7768520">.</span><span class="ident" id="7768521">Errorf</span><span class="op" id="7768527">(</span><span class="string" id="7768528">&#34;got&nbsp;%v&nbsp;from&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7768553">,</span>&nbsp;<span class="ident" id="7768555">msg</span><span class="op" id="7768558">.</span><span class="ident" id="7768559">rcode</span><span class="op" id="7768564">,</span>&nbsp;<span class="ident" id="7768566">server</span><span class="op" id="7768572">,</span>&nbsp;<span class="ident" id="7768574">tt</span><span class="op" id="7768576">.</span><span class="ident" id="7768577">rcode</span><span class="op" id="7768582">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7768587">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7768598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7768601">}</span><br>
<span class="lineno"></span><span class="op" id="7768603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="7768606">type</span>&nbsp;<span class="ident" id="7768611">resolvConfTest</span>&nbsp;<span class="keyword" id="7768626">struct</span>&nbsp;<span class="op" id="7768633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7768636">*</span><span class="ident" id="7768637">testing</span><span class="op" id="7768644">.</span><span class="ident" id="7768645">T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7768648">dir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7768656">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7768664">path</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7768672">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7768680">started</span>&nbsp;<span class="builtintype" id="7768688">bool</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7768694">quitc</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="7768702">chan</span>&nbsp;<span class="keyword" id="7768707">chan</span>&nbsp;<span class="keyword" id="7768712">struct</span><span class="op" id="7768718">{</span><span class="op" id="7768719">}</span><br>
<span class="lineno"></span><span class="op" id="7768721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7768724">func</span>&nbsp;<span class="ident" id="7768729">newResolvConfTest</span><span class="op" id="7768746">(</span><span class="ident" id="7768747">t</span>&nbsp;<span class="op" id="7768749">*</span><span class="ident" id="7768750">testing</span><span class="op" id="7768757">.</span><span class="ident" id="7768758">T</span><span class="op" id="7768759">)</span>&nbsp;<span class="op" id="7768761">*</span><span class="ident" id="7768762">resolvConfTest</span>&nbsp;<span class="op" id="7768777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7768780">dir</span><span class="op" id="7768783">,</span>&nbsp;<span class="ident" id="7768785">err</span>&nbsp;<span class="op" id="7768789">:=</span>&nbsp;<span class="ident" id="7768792">ioutil</span><span class="op" id="7768798">.</span><span class="ident" id="7768799">TempDir</span><span class="op" id="7768806">(</span><span class="string" id="7768807">&#34;&#34;</span><span class="op" id="7768809">,</span>&nbsp;<span class="string" id="7768811">&#34;resolvConfTest&#34;</span><span class="op" id="7768827">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7768830">if</span>&nbsp;<span class="ident" id="7768833">err</span>&nbsp;<span class="op" id="7768837">!=</span>&nbsp;<span class="ident" id="7768840">nil</span>&nbsp;<span class="op" id="7768844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7768848">t</span><span class="op" id="7768849">.</span><span class="ident" id="7768850">Fatalf</span><span class="op" id="7768856">(</span><span class="string" id="7768857">&#34;could&nbsp;not&nbsp;create&nbsp;temp&nbsp;dir:&nbsp;%v&#34;</span><span class="op" id="7768888">,</span>&nbsp;<span class="ident" id="7768890">err</span><span class="op" id="7768893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7768896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7768900">//&nbsp;Disable&nbsp;the&nbsp;default&nbsp;loadConfig</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7768935">onceLoadConfig</span><span class="op" id="7768949">.</span><span class="ident" id="7768950">Do</span><span class="op" id="7768952">(</span><span class="keyword" id="7768953">func</span><span class="op" id="7768957">(</span><span class="op" id="7768958">)</span>&nbsp;<span class="op" id="7768960">{</span><span class="op" id="7768961">}</span><span class="op" id="7768962">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7768966">r</span>&nbsp;<span class="op" id="7768968">:=</span>&nbsp;<span class="op" id="7768971">&amp;</span><span class="ident" id="7768972">resolvConfTest</span><span class="op" id="7768986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7768990">T</span><span class="op" id="7768991">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7768997">t</span><span class="op" id="7768998">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7769002">dir</span><span class="op" id="7769005">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7769009">dir</span><span class="op" id="7769012">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7769016">path</span><span class="op" id="7769020">:</span>&nbsp;&nbsp;<span class="ident" id="7769023">path</span><span class="op" id="7769027">.</span><span class="ident" id="7769028">Join</span><span class="op" id="7769032">(</span><span class="ident" id="7769033">dir</span><span class="op" id="7769036">,</span>&nbsp;<span class="string" id="7769038">&#34;resolv.conf&#34;</span><span class="op" id="7769051">)</span><span class="op" id="7769052">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7769056">quitc</span><span class="op" id="7769061">:</span>&nbsp;<span class="builtinfunc" id="7769063">make</span><span class="op" id="7769067">(</span><span class="keyword" id="7769068">chan</span>&nbsp;<span class="keyword" id="7769073">chan</span>&nbsp;<span class="keyword" id="7769078">struct</span><span class="op" id="7769084">{</span><span class="op" id="7769085">}</span><span class="op" id="7769086">)</span><span class="op" id="7769087">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7769090">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7769094">return</span>&nbsp;<span class="ident" id="7769101">r</span><br>
<span class="lineno">120</span><span class="op" id="7769103">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7769106">func</span>&nbsp;<span class="op" id="7769111">(</span><span class="ident" id="7769112">r</span>&nbsp;<span class="op" id="7769114">*</span><span class="ident" id="7769115">resolvConfTest</span><span class="op" id="7769129">)</span>&nbsp;<span class="ident" id="7769131">Start</span><span class="op" id="7769136">(</span><span class="op" id="7769137">)</span>&nbsp;<span class="op" id="7769139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7769142">loadConfig</span><span class="op" id="7769152">(</span><span class="ident" id="7769153">r</span><span class="op" id="7769154">.</span><span class="ident" id="7769155">path</span><span class="op" id="7769159">,</span>&nbsp;<span class="num" id="7769161">100</span><span class="op" id="7769164">*</span><span class="ident" id="7769165">time</span><span class="op" id="7769169">.</span><span class="ident" id="7769170">Millisecond</span><span class="op" id="7769181">,</span>&nbsp;<span class="ident" id="7769183">r</span><span class="op" id="7769184">.</span><span class="ident" id="7769185">quitc</span><span class="op" id="7769190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7769193">r</span><span class="op" id="7769194">.</span><span class="ident" id="7769195">started</span>&nbsp;<span class="op" id="7769203">=</span>&nbsp;<span class="builtintype" id="7769205">true</span><br>
<span class="lineno">125</span><span class="op" id="7769210">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7769213">func</span>&nbsp;<span class="op" id="7769218">(</span><span class="ident" id="7769219">r</span>&nbsp;<span class="op" id="7769221">*</span><span class="ident" id="7769222">resolvConfTest</span><span class="op" id="7769236">)</span>&nbsp;<span class="ident" id="7769238">SetConf</span><span class="op" id="7769245">(</span><span class="ident" id="7769246">s</span>&nbsp;<span class="builtintype" id="7769248">string</span><span class="op" id="7769254">)</span>&nbsp;<span class="op" id="7769256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7769259">//&nbsp;Make&nbsp;sure&nbsp;the&nbsp;file&nbsp;mtime&nbsp;will&nbsp;be&nbsp;different&nbsp;once&nbsp;we&#39;re&nbsp;done&nbsp;here,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7769328">//&nbsp;even&nbsp;on&nbsp;systems&nbsp;with&nbsp;coarse&nbsp;(1s)&nbsp;mtime&nbsp;resolution.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7769383">time</span><span class="op" id="7769387">.</span><span class="ident" id="7769388">Sleep</span><span class="op" id="7769393">(</span><span class="ident" id="7769394">time</span><span class="op" id="7769398">.</span><span class="ident" id="7769399">Second</span><span class="op" id="7769405">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7769409">f</span><span class="op" id="7769410">,</span>&nbsp;<span class="ident" id="7769412">err</span>&nbsp;<span class="op" id="7769416">:=</span>&nbsp;<span class="ident" id="7769419">os</span><span class="op" id="7769421">.</span><span class="ident" id="7769422">OpenFile</span><span class="op" id="7769430">(</span><span class="ident" id="7769431">r</span><span class="op" id="7769432">.</span><span class="ident" id="7769433">path</span><span class="op" id="7769437">,</span>&nbsp;<span class="ident" id="7769439">os</span><span class="op" id="7769441">.</span><span class="ident" id="7769442">O_CREATE</span><span class="op" id="7769450">|</span><span class="ident" id="7769451">os</span><span class="op" id="7769453">.</span><span class="ident" id="7769454">O_TRUNC</span><span class="op" id="7769461">|</span><span class="ident" id="7769462">os</span><span class="op" id="7769464">.</span><span class="ident" id="7769465">O_WRONLY</span><span class="op" id="7769473">,</span>&nbsp;<span class="num" id="7769475">0600</span><span class="op" id="7769479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7769482">if</span>&nbsp;<span class="ident" id="7769485">err</span>&nbsp;<span class="op" id="7769489">!=</span>&nbsp;<span class="ident" id="7769492">nil</span>&nbsp;<span class="op" id="7769496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7769500">r</span><span class="op" id="7769501">.</span><span class="ident" id="7769502">Fatalf</span><span class="op" id="7769508">(</span><span class="string" id="7769509">&#34;failed&nbsp;to&nbsp;create&nbsp;temp&nbsp;file&nbsp;%s:&nbsp;%v&#34;</span><span class="op" id="7769544">,</span>&nbsp;<span class="ident" id="7769546">r</span><span class="op" id="7769547">.</span><span class="ident" id="7769548">path</span><span class="op" id="7769552">,</span>&nbsp;<span class="ident" id="7769554">err</span><span class="op" id="7769557">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7769560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7769563">if</span>&nbsp;<span class="ident" id="7769566">_</span><span class="op" id="7769567">,</span>&nbsp;<span class="ident" id="7769569">err</span>&nbsp;<span class="op" id="7769573">:=</span>&nbsp;<span class="ident" id="7769576">io</span><span class="op" id="7769578">.</span><span class="ident" id="7769579">WriteString</span><span class="op" id="7769590">(</span><span class="ident" id="7769591">f</span><span class="op" id="7769592">,</span>&nbsp;<span class="ident" id="7769594">s</span><span class="op" id="7769595">)</span><span class="op" id="7769596">;</span>&nbsp;<span class="ident" id="7769598">err</span>&nbsp;<span class="op" id="7769602">!=</span>&nbsp;<span class="ident" id="7769605">nil</span>&nbsp;<span class="op" id="7769609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7769613">f</span><span class="op" id="7769614">.</span><span class="ident" id="7769615">Close</span><span class="op" id="7769620">(</span><span class="op" id="7769621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7769625">r</span><span class="op" id="7769626">.</span><span class="ident" id="7769627">Fatalf</span><span class="op" id="7769633">(</span><span class="string" id="7769634">&#34;failed&nbsp;to&nbsp;write&nbsp;temp&nbsp;file:&nbsp;%v&#34;</span><span class="op" id="7769665">,</span>&nbsp;<span class="ident" id="7769667">err</span><span class="op" id="7769670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7769673">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7769676">f</span><span class="op" id="7769677">.</span><span class="ident" id="7769678">Close</span><span class="op" id="7769683">(</span><span class="op" id="7769684">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7769688">if</span>&nbsp;<span class="ident" id="7769691">r</span><span class="op" id="7769692">.</span><span class="ident" id="7769693">started</span>&nbsp;<span class="op" id="7769701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7769705">cfg</span><span class="op" id="7769708">.</span><span class="ident" id="7769709">ch</span>&nbsp;<span class="op" id="7769712">&lt;-</span>&nbsp;<span class="keyword" id="7769715">struct</span><span class="op" id="7769721">{</span><span class="op" id="7769722">}</span><span class="op" id="7769723">{</span><span class="op" id="7769724">}</span>&nbsp;<span class="comment" id="7769726">//&nbsp;fill&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7769743">cfg</span><span class="op" id="7769746">.</span><span class="ident" id="7769747">ch</span>&nbsp;<span class="op" id="7769750">&lt;-</span>&nbsp;<span class="keyword" id="7769753">struct</span><span class="op" id="7769759">{</span><span class="op" id="7769760">}</span><span class="op" id="7769761">{</span><span class="op" id="7769762">}</span>&nbsp;<span class="comment" id="7769764">//&nbsp;wait&nbsp;for&nbsp;reload&nbsp;to&nbsp;begin</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7769794">cfg</span><span class="op" id="7769797">.</span><span class="ident" id="7769798">ch</span>&nbsp;<span class="op" id="7769801">&lt;-</span>&nbsp;<span class="keyword" id="7769804">struct</span><span class="op" id="7769810">{</span><span class="op" id="7769811">}</span><span class="op" id="7769812">{</span><span class="op" id="7769813">}</span>&nbsp;<span class="comment" id="7769815">//&nbsp;wait&nbsp;for&nbsp;reload&nbsp;to&nbsp;complete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7769847">}</span><br>
<span class="lineno"></span><span class="op" id="7769849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7769852">func</span>&nbsp;<span class="op" id="7769857">(</span><span class="ident" id="7769858">r</span>&nbsp;<span class="op" id="7769860">*</span><span class="ident" id="7769861">resolvConfTest</span><span class="op" id="7769875">)</span>&nbsp;<span class="ident" id="7769877">WantServers</span><span class="op" id="7769888">(</span><span class="ident" id="7769889">want</span>&nbsp;<span class="op" id="7769894">[</span><span class="op" id="7769895">]</span><span class="builtintype" id="7769896">string</span><span class="op" id="7769902">)</span>&nbsp;<span class="op" id="7769904">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7769907">cfg</span><span class="op" id="7769910">.</span><span class="ident" id="7769911">mu</span><span class="op" id="7769913">.</span><span class="ident" id="7769914">RLock</span><span class="op" id="7769919">(</span><span class="op" id="7769920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7769923">defer</span>&nbsp;<span class="ident" id="7769929">cfg</span><span class="op" id="7769932">.</span><span class="ident" id="7769933">mu</span><span class="op" id="7769935">.</span><span class="ident" id="7769936">RUnlock</span><span class="op" id="7769943">(</span><span class="op" id="7769944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7769947">if</span>&nbsp;<span class="ident" id="7769950">got</span>&nbsp;<span class="op" id="7769954">:=</span>&nbsp;<span class="ident" id="7769957">cfg</span><span class="op" id="7769960">.</span><span class="ident" id="7769961">dnsConfig</span><span class="op" id="7769970">.</span><span class="ident" id="7769971">servers</span><span class="op" id="7769978">;</span>&nbsp;<span class="op" id="7769980">!</span><span class="ident" id="7769981">reflect</span><span class="op" id="7769988">.</span><span class="ident" id="7769989">DeepEqual</span><span class="op" id="7769998">(</span><span class="ident" id="7769999">got</span><span class="op" id="7770002">,</span>&nbsp;<span class="ident" id="7770004">want</span><span class="op" id="7770008">)</span>&nbsp;<span class="op" id="7770010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7770014">r</span><span class="op" id="7770015">.</span><span class="ident" id="7770016">Fatalf</span><span class="op" id="7770022">(</span><span class="string" id="7770023">&#34;Unexpected&nbsp;dns&nbsp;server&nbsp;loaded,&nbsp;got&nbsp;%v&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7770069">,</span>&nbsp;<span class="ident" id="7770071">got</span><span class="op" id="7770074">,</span>&nbsp;<span class="ident" id="7770076">want</span><span class="op" id="7770080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7770083">}</span><br>
<span class="lineno">155</span><span class="op" id="7770085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7770088">func</span>&nbsp;<span class="op" id="7770093">(</span><span class="ident" id="7770094">r</span>&nbsp;<span class="op" id="7770096">*</span><span class="ident" id="7770097">resolvConfTest</span><span class="op" id="7770111">)</span>&nbsp;<span class="ident" id="7770113">Close</span><span class="op" id="7770118">(</span><span class="op" id="7770119">)</span>&nbsp;<span class="op" id="7770121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7770124">resp</span>&nbsp;<span class="op" id="7770129">:=</span>&nbsp;<span class="builtinfunc" id="7770132">make</span><span class="op" id="7770136">(</span><span class="keyword" id="7770137">chan</span>&nbsp;<span class="keyword" id="7770142">struct</span><span class="op" id="7770148">{</span><span class="op" id="7770149">}</span><span class="op" id="7770150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7770153">r</span><span class="op" id="7770154">.</span><span class="ident" id="7770155">quitc</span>&nbsp;<span class="op" id="7770161">&lt;-</span>&nbsp;<span class="ident" id="7770164">resp</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7770170">&lt;-</span><span class="ident" id="7770172">resp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7770178">if</span>&nbsp;<span class="ident" id="7770181">err</span>&nbsp;<span class="op" id="7770185">:=</span>&nbsp;<span class="ident" id="7770188">os</span><span class="op" id="7770190">.</span><span class="ident" id="7770191">RemoveAll</span><span class="op" id="7770200">(</span><span class="ident" id="7770201">r</span><span class="op" id="7770202">.</span><span class="ident" id="7770203">dir</span><span class="op" id="7770206">)</span><span class="op" id="7770207">;</span>&nbsp;<span class="ident" id="7770209">err</span>&nbsp;<span class="op" id="7770213">!=</span>&nbsp;<span class="ident" id="7770216">nil</span>&nbsp;<span class="op" id="7770220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7770224">r</span><span class="op" id="7770225">.</span><span class="ident" id="7770226">Logf</span><span class="op" id="7770230">(</span><span class="string" id="7770231">&#34;failed&nbsp;to&nbsp;remove&nbsp;temp&nbsp;dir&nbsp;%s:&nbsp;%v&#34;</span><span class="op" id="7770265">,</span>&nbsp;<span class="ident" id="7770267">r</span><span class="op" id="7770268">.</span><span class="ident" id="7770269">dir</span><span class="op" id="7770272">,</span>&nbsp;<span class="ident" id="7770274">err</span><span class="op" id="7770277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7770280">}</span><br>
<span class="lineno"></span><span class="op" id="7770282">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="7770285">func</span>&nbsp;<span class="ident" id="7770290">TestReloadResolvConfFail</span><span class="op" id="7770314">(</span><span class="ident" id="7770315">t</span>&nbsp;<span class="op" id="7770317">*</span><span class="ident" id="7770318">testing</span><span class="op" id="7770325">.</span><span class="ident" id="7770326">T</span><span class="op" id="7770327">)</span>&nbsp;<span class="op" id="7770329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7770332">if</span>&nbsp;<span class="ident" id="7770335">testing</span><span class="op" id="7770342">.</span><span class="ident" id="7770343">Short</span><span class="op" id="7770348">(</span><span class="op" id="7770349">)</span>&nbsp;<span class="op" id="7770351">||</span>&nbsp;<span class="op" id="7770354">!</span><span class="op" id="7770355">*</span><span class="ident" id="7770356">testExternal</span>&nbsp;<span class="op" id="7770369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7770373">t</span><span class="op" id="7770374">.</span><span class="ident" id="7770375">Skip</span><span class="op" id="7770379">(</span><span class="string" id="7770380">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="7770421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7770424">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7770428">r</span>&nbsp;<span class="op" id="7770430">:=</span>&nbsp;<span class="ident" id="7770433">newResolvConfTest</span><span class="op" id="7770450">(</span><span class="ident" id="7770451">t</span><span class="op" id="7770452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7770455">defer</span>&nbsp;<span class="ident" id="7770461">r</span><span class="op" id="7770462">.</span><span class="ident" id="7770463">Close</span><span class="op" id="7770468">(</span><span class="op" id="7770469">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7770473">//&nbsp;resolv.conf.tmp&nbsp;does&nbsp;not&nbsp;exist&nbsp;yet</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7770512">r</span><span class="op" id="7770513">.</span><span class="ident" id="7770514">Start</span><span class="op" id="7770519">(</span><span class="op" id="7770520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7770523">if</span>&nbsp;<span class="ident" id="7770526">_</span><span class="op" id="7770527">,</span>&nbsp;<span class="ident" id="7770529">err</span>&nbsp;<span class="op" id="7770533">:=</span>&nbsp;<span class="ident" id="7770536">goLookupIP</span><span class="op" id="7770546">(</span><span class="string" id="7770547">&#34;golang.org&#34;</span><span class="op" id="7770559">)</span><span class="op" id="7770560">;</span>&nbsp;<span class="ident" id="7770562">err</span>&nbsp;<span class="op" id="7770566">==</span>&nbsp;<span class="ident" id="7770569">nil</span>&nbsp;<span class="op" id="7770573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7770577">t</span><span class="op" id="7770578">.</span><span class="ident" id="7770579">Fatal</span><span class="op" id="7770584">(</span><span class="string" id="7770585">&#34;goLookupIP(missing)&nbsp;succeeded&#34;</span><span class="op" id="7770616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7770619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7770623">r</span><span class="op" id="7770624">.</span><span class="ident" id="7770625">SetConf</span><span class="op" id="7770632">(</span><span class="string" id="7770633">&#34;nameserver&nbsp;8.8.8.8&#34;</span><span class="op" id="7770653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7770656">if</span>&nbsp;<span class="ident" id="7770659">_</span><span class="op" id="7770660">,</span>&nbsp;<span class="ident" id="7770662">err</span>&nbsp;<span class="op" id="7770666">:=</span>&nbsp;<span class="ident" id="7770669">goLookupIP</span><span class="op" id="7770679">(</span><span class="string" id="7770680">&#34;golang.org&#34;</span><span class="op" id="7770692">)</span><span class="op" id="7770693">;</span>&nbsp;<span class="ident" id="7770695">err</span>&nbsp;<span class="op" id="7770699">!=</span>&nbsp;<span class="ident" id="7770702">nil</span>&nbsp;<span class="op" id="7770706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7770710">t</span><span class="op" id="7770711">.</span><span class="ident" id="7770712">Fatalf</span><span class="op" id="7770718">(</span><span class="string" id="7770719">&#34;goLookupIP(missing;&nbsp;good)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7770757">,</span>&nbsp;<span class="ident" id="7770759">err</span><span class="op" id="7770762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7770765">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7770769">//&nbsp;Using&nbsp;a&nbsp;bad&nbsp;resolv.conf&nbsp;while&nbsp;we&nbsp;had&nbsp;a&nbsp;good</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7770817">//&nbsp;one&nbsp;before&nbsp;should&nbsp;not&nbsp;update&nbsp;the&nbsp;config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7770861">r</span><span class="op" id="7770862">.</span><span class="ident" id="7770863">SetConf</span><span class="op" id="7770870">(</span><span class="string" id="7770871">&#34;&#34;</span><span class="op" id="7770873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7770876">if</span>&nbsp;<span class="ident" id="7770879">_</span><span class="op" id="7770880">,</span>&nbsp;<span class="ident" id="7770882">err</span>&nbsp;<span class="op" id="7770886">:=</span>&nbsp;<span class="ident" id="7770889">goLookupIP</span><span class="op" id="7770899">(</span><span class="string" id="7770900">&#34;golang.org&#34;</span><span class="op" id="7770912">)</span><span class="op" id="7770913">;</span>&nbsp;<span class="ident" id="7770915">err</span>&nbsp;<span class="op" id="7770919">!=</span>&nbsp;<span class="ident" id="7770922">nil</span>&nbsp;<span class="op" id="7770926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7770930">t</span><span class="op" id="7770931">.</span><span class="ident" id="7770932">Fatalf</span><span class="op" id="7770938">(</span><span class="string" id="7770939">&#34;goLookupIP(missing;&nbsp;good;&nbsp;bad)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7770982">,</span>&nbsp;<span class="ident" id="7770984">err</span><span class="op" id="7770987">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7770990">}</span><br>
<span class="lineno"></span><span class="op" id="7770992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7770995">func</span>&nbsp;<span class="ident" id="7771000">TestReloadResolvConfChange</span><span class="op" id="7771026">(</span><span class="ident" id="7771027">t</span>&nbsp;<span class="op" id="7771029">*</span><span class="ident" id="7771030">testing</span><span class="op" id="7771037">.</span><span class="ident" id="7771038">T</span><span class="op" id="7771039">)</span>&nbsp;<span class="op" id="7771041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7771044">if</span>&nbsp;<span class="ident" id="7771047">testing</span><span class="op" id="7771054">.</span><span class="ident" id="7771055">Short</span><span class="op" id="7771060">(</span><span class="op" id="7771061">)</span>&nbsp;<span class="op" id="7771063">||</span>&nbsp;<span class="op" id="7771066">!</span><span class="op" id="7771067">*</span><span class="ident" id="7771068">testExternal</span>&nbsp;<span class="op" id="7771081">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7771085">t</span><span class="op" id="7771086">.</span><span class="ident" id="7771087">Skip</span><span class="op" id="7771091">(</span><span class="string" id="7771092">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="7771133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7771136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7771140">r</span>&nbsp;<span class="op" id="7771142">:=</span>&nbsp;<span class="ident" id="7771145">newResolvConfTest</span><span class="op" id="7771162">(</span><span class="ident" id="7771163">t</span><span class="op" id="7771164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7771167">defer</span>&nbsp;<span class="ident" id="7771173">r</span><span class="op" id="7771174">.</span><span class="ident" id="7771175">Close</span><span class="op" id="7771180">(</span><span class="op" id="7771181">)</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7771185">r</span><span class="op" id="7771186">.</span><span class="ident" id="7771187">SetConf</span><span class="op" id="7771194">(</span><span class="string" id="7771195">&#34;nameserver&nbsp;8.8.8.8&#34;</span><span class="op" id="7771215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7771218">r</span><span class="op" id="7771219">.</span><span class="ident" id="7771220">Start</span><span class="op" id="7771225">(</span><span class="op" id="7771226">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7771230">if</span>&nbsp;<span class="ident" id="7771233">_</span><span class="op" id="7771234">,</span>&nbsp;<span class="ident" id="7771236">err</span>&nbsp;<span class="op" id="7771240">:=</span>&nbsp;<span class="ident" id="7771243">goLookupIP</span><span class="op" id="7771253">(</span><span class="string" id="7771254">&#34;golang.org&#34;</span><span class="op" id="7771266">)</span><span class="op" id="7771267">;</span>&nbsp;<span class="ident" id="7771269">err</span>&nbsp;<span class="op" id="7771273">!=</span>&nbsp;<span class="ident" id="7771276">nil</span>&nbsp;<span class="op" id="7771280">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7771284">t</span><span class="op" id="7771285">.</span><span class="ident" id="7771286">Fatalf</span><span class="op" id="7771292">(</span><span class="string" id="7771293">&#34;goLookupIP(good)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7771322">,</span>&nbsp;<span class="ident" id="7771324">err</span><span class="op" id="7771327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7771330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7771333">r</span><span class="op" id="7771334">.</span><span class="ident" id="7771335">WantServers</span><span class="op" id="7771346">(</span><span class="op" id="7771347">[</span><span class="op" id="7771348">]</span><span class="builtintype" id="7771349">string</span><span class="op" id="7771355">{</span><span class="string" id="7771356">&#34;8.8.8.8&#34;</span><span class="op" id="7771365">}</span><span class="op" id="7771366">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7771370">//&nbsp;Using&nbsp;a&nbsp;bad&nbsp;resolv.conf&nbsp;when&nbsp;we&nbsp;had&nbsp;a&nbsp;good&nbsp;one</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7771421">//&nbsp;before&nbsp;should&nbsp;not&nbsp;update&nbsp;the&nbsp;config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7771461">r</span><span class="op" id="7771462">.</span><span class="ident" id="7771463">SetConf</span><span class="op" id="7771470">(</span><span class="string" id="7771471">&#34;&#34;</span><span class="op" id="7771473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7771476">if</span>&nbsp;<span class="ident" id="7771479">_</span><span class="op" id="7771480">,</span>&nbsp;<span class="ident" id="7771482">err</span>&nbsp;<span class="op" id="7771486">:=</span>&nbsp;<span class="ident" id="7771489">goLookupIP</span><span class="op" id="7771499">(</span><span class="string" id="7771500">&#34;golang.org&#34;</span><span class="op" id="7771512">)</span><span class="op" id="7771513">;</span>&nbsp;<span class="ident" id="7771515">err</span>&nbsp;<span class="op" id="7771519">!=</span>&nbsp;<span class="ident" id="7771522">nil</span>&nbsp;<span class="op" id="7771526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7771530">t</span><span class="op" id="7771531">.</span><span class="ident" id="7771532">Fatalf</span><span class="op" id="7771538">(</span><span class="string" id="7771539">&#34;goLookupIP(good;&nbsp;bad)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7771573">,</span>&nbsp;<span class="ident" id="7771575">err</span><span class="op" id="7771578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7771581">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7771585">//&nbsp;A&nbsp;new&nbsp;good&nbsp;config&nbsp;should&nbsp;get&nbsp;picked&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7771628">r</span><span class="op" id="7771629">.</span><span class="ident" id="7771630">SetConf</span><span class="op" id="7771637">(</span><span class="string" id="7771638">&#34;nameserver&nbsp;8.8.4.4&#34;</span><span class="op" id="7771658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7771661">r</span><span class="op" id="7771662">.</span><span class="ident" id="7771663">WantServers</span><span class="op" id="7771674">(</span><span class="op" id="7771675">[</span><span class="op" id="7771676">]</span><span class="builtintype" id="7771677">string</span><span class="op" id="7771683">{</span><span class="string" id="7771684">&#34;8.8.4.4&#34;</span><span class="op" id="7771693">}</span><span class="op" id="7771694">)</span><br>
<span class="lineno"></span><span class="op" id="7771696">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="keyword" id="7771699">func</span>&nbsp;<span class="ident" id="7771704">BenchmarkGoLookupIP</span><span class="op" id="7771723">(</span><span class="ident" id="7771724">b</span>&nbsp;<span class="op" id="7771726">*</span><span class="ident" id="7771727">testing</span><span class="op" id="7771734">.</span><span class="ident" id="7771735">B</span><span class="op" id="7771736">)</span>&nbsp;<span class="op" id="7771738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7771741">for</span>&nbsp;<span class="ident" id="7771745">i</span>&nbsp;<span class="op" id="7771747">:=</span>&nbsp;<span class="num" id="7771750">0</span><span class="op" id="7771751">;</span>&nbsp;<span class="ident" id="7771753">i</span>&nbsp;<span class="op" id="7771755">&lt;</span>&nbsp;<span class="ident" id="7771757">b</span><span class="op" id="7771758">.</span><span class="ident" id="7771759">N</span><span class="op" id="7771760">;</span>&nbsp;<span class="ident" id="7771762">i</span><span class="op" id="7771763">++</span>&nbsp;<span class="op" id="7771766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7771770">goLookupIP</span><span class="op" id="7771780">(</span><span class="string" id="7771781">&#34;www.example.com&#34;</span><span class="op" id="7771798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7771801">}</span><br>
<span class="lineno">225</span><span class="op" id="7771803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7771806">func</span>&nbsp;<span class="ident" id="7771811">BenchmarkGoLookupIPNoSuchHost</span><span class="op" id="7771840">(</span><span class="ident" id="7771841">b</span>&nbsp;<span class="op" id="7771843">*</span><span class="ident" id="7771844">testing</span><span class="op" id="7771851">.</span><span class="ident" id="7771852">B</span><span class="op" id="7771853">)</span>&nbsp;<span class="op" id="7771855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7771858">for</span>&nbsp;<span class="ident" id="7771862">i</span>&nbsp;<span class="op" id="7771864">:=</span>&nbsp;<span class="num" id="7771867">0</span><span class="op" id="7771868">;</span>&nbsp;<span class="ident" id="7771870">i</span>&nbsp;<span class="op" id="7771872">&lt;</span>&nbsp;<span class="ident" id="7771874">b</span><span class="op" id="7771875">.</span><span class="ident" id="7771876">N</span><span class="op" id="7771877">;</span>&nbsp;<span class="ident" id="7771879">i</span><span class="op" id="7771880">++</span>&nbsp;<span class="op" id="7771883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7771887">goLookupIP</span><span class="op" id="7771897">(</span><span class="string" id="7771898">&#34;some.nonexistent&#34;</span><span class="op" id="7771916">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7771919">}</span><br>
<span class="lineno"></span><span class="op" id="7771921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7771924">func</span>&nbsp;<span class="ident" id="7771929">BenchmarkGoLookupIPWithBrokenNameServer</span><span class="op" id="7771968">(</span><span class="ident" id="7771969">b</span>&nbsp;<span class="op" id="7771971">*</span><span class="ident" id="7771972">testing</span><span class="op" id="7771979">.</span><span class="ident" id="7771980">B</span><span class="op" id="7771981">)</span>&nbsp;<span class="op" id="7771983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7771986">onceLoadConfig</span><span class="op" id="7772000">.</span><span class="ident" id="7772001">Do</span><span class="op" id="7772003">(</span><span class="ident" id="7772004">loadDefaultConfig</span><span class="op" id="7772021">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7772024">if</span>&nbsp;<span class="ident" id="7772027">cfg</span><span class="op" id="7772030">.</span><span class="ident" id="7772031">dnserr</span>&nbsp;<span class="op" id="7772038">!=</span>&nbsp;<span class="ident" id="7772041">nil</span>&nbsp;<span class="op" id="7772045">||</span>&nbsp;<span class="ident" id="7772048">cfg</span><span class="op" id="7772051">.</span><span class="ident" id="7772052">dnsConfig</span>&nbsp;<span class="op" id="7772062">==</span>&nbsp;<span class="ident" id="7772065">nil</span>&nbsp;<span class="op" id="7772069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7772073">b</span><span class="op" id="7772074">.</span><span class="ident" id="7772075">Fatalf</span><span class="op" id="7772081">(</span><span class="string" id="7772082">&#34;loadConfig&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7772105">,</span>&nbsp;<span class="ident" id="7772107">cfg</span><span class="op" id="7772110">.</span><span class="ident" id="7772111">dnserr</span><span class="op" id="7772117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7772120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7772123">//&nbsp;This&nbsp;looks&nbsp;ugly&nbsp;but&nbsp;it&#39;s&nbsp;safe&nbsp;as&nbsp;long&nbsp;as&nbsp;benchmarks&nbsp;are&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7772187">//&nbsp;sequentially&nbsp;in&nbsp;package&nbsp;testing.</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7772224">orig</span>&nbsp;<span class="op" id="7772229">:=</span>&nbsp;<span class="ident" id="7772232">cfg</span><span class="op" id="7772235">.</span><span class="ident" id="7772236">dnsConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7772247">cfg</span><span class="op" id="7772250">.</span><span class="ident" id="7772251">dnsConfig</span><span class="op" id="7772260">.</span><span class="ident" id="7772261">servers</span>&nbsp;<span class="op" id="7772269">=</span>&nbsp;<span class="builtinfunc" id="7772271">append</span><span class="op" id="7772277">(</span><span class="op" id="7772278">[</span><span class="op" id="7772279">]</span><span class="builtintype" id="7772280">string</span><span class="op" id="7772286">{</span><span class="string" id="7772287">&#34;203.0.113.254&#34;</span><span class="op" id="7772302">}</span><span class="op" id="7772303">,</span>&nbsp;<span class="ident" id="7772305">cfg</span><span class="op" id="7772308">.</span><span class="ident" id="7772309">dnsConfig</span><span class="op" id="7772318">.</span><span class="ident" id="7772319">servers</span><span class="op" id="7772326">...</span><span class="op" id="7772329">)</span>&nbsp;<span class="comment" id="7772331">//&nbsp;use&nbsp;TEST-NET-3&nbsp;block,&nbsp;see&nbsp;RFC&nbsp;5737</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7772370">for</span>&nbsp;<span class="ident" id="7772374">i</span>&nbsp;<span class="op" id="7772376">:=</span>&nbsp;<span class="num" id="7772379">0</span><span class="op" id="7772380">;</span>&nbsp;<span class="ident" id="7772382">i</span>&nbsp;<span class="op" id="7772384">&lt;</span>&nbsp;<span class="ident" id="7772386">b</span><span class="op" id="7772387">.</span><span class="ident" id="7772388">N</span><span class="op" id="7772389">;</span>&nbsp;<span class="ident" id="7772391">i</span><span class="op" id="7772392">++</span>&nbsp;<span class="op" id="7772395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7772399">goLookupIP</span><span class="op" id="7772409">(</span><span class="string" id="7772410">&#34;www.example.com&#34;</span><span class="op" id="7772427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7772430">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7772433">cfg</span><span class="op" id="7772436">.</span><span class="ident" id="7772437">dnsConfig</span>&nbsp;<span class="op" id="7772447">=</span>&nbsp;<span class="ident" id="7772449">orig</span><br>
<span class="lineno"></span><span class="op" id="7772454">}</span>
</div>
</body>
</html>
