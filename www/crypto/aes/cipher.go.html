<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3803073">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3803128">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3803182">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3803233">package</span>&nbsp;<span class="ident" id="3803241">aes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3803246">import</span>&nbsp;<span class="op" id="3803253">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3803256">&#34;crypto/cipher&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3803273">&#34;strconv&#34;</span><br>
<span class="lineno">10</span><span class="op" id="3803283">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3803286">//&nbsp;The&nbsp;AES&nbsp;block&nbsp;size&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="3803318">const</span>&nbsp;<span class="ident" id="3803324">BlockSize</span>&nbsp;<span class="op" id="3803334">=</span>&nbsp;<span class="num" id="3803336">16</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="3803340">//&nbsp;A&nbsp;cipher&nbsp;is&nbsp;an&nbsp;instance&nbsp;of&nbsp;AES&nbsp;encryption&nbsp;using&nbsp;a&nbsp;particular&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3803409">type</span>&nbsp;<span class="ident" id="3803414">aesCipher</span>&nbsp;<span class="keyword" id="3803424">struct</span>&nbsp;<span class="op" id="3803431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3803434">enc</span>&nbsp;<span class="op" id="3803438">[</span><span class="op" id="3803439">]</span><span class="builtintype" id="3803440">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3803448">dec</span>&nbsp;<span class="op" id="3803452">[</span><span class="op" id="3803453">]</span><span class="builtintype" id="3803454">uint32</span><br>
<span class="lineno"></span><span class="op" id="3803461">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="3803464">type</span>&nbsp;<span class="ident" id="3803469">KeySizeError</span>&nbsp;<span class="builtintype" id="3803482">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3803487">func</span>&nbsp;<span class="op" id="3803492">(</span><span class="ident" id="3803493">k</span>&nbsp;<span class="ident" id="3803495">KeySizeError</span><span class="op" id="3803507">)</span>&nbsp;<span class="ident" id="3803509">Error</span><span class="op" id="3803514">(</span><span class="op" id="3803515">)</span>&nbsp;<span class="builtintype" id="3803517">string</span>&nbsp;<span class="op" id="3803524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3803527">return</span>&nbsp;<span class="string" id="3803534">&#34;crypto/aes:&nbsp;invalid&nbsp;key&nbsp;size&nbsp;&#34;</span>&nbsp;<span class="op" id="3803566">+</span>&nbsp;<span class="ident" id="3803568">strconv</span><span class="op" id="3803575">.</span><span class="ident" id="3803576">Itoa</span><span class="op" id="3803580">(</span><span class="builtintype" id="3803581">int</span><span class="op" id="3803584">(</span><span class="ident" id="3803585">k</span><span class="op" id="3803586">)</span><span class="op" id="3803587">)</span><br>
<span class="lineno">25</span><span class="op" id="3803589">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3803592">//&nbsp;NewCipher&nbsp;creates&nbsp;and&nbsp;returns&nbsp;a&nbsp;new&nbsp;cipher.Block.</span><br>
<span class="lineno"></span><span class="comment" id="3803645">//&nbsp;The&nbsp;key&nbsp;argument&nbsp;should&nbsp;be&nbsp;the&nbsp;AES&nbsp;key,</span><br>
<span class="lineno"></span><span class="comment" id="3803688">//&nbsp;either&nbsp;16,&nbsp;24,&nbsp;or&nbsp;32&nbsp;bytes&nbsp;to&nbsp;select</span><br>
<span class="lineno">30</span><span class="comment" id="3803728">//&nbsp;AES-128,&nbsp;AES-192,&nbsp;or&nbsp;AES-256.</span><br>
<span class="lineno"></span><span class="keyword" id="3803761">func</span>&nbsp;<span class="ident" id="3803766">NewCipher</span><span class="op" id="3803775">(</span><span class="ident" id="3803776">key</span>&nbsp;<span class="op" id="3803780">[</span><span class="op" id="3803781">]</span><span class="builtintype" id="3803782">byte</span><span class="op" id="3803786">)</span>&nbsp;<span class="op" id="3803788">(</span><span class="ident" id="3803789">cipher</span><span class="op" id="3803795">.</span><span class="ident" id="3803796">Block</span><span class="op" id="3803801">,</span>&nbsp;<span class="builtintype" id="3803803">error</span><span class="op" id="3803808">)</span>&nbsp;<span class="op" id="3803810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3803813">k</span>&nbsp;<span class="op" id="3803815">:=</span>&nbsp;<span class="builtinfunc" id="3803818">len</span><span class="op" id="3803821">(</span><span class="ident" id="3803822">key</span><span class="op" id="3803825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3803828">switch</span>&nbsp;<span class="ident" id="3803835">k</span>&nbsp;<span class="op" id="3803837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3803840">default</span><span class="op" id="3803847">:</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3803851">return</span>&nbsp;<span class="ident" id="3803858">nil</span><span class="op" id="3803861">,</span>&nbsp;<span class="ident" id="3803863">KeySizeError</span><span class="op" id="3803875">(</span><span class="ident" id="3803876">k</span><span class="op" id="3803877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3803880">case</span>&nbsp;<span class="num" id="3803885">16</span><span class="op" id="3803887">,</span>&nbsp;<span class="num" id="3803889">24</span><span class="op" id="3803891">,</span>&nbsp;<span class="num" id="3803893">32</span><span class="op" id="3803895">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3803899">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3803906">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3803910">n</span>&nbsp;<span class="op" id="3803912">:=</span>&nbsp;<span class="ident" id="3803915">k</span>&nbsp;<span class="op" id="3803917">+</span>&nbsp;<span class="num" id="3803919">28</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3803923">c</span>&nbsp;<span class="op" id="3803925">:=</span>&nbsp;<span class="op" id="3803928">&amp;</span><span class="ident" id="3803929">aesCipher</span><span class="op" id="3803938">{</span><span class="builtinfunc" id="3803939">make</span><span class="op" id="3803943">(</span><span class="op" id="3803944">[</span><span class="op" id="3803945">]</span><span class="builtintype" id="3803946">uint32</span><span class="op" id="3803952">,</span>&nbsp;<span class="ident" id="3803954">n</span><span class="op" id="3803955">)</span><span class="op" id="3803956">,</span>&nbsp;<span class="builtinfunc" id="3803958">make</span><span class="op" id="3803962">(</span><span class="op" id="3803963">[</span><span class="op" id="3803964">]</span><span class="builtintype" id="3803965">uint32</span><span class="op" id="3803971">,</span>&nbsp;<span class="ident" id="3803973">n</span><span class="op" id="3803974">)</span><span class="op" id="3803975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3803978">expandKey</span><span class="op" id="3803987">(</span><span class="ident" id="3803988">key</span><span class="op" id="3803991">,</span>&nbsp;<span class="ident" id="3803993">c</span><span class="op" id="3803994">.</span><span class="ident" id="3803995">enc</span><span class="op" id="3803998">,</span>&nbsp;<span class="ident" id="3804000">c</span><span class="op" id="3804001">.</span><span class="ident" id="3804002">dec</span><span class="op" id="3804005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804008">return</span>&nbsp;<span class="ident" id="3804015">c</span><span class="op" id="3804016">,</span>&nbsp;<span class="ident" id="3804018">nil</span><br>
<span class="lineno"></span><span class="op" id="3804022">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="3804025">func</span>&nbsp;<span class="op" id="3804030">(</span><span class="ident" id="3804031">c</span>&nbsp;<span class="op" id="3804033">*</span><span class="ident" id="3804034">aesCipher</span><span class="op" id="3804043">)</span>&nbsp;<span class="ident" id="3804045">BlockSize</span><span class="op" id="3804054">(</span><span class="op" id="3804055">)</span>&nbsp;<span class="builtintype" id="3804057">int</span>&nbsp;<span class="op" id="3804061">{</span>&nbsp;<span class="keyword" id="3804063">return</span>&nbsp;<span class="ident" id="3804070">BlockSize</span>&nbsp;<span class="op" id="3804080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3804083">func</span>&nbsp;<span class="op" id="3804088">(</span><span class="ident" id="3804089">c</span>&nbsp;<span class="op" id="3804091">*</span><span class="ident" id="3804092">aesCipher</span><span class="op" id="3804101">)</span>&nbsp;<span class="ident" id="3804103">Encrypt</span><span class="op" id="3804110">(</span><span class="ident" id="3804111">dst</span><span class="op" id="3804114">,</span>&nbsp;<span class="ident" id="3804116">src</span>&nbsp;<span class="op" id="3804120">[</span><span class="op" id="3804121">]</span><span class="builtintype" id="3804122">byte</span><span class="op" id="3804126">)</span>&nbsp;<span class="op" id="3804128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804131">if</span>&nbsp;<span class="builtinfunc" id="3804134">len</span><span class="op" id="3804137">(</span><span class="ident" id="3804138">src</span><span class="op" id="3804141">)</span>&nbsp;<span class="op" id="3804143">&lt;</span>&nbsp;<span class="ident" id="3804145">BlockSize</span>&nbsp;<span class="op" id="3804155">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3804159">panic</span><span class="op" id="3804164">(</span><span class="string" id="3804165">&#34;crypto/aes:&nbsp;input&nbsp;not&nbsp;full&nbsp;block&#34;</span><span class="op" id="3804199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3804202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804205">if</span>&nbsp;<span class="builtinfunc" id="3804208">len</span><span class="op" id="3804211">(</span><span class="ident" id="3804212">dst</span><span class="op" id="3804215">)</span>&nbsp;<span class="op" id="3804217">&lt;</span>&nbsp;<span class="ident" id="3804219">BlockSize</span>&nbsp;<span class="op" id="3804229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3804233">panic</span><span class="op" id="3804238">(</span><span class="string" id="3804239">&#34;crypto/aes:&nbsp;output&nbsp;not&nbsp;full&nbsp;block&#34;</span><span class="op" id="3804274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3804277">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3804280">encryptBlock</span><span class="op" id="3804292">(</span><span class="ident" id="3804293">c</span><span class="op" id="3804294">.</span><span class="ident" id="3804295">enc</span><span class="op" id="3804298">,</span>&nbsp;<span class="ident" id="3804300">dst</span><span class="op" id="3804303">,</span>&nbsp;<span class="ident" id="3804305">src</span><span class="op" id="3804308">)</span><br>
<span class="lineno"></span><span class="op" id="3804310">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3804313">func</span>&nbsp;<span class="op" id="3804318">(</span><span class="ident" id="3804319">c</span>&nbsp;<span class="op" id="3804321">*</span><span class="ident" id="3804322">aesCipher</span><span class="op" id="3804331">)</span>&nbsp;<span class="ident" id="3804333">Decrypt</span><span class="op" id="3804340">(</span><span class="ident" id="3804341">dst</span><span class="op" id="3804344">,</span>&nbsp;<span class="ident" id="3804346">src</span>&nbsp;<span class="op" id="3804350">[</span><span class="op" id="3804351">]</span><span class="builtintype" id="3804352">byte</span><span class="op" id="3804356">)</span>&nbsp;<span class="op" id="3804358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804361">if</span>&nbsp;<span class="builtinfunc" id="3804364">len</span><span class="op" id="3804367">(</span><span class="ident" id="3804368">src</span><span class="op" id="3804371">)</span>&nbsp;<span class="op" id="3804373">&lt;</span>&nbsp;<span class="ident" id="3804375">BlockSize</span>&nbsp;<span class="op" id="3804385">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3804389">panic</span><span class="op" id="3804394">(</span><span class="string" id="3804395">&#34;crypto/aes:&nbsp;input&nbsp;not&nbsp;full&nbsp;block&#34;</span><span class="op" id="3804429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3804432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804435">if</span>&nbsp;<span class="builtinfunc" id="3804438">len</span><span class="op" id="3804441">(</span><span class="ident" id="3804442">dst</span><span class="op" id="3804445">)</span>&nbsp;<span class="op" id="3804447">&lt;</span>&nbsp;<span class="ident" id="3804449">BlockSize</span>&nbsp;<span class="op" id="3804459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3804463">panic</span><span class="op" id="3804468">(</span><span class="string" id="3804469">&#34;crypto/aes:&nbsp;output&nbsp;not&nbsp;full&nbsp;block&#34;</span><span class="op" id="3804504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3804507">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3804510">decryptBlock</span><span class="op" id="3804522">(</span><span class="ident" id="3804523">c</span><span class="op" id="3804524">.</span><span class="ident" id="3804525">dec</span><span class="op" id="3804528">,</span>&nbsp;<span class="ident" id="3804530">dst</span><span class="op" id="3804533">,</span>&nbsp;<span class="ident" id="3804535">src</span><span class="op" id="3804538">)</span><br>
<span class="lineno"></span><span class="op" id="3804540">}</span>
</div>
</body>
</html>
