<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/tar</h2>
<ul>
<li><a href="/gostd/archive/tar/common.go.html">common.go</a></li>
<li><a href="/gostd/archive/tar/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/tar/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/tar/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/tar/stat_atim.go.html">stat_atim.go</a></li>
<li><a href="/gostd/archive/tar/stat_unix.go.html">stat_unix.go</a></li>
<li><a href="/gostd/archive/tar/tar_test.go.html">tar_test.go</a></li>
<li><a href="/gostd/archive/tar/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/tar/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6472591">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6472646">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6472700">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6472751">package</span>&nbsp;<span class="ident" id="6472759">tar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6472764">import</span>&nbsp;<span class="op" id="6472771">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6472774">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6472783">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6472790">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6472796">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6472809">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6472815">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6472826">&#34;strings&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6472837">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6472848">&#34;testing/iotest&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6472866">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6472873">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="6472876">type</span>&nbsp;<span class="ident" id="6472881">writerTestEntry</span>&nbsp;<span class="keyword" id="6472897">struct</span>&nbsp;<span class="op" id="6472904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6472907">header</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6472916">*</span><span class="ident" id="6472917">Header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6472925">contents</span>&nbsp;<span class="builtintype" id="6472934">string</span><br>
<span class="lineno"></span><span class="op" id="6472941">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="6472944">type</span>&nbsp;<span class="ident" id="6472949">writerTest</span>&nbsp;<span class="keyword" id="6472960">struct</span>&nbsp;<span class="op" id="6472967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6472970">file</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6472978">string</span>&nbsp;<span class="comment" id="6472985">//&nbsp;filename&nbsp;of&nbsp;expected&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6473017">entries</span>&nbsp;<span class="op" id="6473025">[</span><span class="op" id="6473026">]</span><span class="op" id="6473027">*</span><span class="ident" id="6473028">writerTestEntry</span><br>
<span class="lineno"></span><span class="op" id="6473044">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="6473047">var</span>&nbsp;<span class="ident" id="6473051">writerTests</span>&nbsp;<span class="op" id="6473063">=</span>&nbsp;<span class="op" id="6473065">[</span><span class="op" id="6473066">]</span><span class="op" id="6473067">*</span><span class="ident" id="6473068">writerTest</span><span class="op" id="6473078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6473081">//&nbsp;The&nbsp;writer&nbsp;test&nbsp;file&nbsp;was&nbsp;produced&nbsp;with&nbsp;this&nbsp;command:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6473138">//&nbsp;tar&nbsp;(GNU&nbsp;tar)&nbsp;1.26</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6473161">//&nbsp;&nbsp;&nbsp;ln&nbsp;-s&nbsp;small.txt&nbsp;link.txt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6473192">//&nbsp;&nbsp;&nbsp;tar&nbsp;-b&nbsp;1&nbsp;--format=ustar&nbsp;-c&nbsp;-f&nbsp;writer.tar&nbsp;small.txt&nbsp;small2.txt&nbsp;link.txt</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6473269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6473273">file</span><span class="op" id="6473277">:</span>&nbsp;<span class="string" id="6473279">&#34;testdata/writer.tar&#34;</span><span class="op" id="6473300">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6473304">entries</span><span class="op" id="6473311">:</span>&nbsp;<span class="op" id="6473313">[</span><span class="op" id="6473314">]</span><span class="op" id="6473315">*</span><span class="ident" id="6473316">writerTestEntry</span><span class="op" id="6473331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6473336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6473342">header</span><span class="op" id="6473348">:</span>&nbsp;<span class="op" id="6473350">&amp;</span><span class="ident" id="6473351">Header</span><span class="op" id="6473357">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6473364">Name</span><span class="op" id="6473368">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6473374">&#34;small.txt&#34;</span><span class="op" id="6473385">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6473392">Mode</span><span class="op" id="6473396">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6473402">0640</span><span class="op" id="6473406">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6473413">Uid</span><span class="op" id="6473416">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6473423">73025</span><span class="op" id="6473428">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6473435">Gid</span><span class="op" id="6473438">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6473445">5000</span><span class="op" id="6473449">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6473456">Size</span><span class="op" id="6473460">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6473466">5</span><span class="op" id="6473467">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6473474">ModTime</span><span class="op" id="6473481">:</span>&nbsp;&nbsp;<span class="ident" id="6473484">time</span><span class="op" id="6473488">.</span><span class="ident" id="6473489">Unix</span><span class="op" id="6473493">(</span><span class="num" id="6473494">1246508266</span><span class="op" id="6473504">,</span>&nbsp;<span class="num" id="6473506">0</span><span class="op" id="6473507">)</span><span class="op" id="6473508">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6473515">Typeflag</span><span class="op" id="6473523">:</span>&nbsp;<span class="string" id="6473525">&#39;0&#39;</span><span class="op" id="6473528">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6473535">Uname</span><span class="op" id="6473540">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6473545">&#34;dsymonds&#34;</span><span class="op" id="6473555">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6473562">Gname</span><span class="op" id="6473567">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6473572">&#34;eng&#34;</span><span class="op" id="6473577">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6473583">}</span><span class="op" id="6473584">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6473590">contents</span><span class="op" id="6473598">:</span>&nbsp;<span class="string" id="6473600">&#34;Kilts&#34;</span><span class="op" id="6473607">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6473612">}</span><span class="op" id="6473613">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6473618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6473624">header</span><span class="op" id="6473630">:</span>&nbsp;<span class="op" id="6473632">&amp;</span><span class="ident" id="6473633">Header</span><span class="op" id="6473639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6473646">Name</span><span class="op" id="6473650">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6473656">&#34;small2.txt&#34;</span><span class="op" id="6473668">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6473675">Mode</span><span class="op" id="6473679">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6473685">0640</span><span class="op" id="6473689">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6473696">Uid</span><span class="op" id="6473699">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6473706">73025</span><span class="op" id="6473711">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6473718">Gid</span><span class="op" id="6473721">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6473728">5000</span><span class="op" id="6473732">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6473739">Size</span><span class="op" id="6473743">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6473749">11</span><span class="op" id="6473751">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6473758">ModTime</span><span class="op" id="6473765">:</span>&nbsp;&nbsp;<span class="ident" id="6473768">time</span><span class="op" id="6473772">.</span><span class="ident" id="6473773">Unix</span><span class="op" id="6473777">(</span><span class="num" id="6473778">1245217492</span><span class="op" id="6473788">,</span>&nbsp;<span class="num" id="6473790">0</span><span class="op" id="6473791">)</span><span class="op" id="6473792">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6473799">Typeflag</span><span class="op" id="6473807">:</span>&nbsp;<span class="string" id="6473809">&#39;0&#39;</span><span class="op" id="6473812">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6473819">Uname</span><span class="op" id="6473824">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6473829">&#34;dsymonds&#34;</span><span class="op" id="6473839">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6473846">Gname</span><span class="op" id="6473851">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6473856">&#34;eng&#34;</span><span class="op" id="6473861">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6473867">}</span><span class="op" id="6473868">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6473874">contents</span><span class="op" id="6473882">:</span>&nbsp;<span class="string" id="6473884">&#34;Google.com\n&#34;</span><span class="op" id="6473898">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6473903">}</span><span class="op" id="6473904">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6473909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6473915">header</span><span class="op" id="6473921">:</span>&nbsp;<span class="op" id="6473923">&amp;</span><span class="ident" id="6473924">Header</span><span class="op" id="6473930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6473937">Name</span><span class="op" id="6473941">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6473947">&#34;link.txt&#34;</span><span class="op" id="6473957">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6473964">Mode</span><span class="op" id="6473968">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6473974">0777</span><span class="op" id="6473978">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6473985">Uid</span><span class="op" id="6473988">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6473995">1000</span><span class="op" id="6473999">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6474006">Gid</span><span class="op" id="6474009">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6474016">1000</span><span class="op" id="6474020">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6474027">Size</span><span class="op" id="6474031">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6474037">0</span><span class="op" id="6474038">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6474045">ModTime</span><span class="op" id="6474052">:</span>&nbsp;&nbsp;<span class="ident" id="6474055">time</span><span class="op" id="6474059">.</span><span class="ident" id="6474060">Unix</span><span class="op" id="6474064">(</span><span class="num" id="6474065">1314603082</span><span class="op" id="6474075">,</span>&nbsp;<span class="num" id="6474077">0</span><span class="op" id="6474078">)</span><span class="op" id="6474079">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6474086">Typeflag</span><span class="op" id="6474094">:</span>&nbsp;<span class="string" id="6474096">&#39;2&#39;</span><span class="op" id="6474099">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6474106">Linkname</span><span class="op" id="6474114">:</span>&nbsp;<span class="string" id="6474116">&#34;small.txt&#34;</span><span class="op" id="6474127">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6474134">Uname</span><span class="op" id="6474139">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6474144">&#34;strings&#34;</span><span class="op" id="6474153">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6474160">Gname</span><span class="op" id="6474165">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6474170">&#34;strings&#34;</span><span class="op" id="6474179">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6474185">}</span><span class="op" id="6474186">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6474192">//&nbsp;no&nbsp;contents</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6474210">}</span><span class="op" id="6474211">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6474215">}</span><span class="op" id="6474216">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6474219">}</span><span class="op" id="6474220">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6474223">//&nbsp;The&nbsp;truncated&nbsp;test&nbsp;file&nbsp;was&nbsp;produced&nbsp;using&nbsp;these&nbsp;commands:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6474286">//&nbsp;&nbsp;&nbsp;dd&nbsp;if=/dev/zero&nbsp;bs=1048576&nbsp;count=16384&nbsp;&gt;&nbsp;/tmp/16gig.txt</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6474348">//&nbsp;&nbsp;&nbsp;tar&nbsp;-b&nbsp;1&nbsp;-c&nbsp;-f-&nbsp;/tmp/16gig.txt&nbsp;|&nbsp;dd&nbsp;bs=512&nbsp;count=8&nbsp;&gt;&nbsp;writer-big.tar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6474422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6474426">file</span><span class="op" id="6474430">:</span>&nbsp;<span class="string" id="6474432">&#34;testdata/writer-big.tar&#34;</span><span class="op" id="6474457">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6474461">entries</span><span class="op" id="6474468">:</span>&nbsp;<span class="op" id="6474470">[</span><span class="op" id="6474471">]</span><span class="op" id="6474472">*</span><span class="ident" id="6474473">writerTestEntry</span><span class="op" id="6474488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6474493">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6474499">header</span><span class="op" id="6474505">:</span>&nbsp;<span class="op" id="6474507">&amp;</span><span class="ident" id="6474508">Header</span><span class="op" id="6474514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6474521">Name</span><span class="op" id="6474525">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6474531">&#34;tmp/16gig.txt&#34;</span><span class="op" id="6474546">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6474553">Mode</span><span class="op" id="6474557">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6474563">0640</span><span class="op" id="6474567">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6474574">Uid</span><span class="op" id="6474577">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6474584">73025</span><span class="op" id="6474589">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6474596">Gid</span><span class="op" id="6474599">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6474606">5000</span><span class="op" id="6474610">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6474617">Size</span><span class="op" id="6474621">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6474627">16</span>&nbsp;<span class="op" id="6474630">&lt;&lt;</span>&nbsp;<span class="num" id="6474633">30</span><span class="op" id="6474635">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6474642">ModTime</span><span class="op" id="6474649">:</span>&nbsp;&nbsp;<span class="ident" id="6474652">time</span><span class="op" id="6474656">.</span><span class="ident" id="6474657">Unix</span><span class="op" id="6474661">(</span><span class="num" id="6474662">1254699560</span><span class="op" id="6474672">,</span>&nbsp;<span class="num" id="6474674">0</span><span class="op" id="6474675">)</span><span class="op" id="6474676">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6474683">Typeflag</span><span class="op" id="6474691">:</span>&nbsp;<span class="string" id="6474693">&#39;0&#39;</span><span class="op" id="6474696">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6474703">Uname</span><span class="op" id="6474708">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6474713">&#34;dsymonds&#34;</span><span class="op" id="6474723">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6474730">Gname</span><span class="op" id="6474735">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6474740">&#34;eng&#34;</span><span class="op" id="6474745">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6474751">}</span><span class="op" id="6474752">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6474758">//&nbsp;fake&nbsp;contents</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6474779">contents</span><span class="op" id="6474787">:</span>&nbsp;<span class="ident" id="6474789">strings</span><span class="op" id="6474796">.</span><span class="ident" id="6474797">Repeat</span><span class="op" id="6474803">(</span><span class="string" id="6474804">&#34;\x00&#34;</span><span class="op" id="6474810">,</span>&nbsp;<span class="num" id="6474812">4</span><span class="op" id="6474813">&lt;&lt;</span><span class="num" id="6474815">10</span><span class="op" id="6474817">)</span><span class="op" id="6474818">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6474823">}</span><span class="op" id="6474824">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6474828">}</span><span class="op" id="6474829">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6474832">}</span><span class="op" id="6474833">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6474836">//&nbsp;The&nbsp;truncated&nbsp;test&nbsp;file&nbsp;was&nbsp;produced&nbsp;using&nbsp;these&nbsp;commands:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6474899">//&nbsp;&nbsp;&nbsp;dd&nbsp;if=/dev/zero&nbsp;bs=1048576&nbsp;count=16384&nbsp;&gt;&nbsp;(longname/)*15&nbsp;/16gig.txt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6474972">//&nbsp;&nbsp;&nbsp;tar&nbsp;-b&nbsp;1&nbsp;-c&nbsp;-f-&nbsp;(longname/)*15&nbsp;/16gig.txt&nbsp;|&nbsp;dd&nbsp;bs=512&nbsp;count=8&nbsp;&gt;&nbsp;writer-big-long.tar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6475062">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6475066">file</span><span class="op" id="6475070">:</span>&nbsp;<span class="string" id="6475072">&#34;testdata/writer-big-long.tar&#34;</span><span class="op" id="6475102">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6475106">entries</span><span class="op" id="6475113">:</span>&nbsp;<span class="op" id="6475115">[</span><span class="op" id="6475116">]</span><span class="op" id="6475117">*</span><span class="ident" id="6475118">writerTestEntry</span><span class="op" id="6475133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6475138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6475144">header</span><span class="op" id="6475150">:</span>&nbsp;<span class="op" id="6475152">&amp;</span><span class="ident" id="6475153">Header</span><span class="op" id="6475159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6475166">Name</span><span class="op" id="6475170">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6475176">strings</span><span class="op" id="6475183">.</span><span class="ident" id="6475184">Repeat</span><span class="op" id="6475190">(</span><span class="string" id="6475191">&#34;longname/&#34;</span><span class="op" id="6475202">,</span>&nbsp;<span class="num" id="6475204">15</span><span class="op" id="6475206">)</span>&nbsp;<span class="op" id="6475208">+</span>&nbsp;<span class="string" id="6475210">&#34;16gig.txt&#34;</span><span class="op" id="6475221">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6475228">Mode</span><span class="op" id="6475232">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6475238">0644</span><span class="op" id="6475242">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6475249">Uid</span><span class="op" id="6475252">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6475259">1000</span><span class="op" id="6475263">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6475270">Gid</span><span class="op" id="6475273">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6475280">1000</span><span class="op" id="6475284">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6475291">Size</span><span class="op" id="6475295">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6475301">16</span>&nbsp;<span class="op" id="6475304">&lt;&lt;</span>&nbsp;<span class="num" id="6475307">30</span><span class="op" id="6475309">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6475316">ModTime</span><span class="op" id="6475323">:</span>&nbsp;&nbsp;<span class="ident" id="6475326">time</span><span class="op" id="6475330">.</span><span class="ident" id="6475331">Unix</span><span class="op" id="6475335">(</span><span class="num" id="6475336">1399583047</span><span class="op" id="6475346">,</span>&nbsp;<span class="num" id="6475348">0</span><span class="op" id="6475349">)</span><span class="op" id="6475350">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6475357">Typeflag</span><span class="op" id="6475365">:</span>&nbsp;<span class="string" id="6475367">&#39;0&#39;</span><span class="op" id="6475370">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6475377">Uname</span><span class="op" id="6475382">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6475387">&#34;guillaume&#34;</span><span class="op" id="6475398">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6475405">Gname</span><span class="op" id="6475410">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6475415">&#34;guillaume&#34;</span><span class="op" id="6475426">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6475432">}</span><span class="op" id="6475433">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6475439">//&nbsp;fake&nbsp;contents</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6475460">contents</span><span class="op" id="6475468">:</span>&nbsp;<span class="ident" id="6475470">strings</span><span class="op" id="6475477">.</span><span class="ident" id="6475478">Repeat</span><span class="op" id="6475484">(</span><span class="string" id="6475485">&#34;\x00&#34;</span><span class="op" id="6475491">,</span>&nbsp;<span class="num" id="6475493">4</span><span class="op" id="6475494">&lt;&lt;</span><span class="num" id="6475496">10</span><span class="op" id="6475498">)</span><span class="op" id="6475499">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6475504">}</span><span class="op" id="6475505">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6475509">}</span><span class="op" id="6475510">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6475513">}</span><span class="op" id="6475514">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6475517">//&nbsp;This&nbsp;file&nbsp;was&nbsp;produced&nbsp;using&nbsp;gnu&nbsp;tar&nbsp;1.17</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6475563">//&nbsp;gnutar&nbsp;&nbsp;-b&nbsp;4&nbsp;--format=ustar&nbsp;(longname/)*15&nbsp;+&nbsp;file.txt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6475621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6475625">file</span><span class="op" id="6475629">:</span>&nbsp;<span class="string" id="6475631">&#34;testdata/ustar.tar&#34;</span><span class="op" id="6475651">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6475655">entries</span><span class="op" id="6475662">:</span>&nbsp;<span class="op" id="6475664">[</span><span class="op" id="6475665">]</span><span class="op" id="6475666">*</span><span class="ident" id="6475667">writerTestEntry</span><span class="op" id="6475682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6475687">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6475693">header</span><span class="op" id="6475699">:</span>&nbsp;<span class="op" id="6475701">&amp;</span><span class="ident" id="6475702">Header</span><span class="op" id="6475708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6475715">Name</span><span class="op" id="6475719">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6475725">strings</span><span class="op" id="6475732">.</span><span class="ident" id="6475733">Repeat</span><span class="op" id="6475739">(</span><span class="string" id="6475740">&#34;longname/&#34;</span><span class="op" id="6475751">,</span>&nbsp;<span class="num" id="6475753">15</span><span class="op" id="6475755">)</span>&nbsp;<span class="op" id="6475757">+</span>&nbsp;<span class="string" id="6475759">&#34;file.txt&#34;</span><span class="op" id="6475769">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6475776">Mode</span><span class="op" id="6475780">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6475786">0644</span><span class="op" id="6475790">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6475797">Uid</span><span class="op" id="6475800">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6475807">0765</span><span class="op" id="6475811">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6475818">Gid</span><span class="op" id="6475821">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6475828">024</span><span class="op" id="6475831">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6475838">Size</span><span class="op" id="6475842">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6475848">06</span><span class="op" id="6475850">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6475857">ModTime</span><span class="op" id="6475864">:</span>&nbsp;&nbsp;<span class="ident" id="6475867">time</span><span class="op" id="6475871">.</span><span class="ident" id="6475872">Unix</span><span class="op" id="6475876">(</span><span class="num" id="6475877">1360135598</span><span class="op" id="6475887">,</span>&nbsp;<span class="num" id="6475889">0</span><span class="op" id="6475890">)</span><span class="op" id="6475891">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6475898">Typeflag</span><span class="op" id="6475906">:</span>&nbsp;<span class="string" id="6475908">&#39;0&#39;</span><span class="op" id="6475911">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6475918">Uname</span><span class="op" id="6475923">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6475928">&#34;shane&#34;</span><span class="op" id="6475935">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6475942">Gname</span><span class="op" id="6475947">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6475952">&#34;staff&#34;</span><span class="op" id="6475959">,</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6475965">}</span><span class="op" id="6475966">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6475972">contents</span><span class="op" id="6475980">:</span>&nbsp;<span class="string" id="6475982">&#34;hello\n&#34;</span><span class="op" id="6475991">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6475996">}</span><span class="op" id="6475997">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6476001">}</span><span class="op" id="6476002">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6476005">}</span><span class="op" id="6476006">,</span><br>
<span class="lineno">150</span><span class="op" id="6476008">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6476011">//&nbsp;Render&nbsp;byte&nbsp;array&nbsp;in&nbsp;a&nbsp;two-character&nbsp;hexadecimal&nbsp;string,&nbsp;spaced&nbsp;for&nbsp;easy&nbsp;visual&nbsp;inspection.</span><br>
<span class="lineno"></span><span class="keyword" id="6476106">func</span>&nbsp;<span class="ident" id="6476111">bytestr</span><span class="op" id="6476118">(</span><span class="ident" id="6476119">offset</span>&nbsp;<span class="builtintype" id="6476126">int</span><span class="op" id="6476129">,</span>&nbsp;<span class="ident" id="6476131">b</span>&nbsp;<span class="op" id="6476133">[</span><span class="op" id="6476134">]</span><span class="builtintype" id="6476135">byte</span><span class="op" id="6476139">)</span>&nbsp;<span class="builtintype" id="6476141">string</span>&nbsp;<span class="op" id="6476148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6476151">const</span>&nbsp;<span class="ident" id="6476157">rowLen</span>&nbsp;<span class="op" id="6476164">=</span>&nbsp;<span class="num" id="6476166">32</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6476170">s</span>&nbsp;<span class="op" id="6476172">:=</span>&nbsp;<span class="ident" id="6476175">fmt</span><span class="op" id="6476178">.</span><span class="ident" id="6476179">Sprintf</span><span class="op" id="6476186">(</span><span class="string" id="6476187">&#34;%04x&nbsp;&#34;</span><span class="op" id="6476194">,</span>&nbsp;<span class="ident" id="6476196">offset</span><span class="op" id="6476202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6476205">for</span>&nbsp;<span class="ident" id="6476209">_</span><span class="op" id="6476210">,</span>&nbsp;<span class="ident" id="6476212">ch</span>&nbsp;<span class="op" id="6476215">:=</span>&nbsp;<span class="keyword" id="6476218">range</span>&nbsp;<span class="ident" id="6476224">b</span>&nbsp;<span class="op" id="6476226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6476230">switch</span>&nbsp;<span class="op" id="6476237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6476241">case</span>&nbsp;<span class="string" id="6476246">&#39;0&#39;</span>&nbsp;<span class="op" id="6476250">&lt;=</span>&nbsp;<span class="ident" id="6476253">ch</span>&nbsp;<span class="op" id="6476256">&amp;&amp;</span>&nbsp;<span class="ident" id="6476259">ch</span>&nbsp;<span class="op" id="6476262">&lt;=</span>&nbsp;<span class="string" id="6476265">&#39;9&#39;</span><span class="op" id="6476268">,</span>&nbsp;<span class="string" id="6476270">&#39;A&#39;</span>&nbsp;<span class="op" id="6476274">&lt;=</span>&nbsp;<span class="ident" id="6476277">ch</span>&nbsp;<span class="op" id="6476280">&amp;&amp;</span>&nbsp;<span class="ident" id="6476283">ch</span>&nbsp;<span class="op" id="6476286">&lt;=</span>&nbsp;<span class="string" id="6476289">&#39;Z&#39;</span><span class="op" id="6476292">,</span>&nbsp;<span class="string" id="6476294">&#39;a&#39;</span>&nbsp;<span class="op" id="6476298">&lt;=</span>&nbsp;<span class="ident" id="6476301">ch</span>&nbsp;<span class="op" id="6476304">&amp;&amp;</span>&nbsp;<span class="ident" id="6476307">ch</span>&nbsp;<span class="op" id="6476310">&lt;=</span>&nbsp;<span class="string" id="6476313">&#39;z&#39;</span><span class="op" id="6476316">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6476321">s</span>&nbsp;<span class="op" id="6476323">+=</span>&nbsp;<span class="ident" id="6476326">fmt</span><span class="op" id="6476329">.</span><span class="ident" id="6476330">Sprintf</span><span class="op" id="6476337">(</span><span class="string" id="6476338">&#34;&nbsp;&nbsp;%c&#34;</span><span class="op" id="6476344">,</span>&nbsp;<span class="ident" id="6476346">ch</span><span class="op" id="6476348">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6476352">default</span><span class="op" id="6476359">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6476364">s</span>&nbsp;<span class="op" id="6476366">+=</span>&nbsp;<span class="ident" id="6476369">fmt</span><span class="op" id="6476372">.</span><span class="ident" id="6476373">Sprintf</span><span class="op" id="6476380">(</span><span class="string" id="6476381">&#34;&nbsp;%02x&#34;</span><span class="op" id="6476388">,</span>&nbsp;<span class="ident" id="6476390">ch</span><span class="op" id="6476392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6476396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6476399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6476402">return</span>&nbsp;<span class="ident" id="6476409">s</span><br>
<span class="lineno">165</span><span class="op" id="6476411">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6476414">//&nbsp;Render&nbsp;a&nbsp;pseudo-diff&nbsp;between&nbsp;two&nbsp;blocks&nbsp;of&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="6476467">func</span>&nbsp;<span class="ident" id="6476472">bytediff</span><span class="op" id="6476480">(</span><span class="ident" id="6476481">a</span>&nbsp;<span class="op" id="6476483">[</span><span class="op" id="6476484">]</span><span class="builtintype" id="6476485">byte</span><span class="op" id="6476489">,</span>&nbsp;<span class="ident" id="6476491">b</span>&nbsp;<span class="op" id="6476493">[</span><span class="op" id="6476494">]</span><span class="builtintype" id="6476495">byte</span><span class="op" id="6476499">)</span>&nbsp;<span class="builtintype" id="6476501">string</span>&nbsp;<span class="op" id="6476508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6476511">const</span>&nbsp;<span class="ident" id="6476517">rowLen</span>&nbsp;<span class="op" id="6476524">=</span>&nbsp;<span class="num" id="6476526">32</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6476530">s</span>&nbsp;<span class="op" id="6476532">:=</span>&nbsp;<span class="ident" id="6476535">fmt</span><span class="op" id="6476538">.</span><span class="ident" id="6476539">Sprintf</span><span class="op" id="6476546">(</span><span class="string" id="6476547">&#34;(%d&nbsp;bytes&nbsp;vs.&nbsp;%d&nbsp;bytes)\n&#34;</span><span class="op" id="6476574">,</span>&nbsp;<span class="builtinfunc" id="6476576">len</span><span class="op" id="6476579">(</span><span class="ident" id="6476580">a</span><span class="op" id="6476581">)</span><span class="op" id="6476582">,</span>&nbsp;<span class="builtinfunc" id="6476584">len</span><span class="op" id="6476587">(</span><span class="ident" id="6476588">b</span><span class="op" id="6476589">)</span><span class="op" id="6476590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6476593">for</span>&nbsp;<span class="ident" id="6476597">offset</span>&nbsp;<span class="op" id="6476604">:=</span>&nbsp;<span class="num" id="6476607">0</span><span class="op" id="6476608">;</span>&nbsp;<span class="builtinfunc" id="6476610">len</span><span class="op" id="6476613">(</span><span class="ident" id="6476614">a</span><span class="op" id="6476615">)</span><span class="op" id="6476616">+</span><span class="builtinfunc" id="6476617">len</span><span class="op" id="6476620">(</span><span class="ident" id="6476621">b</span><span class="op" id="6476622">)</span>&nbsp;<span class="op" id="6476624">&gt;</span>&nbsp;<span class="num" id="6476626">0</span><span class="op" id="6476627">;</span>&nbsp;<span class="ident" id="6476629">offset</span>&nbsp;<span class="op" id="6476636">+=</span>&nbsp;<span class="ident" id="6476639">rowLen</span>&nbsp;<span class="op" id="6476646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6476650">na</span><span class="op" id="6476652">,</span>&nbsp;<span class="ident" id="6476654">nb</span>&nbsp;<span class="op" id="6476657">:=</span>&nbsp;<span class="ident" id="6476660">rowLen</span><span class="op" id="6476666">,</span>&nbsp;<span class="ident" id="6476668">rowLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6476677">if</span>&nbsp;<span class="ident" id="6476680">na</span>&nbsp;<span class="op" id="6476683">&gt;</span>&nbsp;<span class="builtinfunc" id="6476685">len</span><span class="op" id="6476688">(</span><span class="ident" id="6476689">a</span><span class="op" id="6476690">)</span>&nbsp;<span class="op" id="6476692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6476697">na</span>&nbsp;<span class="op" id="6476700">=</span>&nbsp;<span class="builtinfunc" id="6476702">len</span><span class="op" id="6476705">(</span><span class="ident" id="6476706">a</span><span class="op" id="6476707">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6476711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6476715">if</span>&nbsp;<span class="ident" id="6476718">nb</span>&nbsp;<span class="op" id="6476721">&gt;</span>&nbsp;<span class="builtinfunc" id="6476723">len</span><span class="op" id="6476726">(</span><span class="ident" id="6476727">b</span><span class="op" id="6476728">)</span>&nbsp;<span class="op" id="6476730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6476735">nb</span>&nbsp;<span class="op" id="6476738">=</span>&nbsp;<span class="builtinfunc" id="6476740">len</span><span class="op" id="6476743">(</span><span class="ident" id="6476744">b</span><span class="op" id="6476745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6476749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6476753">sa</span>&nbsp;<span class="op" id="6476756">:=</span>&nbsp;<span class="ident" id="6476759">bytestr</span><span class="op" id="6476766">(</span><span class="ident" id="6476767">offset</span><span class="op" id="6476773">,</span>&nbsp;<span class="ident" id="6476775">a</span><span class="op" id="6476776">[</span><span class="num" id="6476777">0</span><span class="op" id="6476778">:</span><span class="ident" id="6476779">na</span><span class="op" id="6476781">]</span><span class="op" id="6476782">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6476786">sb</span>&nbsp;<span class="op" id="6476789">:=</span>&nbsp;<span class="ident" id="6476792">bytestr</span><span class="op" id="6476799">(</span><span class="ident" id="6476800">offset</span><span class="op" id="6476806">,</span>&nbsp;<span class="ident" id="6476808">b</span><span class="op" id="6476809">[</span><span class="num" id="6476810">0</span><span class="op" id="6476811">:</span><span class="ident" id="6476812">nb</span><span class="op" id="6476814">]</span><span class="op" id="6476815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6476819">if</span>&nbsp;<span class="ident" id="6476822">sa</span>&nbsp;<span class="op" id="6476825">!=</span>&nbsp;<span class="ident" id="6476828">sb</span>&nbsp;<span class="op" id="6476831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6476836">s</span>&nbsp;<span class="op" id="6476838">+=</span>&nbsp;<span class="ident" id="6476841">fmt</span><span class="op" id="6476844">.</span><span class="ident" id="6476845">Sprintf</span><span class="op" id="6476852">(</span><span class="string" id="6476853">&#34;-%v\n+%v\n&#34;</span><span class="op" id="6476865">,</span>&nbsp;<span class="ident" id="6476867">sa</span><span class="op" id="6476869">,</span>&nbsp;<span class="ident" id="6476871">sb</span><span class="op" id="6476873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6476877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6476881">a</span>&nbsp;<span class="op" id="6476883">=</span>&nbsp;<span class="ident" id="6476885">a</span><span class="op" id="6476886">[</span><span class="ident" id="6476887">na</span><span class="op" id="6476889">:</span><span class="op" id="6476890">]</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6476894">b</span>&nbsp;<span class="op" id="6476896">=</span>&nbsp;<span class="ident" id="6476898">b</span><span class="op" id="6476899">[</span><span class="ident" id="6476900">nb</span><span class="op" id="6476902">:</span><span class="op" id="6476903">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6476906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6476909">return</span>&nbsp;<span class="ident" id="6476916">s</span><br>
<span class="lineno"></span><span class="op" id="6476918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="6476921">func</span>&nbsp;<span class="ident" id="6476926">TestWriter</span><span class="op" id="6476936">(</span><span class="ident" id="6476937">t</span>&nbsp;<span class="op" id="6476939">*</span><span class="ident" id="6476940">testing</span><span class="op" id="6476947">.</span><span class="ident" id="6476948">T</span><span class="op" id="6476949">)</span>&nbsp;<span class="op" id="6476951">{</span><br>
<span class="lineno"></span><span class="ident" id="6476953">testLoop</span><span class="op" id="6476961">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6476964">for</span>&nbsp;<span class="ident" id="6476968">i</span><span class="op" id="6476969">,</span>&nbsp;<span class="ident" id="6476971">test</span>&nbsp;<span class="op" id="6476976">:=</span>&nbsp;<span class="keyword" id="6476979">range</span>&nbsp;<span class="ident" id="6476985">writerTests</span>&nbsp;<span class="op" id="6476997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6477001">expected</span><span class="op" id="6477009">,</span>&nbsp;<span class="ident" id="6477011">err</span>&nbsp;<span class="op" id="6477015">:=</span>&nbsp;<span class="ident" id="6477018">ioutil</span><span class="op" id="6477024">.</span><span class="ident" id="6477025">ReadFile</span><span class="op" id="6477033">(</span><span class="ident" id="6477034">test</span><span class="op" id="6477038">.</span><span class="ident" id="6477039">file</span><span class="op" id="6477043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6477047">if</span>&nbsp;<span class="ident" id="6477050">err</span>&nbsp;<span class="op" id="6477054">!=</span>&nbsp;<span class="ident" id="6477057">nil</span>&nbsp;<span class="op" id="6477061">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6477066">t</span><span class="op" id="6477067">.</span><span class="ident" id="6477068">Errorf</span><span class="op" id="6477074">(</span><span class="string" id="6477075">&#34;test&nbsp;%d:&nbsp;Unexpected&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="6477106">,</span>&nbsp;<span class="ident" id="6477108">i</span><span class="op" id="6477109">,</span>&nbsp;<span class="ident" id="6477111">err</span><span class="op" id="6477114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6477119">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6477130">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6477135">buf</span>&nbsp;<span class="op" id="6477139">:=</span>&nbsp;<span class="builtinfunc" id="6477142">new</span><span class="op" id="6477145">(</span><span class="ident" id="6477146">bytes</span><span class="op" id="6477151">.</span><span class="ident" id="6477152">Buffer</span><span class="op" id="6477158">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6477162">tw</span>&nbsp;<span class="op" id="6477165">:=</span>&nbsp;<span class="ident" id="6477168">NewWriter</span><span class="op" id="6477177">(</span><span class="ident" id="6477178">iotest</span><span class="op" id="6477184">.</span><span class="ident" id="6477185">TruncateWriter</span><span class="op" id="6477199">(</span><span class="ident" id="6477200">buf</span><span class="op" id="6477203">,</span>&nbsp;<span class="num" id="6477205">4</span><span class="op" id="6477206">&lt;&lt;</span><span class="num" id="6477208">10</span><span class="op" id="6477210">)</span><span class="op" id="6477211">)</span>&nbsp;<span class="comment" id="6477213">//&nbsp;only&nbsp;catch&nbsp;the&nbsp;first&nbsp;4&nbsp;KB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6477244">big</span>&nbsp;<span class="op" id="6477248">:=</span>&nbsp;<span class="builtintype" id="6477251">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6477259">for</span>&nbsp;<span class="ident" id="6477263">j</span><span class="op" id="6477264">,</span>&nbsp;<span class="ident" id="6477266">entry</span>&nbsp;<span class="op" id="6477272">:=</span>&nbsp;<span class="keyword" id="6477275">range</span>&nbsp;<span class="ident" id="6477281">test</span><span class="op" id="6477285">.</span><span class="ident" id="6477286">entries</span>&nbsp;<span class="op" id="6477294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6477299">big</span>&nbsp;<span class="op" id="6477303">=</span>&nbsp;<span class="ident" id="6477305">big</span>&nbsp;<span class="op" id="6477309">||</span>&nbsp;<span class="ident" id="6477312">entry</span><span class="op" id="6477317">.</span><span class="ident" id="6477318">header</span><span class="op" id="6477324">.</span><span class="ident" id="6477325">Size</span>&nbsp;<span class="op" id="6477330">&gt;</span>&nbsp;<span class="num" id="6477332">1</span><span class="op" id="6477333">&lt;&lt;</span><span class="num" id="6477335">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6477341">if</span>&nbsp;<span class="ident" id="6477344">err</span>&nbsp;<span class="op" id="6477348">:=</span>&nbsp;<span class="ident" id="6477351">tw</span><span class="op" id="6477353">.</span><span class="ident" id="6477354">WriteHeader</span><span class="op" id="6477365">(</span><span class="ident" id="6477366">entry</span><span class="op" id="6477371">.</span><span class="ident" id="6477372">header</span><span class="op" id="6477378">)</span><span class="op" id="6477379">;</span>&nbsp;<span class="ident" id="6477381">err</span>&nbsp;<span class="op" id="6477385">!=</span>&nbsp;<span class="ident" id="6477388">nil</span>&nbsp;<span class="op" id="6477392">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6477398">t</span><span class="op" id="6477399">.</span><span class="ident" id="6477400">Errorf</span><span class="op" id="6477406">(</span><span class="string" id="6477407">&#34;test&nbsp;%d,&nbsp;entry&nbsp;%d:&nbsp;Failed&nbsp;writing&nbsp;header:&nbsp;%v&#34;</span><span class="op" id="6477453">,</span>&nbsp;<span class="ident" id="6477455">i</span><span class="op" id="6477456">,</span>&nbsp;<span class="ident" id="6477458">j</span><span class="op" id="6477459">,</span>&nbsp;<span class="ident" id="6477461">err</span><span class="op" id="6477464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6477470">continue</span>&nbsp;<span class="ident" id="6477479">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6477491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6477496">if</span>&nbsp;<span class="ident" id="6477499">_</span><span class="op" id="6477500">,</span>&nbsp;<span class="ident" id="6477502">err</span>&nbsp;<span class="op" id="6477506">:=</span>&nbsp;<span class="ident" id="6477509">io</span><span class="op" id="6477511">.</span><span class="ident" id="6477512">WriteString</span><span class="op" id="6477523">(</span><span class="ident" id="6477524">tw</span><span class="op" id="6477526">,</span>&nbsp;<span class="ident" id="6477528">entry</span><span class="op" id="6477533">.</span><span class="ident" id="6477534">contents</span><span class="op" id="6477542">)</span><span class="op" id="6477543">;</span>&nbsp;<span class="ident" id="6477545">err</span>&nbsp;<span class="op" id="6477549">!=</span>&nbsp;<span class="ident" id="6477552">nil</span>&nbsp;<span class="op" id="6477556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6477562">t</span><span class="op" id="6477563">.</span><span class="ident" id="6477564">Errorf</span><span class="op" id="6477570">(</span><span class="string" id="6477571">&#34;test&nbsp;%d,&nbsp;entry&nbsp;%d:&nbsp;Failed&nbsp;writing&nbsp;contents:&nbsp;%v&#34;</span><span class="op" id="6477619">,</span>&nbsp;<span class="ident" id="6477621">i</span><span class="op" id="6477622">,</span>&nbsp;<span class="ident" id="6477624">j</span><span class="op" id="6477625">,</span>&nbsp;<span class="ident" id="6477627">err</span><span class="op" id="6477630">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6477636">continue</span>&nbsp;<span class="ident" id="6477645">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6477657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6477661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6477665">//&nbsp;Only&nbsp;interested&nbsp;in&nbsp;Close&nbsp;failures&nbsp;for&nbsp;the&nbsp;small&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6477725">if</span>&nbsp;<span class="ident" id="6477728">err</span>&nbsp;<span class="op" id="6477732">:=</span>&nbsp;<span class="ident" id="6477735">tw</span><span class="op" id="6477737">.</span><span class="ident" id="6477738">Close</span><span class="op" id="6477743">(</span><span class="op" id="6477744">)</span><span class="op" id="6477745">;</span>&nbsp;<span class="ident" id="6477747">err</span>&nbsp;<span class="op" id="6477751">!=</span>&nbsp;<span class="ident" id="6477754">nil</span>&nbsp;<span class="op" id="6477758">&amp;&amp;</span>&nbsp;<span class="op" id="6477761">!</span><span class="ident" id="6477762">big</span>&nbsp;<span class="op" id="6477766">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6477771">t</span><span class="op" id="6477772">.</span><span class="ident" id="6477773">Errorf</span><span class="op" id="6477779">(</span><span class="string" id="6477780">&#34;test&nbsp;%d:&nbsp;Failed&nbsp;closing&nbsp;archive:&nbsp;%v&#34;</span><span class="op" id="6477817">,</span>&nbsp;<span class="ident" id="6477819">i</span><span class="op" id="6477820">,</span>&nbsp;<span class="ident" id="6477822">err</span><span class="op" id="6477825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6477830">continue</span>&nbsp;<span class="ident" id="6477839">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6477850">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6477855">actual</span>&nbsp;<span class="op" id="6477862">:=</span>&nbsp;<span class="ident" id="6477865">buf</span><span class="op" id="6477868">.</span><span class="ident" id="6477869">Bytes</span><span class="op" id="6477874">(</span><span class="op" id="6477875">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6477879">if</span>&nbsp;<span class="op" id="6477882">!</span><span class="ident" id="6477883">bytes</span><span class="op" id="6477888">.</span><span class="ident" id="6477889">Equal</span><span class="op" id="6477894">(</span><span class="ident" id="6477895">expected</span><span class="op" id="6477903">,</span>&nbsp;<span class="ident" id="6477905">actual</span><span class="op" id="6477911">)</span>&nbsp;<span class="op" id="6477913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6477918">t</span><span class="op" id="6477919">.</span><span class="ident" id="6477920">Errorf</span><span class="op" id="6477926">(</span><span class="string" id="6477927">&#34;test&nbsp;%d:&nbsp;Incorrect&nbsp;result:&nbsp;(-=expected,&nbsp;+=actual)\n%v&#34;</span><span class="op" id="6477982">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6477988">i</span><span class="op" id="6477989">,</span>&nbsp;<span class="ident" id="6477991">bytediff</span><span class="op" id="6477999">(</span><span class="ident" id="6478000">expected</span><span class="op" id="6478008">,</span>&nbsp;<span class="ident" id="6478010">actual</span><span class="op" id="6478016">)</span><span class="op" id="6478017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6478021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6478025">if</span>&nbsp;<span class="ident" id="6478028">testing</span><span class="op" id="6478035">.</span><span class="ident" id="6478036">Short</span><span class="op" id="6478041">(</span><span class="op" id="6478042">)</span>&nbsp;<span class="op" id="6478044">{</span>&nbsp;<span class="comment" id="6478046">//&nbsp;The&nbsp;second&nbsp;test&nbsp;is&nbsp;expensive.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6478082">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6478090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6478093">}</span><br>
<span class="lineno"></span><span class="op" id="6478095">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="6478098">func</span>&nbsp;<span class="ident" id="6478103">TestPax</span><span class="op" id="6478110">(</span><span class="ident" id="6478111">t</span>&nbsp;<span class="op" id="6478113">*</span><span class="ident" id="6478114">testing</span><span class="op" id="6478121">.</span><span class="ident" id="6478122">T</span><span class="op" id="6478123">)</span>&nbsp;<span class="op" id="6478125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6478128">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;a&nbsp;large&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6478168">fileinfo</span><span class="op" id="6478176">,</span>&nbsp;<span class="ident" id="6478178">err</span>&nbsp;<span class="op" id="6478182">:=</span>&nbsp;<span class="ident" id="6478185">os</span><span class="op" id="6478187">.</span><span class="ident" id="6478188">Stat</span><span class="op" id="6478192">(</span><span class="string" id="6478193">&#34;testdata/small.txt&#34;</span><span class="op" id="6478213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6478216">if</span>&nbsp;<span class="ident" id="6478219">err</span>&nbsp;<span class="op" id="6478223">!=</span>&nbsp;<span class="ident" id="6478226">nil</span>&nbsp;<span class="op" id="6478230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6478234">t</span><span class="op" id="6478235">.</span><span class="ident" id="6478236">Fatal</span><span class="op" id="6478241">(</span><span class="ident" id="6478242">err</span><span class="op" id="6478245">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6478248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6478251">hdr</span><span class="op" id="6478254">,</span>&nbsp;<span class="ident" id="6478256">err</span>&nbsp;<span class="op" id="6478260">:=</span>&nbsp;<span class="ident" id="6478263">FileInfoHeader</span><span class="op" id="6478277">(</span><span class="ident" id="6478278">fileinfo</span><span class="op" id="6478286">,</span>&nbsp;<span class="string" id="6478288">&#34;&#34;</span><span class="op" id="6478290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6478293">if</span>&nbsp;<span class="ident" id="6478296">err</span>&nbsp;<span class="op" id="6478300">!=</span>&nbsp;<span class="ident" id="6478303">nil</span>&nbsp;<span class="op" id="6478307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6478311">t</span><span class="op" id="6478312">.</span><span class="ident" id="6478313">Fatalf</span><span class="op" id="6478319">(</span><span class="string" id="6478320">&#34;os.Stat:&nbsp;%v&#34;</span><span class="op" id="6478333">,</span>&nbsp;<span class="ident" id="6478335">err</span><span class="op" id="6478338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6478341">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6478344">//&nbsp;Force&nbsp;a&nbsp;PAX&nbsp;long&nbsp;name&nbsp;to&nbsp;be&nbsp;written</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6478384">longName</span>&nbsp;<span class="op" id="6478393">:=</span>&nbsp;<span class="ident" id="6478396">strings</span><span class="op" id="6478403">.</span><span class="ident" id="6478404">Repeat</span><span class="op" id="6478410">(</span><span class="string" id="6478411">&#34;ab&#34;</span><span class="op" id="6478415">,</span>&nbsp;<span class="num" id="6478417">100</span><span class="op" id="6478420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6478423">contents</span>&nbsp;<span class="op" id="6478432">:=</span>&nbsp;<span class="ident" id="6478435">strings</span><span class="op" id="6478442">.</span><span class="ident" id="6478443">Repeat</span><span class="op" id="6478449">(</span><span class="string" id="6478450">&#34;&nbsp;&#34;</span><span class="op" id="6478453">,</span>&nbsp;<span class="builtintype" id="6478455">int</span><span class="op" id="6478458">(</span><span class="ident" id="6478459">hdr</span><span class="op" id="6478462">.</span><span class="ident" id="6478463">Size</span><span class="op" id="6478467">)</span><span class="op" id="6478468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6478471">hdr</span><span class="op" id="6478474">.</span><span class="ident" id="6478475">Name</span>&nbsp;<span class="op" id="6478480">=</span>&nbsp;<span class="ident" id="6478482">longName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6478492">var</span>&nbsp;<span class="ident" id="6478496">buf</span>&nbsp;<span class="ident" id="6478500">bytes</span><span class="op" id="6478505">.</span><span class="ident" id="6478506">Buffer</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6478514">writer</span>&nbsp;<span class="op" id="6478521">:=</span>&nbsp;<span class="ident" id="6478524">NewWriter</span><span class="op" id="6478533">(</span><span class="op" id="6478534">&amp;</span><span class="ident" id="6478535">buf</span><span class="op" id="6478538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6478541">if</span>&nbsp;<span class="ident" id="6478544">err</span>&nbsp;<span class="op" id="6478548">:=</span>&nbsp;<span class="ident" id="6478551">writer</span><span class="op" id="6478557">.</span><span class="ident" id="6478558">WriteHeader</span><span class="op" id="6478569">(</span><span class="ident" id="6478570">hdr</span><span class="op" id="6478573">)</span><span class="op" id="6478574">;</span>&nbsp;<span class="ident" id="6478576">err</span>&nbsp;<span class="op" id="6478580">!=</span>&nbsp;<span class="ident" id="6478583">nil</span>&nbsp;<span class="op" id="6478587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6478591">t</span><span class="op" id="6478592">.</span><span class="ident" id="6478593">Fatal</span><span class="op" id="6478598">(</span><span class="ident" id="6478599">err</span><span class="op" id="6478602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6478605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6478608">if</span>&nbsp;<span class="ident" id="6478611">_</span><span class="op" id="6478612">,</span>&nbsp;<span class="ident" id="6478614">err</span>&nbsp;<span class="op" id="6478618">=</span>&nbsp;<span class="ident" id="6478620">writer</span><span class="op" id="6478626">.</span><span class="ident" id="6478627">Write</span><span class="op" id="6478632">(</span><span class="op" id="6478633">[</span><span class="op" id="6478634">]</span><span class="builtintype" id="6478635">byte</span><span class="op" id="6478639">(</span><span class="ident" id="6478640">contents</span><span class="op" id="6478648">)</span><span class="op" id="6478649">)</span><span class="op" id="6478650">;</span>&nbsp;<span class="ident" id="6478652">err</span>&nbsp;<span class="op" id="6478656">!=</span>&nbsp;<span class="ident" id="6478659">nil</span>&nbsp;<span class="op" id="6478663">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6478667">t</span><span class="op" id="6478668">.</span><span class="ident" id="6478669">Fatal</span><span class="op" id="6478674">(</span><span class="ident" id="6478675">err</span><span class="op" id="6478678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6478681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6478684">if</span>&nbsp;<span class="ident" id="6478687">err</span>&nbsp;<span class="op" id="6478691">:=</span>&nbsp;<span class="ident" id="6478694">writer</span><span class="op" id="6478700">.</span><span class="ident" id="6478701">Close</span><span class="op" id="6478706">(</span><span class="op" id="6478707">)</span><span class="op" id="6478708">;</span>&nbsp;<span class="ident" id="6478710">err</span>&nbsp;<span class="op" id="6478714">!=</span>&nbsp;<span class="ident" id="6478717">nil</span>&nbsp;<span class="op" id="6478721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6478725">t</span><span class="op" id="6478726">.</span><span class="ident" id="6478727">Fatal</span><span class="op" id="6478732">(</span><span class="ident" id="6478733">err</span><span class="op" id="6478736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6478739">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6478742">//&nbsp;Simple&nbsp;test&nbsp;to&nbsp;make&nbsp;sure&nbsp;PAX&nbsp;extensions&nbsp;are&nbsp;in&nbsp;effect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6478800">if</span>&nbsp;<span class="op" id="6478803">!</span><span class="ident" id="6478804">bytes</span><span class="op" id="6478809">.</span><span class="ident" id="6478810">Contains</span><span class="op" id="6478818">(</span><span class="ident" id="6478819">buf</span><span class="op" id="6478822">.</span><span class="ident" id="6478823">Bytes</span><span class="op" id="6478828">(</span><span class="op" id="6478829">)</span><span class="op" id="6478830">,</span>&nbsp;<span class="op" id="6478832">[</span><span class="op" id="6478833">]</span><span class="builtintype" id="6478834">byte</span><span class="op" id="6478838">(</span><span class="string" id="6478839">&#34;PaxHeaders.&#34;</span><span class="op" id="6478852">)</span><span class="op" id="6478853">)</span>&nbsp;<span class="op" id="6478855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6478859">t</span><span class="op" id="6478860">.</span><span class="ident" id="6478861">Fatal</span><span class="op" id="6478866">(</span><span class="string" id="6478867">&#34;Expected&nbsp;at&nbsp;least&nbsp;one&nbsp;PAX&nbsp;header&nbsp;to&nbsp;be&nbsp;written.&#34;</span><span class="op" id="6478916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6478919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6478922">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6478984">reader</span>&nbsp;<span class="op" id="6478991">:=</span>&nbsp;<span class="ident" id="6478994">NewReader</span><span class="op" id="6479003">(</span><span class="op" id="6479004">&amp;</span><span class="ident" id="6479005">buf</span><span class="op" id="6479008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6479011">hdr</span><span class="op" id="6479014">,</span>&nbsp;<span class="ident" id="6479016">err</span>&nbsp;<span class="op" id="6479020">=</span>&nbsp;<span class="ident" id="6479022">reader</span><span class="op" id="6479028">.</span><span class="ident" id="6479029">Next</span><span class="op" id="6479033">(</span><span class="op" id="6479034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6479037">if</span>&nbsp;<span class="ident" id="6479040">err</span>&nbsp;<span class="op" id="6479044">!=</span>&nbsp;<span class="ident" id="6479047">nil</span>&nbsp;<span class="op" id="6479051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6479055">t</span><span class="op" id="6479056">.</span><span class="ident" id="6479057">Fatal</span><span class="op" id="6479062">(</span><span class="ident" id="6479063">err</span><span class="op" id="6479066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6479069">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6479072">if</span>&nbsp;<span class="ident" id="6479075">hdr</span><span class="op" id="6479078">.</span><span class="ident" id="6479079">Name</span>&nbsp;<span class="op" id="6479084">!=</span>&nbsp;<span class="ident" id="6479087">longName</span>&nbsp;<span class="op" id="6479096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6479100">t</span><span class="op" id="6479101">.</span><span class="ident" id="6479102">Fatal</span><span class="op" id="6479107">(</span><span class="string" id="6479108">&#34;Couldn&#39;t&nbsp;recover&nbsp;long&nbsp;file&nbsp;name&#34;</span><span class="op" id="6479141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6479144">}</span><br>
<span class="lineno"></span><span class="op" id="6479146">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="keyword" id="6479149">func</span>&nbsp;<span class="ident" id="6479154">TestPaxSymlink</span><span class="op" id="6479168">(</span><span class="ident" id="6479169">t</span>&nbsp;<span class="op" id="6479171">*</span><span class="ident" id="6479172">testing</span><span class="op" id="6479179">.</span><span class="ident" id="6479180">T</span><span class="op" id="6479181">)</span>&nbsp;<span class="op" id="6479183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6479186">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;a&nbsp;large&nbsp;linkname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6479230">fileinfo</span><span class="op" id="6479238">,</span>&nbsp;<span class="ident" id="6479240">err</span>&nbsp;<span class="op" id="6479244">:=</span>&nbsp;<span class="ident" id="6479247">os</span><span class="op" id="6479249">.</span><span class="ident" id="6479250">Stat</span><span class="op" id="6479254">(</span><span class="string" id="6479255">&#34;testdata/small.txt&#34;</span><span class="op" id="6479275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6479278">if</span>&nbsp;<span class="ident" id="6479281">err</span>&nbsp;<span class="op" id="6479285">!=</span>&nbsp;<span class="ident" id="6479288">nil</span>&nbsp;<span class="op" id="6479292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6479296">t</span><span class="op" id="6479297">.</span><span class="ident" id="6479298">Fatal</span><span class="op" id="6479303">(</span><span class="ident" id="6479304">err</span><span class="op" id="6479307">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6479310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6479313">hdr</span><span class="op" id="6479316">,</span>&nbsp;<span class="ident" id="6479318">err</span>&nbsp;<span class="op" id="6479322">:=</span>&nbsp;<span class="ident" id="6479325">FileInfoHeader</span><span class="op" id="6479339">(</span><span class="ident" id="6479340">fileinfo</span><span class="op" id="6479348">,</span>&nbsp;<span class="string" id="6479350">&#34;&#34;</span><span class="op" id="6479352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6479355">hdr</span><span class="op" id="6479358">.</span><span class="ident" id="6479359">Typeflag</span>&nbsp;<span class="op" id="6479368">=</span>&nbsp;<span class="ident" id="6479370">TypeSymlink</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6479383">if</span>&nbsp;<span class="ident" id="6479386">err</span>&nbsp;<span class="op" id="6479390">!=</span>&nbsp;<span class="ident" id="6479393">nil</span>&nbsp;<span class="op" id="6479397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6479401">t</span><span class="op" id="6479402">.</span><span class="ident" id="6479403">Fatalf</span><span class="op" id="6479409">(</span><span class="string" id="6479410">&#34;os.Stat:1&nbsp;%v&#34;</span><span class="op" id="6479424">,</span>&nbsp;<span class="ident" id="6479426">err</span><span class="op" id="6479429">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6479432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6479435">//&nbsp;Force&nbsp;a&nbsp;PAX&nbsp;long&nbsp;linkname&nbsp;to&nbsp;be&nbsp;written</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6479479">longLinkname</span>&nbsp;<span class="op" id="6479492">:=</span>&nbsp;<span class="ident" id="6479495">strings</span><span class="op" id="6479502">.</span><span class="ident" id="6479503">Repeat</span><span class="op" id="6479509">(</span><span class="string" id="6479510">&#34;1234567890/1234567890&#34;</span><span class="op" id="6479533">,</span>&nbsp;<span class="num" id="6479535">10</span><span class="op" id="6479537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6479540">hdr</span><span class="op" id="6479543">.</span><span class="ident" id="6479544">Linkname</span>&nbsp;<span class="op" id="6479553">=</span>&nbsp;<span class="ident" id="6479555">longLinkname</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6479570">hdr</span><span class="op" id="6479573">.</span><span class="ident" id="6479574">Size</span>&nbsp;<span class="op" id="6479579">=</span>&nbsp;<span class="num" id="6479581">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6479584">var</span>&nbsp;<span class="ident" id="6479588">buf</span>&nbsp;<span class="ident" id="6479592">bytes</span><span class="op" id="6479597">.</span><span class="ident" id="6479598">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6479606">writer</span>&nbsp;<span class="op" id="6479613">:=</span>&nbsp;<span class="ident" id="6479616">NewWriter</span><span class="op" id="6479625">(</span><span class="op" id="6479626">&amp;</span><span class="ident" id="6479627">buf</span><span class="op" id="6479630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6479633">if</span>&nbsp;<span class="ident" id="6479636">err</span>&nbsp;<span class="op" id="6479640">:=</span>&nbsp;<span class="ident" id="6479643">writer</span><span class="op" id="6479649">.</span><span class="ident" id="6479650">WriteHeader</span><span class="op" id="6479661">(</span><span class="ident" id="6479662">hdr</span><span class="op" id="6479665">)</span><span class="op" id="6479666">;</span>&nbsp;<span class="ident" id="6479668">err</span>&nbsp;<span class="op" id="6479672">!=</span>&nbsp;<span class="ident" id="6479675">nil</span>&nbsp;<span class="op" id="6479679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6479683">t</span><span class="op" id="6479684">.</span><span class="ident" id="6479685">Fatal</span><span class="op" id="6479690">(</span><span class="ident" id="6479691">err</span><span class="op" id="6479694">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6479697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6479700">if</span>&nbsp;<span class="ident" id="6479703">err</span>&nbsp;<span class="op" id="6479707">:=</span>&nbsp;<span class="ident" id="6479710">writer</span><span class="op" id="6479716">.</span><span class="ident" id="6479717">Close</span><span class="op" id="6479722">(</span><span class="op" id="6479723">)</span><span class="op" id="6479724">;</span>&nbsp;<span class="ident" id="6479726">err</span>&nbsp;<span class="op" id="6479730">!=</span>&nbsp;<span class="ident" id="6479733">nil</span>&nbsp;<span class="op" id="6479737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6479741">t</span><span class="op" id="6479742">.</span><span class="ident" id="6479743">Fatal</span><span class="op" id="6479748">(</span><span class="ident" id="6479749">err</span><span class="op" id="6479752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6479755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6479758">//&nbsp;Simple&nbsp;test&nbsp;to&nbsp;make&nbsp;sure&nbsp;PAX&nbsp;extensions&nbsp;are&nbsp;in&nbsp;effect</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6479816">if</span>&nbsp;<span class="op" id="6479819">!</span><span class="ident" id="6479820">bytes</span><span class="op" id="6479825">.</span><span class="ident" id="6479826">Contains</span><span class="op" id="6479834">(</span><span class="ident" id="6479835">buf</span><span class="op" id="6479838">.</span><span class="ident" id="6479839">Bytes</span><span class="op" id="6479844">(</span><span class="op" id="6479845">)</span><span class="op" id="6479846">,</span>&nbsp;<span class="op" id="6479848">[</span><span class="op" id="6479849">]</span><span class="builtintype" id="6479850">byte</span><span class="op" id="6479854">(</span><span class="string" id="6479855">&#34;PaxHeaders.&#34;</span><span class="op" id="6479868">)</span><span class="op" id="6479869">)</span>&nbsp;<span class="op" id="6479871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6479875">t</span><span class="op" id="6479876">.</span><span class="ident" id="6479877">Fatal</span><span class="op" id="6479882">(</span><span class="string" id="6479883">&#34;Expected&nbsp;at&nbsp;least&nbsp;one&nbsp;PAX&nbsp;header&nbsp;to&nbsp;be&nbsp;written.&#34;</span><span class="op" id="6479932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6479935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6479938">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6480000">reader</span>&nbsp;<span class="op" id="6480007">:=</span>&nbsp;<span class="ident" id="6480010">NewReader</span><span class="op" id="6480019">(</span><span class="op" id="6480020">&amp;</span><span class="ident" id="6480021">buf</span><span class="op" id="6480024">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6480027">hdr</span><span class="op" id="6480030">,</span>&nbsp;<span class="ident" id="6480032">err</span>&nbsp;<span class="op" id="6480036">=</span>&nbsp;<span class="ident" id="6480038">reader</span><span class="op" id="6480044">.</span><span class="ident" id="6480045">Next</span><span class="op" id="6480049">(</span><span class="op" id="6480050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6480053">if</span>&nbsp;<span class="ident" id="6480056">err</span>&nbsp;<span class="op" id="6480060">!=</span>&nbsp;<span class="ident" id="6480063">nil</span>&nbsp;<span class="op" id="6480067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6480071">t</span><span class="op" id="6480072">.</span><span class="ident" id="6480073">Fatal</span><span class="op" id="6480078">(</span><span class="ident" id="6480079">err</span><span class="op" id="6480082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6480085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6480088">if</span>&nbsp;<span class="ident" id="6480091">hdr</span><span class="op" id="6480094">.</span><span class="ident" id="6480095">Linkname</span>&nbsp;<span class="op" id="6480104">!=</span>&nbsp;<span class="ident" id="6480107">longLinkname</span>&nbsp;<span class="op" id="6480120">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6480124">t</span><span class="op" id="6480125">.</span><span class="ident" id="6480126">Fatal</span><span class="op" id="6480131">(</span><span class="string" id="6480132">&#34;Couldn&#39;t&nbsp;recover&nbsp;long&nbsp;link&nbsp;name&#34;</span><span class="op" id="6480165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6480168">}</span><br>
<span class="lineno"></span><span class="op" id="6480170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6480173">func</span>&nbsp;<span class="ident" id="6480178">TestPaxNonAscii</span><span class="op" id="6480193">(</span><span class="ident" id="6480194">t</span>&nbsp;<span class="op" id="6480196">*</span><span class="ident" id="6480197">testing</span><span class="op" id="6480204">.</span><span class="ident" id="6480205">T</span><span class="op" id="6480206">)</span>&nbsp;<span class="op" id="6480208">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6480211">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;non&nbsp;ascii.&nbsp;These&nbsp;should&nbsp;trigger&nbsp;a&nbsp;pax&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6480283">//&nbsp;because&nbsp;pax&nbsp;headers&nbsp;have&nbsp;a&nbsp;defined&nbsp;utf-8&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6480338">fileinfo</span><span class="op" id="6480346">,</span>&nbsp;<span class="ident" id="6480348">err</span>&nbsp;<span class="op" id="6480352">:=</span>&nbsp;<span class="ident" id="6480355">os</span><span class="op" id="6480357">.</span><span class="ident" id="6480358">Stat</span><span class="op" id="6480362">(</span><span class="string" id="6480363">&#34;testdata/small.txt&#34;</span><span class="op" id="6480383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6480386">if</span>&nbsp;<span class="ident" id="6480389">err</span>&nbsp;<span class="op" id="6480393">!=</span>&nbsp;<span class="ident" id="6480396">nil</span>&nbsp;<span class="op" id="6480400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6480404">t</span><span class="op" id="6480405">.</span><span class="ident" id="6480406">Fatal</span><span class="op" id="6480411">(</span><span class="ident" id="6480412">err</span><span class="op" id="6480415">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6480418">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6480422">hdr</span><span class="op" id="6480425">,</span>&nbsp;<span class="ident" id="6480427">err</span>&nbsp;<span class="op" id="6480431">:=</span>&nbsp;<span class="ident" id="6480434">FileInfoHeader</span><span class="op" id="6480448">(</span><span class="ident" id="6480449">fileinfo</span><span class="op" id="6480457">,</span>&nbsp;<span class="string" id="6480459">&#34;&#34;</span><span class="op" id="6480461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6480464">if</span>&nbsp;<span class="ident" id="6480467">err</span>&nbsp;<span class="op" id="6480471">!=</span>&nbsp;<span class="ident" id="6480474">nil</span>&nbsp;<span class="op" id="6480478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6480482">t</span><span class="op" id="6480483">.</span><span class="ident" id="6480484">Fatalf</span><span class="op" id="6480490">(</span><span class="string" id="6480491">&#34;os.Stat:1&nbsp;%v&#34;</span><span class="op" id="6480505">,</span>&nbsp;<span class="ident" id="6480507">err</span><span class="op" id="6480510">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6480513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6480517">//&nbsp;some&nbsp;sample&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6480538">chineseFilename</span>&nbsp;<span class="op" id="6480554">:=</span>&nbsp;<span class="string" id="6480557">&#34;文件名&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6480570">chineseGroupname</span>&nbsp;<span class="op" id="6480587">:=</span>&nbsp;<span class="string" id="6480590">&#34;組&#34;</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6480597">chineseUsername</span>&nbsp;<span class="op" id="6480613">:=</span>&nbsp;<span class="string" id="6480616">&#34;用戶名&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6480630">hdr</span><span class="op" id="6480633">.</span><span class="ident" id="6480634">Name</span>&nbsp;<span class="op" id="6480639">=</span>&nbsp;<span class="ident" id="6480641">chineseFilename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6480658">hdr</span><span class="op" id="6480661">.</span><span class="ident" id="6480662">Gname</span>&nbsp;<span class="op" id="6480668">=</span>&nbsp;<span class="ident" id="6480670">chineseGroupname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6480688">hdr</span><span class="op" id="6480691">.</span><span class="ident" id="6480692">Uname</span>&nbsp;<span class="op" id="6480698">=</span>&nbsp;<span class="ident" id="6480700">chineseUsername</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6480718">contents</span>&nbsp;<span class="op" id="6480727">:=</span>&nbsp;<span class="ident" id="6480730">strings</span><span class="op" id="6480737">.</span><span class="ident" id="6480738">Repeat</span><span class="op" id="6480744">(</span><span class="string" id="6480745">&#34;&nbsp;&#34;</span><span class="op" id="6480748">,</span>&nbsp;<span class="builtintype" id="6480750">int</span><span class="op" id="6480753">(</span><span class="ident" id="6480754">hdr</span><span class="op" id="6480757">.</span><span class="ident" id="6480758">Size</span><span class="op" id="6480762">)</span><span class="op" id="6480763">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6480767">var</span>&nbsp;<span class="ident" id="6480771">buf</span>&nbsp;<span class="ident" id="6480775">bytes</span><span class="op" id="6480780">.</span><span class="ident" id="6480781">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6480789">writer</span>&nbsp;<span class="op" id="6480796">:=</span>&nbsp;<span class="ident" id="6480799">NewWriter</span><span class="op" id="6480808">(</span><span class="op" id="6480809">&amp;</span><span class="ident" id="6480810">buf</span><span class="op" id="6480813">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6480816">if</span>&nbsp;<span class="ident" id="6480819">err</span>&nbsp;<span class="op" id="6480823">:=</span>&nbsp;<span class="ident" id="6480826">writer</span><span class="op" id="6480832">.</span><span class="ident" id="6480833">WriteHeader</span><span class="op" id="6480844">(</span><span class="ident" id="6480845">hdr</span><span class="op" id="6480848">)</span><span class="op" id="6480849">;</span>&nbsp;<span class="ident" id="6480851">err</span>&nbsp;<span class="op" id="6480855">!=</span>&nbsp;<span class="ident" id="6480858">nil</span>&nbsp;<span class="op" id="6480862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6480866">t</span><span class="op" id="6480867">.</span><span class="ident" id="6480868">Fatal</span><span class="op" id="6480873">(</span><span class="ident" id="6480874">err</span><span class="op" id="6480877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6480880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6480883">if</span>&nbsp;<span class="ident" id="6480886">_</span><span class="op" id="6480887">,</span>&nbsp;<span class="ident" id="6480889">err</span>&nbsp;<span class="op" id="6480893">=</span>&nbsp;<span class="ident" id="6480895">writer</span><span class="op" id="6480901">.</span><span class="ident" id="6480902">Write</span><span class="op" id="6480907">(</span><span class="op" id="6480908">[</span><span class="op" id="6480909">]</span><span class="builtintype" id="6480910">byte</span><span class="op" id="6480914">(</span><span class="ident" id="6480915">contents</span><span class="op" id="6480923">)</span><span class="op" id="6480924">)</span><span class="op" id="6480925">;</span>&nbsp;<span class="ident" id="6480927">err</span>&nbsp;<span class="op" id="6480931">!=</span>&nbsp;<span class="ident" id="6480934">nil</span>&nbsp;<span class="op" id="6480938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6480942">t</span><span class="op" id="6480943">.</span><span class="ident" id="6480944">Fatal</span><span class="op" id="6480949">(</span><span class="ident" id="6480950">err</span><span class="op" id="6480953">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6480956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6480959">if</span>&nbsp;<span class="ident" id="6480962">err</span>&nbsp;<span class="op" id="6480966">:=</span>&nbsp;<span class="ident" id="6480969">writer</span><span class="op" id="6480975">.</span><span class="ident" id="6480976">Close</span><span class="op" id="6480981">(</span><span class="op" id="6480982">)</span><span class="op" id="6480983">;</span>&nbsp;<span class="ident" id="6480985">err</span>&nbsp;<span class="op" id="6480989">!=</span>&nbsp;<span class="ident" id="6480992">nil</span>&nbsp;<span class="op" id="6480996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6481000">t</span><span class="op" id="6481001">.</span><span class="ident" id="6481002">Fatal</span><span class="op" id="6481007">(</span><span class="ident" id="6481008">err</span><span class="op" id="6481011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6481014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6481017">//&nbsp;Simple&nbsp;test&nbsp;to&nbsp;make&nbsp;sure&nbsp;PAX&nbsp;extensions&nbsp;are&nbsp;in&nbsp;effect</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6481075">if</span>&nbsp;<span class="op" id="6481078">!</span><span class="ident" id="6481079">bytes</span><span class="op" id="6481084">.</span><span class="ident" id="6481085">Contains</span><span class="op" id="6481093">(</span><span class="ident" id="6481094">buf</span><span class="op" id="6481097">.</span><span class="ident" id="6481098">Bytes</span><span class="op" id="6481103">(</span><span class="op" id="6481104">)</span><span class="op" id="6481105">,</span>&nbsp;<span class="op" id="6481107">[</span><span class="op" id="6481108">]</span><span class="builtintype" id="6481109">byte</span><span class="op" id="6481113">(</span><span class="string" id="6481114">&#34;PaxHeaders.&#34;</span><span class="op" id="6481127">)</span><span class="op" id="6481128">)</span>&nbsp;<span class="op" id="6481130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6481134">t</span><span class="op" id="6481135">.</span><span class="ident" id="6481136">Fatal</span><span class="op" id="6481141">(</span><span class="string" id="6481142">&#34;Expected&nbsp;at&nbsp;least&nbsp;one&nbsp;PAX&nbsp;header&nbsp;to&nbsp;be&nbsp;written.&#34;</span><span class="op" id="6481191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6481194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6481197">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6481259">reader</span>&nbsp;<span class="op" id="6481266">:=</span>&nbsp;<span class="ident" id="6481269">NewReader</span><span class="op" id="6481278">(</span><span class="op" id="6481279">&amp;</span><span class="ident" id="6481280">buf</span><span class="op" id="6481283">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6481286">hdr</span><span class="op" id="6481289">,</span>&nbsp;<span class="ident" id="6481291">err</span>&nbsp;<span class="op" id="6481295">=</span>&nbsp;<span class="ident" id="6481297">reader</span><span class="op" id="6481303">.</span><span class="ident" id="6481304">Next</span><span class="op" id="6481308">(</span><span class="op" id="6481309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6481312">if</span>&nbsp;<span class="ident" id="6481315">err</span>&nbsp;<span class="op" id="6481319">!=</span>&nbsp;<span class="ident" id="6481322">nil</span>&nbsp;<span class="op" id="6481326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6481330">t</span><span class="op" id="6481331">.</span><span class="ident" id="6481332">Fatal</span><span class="op" id="6481337">(</span><span class="ident" id="6481338">err</span><span class="op" id="6481341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6481344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6481347">if</span>&nbsp;<span class="ident" id="6481350">hdr</span><span class="op" id="6481353">.</span><span class="ident" id="6481354">Name</span>&nbsp;<span class="op" id="6481359">!=</span>&nbsp;<span class="ident" id="6481362">chineseFilename</span>&nbsp;<span class="op" id="6481378">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6481382">t</span><span class="op" id="6481383">.</span><span class="ident" id="6481384">Fatal</span><span class="op" id="6481389">(</span><span class="string" id="6481390">&#34;Couldn&#39;t&nbsp;recover&nbsp;unicode&nbsp;name&#34;</span><span class="op" id="6481421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6481424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6481427">if</span>&nbsp;<span class="ident" id="6481430">hdr</span><span class="op" id="6481433">.</span><span class="ident" id="6481434">Gname</span>&nbsp;<span class="op" id="6481440">!=</span>&nbsp;<span class="ident" id="6481443">chineseGroupname</span>&nbsp;<span class="op" id="6481460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6481464">t</span><span class="op" id="6481465">.</span><span class="ident" id="6481466">Fatal</span><span class="op" id="6481471">(</span><span class="string" id="6481472">&#34;Couldn&#39;t&nbsp;recover&nbsp;unicode&nbsp;group&#34;</span><span class="op" id="6481504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6481507">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6481510">if</span>&nbsp;<span class="ident" id="6481513">hdr</span><span class="op" id="6481516">.</span><span class="ident" id="6481517">Uname</span>&nbsp;<span class="op" id="6481523">!=</span>&nbsp;<span class="ident" id="6481526">chineseUsername</span>&nbsp;<span class="op" id="6481542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6481546">t</span><span class="op" id="6481547">.</span><span class="ident" id="6481548">Fatal</span><span class="op" id="6481553">(</span><span class="string" id="6481554">&#34;Couldn&#39;t&nbsp;recover&nbsp;unicode&nbsp;user&#34;</span><span class="op" id="6481585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6481588">}</span><br>
<span class="lineno"></span><span class="op" id="6481590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="keyword" id="6481593">func</span>&nbsp;<span class="ident" id="6481598">TestPaxXattrs</span><span class="op" id="6481611">(</span><span class="ident" id="6481612">t</span>&nbsp;<span class="op" id="6481614">*</span><span class="ident" id="6481615">testing</span><span class="op" id="6481622">.</span><span class="ident" id="6481623">T</span><span class="op" id="6481624">)</span>&nbsp;<span class="op" id="6481626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6481629">xattrs</span>&nbsp;<span class="op" id="6481636">:=</span>&nbsp;<span class="keyword" id="6481639">map</span><span class="op" id="6481642">[</span><span class="builtintype" id="6481643">string</span><span class="op" id="6481649">]</span><span class="builtintype" id="6481650">string</span><span class="op" id="6481656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6481660">&#34;user.key&#34;</span><span class="op" id="6481670">:</span>&nbsp;<span class="string" id="6481672">&#34;value&#34;</span><span class="op" id="6481679">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6481682">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6481686">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;an&nbsp;xattr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6481722">fileinfo</span><span class="op" id="6481730">,</span>&nbsp;<span class="ident" id="6481732">err</span>&nbsp;<span class="op" id="6481736">:=</span>&nbsp;<span class="ident" id="6481739">os</span><span class="op" id="6481741">.</span><span class="ident" id="6481742">Stat</span><span class="op" id="6481746">(</span><span class="string" id="6481747">&#34;testdata/small.txt&#34;</span><span class="op" id="6481767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6481770">if</span>&nbsp;<span class="ident" id="6481773">err</span>&nbsp;<span class="op" id="6481777">!=</span>&nbsp;<span class="ident" id="6481780">nil</span>&nbsp;<span class="op" id="6481784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6481788">t</span><span class="op" id="6481789">.</span><span class="ident" id="6481790">Fatal</span><span class="op" id="6481795">(</span><span class="ident" id="6481796">err</span><span class="op" id="6481799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6481802">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6481805">hdr</span><span class="op" id="6481808">,</span>&nbsp;<span class="ident" id="6481810">err</span>&nbsp;<span class="op" id="6481814">:=</span>&nbsp;<span class="ident" id="6481817">FileInfoHeader</span><span class="op" id="6481831">(</span><span class="ident" id="6481832">fileinfo</span><span class="op" id="6481840">,</span>&nbsp;<span class="string" id="6481842">&#34;&#34;</span><span class="op" id="6481844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6481847">if</span>&nbsp;<span class="ident" id="6481850">err</span>&nbsp;<span class="op" id="6481854">!=</span>&nbsp;<span class="ident" id="6481857">nil</span>&nbsp;<span class="op" id="6481861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6481865">t</span><span class="op" id="6481866">.</span><span class="ident" id="6481867">Fatalf</span><span class="op" id="6481873">(</span><span class="string" id="6481874">&#34;os.Stat:&nbsp;%v&#34;</span><span class="op" id="6481887">,</span>&nbsp;<span class="ident" id="6481889">err</span><span class="op" id="6481892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6481895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6481898">contents</span>&nbsp;<span class="op" id="6481907">:=</span>&nbsp;<span class="string" id="6481910">&#34;Kilts&#34;</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6481919">hdr</span><span class="op" id="6481922">.</span><span class="ident" id="6481923">Xattrs</span>&nbsp;<span class="op" id="6481930">=</span>&nbsp;<span class="ident" id="6481932">xattrs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6481940">var</span>&nbsp;<span class="ident" id="6481944">buf</span>&nbsp;<span class="ident" id="6481948">bytes</span><span class="op" id="6481953">.</span><span class="ident" id="6481954">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6481962">writer</span>&nbsp;<span class="op" id="6481969">:=</span>&nbsp;<span class="ident" id="6481972">NewWriter</span><span class="op" id="6481981">(</span><span class="op" id="6481982">&amp;</span><span class="ident" id="6481983">buf</span><span class="op" id="6481986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6481989">if</span>&nbsp;<span class="ident" id="6481992">err</span>&nbsp;<span class="op" id="6481996">:=</span>&nbsp;<span class="ident" id="6481999">writer</span><span class="op" id="6482005">.</span><span class="ident" id="6482006">WriteHeader</span><span class="op" id="6482017">(</span><span class="ident" id="6482018">hdr</span><span class="op" id="6482021">)</span><span class="op" id="6482022">;</span>&nbsp;<span class="ident" id="6482024">err</span>&nbsp;<span class="op" id="6482028">!=</span>&nbsp;<span class="ident" id="6482031">nil</span>&nbsp;<span class="op" id="6482035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6482039">t</span><span class="op" id="6482040">.</span><span class="ident" id="6482041">Fatal</span><span class="op" id="6482046">(</span><span class="ident" id="6482047">err</span><span class="op" id="6482050">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6482053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6482056">if</span>&nbsp;<span class="ident" id="6482059">_</span><span class="op" id="6482060">,</span>&nbsp;<span class="ident" id="6482062">err</span>&nbsp;<span class="op" id="6482066">=</span>&nbsp;<span class="ident" id="6482068">writer</span><span class="op" id="6482074">.</span><span class="ident" id="6482075">Write</span><span class="op" id="6482080">(</span><span class="op" id="6482081">[</span><span class="op" id="6482082">]</span><span class="builtintype" id="6482083">byte</span><span class="op" id="6482087">(</span><span class="ident" id="6482088">contents</span><span class="op" id="6482096">)</span><span class="op" id="6482097">)</span><span class="op" id="6482098">;</span>&nbsp;<span class="ident" id="6482100">err</span>&nbsp;<span class="op" id="6482104">!=</span>&nbsp;<span class="ident" id="6482107">nil</span>&nbsp;<span class="op" id="6482111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6482115">t</span><span class="op" id="6482116">.</span><span class="ident" id="6482117">Fatal</span><span class="op" id="6482122">(</span><span class="ident" id="6482123">err</span><span class="op" id="6482126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6482129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6482132">if</span>&nbsp;<span class="ident" id="6482135">err</span>&nbsp;<span class="op" id="6482139">:=</span>&nbsp;<span class="ident" id="6482142">writer</span><span class="op" id="6482148">.</span><span class="ident" id="6482149">Close</span><span class="op" id="6482154">(</span><span class="op" id="6482155">)</span><span class="op" id="6482156">;</span>&nbsp;<span class="ident" id="6482158">err</span>&nbsp;<span class="op" id="6482162">!=</span>&nbsp;<span class="ident" id="6482165">nil</span>&nbsp;<span class="op" id="6482169">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6482173">t</span><span class="op" id="6482174">.</span><span class="ident" id="6482175">Fatal</span><span class="op" id="6482180">(</span><span class="ident" id="6482181">err</span><span class="op" id="6482184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6482187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6482190">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;the&nbsp;xattrs&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6482251">reader</span>&nbsp;<span class="op" id="6482258">:=</span>&nbsp;<span class="ident" id="6482261">NewReader</span><span class="op" id="6482270">(</span><span class="op" id="6482271">&amp;</span><span class="ident" id="6482272">buf</span><span class="op" id="6482275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6482278">hdr</span><span class="op" id="6482281">,</span>&nbsp;<span class="ident" id="6482283">err</span>&nbsp;<span class="op" id="6482287">=</span>&nbsp;<span class="ident" id="6482289">reader</span><span class="op" id="6482295">.</span><span class="ident" id="6482296">Next</span><span class="op" id="6482300">(</span><span class="op" id="6482301">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6482304">if</span>&nbsp;<span class="ident" id="6482307">err</span>&nbsp;<span class="op" id="6482311">!=</span>&nbsp;<span class="ident" id="6482314">nil</span>&nbsp;<span class="op" id="6482318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6482322">t</span><span class="op" id="6482323">.</span><span class="ident" id="6482324">Fatal</span><span class="op" id="6482329">(</span><span class="ident" id="6482330">err</span><span class="op" id="6482333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6482336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6482339">if</span>&nbsp;<span class="op" id="6482342">!</span><span class="ident" id="6482343">reflect</span><span class="op" id="6482350">.</span><span class="ident" id="6482351">DeepEqual</span><span class="op" id="6482360">(</span><span class="ident" id="6482361">hdr</span><span class="op" id="6482364">.</span><span class="ident" id="6482365">Xattrs</span><span class="op" id="6482371">,</span>&nbsp;<span class="ident" id="6482373">xattrs</span><span class="op" id="6482379">)</span>&nbsp;<span class="op" id="6482381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6482385">t</span><span class="op" id="6482386">.</span><span class="ident" id="6482387">Fatalf</span><span class="op" id="6482393">(</span><span class="string" id="6482394">&#34;xattrs&nbsp;did&nbsp;not&nbsp;survive&nbsp;round&nbsp;trip:&nbsp;got&nbsp;%+v,&nbsp;want&nbsp;%+v&#34;</span><span class="op" id="6482448">,</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6482453">hdr</span><span class="op" id="6482456">.</span><span class="ident" id="6482457">Xattrs</span><span class="op" id="6482463">,</span>&nbsp;<span class="ident" id="6482465">xattrs</span><span class="op" id="6482471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6482474">}</span><br>
<span class="lineno"></span><span class="op" id="6482476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6482479">func</span>&nbsp;<span class="ident" id="6482484">TestPAXHeader</span><span class="op" id="6482497">(</span><span class="ident" id="6482498">t</span>&nbsp;<span class="op" id="6482500">*</span><span class="ident" id="6482501">testing</span><span class="op" id="6482508">.</span><span class="ident" id="6482509">T</span><span class="op" id="6482510">)</span>&nbsp;<span class="op" id="6482512">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6482515">medName</span>&nbsp;<span class="op" id="6482523">:=</span>&nbsp;<span class="ident" id="6482526">strings</span><span class="op" id="6482533">.</span><span class="ident" id="6482534">Repeat</span><span class="op" id="6482540">(</span><span class="string" id="6482541">&#34;CD&#34;</span><span class="op" id="6482545">,</span>&nbsp;<span class="num" id="6482547">50</span><span class="op" id="6482549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6482552">longName</span>&nbsp;<span class="op" id="6482561">:=</span>&nbsp;<span class="ident" id="6482564">strings</span><span class="op" id="6482571">.</span><span class="ident" id="6482572">Repeat</span><span class="op" id="6482578">(</span><span class="string" id="6482579">&#34;AB&#34;</span><span class="op" id="6482583">,</span>&nbsp;<span class="num" id="6482585">100</span><span class="op" id="6482588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6482591">paxTests</span>&nbsp;<span class="op" id="6482600">:=</span>&nbsp;<span class="op" id="6482603">[</span><span class="op" id="6482604">]</span><span class="op" id="6482605">[</span><span class="num" id="6482606">2</span><span class="op" id="6482607">]</span><span class="builtintype" id="6482608">string</span><span class="op" id="6482614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6482618">{</span><span class="ident" id="6482619">paxPath</span>&nbsp;<span class="op" id="6482627">+</span>&nbsp;<span class="string" id="6482629">&#34;=/etc/hosts&#34;</span><span class="op" id="6482642">,</span>&nbsp;<span class="string" id="6482644">&#34;19&nbsp;path=/etc/hosts\n&#34;</span><span class="op" id="6482666">}</span><span class="op" id="6482667">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6482671">{</span><span class="string" id="6482672">&#34;a=b&#34;</span><span class="op" id="6482677">,</span>&nbsp;<span class="string" id="6482679">&#34;6&nbsp;a=b\n&#34;</span><span class="op" id="6482688">}</span><span class="op" id="6482689">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6482700">//&nbsp;Single&nbsp;digit&nbsp;length</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6482725">{</span><span class="string" id="6482726">&#34;a=names&#34;</span><span class="op" id="6482735">,</span>&nbsp;<span class="string" id="6482737">&#34;11&nbsp;a=names\n&#34;</span><span class="op" id="6482751">}</span><span class="op" id="6482752">,</span>&nbsp;<span class="comment" id="6482754">//&nbsp;Test&nbsp;case&nbsp;involving&nbsp;carries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6482787">{</span><span class="ident" id="6482788">paxPath</span>&nbsp;<span class="op" id="6482796">+</span>&nbsp;<span class="string" id="6482798">&#34;=&#34;</span>&nbsp;<span class="op" id="6482802">+</span>&nbsp;<span class="ident" id="6482804">longName</span><span class="op" id="6482812">,</span>&nbsp;<span class="ident" id="6482814">fmt</span><span class="op" id="6482817">.</span><span class="ident" id="6482818">Sprintf</span><span class="op" id="6482825">(</span><span class="string" id="6482826">&#34;210&nbsp;path=%s\n&#34;</span><span class="op" id="6482841">,</span>&nbsp;<span class="ident" id="6482843">longName</span><span class="op" id="6482851">)</span><span class="op" id="6482852">}</span><span class="op" id="6482853">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6482857">{</span><span class="ident" id="6482858">paxPath</span>&nbsp;<span class="op" id="6482866">+</span>&nbsp;<span class="string" id="6482868">&#34;=&#34;</span>&nbsp;<span class="op" id="6482872">+</span>&nbsp;<span class="ident" id="6482874">medName</span><span class="op" id="6482881">,</span>&nbsp;<span class="ident" id="6482883">fmt</span><span class="op" id="6482886">.</span><span class="ident" id="6482887">Sprintf</span><span class="op" id="6482894">(</span><span class="string" id="6482895">&#34;110&nbsp;path=%s\n&#34;</span><span class="op" id="6482910">,</span>&nbsp;<span class="ident" id="6482912">medName</span><span class="op" id="6482919">)</span><span class="op" id="6482920">}</span><span class="op" id="6482921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6482925">for</span>&nbsp;<span class="ident" id="6482929">_</span><span class="op" id="6482930">,</span>&nbsp;<span class="ident" id="6482932">test</span>&nbsp;<span class="op" id="6482937">:=</span>&nbsp;<span class="keyword" id="6482940">range</span>&nbsp;<span class="ident" id="6482946">paxTests</span>&nbsp;<span class="op" id="6482955">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6482959">key</span><span class="op" id="6482962">,</span>&nbsp;<span class="ident" id="6482964">expected</span>&nbsp;<span class="op" id="6482973">:=</span>&nbsp;<span class="ident" id="6482976">test</span><span class="op" id="6482980">[</span><span class="num" id="6482981">0</span><span class="op" id="6482982">]</span><span class="op" id="6482983">,</span>&nbsp;<span class="ident" id="6482985">test</span><span class="op" id="6482989">[</span><span class="num" id="6482990">1</span><span class="op" id="6482991">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6482995">if</span>&nbsp;<span class="ident" id="6482998">result</span>&nbsp;<span class="op" id="6483005">:=</span>&nbsp;<span class="ident" id="6483008">paxHeader</span><span class="op" id="6483017">(</span><span class="ident" id="6483018">key</span><span class="op" id="6483021">)</span><span class="op" id="6483022">;</span>&nbsp;<span class="ident" id="6483024">result</span>&nbsp;<span class="op" id="6483031">!=</span>&nbsp;<span class="ident" id="6483034">expected</span>&nbsp;<span class="op" id="6483043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6483048">t</span><span class="op" id="6483049">.</span><span class="ident" id="6483050">Fatalf</span><span class="op" id="6483056">(</span><span class="string" id="6483057">&#34;paxHeader:&nbsp;got&nbsp;%s,&nbsp;expected&nbsp;%s&#34;</span><span class="op" id="6483089">,</span>&nbsp;<span class="ident" id="6483091">result</span><span class="op" id="6483097">,</span>&nbsp;<span class="ident" id="6483099">expected</span><span class="op" id="6483107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6483111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6483114">}</span><br>
<span class="lineno">420</span><span class="op" id="6483116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6483119">func</span>&nbsp;<span class="ident" id="6483124">TestUSTARLongName</span><span class="op" id="6483141">(</span><span class="ident" id="6483142">t</span>&nbsp;<span class="op" id="6483144">*</span><span class="ident" id="6483145">testing</span><span class="op" id="6483152">.</span><span class="ident" id="6483153">T</span><span class="op" id="6483154">)</span>&nbsp;<span class="op" id="6483156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6483159">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;a&nbsp;path&nbsp;that&nbsp;failed&nbsp;to&nbsp;split&nbsp;with&nbsp;USTAR&nbsp;extension&nbsp;in&nbsp;previous&nbsp;versions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6483257">fileinfo</span><span class="op" id="6483265">,</span>&nbsp;<span class="ident" id="6483267">err</span>&nbsp;<span class="op" id="6483271">:=</span>&nbsp;<span class="ident" id="6483274">os</span><span class="op" id="6483276">.</span><span class="ident" id="6483277">Stat</span><span class="op" id="6483281">(</span><span class="string" id="6483282">&#34;testdata/small.txt&#34;</span><span class="op" id="6483302">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6483305">if</span>&nbsp;<span class="ident" id="6483308">err</span>&nbsp;<span class="op" id="6483312">!=</span>&nbsp;<span class="ident" id="6483315">nil</span>&nbsp;<span class="op" id="6483319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6483323">t</span><span class="op" id="6483324">.</span><span class="ident" id="6483325">Fatal</span><span class="op" id="6483330">(</span><span class="ident" id="6483331">err</span><span class="op" id="6483334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6483337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6483340">hdr</span><span class="op" id="6483343">,</span>&nbsp;<span class="ident" id="6483345">err</span>&nbsp;<span class="op" id="6483349">:=</span>&nbsp;<span class="ident" id="6483352">FileInfoHeader</span><span class="op" id="6483366">(</span><span class="ident" id="6483367">fileinfo</span><span class="op" id="6483375">,</span>&nbsp;<span class="string" id="6483377">&#34;&#34;</span><span class="op" id="6483379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6483382">hdr</span><span class="op" id="6483385">.</span><span class="ident" id="6483386">Typeflag</span>&nbsp;<span class="op" id="6483395">=</span>&nbsp;<span class="ident" id="6483397">TypeDir</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6483406">if</span>&nbsp;<span class="ident" id="6483409">err</span>&nbsp;<span class="op" id="6483413">!=</span>&nbsp;<span class="ident" id="6483416">nil</span>&nbsp;<span class="op" id="6483420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6483424">t</span><span class="op" id="6483425">.</span><span class="ident" id="6483426">Fatalf</span><span class="op" id="6483432">(</span><span class="string" id="6483433">&#34;os.Stat:1&nbsp;%v&#34;</span><span class="op" id="6483447">,</span>&nbsp;<span class="ident" id="6483449">err</span><span class="op" id="6483452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6483455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6483458">//&nbsp;Force&nbsp;a&nbsp;PAX&nbsp;long&nbsp;name&nbsp;to&nbsp;be&nbsp;written.&nbsp;The&nbsp;name&nbsp;was&nbsp;taken&nbsp;from&nbsp;a&nbsp;practical&nbsp;example</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6483543">//&nbsp;that&nbsp;fails&nbsp;and&nbsp;replaced&nbsp;ever&nbsp;char&nbsp;through&nbsp;numbers&nbsp;to&nbsp;anonymize&nbsp;the&nbsp;sample.</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6483622">longName</span>&nbsp;<span class="op" id="6483631">:=</span>&nbsp;<span class="string" id="6483634">&#34;/0000_0000000/00000-000000000/0000_0000000/00000-0000000000000/0000_0000000/00000-0000000-00000000/0000_0000000/00000000/0000_0000000/000/0000_0000000/00000000v00/0000_0000000/000000/0000_0000000/0000000/0000_0000000/00000y-00/0000/0000/00000000/0x000000/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6483893">hdr</span><span class="op" id="6483896">.</span><span class="ident" id="6483897">Name</span>&nbsp;<span class="op" id="6483902">=</span>&nbsp;<span class="ident" id="6483904">longName</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6483915">hdr</span><span class="op" id="6483918">.</span><span class="ident" id="6483919">Size</span>&nbsp;<span class="op" id="6483924">=</span>&nbsp;<span class="num" id="6483926">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6483929">var</span>&nbsp;<span class="ident" id="6483933">buf</span>&nbsp;<span class="ident" id="6483937">bytes</span><span class="op" id="6483942">.</span><span class="ident" id="6483943">Buffer</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6483951">writer</span>&nbsp;<span class="op" id="6483958">:=</span>&nbsp;<span class="ident" id="6483961">NewWriter</span><span class="op" id="6483970">(</span><span class="op" id="6483971">&amp;</span><span class="ident" id="6483972">buf</span><span class="op" id="6483975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6483978">if</span>&nbsp;<span class="ident" id="6483981">err</span>&nbsp;<span class="op" id="6483985">:=</span>&nbsp;<span class="ident" id="6483988">writer</span><span class="op" id="6483994">.</span><span class="ident" id="6483995">WriteHeader</span><span class="op" id="6484006">(</span><span class="ident" id="6484007">hdr</span><span class="op" id="6484010">)</span><span class="op" id="6484011">;</span>&nbsp;<span class="ident" id="6484013">err</span>&nbsp;<span class="op" id="6484017">!=</span>&nbsp;<span class="ident" id="6484020">nil</span>&nbsp;<span class="op" id="6484024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6484028">t</span><span class="op" id="6484029">.</span><span class="ident" id="6484030">Fatal</span><span class="op" id="6484035">(</span><span class="ident" id="6484036">err</span><span class="op" id="6484039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6484042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6484045">if</span>&nbsp;<span class="ident" id="6484048">err</span>&nbsp;<span class="op" id="6484052">:=</span>&nbsp;<span class="ident" id="6484055">writer</span><span class="op" id="6484061">.</span><span class="ident" id="6484062">Close</span><span class="op" id="6484067">(</span><span class="op" id="6484068">)</span><span class="op" id="6484069">;</span>&nbsp;<span class="ident" id="6484071">err</span>&nbsp;<span class="op" id="6484075">!=</span>&nbsp;<span class="ident" id="6484078">nil</span>&nbsp;<span class="op" id="6484082">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6484086">t</span><span class="op" id="6484087">.</span><span class="ident" id="6484088">Fatal</span><span class="op" id="6484093">(</span><span class="ident" id="6484094">err</span><span class="op" id="6484097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6484100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6484103">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6484165">reader</span>&nbsp;<span class="op" id="6484172">:=</span>&nbsp;<span class="ident" id="6484175">NewReader</span><span class="op" id="6484184">(</span><span class="op" id="6484185">&amp;</span><span class="ident" id="6484186">buf</span><span class="op" id="6484189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6484192">hdr</span><span class="op" id="6484195">,</span>&nbsp;<span class="ident" id="6484197">err</span>&nbsp;<span class="op" id="6484201">=</span>&nbsp;<span class="ident" id="6484203">reader</span><span class="op" id="6484209">.</span><span class="ident" id="6484210">Next</span><span class="op" id="6484214">(</span><span class="op" id="6484215">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6484218">if</span>&nbsp;<span class="ident" id="6484221">err</span>&nbsp;<span class="op" id="6484225">!=</span>&nbsp;<span class="ident" id="6484228">nil</span>&nbsp;<span class="op" id="6484232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6484236">t</span><span class="op" id="6484237">.</span><span class="ident" id="6484238">Fatal</span><span class="op" id="6484243">(</span><span class="ident" id="6484244">err</span><span class="op" id="6484247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6484250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6484253">if</span>&nbsp;<span class="ident" id="6484256">hdr</span><span class="op" id="6484259">.</span><span class="ident" id="6484260">Name</span>&nbsp;<span class="op" id="6484265">!=</span>&nbsp;<span class="ident" id="6484268">longName</span>&nbsp;<span class="op" id="6484277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6484281">t</span><span class="op" id="6484282">.</span><span class="ident" id="6484283">Fatal</span><span class="op" id="6484288">(</span><span class="string" id="6484289">&#34;Couldn&#39;t&nbsp;recover&nbsp;long&nbsp;name&#34;</span><span class="op" id="6484317">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6484320">}</span><br>
<span class="lineno"></span><span class="op" id="6484322">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6484325">func</span>&nbsp;<span class="ident" id="6484330">TestValidTypeflagWithPAXHeader</span><span class="op" id="6484360">(</span><span class="ident" id="6484361">t</span>&nbsp;<span class="op" id="6484363">*</span><span class="ident" id="6484364">testing</span><span class="op" id="6484371">.</span><span class="ident" id="6484372">T</span><span class="op" id="6484373">)</span>&nbsp;<span class="op" id="6484375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6484378">var</span>&nbsp;<span class="ident" id="6484382">buffer</span>&nbsp;<span class="ident" id="6484389">bytes</span><span class="op" id="6484394">.</span><span class="ident" id="6484395">Buffer</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6484403">tw</span>&nbsp;<span class="op" id="6484406">:=</span>&nbsp;<span class="ident" id="6484409">NewWriter</span><span class="op" id="6484418">(</span><span class="op" id="6484419">&amp;</span><span class="ident" id="6484420">buffer</span><span class="op" id="6484426">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6484430">fileName</span>&nbsp;<span class="op" id="6484439">:=</span>&nbsp;<span class="ident" id="6484442">strings</span><span class="op" id="6484449">.</span><span class="ident" id="6484450">Repeat</span><span class="op" id="6484456">(</span><span class="string" id="6484457">&#34;ab&#34;</span><span class="op" id="6484461">,</span>&nbsp;<span class="num" id="6484463">100</span><span class="op" id="6484466">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6484470">hdr</span>&nbsp;<span class="op" id="6484474">:=</span>&nbsp;<span class="op" id="6484477">&amp;</span><span class="ident" id="6484478">Header</span><span class="op" id="6484484">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6484488">Name</span><span class="op" id="6484492">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6484498">fileName</span><span class="op" id="6484506">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6484510">Size</span><span class="op" id="6484514">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6484520">4</span><span class="op" id="6484521">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6484525">Typeflag</span><span class="op" id="6484533">:</span>&nbsp;<span class="num" id="6484535">0</span><span class="op" id="6484536">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6484539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6484542">if</span>&nbsp;<span class="ident" id="6484545">err</span>&nbsp;<span class="op" id="6484549">:=</span>&nbsp;<span class="ident" id="6484552">tw</span><span class="op" id="6484554">.</span><span class="ident" id="6484555">WriteHeader</span><span class="op" id="6484566">(</span><span class="ident" id="6484567">hdr</span><span class="op" id="6484570">)</span><span class="op" id="6484571">;</span>&nbsp;<span class="ident" id="6484573">err</span>&nbsp;<span class="op" id="6484577">!=</span>&nbsp;<span class="ident" id="6484580">nil</span>&nbsp;<span class="op" id="6484584">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6484588">t</span><span class="op" id="6484589">.</span><span class="ident" id="6484590">Fatalf</span><span class="op" id="6484596">(</span><span class="string" id="6484597">&#34;Failed&nbsp;to&nbsp;write&nbsp;header:&nbsp;%s&#34;</span><span class="op" id="6484625">,</span>&nbsp;<span class="ident" id="6484627">err</span><span class="op" id="6484630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6484633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6484636">if</span>&nbsp;<span class="ident" id="6484639">_</span><span class="op" id="6484640">,</span>&nbsp;<span class="ident" id="6484642">err</span>&nbsp;<span class="op" id="6484646">:=</span>&nbsp;<span class="ident" id="6484649">tw</span><span class="op" id="6484651">.</span><span class="ident" id="6484652">Write</span><span class="op" id="6484657">(</span><span class="op" id="6484658">[</span><span class="op" id="6484659">]</span><span class="builtintype" id="6484660">byte</span><span class="op" id="6484664">(</span><span class="string" id="6484665">&#34;fooo&#34;</span><span class="op" id="6484671">)</span><span class="op" id="6484672">)</span><span class="op" id="6484673">;</span>&nbsp;<span class="ident" id="6484675">err</span>&nbsp;<span class="op" id="6484679">!=</span>&nbsp;<span class="ident" id="6484682">nil</span>&nbsp;<span class="op" id="6484686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6484690">t</span><span class="op" id="6484691">.</span><span class="ident" id="6484692">Fatalf</span><span class="op" id="6484698">(</span><span class="string" id="6484699">&#34;Failed&nbsp;to&nbsp;write&nbsp;the&nbsp;file&#39;s&nbsp;data:&nbsp;%s&#34;</span><span class="op" id="6484736">,</span>&nbsp;<span class="ident" id="6484738">err</span><span class="op" id="6484741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6484744">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6484747">tw</span><span class="op" id="6484749">.</span><span class="ident" id="6484750">Close</span><span class="op" id="6484755">(</span><span class="op" id="6484756">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6484760">tr</span>&nbsp;<span class="op" id="6484763">:=</span>&nbsp;<span class="ident" id="6484766">NewReader</span><span class="op" id="6484775">(</span><span class="op" id="6484776">&amp;</span><span class="ident" id="6484777">buffer</span><span class="op" id="6484783">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6484787">for</span>&nbsp;<span class="op" id="6484791">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6484795">header</span><span class="op" id="6484801">,</span>&nbsp;<span class="ident" id="6484803">err</span>&nbsp;<span class="op" id="6484807">:=</span>&nbsp;<span class="ident" id="6484810">tr</span><span class="op" id="6484812">.</span><span class="ident" id="6484813">Next</span><span class="op" id="6484817">(</span><span class="op" id="6484818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6484822">if</span>&nbsp;<span class="ident" id="6484825">err</span>&nbsp;<span class="op" id="6484829">==</span>&nbsp;<span class="ident" id="6484832">io</span><span class="op" id="6484834">.</span><span class="ident" id="6484835">EOF</span>&nbsp;<span class="op" id="6484839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6484844">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6484852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6484856">if</span>&nbsp;<span class="ident" id="6484859">err</span>&nbsp;<span class="op" id="6484863">!=</span>&nbsp;<span class="ident" id="6484866">nil</span>&nbsp;<span class="op" id="6484870">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6484875">t</span><span class="op" id="6484876">.</span><span class="ident" id="6484877">Fatalf</span><span class="op" id="6484883">(</span><span class="string" id="6484884">&#34;Failed&nbsp;to&nbsp;read&nbsp;header:&nbsp;%s&#34;</span><span class="op" id="6484911">,</span>&nbsp;<span class="ident" id="6484913">err</span><span class="op" id="6484916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6484920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6484924">if</span>&nbsp;<span class="ident" id="6484927">header</span><span class="op" id="6484933">.</span><span class="ident" id="6484934">Typeflag</span>&nbsp;<span class="op" id="6484943">!=</span>&nbsp;<span class="num" id="6484946">0</span>&nbsp;<span class="op" id="6484948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6484953">t</span><span class="op" id="6484954">.</span><span class="ident" id="6484955">Fatalf</span><span class="op" id="6484961">(</span><span class="string" id="6484962">&#34;Typeflag&nbsp;should&#39;ve&nbsp;been&nbsp;0,&nbsp;found&nbsp;%d&#34;</span><span class="op" id="6484999">,</span>&nbsp;<span class="ident" id="6485001">header</span><span class="op" id="6485007">.</span><span class="ident" id="6485008">Typeflag</span><span class="op" id="6485016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6485020">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6485023">}</span><br>
<span class="lineno"></span><span class="op" id="6485025">}</span>
</div>
</body>
</html>
