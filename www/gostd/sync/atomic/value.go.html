<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>sync/atomic</h2>
<ul>
<li><a href="/gostd/sync/atomic/atomic_test.go.html">atomic_test.go</a></li>
<li><a href="/gostd/sync/atomic/doc.go.html">doc.go</a></li>
<li><a href="/gostd/sync/atomic/value.go.html" class="current">value.go</a></li>
<li><a href="/gostd/sync/atomic/value_test.go.html">value_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1428410">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1428465">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1428519">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1428570">package</span>&nbsp;<span class="ident" id="1428578">atomic</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1428586">import</span>&nbsp;<span class="op" id="1428593">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1428596">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1428605">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="1428608">//&nbsp;A&nbsp;Value&nbsp;provides&nbsp;an&nbsp;atomic&nbsp;load&nbsp;and&nbsp;store&nbsp;of&nbsp;a&nbsp;consistently&nbsp;typed&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="1428684">//&nbsp;Values&nbsp;can&nbsp;be&nbsp;created&nbsp;as&nbsp;part&nbsp;of&nbsp;other&nbsp;data&nbsp;structures.</span><br>
<span class="lineno"></span><span class="comment" id="1428743">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;a&nbsp;Value&nbsp;returns&nbsp;nil&nbsp;from&nbsp;Load.</span><br>
<span class="lineno"></span><span class="comment" id="1428796">//&nbsp;Once&nbsp;Store&nbsp;has&nbsp;been&nbsp;called,&nbsp;a&nbsp;Value&nbsp;must&nbsp;not&nbsp;be&nbsp;copied.</span><br>
<span class="lineno">15</span><span class="keyword" id="1428855">type</span>&nbsp;<span class="ident" id="1428860">Value</span>&nbsp;<span class="keyword" id="1428866">struct</span>&nbsp;<span class="op" id="1428873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1428876">v</span>&nbsp;<span class="keyword" id="1428878">interface</span><span class="op" id="1428887">{</span><span class="op" id="1428888">}</span><br>
<span class="lineno"></span><span class="op" id="1428890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1428893">//&nbsp;ifaceWords&nbsp;is&nbsp;interface{}&nbsp;internal&nbsp;representation.</span><br>
<span class="lineno">20</span><span class="keyword" id="1428947">type</span>&nbsp;<span class="ident" id="1428952">ifaceWords</span>&nbsp;<span class="keyword" id="1428963">struct</span>&nbsp;<span class="op" id="1428970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1428973">typ</span>&nbsp;&nbsp;<span class="ident" id="1428978">unsafe</span><span class="op" id="1428984">.</span><span class="ident" id="1428985">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1428994">data</span>&nbsp;<span class="ident" id="1428999">unsafe</span><span class="op" id="1429005">.</span><span class="ident" id="1429006">Pointer</span><br>
<span class="lineno"></span><span class="op" id="1429014">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="1429017">//&nbsp;Load&nbsp;returns&nbsp;the&nbsp;value&nbsp;set&nbsp;by&nbsp;the&nbsp;most&nbsp;recent&nbsp;Store.</span><br>
<span class="lineno"></span><span class="comment" id="1429073">//&nbsp;It&nbsp;returns&nbsp;nil&nbsp;if&nbsp;there&nbsp;has&nbsp;been&nbsp;no&nbsp;call&nbsp;to&nbsp;Store&nbsp;for&nbsp;this&nbsp;Value.</span><br>
<span class="lineno"></span><span class="keyword" id="1429142">func</span>&nbsp;<span class="op" id="1429147">(</span><span class="ident" id="1429148">v</span>&nbsp;<span class="op" id="1429150">*</span><span class="ident" id="1429151">Value</span><span class="op" id="1429156">)</span>&nbsp;<span class="ident" id="1429158">Load</span><span class="op" id="1429162">(</span><span class="op" id="1429163">)</span>&nbsp;<span class="op" id="1429165">(</span><span class="ident" id="1429166">x</span>&nbsp;<span class="keyword" id="1429168">interface</span><span class="op" id="1429177">{</span><span class="op" id="1429178">}</span><span class="op" id="1429179">)</span>&nbsp;<span class="op" id="1429181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1429184">vp</span>&nbsp;<span class="op" id="1429187">:=</span>&nbsp;<span class="op" id="1429190">(</span><span class="op" id="1429191">*</span><span class="ident" id="1429192">ifaceWords</span><span class="op" id="1429202">)</span><span class="op" id="1429203">(</span><span class="ident" id="1429204">unsafe</span><span class="op" id="1429210">.</span><span class="ident" id="1429211">Pointer</span><span class="op" id="1429218">(</span><span class="ident" id="1429219">v</span><span class="op" id="1429220">)</span><span class="op" id="1429221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1429224">typ</span>&nbsp;<span class="op" id="1429228">:=</span>&nbsp;<span class="ident" id="1429231">LoadPointer</span><span class="op" id="1429242">(</span><span class="op" id="1429243">&amp;</span><span class="ident" id="1429244">vp</span><span class="op" id="1429246">.</span><span class="ident" id="1429247">typ</span><span class="op" id="1429250">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1429253">if</span>&nbsp;<span class="ident" id="1429256">typ</span>&nbsp;<span class="op" id="1429260">==</span>&nbsp;<span class="builtintype" id="1429263">nil</span>&nbsp;<span class="op" id="1429267">||</span>&nbsp;<span class="builtintype" id="1429270">uintptr</span><span class="op" id="1429277">(</span><span class="ident" id="1429278">typ</span><span class="op" id="1429281">)</span>&nbsp;<span class="op" id="1429283">==</span>&nbsp;<span class="op" id="1429286">^</span><span class="builtintype" id="1429287">uintptr</span><span class="op" id="1429294">(</span><span class="num" id="1429295">0</span><span class="op" id="1429296">)</span>&nbsp;<span class="op" id="1429298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1429302">//&nbsp;First&nbsp;store&nbsp;not&nbsp;yet&nbsp;completed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1429338">return</span>&nbsp;<span class="builtintype" id="1429345">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1429350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1429353">data</span>&nbsp;<span class="op" id="1429358">:=</span>&nbsp;<span class="ident" id="1429361">LoadPointer</span><span class="op" id="1429372">(</span><span class="op" id="1429373">&amp;</span><span class="ident" id="1429374">vp</span><span class="op" id="1429376">.</span><span class="ident" id="1429377">data</span><span class="op" id="1429381">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1429384">xp</span>&nbsp;<span class="op" id="1429387">:=</span>&nbsp;<span class="op" id="1429390">(</span><span class="op" id="1429391">*</span><span class="ident" id="1429392">ifaceWords</span><span class="op" id="1429402">)</span><span class="op" id="1429403">(</span><span class="ident" id="1429404">unsafe</span><span class="op" id="1429410">.</span><span class="ident" id="1429411">Pointer</span><span class="op" id="1429418">(</span><span class="op" id="1429419">&amp;</span><span class="ident" id="1429420">x</span><span class="op" id="1429421">)</span><span class="op" id="1429422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1429425">xp</span><span class="op" id="1429427">.</span><span class="ident" id="1429428">typ</span>&nbsp;<span class="op" id="1429432">=</span>&nbsp;<span class="ident" id="1429434">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1429439">xp</span><span class="op" id="1429441">.</span><span class="ident" id="1429442">data</span>&nbsp;<span class="op" id="1429447">=</span>&nbsp;<span class="ident" id="1429449">data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1429455">return</span><br>
<span class="lineno"></span><span class="op" id="1429462">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="1429465">//&nbsp;Store&nbsp;sets&nbsp;the&nbsp;value&nbsp;of&nbsp;the&nbsp;Value&nbsp;to&nbsp;x.</span><br>
<span class="lineno"></span><span class="comment" id="1429508">//&nbsp;All&nbsp;calls&nbsp;to&nbsp;Store&nbsp;for&nbsp;a&nbsp;given&nbsp;Value&nbsp;must&nbsp;use&nbsp;values&nbsp;of&nbsp;the&nbsp;same&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="1429591">//&nbsp;Store&nbsp;of&nbsp;an&nbsp;inconsistent&nbsp;type&nbsp;panics,&nbsp;as&nbsp;does&nbsp;Store(nil).</span><br>
<span class="lineno"></span><span class="keyword" id="1429652">func</span>&nbsp;<span class="op" id="1429657">(</span><span class="ident" id="1429658">v</span>&nbsp;<span class="op" id="1429660">*</span><span class="ident" id="1429661">Value</span><span class="op" id="1429666">)</span>&nbsp;<span class="ident" id="1429668">Store</span><span class="op" id="1429673">(</span><span class="ident" id="1429674">x</span>&nbsp;<span class="keyword" id="1429676">interface</span><span class="op" id="1429685">{</span><span class="op" id="1429686">}</span><span class="op" id="1429687">)</span>&nbsp;<span class="op" id="1429689">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1429692">if</span>&nbsp;<span class="ident" id="1429695">x</span>&nbsp;<span class="op" id="1429697">==</span>&nbsp;<span class="builtintype" id="1429700">nil</span>&nbsp;<span class="op" id="1429704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1429708">panic</span><span class="op" id="1429713">(</span><span class="string" id="1429714">&#34;sync/atomic:&nbsp;store&nbsp;of&nbsp;nil&nbsp;value&nbsp;into&nbsp;Value&#34;</span><span class="op" id="1429758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1429761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1429764">vp</span>&nbsp;<span class="op" id="1429767">:=</span>&nbsp;<span class="op" id="1429770">(</span><span class="op" id="1429771">*</span><span class="ident" id="1429772">ifaceWords</span><span class="op" id="1429782">)</span><span class="op" id="1429783">(</span><span class="ident" id="1429784">unsafe</span><span class="op" id="1429790">.</span><span class="ident" id="1429791">Pointer</span><span class="op" id="1429798">(</span><span class="ident" id="1429799">v</span><span class="op" id="1429800">)</span><span class="op" id="1429801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1429804">xp</span>&nbsp;<span class="op" id="1429807">:=</span>&nbsp;<span class="op" id="1429810">(</span><span class="op" id="1429811">*</span><span class="ident" id="1429812">ifaceWords</span><span class="op" id="1429822">)</span><span class="op" id="1429823">(</span><span class="ident" id="1429824">unsafe</span><span class="op" id="1429830">.</span><span class="ident" id="1429831">Pointer</span><span class="op" id="1429838">(</span><span class="op" id="1429839">&amp;</span><span class="ident" id="1429840">x</span><span class="op" id="1429841">)</span><span class="op" id="1429842">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1429845">for</span>&nbsp;<span class="op" id="1429849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1429853">typ</span>&nbsp;<span class="op" id="1429857">:=</span>&nbsp;<span class="ident" id="1429860">LoadPointer</span><span class="op" id="1429871">(</span><span class="op" id="1429872">&amp;</span><span class="ident" id="1429873">vp</span><span class="op" id="1429875">.</span><span class="ident" id="1429876">typ</span><span class="op" id="1429879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1429883">if</span>&nbsp;<span class="ident" id="1429886">typ</span>&nbsp;<span class="op" id="1429890">==</span>&nbsp;<span class="builtintype" id="1429893">nil</span>&nbsp;<span class="op" id="1429897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1429902">//&nbsp;Attempt&nbsp;to&nbsp;start&nbsp;first&nbsp;store.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1429938">//&nbsp;Disable&nbsp;preemption&nbsp;so&nbsp;that&nbsp;other&nbsp;goroutines&nbsp;can&nbsp;use</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1429996">//&nbsp;active&nbsp;spin&nbsp;wait&nbsp;to&nbsp;wait&nbsp;for&nbsp;completion;&nbsp;and&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1430055">//&nbsp;GC&nbsp;does&nbsp;not&nbsp;see&nbsp;the&nbsp;fake&nbsp;type&nbsp;accidentally.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1430105">runtime_procPin</span><span class="op" id="1430120">(</span><span class="op" id="1430121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1430126">if</span>&nbsp;<span class="op" id="1430129">!</span><span class="ident" id="1430130">CompareAndSwapPointer</span><span class="op" id="1430151">(</span><span class="op" id="1430152">&amp;</span><span class="ident" id="1430153">vp</span><span class="op" id="1430155">.</span><span class="ident" id="1430156">typ</span><span class="op" id="1430159">,</span>&nbsp;<span class="builtintype" id="1430161">nil</span><span class="op" id="1430164">,</span>&nbsp;<span class="ident" id="1430166">unsafe</span><span class="op" id="1430172">.</span><span class="ident" id="1430173">Pointer</span><span class="op" id="1430180">(</span><span class="op" id="1430181">^</span><span class="builtintype" id="1430182">uintptr</span><span class="op" id="1430189">(</span><span class="num" id="1430190">0</span><span class="op" id="1430191">)</span><span class="op" id="1430192">)</span><span class="op" id="1430193">)</span>&nbsp;<span class="op" id="1430195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1430201">runtime_procUnpin</span><span class="op" id="1430218">(</span><span class="op" id="1430219">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1430225">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1430237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1430242">//&nbsp;Complete&nbsp;first&nbsp;store.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1430270">StorePointer</span><span class="op" id="1430282">(</span><span class="op" id="1430283">&amp;</span><span class="ident" id="1430284">vp</span><span class="op" id="1430286">.</span><span class="ident" id="1430287">data</span><span class="op" id="1430291">,</span>&nbsp;<span class="ident" id="1430293">xp</span><span class="op" id="1430295">.</span><span class="ident" id="1430296">data</span><span class="op" id="1430300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1430305">StorePointer</span><span class="op" id="1430317">(</span><span class="op" id="1430318">&amp;</span><span class="ident" id="1430319">vp</span><span class="op" id="1430321">.</span><span class="ident" id="1430322">typ</span><span class="op" id="1430325">,</span>&nbsp;<span class="ident" id="1430327">xp</span><span class="op" id="1430329">.</span><span class="ident" id="1430330">typ</span><span class="op" id="1430333">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1430338">runtime_procUnpin</span><span class="op" id="1430355">(</span><span class="op" id="1430356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1430361">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1430370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1430374">if</span>&nbsp;<span class="builtintype" id="1430377">uintptr</span><span class="op" id="1430384">(</span><span class="ident" id="1430385">typ</span><span class="op" id="1430388">)</span>&nbsp;<span class="op" id="1430390">==</span>&nbsp;<span class="op" id="1430393">^</span><span class="builtintype" id="1430394">uintptr</span><span class="op" id="1430401">(</span><span class="num" id="1430402">0</span><span class="op" id="1430403">)</span>&nbsp;<span class="op" id="1430405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1430410">//&nbsp;First&nbsp;store&nbsp;in&nbsp;progress.&nbsp;Wait.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1430447">//&nbsp;Since&nbsp;we&nbsp;disable&nbsp;preemption&nbsp;around&nbsp;the&nbsp;first&nbsp;store,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1430505">//&nbsp;we&nbsp;can&nbsp;wait&nbsp;with&nbsp;active&nbsp;spinning.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1430545">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1430556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1430560">//&nbsp;First&nbsp;store&nbsp;completed.&nbsp;Check&nbsp;type&nbsp;and&nbsp;overwrite&nbsp;data.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1430619">if</span>&nbsp;<span class="ident" id="1430622">typ</span>&nbsp;<span class="op" id="1430626">!=</span>&nbsp;<span class="ident" id="1430629">xp</span><span class="op" id="1430631">.</span><span class="ident" id="1430632">typ</span>&nbsp;<span class="op" id="1430636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1430641">panic</span><span class="op" id="1430646">(</span><span class="string" id="1430647">&#34;sync/atomic:&nbsp;store&nbsp;of&nbsp;inconsistently&nbsp;typed&nbsp;value&nbsp;into&nbsp;Value&#34;</span><span class="op" id="1430708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1430712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1430716">StorePointer</span><span class="op" id="1430728">(</span><span class="op" id="1430729">&amp;</span><span class="ident" id="1430730">vp</span><span class="op" id="1430732">.</span><span class="ident" id="1430733">data</span><span class="op" id="1430737">,</span>&nbsp;<span class="ident" id="1430739">xp</span><span class="op" id="1430741">.</span><span class="ident" id="1430742">data</span><span class="op" id="1430746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1430750">return</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1430758">}</span><br>
<span class="lineno"></span><span class="op" id="1430760">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1430763">//&nbsp;Disable/enable&nbsp;preemption,&nbsp;implemented&nbsp;in&nbsp;runtime.</span><br>
<span class="lineno"></span><span class="keyword" id="1430817">func</span>&nbsp;<span class="ident" id="1430822">runtime_procPin</span><span class="op" id="1430837">(</span><span class="op" id="1430838">)</span><br>
<span class="lineno">85</span><span class="keyword" id="1430840">func</span>&nbsp;<span class="ident" id="1430845">runtime_procUnpin</span><span class="op" id="1430862">(</span><span class="op" id="1430863">)</span>
</div>
</body>
</html>
