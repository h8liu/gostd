<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/token</h2>
<ul>
<li><a href="/gostd/go/token/position.go.html">position.go</a></li>
<li><a href="/gostd/go/token/position_test.go.html">position_test.go</a></li>
<li><a href="/gostd/go/token/serialize.go.html">serialize.go</a></li>
<li><a href="/gostd/go/token/serialize_test.go.html">serialize_test.go</a></li>
<li><a href="/gostd/go/token/token.go.html">token.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4320434">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4320489">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4320543">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4320594">package</span>&nbsp;<span class="ident" id="4320602">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4320609">type</span>&nbsp;<span class="ident" id="4320614">serializedFile</span>&nbsp;<span class="keyword" id="4320629">struct</span>&nbsp;<span class="op" id="4320636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4320639">//&nbsp;fields&nbsp;correspond&nbsp;1:1&nbsp;to&nbsp;fields&nbsp;with&nbsp;same&nbsp;(lower-case)&nbsp;name&nbsp;in&nbsp;File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4320711">Name</span>&nbsp;&nbsp;<span class="builtintype" id="4320717">string</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4320725">Base</span>&nbsp;&nbsp;<span class="builtintype" id="4320731">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4320736">Size</span>&nbsp;&nbsp;<span class="builtintype" id="4320742">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4320747">Lines</span>&nbsp;<span class="op" id="4320753">[</span><span class="op" id="4320754">]</span><span class="builtintype" id="4320755">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4320760">Infos</span>&nbsp;<span class="op" id="4320766">[</span><span class="op" id="4320767">]</span><span class="ident" id="4320768">lineInfo</span><br>
<span class="lineno"></span><span class="op" id="4320777">}</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="4320780">type</span>&nbsp;<span class="ident" id="4320785">serializedFileSet</span>&nbsp;<span class="keyword" id="4320803">struct</span>&nbsp;<span class="op" id="4320810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4320813">Base</span>&nbsp;&nbsp;<span class="builtintype" id="4320819">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4320824">Files</span>&nbsp;<span class="op" id="4320830">[</span><span class="op" id="4320831">]</span><span class="ident" id="4320832">serializedFile</span><br>
<span class="lineno"></span><span class="op" id="4320847">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="4320850">//&nbsp;Read&nbsp;calls&nbsp;decode&nbsp;to&nbsp;deserialize&nbsp;a&nbsp;file&nbsp;set&nbsp;into&nbsp;s;&nbsp;s&nbsp;must&nbsp;not&nbsp;be&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="4320924">func</span>&nbsp;<span class="op" id="4320929">(</span><span class="ident" id="4320930">s</span>&nbsp;<span class="op" id="4320932">*</span><span class="ident" id="4320933">FileSet</span><span class="op" id="4320940">)</span>&nbsp;<span class="ident" id="4320942">Read</span><span class="op" id="4320946">(</span><span class="ident" id="4320947">decode</span>&nbsp;<span class="keyword" id="4320954">func</span><span class="op" id="4320958">(</span><span class="keyword" id="4320959">interface</span><span class="op" id="4320968">{</span><span class="op" id="4320969">}</span><span class="op" id="4320970">)</span>&nbsp;<span class="builtintype" id="4320972">error</span><span class="op" id="4320977">)</span>&nbsp;<span class="builtintype" id="4320979">error</span>&nbsp;<span class="op" id="4320985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4320988">var</span>&nbsp;<span class="ident" id="4320992">ss</span>&nbsp;<span class="ident" id="4320995">serializedFileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4321014">if</span>&nbsp;<span class="ident" id="4321017">err</span>&nbsp;<span class="op" id="4321021">:=</span>&nbsp;<span class="ident" id="4321024">decode</span><span class="op" id="4321030">(</span><span class="op" id="4321031">&amp;</span><span class="ident" id="4321032">ss</span><span class="op" id="4321034">)</span><span class="op" id="4321035">;</span>&nbsp;<span class="ident" id="4321037">err</span>&nbsp;<span class="op" id="4321041">!=</span>&nbsp;<span class="ident" id="4321044">nil</span>&nbsp;<span class="op" id="4321048">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4321052">return</span>&nbsp;<span class="ident" id="4321059">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4321064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321068">s</span><span class="op" id="4321069">.</span><span class="ident" id="4321070">mutex</span><span class="op" id="4321075">.</span><span class="ident" id="4321076">Lock</span><span class="op" id="4321080">(</span><span class="op" id="4321081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321084">s</span><span class="op" id="4321085">.</span><span class="ident" id="4321086">base</span>&nbsp;<span class="op" id="4321091">=</span>&nbsp;<span class="ident" id="4321093">ss</span><span class="op" id="4321095">.</span><span class="ident" id="4321096">Base</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321102">files</span>&nbsp;<span class="op" id="4321108">:=</span>&nbsp;<span class="builtinfunc" id="4321111">make</span><span class="op" id="4321115">(</span><span class="op" id="4321116">[</span><span class="op" id="4321117">]</span><span class="op" id="4321118">*</span><span class="ident" id="4321119">File</span><span class="op" id="4321123">,</span>&nbsp;<span class="builtinfunc" id="4321125">len</span><span class="op" id="4321128">(</span><span class="ident" id="4321129">ss</span><span class="op" id="4321131">.</span><span class="ident" id="4321132">Files</span><span class="op" id="4321137">)</span><span class="op" id="4321138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4321141">for</span>&nbsp;<span class="ident" id="4321145">i</span>&nbsp;<span class="op" id="4321147">:=</span>&nbsp;<span class="num" id="4321150">0</span><span class="op" id="4321151">;</span>&nbsp;<span class="ident" id="4321153">i</span>&nbsp;<span class="op" id="4321155">&lt;</span>&nbsp;<span class="builtinfunc" id="4321157">len</span><span class="op" id="4321160">(</span><span class="ident" id="4321161">ss</span><span class="op" id="4321163">.</span><span class="ident" id="4321164">Files</span><span class="op" id="4321169">)</span><span class="op" id="4321170">;</span>&nbsp;<span class="ident" id="4321172">i</span><span class="op" id="4321173">++</span>&nbsp;<span class="op" id="4321176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321180">f</span>&nbsp;<span class="op" id="4321182">:=</span>&nbsp;<span class="op" id="4321185">&amp;</span><span class="ident" id="4321186">ss</span><span class="op" id="4321188">.</span><span class="ident" id="4321189">Files</span><span class="op" id="4321194">[</span><span class="ident" id="4321195">i</span><span class="op" id="4321196">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321200">files</span><span class="op" id="4321205">[</span><span class="ident" id="4321206">i</span><span class="op" id="4321207">]</span>&nbsp;<span class="op" id="4321209">=</span>&nbsp;<span class="op" id="4321211">&amp;</span><span class="ident" id="4321212">File</span><span class="op" id="4321216">{</span><span class="ident" id="4321217">s</span><span class="op" id="4321218">,</span>&nbsp;<span class="ident" id="4321220">f</span><span class="op" id="4321221">.</span><span class="ident" id="4321222">Name</span><span class="op" id="4321226">,</span>&nbsp;<span class="ident" id="4321228">f</span><span class="op" id="4321229">.</span><span class="ident" id="4321230">Base</span><span class="op" id="4321234">,</span>&nbsp;<span class="ident" id="4321236">f</span><span class="op" id="4321237">.</span><span class="ident" id="4321238">Size</span><span class="op" id="4321242">,</span>&nbsp;<span class="ident" id="4321244">f</span><span class="op" id="4321245">.</span><span class="ident" id="4321246">Lines</span><span class="op" id="4321251">,</span>&nbsp;<span class="ident" id="4321253">f</span><span class="op" id="4321254">.</span><span class="ident" id="4321255">Infos</span><span class="op" id="4321260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4321263">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321266">s</span><span class="op" id="4321267">.</span><span class="ident" id="4321268">files</span>&nbsp;<span class="op" id="4321274">=</span>&nbsp;<span class="ident" id="4321276">files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321283">s</span><span class="op" id="4321284">.</span><span class="ident" id="4321285">last</span>&nbsp;<span class="op" id="4321290">=</span>&nbsp;<span class="ident" id="4321292">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321297">s</span><span class="op" id="4321298">.</span><span class="ident" id="4321299">mutex</span><span class="op" id="4321304">.</span><span class="ident" id="4321305">Unlock</span><span class="op" id="4321311">(</span><span class="op" id="4321312">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4321316">return</span>&nbsp;<span class="ident" id="4321323">nil</span><br>
<span class="lineno">40</span><span class="op" id="4321327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4321330">//&nbsp;Write&nbsp;calls&nbsp;encode&nbsp;to&nbsp;serialize&nbsp;the&nbsp;file&nbsp;set&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="4321381">func</span>&nbsp;<span class="op" id="4321386">(</span><span class="ident" id="4321387">s</span>&nbsp;<span class="op" id="4321389">*</span><span class="ident" id="4321390">FileSet</span><span class="op" id="4321397">)</span>&nbsp;<span class="ident" id="4321399">Write</span><span class="op" id="4321404">(</span><span class="ident" id="4321405">encode</span>&nbsp;<span class="keyword" id="4321412">func</span><span class="op" id="4321416">(</span><span class="keyword" id="4321417">interface</span><span class="op" id="4321426">{</span><span class="op" id="4321427">}</span><span class="op" id="4321428">)</span>&nbsp;<span class="builtintype" id="4321430">error</span><span class="op" id="4321435">)</span>&nbsp;<span class="builtintype" id="4321437">error</span>&nbsp;<span class="op" id="4321443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4321446">var</span>&nbsp;<span class="ident" id="4321450">ss</span>&nbsp;<span class="ident" id="4321453">serializedFileSet</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321473">s</span><span class="op" id="4321474">.</span><span class="ident" id="4321475">mutex</span><span class="op" id="4321480">.</span><span class="ident" id="4321481">Lock</span><span class="op" id="4321485">(</span><span class="op" id="4321486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321489">ss</span><span class="op" id="4321491">.</span><span class="ident" id="4321492">Base</span>&nbsp;<span class="op" id="4321497">=</span>&nbsp;<span class="ident" id="4321499">s</span><span class="op" id="4321500">.</span><span class="ident" id="4321501">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321507">files</span>&nbsp;<span class="op" id="4321513">:=</span>&nbsp;<span class="builtinfunc" id="4321516">make</span><span class="op" id="4321520">(</span><span class="op" id="4321521">[</span><span class="op" id="4321522">]</span><span class="ident" id="4321523">serializedFile</span><span class="op" id="4321537">,</span>&nbsp;<span class="builtinfunc" id="4321539">len</span><span class="op" id="4321542">(</span><span class="ident" id="4321543">s</span><span class="op" id="4321544">.</span><span class="ident" id="4321545">files</span><span class="op" id="4321550">)</span><span class="op" id="4321551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4321554">for</span>&nbsp;<span class="ident" id="4321558">i</span><span class="op" id="4321559">,</span>&nbsp;<span class="ident" id="4321561">f</span>&nbsp;<span class="op" id="4321563">:=</span>&nbsp;<span class="keyword" id="4321566">range</span>&nbsp;<span class="ident" id="4321572">s</span><span class="op" id="4321573">.</span><span class="ident" id="4321574">files</span>&nbsp;<span class="op" id="4321580">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321584">files</span><span class="op" id="4321589">[</span><span class="ident" id="4321590">i</span><span class="op" id="4321591">]</span>&nbsp;<span class="op" id="4321593">=</span>&nbsp;<span class="ident" id="4321595">serializedFile</span><span class="op" id="4321609">{</span><span class="ident" id="4321610">f</span><span class="op" id="4321611">.</span><span class="ident" id="4321612">name</span><span class="op" id="4321616">,</span>&nbsp;<span class="ident" id="4321618">f</span><span class="op" id="4321619">.</span><span class="ident" id="4321620">base</span><span class="op" id="4321624">,</span>&nbsp;<span class="ident" id="4321626">f</span><span class="op" id="4321627">.</span><span class="ident" id="4321628">size</span><span class="op" id="4321632">,</span>&nbsp;<span class="ident" id="4321634">f</span><span class="op" id="4321635">.</span><span class="ident" id="4321636">lines</span><span class="op" id="4321641">,</span>&nbsp;<span class="ident" id="4321643">f</span><span class="op" id="4321644">.</span><span class="ident" id="4321645">infos</span><span class="op" id="4321650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4321653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321656">ss</span><span class="op" id="4321658">.</span><span class="ident" id="4321659">Files</span>&nbsp;<span class="op" id="4321665">=</span>&nbsp;<span class="ident" id="4321667">files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321674">s</span><span class="op" id="4321675">.</span><span class="ident" id="4321676">mutex</span><span class="op" id="4321681">.</span><span class="ident" id="4321682">Unlock</span><span class="op" id="4321688">(</span><span class="op" id="4321689">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4321693">return</span>&nbsp;<span class="ident" id="4321700">encode</span><span class="op" id="4321706">(</span><span class="ident" id="4321707">ss</span><span class="op" id="4321709">)</span><br>
<span class="lineno"></span><span class="op" id="4321711">}</span>
</div>
</body>
</html>
