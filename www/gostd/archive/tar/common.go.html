<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5472680">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5472735">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5472789">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5472840">//&nbsp;Package&nbsp;tar&nbsp;implements&nbsp;access&nbsp;to&nbsp;tar&nbsp;archives.</span><br>
<span class="lineno"></span><span class="comment" id="5472890">//&nbsp;It&nbsp;aims&nbsp;to&nbsp;cover&nbsp;most&nbsp;of&nbsp;the&nbsp;variations,&nbsp;including&nbsp;those&nbsp;produced</span><br>
<span class="lineno"></span><span class="comment" id="5472959">//&nbsp;by&nbsp;GNU&nbsp;and&nbsp;BSD&nbsp;tars.</span><br>
<span class="lineno"></span><span class="comment" id="5472983">//</span><br>
<span class="lineno"></span><span class="comment" id="5472986">//&nbsp;References:</span><br>
<span class="lineno">10</span><span class="comment" id="5473001">//&nbsp;&nbsp;&nbsp;http://www.freebsd.org/cgi/man.cgi?query=tar&amp;sektion=5</span><br>
<span class="lineno"></span><span class="comment" id="5473061">//&nbsp;&nbsp;&nbsp;http://www.gnu.org/software/tar/manual/html_node/Standard.html</span><br>
<span class="lineno"></span><span class="comment" id="5473129">//&nbsp;&nbsp;&nbsp;http://pubs.opengroup.org/onlinepubs/9699919799/utilities/pax.html</span><br>
<span class="lineno"></span><span class="keyword" id="5473201">package</span>&nbsp;<span class="ident" id="5473209">tar</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="5473214">import</span>&nbsp;<span class="op" id="5473221">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5473224">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5473233">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5473243">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5473250">&#34;os&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5473256">&#34;path&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5473264">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="5473271">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5473274">const</span>&nbsp;<span class="op" id="5473280">(</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473283">blockSize</span>&nbsp;<span class="op" id="5473293">=</span>&nbsp;<span class="num" id="5473295">512</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5473301">//&nbsp;Types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473311">TypeReg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5473329">=</span>&nbsp;<span class="string" id="5473331">&#39;0&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5473338">//&nbsp;regular&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473355">TypeRegA</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5473373">=</span>&nbsp;<span class="string" id="5473375">&#39;\x00&#39;</span>&nbsp;<span class="comment" id="5473382">//&nbsp;regular&nbsp;file</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473399">TypeLink</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5473417">=</span>&nbsp;<span class="string" id="5473419">&#39;1&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5473426">//&nbsp;hard&nbsp;link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473440">TypeSymlink</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5473458">=</span>&nbsp;<span class="string" id="5473460">&#39;2&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5473467">//&nbsp;symbolic&nbsp;link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473485">TypeChar</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5473503">=</span>&nbsp;<span class="string" id="5473505">&#39;3&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5473512">//&nbsp;character&nbsp;device&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473538">TypeBlock</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5473556">=</span>&nbsp;<span class="string" id="5473558">&#39;4&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5473565">//&nbsp;block&nbsp;device&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473587">TypeDir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5473605">=</span>&nbsp;<span class="string" id="5473607">&#39;5&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5473614">//&nbsp;directory</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473628">TypeFifo</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5473646">=</span>&nbsp;<span class="string" id="5473648">&#39;6&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5473655">//&nbsp;fifo&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473669">TypeCont</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5473687">=</span>&nbsp;<span class="string" id="5473689">&#39;7&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5473696">//&nbsp;reserved</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473709">TypeXHeader</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5473727">=</span>&nbsp;<span class="string" id="5473729">&#39;x&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5473736">//&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473756">TypeXGlobalHeader</span>&nbsp;<span class="op" id="5473774">=</span>&nbsp;<span class="string" id="5473776">&#39;g&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5473783">//&nbsp;global&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473810">TypeGNULongName</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5473828">=</span>&nbsp;<span class="string" id="5473830">&#39;L&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5473837">//&nbsp;Next&nbsp;file&nbsp;has&nbsp;a&nbsp;long&nbsp;name</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473867">TypeGNULongLink</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5473885">=</span>&nbsp;<span class="string" id="5473887">&#39;K&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5473894">//&nbsp;Next&nbsp;file&nbsp;symlinks&nbsp;to&nbsp;a&nbsp;file&nbsp;w/&nbsp;a&nbsp;long&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473942">TypeGNUSparse</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5473960">=</span>&nbsp;<span class="string" id="5473962">&#39;S&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5473969">//&nbsp;sparse&nbsp;file</span><br>
<span class="lineno"></span><span class="op" id="5473984">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5473987">//&nbsp;A&nbsp;Header&nbsp;represents&nbsp;a&nbsp;single&nbsp;header&nbsp;in&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno">45</span><span class="comment" id="5474044">//&nbsp;Some&nbsp;fields&nbsp;may&nbsp;not&nbsp;be&nbsp;populated.</span><br>
<span class="lineno"></span><span class="keyword" id="5474081">type</span>&nbsp;<span class="ident" id="5474086">Header</span>&nbsp;<span class="keyword" id="5474093">struct</span>&nbsp;<span class="op" id="5474100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5474103">Name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5474114">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5474124">//&nbsp;name&nbsp;of&nbsp;header&nbsp;file&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5474154">Mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5474165">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5474175">//&nbsp;permission&nbsp;and&nbsp;mode&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5474204">Uid</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5474215">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5474225">//&nbsp;user&nbsp;id&nbsp;of&nbsp;owner</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5474246">Gid</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5474257">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5474267">//&nbsp;group&nbsp;id&nbsp;of&nbsp;owner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5474289">Size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5474300">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5474310">//&nbsp;length&nbsp;in&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5474330">ModTime</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5474341">time</span><span class="op" id="5474345">.</span><span class="ident" id="5474346">Time</span>&nbsp;<span class="comment" id="5474351">//&nbsp;modified&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5474369">Typeflag</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5474380">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5474390">//&nbsp;type&nbsp;of&nbsp;header&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5474415">Linkname</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5474426">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5474436">//&nbsp;target&nbsp;name&nbsp;of&nbsp;link</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5474460">Uname</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5474471">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5474481">//&nbsp;user&nbsp;name&nbsp;of&nbsp;owner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5474504">Gname</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5474515">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5474525">//&nbsp;group&nbsp;name&nbsp;of&nbsp;owner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5474549">Devmajor</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5474560">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5474570">//&nbsp;major&nbsp;number&nbsp;of&nbsp;character&nbsp;or&nbsp;block&nbsp;device</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5474616">Devminor</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5474627">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5474637">//&nbsp;minor&nbsp;number&nbsp;of&nbsp;character&nbsp;or&nbsp;block&nbsp;device</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5474683">AccessTime</span>&nbsp;<span class="ident" id="5474694">time</span><span class="op" id="5474698">.</span><span class="ident" id="5474699">Time</span>&nbsp;<span class="comment" id="5474704">//&nbsp;access&nbsp;time</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5474720">ChangeTime</span>&nbsp;<span class="ident" id="5474731">time</span><span class="op" id="5474735">.</span><span class="ident" id="5474736">Time</span>&nbsp;<span class="comment" id="5474741">//&nbsp;status&nbsp;change&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5474764">Xattrs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5474775">map</span><span class="op" id="5474778">[</span><span class="builtintype" id="5474779">string</span><span class="op" id="5474785">]</span><span class="builtintype" id="5474786">string</span><br>
<span class="lineno"></span><span class="op" id="5474793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5474796">//&nbsp;File&nbsp;name&nbsp;constants&nbsp;from&nbsp;the&nbsp;tar&nbsp;spec.</span><br>
<span class="lineno">65</span><span class="keyword" id="5474838">const</span>&nbsp;<span class="op" id="5474844">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5474847">fileNameSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5474866">=</span>&nbsp;<span class="num" id="5474868">100</span>&nbsp;<span class="comment" id="5474872">//&nbsp;Maximum&nbsp;number&nbsp;of&nbsp;bytes&nbsp;in&nbsp;a&nbsp;standard&nbsp;tar&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5474924">fileNamePrefixSize</span>&nbsp;<span class="op" id="5474943">=</span>&nbsp;<span class="num" id="5474945">155</span>&nbsp;<span class="comment" id="5474949">//&nbsp;Maximum&nbsp;number&nbsp;of&nbsp;ustar&nbsp;extension&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="op" id="5474993">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="comment" id="5474996">//&nbsp;FileInfo&nbsp;returns&nbsp;an&nbsp;os.FileInfo&nbsp;for&nbsp;the&nbsp;Header.</span><br>
<span class="lineno"></span><span class="keyword" id="5475047">func</span>&nbsp;<span class="op" id="5475052">(</span><span class="ident" id="5475053">h</span>&nbsp;<span class="op" id="5475055">*</span><span class="ident" id="5475056">Header</span><span class="op" id="5475062">)</span>&nbsp;<span class="ident" id="5475064">FileInfo</span><span class="op" id="5475072">(</span><span class="op" id="5475073">)</span>&nbsp;<span class="ident" id="5475075">os</span><span class="op" id="5475077">.</span><span class="ident" id="5475078">FileInfo</span>&nbsp;<span class="op" id="5475087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5475090">return</span>&nbsp;<span class="ident" id="5475097">headerFileInfo</span><span class="op" id="5475111">{</span><span class="ident" id="5475112">h</span><span class="op" id="5475113">}</span><br>
<span class="lineno"></span><span class="op" id="5475115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="5475118">//&nbsp;headerFileInfo&nbsp;implements&nbsp;os.FileInfo.</span><br>
<span class="lineno"></span><span class="keyword" id="5475160">type</span>&nbsp;<span class="ident" id="5475165">headerFileInfo</span>&nbsp;<span class="keyword" id="5475180">struct</span>&nbsp;<span class="op" id="5475187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5475190">h</span>&nbsp;<span class="op" id="5475192">*</span><span class="ident" id="5475193">Header</span><br>
<span class="lineno"></span><span class="op" id="5475200">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="5475203">func</span>&nbsp;<span class="op" id="5475208">(</span><span class="ident" id="5475209">fi</span>&nbsp;<span class="ident" id="5475212">headerFileInfo</span><span class="op" id="5475226">)</span>&nbsp;<span class="ident" id="5475228">Size</span><span class="op" id="5475232">(</span><span class="op" id="5475233">)</span>&nbsp;<span class="ident" id="5475235">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5475248">{</span>&nbsp;<span class="keyword" id="5475250">return</span>&nbsp;<span class="ident" id="5475257">fi</span><span class="op" id="5475259">.</span><span class="ident" id="5475260">h</span><span class="op" id="5475261">.</span><span class="ident" id="5475262">Size</span>&nbsp;<span class="op" id="5475267">}</span><br>
<span class="lineno"></span><span class="keyword" id="5475269">func</span>&nbsp;<span class="op" id="5475274">(</span><span class="ident" id="5475275">fi</span>&nbsp;<span class="ident" id="5475278">headerFileInfo</span><span class="op" id="5475292">)</span>&nbsp;<span class="ident" id="5475294">IsDir</span><span class="op" id="5475299">(</span><span class="op" id="5475300">)</span>&nbsp;<span class="builtintype" id="5475302">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5475314">{</span>&nbsp;<span class="keyword" id="5475316">return</span>&nbsp;<span class="ident" id="5475323">fi</span><span class="op" id="5475325">.</span><span class="ident" id="5475326">Mode</span><span class="op" id="5475330">(</span><span class="op" id="5475331">)</span><span class="op" id="5475332">.</span><span class="ident" id="5475333">IsDir</span><span class="op" id="5475338">(</span><span class="op" id="5475339">)</span>&nbsp;<span class="op" id="5475341">}</span><br>
<span class="lineno"></span><span class="keyword" id="5475343">func</span>&nbsp;<span class="op" id="5475348">(</span><span class="ident" id="5475349">fi</span>&nbsp;<span class="ident" id="5475352">headerFileInfo</span><span class="op" id="5475366">)</span>&nbsp;<span class="ident" id="5475368">ModTime</span><span class="op" id="5475375">(</span><span class="op" id="5475376">)</span>&nbsp;<span class="ident" id="5475378">time</span><span class="op" id="5475382">.</span><span class="ident" id="5475383">Time</span>&nbsp;<span class="op" id="5475388">{</span>&nbsp;<span class="keyword" id="5475390">return</span>&nbsp;<span class="ident" id="5475397">fi</span><span class="op" id="5475399">.</span><span class="ident" id="5475400">h</span><span class="op" id="5475401">.</span><span class="ident" id="5475402">ModTime</span>&nbsp;<span class="op" id="5475410">}</span><br>
<span class="lineno"></span><span class="keyword" id="5475412">func</span>&nbsp;<span class="op" id="5475417">(</span><span class="ident" id="5475418">fi</span>&nbsp;<span class="ident" id="5475421">headerFileInfo</span><span class="op" id="5475435">)</span>&nbsp;<span class="ident" id="5475437">Sys</span><span class="op" id="5475440">(</span><span class="op" id="5475441">)</span>&nbsp;<span class="keyword" id="5475443">interface</span><span class="op" id="5475452">{</span><span class="op" id="5475453">}</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5475457">{</span>&nbsp;<span class="keyword" id="5475459">return</span>&nbsp;<span class="ident" id="5475466">fi</span><span class="op" id="5475468">.</span><span class="ident" id="5475469">h</span>&nbsp;<span class="op" id="5475471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="5475474">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;base&nbsp;name&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="5475517">func</span>&nbsp;<span class="op" id="5475522">(</span><span class="ident" id="5475523">fi</span>&nbsp;<span class="ident" id="5475526">headerFileInfo</span><span class="op" id="5475540">)</span>&nbsp;<span class="ident" id="5475542">Name</span><span class="op" id="5475546">(</span><span class="op" id="5475547">)</span>&nbsp;<span class="builtintype" id="5475549">string</span>&nbsp;<span class="op" id="5475556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5475559">if</span>&nbsp;<span class="ident" id="5475562">fi</span><span class="op" id="5475564">.</span><span class="ident" id="5475565">IsDir</span><span class="op" id="5475570">(</span><span class="op" id="5475571">)</span>&nbsp;<span class="op" id="5475573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5475577">return</span>&nbsp;<span class="ident" id="5475584">path</span><span class="op" id="5475588">.</span><span class="ident" id="5475589">Base</span><span class="op" id="5475593">(</span><span class="ident" id="5475594">path</span><span class="op" id="5475598">.</span><span class="ident" id="5475599">Clean</span><span class="op" id="5475604">(</span><span class="ident" id="5475605">fi</span><span class="op" id="5475607">.</span><span class="ident" id="5475608">h</span><span class="op" id="5475609">.</span><span class="ident" id="5475610">Name</span><span class="op" id="5475614">)</span><span class="op" id="5475615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5475618">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5475621">return</span>&nbsp;<span class="ident" id="5475628">path</span><span class="op" id="5475632">.</span><span class="ident" id="5475633">Base</span><span class="op" id="5475637">(</span><span class="ident" id="5475638">fi</span><span class="op" id="5475640">.</span><span class="ident" id="5475641">h</span><span class="op" id="5475642">.</span><span class="ident" id="5475643">Name</span><span class="op" id="5475647">)</span><br>
<span class="lineno"></span><span class="op" id="5475649">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5475652">//&nbsp;Mode&nbsp;returns&nbsp;the&nbsp;permission&nbsp;and&nbsp;mode&nbsp;bits&nbsp;for&nbsp;the&nbsp;headerFileInfo.</span><br>
<span class="lineno"></span><span class="keyword" id="5475721">func</span>&nbsp;<span class="op" id="5475726">(</span><span class="ident" id="5475727">fi</span>&nbsp;<span class="ident" id="5475730">headerFileInfo</span><span class="op" id="5475744">)</span>&nbsp;<span class="ident" id="5475746">Mode</span><span class="op" id="5475750">(</span><span class="op" id="5475751">)</span>&nbsp;<span class="op" id="5475753">(</span><span class="ident" id="5475754">mode</span>&nbsp;<span class="ident" id="5475759">os</span><span class="op" id="5475761">.</span><span class="ident" id="5475762">FileMode</span><span class="op" id="5475770">)</span>&nbsp;<span class="op" id="5475772">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5475775">//&nbsp;Set&nbsp;file&nbsp;permission&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5475805">mode</span>&nbsp;<span class="op" id="5475810">=</span>&nbsp;<span class="ident" id="5475812">os</span><span class="op" id="5475814">.</span><span class="ident" id="5475815">FileMode</span><span class="op" id="5475823">(</span><span class="ident" id="5475824">fi</span><span class="op" id="5475826">.</span><span class="ident" id="5475827">h</span><span class="op" id="5475828">.</span><span class="ident" id="5475829">Mode</span><span class="op" id="5475833">)</span><span class="op" id="5475834">.</span><span class="ident" id="5475835">Perm</span><span class="op" id="5475839">(</span><span class="op" id="5475840">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5475844">//&nbsp;Set&nbsp;setuid,&nbsp;setgid&nbsp;and&nbsp;sticky&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5475884">if</span>&nbsp;<span class="ident" id="5475887">fi</span><span class="op" id="5475889">.</span><span class="ident" id="5475890">h</span><span class="op" id="5475891">.</span><span class="ident" id="5475892">Mode</span><span class="op" id="5475896">&amp;</span><span class="ident" id="5475897">c_ISUID</span>&nbsp;<span class="op" id="5475905">!=</span>&nbsp;<span class="num" id="5475908">0</span>&nbsp;<span class="op" id="5475910">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5475914">//&nbsp;setuid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5475926">mode</span>&nbsp;<span class="op" id="5475931">|=</span>&nbsp;<span class="ident" id="5475934">os</span><span class="op" id="5475936">.</span><span class="ident" id="5475937">ModeSetuid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5475949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5475952">if</span>&nbsp;<span class="ident" id="5475955">fi</span><span class="op" id="5475957">.</span><span class="ident" id="5475958">h</span><span class="op" id="5475959">.</span><span class="ident" id="5475960">Mode</span><span class="op" id="5475964">&amp;</span><span class="ident" id="5475965">c_ISGID</span>&nbsp;<span class="op" id="5475973">!=</span>&nbsp;<span class="num" id="5475976">0</span>&nbsp;<span class="op" id="5475978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5475982">//&nbsp;setgid</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5475994">mode</span>&nbsp;<span class="op" id="5475999">|=</span>&nbsp;<span class="ident" id="5476002">os</span><span class="op" id="5476004">.</span><span class="ident" id="5476005">ModeSetgid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5476017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476020">if</span>&nbsp;<span class="ident" id="5476023">fi</span><span class="op" id="5476025">.</span><span class="ident" id="5476026">h</span><span class="op" id="5476027">.</span><span class="ident" id="5476028">Mode</span><span class="op" id="5476032">&amp;</span><span class="ident" id="5476033">c_ISVTX</span>&nbsp;<span class="op" id="5476041">!=</span>&nbsp;<span class="num" id="5476044">0</span>&nbsp;<span class="op" id="5476046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5476050">//&nbsp;sticky</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476062">mode</span>&nbsp;<span class="op" id="5476067">|=</span>&nbsp;<span class="ident" id="5476070">os</span><span class="op" id="5476072">.</span><span class="ident" id="5476073">ModeSticky</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5476085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5476089">//&nbsp;Set&nbsp;file&nbsp;mode&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5476113">//&nbsp;clear&nbsp;perm,&nbsp;setuid,&nbsp;setgid&nbsp;and&nbsp;sticky&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476161">m</span>&nbsp;<span class="op" id="5476163">:=</span>&nbsp;<span class="ident" id="5476166">os</span><span class="op" id="5476168">.</span><span class="ident" id="5476169">FileMode</span><span class="op" id="5476177">(</span><span class="ident" id="5476178">fi</span><span class="op" id="5476180">.</span><span class="ident" id="5476181">h</span><span class="op" id="5476182">.</span><span class="ident" id="5476183">Mode</span><span class="op" id="5476187">)</span>&nbsp;<span class="op" id="5476189">&amp;^</span>&nbsp;<span class="num" id="5476192">07777</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476199">if</span>&nbsp;<span class="ident" id="5476202">m</span>&nbsp;<span class="op" id="5476204">==</span>&nbsp;<span class="ident" id="5476207">c_ISDIR</span>&nbsp;<span class="op" id="5476215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5476219">//&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476234">mode</span>&nbsp;<span class="op" id="5476239">|=</span>&nbsp;<span class="ident" id="5476242">os</span><span class="op" id="5476244">.</span><span class="ident" id="5476245">ModeDir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5476254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476257">if</span>&nbsp;<span class="ident" id="5476260">m</span>&nbsp;<span class="op" id="5476262">==</span>&nbsp;<span class="ident" id="5476265">c_ISFIFO</span>&nbsp;<span class="op" id="5476274">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5476278">//&nbsp;named&nbsp;pipe&nbsp;(FIFO)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476301">mode</span>&nbsp;<span class="op" id="5476306">|=</span>&nbsp;<span class="ident" id="5476309">os</span><span class="op" id="5476311">.</span><span class="ident" id="5476312">ModeNamedPipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5476327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476330">if</span>&nbsp;<span class="ident" id="5476333">m</span>&nbsp;<span class="op" id="5476335">==</span>&nbsp;<span class="ident" id="5476338">c_ISLNK</span>&nbsp;<span class="op" id="5476346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5476350">//&nbsp;symbolic&nbsp;link</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476369">mode</span>&nbsp;<span class="op" id="5476374">|=</span>&nbsp;<span class="ident" id="5476377">os</span><span class="op" id="5476379">.</span><span class="ident" id="5476380">ModeSymlink</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5476393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476396">if</span>&nbsp;<span class="ident" id="5476399">m</span>&nbsp;<span class="op" id="5476401">==</span>&nbsp;<span class="ident" id="5476404">c_ISBLK</span>&nbsp;<span class="op" id="5476412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5476416">//&nbsp;device&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476433">mode</span>&nbsp;<span class="op" id="5476438">|=</span>&nbsp;<span class="ident" id="5476441">os</span><span class="op" id="5476443">.</span><span class="ident" id="5476444">ModeDevice</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5476456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476459">if</span>&nbsp;<span class="ident" id="5476462">m</span>&nbsp;<span class="op" id="5476464">==</span>&nbsp;<span class="ident" id="5476467">c_ISCHR</span>&nbsp;<span class="op" id="5476475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5476479">//&nbsp;Unix&nbsp;character&nbsp;device</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476506">mode</span>&nbsp;<span class="op" id="5476511">|=</span>&nbsp;<span class="ident" id="5476514">os</span><span class="op" id="5476516">.</span><span class="ident" id="5476517">ModeDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476530">mode</span>&nbsp;<span class="op" id="5476535">|=</span>&nbsp;<span class="ident" id="5476538">os</span><span class="op" id="5476540">.</span><span class="ident" id="5476541">ModeCharDevice</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5476557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476560">if</span>&nbsp;<span class="ident" id="5476563">m</span>&nbsp;<span class="op" id="5476565">==</span>&nbsp;<span class="ident" id="5476568">c_ISSOCK</span>&nbsp;<span class="op" id="5476577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5476581">//&nbsp;Unix&nbsp;domain&nbsp;socket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476605">mode</span>&nbsp;<span class="op" id="5476610">|=</span>&nbsp;<span class="ident" id="5476613">os</span><span class="op" id="5476615">.</span><span class="ident" id="5476616">ModeSocket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5476628">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476632">switch</span>&nbsp;<span class="ident" id="5476639">fi</span><span class="op" id="5476641">.</span><span class="ident" id="5476642">h</span><span class="op" id="5476643">.</span><span class="ident" id="5476644">Typeflag</span>&nbsp;<span class="op" id="5476653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476656">case</span>&nbsp;<span class="ident" id="5476661">TypeLink</span><span class="op" id="5476669">,</span>&nbsp;<span class="ident" id="5476671">TypeSymlink</span><span class="op" id="5476682">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5476686">//&nbsp;hard&nbsp;link,&nbsp;symbolic&nbsp;link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476716">mode</span>&nbsp;<span class="op" id="5476721">|=</span>&nbsp;<span class="ident" id="5476724">os</span><span class="op" id="5476726">.</span><span class="ident" id="5476727">ModeSymlink</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476740">case</span>&nbsp;<span class="ident" id="5476745">TypeChar</span><span class="op" id="5476753">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5476757">//&nbsp;character&nbsp;device&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476784">mode</span>&nbsp;<span class="op" id="5476789">|=</span>&nbsp;<span class="ident" id="5476792">os</span><span class="op" id="5476794">.</span><span class="ident" id="5476795">ModeDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476808">mode</span>&nbsp;<span class="op" id="5476813">|=</span>&nbsp;<span class="ident" id="5476816">os</span><span class="op" id="5476818">.</span><span class="ident" id="5476819">ModeCharDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476835">case</span>&nbsp;<span class="ident" id="5476840">TypeBlock</span><span class="op" id="5476849">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5476853">//&nbsp;block&nbsp;device&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476876">mode</span>&nbsp;<span class="op" id="5476881">|=</span>&nbsp;<span class="ident" id="5476884">os</span><span class="op" id="5476886">.</span><span class="ident" id="5476887">ModeDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476899">case</span>&nbsp;<span class="ident" id="5476904">TypeDir</span><span class="op" id="5476911">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5476915">//&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476930">mode</span>&nbsp;<span class="op" id="5476935">|=</span>&nbsp;<span class="ident" id="5476938">os</span><span class="op" id="5476940">.</span><span class="ident" id="5476941">ModeDir</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476950">case</span>&nbsp;<span class="ident" id="5476955">TypeFifo</span><span class="op" id="5476963">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5476967">//&nbsp;fifo&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476982">mode</span>&nbsp;<span class="op" id="5476987">|=</span>&nbsp;<span class="ident" id="5476990">os</span><span class="op" id="5476992">.</span><span class="ident" id="5476993">ModeNamedPipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5477008">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5477012">return</span>&nbsp;<span class="ident" id="5477019">mode</span><br>
<span class="lineno"></span><span class="op" id="5477024">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5477027">//&nbsp;sysStat,&nbsp;if&nbsp;non-nil,&nbsp;populates&nbsp;h&nbsp;from&nbsp;system-dependent&nbsp;fields&nbsp;of&nbsp;fi.</span><br>
<span class="lineno"></span><span class="keyword" id="5477099">var</span>&nbsp;<span class="ident" id="5477103">sysStat</span>&nbsp;<span class="keyword" id="5477111">func</span><span class="op" id="5477115">(</span><span class="ident" id="5477116">fi</span>&nbsp;<span class="ident" id="5477119">os</span><span class="op" id="5477121">.</span><span class="ident" id="5477122">FileInfo</span><span class="op" id="5477130">,</span>&nbsp;<span class="ident" id="5477132">h</span>&nbsp;<span class="op" id="5477134">*</span><span class="ident" id="5477135">Header</span><span class="op" id="5477141">)</span>&nbsp;<span class="builtintype" id="5477143">error</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="comment" id="5477150">//&nbsp;Mode&nbsp;constants&nbsp;from&nbsp;the&nbsp;tar&nbsp;spec.</span><br>
<span class="lineno"></span><span class="keyword" id="5477187">const</span>&nbsp;<span class="op" id="5477193">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477196">c_ISUID</span>&nbsp;&nbsp;<span class="op" id="5477205">=</span>&nbsp;<span class="num" id="5477207">04000</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5477215">//&nbsp;Set&nbsp;uid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477227">c_ISGID</span>&nbsp;&nbsp;<span class="op" id="5477236">=</span>&nbsp;<span class="num" id="5477238">02000</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5477246">//&nbsp;Set&nbsp;gid</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477258">c_ISVTX</span>&nbsp;&nbsp;<span class="op" id="5477267">=</span>&nbsp;<span class="num" id="5477269">01000</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5477277">//&nbsp;Save&nbsp;text&nbsp;(sticky&nbsp;bit)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477304">c_ISDIR</span>&nbsp;&nbsp;<span class="op" id="5477313">=</span>&nbsp;<span class="num" id="5477315">040000</span>&nbsp;&nbsp;<span class="comment" id="5477323">//&nbsp;Directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477337">c_ISFIFO</span>&nbsp;<span class="op" id="5477346">=</span>&nbsp;<span class="num" id="5477348">010000</span>&nbsp;&nbsp;<span class="comment" id="5477356">//&nbsp;FIFO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477365">c_ISREG</span>&nbsp;&nbsp;<span class="op" id="5477374">=</span>&nbsp;<span class="num" id="5477376">0100000</span>&nbsp;<span class="comment" id="5477384">//&nbsp;Regular&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477401">c_ISLNK</span>&nbsp;&nbsp;<span class="op" id="5477410">=</span>&nbsp;<span class="num" id="5477412">0120000</span>&nbsp;<span class="comment" id="5477420">//&nbsp;Symbolic&nbsp;link</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477438">c_ISBLK</span>&nbsp;&nbsp;<span class="op" id="5477447">=</span>&nbsp;<span class="num" id="5477449">060000</span>&nbsp;&nbsp;<span class="comment" id="5477457">//&nbsp;Block&nbsp;special&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477480">c_ISCHR</span>&nbsp;&nbsp;<span class="op" id="5477489">=</span>&nbsp;<span class="num" id="5477491">020000</span>&nbsp;&nbsp;<span class="comment" id="5477499">//&nbsp;Character&nbsp;special&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477526">c_ISSOCK</span>&nbsp;<span class="op" id="5477535">=</span>&nbsp;<span class="num" id="5477537">0140000</span>&nbsp;<span class="comment" id="5477545">//&nbsp;Socket</span><br>
<span class="lineno"></span><span class="op" id="5477555">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="5477558">//&nbsp;Keywords&nbsp;for&nbsp;the&nbsp;PAX&nbsp;Extended&nbsp;Header</span><br>
<span class="lineno"></span><span class="keyword" id="5477598">const</span>&nbsp;<span class="op" id="5477604">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477607">paxAtime</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5477619">=</span>&nbsp;<span class="string" id="5477621">&#34;atime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477630">paxCharset</span>&nbsp;&nbsp;<span class="op" id="5477642">=</span>&nbsp;<span class="string" id="5477644">&#34;charset&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477655">paxComment</span>&nbsp;&nbsp;<span class="op" id="5477667">=</span>&nbsp;<span class="string" id="5477669">&#34;comment&#34;</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477680">paxCtime</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5477692">=</span>&nbsp;<span class="string" id="5477694">&#34;ctime&#34;</span>&nbsp;<span class="comment" id="5477702">//&nbsp;please&nbsp;note&nbsp;that&nbsp;ctime&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;pax&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477756">paxGid</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5477768">=</span>&nbsp;<span class="string" id="5477770">&#34;gid&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477777">paxGname</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5477789">=</span>&nbsp;<span class="string" id="5477791">&#34;gname&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477800">paxLinkpath</span>&nbsp;<span class="op" id="5477812">=</span>&nbsp;<span class="string" id="5477814">&#34;linkpath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477826">paxMtime</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5477838">=</span>&nbsp;<span class="string" id="5477840">&#34;mtime&#34;</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477849">paxPath</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5477861">=</span>&nbsp;<span class="string" id="5477863">&#34;path&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477871">paxSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5477883">=</span>&nbsp;<span class="string" id="5477885">&#34;size&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477893">paxUid</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5477905">=</span>&nbsp;<span class="string" id="5477907">&#34;uid&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477914">paxUname</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5477926">=</span>&nbsp;<span class="string" id="5477928">&#34;uname&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477937">paxXattr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5477949">=</span>&nbsp;<span class="string" id="5477951">&#34;SCHILY.xattr.&#34;</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477968">paxNone</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5477980">=</span>&nbsp;<span class="string" id="5477982">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="5477985">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5477988">//&nbsp;FileInfoHeader&nbsp;creates&nbsp;a&nbsp;partially-populated&nbsp;Header&nbsp;from&nbsp;fi.</span><br>
<span class="lineno"></span><span class="comment" id="5478052">//&nbsp;If&nbsp;fi&nbsp;describes&nbsp;a&nbsp;symlink,&nbsp;FileInfoHeader&nbsp;records&nbsp;link&nbsp;as&nbsp;the&nbsp;link&nbsp;target.</span><br>
<span class="lineno">200</span><span class="comment" id="5478130">//&nbsp;If&nbsp;fi&nbsp;describes&nbsp;a&nbsp;directory,&nbsp;a&nbsp;slash&nbsp;is&nbsp;appended&nbsp;to&nbsp;the&nbsp;name.</span><br>
<span class="lineno"></span><span class="comment" id="5478195">//&nbsp;Because&nbsp;os.FileInfo&#39;s&nbsp;Name&nbsp;method&nbsp;returns&nbsp;only&nbsp;the&nbsp;base&nbsp;name&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5478262">//&nbsp;the&nbsp;file&nbsp;it&nbsp;describes,&nbsp;it&nbsp;may&nbsp;be&nbsp;necessary&nbsp;to&nbsp;modify&nbsp;the&nbsp;Name&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="5478333">//&nbsp;of&nbsp;the&nbsp;returned&nbsp;header&nbsp;to&nbsp;provide&nbsp;the&nbsp;full&nbsp;path&nbsp;name&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="5478402">func</span>&nbsp;<span class="ident" id="5478407">FileInfoHeader</span><span class="op" id="5478421">(</span><span class="ident" id="5478422">fi</span>&nbsp;<span class="ident" id="5478425">os</span><span class="op" id="5478427">.</span><span class="ident" id="5478428">FileInfo</span><span class="op" id="5478436">,</span>&nbsp;<span class="ident" id="5478438">link</span>&nbsp;<span class="builtintype" id="5478443">string</span><span class="op" id="5478449">)</span>&nbsp;<span class="op" id="5478451">(</span><span class="op" id="5478452">*</span><span class="ident" id="5478453">Header</span><span class="op" id="5478459">,</span>&nbsp;<span class="builtintype" id="5478461">error</span><span class="op" id="5478466">)</span>&nbsp;<span class="op" id="5478468">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5478471">if</span>&nbsp;<span class="ident" id="5478474">fi</span>&nbsp;<span class="op" id="5478477">==</span>&nbsp;<span class="ident" id="5478480">nil</span>&nbsp;<span class="op" id="5478484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5478488">return</span>&nbsp;<span class="ident" id="5478495">nil</span><span class="op" id="5478498">,</span>&nbsp;<span class="ident" id="5478500">errors</span><span class="op" id="5478506">.</span><span class="ident" id="5478507">New</span><span class="op" id="5478510">(</span><span class="string" id="5478511">&#34;tar:&nbsp;FileInfo&nbsp;is&nbsp;nil&#34;</span><span class="op" id="5478533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5478536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5478539">fm</span>&nbsp;<span class="op" id="5478542">:=</span>&nbsp;<span class="ident" id="5478545">fi</span><span class="op" id="5478547">.</span><span class="ident" id="5478548">Mode</span><span class="op" id="5478552">(</span><span class="op" id="5478553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5478556">h</span>&nbsp;<span class="op" id="5478558">:=</span>&nbsp;<span class="op" id="5478561">&amp;</span><span class="ident" id="5478562">Header</span><span class="op" id="5478568">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5478572">Name</span><span class="op" id="5478576">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5478581">fi</span><span class="op" id="5478583">.</span><span class="ident" id="5478584">Name</span><span class="op" id="5478588">(</span><span class="op" id="5478589">)</span><span class="op" id="5478590">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5478594">ModTime</span><span class="op" id="5478601">:</span>&nbsp;<span class="ident" id="5478603">fi</span><span class="op" id="5478605">.</span><span class="ident" id="5478606">ModTime</span><span class="op" id="5478613">(</span><span class="op" id="5478614">)</span><span class="op" id="5478615">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5478619">Mode</span><span class="op" id="5478623">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5478628">int64</span><span class="op" id="5478633">(</span><span class="ident" id="5478634">fm</span><span class="op" id="5478636">.</span><span class="ident" id="5478637">Perm</span><span class="op" id="5478641">(</span><span class="op" id="5478642">)</span><span class="op" id="5478643">)</span><span class="op" id="5478644">,</span>&nbsp;<span class="comment" id="5478646">//&nbsp;or&#39;d&nbsp;with&nbsp;c_IS*&nbsp;constants&nbsp;later</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5478682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5478685">switch</span>&nbsp;<span class="op" id="5478692">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5478695">case</span>&nbsp;<span class="ident" id="5478700">fm</span><span class="op" id="5478702">.</span><span class="ident" id="5478703">IsRegular</span><span class="op" id="5478712">(</span><span class="op" id="5478713">)</span><span class="op" id="5478714">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5478718">h</span><span class="op" id="5478719">.</span><span class="ident" id="5478720">Mode</span>&nbsp;<span class="op" id="5478725">|=</span>&nbsp;<span class="ident" id="5478728">c_ISREG</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5478738">h</span><span class="op" id="5478739">.</span><span class="ident" id="5478740">Typeflag</span>&nbsp;<span class="op" id="5478749">=</span>&nbsp;<span class="ident" id="5478751">TypeReg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5478761">h</span><span class="op" id="5478762">.</span><span class="ident" id="5478763">Size</span>&nbsp;<span class="op" id="5478768">=</span>&nbsp;<span class="ident" id="5478770">fi</span><span class="op" id="5478772">.</span><span class="ident" id="5478773">Size</span><span class="op" id="5478777">(</span><span class="op" id="5478778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5478781">case</span>&nbsp;<span class="ident" id="5478786">fi</span><span class="op" id="5478788">.</span><span class="ident" id="5478789">IsDir</span><span class="op" id="5478794">(</span><span class="op" id="5478795">)</span><span class="op" id="5478796">:</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5478800">h</span><span class="op" id="5478801">.</span><span class="ident" id="5478802">Typeflag</span>&nbsp;<span class="op" id="5478811">=</span>&nbsp;<span class="ident" id="5478813">TypeDir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5478823">h</span><span class="op" id="5478824">.</span><span class="ident" id="5478825">Mode</span>&nbsp;<span class="op" id="5478830">|=</span>&nbsp;<span class="ident" id="5478833">c_ISDIR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5478843">h</span><span class="op" id="5478844">.</span><span class="ident" id="5478845">Name</span>&nbsp;<span class="op" id="5478850">+=</span>&nbsp;<span class="string" id="5478853">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5478858">case</span>&nbsp;<span class="ident" id="5478863">fm</span><span class="op" id="5478865">&amp;</span><span class="ident" id="5478866">os</span><span class="op" id="5478868">.</span><span class="ident" id="5478869">ModeSymlink</span>&nbsp;<span class="op" id="5478881">!=</span>&nbsp;<span class="num" id="5478884">0</span><span class="op" id="5478885">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5478889">h</span><span class="op" id="5478890">.</span><span class="ident" id="5478891">Typeflag</span>&nbsp;<span class="op" id="5478900">=</span>&nbsp;<span class="ident" id="5478902">TypeSymlink</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5478916">h</span><span class="op" id="5478917">.</span><span class="ident" id="5478918">Mode</span>&nbsp;<span class="op" id="5478923">|=</span>&nbsp;<span class="ident" id="5478926">c_ISLNK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5478936">h</span><span class="op" id="5478937">.</span><span class="ident" id="5478938">Linkname</span>&nbsp;<span class="op" id="5478947">=</span>&nbsp;<span class="ident" id="5478949">link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5478955">case</span>&nbsp;<span class="ident" id="5478960">fm</span><span class="op" id="5478962">&amp;</span><span class="ident" id="5478963">os</span><span class="op" id="5478965">.</span><span class="ident" id="5478966">ModeDevice</span>&nbsp;<span class="op" id="5478977">!=</span>&nbsp;<span class="num" id="5478980">0</span><span class="op" id="5478981">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5478985">if</span>&nbsp;<span class="ident" id="5478988">fm</span><span class="op" id="5478990">&amp;</span><span class="ident" id="5478991">os</span><span class="op" id="5478993">.</span><span class="ident" id="5478994">ModeCharDevice</span>&nbsp;<span class="op" id="5479009">!=</span>&nbsp;<span class="num" id="5479012">0</span>&nbsp;<span class="op" id="5479014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5479019">h</span><span class="op" id="5479020">.</span><span class="ident" id="5479021">Mode</span>&nbsp;<span class="op" id="5479026">|=</span>&nbsp;<span class="ident" id="5479029">c_ISCHR</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5479040">h</span><span class="op" id="5479041">.</span><span class="ident" id="5479042">Typeflag</span>&nbsp;<span class="op" id="5479051">=</span>&nbsp;<span class="ident" id="5479053">TypeChar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5479064">}</span>&nbsp;<span class="keyword" id="5479066">else</span>&nbsp;<span class="op" id="5479071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5479076">h</span><span class="op" id="5479077">.</span><span class="ident" id="5479078">Mode</span>&nbsp;<span class="op" id="5479083">|=</span>&nbsp;<span class="ident" id="5479086">c_ISBLK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5479097">h</span><span class="op" id="5479098">.</span><span class="ident" id="5479099">Typeflag</span>&nbsp;<span class="op" id="5479108">=</span>&nbsp;<span class="ident" id="5479110">TypeBlock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5479122">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5479125">case</span>&nbsp;<span class="ident" id="5479130">fm</span><span class="op" id="5479132">&amp;</span><span class="ident" id="5479133">os</span><span class="op" id="5479135">.</span><span class="ident" id="5479136">ModeNamedPipe</span>&nbsp;<span class="op" id="5479150">!=</span>&nbsp;<span class="num" id="5479153">0</span><span class="op" id="5479154">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5479158">h</span><span class="op" id="5479159">.</span><span class="ident" id="5479160">Typeflag</span>&nbsp;<span class="op" id="5479169">=</span>&nbsp;<span class="ident" id="5479171">TypeFifo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5479182">h</span><span class="op" id="5479183">.</span><span class="ident" id="5479184">Mode</span>&nbsp;<span class="op" id="5479189">|=</span>&nbsp;<span class="ident" id="5479192">c_ISFIFO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5479202">case</span>&nbsp;<span class="ident" id="5479207">fm</span><span class="op" id="5479209">&amp;</span><span class="ident" id="5479210">os</span><span class="op" id="5479212">.</span><span class="ident" id="5479213">ModeSocket</span>&nbsp;<span class="op" id="5479224">!=</span>&nbsp;<span class="num" id="5479227">0</span><span class="op" id="5479228">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5479232">h</span><span class="op" id="5479233">.</span><span class="ident" id="5479234">Mode</span>&nbsp;<span class="op" id="5479239">|=</span>&nbsp;<span class="ident" id="5479242">c_ISSOCK</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5479252">default</span><span class="op" id="5479259">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5479263">return</span>&nbsp;<span class="ident" id="5479270">nil</span><span class="op" id="5479273">,</span>&nbsp;<span class="ident" id="5479275">fmt</span><span class="op" id="5479278">.</span><span class="ident" id="5479279">Errorf</span><span class="op" id="5479285">(</span><span class="string" id="5479286">&#34;archive/tar:&nbsp;unknown&nbsp;file&nbsp;mode&nbsp;%v&#34;</span><span class="op" id="5479321">,</span>&nbsp;<span class="ident" id="5479323">fm</span><span class="op" id="5479325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5479328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5479331">if</span>&nbsp;<span class="ident" id="5479334">fm</span><span class="op" id="5479336">&amp;</span><span class="ident" id="5479337">os</span><span class="op" id="5479339">.</span><span class="ident" id="5479340">ModeSetuid</span>&nbsp;<span class="op" id="5479351">!=</span>&nbsp;<span class="num" id="5479354">0</span>&nbsp;<span class="op" id="5479356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5479360">h</span><span class="op" id="5479361">.</span><span class="ident" id="5479362">Mode</span>&nbsp;<span class="op" id="5479367">|=</span>&nbsp;<span class="ident" id="5479370">c_ISUID</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5479379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5479382">if</span>&nbsp;<span class="ident" id="5479385">fm</span><span class="op" id="5479387">&amp;</span><span class="ident" id="5479388">os</span><span class="op" id="5479390">.</span><span class="ident" id="5479391">ModeSetgid</span>&nbsp;<span class="op" id="5479402">!=</span>&nbsp;<span class="num" id="5479405">0</span>&nbsp;<span class="op" id="5479407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5479411">h</span><span class="op" id="5479412">.</span><span class="ident" id="5479413">Mode</span>&nbsp;<span class="op" id="5479418">|=</span>&nbsp;<span class="ident" id="5479421">c_ISGID</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5479430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5479433">if</span>&nbsp;<span class="ident" id="5479436">fm</span><span class="op" id="5479438">&amp;</span><span class="ident" id="5479439">os</span><span class="op" id="5479441">.</span><span class="ident" id="5479442">ModeSticky</span>&nbsp;<span class="op" id="5479453">!=</span>&nbsp;<span class="num" id="5479456">0</span>&nbsp;<span class="op" id="5479458">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5479462">h</span><span class="op" id="5479463">.</span><span class="ident" id="5479464">Mode</span>&nbsp;<span class="op" id="5479469">|=</span>&nbsp;<span class="ident" id="5479472">c_ISVTX</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5479481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5479484">if</span>&nbsp;<span class="ident" id="5479487">sysStat</span>&nbsp;<span class="op" id="5479495">!=</span>&nbsp;<span class="ident" id="5479498">nil</span>&nbsp;<span class="op" id="5479502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5479506">return</span>&nbsp;<span class="ident" id="5479513">h</span><span class="op" id="5479514">,</span>&nbsp;<span class="ident" id="5479516">sysStat</span><span class="op" id="5479523">(</span><span class="ident" id="5479524">fi</span><span class="op" id="5479526">,</span>&nbsp;<span class="ident" id="5479528">h</span><span class="op" id="5479529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5479532">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5479535">return</span>&nbsp;<span class="ident" id="5479542">h</span><span class="op" id="5479543">,</span>&nbsp;<span class="ident" id="5479545">nil</span><br>
<span class="lineno"></span><span class="op" id="5479549">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5479552">var</span>&nbsp;<span class="ident" id="5479556">zeroBlock</span>&nbsp;<span class="op" id="5479566">=</span>&nbsp;<span class="builtinfunc" id="5479568">make</span><span class="op" id="5479572">(</span><span class="op" id="5479573">[</span><span class="op" id="5479574">]</span><span class="builtintype" id="5479575">byte</span><span class="op" id="5479579">,</span>&nbsp;<span class="ident" id="5479581">blockSize</span><span class="op" id="5479590">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="comment" id="5479593">//&nbsp;POSIX&nbsp;specifies&nbsp;a&nbsp;sum&nbsp;of&nbsp;the&nbsp;unsigned&nbsp;byte&nbsp;values,&nbsp;but&nbsp;the&nbsp;Sun&nbsp;tar&nbsp;uses&nbsp;signed&nbsp;byte&nbsp;values.</span><br>
<span class="lineno"></span><span class="comment" id="5479688">//&nbsp;We&nbsp;compute&nbsp;and&nbsp;return&nbsp;both.</span><br>
<span class="lineno"></span><span class="keyword" id="5479719">func</span>&nbsp;<span class="ident" id="5479724">checksum</span><span class="op" id="5479732">(</span><span class="ident" id="5479733">header</span>&nbsp;<span class="op" id="5479740">[</span><span class="op" id="5479741">]</span><span class="builtintype" id="5479742">byte</span><span class="op" id="5479746">)</span>&nbsp;<span class="op" id="5479748">(</span><span class="ident" id="5479749">unsigned</span>&nbsp;<span class="ident" id="5479758">int64</span><span class="op" id="5479763">,</span>&nbsp;<span class="ident" id="5479765">signed</span>&nbsp;<span class="ident" id="5479772">int64</span><span class="op" id="5479777">)</span>&nbsp;<span class="op" id="5479779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5479782">for</span>&nbsp;<span class="ident" id="5479786">i</span>&nbsp;<span class="op" id="5479788">:=</span>&nbsp;<span class="num" id="5479791">0</span><span class="op" id="5479792">;</span>&nbsp;<span class="ident" id="5479794">i</span>&nbsp;<span class="op" id="5479796">&lt;</span>&nbsp;<span class="builtinfunc" id="5479798">len</span><span class="op" id="5479801">(</span><span class="ident" id="5479802">header</span><span class="op" id="5479808">)</span><span class="op" id="5479809">;</span>&nbsp;<span class="ident" id="5479811">i</span><span class="op" id="5479812">++</span>&nbsp;<span class="op" id="5479815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5479819">if</span>&nbsp;<span class="ident" id="5479822">i</span>&nbsp;<span class="op" id="5479824">==</span>&nbsp;<span class="num" id="5479827">148</span>&nbsp;<span class="op" id="5479831">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5479836">//&nbsp;The&nbsp;chksum&nbsp;field&nbsp;(header[148:156])&nbsp;is&nbsp;special:&nbsp;it&nbsp;should&nbsp;be&nbsp;treated&nbsp;as&nbsp;space&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5479926">unsigned</span>&nbsp;<span class="op" id="5479935">+=</span>&nbsp;<span class="string" id="5479938">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5479942">*</span>&nbsp;<span class="num" id="5479944">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5479949">signed</span>&nbsp;<span class="op" id="5479956">+=</span>&nbsp;<span class="string" id="5479959">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5479963">*</span>&nbsp;<span class="num" id="5479965">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5479970">i</span>&nbsp;<span class="op" id="5479972">+=</span>&nbsp;<span class="num" id="5479975">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5479980">continue</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5479991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5479995">unsigned</span>&nbsp;<span class="op" id="5480004">+=</span>&nbsp;<span class="ident" id="5480007">int64</span><span class="op" id="5480012">(</span><span class="ident" id="5480013">header</span><span class="op" id="5480019">[</span><span class="ident" id="5480020">i</span><span class="op" id="5480021">]</span><span class="op" id="5480022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5480026">signed</span>&nbsp;<span class="op" id="5480033">+=</span>&nbsp;<span class="ident" id="5480036">int64</span><span class="op" id="5480041">(</span><span class="builtintype" id="5480042">int8</span><span class="op" id="5480046">(</span><span class="ident" id="5480047">header</span><span class="op" id="5480053">[</span><span class="ident" id="5480054">i</span><span class="op" id="5480055">]</span><span class="op" id="5480056">)</span><span class="op" id="5480057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5480060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480063">return</span><br>
<span class="lineno">275</span><span class="op" id="5480070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5480073">type</span>&nbsp;<span class="ident" id="5480078">slicer</span>&nbsp;<span class="op" id="5480085">[</span><span class="op" id="5480086">]</span><span class="builtintype" id="5480087">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5480093">func</span>&nbsp;<span class="op" id="5480098">(</span><span class="ident" id="5480099">sp</span>&nbsp;<span class="op" id="5480102">*</span><span class="ident" id="5480103">slicer</span><span class="op" id="5480109">)</span>&nbsp;<span class="ident" id="5480111">next</span><span class="op" id="5480115">(</span><span class="ident" id="5480116">n</span>&nbsp;<span class="builtintype" id="5480118">int</span><span class="op" id="5480121">)</span>&nbsp;<span class="op" id="5480123">(</span><span class="ident" id="5480124">b</span>&nbsp;<span class="op" id="5480126">[</span><span class="op" id="5480127">]</span><span class="builtintype" id="5480128">byte</span><span class="op" id="5480132">)</span>&nbsp;<span class="op" id="5480134">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5480137">s</span>&nbsp;<span class="op" id="5480139">:=</span>&nbsp;<span class="op" id="5480142">*</span><span class="ident" id="5480143">sp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5480147">b</span><span class="op" id="5480148">,</span>&nbsp;<span class="op" id="5480150">*</span><span class="ident" id="5480151">sp</span>&nbsp;<span class="op" id="5480154">=</span>&nbsp;<span class="ident" id="5480156">s</span><span class="op" id="5480157">[</span><span class="num" id="5480158">0</span><span class="op" id="5480159">:</span><span class="ident" id="5480160">n</span><span class="op" id="5480161">]</span><span class="op" id="5480162">,</span>&nbsp;<span class="ident" id="5480164">s</span><span class="op" id="5480165">[</span><span class="ident" id="5480166">n</span><span class="op" id="5480167">:</span><span class="op" id="5480168">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480171">return</span><br>
<span class="lineno"></span><span class="op" id="5480178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="keyword" id="5480181">func</span>&nbsp;<span class="ident" id="5480186">isASCII</span><span class="op" id="5480193">(</span><span class="ident" id="5480194">s</span>&nbsp;<span class="builtintype" id="5480196">string</span><span class="op" id="5480202">)</span>&nbsp;<span class="builtintype" id="5480204">bool</span>&nbsp;<span class="op" id="5480209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480212">for</span>&nbsp;<span class="ident" id="5480216">_</span><span class="op" id="5480217">,</span>&nbsp;<span class="ident" id="5480219">c</span>&nbsp;<span class="op" id="5480221">:=</span>&nbsp;<span class="keyword" id="5480224">range</span>&nbsp;<span class="ident" id="5480230">s</span>&nbsp;<span class="op" id="5480232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480236">if</span>&nbsp;<span class="ident" id="5480239">c</span>&nbsp;<span class="op" id="5480241">&gt;=</span>&nbsp;<span class="num" id="5480244">0x80</span>&nbsp;<span class="op" id="5480249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480254">return</span>&nbsp;<span class="builtintype" id="5480261">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5480269">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5480272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480275">return</span>&nbsp;<span class="builtintype" id="5480282">true</span><br>
<span class="lineno"></span><span class="op" id="5480287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5480290">func</span>&nbsp;<span class="ident" id="5480295">toASCII</span><span class="op" id="5480302">(</span><span class="ident" id="5480303">s</span>&nbsp;<span class="builtintype" id="5480305">string</span><span class="op" id="5480311">)</span>&nbsp;<span class="builtintype" id="5480313">string</span>&nbsp;<span class="op" id="5480320">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480323">if</span>&nbsp;<span class="ident" id="5480326">isASCII</span><span class="op" id="5480333">(</span><span class="ident" id="5480334">s</span><span class="op" id="5480335">)</span>&nbsp;<span class="op" id="5480337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480341">return</span>&nbsp;<span class="ident" id="5480348">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5480351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480354">var</span>&nbsp;<span class="ident" id="5480358">buf</span>&nbsp;<span class="ident" id="5480362">bytes</span><span class="op" id="5480367">.</span><span class="ident" id="5480368">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480376">for</span>&nbsp;<span class="ident" id="5480380">_</span><span class="op" id="5480381">,</span>&nbsp;<span class="ident" id="5480383">c</span>&nbsp;<span class="op" id="5480385">:=</span>&nbsp;<span class="keyword" id="5480388">range</span>&nbsp;<span class="ident" id="5480394">s</span>&nbsp;<span class="op" id="5480396">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480400">if</span>&nbsp;<span class="ident" id="5480403">c</span>&nbsp;<span class="op" id="5480405">&lt;</span>&nbsp;<span class="num" id="5480407">0x80</span>&nbsp;<span class="op" id="5480412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5480417">buf</span><span class="op" id="5480420">.</span><span class="ident" id="5480421">WriteByte</span><span class="op" id="5480430">(</span><span class="builtintype" id="5480431">byte</span><span class="op" id="5480435">(</span><span class="ident" id="5480436">c</span><span class="op" id="5480437">)</span><span class="op" id="5480438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5480442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5480445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480448">return</span>&nbsp;<span class="ident" id="5480455">buf</span><span class="op" id="5480458">.</span><span class="ident" id="5480459">String</span><span class="op" id="5480465">(</span><span class="op" id="5480466">)</span><br>
<span class="lineno">305</span><span class="op" id="5480468">}</span>
</div>
</body>
</html>
