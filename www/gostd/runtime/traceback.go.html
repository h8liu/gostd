<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html" class="current">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1759523">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1759578">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1759632">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1759683">package</span>&nbsp;<span class="ident" id="1759691">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1759700">import</span>&nbsp;<span class="string" id="1759707">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1759717">//&nbsp;The&nbsp;code&nbsp;in&nbsp;this&nbsp;file&nbsp;implements&nbsp;stack&nbsp;trace&nbsp;walking&nbsp;for&nbsp;all&nbsp;architectures.</span><br>
<span class="lineno">10</span><span class="comment" id="1759796">//&nbsp;The&nbsp;most&nbsp;important&nbsp;fact&nbsp;about&nbsp;a&nbsp;given&nbsp;architecture&nbsp;is&nbsp;whether&nbsp;it&nbsp;uses&nbsp;a&nbsp;link&nbsp;register.</span><br>
<span class="lineno"></span><span class="comment" id="1759886">//&nbsp;On&nbsp;systems&nbsp;with&nbsp;link&nbsp;registers,&nbsp;the&nbsp;prologue&nbsp;for&nbsp;a&nbsp;non-leaf&nbsp;function&nbsp;stores&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1759969">//&nbsp;incoming&nbsp;value&nbsp;of&nbsp;LR&nbsp;at&nbsp;the&nbsp;bottom&nbsp;of&nbsp;the&nbsp;newly&nbsp;allocated&nbsp;stack&nbsp;frame.</span><br>
<span class="lineno"></span><span class="comment" id="1760043">//&nbsp;On&nbsp;systems&nbsp;without&nbsp;link&nbsp;registers,&nbsp;the&nbsp;architecture&nbsp;pushes&nbsp;a&nbsp;return&nbsp;PC&nbsp;during</span><br>
<span class="lineno"></span><span class="comment" id="1760124">//&nbsp;the&nbsp;call&nbsp;instruction,&nbsp;so&nbsp;the&nbsp;return&nbsp;PC&nbsp;ends&nbsp;up&nbsp;above&nbsp;the&nbsp;stack&nbsp;frame.</span><br>
<span class="lineno">15</span><span class="comment" id="1760197">//&nbsp;In&nbsp;this&nbsp;file,&nbsp;the&nbsp;return&nbsp;PC&nbsp;is&nbsp;always&nbsp;called&nbsp;LR,&nbsp;no&nbsp;matter&nbsp;how&nbsp;it&nbsp;was&nbsp;found.</span><br>
<span class="lineno"></span><span class="comment" id="1760277">//</span><br>
<span class="lineno"></span><span class="comment" id="1760280">//&nbsp;To&nbsp;date,&nbsp;the&nbsp;opposite&nbsp;of&nbsp;a&nbsp;link&nbsp;register&nbsp;architecture&nbsp;is&nbsp;an&nbsp;x86&nbsp;architecture.</span><br>
<span class="lineno"></span><span class="comment" id="1760361">//&nbsp;This&nbsp;code&nbsp;may&nbsp;need&nbsp;to&nbsp;change&nbsp;if&nbsp;some&nbsp;other&nbsp;kind&nbsp;of&nbsp;non-link-register</span><br>
<span class="lineno"></span><span class="comment" id="1760433">//&nbsp;architecture&nbsp;comes&nbsp;along.</span><br>
<span class="lineno">20</span><span class="comment" id="1760462">//</span><br>
<span class="lineno"></span><span class="comment" id="1760465">//&nbsp;The&nbsp;other&nbsp;important&nbsp;fact&nbsp;is&nbsp;the&nbsp;size&nbsp;of&nbsp;a&nbsp;pointer:&nbsp;on&nbsp;32-bit&nbsp;systems&nbsp;the&nbsp;LR</span><br>
<span class="lineno"></span><span class="comment" id="1760544">//&nbsp;takes&nbsp;up&nbsp;only&nbsp;4&nbsp;bytes&nbsp;on&nbsp;the&nbsp;stack,&nbsp;while&nbsp;on&nbsp;64-bit&nbsp;systems&nbsp;it&nbsp;takes&nbsp;up&nbsp;8&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="1760628">//&nbsp;Typically&nbsp;this&nbsp;is&nbsp;ptrSize.</span><br>
<span class="lineno"></span><span class="comment" id="1760658">//</span><br>
<span class="lineno">25</span><span class="comment" id="1760661">//&nbsp;As&nbsp;an&nbsp;exception,&nbsp;amd64p32&nbsp;has&nbsp;ptrSize&nbsp;==&nbsp;4&nbsp;but&nbsp;the&nbsp;CALL&nbsp;instruction&nbsp;still</span><br>
<span class="lineno"></span><span class="comment" id="1760738">//&nbsp;stores&nbsp;an&nbsp;8-byte&nbsp;return&nbsp;PC&nbsp;onto&nbsp;the&nbsp;stack.&nbsp;To&nbsp;accommodate&nbsp;this,&nbsp;we&nbsp;use&nbsp;regSize</span><br>
<span class="lineno"></span><span class="comment" id="1760820">//&nbsp;as&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;architecture-pushed&nbsp;return&nbsp;PC.</span><br>
<span class="lineno"></span><span class="comment" id="1760873">//</span><br>
<span class="lineno"></span><span class="comment" id="1760876">//&nbsp;usesLR&nbsp;is&nbsp;defined&nbsp;below.&nbsp;ptrSize&nbsp;and&nbsp;regSize&nbsp;are&nbsp;defined&nbsp;in&nbsp;stubs.go.</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="1760950">const</span>&nbsp;<span class="ident" id="1760956">usesLR</span>&nbsp;<span class="op" id="1760963">=</span>&nbsp;<span class="ident" id="1760965">GOARCH</span>&nbsp;<span class="op" id="1760972">!=</span>&nbsp;<span class="string" id="1760975">&#34;amd64&#34;</span>&nbsp;<span class="op" id="1760983">&amp;&amp;</span>&nbsp;<span class="ident" id="1760986">GOARCH</span>&nbsp;<span class="op" id="1760993">!=</span>&nbsp;<span class="string" id="1760996">&#34;amd64p32&#34;</span>&nbsp;<span class="op" id="1761007">&amp;&amp;</span>&nbsp;<span class="ident" id="1761010">GOARCH</span>&nbsp;<span class="op" id="1761017">!=</span>&nbsp;<span class="string" id="1761020">&#34;386&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1761027">var</span>&nbsp;<span class="op" id="1761031">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1761034">//&nbsp;initialized&nbsp;in&nbsp;tracebackinit</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761067">deferprocPC</span>&nbsp;<span class="builtintype" id="1761079">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761088">goexitPC</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1761100">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761109">jmpdeferPC</span>&nbsp;&nbsp;<span class="builtintype" id="1761121">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761130">mcallPC</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1761142">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761151">morestackPC</span>&nbsp;<span class="builtintype" id="1761163">uintptr</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761172">mstartPC</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1761184">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761193">newprocPC</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1761205">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761214">rt0_goPC</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1761226">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761235">sigpanicPC</span>&nbsp;&nbsp;<span class="builtintype" id="1761247">uintptr</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761257">externalthreadhandlerp</span>&nbsp;<span class="builtintype" id="1761280">uintptr</span>&nbsp;<span class="comment" id="1761288">//&nbsp;initialized&nbsp;elsewhere</span><br>
<span class="lineno"></span><span class="op" id="1761313">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1761316">func</span>&nbsp;<span class="ident" id="1761321">tracebackinit</span><span class="op" id="1761334">(</span><span class="op" id="1761335">)</span>&nbsp;<span class="op" id="1761337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1761340">//&nbsp;Go&nbsp;variable&nbsp;initialization&nbsp;happens&nbsp;late&nbsp;during&nbsp;runtime&nbsp;startup.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1761408">//&nbsp;Instead&nbsp;of&nbsp;initializing&nbsp;the&nbsp;variables&nbsp;above&nbsp;in&nbsp;the&nbsp;declarations,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1761477">//&nbsp;schedinit&nbsp;calls&nbsp;this&nbsp;function&nbsp;so&nbsp;that&nbsp;the&nbsp;variables&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1761537">//&nbsp;initialized&nbsp;and&nbsp;available&nbsp;earlier&nbsp;in&nbsp;the&nbsp;startup&nbsp;sequence.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761600">deferprocPC</span>&nbsp;<span class="op" id="1761612">=</span>&nbsp;<span class="ident" id="1761614">funcPC</span><span class="op" id="1761620">(</span><span class="ident" id="1761621">deferproc</span><span class="op" id="1761630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761633">goexitPC</span>&nbsp;<span class="op" id="1761642">=</span>&nbsp;<span class="ident" id="1761644">funcPC</span><span class="op" id="1761650">(</span><span class="ident" id="1761651">goexit</span><span class="op" id="1761657">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761660">jmpdeferPC</span>&nbsp;<span class="op" id="1761671">=</span>&nbsp;<span class="ident" id="1761673">funcPC</span><span class="op" id="1761679">(</span><span class="ident" id="1761680">jmpdefer</span><span class="op" id="1761688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761691">mcallPC</span>&nbsp;<span class="op" id="1761699">=</span>&nbsp;<span class="ident" id="1761701">funcPC</span><span class="op" id="1761707">(</span><span class="ident" id="1761708">mcall</span><span class="op" id="1761713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761716">morestackPC</span>&nbsp;<span class="op" id="1761728">=</span>&nbsp;<span class="ident" id="1761730">funcPC</span><span class="op" id="1761736">(</span><span class="ident" id="1761737">morestack</span><span class="op" id="1761746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761749">mstartPC</span>&nbsp;<span class="op" id="1761758">=</span>&nbsp;<span class="ident" id="1761760">funcPC</span><span class="op" id="1761766">(</span><span class="ident" id="1761767">mstart</span><span class="op" id="1761773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761776">newprocPC</span>&nbsp;<span class="op" id="1761786">=</span>&nbsp;<span class="ident" id="1761788">funcPC</span><span class="op" id="1761794">(</span><span class="ident" id="1761795">newproc</span><span class="op" id="1761802">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761805">rt0_goPC</span>&nbsp;<span class="op" id="1761814">=</span>&nbsp;<span class="ident" id="1761816">funcPC</span><span class="op" id="1761822">(</span><span class="ident" id="1761823">rt0_go</span><span class="op" id="1761829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761832">sigpanicPC</span>&nbsp;<span class="op" id="1761843">=</span>&nbsp;<span class="ident" id="1761845">funcPC</span><span class="op" id="1761851">(</span><span class="ident" id="1761852">sigpanic</span><span class="op" id="1761860">)</span><br>
<span class="lineno"></span><span class="op" id="1761862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1761865">//&nbsp;Traceback&nbsp;over&nbsp;the&nbsp;deferred&nbsp;function&nbsp;calls.</span><br>
<span class="lineno">65</span><span class="comment" id="1761912">//&nbsp;Report&nbsp;them&nbsp;like&nbsp;calls&nbsp;that&nbsp;have&nbsp;been&nbsp;invoked&nbsp;but&nbsp;not&nbsp;started&nbsp;executing&nbsp;yet.</span><br>
<span class="lineno"></span><span class="keyword" id="1761992">func</span>&nbsp;<span class="ident" id="1761997">tracebackdefers</span><span class="op" id="1762012">(</span><span class="ident" id="1762013">gp</span>&nbsp;<span class="op" id="1762016">*</span><span class="ident" id="1762017">g</span><span class="op" id="1762018">,</span>&nbsp;<span class="ident" id="1762020">callback</span>&nbsp;<span class="keyword" id="1762029">func</span><span class="op" id="1762033">(</span><span class="op" id="1762034">*</span><span class="ident" id="1762035">stkframe</span><span class="op" id="1762043">,</span>&nbsp;<span class="ident" id="1762045">unsafe</span><span class="op" id="1762051">.</span><span class="ident" id="1762052">Pointer</span><span class="op" id="1762059">)</span>&nbsp;<span class="builtintype" id="1762061">bool</span><span class="op" id="1762065">,</span>&nbsp;<span class="ident" id="1762067">v</span>&nbsp;<span class="ident" id="1762069">unsafe</span><span class="op" id="1762075">.</span><span class="ident" id="1762076">Pointer</span><span class="op" id="1762083">)</span>&nbsp;<span class="op" id="1762085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1762088">var</span>&nbsp;<span class="ident" id="1762092">frame</span>&nbsp;<span class="ident" id="1762098">stkframe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1762108">for</span>&nbsp;<span class="ident" id="1762112">d</span>&nbsp;<span class="op" id="1762114">:=</span>&nbsp;<span class="ident" id="1762117">gp</span><span class="op" id="1762119">.</span><span class="ident" id="1762120">_defer</span><span class="op" id="1762126">;</span>&nbsp;<span class="ident" id="1762128">d</span>&nbsp;<span class="op" id="1762130">!=</span>&nbsp;<span class="ident" id="1762133">nil</span><span class="op" id="1762136">;</span>&nbsp;<span class="ident" id="1762138">d</span>&nbsp;<span class="op" id="1762140">=</span>&nbsp;<span class="ident" id="1762142">d</span><span class="op" id="1762143">.</span><span class="ident" id="1762144">link</span>&nbsp;<span class="op" id="1762149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1762153">fn</span>&nbsp;<span class="op" id="1762156">:=</span>&nbsp;<span class="ident" id="1762159">d</span><span class="op" id="1762160">.</span><span class="ident" id="1762161">fn</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1762166">if</span>&nbsp;<span class="ident" id="1762169">fn</span>&nbsp;<span class="op" id="1762172">==</span>&nbsp;<span class="ident" id="1762175">nil</span>&nbsp;<span class="op" id="1762179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1762184">//&nbsp;Defer&nbsp;of&nbsp;nil&nbsp;function.&nbsp;Args&nbsp;don&#39;t&nbsp;matter.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1762232">frame</span><span class="op" id="1762237">.</span><span class="ident" id="1762238">pc</span>&nbsp;<span class="op" id="1762241">=</span>&nbsp;<span class="num" id="1762243">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1762248">frame</span><span class="op" id="1762253">.</span><span class="ident" id="1762254">fn</span>&nbsp;<span class="op" id="1762257">=</span>&nbsp;<span class="ident" id="1762259">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1762266">frame</span><span class="op" id="1762271">.</span><span class="ident" id="1762272">argp</span>&nbsp;<span class="op" id="1762277">=</span>&nbsp;<span class="num" id="1762279">0</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1762284">frame</span><span class="op" id="1762289">.</span><span class="ident" id="1762290">arglen</span>&nbsp;<span class="op" id="1762297">=</span>&nbsp;<span class="num" id="1762299">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1762304">frame</span><span class="op" id="1762309">.</span><span class="ident" id="1762310">argmap</span>&nbsp;<span class="op" id="1762317">=</span>&nbsp;<span class="ident" id="1762319">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1762325">}</span>&nbsp;<span class="keyword" id="1762327">else</span>&nbsp;<span class="op" id="1762332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1762337">frame</span><span class="op" id="1762342">.</span><span class="ident" id="1762343">pc</span>&nbsp;<span class="op" id="1762346">=</span>&nbsp;<span class="builtintype" id="1762348">uintptr</span><span class="op" id="1762355">(</span><span class="ident" id="1762356">fn</span><span class="op" id="1762358">.</span><span class="ident" id="1762359">fn</span><span class="op" id="1762361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1762366">f</span>&nbsp;<span class="op" id="1762368">:=</span>&nbsp;<span class="ident" id="1762371">findfunc</span><span class="op" id="1762379">(</span><span class="ident" id="1762380">frame</span><span class="op" id="1762385">.</span><span class="ident" id="1762386">pc</span><span class="op" id="1762388">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1762393">if</span>&nbsp;<span class="ident" id="1762396">f</span>&nbsp;<span class="op" id="1762398">==</span>&nbsp;<span class="ident" id="1762401">nil</span>&nbsp;<span class="op" id="1762405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1762411">print</span><span class="op" id="1762416">(</span><span class="string" id="1762417">&#34;runtime:&nbsp;unknown&nbsp;pc&nbsp;in&nbsp;defer&nbsp;&#34;</span><span class="op" id="1762448">,</span>&nbsp;<span class="ident" id="1762450">hex</span><span class="op" id="1762453">(</span><span class="ident" id="1762454">frame</span><span class="op" id="1762459">.</span><span class="ident" id="1762460">pc</span><span class="op" id="1762462">)</span><span class="op" id="1762463">,</span>&nbsp;<span class="string" id="1762465">&#34;\n&#34;</span><span class="op" id="1762469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1762475">gothrow</span><span class="op" id="1762482">(</span><span class="string" id="1762483">&#34;unknown&nbsp;pc&#34;</span><span class="op" id="1762495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1762500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1762505">frame</span><span class="op" id="1762510">.</span><span class="ident" id="1762511">fn</span>&nbsp;<span class="op" id="1762514">=</span>&nbsp;<span class="ident" id="1762516">f</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1762521">frame</span><span class="op" id="1762526">.</span><span class="ident" id="1762527">argp</span>&nbsp;<span class="op" id="1762532">=</span>&nbsp;<span class="builtintype" id="1762534">uintptr</span><span class="op" id="1762541">(</span><span class="ident" id="1762542">deferArgs</span><span class="op" id="1762551">(</span><span class="ident" id="1762552">d</span><span class="op" id="1762553">)</span><span class="op" id="1762554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1762559">setArgInfo</span><span class="op" id="1762569">(</span><span class="op" id="1762570">&amp;</span><span class="ident" id="1762571">frame</span><span class="op" id="1762576">,</span>&nbsp;<span class="ident" id="1762578">f</span><span class="op" id="1762579">,</span>&nbsp;<span class="builtintype" id="1762581">true</span><span class="op" id="1762585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1762589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1762593">frame</span><span class="op" id="1762598">.</span><span class="ident" id="1762599">continpc</span>&nbsp;<span class="op" id="1762608">=</span>&nbsp;<span class="ident" id="1762610">frame</span><span class="op" id="1762615">.</span><span class="ident" id="1762616">pc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1762621">if</span>&nbsp;<span class="op" id="1762624">!</span><span class="ident" id="1762625">callback</span><span class="op" id="1762633">(</span><span class="op" id="1762634">(</span><span class="op" id="1762635">*</span><span class="ident" id="1762636">stkframe</span><span class="op" id="1762644">)</span><span class="op" id="1762645">(</span><span class="ident" id="1762646">noescape</span><span class="op" id="1762654">(</span><span class="ident" id="1762655">unsafe</span><span class="op" id="1762661">.</span><span class="ident" id="1762662">Pointer</span><span class="op" id="1762669">(</span><span class="op" id="1762670">&amp;</span><span class="ident" id="1762671">frame</span><span class="op" id="1762676">)</span><span class="op" id="1762677">)</span><span class="op" id="1762678">)</span><span class="op" id="1762679">,</span>&nbsp;<span class="ident" id="1762681">v</span><span class="op" id="1762682">)</span>&nbsp;<span class="op" id="1762684">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1762689">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1762698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1762701">}</span><br>
<span class="lineno"></span><span class="op" id="1762703">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="1762706">//&nbsp;Generic&nbsp;traceback.&nbsp;&nbsp;Handles&nbsp;runtime&nbsp;stack&nbsp;prints&nbsp;(pcbuf&nbsp;==&nbsp;nil),</span><br>
<span class="lineno"></span><span class="comment" id="1762774">//&nbsp;the&nbsp;runtime.Callers&nbsp;function&nbsp;(pcbuf&nbsp;!=&nbsp;nil),&nbsp;as&nbsp;well&nbsp;as&nbsp;the&nbsp;garbage</span><br>
<span class="lineno"></span><span class="comment" id="1762845">//&nbsp;collector&nbsp;(callback&nbsp;!=&nbsp;nil).&nbsp;&nbsp;A&nbsp;little&nbsp;clunky&nbsp;to&nbsp;merge&nbsp;these,&nbsp;but&nbsp;avoids</span><br>
<span class="lineno"></span><span class="comment" id="1762921">//&nbsp;duplicating&nbsp;the&nbsp;code&nbsp;and&nbsp;all&nbsp;its&nbsp;subtlety.</span><br>
<span class="lineno"></span><span class="keyword" id="1762967">func</span>&nbsp;<span class="ident" id="1762972">gentraceback</span><span class="op" id="1762984">(</span><span class="ident" id="1762985">pc0</span>&nbsp;<span class="builtintype" id="1762989">uintptr</span><span class="op" id="1762996">,</span>&nbsp;<span class="ident" id="1762998">sp0</span>&nbsp;<span class="builtintype" id="1763002">uintptr</span><span class="op" id="1763009">,</span>&nbsp;<span class="ident" id="1763011">lr0</span>&nbsp;<span class="builtintype" id="1763015">uintptr</span><span class="op" id="1763022">,</span>&nbsp;<span class="ident" id="1763024">gp</span>&nbsp;<span class="op" id="1763027">*</span><span class="ident" id="1763028">g</span><span class="op" id="1763029">,</span>&nbsp;<span class="ident" id="1763031">skip</span>&nbsp;<span class="builtintype" id="1763036">int</span><span class="op" id="1763039">,</span>&nbsp;<span class="ident" id="1763041">pcbuf</span>&nbsp;<span class="op" id="1763047">*</span><span class="builtintype" id="1763048">uintptr</span><span class="op" id="1763055">,</span>&nbsp;<span class="ident" id="1763057">max</span>&nbsp;<span class="builtintype" id="1763061">int</span><span class="op" id="1763064">,</span>&nbsp;<span class="ident" id="1763066">callback</span>&nbsp;<span class="keyword" id="1763075">func</span><span class="op" id="1763079">(</span><span class="op" id="1763080">*</span><span class="ident" id="1763081">stkframe</span><span class="op" id="1763089">,</span>&nbsp;<span class="ident" id="1763091">unsafe</span><span class="op" id="1763097">.</span><span class="ident" id="1763098">Pointer</span><span class="op" id="1763105">)</span>&nbsp;<span class="builtintype" id="1763107">bool</span><span class="op" id="1763111">,</span>&nbsp;<span class="ident" id="1763113">v</span>&nbsp;<span class="ident" id="1763115">unsafe</span><span class="op" id="1763121">.</span><span class="ident" id="1763122">Pointer</span><span class="op" id="1763129">,</span>&nbsp;<span class="ident" id="1763131">flags</span>&nbsp;<span class="builtintype" id="1763137">uint</span><span class="op" id="1763141">)</span>&nbsp;<span class="builtintype" id="1763143">int</span>&nbsp;<span class="op" id="1763147">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1763150">if</span>&nbsp;<span class="ident" id="1763153">goexitPC</span>&nbsp;<span class="op" id="1763162">==</span>&nbsp;<span class="num" id="1763165">0</span>&nbsp;<span class="op" id="1763167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1763171">gothrow</span><span class="op" id="1763178">(</span><span class="string" id="1763179">&#34;gentraceback&nbsp;before&nbsp;goexitPC&nbsp;initialization&#34;</span><span class="op" id="1763224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1763227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1763230">g</span>&nbsp;<span class="op" id="1763232">:=</span>&nbsp;<span class="ident" id="1763235">getg</span><span class="op" id="1763239">(</span><span class="op" id="1763240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1763243">if</span>&nbsp;<span class="ident" id="1763246">g</span>&nbsp;<span class="op" id="1763248">==</span>&nbsp;<span class="ident" id="1763251">gp</span>&nbsp;<span class="op" id="1763254">&amp;&amp;</span>&nbsp;<span class="ident" id="1763257">g</span>&nbsp;<span class="op" id="1763259">==</span>&nbsp;<span class="ident" id="1763262">g</span><span class="op" id="1763263">.</span><span class="ident" id="1763264">m</span><span class="op" id="1763265">.</span><span class="ident" id="1763266">curg</span>&nbsp;<span class="op" id="1763271">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1763275">//&nbsp;The&nbsp;starting&nbsp;sp&nbsp;has&nbsp;been&nbsp;passed&nbsp;in&nbsp;as&nbsp;a&nbsp;uintptr,&nbsp;and&nbsp;the&nbsp;caller&nbsp;may</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1763348">//&nbsp;have&nbsp;other&nbsp;uintptr-typed&nbsp;stack&nbsp;references&nbsp;as&nbsp;well.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1763404">//&nbsp;If&nbsp;during&nbsp;one&nbsp;of&nbsp;the&nbsp;calls&nbsp;that&nbsp;got&nbsp;us&nbsp;here&nbsp;or&nbsp;during&nbsp;one&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1763474">//&nbsp;callbacks&nbsp;below&nbsp;the&nbsp;stack&nbsp;must&nbsp;be&nbsp;grown,&nbsp;all&nbsp;these&nbsp;uintptr&nbsp;references</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1763549">//&nbsp;to&nbsp;the&nbsp;stack&nbsp;will&nbsp;not&nbsp;be&nbsp;updated,&nbsp;and&nbsp;gentraceback&nbsp;will&nbsp;continue</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1763619">//&nbsp;to&nbsp;inspect&nbsp;the&nbsp;old&nbsp;stack&nbsp;memory,&nbsp;which&nbsp;may&nbsp;no&nbsp;longer&nbsp;be&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1763687">//&nbsp;Even&nbsp;if&nbsp;all&nbsp;the&nbsp;variables&nbsp;were&nbsp;updated&nbsp;correctly,&nbsp;it&nbsp;is&nbsp;not&nbsp;clear&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1763763">//&nbsp;we&nbsp;want&nbsp;to&nbsp;expose&nbsp;a&nbsp;traceback&nbsp;that&nbsp;begins&nbsp;on&nbsp;one&nbsp;stack&nbsp;and&nbsp;ends</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1763832">//&nbsp;on&nbsp;another&nbsp;stack.&nbsp;That&nbsp;could&nbsp;confuse&nbsp;callers&nbsp;quite&nbsp;a&nbsp;bit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1763895">//&nbsp;Instead,&nbsp;we&nbsp;require&nbsp;that&nbsp;gentraceback&nbsp;and&nbsp;any&nbsp;other&nbsp;function&nbsp;that</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1763966">//&nbsp;accepts&nbsp;an&nbsp;sp&nbsp;for&nbsp;the&nbsp;current&nbsp;goroutine&nbsp;(typically&nbsp;obtained&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1764034">//&nbsp;calling&nbsp;getcallersp)&nbsp;must&nbsp;not&nbsp;run&nbsp;on&nbsp;that&nbsp;goroutine&#39;s&nbsp;stack&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1764103">//&nbsp;instead&nbsp;on&nbsp;the&nbsp;g0&nbsp;stack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1764133">gothrow</span><span class="op" id="1764140">(</span><span class="string" id="1764141">&#34;gentraceback&nbsp;cannot&nbsp;trace&nbsp;user&nbsp;goroutine&nbsp;on&nbsp;its&nbsp;own&nbsp;stack&#34;</span><span class="op" id="1764200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1764203">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1764206">gotraceback</span>&nbsp;<span class="op" id="1764218">:=</span>&nbsp;<span class="ident" id="1764221">gotraceback</span><span class="op" id="1764232">(</span><span class="ident" id="1764233">nil</span><span class="op" id="1764236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1764239">if</span>&nbsp;<span class="ident" id="1764242">pc0</span>&nbsp;<span class="op" id="1764246">==</span>&nbsp;<span class="op" id="1764249">^</span><span class="builtintype" id="1764250">uintptr</span><span class="op" id="1764257">(</span><span class="num" id="1764258">0</span><span class="op" id="1764259">)</span>&nbsp;<span class="op" id="1764261">&amp;&amp;</span>&nbsp;<span class="ident" id="1764264">sp0</span>&nbsp;<span class="op" id="1764268">==</span>&nbsp;<span class="op" id="1764271">^</span><span class="builtintype" id="1764272">uintptr</span><span class="op" id="1764279">(</span><span class="num" id="1764280">0</span><span class="op" id="1764281">)</span>&nbsp;<span class="op" id="1764283">{</span>&nbsp;<span class="comment" id="1764285">//&nbsp;Signal&nbsp;to&nbsp;fetch&nbsp;saved&nbsp;values&nbsp;from&nbsp;gp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1764328">if</span>&nbsp;<span class="ident" id="1764331">gp</span><span class="op" id="1764333">.</span><span class="ident" id="1764334">syscallsp</span>&nbsp;<span class="op" id="1764344">!=</span>&nbsp;<span class="num" id="1764347">0</span>&nbsp;<span class="op" id="1764349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1764354">pc0</span>&nbsp;<span class="op" id="1764358">=</span>&nbsp;<span class="ident" id="1764360">gp</span><span class="op" id="1764362">.</span><span class="ident" id="1764363">syscallpc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1764376">sp0</span>&nbsp;<span class="op" id="1764380">=</span>&nbsp;<span class="ident" id="1764382">gp</span><span class="op" id="1764384">.</span><span class="ident" id="1764385">syscallsp</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1764398">if</span>&nbsp;<span class="ident" id="1764401">usesLR</span>&nbsp;<span class="op" id="1764408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1764414">lr0</span>&nbsp;<span class="op" id="1764418">=</span>&nbsp;<span class="num" id="1764420">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1764425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1764429">}</span>&nbsp;<span class="keyword" id="1764431">else</span>&nbsp;<span class="op" id="1764436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1764441">pc0</span>&nbsp;<span class="op" id="1764445">=</span>&nbsp;<span class="ident" id="1764447">gp</span><span class="op" id="1764449">.</span><span class="ident" id="1764450">sched</span><span class="op" id="1764455">.</span><span class="ident" id="1764456">pc</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1764462">sp0</span>&nbsp;<span class="op" id="1764466">=</span>&nbsp;<span class="ident" id="1764468">gp</span><span class="op" id="1764470">.</span><span class="ident" id="1764471">sched</span><span class="op" id="1764476">.</span><span class="ident" id="1764477">sp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1764483">if</span>&nbsp;<span class="ident" id="1764486">usesLR</span>&nbsp;<span class="op" id="1764493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1764499">lr0</span>&nbsp;<span class="op" id="1764503">=</span>&nbsp;<span class="ident" id="1764505">gp</span><span class="op" id="1764507">.</span><span class="ident" id="1764508">sched</span><span class="op" id="1764513">.</span><span class="ident" id="1764514">lr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1764520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1764524">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1764527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1764531">nprint</span>&nbsp;<span class="op" id="1764538">:=</span>&nbsp;<span class="num" id="1764541">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1764544">var</span>&nbsp;<span class="ident" id="1764548">frame</span>&nbsp;<span class="ident" id="1764554">stkframe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1764564">frame</span><span class="op" id="1764569">.</span><span class="ident" id="1764570">pc</span>&nbsp;<span class="op" id="1764573">=</span>&nbsp;<span class="ident" id="1764575">pc0</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1764580">frame</span><span class="op" id="1764585">.</span><span class="ident" id="1764586">sp</span>&nbsp;<span class="op" id="1764589">=</span>&nbsp;<span class="ident" id="1764591">sp0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1764596">if</span>&nbsp;<span class="ident" id="1764599">usesLR</span>&nbsp;<span class="op" id="1764606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1764610">frame</span><span class="op" id="1764615">.</span><span class="ident" id="1764616">lr</span>&nbsp;<span class="op" id="1764619">=</span>&nbsp;<span class="ident" id="1764621">lr0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1764626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1764629">waspanic</span>&nbsp;<span class="op" id="1764638">:=</span>&nbsp;<span class="builtintype" id="1764641">false</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1764648">wasnewproc</span>&nbsp;<span class="op" id="1764659">:=</span>&nbsp;<span class="builtintype" id="1764662">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1764669">printing</span>&nbsp;<span class="op" id="1764678">:=</span>&nbsp;<span class="ident" id="1764681">pcbuf</span>&nbsp;<span class="op" id="1764687">==</span>&nbsp;<span class="ident" id="1764690">nil</span>&nbsp;<span class="op" id="1764694">&amp;&amp;</span>&nbsp;<span class="ident" id="1764697">callback</span>&nbsp;<span class="op" id="1764706">==</span>&nbsp;<span class="ident" id="1764709">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1764714">_defer</span>&nbsp;<span class="op" id="1764721">:=</span>&nbsp;<span class="ident" id="1764724">gp</span><span class="op" id="1764726">.</span><span class="ident" id="1764727">_defer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1764736">for</span>&nbsp;<span class="ident" id="1764740">_defer</span>&nbsp;<span class="op" id="1764747">!=</span>&nbsp;<span class="ident" id="1764750">nil</span>&nbsp;<span class="op" id="1764754">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1764757">uintptr</span><span class="op" id="1764764">(</span><span class="ident" id="1764765">_defer</span><span class="op" id="1764771">.</span><span class="ident" id="1764772">argp</span><span class="op" id="1764776">)</span>&nbsp;<span class="op" id="1764778">==</span>&nbsp;<span class="ident" id="1764781">_NoArgs</span>&nbsp;<span class="op" id="1764789">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1764793">_defer</span>&nbsp;<span class="op" id="1764800">=</span>&nbsp;<span class="ident" id="1764802">_defer</span><span class="op" id="1764808">.</span><span class="ident" id="1764809">link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1764815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1764819">//&nbsp;If&nbsp;the&nbsp;PC&nbsp;is&nbsp;zero,&nbsp;it&#39;s&nbsp;likely&nbsp;a&nbsp;nil&nbsp;function&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1764875">//&nbsp;Start&nbsp;in&nbsp;the&nbsp;caller&#39;s&nbsp;frame.</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1764908">if</span>&nbsp;<span class="ident" id="1764911">frame</span><span class="op" id="1764916">.</span><span class="ident" id="1764917">pc</span>&nbsp;<span class="op" id="1764920">==</span>&nbsp;<span class="num" id="1764923">0</span>&nbsp;<span class="op" id="1764925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1764929">if</span>&nbsp;<span class="ident" id="1764932">usesLR</span>&nbsp;<span class="op" id="1764939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1764944">frame</span><span class="op" id="1764949">.</span><span class="ident" id="1764950">pc</span>&nbsp;<span class="op" id="1764953">=</span>&nbsp;<span class="op" id="1764955">*</span><span class="op" id="1764956">(</span><span class="op" id="1764957">*</span><span class="builtintype" id="1764958">uintptr</span><span class="op" id="1764965">)</span><span class="op" id="1764966">(</span><span class="ident" id="1764967">unsafe</span><span class="op" id="1764973">.</span><span class="ident" id="1764974">Pointer</span><span class="op" id="1764981">(</span><span class="ident" id="1764982">frame</span><span class="op" id="1764987">.</span><span class="ident" id="1764988">sp</span><span class="op" id="1764990">)</span><span class="op" id="1764991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1764996">frame</span><span class="op" id="1765001">.</span><span class="ident" id="1765002">lr</span>&nbsp;<span class="op" id="1765005">=</span>&nbsp;<span class="num" id="1765007">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1765011">}</span>&nbsp;<span class="keyword" id="1765013">else</span>&nbsp;<span class="op" id="1765018">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1765023">frame</span><span class="op" id="1765028">.</span><span class="ident" id="1765029">pc</span>&nbsp;<span class="op" id="1765032">=</span>&nbsp;<span class="builtintype" id="1765034">uintptr</span><span class="op" id="1765041">(</span><span class="op" id="1765042">*</span><span class="op" id="1765043">(</span><span class="op" id="1765044">*</span><span class="ident" id="1765045">uintreg</span><span class="op" id="1765052">)</span><span class="op" id="1765053">(</span><span class="ident" id="1765054">unsafe</span><span class="op" id="1765060">.</span><span class="ident" id="1765061">Pointer</span><span class="op" id="1765068">(</span><span class="ident" id="1765069">frame</span><span class="op" id="1765074">.</span><span class="ident" id="1765075">sp</span><span class="op" id="1765077">)</span><span class="op" id="1765078">)</span><span class="op" id="1765079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1765084">frame</span><span class="op" id="1765089">.</span><span class="ident" id="1765090">sp</span>&nbsp;<span class="op" id="1765093">+=</span>&nbsp;<span class="ident" id="1765096">regSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1765106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1765109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1765113">f</span>&nbsp;<span class="op" id="1765115">:=</span>&nbsp;<span class="ident" id="1765118">findfunc</span><span class="op" id="1765126">(</span><span class="ident" id="1765127">frame</span><span class="op" id="1765132">.</span><span class="ident" id="1765133">pc</span><span class="op" id="1765135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1765138">if</span>&nbsp;<span class="ident" id="1765141">f</span>&nbsp;<span class="op" id="1765143">==</span>&nbsp;<span class="ident" id="1765146">nil</span>&nbsp;<span class="op" id="1765150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1765154">if</span>&nbsp;<span class="ident" id="1765157">callback</span>&nbsp;<span class="op" id="1765166">!=</span>&nbsp;<span class="ident" id="1765169">nil</span>&nbsp;<span class="op" id="1765173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1765178">print</span><span class="op" id="1765183">(</span><span class="string" id="1765184">&#34;runtime:&nbsp;unknown&nbsp;pc&nbsp;&#34;</span><span class="op" id="1765206">,</span>&nbsp;<span class="ident" id="1765208">hex</span><span class="op" id="1765211">(</span><span class="ident" id="1765212">frame</span><span class="op" id="1765217">.</span><span class="ident" id="1765218">pc</span><span class="op" id="1765220">)</span><span class="op" id="1765221">,</span>&nbsp;<span class="string" id="1765223">&#34;\n&#34;</span><span class="op" id="1765227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1765232">gothrow</span><span class="op" id="1765239">(</span><span class="string" id="1765240">&#34;unknown&nbsp;pc&#34;</span><span class="op" id="1765252">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1765256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1765260">return</span>&nbsp;<span class="num" id="1765267">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1765270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1765273">frame</span><span class="op" id="1765278">.</span><span class="ident" id="1765279">fn</span>&nbsp;<span class="op" id="1765282">=</span>&nbsp;<span class="ident" id="1765284">f</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1765288">n</span>&nbsp;<span class="op" id="1765290">:=</span>&nbsp;<span class="num" id="1765293">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1765296">for</span>&nbsp;<span class="ident" id="1765300">n</span>&nbsp;<span class="op" id="1765302">&lt;</span>&nbsp;<span class="ident" id="1765304">max</span>&nbsp;<span class="op" id="1765308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1765312">//&nbsp;Typically:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1765328">//&nbsp;&nbsp;&nbsp;&nbsppc&nbsp;is&nbsp;the&nbsp;PC&nbsp;of&nbsp;the&nbsp;running&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1765371">//&nbsp;&nbsp;&nbsp;&nbspsp&nbsp;is&nbsp;the&nbsp;stack&nbsp;pointer&nbsp;at&nbsp;that&nbsp;program&nbsp;counter.</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1765425">//&nbsp;&nbsp;&nbsp;&nbspfp&nbsp;is&nbsp;the&nbsp;frame&nbsp;pointer&nbsp;(caller&#39;s&nbsp;stack&nbsp;pointer)&nbsp;at&nbsp;that&nbsp;program&nbsp;counter,&nbsp;or&nbsp;nil&nbsp;if&nbsp;unknown.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1765523">//&nbsp;&nbsp;&nbsp;&nbspstk&nbsp;is&nbsp;the&nbsp;stack&nbsp;containing&nbsp;sp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1765560">//&nbsp;&nbsp;&nbsp;&nbspThe&nbsp;caller&#39;s&nbsp;program&nbsp;counter&nbsp;is&nbsp;lr,&nbsp;unless&nbsp;lr&nbsp;is&nbsp;zero,&nbsp;in&nbsp;which&nbsp;case&nbsp;it&nbsp;is&nbsp;*(uintptr*)sp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1765655">f</span>&nbsp;<span class="op" id="1765657">=</span>&nbsp;<span class="ident" id="1765659">frame</span><span class="op" id="1765664">.</span><span class="ident" id="1765665">fn</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1765671">//&nbsp;Found&nbsp;an&nbsp;actual&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1765702">//&nbsp;Derive&nbsp;frame&nbsp;pointer&nbsp;and&nbsp;link&nbsp;register.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1765747">if</span>&nbsp;<span class="ident" id="1765750">frame</span><span class="op" id="1765755">.</span><span class="ident" id="1765756">fp</span>&nbsp;<span class="op" id="1765759">==</span>&nbsp;<span class="num" id="1765762">0</span>&nbsp;<span class="op" id="1765764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1765769">frame</span><span class="op" id="1765774">.</span><span class="ident" id="1765775">fp</span>&nbsp;<span class="op" id="1765778">=</span>&nbsp;<span class="ident" id="1765780">frame</span><span class="op" id="1765785">.</span><span class="ident" id="1765786">sp</span>&nbsp;<span class="op" id="1765789">+</span>&nbsp;<span class="builtintype" id="1765791">uintptr</span><span class="op" id="1765798">(</span><span class="ident" id="1765799">funcspdelta</span><span class="op" id="1765810">(</span><span class="ident" id="1765811">f</span><span class="op" id="1765812">,</span>&nbsp;<span class="ident" id="1765814">frame</span><span class="op" id="1765819">.</span><span class="ident" id="1765820">pc</span><span class="op" id="1765822">)</span><span class="op" id="1765823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1765828">if</span>&nbsp;<span class="op" id="1765831">!</span><span class="ident" id="1765832">usesLR</span>&nbsp;<span class="op" id="1765839">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1765845">//&nbsp;On&nbsp;x86,&nbsp;call&nbsp;instruction&nbsp;pushes&nbsp;return&nbsp;PC&nbsp;before&nbsp;entering&nbsp;new&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1765924">frame</span><span class="op" id="1765929">.</span><span class="ident" id="1765930">fp</span>&nbsp;<span class="op" id="1765933">+=</span>&nbsp;<span class="ident" id="1765936">regSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1765947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1765951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1765955">var</span>&nbsp;<span class="ident" id="1765959">flr</span>&nbsp;<span class="op" id="1765963">*</span><span class="ident" id="1765964">_func</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1765972">if</span>&nbsp;<span class="ident" id="1765975">topofstack</span><span class="op" id="1765985">(</span><span class="ident" id="1765986">f</span><span class="op" id="1765987">)</span>&nbsp;<span class="op" id="1765989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1765994">frame</span><span class="op" id="1765999">.</span><span class="ident" id="1766000">lr</span>&nbsp;<span class="op" id="1766003">=</span>&nbsp;<span class="num" id="1766005">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1766010">flr</span>&nbsp;<span class="op" id="1766014">=</span>&nbsp;<span class="ident" id="1766016">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1766022">}</span>&nbsp;<span class="keyword" id="1766024">else</span>&nbsp;<span class="keyword" id="1766029">if</span>&nbsp;<span class="ident" id="1766032">usesLR</span>&nbsp;<span class="op" id="1766039">&amp;&amp;</span>&nbsp;<span class="ident" id="1766042">f</span><span class="op" id="1766043">.</span><span class="ident" id="1766044">entry</span>&nbsp;<span class="op" id="1766050">==</span>&nbsp;<span class="ident" id="1766053">jmpdeferPC</span>&nbsp;<span class="op" id="1766064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1766069">//&nbsp;jmpdefer&nbsp;modifies&nbsp;SP/LR/PC&nbsp;non-atomically.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1766118">//&nbsp;If&nbsp;a&nbsp;profiling&nbsp;interrupt&nbsp;arrives&nbsp;during&nbsp;jmpdefer,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1766174">//&nbsp;the&nbsp;stack&nbsp;unwind&nbsp;may&nbsp;see&nbsp;a&nbsp;mismatched&nbsp;register&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1766231">//&nbsp;and&nbsp;get&nbsp;confused.&nbsp;Stop&nbsp;if&nbsp;we&nbsp;see&nbsp;PC&nbsp;within&nbsp;jmpdefer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1766289">//&nbsp;to&nbsp;avoid&nbsp;that&nbsp;confusion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1766320">//&nbsp;See&nbsp;golang.org/issue/8153.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1766353">if</span>&nbsp;<span class="ident" id="1766356">callback</span>&nbsp;<span class="op" id="1766365">!=</span>&nbsp;<span class="ident" id="1766368">nil</span>&nbsp;<span class="op" id="1766372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1766378">gothrow</span><span class="op" id="1766385">(</span><span class="string" id="1766386">&#34;traceback_arm:&nbsp;found&nbsp;jmpdefer&nbsp;when&nbsp;tracing&nbsp;with&nbsp;callback&#34;</span><span class="op" id="1766444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1766449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1766454">frame</span><span class="op" id="1766459">.</span><span class="ident" id="1766460">lr</span>&nbsp;<span class="op" id="1766463">=</span>&nbsp;<span class="num" id="1766465">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1766469">}</span>&nbsp;<span class="keyword" id="1766471">else</span>&nbsp;<span class="op" id="1766476">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1766481">if</span>&nbsp;<span class="ident" id="1766484">usesLR</span>&nbsp;<span class="op" id="1766491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1766497">if</span>&nbsp;<span class="ident" id="1766500">n</span>&nbsp;<span class="op" id="1766502">==</span>&nbsp;<span class="num" id="1766505">0</span>&nbsp;<span class="op" id="1766507">&amp;&amp;</span>&nbsp;<span class="ident" id="1766510">frame</span><span class="op" id="1766515">.</span><span class="ident" id="1766516">sp</span>&nbsp;<span class="op" id="1766519">&lt;</span>&nbsp;<span class="ident" id="1766521">frame</span><span class="op" id="1766526">.</span><span class="ident" id="1766527">fp</span>&nbsp;<span class="op" id="1766530">||</span>&nbsp;<span class="ident" id="1766533">frame</span><span class="op" id="1766538">.</span><span class="ident" id="1766539">lr</span>&nbsp;<span class="op" id="1766542">==</span>&nbsp;<span class="num" id="1766545">0</span>&nbsp;<span class="op" id="1766547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1766554">frame</span><span class="op" id="1766559">.</span><span class="ident" id="1766560">lr</span>&nbsp;<span class="op" id="1766563">=</span>&nbsp;<span class="op" id="1766565">*</span><span class="op" id="1766566">(</span><span class="op" id="1766567">*</span><span class="builtintype" id="1766568">uintptr</span><span class="op" id="1766575">)</span><span class="op" id="1766576">(</span><span class="ident" id="1766577">unsafe</span><span class="op" id="1766583">.</span><span class="ident" id="1766584">Pointer</span><span class="op" id="1766591">(</span><span class="ident" id="1766592">frame</span><span class="op" id="1766597">.</span><span class="ident" id="1766598">sp</span><span class="op" id="1766600">)</span><span class="op" id="1766601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1766607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1766612">}</span>&nbsp;<span class="keyword" id="1766614">else</span>&nbsp;<span class="op" id="1766619">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1766625">if</span>&nbsp;<span class="ident" id="1766628">frame</span><span class="op" id="1766633">.</span><span class="ident" id="1766634">lr</span>&nbsp;<span class="op" id="1766637">==</span>&nbsp;<span class="num" id="1766640">0</span>&nbsp;<span class="op" id="1766642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1766649">frame</span><span class="op" id="1766654">.</span><span class="ident" id="1766655">lr</span>&nbsp;<span class="op" id="1766658">=</span>&nbsp;<span class="builtintype" id="1766660">uintptr</span><span class="op" id="1766667">(</span><span class="op" id="1766668">*</span><span class="op" id="1766669">(</span><span class="op" id="1766670">*</span><span class="ident" id="1766671">uintreg</span><span class="op" id="1766678">)</span><span class="op" id="1766679">(</span><span class="ident" id="1766680">unsafe</span><span class="op" id="1766686">.</span><span class="ident" id="1766687">Pointer</span><span class="op" id="1766694">(</span><span class="ident" id="1766695">frame</span><span class="op" id="1766700">.</span><span class="ident" id="1766701">fp</span>&nbsp;<span class="op" id="1766704">-</span>&nbsp;<span class="ident" id="1766706">regSize</span><span class="op" id="1766713">)</span><span class="op" id="1766714">)</span><span class="op" id="1766715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1766721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1766726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1766731">flr</span>&nbsp;<span class="op" id="1766735">=</span>&nbsp;<span class="ident" id="1766737">findfunc</span><span class="op" id="1766745">(</span><span class="ident" id="1766746">frame</span><span class="op" id="1766751">.</span><span class="ident" id="1766752">lr</span><span class="op" id="1766754">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1766759">if</span>&nbsp;<span class="ident" id="1766762">flr</span>&nbsp;<span class="op" id="1766766">==</span>&nbsp;<span class="ident" id="1766769">nil</span>&nbsp;<span class="op" id="1766773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1766779">//&nbsp;This&nbsp;happens&nbsp;if&nbsp;you&nbsp;get&nbsp;a&nbsp;profiling&nbsp;interrupt&nbsp;at&nbsp;just&nbsp;the&nbsp;wrong&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1766856">//&nbsp;In&nbsp;that&nbsp;context&nbsp;it&nbsp;is&nbsp;okay&nbsp;to&nbsp;stop&nbsp;early.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1766905">//&nbsp;But&nbsp;if&nbsp;callback&nbsp;is&nbsp;set,&nbsp;we&#39;re&nbsp;doing&nbsp;a&nbsp;garbage&nbsp;collection&nbsp;and&nbsp;must</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1766978">//&nbsp;get&nbsp;everything,&nbsp;so&nbsp;crash&nbsp;loudly.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1767018">if</span>&nbsp;<span class="ident" id="1767021">callback</span>&nbsp;<span class="op" id="1767030">!=</span>&nbsp;<span class="ident" id="1767033">nil</span>&nbsp;<span class="op" id="1767037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1767044">print</span><span class="op" id="1767049">(</span><span class="string" id="1767050">&#34;runtime:&nbsp;unexpected&nbsp;return&nbsp;pc&nbsp;for&nbsp;&#34;</span><span class="op" id="1767086">,</span>&nbsp;<span class="ident" id="1767088">gofuncname</span><span class="op" id="1767098">(</span><span class="ident" id="1767099">f</span><span class="op" id="1767100">)</span><span class="op" id="1767101">,</span>&nbsp;<span class="string" id="1767103">&#34;&nbsp;called&nbsp;from&nbsp;&#34;</span><span class="op" id="1767118">,</span>&nbsp;<span class="ident" id="1767120">hex</span><span class="op" id="1767123">(</span><span class="ident" id="1767124">frame</span><span class="op" id="1767129">.</span><span class="ident" id="1767130">lr</span><span class="op" id="1767132">)</span><span class="op" id="1767133">,</span>&nbsp;<span class="string" id="1767135">&#34;\n&#34;</span><span class="op" id="1767139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1767146">gothrow</span><span class="op" id="1767153">(</span><span class="string" id="1767154">&#34;unknown&nbsp;caller&nbsp;pc&#34;</span><span class="op" id="1767173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1767179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1767184">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1767188">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1767193">frame</span><span class="op" id="1767198">.</span><span class="ident" id="1767199">varp</span>&nbsp;<span class="op" id="1767204">=</span>&nbsp;<span class="ident" id="1767206">frame</span><span class="op" id="1767211">.</span><span class="ident" id="1767212">fp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1767217">if</span>&nbsp;<span class="op" id="1767220">!</span><span class="ident" id="1767221">usesLR</span>&nbsp;<span class="op" id="1767228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1767233">//&nbsp;On&nbsp;x86,&nbsp;call&nbsp;instruction&nbsp;pushes&nbsp;return&nbsp;PC&nbsp;before&nbsp;entering&nbsp;new&nbsp;function.</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1767311">frame</span><span class="op" id="1767316">.</span><span class="ident" id="1767317">varp</span>&nbsp;<span class="op" id="1767322">-=</span>&nbsp;<span class="ident" id="1767325">regSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1767335">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1767340">//&nbsp;Derive&nbsp;size&nbsp;of&nbsp;arguments.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1767371">//&nbsp;Most&nbsp;functions&nbsp;have&nbsp;a&nbsp;fixed-size&nbsp;argument&nbsp;block,</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1767425">//&nbsp;so&nbsp;we&nbsp;can&nbsp;use&nbsp;metadata&nbsp;about&nbsp;the&nbsp;function&nbsp;f.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1767475">//&nbsp;Not&nbsp;all,&nbsp;though:&nbsp;there&nbsp;are&nbsp;some&nbsp;variadic&nbsp;functions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1767531">//&nbsp;in&nbsp;package&nbsp;runtime&nbsp;and&nbsp;reflect,&nbsp;and&nbsp;for&nbsp;those&nbsp;we&nbsp;use&nbsp;call-specific</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1767603">//&nbsp;metadata&nbsp;recorded&nbsp;by&nbsp;f&#39;s&nbsp;caller.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1767641">if</span>&nbsp;<span class="ident" id="1767644">callback</span>&nbsp;<span class="op" id="1767653">!=</span>&nbsp;<span class="ident" id="1767656">nil</span>&nbsp;<span class="op" id="1767660">||</span>&nbsp;<span class="ident" id="1767663">printing</span>&nbsp;<span class="op" id="1767672">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1767677">frame</span><span class="op" id="1767682">.</span><span class="ident" id="1767683">argp</span>&nbsp;<span class="op" id="1767688">=</span>&nbsp;<span class="ident" id="1767690">frame</span><span class="op" id="1767695">.</span><span class="ident" id="1767696">fp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1767702">if</span>&nbsp;<span class="ident" id="1767705">usesLR</span>&nbsp;<span class="op" id="1767712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1767718">frame</span><span class="op" id="1767723">.</span><span class="ident" id="1767724">argp</span>&nbsp;<span class="op" id="1767729">+=</span>&nbsp;<span class="ident" id="1767732">ptrSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1767743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1767748">setArgInfo</span><span class="op" id="1767758">(</span><span class="op" id="1767759">&amp;</span><span class="ident" id="1767760">frame</span><span class="op" id="1767765">,</span>&nbsp;<span class="ident" id="1767767">f</span><span class="op" id="1767768">,</span>&nbsp;<span class="ident" id="1767770">callback</span>&nbsp;<span class="op" id="1767779">!=</span>&nbsp;<span class="ident" id="1767782">nil</span><span class="op" id="1767785">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1767789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1767794">//&nbsp;Determine&nbsp;function&nbsp;SP&nbsp;where&nbsp;deferproc&nbsp;would&nbsp;find&nbsp;its&nbsp;arguments.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1767863">var</span>&nbsp;<span class="ident" id="1767867">sparg</span>&nbsp;<span class="builtintype" id="1767873">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1767883">if</span>&nbsp;<span class="ident" id="1767886">usesLR</span>&nbsp;<span class="op" id="1767893">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1767898">//&nbsp;On&nbsp;link&nbsp;register&nbsp;architectures,&nbsp;that&#39;s&nbsp;the&nbsp;standard&nbsp;bottom-of-stack&nbsp;plus&nbsp;1&nbsp;word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1767984">//&nbsp;for&nbsp;the&nbsp;saved&nbsp;LR.&nbsp;If&nbsp;the&nbsp;previous&nbsp;frame&nbsp;was&nbsp;a&nbsp;direct&nbsp;call&nbsp;to&nbsp;newproc/deferproc,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1768070">//&nbsp;however,&nbsp;the&nbsp;SP&nbsp;is&nbsp;three&nbsp;words&nbsp;lower&nbsp;than&nbsp;normal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1768126">//&nbsp;If&nbsp;the&nbsp;function&nbsp;has&nbsp;no&nbsp;frame&nbsp;at&nbsp;all&nbsp;-&nbsp;perhaps&nbsp;it&nbsp;just&nbsp;started,&nbsp;or&nbsp;perhaps</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1768206">//&nbsp;it&nbsp;is&nbsp;a&nbsp;leaf&nbsp;with&nbsp;no&nbsp;local&nbsp;variables&nbsp;-&nbsp;then&nbsp;we&nbsp;cannot&nbsp;possibly&nbsp;find&nbsp;its</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1768284">//&nbsp;SP&nbsp;in&nbsp;a&nbsp;defer,&nbsp;and&nbsp;we&nbsp;might&nbsp;confuse&nbsp;its&nbsp;SP&nbsp;for&nbsp;its&nbsp;caller&#39;s&nbsp;SP,&nbsp;so</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1768357">//&nbsp;leave&nbsp;sparg=0&nbsp;in&nbsp;that&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768391">if</span>&nbsp;<span class="ident" id="1768394">frame</span><span class="op" id="1768399">.</span><span class="ident" id="1768400">fp</span>&nbsp;<span class="op" id="1768403">!=</span>&nbsp;<span class="ident" id="1768406">frame</span><span class="op" id="1768411">.</span><span class="ident" id="1768412">sp</span>&nbsp;<span class="op" id="1768415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1768421">sparg</span>&nbsp;<span class="op" id="1768427">=</span>&nbsp;<span class="ident" id="1768429">frame</span><span class="op" id="1768434">.</span><span class="ident" id="1768435">sp</span>&nbsp;<span class="op" id="1768438">+</span>&nbsp;<span class="ident" id="1768440">regSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768452">if</span>&nbsp;<span class="ident" id="1768455">wasnewproc</span>&nbsp;<span class="op" id="1768466">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1768473">sparg</span>&nbsp;<span class="op" id="1768479">+=</span>&nbsp;<span class="num" id="1768482">3</span>&nbsp;<span class="op" id="1768484">*</span>&nbsp;<span class="ident" id="1768486">regSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1768498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1768503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1768507">}</span>&nbsp;<span class="keyword" id="1768509">else</span>&nbsp;<span class="op" id="1768514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1768519">//&nbsp;On&nbsp;x86&nbsp;that&#39;s&nbsp;the&nbsp;standard&nbsp;bottom-of-stack,&nbsp;so&nbsp;SP&nbsp;exactly.</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1768584">//&nbsp;If&nbsp;the&nbsp;previous&nbsp;frame&nbsp;was&nbsp;a&nbsp;direct&nbsp;call&nbsp;to&nbsp;newproc/deferproc,&nbsp;however,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1768661">//&nbsp;the&nbsp;SP&nbsp;is&nbsp;two&nbsp;words&nbsp;lower&nbsp;than&nbsp;normal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1768706">sparg</span>&nbsp;<span class="op" id="1768712">=</span>&nbsp;<span class="ident" id="1768714">frame</span><span class="op" id="1768719">.</span><span class="ident" id="1768720">sp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768726">if</span>&nbsp;<span class="ident" id="1768729">wasnewproc</span>&nbsp;<span class="op" id="1768740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1768746">sparg</span>&nbsp;<span class="op" id="1768752">+=</span>&nbsp;<span class="num" id="1768755">2</span>&nbsp;<span class="op" id="1768757">*</span>&nbsp;<span class="ident" id="1768759">ptrSize</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1768770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1768774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1768779">//&nbsp;Determine&nbsp;frame&#39;s&nbsp;&#39;continuation&nbsp;PC&#39;,&nbsp;where&nbsp;it&nbsp;can&nbsp;continue.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1768844">//&nbsp;Normally&nbsp;this&nbsp;is&nbsp;the&nbsp;return&nbsp;address&nbsp;on&nbsp;the&nbsp;stack,&nbsp;but&nbsp;if&nbsp;sigpanic</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1768915">//&nbsp;is&nbsp;immediately&nbsp;below&nbsp;this&nbsp;function&nbsp;on&nbsp;the&nbsp;stack,&nbsp;then&nbsp;the&nbsp;frame</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1768984">//&nbsp;stopped&nbsp;executing&nbsp;due&nbsp;to&nbsp;a&nbsp;trap,&nbsp;and&nbsp;frame.pc&nbsp;is&nbsp;probably&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1769051">//&nbsp;a&nbsp;safe&nbsp;point&nbsp;for&nbsp;looking&nbsp;up&nbsp;liveness&nbsp;information.&nbsp;In&nbsp;this&nbsp;panicking&nbsp;case,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1769130">//&nbsp;the&nbsp;function&nbsp;either&nbsp;doesn&#39;t&nbsp;return&nbsp;at&nbsp;all&nbsp;(if&nbsp;it&nbsp;has&nbsp;no&nbsp;defers&nbsp;or&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1769208">//&nbsp;defers&nbsp;do&nbsp;not&nbsp;recover)&nbsp;or&nbsp;it&nbsp;returns&nbsp;from&nbsp;one&nbsp;of&nbsp;the&nbsp;calls&nbsp;to</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1769275">//&nbsp;deferproc&nbsp;a&nbsp;second&nbsp;time&nbsp;(if&nbsp;the&nbsp;corresponding&nbsp;deferred&nbsp;func&nbsp;recovers).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1769351">//&nbsp;It&nbsp;suffices&nbsp;to&nbsp;assume&nbsp;that&nbsp;the&nbsp;most&nbsp;recent&nbsp;deferproc&nbsp;is&nbsp;the&nbsp;one&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1769425">//&nbsp;returns;&nbsp;everything&nbsp;live&nbsp;at&nbsp;earlier&nbsp;deferprocs&nbsp;is&nbsp;still&nbsp;live&nbsp;at&nbsp;that&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769504">frame</span><span class="op" id="1769509">.</span><span class="ident" id="1769510">continpc</span>&nbsp;<span class="op" id="1769519">=</span>&nbsp;<span class="ident" id="1769521">frame</span><span class="op" id="1769526">.</span><span class="ident" id="1769527">pc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1769532">if</span>&nbsp;<span class="ident" id="1769535">waspanic</span>&nbsp;<span class="op" id="1769544">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1769549">if</span>&nbsp;<span class="ident" id="1769552">_defer</span>&nbsp;<span class="op" id="1769559">!=</span>&nbsp;<span class="ident" id="1769562">nil</span>&nbsp;<span class="op" id="1769566">&amp;&amp;</span>&nbsp;<span class="ident" id="1769569">_defer</span><span class="op" id="1769575">.</span><span class="ident" id="1769576">argp</span>&nbsp;<span class="op" id="1769581">==</span>&nbsp;<span class="ident" id="1769584">sparg</span>&nbsp;<span class="op" id="1769590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769596">frame</span><span class="op" id="1769601">.</span><span class="ident" id="1769602">continpc</span>&nbsp;<span class="op" id="1769611">=</span>&nbsp;<span class="ident" id="1769613">_defer</span><span class="op" id="1769619">.</span><span class="ident" id="1769620">pc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1769626">}</span>&nbsp;<span class="keyword" id="1769628">else</span>&nbsp;<span class="op" id="1769633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769639">frame</span><span class="op" id="1769644">.</span><span class="ident" id="1769645">continpc</span>&nbsp;<span class="op" id="1769654">=</span>&nbsp;<span class="num" id="1769656">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1769661">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1769665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1769670">//&nbsp;Unwind&nbsp;our&nbsp;local&nbsp;defer&nbsp;stack&nbsp;past&nbsp;this&nbsp;frame.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1769721">for</span>&nbsp;<span class="ident" id="1769725">_defer</span>&nbsp;<span class="op" id="1769732">!=</span>&nbsp;<span class="ident" id="1769735">nil</span>&nbsp;<span class="op" id="1769739">&amp;&amp;</span>&nbsp;<span class="op" id="1769742">(</span><span class="ident" id="1769743">_defer</span><span class="op" id="1769749">.</span><span class="ident" id="1769750">argp</span>&nbsp;<span class="op" id="1769755">==</span>&nbsp;<span class="ident" id="1769758">sparg</span>&nbsp;<span class="op" id="1769764">||</span>&nbsp;<span class="ident" id="1769767">_defer</span><span class="op" id="1769773">.</span><span class="ident" id="1769774">argp</span>&nbsp;<span class="op" id="1769779">==</span>&nbsp;<span class="ident" id="1769782">_NoArgs</span><span class="op" id="1769789">)</span>&nbsp;<span class="op" id="1769791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769796">_defer</span>&nbsp;<span class="op" id="1769803">=</span>&nbsp;<span class="ident" id="1769805">_defer</span><span class="op" id="1769811">.</span><span class="ident" id="1769812">link</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1769819">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1769824">if</span>&nbsp;<span class="ident" id="1769827">skip</span>&nbsp;<span class="op" id="1769832">&gt;</span>&nbsp;<span class="num" id="1769834">0</span>&nbsp;<span class="op" id="1769836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769841">skip</span><span class="op" id="1769845">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1769851">goto</span>&nbsp;<span class="ident" id="1769856">skipped</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1769866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1769871">if</span>&nbsp;<span class="ident" id="1769874">pcbuf</span>&nbsp;<span class="op" id="1769880">!=</span>&nbsp;<span class="ident" id="1769883">nil</span>&nbsp;<span class="op" id="1769887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1769892">(</span><span class="op" id="1769893">*</span><span class="op" id="1769894">[</span><span class="num" id="1769895">1</span>&nbsp;<span class="op" id="1769897">&lt;&lt;</span>&nbsp;<span class="num" id="1769900">20</span><span class="op" id="1769902">]</span><span class="builtintype" id="1769903">uintptr</span><span class="op" id="1769910">)</span><span class="op" id="1769911">(</span><span class="ident" id="1769912">unsafe</span><span class="op" id="1769918">.</span><span class="ident" id="1769919">Pointer</span><span class="op" id="1769926">(</span><span class="ident" id="1769927">pcbuf</span><span class="op" id="1769932">)</span><span class="op" id="1769933">)</span><span class="op" id="1769934">[</span><span class="ident" id="1769935">n</span><span class="op" id="1769936">]</span>&nbsp;<span class="op" id="1769938">=</span>&nbsp;<span class="ident" id="1769940">frame</span><span class="op" id="1769945">.</span><span class="ident" id="1769946">pc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1769951">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1769955">if</span>&nbsp;<span class="ident" id="1769958">callback</span>&nbsp;<span class="op" id="1769967">!=</span>&nbsp;<span class="ident" id="1769970">nil</span>&nbsp;<span class="op" id="1769974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1769979">if</span>&nbsp;<span class="op" id="1769982">!</span><span class="ident" id="1769983">callback</span><span class="op" id="1769991">(</span><span class="op" id="1769992">(</span><span class="op" id="1769993">*</span><span class="ident" id="1769994">stkframe</span><span class="op" id="1770002">)</span><span class="op" id="1770003">(</span><span class="ident" id="1770004">noescape</span><span class="op" id="1770012">(</span><span class="ident" id="1770013">unsafe</span><span class="op" id="1770019">.</span><span class="ident" id="1770020">Pointer</span><span class="op" id="1770027">(</span><span class="op" id="1770028">&amp;</span><span class="ident" id="1770029">frame</span><span class="op" id="1770034">)</span><span class="op" id="1770035">)</span><span class="op" id="1770036">)</span><span class="op" id="1770037">,</span>&nbsp;<span class="ident" id="1770039">v</span><span class="op" id="1770040">)</span>&nbsp;<span class="op" id="1770042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770048">return</span>&nbsp;<span class="ident" id="1770055">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1770060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1770064">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770068">if</span>&nbsp;<span class="ident" id="1770071">printing</span>&nbsp;<span class="op" id="1770080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770085">if</span>&nbsp;<span class="op" id="1770088">(</span><span class="ident" id="1770089">flags</span><span class="op" id="1770094">&amp;</span><span class="ident" id="1770095">_TraceRuntimeFrames</span><span class="op" id="1770114">)</span>&nbsp;<span class="op" id="1770116">!=</span>&nbsp;<span class="num" id="1770119">0</span>&nbsp;<span class="op" id="1770121">||</span>&nbsp;<span class="ident" id="1770124">showframe</span><span class="op" id="1770133">(</span><span class="ident" id="1770134">f</span><span class="op" id="1770135">,</span>&nbsp;<span class="ident" id="1770137">gp</span><span class="op" id="1770139">)</span>&nbsp;<span class="op" id="1770141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1770147">//&nbsp;Print&nbsp;during&nbsp;crash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1770174">//&nbsp;&nbsp;&nbsp;&nbspmain(0x1,&nbsp;0x2,&nbsp;0x3)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1770201">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/home/rsc/go/src/runtime/x.go:23&nbsp;+0xf</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1770247">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770254">tracepc</span>&nbsp;<span class="op" id="1770262">:=</span>&nbsp;<span class="ident" id="1770265">frame</span><span class="op" id="1770270">.</span><span class="ident" id="1770271">pc</span>&nbsp;<span class="comment" id="1770274">//&nbsp;back&nbsp;up&nbsp;to&nbsp;CALL&nbsp;instruction&nbsp;for&nbsp;funcline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770323">if</span>&nbsp;<span class="op" id="1770326">(</span><span class="ident" id="1770327">n</span>&nbsp;<span class="op" id="1770329">&gt;</span>&nbsp;<span class="num" id="1770331">0</span>&nbsp;<span class="op" id="1770333">||</span>&nbsp;<span class="ident" id="1770336">flags</span><span class="op" id="1770341">&amp;</span><span class="ident" id="1770342">_TraceTrap</span>&nbsp;<span class="op" id="1770353">==</span>&nbsp;<span class="num" id="1770356">0</span><span class="op" id="1770357">)</span>&nbsp;<span class="op" id="1770359">&amp;&amp;</span>&nbsp;<span class="ident" id="1770362">frame</span><span class="op" id="1770367">.</span><span class="ident" id="1770368">pc</span>&nbsp;<span class="op" id="1770371">&gt;</span>&nbsp;<span class="ident" id="1770373">f</span><span class="op" id="1770374">.</span><span class="ident" id="1770375">entry</span>&nbsp;<span class="op" id="1770381">&amp;&amp;</span>&nbsp;<span class="op" id="1770384">!</span><span class="ident" id="1770385">waspanic</span>&nbsp;<span class="op" id="1770394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770401">tracepc</span><span class="op" id="1770408">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1770415">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1770421">print</span><span class="op" id="1770426">(</span><span class="ident" id="1770427">gofuncname</span><span class="op" id="1770437">(</span><span class="ident" id="1770438">f</span><span class="op" id="1770439">)</span><span class="op" id="1770440">,</span>&nbsp;<span class="string" id="1770442">&#34;(&#34;</span><span class="op" id="1770445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770451">argp</span>&nbsp;<span class="op" id="1770456">:=</span>&nbsp;<span class="op" id="1770459">(</span><span class="op" id="1770460">*</span><span class="op" id="1770461">[</span><span class="num" id="1770462">100</span><span class="op" id="1770465">]</span><span class="builtintype" id="1770466">uintptr</span><span class="op" id="1770473">)</span><span class="op" id="1770474">(</span><span class="ident" id="1770475">unsafe</span><span class="op" id="1770481">.</span><span class="ident" id="1770482">Pointer</span><span class="op" id="1770489">(</span><span class="ident" id="1770490">frame</span><span class="op" id="1770495">.</span><span class="ident" id="1770496">argp</span><span class="op" id="1770500">)</span><span class="op" id="1770501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770507">for</span>&nbsp;<span class="ident" id="1770511">i</span>&nbsp;<span class="op" id="1770513">:=</span>&nbsp;<span class="builtintype" id="1770516">uintptr</span><span class="op" id="1770523">(</span><span class="num" id="1770524">0</span><span class="op" id="1770525">)</span><span class="op" id="1770526">;</span>&nbsp;<span class="ident" id="1770528">i</span>&nbsp;<span class="op" id="1770530">&lt;</span>&nbsp;<span class="ident" id="1770532">frame</span><span class="op" id="1770537">.</span><span class="ident" id="1770538">arglen</span><span class="op" id="1770544">/</span><span class="ident" id="1770545">ptrSize</span><span class="op" id="1770552">;</span>&nbsp;<span class="ident" id="1770554">i</span><span class="op" id="1770555">++</span>&nbsp;<span class="op" id="1770558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770565">if</span>&nbsp;<span class="ident" id="1770568">i</span>&nbsp;<span class="op" id="1770570">&gt;=</span>&nbsp;<span class="num" id="1770573">10</span>&nbsp;<span class="op" id="1770576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1770584">print</span><span class="op" id="1770589">(</span><span class="string" id="1770590">&#34;,&nbsp;...&#34;</span><span class="op" id="1770597">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770605">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1770616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770623">if</span>&nbsp;<span class="ident" id="1770626">i</span>&nbsp;<span class="op" id="1770628">!=</span>&nbsp;<span class="num" id="1770631">0</span>&nbsp;<span class="op" id="1770633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1770641">print</span><span class="op" id="1770646">(</span><span class="string" id="1770647">&#34;,&nbsp;&#34;</span><span class="op" id="1770651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1770658">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1770665">print</span><span class="op" id="1770670">(</span><span class="ident" id="1770671">hex</span><span class="op" id="1770674">(</span><span class="ident" id="1770675">argp</span><span class="op" id="1770679">[</span><span class="ident" id="1770680">i</span><span class="op" id="1770681">]</span><span class="op" id="1770682">)</span><span class="op" id="1770683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1770689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1770695">print</span><span class="op" id="1770700">(</span><span class="string" id="1770701">&#34;)\n&#34;</span><span class="op" id="1770706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770712">var</span>&nbsp;<span class="ident" id="1770716">file</span>&nbsp;<span class="builtintype" id="1770721">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770732">line</span>&nbsp;<span class="op" id="1770737">:=</span>&nbsp;<span class="ident" id="1770740">funcline</span><span class="op" id="1770748">(</span><span class="ident" id="1770749">f</span><span class="op" id="1770750">,</span>&nbsp;<span class="ident" id="1770752">tracepc</span><span class="op" id="1770759">,</span>&nbsp;<span class="op" id="1770761">&amp;</span><span class="ident" id="1770762">file</span><span class="op" id="1770766">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1770772">print</span><span class="op" id="1770777">(</span><span class="string" id="1770778">&#34;\t&#34;</span><span class="op" id="1770782">,</span>&nbsp;<span class="ident" id="1770784">file</span><span class="op" id="1770788">,</span>&nbsp;<span class="string" id="1770790">&#34;:&#34;</span><span class="op" id="1770793">,</span>&nbsp;<span class="ident" id="1770795">line</span><span class="op" id="1770799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770805">if</span>&nbsp;<span class="ident" id="1770808">frame</span><span class="op" id="1770813">.</span><span class="ident" id="1770814">pc</span>&nbsp;<span class="op" id="1770817">&gt;</span>&nbsp;<span class="ident" id="1770819">f</span><span class="op" id="1770820">.</span><span class="ident" id="1770821">entry</span>&nbsp;<span class="op" id="1770827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1770834">print</span><span class="op" id="1770839">(</span><span class="string" id="1770840">&#34;&nbsp;+&#34;</span><span class="op" id="1770844">,</span>&nbsp;<span class="ident" id="1770846">hex</span><span class="op" id="1770849">(</span><span class="ident" id="1770850">frame</span><span class="op" id="1770855">.</span><span class="ident" id="1770856">pc</span><span class="op" id="1770858">-</span><span class="ident" id="1770859">f</span><span class="op" id="1770860">.</span><span class="ident" id="1770861">entry</span><span class="op" id="1770866">)</span><span class="op" id="1770867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1770873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770879">if</span>&nbsp;<span class="ident" id="1770882">g</span><span class="op" id="1770883">.</span><span class="ident" id="1770884">m</span><span class="op" id="1770885">.</span><span class="ident" id="1770886">throwing</span>&nbsp;<span class="op" id="1770895">&gt;</span>&nbsp;<span class="num" id="1770897">0</span>&nbsp;<span class="op" id="1770899">&amp;&amp;</span>&nbsp;<span class="ident" id="1770902">gp</span>&nbsp;<span class="op" id="1770905">==</span>&nbsp;<span class="ident" id="1770908">g</span><span class="op" id="1770909">.</span><span class="ident" id="1770910">m</span><span class="op" id="1770911">.</span><span class="ident" id="1770912">curg</span>&nbsp;<span class="op" id="1770917">||</span>&nbsp;<span class="ident" id="1770920">gotraceback</span>&nbsp;<span class="op" id="1770932">&gt;=</span>&nbsp;<span class="num" id="1770935">2</span>&nbsp;<span class="op" id="1770937">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1770944">print</span><span class="op" id="1770949">(</span><span class="string" id="1770950">&#34;&nbsp;fp=&#34;</span><span class="op" id="1770956">,</span>&nbsp;<span class="ident" id="1770958">hex</span><span class="op" id="1770961">(</span><span class="ident" id="1770962">frame</span><span class="op" id="1770967">.</span><span class="ident" id="1770968">fp</span><span class="op" id="1770970">)</span><span class="op" id="1770971">,</span>&nbsp;<span class="string" id="1770973">&#34;&nbsp;sp=&#34;</span><span class="op" id="1770979">,</span>&nbsp;<span class="ident" id="1770981">hex</span><span class="op" id="1770984">(</span><span class="ident" id="1770985">frame</span><span class="op" id="1770990">.</span><span class="ident" id="1770991">sp</span><span class="op" id="1770993">)</span><span class="op" id="1770994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1771000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1771006">print</span><span class="op" id="1771011">(</span><span class="string" id="1771012">&#34;\n&#34;</span><span class="op" id="1771016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1771022">nprint</span><span class="op" id="1771028">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1771034">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1771038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1771042">n</span><span class="op" id="1771043">++</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1771048">skipped</span><span class="op" id="1771055">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1771059">waspanic</span>&nbsp;<span class="op" id="1771068">=</span>&nbsp;<span class="ident" id="1771070">f</span><span class="op" id="1771071">.</span><span class="ident" id="1771072">entry</span>&nbsp;<span class="op" id="1771078">==</span>&nbsp;<span class="ident" id="1771081">sigpanicPC</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1771094">wasnewproc</span>&nbsp;<span class="op" id="1771105">=</span>&nbsp;<span class="ident" id="1771107">f</span><span class="op" id="1771108">.</span><span class="ident" id="1771109">entry</span>&nbsp;<span class="op" id="1771115">==</span>&nbsp;<span class="ident" id="1771118">newprocPC</span>&nbsp;<span class="op" id="1771128">||</span>&nbsp;<span class="ident" id="1771131">f</span><span class="op" id="1771132">.</span><span class="ident" id="1771133">entry</span>&nbsp;<span class="op" id="1771139">==</span>&nbsp;<span class="ident" id="1771142">deferprocPC</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1771157">//&nbsp;Do&nbsp;not&nbsp;unwind&nbsp;past&nbsp;the&nbsp;bottom&nbsp;of&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1771206">if</span>&nbsp;<span class="ident" id="1771209">flr</span>&nbsp;<span class="op" id="1771213">==</span>&nbsp;<span class="ident" id="1771216">nil</span>&nbsp;<span class="op" id="1771220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1771225">break</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1771233">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1771238">//&nbsp;Unwind&nbsp;to&nbsp;next&nbsp;frame.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1771265">frame</span><span class="op" id="1771270">.</span><span class="ident" id="1771271">fn</span>&nbsp;<span class="op" id="1771274">=</span>&nbsp;<span class="ident" id="1771276">flr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1771282">frame</span><span class="op" id="1771287">.</span><span class="ident" id="1771288">pc</span>&nbsp;<span class="op" id="1771291">=</span>&nbsp;<span class="ident" id="1771293">frame</span><span class="op" id="1771298">.</span><span class="ident" id="1771299">lr</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1771304">frame</span><span class="op" id="1771309">.</span><span class="ident" id="1771310">lr</span>&nbsp;<span class="op" id="1771313">=</span>&nbsp;<span class="num" id="1771315">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1771319">frame</span><span class="op" id="1771324">.</span><span class="ident" id="1771325">sp</span>&nbsp;<span class="op" id="1771328">=</span>&nbsp;<span class="ident" id="1771330">frame</span><span class="op" id="1771335">.</span><span class="ident" id="1771336">fp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1771341">frame</span><span class="op" id="1771346">.</span><span class="ident" id="1771347">fp</span>&nbsp;<span class="op" id="1771350">=</span>&nbsp;<span class="num" id="1771352">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1771356">frame</span><span class="op" id="1771361">.</span><span class="ident" id="1771362">argmap</span>&nbsp;<span class="op" id="1771369">=</span>&nbsp;<span class="ident" id="1771371">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1771378">//&nbsp;On&nbsp;link&nbsp;register&nbsp;architectures,&nbsp;sighandler&nbsp;saves&nbsp;the&nbsp;LR&nbsp;on&nbsp;stack</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1771448">//&nbsp;before&nbsp;faking&nbsp;a&nbsp;call&nbsp;to&nbsp;sigpanic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1771487">if</span>&nbsp;<span class="ident" id="1771490">usesLR</span>&nbsp;<span class="op" id="1771497">&amp;&amp;</span>&nbsp;<span class="ident" id="1771500">waspanic</span>&nbsp;<span class="op" id="1771509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1771514">x</span>&nbsp;<span class="op" id="1771516">:=</span>&nbsp;<span class="op" id="1771519">*</span><span class="op" id="1771520">(</span><span class="op" id="1771521">*</span><span class="builtintype" id="1771522">uintptr</span><span class="op" id="1771529">)</span><span class="op" id="1771530">(</span><span class="ident" id="1771531">unsafe</span><span class="op" id="1771537">.</span><span class="ident" id="1771538">Pointer</span><span class="op" id="1771545">(</span><span class="ident" id="1771546">frame</span><span class="op" id="1771551">.</span><span class="ident" id="1771552">sp</span><span class="op" id="1771554">)</span><span class="op" id="1771555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1771560">frame</span><span class="op" id="1771565">.</span><span class="ident" id="1771566">sp</span>&nbsp;<span class="op" id="1771569">+=</span>&nbsp;<span class="ident" id="1771572">ptrSize</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1771583">f</span>&nbsp;<span class="op" id="1771585">=</span>&nbsp;<span class="ident" id="1771587">findfunc</span><span class="op" id="1771595">(</span><span class="ident" id="1771596">frame</span><span class="op" id="1771601">.</span><span class="ident" id="1771602">pc</span><span class="op" id="1771604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1771609">frame</span><span class="op" id="1771614">.</span><span class="ident" id="1771615">fn</span>&nbsp;<span class="op" id="1771618">=</span>&nbsp;<span class="ident" id="1771620">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1771625">if</span>&nbsp;<span class="ident" id="1771628">f</span>&nbsp;<span class="op" id="1771630">==</span>&nbsp;<span class="ident" id="1771633">nil</span>&nbsp;<span class="op" id="1771637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1771643">frame</span><span class="op" id="1771648">.</span><span class="ident" id="1771649">pc</span>&nbsp;<span class="op" id="1771652">=</span>&nbsp;<span class="ident" id="1771654">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1771659">}</span>&nbsp;<span class="keyword" id="1771661">else</span>&nbsp;<span class="keyword" id="1771666">if</span>&nbsp;<span class="ident" id="1771669">f</span><span class="op" id="1771670">.</span><span class="ident" id="1771671">frame</span>&nbsp;<span class="op" id="1771677">==</span>&nbsp;<span class="num" id="1771680">0</span>&nbsp;<span class="op" id="1771682">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1771688">frame</span><span class="op" id="1771693">.</span><span class="ident" id="1771694">lr</span>&nbsp;<span class="op" id="1771697">=</span>&nbsp;<span class="ident" id="1771699">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1771704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1771708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1771711">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1771715">if</span>&nbsp;<span class="ident" id="1771718">pcbuf</span>&nbsp;<span class="op" id="1771724">==</span>&nbsp;<span class="ident" id="1771727">nil</span>&nbsp;<span class="op" id="1771731">&amp;&amp;</span>&nbsp;<span class="ident" id="1771734">callback</span>&nbsp;<span class="op" id="1771743">==</span>&nbsp;<span class="ident" id="1771746">nil</span>&nbsp;<span class="op" id="1771750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1771754">n</span>&nbsp;<span class="op" id="1771756">=</span>&nbsp;<span class="ident" id="1771758">nprint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1771766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1771770">//&nbsp;If&nbsp;callback&nbsp;!=&nbsp;nil,&nbsp;we&#39;re&nbsp;being&nbsp;called&nbsp;to&nbsp;gather&nbsp;stack&nbsp;information&nbsp;during</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1771848">//&nbsp;garbage&nbsp;collection&nbsp;or&nbsp;stack&nbsp;growth.&nbsp;In&nbsp;that&nbsp;context,&nbsp;require&nbsp;that&nbsp;we&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1771926">//&nbsp;up&nbsp;the&nbsp;entire&nbsp;defer&nbsp;stack.&nbsp;If&nbsp;not,&nbsp;then&nbsp;there&nbsp;is&nbsp;a&nbsp;bug&nbsp;somewhere&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1772003">//&nbsp;garbage&nbsp;collection&nbsp;or&nbsp;stack&nbsp;growth&nbsp;may&nbsp;not&nbsp;have&nbsp;seen&nbsp;the&nbsp;correct&nbsp;picture</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1772080">//&nbsp;of&nbsp;the&nbsp;stack.&nbsp;Crash&nbsp;now&nbsp;instead&nbsp;of&nbsp;silently&nbsp;executing&nbsp;the&nbsp;garbage&nbsp;collection</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1772161">//&nbsp;or&nbsp;stack&nbsp;copy&nbsp;incorrectly&nbsp;and&nbsp;setting&nbsp;up&nbsp;for&nbsp;a&nbsp;mysterious&nbsp;crash&nbsp;later.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1772236">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1772240">//&nbsp;Note&nbsp;that&nbsp;panic&nbsp;!=&nbsp;nil&nbsp;is&nbsp;okay&nbsp;here:&nbsp;there&nbsp;can&nbsp;be&nbsp;leftover&nbsp;panics,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1772311">//&nbsp;because&nbsp;the&nbsp;defers&nbsp;on&nbsp;the&nbsp;panic&nbsp;stack&nbsp;do&nbsp;not&nbsp;nest&nbsp;in&nbsp;frame&nbsp;order&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1772383">//&nbsp;they&nbsp;do&nbsp;on&nbsp;the&nbsp;defer&nbsp;stack.&nbsp;If&nbsp;you&nbsp;have:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1772428">//</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1772432">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;1&nbsp;defers&nbsp;d1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1772454">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;2&nbsp;defers&nbsp;d2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1772476">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;3&nbsp;defers&nbsp;d3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1772498">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;4&nbsp;panics</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1772517">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;4&#39;s&nbsp;panic&nbsp;starts&nbsp;running&nbsp;defers</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1772559">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;5,&nbsp;running&nbsp;d3,&nbsp;defers&nbsp;d4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1772594">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;5&nbsp;panics</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1772613">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;5&#39;s&nbsp;panic&nbsp;starts&nbsp;running&nbsp;defers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1772655">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;6,&nbsp;running&nbsp;d4,&nbsp;garbage&nbsp;collects</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1772697">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;6,&nbsp;running&nbsp;d2,&nbsp;garbage&nbsp;collects</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1772739">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1772743">//&nbsp;During&nbsp;the&nbsp;execution&nbsp;of&nbsp;d4,&nbsp;the&nbsp;panic&nbsp;stack&nbsp;is&nbsp;d4&nbsp;-&gt;&nbsp;d3,&nbsp;which</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1772810">//&nbsp;is&nbsp;nested&nbsp;properly,&nbsp;and&nbsp;we&#39;ll&nbsp;treat&nbsp;frame&nbsp;3&nbsp;as&nbsp;resumable,&nbsp;because&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1772883">//&nbsp;can&nbsp;find&nbsp;d3.&nbsp;(And&nbsp;in&nbsp;fact&nbsp;frame&nbsp;3&nbsp;is&nbsp;resumable.&nbsp;If&nbsp;d4&nbsp;recovers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1772950">//&nbsp;and&nbsp;frame&nbsp;5&nbsp;continues&nbsp;running,&nbsp;d3,&nbsp;d3&nbsp;can&nbsp;recover&nbsp;and&nbsp;we&#39;ll</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1773014">//&nbsp;resume&nbsp;execution&nbsp;in&nbsp;(returning&nbsp;from)&nbsp;frame&nbsp;3.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1773065">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1773069">//&nbsp;During&nbsp;the&nbsp;execution&nbsp;of&nbsp;d2,&nbsp;however,&nbsp;the&nbsp;panic&nbsp;stack&nbsp;is&nbsp;d2&nbsp;-&gt;&nbsp;d3,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1773139">//&nbsp;which&nbsp;is&nbsp;inverted.&nbsp;The&nbsp;scan&nbsp;will&nbsp;match&nbsp;d2&nbsp;to&nbsp;frame&nbsp;2&nbsp;but&nbsp;having</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1773207">//&nbsp;d2&nbsp;on&nbsp;the&nbsp;stack&nbsp;until&nbsp;then&nbsp;means&nbsp;it&nbsp;will&nbsp;not&nbsp;match&nbsp;d3&nbsp;to&nbsp;frame&nbsp;3.</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1773277">//&nbsp;This&nbsp;is&nbsp;okay:&nbsp;if&nbsp;we&#39;re&nbsp;running&nbsp;d2,&nbsp;then&nbsp;all&nbsp;the&nbsp;defers&nbsp;after&nbsp;d2&nbsp;have</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1773350">//&nbsp;completed&nbsp;and&nbsp;their&nbsp;corresponding&nbsp;frames&nbsp;are&nbsp;dead.&nbsp;Not&nbsp;finding&nbsp;d3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1773420">//&nbsp;for&nbsp;frame&nbsp;3&nbsp;means&nbsp;we&#39;ll&nbsp;set&nbsp;frame&nbsp;3&#39;s&nbsp;continpc&nbsp;==&nbsp;0,&nbsp;which&nbsp;is&nbsp;correct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1773494">//&nbsp;(frame&nbsp;3&nbsp;is&nbsp;dead).&nbsp;At&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;walk&nbsp;the&nbsp;panic&nbsp;stack&nbsp;can&nbsp;thus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1773565">//&nbsp;contain&nbsp;defers&nbsp;(d3&nbsp;in&nbsp;this&nbsp;case)&nbsp;for&nbsp;dead&nbsp;frames.&nbsp;The&nbsp;inversion&nbsp;here</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1773638">//&nbsp;always&nbsp;indicates&nbsp;a&nbsp;dead&nbsp;frame,&nbsp;and&nbsp;the&nbsp;effect&nbsp;of&nbsp;the&nbsp;inversion&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1773712">//&nbsp;scan&nbsp;is&nbsp;to&nbsp;hide&nbsp;those&nbsp;dead&nbsp;frames,&nbsp;so&nbsp;the&nbsp;scan&nbsp;is&nbsp;still&nbsp;okay:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1773778">//&nbsp;what&#39;s&nbsp;left&nbsp;on&nbsp;the&nbsp;panic&nbsp;stack&nbsp;are&nbsp;exactly&nbsp;(and&nbsp;only)&nbsp;the&nbsp;dead&nbsp;frames.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1773853">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1773857">//&nbsp;We&nbsp;require&nbsp;callback&nbsp;!=&nbsp;nil&nbsp;here&nbsp;because&nbsp;only&nbsp;when&nbsp;callback&nbsp;!=&nbsp;nil</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1773927">//&nbsp;do&nbsp;we&nbsp;know&nbsp;that&nbsp;gentraceback&nbsp;is&nbsp;being&nbsp;called&nbsp;in&nbsp;a&nbsp;&#34;must&nbsp;be&nbsp;correct&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1773999">//&nbsp;context&nbsp;as&nbsp;opposed&nbsp;to&nbsp;a&nbsp;&#34;best&nbsp;effort&#34;&nbsp;context.&nbsp;The&nbsp;tracebacks&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1774070">//&nbsp;callbacks&nbsp;only&nbsp;happen&nbsp;when&nbsp;everything&nbsp;is&nbsp;stopped&nbsp;nicely.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1774131">//&nbsp;At&nbsp;other&nbsp;times,&nbsp;such&nbsp;as&nbsp;when&nbsp;gathering&nbsp;a&nbsp;stack&nbsp;for&nbsp;a&nbsp;profiling&nbsp;signal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1774205">//&nbsp;or&nbsp;when&nbsp;printing&nbsp;a&nbsp;traceback&nbsp;during&nbsp;a&nbsp;crash,&nbsp;everything&nbsp;may&nbsp;not&nbsp;be</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1774276">//&nbsp;stopped&nbsp;nicely,&nbsp;and&nbsp;the&nbsp;stack&nbsp;walk&nbsp;may&nbsp;not&nbsp;be&nbsp;able&nbsp;to&nbsp;complete.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1774344">//&nbsp;It&#39;s&nbsp;okay&nbsp;in&nbsp;those&nbsp;situations&nbsp;not&nbsp;to&nbsp;use&nbsp;up&nbsp;the&nbsp;entire&nbsp;defer&nbsp;stack:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1774416">//&nbsp;incomplete&nbsp;information&nbsp;then&nbsp;is&nbsp;still&nbsp;better&nbsp;than&nbsp;nothing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1774478">if</span>&nbsp;<span class="ident" id="1774481">callback</span>&nbsp;<span class="op" id="1774490">!=</span>&nbsp;<span class="ident" id="1774493">nil</span>&nbsp;<span class="op" id="1774497">&amp;&amp;</span>&nbsp;<span class="ident" id="1774500">n</span>&nbsp;<span class="op" id="1774502">&lt;</span>&nbsp;<span class="ident" id="1774504">max</span>&nbsp;<span class="op" id="1774508">&amp;&amp;</span>&nbsp;<span class="ident" id="1774511">_defer</span>&nbsp;<span class="op" id="1774518">!=</span>&nbsp;<span class="ident" id="1774521">nil</span>&nbsp;<span class="op" id="1774525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1774529">if</span>&nbsp;<span class="ident" id="1774532">_defer</span>&nbsp;<span class="op" id="1774539">!=</span>&nbsp;<span class="ident" id="1774542">nil</span>&nbsp;<span class="op" id="1774546">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1774551">print</span><span class="op" id="1774556">(</span><span class="string" id="1774557">&#34;runtime:&nbsp;g&#34;</span><span class="op" id="1774569">,</span>&nbsp;<span class="ident" id="1774571">gp</span><span class="op" id="1774573">.</span><span class="ident" id="1774574">goid</span><span class="op" id="1774578">,</span>&nbsp;<span class="string" id="1774580">&#34;:&nbsp;leftover&nbsp;defer&nbsp;argp=&#34;</span><span class="op" id="1774604">,</span>&nbsp;<span class="ident" id="1774606">hex</span><span class="op" id="1774609">(</span><span class="ident" id="1774610">_defer</span><span class="op" id="1774616">.</span><span class="ident" id="1774617">argp</span><span class="op" id="1774621">)</span><span class="op" id="1774622">,</span>&nbsp;<span class="string" id="1774624">&#34;&nbsp;pc=&#34;</span><span class="op" id="1774630">,</span>&nbsp;<span class="ident" id="1774632">hex</span><span class="op" id="1774635">(</span><span class="ident" id="1774636">_defer</span><span class="op" id="1774642">.</span><span class="ident" id="1774643">pc</span><span class="op" id="1774645">)</span><span class="op" id="1774646">,</span>&nbsp;<span class="string" id="1774648">&#34;\n&#34;</span><span class="op" id="1774652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1774656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1774660">for</span>&nbsp;<span class="ident" id="1774664">_defer</span>&nbsp;<span class="op" id="1774671">=</span>&nbsp;<span class="ident" id="1774673">gp</span><span class="op" id="1774675">.</span><span class="ident" id="1774676">_defer</span><span class="op" id="1774682">;</span>&nbsp;<span class="ident" id="1774684">_defer</span>&nbsp;<span class="op" id="1774691">!=</span>&nbsp;<span class="ident" id="1774694">nil</span><span class="op" id="1774697">;</span>&nbsp;<span class="ident" id="1774699">_defer</span>&nbsp;<span class="op" id="1774706">=</span>&nbsp;<span class="ident" id="1774708">_defer</span><span class="op" id="1774714">.</span><span class="ident" id="1774715">link</span>&nbsp;<span class="op" id="1774720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1774725">print</span><span class="op" id="1774730">(</span><span class="string" id="1774731">&#34;\tdefer&nbsp;&#34;</span><span class="op" id="1774741">,</span>&nbsp;<span class="ident" id="1774743">_defer</span><span class="op" id="1774749">,</span>&nbsp;<span class="string" id="1774751">&#34;&nbsp;argp=&#34;</span><span class="op" id="1774759">,</span>&nbsp;<span class="ident" id="1774761">hex</span><span class="op" id="1774764">(</span><span class="ident" id="1774765">_defer</span><span class="op" id="1774771">.</span><span class="ident" id="1774772">argp</span><span class="op" id="1774776">)</span><span class="op" id="1774777">,</span>&nbsp;<span class="string" id="1774779">&#34;&nbsp;pc=&#34;</span><span class="op" id="1774785">,</span>&nbsp;<span class="ident" id="1774787">hex</span><span class="op" id="1774790">(</span><span class="ident" id="1774791">_defer</span><span class="op" id="1774797">.</span><span class="ident" id="1774798">pc</span><span class="op" id="1774800">)</span><span class="op" id="1774801">,</span>&nbsp;<span class="string" id="1774803">&#34;\n&#34;</span><span class="op" id="1774807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1774811">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1774815">gothrow</span><span class="op" id="1774822">(</span><span class="string" id="1774823">&#34;traceback&nbsp;has&nbsp;leftover&nbsp;defers&#34;</span><span class="op" id="1774854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1774857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1774861">return</span>&nbsp;<span class="ident" id="1774868">n</span><br>
<span class="lineno"></span><span class="op" id="1774870">}</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span><span class="keyword" id="1774873">func</span>&nbsp;<span class="ident" id="1774878">setArgInfo</span><span class="op" id="1774888">(</span><span class="ident" id="1774889">frame</span>&nbsp;<span class="op" id="1774895">*</span><span class="ident" id="1774896">stkframe</span><span class="op" id="1774904">,</span>&nbsp;<span class="ident" id="1774906">f</span>&nbsp;<span class="op" id="1774908">*</span><span class="ident" id="1774909">_func</span><span class="op" id="1774914">,</span>&nbsp;<span class="ident" id="1774916">needArgMap</span>&nbsp;<span class="builtintype" id="1774927">bool</span><span class="op" id="1774931">)</span>&nbsp;<span class="op" id="1774933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1774936">frame</span><span class="op" id="1774941">.</span><span class="ident" id="1774942">arglen</span>&nbsp;<span class="op" id="1774949">=</span>&nbsp;<span class="builtintype" id="1774951">uintptr</span><span class="op" id="1774958">(</span><span class="ident" id="1774959">f</span><span class="op" id="1774960">.</span><span class="ident" id="1774961">args</span><span class="op" id="1774965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1774968">if</span>&nbsp;<span class="ident" id="1774971">needArgMap</span>&nbsp;<span class="op" id="1774982">&amp;&amp;</span>&nbsp;<span class="ident" id="1774985">f</span><span class="op" id="1774986">.</span><span class="ident" id="1774987">args</span>&nbsp;<span class="op" id="1774992">==</span>&nbsp;<span class="ident" id="1774995">_ArgsSizeUnknown</span>&nbsp;<span class="op" id="1775012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1775016">//&nbsp;Extract&nbsp;argument&nbsp;bitmaps&nbsp;for&nbsp;reflect&nbsp;stubs&nbsp;from&nbsp;the&nbsp;calls&nbsp;they&nbsp;made&nbsp;to&nbsp;reflect.</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1775101">switch</span>&nbsp;<span class="ident" id="1775108">gofuncname</span><span class="op" id="1775118">(</span><span class="ident" id="1775119">f</span><span class="op" id="1775120">)</span>&nbsp;<span class="op" id="1775122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1775126">case</span>&nbsp;<span class="string" id="1775131">&#34;reflect.makeFuncStub&#34;</span><span class="op" id="1775153">,</span>&nbsp;<span class="string" id="1775155">&#34;reflect.methodValueCall&#34;</span><span class="op" id="1775180">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1775185">arg0</span>&nbsp;<span class="op" id="1775190">:=</span>&nbsp;<span class="ident" id="1775193">frame</span><span class="op" id="1775198">.</span><span class="ident" id="1775199">sp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1775205">if</span>&nbsp;<span class="ident" id="1775208">usesLR</span>&nbsp;<span class="op" id="1775215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1775221">arg0</span>&nbsp;<span class="op" id="1775226">+=</span>&nbsp;<span class="ident" id="1775229">ptrSize</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1775240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1775245">fn</span>&nbsp;<span class="op" id="1775248">:=</span>&nbsp;<span class="op" id="1775251">*</span><span class="op" id="1775252">(</span><span class="op" id="1775253">*</span><span class="op" id="1775254">*</span><span class="op" id="1775255">[</span><span class="num" id="1775256">2</span><span class="op" id="1775257">]</span><span class="builtintype" id="1775258">uintptr</span><span class="op" id="1775265">)</span><span class="op" id="1775266">(</span><span class="ident" id="1775267">unsafe</span><span class="op" id="1775273">.</span><span class="ident" id="1775274">Pointer</span><span class="op" id="1775281">(</span><span class="ident" id="1775282">arg0</span><span class="op" id="1775286">)</span><span class="op" id="1775287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1775292">if</span>&nbsp;<span class="ident" id="1775295">fn</span><span class="op" id="1775297">[</span><span class="num" id="1775298">0</span><span class="op" id="1775299">]</span>&nbsp;<span class="op" id="1775301">!=</span>&nbsp;<span class="ident" id="1775304">f</span><span class="op" id="1775305">.</span><span class="ident" id="1775306">entry</span>&nbsp;<span class="op" id="1775312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1775318">print</span><span class="op" id="1775323">(</span><span class="string" id="1775324">&#34;runtime:&nbsp;confused&nbsp;by&nbsp;&#34;</span><span class="op" id="1775347">,</span>&nbsp;<span class="ident" id="1775349">gofuncname</span><span class="op" id="1775359">(</span><span class="ident" id="1775360">f</span><span class="op" id="1775361">)</span><span class="op" id="1775362">,</span>&nbsp;<span class="string" id="1775364">&#34;\n&#34;</span><span class="op" id="1775368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1775374">gothrow</span><span class="op" id="1775381">(</span><span class="string" id="1775382">&#34;reflect&nbsp;mismatch&#34;</span><span class="op" id="1775400">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1775405">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1775410">bv</span>&nbsp;<span class="op" id="1775413">:=</span>&nbsp;<span class="op" id="1775416">(</span><span class="op" id="1775417">*</span><span class="ident" id="1775418">bitvector</span><span class="op" id="1775427">)</span><span class="op" id="1775428">(</span><span class="ident" id="1775429">unsafe</span><span class="op" id="1775435">.</span><span class="ident" id="1775436">Pointer</span><span class="op" id="1775443">(</span><span class="ident" id="1775444">fn</span><span class="op" id="1775446">[</span><span class="num" id="1775447">1</span><span class="op" id="1775448">]</span><span class="op" id="1775449">)</span><span class="op" id="1775450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1775455">frame</span><span class="op" id="1775460">.</span><span class="ident" id="1775461">arglen</span>&nbsp;<span class="op" id="1775468">=</span>&nbsp;<span class="builtintype" id="1775470">uintptr</span><span class="op" id="1775477">(</span><span class="ident" id="1775478">bv</span><span class="op" id="1775480">.</span><span class="ident" id="1775481">n</span>&nbsp;<span class="op" id="1775483">/</span>&nbsp;<span class="num" id="1775485">2</span>&nbsp;<span class="op" id="1775487">*</span>&nbsp;<span class="ident" id="1775489">ptrSize</span><span class="op" id="1775496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1775501">frame</span><span class="op" id="1775506">.</span><span class="ident" id="1775507">argmap</span>&nbsp;<span class="op" id="1775514">=</span>&nbsp;<span class="ident" id="1775516">bv</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1775521">}</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1775524">}</span><br>
<span class="lineno"></span><span class="op" id="1775526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1775529">func</span>&nbsp;<span class="ident" id="1775534">printcreatedby</span><span class="op" id="1775548">(</span><span class="ident" id="1775549">gp</span>&nbsp;<span class="op" id="1775552">*</span><span class="ident" id="1775553">g</span><span class="op" id="1775554">)</span>&nbsp;<span class="op" id="1775556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1775559">//&nbsp;Show&nbsp;what&nbsp;created&nbsp;goroutine,&nbsp;except&nbsp;main&nbsp;goroutine&nbsp;(goid&nbsp;1).</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1775624">pc</span>&nbsp;<span class="op" id="1775627">:=</span>&nbsp;<span class="ident" id="1775630">gp</span><span class="op" id="1775632">.</span><span class="ident" id="1775633">gopc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1775639">f</span>&nbsp;<span class="op" id="1775641">:=</span>&nbsp;<span class="ident" id="1775644">findfunc</span><span class="op" id="1775652">(</span><span class="ident" id="1775653">pc</span><span class="op" id="1775655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1775658">if</span>&nbsp;<span class="ident" id="1775661">f</span>&nbsp;<span class="op" id="1775663">!=</span>&nbsp;<span class="ident" id="1775666">nil</span>&nbsp;<span class="op" id="1775670">&amp;&amp;</span>&nbsp;<span class="ident" id="1775673">showframe</span><span class="op" id="1775682">(</span><span class="ident" id="1775683">f</span><span class="op" id="1775684">,</span>&nbsp;<span class="ident" id="1775686">gp</span><span class="op" id="1775688">)</span>&nbsp;<span class="op" id="1775690">&amp;&amp;</span>&nbsp;<span class="ident" id="1775693">gp</span><span class="op" id="1775695">.</span><span class="ident" id="1775696">goid</span>&nbsp;<span class="op" id="1775701">!=</span>&nbsp;<span class="num" id="1775704">1</span>&nbsp;<span class="op" id="1775706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1775710">print</span><span class="op" id="1775715">(</span><span class="string" id="1775716">&#34;created&nbsp;by&nbsp;&#34;</span><span class="op" id="1775729">,</span>&nbsp;<span class="ident" id="1775731">gofuncname</span><span class="op" id="1775741">(</span><span class="ident" id="1775742">f</span><span class="op" id="1775743">)</span><span class="op" id="1775744">,</span>&nbsp;<span class="string" id="1775746">&#34;\n&#34;</span><span class="op" id="1775750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1775754">tracepc</span>&nbsp;<span class="op" id="1775762">:=</span>&nbsp;<span class="ident" id="1775765">pc</span>&nbsp;<span class="comment" id="1775768">//&nbsp;back&nbsp;up&nbsp;to&nbsp;CALL&nbsp;instruction&nbsp;for&nbsp;funcline.</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1775815">if</span>&nbsp;<span class="ident" id="1775818">pc</span>&nbsp;<span class="op" id="1775821">&gt;</span>&nbsp;<span class="ident" id="1775823">f</span><span class="op" id="1775824">.</span><span class="ident" id="1775825">entry</span>&nbsp;<span class="op" id="1775831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1775836">tracepc</span>&nbsp;<span class="op" id="1775844">-=</span>&nbsp;<span class="ident" id="1775847">_PCQuantum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1775860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1775864">var</span>&nbsp;<span class="ident" id="1775868">file</span>&nbsp;<span class="builtintype" id="1775873">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1775882">line</span>&nbsp;<span class="op" id="1775887">:=</span>&nbsp;<span class="ident" id="1775890">funcline</span><span class="op" id="1775898">(</span><span class="ident" id="1775899">f</span><span class="op" id="1775900">,</span>&nbsp;<span class="ident" id="1775902">tracepc</span><span class="op" id="1775909">,</span>&nbsp;<span class="op" id="1775911">&amp;</span><span class="ident" id="1775912">file</span><span class="op" id="1775916">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1775920">print</span><span class="op" id="1775925">(</span><span class="string" id="1775926">&#34;\t&#34;</span><span class="op" id="1775930">,</span>&nbsp;<span class="ident" id="1775932">file</span><span class="op" id="1775936">,</span>&nbsp;<span class="string" id="1775938">&#34;:&#34;</span><span class="op" id="1775941">,</span>&nbsp;<span class="ident" id="1775943">line</span><span class="op" id="1775947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1775951">if</span>&nbsp;<span class="ident" id="1775954">pc</span>&nbsp;<span class="op" id="1775957">&gt;</span>&nbsp;<span class="ident" id="1775959">f</span><span class="op" id="1775960">.</span><span class="ident" id="1775961">entry</span>&nbsp;<span class="op" id="1775967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1775972">print</span><span class="op" id="1775977">(</span><span class="string" id="1775978">&#34;&nbsp;+&#34;</span><span class="op" id="1775982">,</span>&nbsp;<span class="ident" id="1775984">hex</span><span class="op" id="1775987">(</span><span class="ident" id="1775988">pc</span><span class="op" id="1775990">-</span><span class="ident" id="1775991">f</span><span class="op" id="1775992">.</span><span class="ident" id="1775993">entry</span><span class="op" id="1775998">)</span><span class="op" id="1775999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1776003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1776007">print</span><span class="op" id="1776012">(</span><span class="string" id="1776013">&#34;\n&#34;</span><span class="op" id="1776017">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1776020">}</span><br>
<span class="lineno"></span><span class="op" id="1776022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1776025">func</span>&nbsp;<span class="ident" id="1776030">traceback</span><span class="op" id="1776039">(</span><span class="ident" id="1776040">pc</span>&nbsp;<span class="builtintype" id="1776043">uintptr</span><span class="op" id="1776050">,</span>&nbsp;<span class="ident" id="1776052">sp</span>&nbsp;<span class="builtintype" id="1776055">uintptr</span><span class="op" id="1776062">,</span>&nbsp;<span class="ident" id="1776064">lr</span>&nbsp;<span class="builtintype" id="1776067">uintptr</span><span class="op" id="1776074">,</span>&nbsp;<span class="ident" id="1776076">gp</span>&nbsp;<span class="op" id="1776079">*</span><span class="ident" id="1776080">g</span><span class="op" id="1776081">)</span>&nbsp;<span class="op" id="1776083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1776086">traceback1</span><span class="op" id="1776096">(</span><span class="ident" id="1776097">pc</span><span class="op" id="1776099">,</span>&nbsp;<span class="ident" id="1776101">sp</span><span class="op" id="1776103">,</span>&nbsp;<span class="ident" id="1776105">lr</span><span class="op" id="1776107">,</span>&nbsp;<span class="ident" id="1776109">gp</span><span class="op" id="1776111">,</span>&nbsp;<span class="num" id="1776113">0</span><span class="op" id="1776114">)</span><br>
<span class="lineno">495</span><span class="op" id="1776116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1776119">//&nbsp;tracebacktrap&nbsp;is&nbsp;like&nbsp;traceback&nbsp;but&nbsp;expects&nbsp;that&nbsp;the&nbsp;PC&nbsp;and&nbsp;SP&nbsp;were&nbsp;obtained</span><br>
<span class="lineno"></span><span class="comment" id="1776199">//&nbsp;from&nbsp;a&nbsp;trap,&nbsp;not&nbsp;from&nbsp;gp-&gt;sched&nbsp;or&nbsp;gp-&gt;syscallpc/gp-&gt;syscallsp&nbsp;or&nbsp;getcallerpc/getcallersp.</span><br>
<span class="lineno"></span><span class="comment" id="1776293">//&nbsp;Because&nbsp;they&nbsp;are&nbsp;from&nbsp;a&nbsp;trap&nbsp;instead&nbsp;of&nbsp;from&nbsp;a&nbsp;saved&nbsp;pair,</span><br>
<span class="lineno">500</span><span class="comment" id="1776355">//&nbsp;the&nbsp;initial&nbsp;PC&nbsp;must&nbsp;not&nbsp;be&nbsp;rewound&nbsp;to&nbsp;the&nbsp;previous&nbsp;instruction.</span><br>
<span class="lineno"></span><span class="comment" id="1776422">//&nbsp;(All&nbsp;the&nbsp;saved&nbsp;pairs&nbsp;record&nbsp;a&nbsp;PC&nbsp;that&nbsp;is&nbsp;a&nbsp;return&nbsp;address,&nbsp;so&nbsp;we</span><br>
<span class="lineno"></span><span class="comment" id="1776490">//&nbsp;rewind&nbsp;it&nbsp;into&nbsp;the&nbsp;CALL&nbsp;instruction.)</span><br>
<span class="lineno"></span><span class="keyword" id="1776531">func</span>&nbsp;<span class="ident" id="1776536">tracebacktrap</span><span class="op" id="1776549">(</span><span class="ident" id="1776550">pc</span>&nbsp;<span class="builtintype" id="1776553">uintptr</span><span class="op" id="1776560">,</span>&nbsp;<span class="ident" id="1776562">sp</span>&nbsp;<span class="builtintype" id="1776565">uintptr</span><span class="op" id="1776572">,</span>&nbsp;<span class="ident" id="1776574">lr</span>&nbsp;<span class="builtintype" id="1776577">uintptr</span><span class="op" id="1776584">,</span>&nbsp;<span class="ident" id="1776586">gp</span>&nbsp;<span class="op" id="1776589">*</span><span class="ident" id="1776590">g</span><span class="op" id="1776591">)</span>&nbsp;<span class="op" id="1776593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1776596">traceback1</span><span class="op" id="1776606">(</span><span class="ident" id="1776607">pc</span><span class="op" id="1776609">,</span>&nbsp;<span class="ident" id="1776611">sp</span><span class="op" id="1776613">,</span>&nbsp;<span class="ident" id="1776615">lr</span><span class="op" id="1776617">,</span>&nbsp;<span class="ident" id="1776619">gp</span><span class="op" id="1776621">,</span>&nbsp;<span class="ident" id="1776623">_TraceTrap</span><span class="op" id="1776633">)</span><br>
<span class="lineno">505</span><span class="op" id="1776635">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1776638">func</span>&nbsp;<span class="ident" id="1776643">traceback1</span><span class="op" id="1776653">(</span><span class="ident" id="1776654">pc</span>&nbsp;<span class="builtintype" id="1776657">uintptr</span><span class="op" id="1776664">,</span>&nbsp;<span class="ident" id="1776666">sp</span>&nbsp;<span class="builtintype" id="1776669">uintptr</span><span class="op" id="1776676">,</span>&nbsp;<span class="ident" id="1776678">lr</span>&nbsp;<span class="builtintype" id="1776681">uintptr</span><span class="op" id="1776688">,</span>&nbsp;<span class="ident" id="1776690">gp</span>&nbsp;<span class="op" id="1776693">*</span><span class="ident" id="1776694">g</span><span class="op" id="1776695">,</span>&nbsp;<span class="ident" id="1776697">flags</span>&nbsp;<span class="builtintype" id="1776703">uint</span><span class="op" id="1776707">)</span>&nbsp;<span class="op" id="1776709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1776712">var</span>&nbsp;<span class="ident" id="1776716">n</span>&nbsp;<span class="builtintype" id="1776718">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1776723">if</span>&nbsp;<span class="ident" id="1776726">readgstatus</span><span class="op" id="1776737">(</span><span class="ident" id="1776738">gp</span><span class="op" id="1776740">)</span><span class="op" id="1776741">&amp;^</span><span class="ident" id="1776743">_Gscan</span>&nbsp;<span class="op" id="1776750">==</span>&nbsp;<span class="ident" id="1776753">_Gsyscall</span>&nbsp;<span class="op" id="1776763">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1776767">//&nbsp;Override&nbsp;registers&nbsp;if&nbsp;blocked&nbsp;in&nbsp;system&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1776818">pc</span>&nbsp;<span class="op" id="1776821">=</span>&nbsp;<span class="ident" id="1776823">gp</span><span class="op" id="1776825">.</span><span class="ident" id="1776826">syscallpc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1776838">sp</span>&nbsp;<span class="op" id="1776841">=</span>&nbsp;<span class="ident" id="1776843">gp</span><span class="op" id="1776845">.</span><span class="ident" id="1776846">syscallsp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1776858">flags</span>&nbsp;<span class="op" id="1776864">&amp;^=</span>&nbsp;<span class="ident" id="1776868">_TraceTrap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1776880">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1776883">//&nbsp;Print&nbsp;traceback.&nbsp;By&nbsp;default,&nbsp;omits&nbsp;runtime&nbsp;frames.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1776938">//&nbsp;If&nbsp;that&nbsp;means&nbsp;we&nbsp;print&nbsp;nothing&nbsp;at&nbsp;all,&nbsp;repeat&nbsp;forcing&nbsp;all&nbsp;frames&nbsp;printed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1777016">n</span>&nbsp;<span class="op" id="1777018">=</span>&nbsp;<span class="ident" id="1777020">gentraceback</span><span class="op" id="1777032">(</span><span class="ident" id="1777033">pc</span><span class="op" id="1777035">,</span>&nbsp;<span class="ident" id="1777037">sp</span><span class="op" id="1777039">,</span>&nbsp;<span class="ident" id="1777041">lr</span><span class="op" id="1777043">,</span>&nbsp;<span class="ident" id="1777045">gp</span><span class="op" id="1777047">,</span>&nbsp;<span class="num" id="1777049">0</span><span class="op" id="1777050">,</span>&nbsp;<span class="ident" id="1777052">nil</span><span class="op" id="1777055">,</span>&nbsp;<span class="ident" id="1777057">_TracebackMaxFrames</span><span class="op" id="1777076">,</span>&nbsp;<span class="ident" id="1777078">nil</span><span class="op" id="1777081">,</span>&nbsp;<span class="ident" id="1777083">nil</span><span class="op" id="1777086">,</span>&nbsp;<span class="ident" id="1777088">flags</span><span class="op" id="1777093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1777096">if</span>&nbsp;<span class="ident" id="1777099">n</span>&nbsp;<span class="op" id="1777101">==</span>&nbsp;<span class="num" id="1777104">0</span>&nbsp;<span class="op" id="1777106">&amp;&amp;</span>&nbsp;<span class="op" id="1777109">(</span><span class="ident" id="1777110">flags</span><span class="op" id="1777115">&amp;</span><span class="ident" id="1777116">_TraceRuntimeFrames</span><span class="op" id="1777135">)</span>&nbsp;<span class="op" id="1777137">==</span>&nbsp;<span class="num" id="1777140">0</span>&nbsp;<span class="op" id="1777142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1777146">n</span>&nbsp;<span class="op" id="1777148">=</span>&nbsp;<span class="ident" id="1777150">gentraceback</span><span class="op" id="1777162">(</span><span class="ident" id="1777163">pc</span><span class="op" id="1777165">,</span>&nbsp;<span class="ident" id="1777167">sp</span><span class="op" id="1777169">,</span>&nbsp;<span class="ident" id="1777171">lr</span><span class="op" id="1777173">,</span>&nbsp;<span class="ident" id="1777175">gp</span><span class="op" id="1777177">,</span>&nbsp;<span class="num" id="1777179">0</span><span class="op" id="1777180">,</span>&nbsp;<span class="ident" id="1777182">nil</span><span class="op" id="1777185">,</span>&nbsp;<span class="ident" id="1777187">_TracebackMaxFrames</span><span class="op" id="1777206">,</span>&nbsp;<span class="ident" id="1777208">nil</span><span class="op" id="1777211">,</span>&nbsp;<span class="ident" id="1777213">nil</span><span class="op" id="1777216">,</span>&nbsp;<span class="ident" id="1777218">flags</span><span class="op" id="1777223">|</span><span class="ident" id="1777224">_TraceRuntimeFrames</span><span class="op" id="1777243">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1777246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1777249">if</span>&nbsp;<span class="ident" id="1777252">n</span>&nbsp;<span class="op" id="1777254">==</span>&nbsp;<span class="ident" id="1777257">_TracebackMaxFrames</span>&nbsp;<span class="op" id="1777277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1777281">print</span><span class="op" id="1777286">(</span><span class="string" id="1777287">&#34;...additional&nbsp;frames&nbsp;elided...\n&#34;</span><span class="op" id="1777321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1777324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1777327">printcreatedby</span><span class="op" id="1777341">(</span><span class="ident" id="1777342">gp</span><span class="op" id="1777344">)</span><br>
<span class="lineno">525</span><span class="op" id="1777346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1777349">func</span>&nbsp;<span class="ident" id="1777354">callers</span><span class="op" id="1777361">(</span><span class="ident" id="1777362">skip</span>&nbsp;<span class="builtintype" id="1777367">int</span><span class="op" id="1777370">,</span>&nbsp;<span class="ident" id="1777372">pcbuf</span>&nbsp;<span class="op" id="1777378">*</span><span class="builtintype" id="1777379">uintptr</span><span class="op" id="1777386">,</span>&nbsp;<span class="ident" id="1777388">m</span>&nbsp;<span class="builtintype" id="1777390">int</span><span class="op" id="1777393">)</span>&nbsp;<span class="builtintype" id="1777395">int</span>&nbsp;<span class="op" id="1777399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1777402">sp</span>&nbsp;<span class="op" id="1777405">:=</span>&nbsp;<span class="ident" id="1777408">getcallersp</span><span class="op" id="1777419">(</span><span class="ident" id="1777420">unsafe</span><span class="op" id="1777426">.</span><span class="ident" id="1777427">Pointer</span><span class="op" id="1777434">(</span><span class="op" id="1777435">&amp;</span><span class="ident" id="1777436">skip</span><span class="op" id="1777440">)</span><span class="op" id="1777441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1777444">pc</span>&nbsp;<span class="op" id="1777447">:=</span>&nbsp;<span class="builtintype" id="1777450">uintptr</span><span class="op" id="1777457">(</span><span class="ident" id="1777458">getcallerpc</span><span class="op" id="1777469">(</span><span class="ident" id="1777470">unsafe</span><span class="op" id="1777476">.</span><span class="ident" id="1777477">Pointer</span><span class="op" id="1777484">(</span><span class="op" id="1777485">&amp;</span><span class="ident" id="1777486">skip</span><span class="op" id="1777490">)</span><span class="op" id="1777491">)</span><span class="op" id="1777492">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1777495">var</span>&nbsp;<span class="ident" id="1777499">n</span>&nbsp;<span class="builtintype" id="1777501">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1777506">onM</span><span class="op" id="1777509">(</span><span class="keyword" id="1777510">func</span><span class="op" id="1777514">(</span><span class="op" id="1777515">)</span>&nbsp;<span class="op" id="1777517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1777521">n</span>&nbsp;<span class="op" id="1777523">=</span>&nbsp;<span class="ident" id="1777525">gentraceback</span><span class="op" id="1777537">(</span><span class="ident" id="1777538">pc</span><span class="op" id="1777540">,</span>&nbsp;<span class="ident" id="1777542">sp</span><span class="op" id="1777544">,</span>&nbsp;<span class="num" id="1777546">0</span><span class="op" id="1777547">,</span>&nbsp;<span class="ident" id="1777549">getg</span><span class="op" id="1777553">(</span><span class="op" id="1777554">)</span><span class="op" id="1777555">,</span>&nbsp;<span class="ident" id="1777557">skip</span><span class="op" id="1777561">,</span>&nbsp;<span class="ident" id="1777563">pcbuf</span><span class="op" id="1777568">,</span>&nbsp;<span class="ident" id="1777570">m</span><span class="op" id="1777571">,</span>&nbsp;<span class="ident" id="1777573">nil</span><span class="op" id="1777576">,</span>&nbsp;<span class="ident" id="1777578">nil</span><span class="op" id="1777581">,</span>&nbsp;<span class="num" id="1777583">0</span><span class="op" id="1777584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1777587">}</span><span class="op" id="1777588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1777591">return</span>&nbsp;<span class="ident" id="1777598">n</span><br>
<span class="lineno">535</span><span class="op" id="1777600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1777603">func</span>&nbsp;<span class="ident" id="1777608">gcallers</span><span class="op" id="1777616">(</span><span class="ident" id="1777617">gp</span>&nbsp;<span class="op" id="1777620">*</span><span class="ident" id="1777621">g</span><span class="op" id="1777622">,</span>&nbsp;<span class="ident" id="1777624">skip</span>&nbsp;<span class="builtintype" id="1777629">int</span><span class="op" id="1777632">,</span>&nbsp;<span class="ident" id="1777634">pcbuf</span>&nbsp;<span class="op" id="1777640">*</span><span class="builtintype" id="1777641">uintptr</span><span class="op" id="1777648">,</span>&nbsp;<span class="ident" id="1777650">m</span>&nbsp;<span class="builtintype" id="1777652">int</span><span class="op" id="1777655">)</span>&nbsp;<span class="builtintype" id="1777657">int</span>&nbsp;<span class="op" id="1777661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1777664">return</span>&nbsp;<span class="ident" id="1777671">gentraceback</span><span class="op" id="1777683">(</span><span class="op" id="1777684">^</span><span class="builtintype" id="1777685">uintptr</span><span class="op" id="1777692">(</span><span class="num" id="1777693">0</span><span class="op" id="1777694">)</span><span class="op" id="1777695">,</span>&nbsp;<span class="op" id="1777697">^</span><span class="builtintype" id="1777698">uintptr</span><span class="op" id="1777705">(</span><span class="num" id="1777706">0</span><span class="op" id="1777707">)</span><span class="op" id="1777708">,</span>&nbsp;<span class="num" id="1777710">0</span><span class="op" id="1777711">,</span>&nbsp;<span class="ident" id="1777713">gp</span><span class="op" id="1777715">,</span>&nbsp;<span class="ident" id="1777717">skip</span><span class="op" id="1777721">,</span>&nbsp;<span class="ident" id="1777723">pcbuf</span><span class="op" id="1777728">,</span>&nbsp;<span class="ident" id="1777730">m</span><span class="op" id="1777731">,</span>&nbsp;<span class="ident" id="1777733">nil</span><span class="op" id="1777736">,</span>&nbsp;<span class="ident" id="1777738">nil</span><span class="op" id="1777741">,</span>&nbsp;<span class="num" id="1777743">0</span><span class="op" id="1777744">)</span><br>
<span class="lineno"></span><span class="op" id="1777746">}</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span><span class="keyword" id="1777749">func</span>&nbsp;<span class="ident" id="1777754">showframe</span><span class="op" id="1777763">(</span><span class="ident" id="1777764">f</span>&nbsp;<span class="op" id="1777766">*</span><span class="ident" id="1777767">_func</span><span class="op" id="1777772">,</span>&nbsp;<span class="ident" id="1777774">gp</span>&nbsp;<span class="op" id="1777777">*</span><span class="ident" id="1777778">g</span><span class="op" id="1777779">)</span>&nbsp;<span class="builtintype" id="1777781">bool</span>&nbsp;<span class="op" id="1777786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1777789">g</span>&nbsp;<span class="op" id="1777791">:=</span>&nbsp;<span class="ident" id="1777794">getg</span><span class="op" id="1777798">(</span><span class="op" id="1777799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1777802">if</span>&nbsp;<span class="ident" id="1777805">g</span><span class="op" id="1777806">.</span><span class="ident" id="1777807">m</span><span class="op" id="1777808">.</span><span class="ident" id="1777809">throwing</span>&nbsp;<span class="op" id="1777818">&gt;</span>&nbsp;<span class="num" id="1777820">0</span>&nbsp;<span class="op" id="1777822">&amp;&amp;</span>&nbsp;<span class="ident" id="1777825">gp</span>&nbsp;<span class="op" id="1777828">!=</span>&nbsp;<span class="ident" id="1777831">nil</span>&nbsp;<span class="op" id="1777835">&amp;&amp;</span>&nbsp;<span class="op" id="1777838">(</span><span class="ident" id="1777839">gp</span>&nbsp;<span class="op" id="1777842">==</span>&nbsp;<span class="ident" id="1777845">g</span><span class="op" id="1777846">.</span><span class="ident" id="1777847">m</span><span class="op" id="1777848">.</span><span class="ident" id="1777849">curg</span>&nbsp;<span class="op" id="1777854">||</span>&nbsp;<span class="ident" id="1777857">gp</span>&nbsp;<span class="op" id="1777860">==</span>&nbsp;<span class="ident" id="1777863">g</span><span class="op" id="1777864">.</span><span class="ident" id="1777865">m</span><span class="op" id="1777866">.</span><span class="ident" id="1777867">caughtsig</span><span class="op" id="1777876">)</span>&nbsp;<span class="op" id="1777878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1777882">return</span>&nbsp;<span class="builtintype" id="1777889">true</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1777895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1777898">traceback</span>&nbsp;<span class="op" id="1777908">:=</span>&nbsp;<span class="ident" id="1777911">gotraceback</span><span class="op" id="1777922">(</span><span class="ident" id="1777923">nil</span><span class="op" id="1777926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1777929">name</span>&nbsp;<span class="op" id="1777934">:=</span>&nbsp;<span class="ident" id="1777937">gostringnocopy</span><span class="op" id="1777951">(</span><span class="ident" id="1777952">funcname</span><span class="op" id="1777960">(</span><span class="ident" id="1777961">f</span><span class="op" id="1777962">)</span><span class="op" id="1777963">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1777967">//&nbsp;Special&nbsp;case:&nbsp;always&nbsp;show&nbsp;runtime.panic&nbsp;frame,&nbsp;so&nbsp;that&nbsp;we&nbsp;can</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1778033">//&nbsp;see&nbsp;where&nbsp;a&nbsp;panic&nbsp;started&nbsp;in&nbsp;the&nbsp;middle&nbsp;of&nbsp;a&nbsp;stack&nbsp;trace.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1778095">//&nbsp;See&nbsp;golang.org/issue/5832.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1778126">if</span>&nbsp;<span class="ident" id="1778129">name</span>&nbsp;<span class="op" id="1778134">==</span>&nbsp;<span class="string" id="1778137">&#34;runtime.panic&#34;</span>&nbsp;<span class="op" id="1778153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1778157">return</span>&nbsp;<span class="builtintype" id="1778164">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1778170">}</span><br>
<span class="lineno">555</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1778174">return</span>&nbsp;<span class="ident" id="1778181">traceback</span>&nbsp;<span class="op" id="1778191">&gt;</span>&nbsp;<span class="num" id="1778193">1</span>&nbsp;<span class="op" id="1778195">||</span>&nbsp;<span class="ident" id="1778198">f</span>&nbsp;<span class="op" id="1778200">!=</span>&nbsp;<span class="ident" id="1778203">nil</span>&nbsp;<span class="op" id="1778207">&amp;&amp;</span>&nbsp;<span class="ident" id="1778210">contains</span><span class="op" id="1778218">(</span><span class="ident" id="1778219">name</span><span class="op" id="1778223">,</span>&nbsp;<span class="string" id="1778225">&#34;.&#34;</span><span class="op" id="1778228">)</span>&nbsp;<span class="op" id="1778230">&amp;&amp;</span>&nbsp;<span class="op" id="1778233">(</span><span class="op" id="1778234">!</span><span class="ident" id="1778235">hasprefix</span><span class="op" id="1778244">(</span><span class="ident" id="1778245">name</span><span class="op" id="1778249">,</span>&nbsp;<span class="string" id="1778251">&#34;runtime.&#34;</span><span class="op" id="1778261">)</span>&nbsp;<span class="op" id="1778263">||</span>&nbsp;<span class="ident" id="1778266">isExportedRuntime</span><span class="op" id="1778283">(</span><span class="ident" id="1778284">name</span><span class="op" id="1778288">)</span><span class="op" id="1778289">)</span><br>
<span class="lineno"></span><span class="op" id="1778291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1778294">//&nbsp;isExportedRuntime&nbsp;reports&nbsp;whether&nbsp;name&nbsp;is&nbsp;an&nbsp;exported&nbsp;runtime&nbsp;function.</span><br>
<span class="lineno">560</span><span class="comment" id="1778369">//&nbsp;It&nbsp;is&nbsp;only&nbsp;for&nbsp;runtime&nbsp;functions,&nbsp;so&nbsp;ASCII&nbsp;A-Z&nbsp;is&nbsp;fine.</span><br>
<span class="lineno"></span><span class="keyword" id="1778428">func</span>&nbsp;<span class="ident" id="1778433">isExportedRuntime</span><span class="op" id="1778450">(</span><span class="ident" id="1778451">name</span>&nbsp;<span class="builtintype" id="1778456">string</span><span class="op" id="1778462">)</span>&nbsp;<span class="builtintype" id="1778464">bool</span>&nbsp;<span class="op" id="1778469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1778472">const</span>&nbsp;<span class="ident" id="1778478">n</span>&nbsp;<span class="op" id="1778480">=</span>&nbsp;<span class="builtinfunc" id="1778482">len</span><span class="op" id="1778485">(</span><span class="string" id="1778486">&#34;runtime.&#34;</span><span class="op" id="1778496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1778499">return</span>&nbsp;<span class="builtinfunc" id="1778506">len</span><span class="op" id="1778509">(</span><span class="ident" id="1778510">name</span><span class="op" id="1778514">)</span>&nbsp;<span class="op" id="1778516">&gt;</span>&nbsp;<span class="ident" id="1778518">n</span>&nbsp;<span class="op" id="1778520">&amp;&amp;</span>&nbsp;<span class="ident" id="1778523">name</span><span class="op" id="1778527">[</span><span class="op" id="1778528">:</span><span class="ident" id="1778529">n</span><span class="op" id="1778530">]</span>&nbsp;<span class="op" id="1778532">==</span>&nbsp;<span class="string" id="1778535">&#34;runtime.&#34;</span>&nbsp;<span class="op" id="1778546">&amp;&amp;</span>&nbsp;<span class="string" id="1778549">&#39;A&#39;</span>&nbsp;<span class="op" id="1778553">&lt;=</span>&nbsp;<span class="ident" id="1778556">name</span><span class="op" id="1778560">[</span><span class="ident" id="1778561">n</span><span class="op" id="1778562">]</span>&nbsp;<span class="op" id="1778564">&amp;&amp;</span>&nbsp;<span class="ident" id="1778567">name</span><span class="op" id="1778571">[</span><span class="ident" id="1778572">n</span><span class="op" id="1778573">]</span>&nbsp;<span class="op" id="1778575">&lt;=</span>&nbsp;<span class="string" id="1778578">&#39;Z&#39;</span><br>
<span class="lineno"></span><span class="op" id="1778582">}</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span><span class="keyword" id="1778585">var</span>&nbsp;<span class="ident" id="1778589">gStatusStrings</span>&nbsp;<span class="op" id="1778604">=</span>&nbsp;<span class="op" id="1778606">[</span><span class="op" id="1778607">...</span><span class="op" id="1778610">]</span><span class="builtintype" id="1778611">string</span><span class="op" id="1778617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1778620">_Gidle</span><span class="op" id="1778626">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1778633">&#34;idle&#34;</span><span class="op" id="1778639">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1778642">_Grunnable</span><span class="op" id="1778652">:</span>&nbsp;&nbsp;<span class="string" id="1778655">&#34;runnable&#34;</span><span class="op" id="1778665">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1778668">_Grunning</span><span class="op" id="1778677">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="1778681">&#34;running&#34;</span><span class="op" id="1778690">,</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1778693">_Gsyscall</span><span class="op" id="1778702">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="1778706">&#34;syscall&#34;</span><span class="op" id="1778715">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1778718">_Gwaiting</span><span class="op" id="1778727">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="1778731">&#34;waiting&#34;</span><span class="op" id="1778740">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1778743">_Gdead</span><span class="op" id="1778749">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1778756">&#34;dead&#34;</span><span class="op" id="1778762">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1778765">_Genqueue</span><span class="op" id="1778774">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="1778778">&#34;enqueue&#34;</span><span class="op" id="1778787">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1778790">_Gcopystack</span><span class="op" id="1778801">:</span>&nbsp;<span class="string" id="1778803">&#34;copystack&#34;</span><span class="op" id="1778814">,</span><br>
<span class="lineno">575</span><span class="op" id="1778816">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1778819">var</span>&nbsp;<span class="ident" id="1778823">gScanStatusStrings</span>&nbsp;<span class="op" id="1778842">=</span>&nbsp;<span class="op" id="1778844">[</span><span class="op" id="1778845">...</span><span class="op" id="1778848">]</span><span class="builtintype" id="1778849">string</span><span class="op" id="1778855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="1778858">0</span><span class="op" id="1778859">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1778870">&#34;scan&#34;</span><span class="op" id="1778876">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1778879">_Grunnable</span><span class="op" id="1778889">:</span>&nbsp;<span class="string" id="1778891">&#34;scanrunnable&#34;</span><span class="op" id="1778905">,</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1778908">_Grunning</span><span class="op" id="1778917">:</span>&nbsp;&nbsp;<span class="string" id="1778920">&#34;scanrunning&#34;</span><span class="op" id="1778933">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1778936">_Gsyscall</span><span class="op" id="1778945">:</span>&nbsp;&nbsp;<span class="string" id="1778948">&#34;scansyscall&#34;</span><span class="op" id="1778961">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1778964">_Gwaiting</span><span class="op" id="1778973">:</span>&nbsp;&nbsp;<span class="string" id="1778976">&#34;scanwaiting&#34;</span><span class="op" id="1778989">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1778992">_Gdead</span><span class="op" id="1778998">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1779004">&#34;scandead&#34;</span><span class="op" id="1779014">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1779017">_Genqueue</span><span class="op" id="1779026">:</span>&nbsp;&nbsp;<span class="string" id="1779029">&#34;scanenqueue&#34;</span><span class="op" id="1779042">,</span><br>
<span class="lineno">585</span><span class="op" id="1779044">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1779047">func</span>&nbsp;<span class="ident" id="1779052">goroutineheader</span><span class="op" id="1779067">(</span><span class="ident" id="1779068">gp</span>&nbsp;<span class="op" id="1779071">*</span><span class="ident" id="1779072">g</span><span class="op" id="1779073">)</span>&nbsp;<span class="op" id="1779075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1779078">gpstatus</span>&nbsp;<span class="op" id="1779087">:=</span>&nbsp;<span class="ident" id="1779090">readgstatus</span><span class="op" id="1779101">(</span><span class="ident" id="1779102">gp</span><span class="op" id="1779104">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1779108">//&nbsp;Basic&nbsp;string&nbsp;status</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1779132">var</span>&nbsp;<span class="ident" id="1779136">status</span>&nbsp;<span class="builtintype" id="1779143">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1779151">if</span>&nbsp;<span class="num" id="1779154">0</span>&nbsp;<span class="op" id="1779156">&lt;=</span>&nbsp;<span class="ident" id="1779159">gpstatus</span>&nbsp;<span class="op" id="1779168">&amp;&amp;</span>&nbsp;<span class="ident" id="1779171">gpstatus</span>&nbsp;<span class="op" id="1779180">&lt;</span>&nbsp;<span class="builtintype" id="1779182">uint32</span><span class="op" id="1779188">(</span><span class="builtinfunc" id="1779189">len</span><span class="op" id="1779192">(</span><span class="ident" id="1779193">gStatusStrings</span><span class="op" id="1779207">)</span><span class="op" id="1779208">)</span>&nbsp;<span class="op" id="1779210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1779214">status</span>&nbsp;<span class="op" id="1779221">=</span>&nbsp;<span class="ident" id="1779223">gStatusStrings</span><span class="op" id="1779237">[</span><span class="ident" id="1779238">gpstatus</span><span class="op" id="1779246">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1779249">}</span>&nbsp;<span class="keyword" id="1779251">else</span>&nbsp;<span class="keyword" id="1779256">if</span>&nbsp;<span class="ident" id="1779259">gpstatus</span><span class="op" id="1779267">&amp;</span><span class="ident" id="1779268">_Gscan</span>&nbsp;<span class="op" id="1779275">!=</span>&nbsp;<span class="num" id="1779278">0</span>&nbsp;<span class="op" id="1779280">&amp;&amp;</span>&nbsp;<span class="num" id="1779283">0</span>&nbsp;<span class="op" id="1779285">&lt;=</span>&nbsp;<span class="ident" id="1779288">gpstatus</span><span class="op" id="1779296">&amp;^</span><span class="ident" id="1779298">_Gscan</span>&nbsp;<span class="op" id="1779305">&amp;&amp;</span>&nbsp;<span class="ident" id="1779308">gpstatus</span><span class="op" id="1779316">&amp;^</span><span class="ident" id="1779318">_Gscan</span>&nbsp;<span class="op" id="1779325">&lt;</span>&nbsp;<span class="builtintype" id="1779327">uint32</span><span class="op" id="1779333">(</span><span class="builtinfunc" id="1779334">len</span><span class="op" id="1779337">(</span><span class="ident" id="1779338">gStatusStrings</span><span class="op" id="1779352">)</span><span class="op" id="1779353">)</span>&nbsp;<span class="op" id="1779355">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1779359">status</span>&nbsp;<span class="op" id="1779366">=</span>&nbsp;<span class="ident" id="1779368">gStatusStrings</span><span class="op" id="1779382">[</span><span class="ident" id="1779383">gpstatus</span><span class="op" id="1779391">&amp;^</span><span class="ident" id="1779393">_Gscan</span><span class="op" id="1779399">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1779402">}</span>&nbsp;<span class="keyword" id="1779404">else</span>&nbsp;<span class="op" id="1779409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1779413">status</span>&nbsp;<span class="op" id="1779420">=</span>&nbsp;<span class="string" id="1779422">&#34;???&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1779429">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1779433">//&nbsp;Override.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1779447">if</span>&nbsp;<span class="op" id="1779450">(</span><span class="ident" id="1779451">gpstatus</span>&nbsp;<span class="op" id="1779460">==</span>&nbsp;<span class="ident" id="1779463">_Gwaiting</span>&nbsp;<span class="op" id="1779473">||</span>&nbsp;<span class="ident" id="1779476">gpstatus</span>&nbsp;<span class="op" id="1779485">==</span>&nbsp;<span class="ident" id="1779488">_Gscanwaiting</span><span class="op" id="1779501">)</span>&nbsp;<span class="op" id="1779503">&amp;&amp;</span>&nbsp;<span class="ident" id="1779506">gp</span><span class="op" id="1779508">.</span><span class="ident" id="1779509">waitreason</span>&nbsp;<span class="op" id="1779520">!=</span>&nbsp;<span class="string" id="1779523">&#34;&#34;</span>&nbsp;<span class="op" id="1779526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1779530">status</span>&nbsp;<span class="op" id="1779537">=</span>&nbsp;<span class="ident" id="1779539">gp</span><span class="op" id="1779541">.</span><span class="ident" id="1779542">waitreason</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1779554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1779558">//&nbsp;approx&nbsp;time&nbsp;the&nbsp;G&nbsp;is&nbsp;blocked,&nbsp;in&nbsp;minutes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1779603">var</span>&nbsp;<span class="ident" id="1779607">waitfor</span>&nbsp;<span class="ident" id="1779615">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1779622">gpstatus</span>&nbsp;<span class="op" id="1779631">&amp;^=</span>&nbsp;<span class="ident" id="1779635">_Gscan</span>&nbsp;<span class="comment" id="1779642">//&nbsp;drop&nbsp;the&nbsp;scan&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1779664">if</span>&nbsp;<span class="op" id="1779667">(</span><span class="ident" id="1779668">gpstatus</span>&nbsp;<span class="op" id="1779677">==</span>&nbsp;<span class="ident" id="1779680">_Gwaiting</span>&nbsp;<span class="op" id="1779690">||</span>&nbsp;<span class="ident" id="1779693">gpstatus</span>&nbsp;<span class="op" id="1779702">==</span>&nbsp;<span class="ident" id="1779705">_Gsyscall</span><span class="op" id="1779714">)</span>&nbsp;<span class="op" id="1779716">&amp;&amp;</span>&nbsp;<span class="ident" id="1779719">gp</span><span class="op" id="1779721">.</span><span class="ident" id="1779722">waitsince</span>&nbsp;<span class="op" id="1779732">!=</span>&nbsp;<span class="num" id="1779735">0</span>&nbsp;<span class="op" id="1779737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1779741">waitfor</span>&nbsp;<span class="op" id="1779749">=</span>&nbsp;<span class="op" id="1779751">(</span><span class="ident" id="1779752">nanotime</span><span class="op" id="1779760">(</span><span class="op" id="1779761">)</span>&nbsp;<span class="op" id="1779763">-</span>&nbsp;<span class="ident" id="1779765">gp</span><span class="op" id="1779767">.</span><span class="ident" id="1779768">waitsince</span><span class="op" id="1779777">)</span>&nbsp;<span class="op" id="1779779">/</span>&nbsp;<span class="num" id="1779781">60e9</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1779787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1779790">print</span><span class="op" id="1779795">(</span><span class="string" id="1779796">&#34;goroutine&nbsp;&#34;</span><span class="op" id="1779808">,</span>&nbsp;<span class="ident" id="1779810">gp</span><span class="op" id="1779812">.</span><span class="ident" id="1779813">goid</span><span class="op" id="1779817">,</span>&nbsp;<span class="string" id="1779819">&#34;&nbsp;[&#34;</span><span class="op" id="1779823">,</span>&nbsp;<span class="ident" id="1779825">status</span><span class="op" id="1779831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1779834">if</span>&nbsp;<span class="ident" id="1779837">waitfor</span>&nbsp;<span class="op" id="1779845">&gt;=</span>&nbsp;<span class="num" id="1779848">1</span>&nbsp;<span class="op" id="1779850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1779854">print</span><span class="op" id="1779859">(</span><span class="string" id="1779860">&#34;,&nbsp;&#34;</span><span class="op" id="1779864">,</span>&nbsp;<span class="ident" id="1779866">waitfor</span><span class="op" id="1779873">,</span>&nbsp;<span class="string" id="1779875">&#34;&nbsp;minutes&#34;</span><span class="op" id="1779885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1779888">}</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1779891">if</span>&nbsp;<span class="ident" id="1779894">gp</span><span class="op" id="1779896">.</span><span class="ident" id="1779897">lockedm</span>&nbsp;<span class="op" id="1779905">!=</span>&nbsp;<span class="ident" id="1779908">nil</span>&nbsp;<span class="op" id="1779912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1779916">print</span><span class="op" id="1779921">(</span><span class="string" id="1779922">&#34;,&nbsp;locked&nbsp;to&nbsp;thread&#34;</span><span class="op" id="1779942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1779945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1779948">print</span><span class="op" id="1779953">(</span><span class="string" id="1779954">&#34;]:\n&#34;</span><span class="op" id="1779960">)</span><br>
<span class="lineno"></span><span class="op" id="1779962">}</span><br>
<span class="lineno">620</span><br>
<span class="lineno"></span><span class="keyword" id="1779965">func</span>&nbsp;<span class="ident" id="1779970">tracebackothers</span><span class="op" id="1779985">(</span><span class="ident" id="1779986">me</span>&nbsp;<span class="op" id="1779989">*</span><span class="ident" id="1779990">g</span><span class="op" id="1779991">)</span>&nbsp;<span class="op" id="1779993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1779996">level</span>&nbsp;<span class="op" id="1780002">:=</span>&nbsp;<span class="ident" id="1780005">gotraceback</span><span class="op" id="1780016">(</span><span class="ident" id="1780017">nil</span><span class="op" id="1780020">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1780024">//&nbsp;Show&nbsp;the&nbsp;current&nbsp;goroutine&nbsp;first,&nbsp;if&nbsp;we&nbsp;haven&#39;t&nbsp;already.</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1780085">g</span>&nbsp;<span class="op" id="1780087">:=</span>&nbsp;<span class="ident" id="1780090">getg</span><span class="op" id="1780094">(</span><span class="op" id="1780095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1780098">gp</span>&nbsp;<span class="op" id="1780101">:=</span>&nbsp;<span class="ident" id="1780104">g</span><span class="op" id="1780105">.</span><span class="ident" id="1780106">m</span><span class="op" id="1780107">.</span><span class="ident" id="1780108">curg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1780114">if</span>&nbsp;<span class="ident" id="1780117">gp</span>&nbsp;<span class="op" id="1780120">!=</span>&nbsp;<span class="ident" id="1780123">nil</span>&nbsp;<span class="op" id="1780127">&amp;&amp;</span>&nbsp;<span class="ident" id="1780130">gp</span>&nbsp;<span class="op" id="1780133">!=</span>&nbsp;<span class="ident" id="1780136">me</span>&nbsp;<span class="op" id="1780139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1780143">print</span><span class="op" id="1780148">(</span><span class="string" id="1780149">&#34;\n&#34;</span><span class="op" id="1780153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1780157">goroutineheader</span><span class="op" id="1780172">(</span><span class="ident" id="1780173">gp</span><span class="op" id="1780175">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1780179">traceback</span><span class="op" id="1780188">(</span><span class="op" id="1780189">^</span><span class="builtintype" id="1780190">uintptr</span><span class="op" id="1780197">(</span><span class="num" id="1780198">0</span><span class="op" id="1780199">)</span><span class="op" id="1780200">,</span>&nbsp;<span class="op" id="1780202">^</span><span class="builtintype" id="1780203">uintptr</span><span class="op" id="1780210">(</span><span class="num" id="1780211">0</span><span class="op" id="1780212">)</span><span class="op" id="1780213">,</span>&nbsp;<span class="num" id="1780215">0</span><span class="op" id="1780216">,</span>&nbsp;<span class="ident" id="1780218">gp</span><span class="op" id="1780220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1780223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1780227">lock</span><span class="op" id="1780231">(</span><span class="op" id="1780232">&amp;</span><span class="ident" id="1780233">allglock</span><span class="op" id="1780241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1780244">for</span>&nbsp;<span class="ident" id="1780248">_</span><span class="op" id="1780249">,</span>&nbsp;<span class="ident" id="1780251">gp</span>&nbsp;<span class="op" id="1780254">:=</span>&nbsp;<span class="keyword" id="1780257">range</span>&nbsp;<span class="ident" id="1780263">allgs</span>&nbsp;<span class="op" id="1780269">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1780273">if</span>&nbsp;<span class="ident" id="1780276">gp</span>&nbsp;<span class="op" id="1780279">==</span>&nbsp;<span class="ident" id="1780282">me</span>&nbsp;<span class="op" id="1780285">||</span>&nbsp;<span class="ident" id="1780288">gp</span>&nbsp;<span class="op" id="1780291">==</span>&nbsp;<span class="ident" id="1780294">g</span><span class="op" id="1780295">.</span><span class="ident" id="1780296">m</span><span class="op" id="1780297">.</span><span class="ident" id="1780298">curg</span>&nbsp;<span class="op" id="1780303">||</span>&nbsp;<span class="ident" id="1780306">readgstatus</span><span class="op" id="1780317">(</span><span class="ident" id="1780318">gp</span><span class="op" id="1780320">)</span>&nbsp;<span class="op" id="1780322">==</span>&nbsp;<span class="ident" id="1780325">_Gdead</span>&nbsp;<span class="op" id="1780332">||</span>&nbsp;<span class="ident" id="1780335">gp</span><span class="op" id="1780337">.</span><span class="ident" id="1780338">issystem</span>&nbsp;<span class="op" id="1780347">&amp;&amp;</span>&nbsp;<span class="ident" id="1780350">level</span>&nbsp;<span class="op" id="1780356">&lt;</span>&nbsp;<span class="num" id="1780358">2</span>&nbsp;<span class="op" id="1780360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1780365">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1780376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1780380">print</span><span class="op" id="1780385">(</span><span class="string" id="1780386">&#34;\n&#34;</span><span class="op" id="1780390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1780394">goroutineheader</span><span class="op" id="1780409">(</span><span class="ident" id="1780410">gp</span><span class="op" id="1780412">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1780416">if</span>&nbsp;<span class="ident" id="1780419">readgstatus</span><span class="op" id="1780430">(</span><span class="ident" id="1780431">gp</span><span class="op" id="1780433">)</span><span class="op" id="1780434">&amp;^</span><span class="ident" id="1780436">_Gscan</span>&nbsp;<span class="op" id="1780443">==</span>&nbsp;<span class="ident" id="1780446">_Grunning</span>&nbsp;<span class="op" id="1780456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1780461">print</span><span class="op" id="1780466">(</span><span class="string" id="1780467">&#34;\tgoroutine&nbsp;running&nbsp;on&nbsp;other&nbsp;thread;&nbsp;stack&nbsp;unavailable\n&#34;</span><span class="op" id="1780525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1780530">printcreatedby</span><span class="op" id="1780544">(</span><span class="ident" id="1780545">gp</span><span class="op" id="1780547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1780551">}</span>&nbsp;<span class="keyword" id="1780553">else</span>&nbsp;<span class="op" id="1780558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1780563">traceback</span><span class="op" id="1780572">(</span><span class="op" id="1780573">^</span><span class="builtintype" id="1780574">uintptr</span><span class="op" id="1780581">(</span><span class="num" id="1780582">0</span><span class="op" id="1780583">)</span><span class="op" id="1780584">,</span>&nbsp;<span class="op" id="1780586">^</span><span class="builtintype" id="1780587">uintptr</span><span class="op" id="1780594">(</span><span class="num" id="1780595">0</span><span class="op" id="1780596">)</span><span class="op" id="1780597">,</span>&nbsp;<span class="num" id="1780599">0</span><span class="op" id="1780600">,</span>&nbsp;<span class="ident" id="1780602">gp</span><span class="op" id="1780604">)</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1780608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1780611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1780614">unlock</span><span class="op" id="1780620">(</span><span class="op" id="1780621">&amp;</span><span class="ident" id="1780622">allglock</span><span class="op" id="1780630">)</span><br>
<span class="lineno"></span><span class="op" id="1780632">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">650</span><span class="comment" id="1780635">//&nbsp;Does&nbsp;f&nbsp;mark&nbsp;the&nbsp;top&nbsp;of&nbsp;a&nbsp;goroutine&nbsp;stack?</span><br>
<span class="lineno"></span><span class="keyword" id="1780680">func</span>&nbsp;<span class="ident" id="1780685">topofstack</span><span class="op" id="1780695">(</span><span class="ident" id="1780696">f</span>&nbsp;<span class="op" id="1780698">*</span><span class="ident" id="1780699">_func</span><span class="op" id="1780704">)</span>&nbsp;<span class="builtintype" id="1780706">bool</span>&nbsp;<span class="op" id="1780711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1780714">pc</span>&nbsp;<span class="op" id="1780717">:=</span>&nbsp;<span class="ident" id="1780720">f</span><span class="op" id="1780721">.</span><span class="ident" id="1780722">entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1780729">return</span>&nbsp;<span class="ident" id="1780736">pc</span>&nbsp;<span class="op" id="1780739">==</span>&nbsp;<span class="ident" id="1780742">goexitPC</span>&nbsp;<span class="op" id="1780751">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1780756">pc</span>&nbsp;<span class="op" id="1780759">==</span>&nbsp;<span class="ident" id="1780762">mstartPC</span>&nbsp;<span class="op" id="1780771">||</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1780776">pc</span>&nbsp;<span class="op" id="1780779">==</span>&nbsp;<span class="ident" id="1780782">mcallPC</span>&nbsp;<span class="op" id="1780790">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1780795">pc</span>&nbsp;<span class="op" id="1780798">==</span>&nbsp;<span class="ident" id="1780801">morestackPC</span>&nbsp;<span class="op" id="1780813">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1780818">pc</span>&nbsp;<span class="op" id="1780821">==</span>&nbsp;<span class="ident" id="1780824">rt0_goPC</span>&nbsp;<span class="op" id="1780833">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1780838">externalthreadhandlerp</span>&nbsp;<span class="op" id="1780861">!=</span>&nbsp;<span class="num" id="1780864">0</span>&nbsp;<span class="op" id="1780866">&amp;&amp;</span>&nbsp;<span class="ident" id="1780869">pc</span>&nbsp;<span class="op" id="1780872">==</span>&nbsp;<span class="ident" id="1780875">externalthreadhandlerp</span><br>
<span class="lineno"></span><span class="op" id="1780898">}</span>
</div>
</body>
</html>
