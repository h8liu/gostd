<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/printer</h2>
<ul>
<li><a href="/gostd/go/printer/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/printer/nodes.go.html">nodes.go</a></li>
<li><a href="/gostd/go/printer/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/printer/printer.go.html">printer.go</a></li>
<li><a href="/gostd/go/printer/printer_test.go.html">printer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7608707">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7608762">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7608816">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7608867">package</span>&nbsp;<span class="ident" id="7608875">printer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7608884">import</span>&nbsp;<span class="op" id="7608891">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7608894">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7608903">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7608913">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7608921">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7608928">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7608938">&#34;go/parser&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7608951">&#34;go/token&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7608963">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7608976">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7608993">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7609004">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7609011">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="7609014">const</span>&nbsp;<span class="op" id="7609020">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7609023">dataDir</span>&nbsp;&nbsp;<span class="op" id="7609032">=</span>&nbsp;<span class="string" id="7609034">&#34;testdata&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7609046">tabwidth</span>&nbsp;<span class="op" id="7609055">=</span>&nbsp;<span class="num" id="7609057">8</span><br>
<span class="lineno"></span><span class="op" id="7609059">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="7609062">var</span>&nbsp;<span class="ident" id="7609066">update</span>&nbsp;<span class="op" id="7609073">=</span>&nbsp;<span class="ident" id="7609075">flag</span><span class="op" id="7609079">.</span><span class="ident" id="7609080">Bool</span><span class="op" id="7609084">(</span><span class="string" id="7609085">&#34;update&#34;</span><span class="op" id="7609093">,</span>&nbsp;<span class="builtintype" id="7609095">false</span><span class="op" id="7609100">,</span>&nbsp;<span class="string" id="7609102">&#34;update&nbsp;golden&nbsp;files&#34;</span><span class="op" id="7609123">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7609126">var</span>&nbsp;<span class="ident" id="7609130">fset</span>&nbsp;<span class="op" id="7609135">=</span>&nbsp;<span class="ident" id="7609137">token</span><span class="op" id="7609142">.</span><span class="ident" id="7609143">NewFileSet</span><span class="op" id="7609153">(</span><span class="op" id="7609154">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="7609157">type</span>&nbsp;<span class="ident" id="7609162">checkMode</span>&nbsp;<span class="builtintype" id="7609172">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7609178">const</span>&nbsp;<span class="op" id="7609184">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7609187">export</span>&nbsp;<span class="ident" id="7609194">checkMode</span>&nbsp;<span class="op" id="7609204">=</span>&nbsp;<span class="num" id="7609206">1</span>&nbsp;<span class="op" id="7609208">&lt;&lt;</span>&nbsp;<span class="ident" id="7609211">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7609217">rawFormat</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7609228">idempotent</span><br>
<span class="lineno"></span><span class="op" id="7609239">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7609242">//&nbsp;format&nbsp;parses&nbsp;src,&nbsp;prints&nbsp;the&nbsp;corresponding&nbsp;AST,&nbsp;verifies&nbsp;the&nbsp;resulting</span><br>
<span class="lineno"></span><span class="comment" id="7609317">//&nbsp;src&nbsp;is&nbsp;syntactically&nbsp;correct,&nbsp;and&nbsp;returns&nbsp;the&nbsp;resulting&nbsp;src&nbsp;or&nbsp;an&nbsp;error</span><br>
<span class="lineno">40</span><span class="comment" id="7609392">//&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="7609403">func</span>&nbsp;<span class="ident" id="7609408">format</span><span class="op" id="7609414">(</span><span class="ident" id="7609415">src</span>&nbsp;<span class="op" id="7609419">[</span><span class="op" id="7609420">]</span><span class="builtintype" id="7609421">byte</span><span class="op" id="7609425">,</span>&nbsp;<span class="ident" id="7609427">mode</span>&nbsp;<span class="ident" id="7609432">checkMode</span><span class="op" id="7609441">)</span>&nbsp;<span class="op" id="7609443">(</span><span class="op" id="7609444">[</span><span class="op" id="7609445">]</span><span class="builtintype" id="7609446">byte</span><span class="op" id="7609450">,</span>&nbsp;<span class="builtintype" id="7609452">error</span><span class="op" id="7609457">)</span>&nbsp;<span class="op" id="7609459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7609462">//&nbsp;parse&nbsp;src</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7609476">f</span><span class="op" id="7609477">,</span>&nbsp;<span class="ident" id="7609479">err</span>&nbsp;<span class="op" id="7609483">:=</span>&nbsp;<span class="ident" id="7609486">parser</span><span class="op" id="7609492">.</span><span class="ident" id="7609493">ParseFile</span><span class="op" id="7609502">(</span><span class="ident" id="7609503">fset</span><span class="op" id="7609507">,</span>&nbsp;<span class="string" id="7609509">&#34;&#34;</span><span class="op" id="7609511">,</span>&nbsp;<span class="ident" id="7609513">src</span><span class="op" id="7609516">,</span>&nbsp;<span class="ident" id="7609518">parser</span><span class="op" id="7609524">.</span><span class="ident" id="7609525">ParseComments</span><span class="op" id="7609538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7609541">if</span>&nbsp;<span class="ident" id="7609544">err</span>&nbsp;<span class="op" id="7609548">!=</span>&nbsp;<span class="ident" id="7609551">nil</span>&nbsp;<span class="op" id="7609555">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7609559">return</span>&nbsp;<span class="ident" id="7609566">nil</span><span class="op" id="7609569">,</span>&nbsp;<span class="ident" id="7609571">fmt</span><span class="op" id="7609574">.</span><span class="ident" id="7609575">Errorf</span><span class="op" id="7609581">(</span><span class="string" id="7609582">&#34;parse:&nbsp;%s\n%s&#34;</span><span class="op" id="7609597">,</span>&nbsp;<span class="ident" id="7609599">err</span><span class="op" id="7609602">,</span>&nbsp;<span class="ident" id="7609604">src</span><span class="op" id="7609607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7609610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7609614">//&nbsp;filter&nbsp;exports&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7609646">if</span>&nbsp;<span class="ident" id="7609649">mode</span><span class="op" id="7609653">&amp;</span><span class="ident" id="7609654">export</span>&nbsp;<span class="op" id="7609661">!=</span>&nbsp;<span class="num" id="7609664">0</span>&nbsp;<span class="op" id="7609666">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7609670">ast</span><span class="op" id="7609673">.</span><span class="ident" id="7609674">FileExports</span><span class="op" id="7609685">(</span><span class="ident" id="7609686">f</span><span class="op" id="7609687">)</span>&nbsp;<span class="comment" id="7609689">//&nbsp;ignore&nbsp;result</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7609708">f</span><span class="op" id="7609709">.</span><span class="ident" id="7609710">Comments</span>&nbsp;<span class="op" id="7609719">=</span>&nbsp;<span class="ident" id="7609721">nil</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="7609727">//&nbsp;don&#39;t&nbsp;print&nbsp;comments&nbsp;that&nbsp;are&nbsp;not&nbsp;in&nbsp;AST</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7609772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7609776">//&nbsp;determine&nbsp;printer&nbsp;configuration</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7609812">cfg</span>&nbsp;<span class="op" id="7609816">:=</span>&nbsp;<span class="ident" id="7609819">Config</span><span class="op" id="7609825">{</span><span class="ident" id="7609826">Tabwidth</span><span class="op" id="7609834">:</span>&nbsp;<span class="ident" id="7609836">tabwidth</span><span class="op" id="7609844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7609847">if</span>&nbsp;<span class="ident" id="7609850">mode</span><span class="op" id="7609854">&amp;</span><span class="ident" id="7609855">rawFormat</span>&nbsp;<span class="op" id="7609865">!=</span>&nbsp;<span class="num" id="7609868">0</span>&nbsp;<span class="op" id="7609870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7609874">cfg</span><span class="op" id="7609877">.</span><span class="ident" id="7609878">Mode</span>&nbsp;<span class="op" id="7609883">|=</span>&nbsp;<span class="ident" id="7609886">RawFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7609897">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7609901">//&nbsp;print&nbsp;AST</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7609915">var</span>&nbsp;<span class="ident" id="7609919">buf</span>&nbsp;<span class="ident" id="7609923">bytes</span><span class="op" id="7609928">.</span><span class="ident" id="7609929">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7609937">if</span>&nbsp;<span class="ident" id="7609940">err</span>&nbsp;<span class="op" id="7609944">:=</span>&nbsp;<span class="ident" id="7609947">cfg</span><span class="op" id="7609950">.</span><span class="ident" id="7609951">Fprint</span><span class="op" id="7609957">(</span><span class="op" id="7609958">&amp;</span><span class="ident" id="7609959">buf</span><span class="op" id="7609962">,</span>&nbsp;<span class="ident" id="7609964">fset</span><span class="op" id="7609968">,</span>&nbsp;<span class="ident" id="7609970">f</span><span class="op" id="7609971">)</span><span class="op" id="7609972">;</span>&nbsp;<span class="ident" id="7609974">err</span>&nbsp;<span class="op" id="7609978">!=</span>&nbsp;<span class="ident" id="7609981">nil</span>&nbsp;<span class="op" id="7609985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7609989">return</span>&nbsp;<span class="ident" id="7609996">nil</span><span class="op" id="7609999">,</span>&nbsp;<span class="ident" id="7610001">fmt</span><span class="op" id="7610004">.</span><span class="ident" id="7610005">Errorf</span><span class="op" id="7610011">(</span><span class="string" id="7610012">&#34;print:&nbsp;%s&#34;</span><span class="op" id="7610023">,</span>&nbsp;<span class="ident" id="7610025">err</span><span class="op" id="7610028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7610031">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7610035">//&nbsp;make&nbsp;sure&nbsp;formatted&nbsp;output&nbsp;is&nbsp;syntactically&nbsp;correct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7610091">res</span>&nbsp;<span class="op" id="7610095">:=</span>&nbsp;<span class="ident" id="7610098">buf</span><span class="op" id="7610101">.</span><span class="ident" id="7610102">Bytes</span><span class="op" id="7610107">(</span><span class="op" id="7610108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7610111">if</span>&nbsp;<span class="ident" id="7610114">_</span><span class="op" id="7610115">,</span>&nbsp;<span class="ident" id="7610117">err</span>&nbsp;<span class="op" id="7610121">:=</span>&nbsp;<span class="ident" id="7610124">parser</span><span class="op" id="7610130">.</span><span class="ident" id="7610131">ParseFile</span><span class="op" id="7610140">(</span><span class="ident" id="7610141">fset</span><span class="op" id="7610145">,</span>&nbsp;<span class="string" id="7610147">&#34;&#34;</span><span class="op" id="7610149">,</span>&nbsp;<span class="ident" id="7610151">res</span><span class="op" id="7610154">,</span>&nbsp;<span class="num" id="7610156">0</span><span class="op" id="7610157">)</span><span class="op" id="7610158">;</span>&nbsp;<span class="ident" id="7610160">err</span>&nbsp;<span class="op" id="7610164">!=</span>&nbsp;<span class="ident" id="7610167">nil</span>&nbsp;<span class="op" id="7610171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7610175">return</span>&nbsp;<span class="ident" id="7610182">nil</span><span class="op" id="7610185">,</span>&nbsp;<span class="ident" id="7610187">fmt</span><span class="op" id="7610190">.</span><span class="ident" id="7610191">Errorf</span><span class="op" id="7610197">(</span><span class="string" id="7610198">&#34;re-parse:&nbsp;%s\n%s&#34;</span><span class="op" id="7610216">,</span>&nbsp;<span class="ident" id="7610218">err</span><span class="op" id="7610221">,</span>&nbsp;<span class="ident" id="7610223">buf</span><span class="op" id="7610226">.</span><span class="ident" id="7610227">Bytes</span><span class="op" id="7610232">(</span><span class="op" id="7610233">)</span><span class="op" id="7610234">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7610237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7610241">return</span>&nbsp;<span class="ident" id="7610248">res</span><span class="op" id="7610251">,</span>&nbsp;<span class="ident" id="7610253">nil</span><br>
<span class="lineno"></span><span class="op" id="7610257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="7610260">//&nbsp;lineAt&nbsp;returns&nbsp;the&nbsp;line&nbsp;in&nbsp;text&nbsp;starting&nbsp;at&nbsp;offset&nbsp;offs.</span><br>
<span class="lineno"></span><span class="keyword" id="7610320">func</span>&nbsp;<span class="ident" id="7610325">lineAt</span><span class="op" id="7610331">(</span><span class="ident" id="7610332">text</span>&nbsp;<span class="op" id="7610337">[</span><span class="op" id="7610338">]</span><span class="builtintype" id="7610339">byte</span><span class="op" id="7610343">,</span>&nbsp;<span class="ident" id="7610345">offs</span>&nbsp;<span class="builtintype" id="7610350">int</span><span class="op" id="7610353">)</span>&nbsp;<span class="op" id="7610355">[</span><span class="op" id="7610356">]</span><span class="builtintype" id="7610357">byte</span>&nbsp;<span class="op" id="7610362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7610365">i</span>&nbsp;<span class="op" id="7610367">:=</span>&nbsp;<span class="ident" id="7610370">offs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7610376">for</span>&nbsp;<span class="ident" id="7610380">i</span>&nbsp;<span class="op" id="7610382">&lt;</span>&nbsp;<span class="builtinfunc" id="7610384">len</span><span class="op" id="7610387">(</span><span class="ident" id="7610388">text</span><span class="op" id="7610392">)</span>&nbsp;<span class="op" id="7610394">&amp;&amp;</span>&nbsp;<span class="ident" id="7610397">text</span><span class="op" id="7610401">[</span><span class="ident" id="7610402">i</span><span class="op" id="7610403">]</span>&nbsp;<span class="op" id="7610405">!=</span>&nbsp;<span class="string" id="7610408">&#39;\n&#39;</span>&nbsp;<span class="op" id="7610413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7610417">i</span><span class="op" id="7610418">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7610422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7610425">return</span>&nbsp;<span class="ident" id="7610432">text</span><span class="op" id="7610436">[</span><span class="ident" id="7610437">offs</span><span class="op" id="7610441">:</span><span class="ident" id="7610442">i</span><span class="op" id="7610443">]</span><br>
<span class="lineno"></span><span class="op" id="7610445">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7610448">//&nbsp;diff&nbsp;compares&nbsp;a&nbsp;and&nbsp;b.</span><br>
<span class="lineno">85</span><span class="keyword" id="7610474">func</span>&nbsp;<span class="ident" id="7610479">diff</span><span class="op" id="7610483">(</span><span class="ident" id="7610484">aname</span><span class="op" id="7610489">,</span>&nbsp;<span class="ident" id="7610491">bname</span>&nbsp;<span class="builtintype" id="7610497">string</span><span class="op" id="7610503">,</span>&nbsp;<span class="ident" id="7610505">a</span><span class="op" id="7610506">,</span>&nbsp;<span class="ident" id="7610508">b</span>&nbsp;<span class="op" id="7610510">[</span><span class="op" id="7610511">]</span><span class="builtintype" id="7610512">byte</span><span class="op" id="7610516">)</span>&nbsp;<span class="builtintype" id="7610518">error</span>&nbsp;<span class="op" id="7610524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7610527">var</span>&nbsp;<span class="ident" id="7610531">buf</span>&nbsp;<span class="ident" id="7610535">bytes</span><span class="op" id="7610540">.</span><span class="ident" id="7610541">Buffer</span>&nbsp;<span class="comment" id="7610548">//&nbsp;holding&nbsp;long&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7610580">//&nbsp;compare&nbsp;lengths</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7610600">if</span>&nbsp;<span class="builtinfunc" id="7610603">len</span><span class="op" id="7610606">(</span><span class="ident" id="7610607">a</span><span class="op" id="7610608">)</span>&nbsp;<span class="op" id="7610610">!=</span>&nbsp;<span class="builtinfunc" id="7610613">len</span><span class="op" id="7610616">(</span><span class="ident" id="7610617">b</span><span class="op" id="7610618">)</span>&nbsp;<span class="op" id="7610620">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7610624">fmt</span><span class="op" id="7610627">.</span><span class="ident" id="7610628">Fprintf</span><span class="op" id="7610635">(</span><span class="op" id="7610636">&amp;</span><span class="ident" id="7610637">buf</span><span class="op" id="7610640">,</span>&nbsp;<span class="string" id="7610642">&#34;\nlength&nbsp;changed:&nbsp;len(%s)&nbsp;=&nbsp;%d,&nbsp;len(%s)&nbsp;=&nbsp;%d&#34;</span><span class="op" id="7610688">,</span>&nbsp;<span class="ident" id="7610690">aname</span><span class="op" id="7610695">,</span>&nbsp;<span class="builtinfunc" id="7610697">len</span><span class="op" id="7610700">(</span><span class="ident" id="7610701">a</span><span class="op" id="7610702">)</span><span class="op" id="7610703">,</span>&nbsp;<span class="ident" id="7610705">bname</span><span class="op" id="7610710">,</span>&nbsp;<span class="builtinfunc" id="7610712">len</span><span class="op" id="7610715">(</span><span class="ident" id="7610716">b</span><span class="op" id="7610717">)</span><span class="op" id="7610718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7610721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7610725">//&nbsp;compare&nbsp;contents</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7610746">line</span>&nbsp;<span class="op" id="7610751">:=</span>&nbsp;<span class="num" id="7610754">1</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7610757">offs</span>&nbsp;<span class="op" id="7610762">:=</span>&nbsp;<span class="num" id="7610765">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7610768">for</span>&nbsp;<span class="ident" id="7610772">i</span>&nbsp;<span class="op" id="7610774">:=</span>&nbsp;<span class="num" id="7610777">0</span><span class="op" id="7610778">;</span>&nbsp;<span class="ident" id="7610780">i</span>&nbsp;<span class="op" id="7610782">&lt;</span>&nbsp;<span class="builtinfunc" id="7610784">len</span><span class="op" id="7610787">(</span><span class="ident" id="7610788">a</span><span class="op" id="7610789">)</span>&nbsp;<span class="op" id="7610791">&amp;&amp;</span>&nbsp;<span class="ident" id="7610794">i</span>&nbsp;<span class="op" id="7610796">&lt;</span>&nbsp;<span class="builtinfunc" id="7610798">len</span><span class="op" id="7610801">(</span><span class="ident" id="7610802">b</span><span class="op" id="7610803">)</span><span class="op" id="7610804">;</span>&nbsp;<span class="ident" id="7610806">i</span><span class="op" id="7610807">++</span>&nbsp;<span class="op" id="7610810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7610814">ch</span>&nbsp;<span class="op" id="7610817">:=</span>&nbsp;<span class="ident" id="7610820">a</span><span class="op" id="7610821">[</span><span class="ident" id="7610822">i</span><span class="op" id="7610823">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7610827">if</span>&nbsp;<span class="ident" id="7610830">ch</span>&nbsp;<span class="op" id="7610833">!=</span>&nbsp;<span class="ident" id="7610836">b</span><span class="op" id="7610837">[</span><span class="ident" id="7610838">i</span><span class="op" id="7610839">]</span>&nbsp;<span class="op" id="7610841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7610846">fmt</span><span class="op" id="7610849">.</span><span class="ident" id="7610850">Fprintf</span><span class="op" id="7610857">(</span><span class="op" id="7610858">&amp;</span><span class="ident" id="7610859">buf</span><span class="op" id="7610862">,</span>&nbsp;<span class="string" id="7610864">&#34;\n%s:%d:%d:&nbsp;%s&#34;</span><span class="op" id="7610880">,</span>&nbsp;<span class="ident" id="7610882">aname</span><span class="op" id="7610887">,</span>&nbsp;<span class="ident" id="7610889">line</span><span class="op" id="7610893">,</span>&nbsp;<span class="ident" id="7610895">i</span><span class="op" id="7610896">-</span><span class="ident" id="7610897">offs</span><span class="op" id="7610901">+</span><span class="num" id="7610902">1</span><span class="op" id="7610903">,</span>&nbsp;<span class="ident" id="7610905">lineAt</span><span class="op" id="7610911">(</span><span class="ident" id="7610912">a</span><span class="op" id="7610913">,</span>&nbsp;<span class="ident" id="7610915">offs</span><span class="op" id="7610919">)</span><span class="op" id="7610920">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7610925">fmt</span><span class="op" id="7610928">.</span><span class="ident" id="7610929">Fprintf</span><span class="op" id="7610936">(</span><span class="op" id="7610937">&amp;</span><span class="ident" id="7610938">buf</span><span class="op" id="7610941">,</span>&nbsp;<span class="string" id="7610943">&#34;\n%s:%d:%d:&nbsp;%s&#34;</span><span class="op" id="7610959">,</span>&nbsp;<span class="ident" id="7610961">bname</span><span class="op" id="7610966">,</span>&nbsp;<span class="ident" id="7610968">line</span><span class="op" id="7610972">,</span>&nbsp;<span class="ident" id="7610974">i</span><span class="op" id="7610975">-</span><span class="ident" id="7610976">offs</span><span class="op" id="7610980">+</span><span class="num" id="7610981">1</span><span class="op" id="7610982">,</span>&nbsp;<span class="ident" id="7610984">lineAt</span><span class="op" id="7610990">(</span><span class="ident" id="7610991">b</span><span class="op" id="7610992">,</span>&nbsp;<span class="ident" id="7610994">offs</span><span class="op" id="7610998">)</span><span class="op" id="7610999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7611004">fmt</span><span class="op" id="7611007">.</span><span class="ident" id="7611008">Fprintf</span><span class="op" id="7611015">(</span><span class="op" id="7611016">&amp;</span><span class="ident" id="7611017">buf</span><span class="op" id="7611020">,</span>&nbsp;<span class="string" id="7611022">&#34;\n\n&#34;</span><span class="op" id="7611028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7611033">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7611041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7611045">if</span>&nbsp;<span class="ident" id="7611048">ch</span>&nbsp;<span class="op" id="7611051">==</span>&nbsp;<span class="string" id="7611054">&#39;\n&#39;</span>&nbsp;<span class="op" id="7611059">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7611064">line</span><span class="op" id="7611068">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7611074">offs</span>&nbsp;<span class="op" id="7611079">=</span>&nbsp;<span class="ident" id="7611081">i</span>&nbsp;<span class="op" id="7611083">+</span>&nbsp;<span class="num" id="7611085">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7611089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7611092">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7611096">if</span>&nbsp;<span class="ident" id="7611099">buf</span><span class="op" id="7611102">.</span><span class="ident" id="7611103">Len</span><span class="op" id="7611106">(</span><span class="op" id="7611107">)</span>&nbsp;<span class="op" id="7611109">&gt;</span>&nbsp;<span class="num" id="7611111">0</span>&nbsp;<span class="op" id="7611113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7611117">return</span>&nbsp;<span class="ident" id="7611124">errors</span><span class="op" id="7611130">.</span><span class="ident" id="7611131">New</span><span class="op" id="7611134">(</span><span class="ident" id="7611135">buf</span><span class="op" id="7611138">.</span><span class="ident" id="7611139">String</span><span class="op" id="7611145">(</span><span class="op" id="7611146">)</span><span class="op" id="7611147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7611150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7611153">return</span>&nbsp;<span class="ident" id="7611160">nil</span><br>
<span class="lineno"></span><span class="op" id="7611164">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="7611167">func</span>&nbsp;<span class="ident" id="7611172">runcheck</span><span class="op" id="7611180">(</span><span class="ident" id="7611181">t</span>&nbsp;<span class="op" id="7611183">*</span><span class="ident" id="7611184">testing</span><span class="op" id="7611191">.</span><span class="ident" id="7611192">T</span><span class="op" id="7611193">,</span>&nbsp;<span class="ident" id="7611195">source</span><span class="op" id="7611201">,</span>&nbsp;<span class="ident" id="7611203">golden</span>&nbsp;<span class="builtintype" id="7611210">string</span><span class="op" id="7611216">,</span>&nbsp;<span class="ident" id="7611218">mode</span>&nbsp;<span class="ident" id="7611223">checkMode</span><span class="op" id="7611232">)</span>&nbsp;<span class="op" id="7611234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7611237">src</span><span class="op" id="7611240">,</span>&nbsp;<span class="ident" id="7611242">err</span>&nbsp;<span class="op" id="7611246">:=</span>&nbsp;<span class="ident" id="7611249">ioutil</span><span class="op" id="7611255">.</span><span class="ident" id="7611256">ReadFile</span><span class="op" id="7611264">(</span><span class="ident" id="7611265">source</span><span class="op" id="7611271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7611274">if</span>&nbsp;<span class="ident" id="7611277">err</span>&nbsp;<span class="op" id="7611281">!=</span>&nbsp;<span class="ident" id="7611284">nil</span>&nbsp;<span class="op" id="7611288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7611292">t</span><span class="op" id="7611293">.</span><span class="ident" id="7611294">Error</span><span class="op" id="7611299">(</span><span class="ident" id="7611300">err</span><span class="op" id="7611303">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7611307">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7611315">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7611319">res</span><span class="op" id="7611322">,</span>&nbsp;<span class="ident" id="7611324">err</span>&nbsp;<span class="op" id="7611328">:=</span>&nbsp;<span class="ident" id="7611331">format</span><span class="op" id="7611337">(</span><span class="ident" id="7611338">src</span><span class="op" id="7611341">,</span>&nbsp;<span class="ident" id="7611343">mode</span><span class="op" id="7611347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7611350">if</span>&nbsp;<span class="ident" id="7611353">err</span>&nbsp;<span class="op" id="7611357">!=</span>&nbsp;<span class="ident" id="7611360">nil</span>&nbsp;<span class="op" id="7611364">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7611368">t</span><span class="op" id="7611369">.</span><span class="ident" id="7611370">Error</span><span class="op" id="7611375">(</span><span class="ident" id="7611376">err</span><span class="op" id="7611379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7611383">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7611391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7611395">//&nbsp;update&nbsp;golden&nbsp;files&nbsp;if&nbsp;necessary</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7611432">if</span>&nbsp;<span class="op" id="7611435">*</span><span class="ident" id="7611436">update</span>&nbsp;<span class="op" id="7611443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7611447">if</span>&nbsp;<span class="ident" id="7611450">err</span>&nbsp;<span class="op" id="7611454">:=</span>&nbsp;<span class="ident" id="7611457">ioutil</span><span class="op" id="7611463">.</span><span class="ident" id="7611464">WriteFile</span><span class="op" id="7611473">(</span><span class="ident" id="7611474">golden</span><span class="op" id="7611480">,</span>&nbsp;<span class="ident" id="7611482">res</span><span class="op" id="7611485">,</span>&nbsp;<span class="num" id="7611487">0644</span><span class="op" id="7611491">)</span><span class="op" id="7611492">;</span>&nbsp;<span class="ident" id="7611494">err</span>&nbsp;<span class="op" id="7611498">!=</span>&nbsp;<span class="ident" id="7611501">nil</span>&nbsp;<span class="op" id="7611505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7611510">t</span><span class="op" id="7611511">.</span><span class="ident" id="7611512">Error</span><span class="op" id="7611517">(</span><span class="ident" id="7611518">err</span><span class="op" id="7611521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7611525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7611529">return</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7611537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7611541">//&nbsp;get&nbsp;golden</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7611556">gld</span><span class="op" id="7611559">,</span>&nbsp;<span class="ident" id="7611561">err</span>&nbsp;<span class="op" id="7611565">:=</span>&nbsp;<span class="ident" id="7611568">ioutil</span><span class="op" id="7611574">.</span><span class="ident" id="7611575">ReadFile</span><span class="op" id="7611583">(</span><span class="ident" id="7611584">golden</span><span class="op" id="7611590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7611593">if</span>&nbsp;<span class="ident" id="7611596">err</span>&nbsp;<span class="op" id="7611600">!=</span>&nbsp;<span class="ident" id="7611603">nil</span>&nbsp;<span class="op" id="7611607">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7611611">t</span><span class="op" id="7611612">.</span><span class="ident" id="7611613">Error</span><span class="op" id="7611618">(</span><span class="ident" id="7611619">err</span><span class="op" id="7611622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7611626">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7611634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7611638">//&nbsp;formatted&nbsp;source&nbsp;and&nbsp;golden&nbsp;must&nbsp;be&nbsp;the&nbsp;same</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7611687">if</span>&nbsp;<span class="ident" id="7611690">err</span>&nbsp;<span class="op" id="7611694">:=</span>&nbsp;<span class="ident" id="7611697">diff</span><span class="op" id="7611701">(</span><span class="ident" id="7611702">source</span><span class="op" id="7611708">,</span>&nbsp;<span class="ident" id="7611710">golden</span><span class="op" id="7611716">,</span>&nbsp;<span class="ident" id="7611718">res</span><span class="op" id="7611721">,</span>&nbsp;<span class="ident" id="7611723">gld</span><span class="op" id="7611726">)</span><span class="op" id="7611727">;</span>&nbsp;<span class="ident" id="7611729">err</span>&nbsp;<span class="op" id="7611733">!=</span>&nbsp;<span class="ident" id="7611736">nil</span>&nbsp;<span class="op" id="7611740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7611744">t</span><span class="op" id="7611745">.</span><span class="ident" id="7611746">Error</span><span class="op" id="7611751">(</span><span class="ident" id="7611752">err</span><span class="op" id="7611755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7611759">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7611767">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7611771">if</span>&nbsp;<span class="ident" id="7611774">mode</span><span class="op" id="7611778">&amp;</span><span class="ident" id="7611779">idempotent</span>&nbsp;<span class="op" id="7611790">!=</span>&nbsp;<span class="num" id="7611793">0</span>&nbsp;<span class="op" id="7611795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7611799">//&nbsp;formatting&nbsp;golden&nbsp;must&nbsp;be&nbsp;idempotent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7611841">//&nbsp;(This&nbsp;is&nbsp;very&nbsp;difficult&nbsp;to&nbsp;achieve&nbsp;in&nbsp;general&nbsp;and&nbsp;for&nbsp;now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7611904">//&nbsp;it&nbsp;is&nbsp;only&nbsp;checked&nbsp;for&nbsp;files&nbsp;explicitly&nbsp;marked&nbsp;as&nbsp;such.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7611966">res</span><span class="op" id="7611969">,</span>&nbsp;<span class="ident" id="7611971">err</span>&nbsp;<span class="op" id="7611975">=</span>&nbsp;<span class="ident" id="7611977">format</span><span class="op" id="7611983">(</span><span class="ident" id="7611984">gld</span><span class="op" id="7611987">,</span>&nbsp;<span class="ident" id="7611989">mode</span><span class="op" id="7611993">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7611997">if</span>&nbsp;<span class="ident" id="7612000">err</span>&nbsp;<span class="op" id="7612004">:=</span>&nbsp;<span class="ident" id="7612007">diff</span><span class="op" id="7612011">(</span><span class="ident" id="7612012">golden</span><span class="op" id="7612018">,</span>&nbsp;<span class="ident" id="7612020">fmt</span><span class="op" id="7612023">.</span><span class="ident" id="7612024">Sprintf</span><span class="op" id="7612031">(</span><span class="string" id="7612032">&#34;format(%s)&#34;</span><span class="op" id="7612044">,</span>&nbsp;<span class="ident" id="7612046">golden</span><span class="op" id="7612052">)</span><span class="op" id="7612053">,</span>&nbsp;<span class="ident" id="7612055">gld</span><span class="op" id="7612058">,</span>&nbsp;<span class="ident" id="7612060">res</span><span class="op" id="7612063">)</span><span class="op" id="7612064">;</span>&nbsp;<span class="ident" id="7612066">err</span>&nbsp;<span class="op" id="7612070">!=</span>&nbsp;<span class="ident" id="7612073">nil</span>&nbsp;<span class="op" id="7612077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7612082">t</span><span class="op" id="7612083">.</span><span class="ident" id="7612084">Errorf</span><span class="op" id="7612090">(</span><span class="string" id="7612091">&#34;golden&nbsp;is&nbsp;not&nbsp;idempotent:&nbsp;%s&#34;</span><span class="op" id="7612121">,</span>&nbsp;<span class="ident" id="7612123">err</span><span class="op" id="7612126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7612130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7612133">}</span><br>
<span class="lineno"></span><span class="op" id="7612135">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="keyword" id="7612138">func</span>&nbsp;<span class="ident" id="7612143">check</span><span class="op" id="7612148">(</span><span class="ident" id="7612149">t</span>&nbsp;<span class="op" id="7612151">*</span><span class="ident" id="7612152">testing</span><span class="op" id="7612159">.</span><span class="ident" id="7612160">T</span><span class="op" id="7612161">,</span>&nbsp;<span class="ident" id="7612163">source</span><span class="op" id="7612169">,</span>&nbsp;<span class="ident" id="7612171">golden</span>&nbsp;<span class="builtintype" id="7612178">string</span><span class="op" id="7612184">,</span>&nbsp;<span class="ident" id="7612186">mode</span>&nbsp;<span class="ident" id="7612191">checkMode</span><span class="op" id="7612200">)</span>&nbsp;<span class="op" id="7612202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7612205">//&nbsp;run&nbsp;the&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7612222">cc</span>&nbsp;<span class="op" id="7612225">:=</span>&nbsp;<span class="builtinfunc" id="7612228">make</span><span class="op" id="7612232">(</span><span class="keyword" id="7612233">chan</span>&nbsp;<span class="builtintype" id="7612238">int</span><span class="op" id="7612241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7612244">go</span>&nbsp;<span class="keyword" id="7612247">func</span><span class="op" id="7612251">(</span><span class="op" id="7612252">)</span>&nbsp;<span class="op" id="7612254">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7612258">runcheck</span><span class="op" id="7612266">(</span><span class="ident" id="7612267">t</span><span class="op" id="7612268">,</span>&nbsp;<span class="ident" id="7612270">source</span><span class="op" id="7612276">,</span>&nbsp;<span class="ident" id="7612278">golden</span><span class="op" id="7612284">,</span>&nbsp;<span class="ident" id="7612286">mode</span><span class="op" id="7612290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7612294">cc</span>&nbsp;<span class="op" id="7612297">&lt;-</span>&nbsp;<span class="num" id="7612300">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7612303">}</span><span class="op" id="7612304">(</span><span class="op" id="7612305">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7612309">//&nbsp;wait&nbsp;with&nbsp;timeout</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7612331">select</span>&nbsp;<span class="op" id="7612338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7612341">case</span>&nbsp;<span class="op" id="7612346">&lt;-</span><span class="ident" id="7612348">time</span><span class="op" id="7612352">.</span><span class="ident" id="7612353">After</span><span class="op" id="7612358">(</span><span class="num" id="7612359">10</span>&nbsp;<span class="op" id="7612362">*</span>&nbsp;<span class="ident" id="7612364">time</span><span class="op" id="7612368">.</span><span class="ident" id="7612369">Second</span><span class="op" id="7612375">)</span><span class="op" id="7612376">:</span>&nbsp;<span class="comment" id="7612378">//&nbsp;plenty&nbsp;of&nbsp;a&nbsp;safety&nbsp;margin,&nbsp;even&nbsp;for&nbsp;very&nbsp;slow&nbsp;machines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7612438">//&nbsp;test&nbsp;running&nbsp;past&nbsp;time&nbsp;out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7612470">t</span><span class="op" id="7612471">.</span><span class="ident" id="7612472">Errorf</span><span class="op" id="7612478">(</span><span class="string" id="7612479">&#34;%s:&nbsp;running&nbsp;too&nbsp;slowly&#34;</span><span class="op" id="7612503">,</span>&nbsp;<span class="ident" id="7612505">source</span><span class="op" id="7612511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7612514">case</span>&nbsp;<span class="op" id="7612519">&lt;-</span><span class="ident" id="7612521">cc</span><span class="op" id="7612523">:</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7612527">//&nbsp;test&nbsp;finished&nbsp;within&nbsp;allotted&nbsp;time&nbsp;margin</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7612573">}</span><br>
<span class="lineno"></span><span class="op" id="7612575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7612578">type</span>&nbsp;<span class="ident" id="7612583">entry</span>&nbsp;<span class="keyword" id="7612589">struct</span>&nbsp;<span class="op" id="7612596">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7612599">source</span><span class="op" id="7612605">,</span>&nbsp;<span class="ident" id="7612607">golden</span>&nbsp;<span class="builtintype" id="7612614">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7612622">mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7612637">checkMode</span><br>
<span class="lineno"></span><span class="op" id="7612647">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7612650">//&nbsp;Use&nbsp;go&nbsp;test&nbsp;-update&nbsp;to&nbsp;create/update&nbsp;the&nbsp;respective&nbsp;golden&nbsp;files.</span><br>
<span class="lineno">185</span><span class="keyword" id="7612719">var</span>&nbsp;<span class="ident" id="7612723">data</span>&nbsp;<span class="op" id="7612728">=</span>&nbsp;<span class="op" id="7612730">[</span><span class="op" id="7612731">]</span><span class="ident" id="7612732">entry</span><span class="op" id="7612737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7612740">{</span><span class="string" id="7612741">&#34;empty.input&#34;</span><span class="op" id="7612754">,</span>&nbsp;<span class="string" id="7612756">&#34;empty.golden&#34;</span><span class="op" id="7612770">,</span>&nbsp;<span class="ident" id="7612772">idempotent</span><span class="op" id="7612782">}</span><span class="op" id="7612783">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7612786">{</span><span class="string" id="7612787">&#34;comments.input&#34;</span><span class="op" id="7612803">,</span>&nbsp;<span class="string" id="7612805">&#34;comments.golden&#34;</span><span class="op" id="7612822">,</span>&nbsp;<span class="num" id="7612824">0</span><span class="op" id="7612825">}</span><span class="op" id="7612826">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7612829">{</span><span class="string" id="7612830">&#34;comments.input&#34;</span><span class="op" id="7612846">,</span>&nbsp;<span class="string" id="7612848">&#34;comments.x&#34;</span><span class="op" id="7612860">,</span>&nbsp;<span class="ident" id="7612862">export</span><span class="op" id="7612868">}</span><span class="op" id="7612869">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7612872">{</span><span class="string" id="7612873">&#34;comments2.input&#34;</span><span class="op" id="7612890">,</span>&nbsp;<span class="string" id="7612892">&#34;comments2.golden&#34;</span><span class="op" id="7612910">,</span>&nbsp;<span class="ident" id="7612912">idempotent</span><span class="op" id="7612922">}</span><span class="op" id="7612923">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7612926">{</span><span class="string" id="7612927">&#34;linebreaks.input&#34;</span><span class="op" id="7612945">,</span>&nbsp;<span class="string" id="7612947">&#34;linebreaks.golden&#34;</span><span class="op" id="7612966">,</span>&nbsp;<span class="ident" id="7612968">idempotent</span><span class="op" id="7612978">}</span><span class="op" id="7612979">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7612982">{</span><span class="string" id="7612983">&#34;expressions.input&#34;</span><span class="op" id="7613002">,</span>&nbsp;<span class="string" id="7613004">&#34;expressions.golden&#34;</span><span class="op" id="7613024">,</span>&nbsp;<span class="ident" id="7613026">idempotent</span><span class="op" id="7613036">}</span><span class="op" id="7613037">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7613040">{</span><span class="string" id="7613041">&#34;expressions.input&#34;</span><span class="op" id="7613060">,</span>&nbsp;<span class="string" id="7613062">&#34;expressions.raw&#34;</span><span class="op" id="7613079">,</span>&nbsp;<span class="ident" id="7613081">rawFormat</span>&nbsp;<span class="op" id="7613091">|</span>&nbsp;<span class="ident" id="7613093">idempotent</span><span class="op" id="7613103">}</span><span class="op" id="7613104">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7613107">{</span><span class="string" id="7613108">&#34;declarations.input&#34;</span><span class="op" id="7613128">,</span>&nbsp;<span class="string" id="7613130">&#34;declarations.golden&#34;</span><span class="op" id="7613151">,</span>&nbsp;<span class="num" id="7613153">0</span><span class="op" id="7613154">}</span><span class="op" id="7613155">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7613158">{</span><span class="string" id="7613159">&#34;statements.input&#34;</span><span class="op" id="7613177">,</span>&nbsp;<span class="string" id="7613179">&#34;statements.golden&#34;</span><span class="op" id="7613198">,</span>&nbsp;<span class="num" id="7613200">0</span><span class="op" id="7613201">}</span><span class="op" id="7613202">,</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7613205">{</span><span class="string" id="7613206">&#34;slow.input&#34;</span><span class="op" id="7613218">,</span>&nbsp;<span class="string" id="7613220">&#34;slow.golden&#34;</span><span class="op" id="7613233">,</span>&nbsp;<span class="ident" id="7613235">idempotent</span><span class="op" id="7613245">}</span><span class="op" id="7613246">,</span><br>
<span class="lineno"></span><span class="op" id="7613248">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7613251">func</span>&nbsp;<span class="ident" id="7613256">TestFiles</span><span class="op" id="7613265">(</span><span class="ident" id="7613266">t</span>&nbsp;<span class="op" id="7613268">*</span><span class="ident" id="7613269">testing</span><span class="op" id="7613276">.</span><span class="ident" id="7613277">T</span><span class="op" id="7613278">)</span>&nbsp;<span class="op" id="7613280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7613283">for</span>&nbsp;<span class="ident" id="7613287">_</span><span class="op" id="7613288">,</span>&nbsp;<span class="ident" id="7613290">e</span>&nbsp;<span class="op" id="7613292">:=</span>&nbsp;<span class="keyword" id="7613295">range</span>&nbsp;<span class="ident" id="7613301">data</span>&nbsp;<span class="op" id="7613306">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7613310">source</span>&nbsp;<span class="op" id="7613317">:=</span>&nbsp;<span class="ident" id="7613320">filepath</span><span class="op" id="7613328">.</span><span class="ident" id="7613329">Join</span><span class="op" id="7613333">(</span><span class="ident" id="7613334">dataDir</span><span class="op" id="7613341">,</span>&nbsp;<span class="ident" id="7613343">e</span><span class="op" id="7613344">.</span><span class="ident" id="7613345">source</span><span class="op" id="7613351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7613355">golden</span>&nbsp;<span class="op" id="7613362">:=</span>&nbsp;<span class="ident" id="7613365">filepath</span><span class="op" id="7613373">.</span><span class="ident" id="7613374">Join</span><span class="op" id="7613378">(</span><span class="ident" id="7613379">dataDir</span><span class="op" id="7613386">,</span>&nbsp;<span class="ident" id="7613388">e</span><span class="op" id="7613389">.</span><span class="ident" id="7613390">golden</span><span class="op" id="7613396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7613400">check</span><span class="op" id="7613405">(</span><span class="ident" id="7613406">t</span><span class="op" id="7613407">,</span>&nbsp;<span class="ident" id="7613409">source</span><span class="op" id="7613415">,</span>&nbsp;<span class="ident" id="7613417">golden</span><span class="op" id="7613423">,</span>&nbsp;<span class="ident" id="7613425">e</span><span class="op" id="7613426">.</span><span class="ident" id="7613427">mode</span><span class="op" id="7613431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7613435">//&nbsp;TODO(gri)&nbsp;check&nbsp;that&nbsp;golden&nbsp;is&nbsp;idempotent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7613482">//check(t,&nbsp;golden,&nbsp;golden,&nbsp;e.mode)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7613518">}</span><br>
<span class="lineno"></span><span class="op" id="7613520">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7613523">//&nbsp;TestLineComments,&nbsp;using&nbsp;a&nbsp;simple&nbsp;test&nbsp;case,&nbsp;checks&nbsp;that&nbsp;consecutive&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="7613599">//&nbsp;comments&nbsp;are&nbsp;properly&nbsp;terminated&nbsp;with&nbsp;a&nbsp;newline&nbsp;even&nbsp;if&nbsp;the&nbsp;AST&nbsp;position</span><br>
<span class="lineno">210</span><span class="comment" id="7613675">//&nbsp;information&nbsp;is&nbsp;incorrect.</span><br>
<span class="lineno"></span><span class="comment" id="7613704">//</span><br>
<span class="lineno"></span><span class="keyword" id="7613707">func</span>&nbsp;<span class="ident" id="7613712">TestLineComments</span><span class="op" id="7613728">(</span><span class="ident" id="7613729">t</span>&nbsp;<span class="op" id="7613731">*</span><span class="ident" id="7613732">testing</span><span class="op" id="7613739">.</span><span class="ident" id="7613740">T</span><span class="op" id="7613741">)</span>&nbsp;<span class="op" id="7613743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7613746">const</span>&nbsp;<span class="ident" id="7613752">src</span>&nbsp;<span class="op" id="7613756">=</span>&nbsp;<span class="string" id="7613758">`//&nbsp;comment&nbsp;1<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;comment&nbsp;2<br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;comment&nbsp;3<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsppackage&nbsp;main<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7613819">fset</span>&nbsp;<span class="op" id="7613824">:=</span>&nbsp;<span class="ident" id="7613827">token</span><span class="op" id="7613832">.</span><span class="ident" id="7613833">NewFileSet</span><span class="op" id="7613843">(</span><span class="op" id="7613844">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7613847">f</span><span class="op" id="7613848">,</span>&nbsp;<span class="ident" id="7613850">err</span>&nbsp;<span class="op" id="7613854">:=</span>&nbsp;<span class="ident" id="7613857">parser</span><span class="op" id="7613863">.</span><span class="ident" id="7613864">ParseFile</span><span class="op" id="7613873">(</span><span class="ident" id="7613874">fset</span><span class="op" id="7613878">,</span>&nbsp;<span class="string" id="7613880">&#34;&#34;</span><span class="op" id="7613882">,</span>&nbsp;<span class="ident" id="7613884">src</span><span class="op" id="7613887">,</span>&nbsp;<span class="ident" id="7613889">parser</span><span class="op" id="7613895">.</span><span class="ident" id="7613896">ParseComments</span><span class="op" id="7613909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7613912">if</span>&nbsp;<span class="ident" id="7613915">err</span>&nbsp;<span class="op" id="7613919">!=</span>&nbsp;<span class="ident" id="7613922">nil</span>&nbsp;<span class="op" id="7613926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7613930">panic</span><span class="op" id="7613935">(</span><span class="ident" id="7613936">err</span><span class="op" id="7613939">)</span>&nbsp;<span class="comment" id="7613941">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7613959">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7613963">var</span>&nbsp;<span class="ident" id="7613967">buf</span>&nbsp;<span class="ident" id="7613971">bytes</span><span class="op" id="7613976">.</span><span class="ident" id="7613977">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7613985">fset</span>&nbsp;<span class="op" id="7613990">=</span>&nbsp;<span class="ident" id="7613992">token</span><span class="op" id="7613997">.</span><span class="ident" id="7613998">NewFileSet</span><span class="op" id="7614008">(</span><span class="op" id="7614009">)</span>&nbsp;<span class="comment" id="7614011">//&nbsp;use&nbsp;the&nbsp;wrong&nbsp;file&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7614038">Fprint</span><span class="op" id="7614044">(</span><span class="op" id="7614045">&amp;</span><span class="ident" id="7614046">buf</span><span class="op" id="7614049">,</span>&nbsp;<span class="ident" id="7614051">fset</span><span class="op" id="7614055">,</span>&nbsp;<span class="ident" id="7614057">f</span><span class="op" id="7614058">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7614062">nlines</span>&nbsp;<span class="op" id="7614069">:=</span>&nbsp;<span class="num" id="7614072">0</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7614075">for</span>&nbsp;<span class="ident" id="7614079">_</span><span class="op" id="7614080">,</span>&nbsp;<span class="ident" id="7614082">ch</span>&nbsp;<span class="op" id="7614085">:=</span>&nbsp;<span class="keyword" id="7614088">range</span>&nbsp;<span class="ident" id="7614094">buf</span><span class="op" id="7614097">.</span><span class="ident" id="7614098">Bytes</span><span class="op" id="7614103">(</span><span class="op" id="7614104">)</span>&nbsp;<span class="op" id="7614106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7614110">if</span>&nbsp;<span class="ident" id="7614113">ch</span>&nbsp;<span class="op" id="7614116">==</span>&nbsp;<span class="string" id="7614119">&#39;\n&#39;</span>&nbsp;<span class="op" id="7614124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7614129">nlines</span><span class="op" id="7614135">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7614140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7614143">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7614147">const</span>&nbsp;<span class="ident" id="7614153">expected</span>&nbsp;<span class="op" id="7614162">=</span>&nbsp;<span class="num" id="7614164">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7614167">if</span>&nbsp;<span class="ident" id="7614170">nlines</span>&nbsp;<span class="op" id="7614177">&lt;</span>&nbsp;<span class="ident" id="7614179">expected</span>&nbsp;<span class="op" id="7614188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7614192">t</span><span class="op" id="7614193">.</span><span class="ident" id="7614194">Errorf</span><span class="op" id="7614200">(</span><span class="string" id="7614201">&#34;got&nbsp;%d,&nbsp;expected&nbsp;%d\n&#34;</span><span class="op" id="7614224">,</span>&nbsp;<span class="ident" id="7614226">nlines</span><span class="op" id="7614232">,</span>&nbsp;<span class="ident" id="7614234">expected</span><span class="op" id="7614242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7614246">t</span><span class="op" id="7614247">.</span><span class="ident" id="7614248">Errorf</span><span class="op" id="7614254">(</span><span class="string" id="7614255">&#34;result:\n%s&#34;</span><span class="op" id="7614268">,</span>&nbsp;<span class="ident" id="7614270">buf</span><span class="op" id="7614273">.</span><span class="ident" id="7614274">Bytes</span><span class="op" id="7614279">(</span><span class="op" id="7614280">)</span><span class="op" id="7614281">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7614284">}</span><br>
<span class="lineno"></span><span class="op" id="7614286">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7614289">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;printer&nbsp;can&nbsp;be&nbsp;invoked&nbsp;during&nbsp;initialization.</span><br>
<span class="lineno"></span><span class="keyword" id="7614354">func</span>&nbsp;<span class="ident" id="7614359">init</span><span class="op" id="7614363">(</span><span class="op" id="7614364">)</span>&nbsp;<span class="op" id="7614366">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7614369">const</span>&nbsp;<span class="ident" id="7614375">name</span>&nbsp;<span class="op" id="7614380">=</span>&nbsp;<span class="string" id="7614382">&#34;foobar&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7614392">var</span>&nbsp;<span class="ident" id="7614396">buf</span>&nbsp;<span class="ident" id="7614400">bytes</span><span class="op" id="7614405">.</span><span class="ident" id="7614406">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7614414">if</span>&nbsp;<span class="ident" id="7614417">err</span>&nbsp;<span class="op" id="7614421">:=</span>&nbsp;<span class="ident" id="7614424">Fprint</span><span class="op" id="7614430">(</span><span class="op" id="7614431">&amp;</span><span class="ident" id="7614432">buf</span><span class="op" id="7614435">,</span>&nbsp;<span class="ident" id="7614437">fset</span><span class="op" id="7614441">,</span>&nbsp;<span class="op" id="7614443">&amp;</span><span class="ident" id="7614444">ast</span><span class="op" id="7614447">.</span><span class="ident" id="7614448">Ident</span><span class="op" id="7614453">{</span><span class="ident" id="7614454">Name</span><span class="op" id="7614458">:</span>&nbsp;<span class="ident" id="7614460">name</span><span class="op" id="7614464">}</span><span class="op" id="7614465">)</span><span class="op" id="7614466">;</span>&nbsp;<span class="ident" id="7614468">err</span>&nbsp;<span class="op" id="7614472">!=</span>&nbsp;<span class="ident" id="7614475">nil</span>&nbsp;<span class="op" id="7614479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7614483">panic</span><span class="op" id="7614488">(</span><span class="ident" id="7614489">err</span><span class="op" id="7614492">)</span>&nbsp;<span class="comment" id="7614494">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7614512">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7614515">//&nbsp;in&nbsp;debug&nbsp;mode,&nbsp;the&nbsp;result&nbsp;contains&nbsp;additional&nbsp;information;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7614578">//&nbsp;ignore&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7614592">if</span>&nbsp;<span class="ident" id="7614595">s</span>&nbsp;<span class="op" id="7614597">:=</span>&nbsp;<span class="ident" id="7614600">buf</span><span class="op" id="7614603">.</span><span class="ident" id="7614604">String</span><span class="op" id="7614610">(</span><span class="op" id="7614611">)</span><span class="op" id="7614612">;</span>&nbsp;<span class="op" id="7614614">!</span><span class="ident" id="7614615">debug</span>&nbsp;<span class="op" id="7614621">&amp;&amp;</span>&nbsp;<span class="ident" id="7614624">s</span>&nbsp;<span class="op" id="7614626">!=</span>&nbsp;<span class="ident" id="7614629">name</span>&nbsp;<span class="op" id="7614634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7614638">panic</span><span class="op" id="7614643">(</span><span class="string" id="7614644">&#34;got&nbsp;&#34;</span>&nbsp;<span class="op" id="7614651">+</span>&nbsp;<span class="ident" id="7614653">s</span>&nbsp;<span class="op" id="7614655">+</span>&nbsp;<span class="string" id="7614657">&#34;,&nbsp;want&nbsp;&#34;</span>&nbsp;<span class="op" id="7614667">+</span>&nbsp;<span class="ident" id="7614669">name</span><span class="op" id="7614673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7614676">}</span><br>
<span class="lineno">255</span><span class="op" id="7614678">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7614681">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;printer&nbsp;doesn&#39;t&nbsp;crash&nbsp;if&nbsp;the&nbsp;AST&nbsp;contains&nbsp;BadXXX&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="keyword" id="7614756">func</span>&nbsp;<span class="ident" id="7614761">TestBadNodes</span><span class="op" id="7614773">(</span><span class="ident" id="7614774">t</span>&nbsp;<span class="op" id="7614776">*</span><span class="ident" id="7614777">testing</span><span class="op" id="7614784">.</span><span class="ident" id="7614785">T</span><span class="op" id="7614786">)</span>&nbsp;<span class="op" id="7614788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7614791">const</span>&nbsp;<span class="ident" id="7614797">src</span>&nbsp;<span class="op" id="7614801">=</span>&nbsp;<span class="string" id="7614803">&#34;package&nbsp;p\n(&#34;</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7614819">const</span>&nbsp;<span class="ident" id="7614825">res</span>&nbsp;<span class="op" id="7614829">=</span>&nbsp;<span class="string" id="7614831">&#34;package&nbsp;p\nBadDecl\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7614855">f</span><span class="op" id="7614856">,</span>&nbsp;<span class="ident" id="7614858">err</span>&nbsp;<span class="op" id="7614862">:=</span>&nbsp;<span class="ident" id="7614865">parser</span><span class="op" id="7614871">.</span><span class="ident" id="7614872">ParseFile</span><span class="op" id="7614881">(</span><span class="ident" id="7614882">fset</span><span class="op" id="7614886">,</span>&nbsp;<span class="string" id="7614888">&#34;&#34;</span><span class="op" id="7614890">,</span>&nbsp;<span class="ident" id="7614892">src</span><span class="op" id="7614895">,</span>&nbsp;<span class="ident" id="7614897">parser</span><span class="op" id="7614903">.</span><span class="ident" id="7614904">ParseComments</span><span class="op" id="7614917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7614920">if</span>&nbsp;<span class="ident" id="7614923">err</span>&nbsp;<span class="op" id="7614927">==</span>&nbsp;<span class="ident" id="7614930">nil</span>&nbsp;<span class="op" id="7614934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7614938">t</span><span class="op" id="7614939">.</span><span class="ident" id="7614940">Error</span><span class="op" id="7614945">(</span><span class="string" id="7614946">&#34;expected&nbsp;illegal&nbsp;program&#34;</span><span class="op" id="7614972">)</span>&nbsp;<span class="comment" id="7614974">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7614992">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7614995">var</span>&nbsp;<span class="ident" id="7614999">buf</span>&nbsp;<span class="ident" id="7615003">bytes</span><span class="op" id="7615008">.</span><span class="ident" id="7615009">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7615017">Fprint</span><span class="op" id="7615023">(</span><span class="op" id="7615024">&amp;</span><span class="ident" id="7615025">buf</span><span class="op" id="7615028">,</span>&nbsp;<span class="ident" id="7615030">fset</span><span class="op" id="7615034">,</span>&nbsp;<span class="ident" id="7615036">f</span><span class="op" id="7615037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7615040">if</span>&nbsp;<span class="ident" id="7615043">buf</span><span class="op" id="7615046">.</span><span class="ident" id="7615047">String</span><span class="op" id="7615053">(</span><span class="op" id="7615054">)</span>&nbsp;<span class="op" id="7615056">!=</span>&nbsp;<span class="ident" id="7615059">res</span>&nbsp;<span class="op" id="7615063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7615067">t</span><span class="op" id="7615068">.</span><span class="ident" id="7615069">Errorf</span><span class="op" id="7615075">(</span><span class="string" id="7615076">&#34;got&nbsp;%q,&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="7615097">,</span>&nbsp;<span class="ident" id="7615099">buf</span><span class="op" id="7615102">.</span><span class="ident" id="7615103">String</span><span class="op" id="7615109">(</span><span class="op" id="7615110">)</span><span class="op" id="7615111">,</span>&nbsp;<span class="ident" id="7615113">res</span><span class="op" id="7615116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7615119">}</span><br>
<span class="lineno">270</span><span class="op" id="7615121">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7615124">//&nbsp;testComment&nbsp;verifies&nbsp;that&nbsp;f&nbsp;can&nbsp;be&nbsp;parsed&nbsp;again&nbsp;after&nbsp;printing&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="7615193">//&nbsp;with&nbsp;its&nbsp;first&nbsp;comment&nbsp;set&nbsp;to&nbsp;comment&nbsp;at&nbsp;any&nbsp;possible&nbsp;source&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="7615265">func</span>&nbsp;<span class="ident" id="7615270">testComment</span><span class="op" id="7615281">(</span><span class="ident" id="7615282">t</span>&nbsp;<span class="op" id="7615284">*</span><span class="ident" id="7615285">testing</span><span class="op" id="7615292">.</span><span class="ident" id="7615293">T</span><span class="op" id="7615294">,</span>&nbsp;<span class="ident" id="7615296">f</span>&nbsp;<span class="op" id="7615298">*</span><span class="ident" id="7615299">ast</span><span class="op" id="7615302">.</span><span class="ident" id="7615303">File</span><span class="op" id="7615307">,</span>&nbsp;<span class="ident" id="7615309">srclen</span>&nbsp;<span class="builtintype" id="7615316">int</span><span class="op" id="7615319">,</span>&nbsp;<span class="ident" id="7615321">comment</span>&nbsp;<span class="op" id="7615329">*</span><span class="ident" id="7615330">ast</span><span class="op" id="7615333">.</span><span class="ident" id="7615334">Comment</span><span class="op" id="7615341">)</span>&nbsp;<span class="op" id="7615343">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7615346">f</span><span class="op" id="7615347">.</span><span class="ident" id="7615348">Comments</span><span class="op" id="7615356">[</span><span class="num" id="7615357">0</span><span class="op" id="7615358">]</span><span class="op" id="7615359">.</span><span class="ident" id="7615360">List</span><span class="op" id="7615364">[</span><span class="num" id="7615365">0</span><span class="op" id="7615366">]</span>&nbsp;<span class="op" id="7615368">=</span>&nbsp;<span class="ident" id="7615370">comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7615379">var</span>&nbsp;<span class="ident" id="7615383">buf</span>&nbsp;<span class="ident" id="7615387">bytes</span><span class="op" id="7615392">.</span><span class="ident" id="7615393">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7615401">for</span>&nbsp;<span class="ident" id="7615405">offs</span>&nbsp;<span class="op" id="7615410">:=</span>&nbsp;<span class="num" id="7615413">0</span><span class="op" id="7615414">;</span>&nbsp;<span class="ident" id="7615416">offs</span>&nbsp;<span class="op" id="7615421">&lt;=</span>&nbsp;<span class="ident" id="7615424">srclen</span><span class="op" id="7615430">;</span>&nbsp;<span class="ident" id="7615432">offs</span><span class="op" id="7615436">++</span>&nbsp;<span class="op" id="7615439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7615443">buf</span><span class="op" id="7615446">.</span><span class="ident" id="7615447">Reset</span><span class="op" id="7615452">(</span><span class="op" id="7615453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7615457">//&nbsp;Printing&nbsp;f&nbsp;should&nbsp;result&nbsp;in&nbsp;a&nbsp;correct&nbsp;program&nbsp;no</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7615511">//&nbsp;matter&nbsp;what&nbsp;the&nbsp;(incorrect)&nbsp;comment&nbsp;position&nbsp;is.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7615565">if</span>&nbsp;<span class="ident" id="7615568">err</span>&nbsp;<span class="op" id="7615572">:=</span>&nbsp;<span class="ident" id="7615575">Fprint</span><span class="op" id="7615581">(</span><span class="op" id="7615582">&amp;</span><span class="ident" id="7615583">buf</span><span class="op" id="7615586">,</span>&nbsp;<span class="ident" id="7615588">fset</span><span class="op" id="7615592">,</span>&nbsp;<span class="ident" id="7615594">f</span><span class="op" id="7615595">)</span><span class="op" id="7615596">;</span>&nbsp;<span class="ident" id="7615598">err</span>&nbsp;<span class="op" id="7615602">!=</span>&nbsp;<span class="ident" id="7615605">nil</span>&nbsp;<span class="op" id="7615609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7615614">t</span><span class="op" id="7615615">.</span><span class="ident" id="7615616">Error</span><span class="op" id="7615621">(</span><span class="ident" id="7615622">err</span><span class="op" id="7615625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7615629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7615633">if</span>&nbsp;<span class="ident" id="7615636">_</span><span class="op" id="7615637">,</span>&nbsp;<span class="ident" id="7615639">err</span>&nbsp;<span class="op" id="7615643">:=</span>&nbsp;<span class="ident" id="7615646">parser</span><span class="op" id="7615652">.</span><span class="ident" id="7615653">ParseFile</span><span class="op" id="7615662">(</span><span class="ident" id="7615663">fset</span><span class="op" id="7615667">,</span>&nbsp;<span class="string" id="7615669">&#34;&#34;</span><span class="op" id="7615671">,</span>&nbsp;<span class="ident" id="7615673">buf</span><span class="op" id="7615676">.</span><span class="ident" id="7615677">Bytes</span><span class="op" id="7615682">(</span><span class="op" id="7615683">)</span><span class="op" id="7615684">,</span>&nbsp;<span class="num" id="7615686">0</span><span class="op" id="7615687">)</span><span class="op" id="7615688">;</span>&nbsp;<span class="ident" id="7615690">err</span>&nbsp;<span class="op" id="7615694">!=</span>&nbsp;<span class="ident" id="7615697">nil</span>&nbsp;<span class="op" id="7615701">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7615706">t</span><span class="op" id="7615707">.</span><span class="ident" id="7615708">Fatalf</span><span class="op" id="7615714">(</span><span class="string" id="7615715">&#34;incorrect&nbsp;program&nbsp;for&nbsp;pos&nbsp;=&nbsp;%d:\n%s&#34;</span><span class="op" id="7615752">,</span>&nbsp;<span class="ident" id="7615754">comment</span><span class="op" id="7615761">.</span><span class="ident" id="7615762">Slash</span><span class="op" id="7615767">,</span>&nbsp;<span class="ident" id="7615769">buf</span><span class="op" id="7615772">.</span><span class="ident" id="7615773">String</span><span class="op" id="7615779">(</span><span class="op" id="7615780">)</span><span class="op" id="7615781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7615785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7615789">//&nbsp;Position&nbsp;information&nbsp;is&nbsp;just&nbsp;an&nbsp;offset.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7615834">//&nbsp;Move&nbsp;comment&nbsp;one&nbsp;byte&nbsp;down&nbsp;in&nbsp;the&nbsp;source.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7615881">comment</span><span class="op" id="7615888">.</span><span class="ident" id="7615889">Slash</span><span class="op" id="7615894">++</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7615898">}</span><br>
<span class="lineno"></span><span class="op" id="7615900">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7615903">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;printer&nbsp;produces&nbsp;a&nbsp;correct&nbsp;program</span><br>
<span class="lineno"></span><span class="comment" id="7615957">//&nbsp;even&nbsp;if&nbsp;the&nbsp;position&nbsp;information&nbsp;of&nbsp;comments&nbsp;introducing&nbsp;newlines</span><br>
<span class="lineno">295</span><span class="comment" id="7616026">//&nbsp;is&nbsp;incorrect.</span><br>
<span class="lineno"></span><span class="keyword" id="7616043">func</span>&nbsp;<span class="ident" id="7616048">TestBadComments</span><span class="op" id="7616063">(</span><span class="ident" id="7616064">t</span>&nbsp;<span class="op" id="7616066">*</span><span class="ident" id="7616067">testing</span><span class="op" id="7616074">.</span><span class="ident" id="7616075">T</span><span class="op" id="7616076">)</span>&nbsp;<span class="op" id="7616078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7616081">const</span>&nbsp;<span class="ident" id="7616087">src</span>&nbsp;<span class="op" id="7616091">=</span>&nbsp;<span class="string" id="7616093">`<br>
<span class="lineno"></span>//&nbsp;first&nbsp;comment&nbsp;-&nbsp;text&nbsp;and&nbsp;position&nbsp;changed&nbsp;by&nbsp;test<br>
<span class="lineno"></span>package&nbsp;p<br>
<span class="lineno">300</span>import&nbsp;&#34;fmt&#34;<br>
<span class="lineno"></span>const&nbsp;pi&nbsp;=&nbsp;3.14&nbsp;//&nbsp;rough&nbsp;circle<br>
<span class="lineno"></span>var&nbsp;(<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspx,&nbsp;y,&nbsp;z&nbsp;int&nbsp;=&nbsp;1,&nbsp;2,&nbsp;3<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspu,&nbsp;v&nbsp;float64<br>
<span class="lineno">305</span>)<br>
<span class="lineno"></span>func&nbsp;fibo(n&nbsp;int)&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspif&nbsp;n&nbsp;&lt;&nbsp;2&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;n&nbsp;/*&nbsp;seed&nbsp;values&nbsp;*/<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;fibo(n-1)&nbsp;+&nbsp;fibo(n-2)<br>
<span class="lineno"></span>}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7616347">f</span><span class="op" id="7616348">,</span>&nbsp;<span class="ident" id="7616350">err</span>&nbsp;<span class="op" id="7616354">:=</span>&nbsp;<span class="ident" id="7616357">parser</span><span class="op" id="7616363">.</span><span class="ident" id="7616364">ParseFile</span><span class="op" id="7616373">(</span><span class="ident" id="7616374">fset</span><span class="op" id="7616378">,</span>&nbsp;<span class="string" id="7616380">&#34;&#34;</span><span class="op" id="7616382">,</span>&nbsp;<span class="ident" id="7616384">src</span><span class="op" id="7616387">,</span>&nbsp;<span class="ident" id="7616389">parser</span><span class="op" id="7616395">.</span><span class="ident" id="7616396">ParseComments</span><span class="op" id="7616409">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7616412">if</span>&nbsp;<span class="ident" id="7616415">err</span>&nbsp;<span class="op" id="7616419">!=</span>&nbsp;<span class="ident" id="7616422">nil</span>&nbsp;<span class="op" id="7616426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7616430">t</span><span class="op" id="7616431">.</span><span class="ident" id="7616432">Error</span><span class="op" id="7616437">(</span><span class="ident" id="7616438">err</span><span class="op" id="7616441">)</span>&nbsp;<span class="comment" id="7616443">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7616461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7616465">comment</span>&nbsp;<span class="op" id="7616473">:=</span>&nbsp;<span class="ident" id="7616476">f</span><span class="op" id="7616477">.</span><span class="ident" id="7616478">Comments</span><span class="op" id="7616486">[</span><span class="num" id="7616487">0</span><span class="op" id="7616488">]</span><span class="op" id="7616489">.</span><span class="ident" id="7616490">List</span><span class="op" id="7616494">[</span><span class="num" id="7616495">0</span><span class="op" id="7616496">]</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7616499">pos</span>&nbsp;<span class="op" id="7616503">:=</span>&nbsp;<span class="ident" id="7616506">comment</span><span class="op" id="7616513">.</span><span class="ident" id="7616514">Pos</span><span class="op" id="7616517">(</span><span class="op" id="7616518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7616521">if</span>&nbsp;<span class="ident" id="7616524">fset</span><span class="op" id="7616528">.</span><span class="ident" id="7616529">Position</span><span class="op" id="7616537">(</span><span class="ident" id="7616538">pos</span><span class="op" id="7616541">)</span><span class="op" id="7616542">.</span><span class="ident" id="7616543">Offset</span>&nbsp;<span class="op" id="7616550">!=</span>&nbsp;<span class="num" id="7616553">1</span>&nbsp;<span class="op" id="7616555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7616559">t</span><span class="op" id="7616560">.</span><span class="ident" id="7616561">Error</span><span class="op" id="7616566">(</span><span class="string" id="7616567">&#34;expected&nbsp;offset&nbsp;1&#34;</span><span class="op" id="7616586">)</span>&nbsp;<span class="comment" id="7616588">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7616606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7616610">testComment</span><span class="op" id="7616621">(</span><span class="ident" id="7616622">t</span><span class="op" id="7616623">,</span>&nbsp;<span class="ident" id="7616625">f</span><span class="op" id="7616626">,</span>&nbsp;<span class="builtinfunc" id="7616628">len</span><span class="op" id="7616631">(</span><span class="ident" id="7616632">src</span><span class="op" id="7616635">)</span><span class="op" id="7616636">,</span>&nbsp;<span class="op" id="7616638">&amp;</span><span class="ident" id="7616639">ast</span><span class="op" id="7616642">.</span><span class="ident" id="7616643">Comment</span><span class="op" id="7616650">{</span><span class="ident" id="7616651">Slash</span><span class="op" id="7616656">:</span>&nbsp;<span class="ident" id="7616658">pos</span><span class="op" id="7616661">,</span>&nbsp;<span class="ident" id="7616663">Text</span><span class="op" id="7616667">:</span>&nbsp;<span class="string" id="7616669">&#34;//-style&nbsp;comment&#34;</span><span class="op" id="7616687">}</span><span class="op" id="7616688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7616691">testComment</span><span class="op" id="7616702">(</span><span class="ident" id="7616703">t</span><span class="op" id="7616704">,</span>&nbsp;<span class="ident" id="7616706">f</span><span class="op" id="7616707">,</span>&nbsp;<span class="builtinfunc" id="7616709">len</span><span class="op" id="7616712">(</span><span class="ident" id="7616713">src</span><span class="op" id="7616716">)</span><span class="op" id="7616717">,</span>&nbsp;<span class="op" id="7616719">&amp;</span><span class="ident" id="7616720">ast</span><span class="op" id="7616723">.</span><span class="ident" id="7616724">Comment</span><span class="op" id="7616731">{</span><span class="ident" id="7616732">Slash</span><span class="op" id="7616737">:</span>&nbsp;<span class="ident" id="7616739">pos</span><span class="op" id="7616742">,</span>&nbsp;<span class="ident" id="7616744">Text</span><span class="op" id="7616748">:</span>&nbsp;<span class="string" id="7616750">&#34;/*-style&nbsp;comment&nbsp;*/&#34;</span><span class="op" id="7616771">}</span><span class="op" id="7616772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7616775">testComment</span><span class="op" id="7616786">(</span><span class="ident" id="7616787">t</span><span class="op" id="7616788">,</span>&nbsp;<span class="ident" id="7616790">f</span><span class="op" id="7616791">,</span>&nbsp;<span class="builtinfunc" id="7616793">len</span><span class="op" id="7616796">(</span><span class="ident" id="7616797">src</span><span class="op" id="7616800">)</span><span class="op" id="7616801">,</span>&nbsp;<span class="op" id="7616803">&amp;</span><span class="ident" id="7616804">ast</span><span class="op" id="7616807">.</span><span class="ident" id="7616808">Comment</span><span class="op" id="7616815">{</span><span class="ident" id="7616816">Slash</span><span class="op" id="7616821">:</span>&nbsp;<span class="ident" id="7616823">pos</span><span class="op" id="7616826">,</span>&nbsp;<span class="ident" id="7616828">Text</span><span class="op" id="7616832">:</span>&nbsp;<span class="string" id="7616834">&#34;/*-style&nbsp;\n&nbsp;comment&nbsp;*/&#34;</span><span class="op" id="7616858">}</span><span class="op" id="7616859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7616862">testComment</span><span class="op" id="7616873">(</span><span class="ident" id="7616874">t</span><span class="op" id="7616875">,</span>&nbsp;<span class="ident" id="7616877">f</span><span class="op" id="7616878">,</span>&nbsp;<span class="builtinfunc" id="7616880">len</span><span class="op" id="7616883">(</span><span class="ident" id="7616884">src</span><span class="op" id="7616887">)</span><span class="op" id="7616888">,</span>&nbsp;<span class="op" id="7616890">&amp;</span><span class="ident" id="7616891">ast</span><span class="op" id="7616894">.</span><span class="ident" id="7616895">Comment</span><span class="op" id="7616902">{</span><span class="ident" id="7616903">Slash</span><span class="op" id="7616908">:</span>&nbsp;<span class="ident" id="7616910">pos</span><span class="op" id="7616913">,</span>&nbsp;<span class="ident" id="7616915">Text</span><span class="op" id="7616919">:</span>&nbsp;<span class="string" id="7616921">&#34;/*-style&nbsp;comment&nbsp;\n\n\n&nbsp;*/&#34;</span><span class="op" id="7616949">}</span><span class="op" id="7616950">)</span><br>
<span class="lineno"></span><span class="op" id="7616952">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="keyword" id="7616955">type</span>&nbsp;<span class="ident" id="7616960">visitor</span>&nbsp;<span class="keyword" id="7616968">chan</span>&nbsp;<span class="op" id="7616973">*</span><span class="ident" id="7616974">ast</span><span class="op" id="7616977">.</span><span class="ident" id="7616978">Ident</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7616985">func</span>&nbsp;<span class="op" id="7616990">(</span><span class="ident" id="7616991">v</span>&nbsp;<span class="ident" id="7616993">visitor</span><span class="op" id="7617000">)</span>&nbsp;<span class="ident" id="7617002">Visit</span><span class="op" id="7617007">(</span><span class="ident" id="7617008">n</span>&nbsp;<span class="ident" id="7617010">ast</span><span class="op" id="7617013">.</span><span class="ident" id="7617014">Node</span><span class="op" id="7617018">)</span>&nbsp;<span class="op" id="7617020">(</span><span class="ident" id="7617021">w</span>&nbsp;<span class="ident" id="7617023">ast</span><span class="op" id="7617026">.</span><span class="ident" id="7617027">Visitor</span><span class="op" id="7617034">)</span>&nbsp;<span class="op" id="7617036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7617039">if</span>&nbsp;<span class="ident" id="7617042">ident</span><span class="op" id="7617047">,</span>&nbsp;<span class="ident" id="7617049">ok</span>&nbsp;<span class="op" id="7617052">:=</span>&nbsp;<span class="ident" id="7617055">n</span><span class="op" id="7617056">.</span><span class="op" id="7617057">(</span><span class="op" id="7617058">*</span><span class="ident" id="7617059">ast</span><span class="op" id="7617062">.</span><span class="ident" id="7617063">Ident</span><span class="op" id="7617068">)</span><span class="op" id="7617069">;</span>&nbsp;<span class="ident" id="7617071">ok</span>&nbsp;<span class="op" id="7617074">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7617078">v</span>&nbsp;<span class="op" id="7617080">&lt;-</span>&nbsp;<span class="ident" id="7617083">ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7617090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7617093">return</span>&nbsp;<span class="ident" id="7617100">v</span><br>
<span class="lineno"></span><span class="op" id="7617102">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="comment" id="7617105">//&nbsp;idents&nbsp;is&nbsp;an&nbsp;iterator&nbsp;that&nbsp;returns&nbsp;all&nbsp;idents&nbsp;in&nbsp;f&nbsp;via&nbsp;the&nbsp;result&nbsp;channel.</span><br>
<span class="lineno"></span><span class="keyword" id="7617183">func</span>&nbsp;<span class="ident" id="7617188">idents</span><span class="op" id="7617194">(</span><span class="ident" id="7617195">f</span>&nbsp;<span class="op" id="7617197">*</span><span class="ident" id="7617198">ast</span><span class="op" id="7617201">.</span><span class="ident" id="7617202">File</span><span class="op" id="7617206">)</span>&nbsp;<span class="op" id="7617208">&lt;-</span><span class="keyword" id="7617210">chan</span>&nbsp;<span class="op" id="7617215">*</span><span class="ident" id="7617216">ast</span><span class="op" id="7617219">.</span><span class="ident" id="7617220">Ident</span>&nbsp;<span class="op" id="7617226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7617229">v</span>&nbsp;<span class="op" id="7617231">:=</span>&nbsp;<span class="builtinfunc" id="7617234">make</span><span class="op" id="7617238">(</span><span class="ident" id="7617239">visitor</span><span class="op" id="7617246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7617249">go</span>&nbsp;<span class="keyword" id="7617252">func</span><span class="op" id="7617256">(</span><span class="op" id="7617257">)</span>&nbsp;<span class="op" id="7617259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7617263">ast</span><span class="op" id="7617266">.</span><span class="ident" id="7617267">Walk</span><span class="op" id="7617271">(</span><span class="ident" id="7617272">v</span><span class="op" id="7617273">,</span>&nbsp;<span class="ident" id="7617275">f</span><span class="op" id="7617276">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7617280">close</span><span class="op" id="7617285">(</span><span class="ident" id="7617286">v</span><span class="op" id="7617287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7617290">}</span><span class="op" id="7617291">(</span><span class="op" id="7617292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7617295">return</span>&nbsp;<span class="ident" id="7617302">v</span><br>
<span class="lineno"></span><span class="op" id="7617304">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span><span class="comment" id="7617307">//&nbsp;identCount&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;identifiers&nbsp;found&nbsp;in&nbsp;f.</span><br>
<span class="lineno"></span><span class="keyword" id="7617367">func</span>&nbsp;<span class="ident" id="7617372">identCount</span><span class="op" id="7617382">(</span><span class="ident" id="7617383">f</span>&nbsp;<span class="op" id="7617385">*</span><span class="ident" id="7617386">ast</span><span class="op" id="7617389">.</span><span class="ident" id="7617390">File</span><span class="op" id="7617394">)</span>&nbsp;<span class="builtintype" id="7617396">int</span>&nbsp;<span class="op" id="7617400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7617403">n</span>&nbsp;<span class="op" id="7617405">:=</span>&nbsp;<span class="num" id="7617408">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7617411">for</span>&nbsp;<span class="keyword" id="7617415">range</span>&nbsp;<span class="ident" id="7617421">idents</span><span class="op" id="7617427">(</span><span class="ident" id="7617428">f</span><span class="op" id="7617429">)</span>&nbsp;<span class="op" id="7617431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7617435">n</span><span class="op" id="7617436">++</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7617440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7617443">return</span>&nbsp;<span class="ident" id="7617450">n</span><br>
<span class="lineno"></span><span class="op" id="7617452">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7617455">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;SourcePos&nbsp;mode&nbsp;emits&nbsp;correct&nbsp;//line&nbsp;comments</span><br>
<span class="lineno">360</span><span class="comment" id="7617519">//&nbsp;by&nbsp;testing&nbsp;that&nbsp;position&nbsp;information&nbsp;for&nbsp;matching&nbsp;identifiers</span><br>
<span class="lineno"></span><span class="comment" id="7617584">//&nbsp;is&nbsp;maintained.</span><br>
<span class="lineno"></span><span class="keyword" id="7617602">func</span>&nbsp;<span class="ident" id="7617607">TestSourcePos</span><span class="op" id="7617620">(</span><span class="ident" id="7617621">t</span>&nbsp;<span class="op" id="7617623">*</span><span class="ident" id="7617624">testing</span><span class="op" id="7617631">.</span><span class="ident" id="7617632">T</span><span class="op" id="7617633">)</span>&nbsp;<span class="op" id="7617635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7617638">const</span>&nbsp;<span class="ident" id="7617644">src</span>&nbsp;<span class="op" id="7617648">=</span>&nbsp;<span class="string" id="7617650">`<br>
<span class="lineno"></span>package&nbsp;p<br>
<span class="lineno">365</span>import&nbsp;(&nbsp;&#34;go/printer&#34;;&nbsp;&#34;math&#34;&nbsp;)<br>
<span class="lineno"></span>const&nbsp;pi&nbsp;=&nbsp;3.14;&nbsp;var&nbsp;x&nbsp;=&nbsp;0<br>
<span class="lineno"></span>type&nbsp;t&nbsp;struct{&nbsp;x,&nbsp;y,&nbsp;z&nbsp;int;&nbsp;u,&nbsp;v,&nbsp;w&nbsp;float32&nbsp;}<br>
<span class="lineno"></span>func&nbsp;(t&nbsp;*t)&nbsp;foo(a,&nbsp;b,&nbsp;c&nbsp;int)&nbsp;int&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;a*t.x&nbsp;+&nbsp;b*t.y&nbsp;+<br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;two&nbsp;extra&nbsp;lines&nbsp;here<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;...<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspc*t.z<br>
<span class="lineno"></span>}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7617875">//&nbsp;parse&nbsp;original</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7617894">f1</span><span class="op" id="7617896">,</span>&nbsp;<span class="ident" id="7617898">err</span>&nbsp;<span class="op" id="7617902">:=</span>&nbsp;<span class="ident" id="7617905">parser</span><span class="op" id="7617911">.</span><span class="ident" id="7617912">ParseFile</span><span class="op" id="7617921">(</span><span class="ident" id="7617922">fset</span><span class="op" id="7617926">,</span>&nbsp;<span class="string" id="7617928">&#34;src&#34;</span><span class="op" id="7617933">,</span>&nbsp;<span class="ident" id="7617935">src</span><span class="op" id="7617938">,</span>&nbsp;<span class="ident" id="7617940">parser</span><span class="op" id="7617946">.</span><span class="ident" id="7617947">ParseComments</span><span class="op" id="7617960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7617963">if</span>&nbsp;<span class="ident" id="7617966">err</span>&nbsp;<span class="op" id="7617970">!=</span>&nbsp;<span class="ident" id="7617973">nil</span>&nbsp;<span class="op" id="7617977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7617981">t</span><span class="op" id="7617982">.</span><span class="ident" id="7617983">Fatal</span><span class="op" id="7617988">(</span><span class="ident" id="7617989">err</span><span class="op" id="7617992">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7617995">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7617999">//&nbsp;pretty-print&nbsp;original</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7618025">var</span>&nbsp;<span class="ident" id="7618029">buf</span>&nbsp;<span class="ident" id="7618033">bytes</span><span class="op" id="7618038">.</span><span class="ident" id="7618039">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7618047">err</span>&nbsp;<span class="op" id="7618051">=</span>&nbsp;<span class="op" id="7618053">(</span><span class="op" id="7618054">&amp;</span><span class="ident" id="7618055">Config</span><span class="op" id="7618061">{</span><span class="ident" id="7618062">Mode</span><span class="op" id="7618066">:</span>&nbsp;<span class="ident" id="7618068">UseSpaces</span>&nbsp;<span class="op" id="7618078">|</span>&nbsp;<span class="ident" id="7618080">SourcePos</span><span class="op" id="7618089">,</span>&nbsp;<span class="ident" id="7618091">Tabwidth</span><span class="op" id="7618099">:</span>&nbsp;<span class="num" id="7618101">8</span><span class="op" id="7618102">}</span><span class="op" id="7618103">)</span><span class="op" id="7618104">.</span><span class="ident" id="7618105">Fprint</span><span class="op" id="7618111">(</span><span class="op" id="7618112">&amp;</span><span class="ident" id="7618113">buf</span><span class="op" id="7618116">,</span>&nbsp;<span class="ident" id="7618118">fset</span><span class="op" id="7618122">,</span>&nbsp;<span class="ident" id="7618124">f1</span><span class="op" id="7618126">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7618129">if</span>&nbsp;<span class="ident" id="7618132">err</span>&nbsp;<span class="op" id="7618136">!=</span>&nbsp;<span class="ident" id="7618139">nil</span>&nbsp;<span class="op" id="7618143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7618147">t</span><span class="op" id="7618148">.</span><span class="ident" id="7618149">Fatal</span><span class="op" id="7618154">(</span><span class="ident" id="7618155">err</span><span class="op" id="7618158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7618161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7618165">//&nbsp;parse&nbsp;pretty&nbsp;printed&nbsp;original</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7618199">//&nbsp;(//line&nbsp;comments&nbsp;must&nbsp;be&nbsp;interpreted&nbsp;even&nbsp;w/o&nbsp;parser.ParseComments&nbsp;set)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7618275">f2</span><span class="op" id="7618277">,</span>&nbsp;<span class="ident" id="7618279">err</span>&nbsp;<span class="op" id="7618283">:=</span>&nbsp;<span class="ident" id="7618286">parser</span><span class="op" id="7618292">.</span><span class="ident" id="7618293">ParseFile</span><span class="op" id="7618302">(</span><span class="ident" id="7618303">fset</span><span class="op" id="7618307">,</span>&nbsp;<span class="string" id="7618309">&#34;&#34;</span><span class="op" id="7618311">,</span>&nbsp;<span class="ident" id="7618313">buf</span><span class="op" id="7618316">.</span><span class="ident" id="7618317">Bytes</span><span class="op" id="7618322">(</span><span class="op" id="7618323">)</span><span class="op" id="7618324">,</span>&nbsp;<span class="num" id="7618326">0</span><span class="op" id="7618327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7618330">if</span>&nbsp;<span class="ident" id="7618333">err</span>&nbsp;<span class="op" id="7618337">!=</span>&nbsp;<span class="ident" id="7618340">nil</span>&nbsp;<span class="op" id="7618344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7618348">t</span><span class="op" id="7618349">.</span><span class="ident" id="7618350">Fatalf</span><span class="op" id="7618356">(</span><span class="string" id="7618357">&#34;%s\n%s&#34;</span><span class="op" id="7618365">,</span>&nbsp;<span class="ident" id="7618367">err</span><span class="op" id="7618370">,</span>&nbsp;<span class="ident" id="7618372">buf</span><span class="op" id="7618375">.</span><span class="ident" id="7618376">Bytes</span><span class="op" id="7618381">(</span><span class="op" id="7618382">)</span><span class="op" id="7618383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7618386">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7618390">//&nbsp;At&nbsp;this&nbsp;point&nbsp;the&nbsp;position&nbsp;information&nbsp;of&nbsp;identifiers&nbsp;in&nbsp;f2&nbsp;should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7618461">//&nbsp;match&nbsp;the&nbsp;position&nbsp;information&nbsp;of&nbsp;corresponding&nbsp;identifiers&nbsp;in&nbsp;f1.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7618533">//&nbsp;number&nbsp;of&nbsp;identifiers&nbsp;must&nbsp;be&nbsp;&gt;&nbsp;0&nbsp;(test&nbsp;should&nbsp;run)&nbsp;and&nbsp;must&nbsp;match</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7618604">n1</span>&nbsp;<span class="op" id="7618607">:=</span>&nbsp;<span class="ident" id="7618610">identCount</span><span class="op" id="7618620">(</span><span class="ident" id="7618621">f1</span><span class="op" id="7618623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7618626">n2</span>&nbsp;<span class="op" id="7618629">:=</span>&nbsp;<span class="ident" id="7618632">identCount</span><span class="op" id="7618642">(</span><span class="ident" id="7618643">f2</span><span class="op" id="7618645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7618648">if</span>&nbsp;<span class="ident" id="7618651">n1</span>&nbsp;<span class="op" id="7618654">==</span>&nbsp;<span class="num" id="7618657">0</span>&nbsp;<span class="op" id="7618659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7618663">t</span><span class="op" id="7618664">.</span><span class="ident" id="7618665">Fatal</span><span class="op" id="7618670">(</span><span class="string" id="7618671">&#34;got&nbsp;no&nbsp;idents&#34;</span><span class="op" id="7618686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7618689">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7618692">if</span>&nbsp;<span class="ident" id="7618695">n2</span>&nbsp;<span class="op" id="7618698">!=</span>&nbsp;<span class="ident" id="7618701">n1</span>&nbsp;<span class="op" id="7618704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7618708">t</span><span class="op" id="7618709">.</span><span class="ident" id="7618710">Errorf</span><span class="op" id="7618716">(</span><span class="string" id="7618717">&#34;got&nbsp;%d&nbsp;idents;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7618741">,</span>&nbsp;<span class="ident" id="7618743">n2</span><span class="op" id="7618745">,</span>&nbsp;<span class="ident" id="7618747">n1</span><span class="op" id="7618749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7618752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7618756">//&nbsp;verify&nbsp;that&nbsp;all&nbsp;identifiers&nbsp;have&nbsp;correct&nbsp;line&nbsp;information</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7618818">i2range</span>&nbsp;<span class="op" id="7618826">:=</span>&nbsp;<span class="ident" id="7618829">idents</span><span class="op" id="7618835">(</span><span class="ident" id="7618836">f2</span><span class="op" id="7618838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7618841">for</span>&nbsp;<span class="ident" id="7618845">i1</span>&nbsp;<span class="op" id="7618848">:=</span>&nbsp;<span class="keyword" id="7618851">range</span>&nbsp;<span class="ident" id="7618857">idents</span><span class="op" id="7618863">(</span><span class="ident" id="7618864">f1</span><span class="op" id="7618866">)</span>&nbsp;<span class="op" id="7618868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7618872">i2</span>&nbsp;<span class="op" id="7618875">:=</span>&nbsp;<span class="op" id="7618878">&lt;-</span><span class="ident" id="7618880">i2range</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7618891">if</span>&nbsp;<span class="ident" id="7618894">i2</span><span class="op" id="7618896">.</span><span class="ident" id="7618897">Name</span>&nbsp;<span class="op" id="7618902">!=</span>&nbsp;<span class="ident" id="7618905">i1</span><span class="op" id="7618907">.</span><span class="ident" id="7618908">Name</span>&nbsp;<span class="op" id="7618913">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7618918">t</span><span class="op" id="7618919">.</span><span class="ident" id="7618920">Errorf</span><span class="op" id="7618926">(</span><span class="string" id="7618927">&#34;got&nbsp;ident&nbsp;%s;&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7618950">,</span>&nbsp;<span class="ident" id="7618952">i2</span><span class="op" id="7618954">.</span><span class="ident" id="7618955">Name</span><span class="op" id="7618959">,</span>&nbsp;<span class="ident" id="7618961">i1</span><span class="op" id="7618963">.</span><span class="ident" id="7618964">Name</span><span class="op" id="7618968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7618972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7618977">l1</span>&nbsp;<span class="op" id="7618980">:=</span>&nbsp;<span class="ident" id="7618983">fset</span><span class="op" id="7618987">.</span><span class="ident" id="7618988">Position</span><span class="op" id="7618996">(</span><span class="ident" id="7618997">i1</span><span class="op" id="7618999">.</span><span class="ident" id="7619000">Pos</span><span class="op" id="7619003">(</span><span class="op" id="7619004">)</span><span class="op" id="7619005">)</span><span class="op" id="7619006">.</span><span class="ident" id="7619007">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7619014">l2</span>&nbsp;<span class="op" id="7619017">:=</span>&nbsp;<span class="ident" id="7619020">fset</span><span class="op" id="7619024">.</span><span class="ident" id="7619025">Position</span><span class="op" id="7619033">(</span><span class="ident" id="7619034">i2</span><span class="op" id="7619036">.</span><span class="ident" id="7619037">Pos</span><span class="op" id="7619040">(</span><span class="op" id="7619041">)</span><span class="op" id="7619042">)</span><span class="op" id="7619043">.</span><span class="ident" id="7619044">Line</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7619051">if</span>&nbsp;<span class="ident" id="7619054">l2</span>&nbsp;<span class="op" id="7619057">!=</span>&nbsp;<span class="ident" id="7619060">l1</span>&nbsp;<span class="op" id="7619063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7619068">t</span><span class="op" id="7619069">.</span><span class="ident" id="7619070">Errorf</span><span class="op" id="7619076">(</span><span class="string" id="7619077">&#34;got&nbsp;line&nbsp;%d;&nbsp;want&nbsp;%d&nbsp;for&nbsp;%s&#34;</span><span class="op" id="7619106">,</span>&nbsp;<span class="ident" id="7619108">l2</span><span class="op" id="7619110">,</span>&nbsp;<span class="ident" id="7619112">l1</span><span class="op" id="7619114">,</span>&nbsp;<span class="ident" id="7619116">i1</span><span class="op" id="7619118">.</span><span class="ident" id="7619119">Name</span><span class="op" id="7619123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7619127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7619130">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7619134">if</span>&nbsp;<span class="ident" id="7619137">t</span><span class="op" id="7619138">.</span><span class="ident" id="7619139">Failed</span><span class="op" id="7619145">(</span><span class="op" id="7619146">)</span>&nbsp;<span class="op" id="7619148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7619152">t</span><span class="op" id="7619153">.</span><span class="ident" id="7619154">Logf</span><span class="op" id="7619158">(</span><span class="string" id="7619159">&#34;\n%s&#34;</span><span class="op" id="7619165">,</span>&nbsp;<span class="ident" id="7619167">buf</span><span class="op" id="7619170">.</span><span class="ident" id="7619171">Bytes</span><span class="op" id="7619176">(</span><span class="op" id="7619177">)</span><span class="op" id="7619178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7619181">}</span><br>
<span class="lineno"></span><span class="op" id="7619183">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="keyword" id="7619186">var</span>&nbsp;<span class="ident" id="7619190">decls</span>&nbsp;<span class="op" id="7619196">=</span>&nbsp;<span class="op" id="7619198">[</span><span class="op" id="7619199">]</span><span class="builtintype" id="7619200">string</span><span class="op" id="7619206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7619209">`import&nbsp;&#34;fmt&#34;`</span><span class="op" id="7619223">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7619226">&#34;const&nbsp;pi&nbsp;=&nbsp;3.1415\nconst&nbsp;e&nbsp;=&nbsp;2.71828\n\nvar&nbsp;x&nbsp;=&nbsp;pi&#34;</span><span class="op" id="7619278">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7619281">&#34;func&nbsp;sum(x,&nbsp;y&nbsp;int)&nbsp;int\t{&nbsp;return&nbsp;x&nbsp;+&nbsp;y&nbsp;}&#34;</span><span class="op" id="7619323">,</span><br>
<span class="lineno"></span><span class="op" id="7619325">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span><span class="keyword" id="7619328">func</span>&nbsp;<span class="ident" id="7619333">TestDeclLists</span><span class="op" id="7619346">(</span><span class="ident" id="7619347">t</span>&nbsp;<span class="op" id="7619349">*</span><span class="ident" id="7619350">testing</span><span class="op" id="7619357">.</span><span class="ident" id="7619358">T</span><span class="op" id="7619359">)</span>&nbsp;<span class="op" id="7619361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7619364">for</span>&nbsp;<span class="ident" id="7619368">_</span><span class="op" id="7619369">,</span>&nbsp;<span class="ident" id="7619371">src</span>&nbsp;<span class="op" id="7619375">:=</span>&nbsp;<span class="keyword" id="7619378">range</span>&nbsp;<span class="ident" id="7619384">decls</span>&nbsp;<span class="op" id="7619390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7619394">file</span><span class="op" id="7619398">,</span>&nbsp;<span class="ident" id="7619400">err</span>&nbsp;<span class="op" id="7619404">:=</span>&nbsp;<span class="ident" id="7619407">parser</span><span class="op" id="7619413">.</span><span class="ident" id="7619414">ParseFile</span><span class="op" id="7619423">(</span><span class="ident" id="7619424">fset</span><span class="op" id="7619428">,</span>&nbsp;<span class="string" id="7619430">&#34;&#34;</span><span class="op" id="7619432">,</span>&nbsp;<span class="string" id="7619434">&#34;package&nbsp;p;&#34;</span><span class="op" id="7619446">+</span><span class="ident" id="7619447">src</span><span class="op" id="7619450">,</span>&nbsp;<span class="ident" id="7619452">parser</span><span class="op" id="7619458">.</span><span class="ident" id="7619459">ParseComments</span><span class="op" id="7619472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7619476">if</span>&nbsp;<span class="ident" id="7619479">err</span>&nbsp;<span class="op" id="7619483">!=</span>&nbsp;<span class="ident" id="7619486">nil</span>&nbsp;<span class="op" id="7619490">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7619495">panic</span><span class="op" id="7619500">(</span><span class="ident" id="7619501">err</span><span class="op" id="7619504">)</span>&nbsp;<span class="comment" id="7619506">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7619525">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7619530">var</span>&nbsp;<span class="ident" id="7619534">buf</span>&nbsp;<span class="ident" id="7619538">bytes</span><span class="op" id="7619543">.</span><span class="ident" id="7619544">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7619553">err</span>&nbsp;<span class="op" id="7619557">=</span>&nbsp;<span class="ident" id="7619559">Fprint</span><span class="op" id="7619565">(</span><span class="op" id="7619566">&amp;</span><span class="ident" id="7619567">buf</span><span class="op" id="7619570">,</span>&nbsp;<span class="ident" id="7619572">fset</span><span class="op" id="7619576">,</span>&nbsp;<span class="ident" id="7619578">file</span><span class="op" id="7619582">.</span><span class="ident" id="7619583">Decls</span><span class="op" id="7619588">)</span>&nbsp;<span class="comment" id="7619590">//&nbsp;only&nbsp;print&nbsp;declarations</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7619619">if</span>&nbsp;<span class="ident" id="7619622">err</span>&nbsp;<span class="op" id="7619626">!=</span>&nbsp;<span class="ident" id="7619629">nil</span>&nbsp;<span class="op" id="7619633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7619638">panic</span><span class="op" id="7619643">(</span><span class="ident" id="7619644">err</span><span class="op" id="7619647">)</span>&nbsp;<span class="comment" id="7619649">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7619668">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7619673">out</span>&nbsp;<span class="op" id="7619677">:=</span>&nbsp;<span class="ident" id="7619680">buf</span><span class="op" id="7619683">.</span><span class="ident" id="7619684">String</span><span class="op" id="7619690">(</span><span class="op" id="7619691">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7619695">if</span>&nbsp;<span class="ident" id="7619698">out</span>&nbsp;<span class="op" id="7619702">!=</span>&nbsp;<span class="ident" id="7619705">src</span>&nbsp;<span class="op" id="7619709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7619714">t</span><span class="op" id="7619715">.</span><span class="ident" id="7619716">Errorf</span><span class="op" id="7619722">(</span><span class="string" id="7619723">&#34;\ngot&nbsp;:&nbsp;%q\nwant:&nbsp;%q\n&#34;</span><span class="op" id="7619747">,</span>&nbsp;<span class="ident" id="7619749">out</span><span class="op" id="7619752">,</span>&nbsp;<span class="ident" id="7619754">src</span><span class="op" id="7619757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7619761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7619764">}</span><br>
<span class="lineno"></span><span class="op" id="7619766">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="keyword" id="7619769">var</span>&nbsp;<span class="ident" id="7619773">stmts</span>&nbsp;<span class="op" id="7619779">=</span>&nbsp;<span class="op" id="7619781">[</span><span class="op" id="7619782">]</span><span class="builtintype" id="7619783">string</span><span class="op" id="7619789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7619792">&#34;i&nbsp;:=&nbsp;0&#34;</span><span class="op" id="7619800">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7619803">&#34;select&nbsp;{}\nvar&nbsp;a,&nbsp;b&nbsp;=&nbsp;1,&nbsp;2\nreturn&nbsp;a&nbsp;+&nbsp;b&#34;</span><span class="op" id="7619845">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7619848">&#34;go&nbsp;f()\ndefer&nbsp;func()&nbsp;{}()&#34;</span><span class="op" id="7619875">,</span><br>
<span class="lineno">460</span><span class="op" id="7619877">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7619880">func</span>&nbsp;<span class="ident" id="7619885">TestStmtLists</span><span class="op" id="7619898">(</span><span class="ident" id="7619899">t</span>&nbsp;<span class="op" id="7619901">*</span><span class="ident" id="7619902">testing</span><span class="op" id="7619909">.</span><span class="ident" id="7619910">T</span><span class="op" id="7619911">)</span>&nbsp;<span class="op" id="7619913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7619916">for</span>&nbsp;<span class="ident" id="7619920">_</span><span class="op" id="7619921">,</span>&nbsp;<span class="ident" id="7619923">src</span>&nbsp;<span class="op" id="7619927">:=</span>&nbsp;<span class="keyword" id="7619930">range</span>&nbsp;<span class="ident" id="7619936">stmts</span>&nbsp;<span class="op" id="7619942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7619946">file</span><span class="op" id="7619950">,</span>&nbsp;<span class="ident" id="7619952">err</span>&nbsp;<span class="op" id="7619956">:=</span>&nbsp;<span class="ident" id="7619959">parser</span><span class="op" id="7619965">.</span><span class="ident" id="7619966">ParseFile</span><span class="op" id="7619975">(</span><span class="ident" id="7619976">fset</span><span class="op" id="7619980">,</span>&nbsp;<span class="string" id="7619982">&#34;&#34;</span><span class="op" id="7619984">,</span>&nbsp;<span class="string" id="7619986">&#34;package&nbsp;p;&nbsp;func&nbsp;_()&nbsp;{&#34;</span><span class="op" id="7620009">+</span><span class="ident" id="7620010">src</span><span class="op" id="7620013">+</span><span class="string" id="7620014">&#34;}&#34;</span><span class="op" id="7620017">,</span>&nbsp;<span class="ident" id="7620019">parser</span><span class="op" id="7620025">.</span><span class="ident" id="7620026">ParseComments</span><span class="op" id="7620039">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7620043">if</span>&nbsp;<span class="ident" id="7620046">err</span>&nbsp;<span class="op" id="7620050">!=</span>&nbsp;<span class="ident" id="7620053">nil</span>&nbsp;<span class="op" id="7620057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7620062">panic</span><span class="op" id="7620067">(</span><span class="ident" id="7620068">err</span><span class="op" id="7620071">)</span>&nbsp;<span class="comment" id="7620073">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7620092">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7620097">var</span>&nbsp;<span class="ident" id="7620101">buf</span>&nbsp;<span class="ident" id="7620105">bytes</span><span class="op" id="7620110">.</span><span class="ident" id="7620111">Buffer</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7620120">err</span>&nbsp;<span class="op" id="7620124">=</span>&nbsp;<span class="ident" id="7620126">Fprint</span><span class="op" id="7620132">(</span><span class="op" id="7620133">&amp;</span><span class="ident" id="7620134">buf</span><span class="op" id="7620137">,</span>&nbsp;<span class="ident" id="7620139">fset</span><span class="op" id="7620143">,</span>&nbsp;<span class="ident" id="7620145">file</span><span class="op" id="7620149">.</span><span class="ident" id="7620150">Decls</span><span class="op" id="7620155">[</span><span class="num" id="7620156">0</span><span class="op" id="7620157">]</span><span class="op" id="7620158">.</span><span class="op" id="7620159">(</span><span class="op" id="7620160">*</span><span class="ident" id="7620161">ast</span><span class="op" id="7620164">.</span><span class="ident" id="7620165">FuncDecl</span><span class="op" id="7620173">)</span><span class="op" id="7620174">.</span><span class="ident" id="7620175">Body</span><span class="op" id="7620179">.</span><span class="ident" id="7620180">List</span><span class="op" id="7620184">)</span>&nbsp;<span class="comment" id="7620186">//&nbsp;only&nbsp;print&nbsp;statements</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7620213">if</span>&nbsp;<span class="ident" id="7620216">err</span>&nbsp;<span class="op" id="7620220">!=</span>&nbsp;<span class="ident" id="7620223">nil</span>&nbsp;<span class="op" id="7620227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7620232">panic</span><span class="op" id="7620237">(</span><span class="ident" id="7620238">err</span><span class="op" id="7620241">)</span>&nbsp;<span class="comment" id="7620243">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7620262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7620267">out</span>&nbsp;<span class="op" id="7620271">:=</span>&nbsp;<span class="ident" id="7620274">buf</span><span class="op" id="7620277">.</span><span class="ident" id="7620278">String</span><span class="op" id="7620284">(</span><span class="op" id="7620285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7620289">if</span>&nbsp;<span class="ident" id="7620292">out</span>&nbsp;<span class="op" id="7620296">!=</span>&nbsp;<span class="ident" id="7620299">src</span>&nbsp;<span class="op" id="7620303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7620308">t</span><span class="op" id="7620309">.</span><span class="ident" id="7620310">Errorf</span><span class="op" id="7620316">(</span><span class="string" id="7620317">&#34;\ngot&nbsp;:&nbsp;%q\nwant:&nbsp;%q\n&#34;</span><span class="op" id="7620341">,</span>&nbsp;<span class="ident" id="7620343">out</span><span class="op" id="7620346">,</span>&nbsp;<span class="ident" id="7620348">src</span><span class="op" id="7620351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7620355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7620358">}</span><br>
<span class="lineno">480</span><span class="op" id="7620360">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7620363">func</span>&nbsp;<span class="ident" id="7620368">TestBaseIndent</span><span class="op" id="7620382">(</span><span class="ident" id="7620383">t</span>&nbsp;<span class="op" id="7620385">*</span><span class="ident" id="7620386">testing</span><span class="op" id="7620393">.</span><span class="ident" id="7620394">T</span><span class="op" id="7620395">)</span>&nbsp;<span class="op" id="7620397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7620400">//&nbsp;The&nbsp;testfile&nbsp;must&nbsp;not&nbsp;contain&nbsp;multi-line&nbsp;raw&nbsp;strings&nbsp;since&nbsp;those</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7620469">//&nbsp;are&nbsp;not&nbsp;indented&nbsp;(because&nbsp;their&nbsp;values&nbsp;must&nbsp;not&nbsp;change)&nbsp;and&nbsp;make</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7620538">//&nbsp;this&nbsp;test&nbsp;fail.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7620558">const</span>&nbsp;<span class="ident" id="7620564">filename</span>&nbsp;<span class="op" id="7620573">=</span>&nbsp;<span class="string" id="7620575">&#34;printer.go&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7620589">src</span><span class="op" id="7620592">,</span>&nbsp;<span class="ident" id="7620594">err</span>&nbsp;<span class="op" id="7620598">:=</span>&nbsp;<span class="ident" id="7620601">ioutil</span><span class="op" id="7620607">.</span><span class="ident" id="7620608">ReadFile</span><span class="op" id="7620616">(</span><span class="ident" id="7620617">filename</span><span class="op" id="7620625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7620628">if</span>&nbsp;<span class="ident" id="7620631">err</span>&nbsp;<span class="op" id="7620635">!=</span>&nbsp;<span class="ident" id="7620638">nil</span>&nbsp;<span class="op" id="7620642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7620646">panic</span><span class="op" id="7620651">(</span><span class="ident" id="7620652">err</span><span class="op" id="7620655">)</span>&nbsp;<span class="comment" id="7620657">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7620675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7620679">file</span><span class="op" id="7620683">,</span>&nbsp;<span class="ident" id="7620685">err</span>&nbsp;<span class="op" id="7620689">:=</span>&nbsp;<span class="ident" id="7620692">parser</span><span class="op" id="7620698">.</span><span class="ident" id="7620699">ParseFile</span><span class="op" id="7620708">(</span><span class="ident" id="7620709">fset</span><span class="op" id="7620713">,</span>&nbsp;<span class="ident" id="7620715">filename</span><span class="op" id="7620723">,</span>&nbsp;<span class="ident" id="7620725">src</span><span class="op" id="7620728">,</span>&nbsp;<span class="num" id="7620730">0</span><span class="op" id="7620731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7620734">if</span>&nbsp;<span class="ident" id="7620737">err</span>&nbsp;<span class="op" id="7620741">!=</span>&nbsp;<span class="ident" id="7620744">nil</span>&nbsp;<span class="op" id="7620748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7620752">panic</span><span class="op" id="7620757">(</span><span class="ident" id="7620758">err</span><span class="op" id="7620761">)</span>&nbsp;<span class="comment" id="7620763">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7620781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7620785">var</span>&nbsp;<span class="ident" id="7620789">buf</span>&nbsp;<span class="ident" id="7620793">bytes</span><span class="op" id="7620798">.</span><span class="ident" id="7620799">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7620807">for</span>&nbsp;<span class="ident" id="7620811">indent</span>&nbsp;<span class="op" id="7620818">:=</span>&nbsp;<span class="num" id="7620821">0</span><span class="op" id="7620822">;</span>&nbsp;<span class="ident" id="7620824">indent</span>&nbsp;<span class="op" id="7620831">&lt;</span>&nbsp;<span class="num" id="7620833">4</span><span class="op" id="7620834">;</span>&nbsp;<span class="ident" id="7620836">indent</span><span class="op" id="7620842">++</span>&nbsp;<span class="op" id="7620845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7620849">buf</span><span class="op" id="7620852">.</span><span class="ident" id="7620853">Reset</span><span class="op" id="7620858">(</span><span class="op" id="7620859">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7620863">(</span><span class="op" id="7620864">&amp;</span><span class="ident" id="7620865">Config</span><span class="op" id="7620871">{</span><span class="ident" id="7620872">Tabwidth</span><span class="op" id="7620880">:</span>&nbsp;<span class="ident" id="7620882">tabwidth</span><span class="op" id="7620890">,</span>&nbsp;<span class="ident" id="7620892">Indent</span><span class="op" id="7620898">:</span>&nbsp;<span class="ident" id="7620900">indent</span><span class="op" id="7620906">}</span><span class="op" id="7620907">)</span><span class="op" id="7620908">.</span><span class="ident" id="7620909">Fprint</span><span class="op" id="7620915">(</span><span class="op" id="7620916">&amp;</span><span class="ident" id="7620917">buf</span><span class="op" id="7620920">,</span>&nbsp;<span class="ident" id="7620922">fset</span><span class="op" id="7620926">,</span>&nbsp;<span class="ident" id="7620928">file</span><span class="op" id="7620932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7620936">//&nbsp;all&nbsp;code&nbsp;must&nbsp;be&nbsp;indented&nbsp;by&nbsp;at&nbsp;least&nbsp;&#39;indent&#39;&nbsp;tabs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7620993">lines</span>&nbsp;<span class="op" id="7620999">:=</span>&nbsp;<span class="ident" id="7621002">bytes</span><span class="op" id="7621007">.</span><span class="ident" id="7621008">Split</span><span class="op" id="7621013">(</span><span class="ident" id="7621014">buf</span><span class="op" id="7621017">.</span><span class="ident" id="7621018">Bytes</span><span class="op" id="7621023">(</span><span class="op" id="7621024">)</span><span class="op" id="7621025">,</span>&nbsp;<span class="op" id="7621027">[</span><span class="op" id="7621028">]</span><span class="builtintype" id="7621029">byte</span><span class="op" id="7621033">{</span><span class="string" id="7621034">&#39;\n&#39;</span><span class="op" id="7621038">}</span><span class="op" id="7621039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7621043">for</span>&nbsp;<span class="ident" id="7621047">i</span><span class="op" id="7621048">,</span>&nbsp;<span class="ident" id="7621050">line</span>&nbsp;<span class="op" id="7621055">:=</span>&nbsp;<span class="keyword" id="7621058">range</span>&nbsp;<span class="ident" id="7621064">lines</span>&nbsp;<span class="op" id="7621070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7621075">if</span>&nbsp;<span class="builtinfunc" id="7621078">len</span><span class="op" id="7621081">(</span><span class="ident" id="7621082">line</span><span class="op" id="7621086">)</span>&nbsp;<span class="op" id="7621088">==</span>&nbsp;<span class="num" id="7621091">0</span>&nbsp;<span class="op" id="7621093">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7621099">continue</span>&nbsp;<span class="comment" id="7621108">//&nbsp;empty&nbsp;lines&nbsp;don&#39;t&nbsp;have&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7621149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7621154">n</span>&nbsp;<span class="op" id="7621156">:=</span>&nbsp;<span class="num" id="7621159">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7621164">for</span>&nbsp;<span class="ident" id="7621168">j</span><span class="op" id="7621169">,</span>&nbsp;<span class="ident" id="7621171">b</span>&nbsp;<span class="op" id="7621173">:=</span>&nbsp;<span class="keyword" id="7621176">range</span>&nbsp;<span class="ident" id="7621182">line</span>&nbsp;<span class="op" id="7621187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7621193">if</span>&nbsp;<span class="ident" id="7621196">b</span>&nbsp;<span class="op" id="7621198">!=</span>&nbsp;<span class="string" id="7621201">&#39;\t&#39;</span>&nbsp;<span class="op" id="7621206">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7621213">//&nbsp;end&nbsp;of&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7621240">n</span>&nbsp;<span class="op" id="7621242">=</span>&nbsp;<span class="ident" id="7621244">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7621251">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7621261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7621266">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7621271">if</span>&nbsp;<span class="ident" id="7621274">n</span>&nbsp;<span class="op" id="7621276">&lt;</span>&nbsp;<span class="ident" id="7621278">indent</span>&nbsp;<span class="op" id="7621285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7621291">t</span><span class="op" id="7621292">.</span><span class="ident" id="7621293">Errorf</span><span class="op" id="7621299">(</span><span class="string" id="7621300">&#34;line&nbsp;%d:&nbsp;got&nbsp;only&nbsp;%d&nbsp;tabs;&nbsp;want&nbsp;at&nbsp;least&nbsp;%d:&nbsp;%q&#34;</span><span class="op" id="7621349">,</span>&nbsp;<span class="ident" id="7621351">i</span><span class="op" id="7621352">,</span>&nbsp;<span class="ident" id="7621354">n</span><span class="op" id="7621355">,</span>&nbsp;<span class="ident" id="7621357">indent</span><span class="op" id="7621363">,</span>&nbsp;<span class="ident" id="7621365">line</span><span class="op" id="7621369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7621374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7621378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7621381">}</span><br>
<span class="lineno">520</span><span class="op" id="7621383">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7621386">//&nbsp;TestFuncType&nbsp;tests&nbsp;that&nbsp;an&nbsp;ast.FuncType&nbsp;with&nbsp;a&nbsp;nil&nbsp;Params&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="7621453">//&nbsp;can&nbsp;be&nbsp;printed&nbsp;(per&nbsp;go/ast&nbsp;specification).&nbsp;Test&nbsp;case&nbsp;for&nbsp;issue&nbsp;3870.</span><br>
<span class="lineno"></span><span class="keyword" id="7621525">func</span>&nbsp;<span class="ident" id="7621530">TestFuncType</span><span class="op" id="7621542">(</span><span class="ident" id="7621543">t</span>&nbsp;<span class="op" id="7621545">*</span><span class="ident" id="7621546">testing</span><span class="op" id="7621553">.</span><span class="ident" id="7621554">T</span><span class="op" id="7621555">)</span>&nbsp;<span class="op" id="7621557">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7621560">src</span>&nbsp;<span class="op" id="7621564">:=</span>&nbsp;<span class="op" id="7621567">&amp;</span><span class="ident" id="7621568">ast</span><span class="op" id="7621571">.</span><span class="ident" id="7621572">File</span><span class="op" id="7621576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7621580">Name</span><span class="op" id="7621584">:</span>&nbsp;<span class="op" id="7621586">&amp;</span><span class="ident" id="7621587">ast</span><span class="op" id="7621590">.</span><span class="ident" id="7621591">Ident</span><span class="op" id="7621596">{</span><span class="ident" id="7621597">Name</span><span class="op" id="7621601">:</span>&nbsp;<span class="string" id="7621603">&#34;p&#34;</span><span class="op" id="7621606">}</span><span class="op" id="7621607">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7621611">Decls</span><span class="op" id="7621616">:</span>&nbsp;<span class="op" id="7621618">[</span><span class="op" id="7621619">]</span><span class="ident" id="7621620">ast</span><span class="op" id="7621623">.</span><span class="ident" id="7621624">Decl</span><span class="op" id="7621628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7621633">&amp;</span><span class="ident" id="7621634">ast</span><span class="op" id="7621637">.</span><span class="ident" id="7621638">FuncDecl</span><span class="op" id="7621646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7621652">Name</span><span class="op" id="7621656">:</span>&nbsp;<span class="op" id="7621658">&amp;</span><span class="ident" id="7621659">ast</span><span class="op" id="7621662">.</span><span class="ident" id="7621663">Ident</span><span class="op" id="7621668">{</span><span class="ident" id="7621669">Name</span><span class="op" id="7621673">:</span>&nbsp;<span class="string" id="7621675">&#34;f&#34;</span><span class="op" id="7621678">}</span><span class="op" id="7621679">,</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7621685">Type</span><span class="op" id="7621689">:</span>&nbsp;<span class="op" id="7621691">&amp;</span><span class="ident" id="7621692">ast</span><span class="op" id="7621695">.</span><span class="ident" id="7621696">FuncType</span><span class="op" id="7621704">{</span><span class="op" id="7621705">}</span><span class="op" id="7621706">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7621711">}</span><span class="op" id="7621712">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7621716">}</span><span class="op" id="7621717">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7621720">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7621724">var</span>&nbsp;<span class="ident" id="7621728">buf</span>&nbsp;<span class="ident" id="7621732">bytes</span><span class="op" id="7621737">.</span><span class="ident" id="7621738">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7621746">if</span>&nbsp;<span class="ident" id="7621749">err</span>&nbsp;<span class="op" id="7621753">:=</span>&nbsp;<span class="ident" id="7621756">Fprint</span><span class="op" id="7621762">(</span><span class="op" id="7621763">&amp;</span><span class="ident" id="7621764">buf</span><span class="op" id="7621767">,</span>&nbsp;<span class="ident" id="7621769">fset</span><span class="op" id="7621773">,</span>&nbsp;<span class="ident" id="7621775">src</span><span class="op" id="7621778">)</span><span class="op" id="7621779">;</span>&nbsp;<span class="ident" id="7621781">err</span>&nbsp;<span class="op" id="7621785">!=</span>&nbsp;<span class="ident" id="7621788">nil</span>&nbsp;<span class="op" id="7621792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7621796">t</span><span class="op" id="7621797">.</span><span class="ident" id="7621798">Fatal</span><span class="op" id="7621803">(</span><span class="ident" id="7621804">err</span><span class="op" id="7621807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7621810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7621813">got</span>&nbsp;<span class="op" id="7621817">:=</span>&nbsp;<span class="ident" id="7621820">buf</span><span class="op" id="7621823">.</span><span class="ident" id="7621824">String</span><span class="op" id="7621830">(</span><span class="op" id="7621831">)</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7621835">const</span>&nbsp;<span class="ident" id="7621841">want</span>&nbsp;<span class="op" id="7621846">=</span>&nbsp;<span class="string" id="7621848">`package&nbsp;p<br>
<span class="lineno"></span><br>
<span class="lineno"></span>func&nbsp;f()<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7621873">if</span>&nbsp;<span class="ident" id="7621876">got</span>&nbsp;<span class="op" id="7621880">!=</span>&nbsp;<span class="ident" id="7621883">want</span>&nbsp;<span class="op" id="7621888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7621892">t</span><span class="op" id="7621893">.</span><span class="ident" id="7621894">Fatalf</span><span class="op" id="7621900">(</span><span class="string" id="7621901">&#34;got:\n%s\nwant:\n%s\n&#34;</span><span class="op" id="7621924">,</span>&nbsp;<span class="ident" id="7621926">got</span><span class="op" id="7621929">,</span>&nbsp;<span class="ident" id="7621931">want</span><span class="op" id="7621935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7621938">}</span><br>
<span class="lineno"></span><span class="op" id="7621940">}</span><br>
<span class="lineno">550</span><br>
<span class="lineno"></span><span class="comment" id="7621943">//&nbsp;TextX&nbsp;is&nbsp;a&nbsp;skeleton&nbsp;test&nbsp;that&nbsp;can&nbsp;be&nbsp;filled&nbsp;in&nbsp;for&nbsp;debugging&nbsp;one-off&nbsp;cases.</span><br>
<span class="lineno"></span><span class="comment" id="7622022">//&nbsp;Do&nbsp;not&nbsp;remove.</span><br>
<span class="lineno"></span><span class="keyword" id="7622040">func</span>&nbsp;<span class="ident" id="7622045">TestX</span><span class="op" id="7622050">(</span><span class="ident" id="7622051">t</span>&nbsp;<span class="op" id="7622053">*</span><span class="ident" id="7622054">testing</span><span class="op" id="7622061">.</span><span class="ident" id="7622062">T</span><span class="op" id="7622063">)</span>&nbsp;<span class="op" id="7622065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7622068">const</span>&nbsp;<span class="ident" id="7622074">src</span>&nbsp;<span class="op" id="7622078">=</span>&nbsp;<span class="string" id="7622080">`<br>
<span class="lineno">555</span>package&nbsp;p<br>
<span class="lineno"></span>func&nbsp;_()&nbsp;{}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7622107">_</span><span class="op" id="7622108">,</span>&nbsp;<span class="ident" id="7622110">err</span>&nbsp;<span class="op" id="7622114">:=</span>&nbsp;<span class="ident" id="7622117">format</span><span class="op" id="7622123">(</span><span class="op" id="7622124">[</span><span class="op" id="7622125">]</span><span class="builtintype" id="7622126">byte</span><span class="op" id="7622130">(</span><span class="ident" id="7622131">src</span><span class="op" id="7622134">)</span><span class="op" id="7622135">,</span>&nbsp;<span class="num" id="7622137">0</span><span class="op" id="7622138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7622141">if</span>&nbsp;<span class="ident" id="7622144">err</span>&nbsp;<span class="op" id="7622148">!=</span>&nbsp;<span class="ident" id="7622151">nil</span>&nbsp;<span class="op" id="7622155">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7622159">t</span><span class="op" id="7622160">.</span><span class="ident" id="7622161">Error</span><span class="op" id="7622166">(</span><span class="ident" id="7622167">err</span><span class="op" id="7622170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7622173">}</span><br>
<span class="lineno"></span><span class="op" id="7622175">}</span>
</div>
</body>
</html>
