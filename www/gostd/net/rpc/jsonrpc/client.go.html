<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/rpc/jsonrpc</h2>
<ul>
<li><a href="/gostd/net/rpc/jsonrpc/all_test.go.html">all_test.go</a></li>
<li><a href="/gostd/net/rpc/jsonrpc/client.go.html" class="current">client.go</a></li>
<li><a href="/gostd/net/rpc/jsonrpc/server.go.html">server.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6156928">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6156984">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6157038">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6157089">//&nbsp;Package&nbsp;jsonrpc&nbsp;implements&nbsp;a&nbsp;JSON-RPC&nbsp;ClientCodec&nbsp;and&nbsp;ServerCodec</span><br>
<span class="lineno"></span><span class="comment" id="6157158">//&nbsp;for&nbsp;the&nbsp;rpc&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="6157182">package</span>&nbsp;<span class="ident" id="6157190">jsonrpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6157199">import</span>&nbsp;<span class="op" id="6157206">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6157209">&#34;encoding/json&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6157226">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6157233">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6157239">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6157246">&#34;net/rpc&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6157257">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="6157264">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6157267">type</span>&nbsp;<span class="ident" id="6157272">clientCodec</span>&nbsp;<span class="keyword" id="6157284">struct</span>&nbsp;<span class="op" id="6157291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6157294">dec</span>&nbsp;<span class="op" id="6157298">*</span><span class="ident" id="6157299">json</span><span class="op" id="6157303">.</span><span class="ident" id="6157304">Decoder</span>&nbsp;<span class="comment" id="6157312">//&nbsp;for&nbsp;reading&nbsp;JSON&nbsp;values</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6157340">enc</span>&nbsp;<span class="op" id="6157344">*</span><span class="ident" id="6157345">json</span><span class="op" id="6157349">.</span><span class="ident" id="6157350">Encoder</span>&nbsp;<span class="comment" id="6157358">//&nbsp;for&nbsp;writing&nbsp;JSON&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6157386">c</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6157390">io</span><span class="op" id="6157392">.</span><span class="ident" id="6157393">Closer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6157402">//&nbsp;temporary&nbsp;work&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6157427">req</span>&nbsp;&nbsp;<span class="ident" id="6157432">clientRequest</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6157447">resp</span>&nbsp;<span class="ident" id="6157452">clientResponse</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6157469">//&nbsp;JSON-RPC&nbsp;responses&nbsp;include&nbsp;the&nbsp;request&nbsp;id&nbsp;but&nbsp;not&nbsp;the&nbsp;request&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6157543">//&nbsp;Package&nbsp;rpc&nbsp;expects&nbsp;both.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6157573">//&nbsp;We&nbsp;save&nbsp;the&nbsp;request&nbsp;method&nbsp;in&nbsp;pending&nbsp;when&nbsp;sending&nbsp;a&nbsp;request</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6157638">//&nbsp;and&nbsp;then&nbsp;look&nbsp;it&nbsp;up&nbsp;by&nbsp;request&nbsp;ID&nbsp;when&nbsp;filling&nbsp;out&nbsp;the&nbsp;rpc&nbsp;Response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6157711">mutex</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6157719">sync</span><span class="op" id="6157723">.</span><span class="ident" id="6157724">Mutex</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6157737">//&nbsp;protects&nbsp;pending</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6157758">pending</span>&nbsp;<span class="keyword" id="6157766">map</span><span class="op" id="6157769">[</span><span class="builtintype" id="6157770">uint64</span><span class="op" id="6157776">]</span><span class="builtintype" id="6157777">string</span>&nbsp;<span class="comment" id="6157784">//&nbsp;map&nbsp;request&nbsp;id&nbsp;to&nbsp;method&nbsp;name</span><br>
<span class="lineno"></span><span class="op" id="6157817">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="6157820">//&nbsp;NewClientCodec&nbsp;returns&nbsp;a&nbsp;new&nbsp;rpc.ClientCodec&nbsp;using&nbsp;JSON-RPC&nbsp;on&nbsp;conn.</span><br>
<span class="lineno"></span><span class="keyword" id="6157892">func</span>&nbsp;<span class="ident" id="6157897">NewClientCodec</span><span class="op" id="6157911">(</span><span class="ident" id="6157912">conn</span>&nbsp;<span class="ident" id="6157917">io</span><span class="op" id="6157919">.</span><span class="ident" id="6157920">ReadWriteCloser</span><span class="op" id="6157935">)</span>&nbsp;<span class="ident" id="6157937">rpc</span><span class="op" id="6157940">.</span><span class="ident" id="6157941">ClientCodec</span>&nbsp;<span class="op" id="6157953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6157956">return</span>&nbsp;<span class="op" id="6157963">&amp;</span><span class="ident" id="6157964">clientCodec</span><span class="op" id="6157975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6157979">dec</span><span class="op" id="6157982">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6157988">json</span><span class="op" id="6157992">.</span><span class="ident" id="6157993">NewDecoder</span><span class="op" id="6158003">(</span><span class="ident" id="6158004">conn</span><span class="op" id="6158008">)</span><span class="op" id="6158009">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6158013">enc</span><span class="op" id="6158016">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6158022">json</span><span class="op" id="6158026">.</span><span class="ident" id="6158027">NewEncoder</span><span class="op" id="6158037">(</span><span class="ident" id="6158038">conn</span><span class="op" id="6158042">)</span><span class="op" id="6158043">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6158047">c</span><span class="op" id="6158048">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6158056">conn</span><span class="op" id="6158060">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6158064">pending</span><span class="op" id="6158071">:</span>&nbsp;<span class="builtinfunc" id="6158073">make</span><span class="op" id="6158077">(</span><span class="keyword" id="6158078">map</span><span class="op" id="6158081">[</span><span class="builtintype" id="6158082">uint64</span><span class="op" id="6158088">]</span><span class="builtintype" id="6158089">string</span><span class="op" id="6158095">)</span><span class="op" id="6158096">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6158099">}</span><br>
<span class="lineno"></span><span class="op" id="6158101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="6158104">type</span>&nbsp;<span class="ident" id="6158109">clientRequest</span>&nbsp;<span class="keyword" id="6158123">struct</span>&nbsp;<span class="op" id="6158130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6158133">Method</span>&nbsp;<span class="builtintype" id="6158140">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6158155">`json:&#34;method&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6158172">Params</span>&nbsp;<span class="op" id="6158179">[</span><span class="num" id="6158180">1</span><span class="op" id="6158181">]</span><span class="keyword" id="6158182">interface</span><span class="op" id="6158191">{</span><span class="op" id="6158192">}</span>&nbsp;<span class="string" id="6158194">`json:&#34;params&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6158211">Id</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6158218">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6158233">`json:&#34;id&#34;`</span><br>
<span class="lineno"></span><span class="op" id="6158245">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="6158248">func</span>&nbsp;<span class="op" id="6158253">(</span><span class="ident" id="6158254">c</span>&nbsp;<span class="op" id="6158256">*</span><span class="ident" id="6158257">clientCodec</span><span class="op" id="6158268">)</span>&nbsp;<span class="ident" id="6158270">WriteRequest</span><span class="op" id="6158282">(</span><span class="ident" id="6158283">r</span>&nbsp;<span class="op" id="6158285">*</span><span class="ident" id="6158286">rpc</span><span class="op" id="6158289">.</span><span class="ident" id="6158290">Request</span><span class="op" id="6158297">,</span>&nbsp;<span class="ident" id="6158299">param</span>&nbsp;<span class="keyword" id="6158305">interface</span><span class="op" id="6158314">{</span><span class="op" id="6158315">}</span><span class="op" id="6158316">)</span>&nbsp;<span class="builtintype" id="6158318">error</span>&nbsp;<span class="op" id="6158324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6158327">c</span><span class="op" id="6158328">.</span><span class="ident" id="6158329">mutex</span><span class="op" id="6158334">.</span><span class="ident" id="6158335">Lock</span><span class="op" id="6158339">(</span><span class="op" id="6158340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6158343">c</span><span class="op" id="6158344">.</span><span class="ident" id="6158345">pending</span><span class="op" id="6158352">[</span><span class="ident" id="6158353">r</span><span class="op" id="6158354">.</span><span class="ident" id="6158355">Seq</span><span class="op" id="6158358">]</span>&nbsp;<span class="op" id="6158360">=</span>&nbsp;<span class="ident" id="6158362">r</span><span class="op" id="6158363">.</span><span class="ident" id="6158364">ServiceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6158379">c</span><span class="op" id="6158380">.</span><span class="ident" id="6158381">mutex</span><span class="op" id="6158386">.</span><span class="ident" id="6158387">Unlock</span><span class="op" id="6158393">(</span><span class="op" id="6158394">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6158397">c</span><span class="op" id="6158398">.</span><span class="ident" id="6158399">req</span><span class="op" id="6158402">.</span><span class="ident" id="6158403">Method</span>&nbsp;<span class="op" id="6158410">=</span>&nbsp;<span class="ident" id="6158412">r</span><span class="op" id="6158413">.</span><span class="ident" id="6158414">ServiceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6158429">c</span><span class="op" id="6158430">.</span><span class="ident" id="6158431">req</span><span class="op" id="6158434">.</span><span class="ident" id="6158435">Params</span><span class="op" id="6158441">[</span><span class="num" id="6158442">0</span><span class="op" id="6158443">]</span>&nbsp;<span class="op" id="6158445">=</span>&nbsp;<span class="ident" id="6158447">param</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6158454">c</span><span class="op" id="6158455">.</span><span class="ident" id="6158456">req</span><span class="op" id="6158459">.</span><span class="ident" id="6158460">Id</span>&nbsp;<span class="op" id="6158463">=</span>&nbsp;<span class="ident" id="6158465">r</span><span class="op" id="6158466">.</span><span class="ident" id="6158467">Seq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6158472">return</span>&nbsp;<span class="ident" id="6158479">c</span><span class="op" id="6158480">.</span><span class="ident" id="6158481">enc</span><span class="op" id="6158484">.</span><span class="ident" id="6158485">Encode</span><span class="op" id="6158491">(</span><span class="op" id="6158492">&amp;</span><span class="ident" id="6158493">c</span><span class="op" id="6158494">.</span><span class="ident" id="6158495">req</span><span class="op" id="6158498">)</span><br>
<span class="lineno"></span><span class="op" id="6158500">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="6158503">type</span>&nbsp;<span class="ident" id="6158508">clientResponse</span>&nbsp;<span class="keyword" id="6158523">struct</span>&nbsp;<span class="op" id="6158530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6158533">Id</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6158540">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6158557">`json:&#34;id&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6158570">Result</span>&nbsp;<span class="op" id="6158577">*</span><span class="ident" id="6158578">json</span><span class="op" id="6158582">.</span><span class="ident" id="6158583">RawMessage</span>&nbsp;<span class="string" id="6158594">`json:&#34;result&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6158611">Error</span>&nbsp;&nbsp;<span class="keyword" id="6158618">interface</span><span class="op" id="6158627">{</span><span class="op" id="6158628">}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6158635">`json:&#34;error&#34;`</span><br>
<span class="lineno">65</span><span class="op" id="6158650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6158653">func</span>&nbsp;<span class="op" id="6158658">(</span><span class="ident" id="6158659">r</span>&nbsp;<span class="op" id="6158661">*</span><span class="ident" id="6158662">clientResponse</span><span class="op" id="6158676">)</span>&nbsp;<span class="ident" id="6158678">reset</span><span class="op" id="6158683">(</span><span class="op" id="6158684">)</span>&nbsp;<span class="op" id="6158686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6158689">r</span><span class="op" id="6158690">.</span><span class="ident" id="6158691">Id</span>&nbsp;<span class="op" id="6158694">=</span>&nbsp;<span class="num" id="6158696">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6158699">r</span><span class="op" id="6158700">.</span><span class="ident" id="6158701">Result</span>&nbsp;<span class="op" id="6158708">=</span>&nbsp;<span class="builtintype" id="6158710">nil</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6158715">r</span><span class="op" id="6158716">.</span><span class="ident" id="6158717">Error</span>&nbsp;<span class="op" id="6158723">=</span>&nbsp;<span class="builtintype" id="6158725">nil</span><br>
<span class="lineno"></span><span class="op" id="6158729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6158732">func</span>&nbsp;<span class="op" id="6158737">(</span><span class="ident" id="6158738">c</span>&nbsp;<span class="op" id="6158740">*</span><span class="ident" id="6158741">clientCodec</span><span class="op" id="6158752">)</span>&nbsp;<span class="ident" id="6158754">ReadResponseHeader</span><span class="op" id="6158772">(</span><span class="ident" id="6158773">r</span>&nbsp;<span class="op" id="6158775">*</span><span class="ident" id="6158776">rpc</span><span class="op" id="6158779">.</span><span class="ident" id="6158780">Response</span><span class="op" id="6158788">)</span>&nbsp;<span class="builtintype" id="6158790">error</span>&nbsp;<span class="op" id="6158796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6158799">c</span><span class="op" id="6158800">.</span><span class="ident" id="6158801">resp</span><span class="op" id="6158805">.</span><span class="ident" id="6158806">reset</span><span class="op" id="6158811">(</span><span class="op" id="6158812">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6158815">if</span>&nbsp;<span class="ident" id="6158818">err</span>&nbsp;<span class="op" id="6158822">:=</span>&nbsp;<span class="ident" id="6158825">c</span><span class="op" id="6158826">.</span><span class="ident" id="6158827">dec</span><span class="op" id="6158830">.</span><span class="ident" id="6158831">Decode</span><span class="op" id="6158837">(</span><span class="op" id="6158838">&amp;</span><span class="ident" id="6158839">c</span><span class="op" id="6158840">.</span><span class="ident" id="6158841">resp</span><span class="op" id="6158845">)</span><span class="op" id="6158846">;</span>&nbsp;<span class="ident" id="6158848">err</span>&nbsp;<span class="op" id="6158852">!=</span>&nbsp;<span class="builtintype" id="6158855">nil</span>&nbsp;<span class="op" id="6158859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6158863">return</span>&nbsp;<span class="ident" id="6158870">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6158875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6158879">c</span><span class="op" id="6158880">.</span><span class="ident" id="6158881">mutex</span><span class="op" id="6158886">.</span><span class="ident" id="6158887">Lock</span><span class="op" id="6158891">(</span><span class="op" id="6158892">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6158895">r</span><span class="op" id="6158896">.</span><span class="ident" id="6158897">ServiceMethod</span>&nbsp;<span class="op" id="6158911">=</span>&nbsp;<span class="ident" id="6158913">c</span><span class="op" id="6158914">.</span><span class="ident" id="6158915">pending</span><span class="op" id="6158922">[</span><span class="ident" id="6158923">c</span><span class="op" id="6158924">.</span><span class="ident" id="6158925">resp</span><span class="op" id="6158929">.</span><span class="ident" id="6158930">Id</span><span class="op" id="6158932">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6158935">delete</span><span class="op" id="6158941">(</span><span class="ident" id="6158942">c</span><span class="op" id="6158943">.</span><span class="ident" id="6158944">pending</span><span class="op" id="6158951">,</span>&nbsp;<span class="ident" id="6158953">c</span><span class="op" id="6158954">.</span><span class="ident" id="6158955">resp</span><span class="op" id="6158959">.</span><span class="ident" id="6158960">Id</span><span class="op" id="6158962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6158965">c</span><span class="op" id="6158966">.</span><span class="ident" id="6158967">mutex</span><span class="op" id="6158972">.</span><span class="ident" id="6158973">Unlock</span><span class="op" id="6158979">(</span><span class="op" id="6158980">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6158984">r</span><span class="op" id="6158985">.</span><span class="ident" id="6158986">Error</span>&nbsp;<span class="op" id="6158992">=</span>&nbsp;<span class="string" id="6158994">&#34;&#34;</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6158998">r</span><span class="op" id="6158999">.</span><span class="ident" id="6159000">Seq</span>&nbsp;<span class="op" id="6159004">=</span>&nbsp;<span class="ident" id="6159006">c</span><span class="op" id="6159007">.</span><span class="ident" id="6159008">resp</span><span class="op" id="6159012">.</span><span class="ident" id="6159013">Id</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6159017">if</span>&nbsp;<span class="ident" id="6159020">c</span><span class="op" id="6159021">.</span><span class="ident" id="6159022">resp</span><span class="op" id="6159026">.</span><span class="ident" id="6159027">Error</span>&nbsp;<span class="op" id="6159033">!=</span>&nbsp;<span class="builtintype" id="6159036">nil</span>&nbsp;<span class="op" id="6159040">||</span>&nbsp;<span class="ident" id="6159043">c</span><span class="op" id="6159044">.</span><span class="ident" id="6159045">resp</span><span class="op" id="6159049">.</span><span class="ident" id="6159050">Result</span>&nbsp;<span class="op" id="6159057">==</span>&nbsp;<span class="builtintype" id="6159060">nil</span>&nbsp;<span class="op" id="6159064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6159068">x</span><span class="op" id="6159069">,</span>&nbsp;<span class="ident" id="6159071">ok</span>&nbsp;<span class="op" id="6159074">:=</span>&nbsp;<span class="ident" id="6159077">c</span><span class="op" id="6159078">.</span><span class="ident" id="6159079">resp</span><span class="op" id="6159083">.</span><span class="ident" id="6159084">Error</span><span class="op" id="6159089">.</span><span class="op" id="6159090">(</span><span class="builtintype" id="6159091">string</span><span class="op" id="6159097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6159101">if</span>&nbsp;<span class="op" id="6159104">!</span><span class="ident" id="6159105">ok</span>&nbsp;<span class="op" id="6159108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6159113">return</span>&nbsp;<span class="ident" id="6159120">fmt</span><span class="op" id="6159123">.</span><span class="ident" id="6159124">Errorf</span><span class="op" id="6159130">(</span><span class="string" id="6159131">&#34;invalid&nbsp;error&nbsp;%v&#34;</span><span class="op" id="6159149">,</span>&nbsp;<span class="ident" id="6159151">c</span><span class="op" id="6159152">.</span><span class="ident" id="6159153">resp</span><span class="op" id="6159157">.</span><span class="ident" id="6159158">Error</span><span class="op" id="6159163">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6159167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6159171">if</span>&nbsp;<span class="ident" id="6159174">x</span>&nbsp;<span class="op" id="6159176">==</span>&nbsp;<span class="string" id="6159179">&#34;&#34;</span>&nbsp;<span class="op" id="6159182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6159187">x</span>&nbsp;<span class="op" id="6159189">=</span>&nbsp;<span class="string" id="6159191">&#34;unspecified&nbsp;error&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6159213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6159217">r</span><span class="op" id="6159218">.</span><span class="ident" id="6159219">Error</span>&nbsp;<span class="op" id="6159225">=</span>&nbsp;<span class="ident" id="6159227">x</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6159230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6159233">return</span>&nbsp;<span class="builtintype" id="6159240">nil</span><br>
<span class="lineno"></span><span class="op" id="6159244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6159247">func</span>&nbsp;<span class="op" id="6159252">(</span><span class="ident" id="6159253">c</span>&nbsp;<span class="op" id="6159255">*</span><span class="ident" id="6159256">clientCodec</span><span class="op" id="6159267">)</span>&nbsp;<span class="ident" id="6159269">ReadResponseBody</span><span class="op" id="6159285">(</span><span class="ident" id="6159286">x</span>&nbsp;<span class="keyword" id="6159288">interface</span><span class="op" id="6159297">{</span><span class="op" id="6159298">}</span><span class="op" id="6159299">)</span>&nbsp;<span class="builtintype" id="6159301">error</span>&nbsp;<span class="op" id="6159307">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6159310">if</span>&nbsp;<span class="ident" id="6159313">x</span>&nbsp;<span class="op" id="6159315">==</span>&nbsp;<span class="builtintype" id="6159318">nil</span>&nbsp;<span class="op" id="6159322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6159326">return</span>&nbsp;<span class="builtintype" id="6159333">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6159338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6159341">return</span>&nbsp;<span class="ident" id="6159348">json</span><span class="op" id="6159352">.</span><span class="ident" id="6159353">Unmarshal</span><span class="op" id="6159362">(</span><span class="op" id="6159363">*</span><span class="ident" id="6159364">c</span><span class="op" id="6159365">.</span><span class="ident" id="6159366">resp</span><span class="op" id="6159370">.</span><span class="ident" id="6159371">Result</span><span class="op" id="6159377">,</span>&nbsp;<span class="ident" id="6159379">x</span><span class="op" id="6159380">)</span><br>
<span class="lineno"></span><span class="op" id="6159382">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="6159385">func</span>&nbsp;<span class="op" id="6159390">(</span><span class="ident" id="6159391">c</span>&nbsp;<span class="op" id="6159393">*</span><span class="ident" id="6159394">clientCodec</span><span class="op" id="6159405">)</span>&nbsp;<span class="ident" id="6159407">Close</span><span class="op" id="6159412">(</span><span class="op" id="6159413">)</span>&nbsp;<span class="builtintype" id="6159415">error</span>&nbsp;<span class="op" id="6159421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6159424">return</span>&nbsp;<span class="ident" id="6159431">c</span><span class="op" id="6159432">.</span><span class="ident" id="6159433">c</span><span class="op" id="6159434">.</span><span class="ident" id="6159435">Close</span><span class="op" id="6159440">(</span><span class="op" id="6159441">)</span><br>
<span class="lineno"></span><span class="op" id="6159443">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="6159446">//&nbsp;NewClient&nbsp;returns&nbsp;a&nbsp;new&nbsp;rpc.Client&nbsp;to&nbsp;handle&nbsp;requests&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6159510">//&nbsp;set&nbsp;of&nbsp;services&nbsp;at&nbsp;the&nbsp;other&nbsp;end&nbsp;of&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="6159565">func</span>&nbsp;<span class="ident" id="6159570">NewClient</span><span class="op" id="6159579">(</span><span class="ident" id="6159580">conn</span>&nbsp;<span class="ident" id="6159585">io</span><span class="op" id="6159587">.</span><span class="ident" id="6159588">ReadWriteCloser</span><span class="op" id="6159603">)</span>&nbsp;<span class="op" id="6159605">*</span><span class="ident" id="6159606">rpc</span><span class="op" id="6159609">.</span><span class="ident" id="6159610">Client</span>&nbsp;<span class="op" id="6159617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6159620">return</span>&nbsp;<span class="ident" id="6159627">rpc</span><span class="op" id="6159630">.</span><span class="ident" id="6159631">NewClientWithCodec</span><span class="op" id="6159649">(</span><span class="ident" id="6159650">NewClientCodec</span><span class="op" id="6159664">(</span><span class="ident" id="6159665">conn</span><span class="op" id="6159669">)</span><span class="op" id="6159670">)</span><br>
<span class="lineno"></span><span class="op" id="6159672">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="6159675">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;a&nbsp;JSON-RPC&nbsp;server&nbsp;at&nbsp;the&nbsp;specified&nbsp;network&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="6159747">func</span>&nbsp;<span class="ident" id="6159752">Dial</span><span class="op" id="6159756">(</span><span class="ident" id="6159757">network</span><span class="op" id="6159764">,</span>&nbsp;<span class="ident" id="6159766">address</span>&nbsp;<span class="builtintype" id="6159774">string</span><span class="op" id="6159780">)</span>&nbsp;<span class="op" id="6159782">(</span><span class="op" id="6159783">*</span><span class="ident" id="6159784">rpc</span><span class="op" id="6159787">.</span><span class="ident" id="6159788">Client</span><span class="op" id="6159794">,</span>&nbsp;<span class="builtintype" id="6159796">error</span><span class="op" id="6159801">)</span>&nbsp;<span class="op" id="6159803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6159806">conn</span><span class="op" id="6159810">,</span>&nbsp;<span class="ident" id="6159812">err</span>&nbsp;<span class="op" id="6159816">:=</span>&nbsp;<span class="ident" id="6159819">net</span><span class="op" id="6159822">.</span><span class="ident" id="6159823">Dial</span><span class="op" id="6159827">(</span><span class="ident" id="6159828">network</span><span class="op" id="6159835">,</span>&nbsp;<span class="ident" id="6159837">address</span><span class="op" id="6159844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6159847">if</span>&nbsp;<span class="ident" id="6159850">err</span>&nbsp;<span class="op" id="6159854">!=</span>&nbsp;<span class="builtintype" id="6159857">nil</span>&nbsp;<span class="op" id="6159861">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6159865">return</span>&nbsp;<span class="builtintype" id="6159872">nil</span><span class="op" id="6159875">,</span>&nbsp;<span class="ident" id="6159877">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6159882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6159885">return</span>&nbsp;<span class="ident" id="6159892">NewClient</span><span class="op" id="6159901">(</span><span class="ident" id="6159902">conn</span><span class="op" id="6159906">)</span><span class="op" id="6159907">,</span>&nbsp;<span class="ident" id="6159909">err</span><br>
<span class="lineno"></span><span class="op" id="6159913">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
