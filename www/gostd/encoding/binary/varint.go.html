<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/binary</h2>
<ul>
<li><a href="/gostd/encoding/binary/binary.go.html">binary.go</a></li>
<li><a href="/gostd/encoding/binary/binary_test.go.html">binary_test.go</a></li>
<li><a href="/gostd/encoding/binary/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/binary/varint.go.html" class="current">varint.go</a></li>
<li><a href="/gostd/encoding/binary/varint_test.go.html">varint_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3062661">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3062717">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3062771">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3062822">package</span>&nbsp;<span class="ident" id="3062830">binary</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3062838">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;&#34;varint&#34;&nbsp;encoding&nbsp;of&nbsp;64-bit&nbsp;integers.</span><br>
<span class="lineno"></span><span class="comment" id="3062900">//&nbsp;The&nbsp;encoding&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="3062920">//&nbsp;-&nbsp;unsigned&nbsp;integers&nbsp;are&nbsp;serialized&nbsp;7&nbsp;bits&nbsp;at&nbsp;a&nbsp;time,&nbsp;starting&nbsp;with&nbsp;the</span><br>
<span class="lineno">10</span><span class="comment" id="3062994">//&nbsp;&nbsp;&nbsp;least&nbsp;significant&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="3063022">//&nbsp;-&nbsp;the&nbsp;most&nbsp;significant&nbsp;bit&nbsp;(msb)&nbsp;in&nbsp;each&nbsp;output&nbsp;byte&nbsp;indicates&nbsp;if&nbsp;there</span><br>
<span class="lineno"></span><span class="comment" id="3063097">//&nbsp;&nbsp;&nbsp;is&nbsp;a&nbsp;continuation&nbsp;byte&nbsp;(msb&nbsp;=&nbsp;1)</span><br>
<span class="lineno"></span><span class="comment" id="3063135">//&nbsp;-&nbsp;signed&nbsp;integers&nbsp;are&nbsp;mapped&nbsp;to&nbsp;unsigned&nbsp;integers&nbsp;using&nbsp;&#34;zig-zag&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3063204">//&nbsp;&nbsp;&nbsp;encoding:&nbsp;Positive&nbsp;values&nbsp;x&nbsp;are&nbsp;written&nbsp;as&nbsp;2*x&nbsp;+&nbsp;0,&nbsp;negative&nbsp;values</span><br>
<span class="lineno">15</span><span class="comment" id="3063277">//&nbsp;&nbsp;&nbsp;are&nbsp;written&nbsp;as&nbsp;2*(^x)&nbsp;+&nbsp;1;&nbsp;that&nbsp;is,&nbsp;negative&nbsp;numbers&nbsp;are&nbsp;complemented</span><br>
<span class="lineno"></span><span class="comment" id="3063352">//&nbsp;&nbsp;&nbsp;and&nbsp;whether&nbsp;to&nbsp;complement&nbsp;is&nbsp;encoded&nbsp;in&nbsp;bit&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="3063404">//</span><br>
<span class="lineno"></span><span class="comment" id="3063407">//&nbsp;Design&nbsp;note:</span><br>
<span class="lineno"></span><span class="comment" id="3063423">//&nbsp;At&nbsp;most&nbsp;10&nbsp;bytes&nbsp;are&nbsp;needed&nbsp;for&nbsp;64-bit&nbsp;values.&nbsp;The&nbsp;encoding&nbsp;could</span><br>
<span class="lineno">20</span><span class="comment" id="3063492">//&nbsp;be&nbsp;more&nbsp;dense:&nbsp;a&nbsp;full&nbsp;64-bit&nbsp;value&nbsp;needs&nbsp;an&nbsp;extra&nbsp;byte&nbsp;just&nbsp;to&nbsp;hold&nbsp;bit&nbsp;63.</span><br>
<span class="lineno"></span><span class="comment" id="3063571">//&nbsp;Instead,&nbsp;the&nbsp;msb&nbsp;of&nbsp;the&nbsp;previous&nbsp;byte&nbsp;could&nbsp;be&nbsp;used&nbsp;to&nbsp;hold&nbsp;bit&nbsp;63&nbsp;since&nbsp;we</span><br>
<span class="lineno"></span><span class="comment" id="3063650">//&nbsp;know&nbsp;there&nbsp;can&#39;t&nbsp;be&nbsp;more&nbsp;than&nbsp;64&nbsp;bits.&nbsp;This&nbsp;is&nbsp;a&nbsp;trivial&nbsp;improvement&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3063726">//&nbsp;would&nbsp;reduce&nbsp;the&nbsp;maximum&nbsp;encoding&nbsp;length&nbsp;to&nbsp;9&nbsp;bytes.&nbsp;However,&nbsp;it&nbsp;breaks&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3063805">//&nbsp;invariant&nbsp;that&nbsp;the&nbsp;msb&nbsp;is&nbsp;always&nbsp;the&nbsp;&#34;continuation&nbsp;bit&#34;&nbsp;and&nbsp;thus&nbsp;makes&nbsp;the</span><br>
<span class="lineno">25</span><span class="comment" id="3063883">//&nbsp;format&nbsp;incompatible&nbsp;with&nbsp;a&nbsp;varint&nbsp;encoding&nbsp;for&nbsp;larger&nbsp;numbers&nbsp;(say&nbsp;128-bit).</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3063964">import</span>&nbsp;<span class="op" id="3063971">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3063974">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3063984">&#34;io&#34;</span><br>
<span class="lineno">30</span><span class="op" id="3063989">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3063992">//&nbsp;MaxVarintLenN&nbsp;is&nbsp;the&nbsp;maximum&nbsp;length&nbsp;of&nbsp;a&nbsp;varint-encoded&nbsp;N-bit&nbsp;integer.</span><br>
<span class="lineno"></span><span class="keyword" id="3064066">const</span>&nbsp;<span class="op" id="3064072">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3064075">MaxVarintLen16</span>&nbsp;<span class="op" id="3064090">=</span>&nbsp;<span class="num" id="3064092">3</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3064095">MaxVarintLen32</span>&nbsp;<span class="op" id="3064110">=</span>&nbsp;<span class="num" id="3064112">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3064115">MaxVarintLen64</span>&nbsp;<span class="op" id="3064130">=</span>&nbsp;<span class="num" id="3064132">10</span><br>
<span class="lineno"></span><span class="op" id="3064135">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3064138">//&nbsp;PutUvarint&nbsp;encodes&nbsp;a&nbsp;uint64&nbsp;into&nbsp;buf&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">40</span><span class="comment" id="3064219">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;is&nbsp;too&nbsp;small,&nbsp;PutUvarint&nbsp;will&nbsp;panic.</span><br>
<span class="lineno"></span><span class="keyword" id="3064273">func</span>&nbsp;<span class="ident" id="3064278">PutUvarint</span><span class="op" id="3064288">(</span><span class="ident" id="3064289">buf</span>&nbsp;<span class="op" id="3064293">[</span><span class="op" id="3064294">]</span><span class="builtintype" id="3064295">byte</span><span class="op" id="3064299">,</span>&nbsp;<span class="ident" id="3064301">x</span>&nbsp;<span class="ident" id="3064303">uint64</span><span class="op" id="3064309">)</span>&nbsp;<span class="builtintype" id="3064311">int</span>&nbsp;<span class="op" id="3064315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3064318">i</span>&nbsp;<span class="op" id="3064320">:=</span>&nbsp;<span class="num" id="3064323">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3064326">for</span>&nbsp;<span class="ident" id="3064330">x</span>&nbsp;<span class="op" id="3064332">&gt;=</span>&nbsp;<span class="num" id="3064335">0x80</span>&nbsp;<span class="op" id="3064340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3064344">buf</span><span class="op" id="3064347">[</span><span class="ident" id="3064348">i</span><span class="op" id="3064349">]</span>&nbsp;<span class="op" id="3064351">=</span>&nbsp;<span class="builtintype" id="3064353">byte</span><span class="op" id="3064357">(</span><span class="ident" id="3064358">x</span><span class="op" id="3064359">)</span>&nbsp;<span class="op" id="3064361">|</span>&nbsp;<span class="num" id="3064363">0x80</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3064370">x</span>&nbsp;<span class="op" id="3064372">&gt;&gt;=</span>&nbsp;<span class="num" id="3064376">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3064380">i</span><span class="op" id="3064381">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3064385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3064388">buf</span><span class="op" id="3064391">[</span><span class="ident" id="3064392">i</span><span class="op" id="3064393">]</span>&nbsp;<span class="op" id="3064395">=</span>&nbsp;<span class="builtintype" id="3064397">byte</span><span class="op" id="3064401">(</span><span class="ident" id="3064402">x</span><span class="op" id="3064403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3064406">return</span>&nbsp;<span class="ident" id="3064413">i</span>&nbsp;<span class="op" id="3064415">+</span>&nbsp;<span class="num" id="3064417">1</span><br>
<span class="lineno">50</span><span class="op" id="3064419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3064422">//&nbsp;Uvarint&nbsp;decodes&nbsp;a&nbsp;uint64&nbsp;from&nbsp;buf&nbsp;and&nbsp;returns&nbsp;that&nbsp;value&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3064490">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;(&gt;&nbsp;0).&nbsp;If&nbsp;an&nbsp;error&nbsp;occurred,&nbsp;the&nbsp;value&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="3064558">//&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;n&nbsp;is&nbsp;&lt;=&nbsp;0&nbsp;meaning:</span><br>
<span class="lineno">55</span><span class="comment" id="3064604">//</span><br>
<span class="lineno"></span><span class="comment" id="3064607">//&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;==&nbsp;0:&nbsp;buf&nbsp;too&nbsp;small</span><br>
<span class="lineno"></span><span class="comment" id="3064632">//&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;&nbsp;&lt;&nbsp;0:&nbsp;value&nbsp;larger&nbsp;than&nbsp;64&nbsp;bits&nbsp;(overflow)</span><br>
<span class="lineno"></span><span class="comment" id="3064680">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;-n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="3064731">//</span><br>
<span class="lineno">60</span><span class="keyword" id="3064734">func</span>&nbsp;<span class="ident" id="3064739">Uvarint</span><span class="op" id="3064746">(</span><span class="ident" id="3064747">buf</span>&nbsp;<span class="op" id="3064751">[</span><span class="op" id="3064752">]</span><span class="builtintype" id="3064753">byte</span><span class="op" id="3064757">)</span>&nbsp;<span class="op" id="3064759">(</span><span class="ident" id="3064760">uint64</span><span class="op" id="3064766">,</span>&nbsp;<span class="builtintype" id="3064768">int</span><span class="op" id="3064771">)</span>&nbsp;<span class="op" id="3064773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3064776">var</span>&nbsp;<span class="ident" id="3064780">x</span>&nbsp;<span class="ident" id="3064782">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3064790">var</span>&nbsp;<span class="ident" id="3064794">s</span>&nbsp;<span class="builtintype" id="3064796">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3064802">for</span>&nbsp;<span class="ident" id="3064806">i</span><span class="op" id="3064807">,</span>&nbsp;<span class="ident" id="3064809">b</span>&nbsp;<span class="op" id="3064811">:=</span>&nbsp;<span class="keyword" id="3064814">range</span>&nbsp;<span class="ident" id="3064820">buf</span>&nbsp;<span class="op" id="3064824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3064828">if</span>&nbsp;<span class="ident" id="3064831">b</span>&nbsp;<span class="op" id="3064833">&lt;</span>&nbsp;<span class="num" id="3064835">0x80</span>&nbsp;<span class="op" id="3064840">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3064845">if</span>&nbsp;<span class="ident" id="3064848">i</span>&nbsp;<span class="op" id="3064850">&gt;</span>&nbsp;<span class="num" id="3064852">9</span>&nbsp;<span class="op" id="3064854">||</span>&nbsp;<span class="ident" id="3064857">i</span>&nbsp;<span class="op" id="3064859">==</span>&nbsp;<span class="num" id="3064862">9</span>&nbsp;<span class="op" id="3064864">&amp;&amp;</span>&nbsp;<span class="ident" id="3064867">b</span>&nbsp;<span class="op" id="3064869">&gt;</span>&nbsp;<span class="num" id="3064871">1</span>&nbsp;<span class="op" id="3064873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3064879">return</span>&nbsp;<span class="num" id="3064886">0</span><span class="op" id="3064887">,</span>&nbsp;<span class="op" id="3064889">-</span><span class="op" id="3064890">(</span><span class="ident" id="3064891">i</span>&nbsp;<span class="op" id="3064893">+</span>&nbsp;<span class="num" id="3064895">1</span><span class="op" id="3064896">)</span>&nbsp;<span class="comment" id="3064898">//&nbsp;overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3064913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3064918">return</span>&nbsp;<span class="ident" id="3064925">x</span>&nbsp;<span class="op" id="3064927">|</span>&nbsp;<span class="ident" id="3064929">uint64</span><span class="op" id="3064935">(</span><span class="ident" id="3064936">b</span><span class="op" id="3064937">)</span><span class="op" id="3064938">&lt;&lt;</span><span class="ident" id="3064940">s</span><span class="op" id="3064941">,</span>&nbsp;<span class="ident" id="3064943">i</span>&nbsp;<span class="op" id="3064945">+</span>&nbsp;<span class="num" id="3064947">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3064951">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3064955">x</span>&nbsp;<span class="op" id="3064957">|=</span>&nbsp;<span class="ident" id="3064960">uint64</span><span class="op" id="3064966">(</span><span class="ident" id="3064967">b</span><span class="op" id="3064968">&amp;</span><span class="num" id="3064969">0x7f</span><span class="op" id="3064973">)</span>&nbsp;<span class="op" id="3064975">&lt;&lt;</span>&nbsp;<span class="ident" id="3064978">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3064982">s</span>&nbsp;<span class="op" id="3064984">+=</span>&nbsp;<span class="num" id="3064987">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3064990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3064993">return</span>&nbsp;<span class="num" id="3065000">0</span><span class="op" id="3065001">,</span>&nbsp;<span class="num" id="3065003">0</span><br>
<span class="lineno"></span><span class="op" id="3065005">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="3065008">//&nbsp;PutVarint&nbsp;encodes&nbsp;an&nbsp;int64&nbsp;into&nbsp;buf&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="3065088">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;is&nbsp;too&nbsp;small,&nbsp;PutVarint&nbsp;will&nbsp;panic.</span><br>
<span class="lineno"></span><span class="keyword" id="3065141">func</span>&nbsp;<span class="ident" id="3065146">PutVarint</span><span class="op" id="3065155">(</span><span class="ident" id="3065156">buf</span>&nbsp;<span class="op" id="3065160">[</span><span class="op" id="3065161">]</span><span class="builtintype" id="3065162">byte</span><span class="op" id="3065166">,</span>&nbsp;<span class="ident" id="3065168">x</span>&nbsp;<span class="ident" id="3065170">int64</span><span class="op" id="3065175">)</span>&nbsp;<span class="builtintype" id="3065177">int</span>&nbsp;<span class="op" id="3065181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3065184">ux</span>&nbsp;<span class="op" id="3065187">:=</span>&nbsp;<span class="ident" id="3065190">uint64</span><span class="op" id="3065196">(</span><span class="ident" id="3065197">x</span><span class="op" id="3065198">)</span>&nbsp;<span class="op" id="3065200">&lt;&lt;</span>&nbsp;<span class="num" id="3065203">1</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3065206">if</span>&nbsp;<span class="ident" id="3065209">x</span>&nbsp;<span class="op" id="3065211">&lt;</span>&nbsp;<span class="num" id="3065213">0</span>&nbsp;<span class="op" id="3065215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3065219">ux</span>&nbsp;<span class="op" id="3065222">=</span>&nbsp;<span class="op" id="3065224">^</span><span class="ident" id="3065225">ux</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3065229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3065232">return</span>&nbsp;<span class="ident" id="3065239">PutUvarint</span><span class="op" id="3065249">(</span><span class="ident" id="3065250">buf</span><span class="op" id="3065253">,</span>&nbsp;<span class="ident" id="3065255">ux</span><span class="op" id="3065257">)</span><br>
<span class="lineno"></span><span class="op" id="3065259">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="3065262">//&nbsp;Varint&nbsp;decodes&nbsp;an&nbsp;int64&nbsp;from&nbsp;buf&nbsp;and&nbsp;returns&nbsp;that&nbsp;value&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3065329">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;(&gt;&nbsp;0).&nbsp;If&nbsp;an&nbsp;error&nbsp;occurred,&nbsp;the&nbsp;value&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="3065397">//&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;n&nbsp;is&nbsp;&lt;=&nbsp;0&nbsp;with&nbsp;the&nbsp;following&nbsp;meaning:</span><br>
<span class="lineno"></span><span class="comment" id="3065462">//</span><br>
<span class="lineno">90</span><span class="comment" id="3065465">//&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;==&nbsp;0:&nbsp;buf&nbsp;too&nbsp;small</span><br>
<span class="lineno"></span><span class="comment" id="3065490">//&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;&nbsp;&lt;&nbsp;0:&nbsp;value&nbsp;larger&nbsp;than&nbsp;64&nbsp;bits&nbsp;(overflow)</span><br>
<span class="lineno"></span><span class="comment" id="3065538">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;-n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="3065589">//</span><br>
<span class="lineno"></span><span class="keyword" id="3065592">func</span>&nbsp;<span class="ident" id="3065597">Varint</span><span class="op" id="3065603">(</span><span class="ident" id="3065604">buf</span>&nbsp;<span class="op" id="3065608">[</span><span class="op" id="3065609">]</span><span class="builtintype" id="3065610">byte</span><span class="op" id="3065614">)</span>&nbsp;<span class="op" id="3065616">(</span><span class="ident" id="3065617">int64</span><span class="op" id="3065622">,</span>&nbsp;<span class="builtintype" id="3065624">int</span><span class="op" id="3065627">)</span>&nbsp;<span class="op" id="3065629">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3065632">ux</span><span class="op" id="3065634">,</span>&nbsp;<span class="ident" id="3065636">n</span>&nbsp;<span class="op" id="3065638">:=</span>&nbsp;<span class="ident" id="3065641">Uvarint</span><span class="op" id="3065648">(</span><span class="ident" id="3065649">buf</span><span class="op" id="3065652">)</span>&nbsp;<span class="comment" id="3065654">//&nbsp;ok&nbsp;to&nbsp;continue&nbsp;in&nbsp;presence&nbsp;of&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3065694">x</span>&nbsp;<span class="op" id="3065696">:=</span>&nbsp;<span class="ident" id="3065699">int64</span><span class="op" id="3065704">(</span><span class="ident" id="3065705">ux</span>&nbsp;<span class="op" id="3065708">&gt;&gt;</span>&nbsp;<span class="num" id="3065711">1</span><span class="op" id="3065712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3065715">if</span>&nbsp;<span class="ident" id="3065718">ux</span><span class="op" id="3065720">&amp;</span><span class="num" id="3065721">1</span>&nbsp;<span class="op" id="3065723">!=</span>&nbsp;<span class="num" id="3065726">0</span>&nbsp;<span class="op" id="3065728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3065732">x</span>&nbsp;<span class="op" id="3065734">=</span>&nbsp;<span class="op" id="3065736">^</span><span class="ident" id="3065737">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3065740">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3065743">return</span>&nbsp;<span class="ident" id="3065750">x</span><span class="op" id="3065751">,</span>&nbsp;<span class="ident" id="3065753">n</span><br>
<span class="lineno"></span><span class="op" id="3065755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3065758">var</span>&nbsp;<span class="ident" id="3065762">overflow</span>&nbsp;<span class="op" id="3065771">=</span>&nbsp;<span class="ident" id="3065773">errors</span><span class="op" id="3065779">.</span><span class="ident" id="3065780">New</span><span class="op" id="3065783">(</span><span class="string" id="3065784">&#34;binary:&nbsp;varint&nbsp;overflows&nbsp;a&nbsp;64-bit&nbsp;integer&#34;</span><span class="op" id="3065827">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="3065830">//&nbsp;ReadUvarint&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;a&nbsp;uint64.</span><br>
<span class="lineno"></span><span class="keyword" id="3065914">func</span>&nbsp;<span class="ident" id="3065919">ReadUvarint</span><span class="op" id="3065930">(</span><span class="ident" id="3065931">r</span>&nbsp;<span class="ident" id="3065933">io</span><span class="op" id="3065935">.</span><span class="ident" id="3065936">ByteReader</span><span class="op" id="3065946">)</span>&nbsp;<span class="op" id="3065948">(</span><span class="ident" id="3065949">uint64</span><span class="op" id="3065955">,</span>&nbsp;<span class="builtintype" id="3065957">error</span><span class="op" id="3065962">)</span>&nbsp;<span class="op" id="3065964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3065967">var</span>&nbsp;<span class="ident" id="3065971">x</span>&nbsp;<span class="ident" id="3065973">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3065981">var</span>&nbsp;<span class="ident" id="3065985">s</span>&nbsp;<span class="builtintype" id="3065987">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3065993">for</span>&nbsp;<span class="ident" id="3065997">i</span>&nbsp;<span class="op" id="3065999">:=</span>&nbsp;<span class="num" id="3066002">0</span><span class="op" id="3066003">;</span>&nbsp;<span class="op" id="3066005">;</span>&nbsp;<span class="ident" id="3066007">i</span><span class="op" id="3066008">++</span>&nbsp;<span class="op" id="3066011">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3066015">b</span><span class="op" id="3066016">,</span>&nbsp;<span class="ident" id="3066018">err</span>&nbsp;<span class="op" id="3066022">:=</span>&nbsp;<span class="ident" id="3066025">r</span><span class="op" id="3066026">.</span><span class="ident" id="3066027">ReadByte</span><span class="op" id="3066035">(</span><span class="op" id="3066036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3066040">if</span>&nbsp;<span class="ident" id="3066043">err</span>&nbsp;<span class="op" id="3066047">!=</span>&nbsp;<span class="builtintype" id="3066050">nil</span>&nbsp;<span class="op" id="3066054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3066059">return</span>&nbsp;<span class="ident" id="3066066">x</span><span class="op" id="3066067">,</span>&nbsp;<span class="ident" id="3066069">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3066075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3066079">if</span>&nbsp;<span class="ident" id="3066082">b</span>&nbsp;<span class="op" id="3066084">&lt;</span>&nbsp;<span class="num" id="3066086">0x80</span>&nbsp;<span class="op" id="3066091">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3066096">if</span>&nbsp;<span class="ident" id="3066099">i</span>&nbsp;<span class="op" id="3066101">&gt;</span>&nbsp;<span class="num" id="3066103">9</span>&nbsp;<span class="op" id="3066105">||</span>&nbsp;<span class="ident" id="3066108">i</span>&nbsp;<span class="op" id="3066110">==</span>&nbsp;<span class="num" id="3066113">9</span>&nbsp;<span class="op" id="3066115">&amp;&amp;</span>&nbsp;<span class="ident" id="3066118">b</span>&nbsp;<span class="op" id="3066120">&gt;</span>&nbsp;<span class="num" id="3066122">1</span>&nbsp;<span class="op" id="3066124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3066130">return</span>&nbsp;<span class="ident" id="3066137">x</span><span class="op" id="3066138">,</span>&nbsp;<span class="ident" id="3066140">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3066152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3066157">return</span>&nbsp;<span class="ident" id="3066164">x</span>&nbsp;<span class="op" id="3066166">|</span>&nbsp;<span class="ident" id="3066168">uint64</span><span class="op" id="3066174">(</span><span class="ident" id="3066175">b</span><span class="op" id="3066176">)</span><span class="op" id="3066177">&lt;&lt;</span><span class="ident" id="3066179">s</span><span class="op" id="3066180">,</span>&nbsp;<span class="builtintype" id="3066182">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3066188">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3066192">x</span>&nbsp;<span class="op" id="3066194">|=</span>&nbsp;<span class="ident" id="3066197">uint64</span><span class="op" id="3066203">(</span><span class="ident" id="3066204">b</span><span class="op" id="3066205">&amp;</span><span class="num" id="3066206">0x7f</span><span class="op" id="3066210">)</span>&nbsp;<span class="op" id="3066212">&lt;&lt;</span>&nbsp;<span class="ident" id="3066215">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3066219">s</span>&nbsp;<span class="op" id="3066221">+=</span>&nbsp;<span class="num" id="3066224">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3066227">}</span><br>
<span class="lineno"></span><span class="op" id="3066229">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="3066232">//&nbsp;ReadVarint&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;signed&nbsp;integer&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;an&nbsp;int64.</span><br>
<span class="lineno"></span><span class="keyword" id="3066313">func</span>&nbsp;<span class="ident" id="3066318">ReadVarint</span><span class="op" id="3066328">(</span><span class="ident" id="3066329">r</span>&nbsp;<span class="ident" id="3066331">io</span><span class="op" id="3066333">.</span><span class="ident" id="3066334">ByteReader</span><span class="op" id="3066344">)</span>&nbsp;<span class="op" id="3066346">(</span><span class="ident" id="3066347">int64</span><span class="op" id="3066352">,</span>&nbsp;<span class="builtintype" id="3066354">error</span><span class="op" id="3066359">)</span>&nbsp;<span class="op" id="3066361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3066364">ux</span><span class="op" id="3066366">,</span>&nbsp;<span class="ident" id="3066368">err</span>&nbsp;<span class="op" id="3066372">:=</span>&nbsp;<span class="ident" id="3066375">ReadUvarint</span><span class="op" id="3066386">(</span><span class="ident" id="3066387">r</span><span class="op" id="3066388">)</span>&nbsp;<span class="comment" id="3066390">//&nbsp;ok&nbsp;to&nbsp;continue&nbsp;in&nbsp;presence&nbsp;of&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3066430">x</span>&nbsp;<span class="op" id="3066432">:=</span>&nbsp;<span class="ident" id="3066435">int64</span><span class="op" id="3066440">(</span><span class="ident" id="3066441">ux</span>&nbsp;<span class="op" id="3066444">&gt;&gt;</span>&nbsp;<span class="num" id="3066447">1</span><span class="op" id="3066448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3066451">if</span>&nbsp;<span class="ident" id="3066454">ux</span><span class="op" id="3066456">&amp;</span><span class="num" id="3066457">1</span>&nbsp;<span class="op" id="3066459">!=</span>&nbsp;<span class="num" id="3066462">0</span>&nbsp;<span class="op" id="3066464">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3066468">x</span>&nbsp;<span class="op" id="3066470">=</span>&nbsp;<span class="op" id="3066472">^</span><span class="ident" id="3066473">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3066476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3066479">return</span>&nbsp;<span class="ident" id="3066486">x</span><span class="op" id="3066487">,</span>&nbsp;<span class="ident" id="3066489">err</span><br>
<span class="lineno"></span><span class="op" id="3066493">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
