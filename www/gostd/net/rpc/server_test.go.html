<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="8378202">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8378257">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8378311">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8378362">package</span>&nbsp;<span class="ident" id="8378370">rpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8378375">import</span>&nbsp;<span class="op" id="8378382">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8378385">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8378395">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8378402">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8378408">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8378415">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8378422">&#34;net/http/httptest&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8378443">&#34;runtime&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8378454">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8378465">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8378473">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8378488">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8378499">&#34;time&#34;</span><br>
<span class="lineno">20</span><span class="op" id="8378506">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8378509">var</span>&nbsp;<span class="op" id="8378513">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8378516">newServer</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8378542">*</span><span class="ident" id="8378543">Server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8378551">serverAddr</span><span class="op" id="8378561">,</span>&nbsp;<span class="ident" id="8378563">newServerAddr</span>&nbsp;<span class="builtintype" id="8378577">string</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8378585">httpServerAddr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8378611">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8378619">once</span><span class="op" id="8378623">,</span>&nbsp;<span class="ident" id="8378625">newOnce</span><span class="op" id="8378632">,</span>&nbsp;<span class="ident" id="8378634">httpOnce</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8378645">sync</span><span class="op" id="8378649">.</span><span class="ident" id="8378650">Once</span><br>
<span class="lineno"></span><span class="op" id="8378655">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8378658">const</span>&nbsp;<span class="op" id="8378664">(</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8378667">newHttpPath</span>&nbsp;<span class="op" id="8378679">=</span>&nbsp;<span class="string" id="8378681">&#34;/foo&#34;</span><br>
<span class="lineno"></span><span class="op" id="8378688">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8378691">type</span>&nbsp;<span class="ident" id="8378696">Args</span>&nbsp;<span class="keyword" id="8378701">struct</span>&nbsp;<span class="op" id="8378708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8378711">A</span><span class="op" id="8378712">,</span>&nbsp;<span class="ident" id="8378714">B</span>&nbsp;<span class="builtintype" id="8378716">int</span><br>
<span class="lineno">35</span><span class="op" id="8378720">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8378723">type</span>&nbsp;<span class="ident" id="8378728">Reply</span>&nbsp;<span class="keyword" id="8378734">struct</span>&nbsp;<span class="op" id="8378741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8378744">C</span>&nbsp;<span class="builtintype" id="8378746">int</span><br>
<span class="lineno"></span><span class="op" id="8378750">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="8378753">type</span>&nbsp;<span class="ident" id="8378758">Arith</span>&nbsp;<span class="builtintype" id="8378764">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8378769">//&nbsp;Some&nbsp;of&nbsp;Arith&#39;s&nbsp;methods&nbsp;have&nbsp;value&nbsp;args,&nbsp;some&nbsp;have&nbsp;pointer&nbsp;args.&nbsp;That&#39;s&nbsp;deliberate.</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="8378857">func</span>&nbsp;<span class="op" id="8378862">(</span><span class="ident" id="8378863">t</span>&nbsp;<span class="op" id="8378865">*</span><span class="ident" id="8378866">Arith</span><span class="op" id="8378871">)</span>&nbsp;<span class="ident" id="8378873">Add</span><span class="op" id="8378876">(</span><span class="ident" id="8378877">args</span>&nbsp;<span class="ident" id="8378882">Args</span><span class="op" id="8378886">,</span>&nbsp;<span class="ident" id="8378888">reply</span>&nbsp;<span class="op" id="8378894">*</span><span class="ident" id="8378895">Reply</span><span class="op" id="8378900">)</span>&nbsp;<span class="builtintype" id="8378902">error</span>&nbsp;<span class="op" id="8378908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8378911">reply</span><span class="op" id="8378916">.</span><span class="ident" id="8378917">C</span>&nbsp;<span class="op" id="8378919">=</span>&nbsp;<span class="ident" id="8378921">args</span><span class="op" id="8378925">.</span><span class="ident" id="8378926">A</span>&nbsp;<span class="op" id="8378928">+</span>&nbsp;<span class="ident" id="8378930">args</span><span class="op" id="8378934">.</span><span class="ident" id="8378935">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8378938">return</span>&nbsp;<span class="ident" id="8378945">nil</span><br>
<span class="lineno"></span><span class="op" id="8378949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="8378952">func</span>&nbsp;<span class="op" id="8378957">(</span><span class="ident" id="8378958">t</span>&nbsp;<span class="op" id="8378960">*</span><span class="ident" id="8378961">Arith</span><span class="op" id="8378966">)</span>&nbsp;<span class="ident" id="8378968">Mul</span><span class="op" id="8378971">(</span><span class="ident" id="8378972">args</span>&nbsp;<span class="op" id="8378977">*</span><span class="ident" id="8378978">Args</span><span class="op" id="8378982">,</span>&nbsp;<span class="ident" id="8378984">reply</span>&nbsp;<span class="op" id="8378990">*</span><span class="ident" id="8378991">Reply</span><span class="op" id="8378996">)</span>&nbsp;<span class="builtintype" id="8378998">error</span>&nbsp;<span class="op" id="8379004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8379007">reply</span><span class="op" id="8379012">.</span><span class="ident" id="8379013">C</span>&nbsp;<span class="op" id="8379015">=</span>&nbsp;<span class="ident" id="8379017">args</span><span class="op" id="8379021">.</span><span class="ident" id="8379022">A</span>&nbsp;<span class="op" id="8379024">*</span>&nbsp;<span class="ident" id="8379026">args</span><span class="op" id="8379030">.</span><span class="ident" id="8379031">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8379034">return</span>&nbsp;<span class="ident" id="8379041">nil</span><br>
<span class="lineno"></span><span class="op" id="8379045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="8379048">func</span>&nbsp;<span class="op" id="8379053">(</span><span class="ident" id="8379054">t</span>&nbsp;<span class="op" id="8379056">*</span><span class="ident" id="8379057">Arith</span><span class="op" id="8379062">)</span>&nbsp;<span class="ident" id="8379064">Div</span><span class="op" id="8379067">(</span><span class="ident" id="8379068">args</span>&nbsp;<span class="ident" id="8379073">Args</span><span class="op" id="8379077">,</span>&nbsp;<span class="ident" id="8379079">reply</span>&nbsp;<span class="op" id="8379085">*</span><span class="ident" id="8379086">Reply</span><span class="op" id="8379091">)</span>&nbsp;<span class="builtintype" id="8379093">error</span>&nbsp;<span class="op" id="8379099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8379102">if</span>&nbsp;<span class="ident" id="8379105">args</span><span class="op" id="8379109">.</span><span class="ident" id="8379110">B</span>&nbsp;<span class="op" id="8379112">==</span>&nbsp;<span class="num" id="8379115">0</span>&nbsp;<span class="op" id="8379117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8379121">return</span>&nbsp;<span class="ident" id="8379128">errors</span><span class="op" id="8379134">.</span><span class="ident" id="8379135">New</span><span class="op" id="8379138">(</span><span class="string" id="8379139">&#34;divide&nbsp;by&nbsp;zero&#34;</span><span class="op" id="8379155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8379158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8379161">reply</span><span class="op" id="8379166">.</span><span class="ident" id="8379167">C</span>&nbsp;<span class="op" id="8379169">=</span>&nbsp;<span class="ident" id="8379171">args</span><span class="op" id="8379175">.</span><span class="ident" id="8379176">A</span>&nbsp;<span class="op" id="8379178">/</span>&nbsp;<span class="ident" id="8379180">args</span><span class="op" id="8379184">.</span><span class="ident" id="8379185">B</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8379188">return</span>&nbsp;<span class="ident" id="8379195">nil</span><br>
<span class="lineno"></span><span class="op" id="8379199">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8379202">func</span>&nbsp;<span class="op" id="8379207">(</span><span class="ident" id="8379208">t</span>&nbsp;<span class="op" id="8379210">*</span><span class="ident" id="8379211">Arith</span><span class="op" id="8379216">)</span>&nbsp;<span class="ident" id="8379218">String</span><span class="op" id="8379224">(</span><span class="ident" id="8379225">args</span>&nbsp;<span class="op" id="8379230">*</span><span class="ident" id="8379231">Args</span><span class="op" id="8379235">,</span>&nbsp;<span class="ident" id="8379237">reply</span>&nbsp;<span class="op" id="8379243">*</span><span class="builtintype" id="8379244">string</span><span class="op" id="8379250">)</span>&nbsp;<span class="builtintype" id="8379252">error</span>&nbsp;<span class="op" id="8379258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8379261">*</span><span class="ident" id="8379262">reply</span>&nbsp;<span class="op" id="8379268">=</span>&nbsp;<span class="ident" id="8379270">fmt</span><span class="op" id="8379273">.</span><span class="ident" id="8379274">Sprintf</span><span class="op" id="8379281">(</span><span class="string" id="8379282">&#34;%d+%d=%d&#34;</span><span class="op" id="8379292">,</span>&nbsp;<span class="ident" id="8379294">args</span><span class="op" id="8379298">.</span><span class="ident" id="8379299">A</span><span class="op" id="8379300">,</span>&nbsp;<span class="ident" id="8379302">args</span><span class="op" id="8379306">.</span><span class="ident" id="8379307">B</span><span class="op" id="8379308">,</span>&nbsp;<span class="ident" id="8379310">args</span><span class="op" id="8379314">.</span><span class="ident" id="8379315">A</span><span class="op" id="8379316">+</span><span class="ident" id="8379317">args</span><span class="op" id="8379321">.</span><span class="ident" id="8379322">B</span><span class="op" id="8379323">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8379326">return</span>&nbsp;<span class="ident" id="8379333">nil</span><br>
<span class="lineno"></span><span class="op" id="8379337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8379340">func</span>&nbsp;<span class="op" id="8379345">(</span><span class="ident" id="8379346">t</span>&nbsp;<span class="op" id="8379348">*</span><span class="ident" id="8379349">Arith</span><span class="op" id="8379354">)</span>&nbsp;<span class="ident" id="8379356">Scan</span><span class="op" id="8379360">(</span><span class="ident" id="8379361">args</span>&nbsp;<span class="builtintype" id="8379366">string</span><span class="op" id="8379372">,</span>&nbsp;<span class="ident" id="8379374">reply</span>&nbsp;<span class="op" id="8379380">*</span><span class="ident" id="8379381">Reply</span><span class="op" id="8379386">)</span>&nbsp;<span class="op" id="8379388">(</span><span class="ident" id="8379389">err</span>&nbsp;<span class="builtintype" id="8379393">error</span><span class="op" id="8379398">)</span>&nbsp;<span class="op" id="8379400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8379403">_</span><span class="op" id="8379404">,</span>&nbsp;<span class="ident" id="8379406">err</span>&nbsp;<span class="op" id="8379410">=</span>&nbsp;<span class="ident" id="8379412">fmt</span><span class="op" id="8379415">.</span><span class="ident" id="8379416">Sscan</span><span class="op" id="8379421">(</span><span class="ident" id="8379422">args</span><span class="op" id="8379426">,</span>&nbsp;<span class="op" id="8379428">&amp;</span><span class="ident" id="8379429">reply</span><span class="op" id="8379434">.</span><span class="ident" id="8379435">C</span><span class="op" id="8379436">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8379439">return</span><br>
<span class="lineno"></span><span class="op" id="8379446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8379449">func</span>&nbsp;<span class="op" id="8379454">(</span><span class="ident" id="8379455">t</span>&nbsp;<span class="op" id="8379457">*</span><span class="ident" id="8379458">Arith</span><span class="op" id="8379463">)</span>&nbsp;<span class="ident" id="8379465">Error</span><span class="op" id="8379470">(</span><span class="ident" id="8379471">args</span>&nbsp;<span class="op" id="8379476">*</span><span class="ident" id="8379477">Args</span><span class="op" id="8379481">,</span>&nbsp;<span class="ident" id="8379483">reply</span>&nbsp;<span class="op" id="8379489">*</span><span class="ident" id="8379490">Reply</span><span class="op" id="8379495">)</span>&nbsp;<span class="builtintype" id="8379497">error</span>&nbsp;<span class="op" id="8379503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8379506">panic</span><span class="op" id="8379511">(</span><span class="string" id="8379512">&#34;ERROR&#34;</span><span class="op" id="8379519">)</span><br>
<span class="lineno">75</span><span class="op" id="8379521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8379524">func</span>&nbsp;<span class="ident" id="8379529">listenTCP</span><span class="op" id="8379538">(</span><span class="op" id="8379539">)</span>&nbsp;<span class="op" id="8379541">(</span><span class="ident" id="8379542">net</span><span class="op" id="8379545">.</span><span class="ident" id="8379546">Listener</span><span class="op" id="8379554">,</span>&nbsp;<span class="builtintype" id="8379556">string</span><span class="op" id="8379562">)</span>&nbsp;<span class="op" id="8379564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8379567">l</span><span class="op" id="8379568">,</span>&nbsp;<span class="ident" id="8379570">e</span>&nbsp;<span class="op" id="8379572">:=</span>&nbsp;<span class="ident" id="8379575">net</span><span class="op" id="8379578">.</span><span class="ident" id="8379579">Listen</span><span class="op" id="8379585">(</span><span class="string" id="8379586">&#34;tcp&#34;</span><span class="op" id="8379591">,</span>&nbsp;<span class="string" id="8379593">&#34;127.0.0.1:0&#34;</span><span class="op" id="8379606">)</span>&nbsp;<span class="comment" id="8379608">//&nbsp;any&nbsp;available&nbsp;address</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8379634">if</span>&nbsp;<span class="ident" id="8379637">e</span>&nbsp;<span class="op" id="8379639">!=</span>&nbsp;<span class="ident" id="8379642">nil</span>&nbsp;<span class="op" id="8379646">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8379650">log</span><span class="op" id="8379653">.</span><span class="ident" id="8379654">Fatalf</span><span class="op" id="8379660">(</span><span class="string" id="8379661">&#34;net.Listen&nbsp;tcp&nbsp;:0:&nbsp;%v&#34;</span><span class="op" id="8379684">,</span>&nbsp;<span class="ident" id="8379686">e</span><span class="op" id="8379687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8379690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8379693">return</span>&nbsp;<span class="ident" id="8379700">l</span><span class="op" id="8379701">,</span>&nbsp;<span class="ident" id="8379703">l</span><span class="op" id="8379704">.</span><span class="ident" id="8379705">Addr</span><span class="op" id="8379709">(</span><span class="op" id="8379710">)</span><span class="op" id="8379711">.</span><span class="ident" id="8379712">String</span><span class="op" id="8379718">(</span><span class="op" id="8379719">)</span><br>
<span class="lineno"></span><span class="op" id="8379721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="keyword" id="8379724">func</span>&nbsp;<span class="ident" id="8379729">startServer</span><span class="op" id="8379740">(</span><span class="op" id="8379741">)</span>&nbsp;<span class="op" id="8379743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8379746">Register</span><span class="op" id="8379754">(</span><span class="builtinfunc" id="8379755">new</span><span class="op" id="8379758">(</span><span class="ident" id="8379759">Arith</span><span class="op" id="8379764">)</span><span class="op" id="8379765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8379768">RegisterName</span><span class="op" id="8379780">(</span><span class="string" id="8379781">&#34;net.rpc.Arith&#34;</span><span class="op" id="8379796">,</span>&nbsp;<span class="builtinfunc" id="8379798">new</span><span class="op" id="8379801">(</span><span class="ident" id="8379802">Arith</span><span class="op" id="8379807">)</span><span class="op" id="8379808">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8379812">var</span>&nbsp;<span class="ident" id="8379816">l</span>&nbsp;<span class="ident" id="8379818">net</span><span class="op" id="8379821">.</span><span class="ident" id="8379822">Listener</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8379832">l</span><span class="op" id="8379833">,</span>&nbsp;<span class="ident" id="8379835">serverAddr</span>&nbsp;<span class="op" id="8379846">=</span>&nbsp;<span class="ident" id="8379848">listenTCP</span><span class="op" id="8379857">(</span><span class="op" id="8379858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8379861">log</span><span class="op" id="8379864">.</span><span class="ident" id="8379865">Println</span><span class="op" id="8379872">(</span><span class="string" id="8379873">&#34;Test&nbsp;RPC&nbsp;server&nbsp;listening&nbsp;on&#34;</span><span class="op" id="8379903">,</span>&nbsp;<span class="ident" id="8379905">serverAddr</span><span class="op" id="8379915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8379918">go</span>&nbsp;<span class="ident" id="8379921">Accept</span><span class="op" id="8379927">(</span><span class="ident" id="8379928">l</span><span class="op" id="8379929">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8379933">HandleHTTP</span><span class="op" id="8379943">(</span><span class="op" id="8379944">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8379947">httpOnce</span><span class="op" id="8379955">.</span><span class="ident" id="8379956">Do</span><span class="op" id="8379958">(</span><span class="ident" id="8379959">startHttpServer</span><span class="op" id="8379974">)</span><br>
<span class="lineno"></span><span class="op" id="8379976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8379979">func</span>&nbsp;<span class="ident" id="8379984">startNewServer</span><span class="op" id="8379998">(</span><span class="op" id="8379999">)</span>&nbsp;<span class="op" id="8380001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8380004">newServer</span>&nbsp;<span class="op" id="8380014">=</span>&nbsp;<span class="ident" id="8380016">NewServer</span><span class="op" id="8380025">(</span><span class="op" id="8380026">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8380029">newServer</span><span class="op" id="8380038">.</span><span class="ident" id="8380039">Register</span><span class="op" id="8380047">(</span><span class="builtinfunc" id="8380048">new</span><span class="op" id="8380051">(</span><span class="ident" id="8380052">Arith</span><span class="op" id="8380057">)</span><span class="op" id="8380058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8380061">newServer</span><span class="op" id="8380070">.</span><span class="ident" id="8380071">RegisterName</span><span class="op" id="8380083">(</span><span class="string" id="8380084">&#34;net.rpc.Arith&#34;</span><span class="op" id="8380099">,</span>&nbsp;<span class="builtinfunc" id="8380101">new</span><span class="op" id="8380104">(</span><span class="ident" id="8380105">Arith</span><span class="op" id="8380110">)</span><span class="op" id="8380111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8380114">newServer</span><span class="op" id="8380123">.</span><span class="ident" id="8380124">RegisterName</span><span class="op" id="8380136">(</span><span class="string" id="8380137">&#34;newServer.Arith&#34;</span><span class="op" id="8380154">,</span>&nbsp;<span class="builtinfunc" id="8380156">new</span><span class="op" id="8380159">(</span><span class="ident" id="8380160">Arith</span><span class="op" id="8380165">)</span><span class="op" id="8380166">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8380170">var</span>&nbsp;<span class="ident" id="8380174">l</span>&nbsp;<span class="ident" id="8380176">net</span><span class="op" id="8380179">.</span><span class="ident" id="8380180">Listener</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8380190">l</span><span class="op" id="8380191">,</span>&nbsp;<span class="ident" id="8380193">newServerAddr</span>&nbsp;<span class="op" id="8380207">=</span>&nbsp;<span class="ident" id="8380209">listenTCP</span><span class="op" id="8380218">(</span><span class="op" id="8380219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8380222">log</span><span class="op" id="8380225">.</span><span class="ident" id="8380226">Println</span><span class="op" id="8380233">(</span><span class="string" id="8380234">&#34;NewServer&nbsp;test&nbsp;RPC&nbsp;server&nbsp;listening&nbsp;on&#34;</span><span class="op" id="8380274">,</span>&nbsp;<span class="ident" id="8380276">newServerAddr</span><span class="op" id="8380289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8380292">go</span>&nbsp;<span class="ident" id="8380295">newServer</span><span class="op" id="8380304">.</span><span class="ident" id="8380305">Accept</span><span class="op" id="8380311">(</span><span class="ident" id="8380312">l</span><span class="op" id="8380313">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8380317">newServer</span><span class="op" id="8380326">.</span><span class="ident" id="8380327">HandleHTTP</span><span class="op" id="8380337">(</span><span class="ident" id="8380338">newHttpPath</span><span class="op" id="8380349">,</span>&nbsp;<span class="string" id="8380351">&#34;/bar&#34;</span><span class="op" id="8380357">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8380360">httpOnce</span><span class="op" id="8380368">.</span><span class="ident" id="8380369">Do</span><span class="op" id="8380371">(</span><span class="ident" id="8380372">startHttpServer</span><span class="op" id="8380387">)</span><br>
<span class="lineno"></span><span class="op" id="8380389">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8380392">func</span>&nbsp;<span class="ident" id="8380397">startHttpServer</span><span class="op" id="8380412">(</span><span class="op" id="8380413">)</span>&nbsp;<span class="op" id="8380415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8380418">server</span>&nbsp;<span class="op" id="8380425">:=</span>&nbsp;<span class="ident" id="8380428">httptest</span><span class="op" id="8380436">.</span><span class="ident" id="8380437">NewServer</span><span class="op" id="8380446">(</span><span class="ident" id="8380447">nil</span><span class="op" id="8380450">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8380453">httpServerAddr</span>&nbsp;<span class="op" id="8380468">=</span>&nbsp;<span class="ident" id="8380470">server</span><span class="op" id="8380476">.</span><span class="ident" id="8380477">Listener</span><span class="op" id="8380485">.</span><span class="ident" id="8380486">Addr</span><span class="op" id="8380490">(</span><span class="op" id="8380491">)</span><span class="op" id="8380492">.</span><span class="ident" id="8380493">String</span><span class="op" id="8380499">(</span><span class="op" id="8380500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8380503">log</span><span class="op" id="8380506">.</span><span class="ident" id="8380507">Println</span><span class="op" id="8380514">(</span><span class="string" id="8380515">&#34;Test&nbsp;HTTP&nbsp;RPC&nbsp;server&nbsp;listening&nbsp;on&#34;</span><span class="op" id="8380550">,</span>&nbsp;<span class="ident" id="8380552">httpServerAddr</span><span class="op" id="8380566">)</span><br>
<span class="lineno"></span><span class="op" id="8380568">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8380571">func</span>&nbsp;<span class="ident" id="8380576">TestRPC</span><span class="op" id="8380583">(</span><span class="ident" id="8380584">t</span>&nbsp;<span class="op" id="8380586">*</span><span class="ident" id="8380587">testing</span><span class="op" id="8380594">.</span><span class="ident" id="8380595">T</span><span class="op" id="8380596">)</span>&nbsp;<span class="op" id="8380598">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8380601">once</span><span class="op" id="8380605">.</span><span class="ident" id="8380606">Do</span><span class="op" id="8380608">(</span><span class="ident" id="8380609">startServer</span><span class="op" id="8380620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8380623">testRPC</span><span class="op" id="8380630">(</span><span class="ident" id="8380631">t</span><span class="op" id="8380632">,</span>&nbsp;<span class="ident" id="8380634">serverAddr</span><span class="op" id="8380644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8380647">newOnce</span><span class="op" id="8380654">.</span><span class="ident" id="8380655">Do</span><span class="op" id="8380657">(</span><span class="ident" id="8380658">startNewServer</span><span class="op" id="8380672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8380675">testRPC</span><span class="op" id="8380682">(</span><span class="ident" id="8380683">t</span><span class="op" id="8380684">,</span>&nbsp;<span class="ident" id="8380686">newServerAddr</span><span class="op" id="8380699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8380702">testNewServerRPC</span><span class="op" id="8380718">(</span><span class="ident" id="8380719">t</span><span class="op" id="8380720">,</span>&nbsp;<span class="ident" id="8380722">newServerAddr</span><span class="op" id="8380735">)</span><br>
<span class="lineno">125</span><span class="op" id="8380737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8380740">func</span>&nbsp;<span class="ident" id="8380745">testRPC</span><span class="op" id="8380752">(</span><span class="ident" id="8380753">t</span>&nbsp;<span class="op" id="8380755">*</span><span class="ident" id="8380756">testing</span><span class="op" id="8380763">.</span><span class="ident" id="8380764">T</span><span class="op" id="8380765">,</span>&nbsp;<span class="ident" id="8380767">addr</span>&nbsp;<span class="builtintype" id="8380772">string</span><span class="op" id="8380778">)</span>&nbsp;<span class="op" id="8380780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8380783">client</span><span class="op" id="8380789">,</span>&nbsp;<span class="ident" id="8380791">err</span>&nbsp;<span class="op" id="8380795">:=</span>&nbsp;<span class="ident" id="8380798">Dial</span><span class="op" id="8380802">(</span><span class="string" id="8380803">&#34;tcp&#34;</span><span class="op" id="8380808">,</span>&nbsp;<span class="ident" id="8380810">addr</span><span class="op" id="8380814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8380817">if</span>&nbsp;<span class="ident" id="8380820">err</span>&nbsp;<span class="op" id="8380824">!=</span>&nbsp;<span class="ident" id="8380827">nil</span>&nbsp;<span class="op" id="8380831">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8380835">t</span><span class="op" id="8380836">.</span><span class="ident" id="8380837">Fatal</span><span class="op" id="8380842">(</span><span class="string" id="8380843">&#34;dialing&#34;</span><span class="op" id="8380852">,</span>&nbsp;<span class="ident" id="8380854">err</span><span class="op" id="8380857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8380860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8380863">defer</span>&nbsp;<span class="ident" id="8380869">client</span><span class="op" id="8380875">.</span><span class="ident" id="8380876">Close</span><span class="op" id="8380881">(</span><span class="op" id="8380882">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8380886">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8380908">args</span>&nbsp;<span class="op" id="8380913">:=</span>&nbsp;<span class="op" id="8380916">&amp;</span><span class="ident" id="8380917">Args</span><span class="op" id="8380921">{</span><span class="num" id="8380922">7</span><span class="op" id="8380923">,</span>&nbsp;<span class="num" id="8380925">8</span><span class="op" id="8380926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8380929">reply</span>&nbsp;<span class="op" id="8380935">:=</span>&nbsp;<span class="builtinfunc" id="8380938">new</span><span class="op" id="8380941">(</span><span class="ident" id="8380942">Reply</span><span class="op" id="8380947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8380950">err</span>&nbsp;<span class="op" id="8380954">=</span>&nbsp;<span class="ident" id="8380956">client</span><span class="op" id="8380962">.</span><span class="ident" id="8380963">Call</span><span class="op" id="8380967">(</span><span class="string" id="8380968">&#34;Arith.Add&#34;</span><span class="op" id="8380979">,</span>&nbsp;<span class="ident" id="8380981">args</span><span class="op" id="8380985">,</span>&nbsp;<span class="ident" id="8380987">reply</span><span class="op" id="8380992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8380995">if</span>&nbsp;<span class="ident" id="8380998">err</span>&nbsp;<span class="op" id="8381002">!=</span>&nbsp;<span class="ident" id="8381005">nil</span>&nbsp;<span class="op" id="8381009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8381013">t</span><span class="op" id="8381014">.</span><span class="ident" id="8381015">Errorf</span><span class="op" id="8381021">(</span><span class="string" id="8381022">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8381064">,</span>&nbsp;<span class="ident" id="8381066">err</span><span class="op" id="8381069">.</span><span class="ident" id="8381070">Error</span><span class="op" id="8381075">(</span><span class="op" id="8381076">)</span><span class="op" id="8381077">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8381080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8381083">if</span>&nbsp;<span class="ident" id="8381086">reply</span><span class="op" id="8381091">.</span><span class="ident" id="8381092">C</span>&nbsp;<span class="op" id="8381094">!=</span>&nbsp;<span class="ident" id="8381097">args</span><span class="op" id="8381101">.</span><span class="ident" id="8381102">A</span><span class="op" id="8381103">+</span><span class="ident" id="8381104">args</span><span class="op" id="8381108">.</span><span class="ident" id="8381109">B</span>&nbsp;<span class="op" id="8381111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8381115">t</span><span class="op" id="8381116">.</span><span class="ident" id="8381117">Errorf</span><span class="op" id="8381123">(</span><span class="string" id="8381124">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8381149">,</span>&nbsp;<span class="ident" id="8381151">reply</span><span class="op" id="8381156">.</span><span class="ident" id="8381157">C</span><span class="op" id="8381158">,</span>&nbsp;<span class="ident" id="8381160">args</span><span class="op" id="8381164">.</span><span class="ident" id="8381165">A</span><span class="op" id="8381166">+</span><span class="ident" id="8381167">args</span><span class="op" id="8381171">.</span><span class="ident" id="8381172">B</span><span class="op" id="8381173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8381176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8381180">//&nbsp;Nonexistent&nbsp;method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8381203">args</span>&nbsp;<span class="op" id="8381208">=</span>&nbsp;<span class="op" id="8381210">&amp;</span><span class="ident" id="8381211">Args</span><span class="op" id="8381215">{</span><span class="num" id="8381216">7</span><span class="op" id="8381217">,</span>&nbsp;<span class="num" id="8381219">0</span><span class="op" id="8381220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8381223">reply</span>&nbsp;<span class="op" id="8381229">=</span>&nbsp;<span class="builtinfunc" id="8381231">new</span><span class="op" id="8381234">(</span><span class="ident" id="8381235">Reply</span><span class="op" id="8381240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8381243">err</span>&nbsp;<span class="op" id="8381247">=</span>&nbsp;<span class="ident" id="8381249">client</span><span class="op" id="8381255">.</span><span class="ident" id="8381256">Call</span><span class="op" id="8381260">(</span><span class="string" id="8381261">&#34;Arith.BadOperation&#34;</span><span class="op" id="8381281">,</span>&nbsp;<span class="ident" id="8381283">args</span><span class="op" id="8381287">,</span>&nbsp;<span class="ident" id="8381289">reply</span><span class="op" id="8381294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8381297">//&nbsp;expect&nbsp;an&nbsp;error</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8381317">if</span>&nbsp;<span class="ident" id="8381320">err</span>&nbsp;<span class="op" id="8381324">==</span>&nbsp;<span class="ident" id="8381327">nil</span>&nbsp;<span class="op" id="8381331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8381335">t</span><span class="op" id="8381336">.</span><span class="ident" id="8381337">Error</span><span class="op" id="8381342">(</span><span class="string" id="8381343">&#34;BadOperation:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="8381373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8381376">}</span>&nbsp;<span class="keyword" id="8381378">else</span>&nbsp;<span class="keyword" id="8381383">if</span>&nbsp;<span class="op" id="8381386">!</span><span class="ident" id="8381387">strings</span><span class="op" id="8381394">.</span><span class="ident" id="8381395">HasPrefix</span><span class="op" id="8381404">(</span><span class="ident" id="8381405">err</span><span class="op" id="8381408">.</span><span class="ident" id="8381409">Error</span><span class="op" id="8381414">(</span><span class="op" id="8381415">)</span><span class="op" id="8381416">,</span>&nbsp;<span class="string" id="8381418">&#34;rpc:&nbsp;can&#39;t&nbsp;find&nbsp;method&nbsp;&#34;</span><span class="op" id="8381443">)</span>&nbsp;<span class="op" id="8381445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8381449">t</span><span class="op" id="8381450">.</span><span class="ident" id="8381451">Errorf</span><span class="op" id="8381457">(</span><span class="string" id="8381458">&#34;BadOperation:&nbsp;expected&nbsp;can&#39;t&nbsp;find&nbsp;method&nbsp;error;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="8381514">,</span>&nbsp;<span class="ident" id="8381516">err</span><span class="op" id="8381519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8381522">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8381526">//&nbsp;Unknown&nbsp;service</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8381546">args</span>&nbsp;<span class="op" id="8381551">=</span>&nbsp;<span class="op" id="8381553">&amp;</span><span class="ident" id="8381554">Args</span><span class="op" id="8381558">{</span><span class="num" id="8381559">7</span><span class="op" id="8381560">,</span>&nbsp;<span class="num" id="8381562">8</span><span class="op" id="8381563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8381566">reply</span>&nbsp;<span class="op" id="8381572">=</span>&nbsp;<span class="builtinfunc" id="8381574">new</span><span class="op" id="8381577">(</span><span class="ident" id="8381578">Reply</span><span class="op" id="8381583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8381586">err</span>&nbsp;<span class="op" id="8381590">=</span>&nbsp;<span class="ident" id="8381592">client</span><span class="op" id="8381598">.</span><span class="ident" id="8381599">Call</span><span class="op" id="8381603">(</span><span class="string" id="8381604">&#34;Arith.Unknown&#34;</span><span class="op" id="8381619">,</span>&nbsp;<span class="ident" id="8381621">args</span><span class="op" id="8381625">,</span>&nbsp;<span class="ident" id="8381627">reply</span><span class="op" id="8381632">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8381635">if</span>&nbsp;<span class="ident" id="8381638">err</span>&nbsp;<span class="op" id="8381642">==</span>&nbsp;<span class="ident" id="8381645">nil</span>&nbsp;<span class="op" id="8381649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8381653">t</span><span class="op" id="8381654">.</span><span class="ident" id="8381655">Error</span><span class="op" id="8381660">(</span><span class="string" id="8381661">&#34;expected&nbsp;error&nbsp;calling&nbsp;unknown&nbsp;service&#34;</span><span class="op" id="8381701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8381704">}</span>&nbsp;<span class="keyword" id="8381706">else</span>&nbsp;<span class="keyword" id="8381711">if</span>&nbsp;<span class="ident" id="8381714">strings</span><span class="op" id="8381721">.</span><span class="ident" id="8381722">Index</span><span class="op" id="8381727">(</span><span class="ident" id="8381728">err</span><span class="op" id="8381731">.</span><span class="ident" id="8381732">Error</span><span class="op" id="8381737">(</span><span class="op" id="8381738">)</span><span class="op" id="8381739">,</span>&nbsp;<span class="string" id="8381741">&#34;method&#34;</span><span class="op" id="8381749">)</span>&nbsp;<span class="op" id="8381751">&lt;</span>&nbsp;<span class="num" id="8381753">0</span>&nbsp;<span class="op" id="8381755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8381759">t</span><span class="op" id="8381760">.</span><span class="ident" id="8381761">Error</span><span class="op" id="8381766">(</span><span class="string" id="8381767">&#34;expected&nbsp;error&nbsp;about&nbsp;method;&nbsp;got&#34;</span><span class="op" id="8381801">,</span>&nbsp;<span class="ident" id="8381803">err</span><span class="op" id="8381806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8381809">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8381813">//&nbsp;Out&nbsp;of&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8381831">args</span>&nbsp;<span class="op" id="8381836">=</span>&nbsp;<span class="op" id="8381838">&amp;</span><span class="ident" id="8381839">Args</span><span class="op" id="8381843">{</span><span class="num" id="8381844">7</span><span class="op" id="8381845">,</span>&nbsp;<span class="num" id="8381847">8</span><span class="op" id="8381848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8381851">mulReply</span>&nbsp;<span class="op" id="8381860">:=</span>&nbsp;<span class="builtinfunc" id="8381863">new</span><span class="op" id="8381866">(</span><span class="ident" id="8381867">Reply</span><span class="op" id="8381872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8381875">mulCall</span>&nbsp;<span class="op" id="8381883">:=</span>&nbsp;<span class="ident" id="8381886">client</span><span class="op" id="8381892">.</span><span class="ident" id="8381893">Go</span><span class="op" id="8381895">(</span><span class="string" id="8381896">&#34;Arith.Mul&#34;</span><span class="op" id="8381907">,</span>&nbsp;<span class="ident" id="8381909">args</span><span class="op" id="8381913">,</span>&nbsp;<span class="ident" id="8381915">mulReply</span><span class="op" id="8381923">,</span>&nbsp;<span class="ident" id="8381925">nil</span><span class="op" id="8381928">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8381931">addReply</span>&nbsp;<span class="op" id="8381940">:=</span>&nbsp;<span class="builtinfunc" id="8381943">new</span><span class="op" id="8381946">(</span><span class="ident" id="8381947">Reply</span><span class="op" id="8381952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8381955">addCall</span>&nbsp;<span class="op" id="8381963">:=</span>&nbsp;<span class="ident" id="8381966">client</span><span class="op" id="8381972">.</span><span class="ident" id="8381973">Go</span><span class="op" id="8381975">(</span><span class="string" id="8381976">&#34;Arith.Add&#34;</span><span class="op" id="8381987">,</span>&nbsp;<span class="ident" id="8381989">args</span><span class="op" id="8381993">,</span>&nbsp;<span class="ident" id="8381995">addReply</span><span class="op" id="8382003">,</span>&nbsp;<span class="ident" id="8382005">nil</span><span class="op" id="8382008">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8382012">addCall</span>&nbsp;<span class="op" id="8382020">=</span>&nbsp;<span class="op" id="8382022">&lt;-</span><span class="ident" id="8382024">addCall</span><span class="op" id="8382031">.</span><span class="ident" id="8382032">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8382038">if</span>&nbsp;<span class="ident" id="8382041">addCall</span><span class="op" id="8382048">.</span><span class="ident" id="8382049">Error</span>&nbsp;<span class="op" id="8382055">!=</span>&nbsp;<span class="ident" id="8382058">nil</span>&nbsp;<span class="op" id="8382062">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8382066">t</span><span class="op" id="8382067">.</span><span class="ident" id="8382068">Errorf</span><span class="op" id="8382074">(</span><span class="string" id="8382075">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8382117">,</span>&nbsp;<span class="ident" id="8382119">addCall</span><span class="op" id="8382126">.</span><span class="ident" id="8382127">Error</span><span class="op" id="8382132">.</span><span class="ident" id="8382133">Error</span><span class="op" id="8382138">(</span><span class="op" id="8382139">)</span><span class="op" id="8382140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8382143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8382146">if</span>&nbsp;<span class="ident" id="8382149">addReply</span><span class="op" id="8382157">.</span><span class="ident" id="8382158">C</span>&nbsp;<span class="op" id="8382160">!=</span>&nbsp;<span class="ident" id="8382163">args</span><span class="op" id="8382167">.</span><span class="ident" id="8382168">A</span><span class="op" id="8382169">+</span><span class="ident" id="8382170">args</span><span class="op" id="8382174">.</span><span class="ident" id="8382175">B</span>&nbsp;<span class="op" id="8382177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8382181">t</span><span class="op" id="8382182">.</span><span class="ident" id="8382183">Errorf</span><span class="op" id="8382189">(</span><span class="string" id="8382190">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8382215">,</span>&nbsp;<span class="ident" id="8382217">addReply</span><span class="op" id="8382225">.</span><span class="ident" id="8382226">C</span><span class="op" id="8382227">,</span>&nbsp;<span class="ident" id="8382229">args</span><span class="op" id="8382233">.</span><span class="ident" id="8382234">A</span><span class="op" id="8382235">+</span><span class="ident" id="8382236">args</span><span class="op" id="8382240">.</span><span class="ident" id="8382241">B</span><span class="op" id="8382242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8382245">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8382249">mulCall</span>&nbsp;<span class="op" id="8382257">=</span>&nbsp;<span class="op" id="8382259">&lt;-</span><span class="ident" id="8382261">mulCall</span><span class="op" id="8382268">.</span><span class="ident" id="8382269">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8382275">if</span>&nbsp;<span class="ident" id="8382278">mulCall</span><span class="op" id="8382285">.</span><span class="ident" id="8382286">Error</span>&nbsp;<span class="op" id="8382292">!=</span>&nbsp;<span class="ident" id="8382295">nil</span>&nbsp;<span class="op" id="8382299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8382303">t</span><span class="op" id="8382304">.</span><span class="ident" id="8382305">Errorf</span><span class="op" id="8382311">(</span><span class="string" id="8382312">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8382354">,</span>&nbsp;<span class="ident" id="8382356">mulCall</span><span class="op" id="8382363">.</span><span class="ident" id="8382364">Error</span><span class="op" id="8382369">.</span><span class="ident" id="8382370">Error</span><span class="op" id="8382375">(</span><span class="op" id="8382376">)</span><span class="op" id="8382377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8382380">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8382383">if</span>&nbsp;<span class="ident" id="8382386">mulReply</span><span class="op" id="8382394">.</span><span class="ident" id="8382395">C</span>&nbsp;<span class="op" id="8382397">!=</span>&nbsp;<span class="ident" id="8382400">args</span><span class="op" id="8382404">.</span><span class="ident" id="8382405">A</span><span class="op" id="8382406">*</span><span class="ident" id="8382407">args</span><span class="op" id="8382411">.</span><span class="ident" id="8382412">B</span>&nbsp;<span class="op" id="8382414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8382418">t</span><span class="op" id="8382419">.</span><span class="ident" id="8382420">Errorf</span><span class="op" id="8382426">(</span><span class="string" id="8382427">&#34;Mul:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8382452">,</span>&nbsp;<span class="ident" id="8382454">mulReply</span><span class="op" id="8382462">.</span><span class="ident" id="8382463">C</span><span class="op" id="8382464">,</span>&nbsp;<span class="ident" id="8382466">args</span><span class="op" id="8382470">.</span><span class="ident" id="8382471">A</span><span class="op" id="8382472">*</span><span class="ident" id="8382473">args</span><span class="op" id="8382477">.</span><span class="ident" id="8382478">B</span><span class="op" id="8382479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8382482">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8382486">//&nbsp;Error&nbsp;test</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8382501">args</span>&nbsp;<span class="op" id="8382506">=</span>&nbsp;<span class="op" id="8382508">&amp;</span><span class="ident" id="8382509">Args</span><span class="op" id="8382513">{</span><span class="num" id="8382514">7</span><span class="op" id="8382515">,</span>&nbsp;<span class="num" id="8382517">0</span><span class="op" id="8382518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8382521">reply</span>&nbsp;<span class="op" id="8382527">=</span>&nbsp;<span class="builtinfunc" id="8382529">new</span><span class="op" id="8382532">(</span><span class="ident" id="8382533">Reply</span><span class="op" id="8382538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8382541">err</span>&nbsp;<span class="op" id="8382545">=</span>&nbsp;<span class="ident" id="8382547">client</span><span class="op" id="8382553">.</span><span class="ident" id="8382554">Call</span><span class="op" id="8382558">(</span><span class="string" id="8382559">&#34;Arith.Div&#34;</span><span class="op" id="8382570">,</span>&nbsp;<span class="ident" id="8382572">args</span><span class="op" id="8382576">,</span>&nbsp;<span class="ident" id="8382578">reply</span><span class="op" id="8382583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8382586">//&nbsp;expect&nbsp;an&nbsp;error:&nbsp;zero&nbsp;divide</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8382619">if</span>&nbsp;<span class="ident" id="8382622">err</span>&nbsp;<span class="op" id="8382626">==</span>&nbsp;<span class="ident" id="8382629">nil</span>&nbsp;<span class="op" id="8382633">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8382637">t</span><span class="op" id="8382638">.</span><span class="ident" id="8382639">Error</span><span class="op" id="8382644">(</span><span class="string" id="8382645">&#34;Div:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="8382666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8382669">}</span>&nbsp;<span class="keyword" id="8382671">else</span>&nbsp;<span class="keyword" id="8382676">if</span>&nbsp;<span class="ident" id="8382679">err</span><span class="op" id="8382682">.</span><span class="ident" id="8382683">Error</span><span class="op" id="8382688">(</span><span class="op" id="8382689">)</span>&nbsp;<span class="op" id="8382691">!=</span>&nbsp;<span class="string" id="8382694">&#34;divide&nbsp;by&nbsp;zero&#34;</span>&nbsp;<span class="op" id="8382711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8382715">t</span><span class="op" id="8382716">.</span><span class="ident" id="8382717">Error</span><span class="op" id="8382722">(</span><span class="string" id="8382723">&#34;Div:&nbsp;expected&nbsp;divide&nbsp;by&nbsp;zero&nbsp;error;&nbsp;got&#34;</span><span class="op" id="8382764">,</span>&nbsp;<span class="ident" id="8382766">err</span><span class="op" id="8382769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8382772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8382776">//&nbsp;Bad&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8382790">reply</span>&nbsp;<span class="op" id="8382796">=</span>&nbsp;<span class="builtinfunc" id="8382798">new</span><span class="op" id="8382801">(</span><span class="ident" id="8382802">Reply</span><span class="op" id="8382807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8382810">err</span>&nbsp;<span class="op" id="8382814">=</span>&nbsp;<span class="ident" id="8382816">client</span><span class="op" id="8382822">.</span><span class="ident" id="8382823">Call</span><span class="op" id="8382827">(</span><span class="string" id="8382828">&#34;Arith.Add&#34;</span><span class="op" id="8382839">,</span>&nbsp;<span class="ident" id="8382841">reply</span><span class="op" id="8382846">,</span>&nbsp;<span class="ident" id="8382848">reply</span><span class="op" id="8382853">)</span>&nbsp;<span class="comment" id="8382855">//&nbsp;args,&nbsp;reply&nbsp;would&nbsp;be&nbsp;the&nbsp;correct&nbsp;thing&nbsp;to&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8382905">if</span>&nbsp;<span class="ident" id="8382908">err</span>&nbsp;<span class="op" id="8382912">==</span>&nbsp;<span class="ident" id="8382915">nil</span>&nbsp;<span class="op" id="8382919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8382923">t</span><span class="op" id="8382924">.</span><span class="ident" id="8382925">Error</span><span class="op" id="8382930">(</span><span class="string" id="8382931">&#34;expected&nbsp;error&nbsp;calling&nbsp;Arith.Add&nbsp;with&nbsp;wrong&nbsp;arg&nbsp;type&#34;</span><span class="op" id="8382985">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8382988">}</span>&nbsp;<span class="keyword" id="8382990">else</span>&nbsp;<span class="keyword" id="8382995">if</span>&nbsp;<span class="ident" id="8382998">strings</span><span class="op" id="8383005">.</span><span class="ident" id="8383006">Index</span><span class="op" id="8383011">(</span><span class="ident" id="8383012">err</span><span class="op" id="8383015">.</span><span class="ident" id="8383016">Error</span><span class="op" id="8383021">(</span><span class="op" id="8383022">)</span><span class="op" id="8383023">,</span>&nbsp;<span class="string" id="8383025">&#34;type&#34;</span><span class="op" id="8383031">)</span>&nbsp;<span class="op" id="8383033">&lt;</span>&nbsp;<span class="num" id="8383035">0</span>&nbsp;<span class="op" id="8383037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8383041">t</span><span class="op" id="8383042">.</span><span class="ident" id="8383043">Error</span><span class="op" id="8383048">(</span><span class="string" id="8383049">&#34;expected&nbsp;error&nbsp;about&nbsp;type;&nbsp;got&#34;</span><span class="op" id="8383081">,</span>&nbsp;<span class="ident" id="8383083">err</span><span class="op" id="8383086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8383089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8383093">//&nbsp;Non-struct&nbsp;argument</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8383117">const</span>&nbsp;<span class="ident" id="8383123">Val</span>&nbsp;<span class="op" id="8383127">=</span>&nbsp;<span class="num" id="8383129">12345</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8383136">str</span>&nbsp;<span class="op" id="8383140">:=</span>&nbsp;<span class="ident" id="8383143">fmt</span><span class="op" id="8383146">.</span><span class="ident" id="8383147">Sprint</span><span class="op" id="8383153">(</span><span class="ident" id="8383154">Val</span><span class="op" id="8383157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8383160">reply</span>&nbsp;<span class="op" id="8383166">=</span>&nbsp;<span class="builtinfunc" id="8383168">new</span><span class="op" id="8383171">(</span><span class="ident" id="8383172">Reply</span><span class="op" id="8383177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8383180">err</span>&nbsp;<span class="op" id="8383184">=</span>&nbsp;<span class="ident" id="8383186">client</span><span class="op" id="8383192">.</span><span class="ident" id="8383193">Call</span><span class="op" id="8383197">(</span><span class="string" id="8383198">&#34;Arith.Scan&#34;</span><span class="op" id="8383210">,</span>&nbsp;<span class="op" id="8383212">&amp;</span><span class="ident" id="8383213">str</span><span class="op" id="8383216">,</span>&nbsp;<span class="ident" id="8383218">reply</span><span class="op" id="8383223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8383226">if</span>&nbsp;<span class="ident" id="8383229">err</span>&nbsp;<span class="op" id="8383233">!=</span>&nbsp;<span class="ident" id="8383236">nil</span>&nbsp;<span class="op" id="8383240">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8383244">t</span><span class="op" id="8383245">.</span><span class="ident" id="8383246">Errorf</span><span class="op" id="8383252">(</span><span class="string" id="8383253">&#34;Scan:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8383296">,</span>&nbsp;<span class="ident" id="8383298">err</span><span class="op" id="8383301">.</span><span class="ident" id="8383302">Error</span><span class="op" id="8383307">(</span><span class="op" id="8383308">)</span><span class="op" id="8383309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8383312">}</span>&nbsp;<span class="keyword" id="8383314">else</span>&nbsp;<span class="keyword" id="8383319">if</span>&nbsp;<span class="ident" id="8383322">reply</span><span class="op" id="8383327">.</span><span class="ident" id="8383328">C</span>&nbsp;<span class="op" id="8383330">!=</span>&nbsp;<span class="ident" id="8383333">Val</span>&nbsp;<span class="op" id="8383337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8383341">t</span><span class="op" id="8383342">.</span><span class="ident" id="8383343">Errorf</span><span class="op" id="8383349">(</span><span class="string" id="8383350">&#34;Scan:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8383376">,</span>&nbsp;<span class="ident" id="8383378">Val</span><span class="op" id="8383381">,</span>&nbsp;<span class="ident" id="8383383">reply</span><span class="op" id="8383388">.</span><span class="ident" id="8383389">C</span><span class="op" id="8383390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8383393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8383397">//&nbsp;Non-struct&nbsp;reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8383418">args</span>&nbsp;<span class="op" id="8383423">=</span>&nbsp;<span class="op" id="8383425">&amp;</span><span class="ident" id="8383426">Args</span><span class="op" id="8383430">{</span><span class="num" id="8383431">27</span><span class="op" id="8383433">,</span>&nbsp;<span class="num" id="8383435">35</span><span class="op" id="8383437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8383440">str</span>&nbsp;<span class="op" id="8383444">=</span>&nbsp;<span class="string" id="8383446">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8383450">err</span>&nbsp;<span class="op" id="8383454">=</span>&nbsp;<span class="ident" id="8383456">client</span><span class="op" id="8383462">.</span><span class="ident" id="8383463">Call</span><span class="op" id="8383467">(</span><span class="string" id="8383468">&#34;Arith.String&#34;</span><span class="op" id="8383482">,</span>&nbsp;<span class="ident" id="8383484">args</span><span class="op" id="8383488">,</span>&nbsp;<span class="op" id="8383490">&amp;</span><span class="ident" id="8383491">str</span><span class="op" id="8383494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8383497">if</span>&nbsp;<span class="ident" id="8383500">err</span>&nbsp;<span class="op" id="8383504">!=</span>&nbsp;<span class="ident" id="8383507">nil</span>&nbsp;<span class="op" id="8383511">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8383515">t</span><span class="op" id="8383516">.</span><span class="ident" id="8383517">Errorf</span><span class="op" id="8383523">(</span><span class="string" id="8383524">&#34;String:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8383569">,</span>&nbsp;<span class="ident" id="8383571">err</span><span class="op" id="8383574">.</span><span class="ident" id="8383575">Error</span><span class="op" id="8383580">(</span><span class="op" id="8383581">)</span><span class="op" id="8383582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8383585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8383588">expect</span>&nbsp;<span class="op" id="8383595">:=</span>&nbsp;<span class="ident" id="8383598">fmt</span><span class="op" id="8383601">.</span><span class="ident" id="8383602">Sprintf</span><span class="op" id="8383609">(</span><span class="string" id="8383610">&#34;%d+%d=%d&#34;</span><span class="op" id="8383620">,</span>&nbsp;<span class="ident" id="8383622">args</span><span class="op" id="8383626">.</span><span class="ident" id="8383627">A</span><span class="op" id="8383628">,</span>&nbsp;<span class="ident" id="8383630">args</span><span class="op" id="8383634">.</span><span class="ident" id="8383635">B</span><span class="op" id="8383636">,</span>&nbsp;<span class="ident" id="8383638">args</span><span class="op" id="8383642">.</span><span class="ident" id="8383643">A</span><span class="op" id="8383644">+</span><span class="ident" id="8383645">args</span><span class="op" id="8383649">.</span><span class="ident" id="8383650">B</span><span class="op" id="8383651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8383654">if</span>&nbsp;<span class="ident" id="8383657">str</span>&nbsp;<span class="op" id="8383661">!=</span>&nbsp;<span class="ident" id="8383664">expect</span>&nbsp;<span class="op" id="8383671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8383675">t</span><span class="op" id="8383676">.</span><span class="ident" id="8383677">Errorf</span><span class="op" id="8383683">(</span><span class="string" id="8383684">&#34;String:&nbsp;expected&nbsp;%s&nbsp;got&nbsp;%s&#34;</span><span class="op" id="8383712">,</span>&nbsp;<span class="ident" id="8383714">expect</span><span class="op" id="8383720">,</span>&nbsp;<span class="ident" id="8383722">str</span><span class="op" id="8383725">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8383728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8383732">args</span>&nbsp;<span class="op" id="8383737">=</span>&nbsp;<span class="op" id="8383739">&amp;</span><span class="ident" id="8383740">Args</span><span class="op" id="8383744">{</span><span class="num" id="8383745">7</span><span class="op" id="8383746">,</span>&nbsp;<span class="num" id="8383748">8</span><span class="op" id="8383749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8383752">reply</span>&nbsp;<span class="op" id="8383758">=</span>&nbsp;<span class="builtinfunc" id="8383760">new</span><span class="op" id="8383763">(</span><span class="ident" id="8383764">Reply</span><span class="op" id="8383769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8383772">err</span>&nbsp;<span class="op" id="8383776">=</span>&nbsp;<span class="ident" id="8383778">client</span><span class="op" id="8383784">.</span><span class="ident" id="8383785">Call</span><span class="op" id="8383789">(</span><span class="string" id="8383790">&#34;Arith.Mul&#34;</span><span class="op" id="8383801">,</span>&nbsp;<span class="ident" id="8383803">args</span><span class="op" id="8383807">,</span>&nbsp;<span class="ident" id="8383809">reply</span><span class="op" id="8383814">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8383817">if</span>&nbsp;<span class="ident" id="8383820">err</span>&nbsp;<span class="op" id="8383824">!=</span>&nbsp;<span class="ident" id="8383827">nil</span>&nbsp;<span class="op" id="8383831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8383835">t</span><span class="op" id="8383836">.</span><span class="ident" id="8383837">Errorf</span><span class="op" id="8383843">(</span><span class="string" id="8383844">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8383886">,</span>&nbsp;<span class="ident" id="8383888">err</span><span class="op" id="8383891">.</span><span class="ident" id="8383892">Error</span><span class="op" id="8383897">(</span><span class="op" id="8383898">)</span><span class="op" id="8383899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8383902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8383905">if</span>&nbsp;<span class="ident" id="8383908">reply</span><span class="op" id="8383913">.</span><span class="ident" id="8383914">C</span>&nbsp;<span class="op" id="8383916">!=</span>&nbsp;<span class="ident" id="8383919">args</span><span class="op" id="8383923">.</span><span class="ident" id="8383924">A</span><span class="op" id="8383925">*</span><span class="ident" id="8383926">args</span><span class="op" id="8383930">.</span><span class="ident" id="8383931">B</span>&nbsp;<span class="op" id="8383933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8383937">t</span><span class="op" id="8383938">.</span><span class="ident" id="8383939">Errorf</span><span class="op" id="8383945">(</span><span class="string" id="8383946">&#34;Mul:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8383971">,</span>&nbsp;<span class="ident" id="8383973">reply</span><span class="op" id="8383978">.</span><span class="ident" id="8383979">C</span><span class="op" id="8383980">,</span>&nbsp;<span class="ident" id="8383982">args</span><span class="op" id="8383986">.</span><span class="ident" id="8383987">A</span><span class="op" id="8383988">*</span><span class="ident" id="8383989">args</span><span class="op" id="8383993">.</span><span class="ident" id="8383994">B</span><span class="op" id="8383995">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8383998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8384002">//&nbsp;ServiceName&nbsp;contain&nbsp;&#34;.&#34;&nbsp;character</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8384040">args</span>&nbsp;<span class="op" id="8384045">=</span>&nbsp;<span class="op" id="8384047">&amp;</span><span class="ident" id="8384048">Args</span><span class="op" id="8384052">{</span><span class="num" id="8384053">7</span><span class="op" id="8384054">,</span>&nbsp;<span class="num" id="8384056">8</span><span class="op" id="8384057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8384060">reply</span>&nbsp;<span class="op" id="8384066">=</span>&nbsp;<span class="builtinfunc" id="8384068">new</span><span class="op" id="8384071">(</span><span class="ident" id="8384072">Reply</span><span class="op" id="8384077">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8384080">err</span>&nbsp;<span class="op" id="8384084">=</span>&nbsp;<span class="ident" id="8384086">client</span><span class="op" id="8384092">.</span><span class="ident" id="8384093">Call</span><span class="op" id="8384097">(</span><span class="string" id="8384098">&#34;net.rpc.Arith.Add&#34;</span><span class="op" id="8384117">,</span>&nbsp;<span class="ident" id="8384119">args</span><span class="op" id="8384123">,</span>&nbsp;<span class="ident" id="8384125">reply</span><span class="op" id="8384130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8384133">if</span>&nbsp;<span class="ident" id="8384136">err</span>&nbsp;<span class="op" id="8384140">!=</span>&nbsp;<span class="ident" id="8384143">nil</span>&nbsp;<span class="op" id="8384147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8384151">t</span><span class="op" id="8384152">.</span><span class="ident" id="8384153">Errorf</span><span class="op" id="8384159">(</span><span class="string" id="8384160">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8384202">,</span>&nbsp;<span class="ident" id="8384204">err</span><span class="op" id="8384207">.</span><span class="ident" id="8384208">Error</span><span class="op" id="8384213">(</span><span class="op" id="8384214">)</span><span class="op" id="8384215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8384218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8384221">if</span>&nbsp;<span class="ident" id="8384224">reply</span><span class="op" id="8384229">.</span><span class="ident" id="8384230">C</span>&nbsp;<span class="op" id="8384232">!=</span>&nbsp;<span class="ident" id="8384235">args</span><span class="op" id="8384239">.</span><span class="ident" id="8384240">A</span><span class="op" id="8384241">+</span><span class="ident" id="8384242">args</span><span class="op" id="8384246">.</span><span class="ident" id="8384247">B</span>&nbsp;<span class="op" id="8384249">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8384253">t</span><span class="op" id="8384254">.</span><span class="ident" id="8384255">Errorf</span><span class="op" id="8384261">(</span><span class="string" id="8384262">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8384287">,</span>&nbsp;<span class="ident" id="8384289">reply</span><span class="op" id="8384294">.</span><span class="ident" id="8384295">C</span><span class="op" id="8384296">,</span>&nbsp;<span class="ident" id="8384298">args</span><span class="op" id="8384302">.</span><span class="ident" id="8384303">A</span><span class="op" id="8384304">+</span><span class="ident" id="8384305">args</span><span class="op" id="8384309">.</span><span class="ident" id="8384310">B</span><span class="op" id="8384311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8384314">}</span><br>
<span class="lineno"></span><span class="op" id="8384316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8384319">func</span>&nbsp;<span class="ident" id="8384324">testNewServerRPC</span><span class="op" id="8384340">(</span><span class="ident" id="8384341">t</span>&nbsp;<span class="op" id="8384343">*</span><span class="ident" id="8384344">testing</span><span class="op" id="8384351">.</span><span class="ident" id="8384352">T</span><span class="op" id="8384353">,</span>&nbsp;<span class="ident" id="8384355">addr</span>&nbsp;<span class="builtintype" id="8384360">string</span><span class="op" id="8384366">)</span>&nbsp;<span class="op" id="8384368">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8384371">client</span><span class="op" id="8384377">,</span>&nbsp;<span class="ident" id="8384379">err</span>&nbsp;<span class="op" id="8384383">:=</span>&nbsp;<span class="ident" id="8384386">Dial</span><span class="op" id="8384390">(</span><span class="string" id="8384391">&#34;tcp&#34;</span><span class="op" id="8384396">,</span>&nbsp;<span class="ident" id="8384398">addr</span><span class="op" id="8384402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8384405">if</span>&nbsp;<span class="ident" id="8384408">err</span>&nbsp;<span class="op" id="8384412">!=</span>&nbsp;<span class="ident" id="8384415">nil</span>&nbsp;<span class="op" id="8384419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8384423">t</span><span class="op" id="8384424">.</span><span class="ident" id="8384425">Fatal</span><span class="op" id="8384430">(</span><span class="string" id="8384431">&#34;dialing&#34;</span><span class="op" id="8384440">,</span>&nbsp;<span class="ident" id="8384442">err</span><span class="op" id="8384445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8384448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8384451">defer</span>&nbsp;<span class="ident" id="8384457">client</span><span class="op" id="8384463">.</span><span class="ident" id="8384464">Close</span><span class="op" id="8384469">(</span><span class="op" id="8384470">)</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8384474">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8384496">args</span>&nbsp;<span class="op" id="8384501">:=</span>&nbsp;<span class="op" id="8384504">&amp;</span><span class="ident" id="8384505">Args</span><span class="op" id="8384509">{</span><span class="num" id="8384510">7</span><span class="op" id="8384511">,</span>&nbsp;<span class="num" id="8384513">8</span><span class="op" id="8384514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8384517">reply</span>&nbsp;<span class="op" id="8384523">:=</span>&nbsp;<span class="builtinfunc" id="8384526">new</span><span class="op" id="8384529">(</span><span class="ident" id="8384530">Reply</span><span class="op" id="8384535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8384538">err</span>&nbsp;<span class="op" id="8384542">=</span>&nbsp;<span class="ident" id="8384544">client</span><span class="op" id="8384550">.</span><span class="ident" id="8384551">Call</span><span class="op" id="8384555">(</span><span class="string" id="8384556">&#34;newServer.Arith.Add&#34;</span><span class="op" id="8384577">,</span>&nbsp;<span class="ident" id="8384579">args</span><span class="op" id="8384583">,</span>&nbsp;<span class="ident" id="8384585">reply</span><span class="op" id="8384590">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8384593">if</span>&nbsp;<span class="ident" id="8384596">err</span>&nbsp;<span class="op" id="8384600">!=</span>&nbsp;<span class="ident" id="8384603">nil</span>&nbsp;<span class="op" id="8384607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8384611">t</span><span class="op" id="8384612">.</span><span class="ident" id="8384613">Errorf</span><span class="op" id="8384619">(</span><span class="string" id="8384620">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8384662">,</span>&nbsp;<span class="ident" id="8384664">err</span><span class="op" id="8384667">.</span><span class="ident" id="8384668">Error</span><span class="op" id="8384673">(</span><span class="op" id="8384674">)</span><span class="op" id="8384675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8384678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8384681">if</span>&nbsp;<span class="ident" id="8384684">reply</span><span class="op" id="8384689">.</span><span class="ident" id="8384690">C</span>&nbsp;<span class="op" id="8384692">!=</span>&nbsp;<span class="ident" id="8384695">args</span><span class="op" id="8384699">.</span><span class="ident" id="8384700">A</span><span class="op" id="8384701">+</span><span class="ident" id="8384702">args</span><span class="op" id="8384706">.</span><span class="ident" id="8384707">B</span>&nbsp;<span class="op" id="8384709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8384713">t</span><span class="op" id="8384714">.</span><span class="ident" id="8384715">Errorf</span><span class="op" id="8384721">(</span><span class="string" id="8384722">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8384747">,</span>&nbsp;<span class="ident" id="8384749">reply</span><span class="op" id="8384754">.</span><span class="ident" id="8384755">C</span><span class="op" id="8384756">,</span>&nbsp;<span class="ident" id="8384758">args</span><span class="op" id="8384762">.</span><span class="ident" id="8384763">A</span><span class="op" id="8384764">+</span><span class="ident" id="8384765">args</span><span class="op" id="8384769">.</span><span class="ident" id="8384770">B</span><span class="op" id="8384771">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8384774">}</span><br>
<span class="lineno"></span><span class="op" id="8384776">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8384779">func</span>&nbsp;<span class="ident" id="8384784">TestHTTP</span><span class="op" id="8384792">(</span><span class="ident" id="8384793">t</span>&nbsp;<span class="op" id="8384795">*</span><span class="ident" id="8384796">testing</span><span class="op" id="8384803">.</span><span class="ident" id="8384804">T</span><span class="op" id="8384805">)</span>&nbsp;<span class="op" id="8384807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8384810">once</span><span class="op" id="8384814">.</span><span class="ident" id="8384815">Do</span><span class="op" id="8384817">(</span><span class="ident" id="8384818">startServer</span><span class="op" id="8384829">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8384832">testHTTPRPC</span><span class="op" id="8384843">(</span><span class="ident" id="8384844">t</span><span class="op" id="8384845">,</span>&nbsp;<span class="string" id="8384847">&#34;&#34;</span><span class="op" id="8384849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8384852">newOnce</span><span class="op" id="8384859">.</span><span class="ident" id="8384860">Do</span><span class="op" id="8384862">(</span><span class="ident" id="8384863">startNewServer</span><span class="op" id="8384877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8384880">testHTTPRPC</span><span class="op" id="8384891">(</span><span class="ident" id="8384892">t</span><span class="op" id="8384893">,</span>&nbsp;<span class="ident" id="8384895">newHttpPath</span><span class="op" id="8384906">)</span><br>
<span class="lineno"></span><span class="op" id="8384908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="8384911">func</span>&nbsp;<span class="ident" id="8384916">testHTTPRPC</span><span class="op" id="8384927">(</span><span class="ident" id="8384928">t</span>&nbsp;<span class="op" id="8384930">*</span><span class="ident" id="8384931">testing</span><span class="op" id="8384938">.</span><span class="ident" id="8384939">T</span><span class="op" id="8384940">,</span>&nbsp;<span class="ident" id="8384942">path</span>&nbsp;<span class="builtintype" id="8384947">string</span><span class="op" id="8384953">)</span>&nbsp;<span class="op" id="8384955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8384958">var</span>&nbsp;<span class="ident" id="8384962">client</span>&nbsp;<span class="op" id="8384969">*</span><span class="ident" id="8384970">Client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8384978">var</span>&nbsp;<span class="ident" id="8384982">err</span>&nbsp;<span class="builtintype" id="8384986">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8384993">if</span>&nbsp;<span class="ident" id="8384996">path</span>&nbsp;<span class="op" id="8385001">==</span>&nbsp;<span class="string" id="8385004">&#34;&#34;</span>&nbsp;<span class="op" id="8385007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8385011">client</span><span class="op" id="8385017">,</span>&nbsp;<span class="ident" id="8385019">err</span>&nbsp;<span class="op" id="8385023">=</span>&nbsp;<span class="ident" id="8385025">DialHTTP</span><span class="op" id="8385033">(</span><span class="string" id="8385034">&#34;tcp&#34;</span><span class="op" id="8385039">,</span>&nbsp;<span class="ident" id="8385041">httpServerAddr</span><span class="op" id="8385055">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8385058">}</span>&nbsp;<span class="keyword" id="8385060">else</span>&nbsp;<span class="op" id="8385065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8385069">client</span><span class="op" id="8385075">,</span>&nbsp;<span class="ident" id="8385077">err</span>&nbsp;<span class="op" id="8385081">=</span>&nbsp;<span class="ident" id="8385083">DialHTTPPath</span><span class="op" id="8385095">(</span><span class="string" id="8385096">&#34;tcp&#34;</span><span class="op" id="8385101">,</span>&nbsp;<span class="ident" id="8385103">httpServerAddr</span><span class="op" id="8385117">,</span>&nbsp;<span class="ident" id="8385119">path</span><span class="op" id="8385123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8385126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8385129">if</span>&nbsp;<span class="ident" id="8385132">err</span>&nbsp;<span class="op" id="8385136">!=</span>&nbsp;<span class="ident" id="8385139">nil</span>&nbsp;<span class="op" id="8385143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8385147">t</span><span class="op" id="8385148">.</span><span class="ident" id="8385149">Fatal</span><span class="op" id="8385154">(</span><span class="string" id="8385155">&#34;dialing&#34;</span><span class="op" id="8385164">,</span>&nbsp;<span class="ident" id="8385166">err</span><span class="op" id="8385169">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8385172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8385175">defer</span>&nbsp;<span class="ident" id="8385181">client</span><span class="op" id="8385187">.</span><span class="ident" id="8385188">Close</span><span class="op" id="8385193">(</span><span class="op" id="8385194">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8385198">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8385220">args</span>&nbsp;<span class="op" id="8385225">:=</span>&nbsp;<span class="op" id="8385228">&amp;</span><span class="ident" id="8385229">Args</span><span class="op" id="8385233">{</span><span class="num" id="8385234">7</span><span class="op" id="8385235">,</span>&nbsp;<span class="num" id="8385237">8</span><span class="op" id="8385238">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8385241">reply</span>&nbsp;<span class="op" id="8385247">:=</span>&nbsp;<span class="builtinfunc" id="8385250">new</span><span class="op" id="8385253">(</span><span class="ident" id="8385254">Reply</span><span class="op" id="8385259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8385262">err</span>&nbsp;<span class="op" id="8385266">=</span>&nbsp;<span class="ident" id="8385268">client</span><span class="op" id="8385274">.</span><span class="ident" id="8385275">Call</span><span class="op" id="8385279">(</span><span class="string" id="8385280">&#34;Arith.Add&#34;</span><span class="op" id="8385291">,</span>&nbsp;<span class="ident" id="8385293">args</span><span class="op" id="8385297">,</span>&nbsp;<span class="ident" id="8385299">reply</span><span class="op" id="8385304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8385307">if</span>&nbsp;<span class="ident" id="8385310">err</span>&nbsp;<span class="op" id="8385314">!=</span>&nbsp;<span class="ident" id="8385317">nil</span>&nbsp;<span class="op" id="8385321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8385325">t</span><span class="op" id="8385326">.</span><span class="ident" id="8385327">Errorf</span><span class="op" id="8385333">(</span><span class="string" id="8385334">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8385376">,</span>&nbsp;<span class="ident" id="8385378">err</span><span class="op" id="8385381">.</span><span class="ident" id="8385382">Error</span><span class="op" id="8385387">(</span><span class="op" id="8385388">)</span><span class="op" id="8385389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8385392">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8385395">if</span>&nbsp;<span class="ident" id="8385398">reply</span><span class="op" id="8385403">.</span><span class="ident" id="8385404">C</span>&nbsp;<span class="op" id="8385406">!=</span>&nbsp;<span class="ident" id="8385409">args</span><span class="op" id="8385413">.</span><span class="ident" id="8385414">A</span><span class="op" id="8385415">+</span><span class="ident" id="8385416">args</span><span class="op" id="8385420">.</span><span class="ident" id="8385421">B</span>&nbsp;<span class="op" id="8385423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8385427">t</span><span class="op" id="8385428">.</span><span class="ident" id="8385429">Errorf</span><span class="op" id="8385435">(</span><span class="string" id="8385436">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8385461">,</span>&nbsp;<span class="ident" id="8385463">reply</span><span class="op" id="8385468">.</span><span class="ident" id="8385469">C</span><span class="op" id="8385470">,</span>&nbsp;<span class="ident" id="8385472">args</span><span class="op" id="8385476">.</span><span class="ident" id="8385477">A</span><span class="op" id="8385478">+</span><span class="ident" id="8385479">args</span><span class="op" id="8385483">.</span><span class="ident" id="8385484">B</span><span class="op" id="8385485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8385488">}</span><br>
<span class="lineno"></span><span class="op" id="8385490">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span><span class="comment" id="8385493">//&nbsp;CodecEmulator&nbsp;provides&nbsp;a&nbsp;client-like&nbsp;api&nbsp;and&nbsp;a&nbsp;ServerCodec&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="8385566">//&nbsp;Can&nbsp;be&nbsp;used&nbsp;to&nbsp;test&nbsp;ServeRequest.</span><br>
<span class="lineno"></span><span class="keyword" id="8385603">type</span>&nbsp;<span class="ident" id="8385608">CodecEmulator</span>&nbsp;<span class="keyword" id="8385622">struct</span>&nbsp;<span class="op" id="8385629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8385632">server</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8385646">*</span><span class="ident" id="8385647">Server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8385655">serviceMethod</span>&nbsp;<span class="builtintype" id="8385669">string</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8385677">args</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8385691">*</span><span class="ident" id="8385692">Args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8385698">reply</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8385712">*</span><span class="ident" id="8385713">Reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8385720">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8385734">error</span><br>
<span class="lineno"></span><span class="op" id="8385740">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="keyword" id="8385743">func</span>&nbsp;<span class="op" id="8385748">(</span><span class="ident" id="8385749">codec</span>&nbsp;<span class="op" id="8385755">*</span><span class="ident" id="8385756">CodecEmulator</span><span class="op" id="8385769">)</span>&nbsp;<span class="ident" id="8385771">Call</span><span class="op" id="8385775">(</span><span class="ident" id="8385776">serviceMethod</span>&nbsp;<span class="builtintype" id="8385790">string</span><span class="op" id="8385796">,</span>&nbsp;<span class="ident" id="8385798">args</span>&nbsp;<span class="op" id="8385803">*</span><span class="ident" id="8385804">Args</span><span class="op" id="8385808">,</span>&nbsp;<span class="ident" id="8385810">reply</span>&nbsp;<span class="op" id="8385816">*</span><span class="ident" id="8385817">Reply</span><span class="op" id="8385822">)</span>&nbsp;<span class="builtintype" id="8385824">error</span>&nbsp;<span class="op" id="8385830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8385833">codec</span><span class="op" id="8385838">.</span><span class="ident" id="8385839">serviceMethod</span>&nbsp;<span class="op" id="8385853">=</span>&nbsp;<span class="ident" id="8385855">serviceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8385870">codec</span><span class="op" id="8385875">.</span><span class="ident" id="8385876">args</span>&nbsp;<span class="op" id="8385881">=</span>&nbsp;<span class="ident" id="8385883">args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8385889">codec</span><span class="op" id="8385894">.</span><span class="ident" id="8385895">reply</span>&nbsp;<span class="op" id="8385901">=</span>&nbsp;<span class="ident" id="8385903">reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8385910">codec</span><span class="op" id="8385915">.</span><span class="ident" id="8385916">err</span>&nbsp;<span class="op" id="8385920">=</span>&nbsp;<span class="ident" id="8385922">nil</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8385927">var</span>&nbsp;<span class="ident" id="8385931">serverError</span>&nbsp;<span class="builtintype" id="8385943">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8385950">if</span>&nbsp;<span class="ident" id="8385953">codec</span><span class="op" id="8385958">.</span><span class="ident" id="8385959">server</span>&nbsp;<span class="op" id="8385966">==</span>&nbsp;<span class="ident" id="8385969">nil</span>&nbsp;<span class="op" id="8385973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8385977">serverError</span>&nbsp;<span class="op" id="8385989">=</span>&nbsp;<span class="ident" id="8385991">ServeRequest</span><span class="op" id="8386003">(</span><span class="ident" id="8386004">codec</span><span class="op" id="8386009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8386012">}</span>&nbsp;<span class="keyword" id="8386014">else</span>&nbsp;<span class="op" id="8386019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8386023">serverError</span>&nbsp;<span class="op" id="8386035">=</span>&nbsp;<span class="ident" id="8386037">codec</span><span class="op" id="8386042">.</span><span class="ident" id="8386043">server</span><span class="op" id="8386049">.</span><span class="ident" id="8386050">ServeRequest</span><span class="op" id="8386062">(</span><span class="ident" id="8386063">codec</span><span class="op" id="8386068">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8386071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8386074">if</span>&nbsp;<span class="ident" id="8386077">codec</span><span class="op" id="8386082">.</span><span class="ident" id="8386083">err</span>&nbsp;<span class="op" id="8386087">==</span>&nbsp;<span class="ident" id="8386090">nil</span>&nbsp;<span class="op" id="8386094">&amp;&amp;</span>&nbsp;<span class="ident" id="8386097">serverError</span>&nbsp;<span class="op" id="8386109">!=</span>&nbsp;<span class="ident" id="8386112">nil</span>&nbsp;<span class="op" id="8386116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8386120">codec</span><span class="op" id="8386125">.</span><span class="ident" id="8386126">err</span>&nbsp;<span class="op" id="8386130">=</span>&nbsp;<span class="ident" id="8386132">serverError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8386145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8386148">return</span>&nbsp;<span class="ident" id="8386155">codec</span><span class="op" id="8386160">.</span><span class="ident" id="8386161">err</span><br>
<span class="lineno">330</span><span class="op" id="8386165">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8386168">func</span>&nbsp;<span class="op" id="8386173">(</span><span class="ident" id="8386174">codec</span>&nbsp;<span class="op" id="8386180">*</span><span class="ident" id="8386181">CodecEmulator</span><span class="op" id="8386194">)</span>&nbsp;<span class="ident" id="8386196">ReadRequestHeader</span><span class="op" id="8386213">(</span><span class="ident" id="8386214">req</span>&nbsp;<span class="op" id="8386218">*</span><span class="ident" id="8386219">Request</span><span class="op" id="8386226">)</span>&nbsp;<span class="builtintype" id="8386228">error</span>&nbsp;<span class="op" id="8386234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8386237">req</span><span class="op" id="8386240">.</span><span class="ident" id="8386241">ServiceMethod</span>&nbsp;<span class="op" id="8386255">=</span>&nbsp;<span class="ident" id="8386257">codec</span><span class="op" id="8386262">.</span><span class="ident" id="8386263">serviceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8386278">req</span><span class="op" id="8386281">.</span><span class="ident" id="8386282">Seq</span>&nbsp;<span class="op" id="8386286">=</span>&nbsp;<span class="num" id="8386288">0</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8386291">return</span>&nbsp;<span class="ident" id="8386298">nil</span><br>
<span class="lineno"></span><span class="op" id="8386302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8386305">func</span>&nbsp;<span class="op" id="8386310">(</span><span class="ident" id="8386311">codec</span>&nbsp;<span class="op" id="8386317">*</span><span class="ident" id="8386318">CodecEmulator</span><span class="op" id="8386331">)</span>&nbsp;<span class="ident" id="8386333">ReadRequestBody</span><span class="op" id="8386348">(</span><span class="ident" id="8386349">argv</span>&nbsp;<span class="keyword" id="8386354">interface</span><span class="op" id="8386363">{</span><span class="op" id="8386364">}</span><span class="op" id="8386365">)</span>&nbsp;<span class="builtintype" id="8386367">error</span>&nbsp;<span class="op" id="8386373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8386376">if</span>&nbsp;<span class="ident" id="8386379">codec</span><span class="op" id="8386384">.</span><span class="ident" id="8386385">args</span>&nbsp;<span class="op" id="8386390">==</span>&nbsp;<span class="ident" id="8386393">nil</span>&nbsp;<span class="op" id="8386397">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8386401">return</span>&nbsp;<span class="ident" id="8386408">io</span><span class="op" id="8386410">.</span><span class="ident" id="8386411">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8386429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8386432">*</span><span class="op" id="8386433">(</span><span class="ident" id="8386434">argv</span><span class="op" id="8386438">.</span><span class="op" id="8386439">(</span><span class="op" id="8386440">*</span><span class="ident" id="8386441">Args</span><span class="op" id="8386445">)</span><span class="op" id="8386446">)</span>&nbsp;<span class="op" id="8386448">=</span>&nbsp;<span class="op" id="8386450">*</span><span class="ident" id="8386451">codec</span><span class="op" id="8386456">.</span><span class="ident" id="8386457">args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8386463">return</span>&nbsp;<span class="ident" id="8386470">nil</span><br>
<span class="lineno"></span><span class="op" id="8386474">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="keyword" id="8386477">func</span>&nbsp;<span class="op" id="8386482">(</span><span class="ident" id="8386483">codec</span>&nbsp;<span class="op" id="8386489">*</span><span class="ident" id="8386490">CodecEmulator</span><span class="op" id="8386503">)</span>&nbsp;<span class="ident" id="8386505">WriteResponse</span><span class="op" id="8386518">(</span><span class="ident" id="8386519">resp</span>&nbsp;<span class="op" id="8386524">*</span><span class="ident" id="8386525">Response</span><span class="op" id="8386533">,</span>&nbsp;<span class="ident" id="8386535">reply</span>&nbsp;<span class="keyword" id="8386541">interface</span><span class="op" id="8386550">{</span><span class="op" id="8386551">}</span><span class="op" id="8386552">)</span>&nbsp;<span class="builtintype" id="8386554">error</span>&nbsp;<span class="op" id="8386560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8386563">if</span>&nbsp;<span class="ident" id="8386566">resp</span><span class="op" id="8386570">.</span><span class="ident" id="8386571">Error</span>&nbsp;<span class="op" id="8386577">!=</span>&nbsp;<span class="string" id="8386580">&#34;&#34;</span>&nbsp;<span class="op" id="8386583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8386587">codec</span><span class="op" id="8386592">.</span><span class="ident" id="8386593">err</span>&nbsp;<span class="op" id="8386597">=</span>&nbsp;<span class="ident" id="8386599">errors</span><span class="op" id="8386605">.</span><span class="ident" id="8386606">New</span><span class="op" id="8386609">(</span><span class="ident" id="8386610">resp</span><span class="op" id="8386614">.</span><span class="ident" id="8386615">Error</span><span class="op" id="8386620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8386623">}</span>&nbsp;<span class="keyword" id="8386625">else</span>&nbsp;<span class="op" id="8386630">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8386634">*</span><span class="ident" id="8386635">codec</span><span class="op" id="8386640">.</span><span class="ident" id="8386641">reply</span>&nbsp;<span class="op" id="8386647">=</span>&nbsp;<span class="op" id="8386649">*</span><span class="op" id="8386650">(</span><span class="ident" id="8386651">reply</span><span class="op" id="8386656">.</span><span class="op" id="8386657">(</span><span class="op" id="8386658">*</span><span class="ident" id="8386659">Reply</span><span class="op" id="8386664">)</span><span class="op" id="8386665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8386668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8386671">return</span>&nbsp;<span class="ident" id="8386678">nil</span><br>
<span class="lineno"></span><span class="op" id="8386682">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="keyword" id="8386685">func</span>&nbsp;<span class="op" id="8386690">(</span><span class="ident" id="8386691">codec</span>&nbsp;<span class="op" id="8386697">*</span><span class="ident" id="8386698">CodecEmulator</span><span class="op" id="8386711">)</span>&nbsp;<span class="ident" id="8386713">Close</span><span class="op" id="8386718">(</span><span class="op" id="8386719">)</span>&nbsp;<span class="builtintype" id="8386721">error</span>&nbsp;<span class="op" id="8386727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8386730">return</span>&nbsp;<span class="ident" id="8386737">nil</span><br>
<span class="lineno"></span><span class="op" id="8386741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8386744">func</span>&nbsp;<span class="ident" id="8386749">TestServeRequest</span><span class="op" id="8386765">(</span><span class="ident" id="8386766">t</span>&nbsp;<span class="op" id="8386768">*</span><span class="ident" id="8386769">testing</span><span class="op" id="8386776">.</span><span class="ident" id="8386777">T</span><span class="op" id="8386778">)</span>&nbsp;<span class="op" id="8386780">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8386783">once</span><span class="op" id="8386787">.</span><span class="ident" id="8386788">Do</span><span class="op" id="8386790">(</span><span class="ident" id="8386791">startServer</span><span class="op" id="8386802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8386805">testServeRequest</span><span class="op" id="8386821">(</span><span class="ident" id="8386822">t</span><span class="op" id="8386823">,</span>&nbsp;<span class="ident" id="8386825">nil</span><span class="op" id="8386828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8386831">newOnce</span><span class="op" id="8386838">.</span><span class="ident" id="8386839">Do</span><span class="op" id="8386841">(</span><span class="ident" id="8386842">startNewServer</span><span class="op" id="8386856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8386859">testServeRequest</span><span class="op" id="8386875">(</span><span class="ident" id="8386876">t</span><span class="op" id="8386877">,</span>&nbsp;<span class="ident" id="8386879">newServer</span><span class="op" id="8386888">)</span><br>
<span class="lineno"></span><span class="op" id="8386890">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="8386893">func</span>&nbsp;<span class="ident" id="8386898">testServeRequest</span><span class="op" id="8386914">(</span><span class="ident" id="8386915">t</span>&nbsp;<span class="op" id="8386917">*</span><span class="ident" id="8386918">testing</span><span class="op" id="8386925">.</span><span class="ident" id="8386926">T</span><span class="op" id="8386927">,</span>&nbsp;<span class="ident" id="8386929">server</span>&nbsp;<span class="op" id="8386936">*</span><span class="ident" id="8386937">Server</span><span class="op" id="8386943">)</span>&nbsp;<span class="op" id="8386945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8386948">client</span>&nbsp;<span class="op" id="8386955">:=</span>&nbsp;<span class="ident" id="8386958">CodecEmulator</span><span class="op" id="8386971">{</span><span class="ident" id="8386972">server</span><span class="op" id="8386978">:</span>&nbsp;<span class="ident" id="8386980">server</span><span class="op" id="8386986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8386989">defer</span>&nbsp;<span class="ident" id="8386995">client</span><span class="op" id="8387001">.</span><span class="ident" id="8387002">Close</span><span class="op" id="8387007">(</span><span class="op" id="8387008">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8387012">args</span>&nbsp;<span class="op" id="8387017">:=</span>&nbsp;<span class="op" id="8387020">&amp;</span><span class="ident" id="8387021">Args</span><span class="op" id="8387025">{</span><span class="num" id="8387026">7</span><span class="op" id="8387027">,</span>&nbsp;<span class="num" id="8387029">8</span><span class="op" id="8387030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8387033">reply</span>&nbsp;<span class="op" id="8387039">:=</span>&nbsp;<span class="builtinfunc" id="8387042">new</span><span class="op" id="8387045">(</span><span class="ident" id="8387046">Reply</span><span class="op" id="8387051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8387054">err</span>&nbsp;<span class="op" id="8387058">:=</span>&nbsp;<span class="ident" id="8387061">client</span><span class="op" id="8387067">.</span><span class="ident" id="8387068">Call</span><span class="op" id="8387072">(</span><span class="string" id="8387073">&#34;Arith.Add&#34;</span><span class="op" id="8387084">,</span>&nbsp;<span class="ident" id="8387086">args</span><span class="op" id="8387090">,</span>&nbsp;<span class="ident" id="8387092">reply</span><span class="op" id="8387097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8387100">if</span>&nbsp;<span class="ident" id="8387103">err</span>&nbsp;<span class="op" id="8387107">!=</span>&nbsp;<span class="ident" id="8387110">nil</span>&nbsp;<span class="op" id="8387114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8387118">t</span><span class="op" id="8387119">.</span><span class="ident" id="8387120">Errorf</span><span class="op" id="8387126">(</span><span class="string" id="8387127">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8387169">,</span>&nbsp;<span class="ident" id="8387171">err</span><span class="op" id="8387174">.</span><span class="ident" id="8387175">Error</span><span class="op" id="8387180">(</span><span class="op" id="8387181">)</span><span class="op" id="8387182">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8387185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8387188">if</span>&nbsp;<span class="ident" id="8387191">reply</span><span class="op" id="8387196">.</span><span class="ident" id="8387197">C</span>&nbsp;<span class="op" id="8387199">!=</span>&nbsp;<span class="ident" id="8387202">args</span><span class="op" id="8387206">.</span><span class="ident" id="8387207">A</span><span class="op" id="8387208">+</span><span class="ident" id="8387209">args</span><span class="op" id="8387213">.</span><span class="ident" id="8387214">B</span>&nbsp;<span class="op" id="8387216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8387220">t</span><span class="op" id="8387221">.</span><span class="ident" id="8387222">Errorf</span><span class="op" id="8387228">(</span><span class="string" id="8387229">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8387254">,</span>&nbsp;<span class="ident" id="8387256">reply</span><span class="op" id="8387261">.</span><span class="ident" id="8387262">C</span><span class="op" id="8387263">,</span>&nbsp;<span class="ident" id="8387265">args</span><span class="op" id="8387269">.</span><span class="ident" id="8387270">A</span><span class="op" id="8387271">+</span><span class="ident" id="8387272">args</span><span class="op" id="8387276">.</span><span class="ident" id="8387277">B</span><span class="op" id="8387278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8387281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8387285">err</span>&nbsp;<span class="op" id="8387289">=</span>&nbsp;<span class="ident" id="8387291">client</span><span class="op" id="8387297">.</span><span class="ident" id="8387298">Call</span><span class="op" id="8387302">(</span><span class="string" id="8387303">&#34;Arith.Add&#34;</span><span class="op" id="8387314">,</span>&nbsp;<span class="ident" id="8387316">nil</span><span class="op" id="8387319">,</span>&nbsp;<span class="ident" id="8387321">reply</span><span class="op" id="8387326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8387329">if</span>&nbsp;<span class="ident" id="8387332">err</span>&nbsp;<span class="op" id="8387336">==</span>&nbsp;<span class="ident" id="8387339">nil</span>&nbsp;<span class="op" id="8387343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8387347">t</span><span class="op" id="8387348">.</span><span class="ident" id="8387349">Errorf</span><span class="op" id="8387355">(</span><span class="string" id="8387356">&#34;expected&nbsp;error&nbsp;calling&nbsp;Arith.Add&nbsp;with&nbsp;nil&nbsp;arg&#34;</span><span class="op" id="8387403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8387406">}</span><br>
<span class="lineno"></span><span class="op" id="8387408">}</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span><span class="keyword" id="8387411">type</span>&nbsp;<span class="ident" id="8387416">ReplyNotPointer</span>&nbsp;<span class="builtintype" id="8387432">int</span><br>
<span class="lineno"></span><span class="keyword" id="8387436">type</span>&nbsp;<span class="ident" id="8387441">ArgNotPublic</span>&nbsp;<span class="builtintype" id="8387454">int</span><br>
<span class="lineno"></span><span class="keyword" id="8387458">type</span>&nbsp;<span class="ident" id="8387463">ReplyNotPublic</span>&nbsp;<span class="builtintype" id="8387478">int</span><br>
<span class="lineno"></span><span class="keyword" id="8387482">type</span>&nbsp;<span class="ident" id="8387487">NeedsPtrType</span>&nbsp;<span class="builtintype" id="8387500">int</span><br>
<span class="lineno">390</span><span class="keyword" id="8387504">type</span>&nbsp;<span class="ident" id="8387509">local</span>&nbsp;<span class="keyword" id="8387515">struct</span><span class="op" id="8387521">{</span><span class="op" id="8387522">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8387525">func</span>&nbsp;<span class="op" id="8387530">(</span><span class="ident" id="8387531">t</span>&nbsp;<span class="op" id="8387533">*</span><span class="ident" id="8387534">ReplyNotPointer</span><span class="op" id="8387549">)</span>&nbsp;<span class="ident" id="8387551">ReplyNotPointer</span><span class="op" id="8387566">(</span><span class="ident" id="8387567">args</span>&nbsp;<span class="op" id="8387572">*</span><span class="ident" id="8387573">Args</span><span class="op" id="8387577">,</span>&nbsp;<span class="ident" id="8387579">reply</span>&nbsp;<span class="ident" id="8387585">Reply</span><span class="op" id="8387590">)</span>&nbsp;<span class="builtintype" id="8387592">error</span>&nbsp;<span class="op" id="8387598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8387601">return</span>&nbsp;<span class="ident" id="8387608">nil</span><br>
<span class="lineno"></span><span class="op" id="8387612">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="keyword" id="8387615">func</span>&nbsp;<span class="op" id="8387620">(</span><span class="ident" id="8387621">t</span>&nbsp;<span class="op" id="8387623">*</span><span class="ident" id="8387624">ArgNotPublic</span><span class="op" id="8387636">)</span>&nbsp;<span class="ident" id="8387638">ArgNotPublic</span><span class="op" id="8387650">(</span><span class="ident" id="8387651">args</span>&nbsp;<span class="op" id="8387656">*</span><span class="ident" id="8387657">local</span><span class="op" id="8387662">,</span>&nbsp;<span class="ident" id="8387664">reply</span>&nbsp;<span class="op" id="8387670">*</span><span class="ident" id="8387671">Reply</span><span class="op" id="8387676">)</span>&nbsp;<span class="builtintype" id="8387678">error</span>&nbsp;<span class="op" id="8387684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8387687">return</span>&nbsp;<span class="ident" id="8387694">nil</span><br>
<span class="lineno"></span><span class="op" id="8387698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span><span class="keyword" id="8387701">func</span>&nbsp;<span class="op" id="8387706">(</span><span class="ident" id="8387707">t</span>&nbsp;<span class="op" id="8387709">*</span><span class="ident" id="8387710">ReplyNotPublic</span><span class="op" id="8387724">)</span>&nbsp;<span class="ident" id="8387726">ReplyNotPublic</span><span class="op" id="8387740">(</span><span class="ident" id="8387741">args</span>&nbsp;<span class="op" id="8387746">*</span><span class="ident" id="8387747">Args</span><span class="op" id="8387751">,</span>&nbsp;<span class="ident" id="8387753">reply</span>&nbsp;<span class="op" id="8387759">*</span><span class="ident" id="8387760">local</span><span class="op" id="8387765">)</span>&nbsp;<span class="builtintype" id="8387767">error</span>&nbsp;<span class="op" id="8387773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8387776">return</span>&nbsp;<span class="ident" id="8387783">nil</span><br>
<span class="lineno"></span><span class="op" id="8387787">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8387790">func</span>&nbsp;<span class="op" id="8387795">(</span><span class="ident" id="8387796">t</span>&nbsp;<span class="op" id="8387798">*</span><span class="ident" id="8387799">NeedsPtrType</span><span class="op" id="8387811">)</span>&nbsp;<span class="ident" id="8387813">NeedsPtrType</span><span class="op" id="8387825">(</span><span class="ident" id="8387826">args</span>&nbsp;<span class="op" id="8387831">*</span><span class="ident" id="8387832">Args</span><span class="op" id="8387836">,</span>&nbsp;<span class="ident" id="8387838">reply</span>&nbsp;<span class="op" id="8387844">*</span><span class="ident" id="8387845">Reply</span><span class="op" id="8387850">)</span>&nbsp;<span class="builtintype" id="8387852">error</span>&nbsp;<span class="op" id="8387858">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8387861">return</span>&nbsp;<span class="ident" id="8387868">nil</span><br>
<span class="lineno"></span><span class="op" id="8387872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8387875">//&nbsp;Check&nbsp;that&nbsp;registration&nbsp;handles&nbsp;lots&nbsp;of&nbsp;bad&nbsp;methods&nbsp;and&nbsp;a&nbsp;type&nbsp;with&nbsp;no&nbsp;suitable&nbsp;methods.</span><br>
<span class="lineno"></span><span class="keyword" id="8387967">func</span>&nbsp;<span class="ident" id="8387972">TestRegistrationError</span><span class="op" id="8387993">(</span><span class="ident" id="8387994">t</span>&nbsp;<span class="op" id="8387996">*</span><span class="ident" id="8387997">testing</span><span class="op" id="8388004">.</span><span class="ident" id="8388005">T</span><span class="op" id="8388006">)</span>&nbsp;<span class="op" id="8388008">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8388011">err</span>&nbsp;<span class="op" id="8388015">:=</span>&nbsp;<span class="ident" id="8388018">Register</span><span class="op" id="8388026">(</span><span class="builtinfunc" id="8388027">new</span><span class="op" id="8388030">(</span><span class="ident" id="8388031">ReplyNotPointer</span><span class="op" id="8388046">)</span><span class="op" id="8388047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8388050">if</span>&nbsp;<span class="ident" id="8388053">err</span>&nbsp;<span class="op" id="8388057">==</span>&nbsp;<span class="ident" id="8388060">nil</span>&nbsp;<span class="op" id="8388064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8388068">t</span><span class="op" id="8388069">.</span><span class="ident" id="8388070">Error</span><span class="op" id="8388075">(</span><span class="string" id="8388076">&#34;expected&nbsp;error&nbsp;registering&nbsp;ReplyNotPointer&#34;</span><span class="op" id="8388120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8388123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8388126">err</span>&nbsp;<span class="op" id="8388130">=</span>&nbsp;<span class="ident" id="8388132">Register</span><span class="op" id="8388140">(</span><span class="builtinfunc" id="8388141">new</span><span class="op" id="8388144">(</span><span class="ident" id="8388145">ArgNotPublic</span><span class="op" id="8388157">)</span><span class="op" id="8388158">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8388161">if</span>&nbsp;<span class="ident" id="8388164">err</span>&nbsp;<span class="op" id="8388168">==</span>&nbsp;<span class="ident" id="8388171">nil</span>&nbsp;<span class="op" id="8388175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8388179">t</span><span class="op" id="8388180">.</span><span class="ident" id="8388181">Error</span><span class="op" id="8388186">(</span><span class="string" id="8388187">&#34;expected&nbsp;error&nbsp;registering&nbsp;ArgNotPublic&#34;</span><span class="op" id="8388228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8388231">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8388234">err</span>&nbsp;<span class="op" id="8388238">=</span>&nbsp;<span class="ident" id="8388240">Register</span><span class="op" id="8388248">(</span><span class="builtinfunc" id="8388249">new</span><span class="op" id="8388252">(</span><span class="ident" id="8388253">ReplyNotPublic</span><span class="op" id="8388267">)</span><span class="op" id="8388268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8388271">if</span>&nbsp;<span class="ident" id="8388274">err</span>&nbsp;<span class="op" id="8388278">==</span>&nbsp;<span class="ident" id="8388281">nil</span>&nbsp;<span class="op" id="8388285">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8388289">t</span><span class="op" id="8388290">.</span><span class="ident" id="8388291">Error</span><span class="op" id="8388296">(</span><span class="string" id="8388297">&#34;expected&nbsp;error&nbsp;registering&nbsp;ReplyNotPublic&#34;</span><span class="op" id="8388340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8388343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8388346">err</span>&nbsp;<span class="op" id="8388350">=</span>&nbsp;<span class="ident" id="8388352">Register</span><span class="op" id="8388360">(</span><span class="ident" id="8388361">NeedsPtrType</span><span class="op" id="8388373">(</span><span class="num" id="8388374">0</span><span class="op" id="8388375">)</span><span class="op" id="8388376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8388379">if</span>&nbsp;<span class="ident" id="8388382">err</span>&nbsp;<span class="op" id="8388386">==</span>&nbsp;<span class="ident" id="8388389">nil</span>&nbsp;<span class="op" id="8388393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8388397">t</span><span class="op" id="8388398">.</span><span class="ident" id="8388399">Error</span><span class="op" id="8388404">(</span><span class="string" id="8388405">&#34;expected&nbsp;error&nbsp;registering&nbsp;NeedsPtrType&#34;</span><span class="op" id="8388446">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8388449">}</span>&nbsp;<span class="keyword" id="8388451">else</span>&nbsp;<span class="keyword" id="8388456">if</span>&nbsp;<span class="op" id="8388459">!</span><span class="ident" id="8388460">strings</span><span class="op" id="8388467">.</span><span class="ident" id="8388468">Contains</span><span class="op" id="8388476">(</span><span class="ident" id="8388477">err</span><span class="op" id="8388480">.</span><span class="ident" id="8388481">Error</span><span class="op" id="8388486">(</span><span class="op" id="8388487">)</span><span class="op" id="8388488">,</span>&nbsp;<span class="string" id="8388490">&#34;pointer&#34;</span><span class="op" id="8388499">)</span>&nbsp;<span class="op" id="8388501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8388505">t</span><span class="op" id="8388506">.</span><span class="ident" id="8388507">Error</span><span class="op" id="8388512">(</span><span class="string" id="8388513">&#34;expected&nbsp;hint&nbsp;when&nbsp;registering&nbsp;NeedsPtrType&#34;</span><span class="op" id="8388558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8388561">}</span><br>
<span class="lineno"></span><span class="op" id="8388563">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="keyword" id="8388566">type</span>&nbsp;<span class="ident" id="8388571">WriteFailCodec</span>&nbsp;<span class="builtintype" id="8388586">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8388591">func</span>&nbsp;<span class="op" id="8388596">(</span><span class="ident" id="8388597">WriteFailCodec</span><span class="op" id="8388611">)</span>&nbsp;<span class="ident" id="8388613">WriteRequest</span><span class="op" id="8388625">(</span><span class="op" id="8388626">*</span><span class="ident" id="8388627">Request</span><span class="op" id="8388634">,</span>&nbsp;<span class="keyword" id="8388636">interface</span><span class="op" id="8388645">{</span><span class="op" id="8388646">}</span><span class="op" id="8388647">)</span>&nbsp;<span class="builtintype" id="8388649">error</span>&nbsp;<span class="op" id="8388655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8388658">//&nbsp;the&nbsp;panic&nbsp;caused&nbsp;by&nbsp;this&nbsp;error&nbsp;used&nbsp;to&nbsp;not&nbsp;unlock&nbsp;a&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8388720">return</span>&nbsp;<span class="ident" id="8388727">errors</span><span class="op" id="8388733">.</span><span class="ident" id="8388734">New</span><span class="op" id="8388737">(</span><span class="string" id="8388738">&#34;fail&#34;</span><span class="op" id="8388744">)</span><br>
<span class="lineno">435</span><span class="op" id="8388746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8388749">func</span>&nbsp;<span class="op" id="8388754">(</span><span class="ident" id="8388755">WriteFailCodec</span><span class="op" id="8388769">)</span>&nbsp;<span class="ident" id="8388771">ReadResponseHeader</span><span class="op" id="8388789">(</span><span class="op" id="8388790">*</span><span class="ident" id="8388791">Response</span><span class="op" id="8388799">)</span>&nbsp;<span class="builtintype" id="8388801">error</span>&nbsp;<span class="op" id="8388807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8388810">select</span>&nbsp;<span class="op" id="8388817">{</span><span class="op" id="8388818">}</span><br>
<span class="lineno"></span><span class="op" id="8388820">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span><span class="keyword" id="8388823">func</span>&nbsp;<span class="op" id="8388828">(</span><span class="ident" id="8388829">WriteFailCodec</span><span class="op" id="8388843">)</span>&nbsp;<span class="ident" id="8388845">ReadResponseBody</span><span class="op" id="8388861">(</span><span class="keyword" id="8388862">interface</span><span class="op" id="8388871">{</span><span class="op" id="8388872">}</span><span class="op" id="8388873">)</span>&nbsp;<span class="builtintype" id="8388875">error</span>&nbsp;<span class="op" id="8388881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8388884">select</span>&nbsp;<span class="op" id="8388891">{</span><span class="op" id="8388892">}</span><br>
<span class="lineno"></span><span class="op" id="8388894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">445</span><span class="keyword" id="8388897">func</span>&nbsp;<span class="op" id="8388902">(</span><span class="ident" id="8388903">WriteFailCodec</span><span class="op" id="8388917">)</span>&nbsp;<span class="ident" id="8388919">Close</span><span class="op" id="8388924">(</span><span class="op" id="8388925">)</span>&nbsp;<span class="builtintype" id="8388927">error</span>&nbsp;<span class="op" id="8388933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8388936">return</span>&nbsp;<span class="ident" id="8388943">nil</span><br>
<span class="lineno"></span><span class="op" id="8388947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8388950">func</span>&nbsp;<span class="ident" id="8388955">TestSendDeadlock</span><span class="op" id="8388971">(</span><span class="ident" id="8388972">t</span>&nbsp;<span class="op" id="8388974">*</span><span class="ident" id="8388975">testing</span><span class="op" id="8388982">.</span><span class="ident" id="8388983">T</span><span class="op" id="8388984">)</span>&nbsp;<span class="op" id="8388986">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8388989">client</span>&nbsp;<span class="op" id="8388996">:=</span>&nbsp;<span class="ident" id="8388999">NewClientWithCodec</span><span class="op" id="8389017">(</span><span class="ident" id="8389018">WriteFailCodec</span><span class="op" id="8389032">(</span><span class="num" id="8389033">0</span><span class="op" id="8389034">)</span><span class="op" id="8389035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8389038">defer</span>&nbsp;<span class="ident" id="8389044">client</span><span class="op" id="8389050">.</span><span class="ident" id="8389051">Close</span><span class="op" id="8389056">(</span><span class="op" id="8389057">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8389061">done</span>&nbsp;<span class="op" id="8389066">:=</span>&nbsp;<span class="builtinfunc" id="8389069">make</span><span class="op" id="8389073">(</span><span class="keyword" id="8389074">chan</span>&nbsp;<span class="builtintype" id="8389079">bool</span><span class="op" id="8389083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8389086">go</span>&nbsp;<span class="keyword" id="8389089">func</span><span class="op" id="8389093">(</span><span class="op" id="8389094">)</span>&nbsp;<span class="op" id="8389096">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8389100">testSendDeadlock</span><span class="op" id="8389116">(</span><span class="ident" id="8389117">client</span><span class="op" id="8389123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8389127">testSendDeadlock</span><span class="op" id="8389143">(</span><span class="ident" id="8389144">client</span><span class="op" id="8389150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8389154">done</span>&nbsp;<span class="op" id="8389159">&lt;-</span>&nbsp;<span class="builtintype" id="8389162">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8389168">}</span><span class="op" id="8389169">(</span><span class="op" id="8389170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8389173">select</span>&nbsp;<span class="op" id="8389180">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8389183">case</span>&nbsp;<span class="op" id="8389188">&lt;-</span><span class="ident" id="8389190">done</span><span class="op" id="8389194">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8389198">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8389206">case</span>&nbsp;<span class="op" id="8389211">&lt;-</span><span class="ident" id="8389213">time</span><span class="op" id="8389217">.</span><span class="ident" id="8389218">After</span><span class="op" id="8389223">(</span><span class="num" id="8389224">5</span>&nbsp;<span class="op" id="8389226">*</span>&nbsp;<span class="ident" id="8389228">time</span><span class="op" id="8389232">.</span><span class="ident" id="8389233">Second</span><span class="op" id="8389239">)</span><span class="op" id="8389240">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8389244">t</span><span class="op" id="8389245">.</span><span class="ident" id="8389246">Fatal</span><span class="op" id="8389251">(</span><span class="string" id="8389252">&#34;deadlock&#34;</span><span class="op" id="8389262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8389265">}</span><br>
<span class="lineno">465</span><span class="op" id="8389267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8389270">func</span>&nbsp;<span class="ident" id="8389275">testSendDeadlock</span><span class="op" id="8389291">(</span><span class="ident" id="8389292">client</span>&nbsp;<span class="op" id="8389299">*</span><span class="ident" id="8389300">Client</span><span class="op" id="8389306">)</span>&nbsp;<span class="op" id="8389308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8389311">defer</span>&nbsp;<span class="keyword" id="8389317">func</span><span class="op" id="8389321">(</span><span class="op" id="8389322">)</span>&nbsp;<span class="op" id="8389324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8389328">recover</span><span class="op" id="8389335">(</span><span class="op" id="8389336">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8389339">}</span><span class="op" id="8389340">(</span><span class="op" id="8389341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8389344">args</span>&nbsp;<span class="op" id="8389349">:=</span>&nbsp;<span class="op" id="8389352">&amp;</span><span class="ident" id="8389353">Args</span><span class="op" id="8389357">{</span><span class="num" id="8389358">7</span><span class="op" id="8389359">,</span>&nbsp;<span class="num" id="8389361">8</span><span class="op" id="8389362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8389365">reply</span>&nbsp;<span class="op" id="8389371">:=</span>&nbsp;<span class="builtinfunc" id="8389374">new</span><span class="op" id="8389377">(</span><span class="ident" id="8389378">Reply</span><span class="op" id="8389383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8389386">client</span><span class="op" id="8389392">.</span><span class="ident" id="8389393">Call</span><span class="op" id="8389397">(</span><span class="string" id="8389398">&#34;Arith.Add&#34;</span><span class="op" id="8389409">,</span>&nbsp;<span class="ident" id="8389411">args</span><span class="op" id="8389415">,</span>&nbsp;<span class="ident" id="8389417">reply</span><span class="op" id="8389422">)</span><br>
<span class="lineno"></span><span class="op" id="8389424">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="keyword" id="8389427">func</span>&nbsp;<span class="ident" id="8389432">dialDirect</span><span class="op" id="8389442">(</span><span class="op" id="8389443">)</span>&nbsp;<span class="op" id="8389445">(</span><span class="op" id="8389446">*</span><span class="ident" id="8389447">Client</span><span class="op" id="8389453">,</span>&nbsp;<span class="builtintype" id="8389455">error</span><span class="op" id="8389460">)</span>&nbsp;<span class="op" id="8389462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8389465">return</span>&nbsp;<span class="ident" id="8389472">Dial</span><span class="op" id="8389476">(</span><span class="string" id="8389477">&#34;tcp&#34;</span><span class="op" id="8389482">,</span>&nbsp;<span class="ident" id="8389484">serverAddr</span><span class="op" id="8389494">)</span><br>
<span class="lineno"></span><span class="op" id="8389496">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span><span class="keyword" id="8389499">func</span>&nbsp;<span class="ident" id="8389504">dialHTTP</span><span class="op" id="8389512">(</span><span class="op" id="8389513">)</span>&nbsp;<span class="op" id="8389515">(</span><span class="op" id="8389516">*</span><span class="ident" id="8389517">Client</span><span class="op" id="8389523">,</span>&nbsp;<span class="builtintype" id="8389525">error</span><span class="op" id="8389530">)</span>&nbsp;<span class="op" id="8389532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8389535">return</span>&nbsp;<span class="ident" id="8389542">DialHTTP</span><span class="op" id="8389550">(</span><span class="string" id="8389551">&#34;tcp&#34;</span><span class="op" id="8389556">,</span>&nbsp;<span class="ident" id="8389558">httpServerAddr</span><span class="op" id="8389572">)</span><br>
<span class="lineno"></span><span class="op" id="8389574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8389577">func</span>&nbsp;<span class="ident" id="8389582">countMallocs</span><span class="op" id="8389594">(</span><span class="ident" id="8389595">dial</span>&nbsp;<span class="keyword" id="8389600">func</span><span class="op" id="8389604">(</span><span class="op" id="8389605">)</span>&nbsp;<span class="op" id="8389607">(</span><span class="op" id="8389608">*</span><span class="ident" id="8389609">Client</span><span class="op" id="8389615">,</span>&nbsp;<span class="builtintype" id="8389617">error</span><span class="op" id="8389622">)</span><span class="op" id="8389623">,</span>&nbsp;<span class="ident" id="8389625">t</span>&nbsp;<span class="op" id="8389627">*</span><span class="ident" id="8389628">testing</span><span class="op" id="8389635">.</span><span class="ident" id="8389636">T</span><span class="op" id="8389637">)</span>&nbsp;<span class="builtintype" id="8389639">float64</span>&nbsp;<span class="op" id="8389647">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8389650">once</span><span class="op" id="8389654">.</span><span class="ident" id="8389655">Do</span><span class="op" id="8389657">(</span><span class="ident" id="8389658">startServer</span><span class="op" id="8389669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8389672">client</span><span class="op" id="8389678">,</span>&nbsp;<span class="ident" id="8389680">err</span>&nbsp;<span class="op" id="8389684">:=</span>&nbsp;<span class="ident" id="8389687">dial</span><span class="op" id="8389691">(</span><span class="op" id="8389692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8389695">if</span>&nbsp;<span class="ident" id="8389698">err</span>&nbsp;<span class="op" id="8389702">!=</span>&nbsp;<span class="ident" id="8389705">nil</span>&nbsp;<span class="op" id="8389709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8389713">t</span><span class="op" id="8389714">.</span><span class="ident" id="8389715">Fatal</span><span class="op" id="8389720">(</span><span class="string" id="8389721">&#34;error&nbsp;dialing&#34;</span><span class="op" id="8389736">,</span>&nbsp;<span class="ident" id="8389738">err</span><span class="op" id="8389741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8389744">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8389747">defer</span>&nbsp;<span class="ident" id="8389753">client</span><span class="op" id="8389759">.</span><span class="ident" id="8389760">Close</span><span class="op" id="8389765">(</span><span class="op" id="8389766">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8389770">args</span>&nbsp;<span class="op" id="8389775">:=</span>&nbsp;<span class="op" id="8389778">&amp;</span><span class="ident" id="8389779">Args</span><span class="op" id="8389783">{</span><span class="num" id="8389784">7</span><span class="op" id="8389785">,</span>&nbsp;<span class="num" id="8389787">8</span><span class="op" id="8389788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8389791">reply</span>&nbsp;<span class="op" id="8389797">:=</span>&nbsp;<span class="builtinfunc" id="8389800">new</span><span class="op" id="8389803">(</span><span class="ident" id="8389804">Reply</span><span class="op" id="8389809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8389812">return</span>&nbsp;<span class="ident" id="8389819">testing</span><span class="op" id="8389826">.</span><span class="ident" id="8389827">AllocsPerRun</span><span class="op" id="8389839">(</span><span class="num" id="8389840">100</span><span class="op" id="8389843">,</span>&nbsp;<span class="keyword" id="8389845">func</span><span class="op" id="8389849">(</span><span class="op" id="8389850">)</span>&nbsp;<span class="op" id="8389852">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8389856">err</span>&nbsp;<span class="op" id="8389860">:=</span>&nbsp;<span class="ident" id="8389863">client</span><span class="op" id="8389869">.</span><span class="ident" id="8389870">Call</span><span class="op" id="8389874">(</span><span class="string" id="8389875">&#34;Arith.Add&#34;</span><span class="op" id="8389886">,</span>&nbsp;<span class="ident" id="8389888">args</span><span class="op" id="8389892">,</span>&nbsp;<span class="ident" id="8389894">reply</span><span class="op" id="8389899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8389903">if</span>&nbsp;<span class="ident" id="8389906">err</span>&nbsp;<span class="op" id="8389910">!=</span>&nbsp;<span class="ident" id="8389913">nil</span>&nbsp;<span class="op" id="8389917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8389922">t</span><span class="op" id="8389923">.</span><span class="ident" id="8389924">Errorf</span><span class="op" id="8389930">(</span><span class="string" id="8389931">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8389973">,</span>&nbsp;<span class="ident" id="8389975">err</span><span class="op" id="8389978">.</span><span class="ident" id="8389979">Error</span><span class="op" id="8389984">(</span><span class="op" id="8389985">)</span><span class="op" id="8389986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8389990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8389994">if</span>&nbsp;<span class="ident" id="8389997">reply</span><span class="op" id="8390002">.</span><span class="ident" id="8390003">C</span>&nbsp;<span class="op" id="8390005">!=</span>&nbsp;<span class="ident" id="8390008">args</span><span class="op" id="8390012">.</span><span class="ident" id="8390013">A</span><span class="op" id="8390014">+</span><span class="ident" id="8390015">args</span><span class="op" id="8390019">.</span><span class="ident" id="8390020">B</span>&nbsp;<span class="op" id="8390022">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8390027">t</span><span class="op" id="8390028">.</span><span class="ident" id="8390029">Errorf</span><span class="op" id="8390035">(</span><span class="string" id="8390036">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8390061">,</span>&nbsp;<span class="ident" id="8390063">reply</span><span class="op" id="8390068">.</span><span class="ident" id="8390069">C</span><span class="op" id="8390070">,</span>&nbsp;<span class="ident" id="8390072">args</span><span class="op" id="8390076">.</span><span class="ident" id="8390077">A</span><span class="op" id="8390078">+</span><span class="ident" id="8390079">args</span><span class="op" id="8390083">.</span><span class="ident" id="8390084">B</span><span class="op" id="8390085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8390089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8390092">}</span><span class="op" id="8390093">)</span><br>
<span class="lineno"></span><span class="op" id="8390095">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span><span class="keyword" id="8390098">func</span>&nbsp;<span class="ident" id="8390103">TestCountMallocs</span><span class="op" id="8390119">(</span><span class="ident" id="8390120">t</span>&nbsp;<span class="op" id="8390122">*</span><span class="ident" id="8390123">testing</span><span class="op" id="8390130">.</span><span class="ident" id="8390131">T</span><span class="op" id="8390132">)</span>&nbsp;<span class="op" id="8390134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8390137">if</span>&nbsp;<span class="ident" id="8390140">testing</span><span class="op" id="8390147">.</span><span class="ident" id="8390148">Short</span><span class="op" id="8390153">(</span><span class="op" id="8390154">)</span>&nbsp;<span class="op" id="8390156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8390160">t</span><span class="op" id="8390161">.</span><span class="ident" id="8390162">Skip</span><span class="op" id="8390166">(</span><span class="string" id="8390167">&#34;skipping&nbsp;malloc&nbsp;count&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="8390204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8390207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8390210">if</span>&nbsp;<span class="ident" id="8390213">runtime</span><span class="op" id="8390220">.</span><span class="ident" id="8390221">GOMAXPROCS</span><span class="op" id="8390231">(</span><span class="num" id="8390232">0</span><span class="op" id="8390233">)</span>&nbsp;<span class="op" id="8390235">&gt;</span>&nbsp;<span class="num" id="8390237">1</span>&nbsp;<span class="op" id="8390239">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8390243">t</span><span class="op" id="8390244">.</span><span class="ident" id="8390245">Skip</span><span class="op" id="8390249">(</span><span class="string" id="8390250">&#34;skipping;&nbsp;GOMAXPROCS&gt;1&#34;</span><span class="op" id="8390274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8390277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8390280">fmt</span><span class="op" id="8390283">.</span><span class="ident" id="8390284">Printf</span><span class="op" id="8390290">(</span><span class="string" id="8390291">&#34;mallocs&nbsp;per&nbsp;rpc&nbsp;round&nbsp;trip:&nbsp;%v\n&#34;</span><span class="op" id="8390325">,</span>&nbsp;<span class="ident" id="8390327">countMallocs</span><span class="op" id="8390339">(</span><span class="ident" id="8390340">dialDirect</span><span class="op" id="8390350">,</span>&nbsp;<span class="ident" id="8390352">t</span><span class="op" id="8390353">)</span><span class="op" id="8390354">)</span><br>
<span class="lineno"></span><span class="op" id="8390356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="keyword" id="8390359">func</span>&nbsp;<span class="ident" id="8390364">TestCountMallocsOverHTTP</span><span class="op" id="8390388">(</span><span class="ident" id="8390389">t</span>&nbsp;<span class="op" id="8390391">*</span><span class="ident" id="8390392">testing</span><span class="op" id="8390399">.</span><span class="ident" id="8390400">T</span><span class="op" id="8390401">)</span>&nbsp;<span class="op" id="8390403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8390406">if</span>&nbsp;<span class="ident" id="8390409">testing</span><span class="op" id="8390416">.</span><span class="ident" id="8390417">Short</span><span class="op" id="8390422">(</span><span class="op" id="8390423">)</span>&nbsp;<span class="op" id="8390425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8390429">t</span><span class="op" id="8390430">.</span><span class="ident" id="8390431">Skip</span><span class="op" id="8390435">(</span><span class="string" id="8390436">&#34;skipping&nbsp;malloc&nbsp;count&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="8390473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8390476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8390479">if</span>&nbsp;<span class="ident" id="8390482">runtime</span><span class="op" id="8390489">.</span><span class="ident" id="8390490">GOMAXPROCS</span><span class="op" id="8390500">(</span><span class="num" id="8390501">0</span><span class="op" id="8390502">)</span>&nbsp;<span class="op" id="8390504">&gt;</span>&nbsp;<span class="num" id="8390506">1</span>&nbsp;<span class="op" id="8390508">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8390512">t</span><span class="op" id="8390513">.</span><span class="ident" id="8390514">Skip</span><span class="op" id="8390518">(</span><span class="string" id="8390519">&#34;skipping;&nbsp;GOMAXPROCS&gt;1&#34;</span><span class="op" id="8390543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8390546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8390549">fmt</span><span class="op" id="8390552">.</span><span class="ident" id="8390553">Printf</span><span class="op" id="8390559">(</span><span class="string" id="8390560">&#34;mallocs&nbsp;per&nbsp;HTTP&nbsp;rpc&nbsp;round&nbsp;trip:&nbsp;%v\n&#34;</span><span class="op" id="8390599">,</span>&nbsp;<span class="ident" id="8390601">countMallocs</span><span class="op" id="8390613">(</span><span class="ident" id="8390614">dialHTTP</span><span class="op" id="8390622">,</span>&nbsp;<span class="ident" id="8390624">t</span><span class="op" id="8390625">)</span><span class="op" id="8390626">)</span><br>
<span class="lineno"></span><span class="op" id="8390628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span><span class="keyword" id="8390631">type</span>&nbsp;<span class="ident" id="8390636">writeCrasher</span>&nbsp;<span class="keyword" id="8390649">struct</span>&nbsp;<span class="op" id="8390656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8390659">done</span>&nbsp;<span class="keyword" id="8390664">chan</span>&nbsp;<span class="builtintype" id="8390669">bool</span><br>
<span class="lineno"></span><span class="op" id="8390674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8390677">func</span>&nbsp;<span class="op" id="8390682">(</span><span class="ident" id="8390683">writeCrasher</span><span class="op" id="8390695">)</span>&nbsp;<span class="ident" id="8390697">Close</span><span class="op" id="8390702">(</span><span class="op" id="8390703">)</span>&nbsp;<span class="builtintype" id="8390705">error</span>&nbsp;<span class="op" id="8390711">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8390714">return</span>&nbsp;<span class="ident" id="8390721">nil</span><br>
<span class="lineno"></span><span class="op" id="8390725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8390728">func</span>&nbsp;<span class="op" id="8390733">(</span><span class="ident" id="8390734">w</span>&nbsp;<span class="op" id="8390736">*</span><span class="ident" id="8390737">writeCrasher</span><span class="op" id="8390749">)</span>&nbsp;<span class="ident" id="8390751">Read</span><span class="op" id="8390755">(</span><span class="ident" id="8390756">p</span>&nbsp;<span class="op" id="8390758">[</span><span class="op" id="8390759">]</span><span class="builtintype" id="8390760">byte</span><span class="op" id="8390764">)</span>&nbsp;<span class="op" id="8390766">(</span><span class="builtintype" id="8390767">int</span><span class="op" id="8390770">,</span>&nbsp;<span class="builtintype" id="8390772">error</span><span class="op" id="8390777">)</span>&nbsp;<span class="op" id="8390779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8390782">&lt;-</span><span class="ident" id="8390784">w</span><span class="op" id="8390785">.</span><span class="ident" id="8390786">done</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8390792">return</span>&nbsp;<span class="num" id="8390799">0</span><span class="op" id="8390800">,</span>&nbsp;<span class="ident" id="8390802">io</span><span class="op" id="8390804">.</span><span class="ident" id="8390805">EOF</span><br>
<span class="lineno"></span><span class="op" id="8390809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8390812">func</span>&nbsp;<span class="op" id="8390817">(</span><span class="ident" id="8390818">writeCrasher</span><span class="op" id="8390830">)</span>&nbsp;<span class="ident" id="8390832">Write</span><span class="op" id="8390837">(</span><span class="ident" id="8390838">p</span>&nbsp;<span class="op" id="8390840">[</span><span class="op" id="8390841">]</span><span class="builtintype" id="8390842">byte</span><span class="op" id="8390846">)</span>&nbsp;<span class="op" id="8390848">(</span><span class="builtintype" id="8390849">int</span><span class="op" id="8390852">,</span>&nbsp;<span class="builtintype" id="8390854">error</span><span class="op" id="8390859">)</span>&nbsp;<span class="op" id="8390861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8390864">return</span>&nbsp;<span class="num" id="8390871">0</span><span class="op" id="8390872">,</span>&nbsp;<span class="ident" id="8390874">errors</span><span class="op" id="8390880">.</span><span class="ident" id="8390881">New</span><span class="op" id="8390884">(</span><span class="string" id="8390885">&#34;fake&nbsp;write&nbsp;failure&#34;</span><span class="op" id="8390905">)</span><br>
<span class="lineno">540</span><span class="op" id="8390907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8390910">func</span>&nbsp;<span class="ident" id="8390915">TestClientWriteError</span><span class="op" id="8390935">(</span><span class="ident" id="8390936">t</span>&nbsp;<span class="op" id="8390938">*</span><span class="ident" id="8390939">testing</span><span class="op" id="8390946">.</span><span class="ident" id="8390947">T</span><span class="op" id="8390948">)</span>&nbsp;<span class="op" id="8390950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8390953">w</span>&nbsp;<span class="op" id="8390955">:=</span>&nbsp;<span class="op" id="8390958">&amp;</span><span class="ident" id="8390959">writeCrasher</span><span class="op" id="8390971">{</span><span class="ident" id="8390972">done</span><span class="op" id="8390976">:</span>&nbsp;<span class="builtinfunc" id="8390978">make</span><span class="op" id="8390982">(</span><span class="keyword" id="8390983">chan</span>&nbsp;<span class="builtintype" id="8390988">bool</span><span class="op" id="8390992">)</span><span class="op" id="8390993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8390996">c</span>&nbsp;<span class="op" id="8390998">:=</span>&nbsp;<span class="ident" id="8391001">NewClient</span><span class="op" id="8391010">(</span><span class="ident" id="8391011">w</span><span class="op" id="8391012">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8391015">defer</span>&nbsp;<span class="ident" id="8391021">c</span><span class="op" id="8391022">.</span><span class="ident" id="8391023">Close</span><span class="op" id="8391028">(</span><span class="op" id="8391029">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8391033">res</span>&nbsp;<span class="op" id="8391037">:=</span>&nbsp;<span class="builtintype" id="8391040">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8391047">err</span>&nbsp;<span class="op" id="8391051">:=</span>&nbsp;<span class="ident" id="8391054">c</span><span class="op" id="8391055">.</span><span class="ident" id="8391056">Call</span><span class="op" id="8391060">(</span><span class="string" id="8391061">&#34;foo&#34;</span><span class="op" id="8391066">,</span>&nbsp;<span class="num" id="8391068">1</span><span class="op" id="8391069">,</span>&nbsp;<span class="op" id="8391071">&amp;</span><span class="ident" id="8391072">res</span><span class="op" id="8391075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8391078">if</span>&nbsp;<span class="ident" id="8391081">err</span>&nbsp;<span class="op" id="8391085">==</span>&nbsp;<span class="ident" id="8391088">nil</span>&nbsp;<span class="op" id="8391092">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8391096">t</span><span class="op" id="8391097">.</span><span class="ident" id="8391098">Fatal</span><span class="op" id="8391103">(</span><span class="string" id="8391104">&#34;expected&nbsp;error&#34;</span><span class="op" id="8391120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8391123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8391126">if</span>&nbsp;<span class="ident" id="8391129">err</span><span class="op" id="8391132">.</span><span class="ident" id="8391133">Error</span><span class="op" id="8391138">(</span><span class="op" id="8391139">)</span>&nbsp;<span class="op" id="8391141">!=</span>&nbsp;<span class="string" id="8391144">&#34;fake&nbsp;write&nbsp;failure&#34;</span>&nbsp;<span class="op" id="8391165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8391169">t</span><span class="op" id="8391170">.</span><span class="ident" id="8391171">Error</span><span class="op" id="8391176">(</span><span class="string" id="8391177">&#34;unexpected&nbsp;value&nbsp;of&nbsp;error:&#34;</span><span class="op" id="8391205">,</span>&nbsp;<span class="ident" id="8391207">err</span><span class="op" id="8391210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8391213">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8391216">w</span><span class="op" id="8391217">.</span><span class="ident" id="8391218">done</span>&nbsp;<span class="op" id="8391223">&lt;-</span>&nbsp;<span class="builtintype" id="8391226">true</span><br>
<span class="lineno"></span><span class="op" id="8391231">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8391234">func</span>&nbsp;<span class="ident" id="8391239">TestTCPClose</span><span class="op" id="8391251">(</span><span class="ident" id="8391252">t</span>&nbsp;<span class="op" id="8391254">*</span><span class="ident" id="8391255">testing</span><span class="op" id="8391262">.</span><span class="ident" id="8391263">T</span><span class="op" id="8391264">)</span>&nbsp;<span class="op" id="8391266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8391269">once</span><span class="op" id="8391273">.</span><span class="ident" id="8391274">Do</span><span class="op" id="8391276">(</span><span class="ident" id="8391277">startServer</span><span class="op" id="8391288">)</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8391292">client</span><span class="op" id="8391298">,</span>&nbsp;<span class="ident" id="8391300">err</span>&nbsp;<span class="op" id="8391304">:=</span>&nbsp;<span class="ident" id="8391307">dialHTTP</span><span class="op" id="8391315">(</span><span class="op" id="8391316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8391319">if</span>&nbsp;<span class="ident" id="8391322">err</span>&nbsp;<span class="op" id="8391326">!=</span>&nbsp;<span class="ident" id="8391329">nil</span>&nbsp;<span class="op" id="8391333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8391337">t</span><span class="op" id="8391338">.</span><span class="ident" id="8391339">Fatalf</span><span class="op" id="8391345">(</span><span class="string" id="8391346">&#34;dialing:&nbsp;%v&#34;</span><span class="op" id="8391359">,</span>&nbsp;<span class="ident" id="8391361">err</span><span class="op" id="8391364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8391367">}</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8391370">defer</span>&nbsp;<span class="ident" id="8391376">client</span><span class="op" id="8391382">.</span><span class="ident" id="8391383">Close</span><span class="op" id="8391388">(</span><span class="op" id="8391389">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8391393">args</span>&nbsp;<span class="op" id="8391398">:=</span>&nbsp;<span class="ident" id="8391401">Args</span><span class="op" id="8391405">{</span><span class="num" id="8391406">17</span><span class="op" id="8391408">,</span>&nbsp;<span class="num" id="8391410">8</span><span class="op" id="8391411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8391414">var</span>&nbsp;<span class="ident" id="8391418">reply</span>&nbsp;<span class="ident" id="8391424">Reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8391431">err</span>&nbsp;<span class="op" id="8391435">=</span>&nbsp;<span class="ident" id="8391437">client</span><span class="op" id="8391443">.</span><span class="ident" id="8391444">Call</span><span class="op" id="8391448">(</span><span class="string" id="8391449">&#34;Arith.Mul&#34;</span><span class="op" id="8391460">,</span>&nbsp;<span class="ident" id="8391462">args</span><span class="op" id="8391466">,</span>&nbsp;<span class="op" id="8391468">&amp;</span><span class="ident" id="8391469">reply</span><span class="op" id="8391474">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8391477">if</span>&nbsp;<span class="ident" id="8391480">err</span>&nbsp;<span class="op" id="8391484">!=</span>&nbsp;<span class="ident" id="8391487">nil</span>&nbsp;<span class="op" id="8391491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8391495">t</span><span class="op" id="8391496">.</span><span class="ident" id="8391497">Fatal</span><span class="op" id="8391502">(</span><span class="string" id="8391503">&#34;arith&nbsp;error:&#34;</span><span class="op" id="8391517">,</span>&nbsp;<span class="ident" id="8391519">err</span><span class="op" id="8391522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8391525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8391528">t</span><span class="op" id="8391529">.</span><span class="ident" id="8391530">Logf</span><span class="op" id="8391534">(</span><span class="string" id="8391535">&#34;Arith:&nbsp;%d*%d=%d\n&#34;</span><span class="op" id="8391554">,</span>&nbsp;<span class="ident" id="8391556">args</span><span class="op" id="8391560">.</span><span class="ident" id="8391561">A</span><span class="op" id="8391562">,</span>&nbsp;<span class="ident" id="8391564">args</span><span class="op" id="8391568">.</span><span class="ident" id="8391569">B</span><span class="op" id="8391570">,</span>&nbsp;<span class="ident" id="8391572">reply</span><span class="op" id="8391577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8391580">if</span>&nbsp;<span class="ident" id="8391583">reply</span><span class="op" id="8391588">.</span><span class="ident" id="8391589">C</span>&nbsp;<span class="op" id="8391591">!=</span>&nbsp;<span class="ident" id="8391594">args</span><span class="op" id="8391598">.</span><span class="ident" id="8391599">A</span><span class="op" id="8391600">*</span><span class="ident" id="8391601">args</span><span class="op" id="8391605">.</span><span class="ident" id="8391606">B</span>&nbsp;<span class="op" id="8391608">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8391612">t</span><span class="op" id="8391613">.</span><span class="ident" id="8391614">Errorf</span><span class="op" id="8391620">(</span><span class="string" id="8391621">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8391646">,</span>&nbsp;<span class="ident" id="8391648">reply</span><span class="op" id="8391653">.</span><span class="ident" id="8391654">C</span><span class="op" id="8391655">,</span>&nbsp;<span class="ident" id="8391657">args</span><span class="op" id="8391661">.</span><span class="ident" id="8391662">A</span><span class="op" id="8391663">*</span><span class="ident" id="8391664">args</span><span class="op" id="8391668">.</span><span class="ident" id="8391669">B</span><span class="op" id="8391670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8391673">}</span><br>
<span class="lineno"></span><span class="op" id="8391675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8391678">func</span>&nbsp;<span class="ident" id="8391683">TestErrorAfterClientClose</span><span class="op" id="8391708">(</span><span class="ident" id="8391709">t</span>&nbsp;<span class="op" id="8391711">*</span><span class="ident" id="8391712">testing</span><span class="op" id="8391719">.</span><span class="ident" id="8391720">T</span><span class="op" id="8391721">)</span>&nbsp;<span class="op" id="8391723">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8391726">once</span><span class="op" id="8391730">.</span><span class="ident" id="8391731">Do</span><span class="op" id="8391733">(</span><span class="ident" id="8391734">startServer</span><span class="op" id="8391745">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8391749">client</span><span class="op" id="8391755">,</span>&nbsp;<span class="ident" id="8391757">err</span>&nbsp;<span class="op" id="8391761">:=</span>&nbsp;<span class="ident" id="8391764">dialHTTP</span><span class="op" id="8391772">(</span><span class="op" id="8391773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8391776">if</span>&nbsp;<span class="ident" id="8391779">err</span>&nbsp;<span class="op" id="8391783">!=</span>&nbsp;<span class="ident" id="8391786">nil</span>&nbsp;<span class="op" id="8391790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8391794">t</span><span class="op" id="8391795">.</span><span class="ident" id="8391796">Fatalf</span><span class="op" id="8391802">(</span><span class="string" id="8391803">&#34;dialing:&nbsp;%v&#34;</span><span class="op" id="8391816">,</span>&nbsp;<span class="ident" id="8391818">err</span><span class="op" id="8391821">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8391824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8391827">err</span>&nbsp;<span class="op" id="8391831">=</span>&nbsp;<span class="ident" id="8391833">client</span><span class="op" id="8391839">.</span><span class="ident" id="8391840">Close</span><span class="op" id="8391845">(</span><span class="op" id="8391846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8391849">if</span>&nbsp;<span class="ident" id="8391852">err</span>&nbsp;<span class="op" id="8391856">!=</span>&nbsp;<span class="ident" id="8391859">nil</span>&nbsp;<span class="op" id="8391863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8391867">t</span><span class="op" id="8391868">.</span><span class="ident" id="8391869">Fatal</span><span class="op" id="8391874">(</span><span class="string" id="8391875">&#34;close&nbsp;error:&#34;</span><span class="op" id="8391889">,</span>&nbsp;<span class="ident" id="8391891">err</span><span class="op" id="8391894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8391897">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8391900">err</span>&nbsp;<span class="op" id="8391904">=</span>&nbsp;<span class="ident" id="8391906">client</span><span class="op" id="8391912">.</span><span class="ident" id="8391913">Call</span><span class="op" id="8391917">(</span><span class="string" id="8391918">&#34;Arith.Add&#34;</span><span class="op" id="8391929">,</span>&nbsp;<span class="op" id="8391931">&amp;</span><span class="ident" id="8391932">Args</span><span class="op" id="8391936">{</span><span class="num" id="8391937">7</span><span class="op" id="8391938">,</span>&nbsp;<span class="num" id="8391940">9</span><span class="op" id="8391941">}</span><span class="op" id="8391942">,</span>&nbsp;<span class="builtinfunc" id="8391944">new</span><span class="op" id="8391947">(</span><span class="ident" id="8391948">Reply</span><span class="op" id="8391953">)</span><span class="op" id="8391954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8391957">if</span>&nbsp;<span class="ident" id="8391960">err</span>&nbsp;<span class="op" id="8391964">!=</span>&nbsp;<span class="ident" id="8391967">ErrShutdown</span>&nbsp;<span class="op" id="8391979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8391983">t</span><span class="op" id="8391984">.</span><span class="ident" id="8391985">Errorf</span><span class="op" id="8391991">(</span><span class="string" id="8391992">&#34;Forever:&nbsp;expected&nbsp;ErrShutdown&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8392030">,</span>&nbsp;<span class="ident" id="8392032">err</span><span class="op" id="8392035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8392038">}</span><br>
<span class="lineno"></span><span class="op" id="8392040">}</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span><span class="keyword" id="8392043">func</span>&nbsp;<span class="ident" id="8392048">benchmarkEndToEnd</span><span class="op" id="8392065">(</span><span class="ident" id="8392066">dial</span>&nbsp;<span class="keyword" id="8392071">func</span><span class="op" id="8392075">(</span><span class="op" id="8392076">)</span>&nbsp;<span class="op" id="8392078">(</span><span class="op" id="8392079">*</span><span class="ident" id="8392080">Client</span><span class="op" id="8392086">,</span>&nbsp;<span class="builtintype" id="8392088">error</span><span class="op" id="8392093">)</span><span class="op" id="8392094">,</span>&nbsp;<span class="ident" id="8392096">b</span>&nbsp;<span class="op" id="8392098">*</span><span class="ident" id="8392099">testing</span><span class="op" id="8392106">.</span><span class="ident" id="8392107">B</span><span class="op" id="8392108">)</span>&nbsp;<span class="op" id="8392110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8392113">once</span><span class="op" id="8392117">.</span><span class="ident" id="8392118">Do</span><span class="op" id="8392120">(</span><span class="ident" id="8392121">startServer</span><span class="op" id="8392132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8392135">client</span><span class="op" id="8392141">,</span>&nbsp;<span class="ident" id="8392143">err</span>&nbsp;<span class="op" id="8392147">:=</span>&nbsp;<span class="ident" id="8392150">dial</span><span class="op" id="8392154">(</span><span class="op" id="8392155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8392158">if</span>&nbsp;<span class="ident" id="8392161">err</span>&nbsp;<span class="op" id="8392165">!=</span>&nbsp;<span class="ident" id="8392168">nil</span>&nbsp;<span class="op" id="8392172">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8392176">b</span><span class="op" id="8392177">.</span><span class="ident" id="8392178">Fatal</span><span class="op" id="8392183">(</span><span class="string" id="8392184">&#34;error&nbsp;dialing:&#34;</span><span class="op" id="8392200">,</span>&nbsp;<span class="ident" id="8392202">err</span><span class="op" id="8392205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8392208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8392211">defer</span>&nbsp;<span class="ident" id="8392217">client</span><span class="op" id="8392223">.</span><span class="ident" id="8392224">Close</span><span class="op" id="8392229">(</span><span class="op" id="8392230">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8392234">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8392256">args</span>&nbsp;<span class="op" id="8392261">:=</span>&nbsp;<span class="op" id="8392264">&amp;</span><span class="ident" id="8392265">Args</span><span class="op" id="8392269">{</span><span class="num" id="8392270">7</span><span class="op" id="8392271">,</span>&nbsp;<span class="num" id="8392273">8</span><span class="op" id="8392274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8392277">b</span><span class="op" id="8392278">.</span><span class="ident" id="8392279">ResetTimer</span><span class="op" id="8392289">(</span><span class="op" id="8392290">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8392294">b</span><span class="op" id="8392295">.</span><span class="ident" id="8392296">RunParallel</span><span class="op" id="8392307">(</span><span class="keyword" id="8392308">func</span><span class="op" id="8392312">(</span><span class="ident" id="8392313">pb</span>&nbsp;<span class="op" id="8392316">*</span><span class="ident" id="8392317">testing</span><span class="op" id="8392324">.</span><span class="ident" id="8392325">PB</span><span class="op" id="8392327">)</span>&nbsp;<span class="op" id="8392329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8392333">reply</span>&nbsp;<span class="op" id="8392339">:=</span>&nbsp;<span class="builtinfunc" id="8392342">new</span><span class="op" id="8392345">(</span><span class="ident" id="8392346">Reply</span><span class="op" id="8392351">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8392355">for</span>&nbsp;<span class="ident" id="8392359">pb</span><span class="op" id="8392361">.</span><span class="ident" id="8392362">Next</span><span class="op" id="8392366">(</span><span class="op" id="8392367">)</span>&nbsp;<span class="op" id="8392369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8392374">err</span>&nbsp;<span class="op" id="8392378">:=</span>&nbsp;<span class="ident" id="8392381">client</span><span class="op" id="8392387">.</span><span class="ident" id="8392388">Call</span><span class="op" id="8392392">(</span><span class="string" id="8392393">&#34;Arith.Add&#34;</span><span class="op" id="8392404">,</span>&nbsp;<span class="ident" id="8392406">args</span><span class="op" id="8392410">,</span>&nbsp;<span class="ident" id="8392412">reply</span><span class="op" id="8392417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8392422">if</span>&nbsp;<span class="ident" id="8392425">err</span>&nbsp;<span class="op" id="8392429">!=</span>&nbsp;<span class="ident" id="8392432">nil</span>&nbsp;<span class="op" id="8392436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8392442">b</span><span class="op" id="8392443">.</span><span class="ident" id="8392444">Fatalf</span><span class="op" id="8392450">(</span><span class="string" id="8392451">&#34;rpc&nbsp;error:&nbsp;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8392504">,</span>&nbsp;<span class="ident" id="8392506">err</span><span class="op" id="8392509">.</span><span class="ident" id="8392510">Error</span><span class="op" id="8392515">(</span><span class="op" id="8392516">)</span><span class="op" id="8392517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8392522">}</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8392527">if</span>&nbsp;<span class="ident" id="8392530">reply</span><span class="op" id="8392535">.</span><span class="ident" id="8392536">C</span>&nbsp;<span class="op" id="8392538">!=</span>&nbsp;<span class="ident" id="8392541">args</span><span class="op" id="8392545">.</span><span class="ident" id="8392546">A</span><span class="op" id="8392547">+</span><span class="ident" id="8392548">args</span><span class="op" id="8392552">.</span><span class="ident" id="8392553">B</span>&nbsp;<span class="op" id="8392555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8392561">b</span><span class="op" id="8392562">.</span><span class="ident" id="8392563">Fatalf</span><span class="op" id="8392569">(</span><span class="string" id="8392570">&#34;rpc&nbsp;error:&nbsp;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8392606">,</span>&nbsp;<span class="ident" id="8392608">reply</span><span class="op" id="8392613">.</span><span class="ident" id="8392614">C</span><span class="op" id="8392615">,</span>&nbsp;<span class="ident" id="8392617">args</span><span class="op" id="8392621">.</span><span class="ident" id="8392622">A</span><span class="op" id="8392623">+</span><span class="ident" id="8392624">args</span><span class="op" id="8392628">.</span><span class="ident" id="8392629">B</span><span class="op" id="8392630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8392635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8392639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8392642">}</span><span class="op" id="8392643">)</span><br>
<span class="lineno">620</span><span class="op" id="8392645">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8392648">func</span>&nbsp;<span class="ident" id="8392653">benchmarkEndToEndAsync</span><span class="op" id="8392675">(</span><span class="ident" id="8392676">dial</span>&nbsp;<span class="keyword" id="8392681">func</span><span class="op" id="8392685">(</span><span class="op" id="8392686">)</span>&nbsp;<span class="op" id="8392688">(</span><span class="op" id="8392689">*</span><span class="ident" id="8392690">Client</span><span class="op" id="8392696">,</span>&nbsp;<span class="builtintype" id="8392698">error</span><span class="op" id="8392703">)</span><span class="op" id="8392704">,</span>&nbsp;<span class="ident" id="8392706">b</span>&nbsp;<span class="op" id="8392708">*</span><span class="ident" id="8392709">testing</span><span class="op" id="8392716">.</span><span class="ident" id="8392717">B</span><span class="op" id="8392718">)</span>&nbsp;<span class="op" id="8392720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8392723">const</span>&nbsp;<span class="ident" id="8392729">MaxConcurrentCalls</span>&nbsp;<span class="op" id="8392748">=</span>&nbsp;<span class="num" id="8392750">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8392755">once</span><span class="op" id="8392759">.</span><span class="ident" id="8392760">Do</span><span class="op" id="8392762">(</span><span class="ident" id="8392763">startServer</span><span class="op" id="8392774">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8392777">client</span><span class="op" id="8392783">,</span>&nbsp;<span class="ident" id="8392785">err</span>&nbsp;<span class="op" id="8392789">:=</span>&nbsp;<span class="ident" id="8392792">dial</span><span class="op" id="8392796">(</span><span class="op" id="8392797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8392800">if</span>&nbsp;<span class="ident" id="8392803">err</span>&nbsp;<span class="op" id="8392807">!=</span>&nbsp;<span class="ident" id="8392810">nil</span>&nbsp;<span class="op" id="8392814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8392818">b</span><span class="op" id="8392819">.</span><span class="ident" id="8392820">Fatal</span><span class="op" id="8392825">(</span><span class="string" id="8392826">&#34;error&nbsp;dialing:&#34;</span><span class="op" id="8392842">,</span>&nbsp;<span class="ident" id="8392844">err</span><span class="op" id="8392847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8392850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8392853">defer</span>&nbsp;<span class="ident" id="8392859">client</span><span class="op" id="8392865">.</span><span class="ident" id="8392866">Close</span><span class="op" id="8392871">(</span><span class="op" id="8392872">)</span><br>
<span class="lineno">630</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8392876">//&nbsp;Asynchronous&nbsp;calls</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8392899">args</span>&nbsp;<span class="op" id="8392904">:=</span>&nbsp;<span class="op" id="8392907">&amp;</span><span class="ident" id="8392908">Args</span><span class="op" id="8392912">{</span><span class="num" id="8392913">7</span><span class="op" id="8392914">,</span>&nbsp;<span class="num" id="8392916">8</span><span class="op" id="8392917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8392920">procs</span>&nbsp;<span class="op" id="8392926">:=</span>&nbsp;<span class="num" id="8392929">4</span>&nbsp;<span class="op" id="8392931">*</span>&nbsp;<span class="ident" id="8392933">runtime</span><span class="op" id="8392940">.</span><span class="ident" id="8392941">GOMAXPROCS</span><span class="op" id="8392951">(</span><span class="op" id="8392952">-</span><span class="num" id="8392953">1</span><span class="op" id="8392954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8392957">send</span>&nbsp;<span class="op" id="8392962">:=</span>&nbsp;<span class="builtintype" id="8392965">int32</span><span class="op" id="8392970">(</span><span class="ident" id="8392971">b</span><span class="op" id="8392972">.</span><span class="ident" id="8392973">N</span><span class="op" id="8392974">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8392977">recv</span>&nbsp;<span class="op" id="8392982">:=</span>&nbsp;<span class="builtintype" id="8392985">int32</span><span class="op" id="8392990">(</span><span class="ident" id="8392991">b</span><span class="op" id="8392992">.</span><span class="ident" id="8392993">N</span><span class="op" id="8392994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8392997">var</span>&nbsp;<span class="ident" id="8393001">wg</span>&nbsp;<span class="ident" id="8393004">sync</span><span class="op" id="8393008">.</span><span class="ident" id="8393009">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393020">wg</span><span class="op" id="8393022">.</span><span class="ident" id="8393023">Add</span><span class="op" id="8393026">(</span><span class="ident" id="8393027">procs</span><span class="op" id="8393032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393035">gate</span>&nbsp;<span class="op" id="8393040">:=</span>&nbsp;<span class="builtinfunc" id="8393043">make</span><span class="op" id="8393047">(</span><span class="keyword" id="8393048">chan</span>&nbsp;<span class="builtintype" id="8393053">bool</span><span class="op" id="8393057">,</span>&nbsp;<span class="ident" id="8393059">MaxConcurrentCalls</span><span class="op" id="8393077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393080">res</span>&nbsp;<span class="op" id="8393084">:=</span>&nbsp;<span class="builtinfunc" id="8393087">make</span><span class="op" id="8393091">(</span><span class="keyword" id="8393092">chan</span>&nbsp;<span class="op" id="8393097">*</span><span class="ident" id="8393098">Call</span><span class="op" id="8393102">,</span>&nbsp;<span class="ident" id="8393104">MaxConcurrentCalls</span><span class="op" id="8393122">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393125">b</span><span class="op" id="8393126">.</span><span class="ident" id="8393127">ResetTimer</span><span class="op" id="8393137">(</span><span class="op" id="8393138">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8393142">for</span>&nbsp;<span class="ident" id="8393146">p</span>&nbsp;<span class="op" id="8393148">:=</span>&nbsp;<span class="num" id="8393151">0</span><span class="op" id="8393152">;</span>&nbsp;<span class="ident" id="8393154">p</span>&nbsp;<span class="op" id="8393156">&lt;</span>&nbsp;<span class="ident" id="8393158">procs</span><span class="op" id="8393163">;</span>&nbsp;<span class="ident" id="8393165">p</span><span class="op" id="8393166">++</span>&nbsp;<span class="op" id="8393169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8393173">go</span>&nbsp;<span class="keyword" id="8393176">func</span><span class="op" id="8393180">(</span><span class="op" id="8393181">)</span>&nbsp;<span class="op" id="8393183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8393188">for</span>&nbsp;<span class="ident" id="8393192">atomic</span><span class="op" id="8393198">.</span><span class="ident" id="8393199">AddInt32</span><span class="op" id="8393207">(</span><span class="op" id="8393208">&amp;</span><span class="ident" id="8393209">send</span><span class="op" id="8393213">,</span>&nbsp;<span class="op" id="8393215">-</span><span class="num" id="8393216">1</span><span class="op" id="8393217">)</span>&nbsp;<span class="op" id="8393219">&gt;=</span>&nbsp;<span class="num" id="8393222">0</span>&nbsp;<span class="op" id="8393224">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393230">gate</span>&nbsp;<span class="op" id="8393235">&lt;-</span>&nbsp;<span class="builtintype" id="8393238">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393247">reply</span>&nbsp;<span class="op" id="8393253">:=</span>&nbsp;<span class="builtinfunc" id="8393256">new</span><span class="op" id="8393259">(</span><span class="ident" id="8393260">Reply</span><span class="op" id="8393265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393271">client</span><span class="op" id="8393277">.</span><span class="ident" id="8393278">Go</span><span class="op" id="8393280">(</span><span class="string" id="8393281">&#34;Arith.Add&#34;</span><span class="op" id="8393292">,</span>&nbsp;<span class="ident" id="8393294">args</span><span class="op" id="8393298">,</span>&nbsp;<span class="ident" id="8393300">reply</span><span class="op" id="8393305">,</span>&nbsp;<span class="ident" id="8393307">res</span><span class="op" id="8393310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8393315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8393319">}</span><span class="op" id="8393320">(</span><span class="op" id="8393321">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8393325">go</span>&nbsp;<span class="keyword" id="8393328">func</span><span class="op" id="8393332">(</span><span class="op" id="8393333">)</span>&nbsp;<span class="op" id="8393335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8393340">for</span>&nbsp;<span class="ident" id="8393344">call</span>&nbsp;<span class="op" id="8393349">:=</span>&nbsp;<span class="keyword" id="8393352">range</span>&nbsp;<span class="ident" id="8393358">res</span>&nbsp;<span class="op" id="8393362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393368">A</span>&nbsp;<span class="op" id="8393370">:=</span>&nbsp;<span class="ident" id="8393373">call</span><span class="op" id="8393377">.</span><span class="ident" id="8393378">Args</span><span class="op" id="8393382">.</span><span class="op" id="8393383">(</span><span class="op" id="8393384">*</span><span class="ident" id="8393385">Args</span><span class="op" id="8393389">)</span><span class="op" id="8393390">.</span><span class="ident" id="8393391">A</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393397">B</span>&nbsp;<span class="op" id="8393399">:=</span>&nbsp;<span class="ident" id="8393402">call</span><span class="op" id="8393406">.</span><span class="ident" id="8393407">Args</span><span class="op" id="8393411">.</span><span class="op" id="8393412">(</span><span class="op" id="8393413">*</span><span class="ident" id="8393414">Args</span><span class="op" id="8393418">)</span><span class="op" id="8393419">.</span><span class="ident" id="8393420">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393426">C</span>&nbsp;<span class="op" id="8393428">:=</span>&nbsp;<span class="ident" id="8393431">call</span><span class="op" id="8393435">.</span><span class="ident" id="8393436">Reply</span><span class="op" id="8393441">.</span><span class="op" id="8393442">(</span><span class="op" id="8393443">*</span><span class="ident" id="8393444">Reply</span><span class="op" id="8393449">)</span><span class="op" id="8393450">.</span><span class="ident" id="8393451">C</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8393457">if</span>&nbsp;<span class="ident" id="8393460">A</span><span class="op" id="8393461">+</span><span class="ident" id="8393462">B</span>&nbsp;<span class="op" id="8393464">!=</span>&nbsp;<span class="ident" id="8393467">C</span>&nbsp;<span class="op" id="8393469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393476">b</span><span class="op" id="8393477">.</span><span class="ident" id="8393478">Fatalf</span><span class="op" id="8393484">(</span><span class="string" id="8393485">&#34;incorrect&nbsp;reply:&nbsp;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8393527">,</span>&nbsp;<span class="ident" id="8393529">A</span><span class="op" id="8393530">+</span><span class="ident" id="8393531">B</span><span class="op" id="8393532">,</span>&nbsp;<span class="ident" id="8393534">C</span><span class="op" id="8393535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8393541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8393547">&lt;-</span><span class="ident" id="8393549">gate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8393558">if</span>&nbsp;<span class="ident" id="8393561">atomic</span><span class="op" id="8393567">.</span><span class="ident" id="8393568">AddInt32</span><span class="op" id="8393576">(</span><span class="op" id="8393577">&amp;</span><span class="ident" id="8393578">recv</span><span class="op" id="8393582">,</span>&nbsp;<span class="op" id="8393584">-</span><span class="num" id="8393585">1</span><span class="op" id="8393586">)</span>&nbsp;<span class="op" id="8393588">==</span>&nbsp;<span class="num" id="8393591">0</span>&nbsp;<span class="op" id="8393593">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8393600">close</span><span class="op" id="8393605">(</span><span class="ident" id="8393606">res</span><span class="op" id="8393609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8393615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8393620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393625">wg</span><span class="op" id="8393627">.</span><span class="ident" id="8393628">Done</span><span class="op" id="8393632">(</span><span class="op" id="8393633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8393637">}</span><span class="op" id="8393638">(</span><span class="op" id="8393639">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8393642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393645">wg</span><span class="op" id="8393647">.</span><span class="ident" id="8393648">Wait</span><span class="op" id="8393652">(</span><span class="op" id="8393653">)</span><br>
<span class="lineno"></span><span class="op" id="8393655">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8393658">func</span>&nbsp;<span class="ident" id="8393663">BenchmarkEndToEnd</span><span class="op" id="8393680">(</span><span class="ident" id="8393681">b</span>&nbsp;<span class="op" id="8393683">*</span><span class="ident" id="8393684">testing</span><span class="op" id="8393691">.</span><span class="ident" id="8393692">B</span><span class="op" id="8393693">)</span>&nbsp;<span class="op" id="8393695">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393698">benchmarkEndToEnd</span><span class="op" id="8393715">(</span><span class="ident" id="8393716">dialDirect</span><span class="op" id="8393726">,</span>&nbsp;<span class="ident" id="8393728">b</span><span class="op" id="8393729">)</span><br>
<span class="lineno"></span><span class="op" id="8393731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8393734">func</span>&nbsp;<span class="ident" id="8393739">BenchmarkEndToEndHTTP</span><span class="op" id="8393760">(</span><span class="ident" id="8393761">b</span>&nbsp;<span class="op" id="8393763">*</span><span class="ident" id="8393764">testing</span><span class="op" id="8393771">.</span><span class="ident" id="8393772">B</span><span class="op" id="8393773">)</span>&nbsp;<span class="op" id="8393775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393778">benchmarkEndToEnd</span><span class="op" id="8393795">(</span><span class="ident" id="8393796">dialHTTP</span><span class="op" id="8393804">,</span>&nbsp;<span class="ident" id="8393806">b</span><span class="op" id="8393807">)</span><br>
<span class="lineno">675</span><span class="op" id="8393809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8393812">func</span>&nbsp;<span class="ident" id="8393817">BenchmarkEndToEndAsync</span><span class="op" id="8393839">(</span><span class="ident" id="8393840">b</span>&nbsp;<span class="op" id="8393842">*</span><span class="ident" id="8393843">testing</span><span class="op" id="8393850">.</span><span class="ident" id="8393851">B</span><span class="op" id="8393852">)</span>&nbsp;<span class="op" id="8393854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393857">benchmarkEndToEndAsync</span><span class="op" id="8393879">(</span><span class="ident" id="8393880">dialDirect</span><span class="op" id="8393890">,</span>&nbsp;<span class="ident" id="8393892">b</span><span class="op" id="8393893">)</span><br>
<span class="lineno"></span><span class="op" id="8393895">}</span><br>
<span class="lineno">680</span><br>
<span class="lineno"></span><span class="keyword" id="8393898">func</span>&nbsp;<span class="ident" id="8393903">BenchmarkEndToEndAsyncHTTP</span><span class="op" id="8393929">(</span><span class="ident" id="8393930">b</span>&nbsp;<span class="op" id="8393932">*</span><span class="ident" id="8393933">testing</span><span class="op" id="8393940">.</span><span class="ident" id="8393941">B</span><span class="op" id="8393942">)</span>&nbsp;<span class="op" id="8393944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393947">benchmarkEndToEndAsync</span><span class="op" id="8393969">(</span><span class="ident" id="8393970">dialHTTP</span><span class="op" id="8393978">,</span>&nbsp;<span class="ident" id="8393980">b</span><span class="op" id="8393981">)</span><br>
<span class="lineno"></span><span class="op" id="8393983">}</span>
</div>
</body>
</html>
