<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>lonnie.io/e8vm/link8</h2>
<ul>
<li><a href="/gostd/lonnie.io/e8vm/link8/func.go.html">func.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/layout.go.html">layout.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/link.go.html">link.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/linker.go.html">linker.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/package.go.html">package.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/pkg_sym.go.html">pkg_sym.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/symbol.go.html">symbol.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/trace_used.go.html">trace_used.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/var.go.html">var.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/writer.go.html">writer.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="keyword" id="3675673">package</span>&nbsp;<span class="ident" id="3675681">link8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3675688">//&nbsp;Linker&nbsp;provides&nbsp;the&nbsp;framework&nbsp;to&nbsp;link&nbsp;packages&nbsp;together.</span><br>
<span class="lineno"></span><span class="keyword" id="3675748">type</span>&nbsp;<span class="ident" id="3675753">Linker</span>&nbsp;<span class="keyword" id="3675760">struct</span>&nbsp;<span class="op" id="3675767">{</span><br>
<span class="lineno">5</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3675770">pkgs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3675779">[</span><span class="op" id="3675780">]</span><span class="op" id="3675781">*</span><span class="ident" id="3675782">Package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3675791">pkgIndex</span>&nbsp;<span class="keyword" id="3675800">map</span><span class="op" id="3675803">[</span><span class="builtintype" id="3675804">string</span><span class="op" id="3675810">]</span><span class="builtintype" id="3675811">int</span><br>
<span class="lineno"></span><span class="op" id="3675815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3675818">//&nbsp;NewLinker&nbsp;creates&nbsp;a&nbsp;new&nbsp;linker&nbsp;with&nbsp;no&nbsp;packages.</span><br>
<span class="lineno">10</span><span class="keyword" id="3675870">func</span>&nbsp;<span class="ident" id="3675875">NewLinker</span><span class="op" id="3675884">(</span><span class="op" id="3675885">)</span>&nbsp;<span class="op" id="3675887">*</span><span class="ident" id="3675888">Linker</span>&nbsp;<span class="op" id="3675895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3675898">ret</span>&nbsp;<span class="op" id="3675902">:=</span>&nbsp;<span class="builtinfunc" id="3675905">new</span><span class="op" id="3675908">(</span><span class="ident" id="3675909">Linker</span><span class="op" id="3675915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3675918">ret</span><span class="op" id="3675921">.</span><span class="ident" id="3675922">pkgIndex</span>&nbsp;<span class="op" id="3675931">=</span>&nbsp;<span class="builtinfunc" id="3675933">make</span><span class="op" id="3675937">(</span><span class="keyword" id="3675938">map</span><span class="op" id="3675941">[</span><span class="builtintype" id="3675942">string</span><span class="op" id="3675948">]</span><span class="builtintype" id="3675949">int</span><span class="op" id="3675952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3675955">return</span>&nbsp;<span class="ident" id="3675962">ret</span><br>
<span class="lineno"></span><span class="op" id="3675966">}</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3675969">//&nbsp;AddPkg&nbsp;adds&nbsp;a&nbsp;package&nbsp;into&nbsp;the&nbsp;linker.</span><br>
<span class="lineno"></span><span class="comment" id="3676011">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;package&nbsp;and&nbsp;if&nbsp;the&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="3676069">//&nbsp;is&nbsp;new.</span><br>
<span class="lineno"></span><span class="keyword" id="3676080">func</span>&nbsp;<span class="op" id="3676085">(</span><span class="ident" id="3676086">lnk</span>&nbsp;<span class="op" id="3676090">*</span><span class="ident" id="3676091">Linker</span><span class="op" id="3676097">)</span>&nbsp;<span class="ident" id="3676099">AddPkg</span><span class="op" id="3676105">(</span><span class="ident" id="3676106">p</span>&nbsp;<span class="op" id="3676108">*</span><span class="ident" id="3676109">Package</span><span class="op" id="3676116">)</span>&nbsp;<span class="op" id="3676118">(</span><span class="ident" id="3676119">index</span>&nbsp;<span class="builtintype" id="3676125">int</span><span class="op" id="3676128">,</span>&nbsp;<span class="ident" id="3676130">isNew</span>&nbsp;<span class="builtintype" id="3676136">bool</span><span class="op" id="3676140">)</span>&nbsp;<span class="op" id="3676142">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3676145">path</span>&nbsp;<span class="op" id="3676150">:=</span>&nbsp;<span class="ident" id="3676153">p</span><span class="op" id="3676154">.</span><span class="ident" id="3676155">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3676161">index</span><span class="op" id="3676166">,</span>&nbsp;<span class="ident" id="3676168">found</span>&nbsp;<span class="op" id="3676174">:=</span>&nbsp;<span class="ident" id="3676177">lnk</span><span class="op" id="3676180">.</span><span class="ident" id="3676181">pkgIndex</span><span class="op" id="3676189">[</span><span class="ident" id="3676190">path</span><span class="op" id="3676194">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676197">if</span>&nbsp;<span class="ident" id="3676200">found</span>&nbsp;<span class="op" id="3676206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676210">return</span>&nbsp;<span class="ident" id="3676217">index</span><span class="op" id="3676222">,</span>&nbsp;<span class="builtintype" id="3676224">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3676231">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3676235">index</span>&nbsp;<span class="op" id="3676241">=</span>&nbsp;<span class="builtinfunc" id="3676243">len</span><span class="op" id="3676246">(</span><span class="ident" id="3676247">lnk</span><span class="op" id="3676250">.</span><span class="ident" id="3676251">pkgs</span><span class="op" id="3676255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3676258">lnk</span><span class="op" id="3676261">.</span><span class="ident" id="3676262">pkgs</span>&nbsp;<span class="op" id="3676267">=</span>&nbsp;<span class="builtinfunc" id="3676269">append</span><span class="op" id="3676275">(</span><span class="ident" id="3676276">lnk</span><span class="op" id="3676279">.</span><span class="ident" id="3676280">pkgs</span><span class="op" id="3676284">,</span>&nbsp;<span class="ident" id="3676286">p</span><span class="op" id="3676287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3676290">lnk</span><span class="op" id="3676293">.</span><span class="ident" id="3676294">pkgIndex</span><span class="op" id="3676302">[</span><span class="ident" id="3676303">path</span><span class="op" id="3676307">]</span>&nbsp;<span class="op" id="3676309">=</span>&nbsp;<span class="ident" id="3676311">index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676318">return</span>&nbsp;<span class="ident" id="3676325">index</span><span class="op" id="3676330">,</span>&nbsp;<span class="builtintype" id="3676332">true</span><br>
<span class="lineno">30</span><span class="op" id="3676337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3676340">//&nbsp;AddPkgs&nbsp;adds&nbsp;the&nbsp;package&nbsp;and&nbsp;recursively&nbsp;adds&nbsp;the&nbsp;packages</span><br>
<span class="lineno"></span><span class="comment" id="3676402">//&nbsp;it&nbsp;requires.&nbsp;It&nbsp;returns&nbsp;the&nbsp;package&nbsp;index.</span><br>
<span class="lineno"></span><span class="keyword" id="3676448">func</span>&nbsp;<span class="op" id="3676453">(</span><span class="ident" id="3676454">lnk</span>&nbsp;<span class="op" id="3676458">*</span><span class="ident" id="3676459">Linker</span><span class="op" id="3676465">)</span>&nbsp;<span class="ident" id="3676467">AddPkgs</span><span class="op" id="3676474">(</span><span class="ident" id="3676475">p</span>&nbsp;<span class="op" id="3676477">*</span><span class="ident" id="3676478">Package</span><span class="op" id="3676485">)</span>&nbsp;<span class="builtintype" id="3676487">int</span>&nbsp;<span class="op" id="3676491">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3676494">index</span><span class="op" id="3676499">,</span>&nbsp;<span class="ident" id="3676501">isNew</span>&nbsp;<span class="op" id="3676507">:=</span>&nbsp;<span class="ident" id="3676510">lnk</span><span class="op" id="3676513">.</span><span class="ident" id="3676514">AddPkg</span><span class="op" id="3676520">(</span><span class="ident" id="3676521">p</span><span class="op" id="3676522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676525">if</span>&nbsp;<span class="ident" id="3676528">isNew</span>&nbsp;<span class="op" id="3676534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676538">for</span>&nbsp;<span class="ident" id="3676542">_</span><span class="op" id="3676543">,</span>&nbsp;<span class="ident" id="3676545">req</span>&nbsp;<span class="op" id="3676549">:=</span>&nbsp;<span class="keyword" id="3676552">range</span>&nbsp;<span class="ident" id="3676558">p</span><span class="op" id="3676559">.</span><span class="ident" id="3676560">requires</span>&nbsp;<span class="op" id="3676569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3676574">lnk</span><span class="op" id="3676577">.</span><span class="ident" id="3676578">AddPkgs</span><span class="op" id="3676585">(</span><span class="ident" id="3676586">req</span><span class="op" id="3676589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3676593">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3676596">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676600">return</span>&nbsp;<span class="ident" id="3676607">index</span><br>
<span class="lineno"></span><span class="op" id="3676613">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="3676616">//&nbsp;PkgIndex&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;particular&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="3676673">func</span>&nbsp;<span class="op" id="3676678">(</span><span class="ident" id="3676679">lnk</span>&nbsp;<span class="op" id="3676683">*</span><span class="ident" id="3676684">Linker</span><span class="op" id="3676690">)</span>&nbsp;<span class="ident" id="3676692">PkgIndex</span><span class="op" id="3676700">(</span><span class="ident" id="3676701">path</span>&nbsp;<span class="builtintype" id="3676706">string</span><span class="op" id="3676712">)</span>&nbsp;<span class="builtintype" id="3676714">int</span>&nbsp;<span class="op" id="3676718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3676721">ret</span><span class="op" id="3676724">,</span>&nbsp;<span class="ident" id="3676726">found</span>&nbsp;<span class="op" id="3676732">:=</span>&nbsp;<span class="ident" id="3676735">lnk</span><span class="op" id="3676738">.</span><span class="ident" id="3676739">pkgIndex</span><span class="op" id="3676747">[</span><span class="ident" id="3676748">path</span><span class="op" id="3676752">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676755">if</span>&nbsp;<span class="op" id="3676758">!</span><span class="ident" id="3676759">found</span>&nbsp;<span class="op" id="3676765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3676769">panic</span><span class="op" id="3676774">(</span><span class="string" id="3676775">&#34;not&nbsp;found&#34;</span><span class="op" id="3676786">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3676789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676792">return</span>&nbsp;<span class="ident" id="3676799">ret</span><br>
<span class="lineno"></span><span class="op" id="3676803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3676806">//&nbsp;Pkg&nbsp;returns&nbsp;the&nbsp;package&nbsp;of&nbsp;index&nbsp;i.</span><br>
<span class="lineno">55</span><span class="keyword" id="3676845">func</span>&nbsp;<span class="op" id="3676850">(</span><span class="ident" id="3676851">lnk</span>&nbsp;<span class="op" id="3676855">*</span><span class="ident" id="3676856">Linker</span><span class="op" id="3676862">)</span>&nbsp;<span class="ident" id="3676864">Pkg</span><span class="op" id="3676867">(</span><span class="ident" id="3676868">i</span>&nbsp;<span class="builtintype" id="3676870">int</span><span class="op" id="3676873">)</span>&nbsp;<span class="op" id="3676875">*</span><span class="ident" id="3676876">Package</span>&nbsp;<span class="op" id="3676884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676887">return</span>&nbsp;<span class="ident" id="3676894">lnk</span><span class="op" id="3676897">.</span><span class="ident" id="3676898">pkgs</span><span class="op" id="3676902">[</span><span class="ident" id="3676903">i</span><span class="op" id="3676904">]</span><br>
<span class="lineno"></span><span class="op" id="3676906">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3676909">//&nbsp;Npkg&nbsp;retunrs&nbsp;the&nbsp;total&nbsp;number&nbsp;of&nbsp;packages.</span><br>
<span class="lineno">60</span><span class="keyword" id="3676955">func</span>&nbsp;<span class="op" id="3676960">(</span><span class="ident" id="3676961">lnk</span>&nbsp;<span class="op" id="3676965">*</span><span class="ident" id="3676966">Linker</span><span class="op" id="3676972">)</span>&nbsp;<span class="ident" id="3676974">Npkg</span><span class="op" id="3676978">(</span><span class="op" id="3676979">)</span>&nbsp;<span class="builtintype" id="3676981">int</span>&nbsp;<span class="op" id="3676985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676988">return</span>&nbsp;<span class="builtinfunc" id="3676995">len</span><span class="op" id="3676998">(</span><span class="ident" id="3676999">lnk</span><span class="op" id="3677002">.</span><span class="ident" id="3677003">pkgs</span><span class="op" id="3677007">)</span><br>
<span class="lineno"></span><span class="op" id="3677009">}</span>
</div>
</body>
</html>
