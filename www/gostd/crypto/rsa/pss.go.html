<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/rsa</h2>
<ul>
<li><a href="/gostd/crypto/rsa/pkcs1v15.go.html">pkcs1v15.go</a></li>
<li><a href="/gostd/crypto/rsa/pkcs1v15_test.go.html">pkcs1v15_test.go</a></li>
<li><a href="/gostd/crypto/rsa/pss.go.html" class="current">pss.go</a></li>
<li><a href="/gostd/crypto/rsa/pss_test.go.html">pss_test.go</a></li>
<li><a href="/gostd/crypto/rsa/rsa.go.html">rsa.go</a></li>
<li><a href="/gostd/crypto/rsa/rsa_test.go.html">rsa_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4159405">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4159460">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4159514">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4159565">package</span>&nbsp;<span class="ident" id="4159573">rsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4159578">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;the&nbsp;PSS&nbsp;signature&nbsp;scheme&nbsp;[1].</span><br>
<span class="lineno"></span><span class="comment" id="4159632">//</span><br>
<span class="lineno"></span><span class="comment" id="4159635">//&nbsp;[1]&nbsp;http://www.rsa.com/rsalabs/pkcs/files/h11300-wp-pkcs-1v2-2-rsa-cryptography-standard.pdf</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="4159732">import</span>&nbsp;<span class="op" id="4159739">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4159742">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4159751">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4159761">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4159771">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4159779">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4159785">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="4159796">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="4159799">func</span>&nbsp;<span class="ident" id="4159804">emsaPSSEncode</span><span class="op" id="4159817">(</span><span class="ident" id="4159818">mHash</span>&nbsp;<span class="op" id="4159824">[</span><span class="op" id="4159825">]</span><span class="builtintype" id="4159826">byte</span><span class="op" id="4159830">,</span>&nbsp;<span class="ident" id="4159832">emBits</span>&nbsp;<span class="builtintype" id="4159839">int</span><span class="op" id="4159842">,</span>&nbsp;<span class="ident" id="4159844">salt</span>&nbsp;<span class="op" id="4159849">[</span><span class="op" id="4159850">]</span><span class="builtintype" id="4159851">byte</span><span class="op" id="4159855">,</span>&nbsp;<span class="ident" id="4159857">hash</span>&nbsp;<span class="ident" id="4159862">hash</span><span class="op" id="4159866">.</span><span class="ident" id="4159867">Hash</span><span class="op" id="4159871">)</span>&nbsp;<span class="op" id="4159873">(</span><span class="op" id="4159874">[</span><span class="op" id="4159875">]</span><span class="builtintype" id="4159876">byte</span><span class="op" id="4159880">,</span>&nbsp;<span class="builtintype" id="4159882">error</span><span class="op" id="4159887">)</span>&nbsp;<span class="op" id="4159889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4159892">//&nbsp;See&nbsp;[1],&nbsp;section&nbsp;9.1.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4159919">hLen</span>&nbsp;<span class="op" id="4159924">:=</span>&nbsp;<span class="ident" id="4159927">hash</span><span class="op" id="4159931">.</span><span class="ident" id="4159932">Size</span><span class="op" id="4159936">(</span><span class="op" id="4159937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4159940">sLen</span>&nbsp;<span class="op" id="4159945">:=</span>&nbsp;<span class="builtinfunc" id="4159948">len</span><span class="op" id="4159951">(</span><span class="ident" id="4159952">salt</span><span class="op" id="4159956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4159959">emLen</span>&nbsp;<span class="op" id="4159965">:=</span>&nbsp;<span class="op" id="4159968">(</span><span class="ident" id="4159969">emBits</span>&nbsp;<span class="op" id="4159976">+</span>&nbsp;<span class="num" id="4159978">7</span><span class="op" id="4159979">)</span>&nbsp;<span class="op" id="4159981">/</span>&nbsp;<span class="num" id="4159983">8</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4159987">//&nbsp;1.&nbsp;&nbsp;If&nbsp;the&nbsp;length&nbsp;of&nbsp;M&nbsp;is&nbsp;greater&nbsp;than&nbsp;the&nbsp;input&nbsp;limitation&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4160059">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hash&nbsp;function&nbsp;(2^61&nbsp;-&nbsp;1&nbsp;octets&nbsp;for&nbsp;SHA-1),&nbsp;output&nbsp;&#34;message&nbsp;too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4160130">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4160154">//</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4160158">//&nbsp;2.&nbsp;&nbsp;Let&nbsp;mHash&nbsp;=&nbsp;Hash(M),&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;hLen.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4160220">if</span>&nbsp;<span class="builtinfunc" id="4160223">len</span><span class="op" id="4160226">(</span><span class="ident" id="4160227">mHash</span><span class="op" id="4160232">)</span>&nbsp;<span class="op" id="4160234">!=</span>&nbsp;<span class="ident" id="4160237">hLen</span>&nbsp;<span class="op" id="4160242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4160246">return</span>&nbsp;<span class="ident" id="4160253">nil</span><span class="op" id="4160256">,</span>&nbsp;<span class="ident" id="4160258">errors</span><span class="op" id="4160264">.</span><span class="ident" id="4160265">New</span><span class="op" id="4160268">(</span><span class="string" id="4160269">&#34;crypto/rsa:&nbsp;input&nbsp;must&nbsp;be&nbsp;hashed&nbsp;message&#34;</span><span class="op" id="4160311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4160314">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4160318">//&nbsp;3.&nbsp;&nbsp;If&nbsp;emLen&nbsp;&lt;&nbsp;hLen&nbsp;+&nbsp;sLen&nbsp;+&nbsp;2,&nbsp;output&nbsp;&#34;encoding&nbsp;error&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4160389">if</span>&nbsp;<span class="ident" id="4160392">emLen</span>&nbsp;<span class="op" id="4160398">&lt;</span>&nbsp;<span class="ident" id="4160400">hLen</span><span class="op" id="4160404">+</span><span class="ident" id="4160405">sLen</span><span class="op" id="4160409">+</span><span class="num" id="4160410">2</span>&nbsp;<span class="op" id="4160412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4160416">return</span>&nbsp;<span class="ident" id="4160423">nil</span><span class="op" id="4160426">,</span>&nbsp;<span class="ident" id="4160428">errors</span><span class="op" id="4160434">.</span><span class="ident" id="4160435">New</span><span class="op" id="4160438">(</span><span class="string" id="4160439">&#34;crypto/rsa:&nbsp;encoding&nbsp;error&#34;</span><span class="op" id="4160467">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4160470">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4160474">em</span>&nbsp;<span class="op" id="4160477">:=</span>&nbsp;<span class="builtinfunc" id="4160480">make</span><span class="op" id="4160484">(</span><span class="op" id="4160485">[</span><span class="op" id="4160486">]</span><span class="builtintype" id="4160487">byte</span><span class="op" id="4160491">,</span>&nbsp;<span class="ident" id="4160493">emLen</span><span class="op" id="4160498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4160501">db</span>&nbsp;<span class="op" id="4160504">:=</span>&nbsp;<span class="ident" id="4160507">em</span><span class="op" id="4160509">[</span><span class="op" id="4160510">:</span><span class="ident" id="4160511">emLen</span><span class="op" id="4160516">-</span><span class="ident" id="4160517">sLen</span><span class="op" id="4160521">-</span><span class="ident" id="4160522">hLen</span><span class="op" id="4160526">-</span><span class="num" id="4160527">2</span><span class="op" id="4160528">+</span><span class="num" id="4160529">1</span><span class="op" id="4160530">+</span><span class="ident" id="4160531">sLen</span><span class="op" id="4160535">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4160538">h</span>&nbsp;<span class="op" id="4160540">:=</span>&nbsp;<span class="ident" id="4160543">em</span><span class="op" id="4160545">[</span><span class="ident" id="4160546">emLen</span><span class="op" id="4160551">-</span><span class="ident" id="4160552">sLen</span><span class="op" id="4160556">-</span><span class="ident" id="4160557">hLen</span><span class="op" id="4160561">-</span><span class="num" id="4160562">2</span><span class="op" id="4160563">+</span><span class="num" id="4160564">1</span><span class="op" id="4160565">+</span><span class="ident" id="4160566">sLen</span>&nbsp;<span class="op" id="4160571">:</span>&nbsp;<span class="ident" id="4160573">emLen</span><span class="op" id="4160578">-</span><span class="num" id="4160579">1</span><span class="op" id="4160580">]</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4160584">//&nbsp;4.&nbsp;&nbsp;Generate&nbsp;a&nbsp;random&nbsp;octet&nbsp;string&nbsp;salt&nbsp;of&nbsp;length&nbsp;sLen;&nbsp;if&nbsp;sLen&nbsp;=&nbsp;0,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4160657">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;then&nbsp;salt&nbsp;is&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4160696">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4160700">//&nbsp;5.&nbsp;&nbsp;Let</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4160712">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&#39;&nbsp;=&nbsp;(0x)00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;||&nbsp;mHash&nbsp;||&nbsp;salt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4160773">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4160777">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&#39;&nbsp;is&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;8&nbsp;+&nbsp;hLen&nbsp;+&nbsp;sLen&nbsp;with&nbsp;eight</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4160844">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initial&nbsp;zero&nbsp;octets.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4160873">//</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4160877">//&nbsp;6.&nbsp;&nbsp;Let&nbsp;H&nbsp;=&nbsp;Hash(M&#39;),&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;hLen.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4160936">var</span>&nbsp;<span class="ident" id="4160940">prefix</span>&nbsp;<span class="op" id="4160947">[</span><span class="num" id="4160948">8</span><span class="op" id="4160949">]</span><span class="builtintype" id="4160950">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4160957">hash</span><span class="op" id="4160961">.</span><span class="ident" id="4160962">Write</span><span class="op" id="4160967">(</span><span class="ident" id="4160968">prefix</span><span class="op" id="4160974">[</span><span class="op" id="4160975">:</span><span class="op" id="4160976">]</span><span class="op" id="4160977">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4160980">hash</span><span class="op" id="4160984">.</span><span class="ident" id="4160985">Write</span><span class="op" id="4160990">(</span><span class="ident" id="4160991">mHash</span><span class="op" id="4160996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4160999">hash</span><span class="op" id="4161003">.</span><span class="ident" id="4161004">Write</span><span class="op" id="4161009">(</span><span class="ident" id="4161010">salt</span><span class="op" id="4161014">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4161018">h</span>&nbsp;<span class="op" id="4161020">=</span>&nbsp;<span class="ident" id="4161022">hash</span><span class="op" id="4161026">.</span><span class="ident" id="4161027">Sum</span><span class="op" id="4161030">(</span><span class="ident" id="4161031">h</span><span class="op" id="4161032">[</span><span class="op" id="4161033">:</span><span class="num" id="4161034">0</span><span class="op" id="4161035">]</span><span class="op" id="4161036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4161039">hash</span><span class="op" id="4161043">.</span><span class="ident" id="4161044">Reset</span><span class="op" id="4161049">(</span><span class="op" id="4161050">)</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4161054">//&nbsp;7.&nbsp;&nbsp;Generate&nbsp;an&nbsp;octet&nbsp;string&nbsp;PS&nbsp;consisting&nbsp;of&nbsp;emLen&nbsp;-&nbsp;sLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4161128">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zero&nbsp;octets.&nbsp;&nbsp;The&nbsp;length&nbsp;of&nbsp;PS&nbsp;may&nbsp;be&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4161177">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4161181">//&nbsp;8.&nbsp;&nbsp;Let&nbsp;DB&nbsp;=&nbsp;PS&nbsp;||&nbsp;0x01&nbsp;||&nbsp;salt;&nbsp;DB&nbsp;is&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4161250">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;1.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4161277">db</span><span class="op" id="4161279">[</span><span class="ident" id="4161280">emLen</span><span class="op" id="4161285">-</span><span class="ident" id="4161286">sLen</span><span class="op" id="4161290">-</span><span class="ident" id="4161291">hLen</span><span class="op" id="4161295">-</span><span class="num" id="4161296">2</span><span class="op" id="4161297">]</span>&nbsp;<span class="op" id="4161299">=</span>&nbsp;<span class="num" id="4161301">0x01</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4161307">copy</span><span class="op" id="4161311">(</span><span class="ident" id="4161312">db</span><span class="op" id="4161314">[</span><span class="ident" id="4161315">emLen</span><span class="op" id="4161320">-</span><span class="ident" id="4161321">sLen</span><span class="op" id="4161325">-</span><span class="ident" id="4161326">hLen</span><span class="op" id="4161330">-</span><span class="num" id="4161331">1</span><span class="op" id="4161332">:</span><span class="op" id="4161333">]</span><span class="op" id="4161334">,</span>&nbsp;<span class="ident" id="4161336">salt</span><span class="op" id="4161340">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4161344">//&nbsp;9.&nbsp;&nbsp;Let&nbsp;dbMask&nbsp;=&nbsp;MGF(H,&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4161391">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4161395">//&nbsp;10.&nbsp;Let&nbsp;maskedDB&nbsp;=&nbsp;DB&nbsp;\xor&nbsp;dbMask.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4161435">mgf1XOR</span><span class="op" id="4161442">(</span><span class="ident" id="4161443">db</span><span class="op" id="4161445">,</span>&nbsp;<span class="ident" id="4161447">hash</span><span class="op" id="4161451">,</span>&nbsp;<span class="ident" id="4161453">h</span><span class="op" id="4161454">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4161458">//&nbsp;11.&nbsp;Set&nbsp;the&nbsp;leftmost&nbsp;8&nbsp;*&nbsp;emLen&nbsp;-&nbsp;emBits&nbsp;bits&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;octet&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4161532">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maskedDB&nbsp;to&nbsp;zero.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4161559">db</span><span class="op" id="4161561">[</span><span class="num" id="4161562">0</span><span class="op" id="4161563">]</span>&nbsp;<span class="op" id="4161565">&amp;=</span>&nbsp;<span class="op" id="4161568">(</span><span class="num" id="4161569">0xFF</span>&nbsp;<span class="op" id="4161574">&gt;&gt;</span>&nbsp;<span class="builtintype" id="4161577">uint</span><span class="op" id="4161581">(</span><span class="num" id="4161582">8</span><span class="op" id="4161583">*</span><span class="ident" id="4161584">emLen</span><span class="op" id="4161589">-</span><span class="ident" id="4161590">emBits</span><span class="op" id="4161596">)</span><span class="op" id="4161597">)</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4161601">//&nbsp;12.&nbsp;Let&nbsp;EM&nbsp;=&nbsp;maskedDB&nbsp;||&nbsp;H&nbsp;||&nbsp;0xbc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4161641">em</span><span class="op" id="4161643">[</span><span class="ident" id="4161644">emLen</span><span class="op" id="4161649">-</span><span class="num" id="4161650">1</span><span class="op" id="4161651">]</span>&nbsp;<span class="op" id="4161653">=</span>&nbsp;<span class="num" id="4161655">0xBC</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4161662">//&nbsp;13.&nbsp;Output&nbsp;EM.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4161681">return</span>&nbsp;<span class="ident" id="4161688">em</span><span class="op" id="4161690">,</span>&nbsp;<span class="ident" id="4161692">nil</span><br>
<span class="lineno"></span><span class="op" id="4161696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4161699">func</span>&nbsp;<span class="ident" id="4161704">emsaPSSVerify</span><span class="op" id="4161717">(</span><span class="ident" id="4161718">mHash</span><span class="op" id="4161723">,</span>&nbsp;<span class="ident" id="4161725">em</span>&nbsp;<span class="op" id="4161728">[</span><span class="op" id="4161729">]</span><span class="builtintype" id="4161730">byte</span><span class="op" id="4161734">,</span>&nbsp;<span class="ident" id="4161736">emBits</span><span class="op" id="4161742">,</span>&nbsp;<span class="ident" id="4161744">sLen</span>&nbsp;<span class="builtintype" id="4161749">int</span><span class="op" id="4161752">,</span>&nbsp;<span class="ident" id="4161754">hash</span>&nbsp;<span class="ident" id="4161759">hash</span><span class="op" id="4161763">.</span><span class="ident" id="4161764">Hash</span><span class="op" id="4161768">)</span>&nbsp;<span class="builtintype" id="4161770">error</span>&nbsp;<span class="op" id="4161776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4161779">//&nbsp;1.&nbsp;&nbsp;If&nbsp;the&nbsp;length&nbsp;of&nbsp;M&nbsp;is&nbsp;greater&nbsp;than&nbsp;the&nbsp;input&nbsp;limitation&nbsp;for&nbsp;the</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4161851">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hash&nbsp;function&nbsp;(2^61&nbsp;-&nbsp;1&nbsp;octets&nbsp;for&nbsp;SHA-1),&nbsp;output&nbsp;&#34;inconsistent&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4161924">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4161942">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4161946">//&nbsp;2.&nbsp;&nbsp;Let&nbsp;mHash&nbsp;=&nbsp;Hash(M),&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;hLen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4162007">hLen</span>&nbsp;<span class="op" id="4162012">:=</span>&nbsp;<span class="ident" id="4162015">hash</span><span class="op" id="4162019">.</span><span class="ident" id="4162020">Size</span><span class="op" id="4162024">(</span><span class="op" id="4162025">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4162028">if</span>&nbsp;<span class="ident" id="4162031">hLen</span>&nbsp;<span class="op" id="4162036">!=</span>&nbsp;<span class="builtinfunc" id="4162039">len</span><span class="op" id="4162042">(</span><span class="ident" id="4162043">mHash</span><span class="op" id="4162048">)</span>&nbsp;<span class="op" id="4162050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4162054">return</span>&nbsp;<span class="ident" id="4162061">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4162078">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4162082">//&nbsp;3.&nbsp;&nbsp;If&nbsp;emLen&nbsp;&lt;&nbsp;hLen&nbsp;+&nbsp;sLen&nbsp;+&nbsp;2,&nbsp;output&nbsp;&#34;inconsistent&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4162150">emLen</span>&nbsp;<span class="op" id="4162156">:=</span>&nbsp;<span class="op" id="4162159">(</span><span class="ident" id="4162160">emBits</span>&nbsp;<span class="op" id="4162167">+</span>&nbsp;<span class="num" id="4162169">7</span><span class="op" id="4162170">)</span>&nbsp;<span class="op" id="4162172">/</span>&nbsp;<span class="num" id="4162174">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4162177">if</span>&nbsp;<span class="ident" id="4162180">emLen</span>&nbsp;<span class="op" id="4162186">&lt;</span>&nbsp;<span class="ident" id="4162188">hLen</span><span class="op" id="4162192">+</span><span class="ident" id="4162193">sLen</span><span class="op" id="4162197">+</span><span class="num" id="4162198">2</span>&nbsp;<span class="op" id="4162200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4162204">return</span>&nbsp;<span class="ident" id="4162211">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4162228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4162232">//&nbsp;4.&nbsp;&nbsp;If&nbsp;the&nbsp;rightmost&nbsp;octet&nbsp;of&nbsp;EM&nbsp;does&nbsp;not&nbsp;have&nbsp;hexadecimal&nbsp;value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4162301">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbc,&nbsp;output&nbsp;&#34;inconsistent&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4162347">if</span>&nbsp;<span class="ident" id="4162350">em</span><span class="op" id="4162352">[</span><span class="builtinfunc" id="4162353">len</span><span class="op" id="4162356">(</span><span class="ident" id="4162357">em</span><span class="op" id="4162359">)</span><span class="op" id="4162360">-</span><span class="num" id="4162361">1</span><span class="op" id="4162362">]</span>&nbsp;<span class="op" id="4162364">!=</span>&nbsp;<span class="num" id="4162367">0xBC</span>&nbsp;<span class="op" id="4162372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4162376">return</span>&nbsp;<span class="ident" id="4162383">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4162400">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4162404">//&nbsp;5.&nbsp;&nbsp;Let&nbsp;maskedDB&nbsp;be&nbsp;the&nbsp;leftmost&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;1&nbsp;octets&nbsp;of&nbsp;EM,&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4162476">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;H&nbsp;be&nbsp;the&nbsp;next&nbsp;hLen&nbsp;octets.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4162515">db</span>&nbsp;<span class="op" id="4162518">:=</span>&nbsp;<span class="ident" id="4162521">em</span><span class="op" id="4162523">[</span><span class="op" id="4162524">:</span><span class="ident" id="4162525">emLen</span><span class="op" id="4162530">-</span><span class="ident" id="4162531">hLen</span><span class="op" id="4162535">-</span><span class="num" id="4162536">1</span><span class="op" id="4162537">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4162540">h</span>&nbsp;<span class="op" id="4162542">:=</span>&nbsp;<span class="ident" id="4162545">em</span><span class="op" id="4162547">[</span><span class="ident" id="4162548">emLen</span><span class="op" id="4162553">-</span><span class="ident" id="4162554">hLen</span><span class="op" id="4162558">-</span><span class="num" id="4162559">1</span>&nbsp;<span class="op" id="4162561">:</span>&nbsp;<span class="builtinfunc" id="4162563">len</span><span class="op" id="4162566">(</span><span class="ident" id="4162567">em</span><span class="op" id="4162569">)</span><span class="op" id="4162570">-</span><span class="num" id="4162571">1</span><span class="op" id="4162572">]</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4162576">//&nbsp;6.&nbsp;&nbsp;If&nbsp;the&nbsp;leftmost&nbsp;8&nbsp;*&nbsp;emLen&nbsp;-&nbsp;emBits&nbsp;bits&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;octet&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4162649">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maskedDB&nbsp;are&nbsp;not&nbsp;all&nbsp;equal&nbsp;to&nbsp;zero,&nbsp;output&nbsp;&#34;inconsistent&#34;&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4162719">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4162733">if</span>&nbsp;<span class="ident" id="4162736">em</span><span class="op" id="4162738">[</span><span class="num" id="4162739">0</span><span class="op" id="4162740">]</span><span class="op" id="4162741">&amp;</span><span class="op" id="4162742">(</span><span class="num" id="4162743">0xFF</span><span class="op" id="4162747">&lt;&lt;</span><span class="builtintype" id="4162749">uint</span><span class="op" id="4162753">(</span><span class="num" id="4162754">8</span><span class="op" id="4162755">-</span><span class="op" id="4162756">(</span><span class="num" id="4162757">8</span><span class="op" id="4162758">*</span><span class="ident" id="4162759">emLen</span><span class="op" id="4162764">-</span><span class="ident" id="4162765">emBits</span><span class="op" id="4162771">)</span><span class="op" id="4162772">)</span><span class="op" id="4162773">)</span>&nbsp;<span class="op" id="4162775">!=</span>&nbsp;<span class="num" id="4162778">0</span>&nbsp;<span class="op" id="4162780">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4162784">return</span>&nbsp;<span class="ident" id="4162791">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4162808">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4162812">//&nbsp;7.&nbsp;&nbsp;Let&nbsp;dbMask&nbsp;=&nbsp;MGF(H,&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4162859">//</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4162863">//&nbsp;8.&nbsp;&nbsp;Let&nbsp;DB&nbsp;=&nbsp;maskedDB&nbsp;\xor&nbsp;dbMask.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4162902">mgf1XOR</span><span class="op" id="4162909">(</span><span class="ident" id="4162910">db</span><span class="op" id="4162912">,</span>&nbsp;<span class="ident" id="4162914">hash</span><span class="op" id="4162918">,</span>&nbsp;<span class="ident" id="4162920">h</span><span class="op" id="4162921">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4162925">//&nbsp;9.&nbsp;&nbsp;Set&nbsp;the&nbsp;leftmost&nbsp;8&nbsp;*&nbsp;emLen&nbsp;-&nbsp;emBits&nbsp;bits&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;octet&nbsp;in&nbsp;DB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4163002">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;zero.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4163019">db</span><span class="op" id="4163021">[</span><span class="num" id="4163022">0</span><span class="op" id="4163023">]</span>&nbsp;<span class="op" id="4163025">&amp;=</span>&nbsp;<span class="op" id="4163028">(</span><span class="num" id="4163029">0xFF</span>&nbsp;<span class="op" id="4163034">&gt;&gt;</span>&nbsp;<span class="builtintype" id="4163037">uint</span><span class="op" id="4163041">(</span><span class="num" id="4163042">8</span><span class="op" id="4163043">*</span><span class="ident" id="4163044">emLen</span><span class="op" id="4163049">-</span><span class="ident" id="4163050">emBits</span><span class="op" id="4163056">)</span><span class="op" id="4163057">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4163061">if</span>&nbsp;<span class="ident" id="4163064">sLen</span>&nbsp;<span class="op" id="4163069">==</span>&nbsp;<span class="ident" id="4163072">PSSSaltLengthAuto</span>&nbsp;<span class="op" id="4163090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4163093">FindSaltLength</span><span class="op" id="4163107">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4163111">for</span>&nbsp;<span class="ident" id="4163115">sLen</span>&nbsp;<span class="op" id="4163120">=</span>&nbsp;<span class="ident" id="4163122">emLen</span>&nbsp;<span class="op" id="4163128">-</span>&nbsp;<span class="op" id="4163130">(</span><span class="ident" id="4163131">hLen</span>&nbsp;<span class="op" id="4163136">+</span>&nbsp;<span class="num" id="4163138">2</span><span class="op" id="4163139">)</span><span class="op" id="4163140">;</span>&nbsp;<span class="ident" id="4163142">sLen</span>&nbsp;<span class="op" id="4163147">&gt;=</span>&nbsp;<span class="num" id="4163150">0</span><span class="op" id="4163151">;</span>&nbsp;<span class="ident" id="4163153">sLen</span><span class="op" id="4163157">--</span>&nbsp;<span class="op" id="4163160">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4163165">switch</span>&nbsp;<span class="ident" id="4163172">db</span><span class="op" id="4163174">[</span><span class="ident" id="4163175">emLen</span><span class="op" id="4163180">-</span><span class="ident" id="4163181">hLen</span><span class="op" id="4163185">-</span><span class="ident" id="4163186">sLen</span><span class="op" id="4163190">-</span><span class="num" id="4163191">2</span><span class="op" id="4163192">]</span>&nbsp;<span class="op" id="4163194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4163199">case</span>&nbsp;<span class="num" id="4163204">1</span><span class="op" id="4163205">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4163211">break</span>&nbsp;<span class="ident" id="4163217">FindSaltLength</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4163235">case</span>&nbsp;<span class="num" id="4163240">0</span><span class="op" id="4163241">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4163247">continue</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4163259">default</span><span class="op" id="4163266">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4163272">return</span>&nbsp;<span class="ident" id="4163279">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4163298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4163302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4163306">if</span>&nbsp;<span class="ident" id="4163309">sLen</span>&nbsp;<span class="op" id="4163314">&lt;</span>&nbsp;<span class="num" id="4163316">0</span>&nbsp;<span class="op" id="4163318">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4163323">return</span>&nbsp;<span class="ident" id="4163330">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4163348">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4163351">}</span>&nbsp;<span class="keyword" id="4163353">else</span>&nbsp;<span class="op" id="4163358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4163362">//&nbsp;10.&nbsp;If&nbsp;the&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;sLen&nbsp;-&nbsp;2&nbsp;leftmost&nbsp;octets&nbsp;of&nbsp;DB&nbsp;are&nbsp;not&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4163437">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;if&nbsp;the&nbsp;octet&nbsp;at&nbsp;position&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;sLen&nbsp;-&nbsp;1&nbsp;(the&nbsp;leftmost</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4163512">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;position&nbsp;is&nbsp;&#34;position&nbsp;1&#34;)&nbsp;does&nbsp;not&nbsp;have&nbsp;hexadecimal&nbsp;value&nbsp;0x01,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4163585">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output&nbsp;&#34;inconsistent&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4163626">for</span>&nbsp;<span class="ident" id="4163630">_</span><span class="op" id="4163631">,</span>&nbsp;<span class="ident" id="4163633">e</span>&nbsp;<span class="op" id="4163635">:=</span>&nbsp;<span class="keyword" id="4163638">range</span>&nbsp;<span class="ident" id="4163644">db</span><span class="op" id="4163646">[</span><span class="op" id="4163647">:</span><span class="ident" id="4163648">emLen</span><span class="op" id="4163653">-</span><span class="ident" id="4163654">hLen</span><span class="op" id="4163658">-</span><span class="ident" id="4163659">sLen</span><span class="op" id="4163663">-</span><span class="num" id="4163664">2</span><span class="op" id="4163665">]</span>&nbsp;<span class="op" id="4163667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4163672">if</span>&nbsp;<span class="ident" id="4163675">e</span>&nbsp;<span class="op" id="4163677">!=</span>&nbsp;<span class="num" id="4163680">0x00</span>&nbsp;<span class="op" id="4163685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4163691">return</span>&nbsp;<span class="ident" id="4163698">ErrVerification</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4163717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4163721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4163725">if</span>&nbsp;<span class="ident" id="4163728">db</span><span class="op" id="4163730">[</span><span class="ident" id="4163731">emLen</span><span class="op" id="4163736">-</span><span class="ident" id="4163737">hLen</span><span class="op" id="4163741">-</span><span class="ident" id="4163742">sLen</span><span class="op" id="4163746">-</span><span class="num" id="4163747">2</span><span class="op" id="4163748">]</span>&nbsp;<span class="op" id="4163750">!=</span>&nbsp;<span class="num" id="4163753">0x01</span>&nbsp;<span class="op" id="4163758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4163763">return</span>&nbsp;<span class="ident" id="4163770">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4163788">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4163791">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4163795">//&nbsp;11.&nbsp;&nbsp;Let&nbsp;salt&nbsp;be&nbsp;the&nbsp;last&nbsp;sLen&nbsp;octets&nbsp;of&nbsp;DB.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4163844">salt</span>&nbsp;<span class="op" id="4163849">:=</span>&nbsp;<span class="ident" id="4163852">db</span><span class="op" id="4163854">[</span><span class="builtinfunc" id="4163855">len</span><span class="op" id="4163858">(</span><span class="ident" id="4163859">db</span><span class="op" id="4163861">)</span><span class="op" id="4163862">-</span><span class="ident" id="4163863">sLen</span><span class="op" id="4163867">:</span><span class="op" id="4163868">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4163872">//&nbsp;12.&nbsp;&nbsp;Let</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4163885">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&#39;&nbsp;=&nbsp;(0x)00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;||&nbsp;mHash&nbsp;||&nbsp;salt&nbsp;;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4163950">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&#39;&nbsp;is&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;8&nbsp;+&nbsp;hLen&nbsp;+&nbsp;sLen&nbsp;with&nbsp;eight</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4164017">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initial&nbsp;zero&nbsp;octets.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4164046">//</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4164050">//&nbsp;13.&nbsp;Let&nbsp;H&#39;&nbsp;=&nbsp;Hash(M&#39;),&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;hLen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4164109">var</span>&nbsp;<span class="ident" id="4164113">prefix</span>&nbsp;<span class="op" id="4164120">[</span><span class="num" id="4164121">8</span><span class="op" id="4164122">]</span><span class="builtintype" id="4164123">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4164129">hash</span><span class="op" id="4164133">.</span><span class="ident" id="4164134">Write</span><span class="op" id="4164139">(</span><span class="ident" id="4164140">prefix</span><span class="op" id="4164146">[</span><span class="op" id="4164147">:</span><span class="op" id="4164148">]</span><span class="op" id="4164149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4164152">hash</span><span class="op" id="4164156">.</span><span class="ident" id="4164157">Write</span><span class="op" id="4164162">(</span><span class="ident" id="4164163">mHash</span><span class="op" id="4164168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4164171">hash</span><span class="op" id="4164175">.</span><span class="ident" id="4164176">Write</span><span class="op" id="4164181">(</span><span class="ident" id="4164182">salt</span><span class="op" id="4164186">)</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4164190">h0</span>&nbsp;<span class="op" id="4164193">:=</span>&nbsp;<span class="ident" id="4164196">hash</span><span class="op" id="4164200">.</span><span class="ident" id="4164201">Sum</span><span class="op" id="4164204">(</span><span class="ident" id="4164205">nil</span><span class="op" id="4164208">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4164212">//&nbsp;14.&nbsp;If&nbsp;H&nbsp;=&nbsp;H&#39;,&nbsp;output&nbsp;&#34;consistent.&#34;&nbsp;Otherwise,&nbsp;output&nbsp;&#34;inconsistent.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4164286">if</span>&nbsp;<span class="op" id="4164289">!</span><span class="ident" id="4164290">bytes</span><span class="op" id="4164295">.</span><span class="ident" id="4164296">Equal</span><span class="op" id="4164301">(</span><span class="ident" id="4164302">h0</span><span class="op" id="4164304">,</span>&nbsp;<span class="ident" id="4164306">h</span><span class="op" id="4164307">)</span>&nbsp;<span class="op" id="4164309">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4164313">return</span>&nbsp;<span class="ident" id="4164320">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4164337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4164340">return</span>&nbsp;<span class="ident" id="4164347">nil</span><br>
<span class="lineno"></span><span class="op" id="4164351">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="4164354">//&nbsp;signPSSWithSalt&nbsp;calculates&nbsp;the&nbsp;signature&nbsp;of&nbsp;hashed&nbsp;using&nbsp;PSS&nbsp;[1]&nbsp;with&nbsp;specified&nbsp;salt.</span><br>
<span class="lineno"></span><span class="comment" id="4164443">//&nbsp;Note&nbsp;that&nbsp;hashed&nbsp;must&nbsp;be&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;the&nbsp;input&nbsp;message&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4164521">//&nbsp;given&nbsp;hash&nbsp;function.&nbsp;salt&nbsp;is&nbsp;a&nbsp;random&nbsp;sequence&nbsp;of&nbsp;bytes&nbsp;whose&nbsp;length&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="4164601">//&nbsp;later&nbsp;used&nbsp;to&nbsp;verify&nbsp;the&nbsp;signature.</span><br>
<span class="lineno"></span><span class="keyword" id="4164640">func</span>&nbsp;<span class="ident" id="4164645">signPSSWithSalt</span><span class="op" id="4164660">(</span><span class="ident" id="4164661">rand</span>&nbsp;<span class="ident" id="4164666">io</span><span class="op" id="4164668">.</span><span class="ident" id="4164669">Reader</span><span class="op" id="4164675">,</span>&nbsp;<span class="ident" id="4164677">priv</span>&nbsp;<span class="op" id="4164682">*</span><span class="ident" id="4164683">PrivateKey</span><span class="op" id="4164693">,</span>&nbsp;<span class="ident" id="4164695">hash</span>&nbsp;<span class="ident" id="4164700">crypto</span><span class="op" id="4164706">.</span><span class="ident" id="4164707">Hash</span><span class="op" id="4164711">,</span>&nbsp;<span class="ident" id="4164713">hashed</span><span class="op" id="4164719">,</span>&nbsp;<span class="ident" id="4164721">salt</span>&nbsp;<span class="op" id="4164726">[</span><span class="op" id="4164727">]</span><span class="builtintype" id="4164728">byte</span><span class="op" id="4164732">)</span>&nbsp;<span class="op" id="4164734">(</span><span class="ident" id="4164735">s</span>&nbsp;<span class="op" id="4164737">[</span><span class="op" id="4164738">]</span><span class="builtintype" id="4164739">byte</span><span class="op" id="4164743">,</span>&nbsp;<span class="ident" id="4164745">err</span>&nbsp;<span class="builtintype" id="4164749">error</span><span class="op" id="4164754">)</span>&nbsp;<span class="op" id="4164756">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4164759">nBits</span>&nbsp;<span class="op" id="4164765">:=</span>&nbsp;<span class="ident" id="4164768">priv</span><span class="op" id="4164772">.</span><span class="ident" id="4164773">N</span><span class="op" id="4164774">.</span><span class="ident" id="4164775">BitLen</span><span class="op" id="4164781">(</span><span class="op" id="4164782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4164785">em</span><span class="op" id="4164787">,</span>&nbsp;<span class="ident" id="4164789">err</span>&nbsp;<span class="op" id="4164793">:=</span>&nbsp;<span class="ident" id="4164796">emsaPSSEncode</span><span class="op" id="4164809">(</span><span class="ident" id="4164810">hashed</span><span class="op" id="4164816">,</span>&nbsp;<span class="ident" id="4164818">nBits</span><span class="op" id="4164823">-</span><span class="num" id="4164824">1</span><span class="op" id="4164825">,</span>&nbsp;<span class="ident" id="4164827">salt</span><span class="op" id="4164831">,</span>&nbsp;<span class="ident" id="4164833">hash</span><span class="op" id="4164837">.</span><span class="ident" id="4164838">New</span><span class="op" id="4164841">(</span><span class="op" id="4164842">)</span><span class="op" id="4164843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4164846">if</span>&nbsp;<span class="ident" id="4164849">err</span>&nbsp;<span class="op" id="4164853">!=</span>&nbsp;<span class="ident" id="4164856">nil</span>&nbsp;<span class="op" id="4164860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4164864">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4164872">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4164875">m</span>&nbsp;<span class="op" id="4164877">:=</span>&nbsp;<span class="builtinfunc" id="4164880">new</span><span class="op" id="4164883">(</span><span class="ident" id="4164884">big</span><span class="op" id="4164887">.</span><span class="ident" id="4164888">Int</span><span class="op" id="4164891">)</span><span class="op" id="4164892">.</span><span class="ident" id="4164893">SetBytes</span><span class="op" id="4164901">(</span><span class="ident" id="4164902">em</span><span class="op" id="4164904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4164907">c</span><span class="op" id="4164908">,</span>&nbsp;<span class="ident" id="4164910">err</span>&nbsp;<span class="op" id="4164914">:=</span>&nbsp;<span class="ident" id="4164917">decrypt</span><span class="op" id="4164924">(</span><span class="ident" id="4164925">rand</span><span class="op" id="4164929">,</span>&nbsp;<span class="ident" id="4164931">priv</span><span class="op" id="4164935">,</span>&nbsp;<span class="ident" id="4164937">m</span><span class="op" id="4164938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4164941">if</span>&nbsp;<span class="ident" id="4164944">err</span>&nbsp;<span class="op" id="4164948">!=</span>&nbsp;<span class="ident" id="4164951">nil</span>&nbsp;<span class="op" id="4164955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4164959">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4164967">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4164970">s</span>&nbsp;<span class="op" id="4164972">=</span>&nbsp;<span class="builtinfunc" id="4164974">make</span><span class="op" id="4164978">(</span><span class="op" id="4164979">[</span><span class="op" id="4164980">]</span><span class="builtintype" id="4164981">byte</span><span class="op" id="4164985">,</span>&nbsp;<span class="op" id="4164987">(</span><span class="ident" id="4164988">nBits</span><span class="op" id="4164993">+</span><span class="num" id="4164994">7</span><span class="op" id="4164995">)</span><span class="op" id="4164996">/</span><span class="num" id="4164997">8</span><span class="op" id="4164998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4165001">copyWithLeftPad</span><span class="op" id="4165016">(</span><span class="ident" id="4165017">s</span><span class="op" id="4165018">,</span>&nbsp;<span class="ident" id="4165020">c</span><span class="op" id="4165021">.</span><span class="ident" id="4165022">Bytes</span><span class="op" id="4165027">(</span><span class="op" id="4165028">)</span><span class="op" id="4165029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4165032">return</span><br>
<span class="lineno"></span><span class="op" id="4165039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="4165042">const</span>&nbsp;<span class="op" id="4165048">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4165051">//&nbsp;PSSSaltLengthAuto&nbsp;causes&nbsp;the&nbsp;salt&nbsp;in&nbsp;a&nbsp;PSS&nbsp;signature&nbsp;to&nbsp;be&nbsp;as&nbsp;large</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4165123">//&nbsp;as&nbsp;possible&nbsp;when&nbsp;signing,&nbsp;and&nbsp;to&nbsp;be&nbsp;auto-detected&nbsp;when&nbsp;verifying.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4165193">PSSSaltLengthAuto</span>&nbsp;<span class="op" id="4165211">=</span>&nbsp;<span class="num" id="4165213">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4165216">//&nbsp;PSSSaltLengthEqualsHash&nbsp;causes&nbsp;the&nbsp;salt&nbsp;length&nbsp;to&nbsp;equal&nbsp;the&nbsp;length</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4165287">//&nbsp;of&nbsp;the&nbsp;hash&nbsp;used&nbsp;in&nbsp;the&nbsp;signature.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4165326">PSSSaltLengthEqualsHash</span>&nbsp;<span class="op" id="4165350">=</span>&nbsp;<span class="op" id="4165352">-</span><span class="num" id="4165353">1</span><br>
<span class="lineno"></span><span class="op" id="4165355">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4165358">//&nbsp;PSSOptions&nbsp;contains&nbsp;options&nbsp;for&nbsp;creating&nbsp;and&nbsp;verifying&nbsp;PSS&nbsp;signatures.</span><br>
<span class="lineno">220</span><span class="keyword" id="4165432">type</span>&nbsp;<span class="ident" id="4165437">PSSOptions</span>&nbsp;<span class="keyword" id="4165448">struct</span>&nbsp;<span class="op" id="4165455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4165458">//&nbsp;SaltLength&nbsp;controls&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;salt&nbsp;used&nbsp;in&nbsp;the&nbsp;PSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4165521">//&nbsp;signature.&nbsp;It&nbsp;can&nbsp;either&nbsp;be&nbsp;a&nbsp;number&nbsp;of&nbsp;bytes,&nbsp;or&nbsp;one&nbsp;of&nbsp;the&nbsp;special</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4165594">//&nbsp;PSSSaltLength&nbsp;constants.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4165623">SaltLength</span>&nbsp;<span class="builtintype" id="4165634">int</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4165640">//&nbsp;Hash,&nbsp;if&nbsp;not&nbsp;zero,&nbsp;overrides&nbsp;the&nbsp;hash&nbsp;function&nbsp;passed&nbsp;to&nbsp;SignPSS.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4165710">//&nbsp;This&nbsp;is&nbsp;the&nbsp;only&nbsp;way&nbsp;to&nbsp;specify&nbsp;the&nbsp;hash&nbsp;function&nbsp;when&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4165779">//&nbsp;crypto.Signer&nbsp;interface.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4165808">Hash</span>&nbsp;<span class="ident" id="4165813">crypto</span><span class="op" id="4165819">.</span><span class="ident" id="4165820">Hash</span><br>
<span class="lineno">230</span><span class="op" id="4165825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4165828">//&nbsp;HashFunc&nbsp;returns&nbsp;pssOpts.Hash&nbsp;so&nbsp;that&nbsp;PSSOptions&nbsp;implements</span><br>
<span class="lineno"></span><span class="comment" id="4165891">//&nbsp;crypto.SignerOpts.</span><br>
<span class="lineno"></span><span class="keyword" id="4165913">func</span>&nbsp;<span class="op" id="4165918">(</span><span class="ident" id="4165919">pssOpts</span>&nbsp;<span class="op" id="4165927">*</span><span class="ident" id="4165928">PSSOptions</span><span class="op" id="4165938">)</span>&nbsp;<span class="ident" id="4165940">HashFunc</span><span class="op" id="4165948">(</span><span class="op" id="4165949">)</span>&nbsp;<span class="ident" id="4165951">crypto</span><span class="op" id="4165957">.</span><span class="ident" id="4165958">Hash</span>&nbsp;<span class="op" id="4165963">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4165966">return</span>&nbsp;<span class="ident" id="4165973">pssOpts</span><span class="op" id="4165980">.</span><span class="ident" id="4165981">Hash</span><br>
<span class="lineno"></span><span class="op" id="4165986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4165989">func</span>&nbsp;<span class="op" id="4165994">(</span><span class="ident" id="4165995">opts</span>&nbsp;<span class="op" id="4166000">*</span><span class="ident" id="4166001">PSSOptions</span><span class="op" id="4166011">)</span>&nbsp;<span class="ident" id="4166013">saltLength</span><span class="op" id="4166023">(</span><span class="op" id="4166024">)</span>&nbsp;<span class="builtintype" id="4166026">int</span>&nbsp;<span class="op" id="4166030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4166033">if</span>&nbsp;<span class="ident" id="4166036">opts</span>&nbsp;<span class="op" id="4166041">==</span>&nbsp;<span class="ident" id="4166044">nil</span>&nbsp;<span class="op" id="4166048">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4166052">return</span>&nbsp;<span class="ident" id="4166059">PSSSaltLengthAuto</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4166078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4166081">return</span>&nbsp;<span class="ident" id="4166088">opts</span><span class="op" id="4166092">.</span><span class="ident" id="4166093">SaltLength</span><br>
<span class="lineno"></span><span class="op" id="4166104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="comment" id="4166107">//&nbsp;SignPSS&nbsp;calculates&nbsp;the&nbsp;signature&nbsp;of&nbsp;hashed&nbsp;using&nbsp;RSASSA-PSS&nbsp;[1].</span><br>
<span class="lineno"></span><span class="comment" id="4166175">//&nbsp;Note&nbsp;that&nbsp;hashed&nbsp;must&nbsp;be&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;the&nbsp;input&nbsp;message&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4166253">//&nbsp;given&nbsp;hash&nbsp;function.&nbsp;The&nbsp;opts&nbsp;argument&nbsp;may&nbsp;be&nbsp;nil,&nbsp;in&nbsp;which&nbsp;case&nbsp;sensible</span><br>
<span class="lineno"></span><span class="comment" id="4166330">//&nbsp;defaults&nbsp;are&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="4166352">func</span>&nbsp;<span class="ident" id="4166357">SignPSS</span><span class="op" id="4166364">(</span><span class="ident" id="4166365">rand</span>&nbsp;<span class="ident" id="4166370">io</span><span class="op" id="4166372">.</span><span class="ident" id="4166373">Reader</span><span class="op" id="4166379">,</span>&nbsp;<span class="ident" id="4166381">priv</span>&nbsp;<span class="op" id="4166386">*</span><span class="ident" id="4166387">PrivateKey</span><span class="op" id="4166397">,</span>&nbsp;<span class="ident" id="4166399">hash</span>&nbsp;<span class="ident" id="4166404">crypto</span><span class="op" id="4166410">.</span><span class="ident" id="4166411">Hash</span><span class="op" id="4166415">,</span>&nbsp;<span class="ident" id="4166417">hashed</span>&nbsp;<span class="op" id="4166424">[</span><span class="op" id="4166425">]</span><span class="builtintype" id="4166426">byte</span><span class="op" id="4166430">,</span>&nbsp;<span class="ident" id="4166432">opts</span>&nbsp;<span class="op" id="4166437">*</span><span class="ident" id="4166438">PSSOptions</span><span class="op" id="4166448">)</span>&nbsp;<span class="op" id="4166450">(</span><span class="ident" id="4166451">s</span>&nbsp;<span class="op" id="4166453">[</span><span class="op" id="4166454">]</span><span class="builtintype" id="4166455">byte</span><span class="op" id="4166459">,</span>&nbsp;<span class="ident" id="4166461">err</span>&nbsp;<span class="builtintype" id="4166465">error</span><span class="op" id="4166470">)</span>&nbsp;<span class="op" id="4166472">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4166475">saltLength</span>&nbsp;<span class="op" id="4166486">:=</span>&nbsp;<span class="ident" id="4166489">opts</span><span class="op" id="4166493">.</span><span class="ident" id="4166494">saltLength</span><span class="op" id="4166504">(</span><span class="op" id="4166505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4166508">switch</span>&nbsp;<span class="ident" id="4166515">saltLength</span>&nbsp;<span class="op" id="4166526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4166529">case</span>&nbsp;<span class="ident" id="4166534">PSSSaltLengthAuto</span><span class="op" id="4166551">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4166555">saltLength</span>&nbsp;<span class="op" id="4166566">=</span>&nbsp;<span class="op" id="4166568">(</span><span class="ident" id="4166569">priv</span><span class="op" id="4166573">.</span><span class="ident" id="4166574">N</span><span class="op" id="4166575">.</span><span class="ident" id="4166576">BitLen</span><span class="op" id="4166582">(</span><span class="op" id="4166583">)</span><span class="op" id="4166584">+</span><span class="num" id="4166585">7</span><span class="op" id="4166586">)</span><span class="op" id="4166587">/</span><span class="num" id="4166588">8</span>&nbsp;<span class="op" id="4166590">-</span>&nbsp;<span class="num" id="4166592">2</span>&nbsp;<span class="op" id="4166594">-</span>&nbsp;<span class="ident" id="4166596">hash</span><span class="op" id="4166600">.</span><span class="ident" id="4166601">Size</span><span class="op" id="4166605">(</span><span class="op" id="4166606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4166609">case</span>&nbsp;<span class="ident" id="4166614">PSSSaltLengthEqualsHash</span><span class="op" id="4166637">:</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4166641">saltLength</span>&nbsp;<span class="op" id="4166652">=</span>&nbsp;<span class="ident" id="4166654">hash</span><span class="op" id="4166658">.</span><span class="ident" id="4166659">Size</span><span class="op" id="4166663">(</span><span class="op" id="4166664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4166667">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4166671">if</span>&nbsp;<span class="ident" id="4166674">opts</span><span class="op" id="4166678">.</span><span class="ident" id="4166679">Hash</span>&nbsp;<span class="op" id="4166684">!=</span>&nbsp;<span class="num" id="4166687">0</span>&nbsp;<span class="op" id="4166689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4166693">hash</span>&nbsp;<span class="op" id="4166698">=</span>&nbsp;<span class="ident" id="4166700">opts</span><span class="op" id="4166704">.</span><span class="ident" id="4166705">Hash</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4166711">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4166715">salt</span>&nbsp;<span class="op" id="4166720">:=</span>&nbsp;<span class="builtinfunc" id="4166723">make</span><span class="op" id="4166727">(</span><span class="op" id="4166728">[</span><span class="op" id="4166729">]</span><span class="builtintype" id="4166730">byte</span><span class="op" id="4166734">,</span>&nbsp;<span class="ident" id="4166736">saltLength</span><span class="op" id="4166746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4166749">if</span>&nbsp;<span class="ident" id="4166752">_</span><span class="op" id="4166753">,</span>&nbsp;<span class="ident" id="4166755">err</span>&nbsp;<span class="op" id="4166759">=</span>&nbsp;<span class="ident" id="4166761">io</span><span class="op" id="4166763">.</span><span class="ident" id="4166764">ReadFull</span><span class="op" id="4166772">(</span><span class="ident" id="4166773">rand</span><span class="op" id="4166777">,</span>&nbsp;<span class="ident" id="4166779">salt</span><span class="op" id="4166783">)</span><span class="op" id="4166784">;</span>&nbsp;<span class="ident" id="4166786">err</span>&nbsp;<span class="op" id="4166790">!=</span>&nbsp;<span class="ident" id="4166793">nil</span>&nbsp;<span class="op" id="4166797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4166801">return</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4166809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4166812">return</span>&nbsp;<span class="ident" id="4166819">signPSSWithSalt</span><span class="op" id="4166834">(</span><span class="ident" id="4166835">rand</span><span class="op" id="4166839">,</span>&nbsp;<span class="ident" id="4166841">priv</span><span class="op" id="4166845">,</span>&nbsp;<span class="ident" id="4166847">hash</span><span class="op" id="4166851">,</span>&nbsp;<span class="ident" id="4166853">hashed</span><span class="op" id="4166859">,</span>&nbsp;<span class="ident" id="4166861">salt</span><span class="op" id="4166865">)</span><br>
<span class="lineno"></span><span class="op" id="4166867">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4166870">//&nbsp;VerifyPSS&nbsp;verifies&nbsp;a&nbsp;PSS&nbsp;signature.</span><br>
<span class="lineno">270</span><span class="comment" id="4166909">//&nbsp;hashed&nbsp;is&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;the&nbsp;input&nbsp;message&nbsp;using&nbsp;the&nbsp;given&nbsp;hash</span><br>
<span class="lineno"></span><span class="comment" id="4166983">//&nbsp;function&nbsp;and&nbsp;sig&nbsp;is&nbsp;the&nbsp;signature.&nbsp;A&nbsp;valid&nbsp;signature&nbsp;is&nbsp;indicated&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="4167055">//&nbsp;returning&nbsp;a&nbsp;nil&nbsp;error.&nbsp;The&nbsp;opts&nbsp;argument&nbsp;may&nbsp;be&nbsp;nil,&nbsp;in&nbsp;which&nbsp;case&nbsp;sensible</span><br>
<span class="lineno"></span><span class="comment" id="4167134">//&nbsp;defaults&nbsp;are&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="4167156">func</span>&nbsp;<span class="ident" id="4167161">VerifyPSS</span><span class="op" id="4167170">(</span><span class="ident" id="4167171">pub</span>&nbsp;<span class="op" id="4167175">*</span><span class="ident" id="4167176">PublicKey</span><span class="op" id="4167185">,</span>&nbsp;<span class="ident" id="4167187">hash</span>&nbsp;<span class="ident" id="4167192">crypto</span><span class="op" id="4167198">.</span><span class="ident" id="4167199">Hash</span><span class="op" id="4167203">,</span>&nbsp;<span class="ident" id="4167205">hashed</span>&nbsp;<span class="op" id="4167212">[</span><span class="op" id="4167213">]</span><span class="builtintype" id="4167214">byte</span><span class="op" id="4167218">,</span>&nbsp;<span class="ident" id="4167220">sig</span>&nbsp;<span class="op" id="4167224">[</span><span class="op" id="4167225">]</span><span class="builtintype" id="4167226">byte</span><span class="op" id="4167230">,</span>&nbsp;<span class="ident" id="4167232">opts</span>&nbsp;<span class="op" id="4167237">*</span><span class="ident" id="4167238">PSSOptions</span><span class="op" id="4167248">)</span>&nbsp;<span class="builtintype" id="4167250">error</span>&nbsp;<span class="op" id="4167256">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4167259">return</span>&nbsp;<span class="ident" id="4167266">verifyPSS</span><span class="op" id="4167275">(</span><span class="ident" id="4167276">pub</span><span class="op" id="4167279">,</span>&nbsp;<span class="ident" id="4167281">hash</span><span class="op" id="4167285">,</span>&nbsp;<span class="ident" id="4167287">hashed</span><span class="op" id="4167293">,</span>&nbsp;<span class="ident" id="4167295">sig</span><span class="op" id="4167298">,</span>&nbsp;<span class="ident" id="4167300">opts</span><span class="op" id="4167304">.</span><span class="ident" id="4167305">saltLength</span><span class="op" id="4167315">(</span><span class="op" id="4167316">)</span><span class="op" id="4167317">)</span><br>
<span class="lineno"></span><span class="op" id="4167319">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4167322">//&nbsp;verifyPSS&nbsp;verifies&nbsp;a&nbsp;PSS&nbsp;signature&nbsp;with&nbsp;the&nbsp;given&nbsp;salt&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="4167388">func</span>&nbsp;<span class="ident" id="4167393">verifyPSS</span><span class="op" id="4167402">(</span><span class="ident" id="4167403">pub</span>&nbsp;<span class="op" id="4167407">*</span><span class="ident" id="4167408">PublicKey</span><span class="op" id="4167417">,</span>&nbsp;<span class="ident" id="4167419">hash</span>&nbsp;<span class="ident" id="4167424">crypto</span><span class="op" id="4167430">.</span><span class="ident" id="4167431">Hash</span><span class="op" id="4167435">,</span>&nbsp;<span class="ident" id="4167437">hashed</span>&nbsp;<span class="op" id="4167444">[</span><span class="op" id="4167445">]</span><span class="builtintype" id="4167446">byte</span><span class="op" id="4167450">,</span>&nbsp;<span class="ident" id="4167452">sig</span>&nbsp;<span class="op" id="4167456">[</span><span class="op" id="4167457">]</span><span class="builtintype" id="4167458">byte</span><span class="op" id="4167462">,</span>&nbsp;<span class="ident" id="4167464">saltLen</span>&nbsp;<span class="builtintype" id="4167472">int</span><span class="op" id="4167475">)</span>&nbsp;<span class="builtintype" id="4167477">error</span>&nbsp;<span class="op" id="4167483">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4167486">nBits</span>&nbsp;<span class="op" id="4167492">:=</span>&nbsp;<span class="ident" id="4167495">pub</span><span class="op" id="4167498">.</span><span class="ident" id="4167499">N</span><span class="op" id="4167500">.</span><span class="ident" id="4167501">BitLen</span><span class="op" id="4167507">(</span><span class="op" id="4167508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4167511">if</span>&nbsp;<span class="builtinfunc" id="4167514">len</span><span class="op" id="4167517">(</span><span class="ident" id="4167518">sig</span><span class="op" id="4167521">)</span>&nbsp;<span class="op" id="4167523">!=</span>&nbsp;<span class="op" id="4167526">(</span><span class="ident" id="4167527">nBits</span><span class="op" id="4167532">+</span><span class="num" id="4167533">7</span><span class="op" id="4167534">)</span><span class="op" id="4167535">/</span><span class="num" id="4167536">8</span>&nbsp;<span class="op" id="4167538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4167542">return</span>&nbsp;<span class="ident" id="4167549">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4167566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4167569">s</span>&nbsp;<span class="op" id="4167571">:=</span>&nbsp;<span class="builtinfunc" id="4167574">new</span><span class="op" id="4167577">(</span><span class="ident" id="4167578">big</span><span class="op" id="4167581">.</span><span class="ident" id="4167582">Int</span><span class="op" id="4167585">)</span><span class="op" id="4167586">.</span><span class="ident" id="4167587">SetBytes</span><span class="op" id="4167595">(</span><span class="ident" id="4167596">sig</span><span class="op" id="4167599">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4167602">m</span>&nbsp;<span class="op" id="4167604">:=</span>&nbsp;<span class="ident" id="4167607">encrypt</span><span class="op" id="4167614">(</span><span class="builtinfunc" id="4167615">new</span><span class="op" id="4167618">(</span><span class="ident" id="4167619">big</span><span class="op" id="4167622">.</span><span class="ident" id="4167623">Int</span><span class="op" id="4167626">)</span><span class="op" id="4167627">,</span>&nbsp;<span class="ident" id="4167629">pub</span><span class="op" id="4167632">,</span>&nbsp;<span class="ident" id="4167634">s</span><span class="op" id="4167635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4167638">emBits</span>&nbsp;<span class="op" id="4167645">:=</span>&nbsp;<span class="ident" id="4167648">nBits</span>&nbsp;<span class="op" id="4167654">-</span>&nbsp;<span class="num" id="4167656">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4167659">emLen</span>&nbsp;<span class="op" id="4167665">:=</span>&nbsp;<span class="op" id="4167668">(</span><span class="ident" id="4167669">emBits</span>&nbsp;<span class="op" id="4167676">+</span>&nbsp;<span class="num" id="4167678">7</span><span class="op" id="4167679">)</span>&nbsp;<span class="op" id="4167681">/</span>&nbsp;<span class="num" id="4167683">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4167686">if</span>&nbsp;<span class="ident" id="4167689">emLen</span>&nbsp;<span class="op" id="4167695">&lt;</span>&nbsp;<span class="builtinfunc" id="4167697">len</span><span class="op" id="4167700">(</span><span class="ident" id="4167701">m</span><span class="op" id="4167702">.</span><span class="ident" id="4167703">Bytes</span><span class="op" id="4167708">(</span><span class="op" id="4167709">)</span><span class="op" id="4167710">)</span>&nbsp;<span class="op" id="4167712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4167716">return</span>&nbsp;<span class="ident" id="4167723">ErrVerification</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4167740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4167743">em</span>&nbsp;<span class="op" id="4167746">:=</span>&nbsp;<span class="builtinfunc" id="4167749">make</span><span class="op" id="4167753">(</span><span class="op" id="4167754">[</span><span class="op" id="4167755">]</span><span class="builtintype" id="4167756">byte</span><span class="op" id="4167760">,</span>&nbsp;<span class="ident" id="4167762">emLen</span><span class="op" id="4167767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4167770">copyWithLeftPad</span><span class="op" id="4167785">(</span><span class="ident" id="4167786">em</span><span class="op" id="4167788">,</span>&nbsp;<span class="ident" id="4167790">m</span><span class="op" id="4167791">.</span><span class="ident" id="4167792">Bytes</span><span class="op" id="4167797">(</span><span class="op" id="4167798">)</span><span class="op" id="4167799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4167802">if</span>&nbsp;<span class="ident" id="4167805">saltLen</span>&nbsp;<span class="op" id="4167813">==</span>&nbsp;<span class="ident" id="4167816">PSSSaltLengthEqualsHash</span>&nbsp;<span class="op" id="4167840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4167844">saltLen</span>&nbsp;<span class="op" id="4167852">=</span>&nbsp;<span class="ident" id="4167854">hash</span><span class="op" id="4167858">.</span><span class="ident" id="4167859">Size</span><span class="op" id="4167863">(</span><span class="op" id="4167864">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4167867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4167870">return</span>&nbsp;<span class="ident" id="4167877">emsaPSSVerify</span><span class="op" id="4167890">(</span><span class="ident" id="4167891">hashed</span><span class="op" id="4167897">,</span>&nbsp;<span class="ident" id="4167899">em</span><span class="op" id="4167901">,</span>&nbsp;<span class="ident" id="4167903">emBits</span><span class="op" id="4167909">,</span>&nbsp;<span class="ident" id="4167911">saltLen</span><span class="op" id="4167918">,</span>&nbsp;<span class="ident" id="4167920">hash</span><span class="op" id="4167924">.</span><span class="ident" id="4167925">New</span><span class="op" id="4167928">(</span><span class="op" id="4167929">)</span><span class="op" id="4167930">)</span><br>
<span class="lineno"></span><span class="op" id="4167932">}</span>
</div>
</body>
</html>
