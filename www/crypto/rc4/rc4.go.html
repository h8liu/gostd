<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4047735">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4047790">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4047844">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4047895">//&nbsp;Package&nbsp;rc4&nbsp;implements&nbsp;RC4&nbsp;encryption,&nbsp;as&nbsp;defined&nbsp;in&nbsp;Bruce&nbsp;Schneier&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4047968">//&nbsp;Applied&nbsp;Cryptography.</span><br>
<span class="lineno"></span><span class="keyword" id="4047993">package</span>&nbsp;<span class="ident" id="4048001">rc4</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4048006">//&nbsp;BUG(agl):&nbsp;RC4&nbsp;is&nbsp;in&nbsp;common&nbsp;use&nbsp;but&nbsp;has&nbsp;design&nbsp;weaknesses&nbsp;that&nbsp;make</span><br>
<span class="lineno">10</span><span class="comment" id="4048076">//&nbsp;it&nbsp;a&nbsp;poor&nbsp;choice&nbsp;for&nbsp;new&nbsp;protocols.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4048116">import</span>&nbsp;<span class="string" id="4048123">&#34;strconv&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4048134">//&nbsp;A&nbsp;Cipher&nbsp;is&nbsp;an&nbsp;instance&nbsp;of&nbsp;RC4&nbsp;using&nbsp;a&nbsp;particular&nbsp;key.</span><br>
<span class="lineno">15</span><span class="keyword" id="4048192">type</span>&nbsp;<span class="ident" id="4048197">Cipher</span>&nbsp;<span class="keyword" id="4048204">struct</span>&nbsp;<span class="op" id="4048211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4048214">s</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4048219">[</span><span class="num" id="4048220">256</span><span class="op" id="4048223">]</span><span class="builtintype" id="4048224">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4048232">i</span><span class="op" id="4048233">,</span>&nbsp;<span class="ident" id="4048235">j</span>&nbsp;<span class="builtintype" id="4048237">uint8</span><br>
<span class="lineno"></span><span class="op" id="4048243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="4048246">type</span>&nbsp;<span class="ident" id="4048251">KeySizeError</span>&nbsp;<span class="builtintype" id="4048264">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4048269">func</span>&nbsp;<span class="op" id="4048274">(</span><span class="ident" id="4048275">k</span>&nbsp;<span class="ident" id="4048277">KeySizeError</span><span class="op" id="4048289">)</span>&nbsp;<span class="ident" id="4048291">Error</span><span class="op" id="4048296">(</span><span class="op" id="4048297">)</span>&nbsp;<span class="builtintype" id="4048299">string</span>&nbsp;<span class="op" id="4048306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4048309">return</span>&nbsp;<span class="string" id="4048316">&#34;crypto/rc4:&nbsp;invalid&nbsp;key&nbsp;size&nbsp;&#34;</span>&nbsp;<span class="op" id="4048348">+</span>&nbsp;<span class="ident" id="4048350">strconv</span><span class="op" id="4048357">.</span><span class="ident" id="4048358">Itoa</span><span class="op" id="4048362">(</span><span class="builtintype" id="4048363">int</span><span class="op" id="4048366">(</span><span class="ident" id="4048367">k</span><span class="op" id="4048368">)</span><span class="op" id="4048369">)</span><br>
<span class="lineno"></span><span class="op" id="4048371">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="4048374">//&nbsp;NewCipher&nbsp;creates&nbsp;and&nbsp;returns&nbsp;a&nbsp;new&nbsp;Cipher.&nbsp;&nbsp;The&nbsp;key&nbsp;argument&nbsp;should&nbsp;be&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4048453">//&nbsp;RC4&nbsp;key,&nbsp;at&nbsp;least&nbsp;1&nbsp;byte&nbsp;and&nbsp;at&nbsp;most&nbsp;256&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="4048504">func</span>&nbsp;<span class="ident" id="4048509">NewCipher</span><span class="op" id="4048518">(</span><span class="ident" id="4048519">key</span>&nbsp;<span class="op" id="4048523">[</span><span class="op" id="4048524">]</span><span class="builtintype" id="4048525">byte</span><span class="op" id="4048529">)</span>&nbsp;<span class="op" id="4048531">(</span><span class="op" id="4048532">*</span><span class="ident" id="4048533">Cipher</span><span class="op" id="4048539">,</span>&nbsp;<span class="builtintype" id="4048541">error</span><span class="op" id="4048546">)</span>&nbsp;<span class="op" id="4048548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4048551">k</span>&nbsp;<span class="op" id="4048553">:=</span>&nbsp;<span class="builtinfunc" id="4048556">len</span><span class="op" id="4048559">(</span><span class="ident" id="4048560">key</span><span class="op" id="4048563">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4048566">if</span>&nbsp;<span class="ident" id="4048569">k</span>&nbsp;<span class="op" id="4048571">&lt;</span>&nbsp;<span class="num" id="4048573">1</span>&nbsp;<span class="op" id="4048575">||</span>&nbsp;<span class="ident" id="4048578">k</span>&nbsp;<span class="op" id="4048580">&gt;</span>&nbsp;<span class="num" id="4048582">256</span>&nbsp;<span class="op" id="4048586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4048590">return</span>&nbsp;<span class="ident" id="4048597">nil</span><span class="op" id="4048600">,</span>&nbsp;<span class="ident" id="4048602">KeySizeError</span><span class="op" id="4048614">(</span><span class="ident" id="4048615">k</span><span class="op" id="4048616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4048619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4048622">var</span>&nbsp;<span class="ident" id="4048626">c</span>&nbsp;<span class="ident" id="4048628">Cipher</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4048636">for</span>&nbsp;<span class="ident" id="4048640">i</span>&nbsp;<span class="op" id="4048642">:=</span>&nbsp;<span class="num" id="4048645">0</span><span class="op" id="4048646">;</span>&nbsp;<span class="ident" id="4048648">i</span>&nbsp;<span class="op" id="4048650">&lt;</span>&nbsp;<span class="num" id="4048652">256</span><span class="op" id="4048655">;</span>&nbsp;<span class="ident" id="4048657">i</span><span class="op" id="4048658">++</span>&nbsp;<span class="op" id="4048661">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4048665">c</span><span class="op" id="4048666">.</span><span class="ident" id="4048667">s</span><span class="op" id="4048668">[</span><span class="ident" id="4048669">i</span><span class="op" id="4048670">]</span>&nbsp;<span class="op" id="4048672">=</span>&nbsp;<span class="builtintype" id="4048674">uint32</span><span class="op" id="4048680">(</span><span class="ident" id="4048681">i</span><span class="op" id="4048682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4048685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4048688">var</span>&nbsp;<span class="ident" id="4048692">j</span>&nbsp;<span class="builtintype" id="4048694">uint8</span>&nbsp;<span class="op" id="4048700">=</span>&nbsp;<span class="num" id="4048702">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4048705">for</span>&nbsp;<span class="ident" id="4048709">i</span>&nbsp;<span class="op" id="4048711">:=</span>&nbsp;<span class="num" id="4048714">0</span><span class="op" id="4048715">;</span>&nbsp;<span class="ident" id="4048717">i</span>&nbsp;<span class="op" id="4048719">&lt;</span>&nbsp;<span class="num" id="4048721">256</span><span class="op" id="4048724">;</span>&nbsp;<span class="ident" id="4048726">i</span><span class="op" id="4048727">++</span>&nbsp;<span class="op" id="4048730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4048734">j</span>&nbsp;<span class="op" id="4048736">+=</span>&nbsp;<span class="builtintype" id="4048739">uint8</span><span class="op" id="4048744">(</span><span class="ident" id="4048745">c</span><span class="op" id="4048746">.</span><span class="ident" id="4048747">s</span><span class="op" id="4048748">[</span><span class="ident" id="4048749">i</span><span class="op" id="4048750">]</span><span class="op" id="4048751">)</span>&nbsp;<span class="op" id="4048753">+</span>&nbsp;<span class="ident" id="4048755">key</span><span class="op" id="4048758">[</span><span class="ident" id="4048759">i</span><span class="op" id="4048760">%</span><span class="ident" id="4048761">k</span><span class="op" id="4048762">]</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4048766">c</span><span class="op" id="4048767">.</span><span class="ident" id="4048768">s</span><span class="op" id="4048769">[</span><span class="ident" id="4048770">i</span><span class="op" id="4048771">]</span><span class="op" id="4048772">,</span>&nbsp;<span class="ident" id="4048774">c</span><span class="op" id="4048775">.</span><span class="ident" id="4048776">s</span><span class="op" id="4048777">[</span><span class="ident" id="4048778">j</span><span class="op" id="4048779">]</span>&nbsp;<span class="op" id="4048781">=</span>&nbsp;<span class="ident" id="4048783">c</span><span class="op" id="4048784">.</span><span class="ident" id="4048785">s</span><span class="op" id="4048786">[</span><span class="ident" id="4048787">j</span><span class="op" id="4048788">]</span><span class="op" id="4048789">,</span>&nbsp;<span class="ident" id="4048791">c</span><span class="op" id="4048792">.</span><span class="ident" id="4048793">s</span><span class="op" id="4048794">[</span><span class="ident" id="4048795">i</span><span class="op" id="4048796">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4048799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4048802">return</span>&nbsp;<span class="op" id="4048809">&amp;</span><span class="ident" id="4048810">c</span><span class="op" id="4048811">,</span>&nbsp;<span class="ident" id="4048813">nil</span><br>
<span class="lineno"></span><span class="op" id="4048817">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="4048820">//&nbsp;Reset&nbsp;zeros&nbsp;the&nbsp;key&nbsp;data&nbsp;so&nbsp;that&nbsp;it&nbsp;will&nbsp;no&nbsp;longer&nbsp;appear&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4048888">//&nbsp;process&#39;s&nbsp;memory.</span><br>
<span class="lineno"></span><span class="keyword" id="4048909">func</span>&nbsp;<span class="op" id="4048914">(</span><span class="ident" id="4048915">c</span>&nbsp;<span class="op" id="4048917">*</span><span class="ident" id="4048918">Cipher</span><span class="op" id="4048924">)</span>&nbsp;<span class="ident" id="4048926">Reset</span><span class="op" id="4048931">(</span><span class="op" id="4048932">)</span>&nbsp;<span class="op" id="4048934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4048937">for</span>&nbsp;<span class="ident" id="4048941">i</span>&nbsp;<span class="op" id="4048943">:=</span>&nbsp;<span class="keyword" id="4048946">range</span>&nbsp;<span class="ident" id="4048952">c</span><span class="op" id="4048953">.</span><span class="ident" id="4048954">s</span>&nbsp;<span class="op" id="4048956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4048960">c</span><span class="op" id="4048961">.</span><span class="ident" id="4048962">s</span><span class="op" id="4048963">[</span><span class="ident" id="4048964">i</span><span class="op" id="4048965">]</span>&nbsp;<span class="op" id="4048967">=</span>&nbsp;<span class="num" id="4048969">0</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4048972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4048975">c</span><span class="op" id="4048976">.</span><span class="ident" id="4048977">i</span><span class="op" id="4048978">,</span>&nbsp;<span class="ident" id="4048980">c</span><span class="op" id="4048981">.</span><span class="ident" id="4048982">j</span>&nbsp;<span class="op" id="4048984">=</span>&nbsp;<span class="num" id="4048986">0</span><span class="op" id="4048987">,</span>&nbsp;<span class="num" id="4048989">0</span><br>
<span class="lineno"></span><span class="op" id="4048991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4048994">//&nbsp;xorKeyStreamGeneric&nbsp;sets&nbsp;dst&nbsp;to&nbsp;the&nbsp;result&nbsp;of&nbsp;XORing&nbsp;src&nbsp;with&nbsp;the</span><br>
<span class="lineno">55</span><span class="comment" id="4049063">//&nbsp;key&nbsp;stream.&nbsp;&nbsp;Dst&nbsp;and&nbsp;src&nbsp;may&nbsp;be&nbsp;the&nbsp;same&nbsp;slice&nbsp;but&nbsp;otherwise&nbsp;should</span><br>
<span class="lineno"></span><span class="comment" id="4049134">//&nbsp;not&nbsp;overlap.</span><br>
<span class="lineno"></span><span class="comment" id="4049150">//</span><br>
<span class="lineno"></span><span class="comment" id="4049153">//&nbsp;This&nbsp;is&nbsp;the&nbsp;pure&nbsp;Go&nbsp;version.&nbsp;rc4_{amd64,386,arm}*&nbsp;contain&nbsp;assembly</span><br>
<span class="lineno"></span><span class="comment" id="4049223">//&nbsp;implementations.&nbsp;This&nbsp;is&nbsp;here&nbsp;for&nbsp;tests&nbsp;and&nbsp;to&nbsp;prevent&nbsp;bitrot.</span><br>
<span class="lineno">60</span><span class="keyword" id="4049289">func</span>&nbsp;<span class="op" id="4049294">(</span><span class="ident" id="4049295">c</span>&nbsp;<span class="op" id="4049297">*</span><span class="ident" id="4049298">Cipher</span><span class="op" id="4049304">)</span>&nbsp;<span class="ident" id="4049306">xorKeyStreamGeneric</span><span class="op" id="4049325">(</span><span class="ident" id="4049326">dst</span><span class="op" id="4049329">,</span>&nbsp;<span class="ident" id="4049331">src</span>&nbsp;<span class="op" id="4049335">[</span><span class="op" id="4049336">]</span><span class="builtintype" id="4049337">byte</span><span class="op" id="4049341">)</span>&nbsp;<span class="op" id="4049343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4049346">i</span><span class="op" id="4049347">,</span>&nbsp;<span class="ident" id="4049349">j</span>&nbsp;<span class="op" id="4049351">:=</span>&nbsp;<span class="ident" id="4049354">c</span><span class="op" id="4049355">.</span><span class="ident" id="4049356">i</span><span class="op" id="4049357">,</span>&nbsp;<span class="ident" id="4049359">c</span><span class="op" id="4049360">.</span><span class="ident" id="4049361">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4049364">for</span>&nbsp;<span class="ident" id="4049368">k</span><span class="op" id="4049369">,</span>&nbsp;<span class="ident" id="4049371">v</span>&nbsp;<span class="op" id="4049373">:=</span>&nbsp;<span class="keyword" id="4049376">range</span>&nbsp;<span class="ident" id="4049382">src</span>&nbsp;<span class="op" id="4049386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4049390">i</span>&nbsp;<span class="op" id="4049392">+=</span>&nbsp;<span class="num" id="4049395">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4049399">j</span>&nbsp;<span class="op" id="4049401">+=</span>&nbsp;<span class="builtintype" id="4049404">uint8</span><span class="op" id="4049409">(</span><span class="ident" id="4049410">c</span><span class="op" id="4049411">.</span><span class="ident" id="4049412">s</span><span class="op" id="4049413">[</span><span class="ident" id="4049414">i</span><span class="op" id="4049415">]</span><span class="op" id="4049416">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4049420">c</span><span class="op" id="4049421">.</span><span class="ident" id="4049422">s</span><span class="op" id="4049423">[</span><span class="ident" id="4049424">i</span><span class="op" id="4049425">]</span><span class="op" id="4049426">,</span>&nbsp;<span class="ident" id="4049428">c</span><span class="op" id="4049429">.</span><span class="ident" id="4049430">s</span><span class="op" id="4049431">[</span><span class="ident" id="4049432">j</span><span class="op" id="4049433">]</span>&nbsp;<span class="op" id="4049435">=</span>&nbsp;<span class="ident" id="4049437">c</span><span class="op" id="4049438">.</span><span class="ident" id="4049439">s</span><span class="op" id="4049440">[</span><span class="ident" id="4049441">j</span><span class="op" id="4049442">]</span><span class="op" id="4049443">,</span>&nbsp;<span class="ident" id="4049445">c</span><span class="op" id="4049446">.</span><span class="ident" id="4049447">s</span><span class="op" id="4049448">[</span><span class="ident" id="4049449">i</span><span class="op" id="4049450">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4049454">dst</span><span class="op" id="4049457">[</span><span class="ident" id="4049458">k</span><span class="op" id="4049459">]</span>&nbsp;<span class="op" id="4049461">=</span>&nbsp;<span class="ident" id="4049463">v</span>&nbsp;<span class="op" id="4049465">^</span>&nbsp;<span class="builtintype" id="4049467">uint8</span><span class="op" id="4049472">(</span><span class="ident" id="4049473">c</span><span class="op" id="4049474">.</span><span class="ident" id="4049475">s</span><span class="op" id="4049476">[</span><span class="builtintype" id="4049477">uint8</span><span class="op" id="4049482">(</span><span class="ident" id="4049483">c</span><span class="op" id="4049484">.</span><span class="ident" id="4049485">s</span><span class="op" id="4049486">[</span><span class="ident" id="4049487">i</span><span class="op" id="4049488">]</span><span class="op" id="4049489">+</span><span class="ident" id="4049490">c</span><span class="op" id="4049491">.</span><span class="ident" id="4049492">s</span><span class="op" id="4049493">[</span><span class="ident" id="4049494">j</span><span class="op" id="4049495">]</span><span class="op" id="4049496">)</span><span class="op" id="4049497">]</span><span class="op" id="4049498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4049501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4049504">c</span><span class="op" id="4049505">.</span><span class="ident" id="4049506">i</span><span class="op" id="4049507">,</span>&nbsp;<span class="ident" id="4049509">c</span><span class="op" id="4049510">.</span><span class="ident" id="4049511">j</span>&nbsp;<span class="op" id="4049513">=</span>&nbsp;<span class="ident" id="4049515">i</span><span class="op" id="4049516">,</span>&nbsp;<span class="ident" id="4049518">j</span><br>
<span class="lineno"></span><span class="op" id="4049520">}</span>
</div>
</body>
</html>
