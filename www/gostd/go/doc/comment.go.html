<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/doc</h2>
<ul>
<li><a href="/gostd/go/doc/comment.go.html">comment.go</a></li>
<li><a href="/gostd/go/doc/comment_test.go.html">comment_test.go</a></li>
<li><a href="/gostd/go/doc/doc.go.html">doc.go</a></li>
<li><a href="/gostd/go/doc/doc_test.go.html">doc_test.go</a></li>
<li><a href="/gostd/go/doc/example.go.html">example.go</a></li>
<li><a href="/gostd/go/doc/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/doc/exports.go.html">exports.go</a></li>
<li><a href="/gostd/go/doc/filter.go.html">filter.go</a></li>
<li><a href="/gostd/go/doc/reader.go.html">reader.go</a></li>
<li><a href="/gostd/go/doc/synopsis.go.html">synopsis.go</a></li>
<li><a href="/gostd/go/doc/synopsis_test.go.html">synopsis_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3273415">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3273470">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3273524">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3273575">//&nbsp;Godoc&nbsp;comment&nbsp;extraction&nbsp;and&nbsp;comment&nbsp;-&gt;&nbsp;HTML&nbsp;formatting.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3273636">package</span>&nbsp;<span class="ident" id="3273644">doc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3273649">import</span>&nbsp;<span class="op" id="3273656">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3273659">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3273665">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3273675">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3273686">&#34;text/template&#34;</span>&nbsp;<span class="comment" id="3273702">//&nbsp;for&nbsp;HTMLEscape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3273721">&#34;unicode&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3273732">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="3273747">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3273750">var</span>&nbsp;<span class="op" id="3273754">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3273757">ldquo</span>&nbsp;<span class="op" id="3273763">=</span>&nbsp;<span class="op" id="3273765">[</span><span class="op" id="3273766">]</span><span class="builtintype" id="3273767">byte</span><span class="op" id="3273771">(</span><span class="string" id="3273772">&#34;&amp;ldquo;&#34;</span><span class="op" id="3273781">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3273784">rdquo</span>&nbsp;<span class="op" id="3273790">=</span>&nbsp;<span class="op" id="3273792">[</span><span class="op" id="3273793">]</span><span class="builtintype" id="3273794">byte</span><span class="op" id="3273798">(</span><span class="string" id="3273799">&#34;&amp;rdquo;&#34;</span><span class="op" id="3273808">)</span><br>
<span class="lineno"></span><span class="op" id="3273810">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3273813">//&nbsp;Escape&nbsp;comment&nbsp;text&nbsp;for&nbsp;HTML.&nbsp;If&nbsp;nice&nbsp;is&nbsp;set,</span><br>
<span class="lineno"></span><span class="comment" id="3273862">//&nbsp;also&nbsp;turn&nbsp;``&nbsp;into&nbsp;&amp;ldquo;&nbsp;and&nbsp;&#39;&#39;&nbsp;into&nbsp;&amp;rdquo;.</span><br>
<span class="lineno">25</span><span class="keyword" id="3273912">func</span>&nbsp;<span class="ident" id="3273917">commentEscape</span><span class="op" id="3273930">(</span><span class="ident" id="3273931">w</span>&nbsp;<span class="ident" id="3273933">io</span><span class="op" id="3273935">.</span><span class="ident" id="3273936">Writer</span><span class="op" id="3273942">,</span>&nbsp;<span class="ident" id="3273944">text</span>&nbsp;<span class="builtintype" id="3273949">string</span><span class="op" id="3273955">,</span>&nbsp;<span class="ident" id="3273957">nice</span>&nbsp;<span class="builtintype" id="3273962">bool</span><span class="op" id="3273966">)</span>&nbsp;<span class="op" id="3273968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3273971">last</span>&nbsp;<span class="op" id="3273976">:=</span>&nbsp;<span class="num" id="3273979">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3273982">if</span>&nbsp;<span class="ident" id="3273985">nice</span>&nbsp;<span class="op" id="3273990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3273994">for</span>&nbsp;<span class="ident" id="3273998">i</span>&nbsp;<span class="op" id="3274000">:=</span>&nbsp;<span class="num" id="3274003">0</span><span class="op" id="3274004">;</span>&nbsp;<span class="ident" id="3274006">i</span>&nbsp;<span class="op" id="3274008">&lt;</span>&nbsp;<span class="builtinfunc" id="3274010">len</span><span class="op" id="3274013">(</span><span class="ident" id="3274014">text</span><span class="op" id="3274018">)</span><span class="op" id="3274019">-</span><span class="num" id="3274020">1</span><span class="op" id="3274021">;</span>&nbsp;<span class="ident" id="3274023">i</span><span class="op" id="3274024">++</span>&nbsp;<span class="op" id="3274027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3274032">ch</span>&nbsp;<span class="op" id="3274035">:=</span>&nbsp;<span class="ident" id="3274038">text</span><span class="op" id="3274042">[</span><span class="ident" id="3274043">i</span><span class="op" id="3274044">]</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3274049">if</span>&nbsp;<span class="ident" id="3274052">ch</span>&nbsp;<span class="op" id="3274055">==</span>&nbsp;<span class="ident" id="3274058">text</span><span class="op" id="3274062">[</span><span class="ident" id="3274063">i</span><span class="op" id="3274064">+</span><span class="num" id="3274065">1</span><span class="op" id="3274066">]</span>&nbsp;<span class="op" id="3274068">&amp;&amp;</span>&nbsp;<span class="op" id="3274071">(</span><span class="ident" id="3274072">ch</span>&nbsp;<span class="op" id="3274075">==</span>&nbsp;<span class="string" id="3274078">&#39;`&#39;</span>&nbsp;<span class="op" id="3274082">||</span>&nbsp;<span class="ident" id="3274085">ch</span>&nbsp;<span class="op" id="3274088">==</span>&nbsp;<span class="string" id="3274091">&#39;\&#39;&#39;</span><span class="op" id="3274095">)</span>&nbsp;<span class="op" id="3274097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3274103">template</span><span class="op" id="3274111">.</span><span class="ident" id="3274112">HTMLEscape</span><span class="op" id="3274122">(</span><span class="ident" id="3274123">w</span><span class="op" id="3274124">,</span>&nbsp;<span class="op" id="3274126">[</span><span class="op" id="3274127">]</span><span class="builtintype" id="3274128">byte</span><span class="op" id="3274132">(</span><span class="ident" id="3274133">text</span><span class="op" id="3274137">[</span><span class="ident" id="3274138">last</span><span class="op" id="3274142">:</span><span class="ident" id="3274143">i</span><span class="op" id="3274144">]</span><span class="op" id="3274145">)</span><span class="op" id="3274146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3274152">last</span>&nbsp;<span class="op" id="3274157">=</span>&nbsp;<span class="ident" id="3274159">i</span>&nbsp;<span class="op" id="3274161">+</span>&nbsp;<span class="num" id="3274163">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3274169">switch</span>&nbsp;<span class="ident" id="3274176">ch</span>&nbsp;<span class="op" id="3274179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3274185">case</span>&nbsp;<span class="string" id="3274190">&#39;`&#39;</span><span class="op" id="3274193">:</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3274200">w</span><span class="op" id="3274201">.</span><span class="ident" id="3274202">Write</span><span class="op" id="3274207">(</span><span class="ident" id="3274208">ldquo</span><span class="op" id="3274213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3274219">case</span>&nbsp;<span class="string" id="3274224">&#39;\&#39;&#39;</span><span class="op" id="3274228">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3274235">w</span><span class="op" id="3274236">.</span><span class="ident" id="3274237">Write</span><span class="op" id="3274242">(</span><span class="ident" id="3274243">rdquo</span><span class="op" id="3274248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3274254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3274260">i</span><span class="op" id="3274261">++</span>&nbsp;<span class="comment" id="3274264">//&nbsp;loop&nbsp;will&nbsp;add&nbsp;one&nbsp;more</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3274293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3274297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3274300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3274303">template</span><span class="op" id="3274311">.</span><span class="ident" id="3274312">HTMLEscape</span><span class="op" id="3274322">(</span><span class="ident" id="3274323">w</span><span class="op" id="3274324">,</span>&nbsp;<span class="op" id="3274326">[</span><span class="op" id="3274327">]</span><span class="builtintype" id="3274328">byte</span><span class="op" id="3274332">(</span><span class="ident" id="3274333">text</span><span class="op" id="3274337">[</span><span class="ident" id="3274338">last</span><span class="op" id="3274342">:</span><span class="op" id="3274343">]</span><span class="op" id="3274344">)</span><span class="op" id="3274345">)</span><br>
<span class="lineno"></span><span class="op" id="3274347">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="3274350">const</span>&nbsp;<span class="op" id="3274356">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3274359">//&nbsp;Regexp&nbsp;for&nbsp;Go&nbsp;identifiers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3274389">identRx</span>&nbsp;<span class="op" id="3274397">=</span>&nbsp;<span class="string" id="3274399">`[\pL_][\pL_0-9]*`</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3274420">//&nbsp;Regexp&nbsp;for&nbsp;URLs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3274440">protocol</span>&nbsp;<span class="op" id="3274449">=</span>&nbsp;<span class="string" id="3274451">`https?|ftp|file|gopher|mailto|news|nntp|telnet|wais|prospero`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3274515">hostPart</span>&nbsp;<span class="op" id="3274524">=</span>&nbsp;<span class="string" id="3274526">`[a-zA-Z0-9_@\-]+`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3274546">filePart</span>&nbsp;<span class="op" id="3274555">=</span>&nbsp;<span class="string" id="3274557">`[a-zA-Z0-9_?%#~&amp;/\-+=()]+`</span>&nbsp;<span class="comment" id="3274585">//&nbsp;parentheses&nbsp;may&nbsp;not&nbsp;be&nbsp;matching;&nbsp;see&nbsp;pairedParensPrefixLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3274648">urlRx</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3274657">=</span>&nbsp;<span class="string" id="3274659">`(`</span>&nbsp;<span class="op" id="3274663">+</span>&nbsp;<span class="ident" id="3274665">protocol</span>&nbsp;<span class="op" id="3274674">+</span>&nbsp;<span class="string" id="3274676">`)://`</span>&nbsp;<span class="op" id="3274683">+</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="3274687">//&nbsp;http://</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3274700">hostPart</span>&nbsp;<span class="op" id="3274709">+</span>&nbsp;<span class="string" id="3274711">`([.:]`</span>&nbsp;<span class="op" id="3274719">+</span>&nbsp;<span class="ident" id="3274721">hostPart</span>&nbsp;<span class="op" id="3274730">+</span>&nbsp;<span class="string" id="3274732">`)*/?`</span>&nbsp;<span class="op" id="3274739">+</span>&nbsp;<span class="comment" id="3274741">//&nbsp;//www.google.com:8080/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3274769">filePart</span>&nbsp;<span class="op" id="3274778">+</span>&nbsp;<span class="string" id="3274780">`([:.,]`</span>&nbsp;<span class="op" id="3274789">+</span>&nbsp;<span class="ident" id="3274791">filePart</span>&nbsp;<span class="op" id="3274800">+</span>&nbsp;<span class="string" id="3274802">`)*`</span><br>
<span class="lineno"></span><span class="op" id="3274807">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3274810">var</span>&nbsp;<span class="ident" id="3274814">matchRx</span>&nbsp;<span class="op" id="3274822">=</span>&nbsp;<span class="ident" id="3274824">regexp</span><span class="op" id="3274830">.</span><span class="ident" id="3274831">MustCompile</span><span class="op" id="3274842">(</span><span class="string" id="3274843">`(`</span>&nbsp;<span class="op" id="3274847">+</span>&nbsp;<span class="ident" id="3274849">urlRx</span>&nbsp;<span class="op" id="3274855">+</span>&nbsp;<span class="string" id="3274857">`)|(`</span>&nbsp;<span class="op" id="3274863">+</span>&nbsp;<span class="ident" id="3274865">identRx</span>&nbsp;<span class="op" id="3274873">+</span>&nbsp;<span class="string" id="3274875">`)`</span><span class="op" id="3274878">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="3274881">var</span>&nbsp;<span class="op" id="3274885">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3274888">html_a</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3274900">=</span>&nbsp;<span class="op" id="3274902">[</span><span class="op" id="3274903">]</span><span class="builtintype" id="3274904">byte</span><span class="op" id="3274908">(</span><span class="string" id="3274909">`&lt;a&nbsp;href=&#34;`</span><span class="op" id="3274920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3274923">html_aq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3274935">=</span>&nbsp;<span class="op" id="3274937">[</span><span class="op" id="3274938">]</span><span class="builtintype" id="3274939">byte</span><span class="op" id="3274943">(</span><span class="string" id="3274944">`&#34;&gt;`</span><span class="op" id="3274948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3274951">html_enda</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3274963">=</span>&nbsp;<span class="op" id="3274965">[</span><span class="op" id="3274966">]</span><span class="builtintype" id="3274967">byte</span><span class="op" id="3274971">(</span><span class="string" id="3274972">&#34;&lt;/a&gt;&#34;</span><span class="op" id="3274978">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3274981">html_i</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3274993">=</span>&nbsp;<span class="op" id="3274995">[</span><span class="op" id="3274996">]</span><span class="builtintype" id="3274997">byte</span><span class="op" id="3275001">(</span><span class="string" id="3275002">&#34;&lt;i&gt;&#34;</span><span class="op" id="3275007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3275010">html_endi</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3275022">=</span>&nbsp;<span class="op" id="3275024">[</span><span class="op" id="3275025">]</span><span class="builtintype" id="3275026">byte</span><span class="op" id="3275030">(</span><span class="string" id="3275031">&#34;&lt;/i&gt;&#34;</span><span class="op" id="3275037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3275040">html_p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3275052">=</span>&nbsp;<span class="op" id="3275054">[</span><span class="op" id="3275055">]</span><span class="builtintype" id="3275056">byte</span><span class="op" id="3275060">(</span><span class="string" id="3275061">&#34;&lt;p&gt;\n&#34;</span><span class="op" id="3275068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3275071">html_endp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3275083">=</span>&nbsp;<span class="op" id="3275085">[</span><span class="op" id="3275086">]</span><span class="builtintype" id="3275087">byte</span><span class="op" id="3275091">(</span><span class="string" id="3275092">&#34;&lt;/p&gt;\n&#34;</span><span class="op" id="3275100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3275103">html_pre</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3275115">=</span>&nbsp;<span class="op" id="3275117">[</span><span class="op" id="3275118">]</span><span class="builtintype" id="3275119">byte</span><span class="op" id="3275123">(</span><span class="string" id="3275124">&#34;&lt;pre&gt;&#34;</span><span class="op" id="3275131">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3275134">html_endpre</span>&nbsp;<span class="op" id="3275146">=</span>&nbsp;<span class="op" id="3275148">[</span><span class="op" id="3275149">]</span><span class="builtintype" id="3275150">byte</span><span class="op" id="3275154">(</span><span class="string" id="3275155">&#34;&lt;/pre&gt;\n&#34;</span><span class="op" id="3275165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3275168">html_h</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3275180">=</span>&nbsp;<span class="op" id="3275182">[</span><span class="op" id="3275183">]</span><span class="builtintype" id="3275184">byte</span><span class="op" id="3275188">(</span><span class="string" id="3275189">`&lt;h3&nbsp;id=&#34;`</span><span class="op" id="3275199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3275202">html_hq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3275214">=</span>&nbsp;<span class="op" id="3275216">[</span><span class="op" id="3275217">]</span><span class="builtintype" id="3275218">byte</span><span class="op" id="3275222">(</span><span class="string" id="3275223">`&#34;&gt;`</span><span class="op" id="3275227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3275230">html_endh</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3275242">=</span>&nbsp;<span class="op" id="3275244">[</span><span class="op" id="3275245">]</span><span class="builtintype" id="3275246">byte</span><span class="op" id="3275250">(</span><span class="string" id="3275251">&#34;&lt;/h3&gt;\n&#34;</span><span class="op" id="3275260">)</span><br>
<span class="lineno"></span><span class="op" id="3275262">)</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="3275265">//&nbsp;pairedParensPrefixLen&nbsp;returns&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;longest&nbsp;prefix&nbsp;of&nbsp;s&nbsp;containing&nbsp;paired&nbsp;parentheses.</span><br>
<span class="lineno"></span><span class="keyword" id="3275367">func</span>&nbsp;<span class="ident" id="3275372">pairedParensPrefixLen</span><span class="op" id="3275393">(</span><span class="ident" id="3275394">s</span>&nbsp;<span class="builtintype" id="3275396">string</span><span class="op" id="3275402">)</span>&nbsp;<span class="builtintype" id="3275404">int</span>&nbsp;<span class="op" id="3275408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3275411">parens</span>&nbsp;<span class="op" id="3275418">:=</span>&nbsp;<span class="num" id="3275421">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3275424">l</span>&nbsp;<span class="op" id="3275426">:=</span>&nbsp;<span class="builtinfunc" id="3275429">len</span><span class="op" id="3275432">(</span><span class="ident" id="3275433">s</span><span class="op" id="3275434">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3275437">for</span>&nbsp;<span class="ident" id="3275441">i</span><span class="op" id="3275442">,</span>&nbsp;<span class="ident" id="3275444">ch</span>&nbsp;<span class="op" id="3275447">:=</span>&nbsp;<span class="keyword" id="3275450">range</span>&nbsp;<span class="ident" id="3275456">s</span>&nbsp;<span class="op" id="3275458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3275462">switch</span>&nbsp;<span class="ident" id="3275469">ch</span>&nbsp;<span class="op" id="3275472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3275476">case</span>&nbsp;<span class="string" id="3275481">&#39;(&#39;</span><span class="op" id="3275484">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3275489">if</span>&nbsp;<span class="ident" id="3275492">parens</span>&nbsp;<span class="op" id="3275499">==</span>&nbsp;<span class="num" id="3275502">0</span>&nbsp;<span class="op" id="3275504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3275510">l</span>&nbsp;<span class="op" id="3275512">=</span>&nbsp;<span class="ident" id="3275514">i</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3275519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3275524">parens</span><span class="op" id="3275530">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3275535">case</span>&nbsp;<span class="string" id="3275540">&#39;)&#39;</span><span class="op" id="3275543">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3275548">parens</span><span class="op" id="3275554">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3275560">if</span>&nbsp;<span class="ident" id="3275563">parens</span>&nbsp;<span class="op" id="3275570">==</span>&nbsp;<span class="num" id="3275573">0</span>&nbsp;<span class="op" id="3275575">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3275581">l</span>&nbsp;<span class="op" id="3275583">=</span>&nbsp;<span class="builtinfunc" id="3275585">len</span><span class="op" id="3275588">(</span><span class="ident" id="3275589">s</span><span class="op" id="3275590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3275595">}</span>&nbsp;<span class="keyword" id="3275597">else</span>&nbsp;<span class="keyword" id="3275602">if</span>&nbsp;<span class="ident" id="3275605">parens</span>&nbsp;<span class="op" id="3275612">&lt;</span>&nbsp;<span class="num" id="3275614">0</span>&nbsp;<span class="op" id="3275616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3275622">return</span>&nbsp;<span class="ident" id="3275629">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3275634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3275638">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3275641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3275644">return</span>&nbsp;<span class="ident" id="3275651">l</span><br>
<span class="lineno"></span><span class="op" id="3275653">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3275656">//&nbsp;Emphasize&nbsp;and&nbsp;escape&nbsp;a&nbsp;line&nbsp;of&nbsp;text&nbsp;for&nbsp;HTML.&nbsp;URLs&nbsp;are&nbsp;converted&nbsp;into&nbsp;links;</span><br>
<span class="lineno">100</span><span class="comment" id="3275736">//&nbsp;if&nbsp;the&nbsp;URL&nbsp;also&nbsp;appears&nbsp;in&nbsp;the&nbsp;words&nbsp;map,&nbsp;the&nbsp;link&nbsp;is&nbsp;taken&nbsp;from&nbsp;the&nbsp;map&nbsp;(if</span><br>
<span class="lineno"></span><span class="comment" id="3275816">//&nbsp;the&nbsp;corresponding&nbsp;map&nbsp;value&nbsp;is&nbsp;the&nbsp;empty&nbsp;string,&nbsp;the&nbsp;URL&nbsp;is&nbsp;not&nbsp;converted</span><br>
<span class="lineno"></span><span class="comment" id="3275893">//&nbsp;into&nbsp;a&nbsp;link).&nbsp;Go&nbsp;identifiers&nbsp;that&nbsp;appear&nbsp;in&nbsp;the&nbsp;words&nbsp;map&nbsp;are&nbsp;italicized;&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="3275973">//&nbsp;the&nbsp;corresponding&nbsp;map&nbsp;value&nbsp;is&nbsp;not&nbsp;the&nbsp;empty&nbsp;string,&nbsp;it&nbsp;is&nbsp;considered&nbsp;a&nbsp;URL</span><br>
<span class="lineno"></span><span class="comment" id="3276052">//&nbsp;and&nbsp;the&nbsp;word&nbsp;is&nbsp;converted&nbsp;into&nbsp;a&nbsp;link.&nbsp;If&nbsp;nice&nbsp;is&nbsp;set,&nbsp;the&nbsp;remaining&nbsp;text&#39;s</span><br>
<span class="lineno">105</span><span class="comment" id="3276131">//&nbsp;appearance&nbsp;is&nbsp;improved&nbsp;where&nbsp;it&nbsp;makes&nbsp;sense&nbsp;(e.g.,&nbsp;``&nbsp;is&nbsp;turned&nbsp;into&nbsp;&amp;ldquo;</span><br>
<span class="lineno"></span><span class="comment" id="3276211">//&nbsp;and&nbsp;&#39;&#39;&nbsp;into&nbsp;&amp;rdquo;).</span><br>
<span class="lineno"></span><span class="keyword" id="3276236">func</span>&nbsp;<span class="ident" id="3276241">emphasize</span><span class="op" id="3276250">(</span><span class="ident" id="3276251">w</span>&nbsp;<span class="ident" id="3276253">io</span><span class="op" id="3276255">.</span><span class="ident" id="3276256">Writer</span><span class="op" id="3276262">,</span>&nbsp;<span class="ident" id="3276264">line</span>&nbsp;<span class="builtintype" id="3276269">string</span><span class="op" id="3276275">,</span>&nbsp;<span class="ident" id="3276277">words</span>&nbsp;<span class="keyword" id="3276283">map</span><span class="op" id="3276286">[</span><span class="builtintype" id="3276287">string</span><span class="op" id="3276293">]</span><span class="builtintype" id="3276294">string</span><span class="op" id="3276300">,</span>&nbsp;<span class="ident" id="3276302">nice</span>&nbsp;<span class="builtintype" id="3276307">bool</span><span class="op" id="3276311">)</span>&nbsp;<span class="op" id="3276313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3276316">for</span>&nbsp;<span class="op" id="3276320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3276324">m</span>&nbsp;<span class="op" id="3276326">:=</span>&nbsp;<span class="ident" id="3276329">matchRx</span><span class="op" id="3276336">.</span><span class="ident" id="3276337">FindStringSubmatchIndex</span><span class="op" id="3276360">(</span><span class="ident" id="3276361">line</span><span class="op" id="3276365">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3276369">if</span>&nbsp;<span class="ident" id="3276372">m</span>&nbsp;<span class="op" id="3276374">==</span>&nbsp;<span class="ident" id="3276377">nil</span>&nbsp;<span class="op" id="3276381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3276386">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3276394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3276398">//&nbsp;m&nbsp;&gt;=&nbsp;6&nbsp;(two&nbsp;parenthesized&nbsp;sub-regexps&nbsp;in&nbsp;matchRx,&nbsp;1st&nbsp;one&nbsp;is&nbsp;urlRx)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3276472">//&nbsp;write&nbsp;text&nbsp;before&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3276501">commentEscape</span><span class="op" id="3276514">(</span><span class="ident" id="3276515">w</span><span class="op" id="3276516">,</span>&nbsp;<span class="ident" id="3276518">line</span><span class="op" id="3276522">[</span><span class="num" id="3276523">0</span><span class="op" id="3276524">:</span><span class="ident" id="3276525">m</span><span class="op" id="3276526">[</span><span class="num" id="3276527">0</span><span class="op" id="3276528">]</span><span class="op" id="3276529">]</span><span class="op" id="3276530">,</span>&nbsp;<span class="ident" id="3276532">nice</span><span class="op" id="3276536">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3276541">//&nbsp;adjust&nbsp;match&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3276572">match</span>&nbsp;<span class="op" id="3276578">:=</span>&nbsp;<span class="ident" id="3276581">line</span><span class="op" id="3276585">[</span><span class="ident" id="3276586">m</span><span class="op" id="3276587">[</span><span class="num" id="3276588">0</span><span class="op" id="3276589">]</span><span class="op" id="3276590">:</span><span class="ident" id="3276591">m</span><span class="op" id="3276592">[</span><span class="num" id="3276593">1</span><span class="op" id="3276594">]</span><span class="op" id="3276595">]</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3276599">if</span>&nbsp;<span class="ident" id="3276602">n</span>&nbsp;<span class="op" id="3276604">:=</span>&nbsp;<span class="ident" id="3276607">pairedParensPrefixLen</span><span class="op" id="3276628">(</span><span class="ident" id="3276629">match</span><span class="op" id="3276634">)</span><span class="op" id="3276635">;</span>&nbsp;<span class="ident" id="3276637">n</span>&nbsp;<span class="op" id="3276639">&lt;</span>&nbsp;<span class="builtinfunc" id="3276641">len</span><span class="op" id="3276644">(</span><span class="ident" id="3276645">match</span><span class="op" id="3276650">)</span>&nbsp;<span class="op" id="3276652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3276657">//&nbsp;match&nbsp;contains&nbsp;unpaired&nbsp;parentheses&nbsp;(rare);</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3276707">//&nbsp;redo&nbsp;matching&nbsp;with&nbsp;shortened&nbsp;line&nbsp;for&nbsp;correct&nbsp;indices</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3276767">m</span>&nbsp;<span class="op" id="3276769">=</span>&nbsp;<span class="ident" id="3276771">matchRx</span><span class="op" id="3276778">.</span><span class="ident" id="3276779">FindStringSubmatchIndex</span><span class="op" id="3276802">(</span><span class="ident" id="3276803">line</span><span class="op" id="3276807">[</span><span class="op" id="3276808">:</span><span class="ident" id="3276809">m</span><span class="op" id="3276810">[</span><span class="num" id="3276811">0</span><span class="op" id="3276812">]</span><span class="op" id="3276813">+</span><span class="ident" id="3276814">n</span><span class="op" id="3276815">]</span><span class="op" id="3276816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3276821">match</span>&nbsp;<span class="op" id="3276827">=</span>&nbsp;<span class="ident" id="3276829">match</span><span class="op" id="3276834">[</span><span class="op" id="3276835">:</span><span class="ident" id="3276836">n</span><span class="op" id="3276837">]</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3276841">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3276846">//&nbsp;analyze&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3276865">url</span>&nbsp;<span class="op" id="3276869">:=</span>&nbsp;<span class="string" id="3276872">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3276877">italics</span>&nbsp;<span class="op" id="3276885">:=</span>&nbsp;<span class="builtintype" id="3276888">false</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3276896">if</span>&nbsp;<span class="ident" id="3276899">words</span>&nbsp;<span class="op" id="3276905">!=</span>&nbsp;<span class="ident" id="3276908">nil</span>&nbsp;<span class="op" id="3276912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3276917">url</span><span class="op" id="3276920">,</span>&nbsp;<span class="ident" id="3276922">italics</span>&nbsp;<span class="op" id="3276930">=</span>&nbsp;<span class="ident" id="3276932">words</span><span class="op" id="3276937">[</span><span class="ident" id="3276938">match</span><span class="op" id="3276943">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3276947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3276951">if</span>&nbsp;<span class="ident" id="3276954">m</span><span class="op" id="3276955">[</span><span class="num" id="3276956">2</span><span class="op" id="3276957">]</span>&nbsp;<span class="op" id="3276959">&gt;=</span>&nbsp;<span class="num" id="3276962">0</span>&nbsp;<span class="op" id="3276964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3276969">//&nbsp;match&nbsp;against&nbsp;first&nbsp;parenthesized&nbsp;sub-regexp;&nbsp;must&nbsp;be&nbsp;match&nbsp;against&nbsp;urlRx</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277049">if</span>&nbsp;<span class="op" id="3277052">!</span><span class="ident" id="3277053">italics</span>&nbsp;<span class="op" id="3277061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3277067">//&nbsp;no&nbsp;alternative&nbsp;URL&nbsp;in&nbsp;words&nbsp;list,&nbsp;use&nbsp;match&nbsp;instead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3277126">url</span>&nbsp;<span class="op" id="3277130">=</span>&nbsp;<span class="ident" id="3277132">match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3277141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3277146">italics</span>&nbsp;<span class="op" id="3277154">=</span>&nbsp;<span class="builtintype" id="3277156">false</span>&nbsp;<span class="comment" id="3277162">//&nbsp;don&#39;t&nbsp;italicize&nbsp;URLs</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3277188">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3277193">//&nbsp;write&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277210">if</span>&nbsp;<span class="builtinfunc" id="3277213">len</span><span class="op" id="3277216">(</span><span class="ident" id="3277217">url</span><span class="op" id="3277220">)</span>&nbsp;<span class="op" id="3277222">&gt;</span>&nbsp;<span class="num" id="3277224">0</span>&nbsp;<span class="op" id="3277226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3277231">w</span><span class="op" id="3277232">.</span><span class="ident" id="3277233">Write</span><span class="op" id="3277238">(</span><span class="ident" id="3277239">html_a</span><span class="op" id="3277245">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3277250">template</span><span class="op" id="3277258">.</span><span class="ident" id="3277259">HTMLEscape</span><span class="op" id="3277269">(</span><span class="ident" id="3277270">w</span><span class="op" id="3277271">,</span>&nbsp;<span class="op" id="3277273">[</span><span class="op" id="3277274">]</span><span class="builtintype" id="3277275">byte</span><span class="op" id="3277279">(</span><span class="ident" id="3277280">url</span><span class="op" id="3277283">)</span><span class="op" id="3277284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3277289">w</span><span class="op" id="3277290">.</span><span class="ident" id="3277291">Write</span><span class="op" id="3277296">(</span><span class="ident" id="3277297">html_aq</span><span class="op" id="3277304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3277308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277312">if</span>&nbsp;<span class="ident" id="3277315">italics</span>&nbsp;<span class="op" id="3277323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3277328">w</span><span class="op" id="3277329">.</span><span class="ident" id="3277330">Write</span><span class="op" id="3277335">(</span><span class="ident" id="3277336">html_i</span><span class="op" id="3277342">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3277346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3277350">commentEscape</span><span class="op" id="3277363">(</span><span class="ident" id="3277364">w</span><span class="op" id="3277365">,</span>&nbsp;<span class="ident" id="3277367">match</span><span class="op" id="3277372">,</span>&nbsp;<span class="ident" id="3277374">nice</span><span class="op" id="3277378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277382">if</span>&nbsp;<span class="ident" id="3277385">italics</span>&nbsp;<span class="op" id="3277393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3277398">w</span><span class="op" id="3277399">.</span><span class="ident" id="3277400">Write</span><span class="op" id="3277405">(</span><span class="ident" id="3277406">html_endi</span><span class="op" id="3277415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3277419">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277423">if</span>&nbsp;<span class="builtinfunc" id="3277426">len</span><span class="op" id="3277429">(</span><span class="ident" id="3277430">url</span><span class="op" id="3277433">)</span>&nbsp;<span class="op" id="3277435">&gt;</span>&nbsp;<span class="num" id="3277437">0</span>&nbsp;<span class="op" id="3277439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3277444">w</span><span class="op" id="3277445">.</span><span class="ident" id="3277446">Write</span><span class="op" id="3277451">(</span><span class="ident" id="3277452">html_enda</span><span class="op" id="3277461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3277465">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3277470">//&nbsp;advance</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3277483">line</span>&nbsp;<span class="op" id="3277488">=</span>&nbsp;<span class="ident" id="3277490">line</span><span class="op" id="3277494">[</span><span class="ident" id="3277495">m</span><span class="op" id="3277496">[</span><span class="num" id="3277497">1</span><span class="op" id="3277498">]</span><span class="op" id="3277499">:</span><span class="op" id="3277500">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3277503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3277506">commentEscape</span><span class="op" id="3277519">(</span><span class="ident" id="3277520">w</span><span class="op" id="3277521">,</span>&nbsp;<span class="ident" id="3277523">line</span><span class="op" id="3277527">,</span>&nbsp;<span class="ident" id="3277529">nice</span><span class="op" id="3277533">)</span><br>
<span class="lineno"></span><span class="op" id="3277535">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="keyword" id="3277538">func</span>&nbsp;<span class="ident" id="3277543">indentLen</span><span class="op" id="3277552">(</span><span class="ident" id="3277553">s</span>&nbsp;<span class="builtintype" id="3277555">string</span><span class="op" id="3277561">)</span>&nbsp;<span class="builtintype" id="3277563">int</span>&nbsp;<span class="op" id="3277567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3277570">i</span>&nbsp;<span class="op" id="3277572">:=</span>&nbsp;<span class="num" id="3277575">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277578">for</span>&nbsp;<span class="ident" id="3277582">i</span>&nbsp;<span class="op" id="3277584">&lt;</span>&nbsp;<span class="builtinfunc" id="3277586">len</span><span class="op" id="3277589">(</span><span class="ident" id="3277590">s</span><span class="op" id="3277591">)</span>&nbsp;<span class="op" id="3277593">&amp;&amp;</span>&nbsp;<span class="op" id="3277596">(</span><span class="ident" id="3277597">s</span><span class="op" id="3277598">[</span><span class="ident" id="3277599">i</span><span class="op" id="3277600">]</span>&nbsp;<span class="op" id="3277602">==</span>&nbsp;<span class="string" id="3277605">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3277609">||</span>&nbsp;<span class="ident" id="3277612">s</span><span class="op" id="3277613">[</span><span class="ident" id="3277614">i</span><span class="op" id="3277615">]</span>&nbsp;<span class="op" id="3277617">==</span>&nbsp;<span class="string" id="3277620">&#39;\t&#39;</span><span class="op" id="3277624">)</span>&nbsp;<span class="op" id="3277626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3277630">i</span><span class="op" id="3277631">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3277635">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277638">return</span>&nbsp;<span class="ident" id="3277645">i</span><br>
<span class="lineno"></span><span class="op" id="3277647">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3277650">func</span>&nbsp;<span class="ident" id="3277655">isBlank</span><span class="op" id="3277662">(</span><span class="ident" id="3277663">s</span>&nbsp;<span class="builtintype" id="3277665">string</span><span class="op" id="3277671">)</span>&nbsp;<span class="builtintype" id="3277673">bool</span>&nbsp;<span class="op" id="3277678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277681">return</span>&nbsp;<span class="builtinfunc" id="3277688">len</span><span class="op" id="3277691">(</span><span class="ident" id="3277692">s</span><span class="op" id="3277693">)</span>&nbsp;<span class="op" id="3277695">==</span>&nbsp;<span class="num" id="3277698">0</span>&nbsp;<span class="op" id="3277700">||</span>&nbsp;<span class="op" id="3277703">(</span><span class="builtinfunc" id="3277704">len</span><span class="op" id="3277707">(</span><span class="ident" id="3277708">s</span><span class="op" id="3277709">)</span>&nbsp;<span class="op" id="3277711">==</span>&nbsp;<span class="num" id="3277714">1</span>&nbsp;<span class="op" id="3277716">&amp;&amp;</span>&nbsp;<span class="ident" id="3277719">s</span><span class="op" id="3277720">[</span><span class="num" id="3277721">0</span><span class="op" id="3277722">]</span>&nbsp;<span class="op" id="3277724">==</span>&nbsp;<span class="string" id="3277727">&#39;\n&#39;</span><span class="op" id="3277731">)</span><br>
<span class="lineno">175</span><span class="op" id="3277733">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3277736">func</span>&nbsp;<span class="ident" id="3277741">commonPrefix</span><span class="op" id="3277753">(</span><span class="ident" id="3277754">a</span><span class="op" id="3277755">,</span>&nbsp;<span class="ident" id="3277757">b</span>&nbsp;<span class="builtintype" id="3277759">string</span><span class="op" id="3277765">)</span>&nbsp;<span class="builtintype" id="3277767">string</span>&nbsp;<span class="op" id="3277774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3277777">i</span>&nbsp;<span class="op" id="3277779">:=</span>&nbsp;<span class="num" id="3277782">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277785">for</span>&nbsp;<span class="ident" id="3277789">i</span>&nbsp;<span class="op" id="3277791">&lt;</span>&nbsp;<span class="builtinfunc" id="3277793">len</span><span class="op" id="3277796">(</span><span class="ident" id="3277797">a</span><span class="op" id="3277798">)</span>&nbsp;<span class="op" id="3277800">&amp;&amp;</span>&nbsp;<span class="ident" id="3277803">i</span>&nbsp;<span class="op" id="3277805">&lt;</span>&nbsp;<span class="builtinfunc" id="3277807">len</span><span class="op" id="3277810">(</span><span class="ident" id="3277811">b</span><span class="op" id="3277812">)</span>&nbsp;<span class="op" id="3277814">&amp;&amp;</span>&nbsp;<span class="ident" id="3277817">a</span><span class="op" id="3277818">[</span><span class="ident" id="3277819">i</span><span class="op" id="3277820">]</span>&nbsp;<span class="op" id="3277822">==</span>&nbsp;<span class="ident" id="3277825">b</span><span class="op" id="3277826">[</span><span class="ident" id="3277827">i</span><span class="op" id="3277828">]</span>&nbsp;<span class="op" id="3277830">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3277834">i</span><span class="op" id="3277835">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3277839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277842">return</span>&nbsp;<span class="ident" id="3277849">a</span><span class="op" id="3277850">[</span><span class="num" id="3277851">0</span><span class="op" id="3277852">:</span><span class="ident" id="3277853">i</span><span class="op" id="3277854">]</span><br>
<span class="lineno"></span><span class="op" id="3277856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="3277859">func</span>&nbsp;<span class="ident" id="3277864">unindent</span><span class="op" id="3277872">(</span><span class="ident" id="3277873">block</span>&nbsp;<span class="op" id="3277879">[</span><span class="op" id="3277880">]</span><span class="builtintype" id="3277881">string</span><span class="op" id="3277887">)</span>&nbsp;<span class="op" id="3277889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277892">if</span>&nbsp;<span class="builtinfunc" id="3277895">len</span><span class="op" id="3277898">(</span><span class="ident" id="3277899">block</span><span class="op" id="3277904">)</span>&nbsp;<span class="op" id="3277906">==</span>&nbsp;<span class="num" id="3277909">0</span>&nbsp;<span class="op" id="3277911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277915">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3277923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3277927">//&nbsp;compute&nbsp;maximum&nbsp;common&nbsp;white&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3277967">prefix</span>&nbsp;<span class="op" id="3277974">:=</span>&nbsp;<span class="ident" id="3277977">block</span><span class="op" id="3277982">[</span><span class="num" id="3277983">0</span><span class="op" id="3277984">]</span><span class="op" id="3277985">[</span><span class="num" id="3277986">0</span><span class="op" id="3277987">:</span><span class="ident" id="3277988">indentLen</span><span class="op" id="3277997">(</span><span class="ident" id="3277998">block</span><span class="op" id="3278003">[</span><span class="num" id="3278004">0</span><span class="op" id="3278005">]</span><span class="op" id="3278006">)</span><span class="op" id="3278007">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3278010">for</span>&nbsp;<span class="ident" id="3278014">_</span><span class="op" id="3278015">,</span>&nbsp;<span class="ident" id="3278017">line</span>&nbsp;<span class="op" id="3278022">:=</span>&nbsp;<span class="keyword" id="3278025">range</span>&nbsp;<span class="ident" id="3278031">block</span>&nbsp;<span class="op" id="3278037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3278041">if</span>&nbsp;<span class="op" id="3278044">!</span><span class="ident" id="3278045">isBlank</span><span class="op" id="3278052">(</span><span class="ident" id="3278053">line</span><span class="op" id="3278057">)</span>&nbsp;<span class="op" id="3278059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3278064">prefix</span>&nbsp;<span class="op" id="3278071">=</span>&nbsp;<span class="ident" id="3278073">commonPrefix</span><span class="op" id="3278085">(</span><span class="ident" id="3278086">prefix</span><span class="op" id="3278092">,</span>&nbsp;<span class="ident" id="3278094">line</span><span class="op" id="3278098">[</span><span class="num" id="3278099">0</span><span class="op" id="3278100">:</span><span class="ident" id="3278101">indentLen</span><span class="op" id="3278110">(</span><span class="ident" id="3278111">line</span><span class="op" id="3278115">)</span><span class="op" id="3278116">]</span><span class="op" id="3278117">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3278121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3278124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3278127">n</span>&nbsp;<span class="op" id="3278129">:=</span>&nbsp;<span class="builtinfunc" id="3278132">len</span><span class="op" id="3278135">(</span><span class="ident" id="3278136">prefix</span><span class="op" id="3278142">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3278146">//&nbsp;remove</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3278157">for</span>&nbsp;<span class="ident" id="3278161">i</span><span class="op" id="3278162">,</span>&nbsp;<span class="ident" id="3278164">line</span>&nbsp;<span class="op" id="3278169">:=</span>&nbsp;<span class="keyword" id="3278172">range</span>&nbsp;<span class="ident" id="3278178">block</span>&nbsp;<span class="op" id="3278184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3278188">if</span>&nbsp;<span class="op" id="3278191">!</span><span class="ident" id="3278192">isBlank</span><span class="op" id="3278199">(</span><span class="ident" id="3278200">line</span><span class="op" id="3278204">)</span>&nbsp;<span class="op" id="3278206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3278211">block</span><span class="op" id="3278216">[</span><span class="ident" id="3278217">i</span><span class="op" id="3278218">]</span>&nbsp;<span class="op" id="3278220">=</span>&nbsp;<span class="ident" id="3278222">line</span><span class="op" id="3278226">[</span><span class="ident" id="3278227">n</span><span class="op" id="3278228">:</span><span class="op" id="3278229">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3278233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3278236">}</span><br>
<span class="lineno">205</span><span class="op" id="3278238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3278241">//&nbsp;heading&nbsp;returns&nbsp;the&nbsp;trimmed&nbsp;line&nbsp;if&nbsp;it&nbsp;passes&nbsp;as&nbsp;a&nbsp;section&nbsp;heading;</span><br>
<span class="lineno"></span><span class="comment" id="3278312">//&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3278354">func</span>&nbsp;<span class="ident" id="3278359">heading</span><span class="op" id="3278366">(</span><span class="ident" id="3278367">line</span>&nbsp;<span class="builtintype" id="3278372">string</span><span class="op" id="3278378">)</span>&nbsp;<span class="builtintype" id="3278380">string</span>&nbsp;<span class="op" id="3278387">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3278390">line</span>&nbsp;<span class="op" id="3278395">=</span>&nbsp;<span class="ident" id="3278397">strings</span><span class="op" id="3278404">.</span><span class="ident" id="3278405">TrimSpace</span><span class="op" id="3278414">(</span><span class="ident" id="3278415">line</span><span class="op" id="3278419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3278422">if</span>&nbsp;<span class="builtinfunc" id="3278425">len</span><span class="op" id="3278428">(</span><span class="ident" id="3278429">line</span><span class="op" id="3278433">)</span>&nbsp;<span class="op" id="3278435">==</span>&nbsp;<span class="num" id="3278438">0</span>&nbsp;<span class="op" id="3278440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3278444">return</span>&nbsp;<span class="string" id="3278451">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3278455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3278459">//&nbsp;a&nbsp;heading&nbsp;must&nbsp;start&nbsp;with&nbsp;an&nbsp;uppercase&nbsp;letter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3278509">r</span><span class="op" id="3278510">,</span>&nbsp;<span class="ident" id="3278512">_</span>&nbsp;<span class="op" id="3278514">:=</span>&nbsp;<span class="ident" id="3278517">utf8</span><span class="op" id="3278521">.</span><span class="ident" id="3278522">DecodeRuneInString</span><span class="op" id="3278540">(</span><span class="ident" id="3278541">line</span><span class="op" id="3278545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3278548">if</span>&nbsp;<span class="op" id="3278551">!</span><span class="ident" id="3278552">unicode</span><span class="op" id="3278559">.</span><span class="ident" id="3278560">IsLetter</span><span class="op" id="3278568">(</span><span class="ident" id="3278569">r</span><span class="op" id="3278570">)</span>&nbsp;<span class="op" id="3278572">||</span>&nbsp;<span class="op" id="3278575">!</span><span class="ident" id="3278576">unicode</span><span class="op" id="3278583">.</span><span class="ident" id="3278584">IsUpper</span><span class="op" id="3278591">(</span><span class="ident" id="3278592">r</span><span class="op" id="3278593">)</span>&nbsp;<span class="op" id="3278595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3278599">return</span>&nbsp;<span class="string" id="3278606">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3278610">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3278614">//&nbsp;it&nbsp;must&nbsp;end&nbsp;in&nbsp;a&nbsp;letter&nbsp;or&nbsp;digit:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3278652">r</span><span class="op" id="3278653">,</span>&nbsp;<span class="ident" id="3278655">_</span>&nbsp;<span class="op" id="3278657">=</span>&nbsp;<span class="ident" id="3278659">utf8</span><span class="op" id="3278663">.</span><span class="ident" id="3278664">DecodeLastRuneInString</span><span class="op" id="3278686">(</span><span class="ident" id="3278687">line</span><span class="op" id="3278691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3278694">if</span>&nbsp;<span class="op" id="3278697">!</span><span class="ident" id="3278698">unicode</span><span class="op" id="3278705">.</span><span class="ident" id="3278706">IsLetter</span><span class="op" id="3278714">(</span><span class="ident" id="3278715">r</span><span class="op" id="3278716">)</span>&nbsp;<span class="op" id="3278718">&amp;&amp;</span>&nbsp;<span class="op" id="3278721">!</span><span class="ident" id="3278722">unicode</span><span class="op" id="3278729">.</span><span class="ident" id="3278730">IsDigit</span><span class="op" id="3278737">(</span><span class="ident" id="3278738">r</span><span class="op" id="3278739">)</span>&nbsp;<span class="op" id="3278741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3278745">return</span>&nbsp;<span class="string" id="3278752">&#34;&#34;</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3278756">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3278760">//&nbsp;exclude&nbsp;lines&nbsp;with&nbsp;illegal&nbsp;characters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3278802">if</span>&nbsp;<span class="ident" id="3278805">strings</span><span class="op" id="3278812">.</span><span class="ident" id="3278813">IndexAny</span><span class="op" id="3278821">(</span><span class="ident" id="3278822">line</span><span class="op" id="3278826">,</span>&nbsp;<span class="string" id="3278828">&#34;,.;:!?+*/=()[]{}_^&amp;~%#@&lt;\&#34;&gt;\\&#34;</span><span class="op" id="3278863">)</span>&nbsp;<span class="op" id="3278865">&gt;=</span>&nbsp;<span class="num" id="3278868">0</span>&nbsp;<span class="op" id="3278870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3278874">return</span>&nbsp;<span class="string" id="3278881">&#34;&#34;</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3278885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3278889">//&nbsp;allow&nbsp;&#34;&#39;&#34;&nbsp;for&nbsp;possessive&nbsp;&#34;&#39;s&#34;&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3278928">for</span>&nbsp;<span class="ident" id="3278932">b</span>&nbsp;<span class="op" id="3278934">:=</span>&nbsp;<span class="ident" id="3278937">line</span><span class="op" id="3278941">;</span>&nbsp;<span class="op" id="3278943">;</span>&nbsp;<span class="op" id="3278945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3278949">i</span>&nbsp;<span class="op" id="3278951">:=</span>&nbsp;<span class="ident" id="3278954">strings</span><span class="op" id="3278961">.</span><span class="ident" id="3278962">IndexRune</span><span class="op" id="3278971">(</span><span class="ident" id="3278972">b</span><span class="op" id="3278973">,</span>&nbsp;<span class="string" id="3278975">&#39;\&#39;&#39;</span><span class="op" id="3278979">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3278983">if</span>&nbsp;<span class="ident" id="3278986">i</span>&nbsp;<span class="op" id="3278988">&lt;</span>&nbsp;<span class="num" id="3278990">0</span>&nbsp;<span class="op" id="3278992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3278997">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3279005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3279009">if</span>&nbsp;<span class="ident" id="3279012">i</span><span class="op" id="3279013">+</span><span class="num" id="3279014">1</span>&nbsp;<span class="op" id="3279016">&gt;=</span>&nbsp;<span class="builtinfunc" id="3279019">len</span><span class="op" id="3279022">(</span><span class="ident" id="3279023">b</span><span class="op" id="3279024">)</span>&nbsp;<span class="op" id="3279026">||</span>&nbsp;<span class="ident" id="3279029">b</span><span class="op" id="3279030">[</span><span class="ident" id="3279031">i</span><span class="op" id="3279032">+</span><span class="num" id="3279033">1</span><span class="op" id="3279034">]</span>&nbsp;<span class="op" id="3279036">!=</span>&nbsp;<span class="string" id="3279039">&#39;s&#39;</span>&nbsp;<span class="op" id="3279043">||</span>&nbsp;<span class="op" id="3279046">(</span><span class="ident" id="3279047">i</span><span class="op" id="3279048">+</span><span class="num" id="3279049">2</span>&nbsp;<span class="op" id="3279051">&lt;</span>&nbsp;<span class="builtinfunc" id="3279053">len</span><span class="op" id="3279056">(</span><span class="ident" id="3279057">b</span><span class="op" id="3279058">)</span>&nbsp;<span class="op" id="3279060">&amp;&amp;</span>&nbsp;<span class="ident" id="3279063">b</span><span class="op" id="3279064">[</span><span class="ident" id="3279065">i</span><span class="op" id="3279066">+</span><span class="num" id="3279067">2</span><span class="op" id="3279068">]</span>&nbsp;<span class="op" id="3279070">!=</span>&nbsp;<span class="string" id="3279073">&#39;&nbsp;&#39;</span><span class="op" id="3279076">)</span>&nbsp;<span class="op" id="3279078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3279083">return</span>&nbsp;<span class="string" id="3279090">&#34;&#34;</span>&nbsp;<span class="comment" id="3279093">//&nbsp;not&nbsp;followed&nbsp;by&nbsp;&#34;s&nbsp;&#34;</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3279119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3279123">b</span>&nbsp;<span class="op" id="3279125">=</span>&nbsp;<span class="ident" id="3279127">b</span><span class="op" id="3279128">[</span><span class="ident" id="3279129">i</span><span class="op" id="3279130">+</span><span class="num" id="3279131">2</span><span class="op" id="3279132">:</span><span class="op" id="3279133">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3279136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3279140">return</span>&nbsp;<span class="ident" id="3279147">line</span><br>
<span class="lineno">245</span><span class="op" id="3279152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3279155">type</span>&nbsp;<span class="ident" id="3279160">op</span>&nbsp;<span class="builtintype" id="3279163">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3279168">const</span>&nbsp;<span class="op" id="3279174">(</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3279177">opPara</span>&nbsp;<span class="ident" id="3279184">op</span>&nbsp;<span class="op" id="3279187">=</span>&nbsp;<span class="ident" id="3279189">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3279195">opHead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3279203">opPre</span><br>
<span class="lineno"></span><span class="op" id="3279209">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="3279212">type</span>&nbsp;<span class="ident" id="3279217">block</span>&nbsp;<span class="keyword" id="3279223">struct</span>&nbsp;<span class="op" id="3279230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3279233">op</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3279239">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3279243">lines</span>&nbsp;<span class="op" id="3279249">[</span><span class="op" id="3279250">]</span><span class="builtintype" id="3279251">string</span><br>
<span class="lineno"></span><span class="op" id="3279258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="keyword" id="3279261">var</span>&nbsp;<span class="ident" id="3279265">nonAlphaNumRx</span>&nbsp;<span class="op" id="3279279">=</span>&nbsp;<span class="ident" id="3279281">regexp</span><span class="op" id="3279287">.</span><span class="ident" id="3279288">MustCompile</span><span class="op" id="3279299">(</span><span class="string" id="3279300">`[^a-zA-Z0-9]`</span><span class="op" id="3279314">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3279317">func</span>&nbsp;<span class="ident" id="3279322">anchorID</span><span class="op" id="3279330">(</span><span class="ident" id="3279331">line</span>&nbsp;<span class="builtintype" id="3279336">string</span><span class="op" id="3279342">)</span>&nbsp;<span class="builtintype" id="3279344">string</span>&nbsp;<span class="op" id="3279351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3279354">//&nbsp;Add&nbsp;a&nbsp;&#34;hdr-&#34;&nbsp;prefix&nbsp;to&nbsp;avoid&nbsp;conflicting&nbsp;with&nbsp;IDs&nbsp;used&nbsp;for&nbsp;package&nbsp;symbols.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3279434">return</span>&nbsp;<span class="string" id="3279441">&#34;hdr-&#34;</span>&nbsp;<span class="op" id="3279448">+</span>&nbsp;<span class="ident" id="3279450">nonAlphaNumRx</span><span class="op" id="3279463">.</span><span class="ident" id="3279464">ReplaceAllString</span><span class="op" id="3279480">(</span><span class="ident" id="3279481">line</span><span class="op" id="3279485">,</span>&nbsp;<span class="string" id="3279487">&#34;_&#34;</span><span class="op" id="3279490">)</span><br>
<span class="lineno">265</span><span class="op" id="3279492">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3279495">//&nbsp;ToHTML&nbsp;converts&nbsp;comment&nbsp;text&nbsp;to&nbsp;formatted&nbsp;HTML.</span><br>
<span class="lineno"></span><span class="comment" id="3279546">//&nbsp;The&nbsp;comment&nbsp;was&nbsp;prepared&nbsp;by&nbsp;DocReader,</span><br>
<span class="lineno"></span><span class="comment" id="3279588">//&nbsp;so&nbsp;it&nbsp;is&nbsp;known&nbsp;not&nbsp;to&nbsp;have&nbsp;leading,&nbsp;trailing&nbsp;blank&nbsp;lines</span><br>
<span class="lineno">270</span><span class="comment" id="3279648">//&nbsp;nor&nbsp;to&nbsp;have&nbsp;trailing&nbsp;spaces&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;lines.</span><br>
<span class="lineno"></span><span class="comment" id="3279700">//&nbsp;The&nbsp;comment&nbsp;markers&nbsp;have&nbsp;already&nbsp;been&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="3279750">//</span><br>
<span class="lineno"></span><span class="comment" id="3279753">//&nbsp;Each&nbsp;span&nbsp;of&nbsp;unindented&nbsp;non-blank&nbsp;lines&nbsp;is&nbsp;converted&nbsp;into</span><br>
<span class="lineno"></span><span class="comment" id="3279814">//&nbsp;a&nbsp;single&nbsp;paragraph.&nbsp;There&nbsp;is&nbsp;one&nbsp;exception&nbsp;to&nbsp;the&nbsp;rule:&nbsp;a&nbsp;span&nbsp;that</span><br>
<span class="lineno">275</span><span class="comment" id="3279885">//&nbsp;consists&nbsp;of&nbsp;a&nbsp;single&nbsp;line,&nbsp;is&nbsp;followed&nbsp;by&nbsp;another&nbsp;paragraph&nbsp;span,</span><br>
<span class="lineno"></span><span class="comment" id="3279954">//&nbsp;begins&nbsp;with&nbsp;a&nbsp;capital&nbsp;letter,&nbsp;and&nbsp;contains&nbsp;no&nbsp;punctuation</span><br>
<span class="lineno"></span><span class="comment" id="3280015">//&nbsp;is&nbsp;formatted&nbsp;as&nbsp;a&nbsp;heading.</span><br>
<span class="lineno"></span><span class="comment" id="3280045">//</span><br>
<span class="lineno"></span><span class="comment" id="3280048">//&nbsp;A&nbsp;span&nbsp;of&nbsp;indented&nbsp;lines&nbsp;is&nbsp;converted&nbsp;into&nbsp;a&nbsp;&lt;pre&gt;&nbsp;block,</span><br>
<span class="lineno">280</span><span class="comment" id="3280109">//&nbsp;with&nbsp;the&nbsp;common&nbsp;indent&nbsp;prefix&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="3280151">//</span><br>
<span class="lineno"></span><span class="comment" id="3280154">//&nbsp;URLs&nbsp;in&nbsp;the&nbsp;comment&nbsp;text&nbsp;are&nbsp;converted&nbsp;into&nbsp;links;&nbsp;if&nbsp;the&nbsp;URL&nbsp;also&nbsp;appears</span><br>
<span class="lineno"></span><span class="comment" id="3280232">//&nbsp;in&nbsp;the&nbsp;words&nbsp;map,&nbsp;the&nbsp;link&nbsp;is&nbsp;taken&nbsp;from&nbsp;the&nbsp;map&nbsp;(if&nbsp;the&nbsp;corresponding&nbsp;map</span><br>
<span class="lineno"></span><span class="comment" id="3280310">//&nbsp;value&nbsp;is&nbsp;the&nbsp;empty&nbsp;string,&nbsp;the&nbsp;URL&nbsp;is&nbsp;not&nbsp;converted&nbsp;into&nbsp;a&nbsp;link).</span><br>
<span class="lineno">285</span><span class="comment" id="3280379">//</span><br>
<span class="lineno"></span><span class="comment" id="3280382">//&nbsp;Go&nbsp;identifiers&nbsp;that&nbsp;appear&nbsp;in&nbsp;the&nbsp;words&nbsp;map&nbsp;are&nbsp;italicized;&nbsp;if&nbsp;the&nbsp;corresponding</span><br>
<span class="lineno"></span><span class="comment" id="3280466">//&nbsp;map&nbsp;value&nbsp;is&nbsp;not&nbsp;the&nbsp;empty&nbsp;string,&nbsp;it&nbsp;is&nbsp;considered&nbsp;a&nbsp;URL&nbsp;and&nbsp;the&nbsp;word&nbsp;is&nbsp;converted</span><br>
<span class="lineno"></span><span class="comment" id="3280553">//&nbsp;into&nbsp;a&nbsp;link.</span><br>
<span class="lineno"></span><span class="keyword" id="3280569">func</span>&nbsp;<span class="ident" id="3280574">ToHTML</span><span class="op" id="3280580">(</span><span class="ident" id="3280581">w</span>&nbsp;<span class="ident" id="3280583">io</span><span class="op" id="3280585">.</span><span class="ident" id="3280586">Writer</span><span class="op" id="3280592">,</span>&nbsp;<span class="ident" id="3280594">text</span>&nbsp;<span class="builtintype" id="3280599">string</span><span class="op" id="3280605">,</span>&nbsp;<span class="ident" id="3280607">words</span>&nbsp;<span class="keyword" id="3280613">map</span><span class="op" id="3280616">[</span><span class="builtintype" id="3280617">string</span><span class="op" id="3280623">]</span><span class="builtintype" id="3280624">string</span><span class="op" id="3280630">)</span>&nbsp;<span class="op" id="3280632">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280635">for</span>&nbsp;<span class="ident" id="3280639">_</span><span class="op" id="3280640">,</span>&nbsp;<span class="ident" id="3280642">b</span>&nbsp;<span class="op" id="3280644">:=</span>&nbsp;<span class="keyword" id="3280647">range</span>&nbsp;<span class="ident" id="3280653">blocks</span><span class="op" id="3280659">(</span><span class="ident" id="3280660">text</span><span class="op" id="3280664">)</span>&nbsp;<span class="op" id="3280666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280670">switch</span>&nbsp;<span class="ident" id="3280677">b</span><span class="op" id="3280678">.</span><span class="ident" id="3280679">op</span>&nbsp;<span class="op" id="3280682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280686">case</span>&nbsp;<span class="ident" id="3280691">opPara</span><span class="op" id="3280697">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3280702">w</span><span class="op" id="3280703">.</span><span class="ident" id="3280704">Write</span><span class="op" id="3280709">(</span><span class="ident" id="3280710">html_p</span><span class="op" id="3280716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280721">for</span>&nbsp;<span class="ident" id="3280725">_</span><span class="op" id="3280726">,</span>&nbsp;<span class="ident" id="3280728">line</span>&nbsp;<span class="op" id="3280733">:=</span>&nbsp;<span class="keyword" id="3280736">range</span>&nbsp;<span class="ident" id="3280742">b</span><span class="op" id="3280743">.</span><span class="ident" id="3280744">lines</span>&nbsp;<span class="op" id="3280750">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3280756">emphasize</span><span class="op" id="3280765">(</span><span class="ident" id="3280766">w</span><span class="op" id="3280767">,</span>&nbsp;<span class="ident" id="3280769">line</span><span class="op" id="3280773">,</span>&nbsp;<span class="ident" id="3280775">words</span><span class="op" id="3280780">,</span>&nbsp;<span class="builtintype" id="3280782">true</span><span class="op" id="3280786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3280791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3280796">w</span><span class="op" id="3280797">.</span><span class="ident" id="3280798">Write</span><span class="op" id="3280803">(</span><span class="ident" id="3280804">html_endp</span><span class="op" id="3280813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280817">case</span>&nbsp;<span class="ident" id="3280822">opHead</span><span class="op" id="3280828">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3280833">w</span><span class="op" id="3280834">.</span><span class="ident" id="3280835">Write</span><span class="op" id="3280840">(</span><span class="ident" id="3280841">html_h</span><span class="op" id="3280847">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3280852">id</span>&nbsp;<span class="op" id="3280855">:=</span>&nbsp;<span class="string" id="3280858">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280864">for</span>&nbsp;<span class="ident" id="3280868">_</span><span class="op" id="3280869">,</span>&nbsp;<span class="ident" id="3280871">line</span>&nbsp;<span class="op" id="3280876">:=</span>&nbsp;<span class="keyword" id="3280879">range</span>&nbsp;<span class="ident" id="3280885">b</span><span class="op" id="3280886">.</span><span class="ident" id="3280887">lines</span>&nbsp;<span class="op" id="3280893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280899">if</span>&nbsp;<span class="ident" id="3280902">id</span>&nbsp;<span class="op" id="3280905">==</span>&nbsp;<span class="string" id="3280908">&#34;&#34;</span>&nbsp;<span class="op" id="3280911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3280918">id</span>&nbsp;<span class="op" id="3280921">=</span>&nbsp;<span class="ident" id="3280923">anchorID</span><span class="op" id="3280931">(</span><span class="ident" id="3280932">line</span><span class="op" id="3280936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3280943">w</span><span class="op" id="3280944">.</span><span class="ident" id="3280945">Write</span><span class="op" id="3280950">(</span><span class="op" id="3280951">[</span><span class="op" id="3280952">]</span><span class="builtintype" id="3280953">byte</span><span class="op" id="3280957">(</span><span class="ident" id="3280958">id</span><span class="op" id="3280960">)</span><span class="op" id="3280961">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3280968">w</span><span class="op" id="3280969">.</span><span class="ident" id="3280970">Write</span><span class="op" id="3280975">(</span><span class="ident" id="3280976">html_hq</span><span class="op" id="3280983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3280989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3280995">commentEscape</span><span class="op" id="3281008">(</span><span class="ident" id="3281009">w</span><span class="op" id="3281010">,</span>&nbsp;<span class="ident" id="3281012">line</span><span class="op" id="3281016">,</span>&nbsp;<span class="builtintype" id="3281018">true</span><span class="op" id="3281022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3281027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281032">if</span>&nbsp;<span class="ident" id="3281035">id</span>&nbsp;<span class="op" id="3281038">==</span>&nbsp;<span class="string" id="3281041">&#34;&#34;</span>&nbsp;<span class="op" id="3281044">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3281050">w</span><span class="op" id="3281051">.</span><span class="ident" id="3281052">Write</span><span class="op" id="3281057">(</span><span class="ident" id="3281058">html_hq</span><span class="op" id="3281065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3281070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3281075">w</span><span class="op" id="3281076">.</span><span class="ident" id="3281077">Write</span><span class="op" id="3281082">(</span><span class="ident" id="3281083">html_endh</span><span class="op" id="3281092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281096">case</span>&nbsp;<span class="ident" id="3281101">opPre</span><span class="op" id="3281106">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3281111">w</span><span class="op" id="3281112">.</span><span class="ident" id="3281113">Write</span><span class="op" id="3281118">(</span><span class="ident" id="3281119">html_pre</span><span class="op" id="3281127">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281132">for</span>&nbsp;<span class="ident" id="3281136">_</span><span class="op" id="3281137">,</span>&nbsp;<span class="ident" id="3281139">line</span>&nbsp;<span class="op" id="3281144">:=</span>&nbsp;<span class="keyword" id="3281147">range</span>&nbsp;<span class="ident" id="3281153">b</span><span class="op" id="3281154">.</span><span class="ident" id="3281155">lines</span>&nbsp;<span class="op" id="3281161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3281167">emphasize</span><span class="op" id="3281176">(</span><span class="ident" id="3281177">w</span><span class="op" id="3281178">,</span>&nbsp;<span class="ident" id="3281180">line</span><span class="op" id="3281184">,</span>&nbsp;<span class="ident" id="3281186">nil</span><span class="op" id="3281189">,</span>&nbsp;<span class="builtintype" id="3281191">false</span><span class="op" id="3281196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3281201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3281206">w</span><span class="op" id="3281207">.</span><span class="ident" id="3281208">Write</span><span class="op" id="3281213">(</span><span class="ident" id="3281214">html_endpre</span><span class="op" id="3281225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3281229">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3281232">}</span><br>
<span class="lineno"></span><span class="op" id="3281234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3281237">func</span>&nbsp;<span class="ident" id="3281242">blocks</span><span class="op" id="3281248">(</span><span class="ident" id="3281249">text</span>&nbsp;<span class="builtintype" id="3281254">string</span><span class="op" id="3281260">)</span>&nbsp;<span class="op" id="3281262">[</span><span class="op" id="3281263">]</span><span class="ident" id="3281264">block</span>&nbsp;<span class="op" id="3281270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281273">var</span>&nbsp;<span class="op" id="3281277">(</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3281281">out</span>&nbsp;&nbsp;<span class="op" id="3281286">[</span><span class="op" id="3281287">]</span><span class="ident" id="3281288">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3281296">para</span>&nbsp;<span class="op" id="3281301">[</span><span class="op" id="3281302">]</span><span class="builtintype" id="3281303">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3281313">lastWasBlank</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3281328">=</span>&nbsp;<span class="builtintype" id="3281330">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3281338">lastWasHeading</span>&nbsp;<span class="op" id="3281353">=</span>&nbsp;<span class="builtintype" id="3281355">false</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3281362">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3281366">close</span>&nbsp;<span class="op" id="3281372">:=</span>&nbsp;<span class="keyword" id="3281375">func</span><span class="op" id="3281379">(</span><span class="op" id="3281380">)</span>&nbsp;<span class="op" id="3281382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281386">if</span>&nbsp;<span class="ident" id="3281389">para</span>&nbsp;<span class="op" id="3281394">!=</span>&nbsp;<span class="ident" id="3281397">nil</span>&nbsp;<span class="op" id="3281401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3281406">out</span>&nbsp;<span class="op" id="3281410">=</span>&nbsp;<span class="builtinfunc" id="3281412">append</span><span class="op" id="3281418">(</span><span class="ident" id="3281419">out</span><span class="op" id="3281422">,</span>&nbsp;<span class="ident" id="3281424">block</span><span class="op" id="3281429">{</span><span class="ident" id="3281430">opPara</span><span class="op" id="3281436">,</span>&nbsp;<span class="ident" id="3281438">para</span><span class="op" id="3281442">}</span><span class="op" id="3281443">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3281448">para</span>&nbsp;<span class="op" id="3281453">=</span>&nbsp;<span class="ident" id="3281455">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3281461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3281464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3281468">lines</span>&nbsp;<span class="op" id="3281474">:=</span>&nbsp;<span class="ident" id="3281477">strings</span><span class="op" id="3281484">.</span><span class="ident" id="3281485">SplitAfter</span><span class="op" id="3281495">(</span><span class="ident" id="3281496">text</span><span class="op" id="3281500">,</span>&nbsp;<span class="string" id="3281502">&#34;\n&#34;</span><span class="op" id="3281506">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3281509">unindent</span><span class="op" id="3281517">(</span><span class="ident" id="3281518">lines</span><span class="op" id="3281523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281526">for</span>&nbsp;<span class="ident" id="3281530">i</span>&nbsp;<span class="op" id="3281532">:=</span>&nbsp;<span class="num" id="3281535">0</span><span class="op" id="3281536">;</span>&nbsp;<span class="ident" id="3281538">i</span>&nbsp;<span class="op" id="3281540">&lt;</span>&nbsp;<span class="builtinfunc" id="3281542">len</span><span class="op" id="3281545">(</span><span class="ident" id="3281546">lines</span><span class="op" id="3281551">)</span><span class="op" id="3281552">;</span>&nbsp;<span class="op" id="3281554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3281558">line</span>&nbsp;<span class="op" id="3281563">:=</span>&nbsp;<span class="ident" id="3281566">lines</span><span class="op" id="3281571">[</span><span class="ident" id="3281572">i</span><span class="op" id="3281573">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281577">if</span>&nbsp;<span class="ident" id="3281580">isBlank</span><span class="op" id="3281587">(</span><span class="ident" id="3281588">line</span><span class="op" id="3281592">)</span>&nbsp;<span class="op" id="3281594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3281599">//&nbsp;close&nbsp;paragraph</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3281621">close</span><span class="op" id="3281626">(</span><span class="op" id="3281627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3281632">i</span><span class="op" id="3281633">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3281639">lastWasBlank</span>&nbsp;<span class="op" id="3281652">=</span>&nbsp;<span class="builtintype" id="3281654">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281662">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3281673">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281677">if</span>&nbsp;<span class="ident" id="3281680">indentLen</span><span class="op" id="3281689">(</span><span class="ident" id="3281690">line</span><span class="op" id="3281694">)</span>&nbsp;<span class="op" id="3281696">&gt;</span>&nbsp;<span class="num" id="3281698">0</span>&nbsp;<span class="op" id="3281700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3281705">//&nbsp;close&nbsp;paragraph</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3281727">close</span><span class="op" id="3281732">(</span><span class="op" id="3281733">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3281739">//&nbsp;count&nbsp;indented&nbsp;or&nbsp;blank&nbsp;lines</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3281775">j</span>&nbsp;<span class="op" id="3281777">:=</span>&nbsp;<span class="ident" id="3281780">i</span>&nbsp;<span class="op" id="3281782">+</span>&nbsp;<span class="num" id="3281784">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281789">for</span>&nbsp;<span class="ident" id="3281793">j</span>&nbsp;<span class="op" id="3281795">&lt;</span>&nbsp;<span class="builtinfunc" id="3281797">len</span><span class="op" id="3281800">(</span><span class="ident" id="3281801">lines</span><span class="op" id="3281806">)</span>&nbsp;<span class="op" id="3281808">&amp;&amp;</span>&nbsp;<span class="op" id="3281811">(</span><span class="ident" id="3281812">isBlank</span><span class="op" id="3281819">(</span><span class="ident" id="3281820">lines</span><span class="op" id="3281825">[</span><span class="ident" id="3281826">j</span><span class="op" id="3281827">]</span><span class="op" id="3281828">)</span>&nbsp;<span class="op" id="3281830">||</span>&nbsp;<span class="ident" id="3281833">indentLen</span><span class="op" id="3281842">(</span><span class="ident" id="3281843">lines</span><span class="op" id="3281848">[</span><span class="ident" id="3281849">j</span><span class="op" id="3281850">]</span><span class="op" id="3281851">)</span>&nbsp;<span class="op" id="3281853">&gt;</span>&nbsp;<span class="num" id="3281855">0</span><span class="op" id="3281856">)</span>&nbsp;<span class="op" id="3281858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3281864">j</span><span class="op" id="3281865">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3281871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3281876">//&nbsp;but&nbsp;not&nbsp;trailing&nbsp;blank&nbsp;lines</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281911">for</span>&nbsp;<span class="ident" id="3281915">j</span>&nbsp;<span class="op" id="3281917">&gt;</span>&nbsp;<span class="ident" id="3281919">i</span>&nbsp;<span class="op" id="3281921">&amp;&amp;</span>&nbsp;<span class="ident" id="3281924">isBlank</span><span class="op" id="3281931">(</span><span class="ident" id="3281932">lines</span><span class="op" id="3281937">[</span><span class="ident" id="3281938">j</span><span class="op" id="3281939">-</span><span class="num" id="3281940">1</span><span class="op" id="3281941">]</span><span class="op" id="3281942">)</span>&nbsp;<span class="op" id="3281944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3281950">j</span><span class="op" id="3281951">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3281957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3281962">pre</span>&nbsp;<span class="op" id="3281966">:=</span>&nbsp;<span class="ident" id="3281969">lines</span><span class="op" id="3281974">[</span><span class="ident" id="3281975">i</span><span class="op" id="3281976">:</span><span class="ident" id="3281977">j</span><span class="op" id="3281978">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3281983">i</span>&nbsp;<span class="op" id="3281985">=</span>&nbsp;<span class="ident" id="3281987">j</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3281993">unindent</span><span class="op" id="3282001">(</span><span class="ident" id="3282002">pre</span><span class="op" id="3282005">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3282011">//&nbsp;put&nbsp;those&nbsp;lines&nbsp;in&nbsp;a&nbsp;pre&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3282048">out</span>&nbsp;<span class="op" id="3282052">=</span>&nbsp;<span class="builtinfunc" id="3282054">append</span><span class="op" id="3282060">(</span><span class="ident" id="3282061">out</span><span class="op" id="3282064">,</span>&nbsp;<span class="ident" id="3282066">block</span><span class="op" id="3282071">{</span><span class="ident" id="3282072">opPre</span><span class="op" id="3282077">,</span>&nbsp;<span class="ident" id="3282079">pre</span><span class="op" id="3282082">}</span><span class="op" id="3282083">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3282088">lastWasHeading</span>&nbsp;<span class="op" id="3282103">=</span>&nbsp;<span class="builtintype" id="3282105">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3282114">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3282125">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3282130">if</span>&nbsp;<span class="ident" id="3282133">lastWasBlank</span>&nbsp;<span class="op" id="3282146">&amp;&amp;</span>&nbsp;<span class="op" id="3282149">!</span><span class="ident" id="3282150">lastWasHeading</span>&nbsp;<span class="op" id="3282165">&amp;&amp;</span>&nbsp;<span class="ident" id="3282168">i</span><span class="op" id="3282169">+</span><span class="num" id="3282170">2</span>&nbsp;<span class="op" id="3282172">&lt;</span>&nbsp;<span class="builtinfunc" id="3282174">len</span><span class="op" id="3282177">(</span><span class="ident" id="3282178">lines</span><span class="op" id="3282183">)</span>&nbsp;<span class="op" id="3282185">&amp;&amp;</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3282191">isBlank</span><span class="op" id="3282198">(</span><span class="ident" id="3282199">lines</span><span class="op" id="3282204">[</span><span class="ident" id="3282205">i</span><span class="op" id="3282206">+</span><span class="num" id="3282207">1</span><span class="op" id="3282208">]</span><span class="op" id="3282209">)</span>&nbsp;<span class="op" id="3282211">&amp;&amp;</span>&nbsp;<span class="op" id="3282214">!</span><span class="ident" id="3282215">isBlank</span><span class="op" id="3282222">(</span><span class="ident" id="3282223">lines</span><span class="op" id="3282228">[</span><span class="ident" id="3282229">i</span><span class="op" id="3282230">+</span><span class="num" id="3282231">2</span><span class="op" id="3282232">]</span><span class="op" id="3282233">)</span>&nbsp;<span class="op" id="3282235">&amp;&amp;</span>&nbsp;<span class="ident" id="3282238">indentLen</span><span class="op" id="3282247">(</span><span class="ident" id="3282248">lines</span><span class="op" id="3282253">[</span><span class="ident" id="3282254">i</span><span class="op" id="3282255">+</span><span class="num" id="3282256">2</span><span class="op" id="3282257">]</span><span class="op" id="3282258">)</span>&nbsp;<span class="op" id="3282260">==</span>&nbsp;<span class="num" id="3282263">0</span>&nbsp;<span class="op" id="3282265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3282270">//&nbsp;current&nbsp;line&nbsp;is&nbsp;non-blank,&nbsp;surrounded&nbsp;by&nbsp;blank&nbsp;lines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3282329">//&nbsp;and&nbsp;the&nbsp;next&nbsp;non-blank&nbsp;line&nbsp;is&nbsp;not&nbsp;indented:&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3282385">//&nbsp;might&nbsp;be&nbsp;a&nbsp;heading.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3282411">if</span>&nbsp;<span class="ident" id="3282414">head</span>&nbsp;<span class="op" id="3282419">:=</span>&nbsp;<span class="ident" id="3282422">heading</span><span class="op" id="3282429">(</span><span class="ident" id="3282430">line</span><span class="op" id="3282434">)</span><span class="op" id="3282435">;</span>&nbsp;<span class="ident" id="3282437">head</span>&nbsp;<span class="op" id="3282442">!=</span>&nbsp;<span class="string" id="3282445">&#34;&#34;</span>&nbsp;<span class="op" id="3282448">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3282454">close</span><span class="op" id="3282459">(</span><span class="op" id="3282460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3282466">out</span>&nbsp;<span class="op" id="3282470">=</span>&nbsp;<span class="builtinfunc" id="3282472">append</span><span class="op" id="3282478">(</span><span class="ident" id="3282479">out</span><span class="op" id="3282482">,</span>&nbsp;<span class="ident" id="3282484">block</span><span class="op" id="3282489">{</span><span class="ident" id="3282490">opHead</span><span class="op" id="3282496">,</span>&nbsp;<span class="op" id="3282498">[</span><span class="op" id="3282499">]</span><span class="builtintype" id="3282500">string</span><span class="op" id="3282506">{</span><span class="ident" id="3282507">head</span><span class="op" id="3282511">}</span><span class="op" id="3282512">}</span><span class="op" id="3282513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3282519">i</span>&nbsp;<span class="op" id="3282521">+=</span>&nbsp;<span class="num" id="3282524">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3282530">lastWasHeading</span>&nbsp;<span class="op" id="3282545">=</span>&nbsp;<span class="builtintype" id="3282547">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3282556">continue</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3282568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3282572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3282577">//&nbsp;open&nbsp;paragraph</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3282597">lastWasBlank</span>&nbsp;<span class="op" id="3282610">=</span>&nbsp;<span class="builtintype" id="3282612">false</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3282620">lastWasHeading</span>&nbsp;<span class="op" id="3282635">=</span>&nbsp;<span class="builtintype" id="3282637">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3282645">para</span>&nbsp;<span class="op" id="3282650">=</span>&nbsp;<span class="builtinfunc" id="3282652">append</span><span class="op" id="3282658">(</span><span class="ident" id="3282659">para</span><span class="op" id="3282663">,</span>&nbsp;<span class="ident" id="3282665">lines</span><span class="op" id="3282670">[</span><span class="ident" id="3282671">i</span><span class="op" id="3282672">]</span><span class="op" id="3282673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3282677">i</span><span class="op" id="3282678">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3282682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3282685">close</span><span class="op" id="3282690">(</span><span class="op" id="3282691">)</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3282695">return</span>&nbsp;<span class="ident" id="3282702">out</span><br>
<span class="lineno"></span><span class="op" id="3282706">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3282709">//&nbsp;ToText&nbsp;prepares&nbsp;comment&nbsp;text&nbsp;for&nbsp;presentation&nbsp;in&nbsp;textual&nbsp;output.</span><br>
<span class="lineno">400</span><span class="comment" id="3282777">//&nbsp;It&nbsp;wraps&nbsp;paragraphs&nbsp;of&nbsp;text&nbsp;to&nbsp;width&nbsp;or&nbsp;fewer&nbsp;Unicode&nbsp;code&nbsp;points</span><br>
<span class="lineno"></span><span class="comment" id="3282846">//&nbsp;and&nbsp;then&nbsp;prefixes&nbsp;each&nbsp;line&nbsp;with&nbsp;the&nbsp;indent.&nbsp;&nbsp;In&nbsp;preformatted&nbsp;sections</span><br>
<span class="lineno"></span><span class="comment" id="3282920">//&nbsp;(such&nbsp;as&nbsp;program&nbsp;text),&nbsp;it&nbsp;prefixes&nbsp;each&nbsp;non-blank&nbsp;line&nbsp;with&nbsp;preIndent.</span><br>
<span class="lineno"></span><span class="keyword" id="3282995">func</span>&nbsp;<span class="ident" id="3283000">ToText</span><span class="op" id="3283006">(</span><span class="ident" id="3283007">w</span>&nbsp;<span class="ident" id="3283009">io</span><span class="op" id="3283011">.</span><span class="ident" id="3283012">Writer</span><span class="op" id="3283018">,</span>&nbsp;<span class="ident" id="3283020">text</span>&nbsp;<span class="builtintype" id="3283025">string</span><span class="op" id="3283031">,</span>&nbsp;<span class="ident" id="3283033">indent</span><span class="op" id="3283039">,</span>&nbsp;<span class="ident" id="3283041">preIndent</span>&nbsp;<span class="builtintype" id="3283051">string</span><span class="op" id="3283057">,</span>&nbsp;<span class="ident" id="3283059">width</span>&nbsp;<span class="builtintype" id="3283065">int</span><span class="op" id="3283068">)</span>&nbsp;<span class="op" id="3283070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3283073">l</span>&nbsp;<span class="op" id="3283075">:=</span>&nbsp;<span class="ident" id="3283078">lineWrapper</span><span class="op" id="3283089">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3283093">out</span><span class="op" id="3283096">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3283101">w</span><span class="op" id="3283102">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3283106">width</span><span class="op" id="3283111">:</span>&nbsp;&nbsp;<span class="ident" id="3283114">width</span><span class="op" id="3283119">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3283123">indent</span><span class="op" id="3283129">:</span>&nbsp;<span class="ident" id="3283131">indent</span><span class="op" id="3283137">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3283140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3283143">for</span>&nbsp;<span class="ident" id="3283147">_</span><span class="op" id="3283148">,</span>&nbsp;<span class="ident" id="3283150">b</span>&nbsp;<span class="op" id="3283152">:=</span>&nbsp;<span class="keyword" id="3283155">range</span>&nbsp;<span class="ident" id="3283161">blocks</span><span class="op" id="3283167">(</span><span class="ident" id="3283168">text</span><span class="op" id="3283172">)</span>&nbsp;<span class="op" id="3283174">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3283178">switch</span>&nbsp;<span class="ident" id="3283185">b</span><span class="op" id="3283186">.</span><span class="ident" id="3283187">op</span>&nbsp;<span class="op" id="3283190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3283194">case</span>&nbsp;<span class="ident" id="3283199">opPara</span><span class="op" id="3283205">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3283210">//&nbsp;l.write&nbsp;will&nbsp;add&nbsp;leading&nbsp;newline&nbsp;if&nbsp;required</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3283261">for</span>&nbsp;<span class="ident" id="3283265">_</span><span class="op" id="3283266">,</span>&nbsp;<span class="ident" id="3283268">line</span>&nbsp;<span class="op" id="3283273">:=</span>&nbsp;<span class="keyword" id="3283276">range</span>&nbsp;<span class="ident" id="3283282">b</span><span class="op" id="3283283">.</span><span class="ident" id="3283284">lines</span>&nbsp;<span class="op" id="3283290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3283296">l</span><span class="op" id="3283297">.</span><span class="ident" id="3283298">write</span><span class="op" id="3283303">(</span><span class="ident" id="3283304">line</span><span class="op" id="3283308">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3283313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3283318">l</span><span class="op" id="3283319">.</span><span class="ident" id="3283320">flush</span><span class="op" id="3283325">(</span><span class="op" id="3283326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3283330">case</span>&nbsp;<span class="ident" id="3283335">opHead</span><span class="op" id="3283341">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3283346">w</span><span class="op" id="3283347">.</span><span class="ident" id="3283348">Write</span><span class="op" id="3283353">(</span><span class="ident" id="3283354">nl</span><span class="op" id="3283356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3283361">for</span>&nbsp;<span class="ident" id="3283365">_</span><span class="op" id="3283366">,</span>&nbsp;<span class="ident" id="3283368">line</span>&nbsp;<span class="op" id="3283373">:=</span>&nbsp;<span class="keyword" id="3283376">range</span>&nbsp;<span class="ident" id="3283382">b</span><span class="op" id="3283383">.</span><span class="ident" id="3283384">lines</span>&nbsp;<span class="op" id="3283390">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3283396">l</span><span class="op" id="3283397">.</span><span class="ident" id="3283398">write</span><span class="op" id="3283403">(</span><span class="ident" id="3283404">line</span>&nbsp;<span class="op" id="3283409">+</span>&nbsp;<span class="string" id="3283411">&#34;\n&#34;</span><span class="op" id="3283415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3283420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3283425">l</span><span class="op" id="3283426">.</span><span class="ident" id="3283427">flush</span><span class="op" id="3283432">(</span><span class="op" id="3283433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3283437">case</span>&nbsp;<span class="ident" id="3283442">opPre</span><span class="op" id="3283447">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3283452">w</span><span class="op" id="3283453">.</span><span class="ident" id="3283454">Write</span><span class="op" id="3283459">(</span><span class="ident" id="3283460">nl</span><span class="op" id="3283462">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3283467">for</span>&nbsp;<span class="ident" id="3283471">_</span><span class="op" id="3283472">,</span>&nbsp;<span class="ident" id="3283474">line</span>&nbsp;<span class="op" id="3283479">:=</span>&nbsp;<span class="keyword" id="3283482">range</span>&nbsp;<span class="ident" id="3283488">b</span><span class="op" id="3283489">.</span><span class="ident" id="3283490">lines</span>&nbsp;<span class="op" id="3283496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3283502">if</span>&nbsp;<span class="ident" id="3283505">isBlank</span><span class="op" id="3283512">(</span><span class="ident" id="3283513">line</span><span class="op" id="3283517">)</span>&nbsp;<span class="op" id="3283519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3283526">w</span><span class="op" id="3283527">.</span><span class="ident" id="3283528">Write</span><span class="op" id="3283533">(</span><span class="op" id="3283534">[</span><span class="op" id="3283535">]</span><span class="builtintype" id="3283536">byte</span><span class="op" id="3283540">(</span><span class="string" id="3283541">&#34;\n&#34;</span><span class="op" id="3283545">)</span><span class="op" id="3283546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3283552">}</span>&nbsp;<span class="keyword" id="3283554">else</span>&nbsp;<span class="op" id="3283559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3283566">w</span><span class="op" id="3283567">.</span><span class="ident" id="3283568">Write</span><span class="op" id="3283573">(</span><span class="op" id="3283574">[</span><span class="op" id="3283575">]</span><span class="builtintype" id="3283576">byte</span><span class="op" id="3283580">(</span><span class="ident" id="3283581">preIndent</span><span class="op" id="3283590">)</span><span class="op" id="3283591">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3283598">w</span><span class="op" id="3283599">.</span><span class="ident" id="3283600">Write</span><span class="op" id="3283605">(</span><span class="op" id="3283606">[</span><span class="op" id="3283607">]</span><span class="builtintype" id="3283608">byte</span><span class="op" id="3283612">(</span><span class="ident" id="3283613">line</span><span class="op" id="3283617">)</span><span class="op" id="3283618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3283624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3283629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3283633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3283636">}</span><br>
<span class="lineno">435</span><span class="op" id="3283638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3283641">type</span>&nbsp;<span class="ident" id="3283646">lineWrapper</span>&nbsp;<span class="keyword" id="3283658">struct</span>&nbsp;<span class="op" id="3283665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3283668">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3283678">io</span><span class="op" id="3283680">.</span><span class="ident" id="3283681">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3283689">printed</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3283699">bool</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3283705">width</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3283715">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3283720">indent</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3283730">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3283738">n</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3283748">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3283753">pendSpace</span>&nbsp;<span class="builtintype" id="3283763">int</span><br>
<span class="lineno"></span><span class="op" id="3283767">}</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span><span class="keyword" id="3283770">var</span>&nbsp;<span class="ident" id="3283774">nl</span>&nbsp;<span class="op" id="3283777">=</span>&nbsp;<span class="op" id="3283779">[</span><span class="op" id="3283780">]</span><span class="builtintype" id="3283781">byte</span><span class="op" id="3283785">(</span><span class="string" id="3283786">&#34;\n&#34;</span><span class="op" id="3283790">)</span><br>
<span class="lineno"></span><span class="keyword" id="3283792">var</span>&nbsp;<span class="ident" id="3283796">space</span>&nbsp;<span class="op" id="3283802">=</span>&nbsp;<span class="op" id="3283804">[</span><span class="op" id="3283805">]</span><span class="builtintype" id="3283806">byte</span><span class="op" id="3283810">(</span><span class="string" id="3283811">&#34;&nbsp;&#34;</span><span class="op" id="3283814">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3283817">func</span>&nbsp;<span class="op" id="3283822">(</span><span class="ident" id="3283823">l</span>&nbsp;<span class="op" id="3283825">*</span><span class="ident" id="3283826">lineWrapper</span><span class="op" id="3283837">)</span>&nbsp;<span class="ident" id="3283839">write</span><span class="op" id="3283844">(</span><span class="ident" id="3283845">text</span>&nbsp;<span class="builtintype" id="3283850">string</span><span class="op" id="3283856">)</span>&nbsp;<span class="op" id="3283858">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3283861">if</span>&nbsp;<span class="ident" id="3283864">l</span><span class="op" id="3283865">.</span><span class="ident" id="3283866">n</span>&nbsp;<span class="op" id="3283868">==</span>&nbsp;<span class="num" id="3283871">0</span>&nbsp;<span class="op" id="3283873">&amp;&amp;</span>&nbsp;<span class="ident" id="3283876">l</span><span class="op" id="3283877">.</span><span class="ident" id="3283878">printed</span>&nbsp;<span class="op" id="3283886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3283890">l</span><span class="op" id="3283891">.</span><span class="ident" id="3283892">out</span><span class="op" id="3283895">.</span><span class="ident" id="3283896">Write</span><span class="op" id="3283901">(</span><span class="ident" id="3283902">nl</span><span class="op" id="3283904">)</span>&nbsp;<span class="comment" id="3283906">//&nbsp;blank&nbsp;line&nbsp;before&nbsp;new&nbsp;paragraph</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3283942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3283945">l</span><span class="op" id="3283946">.</span><span class="ident" id="3283947">printed</span>&nbsp;<span class="op" id="3283955">=</span>&nbsp;<span class="builtintype" id="3283957">true</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3283964">for</span>&nbsp;<span class="ident" id="3283968">_</span><span class="op" id="3283969">,</span>&nbsp;<span class="ident" id="3283971">f</span>&nbsp;<span class="op" id="3283973">:=</span>&nbsp;<span class="keyword" id="3283976">range</span>&nbsp;<span class="ident" id="3283982">strings</span><span class="op" id="3283989">.</span><span class="ident" id="3283990">Fields</span><span class="op" id="3283996">(</span><span class="ident" id="3283997">text</span><span class="op" id="3284001">)</span>&nbsp;<span class="op" id="3284003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3284007">w</span>&nbsp;<span class="op" id="3284009">:=</span>&nbsp;<span class="ident" id="3284012">utf8</span><span class="op" id="3284016">.</span><span class="ident" id="3284017">RuneCountInString</span><span class="op" id="3284034">(</span><span class="ident" id="3284035">f</span><span class="op" id="3284036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3284040">//&nbsp;wrap&nbsp;if&nbsp;line&nbsp;is&nbsp;too&nbsp;long</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3284070">if</span>&nbsp;<span class="ident" id="3284073">l</span><span class="op" id="3284074">.</span><span class="ident" id="3284075">n</span>&nbsp;<span class="op" id="3284077">&gt;</span>&nbsp;<span class="num" id="3284079">0</span>&nbsp;<span class="op" id="3284081">&amp;&amp;</span>&nbsp;<span class="ident" id="3284084">l</span><span class="op" id="3284085">.</span><span class="ident" id="3284086">n</span><span class="op" id="3284087">+</span><span class="ident" id="3284088">l</span><span class="op" id="3284089">.</span><span class="ident" id="3284090">pendSpace</span><span class="op" id="3284099">+</span><span class="ident" id="3284100">w</span>&nbsp;<span class="op" id="3284102">&gt;</span>&nbsp;<span class="ident" id="3284104">l</span><span class="op" id="3284105">.</span><span class="ident" id="3284106">width</span>&nbsp;<span class="op" id="3284112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3284117">l</span><span class="op" id="3284118">.</span><span class="ident" id="3284119">out</span><span class="op" id="3284122">.</span><span class="ident" id="3284123">Write</span><span class="op" id="3284128">(</span><span class="ident" id="3284129">nl</span><span class="op" id="3284131">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3284136">l</span><span class="op" id="3284137">.</span><span class="ident" id="3284138">n</span>&nbsp;<span class="op" id="3284140">=</span>&nbsp;<span class="num" id="3284142">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3284147">l</span><span class="op" id="3284148">.</span><span class="ident" id="3284149">pendSpace</span>&nbsp;<span class="op" id="3284159">=</span>&nbsp;<span class="num" id="3284161">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3284165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3284169">if</span>&nbsp;<span class="ident" id="3284172">l</span><span class="op" id="3284173">.</span><span class="ident" id="3284174">n</span>&nbsp;<span class="op" id="3284176">==</span>&nbsp;<span class="num" id="3284179">0</span>&nbsp;<span class="op" id="3284181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3284186">l</span><span class="op" id="3284187">.</span><span class="ident" id="3284188">out</span><span class="op" id="3284191">.</span><span class="ident" id="3284192">Write</span><span class="op" id="3284197">(</span><span class="op" id="3284198">[</span><span class="op" id="3284199">]</span><span class="builtintype" id="3284200">byte</span><span class="op" id="3284204">(</span><span class="ident" id="3284205">l</span><span class="op" id="3284206">.</span><span class="ident" id="3284207">indent</span><span class="op" id="3284213">)</span><span class="op" id="3284214">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3284218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3284222">l</span><span class="op" id="3284223">.</span><span class="ident" id="3284224">out</span><span class="op" id="3284227">.</span><span class="ident" id="3284228">Write</span><span class="op" id="3284233">(</span><span class="ident" id="3284234">space</span><span class="op" id="3284239">[</span><span class="op" id="3284240">:</span><span class="ident" id="3284241">l</span><span class="op" id="3284242">.</span><span class="ident" id="3284243">pendSpace</span><span class="op" id="3284252">]</span><span class="op" id="3284253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3284257">l</span><span class="op" id="3284258">.</span><span class="ident" id="3284259">out</span><span class="op" id="3284262">.</span><span class="ident" id="3284263">Write</span><span class="op" id="3284268">(</span><span class="op" id="3284269">[</span><span class="op" id="3284270">]</span><span class="builtintype" id="3284271">byte</span><span class="op" id="3284275">(</span><span class="ident" id="3284276">f</span><span class="op" id="3284277">)</span><span class="op" id="3284278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3284282">l</span><span class="op" id="3284283">.</span><span class="ident" id="3284284">n</span>&nbsp;<span class="op" id="3284286">+=</span>&nbsp;<span class="ident" id="3284289">l</span><span class="op" id="3284290">.</span><span class="ident" id="3284291">pendSpace</span>&nbsp;<span class="op" id="3284301">+</span>&nbsp;<span class="ident" id="3284303">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3284307">l</span><span class="op" id="3284308">.</span><span class="ident" id="3284309">pendSpace</span>&nbsp;<span class="op" id="3284319">=</span>&nbsp;<span class="num" id="3284321">1</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3284324">}</span><br>
<span class="lineno"></span><span class="op" id="3284326">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3284329">func</span>&nbsp;<span class="op" id="3284334">(</span><span class="ident" id="3284335">l</span>&nbsp;<span class="op" id="3284337">*</span><span class="ident" id="3284338">lineWrapper</span><span class="op" id="3284349">)</span>&nbsp;<span class="ident" id="3284351">flush</span><span class="op" id="3284356">(</span><span class="op" id="3284357">)</span>&nbsp;<span class="op" id="3284359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3284362">if</span>&nbsp;<span class="ident" id="3284365">l</span><span class="op" id="3284366">.</span><span class="ident" id="3284367">n</span>&nbsp;<span class="op" id="3284369">==</span>&nbsp;<span class="num" id="3284372">0</span>&nbsp;<span class="op" id="3284374">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3284378">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3284386">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3284389">l</span><span class="op" id="3284390">.</span><span class="ident" id="3284391">out</span><span class="op" id="3284394">.</span><span class="ident" id="3284395">Write</span><span class="op" id="3284400">(</span><span class="ident" id="3284401">nl</span><span class="op" id="3284403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3284406">l</span><span class="op" id="3284407">.</span><span class="ident" id="3284408">pendSpace</span>&nbsp;<span class="op" id="3284418">=</span>&nbsp;<span class="num" id="3284420">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3284423">l</span><span class="op" id="3284424">.</span><span class="ident" id="3284425">n</span>&nbsp;<span class="op" id="3284427">=</span>&nbsp;<span class="num" id="3284429">0</span><br>
<span class="lineno">480</span><span class="op" id="3284431">}</span>
</div>
</body>
</html>
