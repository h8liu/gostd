<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/smtp</h2>
<ul>
<li><a href="/gostd/net/smtp/auth.go.html">auth.go</a></li>
<li><a href="/gostd/net/smtp/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/smtp/smtp.go.html">smtp.go</a></li>
<li><a href="/gostd/net/smtp/smtp_test.go.html">smtp_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5647571">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5647626">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5647680">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5647731">package</span>&nbsp;<span class="ident" id="5647739">smtp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5647745">import</span>&nbsp;<span class="op" id="5647752">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5647755">&#34;crypto/hmac&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5647770">&#34;crypto/md5&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5647784">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5647794">&#34;fmt&#34;</span><br>
<span class="lineno"></span><span class="op" id="5647800">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5647803">//&nbsp;Auth&nbsp;is&nbsp;implemented&nbsp;by&nbsp;an&nbsp;SMTP&nbsp;authentication&nbsp;mechanism.</span><br>
<span class="lineno">15</span><span class="keyword" id="5647863">type</span>&nbsp;<span class="ident" id="5647868">Auth</span>&nbsp;<span class="keyword" id="5647873">interface</span>&nbsp;<span class="op" id="5647883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5647886">//&nbsp;Start&nbsp;begins&nbsp;an&nbsp;authentication&nbsp;with&nbsp;a&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5647936">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;authentication&nbsp;protocol</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5647991">//&nbsp;and&nbsp;optionally&nbsp;data&nbsp;to&nbsp;include&nbsp;in&nbsp;the&nbsp;initial&nbsp;AUTH&nbsp;message</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5648054">//&nbsp;sent&nbsp;to&nbsp;the&nbsp;server.&nbsp;It&nbsp;can&nbsp;return&nbsp;proto&nbsp;==&nbsp;&#34;&#34;&nbsp;to&nbsp;indicate</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5648116">//&nbsp;that&nbsp;the&nbsp;authentication&nbsp;should&nbsp;be&nbsp;skipped.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5648163">//&nbsp;If&nbsp;it&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;error,&nbsp;the&nbsp;SMTP&nbsp;client&nbsp;aborts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5648221">//&nbsp;the&nbsp;authentication&nbsp;attempt&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5648279">Start</span><span class="op" id="5648284">(</span><span class="ident" id="5648285">server</span>&nbsp;<span class="op" id="5648292">*</span><span class="ident" id="5648293">ServerInfo</span><span class="op" id="5648303">)</span>&nbsp;<span class="op" id="5648305">(</span><span class="ident" id="5648306">proto</span>&nbsp;<span class="builtintype" id="5648312">string</span><span class="op" id="5648318">,</span>&nbsp;<span class="ident" id="5648320">toServer</span>&nbsp;<span class="op" id="5648329">[</span><span class="op" id="5648330">]</span><span class="builtintype" id="5648331">byte</span><span class="op" id="5648335">,</span>&nbsp;<span class="ident" id="5648337">err</span>&nbsp;<span class="builtintype" id="5648341">error</span><span class="op" id="5648346">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5648350">//&nbsp;Next&nbsp;continues&nbsp;the&nbsp;authentication.&nbsp;The&nbsp;server&nbsp;has&nbsp;just&nbsp;sent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5648414">//&nbsp;the&nbsp;fromServer&nbsp;data.&nbsp;If&nbsp;more&nbsp;is&nbsp;true,&nbsp;the&nbsp;server&nbsp;expects&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5648477">//&nbsp;response,&nbsp;which&nbsp;Next&nbsp;should&nbsp;return&nbsp;as&nbsp;toServer;&nbsp;otherwise</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5648539">//&nbsp;Next&nbsp;should&nbsp;return&nbsp;toServer&nbsp;==&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5648579">//&nbsp;If&nbsp;Next&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;error,&nbsp;the&nbsp;SMTP&nbsp;client&nbsp;aborts</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5648639">//&nbsp;the&nbsp;authentication&nbsp;attempt&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5648697">Next</span><span class="op" id="5648701">(</span><span class="ident" id="5648702">fromServer</span>&nbsp;<span class="op" id="5648713">[</span><span class="op" id="5648714">]</span><span class="builtintype" id="5648715">byte</span><span class="op" id="5648719">,</span>&nbsp;<span class="ident" id="5648721">more</span>&nbsp;<span class="builtintype" id="5648726">bool</span><span class="op" id="5648730">)</span>&nbsp;<span class="op" id="5648732">(</span><span class="ident" id="5648733">toServer</span>&nbsp;<span class="op" id="5648742">[</span><span class="op" id="5648743">]</span><span class="builtintype" id="5648744">byte</span><span class="op" id="5648748">,</span>&nbsp;<span class="ident" id="5648750">err</span>&nbsp;<span class="builtintype" id="5648754">error</span><span class="op" id="5648759">)</span><br>
<span class="lineno"></span><span class="op" id="5648761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5648764">//&nbsp;ServerInfo&nbsp;records&nbsp;information&nbsp;about&nbsp;an&nbsp;SMTP&nbsp;server.</span><br>
<span class="lineno">35</span><span class="keyword" id="5648820">type</span>&nbsp;<span class="ident" id="5648825">ServerInfo</span>&nbsp;<span class="keyword" id="5648836">struct</span>&nbsp;<span class="op" id="5648843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5648846">Name</span>&nbsp;<span class="builtintype" id="5648851">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5648860">//&nbsp;SMTP&nbsp;server&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5648881">TLS</span>&nbsp;&nbsp;<span class="builtintype" id="5648886">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5648895">//&nbsp;using&nbsp;TLS,&nbsp;with&nbsp;valid&nbsp;certificate&nbsp;for&nbsp;Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5648942">Auth</span>&nbsp;<span class="op" id="5648947">[</span><span class="op" id="5648948">]</span><span class="builtintype" id="5648949">string</span>&nbsp;<span class="comment" id="5648956">//&nbsp;advertised&nbsp;authentication&nbsp;mechanisms</span><br>
<span class="lineno"></span><span class="op" id="5648996">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="5648999">type</span>&nbsp;<span class="ident" id="5649004">plainAuth</span>&nbsp;<span class="keyword" id="5649014">struct</span>&nbsp;<span class="op" id="5649021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5649024">identity</span><span class="op" id="5649032">,</span>&nbsp;<span class="ident" id="5649034">username</span><span class="op" id="5649042">,</span>&nbsp;<span class="ident" id="5649044">password</span>&nbsp;<span class="builtintype" id="5649053">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5649061">host</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5649090">string</span><br>
<span class="lineno"></span><span class="op" id="5649097">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="5649100">//&nbsp;PlainAuth&nbsp;returns&nbsp;an&nbsp;Auth&nbsp;that&nbsp;implements&nbsp;the&nbsp;PLAIN&nbsp;authentication</span><br>
<span class="lineno"></span><span class="comment" id="5649170">//&nbsp;mechanism&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4616.</span><br>
<span class="lineno"></span><span class="comment" id="5649207">//&nbsp;The&nbsp;returned&nbsp;Auth&nbsp;uses&nbsp;the&nbsp;given&nbsp;username&nbsp;and&nbsp;password&nbsp;to&nbsp;authenticate</span><br>
<span class="lineno"></span><span class="comment" id="5649281">//&nbsp;on&nbsp;TLS&nbsp;connections&nbsp;to&nbsp;host&nbsp;and&nbsp;act&nbsp;as&nbsp;identity.&nbsp;Usually&nbsp;identity&nbsp;will&nbsp;be</span><br>
<span class="lineno">50</span><span class="comment" id="5649357">//&nbsp;left&nbsp;blank&nbsp;to&nbsp;act&nbsp;as&nbsp;username.</span><br>
<span class="lineno"></span><span class="keyword" id="5649391">func</span>&nbsp;<span class="ident" id="5649396">PlainAuth</span><span class="op" id="5649405">(</span><span class="ident" id="5649406">identity</span><span class="op" id="5649414">,</span>&nbsp;<span class="ident" id="5649416">username</span><span class="op" id="5649424">,</span>&nbsp;<span class="ident" id="5649426">password</span><span class="op" id="5649434">,</span>&nbsp;<span class="ident" id="5649436">host</span>&nbsp;<span class="builtintype" id="5649441">string</span><span class="op" id="5649447">)</span>&nbsp;<span class="ident" id="5649449">Auth</span>&nbsp;<span class="op" id="5649454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5649457">return</span>&nbsp;<span class="op" id="5649464">&amp;</span><span class="ident" id="5649465">plainAuth</span><span class="op" id="5649474">{</span><span class="ident" id="5649475">identity</span><span class="op" id="5649483">,</span>&nbsp;<span class="ident" id="5649485">username</span><span class="op" id="5649493">,</span>&nbsp;<span class="ident" id="5649495">password</span><span class="op" id="5649503">,</span>&nbsp;<span class="ident" id="5649505">host</span><span class="op" id="5649509">}</span><br>
<span class="lineno"></span><span class="op" id="5649511">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="5649514">func</span>&nbsp;<span class="op" id="5649519">(</span><span class="ident" id="5649520">a</span>&nbsp;<span class="op" id="5649522">*</span><span class="ident" id="5649523">plainAuth</span><span class="op" id="5649532">)</span>&nbsp;<span class="ident" id="5649534">Start</span><span class="op" id="5649539">(</span><span class="ident" id="5649540">server</span>&nbsp;<span class="op" id="5649547">*</span><span class="ident" id="5649548">ServerInfo</span><span class="op" id="5649558">)</span>&nbsp;<span class="op" id="5649560">(</span><span class="builtintype" id="5649561">string</span><span class="op" id="5649567">,</span>&nbsp;<span class="op" id="5649569">[</span><span class="op" id="5649570">]</span><span class="builtintype" id="5649571">byte</span><span class="op" id="5649575">,</span>&nbsp;<span class="builtintype" id="5649577">error</span><span class="op" id="5649582">)</span>&nbsp;<span class="op" id="5649584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5649587">if</span>&nbsp;<span class="op" id="5649590">!</span><span class="ident" id="5649591">server</span><span class="op" id="5649597">.</span><span class="ident" id="5649598">TLS</span>&nbsp;<span class="op" id="5649602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5649606">advertised</span>&nbsp;<span class="op" id="5649617">:=</span>&nbsp;<span class="builtintype" id="5649620">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5649628">for</span>&nbsp;<span class="ident" id="5649632">_</span><span class="op" id="5649633">,</span>&nbsp;<span class="ident" id="5649635">mechanism</span>&nbsp;<span class="op" id="5649645">:=</span>&nbsp;<span class="keyword" id="5649648">range</span>&nbsp;<span class="ident" id="5649654">server</span><span class="op" id="5649660">.</span><span class="ident" id="5649661">Auth</span>&nbsp;<span class="op" id="5649666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5649671">if</span>&nbsp;<span class="ident" id="5649674">mechanism</span>&nbsp;<span class="op" id="5649684">==</span>&nbsp;<span class="string" id="5649687">&#34;PLAIN&#34;</span>&nbsp;<span class="op" id="5649695">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5649701">advertised</span>&nbsp;<span class="op" id="5649712">=</span>&nbsp;<span class="builtintype" id="5649714">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5649723">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5649732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5649736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5649740">if</span>&nbsp;<span class="op" id="5649743">!</span><span class="ident" id="5649744">advertised</span>&nbsp;<span class="op" id="5649755">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5649760">return</span>&nbsp;<span class="string" id="5649767">&#34;&#34;</span><span class="op" id="5649769">,</span>&nbsp;<span class="ident" id="5649771">nil</span><span class="op" id="5649774">,</span>&nbsp;<span class="ident" id="5649776">errors</span><span class="op" id="5649782">.</span><span class="ident" id="5649783">New</span><span class="op" id="5649786">(</span><span class="string" id="5649787">&#34;unencrypted&nbsp;connection&#34;</span><span class="op" id="5649811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5649815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5649818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5649821">if</span>&nbsp;<span class="ident" id="5649824">server</span><span class="op" id="5649830">.</span><span class="ident" id="5649831">Name</span>&nbsp;<span class="op" id="5649836">!=</span>&nbsp;<span class="ident" id="5649839">a</span><span class="op" id="5649840">.</span><span class="ident" id="5649841">host</span>&nbsp;<span class="op" id="5649846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5649850">return</span>&nbsp;<span class="string" id="5649857">&#34;&#34;</span><span class="op" id="5649859">,</span>&nbsp;<span class="ident" id="5649861">nil</span><span class="op" id="5649864">,</span>&nbsp;<span class="ident" id="5649866">errors</span><span class="op" id="5649872">.</span><span class="ident" id="5649873">New</span><span class="op" id="5649876">(</span><span class="string" id="5649877">&#34;wrong&nbsp;host&nbsp;name&#34;</span><span class="op" id="5649894">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5649897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5649900">resp</span>&nbsp;<span class="op" id="5649905">:=</span>&nbsp;<span class="op" id="5649908">[</span><span class="op" id="5649909">]</span><span class="builtintype" id="5649910">byte</span><span class="op" id="5649914">(</span><span class="ident" id="5649915">a</span><span class="op" id="5649916">.</span><span class="ident" id="5649917">identity</span>&nbsp;<span class="op" id="5649926">+</span>&nbsp;<span class="string" id="5649928">&#34;\x00&#34;</span>&nbsp;<span class="op" id="5649935">+</span>&nbsp;<span class="ident" id="5649937">a</span><span class="op" id="5649938">.</span><span class="ident" id="5649939">username</span>&nbsp;<span class="op" id="5649948">+</span>&nbsp;<span class="string" id="5649950">&#34;\x00&#34;</span>&nbsp;<span class="op" id="5649957">+</span>&nbsp;<span class="ident" id="5649959">a</span><span class="op" id="5649960">.</span><span class="ident" id="5649961">password</span><span class="op" id="5649969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5649972">return</span>&nbsp;<span class="string" id="5649979">&#34;PLAIN&#34;</span><span class="op" id="5649986">,</span>&nbsp;<span class="ident" id="5649988">resp</span><span class="op" id="5649992">,</span>&nbsp;<span class="ident" id="5649994">nil</span><br>
<span class="lineno"></span><span class="op" id="5649998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="5650001">func</span>&nbsp;<span class="op" id="5650006">(</span><span class="ident" id="5650007">a</span>&nbsp;<span class="op" id="5650009">*</span><span class="ident" id="5650010">plainAuth</span><span class="op" id="5650019">)</span>&nbsp;<span class="ident" id="5650021">Next</span><span class="op" id="5650025">(</span><span class="ident" id="5650026">fromServer</span>&nbsp;<span class="op" id="5650037">[</span><span class="op" id="5650038">]</span><span class="builtintype" id="5650039">byte</span><span class="op" id="5650043">,</span>&nbsp;<span class="ident" id="5650045">more</span>&nbsp;<span class="builtintype" id="5650050">bool</span><span class="op" id="5650054">)</span>&nbsp;<span class="op" id="5650056">(</span><span class="op" id="5650057">[</span><span class="op" id="5650058">]</span><span class="builtintype" id="5650059">byte</span><span class="op" id="5650063">,</span>&nbsp;<span class="builtintype" id="5650065">error</span><span class="op" id="5650070">)</span>&nbsp;<span class="op" id="5650072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5650075">if</span>&nbsp;<span class="ident" id="5650078">more</span>&nbsp;<span class="op" id="5650083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5650087">//&nbsp;We&#39;ve&nbsp;already&nbsp;sent&nbsp;everything.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5650123">return</span>&nbsp;<span class="ident" id="5650130">nil</span><span class="op" id="5650133">,</span>&nbsp;<span class="ident" id="5650135">errors</span><span class="op" id="5650141">.</span><span class="ident" id="5650142">New</span><span class="op" id="5650145">(</span><span class="string" id="5650146">&#34;unexpected&nbsp;server&nbsp;challenge&#34;</span><span class="op" id="5650175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5650178">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5650181">return</span>&nbsp;<span class="ident" id="5650188">nil</span><span class="op" id="5650191">,</span>&nbsp;<span class="ident" id="5650193">nil</span><br>
<span class="lineno"></span><span class="op" id="5650197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5650200">type</span>&nbsp;<span class="ident" id="5650205">cramMD5Auth</span>&nbsp;<span class="keyword" id="5650217">struct</span>&nbsp;<span class="op" id="5650224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5650227">username</span><span class="op" id="5650235">,</span>&nbsp;<span class="ident" id="5650237">secret</span>&nbsp;<span class="builtintype" id="5650244">string</span><br>
<span class="lineno">85</span><span class="op" id="5650251">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5650254">//&nbsp;CRAMMD5Auth&nbsp;returns&nbsp;an&nbsp;Auth&nbsp;that&nbsp;implements&nbsp;the&nbsp;CRAM-MD5&nbsp;authentication</span><br>
<span class="lineno"></span><span class="comment" id="5650329">//&nbsp;mechanism&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;2195.</span><br>
<span class="lineno"></span><span class="comment" id="5650366">//&nbsp;The&nbsp;returned&nbsp;Auth&nbsp;uses&nbsp;the&nbsp;given&nbsp;username&nbsp;and&nbsp;secret&nbsp;to&nbsp;authenticate</span><br>
<span class="lineno">90</span><span class="comment" id="5650438">//&nbsp;to&nbsp;the&nbsp;server&nbsp;using&nbsp;the&nbsp;challenge-response&nbsp;mechanism.</span><br>
<span class="lineno"></span><span class="keyword" id="5650495">func</span>&nbsp;<span class="ident" id="5650500">CRAMMD5Auth</span><span class="op" id="5650511">(</span><span class="ident" id="5650512">username</span><span class="op" id="5650520">,</span>&nbsp;<span class="ident" id="5650522">secret</span>&nbsp;<span class="builtintype" id="5650529">string</span><span class="op" id="5650535">)</span>&nbsp;<span class="ident" id="5650537">Auth</span>&nbsp;<span class="op" id="5650542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5650545">return</span>&nbsp;<span class="op" id="5650552">&amp;</span><span class="ident" id="5650553">cramMD5Auth</span><span class="op" id="5650564">{</span><span class="ident" id="5650565">username</span><span class="op" id="5650573">,</span>&nbsp;<span class="ident" id="5650575">secret</span><span class="op" id="5650581">}</span><br>
<span class="lineno"></span><span class="op" id="5650583">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="5650586">func</span>&nbsp;<span class="op" id="5650591">(</span><span class="ident" id="5650592">a</span>&nbsp;<span class="op" id="5650594">*</span><span class="ident" id="5650595">cramMD5Auth</span><span class="op" id="5650606">)</span>&nbsp;<span class="ident" id="5650608">Start</span><span class="op" id="5650613">(</span><span class="ident" id="5650614">server</span>&nbsp;<span class="op" id="5650621">*</span><span class="ident" id="5650622">ServerInfo</span><span class="op" id="5650632">)</span>&nbsp;<span class="op" id="5650634">(</span><span class="builtintype" id="5650635">string</span><span class="op" id="5650641">,</span>&nbsp;<span class="op" id="5650643">[</span><span class="op" id="5650644">]</span><span class="builtintype" id="5650645">byte</span><span class="op" id="5650649">,</span>&nbsp;<span class="builtintype" id="5650651">error</span><span class="op" id="5650656">)</span>&nbsp;<span class="op" id="5650658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5650661">return</span>&nbsp;<span class="string" id="5650668">&#34;CRAM-MD5&#34;</span><span class="op" id="5650678">,</span>&nbsp;<span class="ident" id="5650680">nil</span><span class="op" id="5650683">,</span>&nbsp;<span class="ident" id="5650685">nil</span><br>
<span class="lineno"></span><span class="op" id="5650689">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5650692">func</span>&nbsp;<span class="op" id="5650697">(</span><span class="ident" id="5650698">a</span>&nbsp;<span class="op" id="5650700">*</span><span class="ident" id="5650701">cramMD5Auth</span><span class="op" id="5650712">)</span>&nbsp;<span class="ident" id="5650714">Next</span><span class="op" id="5650718">(</span><span class="ident" id="5650719">fromServer</span>&nbsp;<span class="op" id="5650730">[</span><span class="op" id="5650731">]</span><span class="builtintype" id="5650732">byte</span><span class="op" id="5650736">,</span>&nbsp;<span class="ident" id="5650738">more</span>&nbsp;<span class="builtintype" id="5650743">bool</span><span class="op" id="5650747">)</span>&nbsp;<span class="op" id="5650749">(</span><span class="op" id="5650750">[</span><span class="op" id="5650751">]</span><span class="builtintype" id="5650752">byte</span><span class="op" id="5650756">,</span>&nbsp;<span class="builtintype" id="5650758">error</span><span class="op" id="5650763">)</span>&nbsp;<span class="op" id="5650765">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5650768">if</span>&nbsp;<span class="ident" id="5650771">more</span>&nbsp;<span class="op" id="5650776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5650780">d</span>&nbsp;<span class="op" id="5650782">:=</span>&nbsp;<span class="ident" id="5650785">hmac</span><span class="op" id="5650789">.</span><span class="ident" id="5650790">New</span><span class="op" id="5650793">(</span><span class="ident" id="5650794">md5</span><span class="op" id="5650797">.</span><span class="ident" id="5650798">New</span><span class="op" id="5650801">,</span>&nbsp;<span class="op" id="5650803">[</span><span class="op" id="5650804">]</span><span class="builtintype" id="5650805">byte</span><span class="op" id="5650809">(</span><span class="ident" id="5650810">a</span><span class="op" id="5650811">.</span><span class="ident" id="5650812">secret</span><span class="op" id="5650818">)</span><span class="op" id="5650819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5650823">d</span><span class="op" id="5650824">.</span><span class="ident" id="5650825">Write</span><span class="op" id="5650830">(</span><span class="ident" id="5650831">fromServer</span><span class="op" id="5650841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5650845">s</span>&nbsp;<span class="op" id="5650847">:=</span>&nbsp;<span class="builtinfunc" id="5650850">make</span><span class="op" id="5650854">(</span><span class="op" id="5650855">[</span><span class="op" id="5650856">]</span><span class="builtintype" id="5650857">byte</span><span class="op" id="5650861">,</span>&nbsp;<span class="num" id="5650863">0</span><span class="op" id="5650864">,</span>&nbsp;<span class="ident" id="5650866">d</span><span class="op" id="5650867">.</span><span class="ident" id="5650868">Size</span><span class="op" id="5650872">(</span><span class="op" id="5650873">)</span><span class="op" id="5650874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5650878">return</span>&nbsp;<span class="op" id="5650885">[</span><span class="op" id="5650886">]</span><span class="builtintype" id="5650887">byte</span><span class="op" id="5650891">(</span><span class="ident" id="5650892">fmt</span><span class="op" id="5650895">.</span><span class="ident" id="5650896">Sprintf</span><span class="op" id="5650903">(</span><span class="string" id="5650904">&#34;%s&nbsp;%x&#34;</span><span class="op" id="5650911">,</span>&nbsp;<span class="ident" id="5650913">a</span><span class="op" id="5650914">.</span><span class="ident" id="5650915">username</span><span class="op" id="5650923">,</span>&nbsp;<span class="ident" id="5650925">d</span><span class="op" id="5650926">.</span><span class="ident" id="5650927">Sum</span><span class="op" id="5650930">(</span><span class="ident" id="5650931">s</span><span class="op" id="5650932">)</span><span class="op" id="5650933">)</span><span class="op" id="5650934">)</span><span class="op" id="5650935">,</span>&nbsp;<span class="ident" id="5650937">nil</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5650942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5650945">return</span>&nbsp;<span class="ident" id="5650952">nil</span><span class="op" id="5650955">,</span>&nbsp;<span class="ident" id="5650957">nil</span><br>
<span class="lineno"></span><span class="op" id="5650961">}</span>
</div>
</body>
</html>
