<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3758246">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3758301">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3758355">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3758406">package</span>&nbsp;<span class="ident" id="3758414">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3758419">import</span>&nbsp;<span class="op" id="3758426">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3758429">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3758438">&#34;crypto/aes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3758452">&#34;crypto/cipher&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3758469">&#34;crypto/hmac&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3758484">&#34;crypto/sha256&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3758501">&#34;crypto/subtle&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3758518">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3758528">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="3758533">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3758536">//&nbsp;sessionState&nbsp;contains&nbsp;the&nbsp;information&nbsp;that&nbsp;is&nbsp;serialized&nbsp;into&nbsp;a&nbsp;session</span><br>
<span class="lineno"></span><span class="comment" id="3758611">//&nbsp;ticket&nbsp;in&nbsp;order&nbsp;to&nbsp;later&nbsp;resume&nbsp;a&nbsp;connection.</span><br>
<span class="lineno">20</span><span class="keyword" id="3758660">type</span>&nbsp;<span class="ident" id="3758665">sessionState</span>&nbsp;<span class="keyword" id="3758678">struct</span>&nbsp;<span class="op" id="3758685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3758688">vers</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3758701">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3758709">cipherSuite</span>&nbsp;&nbsp;<span class="builtintype" id="3758722">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3758730">masterSecret</span>&nbsp;<span class="op" id="3758743">[</span><span class="op" id="3758744">]</span><span class="builtintype" id="3758745">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3758751">certificates</span>&nbsp;<span class="op" id="3758764">[</span><span class="op" id="3758765">]</span><span class="op" id="3758766">[</span><span class="op" id="3758767">]</span><span class="builtintype" id="3758768">byte</span><br>
<span class="lineno">25</span><span class="op" id="3758773">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3758776">func</span>&nbsp;<span class="op" id="3758781">(</span><span class="ident" id="3758782">s</span>&nbsp;<span class="op" id="3758784">*</span><span class="ident" id="3758785">sessionState</span><span class="op" id="3758797">)</span>&nbsp;<span class="ident" id="3758799">equal</span><span class="op" id="3758804">(</span><span class="ident" id="3758805">i</span>&nbsp;<span class="keyword" id="3758807">interface</span><span class="op" id="3758816">{</span><span class="op" id="3758817">}</span><span class="op" id="3758818">)</span>&nbsp;<span class="builtintype" id="3758820">bool</span>&nbsp;<span class="op" id="3758825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3758828">s1</span><span class="op" id="3758830">,</span>&nbsp;<span class="ident" id="3758832">ok</span>&nbsp;<span class="op" id="3758835">:=</span>&nbsp;<span class="ident" id="3758838">i</span><span class="op" id="3758839">.</span><span class="op" id="3758840">(</span><span class="op" id="3758841">*</span><span class="ident" id="3758842">sessionState</span><span class="op" id="3758854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3758857">if</span>&nbsp;<span class="op" id="3758860">!</span><span class="ident" id="3758861">ok</span>&nbsp;<span class="op" id="3758864">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3758868">return</span>&nbsp;<span class="builtintype" id="3758875">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3758882">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3758886">if</span>&nbsp;<span class="ident" id="3758889">s</span><span class="op" id="3758890">.</span><span class="ident" id="3758891">vers</span>&nbsp;<span class="op" id="3758896">!=</span>&nbsp;<span class="ident" id="3758899">s1</span><span class="op" id="3758901">.</span><span class="ident" id="3758902">vers</span>&nbsp;<span class="op" id="3758907">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3758912">s</span><span class="op" id="3758913">.</span><span class="ident" id="3758914">cipherSuite</span>&nbsp;<span class="op" id="3758926">!=</span>&nbsp;<span class="ident" id="3758929">s1</span><span class="op" id="3758931">.</span><span class="ident" id="3758932">cipherSuite</span>&nbsp;<span class="op" id="3758944">||</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3758949">!</span><span class="ident" id="3758950">bytes</span><span class="op" id="3758955">.</span><span class="ident" id="3758956">Equal</span><span class="op" id="3758961">(</span><span class="ident" id="3758962">s</span><span class="op" id="3758963">.</span><span class="ident" id="3758964">masterSecret</span><span class="op" id="3758976">,</span>&nbsp;<span class="ident" id="3758978">s1</span><span class="op" id="3758980">.</span><span class="ident" id="3758981">masterSecret</span><span class="op" id="3758993">)</span>&nbsp;<span class="op" id="3758995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3758999">return</span>&nbsp;<span class="builtintype" id="3759006">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3759013">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3759017">if</span>&nbsp;<span class="builtinfunc" id="3759020">len</span><span class="op" id="3759023">(</span><span class="ident" id="3759024">s</span><span class="op" id="3759025">.</span><span class="ident" id="3759026">certificates</span><span class="op" id="3759038">)</span>&nbsp;<span class="op" id="3759040">!=</span>&nbsp;<span class="builtinfunc" id="3759043">len</span><span class="op" id="3759046">(</span><span class="ident" id="3759047">s1</span><span class="op" id="3759049">.</span><span class="ident" id="3759050">certificates</span><span class="op" id="3759062">)</span>&nbsp;<span class="op" id="3759064">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3759068">return</span>&nbsp;<span class="builtintype" id="3759075">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3759082">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3759086">for</span>&nbsp;<span class="ident" id="3759090">i</span>&nbsp;<span class="op" id="3759092">:=</span>&nbsp;<span class="keyword" id="3759095">range</span>&nbsp;<span class="ident" id="3759101">s</span><span class="op" id="3759102">.</span><span class="ident" id="3759103">certificates</span>&nbsp;<span class="op" id="3759116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3759120">if</span>&nbsp;<span class="op" id="3759123">!</span><span class="ident" id="3759124">bytes</span><span class="op" id="3759129">.</span><span class="ident" id="3759130">Equal</span><span class="op" id="3759135">(</span><span class="ident" id="3759136">s</span><span class="op" id="3759137">.</span><span class="ident" id="3759138">certificates</span><span class="op" id="3759150">[</span><span class="ident" id="3759151">i</span><span class="op" id="3759152">]</span><span class="op" id="3759153">,</span>&nbsp;<span class="ident" id="3759155">s1</span><span class="op" id="3759157">.</span><span class="ident" id="3759158">certificates</span><span class="op" id="3759170">[</span><span class="ident" id="3759171">i</span><span class="op" id="3759172">]</span><span class="op" id="3759173">)</span>&nbsp;<span class="op" id="3759175">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3759180">return</span>&nbsp;<span class="builtintype" id="3759187">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3759195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3759198">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3759202">return</span>&nbsp;<span class="builtintype" id="3759209">true</span><br>
<span class="lineno">50</span><span class="op" id="3759214">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3759217">func</span>&nbsp;<span class="op" id="3759222">(</span><span class="ident" id="3759223">s</span>&nbsp;<span class="op" id="3759225">*</span><span class="ident" id="3759226">sessionState</span><span class="op" id="3759238">)</span>&nbsp;<span class="ident" id="3759240">marshal</span><span class="op" id="3759247">(</span><span class="op" id="3759248">)</span>&nbsp;<span class="op" id="3759250">[</span><span class="op" id="3759251">]</span><span class="builtintype" id="3759252">byte</span>&nbsp;<span class="op" id="3759257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3759260">length</span>&nbsp;<span class="op" id="3759267">:=</span>&nbsp;<span class="num" id="3759270">2</span>&nbsp;<span class="op" id="3759272">+</span>&nbsp;<span class="num" id="3759274">2</span>&nbsp;<span class="op" id="3759276">+</span>&nbsp;<span class="num" id="3759278">2</span>&nbsp;<span class="op" id="3759280">+</span>&nbsp;<span class="builtinfunc" id="3759282">len</span><span class="op" id="3759285">(</span><span class="ident" id="3759286">s</span><span class="op" id="3759287">.</span><span class="ident" id="3759288">masterSecret</span><span class="op" id="3759300">)</span>&nbsp;<span class="op" id="3759302">+</span>&nbsp;<span class="num" id="3759304">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3759307">for</span>&nbsp;<span class="ident" id="3759311">_</span><span class="op" id="3759312">,</span>&nbsp;<span class="ident" id="3759314">cert</span>&nbsp;<span class="op" id="3759319">:=</span>&nbsp;<span class="keyword" id="3759322">range</span>&nbsp;<span class="ident" id="3759328">s</span><span class="op" id="3759329">.</span><span class="ident" id="3759330">certificates</span>&nbsp;<span class="op" id="3759343">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3759347">length</span>&nbsp;<span class="op" id="3759354">+=</span>&nbsp;<span class="num" id="3759357">4</span>&nbsp;<span class="op" id="3759359">+</span>&nbsp;<span class="builtinfunc" id="3759361">len</span><span class="op" id="3759364">(</span><span class="ident" id="3759365">cert</span><span class="op" id="3759369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3759372">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3759376">ret</span>&nbsp;<span class="op" id="3759380">:=</span>&nbsp;<span class="builtinfunc" id="3759383">make</span><span class="op" id="3759387">(</span><span class="op" id="3759388">[</span><span class="op" id="3759389">]</span><span class="builtintype" id="3759390">byte</span><span class="op" id="3759394">,</span>&nbsp;<span class="ident" id="3759396">length</span><span class="op" id="3759402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3759405">x</span>&nbsp;<span class="op" id="3759407">:=</span>&nbsp;<span class="ident" id="3759410">ret</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3759415">x</span><span class="op" id="3759416">[</span><span class="num" id="3759417">0</span><span class="op" id="3759418">]</span>&nbsp;<span class="op" id="3759420">=</span>&nbsp;<span class="builtintype" id="3759422">byte</span><span class="op" id="3759426">(</span><span class="ident" id="3759427">s</span><span class="op" id="3759428">.</span><span class="ident" id="3759429">vers</span>&nbsp;<span class="op" id="3759434">&gt;&gt;</span>&nbsp;<span class="num" id="3759437">8</span><span class="op" id="3759438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3759441">x</span><span class="op" id="3759442">[</span><span class="num" id="3759443">1</span><span class="op" id="3759444">]</span>&nbsp;<span class="op" id="3759446">=</span>&nbsp;<span class="builtintype" id="3759448">byte</span><span class="op" id="3759452">(</span><span class="ident" id="3759453">s</span><span class="op" id="3759454">.</span><span class="ident" id="3759455">vers</span><span class="op" id="3759459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3759462">x</span><span class="op" id="3759463">[</span><span class="num" id="3759464">2</span><span class="op" id="3759465">]</span>&nbsp;<span class="op" id="3759467">=</span>&nbsp;<span class="builtintype" id="3759469">byte</span><span class="op" id="3759473">(</span><span class="ident" id="3759474">s</span><span class="op" id="3759475">.</span><span class="ident" id="3759476">cipherSuite</span>&nbsp;<span class="op" id="3759488">&gt;&gt;</span>&nbsp;<span class="num" id="3759491">8</span><span class="op" id="3759492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3759495">x</span><span class="op" id="3759496">[</span><span class="num" id="3759497">3</span><span class="op" id="3759498">]</span>&nbsp;<span class="op" id="3759500">=</span>&nbsp;<span class="builtintype" id="3759502">byte</span><span class="op" id="3759506">(</span><span class="ident" id="3759507">s</span><span class="op" id="3759508">.</span><span class="ident" id="3759509">cipherSuite</span><span class="op" id="3759520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3759523">x</span><span class="op" id="3759524">[</span><span class="num" id="3759525">4</span><span class="op" id="3759526">]</span>&nbsp;<span class="op" id="3759528">=</span>&nbsp;<span class="builtintype" id="3759530">byte</span><span class="op" id="3759534">(</span><span class="builtinfunc" id="3759535">len</span><span class="op" id="3759538">(</span><span class="ident" id="3759539">s</span><span class="op" id="3759540">.</span><span class="ident" id="3759541">masterSecret</span><span class="op" id="3759553">)</span>&nbsp;<span class="op" id="3759555">&gt;&gt;</span>&nbsp;<span class="num" id="3759558">8</span><span class="op" id="3759559">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3759562">x</span><span class="op" id="3759563">[</span><span class="num" id="3759564">5</span><span class="op" id="3759565">]</span>&nbsp;<span class="op" id="3759567">=</span>&nbsp;<span class="builtintype" id="3759569">byte</span><span class="op" id="3759573">(</span><span class="builtinfunc" id="3759574">len</span><span class="op" id="3759577">(</span><span class="ident" id="3759578">s</span><span class="op" id="3759579">.</span><span class="ident" id="3759580">masterSecret</span><span class="op" id="3759592">)</span><span class="op" id="3759593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3759596">x</span>&nbsp;<span class="op" id="3759598">=</span>&nbsp;<span class="ident" id="3759600">x</span><span class="op" id="3759601">[</span><span class="num" id="3759602">6</span><span class="op" id="3759603">:</span><span class="op" id="3759604">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3759607">copy</span><span class="op" id="3759611">(</span><span class="ident" id="3759612">x</span><span class="op" id="3759613">,</span>&nbsp;<span class="ident" id="3759615">s</span><span class="op" id="3759616">.</span><span class="ident" id="3759617">masterSecret</span><span class="op" id="3759629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3759632">x</span>&nbsp;<span class="op" id="3759634">=</span>&nbsp;<span class="ident" id="3759636">x</span><span class="op" id="3759637">[</span><span class="builtinfunc" id="3759638">len</span><span class="op" id="3759641">(</span><span class="ident" id="3759642">s</span><span class="op" id="3759643">.</span><span class="ident" id="3759644">masterSecret</span><span class="op" id="3759656">)</span><span class="op" id="3759657">:</span><span class="op" id="3759658">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3759662">x</span><span class="op" id="3759663">[</span><span class="num" id="3759664">0</span><span class="op" id="3759665">]</span>&nbsp;<span class="op" id="3759667">=</span>&nbsp;<span class="builtintype" id="3759669">byte</span><span class="op" id="3759673">(</span><span class="builtinfunc" id="3759674">len</span><span class="op" id="3759677">(</span><span class="ident" id="3759678">s</span><span class="op" id="3759679">.</span><span class="ident" id="3759680">certificates</span><span class="op" id="3759692">)</span>&nbsp;<span class="op" id="3759694">&gt;&gt;</span>&nbsp;<span class="num" id="3759697">8</span><span class="op" id="3759698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3759701">x</span><span class="op" id="3759702">[</span><span class="num" id="3759703">1</span><span class="op" id="3759704">]</span>&nbsp;<span class="op" id="3759706">=</span>&nbsp;<span class="builtintype" id="3759708">byte</span><span class="op" id="3759712">(</span><span class="builtinfunc" id="3759713">len</span><span class="op" id="3759716">(</span><span class="ident" id="3759717">s</span><span class="op" id="3759718">.</span><span class="ident" id="3759719">certificates</span><span class="op" id="3759731">)</span><span class="op" id="3759732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3759735">x</span>&nbsp;<span class="op" id="3759737">=</span>&nbsp;<span class="ident" id="3759739">x</span><span class="op" id="3759740">[</span><span class="num" id="3759741">2</span><span class="op" id="3759742">:</span><span class="op" id="3759743">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3759747">for</span>&nbsp;<span class="ident" id="3759751">_</span><span class="op" id="3759752">,</span>&nbsp;<span class="ident" id="3759754">cert</span>&nbsp;<span class="op" id="3759759">:=</span>&nbsp;<span class="keyword" id="3759762">range</span>&nbsp;<span class="ident" id="3759768">s</span><span class="op" id="3759769">.</span><span class="ident" id="3759770">certificates</span>&nbsp;<span class="op" id="3759783">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3759787">x</span><span class="op" id="3759788">[</span><span class="num" id="3759789">0</span><span class="op" id="3759790">]</span>&nbsp;<span class="op" id="3759792">=</span>&nbsp;<span class="builtintype" id="3759794">byte</span><span class="op" id="3759798">(</span><span class="builtinfunc" id="3759799">len</span><span class="op" id="3759802">(</span><span class="ident" id="3759803">cert</span><span class="op" id="3759807">)</span>&nbsp;<span class="op" id="3759809">&gt;&gt;</span>&nbsp;<span class="num" id="3759812">24</span><span class="op" id="3759814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3759818">x</span><span class="op" id="3759819">[</span><span class="num" id="3759820">1</span><span class="op" id="3759821">]</span>&nbsp;<span class="op" id="3759823">=</span>&nbsp;<span class="builtintype" id="3759825">byte</span><span class="op" id="3759829">(</span><span class="builtinfunc" id="3759830">len</span><span class="op" id="3759833">(</span><span class="ident" id="3759834">cert</span><span class="op" id="3759838">)</span>&nbsp;<span class="op" id="3759840">&gt;&gt;</span>&nbsp;<span class="num" id="3759843">16</span><span class="op" id="3759845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3759849">x</span><span class="op" id="3759850">[</span><span class="num" id="3759851">2</span><span class="op" id="3759852">]</span>&nbsp;<span class="op" id="3759854">=</span>&nbsp;<span class="builtintype" id="3759856">byte</span><span class="op" id="3759860">(</span><span class="builtinfunc" id="3759861">len</span><span class="op" id="3759864">(</span><span class="ident" id="3759865">cert</span><span class="op" id="3759869">)</span>&nbsp;<span class="op" id="3759871">&gt;&gt;</span>&nbsp;<span class="num" id="3759874">8</span><span class="op" id="3759875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3759879">x</span><span class="op" id="3759880">[</span><span class="num" id="3759881">3</span><span class="op" id="3759882">]</span>&nbsp;<span class="op" id="3759884">=</span>&nbsp;<span class="builtintype" id="3759886">byte</span><span class="op" id="3759890">(</span><span class="builtinfunc" id="3759891">len</span><span class="op" id="3759894">(</span><span class="ident" id="3759895">cert</span><span class="op" id="3759899">)</span><span class="op" id="3759900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3759904">copy</span><span class="op" id="3759908">(</span><span class="ident" id="3759909">x</span><span class="op" id="3759910">[</span><span class="num" id="3759911">4</span><span class="op" id="3759912">:</span><span class="op" id="3759913">]</span><span class="op" id="3759914">,</span>&nbsp;<span class="ident" id="3759916">cert</span><span class="op" id="3759920">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3759924">x</span>&nbsp;<span class="op" id="3759926">=</span>&nbsp;<span class="ident" id="3759928">x</span><span class="op" id="3759929">[</span><span class="num" id="3759930">4</span><span class="op" id="3759931">+</span><span class="builtinfunc" id="3759932">len</span><span class="op" id="3759935">(</span><span class="ident" id="3759936">cert</span><span class="op" id="3759940">)</span><span class="op" id="3759941">:</span><span class="op" id="3759942">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3759945">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3759949">return</span>&nbsp;<span class="ident" id="3759956">ret</span><br>
<span class="lineno"></span><span class="op" id="3759960">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="3759963">func</span>&nbsp;<span class="op" id="3759968">(</span><span class="ident" id="3759969">s</span>&nbsp;<span class="op" id="3759971">*</span><span class="ident" id="3759972">sessionState</span><span class="op" id="3759984">)</span>&nbsp;<span class="ident" id="3759986">unmarshal</span><span class="op" id="3759995">(</span><span class="ident" id="3759996">data</span>&nbsp;<span class="op" id="3760001">[</span><span class="op" id="3760002">]</span><span class="builtintype" id="3760003">byte</span><span class="op" id="3760007">)</span>&nbsp;<span class="builtintype" id="3760009">bool</span>&nbsp;<span class="op" id="3760014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760017">if</span>&nbsp;<span class="builtinfunc" id="3760020">len</span><span class="op" id="3760023">(</span><span class="ident" id="3760024">data</span><span class="op" id="3760028">)</span>&nbsp;<span class="op" id="3760030">&lt;</span>&nbsp;<span class="num" id="3760032">8</span>&nbsp;<span class="op" id="3760034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760038">return</span>&nbsp;<span class="builtintype" id="3760045">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3760052">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3760056">s</span><span class="op" id="3760057">.</span><span class="ident" id="3760058">vers</span>&nbsp;<span class="op" id="3760063">=</span>&nbsp;<span class="builtintype" id="3760065">uint16</span><span class="op" id="3760071">(</span><span class="ident" id="3760072">data</span><span class="op" id="3760076">[</span><span class="num" id="3760077">0</span><span class="op" id="3760078">]</span><span class="op" id="3760079">)</span><span class="op" id="3760080">&lt;&lt;</span><span class="num" id="3760082">8</span>&nbsp;<span class="op" id="3760084">|</span>&nbsp;<span class="builtintype" id="3760086">uint16</span><span class="op" id="3760092">(</span><span class="ident" id="3760093">data</span><span class="op" id="3760097">[</span><span class="num" id="3760098">1</span><span class="op" id="3760099">]</span><span class="op" id="3760100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3760103">s</span><span class="op" id="3760104">.</span><span class="ident" id="3760105">cipherSuite</span>&nbsp;<span class="op" id="3760117">=</span>&nbsp;<span class="builtintype" id="3760119">uint16</span><span class="op" id="3760125">(</span><span class="ident" id="3760126">data</span><span class="op" id="3760130">[</span><span class="num" id="3760131">2</span><span class="op" id="3760132">]</span><span class="op" id="3760133">)</span><span class="op" id="3760134">&lt;&lt;</span><span class="num" id="3760136">8</span>&nbsp;<span class="op" id="3760138">|</span>&nbsp;<span class="builtintype" id="3760140">uint16</span><span class="op" id="3760146">(</span><span class="ident" id="3760147">data</span><span class="op" id="3760151">[</span><span class="num" id="3760152">3</span><span class="op" id="3760153">]</span><span class="op" id="3760154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3760157">masterSecretLen</span>&nbsp;<span class="op" id="3760173">:=</span>&nbsp;<span class="builtintype" id="3760176">int</span><span class="op" id="3760179">(</span><span class="ident" id="3760180">data</span><span class="op" id="3760184">[</span><span class="num" id="3760185">4</span><span class="op" id="3760186">]</span><span class="op" id="3760187">)</span><span class="op" id="3760188">&lt;&lt;</span><span class="num" id="3760190">8</span>&nbsp;<span class="op" id="3760192">|</span>&nbsp;<span class="builtintype" id="3760194">int</span><span class="op" id="3760197">(</span><span class="ident" id="3760198">data</span><span class="op" id="3760202">[</span><span class="num" id="3760203">5</span><span class="op" id="3760204">]</span><span class="op" id="3760205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3760208">data</span>&nbsp;<span class="op" id="3760213">=</span>&nbsp;<span class="ident" id="3760215">data</span><span class="op" id="3760219">[</span><span class="num" id="3760220">6</span><span class="op" id="3760221">:</span><span class="op" id="3760222">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760225">if</span>&nbsp;<span class="builtinfunc" id="3760228">len</span><span class="op" id="3760231">(</span><span class="ident" id="3760232">data</span><span class="op" id="3760236">)</span>&nbsp;<span class="op" id="3760238">&lt;</span>&nbsp;<span class="ident" id="3760240">masterSecretLen</span>&nbsp;<span class="op" id="3760256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760260">return</span>&nbsp;<span class="builtintype" id="3760267">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3760274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3760278">s</span><span class="op" id="3760279">.</span><span class="ident" id="3760280">masterSecret</span>&nbsp;<span class="op" id="3760293">=</span>&nbsp;<span class="ident" id="3760295">data</span><span class="op" id="3760299">[</span><span class="op" id="3760300">:</span><span class="ident" id="3760301">masterSecretLen</span><span class="op" id="3760316">]</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3760319">data</span>&nbsp;<span class="op" id="3760324">=</span>&nbsp;<span class="ident" id="3760326">data</span><span class="op" id="3760330">[</span><span class="ident" id="3760331">masterSecretLen</span><span class="op" id="3760346">:</span><span class="op" id="3760347">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760351">if</span>&nbsp;<span class="builtinfunc" id="3760354">len</span><span class="op" id="3760357">(</span><span class="ident" id="3760358">data</span><span class="op" id="3760362">)</span>&nbsp;<span class="op" id="3760364">&lt;</span>&nbsp;<span class="num" id="3760366">2</span>&nbsp;<span class="op" id="3760368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760372">return</span>&nbsp;<span class="builtintype" id="3760379">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3760386">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3760390">numCerts</span>&nbsp;<span class="op" id="3760399">:=</span>&nbsp;<span class="builtintype" id="3760402">int</span><span class="op" id="3760405">(</span><span class="ident" id="3760406">data</span><span class="op" id="3760410">[</span><span class="num" id="3760411">0</span><span class="op" id="3760412">]</span><span class="op" id="3760413">)</span><span class="op" id="3760414">&lt;&lt;</span><span class="num" id="3760416">8</span>&nbsp;<span class="op" id="3760418">|</span>&nbsp;<span class="builtintype" id="3760420">int</span><span class="op" id="3760423">(</span><span class="ident" id="3760424">data</span><span class="op" id="3760428">[</span><span class="num" id="3760429">1</span><span class="op" id="3760430">]</span><span class="op" id="3760431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3760434">data</span>&nbsp;<span class="op" id="3760439">=</span>&nbsp;<span class="ident" id="3760441">data</span><span class="op" id="3760445">[</span><span class="num" id="3760446">2</span><span class="op" id="3760447">:</span><span class="op" id="3760448">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3760452">s</span><span class="op" id="3760453">.</span><span class="ident" id="3760454">certificates</span>&nbsp;<span class="op" id="3760467">=</span>&nbsp;<span class="builtinfunc" id="3760469">make</span><span class="op" id="3760473">(</span><span class="op" id="3760474">[</span><span class="op" id="3760475">]</span><span class="op" id="3760476">[</span><span class="op" id="3760477">]</span><span class="builtintype" id="3760478">byte</span><span class="op" id="3760482">,</span>&nbsp;<span class="ident" id="3760484">numCerts</span><span class="op" id="3760492">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760495">for</span>&nbsp;<span class="ident" id="3760499">i</span>&nbsp;<span class="op" id="3760501">:=</span>&nbsp;<span class="keyword" id="3760504">range</span>&nbsp;<span class="ident" id="3760510">s</span><span class="op" id="3760511">.</span><span class="ident" id="3760512">certificates</span>&nbsp;<span class="op" id="3760525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760529">if</span>&nbsp;<span class="builtinfunc" id="3760532">len</span><span class="op" id="3760535">(</span><span class="ident" id="3760536">data</span><span class="op" id="3760540">)</span>&nbsp;<span class="op" id="3760542">&lt;</span>&nbsp;<span class="num" id="3760544">4</span>&nbsp;<span class="op" id="3760546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760551">return</span>&nbsp;<span class="builtintype" id="3760558">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3760566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3760570">certLen</span>&nbsp;<span class="op" id="3760578">:=</span>&nbsp;<span class="builtintype" id="3760581">int</span><span class="op" id="3760584">(</span><span class="ident" id="3760585">data</span><span class="op" id="3760589">[</span><span class="num" id="3760590">0</span><span class="op" id="3760591">]</span><span class="op" id="3760592">)</span><span class="op" id="3760593">&lt;&lt;</span><span class="num" id="3760595">24</span>&nbsp;<span class="op" id="3760598">|</span>&nbsp;<span class="builtintype" id="3760600">int</span><span class="op" id="3760603">(</span><span class="ident" id="3760604">data</span><span class="op" id="3760608">[</span><span class="num" id="3760609">1</span><span class="op" id="3760610">]</span><span class="op" id="3760611">)</span><span class="op" id="3760612">&lt;&lt;</span><span class="num" id="3760614">16</span>&nbsp;<span class="op" id="3760617">|</span>&nbsp;<span class="builtintype" id="3760619">int</span><span class="op" id="3760622">(</span><span class="ident" id="3760623">data</span><span class="op" id="3760627">[</span><span class="num" id="3760628">2</span><span class="op" id="3760629">]</span><span class="op" id="3760630">)</span><span class="op" id="3760631">&lt;&lt;</span><span class="num" id="3760633">8</span>&nbsp;<span class="op" id="3760635">|</span>&nbsp;<span class="builtintype" id="3760637">int</span><span class="op" id="3760640">(</span><span class="ident" id="3760641">data</span><span class="op" id="3760645">[</span><span class="num" id="3760646">3</span><span class="op" id="3760647">]</span><span class="op" id="3760648">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3760652">data</span>&nbsp;<span class="op" id="3760657">=</span>&nbsp;<span class="ident" id="3760659">data</span><span class="op" id="3760663">[</span><span class="num" id="3760664">4</span><span class="op" id="3760665">:</span><span class="op" id="3760666">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760670">if</span>&nbsp;<span class="ident" id="3760673">certLen</span>&nbsp;<span class="op" id="3760681">&lt;</span>&nbsp;<span class="num" id="3760683">0</span>&nbsp;<span class="op" id="3760685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760690">return</span>&nbsp;<span class="builtintype" id="3760697">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3760705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760709">if</span>&nbsp;<span class="builtinfunc" id="3760712">len</span><span class="op" id="3760715">(</span><span class="ident" id="3760716">data</span><span class="op" id="3760720">)</span>&nbsp;<span class="op" id="3760722">&lt;</span>&nbsp;<span class="ident" id="3760724">certLen</span>&nbsp;<span class="op" id="3760732">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760737">return</span>&nbsp;<span class="builtintype" id="3760744">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3760752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3760756">s</span><span class="op" id="3760757">.</span><span class="ident" id="3760758">certificates</span><span class="op" id="3760770">[</span><span class="ident" id="3760771">i</span><span class="op" id="3760772">]</span>&nbsp;<span class="op" id="3760774">=</span>&nbsp;<span class="ident" id="3760776">data</span><span class="op" id="3760780">[</span><span class="op" id="3760781">:</span><span class="ident" id="3760782">certLen</span><span class="op" id="3760789">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3760793">data</span>&nbsp;<span class="op" id="3760798">=</span>&nbsp;<span class="ident" id="3760800">data</span><span class="op" id="3760804">[</span><span class="ident" id="3760805">certLen</span><span class="op" id="3760812">:</span><span class="op" id="3760813">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3760816">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760820">if</span>&nbsp;<span class="builtinfunc" id="3760823">len</span><span class="op" id="3760826">(</span><span class="ident" id="3760827">data</span><span class="op" id="3760831">)</span>&nbsp;<span class="op" id="3760833">&gt;</span>&nbsp;<span class="num" id="3760835">0</span>&nbsp;<span class="op" id="3760837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760841">return</span>&nbsp;<span class="builtintype" id="3760848">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3760855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760859">return</span>&nbsp;<span class="builtintype" id="3760866">true</span><br>
<span class="lineno"></span><span class="op" id="3760871">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3760874">func</span>&nbsp;<span class="op" id="3760879">(</span><span class="ident" id="3760880">c</span>&nbsp;<span class="op" id="3760882">*</span><span class="ident" id="3760883">Conn</span><span class="op" id="3760887">)</span>&nbsp;<span class="ident" id="3760889">encryptTicket</span><span class="op" id="3760902">(</span><span class="ident" id="3760903">state</span>&nbsp;<span class="op" id="3760909">*</span><span class="ident" id="3760910">sessionState</span><span class="op" id="3760922">)</span>&nbsp;<span class="op" id="3760924">(</span><span class="op" id="3760925">[</span><span class="op" id="3760926">]</span><span class="builtintype" id="3760927">byte</span><span class="op" id="3760931">,</span>&nbsp;<span class="builtintype" id="3760933">error</span><span class="op" id="3760938">)</span>&nbsp;<span class="op" id="3760940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3760943">serialized</span>&nbsp;<span class="op" id="3760954">:=</span>&nbsp;<span class="ident" id="3760957">state</span><span class="op" id="3760962">.</span><span class="ident" id="3760963">marshal</span><span class="op" id="3760970">(</span><span class="op" id="3760971">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3760974">encrypted</span>&nbsp;<span class="op" id="3760984">:=</span>&nbsp;<span class="builtinfunc" id="3760987">make</span><span class="op" id="3760991">(</span><span class="op" id="3760992">[</span><span class="op" id="3760993">]</span><span class="builtintype" id="3760994">byte</span><span class="op" id="3760998">,</span>&nbsp;<span class="ident" id="3761000">aes</span><span class="op" id="3761003">.</span><span class="ident" id="3761004">BlockSize</span><span class="op" id="3761013">+</span><span class="builtinfunc" id="3761014">len</span><span class="op" id="3761017">(</span><span class="ident" id="3761018">serialized</span><span class="op" id="3761028">)</span><span class="op" id="3761029">+</span><span class="ident" id="3761030">sha256</span><span class="op" id="3761036">.</span><span class="ident" id="3761037">Size</span><span class="op" id="3761041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3761044">iv</span>&nbsp;<span class="op" id="3761047">:=</span>&nbsp;<span class="ident" id="3761050">encrypted</span><span class="op" id="3761059">[</span><span class="op" id="3761060">:</span><span class="ident" id="3761061">aes</span><span class="op" id="3761064">.</span><span class="ident" id="3761065">BlockSize</span><span class="op" id="3761074">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3761077">macBytes</span>&nbsp;<span class="op" id="3761086">:=</span>&nbsp;<span class="ident" id="3761089">encrypted</span><span class="op" id="3761098">[</span><span class="builtinfunc" id="3761099">len</span><span class="op" id="3761102">(</span><span class="ident" id="3761103">encrypted</span><span class="op" id="3761112">)</span><span class="op" id="3761113">-</span><span class="ident" id="3761114">sha256</span><span class="op" id="3761120">.</span><span class="ident" id="3761121">Size</span><span class="op" id="3761125">:</span><span class="op" id="3761126">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3761130">if</span>&nbsp;<span class="ident" id="3761133">_</span><span class="op" id="3761134">,</span>&nbsp;<span class="ident" id="3761136">err</span>&nbsp;<span class="op" id="3761140">:=</span>&nbsp;<span class="ident" id="3761143">io</span><span class="op" id="3761145">.</span><span class="ident" id="3761146">ReadFull</span><span class="op" id="3761154">(</span><span class="ident" id="3761155">c</span><span class="op" id="3761156">.</span><span class="ident" id="3761157">config</span><span class="op" id="3761163">.</span><span class="ident" id="3761164">rand</span><span class="op" id="3761168">(</span><span class="op" id="3761169">)</span><span class="op" id="3761170">,</span>&nbsp;<span class="ident" id="3761172">iv</span><span class="op" id="3761174">)</span><span class="op" id="3761175">;</span>&nbsp;<span class="ident" id="3761177">err</span>&nbsp;<span class="op" id="3761181">!=</span>&nbsp;<span class="ident" id="3761184">nil</span>&nbsp;<span class="op" id="3761188">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3761192">return</span>&nbsp;<span class="ident" id="3761199">nil</span><span class="op" id="3761202">,</span>&nbsp;<span class="ident" id="3761204">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3761209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3761212">block</span><span class="op" id="3761217">,</span>&nbsp;<span class="ident" id="3761219">err</span>&nbsp;<span class="op" id="3761223">:=</span>&nbsp;<span class="ident" id="3761226">aes</span><span class="op" id="3761229">.</span><span class="ident" id="3761230">NewCipher</span><span class="op" id="3761239">(</span><span class="ident" id="3761240">c</span><span class="op" id="3761241">.</span><span class="ident" id="3761242">config</span><span class="op" id="3761248">.</span><span class="ident" id="3761249">SessionTicketKey</span><span class="op" id="3761265">[</span><span class="op" id="3761266">:</span><span class="num" id="3761267">16</span><span class="op" id="3761269">]</span><span class="op" id="3761270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3761273">if</span>&nbsp;<span class="ident" id="3761276">err</span>&nbsp;<span class="op" id="3761280">!=</span>&nbsp;<span class="ident" id="3761283">nil</span>&nbsp;<span class="op" id="3761287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3761291">return</span>&nbsp;<span class="ident" id="3761298">nil</span><span class="op" id="3761301">,</span>&nbsp;<span class="ident" id="3761303">errors</span><span class="op" id="3761309">.</span><span class="ident" id="3761310">New</span><span class="op" id="3761313">(</span><span class="string" id="3761314">&#34;tls:&nbsp;failed&nbsp;to&nbsp;create&nbsp;cipher&nbsp;while&nbsp;encrypting&nbsp;ticket:&nbsp;&#34;</span>&nbsp;<span class="op" id="3761371">+</span>&nbsp;<span class="ident" id="3761373">err</span><span class="op" id="3761376">.</span><span class="ident" id="3761377">Error</span><span class="op" id="3761382">(</span><span class="op" id="3761383">)</span><span class="op" id="3761384">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3761387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3761390">cipher</span><span class="op" id="3761396">.</span><span class="ident" id="3761397">NewCTR</span><span class="op" id="3761403">(</span><span class="ident" id="3761404">block</span><span class="op" id="3761409">,</span>&nbsp;<span class="ident" id="3761411">iv</span><span class="op" id="3761413">)</span><span class="op" id="3761414">.</span><span class="ident" id="3761415">XORKeyStream</span><span class="op" id="3761427">(</span><span class="ident" id="3761428">encrypted</span><span class="op" id="3761437">[</span><span class="ident" id="3761438">aes</span><span class="op" id="3761441">.</span><span class="ident" id="3761442">BlockSize</span><span class="op" id="3761451">:</span><span class="op" id="3761452">]</span><span class="op" id="3761453">,</span>&nbsp;<span class="ident" id="3761455">serialized</span><span class="op" id="3761465">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3761469">mac</span>&nbsp;<span class="op" id="3761473">:=</span>&nbsp;<span class="ident" id="3761476">hmac</span><span class="op" id="3761480">.</span><span class="ident" id="3761481">New</span><span class="op" id="3761484">(</span><span class="ident" id="3761485">sha256</span><span class="op" id="3761491">.</span><span class="ident" id="3761492">New</span><span class="op" id="3761495">,</span>&nbsp;<span class="ident" id="3761497">c</span><span class="op" id="3761498">.</span><span class="ident" id="3761499">config</span><span class="op" id="3761505">.</span><span class="ident" id="3761506">SessionTicketKey</span><span class="op" id="3761522">[</span><span class="num" id="3761523">16</span><span class="op" id="3761525">:</span><span class="num" id="3761526">32</span><span class="op" id="3761528">]</span><span class="op" id="3761529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3761532">mac</span><span class="op" id="3761535">.</span><span class="ident" id="3761536">Write</span><span class="op" id="3761541">(</span><span class="ident" id="3761542">encrypted</span><span class="op" id="3761551">[</span><span class="op" id="3761552">:</span><span class="builtinfunc" id="3761553">len</span><span class="op" id="3761556">(</span><span class="ident" id="3761557">encrypted</span><span class="op" id="3761566">)</span><span class="op" id="3761567">-</span><span class="ident" id="3761568">sha256</span><span class="op" id="3761574">.</span><span class="ident" id="3761575">Size</span><span class="op" id="3761579">]</span><span class="op" id="3761580">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3761583">mac</span><span class="op" id="3761586">.</span><span class="ident" id="3761587">Sum</span><span class="op" id="3761590">(</span><span class="ident" id="3761591">macBytes</span><span class="op" id="3761599">[</span><span class="op" id="3761600">:</span><span class="num" id="3761601">0</span><span class="op" id="3761602">]</span><span class="op" id="3761603">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3761607">return</span>&nbsp;<span class="ident" id="3761614">encrypted</span><span class="op" id="3761623">,</span>&nbsp;<span class="ident" id="3761625">nil</span><br>
<span class="lineno"></span><span class="op" id="3761629">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="keyword" id="3761632">func</span>&nbsp;<span class="op" id="3761637">(</span><span class="ident" id="3761638">c</span>&nbsp;<span class="op" id="3761640">*</span><span class="ident" id="3761641">Conn</span><span class="op" id="3761645">)</span>&nbsp;<span class="ident" id="3761647">decryptTicket</span><span class="op" id="3761660">(</span><span class="ident" id="3761661">encrypted</span>&nbsp;<span class="op" id="3761671">[</span><span class="op" id="3761672">]</span><span class="builtintype" id="3761673">byte</span><span class="op" id="3761677">)</span>&nbsp;<span class="op" id="3761679">(</span><span class="op" id="3761680">*</span><span class="ident" id="3761681">sessionState</span><span class="op" id="3761693">,</span>&nbsp;<span class="builtintype" id="3761695">bool</span><span class="op" id="3761699">)</span>&nbsp;<span class="op" id="3761701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3761704">if</span>&nbsp;<span class="ident" id="3761707">c</span><span class="op" id="3761708">.</span><span class="ident" id="3761709">config</span><span class="op" id="3761715">.</span><span class="ident" id="3761716">SessionTicketsDisabled</span>&nbsp;<span class="op" id="3761739">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3761744">len</span><span class="op" id="3761747">(</span><span class="ident" id="3761748">encrypted</span><span class="op" id="3761757">)</span>&nbsp;<span class="op" id="3761759">&lt;</span>&nbsp;<span class="ident" id="3761761">aes</span><span class="op" id="3761764">.</span><span class="ident" id="3761765">BlockSize</span><span class="op" id="3761774">+</span><span class="ident" id="3761775">sha256</span><span class="op" id="3761781">.</span><span class="ident" id="3761782">Size</span>&nbsp;<span class="op" id="3761787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3761791">return</span>&nbsp;<span class="ident" id="3761798">nil</span><span class="op" id="3761801">,</span>&nbsp;<span class="builtintype" id="3761803">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3761810">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3761814">iv</span>&nbsp;<span class="op" id="3761817">:=</span>&nbsp;<span class="ident" id="3761820">encrypted</span><span class="op" id="3761829">[</span><span class="op" id="3761830">:</span><span class="ident" id="3761831">aes</span><span class="op" id="3761834">.</span><span class="ident" id="3761835">BlockSize</span><span class="op" id="3761844">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3761847">macBytes</span>&nbsp;<span class="op" id="3761856">:=</span>&nbsp;<span class="ident" id="3761859">encrypted</span><span class="op" id="3761868">[</span><span class="builtinfunc" id="3761869">len</span><span class="op" id="3761872">(</span><span class="ident" id="3761873">encrypted</span><span class="op" id="3761882">)</span><span class="op" id="3761883">-</span><span class="ident" id="3761884">sha256</span><span class="op" id="3761890">.</span><span class="ident" id="3761891">Size</span><span class="op" id="3761895">:</span><span class="op" id="3761896">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3761900">mac</span>&nbsp;<span class="op" id="3761904">:=</span>&nbsp;<span class="ident" id="3761907">hmac</span><span class="op" id="3761911">.</span><span class="ident" id="3761912">New</span><span class="op" id="3761915">(</span><span class="ident" id="3761916">sha256</span><span class="op" id="3761922">.</span><span class="ident" id="3761923">New</span><span class="op" id="3761926">,</span>&nbsp;<span class="ident" id="3761928">c</span><span class="op" id="3761929">.</span><span class="ident" id="3761930">config</span><span class="op" id="3761936">.</span><span class="ident" id="3761937">SessionTicketKey</span><span class="op" id="3761953">[</span><span class="num" id="3761954">16</span><span class="op" id="3761956">:</span><span class="num" id="3761957">32</span><span class="op" id="3761959">]</span><span class="op" id="3761960">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3761963">mac</span><span class="op" id="3761966">.</span><span class="ident" id="3761967">Write</span><span class="op" id="3761972">(</span><span class="ident" id="3761973">encrypted</span><span class="op" id="3761982">[</span><span class="op" id="3761983">:</span><span class="builtinfunc" id="3761984">len</span><span class="op" id="3761987">(</span><span class="ident" id="3761988">encrypted</span><span class="op" id="3761997">)</span><span class="op" id="3761998">-</span><span class="ident" id="3761999">sha256</span><span class="op" id="3762005">.</span><span class="ident" id="3762006">Size</span><span class="op" id="3762010">]</span><span class="op" id="3762011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3762014">expected</span>&nbsp;<span class="op" id="3762023">:=</span>&nbsp;<span class="ident" id="3762026">mac</span><span class="op" id="3762029">.</span><span class="ident" id="3762030">Sum</span><span class="op" id="3762033">(</span><span class="ident" id="3762034">nil</span><span class="op" id="3762037">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3762041">if</span>&nbsp;<span class="ident" id="3762044">subtle</span><span class="op" id="3762050">.</span><span class="ident" id="3762051">ConstantTimeCompare</span><span class="op" id="3762070">(</span><span class="ident" id="3762071">macBytes</span><span class="op" id="3762079">,</span>&nbsp;<span class="ident" id="3762081">expected</span><span class="op" id="3762089">)</span>&nbsp;<span class="op" id="3762091">!=</span>&nbsp;<span class="num" id="3762094">1</span>&nbsp;<span class="op" id="3762096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3762100">return</span>&nbsp;<span class="ident" id="3762107">nil</span><span class="op" id="3762110">,</span>&nbsp;<span class="builtintype" id="3762112">false</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3762119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3762123">block</span><span class="op" id="3762128">,</span>&nbsp;<span class="ident" id="3762130">err</span>&nbsp;<span class="op" id="3762134">:=</span>&nbsp;<span class="ident" id="3762137">aes</span><span class="op" id="3762140">.</span><span class="ident" id="3762141">NewCipher</span><span class="op" id="3762150">(</span><span class="ident" id="3762151">c</span><span class="op" id="3762152">.</span><span class="ident" id="3762153">config</span><span class="op" id="3762159">.</span><span class="ident" id="3762160">SessionTicketKey</span><span class="op" id="3762176">[</span><span class="op" id="3762177">:</span><span class="num" id="3762178">16</span><span class="op" id="3762180">]</span><span class="op" id="3762181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3762184">if</span>&nbsp;<span class="ident" id="3762187">err</span>&nbsp;<span class="op" id="3762191">!=</span>&nbsp;<span class="ident" id="3762194">nil</span>&nbsp;<span class="op" id="3762198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3762202">return</span>&nbsp;<span class="ident" id="3762209">nil</span><span class="op" id="3762212">,</span>&nbsp;<span class="builtintype" id="3762214">false</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3762221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3762224">ciphertext</span>&nbsp;<span class="op" id="3762235">:=</span>&nbsp;<span class="ident" id="3762238">encrypted</span><span class="op" id="3762247">[</span><span class="ident" id="3762248">aes</span><span class="op" id="3762251">.</span><span class="ident" id="3762252">BlockSize</span>&nbsp;<span class="op" id="3762262">:</span>&nbsp;<span class="builtinfunc" id="3762264">len</span><span class="op" id="3762267">(</span><span class="ident" id="3762268">encrypted</span><span class="op" id="3762277">)</span><span class="op" id="3762278">-</span><span class="ident" id="3762279">sha256</span><span class="op" id="3762285">.</span><span class="ident" id="3762286">Size</span><span class="op" id="3762290">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3762293">plaintext</span>&nbsp;<span class="op" id="3762303">:=</span>&nbsp;<span class="ident" id="3762306">ciphertext</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3762318">cipher</span><span class="op" id="3762324">.</span><span class="ident" id="3762325">NewCTR</span><span class="op" id="3762331">(</span><span class="ident" id="3762332">block</span><span class="op" id="3762337">,</span>&nbsp;<span class="ident" id="3762339">iv</span><span class="op" id="3762341">)</span><span class="op" id="3762342">.</span><span class="ident" id="3762343">XORKeyStream</span><span class="op" id="3762355">(</span><span class="ident" id="3762356">plaintext</span><span class="op" id="3762365">,</span>&nbsp;<span class="ident" id="3762367">ciphertext</span><span class="op" id="3762377">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3762381">state</span>&nbsp;<span class="op" id="3762387">:=</span>&nbsp;<span class="builtinfunc" id="3762390">new</span><span class="op" id="3762393">(</span><span class="ident" id="3762394">sessionState</span><span class="op" id="3762406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3762409">ok</span>&nbsp;<span class="op" id="3762412">:=</span>&nbsp;<span class="ident" id="3762415">state</span><span class="op" id="3762420">.</span><span class="ident" id="3762421">unmarshal</span><span class="op" id="3762430">(</span><span class="ident" id="3762431">plaintext</span><span class="op" id="3762440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3762443">return</span>&nbsp;<span class="ident" id="3762450">state</span><span class="op" id="3762455">,</span>&nbsp;<span class="ident" id="3762457">ok</span><br>
<span class="lineno"></span><span class="op" id="3762460">}</span>
</div>
</body>
</html>
