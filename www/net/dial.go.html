<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1330221">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1330277">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1330331">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1330382">package</span>&nbsp;<span class="ident" id="1330390">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1330395">import</span>&nbsp;<span class="op" id="1330402">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1330405">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1330415">&#34;time&#34;</span><br>
<span class="lineno">10</span><span class="op" id="1330422">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1330425">//&nbsp;A&nbsp;Dialer&nbsp;contains&nbsp;options&nbsp;for&nbsp;connecting&nbsp;to&nbsp;an&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="1330484">//</span><br>
<span class="lineno"></span><span class="comment" id="1330487">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;each&nbsp;field&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;dialing</span><br>
<span class="lineno">15</span><span class="comment" id="1330545">//&nbsp;without&nbsp;that&nbsp;option.&nbsp;Dialing&nbsp;with&nbsp;the&nbsp;zero&nbsp;value&nbsp;of&nbsp;Dialer</span><br>
<span class="lineno"></span><span class="comment" id="1330607">//&nbsp;is&nbsp;therefore&nbsp;equivalent&nbsp;to&nbsp;just&nbsp;calling&nbsp;the&nbsp;Dial&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="1330669">type</span>&nbsp;<span class="ident" id="1330674">Dialer</span>&nbsp;<span class="keyword" id="1330681">struct</span>&nbsp;<span class="op" id="1330688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1330691">//&nbsp;Timeout&nbsp;is&nbsp;the&nbsp;maximum&nbsp;amount&nbsp;of&nbsp;time&nbsp;a&nbsp;dial&nbsp;will&nbsp;wait&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1330754">//&nbsp;a&nbsp;connect&nbsp;to&nbsp;complete.&nbsp;If&nbsp;Deadline&nbsp;is&nbsp;also&nbsp;set,&nbsp;it&nbsp;may&nbsp;fail</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1330818">//&nbsp;earlier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1330831">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1330835">//&nbsp;The&nbsp;default&nbsp;is&nbsp;no&nbsp;timeout.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1330866">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1330870">//&nbsp;With&nbsp;or&nbsp;without&nbsp;a&nbsp;timeout,&nbsp;the&nbsp;operating&nbsp;system&nbsp;may&nbsp;impose</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1330933">//&nbsp;its&nbsp;own&nbsp;earlier&nbsp;timeout.&nbsp;For&nbsp;instance,&nbsp;TCP&nbsp;timeouts&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1330993">//&nbsp;often&nbsp;around&nbsp;3&nbsp;minutes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331021">Timeout</span>&nbsp;<span class="ident" id="1331029"><a href="/net/dial.go.html#1330415">time</a></span><span class="op" id="1331033">.</span><span class="ident" id="1331034">Duration</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331045">//&nbsp;Deadline&nbsp;is&nbsp;the&nbsp;absolute&nbsp;point&nbsp;in&nbsp;time&nbsp;after&nbsp;which&nbsp;dials</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331106">//&nbsp;will&nbsp;fail.&nbsp;If&nbsp;Timeout&nbsp;is&nbsp;set,&nbsp;it&nbsp;may&nbsp;fail&nbsp;earlier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331161">//&nbsp;Zero&nbsp;means&nbsp;no&nbsp;deadline,&nbsp;or&nbsp;dependent&nbsp;on&nbsp;the&nbsp;operating&nbsp;system</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331226">//&nbsp;as&nbsp;with&nbsp;the&nbsp;Timeout&nbsp;option.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331258">Deadline</span>&nbsp;<span class="ident" id="1331267"><a href="/net/dial.go.html#1330415">time</a></span><span class="op" id="1331271">.</span><span class="ident" id="1331272">Time</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331279">//&nbsp;LocalAddr&nbsp;is&nbsp;the&nbsp;local&nbsp;address&nbsp;to&nbsp;use&nbsp;when&nbsp;dialing&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331337">//&nbsp;address.&nbsp;The&nbsp;address&nbsp;must&nbsp;be&nbsp;of&nbsp;a&nbsp;compatible&nbsp;type&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331399">//&nbsp;network&nbsp;being&nbsp;dialed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331425">//&nbsp;If&nbsp;nil,&nbsp;a&nbsp;local&nbsp;address&nbsp;is&nbsp;automatically&nbsp;chosen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331478">LocalAddr</span>&nbsp;<span class="ident" id="1331488"><a href="/net/net.go.html#1465097">Addr</a></span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331495">//&nbsp;DualStack&nbsp;allows&nbsp;a&nbsp;single&nbsp;dial&nbsp;to&nbsp;attempt&nbsp;to&nbsp;establish</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331554">//&nbsp;multiple&nbsp;IPv4&nbsp;and&nbsp;IPv6&nbsp;connections&nbsp;and&nbsp;to&nbsp;return&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331617">//&nbsp;established&nbsp;connection&nbsp;when&nbsp;the&nbsp;network&nbsp;is&nbsp;&#34;tcp&#34;&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331678">//&nbsp;destination&nbsp;is&nbsp;a&nbsp;host&nbsp;name&nbsp;that&nbsp;has&nbsp;multiple&nbsp;address&nbsp;family</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331742">//&nbsp;DNS&nbsp;records.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331759">DualStack</span>&nbsp;<span class="builtintype" id="1331769">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331776">//&nbsp;KeepAlive&nbsp;specifies&nbsp;the&nbsp;keep-alive&nbsp;period&nbsp;for&nbsp;an&nbsp;active</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331836">//&nbsp;network&nbsp;connection.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331860">//&nbsp;If&nbsp;zero,&nbsp;keep-alives&nbsp;are&nbsp;not&nbsp;enabled.&nbsp;Network&nbsp;protocols</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331920">//&nbsp;that&nbsp;do&nbsp;not&nbsp;support&nbsp;keep-alives&nbsp;ignore&nbsp;this&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331975">KeepAlive</span>&nbsp;<span class="ident" id="1331985"><a href="/net/dial.go.html#1330415">time</a></span><span class="op" id="1331989">.</span><span class="ident" id="1331990">Duration</span><br>
<span class="lineno"></span><span class="op" id="1331999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="1332002">//&nbsp;Return&nbsp;either&nbsp;now+Timeout&nbsp;or&nbsp;Deadline,&nbsp;whichever&nbsp;comes&nbsp;first.</span><br>
<span class="lineno"></span><span class="comment" id="1332067">//&nbsp;Or&nbsp;zero,&nbsp;if&nbsp;neither&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="1332098">func</span>&nbsp;<span class="op" id="1332103">(</span><span class="ident" id="1332104">d</span>&nbsp;<span class="op" id="1332106">*</span><span class="ident" id="1332107"><a href="/net/dial.go.html#1330674">Dialer</a></span><span class="op" id="1332113">)</span>&nbsp;<span class="ident" id="1332115">deadline</span><span class="op" id="1332123">(</span><span class="op" id="1332124">)</span>&nbsp;<span class="ident" id="1332126"><a href="/net/dial.go.html#1330415">time</a></span><span class="op" id="1332130">.</span><span class="ident" id="1332131">Time</span>&nbsp;<span class="op" id="1332136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1332139">if</span>&nbsp;<span class="ident" id="1332142"><a href="/net/dial.go.html#1332104">d</a></span><span class="op" id="1332143">.</span><span class="ident" id="1332144">Timeout</span>&nbsp;<span class="op" id="1332152">==</span>&nbsp;<span class="num" id="1332155">0</span>&nbsp;<span class="op" id="1332157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1332161">return</span>&nbsp;<span class="ident" id="1332168"><a href="/net/dial.go.html#1332104">d</a></span><span class="op" id="1332169">.</span><span class="ident" id="1332170">Deadline</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1332180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1332183">timeoutDeadline</span>&nbsp;<span class="op" id="1332199">:=</span>&nbsp;<span class="ident" id="1332202"><a href="/net/dial.go.html#1330415">time</a></span><span class="op" id="1332206">.</span><span class="ident" id="1332207">Now</span><span class="op" id="1332210">(</span><span class="op" id="1332211">)</span><span class="op" id="1332212">.</span><span class="ident" id="1332213">Add</span><span class="op" id="1332216">(</span><span class="ident" id="1332217"><a href="/net/dial.go.html#1332104">d</a></span><span class="op" id="1332218">.</span><span class="ident" id="1332219">Timeout</span><span class="op" id="1332226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1332229">if</span>&nbsp;<span class="ident" id="1332232"><a href="/net/dial.go.html#1332104">d</a></span><span class="op" id="1332233">.</span><span class="ident" id="1332234">Deadline</span><span class="op" id="1332242">.</span><span class="ident" id="1332243">IsZero</span><span class="op" id="1332249">(</span><span class="op" id="1332250">)</span>&nbsp;<span class="op" id="1332252">||</span>&nbsp;<span class="ident" id="1332255"><a href="/net/dial.go.html#1332183">timeoutDeadline</a></span><span class="op" id="1332270">.</span><span class="ident" id="1332271">Before</span><span class="op" id="1332277">(</span><span class="ident" id="1332278"><a href="/net/dial.go.html#1332104">d</a></span><span class="op" id="1332279">.</span><span class="ident" id="1332280">Deadline</span><span class="op" id="1332288">)</span>&nbsp;<span class="op" id="1332290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1332294">return</span>&nbsp;<span class="ident" id="1332301"><a href="/net/dial.go.html#1332183">timeoutDeadline</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1332318">}</span>&nbsp;<span class="keyword" id="1332320">else</span>&nbsp;<span class="op" id="1332325">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1332329">return</span>&nbsp;<span class="ident" id="1332336"><a href="/net/dial.go.html#1332104">d</a></span><span class="op" id="1332337">.</span><span class="ident" id="1332338">Deadline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1332348">}</span><br>
<span class="lineno"></span><span class="op" id="1332350">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1332353">func</span>&nbsp;<span class="ident" id="1332358">parseNetwork</span><span class="op" id="1332370">(</span><span class="ident" id="1332371">net</span>&nbsp;<span class="builtintype" id="1332375">string</span><span class="op" id="1332381">)</span>&nbsp;<span class="op" id="1332383">(</span><span class="ident" id="1332384">afnet</span>&nbsp;<span class="builtintype" id="1332390">string</span><span class="op" id="1332396">,</span>&nbsp;<span class="ident" id="1332398">proto</span>&nbsp;<span class="builtintype" id="1332404">int</span><span class="op" id="1332407">,</span>&nbsp;<span class="ident" id="1332409">err</span>&nbsp;<span class="builtintype" id="1332413">error</span><span class="op" id="1332418">)</span>&nbsp;<span class="op" id="1332420">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1332423">i</span>&nbsp;<span class="op" id="1332425">:=</span>&nbsp;<span class="ident" id="1332428"><a href="/net/parse.go.html#1480058">last</a></span><span class="op" id="1332432">(</span><span class="ident" id="1332433"><a href="/net/dial.go.html#1332371">net</a></span><span class="op" id="1332436">,</span>&nbsp;<span class="string" id="1332438">&#39;:&#39;</span><span class="op" id="1332441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1332444">if</span>&nbsp;<span class="ident" id="1332447"><a href="/net/dial.go.html#1332423">i</a></span>&nbsp;<span class="op" id="1332449">&lt;</span>&nbsp;<span class="num" id="1332451">0</span>&nbsp;<span class="op" id="1332453">{</span>&nbsp;<span class="comment" id="1332455">//&nbsp;no&nbsp;colon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1332469">switch</span>&nbsp;<span class="ident" id="1332476"><a href="/net/dial.go.html#1332371">net</a></span>&nbsp;<span class="op" id="1332480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1332484">case</span>&nbsp;<span class="string" id="1332489">&#34;tcp&#34;</span><span class="op" id="1332494">,</span>&nbsp;<span class="string" id="1332496">&#34;tcp4&#34;</span><span class="op" id="1332502">,</span>&nbsp;<span class="string" id="1332504">&#34;tcp6&#34;</span><span class="op" id="1332510">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1332514">case</span>&nbsp;<span class="string" id="1332519">&#34;udp&#34;</span><span class="op" id="1332524">,</span>&nbsp;<span class="string" id="1332526">&#34;udp4&#34;</span><span class="op" id="1332532">,</span>&nbsp;<span class="string" id="1332534">&#34;udp6&#34;</span><span class="op" id="1332540">:</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1332544">case</span>&nbsp;<span class="string" id="1332549">&#34;ip&#34;</span><span class="op" id="1332553">,</span>&nbsp;<span class="string" id="1332555">&#34;ip4&#34;</span><span class="op" id="1332560">,</span>&nbsp;<span class="string" id="1332562">&#34;ip6&#34;</span><span class="op" id="1332567">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1332571">case</span>&nbsp;<span class="string" id="1332576">&#34;unix&#34;</span><span class="op" id="1332582">,</span>&nbsp;<span class="string" id="1332584">&#34;unixgram&#34;</span><span class="op" id="1332594">,</span>&nbsp;<span class="string" id="1332596">&#34;unixpacket&#34;</span><span class="op" id="1332608">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1332612">default</span><span class="op" id="1332619">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1332624">return</span>&nbsp;<span class="string" id="1332631">&#34;&#34;</span><span class="op" id="1332633">,</span>&nbsp;<span class="num" id="1332635">0</span><span class="op" id="1332636">,</span>&nbsp;<span class="ident" id="1332638"><a href="/net/net.go.html#1473867">UnknownNetworkError</a></span><span class="op" id="1332657">(</span><span class="ident" id="1332658"><a href="/net/dial.go.html#1332371">net</a></span><span class="op" id="1332661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1332665">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1332669">return</span>&nbsp;<span class="ident" id="1332676"><a href="/net/dial.go.html#1332371">net</a></span><span class="op" id="1332679">,</span>&nbsp;<span class="num" id="1332681">0</span><span class="op" id="1332682">,</span>&nbsp;<span class="ident" id="1332684">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1332689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1332692"><a href="/net/dial.go.html#1332384">afnet</a></span>&nbsp;<span class="op" id="1332698">=</span>&nbsp;<span class="ident" id="1332700"><a href="/net/dial.go.html#1332371">net</a></span><span class="op" id="1332703">[</span><span class="op" id="1332704">:</span><span class="ident" id="1332705"><a href="/net/dial.go.html#1332423">i</a></span><span class="op" id="1332706">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1332709">switch</span>&nbsp;<span class="ident" id="1332716"><a href="/net/dial.go.html#1332384">afnet</a></span>&nbsp;<span class="op" id="1332722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1332725">case</span>&nbsp;<span class="string" id="1332730">&#34;ip&#34;</span><span class="op" id="1332734">,</span>&nbsp;<span class="string" id="1332736">&#34;ip4&#34;</span><span class="op" id="1332741">,</span>&nbsp;<span class="string" id="1332743">&#34;ip6&#34;</span><span class="op" id="1332748">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1332752">protostr</span>&nbsp;<span class="op" id="1332761">:=</span>&nbsp;<span class="ident" id="1332764"><a href="/net/dial.go.html#1332371">net</a></span><span class="op" id="1332767">[</span><span class="ident" id="1332768"><a href="/net/dial.go.html#1332423">i</a></span><span class="op" id="1332769">+</span><span class="num" id="1332770">1</span><span class="op" id="1332771">:</span><span class="op" id="1332772">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1332776">proto</span><span class="op" id="1332781">,</span>&nbsp;<span class="ident" id="1332783">i</span><span class="op" id="1332784">,</span>&nbsp;<span class="ident" id="1332786">ok</span>&nbsp;<span class="op" id="1332789">:=</span>&nbsp;<span class="ident" id="1332792"><a href="/net/parse.go.html#1477870">dtoi</a></span><span class="op" id="1332796">(</span><span class="ident" id="1332797"><a href="/net/dial.go.html#1332752">protostr</a></span><span class="op" id="1332805">,</span>&nbsp;<span class="num" id="1332807">0</span><span class="op" id="1332808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1332812">if</span>&nbsp;<span class="op" id="1332815">!</span><span class="ident" id="1332816"><a href="/net/dial.go.html#1332786">ok</a></span>&nbsp;<span class="op" id="1332819">||</span>&nbsp;<span class="ident" id="1332822"><a href="/net/dial.go.html#1332783">i</a></span>&nbsp;<span class="op" id="1332824">!=</span>&nbsp;<span class="builtinfunc" id="1332827">len</span><span class="op" id="1332830">(</span><span class="ident" id="1332831"><a href="/net/dial.go.html#1332752">protostr</a></span><span class="op" id="1332839">)</span>&nbsp;<span class="op" id="1332841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1332846"><a href="/net/dial.go.html#1332776">proto</a></span><span class="op" id="1332851">,</span>&nbsp;<span class="ident" id="1332853"><a href="/net/dial.go.html#1332409">err</a></span>&nbsp;<span class="op" id="1332857">=</span>&nbsp;<span class="ident" id="1332859"><a href="/net/lookup_unix.go.html#1459602">lookupProtocol</a></span><span class="op" id="1332873">(</span><span class="ident" id="1332874"><a href="/net/dial.go.html#1332752">protostr</a></span><span class="op" id="1332882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1332887">if</span>&nbsp;<span class="ident" id="1332890"><a href="/net/dial.go.html#1332409">err</a></span>&nbsp;<span class="op" id="1332894">!=</span>&nbsp;<span class="ident" id="1332897">nil</span>&nbsp;<span class="op" id="1332901">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1332907">return</span>&nbsp;<span class="string" id="1332914">&#34;&#34;</span><span class="op" id="1332916">,</span>&nbsp;<span class="num" id="1332918">0</span><span class="op" id="1332919">,</span>&nbsp;<span class="ident" id="1332921"><a href="/net/dial.go.html#1332409">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1332928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1332932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1332936">return</span>&nbsp;<span class="ident" id="1332943"><a href="/net/dial.go.html#1332384">afnet</a></span><span class="op" id="1332948">,</span>&nbsp;<span class="ident" id="1332950"><a href="/net/dial.go.html#1332776">proto</a></span><span class="op" id="1332955">,</span>&nbsp;<span class="ident" id="1332957">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1332962">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1332965">return</span>&nbsp;<span class="string" id="1332972">&#34;&#34;</span><span class="op" id="1332974">,</span>&nbsp;<span class="num" id="1332976">0</span><span class="op" id="1332977">,</span>&nbsp;<span class="ident" id="1332979"><a href="/net/net.go.html#1473867">UnknownNetworkError</a></span><span class="op" id="1332998">(</span><span class="ident" id="1332999"><a href="/net/dial.go.html#1332371">net</a></span><span class="op" id="1333002">)</span><br>
<span class="lineno"></span><span class="op" id="1333004">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1333007">func</span>&nbsp;<span class="ident" id="1333012">resolveAddr</span><span class="op" id="1333023">(</span><span class="ident" id="1333024">op</span><span class="op" id="1333026">,</span>&nbsp;<span class="ident" id="1333028">net</span><span class="op" id="1333031">,</span>&nbsp;<span class="ident" id="1333033">addr</span>&nbsp;<span class="builtintype" id="1333038">string</span><span class="op" id="1333044">,</span>&nbsp;<span class="ident" id="1333046">deadline</span>&nbsp;<span class="ident" id="1333055"><a href="/net/dial.go.html#1330415">time</a></span><span class="op" id="1333059">.</span><span class="ident" id="1333060">Time</span><span class="op" id="1333064">)</span>&nbsp;<span class="op" id="1333066">(</span><span class="ident" id="1333067"><a href="/net/ipsock.go.html#1441064">netaddr</a></span><span class="op" id="1333074">,</span>&nbsp;<span class="builtintype" id="1333076">error</span><span class="op" id="1333081">)</span>&nbsp;<span class="op" id="1333083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1333086">afnet</span><span class="op" id="1333091">,</span>&nbsp;<span class="ident" id="1333093">_</span><span class="op" id="1333094">,</span>&nbsp;<span class="ident" id="1333096">err</span>&nbsp;<span class="op" id="1333100">:=</span>&nbsp;<span class="ident" id="1333103"><a href="/net/dial.go.html#1332358">parseNetwork</a></span><span class="op" id="1333115">(</span><span class="ident" id="1333116"><a href="/net/dial.go.html#1333028">net</a></span><span class="op" id="1333119">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1333122">if</span>&nbsp;<span class="ident" id="1333125"><a href="/net/dial.go.html#1333096">err</a></span>&nbsp;<span class="op" id="1333129">!=</span>&nbsp;<span class="ident" id="1333132">nil</span>&nbsp;<span class="op" id="1333136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1333140">return</span>&nbsp;<span class="ident" id="1333147">nil</span><span class="op" id="1333150">,</span>&nbsp;<span class="ident" id="1333152"><a href="/net/dial.go.html#1333096">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1333157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1333160">if</span>&nbsp;<span class="ident" id="1333163"><a href="/net/dial.go.html#1333024">op</a></span>&nbsp;<span class="op" id="1333166">==</span>&nbsp;<span class="string" id="1333169">&#34;dial&#34;</span>&nbsp;<span class="op" id="1333176">&amp;&amp;</span>&nbsp;<span class="ident" id="1333179"><a href="/net/dial.go.html#1333033">addr</a></span>&nbsp;<span class="op" id="1333184">==</span>&nbsp;<span class="string" id="1333187">&#34;&#34;</span>&nbsp;<span class="op" id="1333190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1333194">return</span>&nbsp;<span class="ident" id="1333201">nil</span><span class="op" id="1333204">,</span>&nbsp;<span class="ident" id="1333206"><a href="/net/net.go.html#1472020">errMissingAddress</a></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1333225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1333228">switch</span>&nbsp;<span class="ident" id="1333235"><a href="/net/dial.go.html#1333086">afnet</a></span>&nbsp;<span class="op" id="1333241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1333244">case</span>&nbsp;<span class="string" id="1333249">&#34;unix&#34;</span><span class="op" id="1333255">,</span>&nbsp;<span class="string" id="1333257">&#34;unixgram&#34;</span><span class="op" id="1333267">,</span>&nbsp;<span class="string" id="1333269">&#34;unixpacket&#34;</span><span class="op" id="1333281">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1333285">return</span>&nbsp;<span class="ident" id="1333292"><a href="/net/unixsock.go.html#1526926">ResolveUnixAddr</a></span><span class="op" id="1333307">(</span><span class="ident" id="1333308"><a href="/net/dial.go.html#1333086">afnet</a></span><span class="op" id="1333313">,</span>&nbsp;<span class="ident" id="1333315"><a href="/net/dial.go.html#1333033">addr</a></span><span class="op" id="1333319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1333322">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1333325">return</span>&nbsp;<span class="ident" id="1333332"><a href="/net/ipsock.go.html#1446593">resolveInternetAddr</a></span><span class="op" id="1333351">(</span><span class="ident" id="1333352"><a href="/net/dial.go.html#1333086">afnet</a></span><span class="op" id="1333357">,</span>&nbsp;<span class="ident" id="1333359"><a href="/net/dial.go.html#1333033">addr</a></span><span class="op" id="1333363">,</span>&nbsp;<span class="ident" id="1333365"><a href="/net/dial.go.html#1333046">deadline</a></span><span class="op" id="1333373">)</span><br>
<span class="lineno"></span><span class="op" id="1333375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1333378">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;the&nbsp;address&nbsp;on&nbsp;the&nbsp;named&nbsp;network.</span><br>
<span class="lineno"></span><span class="comment" id="1333432">//</span><br>
<span class="lineno">115</span><span class="comment" id="1333435">//&nbsp;Known&nbsp;networks&nbsp;are&nbsp;&#34;tcp&#34;,&nbsp;&#34;tcp4&#34;&nbsp;(IPv4-only),&nbsp;&#34;tcp6&#34;&nbsp;(IPv6-only),</span><br>
<span class="lineno"></span><span class="comment" id="1333504">//&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;&nbsp;(IPv4-only),&nbsp;&#34;udp6&#34;&nbsp;(IPv6-only),&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;</span><br>
<span class="lineno"></span><span class="comment" id="1333566">//&nbsp;(IPv4-only),&nbsp;&#34;ip6&#34;&nbsp;(IPv6-only),&nbsp;&#34;unix&#34;,&nbsp;&#34;unixgram&#34;&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="1333624">//&nbsp;&#34;unixpacket&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="1333641">//</span><br>
<span class="lineno">120</span><span class="comment" id="1333644">//&nbsp;For&nbsp;TCP&nbsp;and&nbsp;UDP&nbsp;networks,&nbsp;addresses&nbsp;have&nbsp;the&nbsp;form&nbsp;host:port.</span><br>
<span class="lineno"></span><span class="comment" id="1333708">//&nbsp;If&nbsp;host&nbsp;is&nbsp;a&nbsp;literal&nbsp;IPv6&nbsp;address&nbsp;it&nbsp;must&nbsp;be&nbsp;enclosed</span><br>
<span class="lineno"></span><span class="comment" id="1333765">//&nbsp;in&nbsp;square&nbsp;brackets&nbsp;as&nbsp;in&nbsp;&#34;[::1]:80&#34;&nbsp;or&nbsp;&#34;[ipv6-host%zone]:80&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="1333830">//&nbsp;The&nbsp;functions&nbsp;JoinHostPort&nbsp;and&nbsp;SplitHostPort&nbsp;manipulate&nbsp;addresses</span><br>
<span class="lineno"></span><span class="comment" id="1333899">//&nbsp;in&nbsp;this&nbsp;form.</span><br>
<span class="lineno">125</span><span class="comment" id="1333916">//</span><br>
<span class="lineno"></span><span class="comment" id="1333919">//&nbsp;Examples:</span><br>
<span class="lineno"></span><span class="comment" id="1333932">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;tcp&#34;,&nbsp;&#34;12.34.56.78:80&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="1333965">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;tcp&#34;,&nbsp;&#34;google.com:http&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="1333999">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;tcp&#34;,&nbsp;&#34;[2001:db8::1]:http&#34;)</span><br>
<span class="lineno">130</span><span class="comment" id="1334036">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;tcp&#34;,&nbsp;&#34;[fe80::1%lo0]:80&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="1334071">//</span><br>
<span class="lineno"></span><span class="comment" id="1334074">//&nbsp;For&nbsp;IP&nbsp;networks,&nbsp;the&nbsp;network&nbsp;must&nbsp;be&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;&nbsp;or&nbsp;&#34;ip6&#34;&nbsp;followed</span><br>
<span class="lineno"></span><span class="comment" id="1334144">//&nbsp;by&nbsp;a&nbsp;colon&nbsp;and&nbsp;a&nbsp;protocol&nbsp;number&nbsp;or&nbsp;name&nbsp;and&nbsp;the&nbsp;addr&nbsp;must&nbsp;be&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="1334211">//&nbsp;literal&nbsp;IP&nbsp;address.</span><br>
<span class="lineno">135</span><span class="comment" id="1334234">//</span><br>
<span class="lineno"></span><span class="comment" id="1334237">//&nbsp;Examples:</span><br>
<span class="lineno"></span><span class="comment" id="1334250">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;ip4:1&#34;,&nbsp;&#34;127.0.0.1&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="1334280">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;ip6:ospf&#34;,&nbsp;&#34;::1&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="1334307">//</span><br>
<span class="lineno">140</span><span class="comment" id="1334310">//&nbsp;For&nbsp;Unix&nbsp;networks,&nbsp;the&nbsp;address&nbsp;must&nbsp;be&nbsp;a&nbsp;file&nbsp;system&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="1334372">func</span>&nbsp;<span class="ident" id="1334377">Dial</span><span class="op" id="1334381">(</span><span class="ident" id="1334382">network</span><span class="op" id="1334389">,</span>&nbsp;<span class="ident" id="1334391">address</span>&nbsp;<span class="builtintype" id="1334399">string</span><span class="op" id="1334405">)</span>&nbsp;<span class="op" id="1334407">(</span><span class="ident" id="1334408"><a href="/net/net.go.html#1465335">Conn</a></span><span class="op" id="1334412">,</span>&nbsp;<span class="builtintype" id="1334414">error</span><span class="op" id="1334419">)</span>&nbsp;<span class="op" id="1334421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1334424">var</span>&nbsp;<span class="ident" id="1334428">d</span>&nbsp;<span class="ident" id="1334430"><a href="/net/dial.go.html#1330674">Dialer</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1334438">return</span>&nbsp;<span class="ident" id="1334445"><a href="/net/dial.go.html#1334428">d</a></span><span class="op" id="1334446">.</span><span class="ident" id="1334447">Dial</span><span class="op" id="1334451">(</span><span class="ident" id="1334452"><a href="/net/dial.go.html#1334382">network</a></span><span class="op" id="1334459">,</span>&nbsp;<span class="ident" id="1334461"><a href="/net/dial.go.html#1334391">address</a></span><span class="op" id="1334468">)</span><br>
<span class="lineno"></span><span class="op" id="1334470">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="1334473">//&nbsp;DialTimeout&nbsp;acts&nbsp;like&nbsp;Dial&nbsp;but&nbsp;takes&nbsp;a&nbsp;timeout.</span><br>
<span class="lineno"></span><span class="comment" id="1334524">//&nbsp;The&nbsp;timeout&nbsp;includes&nbsp;name&nbsp;resolution,&nbsp;if&nbsp;required.</span><br>
<span class="lineno"></span><span class="keyword" id="1334578">func</span>&nbsp;<span class="ident" id="1334583">DialTimeout</span><span class="op" id="1334594">(</span><span class="ident" id="1334595">network</span><span class="op" id="1334602">,</span>&nbsp;<span class="ident" id="1334604">address</span>&nbsp;<span class="builtintype" id="1334612">string</span><span class="op" id="1334618">,</span>&nbsp;<span class="ident" id="1334620">timeout</span>&nbsp;<span class="ident" id="1334628"><a href="/net/dial.go.html#1330415">time</a></span><span class="op" id="1334632">.</span><span class="ident" id="1334633">Duration</span><span class="op" id="1334641">)</span>&nbsp;<span class="op" id="1334643">(</span><span class="ident" id="1334644"><a href="/net/net.go.html#1465335">Conn</a></span><span class="op" id="1334648">,</span>&nbsp;<span class="builtintype" id="1334650">error</span><span class="op" id="1334655">)</span>&nbsp;<span class="op" id="1334657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1334660">d</span>&nbsp;<span class="op" id="1334662">:=</span>&nbsp;<span class="ident" id="1334665"><a href="/net/dial.go.html#1330674">Dialer</a></span><span class="op" id="1334671">{</span><span class="ident" id="1334672">Timeout</span><span class="op" id="1334679">:</span>&nbsp;<span class="ident" id="1334681"><a href="/net/dial.go.html#1334620">timeout</a></span><span class="op" id="1334688">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1334691">return</span>&nbsp;<span class="ident" id="1334698"><a href="/net/dial.go.html#1334660">d</a></span><span class="op" id="1334699">.</span><span class="ident" id="1334700">Dial</span><span class="op" id="1334704">(</span><span class="ident" id="1334705"><a href="/net/dial.go.html#1334595">network</a></span><span class="op" id="1334712">,</span>&nbsp;<span class="ident" id="1334714"><a href="/net/dial.go.html#1334604">address</a></span><span class="op" id="1334721">)</span><br>
<span class="lineno"></span><span class="op" id="1334723">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1334726">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;the&nbsp;address&nbsp;on&nbsp;the&nbsp;named&nbsp;network.</span><br>
<span class="lineno"></span><span class="comment" id="1334780">//</span><br>
<span class="lineno">155</span><span class="comment" id="1334783">//&nbsp;See&nbsp;func&nbsp;Dial&nbsp;for&nbsp;a&nbsp;description&nbsp;of&nbsp;the&nbsp;network&nbsp;and&nbsp;address</span><br>
<span class="lineno"></span><span class="comment" id="1334845">//&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="keyword" id="1334860">func</span>&nbsp;<span class="op" id="1334865">(</span><span class="ident" id="1334866">d</span>&nbsp;<span class="op" id="1334868">*</span><span class="ident" id="1334869"><a href="/net/dial.go.html#1330674">Dialer</a></span><span class="op" id="1334875">)</span>&nbsp;<span class="ident" id="1334877">Dial</span><span class="op" id="1334881">(</span><span class="ident" id="1334882">network</span><span class="op" id="1334889">,</span>&nbsp;<span class="ident" id="1334891">address</span>&nbsp;<span class="builtintype" id="1334899">string</span><span class="op" id="1334905">)</span>&nbsp;<span class="op" id="1334907">(</span><span class="ident" id="1334908"><a href="/net/net.go.html#1465335">Conn</a></span><span class="op" id="1334912">,</span>&nbsp;<span class="builtintype" id="1334914">error</span><span class="op" id="1334919">)</span>&nbsp;<span class="op" id="1334921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1334924">ra</span><span class="op" id="1334926">,</span>&nbsp;<span class="ident" id="1334928">err</span>&nbsp;<span class="op" id="1334932">:=</span>&nbsp;<span class="ident" id="1334935"><a href="/net/dial.go.html#1333012">resolveAddr</a></span><span class="op" id="1334946">(</span><span class="string" id="1334947">&#34;dial&#34;</span><span class="op" id="1334953">,</span>&nbsp;<span class="ident" id="1334955"><a href="/net/dial.go.html#1334882">network</a></span><span class="op" id="1334962">,</span>&nbsp;<span class="ident" id="1334964"><a href="/net/dial.go.html#1334891">address</a></span><span class="op" id="1334971">,</span>&nbsp;<span class="ident" id="1334973"><a href="/net/dial.go.html#1334866">d</a></span><span class="op" id="1334974">.</span><span class="ident" id="1334975">deadline</span><span class="op" id="1334983">(</span><span class="op" id="1334984">)</span><span class="op" id="1334985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1334988">if</span>&nbsp;<span class="ident" id="1334991"><a href="/net/dial.go.html#1334928">err</a></span>&nbsp;<span class="op" id="1334995">!=</span>&nbsp;<span class="ident" id="1334998">nil</span>&nbsp;<span class="op" id="1335002">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335006">return</span>&nbsp;<span class="ident" id="1335013">nil</span><span class="op" id="1335016">,</span>&nbsp;<span class="op" id="1335018">&amp;</span><span class="ident" id="1335019"><a href="/net/net.go.html#1472480">OpError</a></span><span class="op" id="1335026">{</span><span class="ident" id="1335027">Op</span><span class="op" id="1335029">:</span>&nbsp;<span class="string" id="1335031">&#34;dial&#34;</span><span class="op" id="1335037">,</span>&nbsp;<span class="ident" id="1335039">Net</span><span class="op" id="1335042">:</span>&nbsp;<span class="ident" id="1335044"><a href="/net/dial.go.html#1334882">network</a></span><span class="op" id="1335051">,</span>&nbsp;<span class="ident" id="1335053">Addr</span><span class="op" id="1335057">:</span>&nbsp;<span class="ident" id="1335059">nil</span><span class="op" id="1335062">,</span>&nbsp;<span class="ident" id="1335064">Err</span><span class="op" id="1335067">:</span>&nbsp;<span class="ident" id="1335069"><a href="/net/dial.go.html#1334928">err</a></span><span class="op" id="1335072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1335075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1335078">dialer</span>&nbsp;<span class="op" id="1335085">:=</span>&nbsp;<span class="keyword" id="1335088">func</span><span class="op" id="1335092">(</span><span class="ident" id="1335093">deadline</span>&nbsp;<span class="ident" id="1335102"><a href="/net/dial.go.html#1330415">time</a></span><span class="op" id="1335106">.</span><span class="ident" id="1335107">Time</span><span class="op" id="1335111">)</span>&nbsp;<span class="op" id="1335113">(</span><span class="ident" id="1335114"><a href="/net/net.go.html#1465335">Conn</a></span><span class="op" id="1335118">,</span>&nbsp;<span class="builtintype" id="1335120">error</span><span class="op" id="1335125">)</span>&nbsp;<span class="op" id="1335127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335131">return</span>&nbsp;<span class="ident" id="1335138"><a href="/net/dial.go.html#1336985">dialSingle</a></span><span class="op" id="1335148">(</span><span class="ident" id="1335149"><a href="/net/dial.go.html#1334882">network</a></span><span class="op" id="1335156">,</span>&nbsp;<span class="ident" id="1335158"><a href="/net/dial.go.html#1334891">address</a></span><span class="op" id="1335165">,</span>&nbsp;<span class="ident" id="1335167"><a href="/net/dial.go.html#1334866">d</a></span><span class="op" id="1335168">.</span><span class="ident" id="1335169">LocalAddr</span><span class="op" id="1335178">,</span>&nbsp;<span class="ident" id="1335180"><a href="/net/dial.go.html#1334924">ra</a></span><span class="op" id="1335182">.</span><span class="ident" id="1335183">toAddr</span><span class="op" id="1335189">(</span><span class="op" id="1335190">)</span><span class="op" id="1335191">,</span>&nbsp;<span class="ident" id="1335193"><a href="/net/dial.go.html#1335093">deadline</a></span><span class="op" id="1335201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1335204">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335207">if</span>&nbsp;<span class="ident" id="1335210">ras</span><span class="op" id="1335213">,</span>&nbsp;<span class="ident" id="1335215">ok</span>&nbsp;<span class="op" id="1335218">:=</span>&nbsp;<span class="ident" id="1335221"><a href="/net/dial.go.html#1334924">ra</a></span><span class="op" id="1335223">.</span><span class="op" id="1335224">(</span><span class="ident" id="1335225"><a href="/net/ipsock.go.html#1441289">addrList</a></span><span class="op" id="1335233">)</span><span class="op" id="1335234">;</span>&nbsp;<span class="ident" id="1335236"><a href="/net/dial.go.html#1335215">ok</a></span>&nbsp;<span class="op" id="1335239">&amp;&amp;</span>&nbsp;<span class="ident" id="1335242"><a href="/net/dial.go.html#1334866">d</a></span><span class="op" id="1335243">.</span><span class="ident" id="1335244">DualStack</span>&nbsp;<span class="op" id="1335254">&amp;&amp;</span>&nbsp;<span class="ident" id="1335257"><a href="/net/dial.go.html#1334882">network</a></span>&nbsp;<span class="op" id="1335265">==</span>&nbsp;<span class="string" id="1335268">&#34;tcp&#34;</span>&nbsp;<span class="op" id="1335274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1335278"><a href="/net/dial.go.html#1335078">dialer</a></span>&nbsp;<span class="op" id="1335285">=</span>&nbsp;<span class="keyword" id="1335287">func</span><span class="op" id="1335291">(</span><span class="ident" id="1335292">deadline</span>&nbsp;<span class="ident" id="1335301"><a href="/net/dial.go.html#1330415">time</a></span><span class="op" id="1335305">.</span><span class="ident" id="1335306">Time</span><span class="op" id="1335310">)</span>&nbsp;<span class="op" id="1335312">(</span><span class="ident" id="1335313"><a href="/net/net.go.html#1465335">Conn</a></span><span class="op" id="1335317">,</span>&nbsp;<span class="builtintype" id="1335319">error</span><span class="op" id="1335324">)</span>&nbsp;<span class="op" id="1335326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335331">return</span>&nbsp;<span class="ident" id="1335338"><a href="/net/dial.go.html#1335946">dialMulti</a></span><span class="op" id="1335347">(</span><span class="ident" id="1335348"><a href="/net/dial.go.html#1334882">network</a></span><span class="op" id="1335355">,</span>&nbsp;<span class="ident" id="1335357"><a href="/net/dial.go.html#1334891">address</a></span><span class="op" id="1335364">,</span>&nbsp;<span class="ident" id="1335366"><a href="/net/dial.go.html#1334866">d</a></span><span class="op" id="1335367">.</span><span class="ident" id="1335368">LocalAddr</span><span class="op" id="1335377">,</span>&nbsp;<span class="ident" id="1335379"><a href="/net/dial.go.html#1335210">ras</a></span><span class="op" id="1335382">,</span>&nbsp;<span class="ident" id="1335384"><a href="/net/dial.go.html#1335292">deadline</a></span><span class="op" id="1335392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1335396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1335399">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1335402">c</span><span class="op" id="1335403">,</span>&nbsp;<span class="ident" id="1335405"><a href="/net/dial.go.html#1334928">err</a></span>&nbsp;<span class="op" id="1335409">:=</span>&nbsp;<span class="ident" id="1335412"><a href="/net/fd_unix.go.html#1388593">dial</a></span><span class="op" id="1335416">(</span><span class="ident" id="1335417"><a href="/net/dial.go.html#1334882">network</a></span><span class="op" id="1335424">,</span>&nbsp;<span class="ident" id="1335426"><a href="/net/dial.go.html#1334924">ra</a></span><span class="op" id="1335428">.</span><span class="ident" id="1335429">toAddr</span><span class="op" id="1335435">(</span><span class="op" id="1335436">)</span><span class="op" id="1335437">,</span>&nbsp;<span class="ident" id="1335439"><a href="/net/dial.go.html#1335078">dialer</a></span><span class="op" id="1335445">,</span>&nbsp;<span class="ident" id="1335447"><a href="/net/dial.go.html#1334866">d</a></span><span class="op" id="1335448">.</span><span class="ident" id="1335449">deadline</span><span class="op" id="1335457">(</span><span class="op" id="1335458">)</span><span class="op" id="1335459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335462">if</span>&nbsp;<span class="ident" id="1335465"><a href="/net/dial.go.html#1334866">d</a></span><span class="op" id="1335466">.</span><span class="ident" id="1335467">KeepAlive</span>&nbsp;<span class="op" id="1335477">&gt;</span>&nbsp;<span class="num" id="1335479">0</span>&nbsp;<span class="op" id="1335481">&amp;&amp;</span>&nbsp;<span class="ident" id="1335484"><a href="/net/dial.go.html#1334928">err</a></span>&nbsp;<span class="op" id="1335488">==</span>&nbsp;<span class="ident" id="1335491">nil</span>&nbsp;<span class="op" id="1335495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335499">if</span>&nbsp;<span class="ident" id="1335502">tc</span><span class="op" id="1335504">,</span>&nbsp;<span class="ident" id="1335506">ok</span>&nbsp;<span class="op" id="1335509">:=</span>&nbsp;<span class="ident" id="1335512"><a href="/net/dial.go.html#1335402">c</a></span><span class="op" id="1335513">.</span><span class="op" id="1335514">(</span><span class="op" id="1335515">*</span><span class="ident" id="1335516"><a href="/net/tcpsock_posix.go.html#1507019">TCPConn</a></span><span class="op" id="1335523">)</span><span class="op" id="1335524">;</span>&nbsp;<span class="ident" id="1335526"><a href="/net/dial.go.html#1335506">ok</a></span>&nbsp;<span class="op" id="1335529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1335534"><a href="/net/dial.go.html#1335502">tc</a></span><span class="op" id="1335536">.</span><span class="ident" id="1335537">SetKeepAlive</span><span class="op" id="1335549">(</span><span class="builtintype" id="1335550">true</span><span class="op" id="1335554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1335559"><a href="/net/dial.go.html#1335502">tc</a></span><span class="op" id="1335561">.</span><span class="ident" id="1335562">SetKeepAlivePeriod</span><span class="op" id="1335580">(</span><span class="ident" id="1335581"><a href="/net/dial.go.html#1334866">d</a></span><span class="op" id="1335582">.</span><span class="ident" id="1335583">KeepAlive</span><span class="op" id="1335592">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1335597"><a href="/net/dial.go.html#1335649">testHookSetKeepAlive</a></span><span class="op" id="1335617">(</span><span class="op" id="1335618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1335622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1335625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335628">return</span>&nbsp;<span class="ident" id="1335635"><a href="/net/dial.go.html#1335402">c</a></span><span class="op" id="1335636">,</span>&nbsp;<span class="ident" id="1335638"><a href="/net/dial.go.html#1334928">err</a></span><br>
<span class="lineno"></span><span class="op" id="1335642">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="keyword" id="1335645">var</span>&nbsp;<span class="ident" id="1335649">testHookSetKeepAlive</span>&nbsp;<span class="op" id="1335670">=</span>&nbsp;<span class="keyword" id="1335672">func</span><span class="op" id="1335676">(</span><span class="op" id="1335677">)</span>&nbsp;<span class="op" id="1335679">{</span><span class="op" id="1335680">}</span>&nbsp;<span class="comment" id="1335682">//&nbsp;changed&nbsp;by&nbsp;dial_test.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1335710">//&nbsp;dialMulti&nbsp;attempts&nbsp;to&nbsp;establish&nbsp;connections&nbsp;to&nbsp;each&nbsp;destination&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1335780">//&nbsp;the&nbsp;list&nbsp;of&nbsp;addresses.&nbsp;It&nbsp;will&nbsp;return&nbsp;the&nbsp;first&nbsp;established</span><br>
<span class="lineno">185</span><span class="comment" id="1335843">//&nbsp;connection&nbsp;and&nbsp;close&nbsp;the&nbsp;other&nbsp;connections.&nbsp;Otherwise&nbsp;it&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="1335911">//&nbsp;error&nbsp;on&nbsp;the&nbsp;last&nbsp;attempt.</span><br>
<span class="lineno"></span><span class="keyword" id="1335941">func</span>&nbsp;<span class="ident" id="1335946">dialMulti</span><span class="op" id="1335955">(</span><span class="ident" id="1335956">net</span><span class="op" id="1335959">,</span>&nbsp;<span class="ident" id="1335961">addr</span>&nbsp;<span class="builtintype" id="1335966">string</span><span class="op" id="1335972">,</span>&nbsp;<span class="ident" id="1335974">la</span>&nbsp;<span class="ident" id="1335977"><a href="/net/net.go.html#1465097">Addr</a></span><span class="op" id="1335981">,</span>&nbsp;<span class="ident" id="1335983">ras</span>&nbsp;<span class="ident" id="1335987"><a href="/net/ipsock.go.html#1441289">addrList</a></span><span class="op" id="1335995">,</span>&nbsp;<span class="ident" id="1335997">deadline</span>&nbsp;<span class="ident" id="1336006"><a href="/net/dial.go.html#1330415">time</a></span><span class="op" id="1336010">.</span><span class="ident" id="1336011">Time</span><span class="op" id="1336015">)</span>&nbsp;<span class="op" id="1336017">(</span><span class="ident" id="1336018"><a href="/net/net.go.html#1465335">Conn</a></span><span class="op" id="1336022">,</span>&nbsp;<span class="builtintype" id="1336024">error</span><span class="op" id="1336029">)</span>&nbsp;<span class="op" id="1336031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1336034">type</span>&nbsp;<span class="ident" id="1336039">racer</span>&nbsp;<span class="keyword" id="1336045">struct</span>&nbsp;<span class="op" id="1336052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336056"><a href="/net/net.go.html#1465335">Conn</a></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="1336063">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1336070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1336073">//&nbsp;Sig&nbsp;controls&nbsp;the&nbsp;flow&nbsp;of&nbsp;dial&nbsp;results&nbsp;on&nbsp;lane.&nbsp;It&nbsp;passes&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1336136">//&nbsp;token&nbsp;to&nbsp;the&nbsp;next&nbsp;racer&nbsp;and&nbsp;also&nbsp;indicates&nbsp;the&nbsp;end&nbsp;of&nbsp;flow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1336199">//&nbsp;by&nbsp;using&nbsp;closed&nbsp;channel.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336228">sig</span>&nbsp;<span class="op" id="1336232">:=</span>&nbsp;<span class="builtinfunc" id="1336235">make</span><span class="op" id="1336239">(</span><span class="keyword" id="1336240">chan</span>&nbsp;<span class="builtintype" id="1336245">bool</span><span class="op" id="1336249">,</span>&nbsp;<span class="num" id="1336251">1</span><span class="op" id="1336252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336255">lane</span>&nbsp;<span class="op" id="1336260">:=</span>&nbsp;<span class="builtinfunc" id="1336263">make</span><span class="op" id="1336267">(</span><span class="keyword" id="1336268">chan</span>&nbsp;<span class="ident" id="1336273"><a href="/net/dial.go.html#1336039">racer</a></span><span class="op" id="1336278">,</span>&nbsp;<span class="num" id="1336280">1</span><span class="op" id="1336281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1336284">for</span>&nbsp;<span class="ident" id="1336288">_</span><span class="op" id="1336289">,</span>&nbsp;<span class="ident" id="1336291">ra</span>&nbsp;<span class="op" id="1336294">:=</span>&nbsp;<span class="keyword" id="1336297">range</span>&nbsp;<span class="ident" id="1336303"><a href="/net/dial.go.html#1335983">ras</a></span>&nbsp;<span class="op" id="1336307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1336311">go</span>&nbsp;<span class="keyword" id="1336314">func</span><span class="op" id="1336318">(</span><span class="ident" id="1336319">ra</span>&nbsp;<span class="ident" id="1336322"><a href="/net/net.go.html#1465097">Addr</a></span><span class="op" id="1336326">)</span>&nbsp;<span class="op" id="1336328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336333">c</span><span class="op" id="1336334">,</span>&nbsp;<span class="ident" id="1336336">err</span>&nbsp;<span class="op" id="1336340">:=</span>&nbsp;<span class="ident" id="1336343"><a href="/net/dial.go.html#1336985">dialSingle</a></span><span class="op" id="1336353">(</span><span class="ident" id="1336354"><a href="/net/dial.go.html#1335956">net</a></span><span class="op" id="1336357">,</span>&nbsp;<span class="ident" id="1336359"><a href="/net/dial.go.html#1335961">addr</a></span><span class="op" id="1336363">,</span>&nbsp;<span class="ident" id="1336365"><a href="/net/dial.go.html#1335974">la</a></span><span class="op" id="1336367">,</span>&nbsp;<span class="ident" id="1336369"><a href="/net/dial.go.html#1336319">ra</a></span><span class="op" id="1336371">,</span>&nbsp;<span class="ident" id="1336373"><a href="/net/dial.go.html#1335997">deadline</a></span><span class="op" id="1336381">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1336386">if</span>&nbsp;<span class="ident" id="1336389">_</span><span class="op" id="1336390">,</span>&nbsp;<span class="ident" id="1336392">ok</span>&nbsp;<span class="op" id="1336395">:=</span>&nbsp;<span class="op" id="1336398">&lt;-</span><span class="ident" id="1336400"><a href="/net/dial.go.html#1336228">sig</a></span><span class="op" id="1336403">;</span>&nbsp;<span class="ident" id="1336405"><a href="/net/dial.go.html#1336392">ok</a></span>&nbsp;<span class="op" id="1336408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336414"><a href="/net/dial.go.html#1336255">lane</a></span>&nbsp;<span class="op" id="1336419">&lt;-</span>&nbsp;<span class="ident" id="1336422"><a href="/net/dial.go.html#1336039">racer</a></span><span class="op" id="1336427">{</span><span class="ident" id="1336428"><a href="/net/dial.go.html#1336333">c</a></span><span class="op" id="1336429">,</span>&nbsp;<span class="ident" id="1336431"><a href="/net/dial.go.html#1336336">err</a></span><span class="op" id="1336434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1336439">}</span>&nbsp;<span class="keyword" id="1336441">else</span>&nbsp;<span class="keyword" id="1336446">if</span>&nbsp;<span class="ident" id="1336449"><a href="/net/dial.go.html#1336336">err</a></span>&nbsp;<span class="op" id="1336453">==</span>&nbsp;<span class="ident" id="1336456">nil</span>&nbsp;<span class="op" id="1336460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1336466">//&nbsp;We&nbsp;have&nbsp;to&nbsp;return&nbsp;the&nbsp;resources</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1336505">//&nbsp;that&nbsp;belong&nbsp;to&nbsp;the&nbsp;other</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1336537">//&nbsp;connections&nbsp;here&nbsp;for&nbsp;avoiding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1336574">//&nbsp;unnecessary&nbsp;resource&nbsp;starvation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336614"><a href="/net/dial.go.html#1336333">c</a></span><span class="op" id="1336615">.</span><span class="ident" id="1336616">Close</span><span class="op" id="1336621">(</span><span class="op" id="1336622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1336627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1336631">}</span><span class="op" id="1336632">(</span><span class="ident" id="1336633"><a href="/net/dial.go.html#1336291">ra</a></span><span class="op" id="1336635">.</span><span class="ident" id="1336636">toAddr</span><span class="op" id="1336642">(</span><span class="op" id="1336643">)</span><span class="op" id="1336644">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1336647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1336650">defer</span>&nbsp;<span class="builtinfunc" id="1336656">close</span><span class="op" id="1336661">(</span><span class="ident" id="1336662"><a href="/net/dial.go.html#1336228">sig</a></span><span class="op" id="1336665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336668">lastErr</span>&nbsp;<span class="op" id="1336676">:=</span>&nbsp;<span class="ident" id="1336679"><a href="/net/net.go.html#1472112">errTimeout</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336691">nracers</span>&nbsp;<span class="op" id="1336699">:=</span>&nbsp;<span class="builtinfunc" id="1336702">len</span><span class="op" id="1336705">(</span><span class="ident" id="1336706"><a href="/net/dial.go.html#1335983">ras</a></span><span class="op" id="1336709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1336712">for</span>&nbsp;<span class="ident" id="1336716"><a href="/net/dial.go.html#1336691">nracers</a></span>&nbsp;<span class="op" id="1336724">&gt;</span>&nbsp;<span class="num" id="1336726">0</span>&nbsp;<span class="op" id="1336728">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336732"><a href="/net/dial.go.html#1336228">sig</a></span>&nbsp;<span class="op" id="1336736">&lt;-</span>&nbsp;<span class="builtintype" id="1336739">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336746">racer</span>&nbsp;<span class="op" id="1336752">:=</span>&nbsp;<span class="op" id="1336755">&lt;-</span><span class="ident" id="1336757"><a href="/net/dial.go.html#1336255">lane</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1336764">if</span>&nbsp;<span class="ident" id="1336767"><a href="/net/dial.go.html#1336746">racer</a></span><span class="op" id="1336772">.</span><span class="builtintype" id="1336773">error</span>&nbsp;<span class="op" id="1336779">==</span>&nbsp;<span class="ident" id="1336782">nil</span>&nbsp;<span class="op" id="1336786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1336791">return</span>&nbsp;<span class="ident" id="1336798"><a href="/net/dial.go.html#1336746">racer</a></span><span class="op" id="1336803">.</span><span class="ident" id="1336804">Conn</span><span class="op" id="1336808">,</span>&nbsp;<span class="ident" id="1336810">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1336816">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336820"><a href="/net/dial.go.html#1336668">lastErr</a></span>&nbsp;<span class="op" id="1336828">=</span>&nbsp;<span class="ident" id="1336830"><a href="/net/dial.go.html#1336746">racer</a></span><span class="op" id="1336835">.</span><span class="builtintype" id="1336836">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336844"><a href="/net/dial.go.html#1336691">nracers</a></span><span class="op" id="1336851">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1336855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1336858">return</span>&nbsp;<span class="ident" id="1336865">nil</span><span class="op" id="1336868">,</span>&nbsp;<span class="ident" id="1336870"><a href="/net/dial.go.html#1336668">lastErr</a></span><br>
<span class="lineno"></span><span class="op" id="1336878">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="1336881">//&nbsp;dialSingle&nbsp;attempts&nbsp;to&nbsp;establish&nbsp;and&nbsp;returns&nbsp;a&nbsp;single&nbsp;connection&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1336952">//&nbsp;the&nbsp;destination&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="1336980">func</span>&nbsp;<span class="ident" id="1336985">dialSingle</span><span class="op" id="1336995">(</span><span class="ident" id="1336996">net</span><span class="op" id="1336999">,</span>&nbsp;<span class="ident" id="1337001">addr</span>&nbsp;<span class="builtintype" id="1337006">string</span><span class="op" id="1337012">,</span>&nbsp;<span class="ident" id="1337014">la</span><span class="op" id="1337016">,</span>&nbsp;<span class="ident" id="1337018">ra</span>&nbsp;<span class="ident" id="1337021"><a href="/net/net.go.html#1465097">Addr</a></span><span class="op" id="1337025">,</span>&nbsp;<span class="ident" id="1337027">deadline</span>&nbsp;<span class="ident" id="1337036"><a href="/net/dial.go.html#1330415">time</a></span><span class="op" id="1337040">.</span><span class="ident" id="1337041">Time</span><span class="op" id="1337045">)</span>&nbsp;<span class="op" id="1337047">(</span><span class="ident" id="1337048">c</span>&nbsp;<span class="ident" id="1337050"><a href="/net/net.go.html#1465335">Conn</a></span><span class="op" id="1337054">,</span>&nbsp;<span class="ident" id="1337056">err</span>&nbsp;<span class="builtintype" id="1337060">error</span><span class="op" id="1337065">)</span>&nbsp;<span class="op" id="1337067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337070">if</span>&nbsp;<span class="ident" id="1337073"><a href="/net/dial.go.html#1337014">la</a></span>&nbsp;<span class="op" id="1337076">!=</span>&nbsp;<span class="ident" id="1337079">nil</span>&nbsp;<span class="op" id="1337083">&amp;&amp;</span>&nbsp;<span class="ident" id="1337086"><a href="/net/dial.go.html#1337014">la</a></span><span class="op" id="1337088">.</span><span class="ident" id="1337089">Network</span><span class="op" id="1337096">(</span><span class="op" id="1337097">)</span>&nbsp;<span class="op" id="1337099">!=</span>&nbsp;<span class="ident" id="1337102"><a href="/net/dial.go.html#1337018">ra</a></span><span class="op" id="1337104">.</span><span class="ident" id="1337105">Network</span><span class="op" id="1337112">(</span><span class="op" id="1337113">)</span>&nbsp;<span class="op" id="1337115">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337119">return</span>&nbsp;<span class="ident" id="1337126">nil</span><span class="op" id="1337129">,</span>&nbsp;<span class="op" id="1337131">&amp;</span><span class="ident" id="1337132"><a href="/net/net.go.html#1472480">OpError</a></span><span class="op" id="1337139">{</span><span class="ident" id="1337140">Op</span><span class="op" id="1337142">:</span>&nbsp;<span class="string" id="1337144">&#34;dial&#34;</span><span class="op" id="1337150">,</span>&nbsp;<span class="ident" id="1337152">Net</span><span class="op" id="1337155">:</span>&nbsp;<span class="ident" id="1337157"><a href="/net/dial.go.html#1336996">net</a></span><span class="op" id="1337160">,</span>&nbsp;<span class="ident" id="1337162">Addr</span><span class="op" id="1337166">:</span>&nbsp;<span class="ident" id="1337168"><a href="/net/dial.go.html#1337018">ra</a></span><span class="op" id="1337170">,</span>&nbsp;<span class="ident" id="1337172">Err</span><span class="op" id="1337175">:</span>&nbsp;<span class="ident" id="1337177"><a href="/net/dial.go.html#1330405">errors</a></span><span class="op" id="1337183">.</span><span class="ident" id="1337184">New</span><span class="op" id="1337187">(</span><span class="string" id="1337188">&#34;mismatched&nbsp;local&nbsp;address&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="1337221">+</span>&nbsp;<span class="ident" id="1337223"><a href="/net/dial.go.html#1337014">la</a></span><span class="op" id="1337225">.</span><span class="ident" id="1337226">Network</span><span class="op" id="1337233">(</span><span class="op" id="1337234">)</span><span class="op" id="1337235">)</span><span class="op" id="1337236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1337239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337242">switch</span>&nbsp;<span class="ident" id="1337249">ra</span>&nbsp;<span class="op" id="1337252">:=</span>&nbsp;<span class="ident" id="1337255"><a href="/net/dial.go.html#1337018">ra</a></span><span class="op" id="1337257">.</span><span class="op" id="1337258">(</span><span class="keyword" id="1337259">type</span><span class="op" id="1337263">)</span>&nbsp;<span class="op" id="1337265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337268">case</span>&nbsp;<span class="op" id="1337273">*</span><span class="ident" id="1337274"><a href="/net/tcpsock.go.html#1504387">TCPAddr</a></span><span class="op" id="1337281">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1337285">la</span><span class="op" id="1337287">,</span>&nbsp;<span class="ident" id="1337289">_</span>&nbsp;<span class="op" id="1337291">:=</span>&nbsp;<span class="ident" id="1337294"><a href="/net/dial.go.html#1337014">la</a></span><span class="op" id="1337296">.</span><span class="op" id="1337297">(</span><span class="op" id="1337298">*</span><span class="ident" id="1337299"><a href="/net/tcpsock.go.html#1504387">TCPAddr</a></span><span class="op" id="1337306">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1337310"><a href="/net/dial.go.html#1337048">c</a></span><span class="op" id="1337311">,</span>&nbsp;<span class="ident" id="1337313"><a href="/net/dial.go.html#1337056">err</a></span>&nbsp;<span class="op" id="1337317">=</span>&nbsp;<span class="ident" id="1337319"><a href="/net/tcpsock_posix.go.html#1509755">dialTCP</a></span><span class="op" id="1337326">(</span><span class="ident" id="1337327"><a href="/net/dial.go.html#1336996">net</a></span><span class="op" id="1337330">,</span>&nbsp;<span class="ident" id="1337332"><a href="/net/dial.go.html#1337285">la</a></span><span class="op" id="1337334">,</span>&nbsp;<span class="ident" id="1337336"><a href="/net/dial.go.html#1337249">ra</a></span><span class="op" id="1337338">,</span>&nbsp;<span class="ident" id="1337340"><a href="/net/dial.go.html#1337027">deadline</a></span><span class="op" id="1337348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337351">case</span>&nbsp;<span class="op" id="1337356">*</span><span class="ident" id="1337357"><a href="/net/udpsock.go.html#1516760">UDPAddr</a></span><span class="op" id="1337364">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1337368">la</span><span class="op" id="1337370">,</span>&nbsp;<span class="ident" id="1337372">_</span>&nbsp;<span class="op" id="1337374">:=</span>&nbsp;<span class="ident" id="1337377"><a href="/net/dial.go.html#1337014">la</a></span><span class="op" id="1337379">.</span><span class="op" id="1337380">(</span><span class="op" id="1337381">*</span><span class="ident" id="1337382"><a href="/net/udpsock.go.html#1516760">UDPAddr</a></span><span class="op" id="1337389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1337393"><a href="/net/dial.go.html#1337048">c</a></span><span class="op" id="1337394">,</span>&nbsp;<span class="ident" id="1337396"><a href="/net/dial.go.html#1337056">err</a></span>&nbsp;<span class="op" id="1337400">=</span>&nbsp;<span class="ident" id="1337402"><a href="/net/udpsock_posix.go.html#1523143">dialUDP</a></span><span class="op" id="1337409">(</span><span class="ident" id="1337410"><a href="/net/dial.go.html#1336996">net</a></span><span class="op" id="1337413">,</span>&nbsp;<span class="ident" id="1337415"><a href="/net/dial.go.html#1337368">la</a></span><span class="op" id="1337417">,</span>&nbsp;<span class="ident" id="1337419"><a href="/net/dial.go.html#1337249">ra</a></span><span class="op" id="1337421">,</span>&nbsp;<span class="ident" id="1337423"><a href="/net/dial.go.html#1337027">deadline</a></span><span class="op" id="1337431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337434">case</span>&nbsp;<span class="op" id="1337439">*</span><span class="ident" id="1337440"><a href="/net/iprawsock.go.html#1432036">IPAddr</a></span><span class="op" id="1337446">:</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1337450">la</span><span class="op" id="1337452">,</span>&nbsp;<span class="ident" id="1337454">_</span>&nbsp;<span class="op" id="1337456">:=</span>&nbsp;<span class="ident" id="1337459"><a href="/net/dial.go.html#1337014">la</a></span><span class="op" id="1337461">.</span><span class="op" id="1337462">(</span><span class="op" id="1337463">*</span><span class="ident" id="1337464"><a href="/net/iprawsock.go.html#1432036">IPAddr</a></span><span class="op" id="1337470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1337474"><a href="/net/dial.go.html#1337048">c</a></span><span class="op" id="1337475">,</span>&nbsp;<span class="ident" id="1337477"><a href="/net/dial.go.html#1337056">err</a></span>&nbsp;<span class="op" id="1337481">=</span>&nbsp;<span class="ident" id="1337483"><a href="/net/iprawsock_posix.go.html#1438699">dialIP</a></span><span class="op" id="1337489">(</span><span class="ident" id="1337490"><a href="/net/dial.go.html#1336996">net</a></span><span class="op" id="1337493">,</span>&nbsp;<span class="ident" id="1337495"><a href="/net/dial.go.html#1337450">la</a></span><span class="op" id="1337497">,</span>&nbsp;<span class="ident" id="1337499"><a href="/net/dial.go.html#1337249">ra</a></span><span class="op" id="1337501">,</span>&nbsp;<span class="ident" id="1337503"><a href="/net/dial.go.html#1337027">deadline</a></span><span class="op" id="1337511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337514">case</span>&nbsp;<span class="op" id="1337519">*</span><span class="ident" id="1337520"><a href="/net/unixsock.go.html#1526419">UnixAddr</a></span><span class="op" id="1337528">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1337532">la</span><span class="op" id="1337534">,</span>&nbsp;<span class="ident" id="1337536">_</span>&nbsp;<span class="op" id="1337538">:=</span>&nbsp;<span class="ident" id="1337541"><a href="/net/dial.go.html#1337014">la</a></span><span class="op" id="1337543">.</span><span class="op" id="1337544">(</span><span class="op" id="1337545">*</span><span class="ident" id="1337546"><a href="/net/unixsock.go.html#1526419">UnixAddr</a></span><span class="op" id="1337554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1337558"><a href="/net/dial.go.html#1337048">c</a></span><span class="op" id="1337559">,</span>&nbsp;<span class="ident" id="1337561"><a href="/net/dial.go.html#1337056">err</a></span>&nbsp;<span class="op" id="1337565">=</span>&nbsp;<span class="ident" id="1337567"><a href="/net/unixsock_posix.go.html#1533705">dialUnix</a></span><span class="op" id="1337575">(</span><span class="ident" id="1337576"><a href="/net/dial.go.html#1336996">net</a></span><span class="op" id="1337579">,</span>&nbsp;<span class="ident" id="1337581"><a href="/net/dial.go.html#1337532">la</a></span><span class="op" id="1337583">,</span>&nbsp;<span class="ident" id="1337585"><a href="/net/dial.go.html#1337249">ra</a></span><span class="op" id="1337587">,</span>&nbsp;<span class="ident" id="1337589"><a href="/net/dial.go.html#1337027">deadline</a></span><span class="op" id="1337597">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337600">default</span><span class="op" id="1337607">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337611">return</span>&nbsp;<span class="ident" id="1337618">nil</span><span class="op" id="1337621">,</span>&nbsp;<span class="op" id="1337623">&amp;</span><span class="ident" id="1337624"><a href="/net/net.go.html#1472480">OpError</a></span><span class="op" id="1337631">{</span><span class="ident" id="1337632">Op</span><span class="op" id="1337634">:</span>&nbsp;<span class="string" id="1337636">&#34;dial&#34;</span><span class="op" id="1337642">,</span>&nbsp;<span class="ident" id="1337644">Net</span><span class="op" id="1337647">:</span>&nbsp;<span class="ident" id="1337649"><a href="/net/dial.go.html#1336996">net</a></span><span class="op" id="1337652">,</span>&nbsp;<span class="ident" id="1337654">Addr</span><span class="op" id="1337658">:</span>&nbsp;<span class="ident" id="1337660"><a href="/net/dial.go.html#1337249">ra</a></span><span class="op" id="1337662">,</span>&nbsp;<span class="ident" id="1337664">Err</span><span class="op" id="1337667">:</span>&nbsp;<span class="op" id="1337669">&amp;</span><span class="ident" id="1337670"><a href="/net/net.go.html#1473565">AddrError</a></span><span class="op" id="1337679">{</span><span class="ident" id="1337680">Err</span><span class="op" id="1337683">:</span>&nbsp;<span class="string" id="1337685">&#34;unexpected&nbsp;address&nbsp;type&#34;</span><span class="op" id="1337710">,</span>&nbsp;<span class="ident" id="1337712">Addr</span><span class="op" id="1337716">:</span>&nbsp;<span class="ident" id="1337718"><a href="/net/dial.go.html#1337001">addr</a></span><span class="op" id="1337722">}</span><span class="op" id="1337723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1337726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337729">if</span>&nbsp;<span class="ident" id="1337732"><a href="/net/dial.go.html#1337056">err</a></span>&nbsp;<span class="op" id="1337736">!=</span>&nbsp;<span class="ident" id="1337739">nil</span>&nbsp;<span class="op" id="1337743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337747">return</span>&nbsp;<span class="ident" id="1337754">nil</span><span class="op" id="1337757">,</span>&nbsp;<span class="ident" id="1337759"><a href="/net/dial.go.html#1337056">err</a></span>&nbsp;<span class="comment" id="1337763">//&nbsp;c&nbsp;is&nbsp;non-nil&nbsp;interface&nbsp;containing&nbsp;nil&nbsp;pointer</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1337813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337816">return</span>&nbsp;<span class="ident" id="1337823"><a href="/net/dial.go.html#1337048">c</a></span><span class="op" id="1337824">,</span>&nbsp;<span class="ident" id="1337826">nil</span><br>
<span class="lineno"></span><span class="op" id="1337830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1337833">//&nbsp;Listen&nbsp;announces&nbsp;on&nbsp;the&nbsp;local&nbsp;network&nbsp;address&nbsp;laddr.</span><br>
<span class="lineno">255</span><span class="comment" id="1337889">//&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;a&nbsp;stream-oriented&nbsp;network:&nbsp;&#34;tcp&#34;,&nbsp;&#34;tcp4&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="1337958">//&nbsp;&#34;tcp6&#34;,&nbsp;&#34;unix&#34;&nbsp;or&nbsp;&#34;unixpacket&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="1337993">//&nbsp;See&nbsp;Dial&nbsp;for&nbsp;the&nbsp;syntax&nbsp;of&nbsp;laddr.</span><br>
<span class="lineno"></span><span class="keyword" id="1338030">func</span>&nbsp;<span class="ident" id="1338035">Listen</span><span class="op" id="1338041">(</span><span class="ident" id="1338042">net</span><span class="op" id="1338045">,</span>&nbsp;<span class="ident" id="1338047">laddr</span>&nbsp;<span class="builtintype" id="1338053">string</span><span class="op" id="1338059">)</span>&nbsp;<span class="op" id="1338061">(</span><span class="ident" id="1338062"><a href="/net/net.go.html#1471621">Listener</a></span><span class="op" id="1338070">,</span>&nbsp;<span class="builtintype" id="1338072">error</span><span class="op" id="1338077">)</span>&nbsp;<span class="op" id="1338079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1338082">la</span><span class="op" id="1338084">,</span>&nbsp;<span class="ident" id="1338086">err</span>&nbsp;<span class="op" id="1338090">:=</span>&nbsp;<span class="ident" id="1338093"><a href="/net/dial.go.html#1333012">resolveAddr</a></span><span class="op" id="1338104">(</span><span class="string" id="1338105">&#34;listen&#34;</span><span class="op" id="1338113">,</span>&nbsp;<span class="ident" id="1338115"><a href="/net/dial.go.html#1338042">net</a></span><span class="op" id="1338118">,</span>&nbsp;<span class="ident" id="1338120"><a href="/net/dial.go.html#1338047">laddr</a></span><span class="op" id="1338125">,</span>&nbsp;<span class="ident" id="1338127"><a href="/net/net.go.html#1473194">noDeadline</a></span><span class="op" id="1338137">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1338140">if</span>&nbsp;<span class="ident" id="1338143"><a href="/net/dial.go.html#1338086">err</a></span>&nbsp;<span class="op" id="1338147">!=</span>&nbsp;<span class="ident" id="1338150">nil</span>&nbsp;<span class="op" id="1338154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1338158">return</span>&nbsp;<span class="ident" id="1338165">nil</span><span class="op" id="1338168">,</span>&nbsp;<span class="op" id="1338170">&amp;</span><span class="ident" id="1338171"><a href="/net/net.go.html#1472480">OpError</a></span><span class="op" id="1338178">{</span><span class="ident" id="1338179">Op</span><span class="op" id="1338181">:</span>&nbsp;<span class="string" id="1338183">&#34;listen&#34;</span><span class="op" id="1338191">,</span>&nbsp;<span class="ident" id="1338193">Net</span><span class="op" id="1338196">:</span>&nbsp;<span class="ident" id="1338198"><a href="/net/dial.go.html#1338042">net</a></span><span class="op" id="1338201">,</span>&nbsp;<span class="ident" id="1338203">Addr</span><span class="op" id="1338207">:</span>&nbsp;<span class="ident" id="1338209">nil</span><span class="op" id="1338212">,</span>&nbsp;<span class="ident" id="1338214">Err</span><span class="op" id="1338217">:</span>&nbsp;<span class="ident" id="1338219"><a href="/net/dial.go.html#1338086">err</a></span><span class="op" id="1338222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1338225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1338228">var</span>&nbsp;<span class="ident" id="1338232">l</span>&nbsp;<span class="ident" id="1338234"><a href="/net/net.go.html#1471621">Listener</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1338244">switch</span>&nbsp;<span class="ident" id="1338251">la</span>&nbsp;<span class="op" id="1338254">:=</span>&nbsp;<span class="ident" id="1338257"><a href="/net/dial.go.html#1338082">la</a></span><span class="op" id="1338259">.</span><span class="ident" id="1338260">toAddr</span><span class="op" id="1338266">(</span><span class="op" id="1338267">)</span><span class="op" id="1338268">.</span><span class="op" id="1338269">(</span><span class="keyword" id="1338270">type</span><span class="op" id="1338274">)</span>&nbsp;<span class="op" id="1338276">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1338279">case</span>&nbsp;<span class="op" id="1338284">*</span><span class="ident" id="1338285"><a href="/net/tcpsock.go.html#1504387">TCPAddr</a></span><span class="op" id="1338292">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1338296"><a href="/net/dial.go.html#1338232">l</a></span><span class="op" id="1338297">,</span>&nbsp;<span class="ident" id="1338299"><a href="/net/dial.go.html#1338086">err</a></span>&nbsp;<span class="op" id="1338303">=</span>&nbsp;<span class="ident" id="1338305"><a href="/net/tcpsock_posix.go.html#1514734">ListenTCP</a></span><span class="op" id="1338314">(</span><span class="ident" id="1338315"><a href="/net/dial.go.html#1338042">net</a></span><span class="op" id="1338318">,</span>&nbsp;<span class="ident" id="1338320"><a href="/net/dial.go.html#1338251">la</a></span><span class="op" id="1338322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1338325">case</span>&nbsp;<span class="op" id="1338330">*</span><span class="ident" id="1338331"><a href="/net/unixsock.go.html#1526419">UnixAddr</a></span><span class="op" id="1338339">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1338343"><a href="/net/dial.go.html#1338232">l</a></span><span class="op" id="1338344">,</span>&nbsp;<span class="ident" id="1338346"><a href="/net/dial.go.html#1338086">err</a></span>&nbsp;<span class="op" id="1338350">=</span>&nbsp;<span class="ident" id="1338352"><a href="/net/unixsock_posix.go.html#1534323">ListenUnix</a></span><span class="op" id="1338362">(</span><span class="ident" id="1338363"><a href="/net/dial.go.html#1338042">net</a></span><span class="op" id="1338366">,</span>&nbsp;<span class="ident" id="1338368"><a href="/net/dial.go.html#1338251">la</a></span><span class="op" id="1338370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1338373">default</span><span class="op" id="1338380">:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1338384">return</span>&nbsp;<span class="ident" id="1338391">nil</span><span class="op" id="1338394">,</span>&nbsp;<span class="op" id="1338396">&amp;</span><span class="ident" id="1338397"><a href="/net/net.go.html#1472480">OpError</a></span><span class="op" id="1338404">{</span><span class="ident" id="1338405">Op</span><span class="op" id="1338407">:</span>&nbsp;<span class="string" id="1338409">&#34;listen&#34;</span><span class="op" id="1338417">,</span>&nbsp;<span class="ident" id="1338419">Net</span><span class="op" id="1338422">:</span>&nbsp;<span class="ident" id="1338424"><a href="/net/dial.go.html#1338042">net</a></span><span class="op" id="1338427">,</span>&nbsp;<span class="ident" id="1338429">Addr</span><span class="op" id="1338433">:</span>&nbsp;<span class="ident" id="1338435"><a href="/net/dial.go.html#1338251">la</a></span><span class="op" id="1338437">,</span>&nbsp;<span class="ident" id="1338439">Err</span><span class="op" id="1338442">:</span>&nbsp;<span class="op" id="1338444">&amp;</span><span class="ident" id="1338445"><a href="/net/net.go.html#1473565">AddrError</a></span><span class="op" id="1338454">{</span><span class="ident" id="1338455">Err</span><span class="op" id="1338458">:</span>&nbsp;<span class="string" id="1338460">&#34;unexpected&nbsp;address&nbsp;type&#34;</span><span class="op" id="1338485">,</span>&nbsp;<span class="ident" id="1338487">Addr</span><span class="op" id="1338491">:</span>&nbsp;<span class="ident" id="1338493"><a href="/net/dial.go.html#1338047">laddr</a></span><span class="op" id="1338498">}</span><span class="op" id="1338499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1338502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1338505">if</span>&nbsp;<span class="ident" id="1338508"><a href="/net/dial.go.html#1338086">err</a></span>&nbsp;<span class="op" id="1338512">!=</span>&nbsp;<span class="ident" id="1338515">nil</span>&nbsp;<span class="op" id="1338519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1338523">return</span>&nbsp;<span class="ident" id="1338530">nil</span><span class="op" id="1338533">,</span>&nbsp;<span class="ident" id="1338535"><a href="/net/dial.go.html#1338086">err</a></span>&nbsp;<span class="comment" id="1338539">//&nbsp;l&nbsp;is&nbsp;non-nil&nbsp;interface&nbsp;containing&nbsp;nil&nbsp;pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1338589">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1338592">return</span>&nbsp;<span class="ident" id="1338599"><a href="/net/dial.go.html#1338232">l</a></span><span class="op" id="1338600">,</span>&nbsp;<span class="ident" id="1338602">nil</span><br>
<span class="lineno"></span><span class="op" id="1338606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1338609">//&nbsp;ListenPacket&nbsp;announces&nbsp;on&nbsp;the&nbsp;local&nbsp;network&nbsp;address&nbsp;laddr.</span><br>
<span class="lineno"></span><span class="comment" id="1338671">//&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;a&nbsp;packet-oriented&nbsp;network:&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;,</span><br>
<span class="lineno">280</span><span class="comment" id="1338740">//&nbsp;&#34;udp6&#34;,&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;,&nbsp;&#34;ip6&#34;&nbsp;or&nbsp;&#34;unixgram&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="1338785">//&nbsp;See&nbsp;Dial&nbsp;for&nbsp;the&nbsp;syntax&nbsp;of&nbsp;laddr.</span><br>
<span class="lineno"></span><span class="keyword" id="1338822">func</span>&nbsp;<span class="ident" id="1338827">ListenPacket</span><span class="op" id="1338839">(</span><span class="ident" id="1338840">net</span><span class="op" id="1338843">,</span>&nbsp;<span class="ident" id="1338845">laddr</span>&nbsp;<span class="builtintype" id="1338851">string</span><span class="op" id="1338857">)</span>&nbsp;<span class="op" id="1338859">(</span><span class="ident" id="1338860"><a href="/net/net.go.html#1469751">PacketConn</a></span><span class="op" id="1338870">,</span>&nbsp;<span class="builtintype" id="1338872">error</span><span class="op" id="1338877">)</span>&nbsp;<span class="op" id="1338879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1338882">la</span><span class="op" id="1338884">,</span>&nbsp;<span class="ident" id="1338886">err</span>&nbsp;<span class="op" id="1338890">:=</span>&nbsp;<span class="ident" id="1338893"><a href="/net/dial.go.html#1333012">resolveAddr</a></span><span class="op" id="1338904">(</span><span class="string" id="1338905">&#34;listen&#34;</span><span class="op" id="1338913">,</span>&nbsp;<span class="ident" id="1338915"><a href="/net/dial.go.html#1338840">net</a></span><span class="op" id="1338918">,</span>&nbsp;<span class="ident" id="1338920"><a href="/net/dial.go.html#1338845">laddr</a></span><span class="op" id="1338925">,</span>&nbsp;<span class="ident" id="1338927"><a href="/net/net.go.html#1473194">noDeadline</a></span><span class="op" id="1338937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1338940">if</span>&nbsp;<span class="ident" id="1338943"><a href="/net/dial.go.html#1338886">err</a></span>&nbsp;<span class="op" id="1338947">!=</span>&nbsp;<span class="ident" id="1338950">nil</span>&nbsp;<span class="op" id="1338954">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1338958">return</span>&nbsp;<span class="ident" id="1338965">nil</span><span class="op" id="1338968">,</span>&nbsp;<span class="op" id="1338970">&amp;</span><span class="ident" id="1338971"><a href="/net/net.go.html#1472480">OpError</a></span><span class="op" id="1338978">{</span><span class="ident" id="1338979">Op</span><span class="op" id="1338981">:</span>&nbsp;<span class="string" id="1338983">&#34;listen&#34;</span><span class="op" id="1338991">,</span>&nbsp;<span class="ident" id="1338993">Net</span><span class="op" id="1338996">:</span>&nbsp;<span class="ident" id="1338998"><a href="/net/dial.go.html#1338840">net</a></span><span class="op" id="1339001">,</span>&nbsp;<span class="ident" id="1339003">Addr</span><span class="op" id="1339007">:</span>&nbsp;<span class="ident" id="1339009">nil</span><span class="op" id="1339012">,</span>&nbsp;<span class="ident" id="1339014">Err</span><span class="op" id="1339017">:</span>&nbsp;<span class="ident" id="1339019"><a href="/net/dial.go.html#1338886">err</a></span><span class="op" id="1339022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1339025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1339028">var</span>&nbsp;<span class="ident" id="1339032">l</span>&nbsp;<span class="ident" id="1339034"><a href="/net/net.go.html#1469751">PacketConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1339046">switch</span>&nbsp;<span class="ident" id="1339053">la</span>&nbsp;<span class="op" id="1339056">:=</span>&nbsp;<span class="ident" id="1339059"><a href="/net/dial.go.html#1338882">la</a></span><span class="op" id="1339061">.</span><span class="ident" id="1339062">toAddr</span><span class="op" id="1339068">(</span><span class="op" id="1339069">)</span><span class="op" id="1339070">.</span><span class="op" id="1339071">(</span><span class="keyword" id="1339072">type</span><span class="op" id="1339076">)</span>&nbsp;<span class="op" id="1339078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1339081">case</span>&nbsp;<span class="op" id="1339086">*</span><span class="ident" id="1339087"><a href="/net/udpsock.go.html#1516760">UDPAddr</a></span><span class="op" id="1339094">:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1339098"><a href="/net/dial.go.html#1339032">l</a></span><span class="op" id="1339099">,</span>&nbsp;<span class="ident" id="1339101"><a href="/net/dial.go.html#1338886">err</a></span>&nbsp;<span class="op" id="1339105">=</span>&nbsp;<span class="ident" id="1339107"><a href="/net/udpsock_posix.go.html#1523853">ListenUDP</a></span><span class="op" id="1339116">(</span><span class="ident" id="1339117"><a href="/net/dial.go.html#1338840">net</a></span><span class="op" id="1339120">,</span>&nbsp;<span class="ident" id="1339122"><a href="/net/dial.go.html#1339053">la</a></span><span class="op" id="1339124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1339127">case</span>&nbsp;<span class="op" id="1339132">*</span><span class="ident" id="1339133"><a href="/net/iprawsock.go.html#1432036">IPAddr</a></span><span class="op" id="1339139">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1339143"><a href="/net/dial.go.html#1339032">l</a></span><span class="op" id="1339144">,</span>&nbsp;<span class="ident" id="1339146"><a href="/net/dial.go.html#1338886">err</a></span>&nbsp;<span class="op" id="1339150">=</span>&nbsp;<span class="ident" id="1339152"><a href="/net/iprawsock_posix.go.html#1439614">ListenIP</a></span><span class="op" id="1339160">(</span><span class="ident" id="1339161"><a href="/net/dial.go.html#1338840">net</a></span><span class="op" id="1339164">,</span>&nbsp;<span class="ident" id="1339166"><a href="/net/dial.go.html#1339053">la</a></span><span class="op" id="1339168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1339171">case</span>&nbsp;<span class="op" id="1339176">*</span><span class="ident" id="1339177"><a href="/net/unixsock.go.html#1526419">UnixAddr</a></span><span class="op" id="1339185">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1339189"><a href="/net/dial.go.html#1339032">l</a></span><span class="op" id="1339190">,</span>&nbsp;<span class="ident" id="1339192"><a href="/net/dial.go.html#1338886">err</a></span>&nbsp;<span class="op" id="1339196">=</span>&nbsp;<span class="ident" id="1339198"><a href="/net/unixsock_posix.go.html#1537208">ListenUnixgram</a></span><span class="op" id="1339212">(</span><span class="ident" id="1339213"><a href="/net/dial.go.html#1338840">net</a></span><span class="op" id="1339216">,</span>&nbsp;<span class="ident" id="1339218"><a href="/net/dial.go.html#1339053">la</a></span><span class="op" id="1339220">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1339223">default</span><span class="op" id="1339230">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1339234">return</span>&nbsp;<span class="ident" id="1339241">nil</span><span class="op" id="1339244">,</span>&nbsp;<span class="op" id="1339246">&amp;</span><span class="ident" id="1339247"><a href="/net/net.go.html#1472480">OpError</a></span><span class="op" id="1339254">{</span><span class="ident" id="1339255">Op</span><span class="op" id="1339257">:</span>&nbsp;<span class="string" id="1339259">&#34;listen&#34;</span><span class="op" id="1339267">,</span>&nbsp;<span class="ident" id="1339269">Net</span><span class="op" id="1339272">:</span>&nbsp;<span class="ident" id="1339274"><a href="/net/dial.go.html#1338840">net</a></span><span class="op" id="1339277">,</span>&nbsp;<span class="ident" id="1339279">Addr</span><span class="op" id="1339283">:</span>&nbsp;<span class="ident" id="1339285"><a href="/net/dial.go.html#1339053">la</a></span><span class="op" id="1339287">,</span>&nbsp;<span class="ident" id="1339289">Err</span><span class="op" id="1339292">:</span>&nbsp;<span class="op" id="1339294">&amp;</span><span class="ident" id="1339295"><a href="/net/net.go.html#1473565">AddrError</a></span><span class="op" id="1339304">{</span><span class="ident" id="1339305">Err</span><span class="op" id="1339308">:</span>&nbsp;<span class="string" id="1339310">&#34;unexpected&nbsp;address&nbsp;type&#34;</span><span class="op" id="1339335">,</span>&nbsp;<span class="ident" id="1339337">Addr</span><span class="op" id="1339341">:</span>&nbsp;<span class="ident" id="1339343"><a href="/net/dial.go.html#1338845">laddr</a></span><span class="op" id="1339348">}</span><span class="op" id="1339349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1339352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1339355">if</span>&nbsp;<span class="ident" id="1339358"><a href="/net/dial.go.html#1338886">err</a></span>&nbsp;<span class="op" id="1339362">!=</span>&nbsp;<span class="ident" id="1339365">nil</span>&nbsp;<span class="op" id="1339369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1339373">return</span>&nbsp;<span class="ident" id="1339380">nil</span><span class="op" id="1339383">,</span>&nbsp;<span class="ident" id="1339385"><a href="/net/dial.go.html#1338886">err</a></span>&nbsp;<span class="comment" id="1339389">//&nbsp;l&nbsp;is&nbsp;non-nil&nbsp;interface&nbsp;containing&nbsp;nil&nbsp;pointer</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1339439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1339442">return</span>&nbsp;<span class="ident" id="1339449"><a href="/net/dial.go.html#1339032">l</a></span><span class="op" id="1339450">,</span>&nbsp;<span class="ident" id="1339452">nil</span><br>
<span class="lineno"></span><span class="op" id="1339456">}</span>
</div>
</body>
</html>
