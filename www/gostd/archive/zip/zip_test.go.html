<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7705263">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7705318">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7705372">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7705423">//&nbsp;Tests&nbsp;that&nbsp;involve&nbsp;both&nbsp;reading&nbsp;and&nbsp;writing.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7705472">package</span>&nbsp;<span class="ident" id="7705480">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7705485">import</span>&nbsp;<span class="op" id="7705492">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7705495">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7705504">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7705511">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7705519">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7705525">&#34;io/ioutil&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7705538">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7705546">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7705557">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7705568">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7705575">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="7705578">func</span>&nbsp;<span class="ident" id="7705583">TestOver65kFiles</span><span class="op" id="7705599">(</span><span class="ident" id="7705600">t</span>&nbsp;<span class="op" id="7705602">*</span><span class="ident" id="7705603">testing</span><span class="op" id="7705610">.</span><span class="ident" id="7705611">T</span><span class="op" id="7705612">)</span>&nbsp;<span class="op" id="7705614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7705617">buf</span>&nbsp;<span class="op" id="7705621">:=</span>&nbsp;<span class="builtinfunc" id="7705624">new</span><span class="op" id="7705627">(</span><span class="ident" id="7705628">bytes</span><span class="op" id="7705633">.</span><span class="ident" id="7705634">Buffer</span><span class="op" id="7705640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7705643">w</span>&nbsp;<span class="op" id="7705645">:=</span>&nbsp;<span class="ident" id="7705648">NewWriter</span><span class="op" id="7705657">(</span><span class="ident" id="7705658">buf</span><span class="op" id="7705661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7705664">const</span>&nbsp;<span class="ident" id="7705670">nFiles</span>&nbsp;<span class="op" id="7705677">=</span>&nbsp;<span class="op" id="7705679">(</span><span class="num" id="7705680">1</span>&nbsp;<span class="op" id="7705682">&lt;&lt;</span>&nbsp;<span class="num" id="7705685">16</span><span class="op" id="7705687">)</span>&nbsp;<span class="op" id="7705689">+</span>&nbsp;<span class="num" id="7705691">42</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7705695">for</span>&nbsp;<span class="ident" id="7705699">i</span>&nbsp;<span class="op" id="7705701">:=</span>&nbsp;<span class="num" id="7705704">0</span><span class="op" id="7705705">;</span>&nbsp;<span class="ident" id="7705707">i</span>&nbsp;<span class="op" id="7705709">&lt;</span>&nbsp;<span class="ident" id="7705711">nFiles</span><span class="op" id="7705717">;</span>&nbsp;<span class="ident" id="7705719">i</span><span class="op" id="7705720">++</span>&nbsp;<span class="op" id="7705723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7705727">_</span><span class="op" id="7705728">,</span>&nbsp;<span class="ident" id="7705730">err</span>&nbsp;<span class="op" id="7705734">:=</span>&nbsp;<span class="ident" id="7705737">w</span><span class="op" id="7705738">.</span><span class="ident" id="7705739">CreateHeader</span><span class="op" id="7705751">(</span><span class="op" id="7705752">&amp;</span><span class="ident" id="7705753">FileHeader</span><span class="op" id="7705763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7705768">Name</span><span class="op" id="7705772">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7705776">fmt</span><span class="op" id="7705779">.</span><span class="ident" id="7705780">Sprintf</span><span class="op" id="7705787">(</span><span class="string" id="7705788">&#34;%d.dat&#34;</span><span class="op" id="7705796">,</span>&nbsp;<span class="ident" id="7705798">i</span><span class="op" id="7705799">)</span><span class="op" id="7705800">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7705805">Method</span><span class="op" id="7705811">:</span>&nbsp;<span class="ident" id="7705813">Store</span><span class="op" id="7705818">,</span>&nbsp;<span class="comment" id="7705820">//&nbsp;avoid&nbsp;Issue&nbsp;6136&nbsp;and&nbsp;Issue&nbsp;6138</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7705857">}</span><span class="op" id="7705858">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7705862">if</span>&nbsp;<span class="ident" id="7705865">err</span>&nbsp;<span class="op" id="7705869">!=</span>&nbsp;<span class="ident" id="7705872">nil</span>&nbsp;<span class="op" id="7705876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7705881">t</span><span class="op" id="7705882">.</span><span class="ident" id="7705883">Fatalf</span><span class="op" id="7705889">(</span><span class="string" id="7705890">&#34;creating&nbsp;file&nbsp;%d:&nbsp;%v&#34;</span><span class="op" id="7705912">,</span>&nbsp;<span class="ident" id="7705914">i</span><span class="op" id="7705915">,</span>&nbsp;<span class="ident" id="7705917">err</span><span class="op" id="7705920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7705924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7705927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7705930">if</span>&nbsp;<span class="ident" id="7705933">err</span>&nbsp;<span class="op" id="7705937">:=</span>&nbsp;<span class="ident" id="7705940">w</span><span class="op" id="7705941">.</span><span class="ident" id="7705942">Close</span><span class="op" id="7705947">(</span><span class="op" id="7705948">)</span><span class="op" id="7705949">;</span>&nbsp;<span class="ident" id="7705951">err</span>&nbsp;<span class="op" id="7705955">!=</span>&nbsp;<span class="ident" id="7705958">nil</span>&nbsp;<span class="op" id="7705962">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7705966">t</span><span class="op" id="7705967">.</span><span class="ident" id="7705968">Fatalf</span><span class="op" id="7705974">(</span><span class="string" id="7705975">&#34;Writer.Close:&nbsp;%v&#34;</span><span class="op" id="7705993">,</span>&nbsp;<span class="ident" id="7705995">err</span><span class="op" id="7705998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7706001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7706004">s</span>&nbsp;<span class="op" id="7706006">:=</span>&nbsp;<span class="ident" id="7706009">buf</span><span class="op" id="7706012">.</span><span class="ident" id="7706013">String</span><span class="op" id="7706019">(</span><span class="op" id="7706020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7706023">zr</span><span class="op" id="7706025">,</span>&nbsp;<span class="ident" id="7706027">err</span>&nbsp;<span class="op" id="7706031">:=</span>&nbsp;<span class="ident" id="7706034">NewReader</span><span class="op" id="7706043">(</span><span class="ident" id="7706044">strings</span><span class="op" id="7706051">.</span><span class="ident" id="7706052">NewReader</span><span class="op" id="7706061">(</span><span class="ident" id="7706062">s</span><span class="op" id="7706063">)</span><span class="op" id="7706064">,</span>&nbsp;<span class="ident" id="7706066">int64</span><span class="op" id="7706071">(</span><span class="builtinfunc" id="7706072">len</span><span class="op" id="7706075">(</span><span class="ident" id="7706076">s</span><span class="op" id="7706077">)</span><span class="op" id="7706078">)</span><span class="op" id="7706079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7706082">if</span>&nbsp;<span class="ident" id="7706085">err</span>&nbsp;<span class="op" id="7706089">!=</span>&nbsp;<span class="ident" id="7706092">nil</span>&nbsp;<span class="op" id="7706096">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7706100">t</span><span class="op" id="7706101">.</span><span class="ident" id="7706102">Fatalf</span><span class="op" id="7706108">(</span><span class="string" id="7706109">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="7706124">,</span>&nbsp;<span class="ident" id="7706126">err</span><span class="op" id="7706129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7706132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7706135">if</span>&nbsp;<span class="ident" id="7706138">got</span>&nbsp;<span class="op" id="7706142">:=</span>&nbsp;<span class="builtinfunc" id="7706145">len</span><span class="op" id="7706148">(</span><span class="ident" id="7706149">zr</span><span class="op" id="7706151">.</span><span class="ident" id="7706152">File</span><span class="op" id="7706156">)</span><span class="op" id="7706157">;</span>&nbsp;<span class="ident" id="7706159">got</span>&nbsp;<span class="op" id="7706163">!=</span>&nbsp;<span class="ident" id="7706166">nFiles</span>&nbsp;<span class="op" id="7706173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7706177">t</span><span class="op" id="7706178">.</span><span class="ident" id="7706179">Fatalf</span><span class="op" id="7706185">(</span><span class="string" id="7706186">&#34;File&nbsp;contains&nbsp;%d&nbsp;files,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7706219">,</span>&nbsp;<span class="ident" id="7706221">got</span><span class="op" id="7706224">,</span>&nbsp;<span class="ident" id="7706226">nFiles</span><span class="op" id="7706232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7706235">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7706238">for</span>&nbsp;<span class="ident" id="7706242">i</span>&nbsp;<span class="op" id="7706244">:=</span>&nbsp;<span class="num" id="7706247">0</span><span class="op" id="7706248">;</span>&nbsp;<span class="ident" id="7706250">i</span>&nbsp;<span class="op" id="7706252">&lt;</span>&nbsp;<span class="ident" id="7706254">nFiles</span><span class="op" id="7706260">;</span>&nbsp;<span class="ident" id="7706262">i</span><span class="op" id="7706263">++</span>&nbsp;<span class="op" id="7706266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7706270">want</span>&nbsp;<span class="op" id="7706275">:=</span>&nbsp;<span class="ident" id="7706278">fmt</span><span class="op" id="7706281">.</span><span class="ident" id="7706282">Sprintf</span><span class="op" id="7706289">(</span><span class="string" id="7706290">&#34;%d.dat&#34;</span><span class="op" id="7706298">,</span>&nbsp;<span class="ident" id="7706300">i</span><span class="op" id="7706301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7706305">if</span>&nbsp;<span class="ident" id="7706308">zr</span><span class="op" id="7706310">.</span><span class="ident" id="7706311">File</span><span class="op" id="7706315">[</span><span class="ident" id="7706316">i</span><span class="op" id="7706317">]</span><span class="op" id="7706318">.</span><span class="ident" id="7706319">Name</span>&nbsp;<span class="op" id="7706324">!=</span>&nbsp;<span class="ident" id="7706327">want</span>&nbsp;<span class="op" id="7706332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7706337">t</span><span class="op" id="7706338">.</span><span class="ident" id="7706339">Fatalf</span><span class="op" id="7706345">(</span><span class="string" id="7706346">&#34;File(%d)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7706370">,</span>&nbsp;<span class="ident" id="7706372">i</span><span class="op" id="7706373">,</span>&nbsp;<span class="ident" id="7706375">zr</span><span class="op" id="7706377">.</span><span class="ident" id="7706378">File</span><span class="op" id="7706382">[</span><span class="ident" id="7706383">i</span><span class="op" id="7706384">]</span><span class="op" id="7706385">.</span><span class="ident" id="7706386">Name</span><span class="op" id="7706390">,</span>&nbsp;<span class="ident" id="7706392">want</span><span class="op" id="7706396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7706400">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7706403">}</span><br>
<span class="lineno"></span><span class="op" id="7706405">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7706408">func</span>&nbsp;<span class="ident" id="7706413">TestModTime</span><span class="op" id="7706424">(</span><span class="ident" id="7706425">t</span>&nbsp;<span class="op" id="7706427">*</span><span class="ident" id="7706428">testing</span><span class="op" id="7706435">.</span><span class="ident" id="7706436">T</span><span class="op" id="7706437">)</span>&nbsp;<span class="op" id="7706439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7706442">var</span>&nbsp;<span class="ident" id="7706446">testTime</span>&nbsp;<span class="op" id="7706455">=</span>&nbsp;<span class="ident" id="7706457">time</span><span class="op" id="7706461">.</span><span class="ident" id="7706462">Date</span><span class="op" id="7706466">(</span><span class="num" id="7706467">2009</span><span class="op" id="7706471">,</span>&nbsp;<span class="ident" id="7706473">time</span><span class="op" id="7706477">.</span><span class="ident" id="7706478">November</span><span class="op" id="7706486">,</span>&nbsp;<span class="num" id="7706488">10</span><span class="op" id="7706490">,</span>&nbsp;<span class="num" id="7706492">23</span><span class="op" id="7706494">,</span>&nbsp;<span class="num" id="7706496">45</span><span class="op" id="7706498">,</span>&nbsp;<span class="num" id="7706500">58</span><span class="op" id="7706502">,</span>&nbsp;<span class="num" id="7706504">0</span><span class="op" id="7706505">,</span>&nbsp;<span class="ident" id="7706507">time</span><span class="op" id="7706511">.</span><span class="ident" id="7706512">UTC</span><span class="op" id="7706515">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7706518">fh</span>&nbsp;<span class="op" id="7706521">:=</span>&nbsp;<span class="builtinfunc" id="7706524">new</span><span class="op" id="7706527">(</span><span class="ident" id="7706528">FileHeader</span><span class="op" id="7706538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7706541">fh</span><span class="op" id="7706543">.</span><span class="ident" id="7706544">SetModTime</span><span class="op" id="7706554">(</span><span class="ident" id="7706555">testTime</span><span class="op" id="7706563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7706566">outTime</span>&nbsp;<span class="op" id="7706574">:=</span>&nbsp;<span class="ident" id="7706577">fh</span><span class="op" id="7706579">.</span><span class="ident" id="7706580">ModTime</span><span class="op" id="7706587">(</span><span class="op" id="7706588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7706591">if</span>&nbsp;<span class="op" id="7706594">!</span><span class="ident" id="7706595">outTime</span><span class="op" id="7706602">.</span><span class="ident" id="7706603">Equal</span><span class="op" id="7706608">(</span><span class="ident" id="7706609">testTime</span><span class="op" id="7706617">)</span>&nbsp;<span class="op" id="7706619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7706623">t</span><span class="op" id="7706624">.</span><span class="ident" id="7706625">Errorf</span><span class="op" id="7706631">(</span><span class="string" id="7706632">&#34;times&nbsp;don&#39;t&nbsp;match:&nbsp;got&nbsp;%s,&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7706668">,</span>&nbsp;<span class="ident" id="7706670">outTime</span><span class="op" id="7706677">,</span>&nbsp;<span class="ident" id="7706679">testTime</span><span class="op" id="7706687">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7706690">}</span><br>
<span class="lineno"></span><span class="op" id="7706692">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7706695">func</span>&nbsp;<span class="ident" id="7706700">testHeaderRoundTrip</span><span class="op" id="7706719">(</span><span class="ident" id="7706720">fh</span>&nbsp;<span class="op" id="7706723">*</span><span class="ident" id="7706724">FileHeader</span><span class="op" id="7706734">,</span>&nbsp;<span class="ident" id="7706736">wantUncompressedSize</span>&nbsp;<span class="builtintype" id="7706757">uint32</span><span class="op" id="7706763">,</span>&nbsp;<span class="ident" id="7706765">wantUncompressedSize64</span>&nbsp;<span class="ident" id="7706788">uint64</span><span class="op" id="7706794">,</span>&nbsp;<span class="ident" id="7706796">t</span>&nbsp;<span class="op" id="7706798">*</span><span class="ident" id="7706799">testing</span><span class="op" id="7706806">.</span><span class="ident" id="7706807">T</span><span class="op" id="7706808">)</span>&nbsp;<span class="op" id="7706810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7706813">fi</span>&nbsp;<span class="op" id="7706816">:=</span>&nbsp;<span class="ident" id="7706819">fh</span><span class="op" id="7706821">.</span><span class="ident" id="7706822">FileInfo</span><span class="op" id="7706830">(</span><span class="op" id="7706831">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7706834">fh2</span><span class="op" id="7706837">,</span>&nbsp;<span class="ident" id="7706839">err</span>&nbsp;<span class="op" id="7706843">:=</span>&nbsp;<span class="ident" id="7706846">FileInfoHeader</span><span class="op" id="7706860">(</span><span class="ident" id="7706861">fi</span><span class="op" id="7706863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7706866">if</span>&nbsp;<span class="ident" id="7706869">err</span>&nbsp;<span class="op" id="7706873">!=</span>&nbsp;<span class="ident" id="7706876">nil</span>&nbsp;<span class="op" id="7706880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7706884">t</span><span class="op" id="7706885">.</span><span class="ident" id="7706886">Fatal</span><span class="op" id="7706891">(</span><span class="ident" id="7706892">err</span><span class="op" id="7706895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7706898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7706901">if</span>&nbsp;<span class="ident" id="7706904">got</span><span class="op" id="7706907">,</span>&nbsp;<span class="ident" id="7706909">want</span>&nbsp;<span class="op" id="7706914">:=</span>&nbsp;<span class="ident" id="7706917">fh2</span><span class="op" id="7706920">.</span><span class="ident" id="7706921">Name</span><span class="op" id="7706925">,</span>&nbsp;<span class="ident" id="7706927">fh</span><span class="op" id="7706929">.</span><span class="ident" id="7706930">Name</span><span class="op" id="7706934">;</span>&nbsp;<span class="ident" id="7706936">got</span>&nbsp;<span class="op" id="7706940">!=</span>&nbsp;<span class="ident" id="7706943">want</span>&nbsp;<span class="op" id="7706948">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7706952">t</span><span class="op" id="7706953">.</span><span class="ident" id="7706954">Errorf</span><span class="op" id="7706960">(</span><span class="string" id="7706961">&#34;Name:&nbsp;got&nbsp;%s,&nbsp;want&nbsp;%s\n&#34;</span><span class="op" id="7706986">,</span>&nbsp;<span class="ident" id="7706988">got</span><span class="op" id="7706991">,</span>&nbsp;<span class="ident" id="7706993">want</span><span class="op" id="7706997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7707000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7707003">if</span>&nbsp;<span class="ident" id="7707006">got</span><span class="op" id="7707009">,</span>&nbsp;<span class="ident" id="7707011">want</span>&nbsp;<span class="op" id="7707016">:=</span>&nbsp;<span class="ident" id="7707019">fh2</span><span class="op" id="7707022">.</span><span class="ident" id="7707023">UncompressedSize</span><span class="op" id="7707039">,</span>&nbsp;<span class="ident" id="7707041">wantUncompressedSize</span><span class="op" id="7707061">;</span>&nbsp;<span class="ident" id="7707063">got</span>&nbsp;<span class="op" id="7707067">!=</span>&nbsp;<span class="ident" id="7707070">want</span>&nbsp;<span class="op" id="7707075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7707079">t</span><span class="op" id="7707080">.</span><span class="ident" id="7707081">Errorf</span><span class="op" id="7707087">(</span><span class="string" id="7707088">&#34;UncompressedSize:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="7707125">,</span>&nbsp;<span class="ident" id="7707127">got</span><span class="op" id="7707130">,</span>&nbsp;<span class="ident" id="7707132">want</span><span class="op" id="7707136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7707139">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7707142">if</span>&nbsp;<span class="ident" id="7707145">got</span><span class="op" id="7707148">,</span>&nbsp;<span class="ident" id="7707150">want</span>&nbsp;<span class="op" id="7707155">:=</span>&nbsp;<span class="ident" id="7707158">fh2</span><span class="op" id="7707161">.</span><span class="ident" id="7707162">UncompressedSize64</span><span class="op" id="7707180">,</span>&nbsp;<span class="ident" id="7707182">wantUncompressedSize64</span><span class="op" id="7707204">;</span>&nbsp;<span class="ident" id="7707206">got</span>&nbsp;<span class="op" id="7707210">!=</span>&nbsp;<span class="ident" id="7707213">want</span>&nbsp;<span class="op" id="7707218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7707222">t</span><span class="op" id="7707223">.</span><span class="ident" id="7707224">Errorf</span><span class="op" id="7707230">(</span><span class="string" id="7707231">&#34;UncompressedSize64:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="7707270">,</span>&nbsp;<span class="ident" id="7707272">got</span><span class="op" id="7707275">,</span>&nbsp;<span class="ident" id="7707277">want</span><span class="op" id="7707281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7707284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7707287">if</span>&nbsp;<span class="ident" id="7707290">got</span><span class="op" id="7707293">,</span>&nbsp;<span class="ident" id="7707295">want</span>&nbsp;<span class="op" id="7707300">:=</span>&nbsp;<span class="ident" id="7707303">fh2</span><span class="op" id="7707306">.</span><span class="ident" id="7707307">ModifiedTime</span><span class="op" id="7707319">,</span>&nbsp;<span class="ident" id="7707321">fh</span><span class="op" id="7707323">.</span><span class="ident" id="7707324">ModifiedTime</span><span class="op" id="7707336">;</span>&nbsp;<span class="ident" id="7707338">got</span>&nbsp;<span class="op" id="7707342">!=</span>&nbsp;<span class="ident" id="7707345">want</span>&nbsp;<span class="op" id="7707350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7707354">t</span><span class="op" id="7707355">.</span><span class="ident" id="7707356">Errorf</span><span class="op" id="7707362">(</span><span class="string" id="7707363">&#34;ModifiedTime:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="7707396">,</span>&nbsp;<span class="ident" id="7707398">got</span><span class="op" id="7707401">,</span>&nbsp;<span class="ident" id="7707403">want</span><span class="op" id="7707407">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7707410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7707413">if</span>&nbsp;<span class="ident" id="7707416">got</span><span class="op" id="7707419">,</span>&nbsp;<span class="ident" id="7707421">want</span>&nbsp;<span class="op" id="7707426">:=</span>&nbsp;<span class="ident" id="7707429">fh2</span><span class="op" id="7707432">.</span><span class="ident" id="7707433">ModifiedDate</span><span class="op" id="7707445">,</span>&nbsp;<span class="ident" id="7707447">fh</span><span class="op" id="7707449">.</span><span class="ident" id="7707450">ModifiedDate</span><span class="op" id="7707462">;</span>&nbsp;<span class="ident" id="7707464">got</span>&nbsp;<span class="op" id="7707468">!=</span>&nbsp;<span class="ident" id="7707471">want</span>&nbsp;<span class="op" id="7707476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7707480">t</span><span class="op" id="7707481">.</span><span class="ident" id="7707482">Errorf</span><span class="op" id="7707488">(</span><span class="string" id="7707489">&#34;ModifiedDate:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="7707522">,</span>&nbsp;<span class="ident" id="7707524">got</span><span class="op" id="7707527">,</span>&nbsp;<span class="ident" id="7707529">want</span><span class="op" id="7707533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7707536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7707540">if</span>&nbsp;<span class="ident" id="7707543">sysfh</span><span class="op" id="7707548">,</span>&nbsp;<span class="ident" id="7707550">ok</span>&nbsp;<span class="op" id="7707553">:=</span>&nbsp;<span class="ident" id="7707556">fi</span><span class="op" id="7707558">.</span><span class="ident" id="7707559">Sys</span><span class="op" id="7707562">(</span><span class="op" id="7707563">)</span><span class="op" id="7707564">.</span><span class="op" id="7707565">(</span><span class="op" id="7707566">*</span><span class="ident" id="7707567">FileHeader</span><span class="op" id="7707577">)</span><span class="op" id="7707578">;</span>&nbsp;<span class="op" id="7707580">!</span><span class="ident" id="7707581">ok</span>&nbsp;<span class="op" id="7707584">&amp;&amp;</span>&nbsp;<span class="ident" id="7707587">sysfh</span>&nbsp;<span class="op" id="7707593">!=</span>&nbsp;<span class="ident" id="7707596">fh</span>&nbsp;<span class="op" id="7707599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7707603">t</span><span class="op" id="7707604">.</span><span class="ident" id="7707605">Errorf</span><span class="op" id="7707611">(</span><span class="string" id="7707612">&#34;Sys&nbsp;didn&#39;t&nbsp;return&nbsp;original&nbsp;*FileHeader&#34;</span><span class="op" id="7707652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7707655">}</span><br>
<span class="lineno"></span><span class="op" id="7707657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="7707660">func</span>&nbsp;<span class="ident" id="7707665">TestFileHeaderRoundTrip</span><span class="op" id="7707688">(</span><span class="ident" id="7707689">t</span>&nbsp;<span class="op" id="7707691">*</span><span class="ident" id="7707692">testing</span><span class="op" id="7707699">.</span><span class="ident" id="7707700">T</span><span class="op" id="7707701">)</span>&nbsp;<span class="op" id="7707703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7707706">fh</span>&nbsp;<span class="op" id="7707709">:=</span>&nbsp;<span class="op" id="7707712">&amp;</span><span class="ident" id="7707713">FileHeader</span><span class="op" id="7707723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7707727">Name</span><span class="op" id="7707731">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7707745">&#34;foo.txt&#34;</span><span class="op" id="7707754">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7707758">UncompressedSize</span><span class="op" id="7707774">:</span>&nbsp;<span class="num" id="7707776">987654321</span><span class="op" id="7707785">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7707789">ModifiedTime</span><span class="op" id="7707801">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7707807">1234</span><span class="op" id="7707811">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7707815">ModifiedDate</span><span class="op" id="7707827">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7707833">5678</span><span class="op" id="7707837">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7707840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7707843">testHeaderRoundTrip</span><span class="op" id="7707862">(</span><span class="ident" id="7707863">fh</span><span class="op" id="7707865">,</span>&nbsp;<span class="ident" id="7707867">fh</span><span class="op" id="7707869">.</span><span class="ident" id="7707870">UncompressedSize</span><span class="op" id="7707886">,</span>&nbsp;<span class="ident" id="7707888">uint64</span><span class="op" id="7707894">(</span><span class="ident" id="7707895">fh</span><span class="op" id="7707897">.</span><span class="ident" id="7707898">UncompressedSize</span><span class="op" id="7707914">)</span><span class="op" id="7707915">,</span>&nbsp;<span class="ident" id="7707917">t</span><span class="op" id="7707918">)</span><br>
<span class="lineno"></span><span class="op" id="7707920">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="7707923">func</span>&nbsp;<span class="ident" id="7707928">TestFileHeaderRoundTrip64</span><span class="op" id="7707953">(</span><span class="ident" id="7707954">t</span>&nbsp;<span class="op" id="7707956">*</span><span class="ident" id="7707957">testing</span><span class="op" id="7707964">.</span><span class="ident" id="7707965">T</span><span class="op" id="7707966">)</span>&nbsp;<span class="op" id="7707968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7707971">fh</span>&nbsp;<span class="op" id="7707974">:=</span>&nbsp;<span class="op" id="7707977">&amp;</span><span class="ident" id="7707978">FileHeader</span><span class="op" id="7707988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7707992">Name</span><span class="op" id="7707996">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7708012">&#34;foo.txt&#34;</span><span class="op" id="7708021">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7708025">UncompressedSize64</span><span class="op" id="7708043">:</span>&nbsp;<span class="num" id="7708045">9876543210</span><span class="op" id="7708055">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7708059">ModifiedTime</span><span class="op" id="7708071">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7708079">1234</span><span class="op" id="7708083">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7708087">ModifiedDate</span><span class="op" id="7708099">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7708107">5678</span><span class="op" id="7708111">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7708114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7708117">testHeaderRoundTrip</span><span class="op" id="7708136">(</span><span class="ident" id="7708137">fh</span><span class="op" id="7708139">,</span>&nbsp;<span class="ident" id="7708141">uint32max</span><span class="op" id="7708150">,</span>&nbsp;<span class="ident" id="7708152">fh</span><span class="op" id="7708154">.</span><span class="ident" id="7708155">UncompressedSize64</span><span class="op" id="7708173">,</span>&nbsp;<span class="ident" id="7708175">t</span><span class="op" id="7708176">)</span><br>
<span class="lineno"></span><span class="op" id="7708178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="7708181">type</span>&nbsp;<span class="ident" id="7708186">repeatedByte</span>&nbsp;<span class="keyword" id="7708199">struct</span>&nbsp;<span class="op" id="7708206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7708209">off</span>&nbsp;<span class="ident" id="7708213">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7708220">b</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7708224">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7708230">n</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7708234">int64</span><br>
<span class="lineno"></span><span class="op" id="7708240">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="7708243">//&nbsp;rleBuffer&nbsp;is&nbsp;a&nbsp;run-length-encoded&nbsp;byte&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="7708293">//&nbsp;It&#39;s&nbsp;an&nbsp;io.Writer&nbsp;(like&nbsp;a&nbsp;bytes.Buffer)&nbsp;and&nbsp;also&nbsp;an&nbsp;io.ReaderAt,</span><br>
<span class="lineno"></span><span class="comment" id="7708361">//&nbsp;allowing&nbsp;random-access&nbsp;reads.</span><br>
<span class="lineno"></span><span class="keyword" id="7708394">type</span>&nbsp;<span class="ident" id="7708399">rleBuffer</span>&nbsp;<span class="keyword" id="7708409">struct</span>&nbsp;<span class="op" id="7708416">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7708419">buf</span>&nbsp;<span class="op" id="7708423">[</span><span class="op" id="7708424">]</span><span class="ident" id="7708425">repeatedByte</span><br>
<span class="lineno"></span><span class="op" id="7708438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7708441">func</span>&nbsp;<span class="op" id="7708446">(</span><span class="ident" id="7708447">r</span>&nbsp;<span class="op" id="7708449">*</span><span class="ident" id="7708450">rleBuffer</span><span class="op" id="7708459">)</span>&nbsp;<span class="ident" id="7708461">Size</span><span class="op" id="7708465">(</span><span class="op" id="7708466">)</span>&nbsp;<span class="ident" id="7708468">int64</span>&nbsp;<span class="op" id="7708474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7708477">if</span>&nbsp;<span class="builtinfunc" id="7708480">len</span><span class="op" id="7708483">(</span><span class="ident" id="7708484">r</span><span class="op" id="7708485">.</span><span class="ident" id="7708486">buf</span><span class="op" id="7708489">)</span>&nbsp;<span class="op" id="7708491">==</span>&nbsp;<span class="num" id="7708494">0</span>&nbsp;<span class="op" id="7708496">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7708500">return</span>&nbsp;<span class="num" id="7708507">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7708510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7708513">last</span>&nbsp;<span class="op" id="7708518">:=</span>&nbsp;<span class="op" id="7708521">&amp;</span><span class="ident" id="7708522">r</span><span class="op" id="7708523">.</span><span class="ident" id="7708524">buf</span><span class="op" id="7708527">[</span><span class="builtinfunc" id="7708528">len</span><span class="op" id="7708531">(</span><span class="ident" id="7708532">r</span><span class="op" id="7708533">.</span><span class="ident" id="7708534">buf</span><span class="op" id="7708537">)</span><span class="op" id="7708538">-</span><span class="num" id="7708539">1</span><span class="op" id="7708540">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7708543">return</span>&nbsp;<span class="ident" id="7708550">last</span><span class="op" id="7708554">.</span><span class="ident" id="7708555">off</span>&nbsp;<span class="op" id="7708559">+</span>&nbsp;<span class="ident" id="7708561">last</span><span class="op" id="7708565">.</span><span class="ident" id="7708566">n</span><br>
<span class="lineno"></span><span class="op" id="7708568">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="keyword" id="7708571">func</span>&nbsp;<span class="op" id="7708576">(</span><span class="ident" id="7708577">r</span>&nbsp;<span class="op" id="7708579">*</span><span class="ident" id="7708580">rleBuffer</span><span class="op" id="7708589">)</span>&nbsp;<span class="ident" id="7708591">Write</span><span class="op" id="7708596">(</span><span class="ident" id="7708597">p</span>&nbsp;<span class="op" id="7708599">[</span><span class="op" id="7708600">]</span><span class="builtintype" id="7708601">byte</span><span class="op" id="7708605">)</span>&nbsp;<span class="op" id="7708607">(</span><span class="ident" id="7708608">n</span>&nbsp;<span class="builtintype" id="7708610">int</span><span class="op" id="7708613">,</span>&nbsp;<span class="ident" id="7708615">err</span>&nbsp;<span class="builtintype" id="7708619">error</span><span class="op" id="7708624">)</span>&nbsp;<span class="op" id="7708626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7708629">var</span>&nbsp;<span class="ident" id="7708633">rp</span>&nbsp;<span class="op" id="7708636">*</span><span class="ident" id="7708637">repeatedByte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7708651">if</span>&nbsp;<span class="builtinfunc" id="7708654">len</span><span class="op" id="7708657">(</span><span class="ident" id="7708658">r</span><span class="op" id="7708659">.</span><span class="ident" id="7708660">buf</span><span class="op" id="7708663">)</span>&nbsp;<span class="op" id="7708665">&gt;</span>&nbsp;<span class="num" id="7708667">0</span>&nbsp;<span class="op" id="7708669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7708673">rp</span>&nbsp;<span class="op" id="7708676">=</span>&nbsp;<span class="op" id="7708678">&amp;</span><span class="ident" id="7708679">r</span><span class="op" id="7708680">.</span><span class="ident" id="7708681">buf</span><span class="op" id="7708684">[</span><span class="builtinfunc" id="7708685">len</span><span class="op" id="7708688">(</span><span class="ident" id="7708689">r</span><span class="op" id="7708690">.</span><span class="ident" id="7708691">buf</span><span class="op" id="7708694">)</span><span class="op" id="7708695">-</span><span class="num" id="7708696">1</span><span class="op" id="7708697">]</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7708701">//&nbsp;Fast&nbsp;path,&nbsp;if&nbsp;p&nbsp;is&nbsp;entirely&nbsp;the&nbsp;same&nbsp;byte&nbsp;repeated.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7708758">if</span>&nbsp;<span class="ident" id="7708761">lastByte</span>&nbsp;<span class="op" id="7708770">:=</span>&nbsp;<span class="ident" id="7708773">rp</span><span class="op" id="7708775">.</span><span class="ident" id="7708776">b</span><span class="op" id="7708777">;</span>&nbsp;<span class="builtinfunc" id="7708779">len</span><span class="op" id="7708782">(</span><span class="ident" id="7708783">p</span><span class="op" id="7708784">)</span>&nbsp;<span class="op" id="7708786">&gt;</span>&nbsp;<span class="num" id="7708788">0</span>&nbsp;<span class="op" id="7708790">&amp;&amp;</span>&nbsp;<span class="ident" id="7708793">p</span><span class="op" id="7708794">[</span><span class="num" id="7708795">0</span><span class="op" id="7708796">]</span>&nbsp;<span class="op" id="7708798">==</span>&nbsp;<span class="ident" id="7708801">lastByte</span>&nbsp;<span class="op" id="7708810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7708815">all</span>&nbsp;<span class="op" id="7708819">:=</span>&nbsp;<span class="builtintype" id="7708822">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7708830">for</span>&nbsp;<span class="ident" id="7708834">_</span><span class="op" id="7708835">,</span>&nbsp;<span class="ident" id="7708837">b</span>&nbsp;<span class="op" id="7708839">:=</span>&nbsp;<span class="keyword" id="7708842">range</span>&nbsp;<span class="ident" id="7708848">p</span>&nbsp;<span class="op" id="7708850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7708856">if</span>&nbsp;<span class="ident" id="7708859">b</span>&nbsp;<span class="op" id="7708861">!=</span>&nbsp;<span class="ident" id="7708864">lastByte</span>&nbsp;<span class="op" id="7708873">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7708880">all</span>&nbsp;<span class="op" id="7708884">=</span>&nbsp;<span class="builtintype" id="7708886">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7708897">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7708907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7708912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7708917">if</span>&nbsp;<span class="ident" id="7708920">all</span>&nbsp;<span class="op" id="7708924">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7708930">rp</span><span class="op" id="7708932">.</span><span class="ident" id="7708933">n</span>&nbsp;<span class="op" id="7708935">+=</span>&nbsp;<span class="ident" id="7708938">int64</span><span class="op" id="7708943">(</span><span class="builtinfunc" id="7708944">len</span><span class="op" id="7708947">(</span><span class="ident" id="7708948">p</span><span class="op" id="7708949">)</span><span class="op" id="7708950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7708956">return</span>&nbsp;<span class="builtinfunc" id="7708963">len</span><span class="op" id="7708966">(</span><span class="ident" id="7708967">p</span><span class="op" id="7708968">)</span><span class="op" id="7708969">,</span>&nbsp;<span class="ident" id="7708971">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7708978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7708982">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7708985">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7708989">for</span>&nbsp;<span class="ident" id="7708993">_</span><span class="op" id="7708994">,</span>&nbsp;<span class="ident" id="7708996">b</span>&nbsp;<span class="op" id="7708998">:=</span>&nbsp;<span class="keyword" id="7709001">range</span>&nbsp;<span class="ident" id="7709007">p</span>&nbsp;<span class="op" id="7709009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7709013">if</span>&nbsp;<span class="ident" id="7709016">rp</span>&nbsp;<span class="op" id="7709019">==</span>&nbsp;<span class="ident" id="7709022">nil</span>&nbsp;<span class="op" id="7709026">||</span>&nbsp;<span class="ident" id="7709029">rp</span><span class="op" id="7709031">.</span><span class="ident" id="7709032">b</span>&nbsp;<span class="op" id="7709034">!=</span>&nbsp;<span class="ident" id="7709037">b</span>&nbsp;<span class="op" id="7709039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7709044">r</span><span class="op" id="7709045">.</span><span class="ident" id="7709046">buf</span>&nbsp;<span class="op" id="7709050">=</span>&nbsp;<span class="builtinfunc" id="7709052">append</span><span class="op" id="7709058">(</span><span class="ident" id="7709059">r</span><span class="op" id="7709060">.</span><span class="ident" id="7709061">buf</span><span class="op" id="7709064">,</span>&nbsp;<span class="ident" id="7709066">repeatedByte</span><span class="op" id="7709078">{</span><span class="ident" id="7709079">r</span><span class="op" id="7709080">.</span><span class="ident" id="7709081">Size</span><span class="op" id="7709085">(</span><span class="op" id="7709086">)</span><span class="op" id="7709087">,</span>&nbsp;<span class="ident" id="7709089">b</span><span class="op" id="7709090">,</span>&nbsp;<span class="num" id="7709092">1</span><span class="op" id="7709093">}</span><span class="op" id="7709094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7709099">rp</span>&nbsp;<span class="op" id="7709102">=</span>&nbsp;<span class="op" id="7709104">&amp;</span><span class="ident" id="7709105">r</span><span class="op" id="7709106">.</span><span class="ident" id="7709107">buf</span><span class="op" id="7709110">[</span><span class="builtinfunc" id="7709111">len</span><span class="op" id="7709114">(</span><span class="ident" id="7709115">r</span><span class="op" id="7709116">.</span><span class="ident" id="7709117">buf</span><span class="op" id="7709120">)</span><span class="op" id="7709121">-</span><span class="num" id="7709122">1</span><span class="op" id="7709123">]</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7709127">}</span>&nbsp;<span class="keyword" id="7709129">else</span>&nbsp;<span class="op" id="7709134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7709139">rp</span><span class="op" id="7709141">.</span><span class="ident" id="7709142">n</span><span class="op" id="7709143">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7709148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7709151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7709154">return</span>&nbsp;<span class="builtinfunc" id="7709161">len</span><span class="op" id="7709164">(</span><span class="ident" id="7709165">p</span><span class="op" id="7709166">)</span><span class="op" id="7709167">,</span>&nbsp;<span class="ident" id="7709169">nil</span><br>
<span class="lineno">160</span><span class="op" id="7709173">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7709176">func</span>&nbsp;<span class="op" id="7709181">(</span><span class="ident" id="7709182">r</span>&nbsp;<span class="op" id="7709184">*</span><span class="ident" id="7709185">rleBuffer</span><span class="op" id="7709194">)</span>&nbsp;<span class="ident" id="7709196">ReadAt</span><span class="op" id="7709202">(</span><span class="ident" id="7709203">p</span>&nbsp;<span class="op" id="7709205">[</span><span class="op" id="7709206">]</span><span class="builtintype" id="7709207">byte</span><span class="op" id="7709211">,</span>&nbsp;<span class="ident" id="7709213">off</span>&nbsp;<span class="ident" id="7709217">int64</span><span class="op" id="7709222">)</span>&nbsp;<span class="op" id="7709224">(</span><span class="ident" id="7709225">n</span>&nbsp;<span class="builtintype" id="7709227">int</span><span class="op" id="7709230">,</span>&nbsp;<span class="ident" id="7709232">err</span>&nbsp;<span class="builtintype" id="7709236">error</span><span class="op" id="7709241">)</span>&nbsp;<span class="op" id="7709243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7709246">if</span>&nbsp;<span class="builtinfunc" id="7709249">len</span><span class="op" id="7709252">(</span><span class="ident" id="7709253">p</span><span class="op" id="7709254">)</span>&nbsp;<span class="op" id="7709256">==</span>&nbsp;<span class="num" id="7709259">0</span>&nbsp;<span class="op" id="7709261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7709265">return</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7709273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7709276">skipParts</span>&nbsp;<span class="op" id="7709286">:=</span>&nbsp;<span class="ident" id="7709289">sort</span><span class="op" id="7709293">.</span><span class="ident" id="7709294">Search</span><span class="op" id="7709300">(</span><span class="builtinfunc" id="7709301">len</span><span class="op" id="7709304">(</span><span class="ident" id="7709305">r</span><span class="op" id="7709306">.</span><span class="ident" id="7709307">buf</span><span class="op" id="7709310">)</span><span class="op" id="7709311">,</span>&nbsp;<span class="keyword" id="7709313">func</span><span class="op" id="7709317">(</span><span class="ident" id="7709318">i</span>&nbsp;<span class="builtintype" id="7709320">int</span><span class="op" id="7709323">)</span>&nbsp;<span class="builtintype" id="7709325">bool</span>&nbsp;<span class="op" id="7709330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7709334">part</span>&nbsp;<span class="op" id="7709339">:=</span>&nbsp;<span class="op" id="7709342">&amp;</span><span class="ident" id="7709343">r</span><span class="op" id="7709344">.</span><span class="ident" id="7709345">buf</span><span class="op" id="7709348">[</span><span class="ident" id="7709349">i</span><span class="op" id="7709350">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7709354">return</span>&nbsp;<span class="ident" id="7709361">part</span><span class="op" id="7709365">.</span><span class="ident" id="7709366">off</span><span class="op" id="7709369">+</span><span class="ident" id="7709370">part</span><span class="op" id="7709374">.</span><span class="ident" id="7709375">n</span>&nbsp;<span class="op" id="7709377">&gt;</span>&nbsp;<span class="ident" id="7709379">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7709384">}</span><span class="op" id="7709385">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7709388">parts</span>&nbsp;<span class="op" id="7709394">:=</span>&nbsp;<span class="ident" id="7709397">r</span><span class="op" id="7709398">.</span><span class="ident" id="7709399">buf</span><span class="op" id="7709402">[</span><span class="ident" id="7709403">skipParts</span><span class="op" id="7709412">:</span><span class="op" id="7709413">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7709416">if</span>&nbsp;<span class="builtinfunc" id="7709419">len</span><span class="op" id="7709422">(</span><span class="ident" id="7709423">parts</span><span class="op" id="7709428">)</span>&nbsp;<span class="op" id="7709430">&gt;</span>&nbsp;<span class="num" id="7709432">0</span>&nbsp;<span class="op" id="7709434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7709438">skipBytes</span>&nbsp;<span class="op" id="7709448">:=</span>&nbsp;<span class="ident" id="7709451">off</span>&nbsp;<span class="op" id="7709455">-</span>&nbsp;<span class="ident" id="7709457">parts</span><span class="op" id="7709462">[</span><span class="num" id="7709463">0</span><span class="op" id="7709464">]</span><span class="op" id="7709465">.</span><span class="ident" id="7709466">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7709472">for</span>&nbsp;<span class="builtinfunc" id="7709476">len</span><span class="op" id="7709479">(</span><span class="ident" id="7709480">parts</span><span class="op" id="7709485">)</span>&nbsp;<span class="op" id="7709487">&gt;</span>&nbsp;<span class="num" id="7709489">0</span>&nbsp;<span class="op" id="7709491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7709496">part</span>&nbsp;<span class="op" id="7709501">:=</span>&nbsp;<span class="ident" id="7709504">parts</span><span class="op" id="7709509">[</span><span class="num" id="7709510">0</span><span class="op" id="7709511">]</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7709516">for</span>&nbsp;<span class="ident" id="7709520">i</span>&nbsp;<span class="op" id="7709522">:=</span>&nbsp;<span class="ident" id="7709525">skipBytes</span><span class="op" id="7709534">;</span>&nbsp;<span class="ident" id="7709536">i</span>&nbsp;<span class="op" id="7709538">&lt;</span>&nbsp;<span class="ident" id="7709540">part</span><span class="op" id="7709544">.</span><span class="ident" id="7709545">n</span><span class="op" id="7709546">;</span>&nbsp;<span class="ident" id="7709548">i</span><span class="op" id="7709549">++</span>&nbsp;<span class="op" id="7709552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7709558">if</span>&nbsp;<span class="ident" id="7709561">n</span>&nbsp;<span class="op" id="7709563">==</span>&nbsp;<span class="builtinfunc" id="7709566">len</span><span class="op" id="7709569">(</span><span class="ident" id="7709570">p</span><span class="op" id="7709571">)</span>&nbsp;<span class="op" id="7709573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7709580">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7709591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7709597">p</span><span class="op" id="7709598">[</span><span class="ident" id="7709599">n</span><span class="op" id="7709600">]</span>&nbsp;<span class="op" id="7709602">=</span>&nbsp;<span class="ident" id="7709604">part</span><span class="op" id="7709608">.</span><span class="ident" id="7709609">b</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7709615">n</span><span class="op" id="7709616">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7709622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7709627">parts</span>&nbsp;<span class="op" id="7709633">=</span>&nbsp;<span class="ident" id="7709635">parts</span><span class="op" id="7709640">[</span><span class="num" id="7709641">1</span><span class="op" id="7709642">:</span><span class="op" id="7709643">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7709648">skipBytes</span>&nbsp;<span class="op" id="7709658">=</span>&nbsp;<span class="num" id="7709660">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7709664">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7709667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7709670">if</span>&nbsp;<span class="ident" id="7709673">n</span>&nbsp;<span class="op" id="7709675">!=</span>&nbsp;<span class="builtinfunc" id="7709678">len</span><span class="op" id="7709681">(</span><span class="ident" id="7709682">p</span><span class="op" id="7709683">)</span>&nbsp;<span class="op" id="7709685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7709689">err</span>&nbsp;<span class="op" id="7709693">=</span>&nbsp;<span class="ident" id="7709695">io</span><span class="op" id="7709697">.</span><span class="ident" id="7709698">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7709716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7709719">return</span><br>
<span class="lineno">190</span><span class="op" id="7709726">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7709729">//&nbsp;Just&nbsp;testing&nbsp;the&nbsp;rleBuffer&nbsp;used&nbsp;in&nbsp;the&nbsp;Zip64&nbsp;test&nbsp;above.&nbsp;Not&nbsp;used&nbsp;by&nbsp;the&nbsp;zip&nbsp;code.</span><br>
<span class="lineno"></span><span class="keyword" id="7709815">func</span>&nbsp;<span class="ident" id="7709820">TestRLEBuffer</span><span class="op" id="7709833">(</span><span class="ident" id="7709834">t</span>&nbsp;<span class="op" id="7709836">*</span><span class="ident" id="7709837">testing</span><span class="op" id="7709844">.</span><span class="ident" id="7709845">T</span><span class="op" id="7709846">)</span>&nbsp;<span class="op" id="7709848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7709851">b</span>&nbsp;<span class="op" id="7709853">:=</span>&nbsp;<span class="builtinfunc" id="7709856">new</span><span class="op" id="7709859">(</span><span class="ident" id="7709860">rleBuffer</span><span class="op" id="7709869">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7709872">var</span>&nbsp;<span class="ident" id="7709876">all</span>&nbsp;<span class="op" id="7709880">[</span><span class="op" id="7709881">]</span><span class="builtintype" id="7709882">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7709888">writes</span>&nbsp;<span class="op" id="7709895">:=</span>&nbsp;<span class="op" id="7709898">[</span><span class="op" id="7709899">]</span><span class="builtintype" id="7709900">string</span><span class="op" id="7709906">{</span><span class="string" id="7709907">&#34;abcdeee&#34;</span><span class="op" id="7709916">,</span>&nbsp;<span class="string" id="7709918">&#34;eeeeeee&#34;</span><span class="op" id="7709927">,</span>&nbsp;<span class="string" id="7709929">&#34;eeeefghaaiii&#34;</span><span class="op" id="7709943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7709946">for</span>&nbsp;<span class="ident" id="7709950">_</span><span class="op" id="7709951">,</span>&nbsp;<span class="ident" id="7709953">w</span>&nbsp;<span class="op" id="7709955">:=</span>&nbsp;<span class="keyword" id="7709958">range</span>&nbsp;<span class="ident" id="7709964">writes</span>&nbsp;<span class="op" id="7709971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7709975">b</span><span class="op" id="7709976">.</span><span class="ident" id="7709977">Write</span><span class="op" id="7709982">(</span><span class="op" id="7709983">[</span><span class="op" id="7709984">]</span><span class="builtintype" id="7709985">byte</span><span class="op" id="7709989">(</span><span class="ident" id="7709990">w</span><span class="op" id="7709991">)</span><span class="op" id="7709992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7709996">all</span>&nbsp;<span class="op" id="7710000">=</span>&nbsp;<span class="builtinfunc" id="7710002">append</span><span class="op" id="7710008">(</span><span class="ident" id="7710009">all</span><span class="op" id="7710012">,</span>&nbsp;<span class="ident" id="7710014">w</span><span class="op" id="7710015">...</span><span class="op" id="7710018">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7710021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7710024">if</span>&nbsp;<span class="builtinfunc" id="7710027">len</span><span class="op" id="7710030">(</span><span class="ident" id="7710031">b</span><span class="op" id="7710032">.</span><span class="ident" id="7710033">buf</span><span class="op" id="7710036">)</span>&nbsp;<span class="op" id="7710038">!=</span>&nbsp;<span class="num" id="7710041">10</span>&nbsp;<span class="op" id="7710044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7710048">t</span><span class="op" id="7710049">.</span><span class="ident" id="7710050">Fatalf</span><span class="op" id="7710056">(</span><span class="string" id="7710057">&#34;len(b.buf)&nbsp;=&nbsp;%d;&nbsp;want&nbsp;10&#34;</span><span class="op" id="7710083">,</span>&nbsp;<span class="builtinfunc" id="7710085">len</span><span class="op" id="7710088">(</span><span class="ident" id="7710089">b</span><span class="op" id="7710090">.</span><span class="ident" id="7710091">buf</span><span class="op" id="7710094">)</span><span class="op" id="7710095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7710098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7710102">for</span>&nbsp;<span class="ident" id="7710106">i</span>&nbsp;<span class="op" id="7710108">:=</span>&nbsp;<span class="num" id="7710111">0</span><span class="op" id="7710112">;</span>&nbsp;<span class="ident" id="7710114">i</span>&nbsp;<span class="op" id="7710116">&lt;</span>&nbsp;<span class="builtinfunc" id="7710118">len</span><span class="op" id="7710121">(</span><span class="ident" id="7710122">all</span><span class="op" id="7710125">)</span><span class="op" id="7710126">;</span>&nbsp;<span class="ident" id="7710128">i</span><span class="op" id="7710129">++</span>&nbsp;<span class="op" id="7710132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7710136">for</span>&nbsp;<span class="ident" id="7710140">j</span>&nbsp;<span class="op" id="7710142">:=</span>&nbsp;<span class="num" id="7710145">0</span><span class="op" id="7710146">;</span>&nbsp;<span class="ident" id="7710148">j</span>&nbsp;<span class="op" id="7710150">&lt;</span>&nbsp;<span class="builtinfunc" id="7710152">len</span><span class="op" id="7710155">(</span><span class="ident" id="7710156">all</span><span class="op" id="7710159">)</span><span class="op" id="7710160">-</span><span class="ident" id="7710161">i</span><span class="op" id="7710162">;</span>&nbsp;<span class="ident" id="7710164">j</span><span class="op" id="7710165">++</span>&nbsp;<span class="op" id="7710168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7710173">buf</span>&nbsp;<span class="op" id="7710177">:=</span>&nbsp;<span class="builtinfunc" id="7710180">make</span><span class="op" id="7710184">(</span><span class="op" id="7710185">[</span><span class="op" id="7710186">]</span><span class="builtintype" id="7710187">byte</span><span class="op" id="7710191">,</span>&nbsp;<span class="ident" id="7710193">j</span><span class="op" id="7710194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7710199">n</span><span class="op" id="7710200">,</span>&nbsp;<span class="ident" id="7710202">err</span>&nbsp;<span class="op" id="7710206">:=</span>&nbsp;<span class="ident" id="7710209">b</span><span class="op" id="7710210">.</span><span class="ident" id="7710211">ReadAt</span><span class="op" id="7710217">(</span><span class="ident" id="7710218">buf</span><span class="op" id="7710221">,</span>&nbsp;<span class="ident" id="7710223">int64</span><span class="op" id="7710228">(</span><span class="ident" id="7710229">i</span><span class="op" id="7710230">)</span><span class="op" id="7710231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7710236">if</span>&nbsp;<span class="ident" id="7710239">err</span>&nbsp;<span class="op" id="7710243">!=</span>&nbsp;<span class="ident" id="7710246">nil</span>&nbsp;<span class="op" id="7710250">||</span>&nbsp;<span class="ident" id="7710253">n</span>&nbsp;<span class="op" id="7710255">!=</span>&nbsp;<span class="builtinfunc" id="7710258">len</span><span class="op" id="7710261">(</span><span class="ident" id="7710262">buf</span><span class="op" id="7710265">)</span>&nbsp;<span class="op" id="7710267">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7710273">t</span><span class="op" id="7710274">.</span><span class="ident" id="7710275">Errorf</span><span class="op" id="7710281">(</span><span class="string" id="7710282">&#34;ReadAt(%d,&nbsp;%d)&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;%d,&nbsp;nil&#34;</span><span class="op" id="7710321">,</span>&nbsp;<span class="ident" id="7710323">i</span><span class="op" id="7710324">,</span>&nbsp;<span class="ident" id="7710326">j</span><span class="op" id="7710327">,</span>&nbsp;<span class="ident" id="7710329">n</span><span class="op" id="7710330">,</span>&nbsp;<span class="ident" id="7710332">err</span><span class="op" id="7710335">,</span>&nbsp;<span class="builtinfunc" id="7710337">len</span><span class="op" id="7710340">(</span><span class="ident" id="7710341">buf</span><span class="op" id="7710344">)</span><span class="op" id="7710345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7710350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7710355">if</span>&nbsp;<span class="op" id="7710358">!</span><span class="ident" id="7710359">bytes</span><span class="op" id="7710364">.</span><span class="ident" id="7710365">Equal</span><span class="op" id="7710370">(</span><span class="ident" id="7710371">buf</span><span class="op" id="7710374">,</span>&nbsp;<span class="ident" id="7710376">all</span><span class="op" id="7710379">[</span><span class="ident" id="7710380">i</span><span class="op" id="7710381">:</span><span class="ident" id="7710382">i</span><span class="op" id="7710383">+</span><span class="ident" id="7710384">j</span><span class="op" id="7710385">]</span><span class="op" id="7710386">)</span>&nbsp;<span class="op" id="7710388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7710394">t</span><span class="op" id="7710395">.</span><span class="ident" id="7710396">Errorf</span><span class="op" id="7710402">(</span><span class="string" id="7710403">&#34;ReadAt(%d,&nbsp;%d)&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7710433">,</span>&nbsp;<span class="ident" id="7710435">i</span><span class="op" id="7710436">,</span>&nbsp;<span class="ident" id="7710438">j</span><span class="op" id="7710439">,</span>&nbsp;<span class="ident" id="7710441">buf</span><span class="op" id="7710444">,</span>&nbsp;<span class="ident" id="7710446">all</span><span class="op" id="7710449">[</span><span class="ident" id="7710450">i</span><span class="op" id="7710451">:</span><span class="ident" id="7710452">i</span><span class="op" id="7710453">+</span><span class="ident" id="7710454">j</span><span class="op" id="7710455">]</span><span class="op" id="7710456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7710461">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7710465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7710468">}</span><br>
<span class="lineno"></span><span class="op" id="7710470">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7710473">//&nbsp;fakeHash32&nbsp;is&nbsp;a&nbsp;dummy&nbsp;Hash32&nbsp;that&nbsp;always&nbsp;returns&nbsp;0.</span><br>
<span class="lineno">220</span><span class="keyword" id="7710528">type</span>&nbsp;<span class="ident" id="7710533">fakeHash32</span>&nbsp;<span class="keyword" id="7710544">struct</span>&nbsp;<span class="op" id="7710551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7710554">hash</span><span class="op" id="7710558">.</span><span class="ident" id="7710559">Hash32</span><br>
<span class="lineno"></span><span class="op" id="7710566">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7710569">func</span>&nbsp;<span class="op" id="7710574">(</span><span class="ident" id="7710575">fakeHash32</span><span class="op" id="7710585">)</span>&nbsp;<span class="ident" id="7710587">Write</span><span class="op" id="7710592">(</span><span class="ident" id="7710593">p</span>&nbsp;<span class="op" id="7710595">[</span><span class="op" id="7710596">]</span><span class="builtintype" id="7710597">byte</span><span class="op" id="7710601">)</span>&nbsp;<span class="op" id="7710603">(</span><span class="builtintype" id="7710604">int</span><span class="op" id="7710607">,</span>&nbsp;<span class="builtintype" id="7710609">error</span><span class="op" id="7710614">)</span>&nbsp;<span class="op" id="7710616">{</span>&nbsp;<span class="keyword" id="7710618">return</span>&nbsp;<span class="builtinfunc" id="7710625">len</span><span class="op" id="7710628">(</span><span class="ident" id="7710629">p</span><span class="op" id="7710630">)</span><span class="op" id="7710631">,</span>&nbsp;<span class="ident" id="7710633">nil</span>&nbsp;<span class="op" id="7710637">}</span><br>
<span class="lineno">225</span><span class="keyword" id="7710639">func</span>&nbsp;<span class="op" id="7710644">(</span><span class="ident" id="7710645">fakeHash32</span><span class="op" id="7710655">)</span>&nbsp;<span class="ident" id="7710657">Sum32</span><span class="op" id="7710662">(</span><span class="op" id="7710663">)</span>&nbsp;<span class="builtintype" id="7710665">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7710686">{</span>&nbsp;<span class="keyword" id="7710688">return</span>&nbsp;<span class="num" id="7710695">0</span>&nbsp;<span class="op" id="7710697">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7710700">func</span>&nbsp;<span class="ident" id="7710705">TestZip64</span><span class="op" id="7710714">(</span><span class="ident" id="7710715">t</span>&nbsp;<span class="op" id="7710717">*</span><span class="ident" id="7710718">testing</span><span class="op" id="7710725">.</span><span class="ident" id="7710726">T</span><span class="op" id="7710727">)</span>&nbsp;<span class="op" id="7710729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7710732">if</span>&nbsp;<span class="ident" id="7710735">testing</span><span class="op" id="7710742">.</span><span class="ident" id="7710743">Short</span><span class="op" id="7710748">(</span><span class="op" id="7710749">)</span>&nbsp;<span class="op" id="7710751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7710755">t</span><span class="op" id="7710756">.</span><span class="ident" id="7710757">Skip</span><span class="op" id="7710761">(</span><span class="string" id="7710762">&#34;slow&nbsp;test;&nbsp;skipping&#34;</span><span class="op" id="7710783">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7710786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7710789">const</span>&nbsp;<span class="ident" id="7710795">size</span>&nbsp;<span class="op" id="7710800">=</span>&nbsp;<span class="num" id="7710802">1</span>&nbsp;<span class="op" id="7710804">&lt;&lt;</span>&nbsp;<span class="num" id="7710807">32</span>&nbsp;<span class="comment" id="7710810">//&nbsp;before&nbsp;the&nbsp;&#34;END\n&#34;&nbsp;part</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7710838">testZip64</span><span class="op" id="7710847">(</span><span class="ident" id="7710848">t</span><span class="op" id="7710849">,</span>&nbsp;<span class="ident" id="7710851">size</span><span class="op" id="7710855">)</span><br>
<span class="lineno"></span><span class="op" id="7710857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword" id="7710860">func</span>&nbsp;<span class="ident" id="7710865">testZip64</span><span class="op" id="7710874">(</span><span class="ident" id="7710875">t</span>&nbsp;<span class="ident" id="7710877">testing</span><span class="op" id="7710884">.</span><span class="ident" id="7710885">TB</span><span class="op" id="7710887">,</span>&nbsp;<span class="ident" id="7710889">size</span>&nbsp;<span class="ident" id="7710894">int64</span><span class="op" id="7710899">)</span>&nbsp;<span class="op" id="7710901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7710904">const</span>&nbsp;<span class="ident" id="7710910">chunkSize</span>&nbsp;<span class="op" id="7710920">=</span>&nbsp;<span class="num" id="7710922">1024</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7710928">chunks</span>&nbsp;<span class="op" id="7710935">:=</span>&nbsp;<span class="builtintype" id="7710938">int</span><span class="op" id="7710941">(</span><span class="ident" id="7710942">size</span>&nbsp;<span class="op" id="7710947">/</span>&nbsp;<span class="ident" id="7710949">chunkSize</span><span class="op" id="7710958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7710961">//&nbsp;write&nbsp;2^32&nbsp;bytes&nbsp;plus&nbsp;&#34;END\n&#34;&nbsp;to&nbsp;a&nbsp;zip&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7711009">buf</span>&nbsp;<span class="op" id="7711013">:=</span>&nbsp;<span class="builtinfunc" id="7711016">new</span><span class="op" id="7711019">(</span><span class="ident" id="7711020">rleBuffer</span><span class="op" id="7711029">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7711032">w</span>&nbsp;<span class="op" id="7711034">:=</span>&nbsp;<span class="ident" id="7711037">NewWriter</span><span class="op" id="7711046">(</span><span class="ident" id="7711047">buf</span><span class="op" id="7711050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7711053">f</span><span class="op" id="7711054">,</span>&nbsp;<span class="ident" id="7711056">err</span>&nbsp;<span class="op" id="7711060">:=</span>&nbsp;<span class="ident" id="7711063">w</span><span class="op" id="7711064">.</span><span class="ident" id="7711065">CreateHeader</span><span class="op" id="7711077">(</span><span class="op" id="7711078">&amp;</span><span class="ident" id="7711079">FileHeader</span><span class="op" id="7711089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7711093">Name</span><span class="op" id="7711097">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7711101">&#34;huge.txt&#34;</span><span class="op" id="7711111">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7711115">Method</span><span class="op" id="7711121">:</span>&nbsp;<span class="ident" id="7711123">Store</span><span class="op" id="7711128">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7711131">}</span><span class="op" id="7711132">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7711135">if</span>&nbsp;<span class="ident" id="7711138">err</span>&nbsp;<span class="op" id="7711142">!=</span>&nbsp;<span class="ident" id="7711145">nil</span>&nbsp;<span class="op" id="7711149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7711153">t</span><span class="op" id="7711154">.</span><span class="ident" id="7711155">Fatal</span><span class="op" id="7711160">(</span><span class="ident" id="7711161">err</span><span class="op" id="7711164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7711167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7711170">f</span><span class="op" id="7711171">.</span><span class="op" id="7711172">(</span><span class="op" id="7711173">*</span><span class="ident" id="7711174">fileWriter</span><span class="op" id="7711184">)</span><span class="op" id="7711185">.</span><span class="ident" id="7711186">crc32</span>&nbsp;<span class="op" id="7711192">=</span>&nbsp;<span class="ident" id="7711194">fakeHash32</span><span class="op" id="7711204">{</span><span class="op" id="7711205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7711208">chunk</span>&nbsp;<span class="op" id="7711214">:=</span>&nbsp;<span class="builtinfunc" id="7711217">make</span><span class="op" id="7711221">(</span><span class="op" id="7711222">[</span><span class="op" id="7711223">]</span><span class="builtintype" id="7711224">byte</span><span class="op" id="7711228">,</span>&nbsp;<span class="ident" id="7711230">chunkSize</span><span class="op" id="7711239">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7711242">for</span>&nbsp;<span class="ident" id="7711246">i</span>&nbsp;<span class="op" id="7711248">:=</span>&nbsp;<span class="keyword" id="7711251">range</span>&nbsp;<span class="ident" id="7711257">chunk</span>&nbsp;<span class="op" id="7711263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7711267">chunk</span><span class="op" id="7711272">[</span><span class="ident" id="7711273">i</span><span class="op" id="7711274">]</span>&nbsp;<span class="op" id="7711276">=</span>&nbsp;<span class="string" id="7711278">&#39;.&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7711283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7711286">for</span>&nbsp;<span class="ident" id="7711290">i</span>&nbsp;<span class="op" id="7711292">:=</span>&nbsp;<span class="num" id="7711295">0</span><span class="op" id="7711296">;</span>&nbsp;<span class="ident" id="7711298">i</span>&nbsp;<span class="op" id="7711300">&lt;</span>&nbsp;<span class="ident" id="7711302">chunks</span><span class="op" id="7711308">;</span>&nbsp;<span class="ident" id="7711310">i</span><span class="op" id="7711311">++</span>&nbsp;<span class="op" id="7711314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7711318">_</span><span class="op" id="7711319">,</span>&nbsp;<span class="ident" id="7711321">err</span>&nbsp;<span class="op" id="7711325">:=</span>&nbsp;<span class="ident" id="7711328">f</span><span class="op" id="7711329">.</span><span class="ident" id="7711330">Write</span><span class="op" id="7711335">(</span><span class="ident" id="7711336">chunk</span><span class="op" id="7711341">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7711345">if</span>&nbsp;<span class="ident" id="7711348">err</span>&nbsp;<span class="op" id="7711352">!=</span>&nbsp;<span class="ident" id="7711355">nil</span>&nbsp;<span class="op" id="7711359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7711364">t</span><span class="op" id="7711365">.</span><span class="ident" id="7711366">Fatal</span><span class="op" id="7711371">(</span><span class="string" id="7711372">&#34;write&nbsp;chunk:&#34;</span><span class="op" id="7711386">,</span>&nbsp;<span class="ident" id="7711388">err</span><span class="op" id="7711391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7711395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7711398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7711401">end</span>&nbsp;<span class="op" id="7711405">:=</span>&nbsp;<span class="op" id="7711408">[</span><span class="op" id="7711409">]</span><span class="builtintype" id="7711410">byte</span><span class="op" id="7711414">(</span><span class="string" id="7711415">&#34;END\n&#34;</span><span class="op" id="7711422">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7711425">_</span><span class="op" id="7711426">,</span>&nbsp;<span class="ident" id="7711428">err</span>&nbsp;<span class="op" id="7711432">=</span>&nbsp;<span class="ident" id="7711434">f</span><span class="op" id="7711435">.</span><span class="ident" id="7711436">Write</span><span class="op" id="7711441">(</span><span class="ident" id="7711442">end</span><span class="op" id="7711445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7711448">if</span>&nbsp;<span class="ident" id="7711451">err</span>&nbsp;<span class="op" id="7711455">!=</span>&nbsp;<span class="ident" id="7711458">nil</span>&nbsp;<span class="op" id="7711462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7711466">t</span><span class="op" id="7711467">.</span><span class="ident" id="7711468">Fatal</span><span class="op" id="7711473">(</span><span class="string" id="7711474">&#34;write&nbsp;end:&#34;</span><span class="op" id="7711486">,</span>&nbsp;<span class="ident" id="7711488">err</span><span class="op" id="7711491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7711494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7711497">if</span>&nbsp;<span class="ident" id="7711500">err</span>&nbsp;<span class="op" id="7711504">:=</span>&nbsp;<span class="ident" id="7711507">w</span><span class="op" id="7711508">.</span><span class="ident" id="7711509">Close</span><span class="op" id="7711514">(</span><span class="op" id="7711515">)</span><span class="op" id="7711516">;</span>&nbsp;<span class="ident" id="7711518">err</span>&nbsp;<span class="op" id="7711522">!=</span>&nbsp;<span class="ident" id="7711525">nil</span>&nbsp;<span class="op" id="7711529">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7711533">t</span><span class="op" id="7711534">.</span><span class="ident" id="7711535">Fatal</span><span class="op" id="7711540">(</span><span class="ident" id="7711541">err</span><span class="op" id="7711544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7711547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7711551">//&nbsp;read&nbsp;back&nbsp;zip&nbsp;file&nbsp;and&nbsp;check&nbsp;that&nbsp;we&nbsp;get&nbsp;to&nbsp;the&nbsp;end&nbsp;of&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7711613">r</span><span class="op" id="7711614">,</span>&nbsp;<span class="ident" id="7711616">err</span>&nbsp;<span class="op" id="7711620">:=</span>&nbsp;<span class="ident" id="7711623">NewReader</span><span class="op" id="7711632">(</span><span class="ident" id="7711633">buf</span><span class="op" id="7711636">,</span>&nbsp;<span class="ident" id="7711638">int64</span><span class="op" id="7711643">(</span><span class="ident" id="7711644">buf</span><span class="op" id="7711647">.</span><span class="ident" id="7711648">Size</span><span class="op" id="7711652">(</span><span class="op" id="7711653">)</span><span class="op" id="7711654">)</span><span class="op" id="7711655">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7711658">if</span>&nbsp;<span class="ident" id="7711661">err</span>&nbsp;<span class="op" id="7711665">!=</span>&nbsp;<span class="ident" id="7711668">nil</span>&nbsp;<span class="op" id="7711672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7711676">t</span><span class="op" id="7711677">.</span><span class="ident" id="7711678">Fatal</span><span class="op" id="7711683">(</span><span class="string" id="7711684">&#34;reader:&#34;</span><span class="op" id="7711693">,</span>&nbsp;<span class="ident" id="7711695">err</span><span class="op" id="7711698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7711701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7711704">f0</span>&nbsp;<span class="op" id="7711707">:=</span>&nbsp;<span class="ident" id="7711710">r</span><span class="op" id="7711711">.</span><span class="ident" id="7711712">File</span><span class="op" id="7711716">[</span><span class="num" id="7711717">0</span><span class="op" id="7711718">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7711721">rc</span><span class="op" id="7711723">,</span>&nbsp;<span class="ident" id="7711725">err</span>&nbsp;<span class="op" id="7711729">:=</span>&nbsp;<span class="ident" id="7711732">f0</span><span class="op" id="7711734">.</span><span class="ident" id="7711735">Open</span><span class="op" id="7711739">(</span><span class="op" id="7711740">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7711743">if</span>&nbsp;<span class="ident" id="7711746">err</span>&nbsp;<span class="op" id="7711750">!=</span>&nbsp;<span class="ident" id="7711753">nil</span>&nbsp;<span class="op" id="7711757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7711761">t</span><span class="op" id="7711762">.</span><span class="ident" id="7711763">Fatal</span><span class="op" id="7711768">(</span><span class="string" id="7711769">&#34;opening:&#34;</span><span class="op" id="7711779">,</span>&nbsp;<span class="ident" id="7711781">err</span><span class="op" id="7711784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7711787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7711790">rc</span><span class="op" id="7711792">.</span><span class="op" id="7711793">(</span><span class="op" id="7711794">*</span><span class="ident" id="7711795">checksumReader</span><span class="op" id="7711809">)</span><span class="op" id="7711810">.</span><span class="ident" id="7711811">hash</span>&nbsp;<span class="op" id="7711816">=</span>&nbsp;<span class="ident" id="7711818">fakeHash32</span><span class="op" id="7711828">{</span><span class="op" id="7711829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7711832">for</span>&nbsp;<span class="ident" id="7711836">i</span>&nbsp;<span class="op" id="7711838">:=</span>&nbsp;<span class="num" id="7711841">0</span><span class="op" id="7711842">;</span>&nbsp;<span class="ident" id="7711844">i</span>&nbsp;<span class="op" id="7711846">&lt;</span>&nbsp;<span class="ident" id="7711848">chunks</span><span class="op" id="7711854">;</span>&nbsp;<span class="ident" id="7711856">i</span><span class="op" id="7711857">++</span>&nbsp;<span class="op" id="7711860">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7711864">_</span><span class="op" id="7711865">,</span>&nbsp;<span class="ident" id="7711867">err</span>&nbsp;<span class="op" id="7711871">:=</span>&nbsp;<span class="ident" id="7711874">io</span><span class="op" id="7711876">.</span><span class="ident" id="7711877">ReadFull</span><span class="op" id="7711885">(</span><span class="ident" id="7711886">rc</span><span class="op" id="7711888">,</span>&nbsp;<span class="ident" id="7711890">chunk</span><span class="op" id="7711895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7711899">if</span>&nbsp;<span class="ident" id="7711902">err</span>&nbsp;<span class="op" id="7711906">!=</span>&nbsp;<span class="ident" id="7711909">nil</span>&nbsp;<span class="op" id="7711913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7711918">t</span><span class="op" id="7711919">.</span><span class="ident" id="7711920">Fatal</span><span class="op" id="7711925">(</span><span class="string" id="7711926">&#34;read:&#34;</span><span class="op" id="7711933">,</span>&nbsp;<span class="ident" id="7711935">err</span><span class="op" id="7711938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7711942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7711945">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7711948">gotEnd</span><span class="op" id="7711954">,</span>&nbsp;<span class="ident" id="7711956">err</span>&nbsp;<span class="op" id="7711960">:=</span>&nbsp;<span class="ident" id="7711963">ioutil</span><span class="op" id="7711969">.</span><span class="ident" id="7711970">ReadAll</span><span class="op" id="7711977">(</span><span class="ident" id="7711978">rc</span><span class="op" id="7711980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7711983">if</span>&nbsp;<span class="ident" id="7711986">err</span>&nbsp;<span class="op" id="7711990">!=</span>&nbsp;<span class="ident" id="7711993">nil</span>&nbsp;<span class="op" id="7711997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7712001">t</span><span class="op" id="7712002">.</span><span class="ident" id="7712003">Fatal</span><span class="op" id="7712008">(</span><span class="string" id="7712009">&#34;read&nbsp;end:&#34;</span><span class="op" id="7712020">,</span>&nbsp;<span class="ident" id="7712022">err</span><span class="op" id="7712025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7712028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7712031">if</span>&nbsp;<span class="op" id="7712034">!</span><span class="ident" id="7712035">bytes</span><span class="op" id="7712040">.</span><span class="ident" id="7712041">Equal</span><span class="op" id="7712046">(</span><span class="ident" id="7712047">gotEnd</span><span class="op" id="7712053">,</span>&nbsp;<span class="ident" id="7712055">end</span><span class="op" id="7712058">)</span>&nbsp;<span class="op" id="7712060">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7712064">t</span><span class="op" id="7712065">.</span><span class="ident" id="7712066">Errorf</span><span class="op" id="7712072">(</span><span class="string" id="7712073">&#34;End&nbsp;of&nbsp;zip64&nbsp;archive&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7712107">,</span>&nbsp;<span class="ident" id="7712109">gotEnd</span><span class="op" id="7712115">,</span>&nbsp;<span class="ident" id="7712117">end</span><span class="op" id="7712120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7712123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7712126">err</span>&nbsp;<span class="op" id="7712130">=</span>&nbsp;<span class="ident" id="7712132">rc</span><span class="op" id="7712134">.</span><span class="ident" id="7712135">Close</span><span class="op" id="7712140">(</span><span class="op" id="7712141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7712144">if</span>&nbsp;<span class="ident" id="7712147">err</span>&nbsp;<span class="op" id="7712151">!=</span>&nbsp;<span class="ident" id="7712154">nil</span>&nbsp;<span class="op" id="7712158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7712162">t</span><span class="op" id="7712163">.</span><span class="ident" id="7712164">Fatal</span><span class="op" id="7712169">(</span><span class="string" id="7712170">&#34;closing:&#34;</span><span class="op" id="7712180">,</span>&nbsp;<span class="ident" id="7712182">err</span><span class="op" id="7712185">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7712188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7712191">if</span>&nbsp;<span class="ident" id="7712194">size</span>&nbsp;<span class="op" id="7712199">==</span>&nbsp;<span class="num" id="7712202">1</span><span class="op" id="7712203">&lt;&lt;</span><span class="num" id="7712205">32</span>&nbsp;<span class="op" id="7712208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7712212">if</span>&nbsp;<span class="ident" id="7712215">got</span><span class="op" id="7712218">,</span>&nbsp;<span class="ident" id="7712220">want</span>&nbsp;<span class="op" id="7712225">:=</span>&nbsp;<span class="ident" id="7712228">f0</span><span class="op" id="7712230">.</span><span class="ident" id="7712231">UncompressedSize</span><span class="op" id="7712247">,</span>&nbsp;<span class="builtintype" id="7712249">uint32</span><span class="op" id="7712255">(</span><span class="ident" id="7712256">uint32max</span><span class="op" id="7712265">)</span><span class="op" id="7712266">;</span>&nbsp;<span class="ident" id="7712268">got</span>&nbsp;<span class="op" id="7712272">!=</span>&nbsp;<span class="ident" id="7712275">want</span>&nbsp;<span class="op" id="7712280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7712285">t</span><span class="op" id="7712286">.</span><span class="ident" id="7712287">Errorf</span><span class="op" id="7712293">(</span><span class="string" id="7712294">&#34;UncompressedSize&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7712324">,</span>&nbsp;<span class="ident" id="7712326">got</span><span class="op" id="7712329">,</span>&nbsp;<span class="ident" id="7712331">want</span><span class="op" id="7712335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7712339">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7712342">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7712346">if</span>&nbsp;<span class="ident" id="7712349">got</span><span class="op" id="7712352">,</span>&nbsp;<span class="ident" id="7712354">want</span>&nbsp;<span class="op" id="7712359">:=</span>&nbsp;<span class="ident" id="7712362">f0</span><span class="op" id="7712364">.</span><span class="ident" id="7712365">UncompressedSize64</span><span class="op" id="7712383">,</span>&nbsp;<span class="ident" id="7712385">uint64</span><span class="op" id="7712391">(</span><span class="ident" id="7712392">size</span><span class="op" id="7712396">)</span><span class="op" id="7712397">+</span><span class="ident" id="7712398">uint64</span><span class="op" id="7712404">(</span><span class="builtinfunc" id="7712405">len</span><span class="op" id="7712408">(</span><span class="ident" id="7712409">end</span><span class="op" id="7712412">)</span><span class="op" id="7712413">)</span><span class="op" id="7712414">;</span>&nbsp;<span class="ident" id="7712416">got</span>&nbsp;<span class="op" id="7712420">!=</span>&nbsp;<span class="ident" id="7712423">want</span>&nbsp;<span class="op" id="7712428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7712432">t</span><span class="op" id="7712433">.</span><span class="ident" id="7712434">Errorf</span><span class="op" id="7712440">(</span><span class="string" id="7712441">&#34;UncompressedSize64&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7712473">,</span>&nbsp;<span class="ident" id="7712475">got</span><span class="op" id="7712478">,</span>&nbsp;<span class="ident" id="7712480">want</span><span class="op" id="7712484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7712487">}</span><br>
<span class="lineno">305</span><span class="op" id="7712489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7712492">func</span>&nbsp;<span class="ident" id="7712497">testInvalidHeader</span><span class="op" id="7712514">(</span><span class="ident" id="7712515">h</span>&nbsp;<span class="op" id="7712517">*</span><span class="ident" id="7712518">FileHeader</span><span class="op" id="7712528">,</span>&nbsp;<span class="ident" id="7712530">t</span>&nbsp;<span class="op" id="7712532">*</span><span class="ident" id="7712533">testing</span><span class="op" id="7712540">.</span><span class="ident" id="7712541">T</span><span class="op" id="7712542">)</span>&nbsp;<span class="op" id="7712544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7712547">var</span>&nbsp;<span class="ident" id="7712551">buf</span>&nbsp;<span class="ident" id="7712555">bytes</span><span class="op" id="7712560">.</span><span class="ident" id="7712561">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7712569">z</span>&nbsp;<span class="op" id="7712571">:=</span>&nbsp;<span class="ident" id="7712574">NewWriter</span><span class="op" id="7712583">(</span><span class="op" id="7712584">&amp;</span><span class="ident" id="7712585">buf</span><span class="op" id="7712588">)</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7712592">f</span><span class="op" id="7712593">,</span>&nbsp;<span class="ident" id="7712595">err</span>&nbsp;<span class="op" id="7712599">:=</span>&nbsp;<span class="ident" id="7712602">z</span><span class="op" id="7712603">.</span><span class="ident" id="7712604">CreateHeader</span><span class="op" id="7712616">(</span><span class="ident" id="7712617">h</span><span class="op" id="7712618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7712621">if</span>&nbsp;<span class="ident" id="7712624">err</span>&nbsp;<span class="op" id="7712628">!=</span>&nbsp;<span class="ident" id="7712631">nil</span>&nbsp;<span class="op" id="7712635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7712639">t</span><span class="op" id="7712640">.</span><span class="ident" id="7712641">Fatalf</span><span class="op" id="7712647">(</span><span class="string" id="7712648">&#34;error&nbsp;creating&nbsp;header:&nbsp;%v&#34;</span><span class="op" id="7712675">,</span>&nbsp;<span class="ident" id="7712677">err</span><span class="op" id="7712680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7712683">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7712686">if</span>&nbsp;<span class="ident" id="7712689">_</span><span class="op" id="7712690">,</span>&nbsp;<span class="ident" id="7712692">err</span>&nbsp;<span class="op" id="7712696">:=</span>&nbsp;<span class="ident" id="7712699">f</span><span class="op" id="7712700">.</span><span class="ident" id="7712701">Write</span><span class="op" id="7712706">(</span><span class="op" id="7712707">[</span><span class="op" id="7712708">]</span><span class="builtintype" id="7712709">byte</span><span class="op" id="7712713">(</span><span class="string" id="7712714">&#34;hi&#34;</span><span class="op" id="7712718">)</span><span class="op" id="7712719">)</span><span class="op" id="7712720">;</span>&nbsp;<span class="ident" id="7712722">err</span>&nbsp;<span class="op" id="7712726">!=</span>&nbsp;<span class="ident" id="7712729">nil</span>&nbsp;<span class="op" id="7712733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7712737">t</span><span class="op" id="7712738">.</span><span class="ident" id="7712739">Fatalf</span><span class="op" id="7712745">(</span><span class="string" id="7712746">&#34;error&nbsp;writing&nbsp;content:&nbsp;%v&#34;</span><span class="op" id="7712773">,</span>&nbsp;<span class="ident" id="7712775">err</span><span class="op" id="7712778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7712781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7712784">if</span>&nbsp;<span class="ident" id="7712787">err</span>&nbsp;<span class="op" id="7712791">:=</span>&nbsp;<span class="ident" id="7712794">z</span><span class="op" id="7712795">.</span><span class="ident" id="7712796">Close</span><span class="op" id="7712801">(</span><span class="op" id="7712802">)</span><span class="op" id="7712803">;</span>&nbsp;<span class="ident" id="7712805">err</span>&nbsp;<span class="op" id="7712809">!=</span>&nbsp;<span class="ident" id="7712812">nil</span>&nbsp;<span class="op" id="7712816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7712820">t</span><span class="op" id="7712821">.</span><span class="ident" id="7712822">Fatalf</span><span class="op" id="7712828">(</span><span class="string" id="7712829">&#34;error&nbsp;closing&nbsp;zip&nbsp;writer:&nbsp;%v&#34;</span><span class="op" id="7712859">,</span>&nbsp;<span class="ident" id="7712861">err</span><span class="op" id="7712864">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7712867">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7712871">b</span>&nbsp;<span class="op" id="7712873">:=</span>&nbsp;<span class="ident" id="7712876">buf</span><span class="op" id="7712879">.</span><span class="ident" id="7712880">Bytes</span><span class="op" id="7712885">(</span><span class="op" id="7712886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7712889">if</span>&nbsp;<span class="ident" id="7712892">_</span><span class="op" id="7712893">,</span>&nbsp;<span class="ident" id="7712895">err</span>&nbsp;<span class="op" id="7712899">=</span>&nbsp;<span class="ident" id="7712901">NewReader</span><span class="op" id="7712910">(</span><span class="ident" id="7712911">bytes</span><span class="op" id="7712916">.</span><span class="ident" id="7712917">NewReader</span><span class="op" id="7712926">(</span><span class="ident" id="7712927">b</span><span class="op" id="7712928">)</span><span class="op" id="7712929">,</span>&nbsp;<span class="ident" id="7712931">int64</span><span class="op" id="7712936">(</span><span class="builtinfunc" id="7712937">len</span><span class="op" id="7712940">(</span><span class="ident" id="7712941">b</span><span class="op" id="7712942">)</span><span class="op" id="7712943">)</span><span class="op" id="7712944">)</span><span class="op" id="7712945">;</span>&nbsp;<span class="ident" id="7712947">err</span>&nbsp;<span class="op" id="7712951">!=</span>&nbsp;<span class="ident" id="7712954">ErrFormat</span>&nbsp;<span class="op" id="7712964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7712968">t</span><span class="op" id="7712969">.</span><span class="ident" id="7712970">Fatalf</span><span class="op" id="7712976">(</span><span class="string" id="7712977">&#34;got&nbsp;%v,&nbsp;expected&nbsp;ErrFormat&#34;</span><span class="op" id="7713005">,</span>&nbsp;<span class="ident" id="7713007">err</span><span class="op" id="7713010">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7713013">}</span><br>
<span class="lineno"></span><span class="op" id="7713015">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7713018">func</span>&nbsp;<span class="ident" id="7713023">testValidHeader</span><span class="op" id="7713038">(</span><span class="ident" id="7713039">h</span>&nbsp;<span class="op" id="7713041">*</span><span class="ident" id="7713042">FileHeader</span><span class="op" id="7713052">,</span>&nbsp;<span class="ident" id="7713054">t</span>&nbsp;<span class="op" id="7713056">*</span><span class="ident" id="7713057">testing</span><span class="op" id="7713064">.</span><span class="ident" id="7713065">T</span><span class="op" id="7713066">)</span>&nbsp;<span class="op" id="7713068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7713071">var</span>&nbsp;<span class="ident" id="7713075">buf</span>&nbsp;<span class="ident" id="7713079">bytes</span><span class="op" id="7713084">.</span><span class="ident" id="7713085">Buffer</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7713093">z</span>&nbsp;<span class="op" id="7713095">:=</span>&nbsp;<span class="ident" id="7713098">NewWriter</span><span class="op" id="7713107">(</span><span class="op" id="7713108">&amp;</span><span class="ident" id="7713109">buf</span><span class="op" id="7713112">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7713116">f</span><span class="op" id="7713117">,</span>&nbsp;<span class="ident" id="7713119">err</span>&nbsp;<span class="op" id="7713123">:=</span>&nbsp;<span class="ident" id="7713126">z</span><span class="op" id="7713127">.</span><span class="ident" id="7713128">CreateHeader</span><span class="op" id="7713140">(</span><span class="ident" id="7713141">h</span><span class="op" id="7713142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7713145">if</span>&nbsp;<span class="ident" id="7713148">err</span>&nbsp;<span class="op" id="7713152">!=</span>&nbsp;<span class="ident" id="7713155">nil</span>&nbsp;<span class="op" id="7713159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7713163">t</span><span class="op" id="7713164">.</span><span class="ident" id="7713165">Fatalf</span><span class="op" id="7713171">(</span><span class="string" id="7713172">&#34;error&nbsp;creating&nbsp;header:&nbsp;%v&#34;</span><span class="op" id="7713199">,</span>&nbsp;<span class="ident" id="7713201">err</span><span class="op" id="7713204">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7713207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7713210">if</span>&nbsp;<span class="ident" id="7713213">_</span><span class="op" id="7713214">,</span>&nbsp;<span class="ident" id="7713216">err</span>&nbsp;<span class="op" id="7713220">:=</span>&nbsp;<span class="ident" id="7713223">f</span><span class="op" id="7713224">.</span><span class="ident" id="7713225">Write</span><span class="op" id="7713230">(</span><span class="op" id="7713231">[</span><span class="op" id="7713232">]</span><span class="builtintype" id="7713233">byte</span><span class="op" id="7713237">(</span><span class="string" id="7713238">&#34;hi&#34;</span><span class="op" id="7713242">)</span><span class="op" id="7713243">)</span><span class="op" id="7713244">;</span>&nbsp;<span class="ident" id="7713246">err</span>&nbsp;<span class="op" id="7713250">!=</span>&nbsp;<span class="ident" id="7713253">nil</span>&nbsp;<span class="op" id="7713257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7713261">t</span><span class="op" id="7713262">.</span><span class="ident" id="7713263">Fatalf</span><span class="op" id="7713269">(</span><span class="string" id="7713270">&#34;error&nbsp;writing&nbsp;content:&nbsp;%v&#34;</span><span class="op" id="7713297">,</span>&nbsp;<span class="ident" id="7713299">err</span><span class="op" id="7713302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7713305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7713308">if</span>&nbsp;<span class="ident" id="7713311">err</span>&nbsp;<span class="op" id="7713315">:=</span>&nbsp;<span class="ident" id="7713318">z</span><span class="op" id="7713319">.</span><span class="ident" id="7713320">Close</span><span class="op" id="7713325">(</span><span class="op" id="7713326">)</span><span class="op" id="7713327">;</span>&nbsp;<span class="ident" id="7713329">err</span>&nbsp;<span class="op" id="7713333">!=</span>&nbsp;<span class="ident" id="7713336">nil</span>&nbsp;<span class="op" id="7713340">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7713344">t</span><span class="op" id="7713345">.</span><span class="ident" id="7713346">Fatalf</span><span class="op" id="7713352">(</span><span class="string" id="7713353">&#34;error&nbsp;closing&nbsp;zip&nbsp;writer:&nbsp;%v&#34;</span><span class="op" id="7713383">,</span>&nbsp;<span class="ident" id="7713385">err</span><span class="op" id="7713388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7713391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7713395">b</span>&nbsp;<span class="op" id="7713397">:=</span>&nbsp;<span class="ident" id="7713400">buf</span><span class="op" id="7713403">.</span><span class="ident" id="7713404">Bytes</span><span class="op" id="7713409">(</span><span class="op" id="7713410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7713413">if</span>&nbsp;<span class="ident" id="7713416">_</span><span class="op" id="7713417">,</span>&nbsp;<span class="ident" id="7713419">err</span>&nbsp;<span class="op" id="7713423">=</span>&nbsp;<span class="ident" id="7713425">NewReader</span><span class="op" id="7713434">(</span><span class="ident" id="7713435">bytes</span><span class="op" id="7713440">.</span><span class="ident" id="7713441">NewReader</span><span class="op" id="7713450">(</span><span class="ident" id="7713451">b</span><span class="op" id="7713452">)</span><span class="op" id="7713453">,</span>&nbsp;<span class="ident" id="7713455">int64</span><span class="op" id="7713460">(</span><span class="builtinfunc" id="7713461">len</span><span class="op" id="7713464">(</span><span class="ident" id="7713465">b</span><span class="op" id="7713466">)</span><span class="op" id="7713467">)</span><span class="op" id="7713468">)</span><span class="op" id="7713469">;</span>&nbsp;<span class="ident" id="7713471">err</span>&nbsp;<span class="op" id="7713475">!=</span>&nbsp;<span class="ident" id="7713478">nil</span>&nbsp;<span class="op" id="7713482">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7713486">t</span><span class="op" id="7713487">.</span><span class="ident" id="7713488">Fatalf</span><span class="op" id="7713494">(</span><span class="string" id="7713495">&#34;got&nbsp;%v,&nbsp;expected&nbsp;nil&#34;</span><span class="op" id="7713517">,</span>&nbsp;<span class="ident" id="7713519">err</span><span class="op" id="7713522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7713525">}</span><br>
<span class="lineno"></span><span class="op" id="7713527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7713530">//&nbsp;Issue&nbsp;4302.</span><br>
<span class="lineno">350</span><span class="keyword" id="7713545">func</span>&nbsp;<span class="ident" id="7713550">TestHeaderInvalidTagAndSize</span><span class="op" id="7713577">(</span><span class="ident" id="7713578">t</span>&nbsp;<span class="op" id="7713580">*</span><span class="ident" id="7713581">testing</span><span class="op" id="7713588">.</span><span class="ident" id="7713589">T</span><span class="op" id="7713590">)</span>&nbsp;<span class="op" id="7713592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7713595">const</span>&nbsp;<span class="ident" id="7713601">timeFormat</span>&nbsp;<span class="op" id="7713612">=</span>&nbsp;<span class="string" id="7713614">&#34;20060102T150405.000.txt&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7713642">ts</span>&nbsp;<span class="op" id="7713645">:=</span>&nbsp;<span class="ident" id="7713648">time</span><span class="op" id="7713652">.</span><span class="ident" id="7713653">Now</span><span class="op" id="7713656">(</span><span class="op" id="7713657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7713660">filename</span>&nbsp;<span class="op" id="7713669">:=</span>&nbsp;<span class="ident" id="7713672">ts</span><span class="op" id="7713674">.</span><span class="ident" id="7713675">Format</span><span class="op" id="7713681">(</span><span class="ident" id="7713682">timeFormat</span><span class="op" id="7713692">)</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7713696">h</span>&nbsp;<span class="op" id="7713698">:=</span>&nbsp;<span class="ident" id="7713701">FileHeader</span><span class="op" id="7713711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7713715">Name</span><span class="op" id="7713719">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7713723">filename</span><span class="op" id="7713731">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7713735">Method</span><span class="op" id="7713741">:</span>&nbsp;<span class="ident" id="7713743">Deflate</span><span class="op" id="7713750">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7713754">Extra</span><span class="op" id="7713759">:</span>&nbsp;&nbsp;<span class="op" id="7713762">[</span><span class="op" id="7713763">]</span><span class="builtintype" id="7713764">byte</span><span class="op" id="7713768">(</span><span class="ident" id="7713769">ts</span><span class="op" id="7713771">.</span><span class="ident" id="7713772">Format</span><span class="op" id="7713778">(</span><span class="ident" id="7713779">time</span><span class="op" id="7713783">.</span><span class="ident" id="7713784">RFC3339Nano</span><span class="op" id="7713795">)</span><span class="op" id="7713796">)</span><span class="op" id="7713797">,</span>&nbsp;<span class="comment" id="7713799">//&nbsp;missing&nbsp;tag&nbsp;and&nbsp;len</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7713823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7713826">h</span><span class="op" id="7713827">.</span><span class="ident" id="7713828">SetModTime</span><span class="op" id="7713838">(</span><span class="ident" id="7713839">ts</span><span class="op" id="7713841">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7713845">testInvalidHeader</span><span class="op" id="7713862">(</span><span class="op" id="7713863">&amp;</span><span class="ident" id="7713864">h</span><span class="op" id="7713865">,</span>&nbsp;<span class="ident" id="7713867">t</span><span class="op" id="7713868">)</span><br>
<span class="lineno"></span><span class="op" id="7713870">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="7713873">func</span>&nbsp;<span class="ident" id="7713878">TestHeaderTooShort</span><span class="op" id="7713896">(</span><span class="ident" id="7713897">t</span>&nbsp;<span class="op" id="7713899">*</span><span class="ident" id="7713900">testing</span><span class="op" id="7713907">.</span><span class="ident" id="7713908">T</span><span class="op" id="7713909">)</span>&nbsp;<span class="op" id="7713911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7713914">h</span>&nbsp;<span class="op" id="7713916">:=</span>&nbsp;<span class="ident" id="7713919">FileHeader</span><span class="op" id="7713929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7713933">Name</span><span class="op" id="7713937">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7713941">&#34;foo.txt&#34;</span><span class="op" id="7713950">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7713954">Method</span><span class="op" id="7713960">:</span>&nbsp;<span class="ident" id="7713962">Deflate</span><span class="op" id="7713969">,</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7713973">Extra</span><span class="op" id="7713978">:</span>&nbsp;&nbsp;<span class="op" id="7713981">[</span><span class="op" id="7713982">]</span><span class="builtintype" id="7713983">byte</span><span class="op" id="7713987">{</span><span class="ident" id="7713988">zip64ExtraId</span><span class="op" id="7714000">}</span><span class="op" id="7714001">,</span>&nbsp;<span class="comment" id="7714003">//&nbsp;missing&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7714020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7714023">testInvalidHeader</span><span class="op" id="7714040">(</span><span class="op" id="7714041">&amp;</span><span class="ident" id="7714042">h</span><span class="op" id="7714043">,</span>&nbsp;<span class="ident" id="7714045">t</span><span class="op" id="7714046">)</span><br>
<span class="lineno"></span><span class="op" id="7714048">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span><span class="comment" id="7714051">//&nbsp;Issue&nbsp;4393.&nbsp;It&nbsp;is&nbsp;valid&nbsp;to&nbsp;have&nbsp;an&nbsp;extra&nbsp;data&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="7714107">//&nbsp;which&nbsp;contains&nbsp;no&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="7714134">func</span>&nbsp;<span class="ident" id="7714139">TestZeroLengthHeader</span><span class="op" id="7714159">(</span><span class="ident" id="7714160">t</span>&nbsp;<span class="op" id="7714162">*</span><span class="ident" id="7714163">testing</span><span class="op" id="7714170">.</span><span class="ident" id="7714171">T</span><span class="op" id="7714172">)</span>&nbsp;<span class="op" id="7714174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7714177">h</span>&nbsp;<span class="op" id="7714179">:=</span>&nbsp;<span class="ident" id="7714182">FileHeader</span><span class="op" id="7714192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7714196">Name</span><span class="op" id="7714200">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7714204">&#34;extadata.txt&#34;</span><span class="op" id="7714218">,</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7714222">Method</span><span class="op" id="7714228">:</span>&nbsp;<span class="ident" id="7714230">Deflate</span><span class="op" id="7714237">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7714241">Extra</span><span class="op" id="7714246">:</span>&nbsp;<span class="op" id="7714248">[</span><span class="op" id="7714249">]</span><span class="builtintype" id="7714250">byte</span><span class="op" id="7714254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7714259">85</span><span class="op" id="7714261">,</span>&nbsp;<span class="num" id="7714263">84</span><span class="op" id="7714265">,</span>&nbsp;<span class="num" id="7714267">5</span><span class="op" id="7714268">,</span>&nbsp;<span class="num" id="7714270">0</span><span class="op" id="7714271">,</span>&nbsp;<span class="num" id="7714273">3</span><span class="op" id="7714274">,</span>&nbsp;<span class="num" id="7714276">154</span><span class="op" id="7714279">,</span>&nbsp;<span class="num" id="7714281">144</span><span class="op" id="7714284">,</span>&nbsp;<span class="num" id="7714286">195</span><span class="op" id="7714289">,</span>&nbsp;<span class="num" id="7714291">77</span><span class="op" id="7714293">,</span>&nbsp;<span class="comment" id="7714295">//&nbsp;tag&nbsp;21589&nbsp;size&nbsp;5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7714318">85</span><span class="op" id="7714320">,</span>&nbsp;<span class="num" id="7714322">120</span><span class="op" id="7714325">,</span>&nbsp;<span class="num" id="7714327">0</span><span class="op" id="7714328">,</span>&nbsp;<span class="num" id="7714330">0</span><span class="op" id="7714331">,</span>&nbsp;<span class="comment" id="7714333">//&nbsp;tag&nbsp;30805&nbsp;size&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7714355">}</span><span class="op" id="7714356">,</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7714359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7714362">testValidHeader</span><span class="op" id="7714377">(</span><span class="op" id="7714378">&amp;</span><span class="ident" id="7714379">h</span><span class="op" id="7714380">,</span>&nbsp;<span class="ident" id="7714382">t</span><span class="op" id="7714383">)</span><br>
<span class="lineno"></span><span class="op" id="7714385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7714388">//&nbsp;Just&nbsp;benchmarking&nbsp;how&nbsp;fast&nbsp;the&nbsp;Zip64&nbsp;test&nbsp;above&nbsp;is.&nbsp;Not&nbsp;related&nbsp;to</span><br>
<span class="lineno">390</span><span class="comment" id="7714458">//&nbsp;our&nbsp;zip&nbsp;performance,&nbsp;since&nbsp;the&nbsp;test&nbsp;above&nbsp;disabled&nbsp;CRC32&nbsp;and&nbsp;flate.</span><br>
<span class="lineno"></span><span class="keyword" id="7714529">func</span>&nbsp;<span class="ident" id="7714534">BenchmarkZip64Test</span><span class="op" id="7714552">(</span><span class="ident" id="7714553">b</span>&nbsp;<span class="op" id="7714555">*</span><span class="ident" id="7714556">testing</span><span class="op" id="7714563">.</span><span class="ident" id="7714564">B</span><span class="op" id="7714565">)</span>&nbsp;<span class="op" id="7714567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7714570">for</span>&nbsp;<span class="ident" id="7714574">i</span>&nbsp;<span class="op" id="7714576">:=</span>&nbsp;<span class="num" id="7714579">0</span><span class="op" id="7714580">;</span>&nbsp;<span class="ident" id="7714582">i</span>&nbsp;<span class="op" id="7714584">&lt;</span>&nbsp;<span class="ident" id="7714586">b</span><span class="op" id="7714587">.</span><span class="ident" id="7714588">N</span><span class="op" id="7714589">;</span>&nbsp;<span class="ident" id="7714591">i</span><span class="op" id="7714592">++</span>&nbsp;<span class="op" id="7714595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7714599">testZip64</span><span class="op" id="7714608">(</span><span class="ident" id="7714609">b</span><span class="op" id="7714610">,</span>&nbsp;<span class="num" id="7714612">1</span><span class="op" id="7714613">&lt;&lt;</span><span class="num" id="7714615">26</span><span class="op" id="7714617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7714620">}</span><br>
<span class="lineno">395</span><span class="op" id="7714622">}</span>
</div>
</body>
</html>
