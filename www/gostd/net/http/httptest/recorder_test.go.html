<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/httptest</h2>
<ul>
<li><a href="/gostd/net/http/httptest/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/httptest/recorder.go.html">recorder.go</a></li>
<li><a href="/gostd/net/http/httptest/recorder_test.go.html" class="current">recorder_test.go</a></li>
<li><a href="/gostd/net/http/httptest/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/httptest/server_test.go.html">server_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7738139">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7738194">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7738248">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7738299">package</span>&nbsp;<span class="ident" id="7738307">httptest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7738317">import</span>&nbsp;<span class="op" id="7738324">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7738327">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7738334">&#34;net/http&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7738346">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7738356">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7738359">func</span>&nbsp;<span class="ident" id="7738364">TestRecorder</span><span class="op" id="7738376">(</span><span class="ident" id="7738377">t</span>&nbsp;<span class="op" id="7738379">*</span><span class="ident" id="7738380">testing</span><span class="op" id="7738387">.</span><span class="ident" id="7738388">T</span><span class="op" id="7738389">)</span>&nbsp;<span class="op" id="7738391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7738394">type</span>&nbsp;<span class="ident" id="7738399">checkFunc</span>&nbsp;<span class="keyword" id="7738409">func</span><span class="op" id="7738413">(</span><span class="op" id="7738414">*</span><span class="ident" id="7738415">ResponseRecorder</span><span class="op" id="7738431">)</span>&nbsp;<span class="builtintype" id="7738433">error</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7738440">check</span>&nbsp;<span class="op" id="7738446">:=</span>&nbsp;<span class="keyword" id="7738449">func</span><span class="op" id="7738453">(</span><span class="ident" id="7738454">fns</span>&nbsp;<span class="op" id="7738458">...</span><span class="ident" id="7738461">checkFunc</span><span class="op" id="7738470">)</span>&nbsp;<span class="op" id="7738472">[</span><span class="op" id="7738473">]</span><span class="ident" id="7738474">checkFunc</span>&nbsp;<span class="op" id="7738484">{</span>&nbsp;<span class="keyword" id="7738486">return</span>&nbsp;<span class="ident" id="7738493">fns</span>&nbsp;<span class="op" id="7738497">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7738501">hasStatus</span>&nbsp;<span class="op" id="7738511">:=</span>&nbsp;<span class="keyword" id="7738514">func</span><span class="op" id="7738518">(</span><span class="ident" id="7738519">wantCode</span>&nbsp;<span class="builtintype" id="7738528">int</span><span class="op" id="7738531">)</span>&nbsp;<span class="ident" id="7738533">checkFunc</span>&nbsp;<span class="op" id="7738543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7738547">return</span>&nbsp;<span class="keyword" id="7738554">func</span><span class="op" id="7738558">(</span><span class="ident" id="7738559">rec</span>&nbsp;<span class="op" id="7738563">*</span><span class="ident" id="7738564">ResponseRecorder</span><span class="op" id="7738580">)</span>&nbsp;<span class="builtintype" id="7738582">error</span>&nbsp;<span class="op" id="7738588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7738593">if</span>&nbsp;<span class="ident" id="7738596">rec</span><span class="op" id="7738599">.</span><span class="ident" id="7738600">Code</span>&nbsp;<span class="op" id="7738605">!=</span>&nbsp;<span class="ident" id="7738608">wantCode</span>&nbsp;<span class="op" id="7738617">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7738623">return</span>&nbsp;<span class="ident" id="7738630">fmt</span><span class="op" id="7738633">.</span><span class="ident" id="7738634">Errorf</span><span class="op" id="7738640">(</span><span class="string" id="7738641">&#34;Status&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7738663">,</span>&nbsp;<span class="ident" id="7738665">rec</span><span class="op" id="7738668">.</span><span class="ident" id="7738669">Code</span><span class="op" id="7738673">,</span>&nbsp;<span class="ident" id="7738675">wantCode</span><span class="op" id="7738683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7738688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7738693">return</span>&nbsp;<span class="builtintype" id="7738700">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7738706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7738709">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7738712">hasContents</span>&nbsp;<span class="op" id="7738724">:=</span>&nbsp;<span class="keyword" id="7738727">func</span><span class="op" id="7738731">(</span><span class="ident" id="7738732">want</span>&nbsp;<span class="builtintype" id="7738737">string</span><span class="op" id="7738743">)</span>&nbsp;<span class="ident" id="7738745">checkFunc</span>&nbsp;<span class="op" id="7738755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7738759">return</span>&nbsp;<span class="keyword" id="7738766">func</span><span class="op" id="7738770">(</span><span class="ident" id="7738771">rec</span>&nbsp;<span class="op" id="7738775">*</span><span class="ident" id="7738776">ResponseRecorder</span><span class="op" id="7738792">)</span>&nbsp;<span class="builtintype" id="7738794">error</span>&nbsp;<span class="op" id="7738800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7738805">if</span>&nbsp;<span class="ident" id="7738808">rec</span><span class="op" id="7738811">.</span><span class="ident" id="7738812">Body</span><span class="op" id="7738816">.</span><span class="ident" id="7738817">String</span><span class="op" id="7738823">(</span><span class="op" id="7738824">)</span>&nbsp;<span class="op" id="7738826">!=</span>&nbsp;<span class="ident" id="7738829">want</span>&nbsp;<span class="op" id="7738834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7738840">return</span>&nbsp;<span class="ident" id="7738847">fmt</span><span class="op" id="7738850">.</span><span class="ident" id="7738851">Errorf</span><span class="op" id="7738857">(</span><span class="string" id="7738858">&#34;wrote&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7738879">,</span>&nbsp;<span class="ident" id="7738881">rec</span><span class="op" id="7738884">.</span><span class="ident" id="7738885">Body</span><span class="op" id="7738889">.</span><span class="ident" id="7738890">String</span><span class="op" id="7738896">(</span><span class="op" id="7738897">)</span><span class="op" id="7738898">,</span>&nbsp;<span class="ident" id="7738900">want</span><span class="op" id="7738904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7738909">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7738914">return</span>&nbsp;<span class="builtintype" id="7738921">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7738927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7738930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7738933">hasFlush</span>&nbsp;<span class="op" id="7738942">:=</span>&nbsp;<span class="keyword" id="7738945">func</span><span class="op" id="7738949">(</span><span class="ident" id="7738950">want</span>&nbsp;<span class="builtintype" id="7738955">bool</span><span class="op" id="7738959">)</span>&nbsp;<span class="ident" id="7738961">checkFunc</span>&nbsp;<span class="op" id="7738971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7738975">return</span>&nbsp;<span class="keyword" id="7738982">func</span><span class="op" id="7738986">(</span><span class="ident" id="7738987">rec</span>&nbsp;<span class="op" id="7738991">*</span><span class="ident" id="7738992">ResponseRecorder</span><span class="op" id="7739008">)</span>&nbsp;<span class="builtintype" id="7739010">error</span>&nbsp;<span class="op" id="7739016">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7739021">if</span>&nbsp;<span class="ident" id="7739024">rec</span><span class="op" id="7739027">.</span><span class="ident" id="7739028">Flushed</span>&nbsp;<span class="op" id="7739036">!=</span>&nbsp;<span class="ident" id="7739039">want</span>&nbsp;<span class="op" id="7739044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7739050">return</span>&nbsp;<span class="ident" id="7739057">fmt</span><span class="op" id="7739060">.</span><span class="ident" id="7739061">Errorf</span><span class="op" id="7739067">(</span><span class="string" id="7739068">&#34;Flushed&nbsp;=&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7739091">,</span>&nbsp;<span class="ident" id="7739093">rec</span><span class="op" id="7739096">.</span><span class="ident" id="7739097">Flushed</span><span class="op" id="7739104">,</span>&nbsp;<span class="ident" id="7739106">want</span><span class="op" id="7739110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7739115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7739120">return</span>&nbsp;<span class="builtintype" id="7739127">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7739133">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7739136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7739140">tests</span>&nbsp;<span class="op" id="7739146">:=</span>&nbsp;<span class="op" id="7739149">[</span><span class="op" id="7739150">]</span><span class="keyword" id="7739151">struct</span>&nbsp;<span class="op" id="7739158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7739162">name</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7739169">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7739178">h</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7739185">func</span><span class="op" id="7739189">(</span><span class="ident" id="7739190">w</span>&nbsp;<span class="ident" id="7739192">http</span><span class="op" id="7739196">.</span><span class="ident" id="7739197">ResponseWriter</span><span class="op" id="7739211">,</span>&nbsp;<span class="ident" id="7739213">r</span>&nbsp;<span class="op" id="7739215">*</span><span class="ident" id="7739216">http</span><span class="op" id="7739220">.</span><span class="ident" id="7739221">Request</span><span class="op" id="7739228">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7739232">checks</span>&nbsp;<span class="op" id="7739239">[</span><span class="op" id="7739240">]</span><span class="ident" id="7739241">checkFunc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7739252">}</span><span class="op" id="7739253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7739257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7739262">&#34;200&nbsp;default&#34;</span><span class="op" id="7739275">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7739280">func</span><span class="op" id="7739284">(</span><span class="ident" id="7739285">w</span>&nbsp;<span class="ident" id="7739287">http</span><span class="op" id="7739291">.</span><span class="ident" id="7739292">ResponseWriter</span><span class="op" id="7739306">,</span>&nbsp;<span class="ident" id="7739308">r</span>&nbsp;<span class="op" id="7739310">*</span><span class="ident" id="7739311">http</span><span class="op" id="7739315">.</span><span class="ident" id="7739316">Request</span><span class="op" id="7739323">)</span>&nbsp;<span class="op" id="7739325">{</span><span class="op" id="7739326">}</span><span class="op" id="7739327">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7739332">check</span><span class="op" id="7739337">(</span><span class="ident" id="7739338">hasStatus</span><span class="op" id="7739347">(</span><span class="num" id="7739348">200</span><span class="op" id="7739351">)</span><span class="op" id="7739352">,</span>&nbsp;<span class="ident" id="7739354">hasContents</span><span class="op" id="7739365">(</span><span class="string" id="7739366">&#34;&#34;</span><span class="op" id="7739368">)</span><span class="op" id="7739369">)</span><span class="op" id="7739370">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7739374">}</span><span class="op" id="7739375">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7739379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7739384">&#34;first&nbsp;code&nbsp;only&#34;</span><span class="op" id="7739401">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7739406">func</span><span class="op" id="7739410">(</span><span class="ident" id="7739411">w</span>&nbsp;<span class="ident" id="7739413">http</span><span class="op" id="7739417">.</span><span class="ident" id="7739418">ResponseWriter</span><span class="op" id="7739432">,</span>&nbsp;<span class="ident" id="7739434">r</span>&nbsp;<span class="op" id="7739436">*</span><span class="ident" id="7739437">http</span><span class="op" id="7739441">.</span><span class="ident" id="7739442">Request</span><span class="op" id="7739449">)</span>&nbsp;<span class="op" id="7739451">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7739457">w</span><span class="op" id="7739458">.</span><span class="ident" id="7739459">WriteHeader</span><span class="op" id="7739470">(</span><span class="num" id="7739471">201</span><span class="op" id="7739474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7739480">w</span><span class="op" id="7739481">.</span><span class="ident" id="7739482">WriteHeader</span><span class="op" id="7739493">(</span><span class="num" id="7739494">202</span><span class="op" id="7739497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7739503">w</span><span class="op" id="7739504">.</span><span class="ident" id="7739505">Write</span><span class="op" id="7739510">(</span><span class="op" id="7739511">[</span><span class="op" id="7739512">]</span><span class="builtintype" id="7739513">byte</span><span class="op" id="7739517">(</span><span class="string" id="7739518">&#34;hi&#34;</span><span class="op" id="7739522">)</span><span class="op" id="7739523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7739528">}</span><span class="op" id="7739529">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7739534">check</span><span class="op" id="7739539">(</span><span class="ident" id="7739540">hasStatus</span><span class="op" id="7739549">(</span><span class="num" id="7739550">201</span><span class="op" id="7739553">)</span><span class="op" id="7739554">,</span>&nbsp;<span class="ident" id="7739556">hasContents</span><span class="op" id="7739567">(</span><span class="string" id="7739568">&#34;hi&#34;</span><span class="op" id="7739572">)</span><span class="op" id="7739573">)</span><span class="op" id="7739574">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7739578">}</span><span class="op" id="7739579">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7739583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7739588">&#34;write&nbsp;sends&nbsp;200&#34;</span><span class="op" id="7739605">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7739610">func</span><span class="op" id="7739614">(</span><span class="ident" id="7739615">w</span>&nbsp;<span class="ident" id="7739617">http</span><span class="op" id="7739621">.</span><span class="ident" id="7739622">ResponseWriter</span><span class="op" id="7739636">,</span>&nbsp;<span class="ident" id="7739638">r</span>&nbsp;<span class="op" id="7739640">*</span><span class="ident" id="7739641">http</span><span class="op" id="7739645">.</span><span class="ident" id="7739646">Request</span><span class="op" id="7739653">)</span>&nbsp;<span class="op" id="7739655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7739661">w</span><span class="op" id="7739662">.</span><span class="ident" id="7739663">Write</span><span class="op" id="7739668">(</span><span class="op" id="7739669">[</span><span class="op" id="7739670">]</span><span class="builtintype" id="7739671">byte</span><span class="op" id="7739675">(</span><span class="string" id="7739676">&#34;hi&nbsp;first&#34;</span><span class="op" id="7739686">)</span><span class="op" id="7739687">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7739693">w</span><span class="op" id="7739694">.</span><span class="ident" id="7739695">WriteHeader</span><span class="op" id="7739706">(</span><span class="num" id="7739707">201</span><span class="op" id="7739710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7739716">w</span><span class="op" id="7739717">.</span><span class="ident" id="7739718">WriteHeader</span><span class="op" id="7739729">(</span><span class="num" id="7739730">202</span><span class="op" id="7739733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7739738">}</span><span class="op" id="7739739">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7739744">check</span><span class="op" id="7739749">(</span><span class="ident" id="7739750">hasStatus</span><span class="op" id="7739759">(</span><span class="num" id="7739760">200</span><span class="op" id="7739763">)</span><span class="op" id="7739764">,</span>&nbsp;<span class="ident" id="7739766">hasContents</span><span class="op" id="7739777">(</span><span class="string" id="7739778">&#34;hi&nbsp;first&#34;</span><span class="op" id="7739788">)</span><span class="op" id="7739789">,</span>&nbsp;<span class="ident" id="7739791">hasFlush</span><span class="op" id="7739799">(</span><span class="builtintype" id="7739800">false</span><span class="op" id="7739805">)</span><span class="op" id="7739806">)</span><span class="op" id="7739807">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7739811">}</span><span class="op" id="7739812">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7739816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7739821">&#34;flush&#34;</span><span class="op" id="7739828">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7739833">func</span><span class="op" id="7739837">(</span><span class="ident" id="7739838">w</span>&nbsp;<span class="ident" id="7739840">http</span><span class="op" id="7739844">.</span><span class="ident" id="7739845">ResponseWriter</span><span class="op" id="7739859">,</span>&nbsp;<span class="ident" id="7739861">r</span>&nbsp;<span class="op" id="7739863">*</span><span class="ident" id="7739864">http</span><span class="op" id="7739868">.</span><span class="ident" id="7739869">Request</span><span class="op" id="7739876">)</span>&nbsp;<span class="op" id="7739878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7739884">w</span><span class="op" id="7739885">.</span><span class="op" id="7739886">(</span><span class="ident" id="7739887">http</span><span class="op" id="7739891">.</span><span class="ident" id="7739892">Flusher</span><span class="op" id="7739899">)</span><span class="op" id="7739900">.</span><span class="ident" id="7739901">Flush</span><span class="op" id="7739906">(</span><span class="op" id="7739907">)</span>&nbsp;<span class="comment" id="7739909">//&nbsp;also&nbsp;sends&nbsp;a&nbsp;200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7739933">w</span><span class="op" id="7739934">.</span><span class="ident" id="7739935">WriteHeader</span><span class="op" id="7739946">(</span><span class="num" id="7739947">201</span><span class="op" id="7739950">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7739955">}</span><span class="op" id="7739956">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7739961">check</span><span class="op" id="7739966">(</span><span class="ident" id="7739967">hasStatus</span><span class="op" id="7739976">(</span><span class="num" id="7739977">200</span><span class="op" id="7739980">)</span><span class="op" id="7739981">,</span>&nbsp;<span class="ident" id="7739983">hasFlush</span><span class="op" id="7739991">(</span><span class="builtintype" id="7739992">true</span><span class="op" id="7739996">)</span><span class="op" id="7739997">)</span><span class="op" id="7739998">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7740002">}</span><span class="op" id="7740003">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7740006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7740009">r</span><span class="op" id="7740010">,</span>&nbsp;<span class="ident" id="7740012">_</span>&nbsp;<span class="op" id="7740014">:=</span>&nbsp;<span class="ident" id="7740017">http</span><span class="op" id="7740021">.</span><span class="ident" id="7740022">NewRequest</span><span class="op" id="7740032">(</span><span class="string" id="7740033">&#34;GET&#34;</span><span class="op" id="7740038">,</span>&nbsp;<span class="string" id="7740040">&#34;http://foo.com/&#34;</span><span class="op" id="7740057">,</span>&nbsp;<span class="builtintype" id="7740059">nil</span><span class="op" id="7740062">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7740065">for</span>&nbsp;<span class="ident" id="7740069">_</span><span class="op" id="7740070">,</span>&nbsp;<span class="ident" id="7740072">tt</span>&nbsp;<span class="op" id="7740075">:=</span>&nbsp;<span class="keyword" id="7740078">range</span>&nbsp;<span class="ident" id="7740084">tests</span>&nbsp;<span class="op" id="7740090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7740094">h</span>&nbsp;<span class="op" id="7740096">:=</span>&nbsp;<span class="ident" id="7740099">http</span><span class="op" id="7740103">.</span><span class="ident" id="7740104">HandlerFunc</span><span class="op" id="7740115">(</span><span class="ident" id="7740116">tt</span><span class="op" id="7740118">.</span><span class="ident" id="7740119">h</span><span class="op" id="7740120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7740124">rec</span>&nbsp;<span class="op" id="7740128">:=</span>&nbsp;<span class="ident" id="7740131">NewRecorder</span><span class="op" id="7740142">(</span><span class="op" id="7740143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7740147">h</span><span class="op" id="7740148">.</span><span class="ident" id="7740149">ServeHTTP</span><span class="op" id="7740158">(</span><span class="ident" id="7740159">rec</span><span class="op" id="7740162">,</span>&nbsp;<span class="ident" id="7740164">r</span><span class="op" id="7740165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7740169">for</span>&nbsp;<span class="ident" id="7740173">_</span><span class="op" id="7740174">,</span>&nbsp;<span class="ident" id="7740176">check</span>&nbsp;<span class="op" id="7740182">:=</span>&nbsp;<span class="keyword" id="7740185">range</span>&nbsp;<span class="ident" id="7740191">tt</span><span class="op" id="7740193">.</span><span class="ident" id="7740194">checks</span>&nbsp;<span class="op" id="7740201">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7740206">if</span>&nbsp;<span class="ident" id="7740209">err</span>&nbsp;<span class="op" id="7740213">:=</span>&nbsp;<span class="ident" id="7740216">check</span><span class="op" id="7740221">(</span><span class="ident" id="7740222">rec</span><span class="op" id="7740225">)</span><span class="op" id="7740226">;</span>&nbsp;<span class="ident" id="7740228">err</span>&nbsp;<span class="op" id="7740232">!=</span>&nbsp;<span class="builtintype" id="7740235">nil</span>&nbsp;<span class="op" id="7740239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7740245">t</span><span class="op" id="7740246">.</span><span class="ident" id="7740247">Errorf</span><span class="op" id="7740253">(</span><span class="string" id="7740254">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="7740262">,</span>&nbsp;<span class="ident" id="7740264">tt</span><span class="op" id="7740266">.</span><span class="ident" id="7740267">name</span><span class="op" id="7740271">,</span>&nbsp;<span class="ident" id="7740273">err</span><span class="op" id="7740276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7740281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7740285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7740288">}</span><br>
<span class="lineno">90</span><span class="op" id="7740290">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
