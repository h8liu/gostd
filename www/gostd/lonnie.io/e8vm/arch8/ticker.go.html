<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>lonnie.io/e8vm/arch8</h2>
<ul>
<li><a href="/gostd/lonnie.io/e8vm/arch8/console.go.html">console.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/cpu.go.html">cpu.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/cpu_test.go.html">cpu_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/device.go.html">device.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/exception.go.html">exception.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_all.go.html">inst_all.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_br.go.html">inst_br.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_br_test.go.html">inst_br_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_imm.go.html">inst_imm.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_imm_test.go.html">inst_imm_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_jmp.go.html">inst_jmp.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_reg.go.html">inst_reg.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_reg_test.go.html">inst_reg_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_sys.go.html">inst_sys.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/int_bus.go.html">int_bus.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/interrupt.go.html">interrupt.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/interrupt_test.go.html">interrupt_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/machine.go.html">machine.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/multi_core.go.html">multi_core.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page.go.html">page.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page_table.go.html">page_table.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page_table_test.go.html">page_table_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page_test.go.html">page_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/phy_memory.go.html">phy_memory.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/phy_memory_test.go.html">phy_memory_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/regs.go.html">regs.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/regs_test.go.html">regs_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/run_image.go.html">run_image.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/serial.go.html">serial.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/ticker.go.html">ticker.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/virt_memory.go.html">virt_memory.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/virt_memory_test.go.html">virt_memory_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="keyword" id="3593140">package</span>&nbsp;<span class="ident" id="3593148">arch8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3593155">import</span>&nbsp;<span class="op" id="3593162">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3593165">&#34;math/rand&#34;</span><br>
<span class="lineno">5</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3593178">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3593185">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3593188">//&nbsp;Ticker&nbsp;is&nbsp;a&nbsp;device&nbsp;that&nbsp;generates&nbsp;time&nbsp;interrupts.</span><br>
<span class="lineno"></span><span class="keyword" id="3593242">type</span>&nbsp;<span class="ident" id="3593247">ticker</span>&nbsp;<span class="keyword" id="3593254">struct</span>&nbsp;<span class="op" id="3593261">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3593264">intBus</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3593273">intBus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3593281">nextTick</span>&nbsp;<span class="builtintype" id="3593290">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3593298">Interval</span>&nbsp;<span class="builtintype" id="3593307">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3593314">Noise</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3593323">int32</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3593330">Rand</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3593339">*</span><span class="ident" id="3593340">rand</span><span class="op" id="3593344">.</span><span class="ident" id="3593345">Rand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3593351">Code</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3593360">byte</span><br>
<span class="lineno"></span><span class="op" id="3593365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3593368">//&nbsp;NewTicker&nbsp;creates&nbsp;a&nbsp;new&nbsp;time&nbsp;interrupt&nbsp;generator.</span><br>
<span class="lineno">20</span><span class="keyword" id="3593421">func</span>&nbsp;<span class="ident" id="3593426">newTicker</span><span class="op" id="3593435">(</span><span class="ident" id="3593436">bus</span>&nbsp;<span class="ident" id="3593440">intBus</span><span class="op" id="3593446">)</span>&nbsp;<span class="op" id="3593448">*</span><span class="ident" id="3593449">ticker</span>&nbsp;<span class="op" id="3593456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3593459">ret</span>&nbsp;<span class="op" id="3593463">:=</span>&nbsp;<span class="builtinfunc" id="3593466">new</span><span class="op" id="3593469">(</span><span class="ident" id="3593470">ticker</span><span class="op" id="3593476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3593479">ret</span><span class="op" id="3593482">.</span><span class="ident" id="3593483">intBus</span>&nbsp;<span class="op" id="3593490">=</span>&nbsp;<span class="ident" id="3593492">bus</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3593498">ret</span><span class="op" id="3593501">.</span><span class="ident" id="3593502">Interval</span>&nbsp;<span class="op" id="3593511">=</span>&nbsp;<span class="num" id="3593513">1000</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3593519">ret</span><span class="op" id="3593522">.</span><span class="ident" id="3593523">Noise</span>&nbsp;<span class="op" id="3593529">=</span>&nbsp;<span class="num" id="3593531">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3593535">ret</span><span class="op" id="3593538">.</span><span class="ident" id="3593539">Rand</span>&nbsp;<span class="op" id="3593544">=</span>&nbsp;<span class="ident" id="3593546">rand</span><span class="op" id="3593550">.</span><span class="ident" id="3593551">New</span><span class="op" id="3593554">(</span><span class="ident" id="3593555">rand</span><span class="op" id="3593559">.</span><span class="ident" id="3593560">NewSource</span><span class="op" id="3593569">(</span><span class="ident" id="3593570">time</span><span class="op" id="3593574">.</span><span class="ident" id="3593575">Now</span><span class="op" id="3593578">(</span><span class="op" id="3593579">)</span><span class="op" id="3593580">.</span><span class="ident" id="3593581">UnixNano</span><span class="op" id="3593589">(</span><span class="op" id="3593590">)</span><span class="op" id="3593591">)</span><span class="op" id="3593592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3593595">ret</span><span class="op" id="3593598">.</span><span class="ident" id="3593599">Code</span>&nbsp;<span class="op" id="3593604">=</span>&nbsp;<span class="num" id="3593606">2</span>&nbsp;<span class="comment" id="3593608">//&nbsp;time&nbsp;interrupt&nbsp;code</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3593633">ret</span><span class="op" id="3593636">.</span><span class="ident" id="3593637">reset</span><span class="op" id="3593642">(</span><span class="op" id="3593643">)</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3593647">return</span>&nbsp;<span class="ident" id="3593654">ret</span><br>
<span class="lineno"></span><span class="op" id="3593658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3593661">func</span>&nbsp;<span class="op" id="3593666">(</span><span class="ident" id="3593667">t</span>&nbsp;<span class="op" id="3593669">*</span><span class="ident" id="3593670">ticker</span><span class="op" id="3593676">)</span>&nbsp;<span class="ident" id="3593678">reset</span><span class="op" id="3593683">(</span><span class="op" id="3593684">)</span>&nbsp;<span class="op" id="3593686">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3593689">if</span>&nbsp;<span class="ident" id="3593692">t</span><span class="op" id="3593693">.</span><span class="ident" id="3593694">Noise</span>&nbsp;<span class="op" id="3593700">&lt;</span>&nbsp;<span class="num" id="3593702">0</span>&nbsp;<span class="op" id="3593704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3593708">panic</span><span class="op" id="3593713">(</span><span class="string" id="3593714">&#34;negative&nbsp;ticker&nbsp;noise&#34;</span><span class="op" id="3593737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3593740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3593743">if</span>&nbsp;<span class="ident" id="3593746">t</span><span class="op" id="3593747">.</span><span class="ident" id="3593748">Interval</span>&nbsp;<span class="op" id="3593757">&lt;</span>&nbsp;<span class="num" id="3593759">0</span>&nbsp;<span class="op" id="3593761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3593765">panic</span><span class="op" id="3593770">(</span><span class="string" id="3593771">&#34;negative&nbsp;ticker&nbsp;interval&#34;</span><span class="op" id="3593797">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3593800">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3593804">noise</span>&nbsp;<span class="op" id="3593810">:=</span>&nbsp;<span class="builtintype" id="3593813">int32</span><span class="op" id="3593818">(</span><span class="num" id="3593819">0</span><span class="op" id="3593820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3593823">if</span>&nbsp;<span class="ident" id="3593826">t</span><span class="op" id="3593827">.</span><span class="ident" id="3593828">Noise</span>&nbsp;<span class="op" id="3593834">&gt;</span>&nbsp;<span class="num" id="3593836">0</span>&nbsp;<span class="op" id="3593838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3593842">noise</span>&nbsp;<span class="op" id="3593848">=</span>&nbsp;<span class="ident" id="3593850">t</span><span class="op" id="3593851">.</span><span class="ident" id="3593852">Rand</span><span class="op" id="3593856">.</span><span class="ident" id="3593857">Int31n</span><span class="op" id="3593863">(</span><span class="ident" id="3593864">t</span><span class="op" id="3593865">.</span><span class="ident" id="3593866">Noise</span><span class="op" id="3593871">)</span>&nbsp;<span class="op" id="3593873">-</span>&nbsp;<span class="ident" id="3593875">t</span><span class="op" id="3593876">.</span><span class="ident" id="3593877">Noise</span><span class="op" id="3593882">/</span><span class="num" id="3593883">2</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3593886">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3593890">next</span>&nbsp;<span class="op" id="3593895">:=</span>&nbsp;<span class="ident" id="3593898">t</span><span class="op" id="3593899">.</span><span class="ident" id="3593900">Interval</span>&nbsp;<span class="op" id="3593909">+</span>&nbsp;<span class="ident" id="3593911">noise</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3593918">if</span>&nbsp;<span class="ident" id="3593921">next</span>&nbsp;<span class="op" id="3593926">&lt;</span>&nbsp;<span class="num" id="3593928">0</span>&nbsp;<span class="op" id="3593930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3593934">next</span>&nbsp;<span class="op" id="3593939">=</span>&nbsp;<span class="num" id="3593941">0</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3593944">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3593948">t</span><span class="op" id="3593949">.</span><span class="ident" id="3593950">nextTick</span>&nbsp;<span class="op" id="3593959">=</span>&nbsp;<span class="ident" id="3593961">next</span><br>
<span class="lineno"></span><span class="op" id="3593966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="3593969">//&nbsp;Tick&nbsp;decreases&nbsp;the&nbsp;ticking&nbsp;counter.&nbsp;If&nbsp;the&nbsp;counter&nbsp;reaches&nbsp;0,</span><br>
<span class="lineno"></span><span class="comment" id="3594034">//&nbsp;it&nbsp;will&nbsp;issue&nbsp;interrupts&nbsp;to&nbsp;all&nbsp;cores&nbsp;and&nbsp;reset&nbsp;the&nbsp;counter.</span><br>
<span class="lineno"></span><span class="keyword" id="3594098">func</span>&nbsp;<span class="op" id="3594103">(</span><span class="ident" id="3594104">t</span>&nbsp;<span class="op" id="3594106">*</span><span class="ident" id="3594107">ticker</span><span class="op" id="3594113">)</span>&nbsp;<span class="ident" id="3594115">Tick</span><span class="op" id="3594119">(</span><span class="op" id="3594120">)</span>&nbsp;<span class="op" id="3594122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3594125">if</span>&nbsp;<span class="ident" id="3594128">t</span><span class="op" id="3594129">.</span><span class="ident" id="3594130">nextTick</span>&nbsp;<span class="op" id="3594139">&lt;</span>&nbsp;<span class="num" id="3594141">0</span>&nbsp;<span class="op" id="3594143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3594147">panic</span><span class="op" id="3594152">(</span><span class="string" id="3594153">&#34;bug&#34;</span><span class="op" id="3594158">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3594161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3594165">if</span>&nbsp;<span class="ident" id="3594168">t</span><span class="op" id="3594169">.</span><span class="ident" id="3594170">nextTick</span>&nbsp;<span class="op" id="3594179">==</span>&nbsp;<span class="num" id="3594182">0</span>&nbsp;<span class="op" id="3594184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3594188">intAllCores</span><span class="op" id="3594199">(</span><span class="ident" id="3594200">t</span><span class="op" id="3594201">.</span><span class="ident" id="3594202">intBus</span><span class="op" id="3594208">,</span>&nbsp;<span class="ident" id="3594210">t</span><span class="op" id="3594211">.</span><span class="ident" id="3594212">Code</span><span class="op" id="3594216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3594220">t</span><span class="op" id="3594221">.</span><span class="ident" id="3594222">reset</span><span class="op" id="3594227">(</span><span class="op" id="3594228">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3594231">}</span>&nbsp;<span class="keyword" id="3594233">else</span>&nbsp;<span class="op" id="3594238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3594242">t</span><span class="op" id="3594243">.</span><span class="ident" id="3594244">nextTick</span><span class="op" id="3594252">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3594256">}</span><br>
<span class="lineno"></span><span class="op" id="3594258">}</span>
</div>
</body>
</html>
