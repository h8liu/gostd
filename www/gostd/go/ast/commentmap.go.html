<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/ast</h2>
<ul>
<li><a href="/gostd/go/ast/ast.go.html">ast.go</a></li>
<li><a href="/gostd/go/ast/ast_test.go.html">ast_test.go</a></li>
<li><a href="/gostd/go/ast/commentmap.go.html" class="current">commentmap.go</a></li>
<li><a href="/gostd/go/ast/commentmap_test.go.html">commentmap_test.go</a></li>
<li><a href="/gostd/go/ast/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/ast/filter.go.html">filter.go</a></li>
<li><a href="/gostd/go/ast/filter_test.go.html">filter_test.go</a></li>
<li><a href="/gostd/go/ast/import.go.html">import.go</a></li>
<li><a href="/gostd/go/ast/print.go.html">print.go</a></li>
<li><a href="/gostd/go/ast/print_test.go.html">print_test.go</a></li>
<li><a href="/gostd/go/ast/resolve.go.html">resolve.go</a></li>
<li><a href="/gostd/go/ast/scope.go.html">scope.go</a></li>
<li><a href="/gostd/go/ast/walk.go.html">walk.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4993286">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4993341">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4993395">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4993446">package</span>&nbsp;<span class="ident" id="4993454">ast</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4993459">import</span>&nbsp;<span class="op" id="4993466">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4993469">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4993478">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4993485">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4993497">&#34;sort&#34;</span><br>
<span class="lineno"></span><span class="op" id="4993504">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4993507">type</span>&nbsp;<span class="ident" id="4993512">byPos</span>&nbsp;<span class="op" id="4993518">[</span><span class="op" id="4993519">]</span><span class="op" id="4993520">*</span><span class="ident" id="4993521">CommentGroup</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="4993535">func</span>&nbsp;<span class="op" id="4993540">(</span><span class="ident" id="4993541">a</span>&nbsp;<span class="ident" id="4993543">byPos</span><span class="op" id="4993548">)</span>&nbsp;<span class="ident" id="4993550">Len</span><span class="op" id="4993553">(</span><span class="op" id="4993554">)</span>&nbsp;<span class="builtintype" id="4993556">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4993570">{</span>&nbsp;<span class="keyword" id="4993572">return</span>&nbsp;<span class="builtinfunc" id="4993579">len</span><span class="op" id="4993582">(</span><span class="ident" id="4993583">a</span><span class="op" id="4993584">)</span>&nbsp;<span class="op" id="4993586">}</span><br>
<span class="lineno"></span><span class="keyword" id="4993588">func</span>&nbsp;<span class="op" id="4993593">(</span><span class="ident" id="4993594">a</span>&nbsp;<span class="ident" id="4993596">byPos</span><span class="op" id="4993601">)</span>&nbsp;<span class="ident" id="4993603">Less</span><span class="op" id="4993607">(</span><span class="ident" id="4993608">i</span><span class="op" id="4993609">,</span>&nbsp;<span class="ident" id="4993611">j</span>&nbsp;<span class="builtintype" id="4993613">int</span><span class="op" id="4993616">)</span>&nbsp;<span class="builtintype" id="4993618">bool</span>&nbsp;<span class="op" id="4993623">{</span>&nbsp;<span class="keyword" id="4993625">return</span>&nbsp;<span class="ident" id="4993632">a</span><span class="op" id="4993633">[</span><span class="ident" id="4993634">i</span><span class="op" id="4993635">]</span><span class="op" id="4993636">.</span><span class="ident" id="4993637">Pos</span><span class="op" id="4993640">(</span><span class="op" id="4993641">)</span>&nbsp;<span class="op" id="4993643">&lt;</span>&nbsp;<span class="ident" id="4993645">a</span><span class="op" id="4993646">[</span><span class="ident" id="4993647">j</span><span class="op" id="4993648">]</span><span class="op" id="4993649">.</span><span class="ident" id="4993650">Pos</span><span class="op" id="4993653">(</span><span class="op" id="4993654">)</span>&nbsp;<span class="op" id="4993656">}</span><br>
<span class="lineno"></span><span class="keyword" id="4993658">func</span>&nbsp;<span class="op" id="4993663">(</span><span class="ident" id="4993664">a</span>&nbsp;<span class="ident" id="4993666">byPos</span><span class="op" id="4993671">)</span>&nbsp;<span class="ident" id="4993673">Swap</span><span class="op" id="4993677">(</span><span class="ident" id="4993678">i</span><span class="op" id="4993679">,</span>&nbsp;<span class="ident" id="4993681">j</span>&nbsp;<span class="builtintype" id="4993683">int</span><span class="op" id="4993686">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4993693">{</span>&nbsp;<span class="ident" id="4993695">a</span><span class="op" id="4993696">[</span><span class="ident" id="4993697">i</span><span class="op" id="4993698">]</span><span class="op" id="4993699">,</span>&nbsp;<span class="ident" id="4993701">a</span><span class="op" id="4993702">[</span><span class="ident" id="4993703">j</span><span class="op" id="4993704">]</span>&nbsp;<span class="op" id="4993706">=</span>&nbsp;<span class="ident" id="4993708">a</span><span class="op" id="4993709">[</span><span class="ident" id="4993710">j</span><span class="op" id="4993711">]</span><span class="op" id="4993712">,</span>&nbsp;<span class="ident" id="4993714">a</span><span class="op" id="4993715">[</span><span class="ident" id="4993716">i</span><span class="op" id="4993717">]</span>&nbsp;<span class="op" id="4993719">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="4993722">//&nbsp;sortComments&nbsp;sorts&nbsp;the&nbsp;list&nbsp;of&nbsp;comment&nbsp;groups&nbsp;in&nbsp;source&nbsp;order.</span><br>
<span class="lineno"></span><span class="comment" id="4993788">//</span><br>
<span class="lineno"></span><span class="keyword" id="4993791">func</span>&nbsp;<span class="ident" id="4993796">sortComments</span><span class="op" id="4993808">(</span><span class="ident" id="4993809">list</span>&nbsp;<span class="op" id="4993814">[</span><span class="op" id="4993815">]</span><span class="op" id="4993816">*</span><span class="ident" id="4993817">CommentGroup</span><span class="op" id="4993829">)</span>&nbsp;<span class="op" id="4993831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4993834">//&nbsp;TODO(gri):&nbsp;Does&nbsp;it&nbsp;make&nbsp;sense&nbsp;to&nbsp;check&nbsp;for&nbsp;sorted-ness</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4993893">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;first&nbsp;(because&nbsp;we&nbsp;know&nbsp;that&nbsp;sorted-ness&nbsp;is</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4993951">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;very&nbsp;likely)?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4993980">if</span>&nbsp;<span class="ident" id="4993983">orderedList</span>&nbsp;<span class="op" id="4993995">:=</span>&nbsp;<span class="ident" id="4993998">byPos</span><span class="op" id="4994003">(</span><span class="ident" id="4994004">list</span><span class="op" id="4994008">)</span><span class="op" id="4994009">;</span>&nbsp;<span class="op" id="4994011">!</span><span class="ident" id="4994012">sort</span><span class="op" id="4994016">.</span><span class="ident" id="4994017">IsSorted</span><span class="op" id="4994025">(</span><span class="ident" id="4994026">orderedList</span><span class="op" id="4994037">)</span>&nbsp;<span class="op" id="4994039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4994043">sort</span><span class="op" id="4994047">.</span><span class="ident" id="4994048">Sort</span><span class="op" id="4994052">(</span><span class="ident" id="4994053">orderedList</span><span class="op" id="4994064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4994067">}</span><br>
<span class="lineno"></span><span class="op" id="4994069">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="4994072">//&nbsp;A&nbsp;CommentMap&nbsp;maps&nbsp;an&nbsp;AST&nbsp;node&nbsp;to&nbsp;a&nbsp;list&nbsp;of&nbsp;comment&nbsp;groups</span><br>
<span class="lineno"></span><span class="comment" id="4994133">//&nbsp;associated&nbsp;with&nbsp;it.&nbsp;See&nbsp;NewCommentMap&nbsp;for&nbsp;a&nbsp;description&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4994195">//&nbsp;the&nbsp;association.</span><br>
<span class="lineno"></span><span class="comment" id="4994215">//</span><br>
<span class="lineno">35</span><span class="keyword" id="4994218">type</span>&nbsp;<span class="ident" id="4994223">CommentMap</span>&nbsp;<span class="keyword" id="4994234">map</span><span class="op" id="4994237">[</span><span class="ident" id="4994238">Node</span><span class="op" id="4994242">]</span><span class="op" id="4994243">[</span><span class="op" id="4994244">]</span><span class="op" id="4994245">*</span><span class="ident" id="4994246">CommentGroup</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4994260">func</span>&nbsp;<span class="op" id="4994265">(</span><span class="ident" id="4994266">cmap</span>&nbsp;<span class="ident" id="4994271">CommentMap</span><span class="op" id="4994281">)</span>&nbsp;<span class="ident" id="4994283">addComment</span><span class="op" id="4994293">(</span><span class="ident" id="4994294">n</span>&nbsp;<span class="ident" id="4994296">Node</span><span class="op" id="4994300">,</span>&nbsp;<span class="ident" id="4994302">c</span>&nbsp;<span class="op" id="4994304">*</span><span class="ident" id="4994305">CommentGroup</span><span class="op" id="4994317">)</span>&nbsp;<span class="op" id="4994319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4994322">list</span>&nbsp;<span class="op" id="4994327">:=</span>&nbsp;<span class="ident" id="4994330">cmap</span><span class="op" id="4994334">[</span><span class="ident" id="4994335">n</span><span class="op" id="4994336">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4994339">if</span>&nbsp;<span class="builtinfunc" id="4994342">len</span><span class="op" id="4994345">(</span><span class="ident" id="4994346">list</span><span class="op" id="4994350">)</span>&nbsp;<span class="op" id="4994352">==</span>&nbsp;<span class="num" id="4994355">0</span>&nbsp;<span class="op" id="4994357">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4994361">list</span>&nbsp;<span class="op" id="4994366">=</span>&nbsp;<span class="op" id="4994368">[</span><span class="op" id="4994369">]</span><span class="op" id="4994370">*</span><span class="ident" id="4994371">CommentGroup</span><span class="op" id="4994383">{</span><span class="ident" id="4994384">c</span><span class="op" id="4994385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4994388">}</span>&nbsp;<span class="keyword" id="4994390">else</span>&nbsp;<span class="op" id="4994395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4994399">list</span>&nbsp;<span class="op" id="4994404">=</span>&nbsp;<span class="builtinfunc" id="4994406">append</span><span class="op" id="4994412">(</span><span class="ident" id="4994413">list</span><span class="op" id="4994417">,</span>&nbsp;<span class="ident" id="4994419">c</span><span class="op" id="4994420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4994423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4994426">cmap</span><span class="op" id="4994430">[</span><span class="ident" id="4994431">n</span><span class="op" id="4994432">]</span>&nbsp;<span class="op" id="4994434">=</span>&nbsp;<span class="ident" id="4994436">list</span><br>
<span class="lineno">45</span><span class="op" id="4994441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4994444">type</span>&nbsp;<span class="ident" id="4994449">byInterval</span>&nbsp;<span class="op" id="4994460">[</span><span class="op" id="4994461">]</span><span class="ident" id="4994462">Node</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4994468">func</span>&nbsp;<span class="op" id="4994473">(</span><span class="ident" id="4994474">a</span>&nbsp;<span class="ident" id="4994476">byInterval</span><span class="op" id="4994486">)</span>&nbsp;<span class="ident" id="4994488">Len</span><span class="op" id="4994491">(</span><span class="op" id="4994492">)</span>&nbsp;<span class="builtintype" id="4994494">int</span>&nbsp;<span class="op" id="4994498">{</span>&nbsp;<span class="keyword" id="4994500">return</span>&nbsp;<span class="builtinfunc" id="4994507">len</span><span class="op" id="4994510">(</span><span class="ident" id="4994511">a</span><span class="op" id="4994512">)</span>&nbsp;<span class="op" id="4994514">}</span><br>
<span class="lineno">50</span><span class="keyword" id="4994516">func</span>&nbsp;<span class="op" id="4994521">(</span><span class="ident" id="4994522">a</span>&nbsp;<span class="ident" id="4994524">byInterval</span><span class="op" id="4994534">)</span>&nbsp;<span class="ident" id="4994536">Less</span><span class="op" id="4994540">(</span><span class="ident" id="4994541">i</span><span class="op" id="4994542">,</span>&nbsp;<span class="ident" id="4994544">j</span>&nbsp;<span class="builtintype" id="4994546">int</span><span class="op" id="4994549">)</span>&nbsp;<span class="builtintype" id="4994551">bool</span>&nbsp;<span class="op" id="4994556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4994559">pi</span><span class="op" id="4994561">,</span>&nbsp;<span class="ident" id="4994563">pj</span>&nbsp;<span class="op" id="4994566">:=</span>&nbsp;<span class="ident" id="4994569">a</span><span class="op" id="4994570">[</span><span class="ident" id="4994571">i</span><span class="op" id="4994572">]</span><span class="op" id="4994573">.</span><span class="ident" id="4994574">Pos</span><span class="op" id="4994577">(</span><span class="op" id="4994578">)</span><span class="op" id="4994579">,</span>&nbsp;<span class="ident" id="4994581">a</span><span class="op" id="4994582">[</span><span class="ident" id="4994583">j</span><span class="op" id="4994584">]</span><span class="op" id="4994585">.</span><span class="ident" id="4994586">Pos</span><span class="op" id="4994589">(</span><span class="op" id="4994590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4994593">return</span>&nbsp;<span class="ident" id="4994600">pi</span>&nbsp;<span class="op" id="4994603">&lt;</span>&nbsp;<span class="ident" id="4994605">pj</span>&nbsp;<span class="op" id="4994608">||</span>&nbsp;<span class="ident" id="4994611">pi</span>&nbsp;<span class="op" id="4994614">==</span>&nbsp;<span class="ident" id="4994617">pj</span>&nbsp;<span class="op" id="4994620">&amp;&amp;</span>&nbsp;<span class="ident" id="4994623">a</span><span class="op" id="4994624">[</span><span class="ident" id="4994625">i</span><span class="op" id="4994626">]</span><span class="op" id="4994627">.</span><span class="ident" id="4994628">End</span><span class="op" id="4994631">(</span><span class="op" id="4994632">)</span>&nbsp;<span class="op" id="4994634">&gt;</span>&nbsp;<span class="ident" id="4994636">a</span><span class="op" id="4994637">[</span><span class="ident" id="4994638">j</span><span class="op" id="4994639">]</span><span class="op" id="4994640">.</span><span class="ident" id="4994641">End</span><span class="op" id="4994644">(</span><span class="op" id="4994645">)</span><br>
<span class="lineno"></span><span class="op" id="4994647">}</span><br>
<span class="lineno"></span><span class="keyword" id="4994649">func</span>&nbsp;<span class="op" id="4994654">(</span><span class="ident" id="4994655">a</span>&nbsp;<span class="ident" id="4994657">byInterval</span><span class="op" id="4994667">)</span>&nbsp;<span class="ident" id="4994669">Swap</span><span class="op" id="4994673">(</span><span class="ident" id="4994674">i</span><span class="op" id="4994675">,</span>&nbsp;<span class="ident" id="4994677">j</span>&nbsp;<span class="builtintype" id="4994679">int</span><span class="op" id="4994682">)</span>&nbsp;<span class="op" id="4994684">{</span>&nbsp;<span class="ident" id="4994686">a</span><span class="op" id="4994687">[</span><span class="ident" id="4994688">i</span><span class="op" id="4994689">]</span><span class="op" id="4994690">,</span>&nbsp;<span class="ident" id="4994692">a</span><span class="op" id="4994693">[</span><span class="ident" id="4994694">j</span><span class="op" id="4994695">]</span>&nbsp;<span class="op" id="4994697">=</span>&nbsp;<span class="ident" id="4994699">a</span><span class="op" id="4994700">[</span><span class="ident" id="4994701">j</span><span class="op" id="4994702">]</span><span class="op" id="4994703">,</span>&nbsp;<span class="ident" id="4994705">a</span><span class="op" id="4994706">[</span><span class="ident" id="4994707">i</span><span class="op" id="4994708">]</span>&nbsp;<span class="op" id="4994710">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="4994713">//&nbsp;nodeList&nbsp;returns&nbsp;the&nbsp;list&nbsp;of&nbsp;nodes&nbsp;of&nbsp;the&nbsp;AST&nbsp;n&nbsp;in&nbsp;source&nbsp;order.</span><br>
<span class="lineno"></span><span class="comment" id="4994781">//</span><br>
<span class="lineno"></span><span class="keyword" id="4994784">func</span>&nbsp;<span class="ident" id="4994789">nodeList</span><span class="op" id="4994797">(</span><span class="ident" id="4994798">n</span>&nbsp;<span class="ident" id="4994800">Node</span><span class="op" id="4994804">)</span>&nbsp;<span class="op" id="4994806">[</span><span class="op" id="4994807">]</span><span class="ident" id="4994808">Node</span>&nbsp;<span class="op" id="4994813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4994816">var</span>&nbsp;<span class="ident" id="4994820">list</span>&nbsp;<span class="op" id="4994825">[</span><span class="op" id="4994826">]</span><span class="ident" id="4994827">Node</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4994833">Inspect</span><span class="op" id="4994840">(</span><span class="ident" id="4994841">n</span><span class="op" id="4994842">,</span>&nbsp;<span class="keyword" id="4994844">func</span><span class="op" id="4994848">(</span><span class="ident" id="4994849">n</span>&nbsp;<span class="ident" id="4994851">Node</span><span class="op" id="4994855">)</span>&nbsp;<span class="builtintype" id="4994857">bool</span>&nbsp;<span class="op" id="4994862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4994866">//&nbsp;don&#39;t&nbsp;collect&nbsp;comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4994894">switch</span>&nbsp;<span class="ident" id="4994901">n</span><span class="op" id="4994902">.</span><span class="op" id="4994903">(</span><span class="keyword" id="4994904">type</span><span class="op" id="4994908">)</span>&nbsp;<span class="op" id="4994910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4994914">case</span>&nbsp;<span class="builtintype" id="4994919">nil</span><span class="op" id="4994922">,</span>&nbsp;<span class="op" id="4994924">*</span><span class="ident" id="4994925">CommentGroup</span><span class="op" id="4994937">,</span>&nbsp;<span class="op" id="4994939">*</span><span class="ident" id="4994940">Comment</span><span class="op" id="4994947">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4994952">return</span>&nbsp;<span class="builtintype" id="4994959">false</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4994967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4994971">list</span>&nbsp;<span class="op" id="4994976">=</span>&nbsp;<span class="builtinfunc" id="4994978">append</span><span class="op" id="4994984">(</span><span class="ident" id="4994985">list</span><span class="op" id="4994989">,</span>&nbsp;<span class="ident" id="4994991">n</span><span class="op" id="4994992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4994996">return</span>&nbsp;<span class="builtintype" id="4995003">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4995009">}</span><span class="op" id="4995010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4995013">//&nbsp;Note:&nbsp;The&nbsp;current&nbsp;implementation&nbsp;assumes&nbsp;that&nbsp;Inspect&nbsp;traverses&nbsp;the</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4995085">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AST&nbsp;in&nbsp;depth-first&nbsp;and&nbsp;thus&nbsp;_source_&nbsp;order.&nbsp;If&nbsp;AST&nbsp;traversal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4995156">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;does&nbsp;not&nbsp;follow&nbsp;source&nbsp;order,&nbsp;the&nbsp;sorting&nbsp;call&nbsp;below&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4995227">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4995247">//&nbsp;sort.Sort(byInterval(list))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4995279">return</span>&nbsp;<span class="ident" id="4995286">list</span><br>
<span class="lineno">75</span><span class="op" id="4995291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4995294">//&nbsp;A&nbsp;commentListReader&nbsp;helps&nbsp;iterating&nbsp;through&nbsp;a&nbsp;list&nbsp;of&nbsp;comment&nbsp;groups.</span><br>
<span class="lineno"></span><span class="comment" id="4995367">//</span><br>
<span class="lineno"></span><span class="keyword" id="4995370">type</span>&nbsp;<span class="ident" id="4995375">commentListReader</span>&nbsp;<span class="keyword" id="4995393">struct</span>&nbsp;<span class="op" id="4995400">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4995403">fset</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4995412">*</span><span class="ident" id="4995413">token</span><span class="op" id="4995418">.</span><span class="ident" id="4995419">FileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4995428">list</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4995437">[</span><span class="op" id="4995438">]</span><span class="op" id="4995439">*</span><span class="ident" id="4995440">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4995454">index</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4995463">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4995468">comment</span>&nbsp;&nbsp;<span class="op" id="4995477">*</span><span class="ident" id="4995478">CommentGroup</span>&nbsp;&nbsp;<span class="comment" id="4995492">//&nbsp;comment&nbsp;group&nbsp;at&nbsp;current&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4995527">pos</span><span class="op" id="4995530">,</span>&nbsp;<span class="ident" id="4995532">end</span>&nbsp;<span class="ident" id="4995536">token</span><span class="op" id="4995541">.</span><span class="ident" id="4995542">Position</span>&nbsp;<span class="comment" id="4995551">//&nbsp;source&nbsp;interval&nbsp;of&nbsp;comment&nbsp;group&nbsp;at&nbsp;current&nbsp;index</span><br>
<span class="lineno">85</span><span class="op" id="4995604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4995607">func</span>&nbsp;<span class="op" id="4995612">(</span><span class="ident" id="4995613">r</span>&nbsp;<span class="op" id="4995615">*</span><span class="ident" id="4995616">commentListReader</span><span class="op" id="4995633">)</span>&nbsp;<span class="ident" id="4995635">eol</span><span class="op" id="4995638">(</span><span class="op" id="4995639">)</span>&nbsp;<span class="builtintype" id="4995641">bool</span>&nbsp;<span class="op" id="4995646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4995649">return</span>&nbsp;<span class="ident" id="4995656">r</span><span class="op" id="4995657">.</span><span class="ident" id="4995658">index</span>&nbsp;<span class="op" id="4995664">&gt;=</span>&nbsp;<span class="builtinfunc" id="4995667">len</span><span class="op" id="4995670">(</span><span class="ident" id="4995671">r</span><span class="op" id="4995672">.</span><span class="ident" id="4995673">list</span><span class="op" id="4995677">)</span><br>
<span class="lineno"></span><span class="op" id="4995679">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="4995682">func</span>&nbsp;<span class="op" id="4995687">(</span><span class="ident" id="4995688">r</span>&nbsp;<span class="op" id="4995690">*</span><span class="ident" id="4995691">commentListReader</span><span class="op" id="4995708">)</span>&nbsp;<span class="ident" id="4995710">next</span><span class="op" id="4995714">(</span><span class="op" id="4995715">)</span>&nbsp;<span class="op" id="4995717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4995720">if</span>&nbsp;<span class="op" id="4995723">!</span><span class="ident" id="4995724">r</span><span class="op" id="4995725">.</span><span class="ident" id="4995726">eol</span><span class="op" id="4995729">(</span><span class="op" id="4995730">)</span>&nbsp;<span class="op" id="4995732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4995736">r</span><span class="op" id="4995737">.</span><span class="ident" id="4995738">comment</span>&nbsp;<span class="op" id="4995746">=</span>&nbsp;<span class="ident" id="4995748">r</span><span class="op" id="4995749">.</span><span class="ident" id="4995750">list</span><span class="op" id="4995754">[</span><span class="ident" id="4995755">r</span><span class="op" id="4995756">.</span><span class="ident" id="4995757">index</span><span class="op" id="4995762">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4995766">r</span><span class="op" id="4995767">.</span><span class="ident" id="4995768">pos</span>&nbsp;<span class="op" id="4995772">=</span>&nbsp;<span class="ident" id="4995774">r</span><span class="op" id="4995775">.</span><span class="ident" id="4995776">fset</span><span class="op" id="4995780">.</span><span class="ident" id="4995781">Position</span><span class="op" id="4995789">(</span><span class="ident" id="4995790">r</span><span class="op" id="4995791">.</span><span class="ident" id="4995792">comment</span><span class="op" id="4995799">.</span><span class="ident" id="4995800">Pos</span><span class="op" id="4995803">(</span><span class="op" id="4995804">)</span><span class="op" id="4995805">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4995809">r</span><span class="op" id="4995810">.</span><span class="ident" id="4995811">end</span>&nbsp;<span class="op" id="4995815">=</span>&nbsp;<span class="ident" id="4995817">r</span><span class="op" id="4995818">.</span><span class="ident" id="4995819">fset</span><span class="op" id="4995823">.</span><span class="ident" id="4995824">Position</span><span class="op" id="4995832">(</span><span class="ident" id="4995833">r</span><span class="op" id="4995834">.</span><span class="ident" id="4995835">comment</span><span class="op" id="4995842">.</span><span class="ident" id="4995843">End</span><span class="op" id="4995846">(</span><span class="op" id="4995847">)</span><span class="op" id="4995848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4995852">r</span><span class="op" id="4995853">.</span><span class="ident" id="4995854">index</span><span class="op" id="4995859">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4995863">}</span><br>
<span class="lineno"></span><span class="op" id="4995865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="4995868">//&nbsp;A&nbsp;nodeStack&nbsp;keeps&nbsp;track&nbsp;of&nbsp;nested&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="comment" id="4995912">//&nbsp;A&nbsp;node&nbsp;lower&nbsp;on&nbsp;the&nbsp;stack&nbsp;lexically&nbsp;contains&nbsp;the&nbsp;nodes&nbsp;higher&nbsp;on&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span><span class="comment" id="4995991">//</span><br>
<span class="lineno"></span><span class="keyword" id="4995994">type</span>&nbsp;<span class="ident" id="4995999">nodeStack</span>&nbsp;<span class="op" id="4996009">[</span><span class="op" id="4996010">]</span><span class="ident" id="4996011">Node</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="4996017">//&nbsp;push&nbsp;pops&nbsp;all&nbsp;nodes&nbsp;that&nbsp;appear&nbsp;lexically&nbsp;before&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="4996071">//&nbsp;and&nbsp;then&nbsp;pushes&nbsp;n&nbsp;on&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span><span class="comment" id="4996106">//</span><br>
<span class="lineno"></span><span class="keyword" id="4996109">func</span>&nbsp;<span class="op" id="4996114">(</span><span class="ident" id="4996115">s</span>&nbsp;<span class="op" id="4996117">*</span><span class="ident" id="4996118">nodeStack</span><span class="op" id="4996127">)</span>&nbsp;<span class="ident" id="4996129">push</span><span class="op" id="4996133">(</span><span class="ident" id="4996134">n</span>&nbsp;<span class="ident" id="4996136">Node</span><span class="op" id="4996140">)</span>&nbsp;<span class="op" id="4996142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4996145">s</span><span class="op" id="4996146">.</span><span class="ident" id="4996147">pop</span><span class="op" id="4996150">(</span><span class="ident" id="4996151">n</span><span class="op" id="4996152">.</span><span class="ident" id="4996153">Pos</span><span class="op" id="4996156">(</span><span class="op" id="4996157">)</span><span class="op" id="4996158">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4996161">*</span><span class="ident" id="4996162">s</span>&nbsp;<span class="op" id="4996164">=</span>&nbsp;<span class="builtinfunc" id="4996166">append</span><span class="op" id="4996172">(</span><span class="op" id="4996173">(</span><span class="op" id="4996174">*</span><span class="ident" id="4996175">s</span><span class="op" id="4996176">)</span><span class="op" id="4996177">,</span>&nbsp;<span class="ident" id="4996179">n</span><span class="op" id="4996180">)</span><br>
<span class="lineno"></span><span class="op" id="4996182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4996185">//&nbsp;pop&nbsp;pops&nbsp;all&nbsp;nodes&nbsp;that&nbsp;appear&nbsp;lexically&nbsp;before&nbsp;pos</span><br>
<span class="lineno"></span><span class="comment" id="4996240">//&nbsp;(i.e.,&nbsp;whose&nbsp;lexical&nbsp;extent&nbsp;has&nbsp;ended&nbsp;before&nbsp;or&nbsp;at&nbsp;pos).</span><br>
<span class="lineno">115</span><span class="comment" id="4996300">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;last&nbsp;node&nbsp;popped.</span><br>
<span class="lineno"></span><span class="comment" id="4996336">//</span><br>
<span class="lineno"></span><span class="keyword" id="4996339">func</span>&nbsp;<span class="op" id="4996344">(</span><span class="ident" id="4996345">s</span>&nbsp;<span class="op" id="4996347">*</span><span class="ident" id="4996348">nodeStack</span><span class="op" id="4996357">)</span>&nbsp;<span class="ident" id="4996359">pop</span><span class="op" id="4996362">(</span><span class="ident" id="4996363">pos</span>&nbsp;<span class="ident" id="4996367">token</span><span class="op" id="4996372">.</span><span class="ident" id="4996373">Pos</span><span class="op" id="4996376">)</span>&nbsp;<span class="op" id="4996378">(</span><span class="ident" id="4996379">top</span>&nbsp;<span class="ident" id="4996383">Node</span><span class="op" id="4996387">)</span>&nbsp;<span class="op" id="4996389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4996392">i</span>&nbsp;<span class="op" id="4996394">:=</span>&nbsp;<span class="builtinfunc" id="4996397">len</span><span class="op" id="4996400">(</span><span class="op" id="4996401">*</span><span class="ident" id="4996402">s</span><span class="op" id="4996403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4996406">for</span>&nbsp;<span class="ident" id="4996410">i</span>&nbsp;<span class="op" id="4996412">&gt;</span>&nbsp;<span class="num" id="4996414">0</span>&nbsp;<span class="op" id="4996416">&amp;&amp;</span>&nbsp;<span class="op" id="4996419">(</span><span class="op" id="4996420">*</span><span class="ident" id="4996421">s</span><span class="op" id="4996422">)</span><span class="op" id="4996423">[</span><span class="ident" id="4996424">i</span><span class="op" id="4996425">-</span><span class="num" id="4996426">1</span><span class="op" id="4996427">]</span><span class="op" id="4996428">.</span><span class="ident" id="4996429">End</span><span class="op" id="4996432">(</span><span class="op" id="4996433">)</span>&nbsp;<span class="op" id="4996435">&lt;=</span>&nbsp;<span class="ident" id="4996438">pos</span>&nbsp;<span class="op" id="4996442">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4996446">top</span>&nbsp;<span class="op" id="4996450">=</span>&nbsp;<span class="op" id="4996452">(</span><span class="op" id="4996453">*</span><span class="ident" id="4996454">s</span><span class="op" id="4996455">)</span><span class="op" id="4996456">[</span><span class="ident" id="4996457">i</span><span class="op" id="4996458">-</span><span class="num" id="4996459">1</span><span class="op" id="4996460">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4996464">i</span><span class="op" id="4996465">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4996469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4996472">*</span><span class="ident" id="4996473">s</span>&nbsp;<span class="op" id="4996475">=</span>&nbsp;<span class="op" id="4996477">(</span><span class="op" id="4996478">*</span><span class="ident" id="4996479">s</span><span class="op" id="4996480">)</span><span class="op" id="4996481">[</span><span class="num" id="4996482">0</span><span class="op" id="4996483">:</span><span class="ident" id="4996484">i</span><span class="op" id="4996485">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4996488">return</span>&nbsp;<span class="ident" id="4996495">top</span><br>
<span class="lineno">125</span><span class="op" id="4996499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4996502">//&nbsp;NewCommentMap&nbsp;creates&nbsp;a&nbsp;new&nbsp;comment&nbsp;map&nbsp;by&nbsp;associating&nbsp;comment&nbsp;groups</span><br>
<span class="lineno"></span><span class="comment" id="4996575">//&nbsp;of&nbsp;the&nbsp;comments&nbsp;list&nbsp;with&nbsp;the&nbsp;nodes&nbsp;of&nbsp;the&nbsp;AST&nbsp;specified&nbsp;by&nbsp;node.</span><br>
<span class="lineno"></span><span class="comment" id="4996644">//</span><br>
<span class="lineno">130</span><span class="comment" id="4996647">//&nbsp;A&nbsp;comment&nbsp;group&nbsp;g&nbsp;is&nbsp;associated&nbsp;with&nbsp;a&nbsp;node&nbsp;n&nbsp;if:</span><br>
<span class="lineno"></span><span class="comment" id="4996700">//</span><br>
<span class="lineno"></span><span class="comment" id="4996703">//&nbsp;&nbsp;&nbsp;-&nbsp;g&nbsp;starts&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;as&nbsp;n&nbsp;ends</span><br>
<span class="lineno"></span><span class="comment" id="4996746">//&nbsp;&nbsp;&nbsp;-&nbsp;g&nbsp;starts&nbsp;on&nbsp;the&nbsp;line&nbsp;immediately&nbsp;following&nbsp;n,&nbsp;and&nbsp;there&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4996812">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;least&nbsp;one&nbsp;empty&nbsp;line&nbsp;after&nbsp;g&nbsp;and&nbsp;before&nbsp;the&nbsp;next&nbsp;node</span><br>
<span class="lineno">135</span><span class="comment" id="4996876">//&nbsp;&nbsp;&nbsp;-&nbsp;g&nbsp;starts&nbsp;before&nbsp;n&nbsp;and&nbsp;is&nbsp;not&nbsp;associated&nbsp;to&nbsp;the&nbsp;node&nbsp;before&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="4996944">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;via&nbsp;the&nbsp;previous&nbsp;rules</span><br>
<span class="lineno"></span><span class="comment" id="4996974">//</span><br>
<span class="lineno"></span><span class="comment" id="4996977">//&nbsp;NewCommentMap&nbsp;tries&nbsp;to&nbsp;associate&nbsp;a&nbsp;comment&nbsp;group&nbsp;to&nbsp;the&nbsp;&#34;largest&#34;</span><br>
<span class="lineno"></span><span class="comment" id="4997046">//&nbsp;node&nbsp;possible:&nbsp;For&nbsp;instance,&nbsp;if&nbsp;the&nbsp;comment&nbsp;is&nbsp;a&nbsp;line&nbsp;comment</span><br>
<span class="lineno">140</span><span class="comment" id="4997111">//&nbsp;trailing&nbsp;an&nbsp;assignment,&nbsp;the&nbsp;comment&nbsp;is&nbsp;associated&nbsp;with&nbsp;the&nbsp;entire</span><br>
<span class="lineno"></span><span class="comment" id="4997180">//&nbsp;assignment&nbsp;rather&nbsp;than&nbsp;just&nbsp;the&nbsp;last&nbsp;operand&nbsp;in&nbsp;the&nbsp;assignment.</span><br>
<span class="lineno"></span><span class="comment" id="4997247">//</span><br>
<span class="lineno"></span><span class="keyword" id="4997250">func</span>&nbsp;<span class="ident" id="4997255">NewCommentMap</span><span class="op" id="4997268">(</span><span class="ident" id="4997269">fset</span>&nbsp;<span class="op" id="4997274">*</span><span class="ident" id="4997275">token</span><span class="op" id="4997280">.</span><span class="ident" id="4997281">FileSet</span><span class="op" id="4997288">,</span>&nbsp;<span class="ident" id="4997290">node</span>&nbsp;<span class="ident" id="4997295">Node</span><span class="op" id="4997299">,</span>&nbsp;<span class="ident" id="4997301">comments</span>&nbsp;<span class="op" id="4997310">[</span><span class="op" id="4997311">]</span><span class="op" id="4997312">*</span><span class="ident" id="4997313">CommentGroup</span><span class="op" id="4997325">)</span>&nbsp;<span class="ident" id="4997327">CommentMap</span>&nbsp;<span class="op" id="4997338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4997341">if</span>&nbsp;<span class="builtinfunc" id="4997344">len</span><span class="op" id="4997347">(</span><span class="ident" id="4997348">comments</span><span class="op" id="4997356">)</span>&nbsp;<span class="op" id="4997358">==</span>&nbsp;<span class="num" id="4997361">0</span>&nbsp;<span class="op" id="4997363">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4997367">return</span>&nbsp;<span class="builtintype" id="4997374">nil</span>&nbsp;<span class="comment" id="4997378">//&nbsp;no&nbsp;comments&nbsp;to&nbsp;map</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4997401">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4997405">cmap</span>&nbsp;<span class="op" id="4997410">:=</span>&nbsp;<span class="builtinfunc" id="4997413">make</span><span class="op" id="4997417">(</span><span class="ident" id="4997418">CommentMap</span><span class="op" id="4997428">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4997432">//&nbsp;set&nbsp;up&nbsp;comment&nbsp;reader&nbsp;r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4997460">tmp</span>&nbsp;<span class="op" id="4997464">:=</span>&nbsp;<span class="builtinfunc" id="4997467">make</span><span class="op" id="4997471">(</span><span class="op" id="4997472">[</span><span class="op" id="4997473">]</span><span class="op" id="4997474">*</span><span class="ident" id="4997475">CommentGroup</span><span class="op" id="4997487">,</span>&nbsp;<span class="builtinfunc" id="4997489">len</span><span class="op" id="4997492">(</span><span class="ident" id="4997493">comments</span><span class="op" id="4997501">)</span><span class="op" id="4997502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4997505">copy</span><span class="op" id="4997509">(</span><span class="ident" id="4997510">tmp</span><span class="op" id="4997513">,</span>&nbsp;<span class="ident" id="4997515">comments</span><span class="op" id="4997523">)</span>&nbsp;<span class="comment" id="4997525">//&nbsp;don&#39;t&nbsp;change&nbsp;incoming&nbsp;comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4997560">sortComments</span><span class="op" id="4997572">(</span><span class="ident" id="4997573">tmp</span><span class="op" id="4997576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4997579">r</span>&nbsp;<span class="op" id="4997581">:=</span>&nbsp;<span class="ident" id="4997584">commentListReader</span><span class="op" id="4997601">{</span><span class="ident" id="4997602">fset</span><span class="op" id="4997606">:</span>&nbsp;<span class="ident" id="4997608">fset</span><span class="op" id="4997612">,</span>&nbsp;<span class="ident" id="4997614">list</span><span class="op" id="4997618">:</span>&nbsp;<span class="ident" id="4997620">tmp</span><span class="op" id="4997623">}</span>&nbsp;<span class="comment" id="4997625">//&nbsp;!r.eol()&nbsp;because&nbsp;len(comments)&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4997664">r</span><span class="op" id="4997665">.</span><span class="ident" id="4997666">next</span><span class="op" id="4997670">(</span><span class="op" id="4997671">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4997675">//&nbsp;create&nbsp;node&nbsp;list&nbsp;in&nbsp;lexical&nbsp;order</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4997713">nodes</span>&nbsp;<span class="op" id="4997719">:=</span>&nbsp;<span class="ident" id="4997722">nodeList</span><span class="op" id="4997730">(</span><span class="ident" id="4997731">node</span><span class="op" id="4997735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4997738">nodes</span>&nbsp;<span class="op" id="4997744">=</span>&nbsp;<span class="builtinfunc" id="4997746">append</span><span class="op" id="4997752">(</span><span class="ident" id="4997753">nodes</span><span class="op" id="4997758">,</span>&nbsp;<span class="builtintype" id="4997760">nil</span><span class="op" id="4997763">)</span>&nbsp;<span class="comment" id="4997765">//&nbsp;append&nbsp;sentinel</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4997786">//&nbsp;set&nbsp;up&nbsp;iteration&nbsp;variables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4997817">var</span>&nbsp;<span class="op" id="4997821">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4997825">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4997831">Node</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4997846">//&nbsp;previous&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4997865">pend</span>&nbsp;&nbsp;<span class="ident" id="4997871">token</span><span class="op" id="4997876">.</span><span class="ident" id="4997877">Position</span>&nbsp;<span class="comment" id="4997886">//&nbsp;end&nbsp;of&nbsp;p</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4997900">pg</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4997906">Node</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4997921">//&nbsp;previous&nbsp;node&nbsp;group&nbsp;(enclosing&nbsp;nodes&nbsp;of&nbsp;&#34;importance&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4997980">pgend</span>&nbsp;<span class="ident" id="4997986">token</span><span class="op" id="4997991">.</span><span class="ident" id="4997992">Position</span>&nbsp;<span class="comment" id="4998001">//&nbsp;end&nbsp;of&nbsp;pg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4998016">stack</span>&nbsp;<span class="ident" id="4998022">nodeStack</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4998037">//&nbsp;stack&nbsp;of&nbsp;node&nbsp;groups</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4998062">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4998066">for</span>&nbsp;<span class="ident" id="4998070">_</span><span class="op" id="4998071">,</span>&nbsp;<span class="ident" id="4998073">q</span>&nbsp;<span class="op" id="4998075">:=</span>&nbsp;<span class="keyword" id="4998078">range</span>&nbsp;<span class="ident" id="4998084">nodes</span>&nbsp;<span class="op" id="4998090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4998094">var</span>&nbsp;<span class="ident" id="4998098">qpos</span>&nbsp;<span class="ident" id="4998103">token</span><span class="op" id="4998108">.</span><span class="ident" id="4998109">Position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4998120">if</span>&nbsp;<span class="ident" id="4998123">q</span>&nbsp;<span class="op" id="4998125">!=</span>&nbsp;<span class="builtintype" id="4998128">nil</span>&nbsp;<span class="op" id="4998132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4998137">qpos</span>&nbsp;<span class="op" id="4998142">=</span>&nbsp;<span class="ident" id="4998144">fset</span><span class="op" id="4998148">.</span><span class="ident" id="4998149">Position</span><span class="op" id="4998157">(</span><span class="ident" id="4998158">q</span><span class="op" id="4998159">.</span><span class="ident" id="4998160">Pos</span><span class="op" id="4998163">(</span><span class="op" id="4998164">)</span><span class="op" id="4998165">)</span>&nbsp;<span class="comment" id="4998167">//&nbsp;current&nbsp;node&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4998194">}</span>&nbsp;<span class="keyword" id="4998196">else</span>&nbsp;<span class="op" id="4998201">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4998206">//&nbsp;set&nbsp;fake&nbsp;sentinel&nbsp;position&nbsp;to&nbsp;infinity&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4998259">//&nbsp;all&nbsp;comments&nbsp;get&nbsp;processed&nbsp;before&nbsp;the&nbsp;sentinel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4998312">const</span>&nbsp;<span class="ident" id="4998318">infinity</span>&nbsp;<span class="op" id="4998327">=</span>&nbsp;<span class="num" id="4998329">1</span>&nbsp;<span class="op" id="4998331">&lt;&lt;</span>&nbsp;<span class="num" id="4998334">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4998340">qpos</span><span class="op" id="4998344">.</span><span class="ident" id="4998345">Offset</span>&nbsp;<span class="op" id="4998352">=</span>&nbsp;<span class="ident" id="4998354">infinity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4998366">qpos</span><span class="op" id="4998370">.</span><span class="ident" id="4998371">Line</span>&nbsp;<span class="op" id="4998376">=</span>&nbsp;<span class="ident" id="4998378">infinity</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4998389">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4998394">//&nbsp;process&nbsp;comments&nbsp;before&nbsp;current&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4998436">for</span>&nbsp;<span class="ident" id="4998440">r</span><span class="op" id="4998441">.</span><span class="ident" id="4998442">end</span><span class="op" id="4998445">.</span><span class="ident" id="4998446">Offset</span>&nbsp;<span class="op" id="4998453">&lt;=</span>&nbsp;<span class="ident" id="4998456">qpos</span><span class="op" id="4998460">.</span><span class="ident" id="4998461">Offset</span>&nbsp;<span class="op" id="4998468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4998473">//&nbsp;determine&nbsp;recent&nbsp;node&nbsp;group</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4998507">if</span>&nbsp;<span class="ident" id="4998510">top</span>&nbsp;<span class="op" id="4998514">:=</span>&nbsp;<span class="ident" id="4998517">stack</span><span class="op" id="4998522">.</span><span class="ident" id="4998523">pop</span><span class="op" id="4998526">(</span><span class="ident" id="4998527">r</span><span class="op" id="4998528">.</span><span class="ident" id="4998529">comment</span><span class="op" id="4998536">.</span><span class="ident" id="4998537">Pos</span><span class="op" id="4998540">(</span><span class="op" id="4998541">)</span><span class="op" id="4998542">)</span><span class="op" id="4998543">;</span>&nbsp;<span class="ident" id="4998545">top</span>&nbsp;<span class="op" id="4998549">!=</span>&nbsp;<span class="builtintype" id="4998552">nil</span>&nbsp;<span class="op" id="4998556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4998562">pg</span>&nbsp;<span class="op" id="4998565">=</span>&nbsp;<span class="ident" id="4998567">top</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4998575">pgend</span>&nbsp;<span class="op" id="4998581">=</span>&nbsp;<span class="ident" id="4998583">fset</span><span class="op" id="4998587">.</span><span class="ident" id="4998588">Position</span><span class="op" id="4998596">(</span><span class="ident" id="4998597">pg</span><span class="op" id="4998599">.</span><span class="ident" id="4998600">End</span><span class="op" id="4998603">(</span><span class="op" id="4998604">)</span><span class="op" id="4998605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4998610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4998615">//&nbsp;Try&nbsp;to&nbsp;associate&nbsp;a&nbsp;comment&nbsp;first&nbsp;with&nbsp;a&nbsp;node&nbsp;group</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4998672">//&nbsp;(i.e.,&nbsp;a&nbsp;node&nbsp;of&nbsp;&#34;importance&#34;&nbsp;such&nbsp;as&nbsp;a&nbsp;declaration);</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4998732">//&nbsp;if&nbsp;that&nbsp;fails,&nbsp;try&nbsp;to&nbsp;associate&nbsp;it&nbsp;with&nbsp;the&nbsp;most&nbsp;recent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4998794">//&nbsp;node.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4998806">//&nbsp;TODO(gri)&nbsp;try&nbsp;to&nbsp;simplify&nbsp;the&nbsp;logic&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4998854">var</span>&nbsp;<span class="ident" id="4998858">assoc</span>&nbsp;<span class="ident" id="4998864">Node</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4998872">switch</span>&nbsp;<span class="op" id="4998879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4998884">case</span>&nbsp;<span class="ident" id="4998889">pg</span>&nbsp;<span class="op" id="4998892">!=</span>&nbsp;<span class="builtintype" id="4998895">nil</span>&nbsp;<span class="op" id="4998899">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4998906">(</span><span class="ident" id="4998907">pgend</span><span class="op" id="4998912">.</span><span class="ident" id="4998913">Line</span>&nbsp;<span class="op" id="4998918">==</span>&nbsp;<span class="ident" id="4998921">r</span><span class="op" id="4998922">.</span><span class="ident" id="4998923">pos</span><span class="op" id="4998926">.</span><span class="ident" id="4998927">Line</span>&nbsp;<span class="op" id="4998932">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4998940">pgend</span><span class="op" id="4998945">.</span><span class="ident" id="4998946">Line</span><span class="op" id="4998950">+</span><span class="num" id="4998951">1</span>&nbsp;<span class="op" id="4998953">==</span>&nbsp;<span class="ident" id="4998956">r</span><span class="op" id="4998957">.</span><span class="ident" id="4998958">pos</span><span class="op" id="4998961">.</span><span class="ident" id="4998962">Line</span>&nbsp;<span class="op" id="4998967">&amp;&amp;</span>&nbsp;<span class="ident" id="4998970">r</span><span class="op" id="4998971">.</span><span class="ident" id="4998972">end</span><span class="op" id="4998975">.</span><span class="ident" id="4998976">Line</span><span class="op" id="4998980">+</span><span class="num" id="4998981">1</span>&nbsp;<span class="op" id="4998983">&lt;</span>&nbsp;<span class="ident" id="4998985">qpos</span><span class="op" id="4998989">.</span><span class="ident" id="4998990">Line</span><span class="op" id="4998994">)</span><span class="op" id="4998995">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4999001">//&nbsp;1)&nbsp;comment&nbsp;starts&nbsp;on&nbsp;same&nbsp;line&nbsp;as&nbsp;previous&nbsp;node&nbsp;group&nbsp;ends,&nbsp;or</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4999071">//&nbsp;2)&nbsp;comment&nbsp;starts&nbsp;on&nbsp;the&nbsp;line&nbsp;immediately&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4999130">//&nbsp;&nbsp;&nbsp;&nbsp;previous&nbsp;node&nbsp;group&nbsp;and&nbsp;there&nbsp;is&nbsp;an&nbsp;empty&nbsp;line&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4999194">//&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;current&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4999221">//&nbsp;=&gt;&nbsp;associate&nbsp;comment&nbsp;with&nbsp;previous&nbsp;node&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4999274">assoc</span>&nbsp;<span class="op" id="4999280">=</span>&nbsp;<span class="ident" id="4999282">pg</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4999288">case</span>&nbsp;<span class="ident" id="4999293">p</span>&nbsp;<span class="op" id="4999295">!=</span>&nbsp;<span class="builtintype" id="4999298">nil</span>&nbsp;<span class="op" id="4999302">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4999309">(</span><span class="ident" id="4999310">pend</span><span class="op" id="4999314">.</span><span class="ident" id="4999315">Line</span>&nbsp;<span class="op" id="4999320">==</span>&nbsp;<span class="ident" id="4999323">r</span><span class="op" id="4999324">.</span><span class="ident" id="4999325">pos</span><span class="op" id="4999328">.</span><span class="ident" id="4999329">Line</span>&nbsp;<span class="op" id="4999334">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4999342">pend</span><span class="op" id="4999346">.</span><span class="ident" id="4999347">Line</span><span class="op" id="4999351">+</span><span class="num" id="4999352">1</span>&nbsp;<span class="op" id="4999354">==</span>&nbsp;<span class="ident" id="4999357">r</span><span class="op" id="4999358">.</span><span class="ident" id="4999359">pos</span><span class="op" id="4999362">.</span><span class="ident" id="4999363">Line</span>&nbsp;<span class="op" id="4999368">&amp;&amp;</span>&nbsp;<span class="ident" id="4999371">r</span><span class="op" id="4999372">.</span><span class="ident" id="4999373">end</span><span class="op" id="4999376">.</span><span class="ident" id="4999377">Line</span><span class="op" id="4999381">+</span><span class="num" id="4999382">1</span>&nbsp;<span class="op" id="4999384">&lt;</span>&nbsp;<span class="ident" id="4999386">qpos</span><span class="op" id="4999390">.</span><span class="ident" id="4999391">Line</span>&nbsp;<span class="op" id="4999396">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4999404">q</span>&nbsp;<span class="op" id="4999406">==</span>&nbsp;<span class="builtintype" id="4999409">nil</span><span class="op" id="4999412">)</span><span class="op" id="4999413">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4999419">//&nbsp;same&nbsp;rules&nbsp;apply&nbsp;as&nbsp;above&nbsp;for&nbsp;p&nbsp;rather&nbsp;than&nbsp;pg,</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4999474">//&nbsp;but&nbsp;also&nbsp;associate&nbsp;with&nbsp;p&nbsp;if&nbsp;we&nbsp;are&nbsp;at&nbsp;the&nbsp;end&nbsp;(q&nbsp;==&nbsp;nil)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4999539">assoc</span>&nbsp;<span class="op" id="4999545">=</span>&nbsp;<span class="ident" id="4999547">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4999552">default</span><span class="op" id="4999559">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4999565">//&nbsp;otherwise,&nbsp;associate&nbsp;comment&nbsp;with&nbsp;current&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4999619">if</span>&nbsp;<span class="ident" id="4999622">q</span>&nbsp;<span class="op" id="4999624">==</span>&nbsp;<span class="builtintype" id="4999627">nil</span>&nbsp;<span class="op" id="4999631">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4999638">//&nbsp;we&nbsp;can&nbsp;only&nbsp;reach&nbsp;here&nbsp;if&nbsp;there&nbsp;was&nbsp;no&nbsp;p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4999687">//&nbsp;which&nbsp;would&nbsp;imply&nbsp;that&nbsp;there&nbsp;were&nbsp;no&nbsp;nodes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4999738">panic</span><span class="op" id="4999743">(</span><span class="string" id="4999744">&#34;internal&nbsp;error:&nbsp;no&nbsp;comments&nbsp;should&nbsp;be&nbsp;associated&nbsp;with&nbsp;sentinel&#34;</span><span class="op" id="4999808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4999814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4999820">assoc</span>&nbsp;<span class="op" id="4999826">=</span>&nbsp;<span class="ident" id="4999828">q</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4999833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4999838">cmap</span><span class="op" id="4999842">.</span><span class="ident" id="4999843">addComment</span><span class="op" id="4999853">(</span><span class="ident" id="4999854">assoc</span><span class="op" id="4999859">,</span>&nbsp;<span class="ident" id="4999861">r</span><span class="op" id="4999862">.</span><span class="ident" id="4999863">comment</span><span class="op" id="4999870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4999875">if</span>&nbsp;<span class="ident" id="4999878">r</span><span class="op" id="4999879">.</span><span class="ident" id="4999880">eol</span><span class="op" id="4999883">(</span><span class="op" id="4999884">)</span>&nbsp;<span class="op" id="4999886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4999892">return</span>&nbsp;<span class="ident" id="4999899">cmap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4999907">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4999912">r</span><span class="op" id="4999913">.</span><span class="ident" id="4999914">next</span><span class="op" id="4999918">(</span><span class="op" id="4999919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4999923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4999928">//&nbsp;update&nbsp;previous&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4999954">p</span>&nbsp;<span class="op" id="4999956">=</span>&nbsp;<span class="ident" id="4999958">q</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4999962">pend</span>&nbsp;<span class="op" id="4999967">=</span>&nbsp;<span class="ident" id="4999969">fset</span><span class="op" id="4999973">.</span><span class="ident" id="4999974">Position</span><span class="op" id="4999982">(</span><span class="ident" id="4999983">p</span><span class="op" id="4999984">.</span><span class="ident" id="4999985">End</span><span class="op" id="4999988">(</span><span class="op" id="4999989">)</span><span class="op" id="4999990">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4999995">//&nbsp;update&nbsp;previous&nbsp;node&nbsp;group&nbsp;if&nbsp;we&nbsp;see&nbsp;an&nbsp;&#34;important&#34;&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5000057">switch</span>&nbsp;<span class="ident" id="5000064">q</span><span class="op" id="5000065">.</span><span class="op" id="5000066">(</span><span class="keyword" id="5000067">type</span><span class="op" id="5000071">)</span>&nbsp;<span class="op" id="5000073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5000077">case</span>&nbsp;<span class="op" id="5000082">*</span><span class="ident" id="5000083">File</span><span class="op" id="5000087">,</span>&nbsp;<span class="op" id="5000089">*</span><span class="ident" id="5000090">Field</span><span class="op" id="5000095">,</span>&nbsp;<span class="ident" id="5000097">Decl</span><span class="op" id="5000101">,</span>&nbsp;<span class="ident" id="5000103">Spec</span><span class="op" id="5000107">,</span>&nbsp;<span class="ident" id="5000109">Stmt</span><span class="op" id="5000113">:</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5000118">stack</span><span class="op" id="5000123">.</span><span class="ident" id="5000124">push</span><span class="op" id="5000128">(</span><span class="ident" id="5000129">q</span><span class="op" id="5000130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5000134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5000137">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5000141">return</span>&nbsp;<span class="ident" id="5000148">cmap</span><br>
<span class="lineno">240</span><span class="op" id="5000153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5000156">//&nbsp;Update&nbsp;replaces&nbsp;an&nbsp;old&nbsp;node&nbsp;in&nbsp;the&nbsp;comment&nbsp;map&nbsp;with&nbsp;the&nbsp;new&nbsp;node</span><br>
<span class="lineno"></span><span class="comment" id="5000224">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;node.&nbsp;Comments&nbsp;that&nbsp;were&nbsp;associated&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5000292">//&nbsp;old&nbsp;node&nbsp;are&nbsp;associated&nbsp;with&nbsp;the&nbsp;new&nbsp;node.</span><br>
<span class="lineno">245</span><span class="comment" id="5000338">//</span><br>
<span class="lineno"></span><span class="keyword" id="5000341">func</span>&nbsp;<span class="op" id="5000346">(</span><span class="ident" id="5000347">cmap</span>&nbsp;<span class="ident" id="5000352">CommentMap</span><span class="op" id="5000362">)</span>&nbsp;<span class="ident" id="5000364">Update</span><span class="op" id="5000370">(</span><span class="ident" id="5000371">old</span><span class="op" id="5000374">,</span>&nbsp;<span class="builtinfunc" id="5000376">new</span>&nbsp;<span class="ident" id="5000380">Node</span><span class="op" id="5000384">)</span>&nbsp;<span class="ident" id="5000386">Node</span>&nbsp;<span class="op" id="5000391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5000394">if</span>&nbsp;<span class="ident" id="5000397">list</span>&nbsp;<span class="op" id="5000402">:=</span>&nbsp;<span class="ident" id="5000405">cmap</span><span class="op" id="5000409">[</span><span class="ident" id="5000410">old</span><span class="op" id="5000413">]</span><span class="op" id="5000414">;</span>&nbsp;<span class="builtinfunc" id="5000416">len</span><span class="op" id="5000419">(</span><span class="ident" id="5000420">list</span><span class="op" id="5000424">)</span>&nbsp;<span class="op" id="5000426">&gt;</span>&nbsp;<span class="num" id="5000428">0</span>&nbsp;<span class="op" id="5000430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5000434">delete</span><span class="op" id="5000440">(</span><span class="ident" id="5000441">cmap</span><span class="op" id="5000445">,</span>&nbsp;<span class="ident" id="5000447">old</span><span class="op" id="5000450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5000454">cmap</span><span class="op" id="5000458">[</span><span class="builtinfunc" id="5000459">new</span><span class="op" id="5000462">]</span>&nbsp;<span class="op" id="5000464">=</span>&nbsp;<span class="builtinfunc" id="5000466">append</span><span class="op" id="5000472">(</span><span class="ident" id="5000473">cmap</span><span class="op" id="5000477">[</span><span class="builtinfunc" id="5000478">new</span><span class="op" id="5000481">]</span><span class="op" id="5000482">,</span>&nbsp;<span class="ident" id="5000484">list</span><span class="op" id="5000488">...</span><span class="op" id="5000491">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5000494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5000497">return</span>&nbsp;<span class="builtinfunc" id="5000504">new</span><br>
<span class="lineno"></span><span class="op" id="5000508">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5000511">//&nbsp;Filter&nbsp;returns&nbsp;a&nbsp;new&nbsp;comment&nbsp;map&nbsp;consisting&nbsp;of&nbsp;only&nbsp;those</span><br>
<span class="lineno">255</span><span class="comment" id="5000572">//&nbsp;entries&nbsp;of&nbsp;cmap&nbsp;for&nbsp;which&nbsp;a&nbsp;corresponding&nbsp;node&nbsp;exists&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="5000632">//&nbsp;the&nbsp;AST&nbsp;specified&nbsp;by&nbsp;node.</span><br>
<span class="lineno"></span><span class="comment" id="5000662">//</span><br>
<span class="lineno"></span><span class="keyword" id="5000665">func</span>&nbsp;<span class="op" id="5000670">(</span><span class="ident" id="5000671">cmap</span>&nbsp;<span class="ident" id="5000676">CommentMap</span><span class="op" id="5000686">)</span>&nbsp;<span class="ident" id="5000688">Filter</span><span class="op" id="5000694">(</span><span class="ident" id="5000695">node</span>&nbsp;<span class="ident" id="5000700">Node</span><span class="op" id="5000704">)</span>&nbsp;<span class="ident" id="5000706">CommentMap</span>&nbsp;<span class="op" id="5000717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5000720">umap</span>&nbsp;<span class="op" id="5000725">:=</span>&nbsp;<span class="builtinfunc" id="5000728">make</span><span class="op" id="5000732">(</span><span class="ident" id="5000733">CommentMap</span><span class="op" id="5000743">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5000746">Inspect</span><span class="op" id="5000753">(</span><span class="ident" id="5000754">node</span><span class="op" id="5000758">,</span>&nbsp;<span class="keyword" id="5000760">func</span><span class="op" id="5000764">(</span><span class="ident" id="5000765">n</span>&nbsp;<span class="ident" id="5000767">Node</span><span class="op" id="5000771">)</span>&nbsp;<span class="builtintype" id="5000773">bool</span>&nbsp;<span class="op" id="5000778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5000782">if</span>&nbsp;<span class="ident" id="5000785">g</span>&nbsp;<span class="op" id="5000787">:=</span>&nbsp;<span class="ident" id="5000790">cmap</span><span class="op" id="5000794">[</span><span class="ident" id="5000795">n</span><span class="op" id="5000796">]</span><span class="op" id="5000797">;</span>&nbsp;<span class="builtinfunc" id="5000799">len</span><span class="op" id="5000802">(</span><span class="ident" id="5000803">g</span><span class="op" id="5000804">)</span>&nbsp;<span class="op" id="5000806">&gt;</span>&nbsp;<span class="num" id="5000808">0</span>&nbsp;<span class="op" id="5000810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5000815">umap</span><span class="op" id="5000819">[</span><span class="ident" id="5000820">n</span><span class="op" id="5000821">]</span>&nbsp;<span class="op" id="5000823">=</span>&nbsp;<span class="ident" id="5000825">g</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5000829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5000833">return</span>&nbsp;<span class="builtintype" id="5000840">true</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5000846">}</span><span class="op" id="5000847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5000850">return</span>&nbsp;<span class="ident" id="5000857">umap</span><br>
<span class="lineno"></span><span class="op" id="5000862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5000865">//&nbsp;Comments&nbsp;returns&nbsp;the&nbsp;list&nbsp;of&nbsp;comment&nbsp;groups&nbsp;in&nbsp;the&nbsp;comment&nbsp;map.</span><br>
<span class="lineno">270</span><span class="comment" id="5000932">//&nbsp;The&nbsp;result&nbsp;is&nbsp;sorted&nbsp;is&nbsp;source&nbsp;order.</span><br>
<span class="lineno"></span><span class="comment" id="5000973">//</span><br>
<span class="lineno"></span><span class="keyword" id="5000976">func</span>&nbsp;<span class="op" id="5000981">(</span><span class="ident" id="5000982">cmap</span>&nbsp;<span class="ident" id="5000987">CommentMap</span><span class="op" id="5000997">)</span>&nbsp;<span class="ident" id="5000999">Comments</span><span class="op" id="5001007">(</span><span class="op" id="5001008">)</span>&nbsp;<span class="op" id="5001010">[</span><span class="op" id="5001011">]</span><span class="op" id="5001012">*</span><span class="ident" id="5001013">CommentGroup</span>&nbsp;<span class="op" id="5001026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5001029">list</span>&nbsp;<span class="op" id="5001034">:=</span>&nbsp;<span class="builtinfunc" id="5001037">make</span><span class="op" id="5001041">(</span><span class="op" id="5001042">[</span><span class="op" id="5001043">]</span><span class="op" id="5001044">*</span><span class="ident" id="5001045">CommentGroup</span><span class="op" id="5001057">,</span>&nbsp;<span class="num" id="5001059">0</span><span class="op" id="5001060">,</span>&nbsp;<span class="builtinfunc" id="5001062">len</span><span class="op" id="5001065">(</span><span class="ident" id="5001066">cmap</span><span class="op" id="5001070">)</span><span class="op" id="5001071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5001074">for</span>&nbsp;<span class="ident" id="5001078">_</span><span class="op" id="5001079">,</span>&nbsp;<span class="ident" id="5001081">e</span>&nbsp;<span class="op" id="5001083">:=</span>&nbsp;<span class="keyword" id="5001086">range</span>&nbsp;<span class="ident" id="5001092">cmap</span>&nbsp;<span class="op" id="5001097">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5001101">list</span>&nbsp;<span class="op" id="5001106">=</span>&nbsp;<span class="builtinfunc" id="5001108">append</span><span class="op" id="5001114">(</span><span class="ident" id="5001115">list</span><span class="op" id="5001119">,</span>&nbsp;<span class="ident" id="5001121">e</span><span class="op" id="5001122">...</span><span class="op" id="5001125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5001128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5001131">sortComments</span><span class="op" id="5001143">(</span><span class="ident" id="5001144">list</span><span class="op" id="5001148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5001151">return</span>&nbsp;<span class="ident" id="5001158">list</span><br>
<span class="lineno"></span><span class="op" id="5001163">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="5001166">func</span>&nbsp;<span class="ident" id="5001171">summary</span><span class="op" id="5001178">(</span><span class="ident" id="5001179">list</span>&nbsp;<span class="op" id="5001184">[</span><span class="op" id="5001185">]</span><span class="op" id="5001186">*</span><span class="ident" id="5001187">CommentGroup</span><span class="op" id="5001199">)</span>&nbsp;<span class="builtintype" id="5001201">string</span>&nbsp;<span class="op" id="5001208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5001211">const</span>&nbsp;<span class="ident" id="5001217">maxLen</span>&nbsp;<span class="op" id="5001224">=</span>&nbsp;<span class="num" id="5001226">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5001230">var</span>&nbsp;<span class="ident" id="5001234">buf</span>&nbsp;<span class="ident" id="5001238">bytes</span><span class="op" id="5001243">.</span><span class="ident" id="5001244">Buffer</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5001253">//&nbsp;collect&nbsp;comments&nbsp;text</span><br>
<span class="lineno"></span><span class="ident" id="5001278">loop</span><span class="op" id="5001282">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5001285">for</span>&nbsp;<span class="ident" id="5001289">_</span><span class="op" id="5001290">,</span>&nbsp;<span class="ident" id="5001292">group</span>&nbsp;<span class="op" id="5001298">:=</span>&nbsp;<span class="keyword" id="5001301">range</span>&nbsp;<span class="ident" id="5001307">list</span>&nbsp;<span class="op" id="5001312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5001316">//&nbsp;Note:&nbsp;CommentGroup.Text()&nbsp;does&nbsp;too&nbsp;much&nbsp;work&nbsp;for&nbsp;what&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5001378">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;need&nbsp;and&nbsp;would&nbsp;only&nbsp;replace&nbsp;this&nbsp;innermost&nbsp;loop.</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5001438">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Just&nbsp;do&nbsp;it&nbsp;explicitly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5001472">for</span>&nbsp;<span class="ident" id="5001476">_</span><span class="op" id="5001477">,</span>&nbsp;<span class="ident" id="5001479">comment</span>&nbsp;<span class="op" id="5001487">:=</span>&nbsp;<span class="keyword" id="5001490">range</span>&nbsp;<span class="ident" id="5001496">group</span><span class="op" id="5001501">.</span><span class="ident" id="5001502">List</span>&nbsp;<span class="op" id="5001507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5001512">if</span>&nbsp;<span class="ident" id="5001515">buf</span><span class="op" id="5001518">.</span><span class="ident" id="5001519">Len</span><span class="op" id="5001522">(</span><span class="op" id="5001523">)</span>&nbsp;<span class="op" id="5001525">&gt;=</span>&nbsp;<span class="ident" id="5001528">maxLen</span>&nbsp;<span class="op" id="5001535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5001541">break</span>&nbsp;<span class="ident" id="5001547">loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5001555">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5001560">buf</span><span class="op" id="5001563">.</span><span class="ident" id="5001564">WriteString</span><span class="op" id="5001575">(</span><span class="ident" id="5001576">comment</span><span class="op" id="5001583">.</span><span class="ident" id="5001584">Text</span><span class="op" id="5001588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5001592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5001595">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5001599">//&nbsp;truncate&nbsp;if&nbsp;too&nbsp;long</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5001624">if</span>&nbsp;<span class="ident" id="5001627">buf</span><span class="op" id="5001630">.</span><span class="ident" id="5001631">Len</span><span class="op" id="5001634">(</span><span class="op" id="5001635">)</span>&nbsp;<span class="op" id="5001637">&gt;</span>&nbsp;<span class="ident" id="5001639">maxLen</span>&nbsp;<span class="op" id="5001646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5001650">buf</span><span class="op" id="5001653">.</span><span class="ident" id="5001654">Truncate</span><span class="op" id="5001662">(</span><span class="ident" id="5001663">maxLen</span>&nbsp;<span class="op" id="5001670">-</span>&nbsp;<span class="num" id="5001672">3</span><span class="op" id="5001673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5001677">buf</span><span class="op" id="5001680">.</span><span class="ident" id="5001681">WriteString</span><span class="op" id="5001692">(</span><span class="string" id="5001693">&#34;...&#34;</span><span class="op" id="5001698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5001701">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5001705">//&nbsp;replace&nbsp;any&nbsp;invisibles&nbsp;with&nbsp;blanks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5001744">bytes</span>&nbsp;<span class="op" id="5001750">:=</span>&nbsp;<span class="ident" id="5001753">buf</span><span class="op" id="5001756">.</span><span class="ident" id="5001757">Bytes</span><span class="op" id="5001762">(</span><span class="op" id="5001763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5001766">for</span>&nbsp;<span class="ident" id="5001770">i</span><span class="op" id="5001771">,</span>&nbsp;<span class="ident" id="5001773">b</span>&nbsp;<span class="op" id="5001775">:=</span>&nbsp;<span class="keyword" id="5001778">range</span>&nbsp;<span class="ident" id="5001784">bytes</span>&nbsp;<span class="op" id="5001790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5001794">switch</span>&nbsp;<span class="ident" id="5001801">b</span>&nbsp;<span class="op" id="5001803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5001807">case</span>&nbsp;<span class="string" id="5001812">&#39;\t&#39;</span><span class="op" id="5001816">,</span>&nbsp;<span class="string" id="5001818">&#39;\n&#39;</span><span class="op" id="5001822">,</span>&nbsp;<span class="string" id="5001824">&#39;\r&#39;</span><span class="op" id="5001828">:</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5001833">bytes</span><span class="op" id="5001838">[</span><span class="ident" id="5001839">i</span><span class="op" id="5001840">]</span>&nbsp;<span class="op" id="5001842">=</span>&nbsp;<span class="string" id="5001844">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5001850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5001853">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5001857">return</span>&nbsp;<span class="builtintype" id="5001864">string</span><span class="op" id="5001870">(</span><span class="ident" id="5001871">bytes</span><span class="op" id="5001876">)</span><br>
<span class="lineno">315</span><span class="op" id="5001878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5001881">func</span>&nbsp;<span class="op" id="5001886">(</span><span class="ident" id="5001887">cmap</span>&nbsp;<span class="ident" id="5001892">CommentMap</span><span class="op" id="5001902">)</span>&nbsp;<span class="ident" id="5001904">String</span><span class="op" id="5001910">(</span><span class="op" id="5001911">)</span>&nbsp;<span class="builtintype" id="5001913">string</span>&nbsp;<span class="op" id="5001920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5001923">var</span>&nbsp;<span class="ident" id="5001927">buf</span>&nbsp;<span class="ident" id="5001931">bytes</span><span class="op" id="5001936">.</span><span class="ident" id="5001937">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5001945">fmt</span><span class="op" id="5001948">.</span><span class="ident" id="5001949">Fprintln</span><span class="op" id="5001957">(</span><span class="op" id="5001958">&amp;</span><span class="ident" id="5001959">buf</span><span class="op" id="5001962">,</span>&nbsp;<span class="string" id="5001964">&#34;CommentMap&nbsp;{&#34;</span><span class="op" id="5001978">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5001981">for</span>&nbsp;<span class="ident" id="5001985">node</span><span class="op" id="5001989">,</span>&nbsp;<span class="ident" id="5001991">comment</span>&nbsp;<span class="op" id="5001999">:=</span>&nbsp;<span class="keyword" id="5002002">range</span>&nbsp;<span class="ident" id="5002008">cmap</span>&nbsp;<span class="op" id="5002013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5002017">//&nbsp;print&nbsp;name&nbsp;of&nbsp;identifiers;&nbsp;print&nbsp;node&nbsp;type&nbsp;for&nbsp;other&nbsp;nodes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5002081">var</span>&nbsp;<span class="ident" id="5002085">s</span>&nbsp;<span class="builtintype" id="5002087">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5002096">if</span>&nbsp;<span class="ident" id="5002099">ident</span><span class="op" id="5002104">,</span>&nbsp;<span class="ident" id="5002106">ok</span>&nbsp;<span class="op" id="5002109">:=</span>&nbsp;<span class="ident" id="5002112">node</span><span class="op" id="5002116">.</span><span class="op" id="5002117">(</span><span class="op" id="5002118">*</span><span class="ident" id="5002119">Ident</span><span class="op" id="5002124">)</span><span class="op" id="5002125">;</span>&nbsp;<span class="ident" id="5002127">ok</span>&nbsp;<span class="op" id="5002130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5002135">s</span>&nbsp;<span class="op" id="5002137">=</span>&nbsp;<span class="ident" id="5002139">ident</span><span class="op" id="5002144">.</span><span class="ident" id="5002145">Name</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5002152">}</span>&nbsp;<span class="keyword" id="5002154">else</span>&nbsp;<span class="op" id="5002159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5002164">s</span>&nbsp;<span class="op" id="5002166">=</span>&nbsp;<span class="ident" id="5002168">fmt</span><span class="op" id="5002171">.</span><span class="ident" id="5002172">Sprintf</span><span class="op" id="5002179">(</span><span class="string" id="5002180">&#34;%T&#34;</span><span class="op" id="5002184">,</span>&nbsp;<span class="ident" id="5002186">node</span><span class="op" id="5002190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5002194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5002198">fmt</span><span class="op" id="5002201">.</span><span class="ident" id="5002202">Fprintf</span><span class="op" id="5002209">(</span><span class="op" id="5002210">&amp;</span><span class="ident" id="5002211">buf</span><span class="op" id="5002214">,</span>&nbsp;<span class="string" id="5002216">&#34;\t%p&nbsp;&nbsp;%20s:&nbsp;&nbsp;%s\n&#34;</span><span class="op" id="5002235">,</span>&nbsp;<span class="ident" id="5002237">node</span><span class="op" id="5002241">,</span>&nbsp;<span class="ident" id="5002243">s</span><span class="op" id="5002244">,</span>&nbsp;<span class="ident" id="5002246">summary</span><span class="op" id="5002253">(</span><span class="ident" id="5002254">comment</span><span class="op" id="5002261">)</span><span class="op" id="5002262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5002265">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5002268">fmt</span><span class="op" id="5002271">.</span><span class="ident" id="5002272">Fprintln</span><span class="op" id="5002280">(</span><span class="op" id="5002281">&amp;</span><span class="ident" id="5002282">buf</span><span class="op" id="5002285">,</span>&nbsp;<span class="string" id="5002287">&#34;}&#34;</span><span class="op" id="5002290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5002293">return</span>&nbsp;<span class="ident" id="5002300">buf</span><span class="op" id="5002303">.</span><span class="ident" id="5002304">String</span><span class="op" id="5002310">(</span><span class="op" id="5002311">)</span><br>
<span class="lineno"></span><span class="op" id="5002313">}</span>
</div>
</body>
</html>
