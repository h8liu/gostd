<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5428256">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5428311">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5428365">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5428416">//&nbsp;Package&nbsp;smtp&nbsp;implements&nbsp;the&nbsp;Simple&nbsp;Mail&nbsp;Transfer&nbsp;Protocol&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;5321.</span><br>
<span class="lineno"></span><span class="comment" id="5428501">//&nbsp;It&nbsp;also&nbsp;implements&nbsp;the&nbsp;following&nbsp;extensions:</span><br>
<span class="lineno"></span><span class="comment" id="5428549">//&nbsp;&nbsp;&nbsp;&nbsp8BITMIME&nbsp;&nbsp;RFC&nbsp;1652</span><br>
<span class="lineno"></span><span class="comment" id="5428571">//&nbsp;&nbsp;&nbsp;&nbspAUTH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RFC&nbsp;2554</span><br>
<span class="lineno"></span><span class="comment" id="5428593">//&nbsp;&nbsp;&nbsp;&nbspSTARTTLS&nbsp;&nbsp;RFC&nbsp;3207</span><br>
<span class="lineno">10</span><span class="comment" id="5428615">//&nbsp;Additional&nbsp;extensions&nbsp;may&nbsp;be&nbsp;handled&nbsp;by&nbsp;clients.</span><br>
<span class="lineno"></span><span class="keyword" id="5428667">package</span>&nbsp;<span class="ident" id="5428675">smtp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5428681">import</span>&nbsp;<span class="op" id="5428688">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5428691">&#34;crypto/tls&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5428705">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5428724">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5428734">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5428740">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5428747">&#34;net/textproto&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5428764">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="5428774">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5428777">//&nbsp;A&nbsp;Client&nbsp;represents&nbsp;a&nbsp;client&nbsp;connection&nbsp;to&nbsp;an&nbsp;SMTP&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="5428839">type</span>&nbsp;<span class="ident" id="5428844">Client</span>&nbsp;<span class="keyword" id="5428851">struct</span>&nbsp;<span class="op" id="5428858">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5428861">//&nbsp;Text&nbsp;is&nbsp;the&nbsp;textproto.Conn&nbsp;used&nbsp;by&nbsp;the&nbsp;Client.&nbsp;It&nbsp;is&nbsp;exported&nbsp;to&nbsp;allow&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5428940">//&nbsp;clients&nbsp;to&nbsp;add&nbsp;extensions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5428971">Text</span>&nbsp;<span class="op" id="5428976">*</span><span class="ident" id="5428977">textproto</span><span class="op" id="5428986">.</span><span class="ident" id="5428987">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5428993">//&nbsp;keep&nbsp;a&nbsp;reference&nbsp;to&nbsp;the&nbsp;connection&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;create&nbsp;a&nbsp;TLS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5429066">//&nbsp;connection&nbsp;later</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429087">conn</span>&nbsp;<span class="ident" id="5429092">net</span><span class="op" id="5429095">.</span><span class="ident" id="5429096">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5429102">//&nbsp;whether&nbsp;the&nbsp;Client&nbsp;is&nbsp;using&nbsp;TLS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429138">tls</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5429149">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429155">serverName</span>&nbsp;<span class="builtintype" id="5429166">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5429174">//&nbsp;map&nbsp;of&nbsp;supported&nbsp;extensions</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429206">ext</span>&nbsp;<span class="keyword" id="5429210">map</span><span class="op" id="5429213">[</span><span class="builtintype" id="5429214">string</span><span class="op" id="5429220">]</span><span class="builtintype" id="5429221">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5429229">//&nbsp;supported&nbsp;auth&nbsp;mechanisms</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429259">auth</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5429270">[</span><span class="op" id="5429271">]</span><span class="builtintype" id="5429272">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429280">localName</span>&nbsp;&nbsp;<span class="builtintype" id="5429291">string</span>&nbsp;<span class="comment" id="5429298">//&nbsp;the&nbsp;name&nbsp;to&nbsp;use&nbsp;in&nbsp;HELO/EHLO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429331">didHello</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5429342">bool</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5429349">//&nbsp;whether&nbsp;we&#39;ve&nbsp;said&nbsp;HELO/EHLO</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429382">helloError</span>&nbsp;<span class="builtintype" id="5429393">error</span>&nbsp;&nbsp;<span class="comment" id="5429400">//&nbsp;the&nbsp;error&nbsp;from&nbsp;the&nbsp;hello</span><br>
<span class="lineno"></span><span class="op" id="5429428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5429431">//&nbsp;Dial&nbsp;returns&nbsp;a&nbsp;new&nbsp;Client&nbsp;connected&nbsp;to&nbsp;an&nbsp;SMTP&nbsp;server&nbsp;at&nbsp;addr.</span><br>
<span class="lineno"></span><span class="comment" id="5429497">//&nbsp;The&nbsp;addr&nbsp;must&nbsp;include&nbsp;a&nbsp;port&nbsp;number.</span><br>
<span class="lineno">45</span><span class="keyword" id="5429537">func</span>&nbsp;<span class="ident" id="5429542">Dial</span><span class="op" id="5429546">(</span><span class="ident" id="5429547">addr</span>&nbsp;<span class="builtintype" id="5429552">string</span><span class="op" id="5429558">)</span>&nbsp;<span class="op" id="5429560">(</span><span class="op" id="5429561">*</span><span class="ident" id="5429562">Client</span><span class="op" id="5429568">,</span>&nbsp;<span class="builtintype" id="5429570">error</span><span class="op" id="5429575">)</span>&nbsp;<span class="op" id="5429577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429580">conn</span><span class="op" id="5429584">,</span>&nbsp;<span class="ident" id="5429586">err</span>&nbsp;<span class="op" id="5429590">:=</span>&nbsp;<span class="ident" id="5429593">net</span><span class="op" id="5429596">.</span><span class="ident" id="5429597">Dial</span><span class="op" id="5429601">(</span><span class="string" id="5429602">&#34;tcp&#34;</span><span class="op" id="5429607">,</span>&nbsp;<span class="ident" id="5429609">addr</span><span class="op" id="5429613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5429616">if</span>&nbsp;<span class="ident" id="5429619">err</span>&nbsp;<span class="op" id="5429623">!=</span>&nbsp;<span class="ident" id="5429626">nil</span>&nbsp;<span class="op" id="5429630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5429634">return</span>&nbsp;<span class="ident" id="5429641">nil</span><span class="op" id="5429644">,</span>&nbsp;<span class="ident" id="5429646">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5429651">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429654">host</span><span class="op" id="5429658">,</span>&nbsp;<span class="ident" id="5429660">_</span><span class="op" id="5429661">,</span>&nbsp;<span class="ident" id="5429663">_</span>&nbsp;<span class="op" id="5429665">:=</span>&nbsp;<span class="ident" id="5429668">net</span><span class="op" id="5429671">.</span><span class="ident" id="5429672">SplitHostPort</span><span class="op" id="5429685">(</span><span class="ident" id="5429686">addr</span><span class="op" id="5429690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5429693">return</span>&nbsp;<span class="ident" id="5429700">NewClient</span><span class="op" id="5429709">(</span><span class="ident" id="5429710">conn</span><span class="op" id="5429714">,</span>&nbsp;<span class="ident" id="5429716">host</span><span class="op" id="5429720">)</span><br>
<span class="lineno"></span><span class="op" id="5429722">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5429725">//&nbsp;NewClient&nbsp;returns&nbsp;a&nbsp;new&nbsp;Client&nbsp;using&nbsp;an&nbsp;existing&nbsp;connection&nbsp;and&nbsp;host&nbsp;as&nbsp;a</span><br>
<span class="lineno">55</span><span class="comment" id="5429802">//&nbsp;server&nbsp;name&nbsp;to&nbsp;be&nbsp;used&nbsp;when&nbsp;authenticating.</span><br>
<span class="lineno"></span><span class="keyword" id="5429849">func</span>&nbsp;<span class="ident" id="5429854">NewClient</span><span class="op" id="5429863">(</span><span class="ident" id="5429864">conn</span>&nbsp;<span class="ident" id="5429869">net</span><span class="op" id="5429872">.</span><span class="ident" id="5429873">Conn</span><span class="op" id="5429877">,</span>&nbsp;<span class="ident" id="5429879">host</span>&nbsp;<span class="builtintype" id="5429884">string</span><span class="op" id="5429890">)</span>&nbsp;<span class="op" id="5429892">(</span><span class="op" id="5429893">*</span><span class="ident" id="5429894">Client</span><span class="op" id="5429900">,</span>&nbsp;<span class="builtintype" id="5429902">error</span><span class="op" id="5429907">)</span>&nbsp;<span class="op" id="5429909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429912">text</span>&nbsp;<span class="op" id="5429917">:=</span>&nbsp;<span class="ident" id="5429920">textproto</span><span class="op" id="5429929">.</span><span class="ident" id="5429930">NewConn</span><span class="op" id="5429937">(</span><span class="ident" id="5429938">conn</span><span class="op" id="5429942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429945">_</span><span class="op" id="5429946">,</span>&nbsp;<span class="ident" id="5429948">_</span><span class="op" id="5429949">,</span>&nbsp;<span class="ident" id="5429951">err</span>&nbsp;<span class="op" id="5429955">:=</span>&nbsp;<span class="ident" id="5429958">text</span><span class="op" id="5429962">.</span><span class="ident" id="5429963">ReadResponse</span><span class="op" id="5429975">(</span><span class="num" id="5429976">220</span><span class="op" id="5429979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5429982">if</span>&nbsp;<span class="ident" id="5429985">err</span>&nbsp;<span class="op" id="5429989">!=</span>&nbsp;<span class="ident" id="5429992">nil</span>&nbsp;<span class="op" id="5429996">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5430000">text</span><span class="op" id="5430004">.</span><span class="ident" id="5430005">Close</span><span class="op" id="5430010">(</span><span class="op" id="5430011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5430015">return</span>&nbsp;<span class="ident" id="5430022">nil</span><span class="op" id="5430025">,</span>&nbsp;<span class="ident" id="5430027">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5430032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5430035">c</span>&nbsp;<span class="op" id="5430037">:=</span>&nbsp;<span class="op" id="5430040">&amp;</span><span class="ident" id="5430041">Client</span><span class="op" id="5430047">{</span><span class="ident" id="5430048">Text</span><span class="op" id="5430052">:</span>&nbsp;<span class="ident" id="5430054">text</span><span class="op" id="5430058">,</span>&nbsp;<span class="ident" id="5430060">conn</span><span class="op" id="5430064">:</span>&nbsp;<span class="ident" id="5430066">conn</span><span class="op" id="5430070">,</span>&nbsp;<span class="ident" id="5430072">serverName</span><span class="op" id="5430082">:</span>&nbsp;<span class="ident" id="5430084">host</span><span class="op" id="5430088">,</span>&nbsp;<span class="ident" id="5430090">localName</span><span class="op" id="5430099">:</span>&nbsp;<span class="string" id="5430101">&#34;localhost&#34;</span><span class="op" id="5430112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5430115">return</span>&nbsp;<span class="ident" id="5430122">c</span><span class="op" id="5430123">,</span>&nbsp;<span class="ident" id="5430125">nil</span><br>
<span class="lineno">65</span><span class="op" id="5430129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5430132">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="5430164">func</span>&nbsp;<span class="op" id="5430169">(</span><span class="ident" id="5430170">c</span>&nbsp;<span class="op" id="5430172">*</span><span class="ident" id="5430173">Client</span><span class="op" id="5430179">)</span>&nbsp;<span class="ident" id="5430181">Close</span><span class="op" id="5430186">(</span><span class="op" id="5430187">)</span>&nbsp;<span class="builtintype" id="5430189">error</span>&nbsp;<span class="op" id="5430195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5430198">return</span>&nbsp;<span class="ident" id="5430205">c</span><span class="op" id="5430206">.</span><span class="ident" id="5430207">Text</span><span class="op" id="5430211">.</span><span class="ident" id="5430212">Close</span><span class="op" id="5430217">(</span><span class="op" id="5430218">)</span><br>
<span class="lineno">70</span><span class="op" id="5430220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5430223">//&nbsp;hello&nbsp;runs&nbsp;a&nbsp;hello&nbsp;exchange&nbsp;if&nbsp;needed.</span><br>
<span class="lineno"></span><span class="keyword" id="5430265">func</span>&nbsp;<span class="op" id="5430270">(</span><span class="ident" id="5430271">c</span>&nbsp;<span class="op" id="5430273">*</span><span class="ident" id="5430274">Client</span><span class="op" id="5430280">)</span>&nbsp;<span class="ident" id="5430282">hello</span><span class="op" id="5430287">(</span><span class="op" id="5430288">)</span>&nbsp;<span class="builtintype" id="5430290">error</span>&nbsp;<span class="op" id="5430296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5430299">if</span>&nbsp;<span class="op" id="5430302">!</span><span class="ident" id="5430303">c</span><span class="op" id="5430304">.</span><span class="ident" id="5430305">didHello</span>&nbsp;<span class="op" id="5430314">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5430318">c</span><span class="op" id="5430319">.</span><span class="ident" id="5430320">didHello</span>&nbsp;<span class="op" id="5430329">=</span>&nbsp;<span class="builtintype" id="5430331">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5430338">err</span>&nbsp;<span class="op" id="5430342">:=</span>&nbsp;<span class="ident" id="5430345">c</span><span class="op" id="5430346">.</span><span class="ident" id="5430347">ehlo</span><span class="op" id="5430351">(</span><span class="op" id="5430352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5430356">if</span>&nbsp;<span class="ident" id="5430359">err</span>&nbsp;<span class="op" id="5430363">!=</span>&nbsp;<span class="ident" id="5430366">nil</span>&nbsp;<span class="op" id="5430370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5430375">c</span><span class="op" id="5430376">.</span><span class="ident" id="5430377">helloError</span>&nbsp;<span class="op" id="5430388">=</span>&nbsp;<span class="ident" id="5430390">c</span><span class="op" id="5430391">.</span><span class="ident" id="5430392">helo</span><span class="op" id="5430396">(</span><span class="op" id="5430397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5430401">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5430404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5430407">return</span>&nbsp;<span class="ident" id="5430414">c</span><span class="op" id="5430415">.</span><span class="ident" id="5430416">helloError</span><br>
<span class="lineno"></span><span class="op" id="5430427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5430430">//&nbsp;Hello&nbsp;sends&nbsp;a&nbsp;HELO&nbsp;or&nbsp;EHLO&nbsp;to&nbsp;the&nbsp;server&nbsp;as&nbsp;the&nbsp;given&nbsp;host&nbsp;name.</span><br>
<span class="lineno">85</span><span class="comment" id="5430498">//&nbsp;Calling&nbsp;this&nbsp;method&nbsp;is&nbsp;only&nbsp;necessary&nbsp;if&nbsp;the&nbsp;client&nbsp;needs&nbsp;control</span><br>
<span class="lineno"></span><span class="comment" id="5430567">//&nbsp;over&nbsp;the&nbsp;host&nbsp;name&nbsp;used.&nbsp;&nbsp;The&nbsp;client&nbsp;will&nbsp;introduce&nbsp;itself&nbsp;as&nbsp;&#34;localhost&#34;</span><br>
<span class="lineno"></span><span class="comment" id="5430644">//&nbsp;automatically&nbsp;otherwise.&nbsp;&nbsp;If&nbsp;Hello&nbsp;is&nbsp;called,&nbsp;it&nbsp;must&nbsp;be&nbsp;called&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="5430718">//&nbsp;any&nbsp;of&nbsp;the&nbsp;other&nbsp;methods.</span><br>
<span class="lineno"></span><span class="keyword" id="5430747">func</span>&nbsp;<span class="op" id="5430752">(</span><span class="ident" id="5430753">c</span>&nbsp;<span class="op" id="5430755">*</span><span class="ident" id="5430756">Client</span><span class="op" id="5430762">)</span>&nbsp;<span class="ident" id="5430764">Hello</span><span class="op" id="5430769">(</span><span class="ident" id="5430770">localName</span>&nbsp;<span class="builtintype" id="5430780">string</span><span class="op" id="5430786">)</span>&nbsp;<span class="builtintype" id="5430788">error</span>&nbsp;<span class="op" id="5430794">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5430797">if</span>&nbsp;<span class="ident" id="5430800">c</span><span class="op" id="5430801">.</span><span class="ident" id="5430802">didHello</span>&nbsp;<span class="op" id="5430811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5430815">return</span>&nbsp;<span class="ident" id="5430822">errors</span><span class="op" id="5430828">.</span><span class="ident" id="5430829">New</span><span class="op" id="5430832">(</span><span class="string" id="5430833">&#34;smtp:&nbsp;Hello&nbsp;called&nbsp;after&nbsp;other&nbsp;methods&#34;</span><span class="op" id="5430873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5430876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5430879">c</span><span class="op" id="5430880">.</span><span class="ident" id="5430881">localName</span>&nbsp;<span class="op" id="5430891">=</span>&nbsp;<span class="ident" id="5430893">localName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5430904">return</span>&nbsp;<span class="ident" id="5430911">c</span><span class="op" id="5430912">.</span><span class="ident" id="5430913">hello</span><span class="op" id="5430918">(</span><span class="op" id="5430919">)</span><br>
<span class="lineno">95</span><span class="op" id="5430921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5430924">//&nbsp;cmd&nbsp;is&nbsp;a&nbsp;convenience&nbsp;function&nbsp;that&nbsp;sends&nbsp;a&nbsp;command&nbsp;and&nbsp;returns&nbsp;the&nbsp;response</span><br>
<span class="lineno"></span><span class="keyword" id="5431003">func</span>&nbsp;<span class="op" id="5431008">(</span><span class="ident" id="5431009">c</span>&nbsp;<span class="op" id="5431011">*</span><span class="ident" id="5431012">Client</span><span class="op" id="5431018">)</span>&nbsp;<span class="ident" id="5431020">cmd</span><span class="op" id="5431023">(</span><span class="ident" id="5431024">expectCode</span>&nbsp;<span class="builtintype" id="5431035">int</span><span class="op" id="5431038">,</span>&nbsp;<span class="ident" id="5431040">format</span>&nbsp;<span class="builtintype" id="5431047">string</span><span class="op" id="5431053">,</span>&nbsp;<span class="ident" id="5431055">args</span>&nbsp;<span class="op" id="5431060">...</span><span class="keyword" id="5431063">interface</span><span class="op" id="5431072">{</span><span class="op" id="5431073">}</span><span class="op" id="5431074">)</span>&nbsp;<span class="op" id="5431076">(</span><span class="builtintype" id="5431077">int</span><span class="op" id="5431080">,</span>&nbsp;<span class="builtintype" id="5431082">string</span><span class="op" id="5431088">,</span>&nbsp;<span class="builtintype" id="5431090">error</span><span class="op" id="5431095">)</span>&nbsp;<span class="op" id="5431097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5431100">id</span><span class="op" id="5431102">,</span>&nbsp;<span class="ident" id="5431104">err</span>&nbsp;<span class="op" id="5431108">:=</span>&nbsp;<span class="ident" id="5431111">c</span><span class="op" id="5431112">.</span><span class="ident" id="5431113">Text</span><span class="op" id="5431117">.</span><span class="ident" id="5431118">Cmd</span><span class="op" id="5431121">(</span><span class="ident" id="5431122">format</span><span class="op" id="5431128">,</span>&nbsp;<span class="ident" id="5431130">args</span><span class="op" id="5431134">...</span><span class="op" id="5431137">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431140">if</span>&nbsp;<span class="ident" id="5431143">err</span>&nbsp;<span class="op" id="5431147">!=</span>&nbsp;<span class="ident" id="5431150">nil</span>&nbsp;<span class="op" id="5431154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431158">return</span>&nbsp;<span class="num" id="5431165">0</span><span class="op" id="5431166">,</span>&nbsp;<span class="string" id="5431168">&#34;&#34;</span><span class="op" id="5431170">,</span>&nbsp;<span class="ident" id="5431172">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5431177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5431180">c</span><span class="op" id="5431181">.</span><span class="ident" id="5431182">Text</span><span class="op" id="5431186">.</span><span class="ident" id="5431187">StartResponse</span><span class="op" id="5431200">(</span><span class="ident" id="5431201">id</span><span class="op" id="5431203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431206">defer</span>&nbsp;<span class="ident" id="5431212">c</span><span class="op" id="5431213">.</span><span class="ident" id="5431214">Text</span><span class="op" id="5431218">.</span><span class="ident" id="5431219">EndResponse</span><span class="op" id="5431230">(</span><span class="ident" id="5431231">id</span><span class="op" id="5431233">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5431236">code</span><span class="op" id="5431240">,</span>&nbsp;<span class="ident" id="5431242">msg</span><span class="op" id="5431245">,</span>&nbsp;<span class="ident" id="5431247">err</span>&nbsp;<span class="op" id="5431251">:=</span>&nbsp;<span class="ident" id="5431254">c</span><span class="op" id="5431255">.</span><span class="ident" id="5431256">Text</span><span class="op" id="5431260">.</span><span class="ident" id="5431261">ReadResponse</span><span class="op" id="5431273">(</span><span class="ident" id="5431274">expectCode</span><span class="op" id="5431284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431287">return</span>&nbsp;<span class="ident" id="5431294">code</span><span class="op" id="5431298">,</span>&nbsp;<span class="ident" id="5431300">msg</span><span class="op" id="5431303">,</span>&nbsp;<span class="ident" id="5431305">err</span><br>
<span class="lineno"></span><span class="op" id="5431309">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5431312">//&nbsp;helo&nbsp;sends&nbsp;the&nbsp;HELO&nbsp;greeting&nbsp;to&nbsp;the&nbsp;server.&nbsp;It&nbsp;should&nbsp;be&nbsp;used&nbsp;only&nbsp;when&nbsp;the</span><br>
<span class="lineno">110</span><span class="comment" id="5431391">//&nbsp;server&nbsp;does&nbsp;not&nbsp;support&nbsp;ehlo.</span><br>
<span class="lineno"></span><span class="keyword" id="5431424">func</span>&nbsp;<span class="op" id="5431429">(</span><span class="ident" id="5431430">c</span>&nbsp;<span class="op" id="5431432">*</span><span class="ident" id="5431433">Client</span><span class="op" id="5431439">)</span>&nbsp;<span class="ident" id="5431441">helo</span><span class="op" id="5431445">(</span><span class="op" id="5431446">)</span>&nbsp;<span class="builtintype" id="5431448">error</span>&nbsp;<span class="op" id="5431454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5431457">c</span><span class="op" id="5431458">.</span><span class="ident" id="5431459">ext</span>&nbsp;<span class="op" id="5431463">=</span>&nbsp;<span class="ident" id="5431465">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5431470">_</span><span class="op" id="5431471">,</span>&nbsp;<span class="ident" id="5431473">_</span><span class="op" id="5431474">,</span>&nbsp;<span class="ident" id="5431476">err</span>&nbsp;<span class="op" id="5431480">:=</span>&nbsp;<span class="ident" id="5431483">c</span><span class="op" id="5431484">.</span><span class="ident" id="5431485">cmd</span><span class="op" id="5431488">(</span><span class="num" id="5431489">250</span><span class="op" id="5431492">,</span>&nbsp;<span class="string" id="5431494">&#34;HELO&nbsp;%s&#34;</span><span class="op" id="5431503">,</span>&nbsp;<span class="ident" id="5431505">c</span><span class="op" id="5431506">.</span><span class="ident" id="5431507">localName</span><span class="op" id="5431516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431519">return</span>&nbsp;<span class="ident" id="5431526">err</span><br>
<span class="lineno">115</span><span class="op" id="5431530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5431533">//&nbsp;ehlo&nbsp;sends&nbsp;the&nbsp;EHLO&nbsp;(extended&nbsp;hello)&nbsp;greeting&nbsp;to&nbsp;the&nbsp;server.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="5431600">//&nbsp;should&nbsp;be&nbsp;the&nbsp;preferred&nbsp;greeting&nbsp;for&nbsp;servers&nbsp;that&nbsp;support&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="5431665">func</span>&nbsp;<span class="op" id="5431670">(</span><span class="ident" id="5431671">c</span>&nbsp;<span class="op" id="5431673">*</span><span class="ident" id="5431674">Client</span><span class="op" id="5431680">)</span>&nbsp;<span class="ident" id="5431682">ehlo</span><span class="op" id="5431686">(</span><span class="op" id="5431687">)</span>&nbsp;<span class="builtintype" id="5431689">error</span>&nbsp;<span class="op" id="5431695">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5431698">_</span><span class="op" id="5431699">,</span>&nbsp;<span class="ident" id="5431701">msg</span><span class="op" id="5431704">,</span>&nbsp;<span class="ident" id="5431706">err</span>&nbsp;<span class="op" id="5431710">:=</span>&nbsp;<span class="ident" id="5431713">c</span><span class="op" id="5431714">.</span><span class="ident" id="5431715">cmd</span><span class="op" id="5431718">(</span><span class="num" id="5431719">250</span><span class="op" id="5431722">,</span>&nbsp;<span class="string" id="5431724">&#34;EHLO&nbsp;%s&#34;</span><span class="op" id="5431733">,</span>&nbsp;<span class="ident" id="5431735">c</span><span class="op" id="5431736">.</span><span class="ident" id="5431737">localName</span><span class="op" id="5431746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431749">if</span>&nbsp;<span class="ident" id="5431752">err</span>&nbsp;<span class="op" id="5431756">!=</span>&nbsp;<span class="ident" id="5431759">nil</span>&nbsp;<span class="op" id="5431763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431767">return</span>&nbsp;<span class="ident" id="5431774">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5431779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5431782">ext</span>&nbsp;<span class="op" id="5431786">:=</span>&nbsp;<span class="builtinfunc" id="5431789">make</span><span class="op" id="5431793">(</span><span class="keyword" id="5431794">map</span><span class="op" id="5431797">[</span><span class="builtintype" id="5431798">string</span><span class="op" id="5431804">]</span><span class="builtintype" id="5431805">string</span><span class="op" id="5431811">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5431814">extList</span>&nbsp;<span class="op" id="5431822">:=</span>&nbsp;<span class="ident" id="5431825">strings</span><span class="op" id="5431832">.</span><span class="ident" id="5431833">Split</span><span class="op" id="5431838">(</span><span class="ident" id="5431839">msg</span><span class="op" id="5431842">,</span>&nbsp;<span class="string" id="5431844">&#34;\n&#34;</span><span class="op" id="5431848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431851">if</span>&nbsp;<span class="builtinfunc" id="5431854">len</span><span class="op" id="5431857">(</span><span class="ident" id="5431858">extList</span><span class="op" id="5431865">)</span>&nbsp;<span class="op" id="5431867">&gt;</span>&nbsp;<span class="num" id="5431869">1</span>&nbsp;<span class="op" id="5431871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5431875">extList</span>&nbsp;<span class="op" id="5431883">=</span>&nbsp;<span class="ident" id="5431885">extList</span><span class="op" id="5431892">[</span><span class="num" id="5431893">1</span><span class="op" id="5431894">:</span><span class="op" id="5431895">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431899">for</span>&nbsp;<span class="ident" id="5431903">_</span><span class="op" id="5431904">,</span>&nbsp;<span class="ident" id="5431906">line</span>&nbsp;<span class="op" id="5431911">:=</span>&nbsp;<span class="keyword" id="5431914">range</span>&nbsp;<span class="ident" id="5431920">extList</span>&nbsp;<span class="op" id="5431928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5431933">args</span>&nbsp;<span class="op" id="5431938">:=</span>&nbsp;<span class="ident" id="5431941">strings</span><span class="op" id="5431948">.</span><span class="ident" id="5431949">SplitN</span><span class="op" id="5431955">(</span><span class="ident" id="5431956">line</span><span class="op" id="5431960">,</span>&nbsp;<span class="string" id="5431962">&#34;&nbsp;&#34;</span><span class="op" id="5431965">,</span>&nbsp;<span class="num" id="5431967">2</span><span class="op" id="5431968">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431973">if</span>&nbsp;<span class="builtinfunc" id="5431976">len</span><span class="op" id="5431979">(</span><span class="ident" id="5431980">args</span><span class="op" id="5431984">)</span>&nbsp;<span class="op" id="5431986">&gt;</span>&nbsp;<span class="num" id="5431988">1</span>&nbsp;<span class="op" id="5431990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5431996">ext</span><span class="op" id="5431999">[</span><span class="ident" id="5432000">args</span><span class="op" id="5432004">[</span><span class="num" id="5432005">0</span><span class="op" id="5432006">]</span><span class="op" id="5432007">]</span>&nbsp;<span class="op" id="5432009">=</span>&nbsp;<span class="ident" id="5432011">args</span><span class="op" id="5432015">[</span><span class="num" id="5432016">1</span><span class="op" id="5432017">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5432022">}</span>&nbsp;<span class="keyword" id="5432024">else</span>&nbsp;<span class="op" id="5432029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5432035">ext</span><span class="op" id="5432038">[</span><span class="ident" id="5432039">args</span><span class="op" id="5432043">[</span><span class="num" id="5432044">0</span><span class="op" id="5432045">]</span><span class="op" id="5432046">]</span>&nbsp;<span class="op" id="5432048">=</span>&nbsp;<span class="string" id="5432050">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5432056">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5432060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5432063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5432066">if</span>&nbsp;<span class="ident" id="5432069">mechs</span><span class="op" id="5432074">,</span>&nbsp;<span class="ident" id="5432076">ok</span>&nbsp;<span class="op" id="5432079">:=</span>&nbsp;<span class="ident" id="5432082">ext</span><span class="op" id="5432085">[</span><span class="string" id="5432086">&#34;AUTH&#34;</span><span class="op" id="5432092">]</span><span class="op" id="5432093">;</span>&nbsp;<span class="ident" id="5432095">ok</span>&nbsp;<span class="op" id="5432098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5432102">c</span><span class="op" id="5432103">.</span><span class="ident" id="5432104">auth</span>&nbsp;<span class="op" id="5432109">=</span>&nbsp;<span class="ident" id="5432111">strings</span><span class="op" id="5432118">.</span><span class="ident" id="5432119">Split</span><span class="op" id="5432124">(</span><span class="ident" id="5432125">mechs</span><span class="op" id="5432130">,</span>&nbsp;<span class="string" id="5432132">&#34;&nbsp;&#34;</span><span class="op" id="5432135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5432138">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5432141">c</span><span class="op" id="5432142">.</span><span class="ident" id="5432143">ext</span>&nbsp;<span class="op" id="5432147">=</span>&nbsp;<span class="ident" id="5432149">ext</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5432154">return</span>&nbsp;<span class="ident" id="5432161">err</span><br>
<span class="lineno"></span><span class="op" id="5432165">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5432168">//&nbsp;StartTLS&nbsp;sends&nbsp;the&nbsp;STARTTLS&nbsp;command&nbsp;and&nbsp;encrypts&nbsp;all&nbsp;further&nbsp;communication.</span><br>
<span class="lineno">145</span><span class="comment" id="5432247">//&nbsp;Only&nbsp;servers&nbsp;that&nbsp;advertise&nbsp;the&nbsp;STARTTLS&nbsp;extension&nbsp;support&nbsp;this&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="5432324">func</span>&nbsp;<span class="op" id="5432329">(</span><span class="ident" id="5432330">c</span>&nbsp;<span class="op" id="5432332">*</span><span class="ident" id="5432333">Client</span><span class="op" id="5432339">)</span>&nbsp;<span class="ident" id="5432341">StartTLS</span><span class="op" id="5432349">(</span><span class="ident" id="5432350">config</span>&nbsp;<span class="op" id="5432357">*</span><span class="ident" id="5432358">tls</span><span class="op" id="5432361">.</span><span class="ident" id="5432362">Config</span><span class="op" id="5432368">)</span>&nbsp;<span class="builtintype" id="5432370">error</span>&nbsp;<span class="op" id="5432376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5432379">if</span>&nbsp;<span class="ident" id="5432382">err</span>&nbsp;<span class="op" id="5432386">:=</span>&nbsp;<span class="ident" id="5432389">c</span><span class="op" id="5432390">.</span><span class="ident" id="5432391">hello</span><span class="op" id="5432396">(</span><span class="op" id="5432397">)</span><span class="op" id="5432398">;</span>&nbsp;<span class="ident" id="5432400">err</span>&nbsp;<span class="op" id="5432404">!=</span>&nbsp;<span class="ident" id="5432407">nil</span>&nbsp;<span class="op" id="5432411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5432415">return</span>&nbsp;<span class="ident" id="5432422">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5432427">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5432430">_</span><span class="op" id="5432431">,</span>&nbsp;<span class="ident" id="5432433">_</span><span class="op" id="5432434">,</span>&nbsp;<span class="ident" id="5432436">err</span>&nbsp;<span class="op" id="5432440">:=</span>&nbsp;<span class="ident" id="5432443">c</span><span class="op" id="5432444">.</span><span class="ident" id="5432445">cmd</span><span class="op" id="5432448">(</span><span class="num" id="5432449">220</span><span class="op" id="5432452">,</span>&nbsp;<span class="string" id="5432454">&#34;STARTTLS&#34;</span><span class="op" id="5432464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5432467">if</span>&nbsp;<span class="ident" id="5432470">err</span>&nbsp;<span class="op" id="5432474">!=</span>&nbsp;<span class="ident" id="5432477">nil</span>&nbsp;<span class="op" id="5432481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5432485">return</span>&nbsp;<span class="ident" id="5432492">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5432497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5432500">c</span><span class="op" id="5432501">.</span><span class="ident" id="5432502">conn</span>&nbsp;<span class="op" id="5432507">=</span>&nbsp;<span class="ident" id="5432509">tls</span><span class="op" id="5432512">.</span><span class="ident" id="5432513">Client</span><span class="op" id="5432519">(</span><span class="ident" id="5432520">c</span><span class="op" id="5432521">.</span><span class="ident" id="5432522">conn</span><span class="op" id="5432526">,</span>&nbsp;<span class="ident" id="5432528">config</span><span class="op" id="5432534">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5432537">c</span><span class="op" id="5432538">.</span><span class="ident" id="5432539">Text</span>&nbsp;<span class="op" id="5432544">=</span>&nbsp;<span class="ident" id="5432546">textproto</span><span class="op" id="5432555">.</span><span class="ident" id="5432556">NewConn</span><span class="op" id="5432563">(</span><span class="ident" id="5432564">c</span><span class="op" id="5432565">.</span><span class="ident" id="5432566">conn</span><span class="op" id="5432570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5432573">c</span><span class="op" id="5432574">.</span><span class="ident" id="5432575">tls</span>&nbsp;<span class="op" id="5432579">=</span>&nbsp;<span class="builtintype" id="5432581">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5432587">return</span>&nbsp;<span class="ident" id="5432594">c</span><span class="op" id="5432595">.</span><span class="ident" id="5432596">ehlo</span><span class="op" id="5432600">(</span><span class="op" id="5432601">)</span><br>
<span class="lineno"></span><span class="op" id="5432603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="5432606">//&nbsp;Verify&nbsp;checks&nbsp;the&nbsp;validity&nbsp;of&nbsp;an&nbsp;email&nbsp;address&nbsp;on&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span><span class="comment" id="5432671">//&nbsp;If&nbsp;Verify&nbsp;returns&nbsp;nil,&nbsp;the&nbsp;address&nbsp;is&nbsp;valid.&nbsp;A&nbsp;non-nil&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="5432736">//&nbsp;does&nbsp;not&nbsp;necessarily&nbsp;indicate&nbsp;an&nbsp;invalid&nbsp;address.&nbsp;Many&nbsp;servers</span><br>
<span class="lineno"></span><span class="comment" id="5432802">//&nbsp;will&nbsp;not&nbsp;verify&nbsp;addresses&nbsp;for&nbsp;security&nbsp;reasons.</span><br>
<span class="lineno"></span><span class="keyword" id="5432853">func</span>&nbsp;<span class="op" id="5432858">(</span><span class="ident" id="5432859">c</span>&nbsp;<span class="op" id="5432861">*</span><span class="ident" id="5432862">Client</span><span class="op" id="5432868">)</span>&nbsp;<span class="ident" id="5432870">Verify</span><span class="op" id="5432876">(</span><span class="ident" id="5432877">addr</span>&nbsp;<span class="builtintype" id="5432882">string</span><span class="op" id="5432888">)</span>&nbsp;<span class="builtintype" id="5432890">error</span>&nbsp;<span class="op" id="5432896">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5432899">if</span>&nbsp;<span class="ident" id="5432902">err</span>&nbsp;<span class="op" id="5432906">:=</span>&nbsp;<span class="ident" id="5432909">c</span><span class="op" id="5432910">.</span><span class="ident" id="5432911">hello</span><span class="op" id="5432916">(</span><span class="op" id="5432917">)</span><span class="op" id="5432918">;</span>&nbsp;<span class="ident" id="5432920">err</span>&nbsp;<span class="op" id="5432924">!=</span>&nbsp;<span class="ident" id="5432927">nil</span>&nbsp;<span class="op" id="5432931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5432935">return</span>&nbsp;<span class="ident" id="5432942">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5432947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5432950">_</span><span class="op" id="5432951">,</span>&nbsp;<span class="ident" id="5432953">_</span><span class="op" id="5432954">,</span>&nbsp;<span class="ident" id="5432956">err</span>&nbsp;<span class="op" id="5432960">:=</span>&nbsp;<span class="ident" id="5432963">c</span><span class="op" id="5432964">.</span><span class="ident" id="5432965">cmd</span><span class="op" id="5432968">(</span><span class="num" id="5432969">250</span><span class="op" id="5432972">,</span>&nbsp;<span class="string" id="5432974">&#34;VRFY&nbsp;%s&#34;</span><span class="op" id="5432983">,</span>&nbsp;<span class="ident" id="5432985">addr</span><span class="op" id="5432989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5432992">return</span>&nbsp;<span class="ident" id="5432999">err</span><br>
<span class="lineno">170</span><span class="op" id="5433003">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5433006">//&nbsp;Auth&nbsp;authenticates&nbsp;a&nbsp;client&nbsp;using&nbsp;the&nbsp;provided&nbsp;authentication&nbsp;mechanism.</span><br>
<span class="lineno"></span><span class="comment" id="5433082">//&nbsp;A&nbsp;failed&nbsp;authentication&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="5433132">//&nbsp;Only&nbsp;servers&nbsp;that&nbsp;advertise&nbsp;the&nbsp;AUTH&nbsp;extension&nbsp;support&nbsp;this&nbsp;function.</span><br>
<span class="lineno">175</span><span class="keyword" id="5433205">func</span>&nbsp;<span class="op" id="5433210">(</span><span class="ident" id="5433211">c</span>&nbsp;<span class="op" id="5433213">*</span><span class="ident" id="5433214">Client</span><span class="op" id="5433220">)</span>&nbsp;<span class="ident" id="5433222">Auth</span><span class="op" id="5433226">(</span><span class="ident" id="5433227">a</span>&nbsp;<span class="ident" id="5433229">Auth</span><span class="op" id="5433233">)</span>&nbsp;<span class="builtintype" id="5433235">error</span>&nbsp;<span class="op" id="5433241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5433244">if</span>&nbsp;<span class="ident" id="5433247">err</span>&nbsp;<span class="op" id="5433251">:=</span>&nbsp;<span class="ident" id="5433254">c</span><span class="op" id="5433255">.</span><span class="ident" id="5433256">hello</span><span class="op" id="5433261">(</span><span class="op" id="5433262">)</span><span class="op" id="5433263">;</span>&nbsp;<span class="ident" id="5433265">err</span>&nbsp;<span class="op" id="5433269">!=</span>&nbsp;<span class="ident" id="5433272">nil</span>&nbsp;<span class="op" id="5433276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5433280">return</span>&nbsp;<span class="ident" id="5433287">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5433292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5433295">encoding</span>&nbsp;<span class="op" id="5433304">:=</span>&nbsp;<span class="ident" id="5433307">base64</span><span class="op" id="5433313">.</span><span class="ident" id="5433314">StdEncoding</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5433327">mech</span><span class="op" id="5433331">,</span>&nbsp;<span class="ident" id="5433333">resp</span><span class="op" id="5433337">,</span>&nbsp;<span class="ident" id="5433339">err</span>&nbsp;<span class="op" id="5433343">:=</span>&nbsp;<span class="ident" id="5433346">a</span><span class="op" id="5433347">.</span><span class="ident" id="5433348">Start</span><span class="op" id="5433353">(</span><span class="op" id="5433354">&amp;</span><span class="ident" id="5433355">ServerInfo</span><span class="op" id="5433365">{</span><span class="ident" id="5433366">c</span><span class="op" id="5433367">.</span><span class="ident" id="5433368">serverName</span><span class="op" id="5433378">,</span>&nbsp;<span class="ident" id="5433380">c</span><span class="op" id="5433381">.</span><span class="ident" id="5433382">tls</span><span class="op" id="5433385">,</span>&nbsp;<span class="ident" id="5433387">c</span><span class="op" id="5433388">.</span><span class="ident" id="5433389">auth</span><span class="op" id="5433393">}</span><span class="op" id="5433394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5433397">if</span>&nbsp;<span class="ident" id="5433400">err</span>&nbsp;<span class="op" id="5433404">!=</span>&nbsp;<span class="ident" id="5433407">nil</span>&nbsp;<span class="op" id="5433411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5433415">c</span><span class="op" id="5433416">.</span><span class="ident" id="5433417">Quit</span><span class="op" id="5433421">(</span><span class="op" id="5433422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5433426">return</span>&nbsp;<span class="ident" id="5433433">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5433438">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5433441">resp64</span>&nbsp;<span class="op" id="5433448">:=</span>&nbsp;<span class="builtinfunc" id="5433451">make</span><span class="op" id="5433455">(</span><span class="op" id="5433456">[</span><span class="op" id="5433457">]</span><span class="builtintype" id="5433458">byte</span><span class="op" id="5433462">,</span>&nbsp;<span class="ident" id="5433464">encoding</span><span class="op" id="5433472">.</span><span class="ident" id="5433473">EncodedLen</span><span class="op" id="5433483">(</span><span class="builtinfunc" id="5433484">len</span><span class="op" id="5433487">(</span><span class="ident" id="5433488">resp</span><span class="op" id="5433492">)</span><span class="op" id="5433493">)</span><span class="op" id="5433494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5433497">encoding</span><span class="op" id="5433505">.</span><span class="ident" id="5433506">Encode</span><span class="op" id="5433512">(</span><span class="ident" id="5433513">resp64</span><span class="op" id="5433519">,</span>&nbsp;<span class="ident" id="5433521">resp</span><span class="op" id="5433525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5433528">code</span><span class="op" id="5433532">,</span>&nbsp;<span class="ident" id="5433534">msg64</span><span class="op" id="5433539">,</span>&nbsp;<span class="ident" id="5433541">err</span>&nbsp;<span class="op" id="5433545">:=</span>&nbsp;<span class="ident" id="5433548">c</span><span class="op" id="5433549">.</span><span class="ident" id="5433550">cmd</span><span class="op" id="5433553">(</span><span class="num" id="5433554">0</span><span class="op" id="5433555">,</span>&nbsp;<span class="string" id="5433557">&#34;AUTH&nbsp;%s&nbsp;%s&#34;</span><span class="op" id="5433569">,</span>&nbsp;<span class="ident" id="5433571">mech</span><span class="op" id="5433575">,</span>&nbsp;<span class="ident" id="5433577">resp64</span><span class="op" id="5433583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5433586">for</span>&nbsp;<span class="ident" id="5433590">err</span>&nbsp;<span class="op" id="5433594">==</span>&nbsp;<span class="ident" id="5433597">nil</span>&nbsp;<span class="op" id="5433601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5433605">var</span>&nbsp;<span class="ident" id="5433609">msg</span>&nbsp;<span class="op" id="5433613">[</span><span class="op" id="5433614">]</span><span class="builtintype" id="5433615">byte</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5433622">switch</span>&nbsp;<span class="ident" id="5433629">code</span>&nbsp;<span class="op" id="5433634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5433638">case</span>&nbsp;<span class="num" id="5433643">334</span><span class="op" id="5433646">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5433651">msg</span><span class="op" id="5433654">,</span>&nbsp;<span class="ident" id="5433656">err</span>&nbsp;<span class="op" id="5433660">=</span>&nbsp;<span class="ident" id="5433662">encoding</span><span class="op" id="5433670">.</span><span class="ident" id="5433671">DecodeString</span><span class="op" id="5433683">(</span><span class="ident" id="5433684">msg64</span><span class="op" id="5433689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5433693">case</span>&nbsp;<span class="num" id="5433698">235</span><span class="op" id="5433701">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5433706">//&nbsp;the&nbsp;last&nbsp;message&nbsp;isn&#39;t&nbsp;base64&nbsp;because&nbsp;it&nbsp;isn&#39;t&nbsp;a&nbsp;challenge</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5433771">msg</span>&nbsp;<span class="op" id="5433775">=</span>&nbsp;<span class="op" id="5433777">[</span><span class="op" id="5433778">]</span><span class="builtintype" id="5433779">byte</span><span class="op" id="5433783">(</span><span class="ident" id="5433784">msg64</span><span class="op" id="5433789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5433793">default</span><span class="op" id="5433800">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5433805">err</span>&nbsp;<span class="op" id="5433809">=</span>&nbsp;<span class="op" id="5433811">&amp;</span><span class="ident" id="5433812">textproto</span><span class="op" id="5433821">.</span><span class="ident" id="5433822">Error</span><span class="op" id="5433827">{</span><span class="ident" id="5433828">Code</span><span class="op" id="5433832">:</span>&nbsp;<span class="ident" id="5433834">code</span><span class="op" id="5433838">,</span>&nbsp;<span class="ident" id="5433840">Msg</span><span class="op" id="5433843">:</span>&nbsp;<span class="ident" id="5433845">msg64</span><span class="op" id="5433850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5433854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5433858">if</span>&nbsp;<span class="ident" id="5433861">err</span>&nbsp;<span class="op" id="5433865">==</span>&nbsp;<span class="ident" id="5433868">nil</span>&nbsp;<span class="op" id="5433872">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5433877">resp</span><span class="op" id="5433881">,</span>&nbsp;<span class="ident" id="5433883">err</span>&nbsp;<span class="op" id="5433887">=</span>&nbsp;<span class="ident" id="5433889">a</span><span class="op" id="5433890">.</span><span class="ident" id="5433891">Next</span><span class="op" id="5433895">(</span><span class="ident" id="5433896">msg</span><span class="op" id="5433899">,</span>&nbsp;<span class="ident" id="5433901">code</span>&nbsp;<span class="op" id="5433906">==</span>&nbsp;<span class="num" id="5433909">334</span><span class="op" id="5433912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5433916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5433920">if</span>&nbsp;<span class="ident" id="5433923">err</span>&nbsp;<span class="op" id="5433927">!=</span>&nbsp;<span class="ident" id="5433930">nil</span>&nbsp;<span class="op" id="5433934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5433939">//&nbsp;abort&nbsp;the&nbsp;AUTH</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5433960">c</span><span class="op" id="5433961">.</span><span class="ident" id="5433962">cmd</span><span class="op" id="5433965">(</span><span class="num" id="5433966">501</span><span class="op" id="5433969">,</span>&nbsp;<span class="string" id="5433971">&#34;*&#34;</span><span class="op" id="5433974">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5433979">c</span><span class="op" id="5433980">.</span><span class="ident" id="5433981">Quit</span><span class="op" id="5433985">(</span><span class="op" id="5433986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5433991">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5433999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5434003">if</span>&nbsp;<span class="ident" id="5434006">resp</span>&nbsp;<span class="op" id="5434011">==</span>&nbsp;<span class="ident" id="5434014">nil</span>&nbsp;<span class="op" id="5434018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5434023">break</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5434031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5434035">resp64</span>&nbsp;<span class="op" id="5434042">=</span>&nbsp;<span class="builtinfunc" id="5434044">make</span><span class="op" id="5434048">(</span><span class="op" id="5434049">[</span><span class="op" id="5434050">]</span><span class="builtintype" id="5434051">byte</span><span class="op" id="5434055">,</span>&nbsp;<span class="ident" id="5434057">encoding</span><span class="op" id="5434065">.</span><span class="ident" id="5434066">EncodedLen</span><span class="op" id="5434076">(</span><span class="builtinfunc" id="5434077">len</span><span class="op" id="5434080">(</span><span class="ident" id="5434081">resp</span><span class="op" id="5434085">)</span><span class="op" id="5434086">)</span><span class="op" id="5434087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5434091">encoding</span><span class="op" id="5434099">.</span><span class="ident" id="5434100">Encode</span><span class="op" id="5434106">(</span><span class="ident" id="5434107">resp64</span><span class="op" id="5434113">,</span>&nbsp;<span class="ident" id="5434115">resp</span><span class="op" id="5434119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5434123">code</span><span class="op" id="5434127">,</span>&nbsp;<span class="ident" id="5434129">msg64</span><span class="op" id="5434134">,</span>&nbsp;<span class="ident" id="5434136">err</span>&nbsp;<span class="op" id="5434140">=</span>&nbsp;<span class="ident" id="5434142">c</span><span class="op" id="5434143">.</span><span class="ident" id="5434144">cmd</span><span class="op" id="5434147">(</span><span class="num" id="5434148">0</span><span class="op" id="5434149">,</span>&nbsp;<span class="builtintype" id="5434151">string</span><span class="op" id="5434157">(</span><span class="ident" id="5434158">resp64</span><span class="op" id="5434164">)</span><span class="op" id="5434165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5434168">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5434171">return</span>&nbsp;<span class="ident" id="5434178">err</span><br>
<span class="lineno"></span><span class="op" id="5434182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5434185">//&nbsp;Mail&nbsp;issues&nbsp;a&nbsp;MAIL&nbsp;command&nbsp;to&nbsp;the&nbsp;server&nbsp;using&nbsp;the&nbsp;provided&nbsp;email&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="5434263">//&nbsp;If&nbsp;the&nbsp;server&nbsp;supports&nbsp;the&nbsp;8BITMIME&nbsp;extension,&nbsp;Mail&nbsp;adds&nbsp;the&nbsp;BODY=8BITMIME</span><br>
<span class="lineno">220</span><span class="comment" id="5434341">//&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="comment" id="5434355">//&nbsp;This&nbsp;initiates&nbsp;a&nbsp;mail&nbsp;transaction&nbsp;and&nbsp;is&nbsp;followed&nbsp;by&nbsp;one&nbsp;or&nbsp;more&nbsp;Rcpt&nbsp;calls.</span><br>
<span class="lineno"></span><span class="keyword" id="5434435">func</span>&nbsp;<span class="op" id="5434440">(</span><span class="ident" id="5434441">c</span>&nbsp;<span class="op" id="5434443">*</span><span class="ident" id="5434444">Client</span><span class="op" id="5434450">)</span>&nbsp;<span class="ident" id="5434452">Mail</span><span class="op" id="5434456">(</span><span class="ident" id="5434457">from</span>&nbsp;<span class="builtintype" id="5434462">string</span><span class="op" id="5434468">)</span>&nbsp;<span class="builtintype" id="5434470">error</span>&nbsp;<span class="op" id="5434476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5434479">if</span>&nbsp;<span class="ident" id="5434482">err</span>&nbsp;<span class="op" id="5434486">:=</span>&nbsp;<span class="ident" id="5434489">c</span><span class="op" id="5434490">.</span><span class="ident" id="5434491">hello</span><span class="op" id="5434496">(</span><span class="op" id="5434497">)</span><span class="op" id="5434498">;</span>&nbsp;<span class="ident" id="5434500">err</span>&nbsp;<span class="op" id="5434504">!=</span>&nbsp;<span class="ident" id="5434507">nil</span>&nbsp;<span class="op" id="5434511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5434515">return</span>&nbsp;<span class="ident" id="5434522">err</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5434527">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5434530">cmdStr</span>&nbsp;<span class="op" id="5434537">:=</span>&nbsp;<span class="string" id="5434540">&#34;MAIL&nbsp;FROM:&lt;%s&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5434558">if</span>&nbsp;<span class="ident" id="5434561">c</span><span class="op" id="5434562">.</span><span class="ident" id="5434563">ext</span>&nbsp;<span class="op" id="5434567">!=</span>&nbsp;<span class="ident" id="5434570">nil</span>&nbsp;<span class="op" id="5434574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5434578">if</span>&nbsp;<span class="ident" id="5434581">_</span><span class="op" id="5434582">,</span>&nbsp;<span class="ident" id="5434584">ok</span>&nbsp;<span class="op" id="5434587">:=</span>&nbsp;<span class="ident" id="5434590">c</span><span class="op" id="5434591">.</span><span class="ident" id="5434592">ext</span><span class="op" id="5434595">[</span><span class="string" id="5434596">&#34;8BITMIME&#34;</span><span class="op" id="5434606">]</span><span class="op" id="5434607">;</span>&nbsp;<span class="ident" id="5434609">ok</span>&nbsp;<span class="op" id="5434612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5434617">cmdStr</span>&nbsp;<span class="op" id="5434624">+=</span>&nbsp;<span class="string" id="5434627">&#34;&nbsp;BODY=8BITMIME&#34;</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5434646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5434649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5434652">_</span><span class="op" id="5434653">,</span>&nbsp;<span class="ident" id="5434655">_</span><span class="op" id="5434656">,</span>&nbsp;<span class="ident" id="5434658">err</span>&nbsp;<span class="op" id="5434662">:=</span>&nbsp;<span class="ident" id="5434665">c</span><span class="op" id="5434666">.</span><span class="ident" id="5434667">cmd</span><span class="op" id="5434670">(</span><span class="num" id="5434671">250</span><span class="op" id="5434674">,</span>&nbsp;<span class="ident" id="5434676">cmdStr</span><span class="op" id="5434682">,</span>&nbsp;<span class="ident" id="5434684">from</span><span class="op" id="5434688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5434691">return</span>&nbsp;<span class="ident" id="5434698">err</span><br>
<span class="lineno"></span><span class="op" id="5434702">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="comment" id="5434705">//&nbsp;Rcpt&nbsp;issues&nbsp;a&nbsp;RCPT&nbsp;command&nbsp;to&nbsp;the&nbsp;server&nbsp;using&nbsp;the&nbsp;provided&nbsp;email&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="5434783">//&nbsp;A&nbsp;call&nbsp;to&nbsp;Rcpt&nbsp;must&nbsp;be&nbsp;preceded&nbsp;by&nbsp;a&nbsp;call&nbsp;to&nbsp;Mail&nbsp;and&nbsp;may&nbsp;be&nbsp;followed&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="5434859">//&nbsp;a&nbsp;Data&nbsp;call&nbsp;or&nbsp;another&nbsp;Rcpt&nbsp;call.</span><br>
<span class="lineno"></span><span class="keyword" id="5434896">func</span>&nbsp;<span class="op" id="5434901">(</span><span class="ident" id="5434902">c</span>&nbsp;<span class="op" id="5434904">*</span><span class="ident" id="5434905">Client</span><span class="op" id="5434911">)</span>&nbsp;<span class="ident" id="5434913">Rcpt</span><span class="op" id="5434917">(</span><span class="ident" id="5434918">to</span>&nbsp;<span class="builtintype" id="5434921">string</span><span class="op" id="5434927">)</span>&nbsp;<span class="builtintype" id="5434929">error</span>&nbsp;<span class="op" id="5434935">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5434938">_</span><span class="op" id="5434939">,</span>&nbsp;<span class="ident" id="5434941">_</span><span class="op" id="5434942">,</span>&nbsp;<span class="ident" id="5434944">err</span>&nbsp;<span class="op" id="5434948">:=</span>&nbsp;<span class="ident" id="5434951">c</span><span class="op" id="5434952">.</span><span class="ident" id="5434953">cmd</span><span class="op" id="5434956">(</span><span class="num" id="5434957">25</span><span class="op" id="5434959">,</span>&nbsp;<span class="string" id="5434961">&#34;RCPT&nbsp;TO:&lt;%s&gt;&#34;</span><span class="op" id="5434975">,</span>&nbsp;<span class="ident" id="5434977">to</span><span class="op" id="5434979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5434982">return</span>&nbsp;<span class="ident" id="5434989">err</span><br>
<span class="lineno"></span><span class="op" id="5434993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5434996">type</span>&nbsp;<span class="ident" id="5435001">dataCloser</span>&nbsp;<span class="keyword" id="5435012">struct</span>&nbsp;<span class="op" id="5435019">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5435022">c</span>&nbsp;<span class="op" id="5435024">*</span><span class="ident" id="5435025">Client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5435033">io</span><span class="op" id="5435035">.</span><span class="ident" id="5435036">WriteCloser</span><br>
<span class="lineno"></span><span class="op" id="5435048">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5435051">func</span>&nbsp;<span class="op" id="5435056">(</span><span class="ident" id="5435057">d</span>&nbsp;<span class="op" id="5435059">*</span><span class="ident" id="5435060">dataCloser</span><span class="op" id="5435070">)</span>&nbsp;<span class="ident" id="5435072">Close</span><span class="op" id="5435077">(</span><span class="op" id="5435078">)</span>&nbsp;<span class="builtintype" id="5435080">error</span>&nbsp;<span class="op" id="5435086">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5435089">d</span><span class="op" id="5435090">.</span><span class="ident" id="5435091">WriteCloser</span><span class="op" id="5435102">.</span><span class="ident" id="5435103">Close</span><span class="op" id="5435108">(</span><span class="op" id="5435109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5435112">_</span><span class="op" id="5435113">,</span>&nbsp;<span class="ident" id="5435115">_</span><span class="op" id="5435116">,</span>&nbsp;<span class="ident" id="5435118">err</span>&nbsp;<span class="op" id="5435122">:=</span>&nbsp;<span class="ident" id="5435125">d</span><span class="op" id="5435126">.</span><span class="ident" id="5435127">c</span><span class="op" id="5435128">.</span><span class="ident" id="5435129">Text</span><span class="op" id="5435133">.</span><span class="ident" id="5435134">ReadResponse</span><span class="op" id="5435146">(</span><span class="num" id="5435147">250</span><span class="op" id="5435150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5435153">return</span>&nbsp;<span class="ident" id="5435160">err</span><br>
<span class="lineno"></span><span class="op" id="5435164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="5435167">//&nbsp;Data&nbsp;issues&nbsp;a&nbsp;DATA&nbsp;command&nbsp;to&nbsp;the&nbsp;server&nbsp;and&nbsp;returns&nbsp;a&nbsp;writer&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5435237">//&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;write&nbsp;the&nbsp;data.&nbsp;The&nbsp;caller&nbsp;should&nbsp;close&nbsp;the&nbsp;writer</span><br>
<span class="lineno"></span><span class="comment" id="5435306">//&nbsp;before&nbsp;calling&nbsp;any&nbsp;more&nbsp;methods&nbsp;on&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="5435347">//&nbsp;A&nbsp;call&nbsp;to&nbsp;Data&nbsp;must&nbsp;be&nbsp;preceded&nbsp;by&nbsp;one&nbsp;or&nbsp;more&nbsp;calls&nbsp;to&nbsp;Rcpt.</span><br>
<span class="lineno"></span><span class="keyword" id="5435412">func</span>&nbsp;<span class="op" id="5435417">(</span><span class="ident" id="5435418">c</span>&nbsp;<span class="op" id="5435420">*</span><span class="ident" id="5435421">Client</span><span class="op" id="5435427">)</span>&nbsp;<span class="ident" id="5435429">Data</span><span class="op" id="5435433">(</span><span class="op" id="5435434">)</span>&nbsp;<span class="op" id="5435436">(</span><span class="ident" id="5435437">io</span><span class="op" id="5435439">.</span><span class="ident" id="5435440">WriteCloser</span><span class="op" id="5435451">,</span>&nbsp;<span class="builtintype" id="5435453">error</span><span class="op" id="5435458">)</span>&nbsp;<span class="op" id="5435460">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5435463">_</span><span class="op" id="5435464">,</span>&nbsp;<span class="ident" id="5435466">_</span><span class="op" id="5435467">,</span>&nbsp;<span class="ident" id="5435469">err</span>&nbsp;<span class="op" id="5435473">:=</span>&nbsp;<span class="ident" id="5435476">c</span><span class="op" id="5435477">.</span><span class="ident" id="5435478">cmd</span><span class="op" id="5435481">(</span><span class="num" id="5435482">354</span><span class="op" id="5435485">,</span>&nbsp;<span class="string" id="5435487">&#34;DATA&#34;</span><span class="op" id="5435493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5435496">if</span>&nbsp;<span class="ident" id="5435499">err</span>&nbsp;<span class="op" id="5435503">!=</span>&nbsp;<span class="ident" id="5435506">nil</span>&nbsp;<span class="op" id="5435510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5435514">return</span>&nbsp;<span class="ident" id="5435521">nil</span><span class="op" id="5435524">,</span>&nbsp;<span class="ident" id="5435526">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5435531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5435534">return</span>&nbsp;<span class="op" id="5435541">&amp;</span><span class="ident" id="5435542">dataCloser</span><span class="op" id="5435552">{</span><span class="ident" id="5435553">c</span><span class="op" id="5435554">,</span>&nbsp;<span class="ident" id="5435556">c</span><span class="op" id="5435557">.</span><span class="ident" id="5435558">Text</span><span class="op" id="5435562">.</span><span class="ident" id="5435563">DotWriter</span><span class="op" id="5435572">(</span><span class="op" id="5435573">)</span><span class="op" id="5435574">}</span><span class="op" id="5435575">,</span>&nbsp;<span class="ident" id="5435577">nil</span><br>
<span class="lineno">265</span><span class="op" id="5435581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5435584">var</span>&nbsp;<span class="ident" id="5435588">testHookStartTLS</span>&nbsp;<span class="keyword" id="5435605">func</span><span class="op" id="5435609">(</span><span class="op" id="5435610">*</span><span class="ident" id="5435611">tls</span><span class="op" id="5435614">.</span><span class="ident" id="5435615">Config</span><span class="op" id="5435621">)</span>&nbsp;<span class="comment" id="5435623">//&nbsp;nil,&nbsp;except&nbsp;for&nbsp;tests</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5435649">//&nbsp;SendMail&nbsp;connects&nbsp;to&nbsp;the&nbsp;server&nbsp;at&nbsp;addr,&nbsp;switches&nbsp;to&nbsp;TLS&nbsp;if</span><br>
<span class="lineno">270</span><span class="comment" id="5435712">//&nbsp;possible,&nbsp;authenticates&nbsp;with&nbsp;the&nbsp;optional&nbsp;mechanism&nbsp;a&nbsp;if&nbsp;possible,</span><br>
<span class="lineno"></span><span class="comment" id="5435782">//&nbsp;and&nbsp;then&nbsp;sends&nbsp;an&nbsp;email&nbsp;from&nbsp;address&nbsp;from,&nbsp;to&nbsp;addresses&nbsp;to,&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="5435850">//&nbsp;message&nbsp;msg.</span><br>
<span class="lineno"></span><span class="keyword" id="5435866">func</span>&nbsp;<span class="ident" id="5435871">SendMail</span><span class="op" id="5435879">(</span><span class="ident" id="5435880">addr</span>&nbsp;<span class="builtintype" id="5435885">string</span><span class="op" id="5435891">,</span>&nbsp;<span class="ident" id="5435893">a</span>&nbsp;<span class="ident" id="5435895">Auth</span><span class="op" id="5435899">,</span>&nbsp;<span class="ident" id="5435901">from</span>&nbsp;<span class="builtintype" id="5435906">string</span><span class="op" id="5435912">,</span>&nbsp;<span class="ident" id="5435914">to</span>&nbsp;<span class="op" id="5435917">[</span><span class="op" id="5435918">]</span><span class="builtintype" id="5435919">string</span><span class="op" id="5435925">,</span>&nbsp;<span class="ident" id="5435927">msg</span>&nbsp;<span class="op" id="5435931">[</span><span class="op" id="5435932">]</span><span class="builtintype" id="5435933">byte</span><span class="op" id="5435937">)</span>&nbsp;<span class="builtintype" id="5435939">error</span>&nbsp;<span class="op" id="5435945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5435948">c</span><span class="op" id="5435949">,</span>&nbsp;<span class="ident" id="5435951">err</span>&nbsp;<span class="op" id="5435955">:=</span>&nbsp;<span class="ident" id="5435958">Dial</span><span class="op" id="5435962">(</span><span class="ident" id="5435963">addr</span><span class="op" id="5435967">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5435970">if</span>&nbsp;<span class="ident" id="5435973">err</span>&nbsp;<span class="op" id="5435977">!=</span>&nbsp;<span class="ident" id="5435980">nil</span>&nbsp;<span class="op" id="5435984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5435988">return</span>&nbsp;<span class="ident" id="5435995">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5436000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5436003">defer</span>&nbsp;<span class="ident" id="5436009">c</span><span class="op" id="5436010">.</span><span class="ident" id="5436011">Close</span><span class="op" id="5436016">(</span><span class="op" id="5436017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5436020">if</span>&nbsp;<span class="ident" id="5436023">err</span>&nbsp;<span class="op" id="5436027">=</span>&nbsp;<span class="ident" id="5436029">c</span><span class="op" id="5436030">.</span><span class="ident" id="5436031">hello</span><span class="op" id="5436036">(</span><span class="op" id="5436037">)</span><span class="op" id="5436038">;</span>&nbsp;<span class="ident" id="5436040">err</span>&nbsp;<span class="op" id="5436044">!=</span>&nbsp;<span class="ident" id="5436047">nil</span>&nbsp;<span class="op" id="5436051">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5436055">return</span>&nbsp;<span class="ident" id="5436062">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5436067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5436070">if</span>&nbsp;<span class="ident" id="5436073">ok</span><span class="op" id="5436075">,</span>&nbsp;<span class="ident" id="5436077">_</span>&nbsp;<span class="op" id="5436079">:=</span>&nbsp;<span class="ident" id="5436082">c</span><span class="op" id="5436083">.</span><span class="ident" id="5436084">Extension</span><span class="op" id="5436093">(</span><span class="string" id="5436094">&#34;STARTTLS&#34;</span><span class="op" id="5436104">)</span><span class="op" id="5436105">;</span>&nbsp;<span class="ident" id="5436107">ok</span>&nbsp;<span class="op" id="5436110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5436114">config</span>&nbsp;<span class="op" id="5436121">:=</span>&nbsp;<span class="op" id="5436124">&amp;</span><span class="ident" id="5436125">tls</span><span class="op" id="5436128">.</span><span class="ident" id="5436129">Config</span><span class="op" id="5436135">{</span><span class="ident" id="5436136">ServerName</span><span class="op" id="5436146">:</span>&nbsp;<span class="ident" id="5436148">c</span><span class="op" id="5436149">.</span><span class="ident" id="5436150">serverName</span><span class="op" id="5436160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5436164">if</span>&nbsp;<span class="ident" id="5436167">testHookStartTLS</span>&nbsp;<span class="op" id="5436184">!=</span>&nbsp;<span class="ident" id="5436187">nil</span>&nbsp;<span class="op" id="5436191">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5436196">testHookStartTLS</span><span class="op" id="5436212">(</span><span class="ident" id="5436213">config</span><span class="op" id="5436219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5436223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5436227">if</span>&nbsp;<span class="ident" id="5436230">err</span>&nbsp;<span class="op" id="5436234">=</span>&nbsp;<span class="ident" id="5436236">c</span><span class="op" id="5436237">.</span><span class="ident" id="5436238">StartTLS</span><span class="op" id="5436246">(</span><span class="ident" id="5436247">config</span><span class="op" id="5436253">)</span><span class="op" id="5436254">;</span>&nbsp;<span class="ident" id="5436256">err</span>&nbsp;<span class="op" id="5436260">!=</span>&nbsp;<span class="ident" id="5436263">nil</span>&nbsp;<span class="op" id="5436267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5436272">return</span>&nbsp;<span class="ident" id="5436279">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5436285">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5436288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5436291">if</span>&nbsp;<span class="ident" id="5436294">a</span>&nbsp;<span class="op" id="5436296">!=</span>&nbsp;<span class="ident" id="5436299">nil</span>&nbsp;<span class="op" id="5436303">&amp;&amp;</span>&nbsp;<span class="ident" id="5436306">c</span><span class="op" id="5436307">.</span><span class="ident" id="5436308">ext</span>&nbsp;<span class="op" id="5436312">!=</span>&nbsp;<span class="ident" id="5436315">nil</span>&nbsp;<span class="op" id="5436319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5436323">if</span>&nbsp;<span class="ident" id="5436326">_</span><span class="op" id="5436327">,</span>&nbsp;<span class="ident" id="5436329">ok</span>&nbsp;<span class="op" id="5436332">:=</span>&nbsp;<span class="ident" id="5436335">c</span><span class="op" id="5436336">.</span><span class="ident" id="5436337">ext</span><span class="op" id="5436340">[</span><span class="string" id="5436341">&#34;AUTH&#34;</span><span class="op" id="5436347">]</span><span class="op" id="5436348">;</span>&nbsp;<span class="ident" id="5436350">ok</span>&nbsp;<span class="op" id="5436353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5436358">if</span>&nbsp;<span class="ident" id="5436361">err</span>&nbsp;<span class="op" id="5436365">=</span>&nbsp;<span class="ident" id="5436367">c</span><span class="op" id="5436368">.</span><span class="ident" id="5436369">Auth</span><span class="op" id="5436373">(</span><span class="ident" id="5436374">a</span><span class="op" id="5436375">)</span><span class="op" id="5436376">;</span>&nbsp;<span class="ident" id="5436378">err</span>&nbsp;<span class="op" id="5436382">!=</span>&nbsp;<span class="ident" id="5436385">nil</span>&nbsp;<span class="op" id="5436389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5436395">return</span>&nbsp;<span class="ident" id="5436402">err</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5436409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5436413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5436416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5436419">if</span>&nbsp;<span class="ident" id="5436422">err</span>&nbsp;<span class="op" id="5436426">=</span>&nbsp;<span class="ident" id="5436428">c</span><span class="op" id="5436429">.</span><span class="ident" id="5436430">Mail</span><span class="op" id="5436434">(</span><span class="ident" id="5436435">from</span><span class="op" id="5436439">)</span><span class="op" id="5436440">;</span>&nbsp;<span class="ident" id="5436442">err</span>&nbsp;<span class="op" id="5436446">!=</span>&nbsp;<span class="ident" id="5436449">nil</span>&nbsp;<span class="op" id="5436453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5436457">return</span>&nbsp;<span class="ident" id="5436464">err</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5436469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5436472">for</span>&nbsp;<span class="ident" id="5436476">_</span><span class="op" id="5436477">,</span>&nbsp;<span class="ident" id="5436479">addr</span>&nbsp;<span class="op" id="5436484">:=</span>&nbsp;<span class="keyword" id="5436487">range</span>&nbsp;<span class="ident" id="5436493">to</span>&nbsp;<span class="op" id="5436496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5436500">if</span>&nbsp;<span class="ident" id="5436503">err</span>&nbsp;<span class="op" id="5436507">=</span>&nbsp;<span class="ident" id="5436509">c</span><span class="op" id="5436510">.</span><span class="ident" id="5436511">Rcpt</span><span class="op" id="5436515">(</span><span class="ident" id="5436516">addr</span><span class="op" id="5436520">)</span><span class="op" id="5436521">;</span>&nbsp;<span class="ident" id="5436523">err</span>&nbsp;<span class="op" id="5436527">!=</span>&nbsp;<span class="ident" id="5436530">nil</span>&nbsp;<span class="op" id="5436534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5436539">return</span>&nbsp;<span class="ident" id="5436546">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5436552">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5436555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5436558">w</span><span class="op" id="5436559">,</span>&nbsp;<span class="ident" id="5436561">err</span>&nbsp;<span class="op" id="5436565">:=</span>&nbsp;<span class="ident" id="5436568">c</span><span class="op" id="5436569">.</span><span class="ident" id="5436570">Data</span><span class="op" id="5436574">(</span><span class="op" id="5436575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5436578">if</span>&nbsp;<span class="ident" id="5436581">err</span>&nbsp;<span class="op" id="5436585">!=</span>&nbsp;<span class="ident" id="5436588">nil</span>&nbsp;<span class="op" id="5436592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5436596">return</span>&nbsp;<span class="ident" id="5436603">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5436608">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5436611">_</span><span class="op" id="5436612">,</span>&nbsp;<span class="ident" id="5436614">err</span>&nbsp;<span class="op" id="5436618">=</span>&nbsp;<span class="ident" id="5436620">w</span><span class="op" id="5436621">.</span><span class="ident" id="5436622">Write</span><span class="op" id="5436627">(</span><span class="ident" id="5436628">msg</span><span class="op" id="5436631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5436634">if</span>&nbsp;<span class="ident" id="5436637">err</span>&nbsp;<span class="op" id="5436641">!=</span>&nbsp;<span class="ident" id="5436644">nil</span>&nbsp;<span class="op" id="5436648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5436652">return</span>&nbsp;<span class="ident" id="5436659">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5436664">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5436667">err</span>&nbsp;<span class="op" id="5436671">=</span>&nbsp;<span class="ident" id="5436673">w</span><span class="op" id="5436674">.</span><span class="ident" id="5436675">Close</span><span class="op" id="5436680">(</span><span class="op" id="5436681">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5436684">if</span>&nbsp;<span class="ident" id="5436687">err</span>&nbsp;<span class="op" id="5436691">!=</span>&nbsp;<span class="ident" id="5436694">nil</span>&nbsp;<span class="op" id="5436698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5436702">return</span>&nbsp;<span class="ident" id="5436709">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5436714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5436717">return</span>&nbsp;<span class="ident" id="5436724">c</span><span class="op" id="5436725">.</span><span class="ident" id="5436726">Quit</span><span class="op" id="5436730">(</span><span class="op" id="5436731">)</span><br>
<span class="lineno"></span><span class="op" id="5436733">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span><span class="comment" id="5436736">//&nbsp;Extension&nbsp;reports&nbsp;whether&nbsp;an&nbsp;extension&nbsp;is&nbsp;support&nbsp;by&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span><span class="comment" id="5436804">//&nbsp;The&nbsp;extension&nbsp;name&nbsp;is&nbsp;case-insensitive.&nbsp;If&nbsp;the&nbsp;extension&nbsp;is&nbsp;supported,</span><br>
<span class="lineno"></span><span class="comment" id="5436878">//&nbsp;Extension&nbsp;also&nbsp;returns&nbsp;a&nbsp;string&nbsp;that&nbsp;contains&nbsp;any&nbsp;parameters&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5436946">//&nbsp;server&nbsp;specifies&nbsp;for&nbsp;the&nbsp;extension.</span><br>
<span class="lineno">325</span><span class="keyword" id="5436985">func</span>&nbsp;<span class="op" id="5436990">(</span><span class="ident" id="5436991">c</span>&nbsp;<span class="op" id="5436993">*</span><span class="ident" id="5436994">Client</span><span class="op" id="5437000">)</span>&nbsp;<span class="ident" id="5437002">Extension</span><span class="op" id="5437011">(</span><span class="ident" id="5437012">ext</span>&nbsp;<span class="builtintype" id="5437016">string</span><span class="op" id="5437022">)</span>&nbsp;<span class="op" id="5437024">(</span><span class="builtintype" id="5437025">bool</span><span class="op" id="5437029">,</span>&nbsp;<span class="builtintype" id="5437031">string</span><span class="op" id="5437037">)</span>&nbsp;<span class="op" id="5437039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5437042">if</span>&nbsp;<span class="ident" id="5437045">err</span>&nbsp;<span class="op" id="5437049">:=</span>&nbsp;<span class="ident" id="5437052">c</span><span class="op" id="5437053">.</span><span class="ident" id="5437054">hello</span><span class="op" id="5437059">(</span><span class="op" id="5437060">)</span><span class="op" id="5437061">;</span>&nbsp;<span class="ident" id="5437063">err</span>&nbsp;<span class="op" id="5437067">!=</span>&nbsp;<span class="ident" id="5437070">nil</span>&nbsp;<span class="op" id="5437074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5437078">return</span>&nbsp;<span class="builtintype" id="5437085">false</span><span class="op" id="5437090">,</span>&nbsp;<span class="string" id="5437092">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5437096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5437099">if</span>&nbsp;<span class="ident" id="5437102">c</span><span class="op" id="5437103">.</span><span class="ident" id="5437104">ext</span>&nbsp;<span class="op" id="5437108">==</span>&nbsp;<span class="ident" id="5437111">nil</span>&nbsp;<span class="op" id="5437115">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5437119">return</span>&nbsp;<span class="builtintype" id="5437126">false</span><span class="op" id="5437131">,</span>&nbsp;<span class="string" id="5437133">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5437137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437140">ext</span>&nbsp;<span class="op" id="5437144">=</span>&nbsp;<span class="ident" id="5437146">strings</span><span class="op" id="5437153">.</span><span class="ident" id="5437154">ToUpper</span><span class="op" id="5437161">(</span><span class="ident" id="5437162">ext</span><span class="op" id="5437165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437168">param</span><span class="op" id="5437173">,</span>&nbsp;<span class="ident" id="5437175">ok</span>&nbsp;<span class="op" id="5437178">:=</span>&nbsp;<span class="ident" id="5437181">c</span><span class="op" id="5437182">.</span><span class="ident" id="5437183">ext</span><span class="op" id="5437186">[</span><span class="ident" id="5437187">ext</span><span class="op" id="5437190">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5437193">return</span>&nbsp;<span class="ident" id="5437200">ok</span><span class="op" id="5437202">,</span>&nbsp;<span class="ident" id="5437204">param</span><br>
<span class="lineno">335</span><span class="op" id="5437210">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5437213">//&nbsp;Reset&nbsp;sends&nbsp;the&nbsp;RSET&nbsp;command&nbsp;to&nbsp;the&nbsp;server,&nbsp;aborting&nbsp;the&nbsp;current&nbsp;mail</span><br>
<span class="lineno"></span><span class="comment" id="5437286">//&nbsp;transaction.</span><br>
<span class="lineno"></span><span class="keyword" id="5437302">func</span>&nbsp;<span class="op" id="5437307">(</span><span class="ident" id="5437308">c</span>&nbsp;<span class="op" id="5437310">*</span><span class="ident" id="5437311">Client</span><span class="op" id="5437317">)</span>&nbsp;<span class="ident" id="5437319">Reset</span><span class="op" id="5437324">(</span><span class="op" id="5437325">)</span>&nbsp;<span class="builtintype" id="5437327">error</span>&nbsp;<span class="op" id="5437333">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5437336">if</span>&nbsp;<span class="ident" id="5437339">err</span>&nbsp;<span class="op" id="5437343">:=</span>&nbsp;<span class="ident" id="5437346">c</span><span class="op" id="5437347">.</span><span class="ident" id="5437348">hello</span><span class="op" id="5437353">(</span><span class="op" id="5437354">)</span><span class="op" id="5437355">;</span>&nbsp;<span class="ident" id="5437357">err</span>&nbsp;<span class="op" id="5437361">!=</span>&nbsp;<span class="ident" id="5437364">nil</span>&nbsp;<span class="op" id="5437368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5437372">return</span>&nbsp;<span class="ident" id="5437379">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5437384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437387">_</span><span class="op" id="5437388">,</span>&nbsp;<span class="ident" id="5437390">_</span><span class="op" id="5437391">,</span>&nbsp;<span class="ident" id="5437393">err</span>&nbsp;<span class="op" id="5437397">:=</span>&nbsp;<span class="ident" id="5437400">c</span><span class="op" id="5437401">.</span><span class="ident" id="5437402">cmd</span><span class="op" id="5437405">(</span><span class="num" id="5437406">250</span><span class="op" id="5437409">,</span>&nbsp;<span class="string" id="5437411">&#34;RSET&#34;</span><span class="op" id="5437417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5437420">return</span>&nbsp;<span class="ident" id="5437427">err</span><br>
<span class="lineno">345</span><span class="op" id="5437431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5437434">//&nbsp;Quit&nbsp;sends&nbsp;the&nbsp;QUIT&nbsp;command&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection&nbsp;to&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="5437506">func</span>&nbsp;<span class="op" id="5437511">(</span><span class="ident" id="5437512">c</span>&nbsp;<span class="op" id="5437514">*</span><span class="ident" id="5437515">Client</span><span class="op" id="5437521">)</span>&nbsp;<span class="ident" id="5437523">Quit</span><span class="op" id="5437527">(</span><span class="op" id="5437528">)</span>&nbsp;<span class="builtintype" id="5437530">error</span>&nbsp;<span class="op" id="5437536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5437539">if</span>&nbsp;<span class="ident" id="5437542">err</span>&nbsp;<span class="op" id="5437546">:=</span>&nbsp;<span class="ident" id="5437549">c</span><span class="op" id="5437550">.</span><span class="ident" id="5437551">hello</span><span class="op" id="5437556">(</span><span class="op" id="5437557">)</span><span class="op" id="5437558">;</span>&nbsp;<span class="ident" id="5437560">err</span>&nbsp;<span class="op" id="5437564">!=</span>&nbsp;<span class="ident" id="5437567">nil</span>&nbsp;<span class="op" id="5437571">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5437575">return</span>&nbsp;<span class="ident" id="5437582">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5437587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437590">_</span><span class="op" id="5437591">,</span>&nbsp;<span class="ident" id="5437593">_</span><span class="op" id="5437594">,</span>&nbsp;<span class="ident" id="5437596">err</span>&nbsp;<span class="op" id="5437600">:=</span>&nbsp;<span class="ident" id="5437603">c</span><span class="op" id="5437604">.</span><span class="ident" id="5437605">cmd</span><span class="op" id="5437608">(</span><span class="num" id="5437609">221</span><span class="op" id="5437612">,</span>&nbsp;<span class="string" id="5437614">&#34;QUIT&#34;</span><span class="op" id="5437620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5437623">if</span>&nbsp;<span class="ident" id="5437626">err</span>&nbsp;<span class="op" id="5437630">!=</span>&nbsp;<span class="ident" id="5437633">nil</span>&nbsp;<span class="op" id="5437637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5437641">return</span>&nbsp;<span class="ident" id="5437648">err</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5437653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5437656">return</span>&nbsp;<span class="ident" id="5437663">c</span><span class="op" id="5437664">.</span><span class="ident" id="5437665">Text</span><span class="op" id="5437669">.</span><span class="ident" id="5437670">Close</span><span class="op" id="5437675">(</span><span class="op" id="5437676">)</span><br>
<span class="lineno"></span><span class="op" id="5437678">}</span>
</div>
</body>
</html>
