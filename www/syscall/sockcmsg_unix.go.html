<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2118507">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2118563">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2118617">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2118668">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2118733">//&nbsp;Socket&nbsp;control&nbsp;messages</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2118761">package</span>&nbsp;<span class="ident" id="2118769">syscall</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="2118778">import</span>&nbsp;<span class="string" id="2118785">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2118795">//&nbsp;Round&nbsp;the&nbsp;length&nbsp;of&nbsp;a&nbsp;raw&nbsp;sockaddr&nbsp;up&nbsp;to&nbsp;align&nbsp;it&nbsp;properly.</span><br>
<span class="lineno"></span><span class="keyword" id="2118858">func</span>&nbsp;<span class="ident" id="2118863">cmsgAlignOf</span><span class="op" id="2118874">(</span><span class="ident" id="2118875">salen</span>&nbsp;<span class="builtintype" id="2118881">int</span><span class="op" id="2118884">)</span>&nbsp;<span class="builtintype" id="2118886">int</span>&nbsp;<span class="op" id="2118890">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2118893">salign</span>&nbsp;<span class="op" id="2118900">:=</span>&nbsp;<span class="ident" id="2118903"><a href="/syscall/ztypes_linux_amd64.go.html#2279603">sizeofPtr</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2118914">//&nbsp;NOTE:&nbsp;It&nbsp;seems&nbsp;like&nbsp;64-bit&nbsp;Darwin&nbsp;and&nbsp;DragonFly&nbsp;BSD&nbsp;kernels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2118978">//&nbsp;still&nbsp;require&nbsp;32-bit&nbsp;aligned&nbsp;access&nbsp;to&nbsp;network&nbsp;subsystem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2119040">if</span>&nbsp;<span class="ident" id="2119043"><a href="/syscall/syscall_unix.go.html#2156997">darwin64Bit</a></span>&nbsp;<span class="op" id="2119055">||</span>&nbsp;<span class="ident" id="2119058"><a href="/syscall/syscall_unix.go.html#2157058">dragonfly64Bit</a></span>&nbsp;<span class="op" id="2119073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2119077"><a href="/syscall/sockcmsg_unix.go.html#2118893">salign</a></span>&nbsp;<span class="op" id="2119084">=</span>&nbsp;<span class="num" id="2119086">4</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2119089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2119092">return</span>&nbsp;<span class="op" id="2119099">(</span><span class="ident" id="2119100"><a href="/syscall/sockcmsg_unix.go.html#2118875">salen</a></span>&nbsp;<span class="op" id="2119106">+</span>&nbsp;<span class="ident" id="2119108"><a href="/syscall/sockcmsg_unix.go.html#2118893">salign</a></span>&nbsp;<span class="op" id="2119115">-</span>&nbsp;<span class="num" id="2119117">1</span><span class="op" id="2119118">)</span>&nbsp;<span class="op" id="2119120">&amp;</span>&nbsp;<span class="op" id="2119122">^</span><span class="op" id="2119123">(</span><span class="ident" id="2119124"><a href="/syscall/sockcmsg_unix.go.html#2118893">salign</a></span>&nbsp;<span class="op" id="2119131">-</span>&nbsp;<span class="num" id="2119133">1</span><span class="op" id="2119134">)</span><br>
<span class="lineno"></span><span class="op" id="2119136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2119139">//&nbsp;CmsgLen&nbsp;returns&nbsp;the&nbsp;value&nbsp;to&nbsp;store&nbsp;in&nbsp;the&nbsp;Len&nbsp;field&nbsp;of&nbsp;the&nbsp;Cmsghdr</span><br>
<span class="lineno">25</span><span class="comment" id="2119209">//&nbsp;structure,&nbsp;taking&nbsp;into&nbsp;account&nbsp;any&nbsp;necessary&nbsp;alignment.</span><br>
<span class="lineno"></span><span class="keyword" id="2119268">func</span>&nbsp;<span class="ident" id="2119273">CmsgLen</span><span class="op" id="2119280">(</span><span class="ident" id="2119281">datalen</span>&nbsp;<span class="builtintype" id="2119289">int</span><span class="op" id="2119292">)</span>&nbsp;<span class="builtintype" id="2119294">int</span>&nbsp;<span class="op" id="2119298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2119301">return</span>&nbsp;<span class="ident" id="2119308"><a href="/syscall/sockcmsg_unix.go.html#2118863">cmsgAlignOf</a></span><span class="op" id="2119319">(</span><span class="ident" id="2119320"><a href="/syscall/ztypes_linux_amd64.go.html#2284548">SizeofCmsghdr</a></span><span class="op" id="2119333">)</span>&nbsp;<span class="op" id="2119335">+</span>&nbsp;<span class="ident" id="2119337"><a href="/syscall/sockcmsg_unix.go.html#2119281">datalen</a></span><br>
<span class="lineno"></span><span class="op" id="2119345">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="2119348">//&nbsp;CmsgSpace&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;an&nbsp;ancillary&nbsp;element&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="2119415">//&nbsp;payload&nbsp;of&nbsp;the&nbsp;passed&nbsp;data&nbsp;length&nbsp;occupies.</span><br>
<span class="lineno"></span><span class="keyword" id="2119462">func</span>&nbsp;<span class="ident" id="2119467">CmsgSpace</span><span class="op" id="2119476">(</span><span class="ident" id="2119477">datalen</span>&nbsp;<span class="builtintype" id="2119485">int</span><span class="op" id="2119488">)</span>&nbsp;<span class="builtintype" id="2119490">int</span>&nbsp;<span class="op" id="2119494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2119497">return</span>&nbsp;<span class="ident" id="2119504"><a href="/syscall/sockcmsg_unix.go.html#2118863">cmsgAlignOf</a></span><span class="op" id="2119515">(</span><span class="ident" id="2119516"><a href="/syscall/ztypes_linux_amd64.go.html#2284548">SizeofCmsghdr</a></span><span class="op" id="2119529">)</span>&nbsp;<span class="op" id="2119531">+</span>&nbsp;<span class="ident" id="2119533"><a href="/syscall/sockcmsg_unix.go.html#2118863">cmsgAlignOf</a></span><span class="op" id="2119544">(</span><span class="ident" id="2119545"><a href="/syscall/sockcmsg_unix.go.html#2119477">datalen</a></span><span class="op" id="2119552">)</span><br>
<span class="lineno"></span><span class="op" id="2119554">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="2119557">func</span>&nbsp;<span class="ident" id="2119562">cmsgData</span><span class="op" id="2119570">(</span><span class="ident" id="2119571">h</span>&nbsp;<span class="op" id="2119573">*</span><span class="ident" id="2119574"><a href="/syscall/ztypes_linux_amd64.go.html#2282996">Cmsghdr</a></span><span class="op" id="2119581">)</span>&nbsp;<span class="ident" id="2119583"><a href="/syscall/sockcmsg_unix.go.html#2118785">unsafe</a></span><span class="op" id="2119589">.</span><span class="ident" id="2119590">Pointer</span>&nbsp;<span class="op" id="2119598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2119601">return</span>&nbsp;<span class="ident" id="2119608"><a href="/syscall/sockcmsg_unix.go.html#2118785">unsafe</a></span><span class="op" id="2119614">.</span><span class="ident" id="2119615">Pointer</span><span class="op" id="2119622">(</span><span class="builtintype" id="2119623">uintptr</span><span class="op" id="2119630">(</span><span class="ident" id="2119631"><a href="/syscall/sockcmsg_unix.go.html#2118785">unsafe</a></span><span class="op" id="2119637">.</span><span class="ident" id="2119638">Pointer</span><span class="op" id="2119645">(</span><span class="ident" id="2119646"><a href="/syscall/sockcmsg_unix.go.html#2119571">h</a></span><span class="op" id="2119647">)</span><span class="op" id="2119648">)</span>&nbsp;<span class="op" id="2119650">+</span>&nbsp;<span class="builtintype" id="2119652">uintptr</span><span class="op" id="2119659">(</span><span class="ident" id="2119660"><a href="/syscall/sockcmsg_unix.go.html#2118863">cmsgAlignOf</a></span><span class="op" id="2119671">(</span><span class="ident" id="2119672"><a href="/syscall/ztypes_linux_amd64.go.html#2284548">SizeofCmsghdr</a></span><span class="op" id="2119685">)</span><span class="op" id="2119686">)</span><span class="op" id="2119687">)</span><br>
<span class="lineno"></span><span class="op" id="2119689">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="2119692">//&nbsp;SocketControlMessage&nbsp;represents&nbsp;a&nbsp;socket&nbsp;control&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="2119753">type</span>&nbsp;<span class="ident" id="2119758">SocketControlMessage</span>&nbsp;<span class="keyword" id="2119779">struct</span>&nbsp;<span class="op" id="2119786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2119789">Header</span>&nbsp;<span class="ident" id="2119796"><a href="/syscall/ztypes_linux_amd64.go.html#2282996">Cmsghdr</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2119805">Data</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2119812">[</span><span class="op" id="2119813">]</span><span class="builtintype" id="2119814">byte</span><br>
<span class="lineno"></span><span class="op" id="2119819">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="2119822">//&nbsp;ParseSocketControlMessage&nbsp;parses&nbsp;b&nbsp;as&nbsp;an&nbsp;array&nbsp;of&nbsp;socket&nbsp;control</span><br>
<span class="lineno"></span><span class="comment" id="2119890">//&nbsp;messages.</span><br>
<span class="lineno"></span><span class="keyword" id="2119903">func</span>&nbsp;<span class="ident" id="2119908">ParseSocketControlMessage</span><span class="op" id="2119933">(</span><span class="ident" id="2119934">b</span>&nbsp;<span class="op" id="2119936">[</span><span class="op" id="2119937">]</span><span class="builtintype" id="2119938">byte</span><span class="op" id="2119942">)</span>&nbsp;<span class="op" id="2119944">(</span><span class="op" id="2119945">[</span><span class="op" id="2119946">]</span><span class="ident" id="2119947"><a href="/syscall/sockcmsg_unix.go.html#2119758">SocketControlMessage</a></span><span class="op" id="2119967">,</span>&nbsp;<span class="builtintype" id="2119969">error</span><span class="op" id="2119974">)</span>&nbsp;<span class="op" id="2119976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2119979">var</span>&nbsp;<span class="ident" id="2119983">msgs</span>&nbsp;<span class="op" id="2119988">[</span><span class="op" id="2119989">]</span><span class="ident" id="2119990"><a href="/syscall/sockcmsg_unix.go.html#2119758">SocketControlMessage</a></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2120012">i</span>&nbsp;<span class="op" id="2120014">:=</span>&nbsp;<span class="num" id="2120017">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2120020">for</span>&nbsp;<span class="ident" id="2120024"><a href="/syscall/sockcmsg_unix.go.html#2120012">i</a></span><span class="op" id="2120025">+</span><span class="ident" id="2120026"><a href="/syscall/sockcmsg_unix.go.html#2119273">CmsgLen</a></span><span class="op" id="2120033">(</span><span class="num" id="2120034">0</span><span class="op" id="2120035">)</span>&nbsp;<span class="op" id="2120037">&lt;=</span>&nbsp;<span class="builtinfunc" id="2120040">len</span><span class="op" id="2120043">(</span><span class="ident" id="2120044"><a href="/syscall/sockcmsg_unix.go.html#2119934">b</a></span><span class="op" id="2120045">)</span>&nbsp;<span class="op" id="2120047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2120051">h</span><span class="op" id="2120052">,</span>&nbsp;<span class="ident" id="2120054">dbuf</span><span class="op" id="2120058">,</span>&nbsp;<span class="ident" id="2120060">err</span>&nbsp;<span class="op" id="2120064">:=</span>&nbsp;<span class="ident" id="2120067"><a href="/syscall/sockcmsg_unix.go.html#2120286">socketControlMessageHeaderAndData</a></span><span class="op" id="2120100">(</span><span class="ident" id="2120101"><a href="/syscall/sockcmsg_unix.go.html#2119934">b</a></span><span class="op" id="2120102">[</span><span class="ident" id="2120103"><a href="/syscall/sockcmsg_unix.go.html#2120012">i</a></span><span class="op" id="2120104">:</span><span class="op" id="2120105">]</span><span class="op" id="2120106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2120110">if</span>&nbsp;<span class="ident" id="2120113"><a href="/syscall/sockcmsg_unix.go.html#2120060">err</a></span>&nbsp;<span class="op" id="2120117">!=</span>&nbsp;<span class="ident" id="2120120">nil</span>&nbsp;<span class="op" id="2120124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2120129">return</span>&nbsp;<span class="ident" id="2120136">nil</span><span class="op" id="2120139">,</span>&nbsp;<span class="ident" id="2120141"><a href="/syscall/sockcmsg_unix.go.html#2120060">err</a></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2120147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2120151">m</span>&nbsp;<span class="op" id="2120153">:=</span>&nbsp;<span class="ident" id="2120156"><a href="/syscall/sockcmsg_unix.go.html#2119758">SocketControlMessage</a></span><span class="op" id="2120176">{</span><span class="ident" id="2120177">Header</span><span class="op" id="2120183">:</span>&nbsp;<span class="op" id="2120185">*</span><span class="ident" id="2120186"><a href="/syscall/sockcmsg_unix.go.html#2120051">h</a></span><span class="op" id="2120187">,</span>&nbsp;<span class="ident" id="2120189">Data</span><span class="op" id="2120193">:</span>&nbsp;<span class="ident" id="2120195"><a href="/syscall/sockcmsg_unix.go.html#2120054">dbuf</a></span><span class="op" id="2120199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2120203"><a href="/syscall/sockcmsg_unix.go.html#2119983">msgs</a></span>&nbsp;<span class="op" id="2120208">=</span>&nbsp;<span class="builtinfunc" id="2120210">append</span><span class="op" id="2120216">(</span><span class="ident" id="2120217"><a href="/syscall/sockcmsg_unix.go.html#2119983">msgs</a></span><span class="op" id="2120221">,</span>&nbsp;<span class="ident" id="2120223"><a href="/syscall/sockcmsg_unix.go.html#2120151">m</a></span><span class="op" id="2120224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2120228"><a href="/syscall/sockcmsg_unix.go.html#2120012">i</a></span>&nbsp;<span class="op" id="2120230">+=</span>&nbsp;<span class="ident" id="2120233"><a href="/syscall/sockcmsg_unix.go.html#2118863">cmsgAlignOf</a></span><span class="op" id="2120244">(</span><span class="builtintype" id="2120245">int</span><span class="op" id="2120248">(</span><span class="ident" id="2120249"><a href="/syscall/sockcmsg_unix.go.html#2120051">h</a></span><span class="op" id="2120250">.</span><span class="ident" id="2120251">Len</span><span class="op" id="2120254">)</span><span class="op" id="2120255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2120258">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2120261">return</span>&nbsp;<span class="ident" id="2120268"><a href="/syscall/sockcmsg_unix.go.html#2119983">msgs</a></span><span class="op" id="2120272">,</span>&nbsp;<span class="ident" id="2120274">nil</span><br>
<span class="lineno"></span><span class="op" id="2120278">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2120281">func</span>&nbsp;<span class="ident" id="2120286">socketControlMessageHeaderAndData</span><span class="op" id="2120319">(</span><span class="ident" id="2120320">b</span>&nbsp;<span class="op" id="2120322">[</span><span class="op" id="2120323">]</span><span class="builtintype" id="2120324">byte</span><span class="op" id="2120328">)</span>&nbsp;<span class="op" id="2120330">(</span><span class="op" id="2120331">*</span><span class="ident" id="2120332"><a href="/syscall/ztypes_linux_amd64.go.html#2282996">Cmsghdr</a></span><span class="op" id="2120339">,</span>&nbsp;<span class="op" id="2120341">[</span><span class="op" id="2120342">]</span><span class="builtintype" id="2120343">byte</span><span class="op" id="2120347">,</span>&nbsp;<span class="builtintype" id="2120349">error</span><span class="op" id="2120354">)</span>&nbsp;<span class="op" id="2120356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2120359">h</span>&nbsp;<span class="op" id="2120361">:=</span>&nbsp;<span class="op" id="2120364">(</span><span class="op" id="2120365">*</span><span class="ident" id="2120366"><a href="/syscall/ztypes_linux_amd64.go.html#2282996">Cmsghdr</a></span><span class="op" id="2120373">)</span><span class="op" id="2120374">(</span><span class="ident" id="2120375"><a href="/syscall/sockcmsg_unix.go.html#2118785">unsafe</a></span><span class="op" id="2120381">.</span><span class="ident" id="2120382">Pointer</span><span class="op" id="2120389">(</span><span class="op" id="2120390">&amp;</span><span class="ident" id="2120391"><a href="/syscall/sockcmsg_unix.go.html#2120320">b</a></span><span class="op" id="2120392">[</span><span class="num" id="2120393">0</span><span class="op" id="2120394">]</span><span class="op" id="2120395">)</span><span class="op" id="2120396">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2120399">if</span>&nbsp;<span class="ident" id="2120402"><a href="/syscall/sockcmsg_unix.go.html#2120359">h</a></span><span class="op" id="2120403">.</span><span class="ident" id="2120404">Len</span>&nbsp;<span class="op" id="2120408">&lt;</span>&nbsp;<span class="ident" id="2120410"><a href="/syscall/ztypes_linux_amd64.go.html#2284548">SizeofCmsghdr</a></span>&nbsp;<span class="op" id="2120424">||</span>&nbsp;<span class="builtintype" id="2120427">int</span><span class="op" id="2120430">(</span><span class="ident" id="2120431"><a href="/syscall/sockcmsg_unix.go.html#2120359">h</a></span><span class="op" id="2120432">.</span><span class="ident" id="2120433">Len</span><span class="op" id="2120436">)</span>&nbsp;<span class="op" id="2120438">&gt;</span>&nbsp;<span class="builtinfunc" id="2120440">len</span><span class="op" id="2120443">(</span><span class="ident" id="2120444"><a href="/syscall/sockcmsg_unix.go.html#2120320">b</a></span><span class="op" id="2120445">)</span>&nbsp;<span class="op" id="2120447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2120451">return</span>&nbsp;<span class="ident" id="2120458">nil</span><span class="op" id="2120461">,</span>&nbsp;<span class="ident" id="2120463">nil</span><span class="op" id="2120466">,</span>&nbsp;<span class="ident" id="2120468"><a href="/syscall/zerrors_linux_amd64.go.html#2214659">EINVAL</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2120476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2120479">return</span>&nbsp;<span class="ident" id="2120486"><a href="/syscall/sockcmsg_unix.go.html#2120359">h</a></span><span class="op" id="2120487">,</span>&nbsp;<span class="ident" id="2120489"><a href="/syscall/sockcmsg_unix.go.html#2120320">b</a></span><span class="op" id="2120490">[</span><span class="ident" id="2120491"><a href="/syscall/sockcmsg_unix.go.html#2118863">cmsgAlignOf</a></span><span class="op" id="2120502">(</span><span class="ident" id="2120503"><a href="/syscall/ztypes_linux_amd64.go.html#2284548">SizeofCmsghdr</a></span><span class="op" id="2120516">)</span><span class="op" id="2120517">:</span><span class="ident" id="2120518"><a href="/syscall/sockcmsg_unix.go.html#2120359">h</a></span><span class="op" id="2120519">.</span><span class="ident" id="2120520">Len</span><span class="op" id="2120523">]</span><span class="op" id="2120524">,</span>&nbsp;<span class="ident" id="2120526">nil</span><br>
<span class="lineno"></span><span class="op" id="2120530">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="2120533">//&nbsp;UnixRights&nbsp;encodes&nbsp;a&nbsp;set&nbsp;of&nbsp;open&nbsp;file&nbsp;descriptors&nbsp;into&nbsp;a&nbsp;socket</span><br>
<span class="lineno"></span><span class="comment" id="2120600">//&nbsp;control&nbsp;message&nbsp;for&nbsp;sending&nbsp;to&nbsp;another&nbsp;process.</span><br>
<span class="lineno"></span><span class="keyword" id="2120651">func</span>&nbsp;<span class="ident" id="2120656">UnixRights</span><span class="op" id="2120666">(</span><span class="ident" id="2120667">fds</span>&nbsp;<span class="op" id="2120671">...</span><span class="builtintype" id="2120674">int</span><span class="op" id="2120677">)</span>&nbsp;<span class="op" id="2120679">[</span><span class="op" id="2120680">]</span><span class="builtintype" id="2120681">byte</span>&nbsp;<span class="op" id="2120686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2120689">datalen</span>&nbsp;<span class="op" id="2120697">:=</span>&nbsp;<span class="builtinfunc" id="2120700">len</span><span class="op" id="2120703">(</span><span class="ident" id="2120704"><a href="/syscall/sockcmsg_unix.go.html#2120667">fds</a></span><span class="op" id="2120707">)</span>&nbsp;<span class="op" id="2120709">*</span>&nbsp;<span class="num" id="2120711">4</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2120714">b</span>&nbsp;<span class="op" id="2120716">:=</span>&nbsp;<span class="builtinfunc" id="2120719">make</span><span class="op" id="2120723">(</span><span class="op" id="2120724">[</span><span class="op" id="2120725">]</span><span class="builtintype" id="2120726">byte</span><span class="op" id="2120730">,</span>&nbsp;<span class="ident" id="2120732"><a href="/syscall/sockcmsg_unix.go.html#2119467">CmsgSpace</a></span><span class="op" id="2120741">(</span><span class="ident" id="2120742"><a href="/syscall/sockcmsg_unix.go.html#2120689">datalen</a></span><span class="op" id="2120749">)</span><span class="op" id="2120750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2120753">h</span>&nbsp;<span class="op" id="2120755">:=</span>&nbsp;<span class="op" id="2120758">(</span><span class="op" id="2120759">*</span><span class="ident" id="2120760"><a href="/syscall/ztypes_linux_amd64.go.html#2282996">Cmsghdr</a></span><span class="op" id="2120767">)</span><span class="op" id="2120768">(</span><span class="ident" id="2120769"><a href="/syscall/sockcmsg_unix.go.html#2118785">unsafe</a></span><span class="op" id="2120775">.</span><span class="ident" id="2120776">Pointer</span><span class="op" id="2120783">(</span><span class="op" id="2120784">&amp;</span><span class="ident" id="2120785"><a href="/syscall/sockcmsg_unix.go.html#2120714">b</a></span><span class="op" id="2120786">[</span><span class="num" id="2120787">0</span><span class="op" id="2120788">]</span><span class="op" id="2120789">)</span><span class="op" id="2120790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2120793"><a href="/syscall/sockcmsg_unix.go.html#2120753">h</a></span><span class="op" id="2120794">.</span><span class="ident" id="2120795">Level</span>&nbsp;<span class="op" id="2120801">=</span>&nbsp;<span class="ident" id="2120803"><a href="/syscall/zerrors_linux_amd64.go.html#2205771">SOL_SOCKET</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2120815"><a href="/syscall/sockcmsg_unix.go.html#2120753">h</a></span><span class="op" id="2120816">.</span><span class="ident" id="2120817">Type</span>&nbsp;<span class="op" id="2120822">=</span>&nbsp;<span class="ident" id="2120824"><a href="/syscall/zerrors_linux_amd64.go.html#2202255">SCM_RIGHTS</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2120836"><a href="/syscall/sockcmsg_unix.go.html#2120753">h</a></span><span class="op" id="2120837">.</span><span class="ident" id="2120838">SetLen</span><span class="op" id="2120844">(</span><span class="ident" id="2120845"><a href="/syscall/sockcmsg_unix.go.html#2119273">CmsgLen</a></span><span class="op" id="2120852">(</span><span class="ident" id="2120853"><a href="/syscall/sockcmsg_unix.go.html#2120689">datalen</a></span><span class="op" id="2120860">)</span><span class="op" id="2120861">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2120864">data</span>&nbsp;<span class="op" id="2120869">:=</span>&nbsp;<span class="builtintype" id="2120872">uintptr</span><span class="op" id="2120879">(</span><span class="ident" id="2120880"><a href="/syscall/sockcmsg_unix.go.html#2119562">cmsgData</a></span><span class="op" id="2120888">(</span><span class="ident" id="2120889"><a href="/syscall/sockcmsg_unix.go.html#2120753">h</a></span><span class="op" id="2120890">)</span><span class="op" id="2120891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2120894">for</span>&nbsp;<span class="ident" id="2120898">_</span><span class="op" id="2120899">,</span>&nbsp;<span class="ident" id="2120901">fd</span>&nbsp;<span class="op" id="2120904">:=</span>&nbsp;<span class="keyword" id="2120907">range</span>&nbsp;<span class="ident" id="2120913"><a href="/syscall/sockcmsg_unix.go.html#2120667">fds</a></span>&nbsp;<span class="op" id="2120917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2120921">*</span><span class="op" id="2120922">(</span><span class="op" id="2120923">*</span><span class="builtintype" id="2120924">int32</span><span class="op" id="2120929">)</span><span class="op" id="2120930">(</span><span class="ident" id="2120931"><a href="/syscall/sockcmsg_unix.go.html#2118785">unsafe</a></span><span class="op" id="2120937">.</span><span class="ident" id="2120938">Pointer</span><span class="op" id="2120945">(</span><span class="ident" id="2120946"><a href="/syscall/sockcmsg_unix.go.html#2120864">data</a></span><span class="op" id="2120950">)</span><span class="op" id="2120951">)</span>&nbsp;<span class="op" id="2120953">=</span>&nbsp;<span class="builtintype" id="2120955">int32</span><span class="op" id="2120960">(</span><span class="ident" id="2120961"><a href="/syscall/sockcmsg_unix.go.html#2120901">fd</a></span><span class="op" id="2120963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2120967"><a href="/syscall/sockcmsg_unix.go.html#2120864">data</a></span>&nbsp;<span class="op" id="2120972">+=</span>&nbsp;<span class="num" id="2120975">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2120978">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2120981">return</span>&nbsp;<span class="ident" id="2120988"><a href="/syscall/sockcmsg_unix.go.html#2120714">b</a></span><br>
<span class="lineno"></span><span class="op" id="2120990">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2120993">//&nbsp;ParseUnixRights&nbsp;decodes&nbsp;a&nbsp;socket&nbsp;control&nbsp;message&nbsp;that&nbsp;contains&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="2121062">//&nbsp;integer&nbsp;array&nbsp;of&nbsp;open&nbsp;file&nbsp;descriptors&nbsp;from&nbsp;another&nbsp;process.</span><br>
<span class="lineno">90</span><span class="keyword" id="2121126">func</span>&nbsp;<span class="ident" id="2121131">ParseUnixRights</span><span class="op" id="2121146">(</span><span class="ident" id="2121147">m</span>&nbsp;<span class="op" id="2121149">*</span><span class="ident" id="2121150"><a href="/syscall/sockcmsg_unix.go.html#2119758">SocketControlMessage</a></span><span class="op" id="2121170">)</span>&nbsp;<span class="op" id="2121172">(</span><span class="op" id="2121173">[</span><span class="op" id="2121174">]</span><span class="builtintype" id="2121175">int</span><span class="op" id="2121178">,</span>&nbsp;<span class="builtintype" id="2121180">error</span><span class="op" id="2121185">)</span>&nbsp;<span class="op" id="2121187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2121190">if</span>&nbsp;<span class="ident" id="2121193"><a href="/syscall/sockcmsg_unix.go.html#2121147">m</a></span><span class="op" id="2121194">.</span><span class="ident" id="2121195">Header</span><span class="op" id="2121201">.</span><span class="ident" id="2121202">Level</span>&nbsp;<span class="op" id="2121208">!=</span>&nbsp;<span class="ident" id="2121211"><a href="/syscall/zerrors_linux_amd64.go.html#2205771">SOL_SOCKET</a></span>&nbsp;<span class="op" id="2121222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2121226">return</span>&nbsp;<span class="ident" id="2121233">nil</span><span class="op" id="2121236">,</span>&nbsp;<span class="ident" id="2121238"><a href="/syscall/zerrors_linux_amd64.go.html#2214659">EINVAL</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2121246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2121249">if</span>&nbsp;<span class="ident" id="2121252"><a href="/syscall/sockcmsg_unix.go.html#2121147">m</a></span><span class="op" id="2121253">.</span><span class="ident" id="2121254">Header</span><span class="op" id="2121260">.</span><span class="ident" id="2121261">Type</span>&nbsp;<span class="op" id="2121266">!=</span>&nbsp;<span class="ident" id="2121269"><a href="/syscall/zerrors_linux_amd64.go.html#2202255">SCM_RIGHTS</a></span>&nbsp;<span class="op" id="2121280">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2121284">return</span>&nbsp;<span class="ident" id="2121291">nil</span><span class="op" id="2121294">,</span>&nbsp;<span class="ident" id="2121296"><a href="/syscall/zerrors_linux_amd64.go.html#2214659">EINVAL</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2121304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2121307">fds</span>&nbsp;<span class="op" id="2121311">:=</span>&nbsp;<span class="builtinfunc" id="2121314">make</span><span class="op" id="2121318">(</span><span class="op" id="2121319">[</span><span class="op" id="2121320">]</span><span class="builtintype" id="2121321">int</span><span class="op" id="2121324">,</span>&nbsp;<span class="builtinfunc" id="2121326">len</span><span class="op" id="2121329">(</span><span class="ident" id="2121330"><a href="/syscall/sockcmsg_unix.go.html#2121147">m</a></span><span class="op" id="2121331">.</span><span class="ident" id="2121332">Data</span><span class="op" id="2121336">)</span><span class="op" id="2121337">&gt;&gt;</span><span class="num" id="2121339">2</span><span class="op" id="2121340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2121343">for</span>&nbsp;<span class="ident" id="2121347">i</span><span class="op" id="2121348">,</span>&nbsp;<span class="ident" id="2121350">j</span>&nbsp;<span class="op" id="2121352">:=</span>&nbsp;<span class="num" id="2121355">0</span><span class="op" id="2121356">,</span>&nbsp;<span class="num" id="2121358">0</span><span class="op" id="2121359">;</span>&nbsp;<span class="ident" id="2121361"><a href="/syscall/sockcmsg_unix.go.html#2121347">i</a></span>&nbsp;<span class="op" id="2121363">&lt;</span>&nbsp;<span class="builtinfunc" id="2121365">len</span><span class="op" id="2121368">(</span><span class="ident" id="2121369"><a href="/syscall/sockcmsg_unix.go.html#2121147">m</a></span><span class="op" id="2121370">.</span><span class="ident" id="2121371">Data</span><span class="op" id="2121375">)</span><span class="op" id="2121376">;</span>&nbsp;<span class="ident" id="2121378"><a href="/syscall/sockcmsg_unix.go.html#2121347">i</a></span>&nbsp;<span class="op" id="2121380">+=</span>&nbsp;<span class="num" id="2121383">4</span>&nbsp;<span class="op" id="2121385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2121389"><a href="/syscall/sockcmsg_unix.go.html#2121307">fds</a></span><span class="op" id="2121392">[</span><span class="ident" id="2121393"><a href="/syscall/sockcmsg_unix.go.html#2121350">j</a></span><span class="op" id="2121394">]</span>&nbsp;<span class="op" id="2121396">=</span>&nbsp;<span class="builtintype" id="2121398">int</span><span class="op" id="2121401">(</span><span class="op" id="2121402">*</span><span class="op" id="2121403">(</span><span class="op" id="2121404">*</span><span class="builtintype" id="2121405">int32</span><span class="op" id="2121410">)</span><span class="op" id="2121411">(</span><span class="ident" id="2121412"><a href="/syscall/sockcmsg_unix.go.html#2118785">unsafe</a></span><span class="op" id="2121418">.</span><span class="ident" id="2121419">Pointer</span><span class="op" id="2121426">(</span><span class="op" id="2121427">&amp;</span><span class="ident" id="2121428"><a href="/syscall/sockcmsg_unix.go.html#2121147">m</a></span><span class="op" id="2121429">.</span><span class="ident" id="2121430">Data</span><span class="op" id="2121434">[</span><span class="ident" id="2121435"><a href="/syscall/sockcmsg_unix.go.html#2121347">i</a></span><span class="op" id="2121436">]</span><span class="op" id="2121437">)</span><span class="op" id="2121438">)</span><span class="op" id="2121439">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2121443"><a href="/syscall/sockcmsg_unix.go.html#2121350">j</a></span><span class="op" id="2121444">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2121448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2121451">return</span>&nbsp;<span class="ident" id="2121458"><a href="/syscall/sockcmsg_unix.go.html#2121307">fds</a></span><span class="op" id="2121461">,</span>&nbsp;<span class="ident" id="2121463">nil</span><br>
<span class="lineno"></span><span class="op" id="2121467">}</span>
</div>
</body>
</html>
