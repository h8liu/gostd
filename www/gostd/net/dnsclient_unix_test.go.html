<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html" class="current">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6428975">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6429030">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6429084">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6429135">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6429200">package</span>&nbsp;<span class="ident" id="6429208">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6429213">import</span>&nbsp;<span class="op" id="6429220">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6429223">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6429229">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6429242">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6429248">&#34;path&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6429256">&#34;reflect&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6429267">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6429278">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6429285">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6429288">var</span>&nbsp;<span class="ident" id="6429292">dnsTransportFallbackTests</span>&nbsp;<span class="op" id="6429318">=</span>&nbsp;<span class="op" id="6429320">[</span><span class="op" id="6429321">]</span><span class="keyword" id="6429322">struct</span>&nbsp;<span class="op" id="6429329">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6429332">server</span>&nbsp;&nbsp;<span class="builtintype" id="6429340">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6429348">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6429356">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6429364">qtype</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6429372">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6429380">timeout</span>&nbsp;<span class="builtintype" id="6429388">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6429393">rcode</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6429401">int</span><br>
<span class="lineno">25</span><span class="op" id="6429405">}</span><span class="op" id="6429406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6429409">//&nbsp;Querying&nbsp;&#34;com.&#34;&nbsp;with&nbsp;qtype=255&nbsp;usually&nbsp;makes&nbsp;an&nbsp;answer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6429468">//&nbsp;which&nbsp;requires&nbsp;more&nbsp;than&nbsp;512&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6429508">{</span><span class="string" id="6429509">&#34;8.8.8.8:53&#34;</span><span class="op" id="6429521">,</span>&nbsp;<span class="string" id="6429523">&#34;com.&#34;</span><span class="op" id="6429529">,</span>&nbsp;<span class="ident" id="6429531">dnsTypeALL</span><span class="op" id="6429541">,</span>&nbsp;<span class="num" id="6429543">2</span><span class="op" id="6429544">,</span>&nbsp;<span class="ident" id="6429546">dnsRcodeSuccess</span><span class="op" id="6429561">}</span><span class="op" id="6429562">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6429565">{</span><span class="string" id="6429566">&#34;8.8.4.4:53&#34;</span><span class="op" id="6429578">,</span>&nbsp;<span class="string" id="6429580">&#34;com.&#34;</span><span class="op" id="6429586">,</span>&nbsp;<span class="ident" id="6429588">dnsTypeALL</span><span class="op" id="6429598">,</span>&nbsp;<span class="num" id="6429600">4</span><span class="op" id="6429601">,</span>&nbsp;<span class="ident" id="6429603">dnsRcodeSuccess</span><span class="op" id="6429618">}</span><span class="op" id="6429619">,</span><br>
<span class="lineno">30</span><span class="op" id="6429621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6429624">func</span>&nbsp;<span class="ident" id="6429629">TestDNSTransportFallback</span><span class="op" id="6429653">(</span><span class="ident" id="6429654">t</span>&nbsp;<span class="op" id="6429656">*</span><span class="ident" id="6429657">testing</span><span class="op" id="6429664">.</span><span class="ident" id="6429665">T</span><span class="op" id="6429666">)</span>&nbsp;<span class="op" id="6429668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6429671">if</span>&nbsp;<span class="ident" id="6429674">testing</span><span class="op" id="6429681">.</span><span class="ident" id="6429682">Short</span><span class="op" id="6429687">(</span><span class="op" id="6429688">)</span>&nbsp;<span class="op" id="6429690">||</span>&nbsp;<span class="op" id="6429693">!</span><span class="op" id="6429694">*</span><span class="ident" id="6429695">testExternal</span>&nbsp;<span class="op" id="6429708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6429712">t</span><span class="op" id="6429713">.</span><span class="ident" id="6429714">Skip</span><span class="op" id="6429718">(</span><span class="string" id="6429719">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="6429760">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6429763">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6429767">for</span>&nbsp;<span class="ident" id="6429771">_</span><span class="op" id="6429772">,</span>&nbsp;<span class="ident" id="6429774">tt</span>&nbsp;<span class="op" id="6429777">:=</span>&nbsp;<span class="keyword" id="6429780">range</span>&nbsp;<span class="ident" id="6429786">dnsTransportFallbackTests</span>&nbsp;<span class="op" id="6429812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6429816">timeout</span>&nbsp;<span class="op" id="6429824">:=</span>&nbsp;<span class="ident" id="6429827">time</span><span class="op" id="6429831">.</span><span class="ident" id="6429832">Duration</span><span class="op" id="6429840">(</span><span class="ident" id="6429841">tt</span><span class="op" id="6429843">.</span><span class="ident" id="6429844">timeout</span><span class="op" id="6429851">)</span>&nbsp;<span class="op" id="6429853">*</span>&nbsp;<span class="ident" id="6429855">time</span><span class="op" id="6429859">.</span><span class="ident" id="6429860">Second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6429869">msg</span><span class="op" id="6429872">,</span>&nbsp;<span class="ident" id="6429874">err</span>&nbsp;<span class="op" id="6429878">:=</span>&nbsp;<span class="ident" id="6429881">exchange</span><span class="op" id="6429889">(</span><span class="ident" id="6429890">tt</span><span class="op" id="6429892">.</span><span class="ident" id="6429893">server</span><span class="op" id="6429899">,</span>&nbsp;<span class="ident" id="6429901">tt</span><span class="op" id="6429903">.</span><span class="ident" id="6429904">name</span><span class="op" id="6429908">,</span>&nbsp;<span class="ident" id="6429910">tt</span><span class="op" id="6429912">.</span><span class="ident" id="6429913">qtype</span><span class="op" id="6429918">,</span>&nbsp;<span class="ident" id="6429920">timeout</span><span class="op" id="6429927">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6429931">if</span>&nbsp;<span class="ident" id="6429934">err</span>&nbsp;<span class="op" id="6429938">!=</span>&nbsp;<span class="builtintype" id="6429941">nil</span>&nbsp;<span class="op" id="6429945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6429950">t</span><span class="op" id="6429951">.</span><span class="ident" id="6429952">Error</span><span class="op" id="6429957">(</span><span class="ident" id="6429958">err</span><span class="op" id="6429961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6429966">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6429977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6429981">switch</span>&nbsp;<span class="ident" id="6429988">msg</span><span class="op" id="6429991">.</span><span class="ident" id="6429992">rcode</span>&nbsp;<span class="op" id="6429998">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6430002">case</span>&nbsp;<span class="ident" id="6430007">tt</span><span class="op" id="6430009">.</span><span class="ident" id="6430010">rcode</span><span class="op" id="6430015">,</span>&nbsp;<span class="ident" id="6430017">dnsRcodeServerFailure</span><span class="op" id="6430038">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6430042">default</span><span class="op" id="6430049">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6430054">t</span><span class="op" id="6430055">.</span><span class="ident" id="6430056">Errorf</span><span class="op" id="6430062">(</span><span class="string" id="6430063">&#34;got&nbsp;%v&nbsp;from&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6430088">,</span>&nbsp;<span class="ident" id="6430090">msg</span><span class="op" id="6430093">.</span><span class="ident" id="6430094">rcode</span><span class="op" id="6430099">,</span>&nbsp;<span class="ident" id="6430101">tt</span><span class="op" id="6430103">.</span><span class="ident" id="6430104">server</span><span class="op" id="6430110">,</span>&nbsp;<span class="ident" id="6430112">tt</span><span class="op" id="6430114">.</span><span class="ident" id="6430115">rcode</span><span class="op" id="6430120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6430125">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6430136">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6430139">}</span><br>
<span class="lineno"></span><span class="op" id="6430141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6430144">//&nbsp;See&nbsp;RFC&nbsp;6761&nbsp;for&nbsp;further&nbsp;information&nbsp;about&nbsp;the&nbsp;reserved,&nbsp;pseudo</span><br>
<span class="lineno"></span><span class="comment" id="6430211">//&nbsp;domain&nbsp;names.</span><br>
<span class="lineno">55</span><span class="keyword" id="6430228">var</span>&nbsp;<span class="ident" id="6430232">specialDomainNameTests</span>&nbsp;<span class="op" id="6430255">=</span>&nbsp;<span class="op" id="6430257">[</span><span class="op" id="6430258">]</span><span class="keyword" id="6430259">struct</span>&nbsp;<span class="op" id="6430266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6430269">name</span>&nbsp;&nbsp;<span class="builtintype" id="6430275">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6430283">qtype</span>&nbsp;<span class="builtintype" id="6430289">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6430297">rcode</span>&nbsp;<span class="builtintype" id="6430303">int</span><br>
<span class="lineno"></span><span class="op" id="6430307">}</span><span class="op" id="6430308">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6430311">//&nbsp;Name&nbsp;resoltion&nbsp;APIs&nbsp;and&nbsp;libraries&nbsp;should&nbsp;not&nbsp;recongnize&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6430375">//&nbsp;followings&nbsp;as&nbsp;special.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6430402">{</span><span class="string" id="6430403">&#34;1.0.168.192.in-addr.arpa.&#34;</span><span class="op" id="6430430">,</span>&nbsp;<span class="ident" id="6430432">dnsTypePTR</span><span class="op" id="6430442">,</span>&nbsp;<span class="ident" id="6430444">dnsRcodeNameError</span><span class="op" id="6430461">}</span><span class="op" id="6430462">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6430465">{</span><span class="string" id="6430466">&#34;test.&#34;</span><span class="op" id="6430473">,</span>&nbsp;<span class="ident" id="6430475">dnsTypeALL</span><span class="op" id="6430485">,</span>&nbsp;<span class="ident" id="6430487">dnsRcodeNameError</span><span class="op" id="6430504">}</span><span class="op" id="6430505">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6430508">{</span><span class="string" id="6430509">&#34;example.com.&#34;</span><span class="op" id="6430523">,</span>&nbsp;<span class="ident" id="6430525">dnsTypeALL</span><span class="op" id="6430535">,</span>&nbsp;<span class="ident" id="6430537">dnsRcodeSuccess</span><span class="op" id="6430552">}</span><span class="op" id="6430553">,</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6430557">//&nbsp;Name&nbsp;resoltion&nbsp;APIs&nbsp;and&nbsp;libraries&nbsp;should&nbsp;recongnize&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6430617">//&nbsp;followings&nbsp;as&nbsp;special&nbsp;and&nbsp;should&nbsp;not&nbsp;send&nbsp;any&nbsp;queries.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6430676">//&nbsp;Though,&nbsp;we&nbsp;test&nbsp;those&nbsp;names&nbsp;here&nbsp;for&nbsp;verifying&nbsp;nagative</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6430736">//&nbsp;answers&nbsp;at&nbsp;DNS&nbsp;query-response&nbsp;interaction&nbsp;level.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6430789">{</span><span class="string" id="6430790">&#34;localhost.&#34;</span><span class="op" id="6430802">,</span>&nbsp;<span class="ident" id="6430804">dnsTypeALL</span><span class="op" id="6430814">,</span>&nbsp;<span class="ident" id="6430816">dnsRcodeNameError</span><span class="op" id="6430833">}</span><span class="op" id="6430834">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6430837">{</span><span class="string" id="6430838">&#34;invalid.&#34;</span><span class="op" id="6430848">,</span>&nbsp;<span class="ident" id="6430850">dnsTypeALL</span><span class="op" id="6430860">,</span>&nbsp;<span class="ident" id="6430862">dnsRcodeNameError</span><span class="op" id="6430879">}</span><span class="op" id="6430880">,</span><br>
<span class="lineno"></span><span class="op" id="6430882">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6430885">func</span>&nbsp;<span class="ident" id="6430890">TestSpecialDomainName</span><span class="op" id="6430911">(</span><span class="ident" id="6430912">t</span>&nbsp;<span class="op" id="6430914">*</span><span class="ident" id="6430915">testing</span><span class="op" id="6430922">.</span><span class="ident" id="6430923">T</span><span class="op" id="6430924">)</span>&nbsp;<span class="op" id="6430926">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6430929">if</span>&nbsp;<span class="ident" id="6430932">testing</span><span class="op" id="6430939">.</span><span class="ident" id="6430940">Short</span><span class="op" id="6430945">(</span><span class="op" id="6430946">)</span>&nbsp;<span class="op" id="6430948">||</span>&nbsp;<span class="op" id="6430951">!</span><span class="op" id="6430952">*</span><span class="ident" id="6430953">testExternal</span>&nbsp;<span class="op" id="6430966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6430970">t</span><span class="op" id="6430971">.</span><span class="ident" id="6430972">Skip</span><span class="op" id="6430976">(</span><span class="string" id="6430977">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="6431018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6431021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6431025">server</span>&nbsp;<span class="op" id="6431032">:=</span>&nbsp;<span class="string" id="6431035">&#34;8.8.8.8:53&#34;</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6431049">for</span>&nbsp;<span class="ident" id="6431053">_</span><span class="op" id="6431054">,</span>&nbsp;<span class="ident" id="6431056">tt</span>&nbsp;<span class="op" id="6431059">:=</span>&nbsp;<span class="keyword" id="6431062">range</span>&nbsp;<span class="ident" id="6431068">specialDomainNameTests</span>&nbsp;<span class="op" id="6431091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6431095">msg</span><span class="op" id="6431098">,</span>&nbsp;<span class="ident" id="6431100">err</span>&nbsp;<span class="op" id="6431104">:=</span>&nbsp;<span class="ident" id="6431107">exchange</span><span class="op" id="6431115">(</span><span class="ident" id="6431116">server</span><span class="op" id="6431122">,</span>&nbsp;<span class="ident" id="6431124">tt</span><span class="op" id="6431126">.</span><span class="ident" id="6431127">name</span><span class="op" id="6431131">,</span>&nbsp;<span class="ident" id="6431133">tt</span><span class="op" id="6431135">.</span><span class="ident" id="6431136">qtype</span><span class="op" id="6431141">,</span>&nbsp;<span class="num" id="6431143">0</span><span class="op" id="6431144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6431148">if</span>&nbsp;<span class="ident" id="6431151">err</span>&nbsp;<span class="op" id="6431155">!=</span>&nbsp;<span class="builtintype" id="6431158">nil</span>&nbsp;<span class="op" id="6431162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6431167">t</span><span class="op" id="6431168">.</span><span class="ident" id="6431169">Error</span><span class="op" id="6431174">(</span><span class="ident" id="6431175">err</span><span class="op" id="6431178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6431183">continue</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6431194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6431198">switch</span>&nbsp;<span class="ident" id="6431205">msg</span><span class="op" id="6431208">.</span><span class="ident" id="6431209">rcode</span>&nbsp;<span class="op" id="6431215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6431219">case</span>&nbsp;<span class="ident" id="6431224">tt</span><span class="op" id="6431226">.</span><span class="ident" id="6431227">rcode</span><span class="op" id="6431232">,</span>&nbsp;<span class="ident" id="6431234">dnsRcodeServerFailure</span><span class="op" id="6431255">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6431259">default</span><span class="op" id="6431266">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6431271">t</span><span class="op" id="6431272">.</span><span class="ident" id="6431273">Errorf</span><span class="op" id="6431279">(</span><span class="string" id="6431280">&#34;got&nbsp;%v&nbsp;from&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6431305">,</span>&nbsp;<span class="ident" id="6431307">msg</span><span class="op" id="6431310">.</span><span class="ident" id="6431311">rcode</span><span class="op" id="6431316">,</span>&nbsp;<span class="ident" id="6431318">server</span><span class="op" id="6431324">,</span>&nbsp;<span class="ident" id="6431326">tt</span><span class="op" id="6431328">.</span><span class="ident" id="6431329">rcode</span><span class="op" id="6431334">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6431339">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6431350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6431353">}</span><br>
<span class="lineno"></span><span class="op" id="6431355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="6431358">type</span>&nbsp;<span class="ident" id="6431363">resolvConfTest</span>&nbsp;<span class="keyword" id="6431378">struct</span>&nbsp;<span class="op" id="6431385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6431388">*</span><span class="ident" id="6431389">testing</span><span class="op" id="6431396">.</span><span class="ident" id="6431397">T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6431400">dir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6431408">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6431416">path</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6431424">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6431432">started</span>&nbsp;<span class="builtintype" id="6431440">bool</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6431446">quitc</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="6431454">chan</span>&nbsp;<span class="keyword" id="6431459">chan</span>&nbsp;<span class="keyword" id="6431464">struct</span><span class="op" id="6431470">{</span><span class="op" id="6431471">}</span><br>
<span class="lineno"></span><span class="op" id="6431473">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6431476">func</span>&nbsp;<span class="ident" id="6431481">newResolvConfTest</span><span class="op" id="6431498">(</span><span class="ident" id="6431499">t</span>&nbsp;<span class="op" id="6431501">*</span><span class="ident" id="6431502">testing</span><span class="op" id="6431509">.</span><span class="ident" id="6431510">T</span><span class="op" id="6431511">)</span>&nbsp;<span class="op" id="6431513">*</span><span class="ident" id="6431514">resolvConfTest</span>&nbsp;<span class="op" id="6431529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6431532">dir</span><span class="op" id="6431535">,</span>&nbsp;<span class="ident" id="6431537">err</span>&nbsp;<span class="op" id="6431541">:=</span>&nbsp;<span class="ident" id="6431544">ioutil</span><span class="op" id="6431550">.</span><span class="ident" id="6431551">TempDir</span><span class="op" id="6431558">(</span><span class="string" id="6431559">&#34;&#34;</span><span class="op" id="6431561">,</span>&nbsp;<span class="string" id="6431563">&#34;resolvConfTest&#34;</span><span class="op" id="6431579">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6431582">if</span>&nbsp;<span class="ident" id="6431585">err</span>&nbsp;<span class="op" id="6431589">!=</span>&nbsp;<span class="builtintype" id="6431592">nil</span>&nbsp;<span class="op" id="6431596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6431600">t</span><span class="op" id="6431601">.</span><span class="ident" id="6431602">Fatalf</span><span class="op" id="6431608">(</span><span class="string" id="6431609">&#34;could&nbsp;not&nbsp;create&nbsp;temp&nbsp;dir:&nbsp;%v&#34;</span><span class="op" id="6431640">,</span>&nbsp;<span class="ident" id="6431642">err</span><span class="op" id="6431645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6431648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6431652">//&nbsp;Disable&nbsp;the&nbsp;default&nbsp;loadConfig</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6431687">onceLoadConfig</span><span class="op" id="6431701">.</span><span class="ident" id="6431702">Do</span><span class="op" id="6431704">(</span><span class="keyword" id="6431705">func</span><span class="op" id="6431709">(</span><span class="op" id="6431710">)</span>&nbsp;<span class="op" id="6431712">{</span><span class="op" id="6431713">}</span><span class="op" id="6431714">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6431718">r</span>&nbsp;<span class="op" id="6431720">:=</span>&nbsp;<span class="op" id="6431723">&amp;</span><span class="ident" id="6431724">resolvConfTest</span><span class="op" id="6431738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6431742">T</span><span class="op" id="6431743">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6431749">t</span><span class="op" id="6431750">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6431754">dir</span><span class="op" id="6431757">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6431761">dir</span><span class="op" id="6431764">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6431768">path</span><span class="op" id="6431772">:</span>&nbsp;&nbsp;<span class="ident" id="6431775">path</span><span class="op" id="6431779">.</span><span class="ident" id="6431780">Join</span><span class="op" id="6431784">(</span><span class="ident" id="6431785">dir</span><span class="op" id="6431788">,</span>&nbsp;<span class="string" id="6431790">&#34;resolv.conf&#34;</span><span class="op" id="6431803">)</span><span class="op" id="6431804">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6431808">quitc</span><span class="op" id="6431813">:</span>&nbsp;<span class="builtinfunc" id="6431815">make</span><span class="op" id="6431819">(</span><span class="keyword" id="6431820">chan</span>&nbsp;<span class="keyword" id="6431825">chan</span>&nbsp;<span class="keyword" id="6431830">struct</span><span class="op" id="6431836">{</span><span class="op" id="6431837">}</span><span class="op" id="6431838">)</span><span class="op" id="6431839">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6431842">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6431846">return</span>&nbsp;<span class="ident" id="6431853">r</span><br>
<span class="lineno">120</span><span class="op" id="6431855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6431858">func</span>&nbsp;<span class="op" id="6431863">(</span><span class="ident" id="6431864">r</span>&nbsp;<span class="op" id="6431866">*</span><span class="ident" id="6431867">resolvConfTest</span><span class="op" id="6431881">)</span>&nbsp;<span class="ident" id="6431883">Start</span><span class="op" id="6431888">(</span><span class="op" id="6431889">)</span>&nbsp;<span class="op" id="6431891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6431894">loadConfig</span><span class="op" id="6431904">(</span><span class="ident" id="6431905">r</span><span class="op" id="6431906">.</span><span class="ident" id="6431907">path</span><span class="op" id="6431911">,</span>&nbsp;<span class="num" id="6431913">100</span><span class="op" id="6431916">*</span><span class="ident" id="6431917">time</span><span class="op" id="6431921">.</span><span class="ident" id="6431922">Millisecond</span><span class="op" id="6431933">,</span>&nbsp;<span class="ident" id="6431935">r</span><span class="op" id="6431936">.</span><span class="ident" id="6431937">quitc</span><span class="op" id="6431942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6431945">r</span><span class="op" id="6431946">.</span><span class="ident" id="6431947">started</span>&nbsp;<span class="op" id="6431955">=</span>&nbsp;<span class="builtintype" id="6431957">true</span><br>
<span class="lineno">125</span><span class="op" id="6431962">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6431965">func</span>&nbsp;<span class="op" id="6431970">(</span><span class="ident" id="6431971">r</span>&nbsp;<span class="op" id="6431973">*</span><span class="ident" id="6431974">resolvConfTest</span><span class="op" id="6431988">)</span>&nbsp;<span class="ident" id="6431990">SetConf</span><span class="op" id="6431997">(</span><span class="ident" id="6431998">s</span>&nbsp;<span class="builtintype" id="6432000">string</span><span class="op" id="6432006">)</span>&nbsp;<span class="op" id="6432008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6432011">//&nbsp;Make&nbsp;sure&nbsp;the&nbsp;file&nbsp;mtime&nbsp;will&nbsp;be&nbsp;different&nbsp;once&nbsp;we&#39;re&nbsp;done&nbsp;here,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6432080">//&nbsp;even&nbsp;on&nbsp;systems&nbsp;with&nbsp;coarse&nbsp;(1s)&nbsp;mtime&nbsp;resolution.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6432135">time</span><span class="op" id="6432139">.</span><span class="ident" id="6432140">Sleep</span><span class="op" id="6432145">(</span><span class="ident" id="6432146">time</span><span class="op" id="6432150">.</span><span class="ident" id="6432151">Second</span><span class="op" id="6432157">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6432161">f</span><span class="op" id="6432162">,</span>&nbsp;<span class="ident" id="6432164">err</span>&nbsp;<span class="op" id="6432168">:=</span>&nbsp;<span class="ident" id="6432171">os</span><span class="op" id="6432173">.</span><span class="ident" id="6432174">OpenFile</span><span class="op" id="6432182">(</span><span class="ident" id="6432183">r</span><span class="op" id="6432184">.</span><span class="ident" id="6432185">path</span><span class="op" id="6432189">,</span>&nbsp;<span class="ident" id="6432191">os</span><span class="op" id="6432193">.</span><span class="ident" id="6432194">O_CREATE</span><span class="op" id="6432202">|</span><span class="ident" id="6432203">os</span><span class="op" id="6432205">.</span><span class="ident" id="6432206">O_TRUNC</span><span class="op" id="6432213">|</span><span class="ident" id="6432214">os</span><span class="op" id="6432216">.</span><span class="ident" id="6432217">O_WRONLY</span><span class="op" id="6432225">,</span>&nbsp;<span class="num" id="6432227">0600</span><span class="op" id="6432231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6432234">if</span>&nbsp;<span class="ident" id="6432237">err</span>&nbsp;<span class="op" id="6432241">!=</span>&nbsp;<span class="builtintype" id="6432244">nil</span>&nbsp;<span class="op" id="6432248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6432252">r</span><span class="op" id="6432253">.</span><span class="ident" id="6432254">Fatalf</span><span class="op" id="6432260">(</span><span class="string" id="6432261">&#34;failed&nbsp;to&nbsp;create&nbsp;temp&nbsp;file&nbsp;%s:&nbsp;%v&#34;</span><span class="op" id="6432296">,</span>&nbsp;<span class="ident" id="6432298">r</span><span class="op" id="6432299">.</span><span class="ident" id="6432300">path</span><span class="op" id="6432304">,</span>&nbsp;<span class="ident" id="6432306">err</span><span class="op" id="6432309">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6432312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6432315">if</span>&nbsp;<span class="ident" id="6432318">_</span><span class="op" id="6432319">,</span>&nbsp;<span class="ident" id="6432321">err</span>&nbsp;<span class="op" id="6432325">:=</span>&nbsp;<span class="ident" id="6432328">io</span><span class="op" id="6432330">.</span><span class="ident" id="6432331">WriteString</span><span class="op" id="6432342">(</span><span class="ident" id="6432343">f</span><span class="op" id="6432344">,</span>&nbsp;<span class="ident" id="6432346">s</span><span class="op" id="6432347">)</span><span class="op" id="6432348">;</span>&nbsp;<span class="ident" id="6432350">err</span>&nbsp;<span class="op" id="6432354">!=</span>&nbsp;<span class="builtintype" id="6432357">nil</span>&nbsp;<span class="op" id="6432361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6432365">f</span><span class="op" id="6432366">.</span><span class="ident" id="6432367">Close</span><span class="op" id="6432372">(</span><span class="op" id="6432373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6432377">r</span><span class="op" id="6432378">.</span><span class="ident" id="6432379">Fatalf</span><span class="op" id="6432385">(</span><span class="string" id="6432386">&#34;failed&nbsp;to&nbsp;write&nbsp;temp&nbsp;file:&nbsp;%v&#34;</span><span class="op" id="6432417">,</span>&nbsp;<span class="ident" id="6432419">err</span><span class="op" id="6432422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6432425">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6432428">f</span><span class="op" id="6432429">.</span><span class="ident" id="6432430">Close</span><span class="op" id="6432435">(</span><span class="op" id="6432436">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6432440">if</span>&nbsp;<span class="ident" id="6432443">r</span><span class="op" id="6432444">.</span><span class="ident" id="6432445">started</span>&nbsp;<span class="op" id="6432453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6432457">cfg</span><span class="op" id="6432460">.</span><span class="ident" id="6432461">ch</span>&nbsp;<span class="op" id="6432464">&lt;-</span>&nbsp;<span class="keyword" id="6432467">struct</span><span class="op" id="6432473">{</span><span class="op" id="6432474">}</span><span class="op" id="6432475">{</span><span class="op" id="6432476">}</span>&nbsp;<span class="comment" id="6432478">//&nbsp;fill&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6432495">cfg</span><span class="op" id="6432498">.</span><span class="ident" id="6432499">ch</span>&nbsp;<span class="op" id="6432502">&lt;-</span>&nbsp;<span class="keyword" id="6432505">struct</span><span class="op" id="6432511">{</span><span class="op" id="6432512">}</span><span class="op" id="6432513">{</span><span class="op" id="6432514">}</span>&nbsp;<span class="comment" id="6432516">//&nbsp;wait&nbsp;for&nbsp;reload&nbsp;to&nbsp;begin</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6432546">cfg</span><span class="op" id="6432549">.</span><span class="ident" id="6432550">ch</span>&nbsp;<span class="op" id="6432553">&lt;-</span>&nbsp;<span class="keyword" id="6432556">struct</span><span class="op" id="6432562">{</span><span class="op" id="6432563">}</span><span class="op" id="6432564">{</span><span class="op" id="6432565">}</span>&nbsp;<span class="comment" id="6432567">//&nbsp;wait&nbsp;for&nbsp;reload&nbsp;to&nbsp;complete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6432599">}</span><br>
<span class="lineno"></span><span class="op" id="6432601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6432604">func</span>&nbsp;<span class="op" id="6432609">(</span><span class="ident" id="6432610">r</span>&nbsp;<span class="op" id="6432612">*</span><span class="ident" id="6432613">resolvConfTest</span><span class="op" id="6432627">)</span>&nbsp;<span class="ident" id="6432629">WantServers</span><span class="op" id="6432640">(</span><span class="ident" id="6432641">want</span>&nbsp;<span class="op" id="6432646">[</span><span class="op" id="6432647">]</span><span class="builtintype" id="6432648">string</span><span class="op" id="6432654">)</span>&nbsp;<span class="op" id="6432656">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6432659">cfg</span><span class="op" id="6432662">.</span><span class="ident" id="6432663">mu</span><span class="op" id="6432665">.</span><span class="ident" id="6432666">RLock</span><span class="op" id="6432671">(</span><span class="op" id="6432672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6432675">defer</span>&nbsp;<span class="ident" id="6432681">cfg</span><span class="op" id="6432684">.</span><span class="ident" id="6432685">mu</span><span class="op" id="6432687">.</span><span class="ident" id="6432688">RUnlock</span><span class="op" id="6432695">(</span><span class="op" id="6432696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6432699">if</span>&nbsp;<span class="ident" id="6432702">got</span>&nbsp;<span class="op" id="6432706">:=</span>&nbsp;<span class="ident" id="6432709">cfg</span><span class="op" id="6432712">.</span><span class="ident" id="6432713">dnsConfig</span><span class="op" id="6432722">.</span><span class="ident" id="6432723">servers</span><span class="op" id="6432730">;</span>&nbsp;<span class="op" id="6432732">!</span><span class="ident" id="6432733">reflect</span><span class="op" id="6432740">.</span><span class="ident" id="6432741">DeepEqual</span><span class="op" id="6432750">(</span><span class="ident" id="6432751">got</span><span class="op" id="6432754">,</span>&nbsp;<span class="ident" id="6432756">want</span><span class="op" id="6432760">)</span>&nbsp;<span class="op" id="6432762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6432766">r</span><span class="op" id="6432767">.</span><span class="ident" id="6432768">Fatalf</span><span class="op" id="6432774">(</span><span class="string" id="6432775">&#34;Unexpected&nbsp;dns&nbsp;server&nbsp;loaded,&nbsp;got&nbsp;%v&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6432821">,</span>&nbsp;<span class="ident" id="6432823">got</span><span class="op" id="6432826">,</span>&nbsp;<span class="ident" id="6432828">want</span><span class="op" id="6432832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6432835">}</span><br>
<span class="lineno">155</span><span class="op" id="6432837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6432840">func</span>&nbsp;<span class="op" id="6432845">(</span><span class="ident" id="6432846">r</span>&nbsp;<span class="op" id="6432848">*</span><span class="ident" id="6432849">resolvConfTest</span><span class="op" id="6432863">)</span>&nbsp;<span class="ident" id="6432865">Close</span><span class="op" id="6432870">(</span><span class="op" id="6432871">)</span>&nbsp;<span class="op" id="6432873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6432876">resp</span>&nbsp;<span class="op" id="6432881">:=</span>&nbsp;<span class="builtinfunc" id="6432884">make</span><span class="op" id="6432888">(</span><span class="keyword" id="6432889">chan</span>&nbsp;<span class="keyword" id="6432894">struct</span><span class="op" id="6432900">{</span><span class="op" id="6432901">}</span><span class="op" id="6432902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6432905">r</span><span class="op" id="6432906">.</span><span class="ident" id="6432907">quitc</span>&nbsp;<span class="op" id="6432913">&lt;-</span>&nbsp;<span class="ident" id="6432916">resp</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6432922">&lt;-</span><span class="ident" id="6432924">resp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6432930">if</span>&nbsp;<span class="ident" id="6432933">err</span>&nbsp;<span class="op" id="6432937">:=</span>&nbsp;<span class="ident" id="6432940">os</span><span class="op" id="6432942">.</span><span class="ident" id="6432943">RemoveAll</span><span class="op" id="6432952">(</span><span class="ident" id="6432953">r</span><span class="op" id="6432954">.</span><span class="ident" id="6432955">dir</span><span class="op" id="6432958">)</span><span class="op" id="6432959">;</span>&nbsp;<span class="ident" id="6432961">err</span>&nbsp;<span class="op" id="6432965">!=</span>&nbsp;<span class="builtintype" id="6432968">nil</span>&nbsp;<span class="op" id="6432972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6432976">r</span><span class="op" id="6432977">.</span><span class="ident" id="6432978">Logf</span><span class="op" id="6432982">(</span><span class="string" id="6432983">&#34;failed&nbsp;to&nbsp;remove&nbsp;temp&nbsp;dir&nbsp;%s:&nbsp;%v&#34;</span><span class="op" id="6433017">,</span>&nbsp;<span class="ident" id="6433019">r</span><span class="op" id="6433020">.</span><span class="ident" id="6433021">dir</span><span class="op" id="6433024">,</span>&nbsp;<span class="ident" id="6433026">err</span><span class="op" id="6433029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6433032">}</span><br>
<span class="lineno"></span><span class="op" id="6433034">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="6433037">func</span>&nbsp;<span class="ident" id="6433042">TestReloadResolvConfFail</span><span class="op" id="6433066">(</span><span class="ident" id="6433067">t</span>&nbsp;<span class="op" id="6433069">*</span><span class="ident" id="6433070">testing</span><span class="op" id="6433077">.</span><span class="ident" id="6433078">T</span><span class="op" id="6433079">)</span>&nbsp;<span class="op" id="6433081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6433084">if</span>&nbsp;<span class="ident" id="6433087">testing</span><span class="op" id="6433094">.</span><span class="ident" id="6433095">Short</span><span class="op" id="6433100">(</span><span class="op" id="6433101">)</span>&nbsp;<span class="op" id="6433103">||</span>&nbsp;<span class="op" id="6433106">!</span><span class="op" id="6433107">*</span><span class="ident" id="6433108">testExternal</span>&nbsp;<span class="op" id="6433121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6433125">t</span><span class="op" id="6433126">.</span><span class="ident" id="6433127">Skip</span><span class="op" id="6433131">(</span><span class="string" id="6433132">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="6433173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6433176">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6433180">r</span>&nbsp;<span class="op" id="6433182">:=</span>&nbsp;<span class="ident" id="6433185">newResolvConfTest</span><span class="op" id="6433202">(</span><span class="ident" id="6433203">t</span><span class="op" id="6433204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6433207">defer</span>&nbsp;<span class="ident" id="6433213">r</span><span class="op" id="6433214">.</span><span class="ident" id="6433215">Close</span><span class="op" id="6433220">(</span><span class="op" id="6433221">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6433225">//&nbsp;resolv.conf.tmp&nbsp;does&nbsp;not&nbsp;exist&nbsp;yet</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6433264">r</span><span class="op" id="6433265">.</span><span class="ident" id="6433266">Start</span><span class="op" id="6433271">(</span><span class="op" id="6433272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6433275">if</span>&nbsp;<span class="ident" id="6433278">_</span><span class="op" id="6433279">,</span>&nbsp;<span class="ident" id="6433281">err</span>&nbsp;<span class="op" id="6433285">:=</span>&nbsp;<span class="ident" id="6433288">goLookupIP</span><span class="op" id="6433298">(</span><span class="string" id="6433299">&#34;golang.org&#34;</span><span class="op" id="6433311">)</span><span class="op" id="6433312">;</span>&nbsp;<span class="ident" id="6433314">err</span>&nbsp;<span class="op" id="6433318">==</span>&nbsp;<span class="builtintype" id="6433321">nil</span>&nbsp;<span class="op" id="6433325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6433329">t</span><span class="op" id="6433330">.</span><span class="ident" id="6433331">Fatal</span><span class="op" id="6433336">(</span><span class="string" id="6433337">&#34;goLookupIP(missing)&nbsp;succeeded&#34;</span><span class="op" id="6433368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6433371">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6433375">r</span><span class="op" id="6433376">.</span><span class="ident" id="6433377">SetConf</span><span class="op" id="6433384">(</span><span class="string" id="6433385">&#34;nameserver&nbsp;8.8.8.8&#34;</span><span class="op" id="6433405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6433408">if</span>&nbsp;<span class="ident" id="6433411">_</span><span class="op" id="6433412">,</span>&nbsp;<span class="ident" id="6433414">err</span>&nbsp;<span class="op" id="6433418">:=</span>&nbsp;<span class="ident" id="6433421">goLookupIP</span><span class="op" id="6433431">(</span><span class="string" id="6433432">&#34;golang.org&#34;</span><span class="op" id="6433444">)</span><span class="op" id="6433445">;</span>&nbsp;<span class="ident" id="6433447">err</span>&nbsp;<span class="op" id="6433451">!=</span>&nbsp;<span class="builtintype" id="6433454">nil</span>&nbsp;<span class="op" id="6433458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6433462">t</span><span class="op" id="6433463">.</span><span class="ident" id="6433464">Fatalf</span><span class="op" id="6433470">(</span><span class="string" id="6433471">&#34;goLookupIP(missing;&nbsp;good)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6433509">,</span>&nbsp;<span class="ident" id="6433511">err</span><span class="op" id="6433514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6433517">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6433521">//&nbsp;Using&nbsp;a&nbsp;bad&nbsp;resolv.conf&nbsp;while&nbsp;we&nbsp;had&nbsp;a&nbsp;good</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6433569">//&nbsp;one&nbsp;before&nbsp;should&nbsp;not&nbsp;update&nbsp;the&nbsp;config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6433613">r</span><span class="op" id="6433614">.</span><span class="ident" id="6433615">SetConf</span><span class="op" id="6433622">(</span><span class="string" id="6433623">&#34;&#34;</span><span class="op" id="6433625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6433628">if</span>&nbsp;<span class="ident" id="6433631">_</span><span class="op" id="6433632">,</span>&nbsp;<span class="ident" id="6433634">err</span>&nbsp;<span class="op" id="6433638">:=</span>&nbsp;<span class="ident" id="6433641">goLookupIP</span><span class="op" id="6433651">(</span><span class="string" id="6433652">&#34;golang.org&#34;</span><span class="op" id="6433664">)</span><span class="op" id="6433665">;</span>&nbsp;<span class="ident" id="6433667">err</span>&nbsp;<span class="op" id="6433671">!=</span>&nbsp;<span class="builtintype" id="6433674">nil</span>&nbsp;<span class="op" id="6433678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6433682">t</span><span class="op" id="6433683">.</span><span class="ident" id="6433684">Fatalf</span><span class="op" id="6433690">(</span><span class="string" id="6433691">&#34;goLookupIP(missing;&nbsp;good;&nbsp;bad)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6433734">,</span>&nbsp;<span class="ident" id="6433736">err</span><span class="op" id="6433739">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6433742">}</span><br>
<span class="lineno"></span><span class="op" id="6433744">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6433747">func</span>&nbsp;<span class="ident" id="6433752">TestReloadResolvConfChange</span><span class="op" id="6433778">(</span><span class="ident" id="6433779">t</span>&nbsp;<span class="op" id="6433781">*</span><span class="ident" id="6433782">testing</span><span class="op" id="6433789">.</span><span class="ident" id="6433790">T</span><span class="op" id="6433791">)</span>&nbsp;<span class="op" id="6433793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6433796">if</span>&nbsp;<span class="ident" id="6433799">testing</span><span class="op" id="6433806">.</span><span class="ident" id="6433807">Short</span><span class="op" id="6433812">(</span><span class="op" id="6433813">)</span>&nbsp;<span class="op" id="6433815">||</span>&nbsp;<span class="op" id="6433818">!</span><span class="op" id="6433819">*</span><span class="ident" id="6433820">testExternal</span>&nbsp;<span class="op" id="6433833">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6433837">t</span><span class="op" id="6433838">.</span><span class="ident" id="6433839">Skip</span><span class="op" id="6433843">(</span><span class="string" id="6433844">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="6433885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6433888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6433892">r</span>&nbsp;<span class="op" id="6433894">:=</span>&nbsp;<span class="ident" id="6433897">newResolvConfTest</span><span class="op" id="6433914">(</span><span class="ident" id="6433915">t</span><span class="op" id="6433916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6433919">defer</span>&nbsp;<span class="ident" id="6433925">r</span><span class="op" id="6433926">.</span><span class="ident" id="6433927">Close</span><span class="op" id="6433932">(</span><span class="op" id="6433933">)</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6433937">r</span><span class="op" id="6433938">.</span><span class="ident" id="6433939">SetConf</span><span class="op" id="6433946">(</span><span class="string" id="6433947">&#34;nameserver&nbsp;8.8.8.8&#34;</span><span class="op" id="6433967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6433970">r</span><span class="op" id="6433971">.</span><span class="ident" id="6433972">Start</span><span class="op" id="6433977">(</span><span class="op" id="6433978">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6433982">if</span>&nbsp;<span class="ident" id="6433985">_</span><span class="op" id="6433986">,</span>&nbsp;<span class="ident" id="6433988">err</span>&nbsp;<span class="op" id="6433992">:=</span>&nbsp;<span class="ident" id="6433995">goLookupIP</span><span class="op" id="6434005">(</span><span class="string" id="6434006">&#34;golang.org&#34;</span><span class="op" id="6434018">)</span><span class="op" id="6434019">;</span>&nbsp;<span class="ident" id="6434021">err</span>&nbsp;<span class="op" id="6434025">!=</span>&nbsp;<span class="builtintype" id="6434028">nil</span>&nbsp;<span class="op" id="6434032">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6434036">t</span><span class="op" id="6434037">.</span><span class="ident" id="6434038">Fatalf</span><span class="op" id="6434044">(</span><span class="string" id="6434045">&#34;goLookupIP(good)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6434074">,</span>&nbsp;<span class="ident" id="6434076">err</span><span class="op" id="6434079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6434082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6434085">r</span><span class="op" id="6434086">.</span><span class="ident" id="6434087">WantServers</span><span class="op" id="6434098">(</span><span class="op" id="6434099">[</span><span class="op" id="6434100">]</span><span class="builtintype" id="6434101">string</span><span class="op" id="6434107">{</span><span class="string" id="6434108">&#34;8.8.8.8&#34;</span><span class="op" id="6434117">}</span><span class="op" id="6434118">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6434122">//&nbsp;Using&nbsp;a&nbsp;bad&nbsp;resolv.conf&nbsp;when&nbsp;we&nbsp;had&nbsp;a&nbsp;good&nbsp;one</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6434173">//&nbsp;before&nbsp;should&nbsp;not&nbsp;update&nbsp;the&nbsp;config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6434213">r</span><span class="op" id="6434214">.</span><span class="ident" id="6434215">SetConf</span><span class="op" id="6434222">(</span><span class="string" id="6434223">&#34;&#34;</span><span class="op" id="6434225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6434228">if</span>&nbsp;<span class="ident" id="6434231">_</span><span class="op" id="6434232">,</span>&nbsp;<span class="ident" id="6434234">err</span>&nbsp;<span class="op" id="6434238">:=</span>&nbsp;<span class="ident" id="6434241">goLookupIP</span><span class="op" id="6434251">(</span><span class="string" id="6434252">&#34;golang.org&#34;</span><span class="op" id="6434264">)</span><span class="op" id="6434265">;</span>&nbsp;<span class="ident" id="6434267">err</span>&nbsp;<span class="op" id="6434271">!=</span>&nbsp;<span class="builtintype" id="6434274">nil</span>&nbsp;<span class="op" id="6434278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6434282">t</span><span class="op" id="6434283">.</span><span class="ident" id="6434284">Fatalf</span><span class="op" id="6434290">(</span><span class="string" id="6434291">&#34;goLookupIP(good;&nbsp;bad)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6434325">,</span>&nbsp;<span class="ident" id="6434327">err</span><span class="op" id="6434330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6434333">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6434337">//&nbsp;A&nbsp;new&nbsp;good&nbsp;config&nbsp;should&nbsp;get&nbsp;picked&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6434380">r</span><span class="op" id="6434381">.</span><span class="ident" id="6434382">SetConf</span><span class="op" id="6434389">(</span><span class="string" id="6434390">&#34;nameserver&nbsp;8.8.4.4&#34;</span><span class="op" id="6434410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6434413">r</span><span class="op" id="6434414">.</span><span class="ident" id="6434415">WantServers</span><span class="op" id="6434426">(</span><span class="op" id="6434427">[</span><span class="op" id="6434428">]</span><span class="builtintype" id="6434429">string</span><span class="op" id="6434435">{</span><span class="string" id="6434436">&#34;8.8.4.4&#34;</span><span class="op" id="6434445">}</span><span class="op" id="6434446">)</span><br>
<span class="lineno"></span><span class="op" id="6434448">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="keyword" id="6434451">func</span>&nbsp;<span class="ident" id="6434456">BenchmarkGoLookupIP</span><span class="op" id="6434475">(</span><span class="ident" id="6434476">b</span>&nbsp;<span class="op" id="6434478">*</span><span class="ident" id="6434479">testing</span><span class="op" id="6434486">.</span><span class="ident" id="6434487">B</span><span class="op" id="6434488">)</span>&nbsp;<span class="op" id="6434490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6434493">for</span>&nbsp;<span class="ident" id="6434497">i</span>&nbsp;<span class="op" id="6434499">:=</span>&nbsp;<span class="num" id="6434502">0</span><span class="op" id="6434503">;</span>&nbsp;<span class="ident" id="6434505">i</span>&nbsp;<span class="op" id="6434507">&lt;</span>&nbsp;<span class="ident" id="6434509">b</span><span class="op" id="6434510">.</span><span class="ident" id="6434511">N</span><span class="op" id="6434512">;</span>&nbsp;<span class="ident" id="6434514">i</span><span class="op" id="6434515">++</span>&nbsp;<span class="op" id="6434518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6434522">goLookupIP</span><span class="op" id="6434532">(</span><span class="string" id="6434533">&#34;www.example.com&#34;</span><span class="op" id="6434550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6434553">}</span><br>
<span class="lineno">225</span><span class="op" id="6434555">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6434558">func</span>&nbsp;<span class="ident" id="6434563">BenchmarkGoLookupIPNoSuchHost</span><span class="op" id="6434592">(</span><span class="ident" id="6434593">b</span>&nbsp;<span class="op" id="6434595">*</span><span class="ident" id="6434596">testing</span><span class="op" id="6434603">.</span><span class="ident" id="6434604">B</span><span class="op" id="6434605">)</span>&nbsp;<span class="op" id="6434607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6434610">for</span>&nbsp;<span class="ident" id="6434614">i</span>&nbsp;<span class="op" id="6434616">:=</span>&nbsp;<span class="num" id="6434619">0</span><span class="op" id="6434620">;</span>&nbsp;<span class="ident" id="6434622">i</span>&nbsp;<span class="op" id="6434624">&lt;</span>&nbsp;<span class="ident" id="6434626">b</span><span class="op" id="6434627">.</span><span class="ident" id="6434628">N</span><span class="op" id="6434629">;</span>&nbsp;<span class="ident" id="6434631">i</span><span class="op" id="6434632">++</span>&nbsp;<span class="op" id="6434635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6434639">goLookupIP</span><span class="op" id="6434649">(</span><span class="string" id="6434650">&#34;some.nonexistent&#34;</span><span class="op" id="6434668">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6434671">}</span><br>
<span class="lineno"></span><span class="op" id="6434673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6434676">func</span>&nbsp;<span class="ident" id="6434681">BenchmarkGoLookupIPWithBrokenNameServer</span><span class="op" id="6434720">(</span><span class="ident" id="6434721">b</span>&nbsp;<span class="op" id="6434723">*</span><span class="ident" id="6434724">testing</span><span class="op" id="6434731">.</span><span class="ident" id="6434732">B</span><span class="op" id="6434733">)</span>&nbsp;<span class="op" id="6434735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6434738">onceLoadConfig</span><span class="op" id="6434752">.</span><span class="ident" id="6434753">Do</span><span class="op" id="6434755">(</span><span class="ident" id="6434756">loadDefaultConfig</span><span class="op" id="6434773">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6434776">if</span>&nbsp;<span class="ident" id="6434779">cfg</span><span class="op" id="6434782">.</span><span class="ident" id="6434783">dnserr</span>&nbsp;<span class="op" id="6434790">!=</span>&nbsp;<span class="builtintype" id="6434793">nil</span>&nbsp;<span class="op" id="6434797">||</span>&nbsp;<span class="ident" id="6434800">cfg</span><span class="op" id="6434803">.</span><span class="ident" id="6434804">dnsConfig</span>&nbsp;<span class="op" id="6434814">==</span>&nbsp;<span class="builtintype" id="6434817">nil</span>&nbsp;<span class="op" id="6434821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6434825">b</span><span class="op" id="6434826">.</span><span class="ident" id="6434827">Fatalf</span><span class="op" id="6434833">(</span><span class="string" id="6434834">&#34;loadConfig&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6434857">,</span>&nbsp;<span class="ident" id="6434859">cfg</span><span class="op" id="6434862">.</span><span class="ident" id="6434863">dnserr</span><span class="op" id="6434869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6434872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6434875">//&nbsp;This&nbsp;looks&nbsp;ugly&nbsp;but&nbsp;it&#39;s&nbsp;safe&nbsp;as&nbsp;long&nbsp;as&nbsp;benchmarks&nbsp;are&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6434939">//&nbsp;sequentially&nbsp;in&nbsp;package&nbsp;testing.</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6434976">orig</span>&nbsp;<span class="op" id="6434981">:=</span>&nbsp;<span class="ident" id="6434984">cfg</span><span class="op" id="6434987">.</span><span class="ident" id="6434988">dnsConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6434999">cfg</span><span class="op" id="6435002">.</span><span class="ident" id="6435003">dnsConfig</span><span class="op" id="6435012">.</span><span class="ident" id="6435013">servers</span>&nbsp;<span class="op" id="6435021">=</span>&nbsp;<span class="builtinfunc" id="6435023">append</span><span class="op" id="6435029">(</span><span class="op" id="6435030">[</span><span class="op" id="6435031">]</span><span class="builtintype" id="6435032">string</span><span class="op" id="6435038">{</span><span class="string" id="6435039">&#34;203.0.113.254&#34;</span><span class="op" id="6435054">}</span><span class="op" id="6435055">,</span>&nbsp;<span class="ident" id="6435057">cfg</span><span class="op" id="6435060">.</span><span class="ident" id="6435061">dnsConfig</span><span class="op" id="6435070">.</span><span class="ident" id="6435071">servers</span><span class="op" id="6435078">...</span><span class="op" id="6435081">)</span>&nbsp;<span class="comment" id="6435083">//&nbsp;use&nbsp;TEST-NET-3&nbsp;block,&nbsp;see&nbsp;RFC&nbsp;5737</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6435122">for</span>&nbsp;<span class="ident" id="6435126">i</span>&nbsp;<span class="op" id="6435128">:=</span>&nbsp;<span class="num" id="6435131">0</span><span class="op" id="6435132">;</span>&nbsp;<span class="ident" id="6435134">i</span>&nbsp;<span class="op" id="6435136">&lt;</span>&nbsp;<span class="ident" id="6435138">b</span><span class="op" id="6435139">.</span><span class="ident" id="6435140">N</span><span class="op" id="6435141">;</span>&nbsp;<span class="ident" id="6435143">i</span><span class="op" id="6435144">++</span>&nbsp;<span class="op" id="6435147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6435151">goLookupIP</span><span class="op" id="6435161">(</span><span class="string" id="6435162">&#34;www.example.com&#34;</span><span class="op" id="6435179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6435182">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6435185">cfg</span><span class="op" id="6435188">.</span><span class="ident" id="6435189">dnsConfig</span>&nbsp;<span class="op" id="6435199">=</span>&nbsp;<span class="ident" id="6435201">orig</span><br>
<span class="lineno"></span><span class="op" id="6435206">}</span>
</div>
</body>
</html>
