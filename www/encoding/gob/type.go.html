<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3235777">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3235832">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3235886">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3235937">package</span>&nbsp;<span class="ident" id="3235945">gob</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3235950">import</span>&nbsp;<span class="op" id="3235957">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3235960">&#34;encoding&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3235972">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3235982">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3235989">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3235995">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3236006">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3236014">&#34;sync/atomic&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3236029">&#34;unicode&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3236040">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="3236055">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3236058">//&nbsp;userTypeInfo&nbsp;stores&nbsp;the&nbsp;information&nbsp;associated&nbsp;with&nbsp;a&nbsp;type&nbsp;the&nbsp;user&nbsp;has&nbsp;handed</span><br>
<span class="lineno">20</span><span class="comment" id="3236140">//&nbsp;to&nbsp;the&nbsp;package.&nbsp;&nbsp;It&#39;s&nbsp;computed&nbsp;once&nbsp;and&nbsp;stored&nbsp;in&nbsp;a&nbsp;map&nbsp;keyed&nbsp;by&nbsp;reflection</span><br>
<span class="lineno"></span><span class="comment" id="3236219">//&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="3236228">type</span>&nbsp;<span class="ident" id="3236233">userTypeInfo</span>&nbsp;<span class="keyword" id="3236246">struct</span>&nbsp;<span class="op" id="3236253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3236256">user</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3236268">reflect</span><span class="op" id="3236275">.</span><span class="ident" id="3236276">Type</span>&nbsp;<span class="comment" id="3236281">//&nbsp;the&nbsp;type&nbsp;the&nbsp;user&nbsp;handed&nbsp;us</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3236313">base</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3236325">reflect</span><span class="op" id="3236332">.</span><span class="ident" id="3236333">Type</span>&nbsp;<span class="comment" id="3236338">//&nbsp;the&nbsp;base&nbsp;type&nbsp;after&nbsp;all&nbsp;indirections</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3236379">indir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3236391">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3236404">//&nbsp;number&nbsp;of&nbsp;indirections&nbsp;to&nbsp;reach&nbsp;the&nbsp;base&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3236454">externalEnc</span>&nbsp;<span class="builtintype" id="3236466">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3236479">//&nbsp;xGob,&nbsp;xBinary,&nbsp;or&nbsp;xText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3236507">externalDec</span>&nbsp;<span class="builtintype" id="3236519">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3236532">//&nbsp;xGob,&nbsp;xBinary&nbsp;or&nbsp;xText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3236559">encIndir</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3236571">int8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3236584">//&nbsp;number&nbsp;of&nbsp;indirections&nbsp;to&nbsp;reach&nbsp;the&nbsp;receiver&nbsp;type;&nbsp;may&nbsp;be&nbsp;negative</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3236655">decIndir</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3236667">int8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3236680">//&nbsp;number&nbsp;of&nbsp;indirections&nbsp;to&nbsp;reach&nbsp;the&nbsp;receiver&nbsp;type;&nbsp;may&nbsp;be&nbsp;negative</span><br>
<span class="lineno">30</span><span class="op" id="3236750">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3236753">//&nbsp;externalEncoding&nbsp;bits</span><br>
<span class="lineno"></span><span class="keyword" id="3236778">const</span>&nbsp;<span class="op" id="3236784">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3236787">xGob</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3236795">=</span>&nbsp;<span class="num" id="3236797">1</span>&nbsp;<span class="op" id="3236799">+</span>&nbsp;<span class="ident" id="3236801">iota</span>&nbsp;<span class="comment" id="3236806">//&nbsp;GobEncoder&nbsp;or&nbsp;GobDecoder</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3236835">xBinary</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3236854">//&nbsp;encoding.BinaryMarshaler&nbsp;or&nbsp;encoding.BinaryUnmarshaler</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3236913">xText</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3236932">//&nbsp;encoding.TextMarshaler&nbsp;or&nbsp;encoding.TextUnmarshaler</span><br>
<span class="lineno"></span><span class="op" id="3236986">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3236989">var</span>&nbsp;<span class="op" id="3236993">(</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3236996">//&nbsp;Protected&nbsp;by&nbsp;an&nbsp;RWMutex&nbsp;because&nbsp;we&nbsp;read&nbsp;it&nbsp;a&nbsp;lot&nbsp;and&nbsp;write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3237059">//&nbsp;it&nbsp;only&nbsp;when&nbsp;we&nbsp;see&nbsp;a&nbsp;new&nbsp;type,&nbsp;typically&nbsp;when&nbsp;compiling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3237121">userTypeLock</span>&nbsp;&nbsp;<span class="ident" id="3237135">sync</span><span class="op" id="3237139">.</span><span class="ident" id="3237140">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3237149">userTypeCache</span>&nbsp;<span class="op" id="3237163">=</span>&nbsp;<span class="builtinfunc" id="3237165">make</span><span class="op" id="3237169">(</span><span class="keyword" id="3237170">map</span><span class="op" id="3237173">[</span><span class="ident" id="3237174">reflect</span><span class="op" id="3237181">.</span><span class="ident" id="3237182">Type</span><span class="op" id="3237186">]</span><span class="op" id="3237187">*</span><span class="ident" id="3237188">userTypeInfo</span><span class="op" id="3237200">)</span><br>
<span class="lineno"></span><span class="op" id="3237202">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="3237205">//&nbsp;validType&nbsp;returns,&nbsp;and&nbsp;saves,&nbsp;the&nbsp;information&nbsp;associated&nbsp;with&nbsp;user-provided&nbsp;type&nbsp;rt.</span><br>
<span class="lineno"></span><span class="comment" id="3237293">//&nbsp;If&nbsp;the&nbsp;user&nbsp;type&nbsp;is&nbsp;not&nbsp;valid,&nbsp;err&nbsp;will&nbsp;be&nbsp;non-nil.&nbsp;&nbsp;To&nbsp;be&nbsp;used&nbsp;when&nbsp;the&nbsp;error&nbsp;handler</span><br>
<span class="lineno"></span><span class="comment" id="3237383">//&nbsp;is&nbsp;not&nbsp;set&nbsp;up.</span><br>
<span class="lineno"></span><span class="keyword" id="3237401">func</span>&nbsp;<span class="ident" id="3237406">validUserType</span><span class="op" id="3237419">(</span><span class="ident" id="3237420">rt</span>&nbsp;<span class="ident" id="3237423">reflect</span><span class="op" id="3237430">.</span><span class="ident" id="3237431">Type</span><span class="op" id="3237435">)</span>&nbsp;<span class="op" id="3237437">(</span><span class="ident" id="3237438">ut</span>&nbsp;<span class="op" id="3237441">*</span><span class="ident" id="3237442">userTypeInfo</span><span class="op" id="3237454">,</span>&nbsp;<span class="ident" id="3237456">err</span>&nbsp;<span class="builtintype" id="3237460">error</span><span class="op" id="3237465">)</span>&nbsp;<span class="op" id="3237467">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3237470">userTypeLock</span><span class="op" id="3237482">.</span><span class="ident" id="3237483">RLock</span><span class="op" id="3237488">(</span><span class="op" id="3237489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3237492">ut</span>&nbsp;<span class="op" id="3237495">=</span>&nbsp;<span class="ident" id="3237497">userTypeCache</span><span class="op" id="3237510">[</span><span class="ident" id="3237511">rt</span><span class="op" id="3237513">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3237516">userTypeLock</span><span class="op" id="3237528">.</span><span class="ident" id="3237529">RUnlock</span><span class="op" id="3237536">(</span><span class="op" id="3237537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3237540">if</span>&nbsp;<span class="ident" id="3237543">ut</span>&nbsp;<span class="op" id="3237546">!=</span>&nbsp;<span class="ident" id="3237549">nil</span>&nbsp;<span class="op" id="3237553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3237557">return</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3237565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3237568">//&nbsp;Now&nbsp;set&nbsp;the&nbsp;value&nbsp;under&nbsp;the&nbsp;write&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3237612">userTypeLock</span><span class="op" id="3237624">.</span><span class="ident" id="3237625">Lock</span><span class="op" id="3237629">(</span><span class="op" id="3237630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3237633">defer</span>&nbsp;<span class="ident" id="3237639">userTypeLock</span><span class="op" id="3237651">.</span><span class="ident" id="3237652">Unlock</span><span class="op" id="3237658">(</span><span class="op" id="3237659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3237662">if</span>&nbsp;<span class="ident" id="3237665">ut</span>&nbsp;<span class="op" id="3237668">=</span>&nbsp;<span class="ident" id="3237670">userTypeCache</span><span class="op" id="3237683">[</span><span class="ident" id="3237684">rt</span><span class="op" id="3237686">]</span><span class="op" id="3237687">;</span>&nbsp;<span class="ident" id="3237689">ut</span>&nbsp;<span class="op" id="3237692">!=</span>&nbsp;<span class="ident" id="3237695">nil</span>&nbsp;<span class="op" id="3237699">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3237703">//&nbsp;Lost&nbsp;the&nbsp;race;&nbsp;not&nbsp;a&nbsp;problem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3237738">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3237746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3237749">ut</span>&nbsp;<span class="op" id="3237752">=</span>&nbsp;<span class="builtinfunc" id="3237754">new</span><span class="op" id="3237757">(</span><span class="ident" id="3237758">userTypeInfo</span><span class="op" id="3237770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3237773">ut</span><span class="op" id="3237775">.</span><span class="ident" id="3237776">base</span>&nbsp;<span class="op" id="3237781">=</span>&nbsp;<span class="ident" id="3237783">rt</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3237787">ut</span><span class="op" id="3237789">.</span><span class="ident" id="3237790">user</span>&nbsp;<span class="op" id="3237795">=</span>&nbsp;<span class="ident" id="3237797">rt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3237801">//&nbsp;A&nbsp;type&nbsp;that&nbsp;is&nbsp;just&nbsp;a&nbsp;cycle&nbsp;of&nbsp;pointers&nbsp;(such&nbsp;as&nbsp;type&nbsp;T&nbsp;*T)&nbsp;cannot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3237872">//&nbsp;be&nbsp;represented&nbsp;in&nbsp;gobs,&nbsp;which&nbsp;need&nbsp;some&nbsp;concrete&nbsp;data.&nbsp;&nbsp;We&nbsp;use&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3237941">//&nbsp;cycle&nbsp;detection&nbsp;algorithm&nbsp;from&nbsp;Knuth,&nbsp;Vol&nbsp;2,&nbsp;Section&nbsp;3.1,&nbsp;Ex&nbsp;6,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3238009">//&nbsp;pp&nbsp;539-540.&nbsp;&nbsp;As&nbsp;we&nbsp;step&nbsp;through&nbsp;indirections,&nbsp;run&nbsp;another&nbsp;type&nbsp;at</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3238079">//&nbsp;half&nbsp;speed.&nbsp;If&nbsp;they&nbsp;meet&nbsp;up,&nbsp;there&#39;s&nbsp;a&nbsp;cycle.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3238129">slowpoke</span>&nbsp;<span class="op" id="3238138">:=</span>&nbsp;<span class="ident" id="3238141">ut</span><span class="op" id="3238143">.</span><span class="ident" id="3238144">base</span>&nbsp;<span class="comment" id="3238149">//&nbsp;walks&nbsp;half&nbsp;as&nbsp;fast&nbsp;as&nbsp;ut.base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3238183">for</span>&nbsp;<span class="op" id="3238187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3238191">pt</span>&nbsp;<span class="op" id="3238194">:=</span>&nbsp;<span class="ident" id="3238197">ut</span><span class="op" id="3238199">.</span><span class="ident" id="3238200">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3238207">if</span>&nbsp;<span class="ident" id="3238210">pt</span><span class="op" id="3238212">.</span><span class="ident" id="3238213">Kind</span><span class="op" id="3238217">(</span><span class="op" id="3238218">)</span>&nbsp;<span class="op" id="3238220">!=</span>&nbsp;<span class="ident" id="3238223">reflect</span><span class="op" id="3238230">.</span><span class="ident" id="3238231">Ptr</span>&nbsp;<span class="op" id="3238235">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3238240">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3238248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3238252">ut</span><span class="op" id="3238254">.</span><span class="ident" id="3238255">base</span>&nbsp;<span class="op" id="3238260">=</span>&nbsp;<span class="ident" id="3238262">pt</span><span class="op" id="3238264">.</span><span class="ident" id="3238265">Elem</span><span class="op" id="3238269">(</span><span class="op" id="3238270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3238274">if</span>&nbsp;<span class="ident" id="3238277">ut</span><span class="op" id="3238279">.</span><span class="ident" id="3238280">base</span>&nbsp;<span class="op" id="3238285">==</span>&nbsp;<span class="ident" id="3238288">slowpoke</span>&nbsp;<span class="op" id="3238297">{</span>&nbsp;<span class="comment" id="3238299">//&nbsp;ut.base&nbsp;lapped&nbsp;slowpoke</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3238329">//&nbsp;recursive&nbsp;pointer&nbsp;type.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3238359">return</span>&nbsp;<span class="ident" id="3238366">nil</span><span class="op" id="3238369">,</span>&nbsp;<span class="ident" id="3238371">errors</span><span class="op" id="3238377">.</span><span class="ident" id="3238378">New</span><span class="op" id="3238381">(</span><span class="string" id="3238382">&#34;can&#39;t&nbsp;represent&nbsp;recursive&nbsp;pointer&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="3238424">+</span>&nbsp;<span class="ident" id="3238426">ut</span><span class="op" id="3238428">.</span><span class="ident" id="3238429">base</span><span class="op" id="3238433">.</span><span class="ident" id="3238434">String</span><span class="op" id="3238440">(</span><span class="op" id="3238441">)</span><span class="op" id="3238442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3238446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3238450">if</span>&nbsp;<span class="ident" id="3238453">ut</span><span class="op" id="3238455">.</span><span class="ident" id="3238456">indir</span><span class="op" id="3238461">%</span><span class="num" id="3238462">2</span>&nbsp;<span class="op" id="3238464">==</span>&nbsp;<span class="num" id="3238467">0</span>&nbsp;<span class="op" id="3238469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3238474">slowpoke</span>&nbsp;<span class="op" id="3238483">=</span>&nbsp;<span class="ident" id="3238485">slowpoke</span><span class="op" id="3238493">.</span><span class="ident" id="3238494">Elem</span><span class="op" id="3238498">(</span><span class="op" id="3238499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3238503">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3238507">ut</span><span class="op" id="3238509">.</span><span class="ident" id="3238510">indir</span><span class="op" id="3238515">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3238519">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3238523">if</span>&nbsp;<span class="ident" id="3238526">ok</span><span class="op" id="3238528">,</span>&nbsp;<span class="ident" id="3238530">indir</span>&nbsp;<span class="op" id="3238536">:=</span>&nbsp;<span class="ident" id="3238539">implementsInterface</span><span class="op" id="3238558">(</span><span class="ident" id="3238559">ut</span><span class="op" id="3238561">.</span><span class="ident" id="3238562">user</span><span class="op" id="3238566">,</span>&nbsp;<span class="ident" id="3238568">gobEncoderInterfaceType</span><span class="op" id="3238591">)</span><span class="op" id="3238592">;</span>&nbsp;<span class="ident" id="3238594">ok</span>&nbsp;<span class="op" id="3238597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3238601">ut</span><span class="op" id="3238603">.</span><span class="ident" id="3238604">externalEnc</span><span class="op" id="3238615">,</span>&nbsp;<span class="ident" id="3238617">ut</span><span class="op" id="3238619">.</span><span class="ident" id="3238620">encIndir</span>&nbsp;<span class="op" id="3238629">=</span>&nbsp;<span class="ident" id="3238631">xGob</span><span class="op" id="3238635">,</span>&nbsp;<span class="ident" id="3238637">indir</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3238644">}</span>&nbsp;<span class="keyword" id="3238646">else</span>&nbsp;<span class="keyword" id="3238651">if</span>&nbsp;<span class="ident" id="3238654">ok</span><span class="op" id="3238656">,</span>&nbsp;<span class="ident" id="3238658">indir</span>&nbsp;<span class="op" id="3238664">:=</span>&nbsp;<span class="ident" id="3238667">implementsInterface</span><span class="op" id="3238686">(</span><span class="ident" id="3238687">ut</span><span class="op" id="3238689">.</span><span class="ident" id="3238690">user</span><span class="op" id="3238694">,</span>&nbsp;<span class="ident" id="3238696">binaryMarshalerInterfaceType</span><span class="op" id="3238724">)</span><span class="op" id="3238725">;</span>&nbsp;<span class="ident" id="3238727">ok</span>&nbsp;<span class="op" id="3238730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3238734">ut</span><span class="op" id="3238736">.</span><span class="ident" id="3238737">externalEnc</span><span class="op" id="3238748">,</span>&nbsp;<span class="ident" id="3238750">ut</span><span class="op" id="3238752">.</span><span class="ident" id="3238753">encIndir</span>&nbsp;<span class="op" id="3238762">=</span>&nbsp;<span class="ident" id="3238764">xBinary</span><span class="op" id="3238771">,</span>&nbsp;<span class="ident" id="3238773">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3238780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3238784">//&nbsp;NOTE(rsc):&nbsp;Would&nbsp;like&nbsp;to&nbsp;allow&nbsp;MarshalText&nbsp;here,&nbsp;but&nbsp;results&nbsp;in&nbsp;incompatibility</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3238868">//&nbsp;with&nbsp;older&nbsp;encodings&nbsp;for&nbsp;net.IP.&nbsp;See&nbsp;golang.org/issue/6760.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3238932">//&nbsp;}&nbsp;else&nbsp;if&nbsp;ok,&nbsp;indir&nbsp;:=&nbsp;implementsInterface(ut.user,&nbsp;textMarshalerInterfaceType);&nbsp;ok&nbsp;{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3239022">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsput.externalEnc,&nbsp;ut.encIndir&nbsp;=&nbsp;xText,&nbsp;indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3239070">//&nbsp;}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3239077">if</span>&nbsp;<span class="ident" id="3239080">ok</span><span class="op" id="3239082">,</span>&nbsp;<span class="ident" id="3239084">indir</span>&nbsp;<span class="op" id="3239090">:=</span>&nbsp;<span class="ident" id="3239093">implementsInterface</span><span class="op" id="3239112">(</span><span class="ident" id="3239113">ut</span><span class="op" id="3239115">.</span><span class="ident" id="3239116">user</span><span class="op" id="3239120">,</span>&nbsp;<span class="ident" id="3239122">gobDecoderInterfaceType</span><span class="op" id="3239145">)</span><span class="op" id="3239146">;</span>&nbsp;<span class="ident" id="3239148">ok</span>&nbsp;<span class="op" id="3239151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3239155">ut</span><span class="op" id="3239157">.</span><span class="ident" id="3239158">externalDec</span><span class="op" id="3239169">,</span>&nbsp;<span class="ident" id="3239171">ut</span><span class="op" id="3239173">.</span><span class="ident" id="3239174">decIndir</span>&nbsp;<span class="op" id="3239183">=</span>&nbsp;<span class="ident" id="3239185">xGob</span><span class="op" id="3239189">,</span>&nbsp;<span class="ident" id="3239191">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3239198">}</span>&nbsp;<span class="keyword" id="3239200">else</span>&nbsp;<span class="keyword" id="3239205">if</span>&nbsp;<span class="ident" id="3239208">ok</span><span class="op" id="3239210">,</span>&nbsp;<span class="ident" id="3239212">indir</span>&nbsp;<span class="op" id="3239218">:=</span>&nbsp;<span class="ident" id="3239221">implementsInterface</span><span class="op" id="3239240">(</span><span class="ident" id="3239241">ut</span><span class="op" id="3239243">.</span><span class="ident" id="3239244">user</span><span class="op" id="3239248">,</span>&nbsp;<span class="ident" id="3239250">binaryUnmarshalerInterfaceType</span><span class="op" id="3239280">)</span><span class="op" id="3239281">;</span>&nbsp;<span class="ident" id="3239283">ok</span>&nbsp;<span class="op" id="3239286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3239290">ut</span><span class="op" id="3239292">.</span><span class="ident" id="3239293">externalDec</span><span class="op" id="3239304">,</span>&nbsp;<span class="ident" id="3239306">ut</span><span class="op" id="3239308">.</span><span class="ident" id="3239309">decIndir</span>&nbsp;<span class="op" id="3239318">=</span>&nbsp;<span class="ident" id="3239320">xBinary</span><span class="op" id="3239327">,</span>&nbsp;<span class="ident" id="3239329">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3239336">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3239340">//&nbsp;See&nbsp;note&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3239360">//&nbsp;}&nbsp;else&nbsp;if&nbsp;ok,&nbsp;indir&nbsp;:=&nbsp;implementsInterface(ut.user,&nbsp;textUnmarshalerInterfaceType);&nbsp;ok&nbsp;{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3239452">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsput.externalDec,&nbsp;ut.decIndir&nbsp;=&nbsp;xText,&nbsp;indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3239500">//&nbsp;}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3239507">userTypeCache</span><span class="op" id="3239520">[</span><span class="ident" id="3239521">rt</span><span class="op" id="3239523">]</span>&nbsp;<span class="op" id="3239525">=</span>&nbsp;<span class="ident" id="3239527">ut</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3239531">return</span><br>
<span class="lineno"></span><span class="op" id="3239538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="3239541">var</span>&nbsp;<span class="op" id="3239545">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3239548">gobEncoderInterfaceType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3239579">=</span>&nbsp;<span class="ident" id="3239581">reflect</span><span class="op" id="3239588">.</span><span class="ident" id="3239589">TypeOf</span><span class="op" id="3239595">(</span><span class="op" id="3239596">(</span><span class="op" id="3239597">*</span><span class="ident" id="3239598">GobEncoder</span><span class="op" id="3239608">)</span><span class="op" id="3239609">(</span><span class="ident" id="3239610">nil</span><span class="op" id="3239613">)</span><span class="op" id="3239614">)</span><span class="op" id="3239615">.</span><span class="ident" id="3239616">Elem</span><span class="op" id="3239620">(</span><span class="op" id="3239621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3239624">gobDecoderInterfaceType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3239655">=</span>&nbsp;<span class="ident" id="3239657">reflect</span><span class="op" id="3239664">.</span><span class="ident" id="3239665">TypeOf</span><span class="op" id="3239671">(</span><span class="op" id="3239672">(</span><span class="op" id="3239673">*</span><span class="ident" id="3239674">GobDecoder</span><span class="op" id="3239684">)</span><span class="op" id="3239685">(</span><span class="ident" id="3239686">nil</span><span class="op" id="3239689">)</span><span class="op" id="3239690">)</span><span class="op" id="3239691">.</span><span class="ident" id="3239692">Elem</span><span class="op" id="3239696">(</span><span class="op" id="3239697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3239700">binaryMarshalerInterfaceType</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3239731">=</span>&nbsp;<span class="ident" id="3239733">reflect</span><span class="op" id="3239740">.</span><span class="ident" id="3239741">TypeOf</span><span class="op" id="3239747">(</span><span class="op" id="3239748">(</span><span class="op" id="3239749">*</span><span class="ident" id="3239750">encoding</span><span class="op" id="3239758">.</span><span class="ident" id="3239759">BinaryMarshaler</span><span class="op" id="3239774">)</span><span class="op" id="3239775">(</span><span class="ident" id="3239776">nil</span><span class="op" id="3239779">)</span><span class="op" id="3239780">)</span><span class="op" id="3239781">.</span><span class="ident" id="3239782">Elem</span><span class="op" id="3239786">(</span><span class="op" id="3239787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3239790">binaryUnmarshalerInterfaceType</span>&nbsp;<span class="op" id="3239821">=</span>&nbsp;<span class="ident" id="3239823">reflect</span><span class="op" id="3239830">.</span><span class="ident" id="3239831">TypeOf</span><span class="op" id="3239837">(</span><span class="op" id="3239838">(</span><span class="op" id="3239839">*</span><span class="ident" id="3239840">encoding</span><span class="op" id="3239848">.</span><span class="ident" id="3239849">BinaryUnmarshaler</span><span class="op" id="3239866">)</span><span class="op" id="3239867">(</span><span class="ident" id="3239868">nil</span><span class="op" id="3239871">)</span><span class="op" id="3239872">)</span><span class="op" id="3239873">.</span><span class="ident" id="3239874">Elem</span><span class="op" id="3239878">(</span><span class="op" id="3239879">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3239882">textMarshalerInterfaceType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3239913">=</span>&nbsp;<span class="ident" id="3239915">reflect</span><span class="op" id="3239922">.</span><span class="ident" id="3239923">TypeOf</span><span class="op" id="3239929">(</span><span class="op" id="3239930">(</span><span class="op" id="3239931">*</span><span class="ident" id="3239932">encoding</span><span class="op" id="3239940">.</span><span class="ident" id="3239941">TextMarshaler</span><span class="op" id="3239954">)</span><span class="op" id="3239955">(</span><span class="ident" id="3239956">nil</span><span class="op" id="3239959">)</span><span class="op" id="3239960">)</span><span class="op" id="3239961">.</span><span class="ident" id="3239962">Elem</span><span class="op" id="3239966">(</span><span class="op" id="3239967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3239970">textUnmarshalerInterfaceType</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3240001">=</span>&nbsp;<span class="ident" id="3240003">reflect</span><span class="op" id="3240010">.</span><span class="ident" id="3240011">TypeOf</span><span class="op" id="3240017">(</span><span class="op" id="3240018">(</span><span class="op" id="3240019">*</span><span class="ident" id="3240020">encoding</span><span class="op" id="3240028">.</span><span class="ident" id="3240029">TextUnmarshaler</span><span class="op" id="3240044">)</span><span class="op" id="3240045">(</span><span class="ident" id="3240046">nil</span><span class="op" id="3240049">)</span><span class="op" id="3240050">)</span><span class="op" id="3240051">.</span><span class="ident" id="3240052">Elem</span><span class="op" id="3240056">(</span><span class="op" id="3240057">)</span><br>
<span class="lineno"></span><span class="op" id="3240059">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3240062">//&nbsp;implementsInterface&nbsp;reports&nbsp;whether&nbsp;the&nbsp;type&nbsp;implements&nbsp;the</span><br>
<span class="lineno">125</span><span class="comment" id="3240125">//&nbsp;gobEncoder/gobDecoder&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="3240161">//&nbsp;It&nbsp;also&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;indirections&nbsp;required&nbsp;to&nbsp;get&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3240230">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="3240249">func</span>&nbsp;<span class="ident" id="3240254">implementsInterface</span><span class="op" id="3240273">(</span><span class="ident" id="3240274">typ</span><span class="op" id="3240277">,</span>&nbsp;<span class="ident" id="3240279">gobEncDecType</span>&nbsp;<span class="ident" id="3240293">reflect</span><span class="op" id="3240300">.</span><span class="ident" id="3240301">Type</span><span class="op" id="3240305">)</span>&nbsp;<span class="op" id="3240307">(</span><span class="ident" id="3240308">success</span>&nbsp;<span class="builtintype" id="3240316">bool</span><span class="op" id="3240320">,</span>&nbsp;<span class="ident" id="3240322">indir</span>&nbsp;<span class="builtintype" id="3240328">int8</span><span class="op" id="3240332">)</span>&nbsp;<span class="op" id="3240334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3240337">if</span>&nbsp;<span class="ident" id="3240340">typ</span>&nbsp;<span class="op" id="3240344">==</span>&nbsp;<span class="ident" id="3240347">nil</span>&nbsp;<span class="op" id="3240351">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3240355">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3240363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3240366">rt</span>&nbsp;<span class="op" id="3240369">:=</span>&nbsp;<span class="ident" id="3240372">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3240377">//&nbsp;The&nbsp;type&nbsp;might&nbsp;be&nbsp;a&nbsp;pointer&nbsp;and&nbsp;we&nbsp;need&nbsp;to&nbsp;keep</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3240429">//&nbsp;dereferencing&nbsp;to&nbsp;the&nbsp;base&nbsp;type&nbsp;until&nbsp;we&nbsp;find&nbsp;an&nbsp;implementation.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3240497">for</span>&nbsp;<span class="op" id="3240501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3240505">if</span>&nbsp;<span class="ident" id="3240508">rt</span><span class="op" id="3240510">.</span><span class="ident" id="3240511">Implements</span><span class="op" id="3240521">(</span><span class="ident" id="3240522">gobEncDecType</span><span class="op" id="3240535">)</span>&nbsp;<span class="op" id="3240537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3240542">return</span>&nbsp;<span class="ident" id="3240549">true</span><span class="op" id="3240553">,</span>&nbsp;<span class="ident" id="3240555">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3240563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3240567">if</span>&nbsp;<span class="ident" id="3240570">p</span>&nbsp;<span class="op" id="3240572">:=</span>&nbsp;<span class="ident" id="3240575">rt</span><span class="op" id="3240577">;</span>&nbsp;<span class="ident" id="3240579">p</span><span class="op" id="3240580">.</span><span class="ident" id="3240581">Kind</span><span class="op" id="3240585">(</span><span class="op" id="3240586">)</span>&nbsp;<span class="op" id="3240588">==</span>&nbsp;<span class="ident" id="3240591">reflect</span><span class="op" id="3240598">.</span><span class="ident" id="3240599">Ptr</span>&nbsp;<span class="op" id="3240603">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3240608">indir</span><span class="op" id="3240613">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3240619">if</span>&nbsp;<span class="ident" id="3240622">indir</span>&nbsp;<span class="op" id="3240628">&gt;</span>&nbsp;<span class="num" id="3240630">100</span>&nbsp;<span class="op" id="3240634">{</span>&nbsp;<span class="comment" id="3240636">//&nbsp;insane&nbsp;number&nbsp;of&nbsp;indirections</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3240673">return</span>&nbsp;<span class="ident" id="3240680">false</span><span class="op" id="3240685">,</span>&nbsp;<span class="num" id="3240687">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3240692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3240697">rt</span>&nbsp;<span class="op" id="3240700">=</span>&nbsp;<span class="ident" id="3240702">p</span><span class="op" id="3240703">.</span><span class="ident" id="3240704">Elem</span><span class="op" id="3240708">(</span><span class="op" id="3240709">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3240714">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3240725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3240729">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3240736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3240739">//&nbsp;No&nbsp;luck&nbsp;yet,&nbsp;but&nbsp;if&nbsp;this&nbsp;is&nbsp;a&nbsp;base&nbsp;type&nbsp;(non-pointer),&nbsp;the&nbsp;pointer&nbsp;might&nbsp;satisfy.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3240825">if</span>&nbsp;<span class="ident" id="3240828">typ</span><span class="op" id="3240831">.</span><span class="ident" id="3240832">Kind</span><span class="op" id="3240836">(</span><span class="op" id="3240837">)</span>&nbsp;<span class="op" id="3240839">!=</span>&nbsp;<span class="ident" id="3240842">reflect</span><span class="op" id="3240849">.</span><span class="ident" id="3240850">Ptr</span>&nbsp;<span class="op" id="3240854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3240858">//&nbsp;Not&nbsp;a&nbsp;pointer,&nbsp;but&nbsp;does&nbsp;the&nbsp;pointer&nbsp;work?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3240905">if</span>&nbsp;<span class="ident" id="3240908">reflect</span><span class="op" id="3240915">.</span><span class="ident" id="3240916">PtrTo</span><span class="op" id="3240921">(</span><span class="ident" id="3240922">typ</span><span class="op" id="3240925">)</span><span class="op" id="3240926">.</span><span class="ident" id="3240927">Implements</span><span class="op" id="3240937">(</span><span class="ident" id="3240938">gobEncDecType</span><span class="op" id="3240951">)</span>&nbsp;<span class="op" id="3240953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3240958">return</span>&nbsp;<span class="ident" id="3240965">true</span><span class="op" id="3240969">,</span>&nbsp;<span class="op" id="3240971">-</span><span class="num" id="3240972">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3240976">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3240979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3240982">return</span>&nbsp;<span class="ident" id="3240989">false</span><span class="op" id="3240994">,</span>&nbsp;<span class="num" id="3240996">0</span><br>
<span class="lineno"></span><span class="op" id="3240998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3241001">//&nbsp;userType&nbsp;returns,&nbsp;and&nbsp;saves,&nbsp;the&nbsp;information&nbsp;associated&nbsp;with&nbsp;user-provided&nbsp;type&nbsp;rt.</span><br>
<span class="lineno">160</span><span class="comment" id="3241088">//&nbsp;If&nbsp;the&nbsp;user&nbsp;type&nbsp;is&nbsp;not&nbsp;valid,&nbsp;it&nbsp;calls&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="3241138">func</span>&nbsp;<span class="ident" id="3241143">userType</span><span class="op" id="3241151">(</span><span class="ident" id="3241152">rt</span>&nbsp;<span class="ident" id="3241155">reflect</span><span class="op" id="3241162">.</span><span class="ident" id="3241163">Type</span><span class="op" id="3241167">)</span>&nbsp;<span class="op" id="3241169">*</span><span class="ident" id="3241170">userTypeInfo</span>&nbsp;<span class="op" id="3241183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3241186">ut</span><span class="op" id="3241188">,</span>&nbsp;<span class="ident" id="3241190">err</span>&nbsp;<span class="op" id="3241194">:=</span>&nbsp;<span class="ident" id="3241197">validUserType</span><span class="op" id="3241210">(</span><span class="ident" id="3241211">rt</span><span class="op" id="3241213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3241216">if</span>&nbsp;<span class="ident" id="3241219">err</span>&nbsp;<span class="op" id="3241223">!=</span>&nbsp;<span class="ident" id="3241226">nil</span>&nbsp;<span class="op" id="3241230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3241234">error_</span><span class="op" id="3241240">(</span><span class="ident" id="3241241">err</span><span class="op" id="3241244">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3241247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3241250">return</span>&nbsp;<span class="ident" id="3241257">ut</span><br>
<span class="lineno"></span><span class="op" id="3241260">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3241263">//&nbsp;A&nbsp;typeId&nbsp;represents&nbsp;a&nbsp;gob&nbsp;Type&nbsp;as&nbsp;an&nbsp;integer&nbsp;that&nbsp;can&nbsp;be&nbsp;passed&nbsp;on&nbsp;the&nbsp;wire.</span><br>
<span class="lineno">170</span><span class="comment" id="3241343">//&nbsp;Internally,&nbsp;typeIds&nbsp;are&nbsp;used&nbsp;as&nbsp;keys&nbsp;to&nbsp;a&nbsp;map&nbsp;to&nbsp;recover&nbsp;the&nbsp;underlying&nbsp;type&nbsp;info.</span><br>
<span class="lineno"></span><span class="keyword" id="3241429">type</span>&nbsp;<span class="ident" id="3241434">typeId</span>&nbsp;<span class="builtintype" id="3241441">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3241448">var</span>&nbsp;<span class="ident" id="3241452">nextId</span>&nbsp;<span class="ident" id="3241459">typeId</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3241472">//&nbsp;incremented&nbsp;for&nbsp;each&nbsp;new&nbsp;type&nbsp;we&nbsp;build</span><br>
<span class="lineno"></span><span class="keyword" id="3241514">var</span>&nbsp;<span class="ident" id="3241518">typeLock</span>&nbsp;<span class="ident" id="3241527">sync</span><span class="op" id="3241531">.</span><span class="ident" id="3241532">Mutex</span>&nbsp;<span class="comment" id="3241538">//&nbsp;set&nbsp;while&nbsp;building&nbsp;a&nbsp;type</span><br>
<span class="lineno">175</span><span class="keyword" id="3241567">const</span>&nbsp;<span class="ident" id="3241573">firstUserId</span>&nbsp;<span class="op" id="3241585">=</span>&nbsp;<span class="num" id="3241587">64</span>&nbsp;&nbsp;<span class="comment" id="3241591">//&nbsp;lowest&nbsp;id&nbsp;number&nbsp;granted&nbsp;to&nbsp;user</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3241628">type</span>&nbsp;<span class="ident" id="3241633">gobType</span>&nbsp;<span class="keyword" id="3241641">interface</span>&nbsp;<span class="op" id="3241651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3241654">id</span><span class="op" id="3241656">(</span><span class="op" id="3241657">)</span>&nbsp;<span class="ident" id="3241659">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3241667">setId</span><span class="op" id="3241672">(</span><span class="ident" id="3241673">id</span>&nbsp;<span class="ident" id="3241676">typeId</span><span class="op" id="3241682">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3241685">name</span><span class="op" id="3241689">(</span><span class="op" id="3241690">)</span>&nbsp;<span class="builtintype" id="3241692">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3241700">string</span><span class="op" id="3241706">(</span><span class="op" id="3241707">)</span>&nbsp;<span class="builtintype" id="3241709">string</span>&nbsp;<span class="comment" id="3241716">//&nbsp;not&nbsp;public;&nbsp;only&nbsp;for&nbsp;debugging</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3241751">safeString</span><span class="op" id="3241761">(</span><span class="ident" id="3241762">seen</span>&nbsp;<span class="keyword" id="3241767">map</span><span class="op" id="3241770">[</span><span class="ident" id="3241771">typeId</span><span class="op" id="3241777">]</span><span class="builtintype" id="3241778">bool</span><span class="op" id="3241782">)</span>&nbsp;<span class="builtintype" id="3241784">string</span><br>
<span class="lineno"></span><span class="op" id="3241791">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="3241794">var</span>&nbsp;<span class="ident" id="3241798">types</span>&nbsp;<span class="op" id="3241804">=</span>&nbsp;<span class="builtinfunc" id="3241806">make</span><span class="op" id="3241810">(</span><span class="keyword" id="3241811">map</span><span class="op" id="3241814">[</span><span class="ident" id="3241815">reflect</span><span class="op" id="3241822">.</span><span class="ident" id="3241823">Type</span><span class="op" id="3241827">]</span><span class="ident" id="3241828">gobType</span><span class="op" id="3241835">)</span><br>
<span class="lineno"></span><span class="keyword" id="3241837">var</span>&nbsp;<span class="ident" id="3241841">idToType</span>&nbsp;<span class="op" id="3241850">=</span>&nbsp;<span class="builtinfunc" id="3241852">make</span><span class="op" id="3241856">(</span><span class="keyword" id="3241857">map</span><span class="op" id="3241860">[</span><span class="ident" id="3241861">typeId</span><span class="op" id="3241867">]</span><span class="ident" id="3241868">gobType</span><span class="op" id="3241875">)</span><br>
<span class="lineno"></span><span class="keyword" id="3241877">var</span>&nbsp;<span class="ident" id="3241881">builtinIdToType</span>&nbsp;<span class="keyword" id="3241897">map</span><span class="op" id="3241900">[</span><span class="ident" id="3241901">typeId</span><span class="op" id="3241907">]</span><span class="ident" id="3241908">gobType</span>&nbsp;<span class="comment" id="3241916">//&nbsp;set&nbsp;in&nbsp;init()&nbsp;after&nbsp;builtins&nbsp;are&nbsp;established</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3241965">func</span>&nbsp;<span class="ident" id="3241970">setTypeId</span><span class="op" id="3241979">(</span><span class="ident" id="3241980">typ</span>&nbsp;<span class="ident" id="3241984">gobType</span><span class="op" id="3241991">)</span>&nbsp;<span class="op" id="3241993">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3241996">//&nbsp;When&nbsp;building&nbsp;recursive&nbsp;types,&nbsp;someone&nbsp;may&nbsp;get&nbsp;there&nbsp;before&nbsp;us.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3242064">if</span>&nbsp;<span class="ident" id="3242067">typ</span><span class="op" id="3242070">.</span><span class="ident" id="3242071">id</span><span class="op" id="3242073">(</span><span class="op" id="3242074">)</span>&nbsp;<span class="op" id="3242076">!=</span>&nbsp;<span class="num" id="3242079">0</span>&nbsp;<span class="op" id="3242081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3242085">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3242093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3242096">nextId</span><span class="op" id="3242102">++</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3242106">typ</span><span class="op" id="3242109">.</span><span class="ident" id="3242110">setId</span><span class="op" id="3242115">(</span><span class="ident" id="3242116">nextId</span><span class="op" id="3242122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3242125">idToType</span><span class="op" id="3242133">[</span><span class="ident" id="3242134">nextId</span><span class="op" id="3242140">]</span>&nbsp;<span class="op" id="3242142">=</span>&nbsp;<span class="ident" id="3242144">typ</span><br>
<span class="lineno"></span><span class="op" id="3242148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3242151">func</span>&nbsp;<span class="op" id="3242156">(</span><span class="ident" id="3242157">t</span>&nbsp;<span class="ident" id="3242159">typeId</span><span class="op" id="3242165">)</span>&nbsp;<span class="ident" id="3242167">gobType</span><span class="op" id="3242174">(</span><span class="op" id="3242175">)</span>&nbsp;<span class="ident" id="3242177">gobType</span>&nbsp;<span class="op" id="3242185">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3242188">if</span>&nbsp;<span class="ident" id="3242191">t</span>&nbsp;<span class="op" id="3242193">==</span>&nbsp;<span class="num" id="3242196">0</span>&nbsp;<span class="op" id="3242198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3242202">return</span>&nbsp;<span class="ident" id="3242209">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3242214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3242217">return</span>&nbsp;<span class="ident" id="3242224">idToType</span><span class="op" id="3242232">[</span><span class="ident" id="3242233">t</span><span class="op" id="3242234">]</span><br>
<span class="lineno"></span><span class="op" id="3242236">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span><span class="comment" id="3242239">//&nbsp;string&nbsp;returns&nbsp;the&nbsp;string&nbsp;representation&nbsp;of&nbsp;the&nbsp;type&nbsp;associated&nbsp;with&nbsp;the&nbsp;typeId.</span><br>
<span class="lineno"></span><span class="keyword" id="3242323">func</span>&nbsp;<span class="op" id="3242328">(</span><span class="ident" id="3242329">t</span>&nbsp;<span class="ident" id="3242331">typeId</span><span class="op" id="3242337">)</span>&nbsp;<span class="builtintype" id="3242339">string</span><span class="op" id="3242345">(</span><span class="op" id="3242346">)</span>&nbsp;<span class="builtintype" id="3242348">string</span>&nbsp;<span class="op" id="3242355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3242358">if</span>&nbsp;<span class="ident" id="3242361">t</span><span class="op" id="3242362">.</span><span class="ident" id="3242363">gobType</span><span class="op" id="3242370">(</span><span class="op" id="3242371">)</span>&nbsp;<span class="op" id="3242373">==</span>&nbsp;<span class="ident" id="3242376">nil</span>&nbsp;<span class="op" id="3242380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3242384">return</span>&nbsp;<span class="string" id="3242391">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3242400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3242403">return</span>&nbsp;<span class="ident" id="3242410">t</span><span class="op" id="3242411">.</span><span class="ident" id="3242412">gobType</span><span class="op" id="3242419">(</span><span class="op" id="3242420">)</span><span class="op" id="3242421">.</span><span class="builtintype" id="3242422">string</span><span class="op" id="3242428">(</span><span class="op" id="3242429">)</span><br>
<span class="lineno"></span><span class="op" id="3242431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3242434">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;type&nbsp;associated&nbsp;with&nbsp;the&nbsp;typeId.</span><br>
<span class="lineno">215</span><span class="keyword" id="3242499">func</span>&nbsp;<span class="op" id="3242504">(</span><span class="ident" id="3242505">t</span>&nbsp;<span class="ident" id="3242507">typeId</span><span class="op" id="3242513">)</span>&nbsp;<span class="ident" id="3242515">name</span><span class="op" id="3242519">(</span><span class="op" id="3242520">)</span>&nbsp;<span class="builtintype" id="3242522">string</span>&nbsp;<span class="op" id="3242529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3242532">if</span>&nbsp;<span class="ident" id="3242535">t</span><span class="op" id="3242536">.</span><span class="ident" id="3242537">gobType</span><span class="op" id="3242544">(</span><span class="op" id="3242545">)</span>&nbsp;<span class="op" id="3242547">==</span>&nbsp;<span class="ident" id="3242550">nil</span>&nbsp;<span class="op" id="3242554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3242558">return</span>&nbsp;<span class="string" id="3242565">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3242574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3242577">return</span>&nbsp;<span class="ident" id="3242584">t</span><span class="op" id="3242585">.</span><span class="ident" id="3242586">gobType</span><span class="op" id="3242593">(</span><span class="op" id="3242594">)</span><span class="op" id="3242595">.</span><span class="ident" id="3242596">name</span><span class="op" id="3242600">(</span><span class="op" id="3242601">)</span><br>
<span class="lineno">220</span><span class="op" id="3242603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3242606">//&nbsp;CommonType&nbsp;holds&nbsp;elements&nbsp;of&nbsp;all&nbsp;types.</span><br>
<span class="lineno"></span><span class="comment" id="3242649">//&nbsp;It&nbsp;is&nbsp;a&nbsp;historical&nbsp;artifact,&nbsp;kept&nbsp;for&nbsp;binary&nbsp;compatibility&nbsp;and&nbsp;exported</span><br>
<span class="lineno"></span><span class="comment" id="3242724">//&nbsp;only&nbsp;for&nbsp;the&nbsp;benefit&nbsp;of&nbsp;the&nbsp;package&#39;s&nbsp;encoding&nbsp;of&nbsp;type&nbsp;descriptors.&nbsp;It&nbsp;is</span><br>
<span class="lineno">225</span><span class="comment" id="3242801">//&nbsp;not&nbsp;intended&nbsp;for&nbsp;direct&nbsp;use&nbsp;by&nbsp;clients.</span><br>
<span class="lineno"></span><span class="keyword" id="3242844">type</span>&nbsp;<span class="ident" id="3242849">CommonType</span>&nbsp;<span class="keyword" id="3242860">struct</span>&nbsp;<span class="op" id="3242867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3242870">Name</span>&nbsp;<span class="builtintype" id="3242875">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3242883">Id</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3242888">typeId</span><br>
<span class="lineno"></span><span class="op" id="3242895">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="keyword" id="3242898">func</span>&nbsp;<span class="op" id="3242903">(</span><span class="ident" id="3242904">t</span>&nbsp;<span class="op" id="3242906">*</span><span class="ident" id="3242907">CommonType</span><span class="op" id="3242917">)</span>&nbsp;<span class="ident" id="3242919">id</span><span class="op" id="3242921">(</span><span class="op" id="3242922">)</span>&nbsp;<span class="ident" id="3242924">typeId</span>&nbsp;<span class="op" id="3242931">{</span>&nbsp;<span class="keyword" id="3242933">return</span>&nbsp;<span class="ident" id="3242940">t</span><span class="op" id="3242941">.</span><span class="ident" id="3242942">Id</span>&nbsp;<span class="op" id="3242945">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3242948">func</span>&nbsp;<span class="op" id="3242953">(</span><span class="ident" id="3242954">t</span>&nbsp;<span class="op" id="3242956">*</span><span class="ident" id="3242957">CommonType</span><span class="op" id="3242967">)</span>&nbsp;<span class="ident" id="3242969">setId</span><span class="op" id="3242974">(</span><span class="ident" id="3242975">id</span>&nbsp;<span class="ident" id="3242978">typeId</span><span class="op" id="3242984">)</span>&nbsp;<span class="op" id="3242986">{</span>&nbsp;<span class="ident" id="3242988">t</span><span class="op" id="3242989">.</span><span class="ident" id="3242990">Id</span>&nbsp;<span class="op" id="3242993">=</span>&nbsp;<span class="ident" id="3242995">id</span>&nbsp;<span class="op" id="3242998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword" id="3243001">func</span>&nbsp;<span class="op" id="3243006">(</span><span class="ident" id="3243007">t</span>&nbsp;<span class="op" id="3243009">*</span><span class="ident" id="3243010">CommonType</span><span class="op" id="3243020">)</span>&nbsp;<span class="builtintype" id="3243022">string</span><span class="op" id="3243028">(</span><span class="op" id="3243029">)</span>&nbsp;<span class="builtintype" id="3243031">string</span>&nbsp;<span class="op" id="3243038">{</span>&nbsp;<span class="keyword" id="3243040">return</span>&nbsp;<span class="ident" id="3243047">t</span><span class="op" id="3243048">.</span><span class="ident" id="3243049">Name</span>&nbsp;<span class="op" id="3243054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3243057">func</span>&nbsp;<span class="op" id="3243062">(</span><span class="ident" id="3243063">t</span>&nbsp;<span class="op" id="3243065">*</span><span class="ident" id="3243066">CommonType</span><span class="op" id="3243076">)</span>&nbsp;<span class="ident" id="3243078">safeString</span><span class="op" id="3243088">(</span><span class="ident" id="3243089">seen</span>&nbsp;<span class="keyword" id="3243094">map</span><span class="op" id="3243097">[</span><span class="ident" id="3243098">typeId</span><span class="op" id="3243104">]</span><span class="builtintype" id="3243105">bool</span><span class="op" id="3243109">)</span>&nbsp;<span class="builtintype" id="3243111">string</span>&nbsp;<span class="op" id="3243118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3243121">return</span>&nbsp;<span class="ident" id="3243128">t</span><span class="op" id="3243129">.</span><span class="ident" id="3243130">Name</span><br>
<span class="lineno"></span><span class="op" id="3243135">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="3243138">func</span>&nbsp;<span class="op" id="3243143">(</span><span class="ident" id="3243144">t</span>&nbsp;<span class="op" id="3243146">*</span><span class="ident" id="3243147">CommonType</span><span class="op" id="3243157">)</span>&nbsp;<span class="ident" id="3243159">name</span><span class="op" id="3243163">(</span><span class="op" id="3243164">)</span>&nbsp;<span class="builtintype" id="3243166">string</span>&nbsp;<span class="op" id="3243173">{</span>&nbsp;<span class="keyword" id="3243175">return</span>&nbsp;<span class="ident" id="3243182">t</span><span class="op" id="3243183">.</span><span class="ident" id="3243184">Name</span>&nbsp;<span class="op" id="3243189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3243192">//&nbsp;Create&nbsp;and&nbsp;check&nbsp;predefined&nbsp;types</span><br>
<span class="lineno"></span><span class="comment" id="3243229">//&nbsp;The&nbsp;string&nbsp;for&nbsp;tBytes&nbsp;is&nbsp;&#34;bytes&#34;&nbsp;not&nbsp;&#34;[]byte&#34;&nbsp;to&nbsp;signify&nbsp;its&nbsp;specialness.</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="keyword" id="3243307">var</span>&nbsp;<span class="op" id="3243311">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3243314">//&nbsp;Primordial&nbsp;types,&nbsp;needed&nbsp;during&nbsp;initialization.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3243366">//&nbsp;Always&nbsp;passed&nbsp;as&nbsp;pointers&nbsp;so&nbsp;the&nbsp;interface{}&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3243420">//&nbsp;goes&nbsp;through&nbsp;without&nbsp;losing&nbsp;its&nbsp;interfaceness.</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3243471">tBool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3243482">=</span>&nbsp;<span class="ident" id="3243484">bootstrapType</span><span class="op" id="3243497">(</span><span class="string" id="3243498">&#34;bool&#34;</span><span class="op" id="3243504">,</span>&nbsp;<span class="op" id="3243506">(</span><span class="op" id="3243507">*</span><span class="builtintype" id="3243508">bool</span><span class="op" id="3243512">)</span><span class="op" id="3243513">(</span><span class="ident" id="3243514">nil</span><span class="op" id="3243517">)</span><span class="op" id="3243518">,</span>&nbsp;<span class="num" id="3243520">1</span><span class="op" id="3243521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3243524">tInt</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3243535">=</span>&nbsp;<span class="ident" id="3243537">bootstrapType</span><span class="op" id="3243550">(</span><span class="string" id="3243551">&#34;int&#34;</span><span class="op" id="3243556">,</span>&nbsp;<span class="op" id="3243558">(</span><span class="op" id="3243559">*</span><span class="builtintype" id="3243560">int</span><span class="op" id="3243563">)</span><span class="op" id="3243564">(</span><span class="ident" id="3243565">nil</span><span class="op" id="3243568">)</span><span class="op" id="3243569">,</span>&nbsp;<span class="num" id="3243571">2</span><span class="op" id="3243572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3243575">tUint</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3243586">=</span>&nbsp;<span class="ident" id="3243588">bootstrapType</span><span class="op" id="3243601">(</span><span class="string" id="3243602">&#34;uint&#34;</span><span class="op" id="3243608">,</span>&nbsp;<span class="op" id="3243610">(</span><span class="op" id="3243611">*</span><span class="builtintype" id="3243612">uint</span><span class="op" id="3243616">)</span><span class="op" id="3243617">(</span><span class="ident" id="3243618">nil</span><span class="op" id="3243621">)</span><span class="op" id="3243622">,</span>&nbsp;<span class="num" id="3243624">3</span><span class="op" id="3243625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3243628">tFloat</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3243639">=</span>&nbsp;<span class="ident" id="3243641">bootstrapType</span><span class="op" id="3243654">(</span><span class="string" id="3243655">&#34;float&#34;</span><span class="op" id="3243662">,</span>&nbsp;<span class="op" id="3243664">(</span><span class="op" id="3243665">*</span><span class="builtintype" id="3243666">float64</span><span class="op" id="3243673">)</span><span class="op" id="3243674">(</span><span class="ident" id="3243675">nil</span><span class="op" id="3243678">)</span><span class="op" id="3243679">,</span>&nbsp;<span class="num" id="3243681">4</span><span class="op" id="3243682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3243685">tBytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3243696">=</span>&nbsp;<span class="ident" id="3243698">bootstrapType</span><span class="op" id="3243711">(</span><span class="string" id="3243712">&#34;bytes&#34;</span><span class="op" id="3243719">,</span>&nbsp;<span class="op" id="3243721">(</span><span class="op" id="3243722">*</span><span class="op" id="3243723">[</span><span class="op" id="3243724">]</span><span class="builtintype" id="3243725">byte</span><span class="op" id="3243729">)</span><span class="op" id="3243730">(</span><span class="ident" id="3243731">nil</span><span class="op" id="3243734">)</span><span class="op" id="3243735">,</span>&nbsp;<span class="num" id="3243737">5</span><span class="op" id="3243738">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3243741">tString</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3243752">=</span>&nbsp;<span class="ident" id="3243754">bootstrapType</span><span class="op" id="3243767">(</span><span class="string" id="3243768">&#34;string&#34;</span><span class="op" id="3243776">,</span>&nbsp;<span class="op" id="3243778">(</span><span class="op" id="3243779">*</span><span class="builtintype" id="3243780">string</span><span class="op" id="3243786">)</span><span class="op" id="3243787">(</span><span class="ident" id="3243788">nil</span><span class="op" id="3243791">)</span><span class="op" id="3243792">,</span>&nbsp;<span class="num" id="3243794">6</span><span class="op" id="3243795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3243798">tComplex</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3243809">=</span>&nbsp;<span class="ident" id="3243811">bootstrapType</span><span class="op" id="3243824">(</span><span class="string" id="3243825">&#34;complex&#34;</span><span class="op" id="3243834">,</span>&nbsp;<span class="op" id="3243836">(</span><span class="op" id="3243837">*</span><span class="builtintype" id="3243838">complex128</span><span class="op" id="3243848">)</span><span class="op" id="3243849">(</span><span class="ident" id="3243850">nil</span><span class="op" id="3243853">)</span><span class="op" id="3243854">,</span>&nbsp;<span class="num" id="3243856">7</span><span class="op" id="3243857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3243860">tInterface</span>&nbsp;<span class="op" id="3243871">=</span>&nbsp;<span class="ident" id="3243873">bootstrapType</span><span class="op" id="3243886">(</span><span class="string" id="3243887">&#34;interface&#34;</span><span class="op" id="3243898">,</span>&nbsp;<span class="op" id="3243900">(</span><span class="op" id="3243901">*</span><span class="keyword" id="3243902">interface</span><span class="op" id="3243911">{</span><span class="op" id="3243912">}</span><span class="op" id="3243913">)</span><span class="op" id="3243914">(</span><span class="ident" id="3243915">nil</span><span class="op" id="3243918">)</span><span class="op" id="3243919">,</span>&nbsp;<span class="num" id="3243921">8</span><span class="op" id="3243922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3243925">//&nbsp;Reserve&nbsp;some&nbsp;Ids&nbsp;for&nbsp;compatible&nbsp;expansion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3243971">tReserved7</span>&nbsp;<span class="op" id="3243982">=</span>&nbsp;<span class="ident" id="3243984">bootstrapType</span><span class="op" id="3243997">(</span><span class="string" id="3243998">&#34;_reserved1&#34;</span><span class="op" id="3244010">,</span>&nbsp;<span class="op" id="3244012">(</span><span class="op" id="3244013">*</span><span class="keyword" id="3244014">struct</span><span class="op" id="3244020">{</span>&nbsp;<span class="ident" id="3244022">r7</span>&nbsp;<span class="builtintype" id="3244025">int</span>&nbsp;<span class="op" id="3244029">}</span><span class="op" id="3244030">)</span><span class="op" id="3244031">(</span><span class="ident" id="3244032">nil</span><span class="op" id="3244035">)</span><span class="op" id="3244036">,</span>&nbsp;<span class="num" id="3244038">9</span><span class="op" id="3244039">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3244042">tReserved6</span>&nbsp;<span class="op" id="3244053">=</span>&nbsp;<span class="ident" id="3244055">bootstrapType</span><span class="op" id="3244068">(</span><span class="string" id="3244069">&#34;_reserved1&#34;</span><span class="op" id="3244081">,</span>&nbsp;<span class="op" id="3244083">(</span><span class="op" id="3244084">*</span><span class="keyword" id="3244085">struct</span><span class="op" id="3244091">{</span>&nbsp;<span class="ident" id="3244093">r6</span>&nbsp;<span class="builtintype" id="3244096">int</span>&nbsp;<span class="op" id="3244100">}</span><span class="op" id="3244101">)</span><span class="op" id="3244102">(</span><span class="ident" id="3244103">nil</span><span class="op" id="3244106">)</span><span class="op" id="3244107">,</span>&nbsp;<span class="num" id="3244109">10</span><span class="op" id="3244111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3244114">tReserved5</span>&nbsp;<span class="op" id="3244125">=</span>&nbsp;<span class="ident" id="3244127">bootstrapType</span><span class="op" id="3244140">(</span><span class="string" id="3244141">&#34;_reserved1&#34;</span><span class="op" id="3244153">,</span>&nbsp;<span class="op" id="3244155">(</span><span class="op" id="3244156">*</span><span class="keyword" id="3244157">struct</span><span class="op" id="3244163">{</span>&nbsp;<span class="ident" id="3244165">r5</span>&nbsp;<span class="builtintype" id="3244168">int</span>&nbsp;<span class="op" id="3244172">}</span><span class="op" id="3244173">)</span><span class="op" id="3244174">(</span><span class="ident" id="3244175">nil</span><span class="op" id="3244178">)</span><span class="op" id="3244179">,</span>&nbsp;<span class="num" id="3244181">11</span><span class="op" id="3244183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3244186">tReserved4</span>&nbsp;<span class="op" id="3244197">=</span>&nbsp;<span class="ident" id="3244199">bootstrapType</span><span class="op" id="3244212">(</span><span class="string" id="3244213">&#34;_reserved1&#34;</span><span class="op" id="3244225">,</span>&nbsp;<span class="op" id="3244227">(</span><span class="op" id="3244228">*</span><span class="keyword" id="3244229">struct</span><span class="op" id="3244235">{</span>&nbsp;<span class="ident" id="3244237">r4</span>&nbsp;<span class="builtintype" id="3244240">int</span>&nbsp;<span class="op" id="3244244">}</span><span class="op" id="3244245">)</span><span class="op" id="3244246">(</span><span class="ident" id="3244247">nil</span><span class="op" id="3244250">)</span><span class="op" id="3244251">,</span>&nbsp;<span class="num" id="3244253">12</span><span class="op" id="3244255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3244258">tReserved3</span>&nbsp;<span class="op" id="3244269">=</span>&nbsp;<span class="ident" id="3244271">bootstrapType</span><span class="op" id="3244284">(</span><span class="string" id="3244285">&#34;_reserved1&#34;</span><span class="op" id="3244297">,</span>&nbsp;<span class="op" id="3244299">(</span><span class="op" id="3244300">*</span><span class="keyword" id="3244301">struct</span><span class="op" id="3244307">{</span>&nbsp;<span class="ident" id="3244309">r3</span>&nbsp;<span class="builtintype" id="3244312">int</span>&nbsp;<span class="op" id="3244316">}</span><span class="op" id="3244317">)</span><span class="op" id="3244318">(</span><span class="ident" id="3244319">nil</span><span class="op" id="3244322">)</span><span class="op" id="3244323">,</span>&nbsp;<span class="num" id="3244325">13</span><span class="op" id="3244327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3244330">tReserved2</span>&nbsp;<span class="op" id="3244341">=</span>&nbsp;<span class="ident" id="3244343">bootstrapType</span><span class="op" id="3244356">(</span><span class="string" id="3244357">&#34;_reserved1&#34;</span><span class="op" id="3244369">,</span>&nbsp;<span class="op" id="3244371">(</span><span class="op" id="3244372">*</span><span class="keyword" id="3244373">struct</span><span class="op" id="3244379">{</span>&nbsp;<span class="ident" id="3244381">r2</span>&nbsp;<span class="builtintype" id="3244384">int</span>&nbsp;<span class="op" id="3244388">}</span><span class="op" id="3244389">)</span><span class="op" id="3244390">(</span><span class="ident" id="3244391">nil</span><span class="op" id="3244394">)</span><span class="op" id="3244395">,</span>&nbsp;<span class="num" id="3244397">14</span><span class="op" id="3244399">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3244402">tReserved1</span>&nbsp;<span class="op" id="3244413">=</span>&nbsp;<span class="ident" id="3244415">bootstrapType</span><span class="op" id="3244428">(</span><span class="string" id="3244429">&#34;_reserved1&#34;</span><span class="op" id="3244441">,</span>&nbsp;<span class="op" id="3244443">(</span><span class="op" id="3244444">*</span><span class="keyword" id="3244445">struct</span><span class="op" id="3244451">{</span>&nbsp;<span class="ident" id="3244453">r1</span>&nbsp;<span class="builtintype" id="3244456">int</span>&nbsp;<span class="op" id="3244460">}</span><span class="op" id="3244461">)</span><span class="op" id="3244462">(</span><span class="ident" id="3244463">nil</span><span class="op" id="3244466">)</span><span class="op" id="3244467">,</span>&nbsp;<span class="num" id="3244469">15</span><span class="op" id="3244471">)</span><br>
<span class="lineno"></span><span class="op" id="3244473">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3244476">//&nbsp;Predefined&nbsp;because&nbsp;it&#39;s&nbsp;needed&nbsp;by&nbsp;the&nbsp;Decoder</span><br>
<span class="lineno"></span><span class="keyword" id="3244525">var</span>&nbsp;<span class="ident" id="3244529">tWireType</span>&nbsp;<span class="op" id="3244539">=</span>&nbsp;<span class="ident" id="3244541">mustGetTypeInfo</span><span class="op" id="3244556">(</span><span class="ident" id="3244557">reflect</span><span class="op" id="3244564">.</span><span class="ident" id="3244565">TypeOf</span><span class="op" id="3244571">(</span><span class="ident" id="3244572">wireType</span><span class="op" id="3244580">{</span><span class="op" id="3244581">}</span><span class="op" id="3244582">)</span><span class="op" id="3244583">)</span><span class="op" id="3244584">.</span><span class="ident" id="3244585">id</span><br>
<span class="lineno">270</span><span class="keyword" id="3244588">var</span>&nbsp;<span class="ident" id="3244592">wireTypeUserInfo</span>&nbsp;<span class="op" id="3244609">*</span><span class="ident" id="3244610">userTypeInfo</span>&nbsp;<span class="comment" id="3244623">//&nbsp;userTypeInfo&nbsp;of&nbsp;(*wireType)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3244655">func</span>&nbsp;<span class="ident" id="3244660">init</span><span class="op" id="3244664">(</span><span class="op" id="3244665">)</span>&nbsp;<span class="op" id="3244667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3244670">//&nbsp;Some&nbsp;magic&nbsp;numbers&nbsp;to&nbsp;make&nbsp;sure&nbsp;there&nbsp;are&nbsp;no&nbsp;surprises.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3244730">checkId</span><span class="op" id="3244737">(</span><span class="num" id="3244738">16</span><span class="op" id="3244740">,</span>&nbsp;<span class="ident" id="3244742">tWireType</span><span class="op" id="3244751">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3244754">checkId</span><span class="op" id="3244761">(</span><span class="num" id="3244762">17</span><span class="op" id="3244764">,</span>&nbsp;<span class="ident" id="3244766">mustGetTypeInfo</span><span class="op" id="3244781">(</span><span class="ident" id="3244782">reflect</span><span class="op" id="3244789">.</span><span class="ident" id="3244790">TypeOf</span><span class="op" id="3244796">(</span><span class="ident" id="3244797">arrayType</span><span class="op" id="3244806">{</span><span class="op" id="3244807">}</span><span class="op" id="3244808">)</span><span class="op" id="3244809">)</span><span class="op" id="3244810">.</span><span class="ident" id="3244811">id</span><span class="op" id="3244813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3244816">checkId</span><span class="op" id="3244823">(</span><span class="num" id="3244824">18</span><span class="op" id="3244826">,</span>&nbsp;<span class="ident" id="3244828">mustGetTypeInfo</span><span class="op" id="3244843">(</span><span class="ident" id="3244844">reflect</span><span class="op" id="3244851">.</span><span class="ident" id="3244852">TypeOf</span><span class="op" id="3244858">(</span><span class="ident" id="3244859">CommonType</span><span class="op" id="3244869">{</span><span class="op" id="3244870">}</span><span class="op" id="3244871">)</span><span class="op" id="3244872">)</span><span class="op" id="3244873">.</span><span class="ident" id="3244874">id</span><span class="op" id="3244876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3244879">checkId</span><span class="op" id="3244886">(</span><span class="num" id="3244887">19</span><span class="op" id="3244889">,</span>&nbsp;<span class="ident" id="3244891">mustGetTypeInfo</span><span class="op" id="3244906">(</span><span class="ident" id="3244907">reflect</span><span class="op" id="3244914">.</span><span class="ident" id="3244915">TypeOf</span><span class="op" id="3244921">(</span><span class="ident" id="3244922">sliceType</span><span class="op" id="3244931">{</span><span class="op" id="3244932">}</span><span class="op" id="3244933">)</span><span class="op" id="3244934">)</span><span class="op" id="3244935">.</span><span class="ident" id="3244936">id</span><span class="op" id="3244938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3244941">checkId</span><span class="op" id="3244948">(</span><span class="num" id="3244949">20</span><span class="op" id="3244951">,</span>&nbsp;<span class="ident" id="3244953">mustGetTypeInfo</span><span class="op" id="3244968">(</span><span class="ident" id="3244969">reflect</span><span class="op" id="3244976">.</span><span class="ident" id="3244977">TypeOf</span><span class="op" id="3244983">(</span><span class="ident" id="3244984">structType</span><span class="op" id="3244994">{</span><span class="op" id="3244995">}</span><span class="op" id="3244996">)</span><span class="op" id="3244997">)</span><span class="op" id="3244998">.</span><span class="ident" id="3244999">id</span><span class="op" id="3245001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3245004">checkId</span><span class="op" id="3245011">(</span><span class="num" id="3245012">21</span><span class="op" id="3245014">,</span>&nbsp;<span class="ident" id="3245016">mustGetTypeInfo</span><span class="op" id="3245031">(</span><span class="ident" id="3245032">reflect</span><span class="op" id="3245039">.</span><span class="ident" id="3245040">TypeOf</span><span class="op" id="3245046">(</span><span class="ident" id="3245047">fieldType</span><span class="op" id="3245056">{</span><span class="op" id="3245057">}</span><span class="op" id="3245058">)</span><span class="op" id="3245059">)</span><span class="op" id="3245060">.</span><span class="ident" id="3245061">id</span><span class="op" id="3245063">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3245066">checkId</span><span class="op" id="3245073">(</span><span class="num" id="3245074">23</span><span class="op" id="3245076">,</span>&nbsp;<span class="ident" id="3245078">mustGetTypeInfo</span><span class="op" id="3245093">(</span><span class="ident" id="3245094">reflect</span><span class="op" id="3245101">.</span><span class="ident" id="3245102">TypeOf</span><span class="op" id="3245108">(</span><span class="ident" id="3245109">mapType</span><span class="op" id="3245116">{</span><span class="op" id="3245117">}</span><span class="op" id="3245118">)</span><span class="op" id="3245119">)</span><span class="op" id="3245120">.</span><span class="ident" id="3245121">id</span><span class="op" id="3245123">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3245127">builtinIdToType</span>&nbsp;<span class="op" id="3245143">=</span>&nbsp;<span class="builtinfunc" id="3245145">make</span><span class="op" id="3245149">(</span><span class="keyword" id="3245150">map</span><span class="op" id="3245153">[</span><span class="ident" id="3245154">typeId</span><span class="op" id="3245160">]</span><span class="ident" id="3245161">gobType</span><span class="op" id="3245168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3245171">for</span>&nbsp;<span class="ident" id="3245175">k</span><span class="op" id="3245176">,</span>&nbsp;<span class="ident" id="3245178">v</span>&nbsp;<span class="op" id="3245180">:=</span>&nbsp;<span class="keyword" id="3245183">range</span>&nbsp;<span class="ident" id="3245189">idToType</span>&nbsp;<span class="op" id="3245198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3245202">builtinIdToType</span><span class="op" id="3245217">[</span><span class="ident" id="3245218">k</span><span class="op" id="3245219">]</span>&nbsp;<span class="op" id="3245221">=</span>&nbsp;<span class="ident" id="3245223">v</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3245226">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3245230">//&nbsp;Move&nbsp;the&nbsp;id&nbsp;space&nbsp;upwards&nbsp;to&nbsp;allow&nbsp;for&nbsp;growth&nbsp;in&nbsp;the&nbsp;predefined&nbsp;world</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3245304">//&nbsp;without&nbsp;breaking&nbsp;existing&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3245341">if</span>&nbsp;<span class="ident" id="3245344">nextId</span>&nbsp;<span class="op" id="3245351">&gt;</span>&nbsp;<span class="ident" id="3245353">firstUserId</span>&nbsp;<span class="op" id="3245365">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3245369">panic</span><span class="op" id="3245374">(</span><span class="ident" id="3245375">fmt</span><span class="op" id="3245378">.</span><span class="ident" id="3245379">Sprintln</span><span class="op" id="3245387">(</span><span class="string" id="3245388">&#34;nextId&nbsp;too&nbsp;large:&#34;</span><span class="op" id="3245407">,</span>&nbsp;<span class="ident" id="3245409">nextId</span><span class="op" id="3245415">)</span><span class="op" id="3245416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3245419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3245422">nextId</span>&nbsp;<span class="op" id="3245429">=</span>&nbsp;<span class="ident" id="3245431">firstUserId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3245444">registerBasics</span><span class="op" id="3245458">(</span><span class="op" id="3245459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3245462">wireTypeUserInfo</span>&nbsp;<span class="op" id="3245479">=</span>&nbsp;<span class="ident" id="3245481">userType</span><span class="op" id="3245489">(</span><span class="ident" id="3245490">reflect</span><span class="op" id="3245497">.</span><span class="ident" id="3245498">TypeOf</span><span class="op" id="3245504">(</span><span class="op" id="3245505">(</span><span class="op" id="3245506">*</span><span class="ident" id="3245507">wireType</span><span class="op" id="3245515">)</span><span class="op" id="3245516">(</span><span class="ident" id="3245517">nil</span><span class="op" id="3245520">)</span><span class="op" id="3245521">)</span><span class="op" id="3245522">)</span><br>
<span class="lineno">295</span><span class="op" id="3245524">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3245527">//&nbsp;Array&nbsp;type</span><br>
<span class="lineno"></span><span class="keyword" id="3245541">type</span>&nbsp;<span class="ident" id="3245546">arrayType</span>&nbsp;<span class="keyword" id="3245556">struct</span>&nbsp;<span class="op" id="3245563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3245566">CommonType</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3245578">Elem</span>&nbsp;<span class="ident" id="3245583">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3245591">Len</span>&nbsp;&nbsp;<span class="builtintype" id="3245596">int</span><br>
<span class="lineno"></span><span class="op" id="3245600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3245603">func</span>&nbsp;<span class="ident" id="3245608">newArrayType</span><span class="op" id="3245620">(</span><span class="ident" id="3245621">name</span>&nbsp;<span class="builtintype" id="3245626">string</span><span class="op" id="3245632">)</span>&nbsp;<span class="op" id="3245634">*</span><span class="ident" id="3245635">arrayType</span>&nbsp;<span class="op" id="3245645">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3245648">a</span>&nbsp;<span class="op" id="3245650">:=</span>&nbsp;<span class="op" id="3245653">&amp;</span><span class="ident" id="3245654">arrayType</span><span class="op" id="3245663">{</span><span class="ident" id="3245664">CommonType</span><span class="op" id="3245674">{</span><span class="ident" id="3245675">Name</span><span class="op" id="3245679">:</span>&nbsp;<span class="ident" id="3245681">name</span><span class="op" id="3245685">}</span><span class="op" id="3245686">,</span>&nbsp;<span class="num" id="3245688">0</span><span class="op" id="3245689">,</span>&nbsp;<span class="num" id="3245691">0</span><span class="op" id="3245692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3245695">return</span>&nbsp;<span class="ident" id="3245702">a</span><br>
<span class="lineno"></span><span class="op" id="3245704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3245707">func</span>&nbsp;<span class="op" id="3245712">(</span><span class="ident" id="3245713">a</span>&nbsp;<span class="op" id="3245715">*</span><span class="ident" id="3245716">arrayType</span><span class="op" id="3245725">)</span>&nbsp;<span class="ident" id="3245727">init</span><span class="op" id="3245731">(</span><span class="ident" id="3245732">elem</span>&nbsp;<span class="ident" id="3245737">gobType</span><span class="op" id="3245744">,</span>&nbsp;<span class="builtinfunc" id="3245746">len</span>&nbsp;<span class="builtintype" id="3245750">int</span><span class="op" id="3245753">)</span>&nbsp;<span class="op" id="3245755">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3245758">//&nbsp;Set&nbsp;our&nbsp;type&nbsp;id&nbsp;before&nbsp;evaluating&nbsp;the&nbsp;element&#39;s,&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;our&nbsp;own.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3245833">setTypeId</span><span class="op" id="3245842">(</span><span class="ident" id="3245843">a</span><span class="op" id="3245844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3245847">a</span><span class="op" id="3245848">.</span><span class="ident" id="3245849">Elem</span>&nbsp;<span class="op" id="3245854">=</span>&nbsp;<span class="ident" id="3245856">elem</span><span class="op" id="3245860">.</span><span class="ident" id="3245861">id</span><span class="op" id="3245863">(</span><span class="op" id="3245864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3245867">a</span><span class="op" id="3245868">.</span><span class="ident" id="3245869">Len</span>&nbsp;<span class="op" id="3245873">=</span>&nbsp;<span class="builtinfunc" id="3245875">len</span><br>
<span class="lineno"></span><span class="op" id="3245879">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="keyword" id="3245882">func</span>&nbsp;<span class="op" id="3245887">(</span><span class="ident" id="3245888">a</span>&nbsp;<span class="op" id="3245890">*</span><span class="ident" id="3245891">arrayType</span><span class="op" id="3245900">)</span>&nbsp;<span class="ident" id="3245902">safeString</span><span class="op" id="3245912">(</span><span class="ident" id="3245913">seen</span>&nbsp;<span class="keyword" id="3245918">map</span><span class="op" id="3245921">[</span><span class="ident" id="3245922">typeId</span><span class="op" id="3245928">]</span><span class="builtintype" id="3245929">bool</span><span class="op" id="3245933">)</span>&nbsp;<span class="builtintype" id="3245935">string</span>&nbsp;<span class="op" id="3245942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3245945">if</span>&nbsp;<span class="ident" id="3245948">seen</span><span class="op" id="3245952">[</span><span class="ident" id="3245953">a</span><span class="op" id="3245954">.</span><span class="ident" id="3245955">Id</span><span class="op" id="3245957">]</span>&nbsp;<span class="op" id="3245959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3245963">return</span>&nbsp;<span class="ident" id="3245970">a</span><span class="op" id="3245971">.</span><span class="ident" id="3245972">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3245978">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3245981">seen</span><span class="op" id="3245985">[</span><span class="ident" id="3245986">a</span><span class="op" id="3245987">.</span><span class="ident" id="3245988">Id</span><span class="op" id="3245990">]</span>&nbsp;<span class="op" id="3245992">=</span>&nbsp;<span class="ident" id="3245994">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3246000">return</span>&nbsp;<span class="ident" id="3246007">fmt</span><span class="op" id="3246010">.</span><span class="ident" id="3246011">Sprintf</span><span class="op" id="3246018">(</span><span class="string" id="3246019">&#34;[%d]%s&#34;</span><span class="op" id="3246027">,</span>&nbsp;<span class="ident" id="3246029">a</span><span class="op" id="3246030">.</span><span class="ident" id="3246031">Len</span><span class="op" id="3246034">,</span>&nbsp;<span class="ident" id="3246036">a</span><span class="op" id="3246037">.</span><span class="ident" id="3246038">Elem</span><span class="op" id="3246042">.</span><span class="ident" id="3246043">gobType</span><span class="op" id="3246050">(</span><span class="op" id="3246051">)</span><span class="op" id="3246052">.</span><span class="ident" id="3246053">safeString</span><span class="op" id="3246063">(</span><span class="ident" id="3246064">seen</span><span class="op" id="3246068">)</span><span class="op" id="3246069">)</span><br>
<span class="lineno"></span><span class="op" id="3246071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3246074">func</span>&nbsp;<span class="op" id="3246079">(</span><span class="ident" id="3246080">a</span>&nbsp;<span class="op" id="3246082">*</span><span class="ident" id="3246083">arrayType</span><span class="op" id="3246092">)</span>&nbsp;<span class="builtintype" id="3246094">string</span><span class="op" id="3246100">(</span><span class="op" id="3246101">)</span>&nbsp;<span class="builtintype" id="3246103">string</span>&nbsp;<span class="op" id="3246110">{</span>&nbsp;<span class="keyword" id="3246112">return</span>&nbsp;<span class="ident" id="3246119">a</span><span class="op" id="3246120">.</span><span class="ident" id="3246121">safeString</span><span class="op" id="3246131">(</span><span class="builtinfunc" id="3246132">make</span><span class="op" id="3246136">(</span><span class="keyword" id="3246137">map</span><span class="op" id="3246140">[</span><span class="ident" id="3246141">typeId</span><span class="op" id="3246147">]</span><span class="builtintype" id="3246148">bool</span><span class="op" id="3246152">)</span><span class="op" id="3246153">)</span>&nbsp;<span class="op" id="3246155">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="3246158">//&nbsp;GobEncoder&nbsp;type&nbsp;(something&nbsp;that&nbsp;implements&nbsp;the&nbsp;GobEncoder&nbsp;interface)</span><br>
<span class="lineno"></span><span class="keyword" id="3246230">type</span>&nbsp;<span class="ident" id="3246235">gobEncoderType</span>&nbsp;<span class="keyword" id="3246250">struct</span>&nbsp;<span class="op" id="3246257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3246260">CommonType</span><br>
<span class="lineno"></span><span class="op" id="3246271">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="keyword" id="3246274">func</span>&nbsp;<span class="ident" id="3246279">newGobEncoderType</span><span class="op" id="3246296">(</span><span class="ident" id="3246297">name</span>&nbsp;<span class="builtintype" id="3246302">string</span><span class="op" id="3246308">)</span>&nbsp;<span class="op" id="3246310">*</span><span class="ident" id="3246311">gobEncoderType</span>&nbsp;<span class="op" id="3246326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3246329">g</span>&nbsp;<span class="op" id="3246331">:=</span>&nbsp;<span class="op" id="3246334">&amp;</span><span class="ident" id="3246335">gobEncoderType</span><span class="op" id="3246349">{</span><span class="ident" id="3246350">CommonType</span><span class="op" id="3246360">{</span><span class="ident" id="3246361">Name</span><span class="op" id="3246365">:</span>&nbsp;<span class="ident" id="3246367">name</span><span class="op" id="3246371">}</span><span class="op" id="3246372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3246375">setTypeId</span><span class="op" id="3246384">(</span><span class="ident" id="3246385">g</span><span class="op" id="3246386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3246389">return</span>&nbsp;<span class="ident" id="3246396">g</span><br>
<span class="lineno">335</span><span class="op" id="3246398">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3246401">func</span>&nbsp;<span class="op" id="3246406">(</span><span class="ident" id="3246407">g</span>&nbsp;<span class="op" id="3246409">*</span><span class="ident" id="3246410">gobEncoderType</span><span class="op" id="3246424">)</span>&nbsp;<span class="ident" id="3246426">safeString</span><span class="op" id="3246436">(</span><span class="ident" id="3246437">seen</span>&nbsp;<span class="keyword" id="3246442">map</span><span class="op" id="3246445">[</span><span class="ident" id="3246446">typeId</span><span class="op" id="3246452">]</span><span class="builtintype" id="3246453">bool</span><span class="op" id="3246457">)</span>&nbsp;<span class="builtintype" id="3246459">string</span>&nbsp;<span class="op" id="3246466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3246469">return</span>&nbsp;<span class="ident" id="3246476">g</span><span class="op" id="3246477">.</span><span class="ident" id="3246478">Name</span><br>
<span class="lineno"></span><span class="op" id="3246483">}</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span><span class="keyword" id="3246486">func</span>&nbsp;<span class="op" id="3246491">(</span><span class="ident" id="3246492">g</span>&nbsp;<span class="op" id="3246494">*</span><span class="ident" id="3246495">gobEncoderType</span><span class="op" id="3246509">)</span>&nbsp;<span class="builtintype" id="3246511">string</span><span class="op" id="3246517">(</span><span class="op" id="3246518">)</span>&nbsp;<span class="builtintype" id="3246520">string</span>&nbsp;<span class="op" id="3246527">{</span>&nbsp;<span class="keyword" id="3246529">return</span>&nbsp;<span class="ident" id="3246536">g</span><span class="op" id="3246537">.</span><span class="ident" id="3246538">Name</span>&nbsp;<span class="op" id="3246543">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3246546">//&nbsp;Map&nbsp;type</span><br>
<span class="lineno"></span><span class="keyword" id="3246558">type</span>&nbsp;<span class="ident" id="3246563">mapType</span>&nbsp;<span class="keyword" id="3246571">struct</span>&nbsp;<span class="op" id="3246578">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3246581">CommonType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3246593">Key</span>&nbsp;&nbsp;<span class="ident" id="3246598">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3246606">Elem</span>&nbsp;<span class="ident" id="3246611">typeId</span><br>
<span class="lineno"></span><span class="op" id="3246618">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span><span class="keyword" id="3246621">func</span>&nbsp;<span class="ident" id="3246626">newMapType</span><span class="op" id="3246636">(</span><span class="ident" id="3246637">name</span>&nbsp;<span class="builtintype" id="3246642">string</span><span class="op" id="3246648">)</span>&nbsp;<span class="op" id="3246650">*</span><span class="ident" id="3246651">mapType</span>&nbsp;<span class="op" id="3246659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3246662">m</span>&nbsp;<span class="op" id="3246664">:=</span>&nbsp;<span class="op" id="3246667">&amp;</span><span class="ident" id="3246668">mapType</span><span class="op" id="3246675">{</span><span class="ident" id="3246676">CommonType</span><span class="op" id="3246686">{</span><span class="ident" id="3246687">Name</span><span class="op" id="3246691">:</span>&nbsp;<span class="ident" id="3246693">name</span><span class="op" id="3246697">}</span><span class="op" id="3246698">,</span>&nbsp;<span class="num" id="3246700">0</span><span class="op" id="3246701">,</span>&nbsp;<span class="num" id="3246703">0</span><span class="op" id="3246704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3246707">return</span>&nbsp;<span class="ident" id="3246714">m</span><br>
<span class="lineno"></span><span class="op" id="3246716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="keyword" id="3246719">func</span>&nbsp;<span class="op" id="3246724">(</span><span class="ident" id="3246725">m</span>&nbsp;<span class="op" id="3246727">*</span><span class="ident" id="3246728">mapType</span><span class="op" id="3246735">)</span>&nbsp;<span class="ident" id="3246737">init</span><span class="op" id="3246741">(</span><span class="ident" id="3246742">key</span><span class="op" id="3246745">,</span>&nbsp;<span class="ident" id="3246747">elem</span>&nbsp;<span class="ident" id="3246752">gobType</span><span class="op" id="3246759">)</span>&nbsp;<span class="op" id="3246761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3246764">//&nbsp;Set&nbsp;our&nbsp;type&nbsp;id&nbsp;before&nbsp;evaluating&nbsp;the&nbsp;element&#39;s,&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;our&nbsp;own.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3246839">setTypeId</span><span class="op" id="3246848">(</span><span class="ident" id="3246849">m</span><span class="op" id="3246850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3246853">m</span><span class="op" id="3246854">.</span><span class="ident" id="3246855">Key</span>&nbsp;<span class="op" id="3246859">=</span>&nbsp;<span class="ident" id="3246861">key</span><span class="op" id="3246864">.</span><span class="ident" id="3246865">id</span><span class="op" id="3246867">(</span><span class="op" id="3246868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3246871">m</span><span class="op" id="3246872">.</span><span class="ident" id="3246873">Elem</span>&nbsp;<span class="op" id="3246878">=</span>&nbsp;<span class="ident" id="3246880">elem</span><span class="op" id="3246884">.</span><span class="ident" id="3246885">id</span><span class="op" id="3246887">(</span><span class="op" id="3246888">)</span><br>
<span class="lineno">360</span><span class="op" id="3246890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3246893">func</span>&nbsp;<span class="op" id="3246898">(</span><span class="ident" id="3246899">m</span>&nbsp;<span class="op" id="3246901">*</span><span class="ident" id="3246902">mapType</span><span class="op" id="3246909">)</span>&nbsp;<span class="ident" id="3246911">safeString</span><span class="op" id="3246921">(</span><span class="ident" id="3246922">seen</span>&nbsp;<span class="keyword" id="3246927">map</span><span class="op" id="3246930">[</span><span class="ident" id="3246931">typeId</span><span class="op" id="3246937">]</span><span class="builtintype" id="3246938">bool</span><span class="op" id="3246942">)</span>&nbsp;<span class="builtintype" id="3246944">string</span>&nbsp;<span class="op" id="3246951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3246954">if</span>&nbsp;<span class="ident" id="3246957">seen</span><span class="op" id="3246961">[</span><span class="ident" id="3246962">m</span><span class="op" id="3246963">.</span><span class="ident" id="3246964">Id</span><span class="op" id="3246966">]</span>&nbsp;<span class="op" id="3246968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3246972">return</span>&nbsp;<span class="ident" id="3246979">m</span><span class="op" id="3246980">.</span><span class="ident" id="3246981">Name</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3246987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3246990">seen</span><span class="op" id="3246994">[</span><span class="ident" id="3246995">m</span><span class="op" id="3246996">.</span><span class="ident" id="3246997">Id</span><span class="op" id="3246999">]</span>&nbsp;<span class="op" id="3247001">=</span>&nbsp;<span class="ident" id="3247003">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3247009">key</span>&nbsp;<span class="op" id="3247013">:=</span>&nbsp;<span class="ident" id="3247016">m</span><span class="op" id="3247017">.</span><span class="ident" id="3247018">Key</span><span class="op" id="3247021">.</span><span class="ident" id="3247022">gobType</span><span class="op" id="3247029">(</span><span class="op" id="3247030">)</span><span class="op" id="3247031">.</span><span class="ident" id="3247032">safeString</span><span class="op" id="3247042">(</span><span class="ident" id="3247043">seen</span><span class="op" id="3247047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3247050">elem</span>&nbsp;<span class="op" id="3247055">:=</span>&nbsp;<span class="ident" id="3247058">m</span><span class="op" id="3247059">.</span><span class="ident" id="3247060">Elem</span><span class="op" id="3247064">.</span><span class="ident" id="3247065">gobType</span><span class="op" id="3247072">(</span><span class="op" id="3247073">)</span><span class="op" id="3247074">.</span><span class="ident" id="3247075">safeString</span><span class="op" id="3247085">(</span><span class="ident" id="3247086">seen</span><span class="op" id="3247090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3247093">return</span>&nbsp;<span class="ident" id="3247100">fmt</span><span class="op" id="3247103">.</span><span class="ident" id="3247104">Sprintf</span><span class="op" id="3247111">(</span><span class="string" id="3247112">&#34;map[%s]%s&#34;</span><span class="op" id="3247123">,</span>&nbsp;<span class="ident" id="3247125">key</span><span class="op" id="3247128">,</span>&nbsp;<span class="ident" id="3247130">elem</span><span class="op" id="3247134">)</span><br>
<span class="lineno">370</span><span class="op" id="3247136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3247139">func</span>&nbsp;<span class="op" id="3247144">(</span><span class="ident" id="3247145">m</span>&nbsp;<span class="op" id="3247147">*</span><span class="ident" id="3247148">mapType</span><span class="op" id="3247155">)</span>&nbsp;<span class="builtintype" id="3247157">string</span><span class="op" id="3247163">(</span><span class="op" id="3247164">)</span>&nbsp;<span class="builtintype" id="3247166">string</span>&nbsp;<span class="op" id="3247173">{</span>&nbsp;<span class="keyword" id="3247175">return</span>&nbsp;<span class="ident" id="3247182">m</span><span class="op" id="3247183">.</span><span class="ident" id="3247184">safeString</span><span class="op" id="3247194">(</span><span class="builtinfunc" id="3247195">make</span><span class="op" id="3247199">(</span><span class="keyword" id="3247200">map</span><span class="op" id="3247203">[</span><span class="ident" id="3247204">typeId</span><span class="op" id="3247210">]</span><span class="builtintype" id="3247211">bool</span><span class="op" id="3247215">)</span><span class="op" id="3247216">)</span>&nbsp;<span class="op" id="3247218">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3247221">//&nbsp;Slice&nbsp;type</span><br>
<span class="lineno">375</span><span class="keyword" id="3247235">type</span>&nbsp;<span class="ident" id="3247240">sliceType</span>&nbsp;<span class="keyword" id="3247250">struct</span>&nbsp;<span class="op" id="3247257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3247260">CommonType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3247272">Elem</span>&nbsp;<span class="ident" id="3247277">typeId</span><br>
<span class="lineno"></span><span class="op" id="3247284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span><span class="keyword" id="3247287">func</span>&nbsp;<span class="ident" id="3247292">newSliceType</span><span class="op" id="3247304">(</span><span class="ident" id="3247305">name</span>&nbsp;<span class="builtintype" id="3247310">string</span><span class="op" id="3247316">)</span>&nbsp;<span class="op" id="3247318">*</span><span class="ident" id="3247319">sliceType</span>&nbsp;<span class="op" id="3247329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3247332">s</span>&nbsp;<span class="op" id="3247334">:=</span>&nbsp;<span class="op" id="3247337">&amp;</span><span class="ident" id="3247338">sliceType</span><span class="op" id="3247347">{</span><span class="ident" id="3247348">CommonType</span><span class="op" id="3247358">{</span><span class="ident" id="3247359">Name</span><span class="op" id="3247363">:</span>&nbsp;<span class="ident" id="3247365">name</span><span class="op" id="3247369">}</span><span class="op" id="3247370">,</span>&nbsp;<span class="num" id="3247372">0</span><span class="op" id="3247373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3247376">return</span>&nbsp;<span class="ident" id="3247383">s</span><br>
<span class="lineno"></span><span class="op" id="3247385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="keyword" id="3247388">func</span>&nbsp;<span class="op" id="3247393">(</span><span class="ident" id="3247394">s</span>&nbsp;<span class="op" id="3247396">*</span><span class="ident" id="3247397">sliceType</span><span class="op" id="3247406">)</span>&nbsp;<span class="ident" id="3247408">init</span><span class="op" id="3247412">(</span><span class="ident" id="3247413">elem</span>&nbsp;<span class="ident" id="3247418">gobType</span><span class="op" id="3247425">)</span>&nbsp;<span class="op" id="3247427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3247430">//&nbsp;Set&nbsp;our&nbsp;type&nbsp;id&nbsp;before&nbsp;evaluating&nbsp;the&nbsp;element&#39;s,&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;our&nbsp;own.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3247505">setTypeId</span><span class="op" id="3247514">(</span><span class="ident" id="3247515">s</span><span class="op" id="3247516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3247519">//&nbsp;See&nbsp;the&nbsp;comments&nbsp;about&nbsp;ids&nbsp;in&nbsp;newTypeObject.&nbsp;Only&nbsp;slices&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3247584">//&nbsp;structs&nbsp;have&nbsp;mutual&nbsp;recursion.</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3247619">if</span>&nbsp;<span class="ident" id="3247622">elem</span><span class="op" id="3247626">.</span><span class="ident" id="3247627">id</span><span class="op" id="3247629">(</span><span class="op" id="3247630">)</span>&nbsp;<span class="op" id="3247632">==</span>&nbsp;<span class="num" id="3247635">0</span>&nbsp;<span class="op" id="3247637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3247641">setTypeId</span><span class="op" id="3247650">(</span><span class="ident" id="3247651">elem</span><span class="op" id="3247655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3247658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3247661">s</span><span class="op" id="3247662">.</span><span class="ident" id="3247663">Elem</span>&nbsp;<span class="op" id="3247668">=</span>&nbsp;<span class="ident" id="3247670">elem</span><span class="op" id="3247674">.</span><span class="ident" id="3247675">id</span><span class="op" id="3247677">(</span><span class="op" id="3247678">)</span><br>
<span class="lineno"></span><span class="op" id="3247680">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="keyword" id="3247683">func</span>&nbsp;<span class="op" id="3247688">(</span><span class="ident" id="3247689">s</span>&nbsp;<span class="op" id="3247691">*</span><span class="ident" id="3247692">sliceType</span><span class="op" id="3247701">)</span>&nbsp;<span class="ident" id="3247703">safeString</span><span class="op" id="3247713">(</span><span class="ident" id="3247714">seen</span>&nbsp;<span class="keyword" id="3247719">map</span><span class="op" id="3247722">[</span><span class="ident" id="3247723">typeId</span><span class="op" id="3247729">]</span><span class="builtintype" id="3247730">bool</span><span class="op" id="3247734">)</span>&nbsp;<span class="builtintype" id="3247736">string</span>&nbsp;<span class="op" id="3247743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3247746">if</span>&nbsp;<span class="ident" id="3247749">seen</span><span class="op" id="3247753">[</span><span class="ident" id="3247754">s</span><span class="op" id="3247755">.</span><span class="ident" id="3247756">Id</span><span class="op" id="3247758">]</span>&nbsp;<span class="op" id="3247760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3247764">return</span>&nbsp;<span class="ident" id="3247771">s</span><span class="op" id="3247772">.</span><span class="ident" id="3247773">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3247779">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3247782">seen</span><span class="op" id="3247786">[</span><span class="ident" id="3247787">s</span><span class="op" id="3247788">.</span><span class="ident" id="3247789">Id</span><span class="op" id="3247791">]</span>&nbsp;<span class="op" id="3247793">=</span>&nbsp;<span class="ident" id="3247795">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3247801">return</span>&nbsp;<span class="ident" id="3247808">fmt</span><span class="op" id="3247811">.</span><span class="ident" id="3247812">Sprintf</span><span class="op" id="3247819">(</span><span class="string" id="3247820">&#34;[]%s&#34;</span><span class="op" id="3247826">,</span>&nbsp;<span class="ident" id="3247828">s</span><span class="op" id="3247829">.</span><span class="ident" id="3247830">Elem</span><span class="op" id="3247834">.</span><span class="ident" id="3247835">gobType</span><span class="op" id="3247842">(</span><span class="op" id="3247843">)</span><span class="op" id="3247844">.</span><span class="ident" id="3247845">safeString</span><span class="op" id="3247855">(</span><span class="ident" id="3247856">seen</span><span class="op" id="3247860">)</span><span class="op" id="3247861">)</span><br>
<span class="lineno"></span><span class="op" id="3247863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3247866">func</span>&nbsp;<span class="op" id="3247871">(</span><span class="ident" id="3247872">s</span>&nbsp;<span class="op" id="3247874">*</span><span class="ident" id="3247875">sliceType</span><span class="op" id="3247884">)</span>&nbsp;<span class="builtintype" id="3247886">string</span><span class="op" id="3247892">(</span><span class="op" id="3247893">)</span>&nbsp;<span class="builtintype" id="3247895">string</span>&nbsp;<span class="op" id="3247902">{</span>&nbsp;<span class="keyword" id="3247904">return</span>&nbsp;<span class="ident" id="3247911">s</span><span class="op" id="3247912">.</span><span class="ident" id="3247913">safeString</span><span class="op" id="3247923">(</span><span class="builtinfunc" id="3247924">make</span><span class="op" id="3247928">(</span><span class="keyword" id="3247929">map</span><span class="op" id="3247932">[</span><span class="ident" id="3247933">typeId</span><span class="op" id="3247939">]</span><span class="builtintype" id="3247940">bool</span><span class="op" id="3247944">)</span><span class="op" id="3247945">)</span>&nbsp;<span class="op" id="3247947">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="comment" id="3247950">//&nbsp;Struct&nbsp;type</span><br>
<span class="lineno"></span><span class="keyword" id="3247965">type</span>&nbsp;<span class="ident" id="3247970">fieldType</span>&nbsp;<span class="keyword" id="3247980">struct</span>&nbsp;<span class="op" id="3247987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3247990">Name</span>&nbsp;<span class="builtintype" id="3247995">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3248003">Id</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3248008">typeId</span><br>
<span class="lineno">410</span><span class="op" id="3248015">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3248018">type</span>&nbsp;<span class="ident" id="3248023">structType</span>&nbsp;<span class="keyword" id="3248034">struct</span>&nbsp;<span class="op" id="3248041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3248044">CommonType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3248056">Field</span>&nbsp;<span class="op" id="3248062">[</span><span class="op" id="3248063">]</span><span class="op" id="3248064">*</span><span class="ident" id="3248065">fieldType</span><br>
<span class="lineno">415</span><span class="op" id="3248075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3248078">func</span>&nbsp;<span class="op" id="3248083">(</span><span class="ident" id="3248084">s</span>&nbsp;<span class="op" id="3248086">*</span><span class="ident" id="3248087">structType</span><span class="op" id="3248097">)</span>&nbsp;<span class="ident" id="3248099">safeString</span><span class="op" id="3248109">(</span><span class="ident" id="3248110">seen</span>&nbsp;<span class="keyword" id="3248115">map</span><span class="op" id="3248118">[</span><span class="ident" id="3248119">typeId</span><span class="op" id="3248125">]</span><span class="builtintype" id="3248126">bool</span><span class="op" id="3248130">)</span>&nbsp;<span class="builtintype" id="3248132">string</span>&nbsp;<span class="op" id="3248139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3248142">if</span>&nbsp;<span class="ident" id="3248145">s</span>&nbsp;<span class="op" id="3248147">==</span>&nbsp;<span class="ident" id="3248150">nil</span>&nbsp;<span class="op" id="3248154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3248158">return</span>&nbsp;<span class="string" id="3248165">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3248174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3248177">if</span>&nbsp;<span class="ident" id="3248180">_</span><span class="op" id="3248181">,</span>&nbsp;<span class="ident" id="3248183">ok</span>&nbsp;<span class="op" id="3248186">:=</span>&nbsp;<span class="ident" id="3248189">seen</span><span class="op" id="3248193">[</span><span class="ident" id="3248194">s</span><span class="op" id="3248195">.</span><span class="ident" id="3248196">Id</span><span class="op" id="3248198">]</span><span class="op" id="3248199">;</span>&nbsp;<span class="ident" id="3248201">ok</span>&nbsp;<span class="op" id="3248204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3248208">return</span>&nbsp;<span class="ident" id="3248215">s</span><span class="op" id="3248216">.</span><span class="ident" id="3248217">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3248223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3248226">seen</span><span class="op" id="3248230">[</span><span class="ident" id="3248231">s</span><span class="op" id="3248232">.</span><span class="ident" id="3248233">Id</span><span class="op" id="3248235">]</span>&nbsp;<span class="op" id="3248237">=</span>&nbsp;<span class="ident" id="3248239">true</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3248245">str</span>&nbsp;<span class="op" id="3248249">:=</span>&nbsp;<span class="ident" id="3248252">s</span><span class="op" id="3248253">.</span><span class="ident" id="3248254">Name</span>&nbsp;<span class="op" id="3248259">+</span>&nbsp;<span class="string" id="3248261">&#34;&nbsp;=&nbsp;struct&nbsp;{&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3248277">for</span>&nbsp;<span class="ident" id="3248281">_</span><span class="op" id="3248282">,</span>&nbsp;<span class="ident" id="3248284">f</span>&nbsp;<span class="op" id="3248286">:=</span>&nbsp;<span class="keyword" id="3248289">range</span>&nbsp;<span class="ident" id="3248295">s</span><span class="op" id="3248296">.</span><span class="ident" id="3248297">Field</span>&nbsp;<span class="op" id="3248303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3248307">str</span>&nbsp;<span class="op" id="3248311">+=</span>&nbsp;<span class="ident" id="3248314">fmt</span><span class="op" id="3248317">.</span><span class="ident" id="3248318">Sprintf</span><span class="op" id="3248325">(</span><span class="string" id="3248326">&#34;%s&nbsp;%s;&nbsp;&#34;</span><span class="op" id="3248335">,</span>&nbsp;<span class="ident" id="3248337">f</span><span class="op" id="3248338">.</span><span class="ident" id="3248339">Name</span><span class="op" id="3248343">,</span>&nbsp;<span class="ident" id="3248345">f</span><span class="op" id="3248346">.</span><span class="ident" id="3248347">Id</span><span class="op" id="3248349">.</span><span class="ident" id="3248350">gobType</span><span class="op" id="3248357">(</span><span class="op" id="3248358">)</span><span class="op" id="3248359">.</span><span class="ident" id="3248360">safeString</span><span class="op" id="3248370">(</span><span class="ident" id="3248371">seen</span><span class="op" id="3248375">)</span><span class="op" id="3248376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3248379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3248382">str</span>&nbsp;<span class="op" id="3248386">+=</span>&nbsp;<span class="string" id="3248389">&#34;}&#34;</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3248394">return</span>&nbsp;<span class="ident" id="3248401">str</span><br>
<span class="lineno"></span><span class="op" id="3248405">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3248408">func</span>&nbsp;<span class="op" id="3248413">(</span><span class="ident" id="3248414">s</span>&nbsp;<span class="op" id="3248416">*</span><span class="ident" id="3248417">structType</span><span class="op" id="3248427">)</span>&nbsp;<span class="builtintype" id="3248429">string</span><span class="op" id="3248435">(</span><span class="op" id="3248436">)</span>&nbsp;<span class="builtintype" id="3248438">string</span>&nbsp;<span class="op" id="3248445">{</span>&nbsp;<span class="keyword" id="3248447">return</span>&nbsp;<span class="ident" id="3248454">s</span><span class="op" id="3248455">.</span><span class="ident" id="3248456">safeString</span><span class="op" id="3248466">(</span><span class="builtinfunc" id="3248467">make</span><span class="op" id="3248471">(</span><span class="keyword" id="3248472">map</span><span class="op" id="3248475">[</span><span class="ident" id="3248476">typeId</span><span class="op" id="3248482">]</span><span class="builtintype" id="3248483">bool</span><span class="op" id="3248487">)</span><span class="op" id="3248488">)</span>&nbsp;<span class="op" id="3248490">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="keyword" id="3248493">func</span>&nbsp;<span class="ident" id="3248498">newStructType</span><span class="op" id="3248511">(</span><span class="ident" id="3248512">name</span>&nbsp;<span class="builtintype" id="3248517">string</span><span class="op" id="3248523">)</span>&nbsp;<span class="op" id="3248525">*</span><span class="ident" id="3248526">structType</span>&nbsp;<span class="op" id="3248537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3248540">s</span>&nbsp;<span class="op" id="3248542">:=</span>&nbsp;<span class="op" id="3248545">&amp;</span><span class="ident" id="3248546">structType</span><span class="op" id="3248556">{</span><span class="ident" id="3248557">CommonType</span><span class="op" id="3248567">{</span><span class="ident" id="3248568">Name</span><span class="op" id="3248572">:</span>&nbsp;<span class="ident" id="3248574">name</span><span class="op" id="3248578">}</span><span class="op" id="3248579">,</span>&nbsp;<span class="ident" id="3248581">nil</span><span class="op" id="3248584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3248587">//&nbsp;For&nbsp;historical&nbsp;reasons&nbsp;we&nbsp;set&nbsp;the&nbsp;id&nbsp;here&nbsp;rather&nbsp;than&nbsp;init.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3248651">//&nbsp;See&nbsp;the&nbsp;comment&nbsp;in&nbsp;newTypeObject&nbsp;for&nbsp;details.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3248701">setTypeId</span><span class="op" id="3248710">(</span><span class="ident" id="3248711">s</span><span class="op" id="3248712">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3248715">return</span>&nbsp;<span class="ident" id="3248722">s</span><br>
<span class="lineno"></span><span class="op" id="3248724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3248727">//&nbsp;newTypeObject&nbsp;allocates&nbsp;a&nbsp;gobType&nbsp;for&nbsp;the&nbsp;reflection&nbsp;type&nbsp;rt.</span><br>
<span class="lineno"></span><span class="comment" id="3248792">//&nbsp;Unless&nbsp;ut&nbsp;represents&nbsp;a&nbsp;GobEncoder,&nbsp;rt&nbsp;should&nbsp;be&nbsp;the&nbsp;base&nbsp;type</span><br>
<span class="lineno">445</span><span class="comment" id="3248857">//&nbsp;of&nbsp;ut.</span><br>
<span class="lineno"></span><span class="comment" id="3248867">//&nbsp;This&nbsp;is&nbsp;only&nbsp;called&nbsp;from&nbsp;the&nbsp;encoding&nbsp;side.&nbsp;The&nbsp;decoding&nbsp;side</span><br>
<span class="lineno"></span><span class="comment" id="3248932">//&nbsp;works&nbsp;through&nbsp;typeIds&nbsp;and&nbsp;userTypeInfos&nbsp;alone.</span><br>
<span class="lineno"></span><span class="keyword" id="3248982">func</span>&nbsp;<span class="ident" id="3248987">newTypeObject</span><span class="op" id="3249000">(</span><span class="ident" id="3249001">name</span>&nbsp;<span class="builtintype" id="3249006">string</span><span class="op" id="3249012">,</span>&nbsp;<span class="ident" id="3249014">ut</span>&nbsp;<span class="op" id="3249017">*</span><span class="ident" id="3249018">userTypeInfo</span><span class="op" id="3249030">,</span>&nbsp;<span class="ident" id="3249032">rt</span>&nbsp;<span class="ident" id="3249035">reflect</span><span class="op" id="3249042">.</span><span class="ident" id="3249043">Type</span><span class="op" id="3249047">)</span>&nbsp;<span class="op" id="3249049">(</span><span class="ident" id="3249050">gobType</span><span class="op" id="3249057">,</span>&nbsp;<span class="builtintype" id="3249059">error</span><span class="op" id="3249064">)</span>&nbsp;<span class="op" id="3249066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3249069">//&nbsp;Does&nbsp;this&nbsp;type&nbsp;implement&nbsp;GobEncoder?</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3249110">if</span>&nbsp;<span class="ident" id="3249113">ut</span><span class="op" id="3249115">.</span><span class="ident" id="3249116">externalEnc</span>&nbsp;<span class="op" id="3249128">!=</span>&nbsp;<span class="num" id="3249131">0</span>&nbsp;<span class="op" id="3249133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3249137">return</span>&nbsp;<span class="ident" id="3249144">newGobEncoderType</span><span class="op" id="3249161">(</span><span class="ident" id="3249162">name</span><span class="op" id="3249166">)</span><span class="op" id="3249167">,</span>&nbsp;<span class="ident" id="3249169">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3249174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3249177">var</span>&nbsp;<span class="ident" id="3249181">err</span>&nbsp;<span class="builtintype" id="3249185">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3249192">var</span>&nbsp;<span class="ident" id="3249196">type0</span><span class="op" id="3249201">,</span>&nbsp;<span class="ident" id="3249203">type1</span>&nbsp;<span class="ident" id="3249209">gobType</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3249218">defer</span>&nbsp;<span class="keyword" id="3249224">func</span><span class="op" id="3249228">(</span><span class="op" id="3249229">)</span>&nbsp;<span class="op" id="3249231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3249235">if</span>&nbsp;<span class="ident" id="3249238">err</span>&nbsp;<span class="op" id="3249242">!=</span>&nbsp;<span class="ident" id="3249245">nil</span>&nbsp;<span class="op" id="3249249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3249254">delete</span><span class="op" id="3249260">(</span><span class="ident" id="3249261">types</span><span class="op" id="3249266">,</span>&nbsp;<span class="ident" id="3249268">rt</span><span class="op" id="3249270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3249274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3249277">}</span><span class="op" id="3249278">(</span><span class="op" id="3249279">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3249282">//&nbsp;Install&nbsp;the&nbsp;top-level&nbsp;type&nbsp;before&nbsp;the&nbsp;subtypes&nbsp;(e.g.&nbsp;struct&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3249353">//&nbsp;fields)&nbsp;so&nbsp;recursive&nbsp;types&nbsp;can&nbsp;be&nbsp;constructed&nbsp;safely.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3249411">switch</span>&nbsp;<span class="ident" id="3249418">t</span>&nbsp;<span class="op" id="3249420">:=</span>&nbsp;<span class="ident" id="3249423">rt</span><span class="op" id="3249425">;</span>&nbsp;<span class="ident" id="3249427">t</span><span class="op" id="3249428">.</span><span class="ident" id="3249429">Kind</span><span class="op" id="3249433">(</span><span class="op" id="3249434">)</span>&nbsp;<span class="op" id="3249436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3249439">//&nbsp;All&nbsp;basic&nbsp;types&nbsp;are&nbsp;easy:&nbsp;they&nbsp;are&nbsp;predefined.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3249490">case</span>&nbsp;<span class="ident" id="3249495">reflect</span><span class="op" id="3249502">.</span><span class="ident" id="3249503">Bool</span><span class="op" id="3249507">:</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3249511">return</span>&nbsp;<span class="ident" id="3249518">tBool</span><span class="op" id="3249523">.</span><span class="ident" id="3249524">gobType</span><span class="op" id="3249531">(</span><span class="op" id="3249532">)</span><span class="op" id="3249533">,</span>&nbsp;<span class="ident" id="3249535">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3249541">case</span>&nbsp;<span class="ident" id="3249546">reflect</span><span class="op" id="3249553">.</span><span class="ident" id="3249554">Int</span><span class="op" id="3249557">,</span>&nbsp;<span class="ident" id="3249559">reflect</span><span class="op" id="3249566">.</span><span class="ident" id="3249567">Int8</span><span class="op" id="3249571">,</span>&nbsp;<span class="ident" id="3249573">reflect</span><span class="op" id="3249580">.</span><span class="ident" id="3249581">Int16</span><span class="op" id="3249586">,</span>&nbsp;<span class="ident" id="3249588">reflect</span><span class="op" id="3249595">.</span><span class="ident" id="3249596">Int32</span><span class="op" id="3249601">,</span>&nbsp;<span class="ident" id="3249603">reflect</span><span class="op" id="3249610">.</span><span class="ident" id="3249611">Int64</span><span class="op" id="3249616">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3249620">return</span>&nbsp;<span class="ident" id="3249627">tInt</span><span class="op" id="3249631">.</span><span class="ident" id="3249632">gobType</span><span class="op" id="3249639">(</span><span class="op" id="3249640">)</span><span class="op" id="3249641">,</span>&nbsp;<span class="ident" id="3249643">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3249649">case</span>&nbsp;<span class="ident" id="3249654">reflect</span><span class="op" id="3249661">.</span><span class="ident" id="3249662">Uint</span><span class="op" id="3249666">,</span>&nbsp;<span class="ident" id="3249668">reflect</span><span class="op" id="3249675">.</span><span class="ident" id="3249676">Uint8</span><span class="op" id="3249681">,</span>&nbsp;<span class="ident" id="3249683">reflect</span><span class="op" id="3249690">.</span><span class="ident" id="3249691">Uint16</span><span class="op" id="3249697">,</span>&nbsp;<span class="ident" id="3249699">reflect</span><span class="op" id="3249706">.</span><span class="ident" id="3249707">Uint32</span><span class="op" id="3249713">,</span>&nbsp;<span class="ident" id="3249715">reflect</span><span class="op" id="3249722">.</span><span class="ident" id="3249723">Uint64</span><span class="op" id="3249729">,</span>&nbsp;<span class="ident" id="3249731">reflect</span><span class="op" id="3249738">.</span><span class="ident" id="3249739">Uintptr</span><span class="op" id="3249746">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3249750">return</span>&nbsp;<span class="ident" id="3249757">tUint</span><span class="op" id="3249762">.</span><span class="ident" id="3249763">gobType</span><span class="op" id="3249770">(</span><span class="op" id="3249771">)</span><span class="op" id="3249772">,</span>&nbsp;<span class="ident" id="3249774">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3249780">case</span>&nbsp;<span class="ident" id="3249785">reflect</span><span class="op" id="3249792">.</span><span class="ident" id="3249793">Float32</span><span class="op" id="3249800">,</span>&nbsp;<span class="ident" id="3249802">reflect</span><span class="op" id="3249809">.</span><span class="ident" id="3249810">Float64</span><span class="op" id="3249817">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3249821">return</span>&nbsp;<span class="ident" id="3249828">tFloat</span><span class="op" id="3249834">.</span><span class="ident" id="3249835">gobType</span><span class="op" id="3249842">(</span><span class="op" id="3249843">)</span><span class="op" id="3249844">,</span>&nbsp;<span class="ident" id="3249846">nil</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3249852">case</span>&nbsp;<span class="ident" id="3249857">reflect</span><span class="op" id="3249864">.</span><span class="ident" id="3249865">Complex64</span><span class="op" id="3249874">,</span>&nbsp;<span class="ident" id="3249876">reflect</span><span class="op" id="3249883">.</span><span class="ident" id="3249884">Complex128</span><span class="op" id="3249894">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3249898">return</span>&nbsp;<span class="ident" id="3249905">tComplex</span><span class="op" id="3249913">.</span><span class="ident" id="3249914">gobType</span><span class="op" id="3249921">(</span><span class="op" id="3249922">)</span><span class="op" id="3249923">,</span>&nbsp;<span class="ident" id="3249925">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3249931">case</span>&nbsp;<span class="ident" id="3249936">reflect</span><span class="op" id="3249943">.</span><span class="ident" id="3249944">String</span><span class="op" id="3249950">:</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3249954">return</span>&nbsp;<span class="ident" id="3249961">tString</span><span class="op" id="3249968">.</span><span class="ident" id="3249969">gobType</span><span class="op" id="3249976">(</span><span class="op" id="3249977">)</span><span class="op" id="3249978">,</span>&nbsp;<span class="ident" id="3249980">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3249986">case</span>&nbsp;<span class="ident" id="3249991">reflect</span><span class="op" id="3249998">.</span><span class="ident" id="3249999">Interface</span><span class="op" id="3250008">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3250012">return</span>&nbsp;<span class="ident" id="3250019">tInterface</span><span class="op" id="3250029">.</span><span class="ident" id="3250030">gobType</span><span class="op" id="3250037">(</span><span class="op" id="3250038">)</span><span class="op" id="3250039">,</span>&nbsp;<span class="ident" id="3250041">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3250047">case</span>&nbsp;<span class="ident" id="3250052">reflect</span><span class="op" id="3250059">.</span><span class="ident" id="3250060">Array</span><span class="op" id="3250065">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3250069">at</span>&nbsp;<span class="op" id="3250072">:=</span>&nbsp;<span class="ident" id="3250075">newArrayType</span><span class="op" id="3250087">(</span><span class="ident" id="3250088">name</span><span class="op" id="3250092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3250096">types</span><span class="op" id="3250101">[</span><span class="ident" id="3250102">rt</span><span class="op" id="3250104">]</span>&nbsp;<span class="op" id="3250106">=</span>&nbsp;<span class="ident" id="3250108">at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3250113">type0</span><span class="op" id="3250118">,</span>&nbsp;<span class="ident" id="3250120">err</span>&nbsp;<span class="op" id="3250124">=</span>&nbsp;<span class="ident" id="3250126">getBaseType</span><span class="op" id="3250137">(</span><span class="string" id="3250138">&#34;&#34;</span><span class="op" id="3250140">,</span>&nbsp;<span class="ident" id="3250142">t</span><span class="op" id="3250143">.</span><span class="ident" id="3250144">Elem</span><span class="op" id="3250148">(</span><span class="op" id="3250149">)</span><span class="op" id="3250150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3250154">if</span>&nbsp;<span class="ident" id="3250157">err</span>&nbsp;<span class="op" id="3250161">!=</span>&nbsp;<span class="ident" id="3250164">nil</span>&nbsp;<span class="op" id="3250168">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3250173">return</span>&nbsp;<span class="ident" id="3250180">nil</span><span class="op" id="3250183">,</span>&nbsp;<span class="ident" id="3250185">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3250191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3250195">//&nbsp;Historical&nbsp;aside:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3250218">//&nbsp;For&nbsp;arrays,&nbsp;maps,&nbsp;and&nbsp;slices,&nbsp;we&nbsp;set&nbsp;the&nbsp;type&nbsp;id&nbsp;after&nbsp;the&nbsp;elements</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3250291">//&nbsp;are&nbsp;constructed.&nbsp;This&nbsp;is&nbsp;to&nbsp;retain&nbsp;the&nbsp;order&nbsp;of&nbsp;type&nbsp;id&nbsp;allocation&nbsp;after</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3250369">//&nbsp;a&nbsp;fix&nbsp;made&nbsp;to&nbsp;handle&nbsp;recursive&nbsp;types,&nbsp;which&nbsp;changed&nbsp;the&nbsp;order&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3250439">//&nbsp;which&nbsp;types&nbsp;are&nbsp;built.&nbsp;&nbsp;Delaying&nbsp;the&nbsp;setting&nbsp;in&nbsp;this&nbsp;way&nbsp;preserves</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3250511">//&nbsp;type&nbsp;ids&nbsp;while&nbsp;allowing&nbsp;recursive&nbsp;types&nbsp;to&nbsp;be&nbsp;described.&nbsp;Structs,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3250582">//&nbsp;done&nbsp;below,&nbsp;were&nbsp;already&nbsp;handling&nbsp;recursion&nbsp;correctly&nbsp;so&nbsp;they</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3250649">//&nbsp;assign&nbsp;the&nbsp;top-level&nbsp;id&nbsp;before&nbsp;those&nbsp;of&nbsp;the&nbsp;field.</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3250705">at</span><span class="op" id="3250707">.</span><span class="ident" id="3250708">init</span><span class="op" id="3250712">(</span><span class="ident" id="3250713">type0</span><span class="op" id="3250718">,</span>&nbsp;<span class="ident" id="3250720">t</span><span class="op" id="3250721">.</span><span class="ident" id="3250722">Len</span><span class="op" id="3250725">(</span><span class="op" id="3250726">)</span><span class="op" id="3250727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3250731">return</span>&nbsp;<span class="ident" id="3250738">at</span><span class="op" id="3250740">,</span>&nbsp;<span class="ident" id="3250742">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3250748">case</span>&nbsp;<span class="ident" id="3250753">reflect</span><span class="op" id="3250760">.</span><span class="ident" id="3250761">Map</span><span class="op" id="3250764">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3250768">mt</span>&nbsp;<span class="op" id="3250771">:=</span>&nbsp;<span class="ident" id="3250774">newMapType</span><span class="op" id="3250784">(</span><span class="ident" id="3250785">name</span><span class="op" id="3250789">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3250793">types</span><span class="op" id="3250798">[</span><span class="ident" id="3250799">rt</span><span class="op" id="3250801">]</span>&nbsp;<span class="op" id="3250803">=</span>&nbsp;<span class="ident" id="3250805">mt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3250810">type0</span><span class="op" id="3250815">,</span>&nbsp;<span class="ident" id="3250817">err</span>&nbsp;<span class="op" id="3250821">=</span>&nbsp;<span class="ident" id="3250823">getBaseType</span><span class="op" id="3250834">(</span><span class="string" id="3250835">&#34;&#34;</span><span class="op" id="3250837">,</span>&nbsp;<span class="ident" id="3250839">t</span><span class="op" id="3250840">.</span><span class="ident" id="3250841">Key</span><span class="op" id="3250844">(</span><span class="op" id="3250845">)</span><span class="op" id="3250846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3250850">if</span>&nbsp;<span class="ident" id="3250853">err</span>&nbsp;<span class="op" id="3250857">!=</span>&nbsp;<span class="ident" id="3250860">nil</span>&nbsp;<span class="op" id="3250864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3250869">return</span>&nbsp;<span class="ident" id="3250876">nil</span><span class="op" id="3250879">,</span>&nbsp;<span class="ident" id="3250881">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3250887">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3250891">type1</span><span class="op" id="3250896">,</span>&nbsp;<span class="ident" id="3250898">err</span>&nbsp;<span class="op" id="3250902">=</span>&nbsp;<span class="ident" id="3250904">getBaseType</span><span class="op" id="3250915">(</span><span class="string" id="3250916">&#34;&#34;</span><span class="op" id="3250918">,</span>&nbsp;<span class="ident" id="3250920">t</span><span class="op" id="3250921">.</span><span class="ident" id="3250922">Elem</span><span class="op" id="3250926">(</span><span class="op" id="3250927">)</span><span class="op" id="3250928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3250932">if</span>&nbsp;<span class="ident" id="3250935">err</span>&nbsp;<span class="op" id="3250939">!=</span>&nbsp;<span class="ident" id="3250942">nil</span>&nbsp;<span class="op" id="3250946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3250951">return</span>&nbsp;<span class="ident" id="3250958">nil</span><span class="op" id="3250961">,</span>&nbsp;<span class="ident" id="3250963">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3250969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3250973">mt</span><span class="op" id="3250975">.</span><span class="ident" id="3250976">init</span><span class="op" id="3250980">(</span><span class="ident" id="3250981">type0</span><span class="op" id="3250986">,</span>&nbsp;<span class="ident" id="3250988">type1</span><span class="op" id="3250993">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3250997">return</span>&nbsp;<span class="ident" id="3251004">mt</span><span class="op" id="3251006">,</span>&nbsp;<span class="ident" id="3251008">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3251014">case</span>&nbsp;<span class="ident" id="3251019">reflect</span><span class="op" id="3251026">.</span><span class="ident" id="3251027">Slice</span><span class="op" id="3251032">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3251036">//&nbsp;[]byte&nbsp;==&nbsp;[]uint8&nbsp;is&nbsp;a&nbsp;special&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3251077">if</span>&nbsp;<span class="ident" id="3251080">t</span><span class="op" id="3251081">.</span><span class="ident" id="3251082">Elem</span><span class="op" id="3251086">(</span><span class="op" id="3251087">)</span><span class="op" id="3251088">.</span><span class="ident" id="3251089">Kind</span><span class="op" id="3251093">(</span><span class="op" id="3251094">)</span>&nbsp;<span class="op" id="3251096">==</span>&nbsp;<span class="ident" id="3251099">reflect</span><span class="op" id="3251106">.</span><span class="ident" id="3251107">Uint8</span>&nbsp;<span class="op" id="3251113">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3251118">return</span>&nbsp;<span class="ident" id="3251125">tBytes</span><span class="op" id="3251131">.</span><span class="ident" id="3251132">gobType</span><span class="op" id="3251139">(</span><span class="op" id="3251140">)</span><span class="op" id="3251141">,</span>&nbsp;<span class="ident" id="3251143">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3251149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3251153">st</span>&nbsp;<span class="op" id="3251156">:=</span>&nbsp;<span class="ident" id="3251159">newSliceType</span><span class="op" id="3251171">(</span><span class="ident" id="3251172">name</span><span class="op" id="3251176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3251180">types</span><span class="op" id="3251185">[</span><span class="ident" id="3251186">rt</span><span class="op" id="3251188">]</span>&nbsp;<span class="op" id="3251190">=</span>&nbsp;<span class="ident" id="3251192">st</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3251197">type0</span><span class="op" id="3251202">,</span>&nbsp;<span class="ident" id="3251204">err</span>&nbsp;<span class="op" id="3251208">=</span>&nbsp;<span class="ident" id="3251210">getBaseType</span><span class="op" id="3251221">(</span><span class="ident" id="3251222">t</span><span class="op" id="3251223">.</span><span class="ident" id="3251224">Elem</span><span class="op" id="3251228">(</span><span class="op" id="3251229">)</span><span class="op" id="3251230">.</span><span class="ident" id="3251231">Name</span><span class="op" id="3251235">(</span><span class="op" id="3251236">)</span><span class="op" id="3251237">,</span>&nbsp;<span class="ident" id="3251239">t</span><span class="op" id="3251240">.</span><span class="ident" id="3251241">Elem</span><span class="op" id="3251245">(</span><span class="op" id="3251246">)</span><span class="op" id="3251247">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3251251">if</span>&nbsp;<span class="ident" id="3251254">err</span>&nbsp;<span class="op" id="3251258">!=</span>&nbsp;<span class="ident" id="3251261">nil</span>&nbsp;<span class="op" id="3251265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3251270">return</span>&nbsp;<span class="ident" id="3251277">nil</span><span class="op" id="3251280">,</span>&nbsp;<span class="ident" id="3251282">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3251288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3251292">st</span><span class="op" id="3251294">.</span><span class="ident" id="3251295">init</span><span class="op" id="3251299">(</span><span class="ident" id="3251300">type0</span><span class="op" id="3251305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3251309">return</span>&nbsp;<span class="ident" id="3251316">st</span><span class="op" id="3251318">,</span>&nbsp;<span class="ident" id="3251320">nil</span><br>
<span class="lineno">530</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3251326">case</span>&nbsp;<span class="ident" id="3251331">reflect</span><span class="op" id="3251338">.</span><span class="ident" id="3251339">Struct</span><span class="op" id="3251345">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3251349">st</span>&nbsp;<span class="op" id="3251352">:=</span>&nbsp;<span class="ident" id="3251355">newStructType</span><span class="op" id="3251368">(</span><span class="ident" id="3251369">name</span><span class="op" id="3251373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3251377">types</span><span class="op" id="3251382">[</span><span class="ident" id="3251383">rt</span><span class="op" id="3251385">]</span>&nbsp;<span class="op" id="3251387">=</span>&nbsp;<span class="ident" id="3251389">st</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3251394">idToType</span><span class="op" id="3251402">[</span><span class="ident" id="3251403">st</span><span class="op" id="3251405">.</span><span class="ident" id="3251406">id</span><span class="op" id="3251408">(</span><span class="op" id="3251409">)</span><span class="op" id="3251410">]</span>&nbsp;<span class="op" id="3251412">=</span>&nbsp;<span class="ident" id="3251414">st</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3251419">for</span>&nbsp;<span class="ident" id="3251423">i</span>&nbsp;<span class="op" id="3251425">:=</span>&nbsp;<span class="num" id="3251428">0</span><span class="op" id="3251429">;</span>&nbsp;<span class="ident" id="3251431">i</span>&nbsp;<span class="op" id="3251433">&lt;</span>&nbsp;<span class="ident" id="3251435">t</span><span class="op" id="3251436">.</span><span class="ident" id="3251437">NumField</span><span class="op" id="3251445">(</span><span class="op" id="3251446">)</span><span class="op" id="3251447">;</span>&nbsp;<span class="ident" id="3251449">i</span><span class="op" id="3251450">++</span>&nbsp;<span class="op" id="3251453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3251458">f</span>&nbsp;<span class="op" id="3251460">:=</span>&nbsp;<span class="ident" id="3251463">t</span><span class="op" id="3251464">.</span><span class="ident" id="3251465">Field</span><span class="op" id="3251470">(</span><span class="ident" id="3251471">i</span><span class="op" id="3251472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3251477">if</span>&nbsp;<span class="op" id="3251480">!</span><span class="ident" id="3251481">isSent</span><span class="op" id="3251487">(</span><span class="op" id="3251488">&amp;</span><span class="ident" id="3251489">f</span><span class="op" id="3251490">)</span>&nbsp;<span class="op" id="3251492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3251498">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3251510">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3251515">typ</span>&nbsp;<span class="op" id="3251519">:=</span>&nbsp;<span class="ident" id="3251522">userType</span><span class="op" id="3251530">(</span><span class="ident" id="3251531">f</span><span class="op" id="3251532">.</span><span class="ident" id="3251533">Type</span><span class="op" id="3251537">)</span><span class="op" id="3251538">.</span><span class="ident" id="3251539">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3251547">tname</span>&nbsp;<span class="op" id="3251553">:=</span>&nbsp;<span class="ident" id="3251556">typ</span><span class="op" id="3251559">.</span><span class="ident" id="3251560">Name</span><span class="op" id="3251564">(</span><span class="op" id="3251565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3251570">if</span>&nbsp;<span class="ident" id="3251573">tname</span>&nbsp;<span class="op" id="3251579">==</span>&nbsp;<span class="string" id="3251582">&#34;&#34;</span>&nbsp;<span class="op" id="3251585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3251591">t</span>&nbsp;<span class="op" id="3251593">:=</span>&nbsp;<span class="ident" id="3251596">userType</span><span class="op" id="3251604">(</span><span class="ident" id="3251605">f</span><span class="op" id="3251606">.</span><span class="ident" id="3251607">Type</span><span class="op" id="3251611">)</span><span class="op" id="3251612">.</span><span class="ident" id="3251613">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3251622">tname</span>&nbsp;<span class="op" id="3251628">=</span>&nbsp;<span class="ident" id="3251630">t</span><span class="op" id="3251631">.</span><span class="ident" id="3251632">String</span><span class="op" id="3251638">(</span><span class="op" id="3251639">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3251644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3251649">gt</span><span class="op" id="3251651">,</span>&nbsp;<span class="ident" id="3251653">err</span>&nbsp;<span class="op" id="3251657">:=</span>&nbsp;<span class="ident" id="3251660">getBaseType</span><span class="op" id="3251671">(</span><span class="ident" id="3251672">tname</span><span class="op" id="3251677">,</span>&nbsp;<span class="ident" id="3251679">f</span><span class="op" id="3251680">.</span><span class="ident" id="3251681">Type</span><span class="op" id="3251685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3251690">if</span>&nbsp;<span class="ident" id="3251693">err</span>&nbsp;<span class="op" id="3251697">!=</span>&nbsp;<span class="ident" id="3251700">nil</span>&nbsp;<span class="op" id="3251704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3251710">return</span>&nbsp;<span class="ident" id="3251717">nil</span><span class="op" id="3251720">,</span>&nbsp;<span class="ident" id="3251722">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3251729">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3251734">//&nbsp;Some&nbsp;mutually&nbsp;recursive&nbsp;types&nbsp;can&nbsp;cause&nbsp;us&nbsp;to&nbsp;be&nbsp;here&nbsp;while</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3251800">//&nbsp;still&nbsp;defining&nbsp;the&nbsp;element.&nbsp;Fix&nbsp;the&nbsp;element&nbsp;type&nbsp;id&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3251864">//&nbsp;We&nbsp;could&nbsp;do&nbsp;this&nbsp;more&nbsp;neatly&nbsp;by&nbsp;setting&nbsp;the&nbsp;id&nbsp;at&nbsp;the&nbsp;start&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3251933">//&nbsp;building&nbsp;every&nbsp;type,&nbsp;but&nbsp;that&nbsp;would&nbsp;break&nbsp;binary&nbsp;compatibility.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3252003">if</span>&nbsp;<span class="ident" id="3252006">gt</span><span class="op" id="3252008">.</span><span class="ident" id="3252009">id</span><span class="op" id="3252011">(</span><span class="op" id="3252012">)</span>&nbsp;<span class="op" id="3252014">==</span>&nbsp;<span class="num" id="3252017">0</span>&nbsp;<span class="op" id="3252019">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3252025">setTypeId</span><span class="op" id="3252034">(</span><span class="ident" id="3252035">gt</span><span class="op" id="3252037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3252042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3252047">st</span><span class="op" id="3252049">.</span><span class="ident" id="3252050">Field</span>&nbsp;<span class="op" id="3252056">=</span>&nbsp;<span class="builtinfunc" id="3252058">append</span><span class="op" id="3252064">(</span><span class="ident" id="3252065">st</span><span class="op" id="3252067">.</span><span class="ident" id="3252068">Field</span><span class="op" id="3252073">,</span>&nbsp;<span class="op" id="3252075">&amp;</span><span class="ident" id="3252076">fieldType</span><span class="op" id="3252085">{</span><span class="ident" id="3252086">f</span><span class="op" id="3252087">.</span><span class="ident" id="3252088">Name</span><span class="op" id="3252092">,</span>&nbsp;<span class="ident" id="3252094">gt</span><span class="op" id="3252096">.</span><span class="ident" id="3252097">id</span><span class="op" id="3252099">(</span><span class="op" id="3252100">)</span><span class="op" id="3252101">}</span><span class="op" id="3252102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3252106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3252110">return</span>&nbsp;<span class="ident" id="3252117">st</span><span class="op" id="3252119">,</span>&nbsp;<span class="ident" id="3252121">nil</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3252127">default</span><span class="op" id="3252134">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3252138">return</span>&nbsp;<span class="ident" id="3252145">nil</span><span class="op" id="3252148">,</span>&nbsp;<span class="ident" id="3252150">errors</span><span class="op" id="3252156">.</span><span class="ident" id="3252157">New</span><span class="op" id="3252160">(</span><span class="string" id="3252161">&#34;gob&nbsp;NewTypeObject&nbsp;can&#39;t&nbsp;handle&nbsp;type:&nbsp;&#34;</span>&nbsp;<span class="op" id="3252201">+</span>&nbsp;<span class="ident" id="3252203">rt</span><span class="op" id="3252205">.</span><span class="ident" id="3252206">String</span><span class="op" id="3252212">(</span><span class="op" id="3252213">)</span><span class="op" id="3252214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3252217">}</span><br>
<span class="lineno"></span><span class="op" id="3252219">}</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span><span class="comment" id="3252222">//&nbsp;isExported&nbsp;reports&nbsp;whether&nbsp;this&nbsp;is&nbsp;an&nbsp;exported&nbsp;-&nbsp;upper&nbsp;case&nbsp;-&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="3252293">func</span>&nbsp;<span class="ident" id="3252298">isExported</span><span class="op" id="3252308">(</span><span class="ident" id="3252309">name</span>&nbsp;<span class="builtintype" id="3252314">string</span><span class="op" id="3252320">)</span>&nbsp;<span class="builtintype" id="3252322">bool</span>&nbsp;<span class="op" id="3252327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3252330">rune</span><span class="op" id="3252334">,</span>&nbsp;<span class="ident" id="3252336">_</span>&nbsp;<span class="op" id="3252338">:=</span>&nbsp;<span class="ident" id="3252341">utf8</span><span class="op" id="3252345">.</span><span class="ident" id="3252346">DecodeRuneInString</span><span class="op" id="3252364">(</span><span class="ident" id="3252365">name</span><span class="op" id="3252369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3252372">return</span>&nbsp;<span class="ident" id="3252379">unicode</span><span class="op" id="3252386">.</span><span class="ident" id="3252387">IsUpper</span><span class="op" id="3252394">(</span><span class="builtintype" id="3252395">rune</span><span class="op" id="3252399">)</span><br>
<span class="lineno">570</span><span class="op" id="3252401">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3252404">//&nbsp;isSent&nbsp;reports&nbsp;whether&nbsp;this&nbsp;struct&nbsp;field&nbsp;is&nbsp;to&nbsp;be&nbsp;transmitted.</span><br>
<span class="lineno"></span><span class="comment" id="3252470">//&nbsp;It&nbsp;will&nbsp;be&nbsp;transmitted&nbsp;only&nbsp;if&nbsp;it&nbsp;is&nbsp;exported&nbsp;and&nbsp;not&nbsp;a&nbsp;chan&nbsp;or&nbsp;func&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="3252548">//&nbsp;or&nbsp;pointer&nbsp;to&nbsp;chan&nbsp;or&nbsp;func.</span><br>
<span class="lineno">575</span><span class="keyword" id="3252579">func</span>&nbsp;<span class="ident" id="3252584">isSent</span><span class="op" id="3252590">(</span><span class="ident" id="3252591">field</span>&nbsp;<span class="op" id="3252597">*</span><span class="ident" id="3252598">reflect</span><span class="op" id="3252605">.</span><span class="ident" id="3252606">StructField</span><span class="op" id="3252617">)</span>&nbsp;<span class="builtintype" id="3252619">bool</span>&nbsp;<span class="op" id="3252624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3252627">if</span>&nbsp;<span class="op" id="3252630">!</span><span class="ident" id="3252631">isExported</span><span class="op" id="3252641">(</span><span class="ident" id="3252642">field</span><span class="op" id="3252647">.</span><span class="ident" id="3252648">Name</span><span class="op" id="3252652">)</span>&nbsp;<span class="op" id="3252654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3252658">return</span>&nbsp;<span class="ident" id="3252665">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3252672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3252675">//&nbsp;If&nbsp;the&nbsp;field&nbsp;is&nbsp;a&nbsp;chan&nbsp;or&nbsp;func&nbsp;or&nbsp;pointer&nbsp;thereto,&nbsp;don&#39;t&nbsp;send&nbsp;it.</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3252745">//&nbsp;That&nbsp;is,&nbsp;treat&nbsp;it&nbsp;like&nbsp;an&nbsp;unexported&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3252793">typ</span>&nbsp;<span class="op" id="3252797">:=</span>&nbsp;<span class="ident" id="3252800">field</span><span class="op" id="3252805">.</span><span class="ident" id="3252806">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3252812">for</span>&nbsp;<span class="ident" id="3252816">typ</span><span class="op" id="3252819">.</span><span class="ident" id="3252820">Kind</span><span class="op" id="3252824">(</span><span class="op" id="3252825">)</span>&nbsp;<span class="op" id="3252827">==</span>&nbsp;<span class="ident" id="3252830">reflect</span><span class="op" id="3252837">.</span><span class="ident" id="3252838">Ptr</span>&nbsp;<span class="op" id="3252842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3252846">typ</span>&nbsp;<span class="op" id="3252850">=</span>&nbsp;<span class="ident" id="3252852">typ</span><span class="op" id="3252855">.</span><span class="ident" id="3252856">Elem</span><span class="op" id="3252860">(</span><span class="op" id="3252861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3252864">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3252867">if</span>&nbsp;<span class="ident" id="3252870">typ</span><span class="op" id="3252873">.</span><span class="ident" id="3252874">Kind</span><span class="op" id="3252878">(</span><span class="op" id="3252879">)</span>&nbsp;<span class="op" id="3252881">==</span>&nbsp;<span class="ident" id="3252884">reflect</span><span class="op" id="3252891">.</span><span class="ident" id="3252892">Chan</span>&nbsp;<span class="op" id="3252897">||</span>&nbsp;<span class="ident" id="3252900">typ</span><span class="op" id="3252903">.</span><span class="ident" id="3252904">Kind</span><span class="op" id="3252908">(</span><span class="op" id="3252909">)</span>&nbsp;<span class="op" id="3252911">==</span>&nbsp;<span class="ident" id="3252914">reflect</span><span class="op" id="3252921">.</span><span class="ident" id="3252922">Func</span>&nbsp;<span class="op" id="3252927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3252931">return</span>&nbsp;<span class="ident" id="3252938">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3252945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3252948">return</span>&nbsp;<span class="ident" id="3252955">true</span><br>
<span class="lineno"></span><span class="op" id="3252960">}</span><br>
<span class="lineno">590</span><br>
<span class="lineno"></span><span class="comment" id="3252963">//&nbsp;getBaseType&nbsp;returns&nbsp;the&nbsp;Gob&nbsp;type&nbsp;describing&nbsp;the&nbsp;given&nbsp;reflect.Type&#39;s&nbsp;base&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="3253046">//&nbsp;typeLock&nbsp;must&nbsp;be&nbsp;held.</span><br>
<span class="lineno"></span><span class="keyword" id="3253072">func</span>&nbsp;<span class="ident" id="3253077">getBaseType</span><span class="op" id="3253088">(</span><span class="ident" id="3253089">name</span>&nbsp;<span class="builtintype" id="3253094">string</span><span class="op" id="3253100">,</span>&nbsp;<span class="ident" id="3253102">rt</span>&nbsp;<span class="ident" id="3253105">reflect</span><span class="op" id="3253112">.</span><span class="ident" id="3253113">Type</span><span class="op" id="3253117">)</span>&nbsp;<span class="op" id="3253119">(</span><span class="ident" id="3253120">gobType</span><span class="op" id="3253127">,</span>&nbsp;<span class="builtintype" id="3253129">error</span><span class="op" id="3253134">)</span>&nbsp;<span class="op" id="3253136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3253139">ut</span>&nbsp;<span class="op" id="3253142">:=</span>&nbsp;<span class="ident" id="3253145">userType</span><span class="op" id="3253153">(</span><span class="ident" id="3253154">rt</span><span class="op" id="3253156">)</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3253159">return</span>&nbsp;<span class="ident" id="3253166">getType</span><span class="op" id="3253173">(</span><span class="ident" id="3253174">name</span><span class="op" id="3253178">,</span>&nbsp;<span class="ident" id="3253180">ut</span><span class="op" id="3253182">,</span>&nbsp;<span class="ident" id="3253184">ut</span><span class="op" id="3253186">.</span><span class="ident" id="3253187">base</span><span class="op" id="3253191">)</span><br>
<span class="lineno"></span><span class="op" id="3253193">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3253196">//&nbsp;getType&nbsp;returns&nbsp;the&nbsp;Gob&nbsp;type&nbsp;describing&nbsp;the&nbsp;given&nbsp;reflect.Type.</span><br>
<span class="lineno"></span><span class="comment" id="3253263">//&nbsp;Should&nbsp;be&nbsp;called&nbsp;only&nbsp;when&nbsp;handling&nbsp;GobEncoders/Decoders,</span><br>
<span class="lineno">600</span><span class="comment" id="3253324">//&nbsp;which&nbsp;may&nbsp;be&nbsp;pointers.&nbsp;&nbsp;All&nbsp;other&nbsp;types&nbsp;are&nbsp;handled&nbsp;through&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3253391">//&nbsp;base&nbsp;type,&nbsp;never&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span><span class="comment" id="3253422">//&nbsp;typeLock&nbsp;must&nbsp;be&nbsp;held.</span><br>
<span class="lineno"></span><span class="keyword" id="3253448">func</span>&nbsp;<span class="ident" id="3253453">getType</span><span class="op" id="3253460">(</span><span class="ident" id="3253461">name</span>&nbsp;<span class="builtintype" id="3253466">string</span><span class="op" id="3253472">,</span>&nbsp;<span class="ident" id="3253474">ut</span>&nbsp;<span class="op" id="3253477">*</span><span class="ident" id="3253478">userTypeInfo</span><span class="op" id="3253490">,</span>&nbsp;<span class="ident" id="3253492">rt</span>&nbsp;<span class="ident" id="3253495">reflect</span><span class="op" id="3253502">.</span><span class="ident" id="3253503">Type</span><span class="op" id="3253507">)</span>&nbsp;<span class="op" id="3253509">(</span><span class="ident" id="3253510">gobType</span><span class="op" id="3253517">,</span>&nbsp;<span class="builtintype" id="3253519">error</span><span class="op" id="3253524">)</span>&nbsp;<span class="op" id="3253526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3253529">typ</span><span class="op" id="3253532">,</span>&nbsp;<span class="ident" id="3253534">present</span>&nbsp;<span class="op" id="3253542">:=</span>&nbsp;<span class="ident" id="3253545">types</span><span class="op" id="3253550">[</span><span class="ident" id="3253551">rt</span><span class="op" id="3253553">]</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3253556">if</span>&nbsp;<span class="ident" id="3253559">present</span>&nbsp;<span class="op" id="3253567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3253571">return</span>&nbsp;<span class="ident" id="3253578">typ</span><span class="op" id="3253581">,</span>&nbsp;<span class="ident" id="3253583">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3253588">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3253591">typ</span><span class="op" id="3253594">,</span>&nbsp;<span class="ident" id="3253596">err</span>&nbsp;<span class="op" id="3253600">:=</span>&nbsp;<span class="ident" id="3253603">newTypeObject</span><span class="op" id="3253616">(</span><span class="ident" id="3253617">name</span><span class="op" id="3253621">,</span>&nbsp;<span class="ident" id="3253623">ut</span><span class="op" id="3253625">,</span>&nbsp;<span class="ident" id="3253627">rt</span><span class="op" id="3253629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3253632">if</span>&nbsp;<span class="ident" id="3253635">err</span>&nbsp;<span class="op" id="3253639">==</span>&nbsp;<span class="ident" id="3253642">nil</span>&nbsp;<span class="op" id="3253646">{</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3253650">types</span><span class="op" id="3253655">[</span><span class="ident" id="3253656">rt</span><span class="op" id="3253658">]</span>&nbsp;<span class="op" id="3253660">=</span>&nbsp;<span class="ident" id="3253662">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3253667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3253670">return</span>&nbsp;<span class="ident" id="3253677">typ</span><span class="op" id="3253680">,</span>&nbsp;<span class="ident" id="3253682">err</span><br>
<span class="lineno"></span><span class="op" id="3253686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">615</span><span class="keyword" id="3253689">func</span>&nbsp;<span class="ident" id="3253694">checkId</span><span class="op" id="3253701">(</span><span class="ident" id="3253702">want</span><span class="op" id="3253706">,</span>&nbsp;<span class="ident" id="3253708">got</span>&nbsp;<span class="ident" id="3253712">typeId</span><span class="op" id="3253718">)</span>&nbsp;<span class="op" id="3253720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3253723">if</span>&nbsp;<span class="ident" id="3253726">want</span>&nbsp;<span class="op" id="3253731">!=</span>&nbsp;<span class="ident" id="3253734">got</span>&nbsp;<span class="op" id="3253738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3253742">fmt</span><span class="op" id="3253745">.</span><span class="ident" id="3253746">Fprintf</span><span class="op" id="3253753">(</span><span class="ident" id="3253754">os</span><span class="op" id="3253756">.</span><span class="ident" id="3253757">Stderr</span><span class="op" id="3253763">,</span>&nbsp;<span class="string" id="3253765">&#34;checkId:&nbsp;%d&nbsp;should&nbsp;be&nbsp;%d\n&#34;</span><span class="op" id="3253793">,</span>&nbsp;<span class="builtintype" id="3253795">int</span><span class="op" id="3253798">(</span><span class="ident" id="3253799">got</span><span class="op" id="3253802">)</span><span class="op" id="3253803">,</span>&nbsp;<span class="builtintype" id="3253805">int</span><span class="op" id="3253808">(</span><span class="ident" id="3253809">want</span><span class="op" id="3253813">)</span><span class="op" id="3253814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3253818">panic</span><span class="op" id="3253823">(</span><span class="string" id="3253824">&#34;bootstrap&nbsp;type&nbsp;wrong&nbsp;id:&nbsp;&#34;</span>&nbsp;<span class="op" id="3253852">+</span>&nbsp;<span class="ident" id="3253854">got</span><span class="op" id="3253857">.</span><span class="ident" id="3253858">name</span><span class="op" id="3253862">(</span><span class="op" id="3253863">)</span>&nbsp;<span class="op" id="3253865">+</span>&nbsp;<span class="string" id="3253867">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="3253871">+</span>&nbsp;<span class="ident" id="3253873">got</span><span class="op" id="3253876">.</span><span class="builtintype" id="3253877">string</span><span class="op" id="3253883">(</span><span class="op" id="3253884">)</span>&nbsp;<span class="op" id="3253886">+</span>&nbsp;<span class="string" id="3253888">&#34;&nbsp;not&nbsp;&#34;</span>&nbsp;<span class="op" id="3253896">+</span>&nbsp;<span class="ident" id="3253898">want</span><span class="op" id="3253902">.</span><span class="builtintype" id="3253903">string</span><span class="op" id="3253909">(</span><span class="op" id="3253910">)</span><span class="op" id="3253911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3253914">}</span><br>
<span class="lineno">620</span><span class="op" id="3253916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3253919">//&nbsp;used&nbsp;for&nbsp;building&nbsp;the&nbsp;basic&nbsp;types;&nbsp;called&nbsp;only&nbsp;from&nbsp;init().&nbsp;&nbsp;the&nbsp;incoming</span><br>
<span class="lineno"></span><span class="comment" id="3253996">//&nbsp;interface&nbsp;always&nbsp;refers&nbsp;to&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span><span class="keyword" id="3254037">func</span>&nbsp;<span class="ident" id="3254042">bootstrapType</span><span class="op" id="3254055">(</span><span class="ident" id="3254056">name</span>&nbsp;<span class="builtintype" id="3254061">string</span><span class="op" id="3254067">,</span>&nbsp;<span class="ident" id="3254069">e</span>&nbsp;<span class="keyword" id="3254071">interface</span><span class="op" id="3254080">{</span><span class="op" id="3254081">}</span><span class="op" id="3254082">,</span>&nbsp;<span class="ident" id="3254084">expect</span>&nbsp;<span class="ident" id="3254091">typeId</span><span class="op" id="3254097">)</span>&nbsp;<span class="ident" id="3254099">typeId</span>&nbsp;<span class="op" id="3254106">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3254109">rt</span>&nbsp;<span class="op" id="3254112">:=</span>&nbsp;<span class="ident" id="3254115">reflect</span><span class="op" id="3254122">.</span><span class="ident" id="3254123">TypeOf</span><span class="op" id="3254129">(</span><span class="ident" id="3254130">e</span><span class="op" id="3254131">)</span><span class="op" id="3254132">.</span><span class="ident" id="3254133">Elem</span><span class="op" id="3254137">(</span><span class="op" id="3254138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3254141">_</span><span class="op" id="3254142">,</span>&nbsp;<span class="ident" id="3254144">present</span>&nbsp;<span class="op" id="3254152">:=</span>&nbsp;<span class="ident" id="3254155">types</span><span class="op" id="3254160">[</span><span class="ident" id="3254161">rt</span><span class="op" id="3254163">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3254166">if</span>&nbsp;<span class="ident" id="3254169">present</span>&nbsp;<span class="op" id="3254177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3254181">panic</span><span class="op" id="3254186">(</span><span class="string" id="3254187">&#34;bootstrap&nbsp;type&nbsp;already&nbsp;present:&nbsp;&#34;</span>&nbsp;<span class="op" id="3254222">+</span>&nbsp;<span class="ident" id="3254224">name</span>&nbsp;<span class="op" id="3254229">+</span>&nbsp;<span class="string" id="3254231">&#34;,&nbsp;&#34;</span>&nbsp;<span class="op" id="3254236">+</span>&nbsp;<span class="ident" id="3254238">rt</span><span class="op" id="3254240">.</span><span class="ident" id="3254241">String</span><span class="op" id="3254247">(</span><span class="op" id="3254248">)</span><span class="op" id="3254249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3254252">}</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3254255">typ</span>&nbsp;<span class="op" id="3254259">:=</span>&nbsp;<span class="op" id="3254262">&amp;</span><span class="ident" id="3254263">CommonType</span><span class="op" id="3254273">{</span><span class="ident" id="3254274">Name</span><span class="op" id="3254278">:</span>&nbsp;<span class="ident" id="3254280">name</span><span class="op" id="3254284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3254287">types</span><span class="op" id="3254292">[</span><span class="ident" id="3254293">rt</span><span class="op" id="3254295">]</span>&nbsp;<span class="op" id="3254297">=</span>&nbsp;<span class="ident" id="3254299">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3254304">setTypeId</span><span class="op" id="3254313">(</span><span class="ident" id="3254314">typ</span><span class="op" id="3254317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3254320">checkId</span><span class="op" id="3254327">(</span><span class="ident" id="3254328">expect</span><span class="op" id="3254334">,</span>&nbsp;<span class="ident" id="3254336">nextId</span><span class="op" id="3254342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3254345">userType</span><span class="op" id="3254353">(</span><span class="ident" id="3254354">rt</span><span class="op" id="3254356">)</span>&nbsp;<span class="comment" id="3254358">//&nbsp;might&nbsp;as&nbsp;well&nbsp;cache&nbsp;it&nbsp;now</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3254389">return</span>&nbsp;<span class="ident" id="3254396">nextId</span><br>
<span class="lineno"></span><span class="op" id="3254403">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3254406">//&nbsp;Representation&nbsp;of&nbsp;the&nbsp;information&nbsp;we&nbsp;send&nbsp;and&nbsp;receive&nbsp;about&nbsp;this&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="3254480">//&nbsp;Each&nbsp;value&nbsp;we&nbsp;send&nbsp;is&nbsp;preceded&nbsp;by&nbsp;its&nbsp;type&nbsp;definition:&nbsp;an&nbsp;encoded&nbsp;int.</span><br>
<span class="lineno">640</span><span class="comment" id="3254554">//&nbsp;However,&nbsp;the&nbsp;very&nbsp;first&nbsp;time&nbsp;we&nbsp;send&nbsp;the&nbsp;value,&nbsp;we&nbsp;first&nbsp;send&nbsp;the&nbsp;pair</span><br>
<span class="lineno"></span><span class="comment" id="3254628">//&nbsp;(-id,&nbsp;wireType).</span><br>
<span class="lineno"></span><span class="comment" id="3254648">//&nbsp;For&nbsp;bootstrapping&nbsp;purposes,&nbsp;we&nbsp;assume&nbsp;that&nbsp;the&nbsp;recipient&nbsp;knows&nbsp;how</span><br>
<span class="lineno"></span><span class="comment" id="3254718">//&nbsp;to&nbsp;decode&nbsp;a&nbsp;wireType;&nbsp;it&nbsp;is&nbsp;exactly&nbsp;the&nbsp;wireType&nbsp;struct&nbsp;here,&nbsp;interpreted</span><br>
<span class="lineno"></span><span class="comment" id="3254795">//&nbsp;using&nbsp;the&nbsp;gob&nbsp;rules&nbsp;for&nbsp;sending&nbsp;a&nbsp;structure,&nbsp;except&nbsp;that&nbsp;we&nbsp;assume&nbsp;the</span><br>
<span class="lineno">645</span><span class="comment" id="3254869">//&nbsp;ids&nbsp;for&nbsp;wireType&nbsp;and&nbsp;structType&nbsp;etc.&nbsp;are&nbsp;known.&nbsp;&nbsp;The&nbsp;relevant&nbsp;pieces</span><br>
<span class="lineno"></span><span class="comment" id="3254941">//&nbsp;are&nbsp;built&nbsp;in&nbsp;encode.go&#39;s&nbsp;init()&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="3254986">//&nbsp;To&nbsp;maintain&nbsp;binary&nbsp;compatibility,&nbsp;if&nbsp;you&nbsp;extend&nbsp;this&nbsp;type,&nbsp;always&nbsp;put</span><br>
<span class="lineno"></span><span class="comment" id="3255059">//&nbsp;the&nbsp;new&nbsp;fields&nbsp;last.</span><br>
<span class="lineno"></span><span class="keyword" id="3255083">type</span>&nbsp;<span class="ident" id="3255088">wireType</span>&nbsp;<span class="keyword" id="3255097">struct</span>&nbsp;<span class="op" id="3255104">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3255107">ArrayT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3255124">*</span><span class="ident" id="3255125">arrayType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3255136">SliceT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3255153">*</span><span class="ident" id="3255154">sliceType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3255165">StructT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3255182">*</span><span class="ident" id="3255183">structType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3255195">MapT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3255212">*</span><span class="ident" id="3255213">mapType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3255222">GobEncoderT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3255239">*</span><span class="ident" id="3255240">gobEncoderType</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3255256">BinaryMarshalerT</span>&nbsp;<span class="op" id="3255273">*</span><span class="ident" id="3255274">gobEncoderType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3255290">TextMarshalerT</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3255307">*</span><span class="ident" id="3255308">gobEncoderType</span><br>
<span class="lineno"></span><span class="op" id="3255323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3255326">func</span>&nbsp;<span class="op" id="3255331">(</span><span class="ident" id="3255332">w</span>&nbsp;<span class="op" id="3255334">*</span><span class="ident" id="3255335">wireType</span><span class="op" id="3255343">)</span>&nbsp;<span class="builtintype" id="3255345">string</span><span class="op" id="3255351">(</span><span class="op" id="3255352">)</span>&nbsp;<span class="builtintype" id="3255354">string</span>&nbsp;<span class="op" id="3255361">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3255364">const</span>&nbsp;<span class="ident" id="3255370">unknown</span>&nbsp;<span class="op" id="3255378">=</span>&nbsp;<span class="string" id="3255380">&#34;unknown&nbsp;type&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3255396">if</span>&nbsp;<span class="ident" id="3255399">w</span>&nbsp;<span class="op" id="3255401">==</span>&nbsp;<span class="ident" id="3255404">nil</span>&nbsp;<span class="op" id="3255408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3255412">return</span>&nbsp;<span class="ident" id="3255419">unknown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3255428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3255431">switch</span>&nbsp;<span class="op" id="3255438">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3255441">case</span>&nbsp;<span class="ident" id="3255446">w</span><span class="op" id="3255447">.</span><span class="ident" id="3255448">ArrayT</span>&nbsp;<span class="op" id="3255455">!=</span>&nbsp;<span class="ident" id="3255458">nil</span><span class="op" id="3255461">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3255465">return</span>&nbsp;<span class="ident" id="3255472">w</span><span class="op" id="3255473">.</span><span class="ident" id="3255474">ArrayT</span><span class="op" id="3255480">.</span><span class="ident" id="3255481">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3255487">case</span>&nbsp;<span class="ident" id="3255492">w</span><span class="op" id="3255493">.</span><span class="ident" id="3255494">SliceT</span>&nbsp;<span class="op" id="3255501">!=</span>&nbsp;<span class="ident" id="3255504">nil</span><span class="op" id="3255507">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3255511">return</span>&nbsp;<span class="ident" id="3255518">w</span><span class="op" id="3255519">.</span><span class="ident" id="3255520">SliceT</span><span class="op" id="3255526">.</span><span class="ident" id="3255527">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3255533">case</span>&nbsp;<span class="ident" id="3255538">w</span><span class="op" id="3255539">.</span><span class="ident" id="3255540">StructT</span>&nbsp;<span class="op" id="3255548">!=</span>&nbsp;<span class="ident" id="3255551">nil</span><span class="op" id="3255554">:</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3255558">return</span>&nbsp;<span class="ident" id="3255565">w</span><span class="op" id="3255566">.</span><span class="ident" id="3255567">StructT</span><span class="op" id="3255574">.</span><span class="ident" id="3255575">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3255581">case</span>&nbsp;<span class="ident" id="3255586">w</span><span class="op" id="3255587">.</span><span class="ident" id="3255588">MapT</span>&nbsp;<span class="op" id="3255593">!=</span>&nbsp;<span class="ident" id="3255596">nil</span><span class="op" id="3255599">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3255603">return</span>&nbsp;<span class="ident" id="3255610">w</span><span class="op" id="3255611">.</span><span class="ident" id="3255612">MapT</span><span class="op" id="3255616">.</span><span class="ident" id="3255617">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3255623">case</span>&nbsp;<span class="ident" id="3255628">w</span><span class="op" id="3255629">.</span><span class="ident" id="3255630">GobEncoderT</span>&nbsp;<span class="op" id="3255642">!=</span>&nbsp;<span class="ident" id="3255645">nil</span><span class="op" id="3255648">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3255652">return</span>&nbsp;<span class="ident" id="3255659">w</span><span class="op" id="3255660">.</span><span class="ident" id="3255661">GobEncoderT</span><span class="op" id="3255672">.</span><span class="ident" id="3255673">Name</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3255679">case</span>&nbsp;<span class="ident" id="3255684">w</span><span class="op" id="3255685">.</span><span class="ident" id="3255686">BinaryMarshalerT</span>&nbsp;<span class="op" id="3255703">!=</span>&nbsp;<span class="ident" id="3255706">nil</span><span class="op" id="3255709">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3255713">return</span>&nbsp;<span class="ident" id="3255720">w</span><span class="op" id="3255721">.</span><span class="ident" id="3255722">BinaryMarshalerT</span><span class="op" id="3255738">.</span><span class="ident" id="3255739">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3255745">case</span>&nbsp;<span class="ident" id="3255750">w</span><span class="op" id="3255751">.</span><span class="ident" id="3255752">TextMarshalerT</span>&nbsp;<span class="op" id="3255767">!=</span>&nbsp;<span class="ident" id="3255770">nil</span><span class="op" id="3255773">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3255777">return</span>&nbsp;<span class="ident" id="3255784">w</span><span class="op" id="3255785">.</span><span class="ident" id="3255786">TextMarshalerT</span><span class="op" id="3255800">.</span><span class="ident" id="3255801">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3255807">}</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3255810">return</span>&nbsp;<span class="ident" id="3255817">unknown</span><br>
<span class="lineno"></span><span class="op" id="3255825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3255828">type</span>&nbsp;<span class="ident" id="3255833">typeInfo</span>&nbsp;<span class="keyword" id="3255842">struct</span>&nbsp;<span class="op" id="3255849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3255852">id</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3255860">typeId</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3255868">encInit</span>&nbsp;<span class="ident" id="3255876">sync</span><span class="op" id="3255880">.</span><span class="ident" id="3255881">Mutex</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="3255889">//&nbsp;protects&nbsp;creation&nbsp;of&nbsp;encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3255922">encoder</span>&nbsp;<span class="ident" id="3255930">atomic</span><span class="op" id="3255936">.</span><span class="ident" id="3255937">Value</span>&nbsp;<span class="comment" id="3255943">//&nbsp;*encEngine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3255958">wire</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3255966">*</span><span class="ident" id="3255967">wireType</span><br>
<span class="lineno"></span><span class="op" id="3255976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">690</span><span class="comment" id="3255979">//&nbsp;typeInfoMap&nbsp;is&nbsp;an&nbsp;atomic&nbsp;pointer&nbsp;to&nbsp;map[reflect.Type]*typeInfo.</span><br>
<span class="lineno"></span><span class="comment" id="3256046">//&nbsp;It&#39;s&nbsp;updated&nbsp;copy-on-write.&nbsp;Readers&nbsp;just&nbsp;do&nbsp;an&nbsp;atomic&nbsp;load</span><br>
<span class="lineno"></span><span class="comment" id="3256108">//&nbsp;to&nbsp;get&nbsp;the&nbsp;current&nbsp;version&nbsp;of&nbsp;the&nbsp;map.&nbsp;Writers&nbsp;make&nbsp;a&nbsp;full&nbsp;copy&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3256178">//&nbsp;the&nbsp;map&nbsp;and&nbsp;atomically&nbsp;update&nbsp;the&nbsp;pointer&nbsp;to&nbsp;point&nbsp;to&nbsp;the&nbsp;new&nbsp;map.</span><br>
<span class="lineno"></span><span class="comment" id="3256248">//&nbsp;Under&nbsp;heavy&nbsp;read&nbsp;contention,&nbsp;this&nbsp;is&nbsp;significantly&nbsp;faster&nbsp;than&nbsp;a&nbsp;map</span><br>
<span class="lineno">695</span><span class="comment" id="3256320">//&nbsp;protected&nbsp;by&nbsp;a&nbsp;mutex.</span><br>
<span class="lineno"></span><span class="keyword" id="3256345">var</span>&nbsp;<span class="ident" id="3256349">typeInfoMap</span>&nbsp;<span class="ident" id="3256361">atomic</span><span class="op" id="3256367">.</span><span class="ident" id="3256368">Value</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3256375">func</span>&nbsp;<span class="ident" id="3256380">lookupTypeInfo</span><span class="op" id="3256394">(</span><span class="ident" id="3256395">rt</span>&nbsp;<span class="ident" id="3256398">reflect</span><span class="op" id="3256405">.</span><span class="ident" id="3256406">Type</span><span class="op" id="3256410">)</span>&nbsp;<span class="op" id="3256412">*</span><span class="ident" id="3256413">typeInfo</span>&nbsp;<span class="op" id="3256422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3256425">m</span><span class="op" id="3256426">,</span>&nbsp;<span class="ident" id="3256428">_</span>&nbsp;<span class="op" id="3256430">:=</span>&nbsp;<span class="ident" id="3256433">typeInfoMap</span><span class="op" id="3256444">.</span><span class="ident" id="3256445">Load</span><span class="op" id="3256449">(</span><span class="op" id="3256450">)</span><span class="op" id="3256451">.</span><span class="op" id="3256452">(</span><span class="keyword" id="3256453">map</span><span class="op" id="3256456">[</span><span class="ident" id="3256457">reflect</span><span class="op" id="3256464">.</span><span class="ident" id="3256465">Type</span><span class="op" id="3256469">]</span><span class="op" id="3256470">*</span><span class="ident" id="3256471">typeInfo</span><span class="op" id="3256479">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3256482">return</span>&nbsp;<span class="ident" id="3256489">m</span><span class="op" id="3256490">[</span><span class="ident" id="3256491">rt</span><span class="op" id="3256493">]</span><br>
<span class="lineno"></span><span class="op" id="3256495">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3256498">func</span>&nbsp;<span class="ident" id="3256503">getTypeInfo</span><span class="op" id="3256514">(</span><span class="ident" id="3256515">ut</span>&nbsp;<span class="op" id="3256518">*</span><span class="ident" id="3256519">userTypeInfo</span><span class="op" id="3256531">)</span>&nbsp;<span class="op" id="3256533">(</span><span class="op" id="3256534">*</span><span class="ident" id="3256535">typeInfo</span><span class="op" id="3256543">,</span>&nbsp;<span class="builtintype" id="3256545">error</span><span class="op" id="3256550">)</span>&nbsp;<span class="op" id="3256552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3256555">rt</span>&nbsp;<span class="op" id="3256558">:=</span>&nbsp;<span class="ident" id="3256561">ut</span><span class="op" id="3256563">.</span><span class="ident" id="3256564">base</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3256570">if</span>&nbsp;<span class="ident" id="3256573">ut</span><span class="op" id="3256575">.</span><span class="ident" id="3256576">externalEnc</span>&nbsp;<span class="op" id="3256588">!=</span>&nbsp;<span class="num" id="3256591">0</span>&nbsp;<span class="op" id="3256593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3256597">//&nbsp;We&nbsp;want&nbsp;the&nbsp;user&nbsp;type,&nbsp;not&nbsp;the&nbsp;base&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3256644">rt</span>&nbsp;<span class="op" id="3256647">=</span>&nbsp;<span class="ident" id="3256649">ut</span><span class="op" id="3256651">.</span><span class="ident" id="3256652">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3256658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3256661">if</span>&nbsp;<span class="ident" id="3256664">info</span>&nbsp;<span class="op" id="3256669">:=</span>&nbsp;<span class="ident" id="3256672">lookupTypeInfo</span><span class="op" id="3256686">(</span><span class="ident" id="3256687">rt</span><span class="op" id="3256689">)</span><span class="op" id="3256690">;</span>&nbsp;<span class="ident" id="3256692">info</span>&nbsp;<span class="op" id="3256697">!=</span>&nbsp;<span class="ident" id="3256700">nil</span>&nbsp;<span class="op" id="3256704">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3256708">return</span>&nbsp;<span class="ident" id="3256715">info</span><span class="op" id="3256719">,</span>&nbsp;<span class="ident" id="3256721">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3256726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3256729">return</span>&nbsp;<span class="ident" id="3256736">buildTypeInfo</span><span class="op" id="3256749">(</span><span class="ident" id="3256750">ut</span><span class="op" id="3256752">,</span>&nbsp;<span class="ident" id="3256754">rt</span><span class="op" id="3256756">)</span><br>
<span class="lineno"></span><span class="op" id="3256758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">715</span><span class="comment" id="3256761">//&nbsp;buildTypeInfo&nbsp;constructs&nbsp;the&nbsp;type&nbsp;information&nbsp;for&nbsp;the&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="3256823">//&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;the&nbsp;type&nbsp;info&nbsp;map.</span><br>
<span class="lineno"></span><span class="keyword" id="3256862">func</span>&nbsp;<span class="ident" id="3256867">buildTypeInfo</span><span class="op" id="3256880">(</span><span class="ident" id="3256881">ut</span>&nbsp;<span class="op" id="3256884">*</span><span class="ident" id="3256885">userTypeInfo</span><span class="op" id="3256897">,</span>&nbsp;<span class="ident" id="3256899">rt</span>&nbsp;<span class="ident" id="3256902">reflect</span><span class="op" id="3256909">.</span><span class="ident" id="3256910">Type</span><span class="op" id="3256914">)</span>&nbsp;<span class="op" id="3256916">(</span><span class="op" id="3256917">*</span><span class="ident" id="3256918">typeInfo</span><span class="op" id="3256926">,</span>&nbsp;<span class="builtintype" id="3256928">error</span><span class="op" id="3256933">)</span>&nbsp;<span class="op" id="3256935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3256938">typeLock</span><span class="op" id="3256946">.</span><span class="ident" id="3256947">Lock</span><span class="op" id="3256951">(</span><span class="op" id="3256952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3256955">defer</span>&nbsp;<span class="ident" id="3256961">typeLock</span><span class="op" id="3256969">.</span><span class="ident" id="3256970">Unlock</span><span class="op" id="3256976">(</span><span class="op" id="3256977">)</span><br>
<span class="lineno">720</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3256981">if</span>&nbsp;<span class="ident" id="3256984">info</span>&nbsp;<span class="op" id="3256989">:=</span>&nbsp;<span class="ident" id="3256992">lookupTypeInfo</span><span class="op" id="3257006">(</span><span class="ident" id="3257007">rt</span><span class="op" id="3257009">)</span><span class="op" id="3257010">;</span>&nbsp;<span class="ident" id="3257012">info</span>&nbsp;<span class="op" id="3257017">!=</span>&nbsp;<span class="ident" id="3257020">nil</span>&nbsp;<span class="op" id="3257024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3257028">return</span>&nbsp;<span class="ident" id="3257035">info</span><span class="op" id="3257039">,</span>&nbsp;<span class="ident" id="3257041">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3257046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3257050">gt</span><span class="op" id="3257052">,</span>&nbsp;<span class="ident" id="3257054">err</span>&nbsp;<span class="op" id="3257058">:=</span>&nbsp;<span class="ident" id="3257061">getBaseType</span><span class="op" id="3257072">(</span><span class="ident" id="3257073">rt</span><span class="op" id="3257075">.</span><span class="ident" id="3257076">Name</span><span class="op" id="3257080">(</span><span class="op" id="3257081">)</span><span class="op" id="3257082">,</span>&nbsp;<span class="ident" id="3257084">rt</span><span class="op" id="3257086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3257089">if</span>&nbsp;<span class="ident" id="3257092">err</span>&nbsp;<span class="op" id="3257096">!=</span>&nbsp;<span class="ident" id="3257099">nil</span>&nbsp;<span class="op" id="3257103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3257107">return</span>&nbsp;<span class="ident" id="3257114">nil</span><span class="op" id="3257117">,</span>&nbsp;<span class="ident" id="3257119">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3257124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3257127">info</span>&nbsp;<span class="op" id="3257132">:=</span>&nbsp;<span class="op" id="3257135">&amp;</span><span class="ident" id="3257136">typeInfo</span><span class="op" id="3257144">{</span><span class="ident" id="3257145">id</span><span class="op" id="3257147">:</span>&nbsp;<span class="ident" id="3257149">gt</span><span class="op" id="3257151">.</span><span class="ident" id="3257152">id</span><span class="op" id="3257154">(</span><span class="op" id="3257155">)</span><span class="op" id="3257156">}</span><br>
<span class="lineno">730</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3257160">if</span>&nbsp;<span class="ident" id="3257163">ut</span><span class="op" id="3257165">.</span><span class="ident" id="3257166">externalEnc</span>&nbsp;<span class="op" id="3257178">!=</span>&nbsp;<span class="num" id="3257181">0</span>&nbsp;<span class="op" id="3257183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3257187">userType</span><span class="op" id="3257195">,</span>&nbsp;<span class="ident" id="3257197">err</span>&nbsp;<span class="op" id="3257201">:=</span>&nbsp;<span class="ident" id="3257204">getType</span><span class="op" id="3257211">(</span><span class="ident" id="3257212">rt</span><span class="op" id="3257214">.</span><span class="ident" id="3257215">Name</span><span class="op" id="3257219">(</span><span class="op" id="3257220">)</span><span class="op" id="3257221">,</span>&nbsp;<span class="ident" id="3257223">ut</span><span class="op" id="3257225">,</span>&nbsp;<span class="ident" id="3257227">rt</span><span class="op" id="3257229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3257233">if</span>&nbsp;<span class="ident" id="3257236">err</span>&nbsp;<span class="op" id="3257240">!=</span>&nbsp;<span class="ident" id="3257243">nil</span>&nbsp;<span class="op" id="3257247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3257252">return</span>&nbsp;<span class="ident" id="3257259">nil</span><span class="op" id="3257262">,</span>&nbsp;<span class="ident" id="3257264">err</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3257270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3257274">gt</span>&nbsp;<span class="op" id="3257277">:=</span>&nbsp;<span class="ident" id="3257280">userType</span><span class="op" id="3257288">.</span><span class="ident" id="3257289">id</span><span class="op" id="3257291">(</span><span class="op" id="3257292">)</span><span class="op" id="3257293">.</span><span class="ident" id="3257294">gobType</span><span class="op" id="3257301">(</span><span class="op" id="3257302">)</span><span class="op" id="3257303">.</span><span class="op" id="3257304">(</span><span class="op" id="3257305">*</span><span class="ident" id="3257306">gobEncoderType</span><span class="op" id="3257320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3257324">switch</span>&nbsp;<span class="ident" id="3257331">ut</span><span class="op" id="3257333">.</span><span class="ident" id="3257334">externalEnc</span>&nbsp;<span class="op" id="3257346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3257350">case</span>&nbsp;<span class="ident" id="3257355">xGob</span><span class="op" id="3257359">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3257364">info</span><span class="op" id="3257368">.</span><span class="ident" id="3257369">wire</span>&nbsp;<span class="op" id="3257374">=</span>&nbsp;<span class="op" id="3257376">&amp;</span><span class="ident" id="3257377">wireType</span><span class="op" id="3257385">{</span><span class="ident" id="3257386">GobEncoderT</span><span class="op" id="3257397">:</span>&nbsp;<span class="ident" id="3257399">gt</span><span class="op" id="3257401">}</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3257405">case</span>&nbsp;<span class="ident" id="3257410">xBinary</span><span class="op" id="3257417">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3257422">info</span><span class="op" id="3257426">.</span><span class="ident" id="3257427">wire</span>&nbsp;<span class="op" id="3257432">=</span>&nbsp;<span class="op" id="3257434">&amp;</span><span class="ident" id="3257435">wireType</span><span class="op" id="3257443">{</span><span class="ident" id="3257444">BinaryMarshalerT</span><span class="op" id="3257460">:</span>&nbsp;<span class="ident" id="3257462">gt</span><span class="op" id="3257464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3257468">case</span>&nbsp;<span class="ident" id="3257473">xText</span><span class="op" id="3257478">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3257483">info</span><span class="op" id="3257487">.</span><span class="ident" id="3257488">wire</span>&nbsp;<span class="op" id="3257493">=</span>&nbsp;<span class="op" id="3257495">&amp;</span><span class="ident" id="3257496">wireType</span><span class="op" id="3257504">{</span><span class="ident" id="3257505">TextMarshalerT</span><span class="op" id="3257519">:</span>&nbsp;<span class="ident" id="3257521">gt</span><span class="op" id="3257523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3257527">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3257531">rt</span>&nbsp;<span class="op" id="3257534">=</span>&nbsp;<span class="ident" id="3257536">ut</span><span class="op" id="3257538">.</span><span class="ident" id="3257539">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3257545">}</span>&nbsp;<span class="keyword" id="3257547">else</span>&nbsp;<span class="op" id="3257552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3257556">t</span>&nbsp;<span class="op" id="3257558">:=</span>&nbsp;<span class="ident" id="3257561">info</span><span class="op" id="3257565">.</span><span class="ident" id="3257566">id</span><span class="op" id="3257568">.</span><span class="ident" id="3257569">gobType</span><span class="op" id="3257576">(</span><span class="op" id="3257577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3257581">switch</span>&nbsp;<span class="ident" id="3257588">typ</span>&nbsp;<span class="op" id="3257592">:=</span>&nbsp;<span class="ident" id="3257595">rt</span><span class="op" id="3257597">;</span>&nbsp;<span class="ident" id="3257599">typ</span><span class="op" id="3257602">.</span><span class="ident" id="3257603">Kind</span><span class="op" id="3257607">(</span><span class="op" id="3257608">)</span>&nbsp;<span class="op" id="3257610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3257614">case</span>&nbsp;<span class="ident" id="3257619">reflect</span><span class="op" id="3257626">.</span><span class="ident" id="3257627">Array</span><span class="op" id="3257632">:</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3257637">info</span><span class="op" id="3257641">.</span><span class="ident" id="3257642">wire</span>&nbsp;<span class="op" id="3257647">=</span>&nbsp;<span class="op" id="3257649">&amp;</span><span class="ident" id="3257650">wireType</span><span class="op" id="3257658">{</span><span class="ident" id="3257659">ArrayT</span><span class="op" id="3257665">:</span>&nbsp;<span class="ident" id="3257667">t</span><span class="op" id="3257668">.</span><span class="op" id="3257669">(</span><span class="op" id="3257670">*</span><span class="ident" id="3257671">arrayType</span><span class="op" id="3257680">)</span><span class="op" id="3257681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3257685">case</span>&nbsp;<span class="ident" id="3257690">reflect</span><span class="op" id="3257697">.</span><span class="ident" id="3257698">Map</span><span class="op" id="3257701">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3257706">info</span><span class="op" id="3257710">.</span><span class="ident" id="3257711">wire</span>&nbsp;<span class="op" id="3257716">=</span>&nbsp;<span class="op" id="3257718">&amp;</span><span class="ident" id="3257719">wireType</span><span class="op" id="3257727">{</span><span class="ident" id="3257728">MapT</span><span class="op" id="3257732">:</span>&nbsp;<span class="ident" id="3257734">t</span><span class="op" id="3257735">.</span><span class="op" id="3257736">(</span><span class="op" id="3257737">*</span><span class="ident" id="3257738">mapType</span><span class="op" id="3257745">)</span><span class="op" id="3257746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3257750">case</span>&nbsp;<span class="ident" id="3257755">reflect</span><span class="op" id="3257762">.</span><span class="ident" id="3257763">Slice</span><span class="op" id="3257768">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3257773">//&nbsp;[]byte&nbsp;==&nbsp;[]uint8&nbsp;is&nbsp;a&nbsp;special&nbsp;case&nbsp;handled&nbsp;separately</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3257834">if</span>&nbsp;<span class="ident" id="3257837">typ</span><span class="op" id="3257840">.</span><span class="ident" id="3257841">Elem</span><span class="op" id="3257845">(</span><span class="op" id="3257846">)</span><span class="op" id="3257847">.</span><span class="ident" id="3257848">Kind</span><span class="op" id="3257852">(</span><span class="op" id="3257853">)</span>&nbsp;<span class="op" id="3257855">!=</span>&nbsp;<span class="ident" id="3257858">reflect</span><span class="op" id="3257865">.</span><span class="ident" id="3257866">Uint8</span>&nbsp;<span class="op" id="3257872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3257878">info</span><span class="op" id="3257882">.</span><span class="ident" id="3257883">wire</span>&nbsp;<span class="op" id="3257888">=</span>&nbsp;<span class="op" id="3257890">&amp;</span><span class="ident" id="3257891">wireType</span><span class="op" id="3257899">{</span><span class="ident" id="3257900">SliceT</span><span class="op" id="3257906">:</span>&nbsp;<span class="ident" id="3257908">t</span><span class="op" id="3257909">.</span><span class="op" id="3257910">(</span><span class="op" id="3257911">*</span><span class="ident" id="3257912">sliceType</span><span class="op" id="3257921">)</span><span class="op" id="3257922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3257927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3257931">case</span>&nbsp;<span class="ident" id="3257936">reflect</span><span class="op" id="3257943">.</span><span class="ident" id="3257944">Struct</span><span class="op" id="3257950">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3257955">info</span><span class="op" id="3257959">.</span><span class="ident" id="3257960">wire</span>&nbsp;<span class="op" id="3257965">=</span>&nbsp;<span class="op" id="3257967">&amp;</span><span class="ident" id="3257968">wireType</span><span class="op" id="3257976">{</span><span class="ident" id="3257977">StructT</span><span class="op" id="3257984">:</span>&nbsp;<span class="ident" id="3257986">t</span><span class="op" id="3257987">.</span><span class="op" id="3257988">(</span><span class="op" id="3257989">*</span><span class="ident" id="3257990">structType</span><span class="op" id="3258000">)</span><span class="op" id="3258001">}</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3258005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3258008">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3258012">//&nbsp;Create&nbsp;new&nbsp;map&nbsp;with&nbsp;old&nbsp;contents&nbsp;plus&nbsp;new&nbsp;entry.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3258065">newm</span>&nbsp;<span class="op" id="3258070">:=</span>&nbsp;<span class="builtinfunc" id="3258073">make</span><span class="op" id="3258077">(</span><span class="keyword" id="3258078">map</span><span class="op" id="3258081">[</span><span class="ident" id="3258082">reflect</span><span class="op" id="3258089">.</span><span class="ident" id="3258090">Type</span><span class="op" id="3258094">]</span><span class="op" id="3258095">*</span><span class="ident" id="3258096">typeInfo</span><span class="op" id="3258104">)</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3258107">m</span><span class="op" id="3258108">,</span>&nbsp;<span class="ident" id="3258110">_</span>&nbsp;<span class="op" id="3258112">:=</span>&nbsp;<span class="ident" id="3258115">typeInfoMap</span><span class="op" id="3258126">.</span><span class="ident" id="3258127">Load</span><span class="op" id="3258131">(</span><span class="op" id="3258132">)</span><span class="op" id="3258133">.</span><span class="op" id="3258134">(</span><span class="keyword" id="3258135">map</span><span class="op" id="3258138">[</span><span class="ident" id="3258139">reflect</span><span class="op" id="3258146">.</span><span class="ident" id="3258147">Type</span><span class="op" id="3258151">]</span><span class="op" id="3258152">*</span><span class="ident" id="3258153">typeInfo</span><span class="op" id="3258161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3258164">for</span>&nbsp;<span class="ident" id="3258168">k</span><span class="op" id="3258169">,</span>&nbsp;<span class="ident" id="3258171">v</span>&nbsp;<span class="op" id="3258173">:=</span>&nbsp;<span class="keyword" id="3258176">range</span>&nbsp;<span class="ident" id="3258182">m</span>&nbsp;<span class="op" id="3258184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3258188">newm</span><span class="op" id="3258192">[</span><span class="ident" id="3258193">k</span><span class="op" id="3258194">]</span>&nbsp;<span class="op" id="3258196">=</span>&nbsp;<span class="ident" id="3258198">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3258201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3258204">newm</span><span class="op" id="3258208">[</span><span class="ident" id="3258209">rt</span><span class="op" id="3258211">]</span>&nbsp;<span class="op" id="3258213">=</span>&nbsp;<span class="ident" id="3258215">info</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3258221">typeInfoMap</span><span class="op" id="3258232">.</span><span class="ident" id="3258233">Store</span><span class="op" id="3258238">(</span><span class="ident" id="3258239">newm</span><span class="op" id="3258243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3258246">return</span>&nbsp;<span class="ident" id="3258253">info</span><span class="op" id="3258257">,</span>&nbsp;<span class="ident" id="3258259">nil</span><br>
<span class="lineno"></span><span class="op" id="3258263">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3258266">//&nbsp;Called&nbsp;only&nbsp;when&nbsp;a&nbsp;panic&nbsp;is&nbsp;acceptable&nbsp;and&nbsp;unexpected.</span><br>
<span class="lineno">775</span><span class="keyword" id="3258324">func</span>&nbsp;<span class="ident" id="3258329">mustGetTypeInfo</span><span class="op" id="3258344">(</span><span class="ident" id="3258345">rt</span>&nbsp;<span class="ident" id="3258348">reflect</span><span class="op" id="3258355">.</span><span class="ident" id="3258356">Type</span><span class="op" id="3258360">)</span>&nbsp;<span class="op" id="3258362">*</span><span class="ident" id="3258363">typeInfo</span>&nbsp;<span class="op" id="3258372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3258375">t</span><span class="op" id="3258376">,</span>&nbsp;<span class="ident" id="3258378">err</span>&nbsp;<span class="op" id="3258382">:=</span>&nbsp;<span class="ident" id="3258385">getTypeInfo</span><span class="op" id="3258396">(</span><span class="ident" id="3258397">userType</span><span class="op" id="3258405">(</span><span class="ident" id="3258406">rt</span><span class="op" id="3258408">)</span><span class="op" id="3258409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3258412">if</span>&nbsp;<span class="ident" id="3258415">err</span>&nbsp;<span class="op" id="3258419">!=</span>&nbsp;<span class="ident" id="3258422">nil</span>&nbsp;<span class="op" id="3258426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3258430">panic</span><span class="op" id="3258435">(</span><span class="string" id="3258436">&#34;getTypeInfo:&nbsp;&#34;</span>&nbsp;<span class="op" id="3258452">+</span>&nbsp;<span class="ident" id="3258454">err</span><span class="op" id="3258457">.</span><span class="ident" id="3258458">Error</span><span class="op" id="3258463">(</span><span class="op" id="3258464">)</span><span class="op" id="3258465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3258468">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3258471">return</span>&nbsp;<span class="ident" id="3258478">t</span><br>
<span class="lineno"></span><span class="op" id="3258480">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3258483">//&nbsp;GobEncoder&nbsp;is&nbsp;the&nbsp;interface&nbsp;describing&nbsp;data&nbsp;that&nbsp;provides&nbsp;its&nbsp;own</span><br>
<span class="lineno"></span><span class="comment" id="3258552">//&nbsp;representation&nbsp;for&nbsp;encoding&nbsp;values&nbsp;for&nbsp;transmission&nbsp;to&nbsp;a&nbsp;GobDecoder.</span><br>
<span class="lineno">785</span><span class="comment" id="3258624">//&nbsp;A&nbsp;type&nbsp;that&nbsp;implements&nbsp;GobEncoder&nbsp;and&nbsp;GobDecoder&nbsp;has&nbsp;complete</span><br>
<span class="lineno"></span><span class="comment" id="3258689">//&nbsp;control&nbsp;over&nbsp;the&nbsp;representation&nbsp;of&nbsp;its&nbsp;data&nbsp;and&nbsp;may&nbsp;therefore</span><br>
<span class="lineno"></span><span class="comment" id="3258754">//&nbsp;contain&nbsp;things&nbsp;such&nbsp;as&nbsp;private&nbsp;fields,&nbsp;channels,&nbsp;and&nbsp;functions,</span><br>
<span class="lineno"></span><span class="comment" id="3258821">//&nbsp;which&nbsp;are&nbsp;not&nbsp;usually&nbsp;transmissible&nbsp;in&nbsp;gob&nbsp;streams.</span><br>
<span class="lineno"></span><span class="comment" id="3258876">//</span><br>
<span class="lineno">790</span><span class="comment" id="3258879">//&nbsp;Note:&nbsp;Since&nbsp;gobs&nbsp;can&nbsp;be&nbsp;stored&nbsp;permanently,&nbsp;It&nbsp;is&nbsp;good&nbsp;design</span><br>
<span class="lineno"></span><span class="comment" id="3258944">//&nbsp;to&nbsp;guarantee&nbsp;the&nbsp;encoding&nbsp;used&nbsp;by&nbsp;a&nbsp;GobEncoder&nbsp;is&nbsp;stable&nbsp;as&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3259011">//&nbsp;software&nbsp;evolves.&nbsp;&nbsp;For&nbsp;instance,&nbsp;it&nbsp;might&nbsp;make&nbsp;sense&nbsp;for&nbsp;GobEncode</span><br>
<span class="lineno"></span><span class="comment" id="3259081">//&nbsp;to&nbsp;include&nbsp;a&nbsp;version&nbsp;number&nbsp;in&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="3259129">type</span>&nbsp;<span class="ident" id="3259134">GobEncoder</span>&nbsp;<span class="keyword" id="3259145">interface</span>&nbsp;<span class="op" id="3259155">{</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3259158">//&nbsp;GobEncode&nbsp;returns&nbsp;a&nbsp;byte&nbsp;slice&nbsp;representing&nbsp;the&nbsp;encoding&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3259226">//&nbsp;receiver&nbsp;for&nbsp;transmission&nbsp;to&nbsp;a&nbsp;GobDecoder,&nbsp;usually&nbsp;of&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3259293">//&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3259312">GobEncode</span><span class="op" id="3259321">(</span><span class="op" id="3259322">)</span>&nbsp;<span class="op" id="3259324">(</span><span class="op" id="3259325">[</span><span class="op" id="3259326">]</span><span class="builtintype" id="3259327">byte</span><span class="op" id="3259331">,</span>&nbsp;<span class="builtintype" id="3259333">error</span><span class="op" id="3259338">)</span><br>
<span class="lineno"></span><span class="op" id="3259340">}</span><br>
<span class="lineno">800</span><br>
<span class="lineno"></span><span class="comment" id="3259343">//&nbsp;GobDecoder&nbsp;is&nbsp;the&nbsp;interface&nbsp;describing&nbsp;data&nbsp;that&nbsp;provides&nbsp;its&nbsp;own</span><br>
<span class="lineno"></span><span class="comment" id="3259412">//&nbsp;routine&nbsp;for&nbsp;decoding&nbsp;transmitted&nbsp;values&nbsp;sent&nbsp;by&nbsp;a&nbsp;GobEncoder.</span><br>
<span class="lineno"></span><span class="keyword" id="3259477">type</span>&nbsp;<span class="ident" id="3259482">GobDecoder</span>&nbsp;<span class="keyword" id="3259493">interface</span>&nbsp;<span class="op" id="3259503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3259506">//&nbsp;GobDecode&nbsp;overwrites&nbsp;the&nbsp;receiver,&nbsp;which&nbsp;must&nbsp;be&nbsp;a&nbsp;pointer,</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3259570">//&nbsp;with&nbsp;the&nbsp;value&nbsp;represented&nbsp;by&nbsp;the&nbsp;byte&nbsp;slice,&nbsp;which&nbsp;was&nbsp;written</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3259638">//&nbsp;by&nbsp;GobEncode,&nbsp;usually&nbsp;for&nbsp;the&nbsp;same&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3259692">GobDecode</span><span class="op" id="3259701">(</span><span class="op" id="3259702">[</span><span class="op" id="3259703">]</span><span class="builtintype" id="3259704">byte</span><span class="op" id="3259708">)</span>&nbsp;<span class="builtintype" id="3259710">error</span><br>
<span class="lineno"></span><span class="op" id="3259716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">810</span><span class="keyword" id="3259719">var</span>&nbsp;<span class="op" id="3259723">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3259726">registerLock</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3259745">sync</span><span class="op" id="3259749">.</span><span class="ident" id="3259750">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3259759">nameToConcreteType</span>&nbsp;<span class="op" id="3259778">=</span>&nbsp;<span class="builtinfunc" id="3259780">make</span><span class="op" id="3259784">(</span><span class="keyword" id="3259785">map</span><span class="op" id="3259788">[</span><span class="builtintype" id="3259789">string</span><span class="op" id="3259795">]</span><span class="ident" id="3259796">reflect</span><span class="op" id="3259803">.</span><span class="ident" id="3259804">Type</span><span class="op" id="3259808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3259811">concreteTypeToName</span>&nbsp;<span class="op" id="3259830">=</span>&nbsp;<span class="builtinfunc" id="3259832">make</span><span class="op" id="3259836">(</span><span class="keyword" id="3259837">map</span><span class="op" id="3259840">[</span><span class="ident" id="3259841">reflect</span><span class="op" id="3259848">.</span><span class="ident" id="3259849">Type</span><span class="op" id="3259853">]</span><span class="builtintype" id="3259854">string</span><span class="op" id="3259860">)</span><br>
<span class="lineno"></span><span class="op" id="3259862">)</span><br>
<span class="lineno">815</span><br>
<span class="lineno"></span><span class="comment" id="3259865">//&nbsp;RegisterName&nbsp;is&nbsp;like&nbsp;Register&nbsp;but&nbsp;uses&nbsp;the&nbsp;provided&nbsp;name&nbsp;rather&nbsp;than&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3259941">//&nbsp;type&#39;s&nbsp;default.</span><br>
<span class="lineno"></span><span class="keyword" id="3259960">func</span>&nbsp;<span class="ident" id="3259965">RegisterName</span><span class="op" id="3259977">(</span><span class="ident" id="3259978">name</span>&nbsp;<span class="builtintype" id="3259983">string</span><span class="op" id="3259989">,</span>&nbsp;<span class="ident" id="3259991">value</span>&nbsp;<span class="keyword" id="3259997">interface</span><span class="op" id="3260006">{</span><span class="op" id="3260007">}</span><span class="op" id="3260008">)</span>&nbsp;<span class="op" id="3260010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3260013">if</span>&nbsp;<span class="ident" id="3260016">name</span>&nbsp;<span class="op" id="3260021">==</span>&nbsp;<span class="string" id="3260024">&#34;&#34;</span>&nbsp;<span class="op" id="3260027">{</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3260031">//&nbsp;reserved&nbsp;for&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3260053">panic</span><span class="op" id="3260058">(</span><span class="string" id="3260059">&#34;attempt&nbsp;to&nbsp;register&nbsp;empty&nbsp;name&#34;</span><span class="op" id="3260091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3260094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3260097">registerLock</span><span class="op" id="3260109">.</span><span class="ident" id="3260110">Lock</span><span class="op" id="3260114">(</span><span class="op" id="3260115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3260118">defer</span>&nbsp;<span class="ident" id="3260124">registerLock</span><span class="op" id="3260136">.</span><span class="ident" id="3260137">Unlock</span><span class="op" id="3260143">(</span><span class="op" id="3260144">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3260147">ut</span>&nbsp;<span class="op" id="3260150">:=</span>&nbsp;<span class="ident" id="3260153">userType</span><span class="op" id="3260161">(</span><span class="ident" id="3260162">reflect</span><span class="op" id="3260169">.</span><span class="ident" id="3260170">TypeOf</span><span class="op" id="3260176">(</span><span class="ident" id="3260177">value</span><span class="op" id="3260182">)</span><span class="op" id="3260183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3260186">//&nbsp;Check&nbsp;for&nbsp;incompatible&nbsp;duplicates.&nbsp;The&nbsp;name&nbsp;must&nbsp;refer&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3260252">//&nbsp;same&nbsp;user&nbsp;type,&nbsp;and&nbsp;vice&nbsp;versa.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3260288">if</span>&nbsp;<span class="ident" id="3260291">t</span><span class="op" id="3260292">,</span>&nbsp;<span class="ident" id="3260294">ok</span>&nbsp;<span class="op" id="3260297">:=</span>&nbsp;<span class="ident" id="3260300">nameToConcreteType</span><span class="op" id="3260318">[</span><span class="ident" id="3260319">name</span><span class="op" id="3260323">]</span><span class="op" id="3260324">;</span>&nbsp;<span class="ident" id="3260326">ok</span>&nbsp;<span class="op" id="3260329">&amp;&amp;</span>&nbsp;<span class="ident" id="3260332">t</span>&nbsp;<span class="op" id="3260334">!=</span>&nbsp;<span class="ident" id="3260337">ut</span><span class="op" id="3260339">.</span><span class="ident" id="3260340">user</span>&nbsp;<span class="op" id="3260345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3260349">panic</span><span class="op" id="3260354">(</span><span class="ident" id="3260355">fmt</span><span class="op" id="3260358">.</span><span class="ident" id="3260359">Sprintf</span><span class="op" id="3260366">(</span><span class="string" id="3260367">&#34;gob:&nbsp;registering&nbsp;duplicate&nbsp;types&nbsp;for&nbsp;%q:&nbsp;%s&nbsp;!=&nbsp;%s&#34;</span><span class="op" id="3260418">,</span>&nbsp;<span class="ident" id="3260420">name</span><span class="op" id="3260424">,</span>&nbsp;<span class="ident" id="3260426">t</span><span class="op" id="3260427">,</span>&nbsp;<span class="ident" id="3260429">ut</span><span class="op" id="3260431">.</span><span class="ident" id="3260432">user</span><span class="op" id="3260436">)</span><span class="op" id="3260437">)</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3260440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3260443">if</span>&nbsp;<span class="ident" id="3260446">n</span><span class="op" id="3260447">,</span>&nbsp;<span class="ident" id="3260449">ok</span>&nbsp;<span class="op" id="3260452">:=</span>&nbsp;<span class="ident" id="3260455">concreteTypeToName</span><span class="op" id="3260473">[</span><span class="ident" id="3260474">ut</span><span class="op" id="3260476">.</span><span class="ident" id="3260477">base</span><span class="op" id="3260481">]</span><span class="op" id="3260482">;</span>&nbsp;<span class="ident" id="3260484">ok</span>&nbsp;<span class="op" id="3260487">&amp;&amp;</span>&nbsp;<span class="ident" id="3260490">n</span>&nbsp;<span class="op" id="3260492">!=</span>&nbsp;<span class="ident" id="3260495">name</span>&nbsp;<span class="op" id="3260500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3260504">panic</span><span class="op" id="3260509">(</span><span class="ident" id="3260510">fmt</span><span class="op" id="3260513">.</span><span class="ident" id="3260514">Sprintf</span><span class="op" id="3260521">(</span><span class="string" id="3260522">&#34;gob:&nbsp;registering&nbsp;duplicate&nbsp;names&nbsp;for&nbsp;%s:&nbsp;%q&nbsp;!=&nbsp;%q&#34;</span><span class="op" id="3260573">,</span>&nbsp;<span class="ident" id="3260575">ut</span><span class="op" id="3260577">.</span><span class="ident" id="3260578">user</span><span class="op" id="3260582">,</span>&nbsp;<span class="ident" id="3260584">n</span><span class="op" id="3260585">,</span>&nbsp;<span class="ident" id="3260587">name</span><span class="op" id="3260591">)</span><span class="op" id="3260592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3260595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3260598">//&nbsp;Store&nbsp;the&nbsp;name&nbsp;and&nbsp;type&nbsp;provided&nbsp;by&nbsp;the&nbsp;user....</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3260651">nameToConcreteType</span><span class="op" id="3260669">[</span><span class="ident" id="3260670">name</span><span class="op" id="3260674">]</span>&nbsp;<span class="op" id="3260676">=</span>&nbsp;<span class="ident" id="3260678">reflect</span><span class="op" id="3260685">.</span><span class="ident" id="3260686">TypeOf</span><span class="op" id="3260692">(</span><span class="ident" id="3260693">value</span><span class="op" id="3260698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3260701">//&nbsp;but&nbsp;the&nbsp;flattened&nbsp;type&nbsp;in&nbsp;the&nbsp;type&nbsp;table,&nbsp;since&nbsp;that&#39;s&nbsp;what&nbsp;decode&nbsp;needs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3260779">concreteTypeToName</span><span class="op" id="3260797">[</span><span class="ident" id="3260798">ut</span><span class="op" id="3260800">.</span><span class="ident" id="3260801">base</span><span class="op" id="3260805">]</span>&nbsp;<span class="op" id="3260807">=</span>&nbsp;<span class="ident" id="3260809">name</span><br>
<span class="lineno"></span><span class="op" id="3260814">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">840</span><span class="comment" id="3260817">//&nbsp;Register&nbsp;records&nbsp;a&nbsp;type,&nbsp;identified&nbsp;by&nbsp;a&nbsp;value&nbsp;for&nbsp;that&nbsp;type,&nbsp;under&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="3260892">//&nbsp;internal&nbsp;type&nbsp;name.&nbsp;&nbsp;That&nbsp;name&nbsp;will&nbsp;identify&nbsp;the&nbsp;concrete&nbsp;type&nbsp;of&nbsp;a&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="3260969">//&nbsp;sent&nbsp;or&nbsp;received&nbsp;as&nbsp;an&nbsp;interface&nbsp;variable.&nbsp;&nbsp;Only&nbsp;types&nbsp;that&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="3261040">//&nbsp;transferred&nbsp;as&nbsp;implementations&nbsp;of&nbsp;interface&nbsp;values&nbsp;need&nbsp;to&nbsp;be&nbsp;registered.</span><br>
<span class="lineno"></span><span class="comment" id="3261117">//&nbsp;Expecting&nbsp;to&nbsp;be&nbsp;used&nbsp;only&nbsp;during&nbsp;initialization,&nbsp;it&nbsp;panics&nbsp;if&nbsp;the&nbsp;mapping</span><br>
<span class="lineno">845</span><span class="comment" id="3261194">//&nbsp;between&nbsp;types&nbsp;and&nbsp;names&nbsp;is&nbsp;not&nbsp;a&nbsp;bijection.</span><br>
<span class="lineno"></span><span class="keyword" id="3261241">func</span>&nbsp;<span class="ident" id="3261246">Register</span><span class="op" id="3261254">(</span><span class="ident" id="3261255">value</span>&nbsp;<span class="keyword" id="3261261">interface</span><span class="op" id="3261270">{</span><span class="op" id="3261271">}</span><span class="op" id="3261272">)</span>&nbsp;<span class="op" id="3261274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3261277">//&nbsp;Default&nbsp;to&nbsp;printed&nbsp;representation&nbsp;for&nbsp;unnamed&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3261333">rt</span>&nbsp;<span class="op" id="3261336">:=</span>&nbsp;<span class="ident" id="3261339">reflect</span><span class="op" id="3261346">.</span><span class="ident" id="3261347">TypeOf</span><span class="op" id="3261353">(</span><span class="ident" id="3261354">value</span><span class="op" id="3261359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3261362">name</span>&nbsp;<span class="op" id="3261367">:=</span>&nbsp;<span class="ident" id="3261370">rt</span><span class="op" id="3261372">.</span><span class="ident" id="3261373">String</span><span class="op" id="3261379">(</span><span class="op" id="3261380">)</span><br>
<span class="lineno">850</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3261384">//&nbsp;But&nbsp;for&nbsp;named&nbsp;types&nbsp;(or&nbsp;pointers&nbsp;to&nbsp;them),&nbsp;qualify&nbsp;with&nbsp;import&nbsp;path&nbsp;(but&nbsp;see&nbsp;inner&nbsp;comment).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3261481">//&nbsp;Dereference&nbsp;one&nbsp;pointer&nbsp;looking&nbsp;for&nbsp;a&nbsp;named&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3261535">star</span>&nbsp;<span class="op" id="3261540">:=</span>&nbsp;<span class="string" id="3261543">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3261547">if</span>&nbsp;<span class="ident" id="3261550">rt</span><span class="op" id="3261552">.</span><span class="ident" id="3261553">Name</span><span class="op" id="3261557">(</span><span class="op" id="3261558">)</span>&nbsp;<span class="op" id="3261560">==</span>&nbsp;<span class="string" id="3261563">&#34;&#34;</span>&nbsp;<span class="op" id="3261566">{</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3261570">if</span>&nbsp;<span class="ident" id="3261573">pt</span>&nbsp;<span class="op" id="3261576">:=</span>&nbsp;<span class="ident" id="3261579">rt</span><span class="op" id="3261581">;</span>&nbsp;<span class="ident" id="3261583">pt</span><span class="op" id="3261585">.</span><span class="ident" id="3261586">Kind</span><span class="op" id="3261590">(</span><span class="op" id="3261591">)</span>&nbsp;<span class="op" id="3261593">==</span>&nbsp;<span class="ident" id="3261596">reflect</span><span class="op" id="3261603">.</span><span class="ident" id="3261604">Ptr</span>&nbsp;<span class="op" id="3261608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3261613">star</span>&nbsp;<span class="op" id="3261618">=</span>&nbsp;<span class="string" id="3261620">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3261627">//&nbsp;NOTE:&nbsp;The&nbsp;following&nbsp;line&nbsp;should&nbsp;be&nbsp;rt&nbsp;=&nbsp;pt.Elem()&nbsp;to&nbsp;implement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3261696">//&nbsp;what&nbsp;the&nbsp;comment&nbsp;above&nbsp;claims,&nbsp;but&nbsp;fixing&nbsp;it&nbsp;would&nbsp;break&nbsp;compatibility</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3261773">//&nbsp;with&nbsp;existing&nbsp;gobs.</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3261799">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3261805">//&nbsp;Given&nbsp;package&nbsp;p&nbsp;imported&nbsp;as&nbsp;&#34;full/p&#34;&nbsp;with&nbsp;these&nbsp;definitions:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3261872">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;package&nbsp;p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3261892">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type&nbsp;T1&nbsp;struct&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3261925">//&nbsp;this&nbsp;table&nbsp;shows&nbsp;the&nbsp;intended&nbsp;and&nbsp;actual&nbsp;strings&nbsp;used&nbsp;by&nbsp;gob&nbsp;to</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3261995">//&nbsp;name&nbsp;the&nbsp;types:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3262017">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3262023">//&nbsp;Type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Correct&nbsp;string&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Actual&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3262072">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3262078">//&nbsp;T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;full/p.T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;full/p.T1</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3262123">//&nbsp;*T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*full/p.T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*p.T1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3262164">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3262170">//&nbsp;The&nbsp;missing&nbsp;full&nbsp;path&nbsp;cannot&nbsp;be&nbsp;fixed&nbsp;without&nbsp;breaking&nbsp;existing&nbsp;gob&nbsp;decoders.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3262254">rt</span>&nbsp;<span class="op" id="3262257">=</span>&nbsp;<span class="ident" id="3262259">pt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3262264">}</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3262267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3262270">if</span>&nbsp;<span class="ident" id="3262273">rt</span><span class="op" id="3262275">.</span><span class="ident" id="3262276">Name</span><span class="op" id="3262280">(</span><span class="op" id="3262281">)</span>&nbsp;<span class="op" id="3262283">!=</span>&nbsp;<span class="string" id="3262286">&#34;&#34;</span>&nbsp;<span class="op" id="3262289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3262293">if</span>&nbsp;<span class="ident" id="3262296">rt</span><span class="op" id="3262298">.</span><span class="ident" id="3262299">PkgPath</span><span class="op" id="3262306">(</span><span class="op" id="3262307">)</span>&nbsp;<span class="op" id="3262309">==</span>&nbsp;<span class="string" id="3262312">&#34;&#34;</span>&nbsp;<span class="op" id="3262315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3262320">name</span>&nbsp;<span class="op" id="3262325">=</span>&nbsp;<span class="ident" id="3262327">star</span>&nbsp;<span class="op" id="3262332">+</span>&nbsp;<span class="ident" id="3262334">rt</span><span class="op" id="3262336">.</span><span class="ident" id="3262337">Name</span><span class="op" id="3262341">(</span><span class="op" id="3262342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3262346">}</span>&nbsp;<span class="keyword" id="3262348">else</span>&nbsp;<span class="op" id="3262353">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3262358">name</span>&nbsp;<span class="op" id="3262363">=</span>&nbsp;<span class="ident" id="3262365">star</span>&nbsp;<span class="op" id="3262370">+</span>&nbsp;<span class="ident" id="3262372">rt</span><span class="op" id="3262374">.</span><span class="ident" id="3262375">PkgPath</span><span class="op" id="3262382">(</span><span class="op" id="3262383">)</span>&nbsp;<span class="op" id="3262385">+</span>&nbsp;<span class="string" id="3262387">&#34;.&#34;</span>&nbsp;<span class="op" id="3262391">+</span>&nbsp;<span class="ident" id="3262393">rt</span><span class="op" id="3262395">.</span><span class="ident" id="3262396">Name</span><span class="op" id="3262400">(</span><span class="op" id="3262401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3262405">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3262408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3262412">RegisterName</span><span class="op" id="3262424">(</span><span class="ident" id="3262425">name</span><span class="op" id="3262429">,</span>&nbsp;<span class="ident" id="3262431">value</span><span class="op" id="3262436">)</span><br>
<span class="lineno">885</span><span class="op" id="3262438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3262441">func</span>&nbsp;<span class="ident" id="3262446">registerBasics</span><span class="op" id="3262460">(</span><span class="op" id="3262461">)</span>&nbsp;<span class="op" id="3262463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3262466">Register</span><span class="op" id="3262474">(</span><span class="builtintype" id="3262475">int</span><span class="op" id="3262478">(</span><span class="num" id="3262479">0</span><span class="op" id="3262480">)</span><span class="op" id="3262481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3262484">Register</span><span class="op" id="3262492">(</span><span class="builtintype" id="3262493">int8</span><span class="op" id="3262497">(</span><span class="num" id="3262498">0</span><span class="op" id="3262499">)</span><span class="op" id="3262500">)</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3262503">Register</span><span class="op" id="3262511">(</span><span class="builtintype" id="3262512">int16</span><span class="op" id="3262517">(</span><span class="num" id="3262518">0</span><span class="op" id="3262519">)</span><span class="op" id="3262520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3262523">Register</span><span class="op" id="3262531">(</span><span class="builtintype" id="3262532">int32</span><span class="op" id="3262537">(</span><span class="num" id="3262538">0</span><span class="op" id="3262539">)</span><span class="op" id="3262540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3262543">Register</span><span class="op" id="3262551">(</span><span class="ident" id="3262552">int64</span><span class="op" id="3262557">(</span><span class="num" id="3262558">0</span><span class="op" id="3262559">)</span><span class="op" id="3262560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3262563">Register</span><span class="op" id="3262571">(</span><span class="builtintype" id="3262572">uint</span><span class="op" id="3262576">(</span><span class="num" id="3262577">0</span><span class="op" id="3262578">)</span><span class="op" id="3262579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3262582">Register</span><span class="op" id="3262590">(</span><span class="builtintype" id="3262591">uint8</span><span class="op" id="3262596">(</span><span class="num" id="3262597">0</span><span class="op" id="3262598">)</span><span class="op" id="3262599">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3262602">Register</span><span class="op" id="3262610">(</span><span class="builtintype" id="3262611">uint16</span><span class="op" id="3262617">(</span><span class="num" id="3262618">0</span><span class="op" id="3262619">)</span><span class="op" id="3262620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3262623">Register</span><span class="op" id="3262631">(</span><span class="builtintype" id="3262632">uint32</span><span class="op" id="3262638">(</span><span class="num" id="3262639">0</span><span class="op" id="3262640">)</span><span class="op" id="3262641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3262644">Register</span><span class="op" id="3262652">(</span><span class="ident" id="3262653">uint64</span><span class="op" id="3262659">(</span><span class="num" id="3262660">0</span><span class="op" id="3262661">)</span><span class="op" id="3262662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3262665">Register</span><span class="op" id="3262673">(</span><span class="builtintype" id="3262674">float32</span><span class="op" id="3262681">(</span><span class="num" id="3262682">0</span><span class="op" id="3262683">)</span><span class="op" id="3262684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3262687">Register</span><span class="op" id="3262695">(</span><span class="builtintype" id="3262696">float64</span><span class="op" id="3262703">(</span><span class="num" id="3262704">0</span><span class="op" id="3262705">)</span><span class="op" id="3262706">)</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3262709">Register</span><span class="op" id="3262717">(</span><span class="builtintype" id="3262718">complex64</span><span class="op" id="3262727">(</span><span class="num" id="3262728">0i</span><span class="op" id="3262730">)</span><span class="op" id="3262731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3262734">Register</span><span class="op" id="3262742">(</span><span class="builtintype" id="3262743">complex128</span><span class="op" id="3262753">(</span><span class="num" id="3262754">0i</span><span class="op" id="3262756">)</span><span class="op" id="3262757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3262760">Register</span><span class="op" id="3262768">(</span><span class="builtintype" id="3262769">uintptr</span><span class="op" id="3262776">(</span><span class="num" id="3262777">0</span><span class="op" id="3262778">)</span><span class="op" id="3262779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3262782">Register</span><span class="op" id="3262790">(</span><span class="ident" id="3262791">false</span><span class="op" id="3262796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3262799">Register</span><span class="op" id="3262807">(</span><span class="string" id="3262808">&#34;&#34;</span><span class="op" id="3262810">)</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3262813">Register</span><span class="op" id="3262821">(</span><span class="op" id="3262822">[</span><span class="op" id="3262823">]</span><span class="builtintype" id="3262824">byte</span><span class="op" id="3262828">(</span><span class="ident" id="3262829">nil</span><span class="op" id="3262832">)</span><span class="op" id="3262833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3262836">Register</span><span class="op" id="3262844">(</span><span class="op" id="3262845">[</span><span class="op" id="3262846">]</span><span class="builtintype" id="3262847">int</span><span class="op" id="3262850">(</span><span class="ident" id="3262851">nil</span><span class="op" id="3262854">)</span><span class="op" id="3262855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3262858">Register</span><span class="op" id="3262866">(</span><span class="op" id="3262867">[</span><span class="op" id="3262868">]</span><span class="builtintype" id="3262869">int8</span><span class="op" id="3262873">(</span><span class="ident" id="3262874">nil</span><span class="op" id="3262877">)</span><span class="op" id="3262878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3262881">Register</span><span class="op" id="3262889">(</span><span class="op" id="3262890">[</span><span class="op" id="3262891">]</span><span class="builtintype" id="3262892">int16</span><span class="op" id="3262897">(</span><span class="ident" id="3262898">nil</span><span class="op" id="3262901">)</span><span class="op" id="3262902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3262905">Register</span><span class="op" id="3262913">(</span><span class="op" id="3262914">[</span><span class="op" id="3262915">]</span><span class="builtintype" id="3262916">int32</span><span class="op" id="3262921">(</span><span class="ident" id="3262922">nil</span><span class="op" id="3262925">)</span><span class="op" id="3262926">)</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3262929">Register</span><span class="op" id="3262937">(</span><span class="op" id="3262938">[</span><span class="op" id="3262939">]</span><span class="ident" id="3262940">int64</span><span class="op" id="3262945">(</span><span class="ident" id="3262946">nil</span><span class="op" id="3262949">)</span><span class="op" id="3262950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3262953">Register</span><span class="op" id="3262961">(</span><span class="op" id="3262962">[</span><span class="op" id="3262963">]</span><span class="builtintype" id="3262964">uint</span><span class="op" id="3262968">(</span><span class="ident" id="3262969">nil</span><span class="op" id="3262972">)</span><span class="op" id="3262973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3262976">Register</span><span class="op" id="3262984">(</span><span class="op" id="3262985">[</span><span class="op" id="3262986">]</span><span class="builtintype" id="3262987">uint8</span><span class="op" id="3262992">(</span><span class="ident" id="3262993">nil</span><span class="op" id="3262996">)</span><span class="op" id="3262997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3263000">Register</span><span class="op" id="3263008">(</span><span class="op" id="3263009">[</span><span class="op" id="3263010">]</span><span class="builtintype" id="3263011">uint16</span><span class="op" id="3263017">(</span><span class="ident" id="3263018">nil</span><span class="op" id="3263021">)</span><span class="op" id="3263022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3263025">Register</span><span class="op" id="3263033">(</span><span class="op" id="3263034">[</span><span class="op" id="3263035">]</span><span class="builtintype" id="3263036">uint32</span><span class="op" id="3263042">(</span><span class="ident" id="3263043">nil</span><span class="op" id="3263046">)</span><span class="op" id="3263047">)</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3263050">Register</span><span class="op" id="3263058">(</span><span class="op" id="3263059">[</span><span class="op" id="3263060">]</span><span class="ident" id="3263061">uint64</span><span class="op" id="3263067">(</span><span class="ident" id="3263068">nil</span><span class="op" id="3263071">)</span><span class="op" id="3263072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3263075">Register</span><span class="op" id="3263083">(</span><span class="op" id="3263084">[</span><span class="op" id="3263085">]</span><span class="builtintype" id="3263086">float32</span><span class="op" id="3263093">(</span><span class="ident" id="3263094">nil</span><span class="op" id="3263097">)</span><span class="op" id="3263098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3263101">Register</span><span class="op" id="3263109">(</span><span class="op" id="3263110">[</span><span class="op" id="3263111">]</span><span class="builtintype" id="3263112">float64</span><span class="op" id="3263119">(</span><span class="ident" id="3263120">nil</span><span class="op" id="3263123">)</span><span class="op" id="3263124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3263127">Register</span><span class="op" id="3263135">(</span><span class="op" id="3263136">[</span><span class="op" id="3263137">]</span><span class="builtintype" id="3263138">complex64</span><span class="op" id="3263147">(</span><span class="ident" id="3263148">nil</span><span class="op" id="3263151">)</span><span class="op" id="3263152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3263155">Register</span><span class="op" id="3263163">(</span><span class="op" id="3263164">[</span><span class="op" id="3263165">]</span><span class="builtintype" id="3263166">complex128</span><span class="op" id="3263176">(</span><span class="ident" id="3263177">nil</span><span class="op" id="3263180">)</span><span class="op" id="3263181">)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3263184">Register</span><span class="op" id="3263192">(</span><span class="op" id="3263193">[</span><span class="op" id="3263194">]</span><span class="builtintype" id="3263195">uintptr</span><span class="op" id="3263202">(</span><span class="ident" id="3263203">nil</span><span class="op" id="3263206">)</span><span class="op" id="3263207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3263210">Register</span><span class="op" id="3263218">(</span><span class="op" id="3263219">[</span><span class="op" id="3263220">]</span><span class="builtintype" id="3263221">bool</span><span class="op" id="3263225">(</span><span class="ident" id="3263226">nil</span><span class="op" id="3263229">)</span><span class="op" id="3263230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3263233">Register</span><span class="op" id="3263241">(</span><span class="op" id="3263242">[</span><span class="op" id="3263243">]</span><span class="builtintype" id="3263244">string</span><span class="op" id="3263250">(</span><span class="ident" id="3263251">nil</span><span class="op" id="3263254">)</span><span class="op" id="3263255">)</span><br>
<span class="lineno"></span><span class="op" id="3263257">}</span>
</div>
</body>
</html>
