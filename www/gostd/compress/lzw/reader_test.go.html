<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="8523761">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8523816">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8523870">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8523921">package</span>&nbsp;<span class="ident" id="8523929">lzw</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8523934">import</span>&nbsp;<span class="op" id="8523941">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8523944">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8523953">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8523959">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8523972">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8523983">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8523994">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8524005">&#34;testing&#34;</span><br>
<span class="lineno">15</span><span class="op" id="8524015">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8524018">type</span>&nbsp;<span class="ident" id="8524023">lzwTest</span>&nbsp;<span class="keyword" id="8524031">struct</span>&nbsp;<span class="op" id="8524038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8524041">desc</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8524052">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8524060">raw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8524071">string</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8524079">compressed</span>&nbsp;<span class="builtintype" id="8524090">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8524098">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8524109">error</span><br>
<span class="lineno"></span><span class="op" id="8524115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8524118">var</span>&nbsp;<span class="ident" id="8524122">lzwTests</span>&nbsp;<span class="op" id="8524131">=</span>&nbsp;<span class="op" id="8524133">[</span><span class="op" id="8524134">]</span><span class="ident" id="8524135">lzwTest</span><span class="op" id="8524142">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8524145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8524149">&#34;empty;LSB;8&#34;</span><span class="op" id="8524162">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8524166">&#34;&#34;</span><span class="op" id="8524168">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8524172">&#34;\x01\x01&#34;</span><span class="op" id="8524182">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8524186">nil</span><span class="op" id="8524189">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8524192">}</span><span class="op" id="8524193">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8524196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8524200">&#34;empty;MSB;8&#34;</span><span class="op" id="8524213">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8524217">&#34;&#34;</span><span class="op" id="8524219">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8524223">&#34;\x80\x80&#34;</span><span class="op" id="8524233">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8524237">nil</span><span class="op" id="8524240">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8524243">}</span><span class="op" id="8524244">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8524247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8524251">&#34;tobe;LSB;7&#34;</span><span class="op" id="8524263">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8524267">&#34;TOBEORNOTTOBEORTOBEORNOT&#34;</span><span class="op" id="8524293">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8524297">&#34;\x54\x4f\x42\x45\x4f\x52\x4e\x4f\x54\x82\x84\x86\x8b\x85\x87\x89\x81&#34;</span><span class="op" id="8524367">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8524371">nil</span><span class="op" id="8524374">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8524377">}</span><span class="op" id="8524378">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8524381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8524385">&#34;tobe;LSB;8&#34;</span><span class="op" id="8524397">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8524401">&#34;TOBEORNOTTOBEORTOBEORNOT&#34;</span><span class="op" id="8524427">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8524431">&#34;\x54\x9e\x08\x29\xf2\x44\x8a\x93\x27\x54\x04\x12\x34\xb8\xb0\xe0\xc1\x84\x01\x01&#34;</span><span class="op" id="8524513">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8524517">nil</span><span class="op" id="8524520">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8524523">}</span><span class="op" id="8524524">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8524527">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8524531">&#34;tobe;MSB;7&#34;</span><span class="op" id="8524543">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8524547">&#34;TOBEORNOTTOBEORTOBEORNOT&#34;</span><span class="op" id="8524573">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8524577">&#34;\x54\x4f\x42\x45\x4f\x52\x4e\x4f\x54\x82\x84\x86\x8b\x85\x87\x89\x81&#34;</span><span class="op" id="8524647">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8524651">nil</span><span class="op" id="8524654">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8524657">}</span><span class="op" id="8524658">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8524661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8524665">&#34;tobe;MSB;8&#34;</span><span class="op" id="8524677">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8524681">&#34;TOBEORNOTTOBEORTOBEORNOT&#34;</span><span class="op" id="8524707">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8524711">&#34;\x2a\x13\xc8\x44\x52\x79\x48\x9c\x4f\x2a\x40\xa0\x90\x68\x5c\x16\x0f\x09\x80\x80&#34;</span><span class="op" id="8524793">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8524797">nil</span><span class="op" id="8524800">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8524803">}</span><span class="op" id="8524804">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8524807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8524811">&#34;tobe-truncated;LSB;8&#34;</span><span class="op" id="8524833">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8524837">&#34;TOBEORNOTTOBEORTOBEORNOT&#34;</span><span class="op" id="8524863">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8524867">&#34;\x54\x9e\x08\x29\xf2\x44\x8a\x93\x27\x54\x04&#34;</span><span class="op" id="8524913">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8524917">io</span><span class="op" id="8524919">.</span><span class="ident" id="8524920">ErrUnexpectedEOF</span><span class="op" id="8524936">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8524939">}</span><span class="op" id="8524940">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8524943">//&nbsp;This&nbsp;example&nbsp;comes&nbsp;from&nbsp;http://en.wikipedia.org/wiki/Graphics_Interchange_Format.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8525029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8525033">&#34;gif;LSB;8&#34;</span><span class="op" id="8525044">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8525048">&#34;\x28\xff\xff\xff\x28\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff&#34;</span><span class="op" id="8525110">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8525114">&#34;\x00\x51\xfc\x1b\x28\x70\xa0\xc1\x83\x01\x01&#34;</span><span class="op" id="8525160">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8525164">nil</span><span class="op" id="8525167">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8525170">}</span><span class="op" id="8525171">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8525174">//&nbsp;This&nbsp;example&nbsp;comes&nbsp;from&nbsp;http://compgroups.net/comp.lang.ruby/Decompressing-LZW-compression-from-PDF-file</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8525283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8525287">&#34;pdf;MSB;8&#34;</span><span class="op" id="8525298">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8525302">&#34;-----A---B&#34;</span><span class="op" id="8525314">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8525318">&#34;\x80\x0b\x60\x50\x22\x0c\x0c\x85\x01&#34;</span><span class="op" id="8525356">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8525360">nil</span><span class="op" id="8525363">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8525366">}</span><span class="op" id="8525367">,</span><br>
<span class="lineno"></span><span class="op" id="8525369">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8525372">func</span>&nbsp;<span class="ident" id="8525377">TestReader</span><span class="op" id="8525387">(</span><span class="ident" id="8525388">t</span>&nbsp;<span class="op" id="8525390">*</span><span class="ident" id="8525391">testing</span><span class="op" id="8525398">.</span><span class="ident" id="8525399">T</span><span class="op" id="8525400">)</span>&nbsp;<span class="op" id="8525402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8525405">var</span>&nbsp;<span class="ident" id="8525409">b</span>&nbsp;<span class="ident" id="8525411">bytes</span><span class="op" id="8525416">.</span><span class="ident" id="8525417">Buffer</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8525425">for</span>&nbsp;<span class="ident" id="8525429">_</span><span class="op" id="8525430">,</span>&nbsp;<span class="ident" id="8525432">tt</span>&nbsp;<span class="op" id="8525435">:=</span>&nbsp;<span class="keyword" id="8525438">range</span>&nbsp;<span class="ident" id="8525444">lzwTests</span>&nbsp;<span class="op" id="8525453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8525457">d</span>&nbsp;<span class="op" id="8525459">:=</span>&nbsp;<span class="ident" id="8525462">strings</span><span class="op" id="8525469">.</span><span class="ident" id="8525470">Split</span><span class="op" id="8525475">(</span><span class="ident" id="8525476">tt</span><span class="op" id="8525478">.</span><span class="ident" id="8525479">desc</span><span class="op" id="8525483">,</span>&nbsp;<span class="string" id="8525485">&#34;;&#34;</span><span class="op" id="8525488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8525492">var</span>&nbsp;<span class="ident" id="8525496">order</span>&nbsp;<span class="ident" id="8525502">Order</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8525510">switch</span>&nbsp;<span class="ident" id="8525517">d</span><span class="op" id="8525518">[</span><span class="num" id="8525519">1</span><span class="op" id="8525520">]</span>&nbsp;<span class="op" id="8525522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8525526">case</span>&nbsp;<span class="string" id="8525531">&#34;LSB&#34;</span><span class="op" id="8525536">:</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8525541">order</span>&nbsp;<span class="op" id="8525547">=</span>&nbsp;<span class="ident" id="8525549">LSB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8525555">case</span>&nbsp;<span class="string" id="8525560">&#34;MSB&#34;</span><span class="op" id="8525565">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8525570">order</span>&nbsp;<span class="op" id="8525576">=</span>&nbsp;<span class="ident" id="8525578">MSB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8525584">default</span><span class="op" id="8525591">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8525596">t</span><span class="op" id="8525597">.</span><span class="ident" id="8525598">Errorf</span><span class="op" id="8525604">(</span><span class="string" id="8525605">&#34;%s:&nbsp;bad&nbsp;order&nbsp;%q&#34;</span><span class="op" id="8525623">,</span>&nbsp;<span class="ident" id="8525625">tt</span><span class="op" id="8525627">.</span><span class="ident" id="8525628">desc</span><span class="op" id="8525632">,</span>&nbsp;<span class="ident" id="8525634">d</span><span class="op" id="8525635">[</span><span class="num" id="8525636">1</span><span class="op" id="8525637">]</span><span class="op" id="8525638">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8525642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8525646">litWidth</span><span class="op" id="8525654">,</span>&nbsp;<span class="ident" id="8525656">_</span>&nbsp;<span class="op" id="8525658">:=</span>&nbsp;<span class="ident" id="8525661">strconv</span><span class="op" id="8525668">.</span><span class="ident" id="8525669">Atoi</span><span class="op" id="8525673">(</span><span class="ident" id="8525674">d</span><span class="op" id="8525675">[</span><span class="num" id="8525676">2</span><span class="op" id="8525677">]</span><span class="op" id="8525678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8525682">rc</span>&nbsp;<span class="op" id="8525685">:=</span>&nbsp;<span class="ident" id="8525688">NewReader</span><span class="op" id="8525697">(</span><span class="ident" id="8525698">strings</span><span class="op" id="8525705">.</span><span class="ident" id="8525706">NewReader</span><span class="op" id="8525715">(</span><span class="ident" id="8525716">tt</span><span class="op" id="8525718">.</span><span class="ident" id="8525719">compressed</span><span class="op" id="8525729">)</span><span class="op" id="8525730">,</span>&nbsp;<span class="ident" id="8525732">order</span><span class="op" id="8525737">,</span>&nbsp;<span class="ident" id="8525739">litWidth</span><span class="op" id="8525747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8525751">defer</span>&nbsp;<span class="ident" id="8525757">rc</span><span class="op" id="8525759">.</span><span class="ident" id="8525760">Close</span><span class="op" id="8525765">(</span><span class="op" id="8525766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8525770">b</span><span class="op" id="8525771">.</span><span class="ident" id="8525772">Reset</span><span class="op" id="8525777">(</span><span class="op" id="8525778">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8525782">n</span><span class="op" id="8525783">,</span>&nbsp;<span class="ident" id="8525785">err</span>&nbsp;<span class="op" id="8525789">:=</span>&nbsp;<span class="ident" id="8525792">io</span><span class="op" id="8525794">.</span><span class="ident" id="8525795">Copy</span><span class="op" id="8525799">(</span><span class="op" id="8525800">&amp;</span><span class="ident" id="8525801">b</span><span class="op" id="8525802">,</span>&nbsp;<span class="ident" id="8525804">rc</span><span class="op" id="8525806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8525810">if</span>&nbsp;<span class="ident" id="8525813">err</span>&nbsp;<span class="op" id="8525817">!=</span>&nbsp;<span class="ident" id="8525820">nil</span>&nbsp;<span class="op" id="8525824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8525829">if</span>&nbsp;<span class="ident" id="8525832">err</span>&nbsp;<span class="op" id="8525836">!=</span>&nbsp;<span class="ident" id="8525839">tt</span><span class="op" id="8525841">.</span><span class="ident" id="8525842">err</span>&nbsp;<span class="op" id="8525846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8525852">t</span><span class="op" id="8525853">.</span><span class="ident" id="8525854">Errorf</span><span class="op" id="8525860">(</span><span class="string" id="8525861">&#34;%s:&nbsp;io.Copy:&nbsp;%v&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8525886">,</span>&nbsp;<span class="ident" id="8525888">tt</span><span class="op" id="8525890">.</span><span class="ident" id="8525891">desc</span><span class="op" id="8525895">,</span>&nbsp;<span class="ident" id="8525897">err</span><span class="op" id="8525900">,</span>&nbsp;<span class="ident" id="8525902">tt</span><span class="op" id="8525904">.</span><span class="ident" id="8525905">err</span><span class="op" id="8525908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8525913">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8525918">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8525929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8525933">s</span>&nbsp;<span class="op" id="8525935">:=</span>&nbsp;<span class="ident" id="8525938">b</span><span class="op" id="8525939">.</span><span class="ident" id="8525940">String</span><span class="op" id="8525946">(</span><span class="op" id="8525947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8525951">if</span>&nbsp;<span class="ident" id="8525954">s</span>&nbsp;<span class="op" id="8525956">!=</span>&nbsp;<span class="ident" id="8525959">tt</span><span class="op" id="8525961">.</span><span class="ident" id="8525962">raw</span>&nbsp;<span class="op" id="8525966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8525971">t</span><span class="op" id="8525972">.</span><span class="ident" id="8525973">Errorf</span><span class="op" id="8525979">(</span><span class="string" id="8525980">&#34;%s:&nbsp;got&nbsp;%d-byte&nbsp;%q&nbsp;want&nbsp;%d-byte&nbsp;%q&#34;</span><span class="op" id="8526016">,</span>&nbsp;<span class="ident" id="8526018">tt</span><span class="op" id="8526020">.</span><span class="ident" id="8526021">desc</span><span class="op" id="8526025">,</span>&nbsp;<span class="ident" id="8526027">n</span><span class="op" id="8526028">,</span>&nbsp;<span class="ident" id="8526030">s</span><span class="op" id="8526031">,</span>&nbsp;<span class="builtinfunc" id="8526033">len</span><span class="op" id="8526036">(</span><span class="ident" id="8526037">tt</span><span class="op" id="8526039">.</span><span class="ident" id="8526040">raw</span><span class="op" id="8526043">)</span><span class="op" id="8526044">,</span>&nbsp;<span class="ident" id="8526046">tt</span><span class="op" id="8526048">.</span><span class="ident" id="8526049">raw</span><span class="op" id="8526052">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8526056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8526059">}</span><br>
<span class="lineno"></span><span class="op" id="8526061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8526064">func</span>&nbsp;<span class="ident" id="8526069">benchmarkDecoder</span><span class="op" id="8526085">(</span><span class="ident" id="8526086">b</span>&nbsp;<span class="op" id="8526088">*</span><span class="ident" id="8526089">testing</span><span class="op" id="8526096">.</span><span class="ident" id="8526097">B</span><span class="op" id="8526098">,</span>&nbsp;<span class="ident" id="8526100">n</span>&nbsp;<span class="builtintype" id="8526102">int</span><span class="op" id="8526105">)</span>&nbsp;<span class="op" id="8526107">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8526110">b</span><span class="op" id="8526111">.</span><span class="ident" id="8526112">StopTimer</span><span class="op" id="8526121">(</span><span class="op" id="8526122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8526125">b</span><span class="op" id="8526126">.</span><span class="ident" id="8526127">SetBytes</span><span class="op" id="8526135">(</span><span class="ident" id="8526136">int64</span><span class="op" id="8526141">(</span><span class="ident" id="8526142">n</span><span class="op" id="8526143">)</span><span class="op" id="8526144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8526147">buf0</span><span class="op" id="8526151">,</span>&nbsp;<span class="ident" id="8526153">err</span>&nbsp;<span class="op" id="8526157">:=</span>&nbsp;<span class="ident" id="8526160">ioutil</span><span class="op" id="8526166">.</span><span class="ident" id="8526167">ReadFile</span><span class="op" id="8526175">(</span><span class="string" id="8526176">&#34;../testdata/e.txt&#34;</span><span class="op" id="8526195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8526198">if</span>&nbsp;<span class="ident" id="8526201">err</span>&nbsp;<span class="op" id="8526205">!=</span>&nbsp;<span class="ident" id="8526208">nil</span>&nbsp;<span class="op" id="8526212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8526216">b</span><span class="op" id="8526217">.</span><span class="ident" id="8526218">Fatal</span><span class="op" id="8526223">(</span><span class="ident" id="8526224">err</span><span class="op" id="8526227">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8526230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8526233">if</span>&nbsp;<span class="builtinfunc" id="8526236">len</span><span class="op" id="8526239">(</span><span class="ident" id="8526240">buf0</span><span class="op" id="8526244">)</span>&nbsp;<span class="op" id="8526246">==</span>&nbsp;<span class="num" id="8526249">0</span>&nbsp;<span class="op" id="8526251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8526255">b</span><span class="op" id="8526256">.</span><span class="ident" id="8526257">Fatalf</span><span class="op" id="8526263">(</span><span class="string" id="8526264">&#34;test&nbsp;file&nbsp;has&nbsp;no&nbsp;data&#34;</span><span class="op" id="8526287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8526290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8526293">compressed</span>&nbsp;<span class="op" id="8526304">:=</span>&nbsp;<span class="builtinfunc" id="8526307">new</span><span class="op" id="8526310">(</span><span class="ident" id="8526311">bytes</span><span class="op" id="8526316">.</span><span class="ident" id="8526317">Buffer</span><span class="op" id="8526323">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8526326">w</span>&nbsp;<span class="op" id="8526328">:=</span>&nbsp;<span class="ident" id="8526331">NewWriter</span><span class="op" id="8526340">(</span><span class="ident" id="8526341">compressed</span><span class="op" id="8526351">,</span>&nbsp;<span class="ident" id="8526353">LSB</span><span class="op" id="8526356">,</span>&nbsp;<span class="num" id="8526358">8</span><span class="op" id="8526359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8526362">for</span>&nbsp;<span class="ident" id="8526366">i</span>&nbsp;<span class="op" id="8526368">:=</span>&nbsp;<span class="num" id="8526371">0</span><span class="op" id="8526372">;</span>&nbsp;<span class="ident" id="8526374">i</span>&nbsp;<span class="op" id="8526376">&lt;</span>&nbsp;<span class="ident" id="8526378">n</span><span class="op" id="8526379">;</span>&nbsp;<span class="ident" id="8526381">i</span>&nbsp;<span class="op" id="8526383">+=</span>&nbsp;<span class="builtinfunc" id="8526386">len</span><span class="op" id="8526389">(</span><span class="ident" id="8526390">buf0</span><span class="op" id="8526394">)</span>&nbsp;<span class="op" id="8526396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8526400">if</span>&nbsp;<span class="builtinfunc" id="8526403">len</span><span class="op" id="8526406">(</span><span class="ident" id="8526407">buf0</span><span class="op" id="8526411">)</span>&nbsp;<span class="op" id="8526413">&gt;</span>&nbsp;<span class="ident" id="8526415">n</span><span class="op" id="8526416">-</span><span class="ident" id="8526417">i</span>&nbsp;<span class="op" id="8526419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8526424">buf0</span>&nbsp;<span class="op" id="8526429">=</span>&nbsp;<span class="ident" id="8526431">buf0</span><span class="op" id="8526435">[</span><span class="op" id="8526436">:</span><span class="ident" id="8526437">n</span><span class="op" id="8526438">-</span><span class="ident" id="8526439">i</span><span class="op" id="8526440">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8526444">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8526448">w</span><span class="op" id="8526449">.</span><span class="ident" id="8526450">Write</span><span class="op" id="8526455">(</span><span class="ident" id="8526456">buf0</span><span class="op" id="8526460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8526463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8526466">w</span><span class="op" id="8526467">.</span><span class="ident" id="8526468">Close</span><span class="op" id="8526473">(</span><span class="op" id="8526474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8526477">buf1</span>&nbsp;<span class="op" id="8526482">:=</span>&nbsp;<span class="ident" id="8526485">compressed</span><span class="op" id="8526495">.</span><span class="ident" id="8526496">Bytes</span><span class="op" id="8526501">(</span><span class="op" id="8526502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8526505">buf0</span><span class="op" id="8526509">,</span>&nbsp;<span class="ident" id="8526511">compressed</span><span class="op" id="8526521">,</span>&nbsp;<span class="ident" id="8526523">w</span>&nbsp;<span class="op" id="8526525">=</span>&nbsp;<span class="ident" id="8526527">nil</span><span class="op" id="8526530">,</span>&nbsp;<span class="ident" id="8526532">nil</span><span class="op" id="8526535">,</span>&nbsp;<span class="ident" id="8526537">nil</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8526542">runtime</span><span class="op" id="8526549">.</span><span class="ident" id="8526550">GC</span><span class="op" id="8526552">(</span><span class="op" id="8526553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8526556">b</span><span class="op" id="8526557">.</span><span class="ident" id="8526558">StartTimer</span><span class="op" id="8526568">(</span><span class="op" id="8526569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8526572">for</span>&nbsp;<span class="ident" id="8526576">i</span>&nbsp;<span class="op" id="8526578">:=</span>&nbsp;<span class="num" id="8526581">0</span><span class="op" id="8526582">;</span>&nbsp;<span class="ident" id="8526584">i</span>&nbsp;<span class="op" id="8526586">&lt;</span>&nbsp;<span class="ident" id="8526588">b</span><span class="op" id="8526589">.</span><span class="ident" id="8526590">N</span><span class="op" id="8526591">;</span>&nbsp;<span class="ident" id="8526593">i</span><span class="op" id="8526594">++</span>&nbsp;<span class="op" id="8526597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8526601">io</span><span class="op" id="8526603">.</span><span class="ident" id="8526604">Copy</span><span class="op" id="8526608">(</span><span class="ident" id="8526609">ioutil</span><span class="op" id="8526615">.</span><span class="ident" id="8526616">Discard</span><span class="op" id="8526623">,</span>&nbsp;<span class="ident" id="8526625">NewReader</span><span class="op" id="8526634">(</span><span class="ident" id="8526635">bytes</span><span class="op" id="8526640">.</span><span class="ident" id="8526641">NewReader</span><span class="op" id="8526650">(</span><span class="ident" id="8526651">buf1</span><span class="op" id="8526655">)</span><span class="op" id="8526656">,</span>&nbsp;<span class="ident" id="8526658">LSB</span><span class="op" id="8526661">,</span>&nbsp;<span class="num" id="8526663">8</span><span class="op" id="8526664">)</span><span class="op" id="8526665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8526668">}</span><br>
<span class="lineno">140</span><span class="op" id="8526670">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8526673">func</span>&nbsp;<span class="ident" id="8526678">BenchmarkDecoder1e4</span><span class="op" id="8526697">(</span><span class="ident" id="8526698">b</span>&nbsp;<span class="op" id="8526700">*</span><span class="ident" id="8526701">testing</span><span class="op" id="8526708">.</span><span class="ident" id="8526709">B</span><span class="op" id="8526710">)</span>&nbsp;<span class="op" id="8526712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8526715">benchmarkDecoder</span><span class="op" id="8526731">(</span><span class="ident" id="8526732">b</span><span class="op" id="8526733">,</span>&nbsp;<span class="num" id="8526735">1e4</span><span class="op" id="8526738">)</span><br>
<span class="lineno"></span><span class="op" id="8526740">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="keyword" id="8526743">func</span>&nbsp;<span class="ident" id="8526748">BenchmarkDecoder1e5</span><span class="op" id="8526767">(</span><span class="ident" id="8526768">b</span>&nbsp;<span class="op" id="8526770">*</span><span class="ident" id="8526771">testing</span><span class="op" id="8526778">.</span><span class="ident" id="8526779">B</span><span class="op" id="8526780">)</span>&nbsp;<span class="op" id="8526782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8526785">benchmarkDecoder</span><span class="op" id="8526801">(</span><span class="ident" id="8526802">b</span><span class="op" id="8526803">,</span>&nbsp;<span class="num" id="8526805">1e5</span><span class="op" id="8526808">)</span><br>
<span class="lineno"></span><span class="op" id="8526810">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="keyword" id="8526813">func</span>&nbsp;<span class="ident" id="8526818">BenchmarkDecoder1e6</span><span class="op" id="8526837">(</span><span class="ident" id="8526838">b</span>&nbsp;<span class="op" id="8526840">*</span><span class="ident" id="8526841">testing</span><span class="op" id="8526848">.</span><span class="ident" id="8526849">B</span><span class="op" id="8526850">)</span>&nbsp;<span class="op" id="8526852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8526855">benchmarkDecoder</span><span class="op" id="8526871">(</span><span class="ident" id="8526872">b</span><span class="op" id="8526873">,</span>&nbsp;<span class="num" id="8526875">1e6</span><span class="op" id="8526878">)</span><br>
<span class="lineno"></span><span class="op" id="8526880">}</span>
</div>
</body>
</html>
