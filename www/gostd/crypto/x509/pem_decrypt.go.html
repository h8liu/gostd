<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/x509</h2>
<ul>
<li><a href="/gostd/crypto/x509/cert_pool.go.html">cert_pool.go</a></li>
<li><a href="/gostd/crypto/x509/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt.go.html">pem_decrypt.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt_test.go.html">pem_decrypt_test.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs1.go.html">pkcs1.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8.go.html">pkcs8.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8_test.go.html">pkcs8_test.go</a></li>
<li><a href="/gostd/crypto/x509/root.go.html">root.go</a></li>
<li><a href="/gostd/crypto/x509/root_unix.go.html">root_unix.go</a></li>
<li><a href="/gostd/crypto/x509/sec1.go.html">sec1.go</a></li>
<li><a href="/gostd/crypto/x509/sec1_test.go.html">sec1_test.go</a></li>
<li><a href="/gostd/crypto/x509/verify.go.html">verify.go</a></li>
<li><a href="/gostd/crypto/x509/verify_test.go.html">verify_test.go</a></li>
<li><a href="/gostd/crypto/x509/x509.go.html">x509.go</a></li>
<li><a href="/gostd/crypto/x509/x509_test.go.html">x509_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3800575">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3800630">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3800684">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3800735">package</span>&nbsp;<span class="ident" id="3800743">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3800749">//&nbsp;RFC&nbsp;1423&nbsp;describes&nbsp;the&nbsp;encryption&nbsp;of&nbsp;PEM&nbsp;blocks.&nbsp;The&nbsp;algorithm&nbsp;used&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3800823">//&nbsp;generate&nbsp;a&nbsp;key&nbsp;from&nbsp;the&nbsp;password&nbsp;was&nbsp;derived&nbsp;by&nbsp;looking&nbsp;at&nbsp;the&nbsp;OpenSSL</span><br>
<span class="lineno"></span><span class="comment" id="3800897">//&nbsp;implementation.</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="3800917">import</span>&nbsp;<span class="op" id="3800924">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3800927">&#34;crypto/aes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3800941">&#34;crypto/cipher&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3800958">&#34;crypto/des&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3800972">&#34;crypto/md5&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3800986">&#34;encoding/hex&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3801002">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3801018">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3801028">&#34;io&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3801034">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="3801044">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3801047">type</span>&nbsp;<span class="ident" id="3801052">PEMCipher</span>&nbsp;<span class="builtintype" id="3801062">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="3801067">//&nbsp;Possible&nbsp;values&nbsp;for&nbsp;the&nbsp;EncryptPEMBlock&nbsp;encryption&nbsp;algorithm.</span><br>
<span class="lineno"></span><span class="keyword" id="3801132">const</span>&nbsp;<span class="op" id="3801138">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801141">_</span>&nbsp;<span class="ident" id="3801143">PEMCipher</span>&nbsp;<span class="op" id="3801153">=</span>&nbsp;<span class="ident" id="3801155">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801161">PEMCipherDES</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801175">PEMCipher3DES</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801190">PEMCipherAES128</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801207">PEMCipherAES192</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801224">PEMCipherAES256</span><br>
<span class="lineno"></span><span class="op" id="3801240">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="3801243">//&nbsp;rfc1423Algo&nbsp;holds&nbsp;a&nbsp;method&nbsp;for&nbsp;enciphering&nbsp;a&nbsp;PEM&nbsp;block.</span><br>
<span class="lineno"></span><span class="keyword" id="3801302">type</span>&nbsp;<span class="ident" id="3801307">rfc1423Algo</span>&nbsp;<span class="keyword" id="3801319">struct</span>&nbsp;<span class="op" id="3801326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801329">cipher</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3801340">PEMCipher</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801351">name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3801362">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801370">cipherFunc</span>&nbsp;<span class="keyword" id="3801381">func</span><span class="op" id="3801385">(</span><span class="ident" id="3801386">key</span>&nbsp;<span class="op" id="3801390">[</span><span class="op" id="3801391">]</span><span class="builtintype" id="3801392">byte</span><span class="op" id="3801396">)</span>&nbsp;<span class="op" id="3801398">(</span><span class="ident" id="3801399">cipher</span><span class="op" id="3801405">.</span><span class="ident" id="3801406">Block</span><span class="op" id="3801411">,</span>&nbsp;<span class="builtintype" id="3801413">error</span><span class="op" id="3801418">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801421">keySize</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3801432">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801437">blockSize</span>&nbsp;&nbsp;<span class="builtintype" id="3801448">int</span><br>
<span class="lineno"></span><span class="op" id="3801452">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3801455">//&nbsp;rfc1423Algos&nbsp;holds&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;possible&nbsp;ways&nbsp;to&nbsp;encrypt&nbsp;a&nbsp;PEM</span><br>
<span class="lineno">45</span><span class="comment" id="3801523">//&nbsp;block.&nbsp;&nbsp;The&nbsp;ivSize&nbsp;numbers&nbsp;were&nbsp;taken&nbsp;from&nbsp;the&nbsp;OpenSSL&nbsp;source.</span><br>
<span class="lineno"></span><span class="keyword" id="3801589">var</span>&nbsp;<span class="ident" id="3801593">rfc1423Algos</span>&nbsp;<span class="op" id="3801606">=</span>&nbsp;<span class="op" id="3801608">[</span><span class="op" id="3801609">]</span><span class="ident" id="3801610">rfc1423Algo</span><span class="op" id="3801621">{</span><span class="op" id="3801622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801625">cipher</span><span class="op" id="3801631">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3801637">PEMCipherDES</span><span class="op" id="3801649">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801652">name</span><span class="op" id="3801656">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3801664">&#34;DES-CBC&#34;</span><span class="op" id="3801673">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801676">cipherFunc</span><span class="op" id="3801686">:</span>&nbsp;<span class="ident" id="3801688">des</span><span class="op" id="3801691">.</span><span class="ident" id="3801692">NewCipher</span><span class="op" id="3801701">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801704">keySize</span><span class="op" id="3801711">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3801716">8</span><span class="op" id="3801717">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801720">blockSize</span><span class="op" id="3801729">:</span>&nbsp;&nbsp;<span class="ident" id="3801732">des</span><span class="op" id="3801735">.</span><span class="ident" id="3801736">BlockSize</span><span class="op" id="3801745">,</span><br>
<span class="lineno"></span><span class="op" id="3801747">}</span><span class="op" id="3801748">,</span>&nbsp;<span class="op" id="3801750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801753">cipher</span><span class="op" id="3801759">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3801765">PEMCipher3DES</span><span class="op" id="3801778">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801781">name</span><span class="op" id="3801785">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3801793">&#34;DES-EDE3-CBC&#34;</span><span class="op" id="3801807">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801810">cipherFunc</span><span class="op" id="3801820">:</span>&nbsp;<span class="ident" id="3801822">des</span><span class="op" id="3801825">.</span><span class="ident" id="3801826">NewTripleDESCipher</span><span class="op" id="3801844">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801847">keySize</span><span class="op" id="3801854">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3801859">24</span><span class="op" id="3801861">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801864">blockSize</span><span class="op" id="3801873">:</span>&nbsp;&nbsp;<span class="ident" id="3801876">des</span><span class="op" id="3801879">.</span><span class="ident" id="3801880">BlockSize</span><span class="op" id="3801889">,</span><br>
<span class="lineno"></span><span class="op" id="3801891">}</span><span class="op" id="3801892">,</span>&nbsp;<span class="op" id="3801894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801897">cipher</span><span class="op" id="3801903">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3801909">PEMCipherAES128</span><span class="op" id="3801924">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801927">name</span><span class="op" id="3801931">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3801939">&#34;AES-128-CBC&#34;</span><span class="op" id="3801952">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801955">cipherFunc</span><span class="op" id="3801965">:</span>&nbsp;<span class="ident" id="3801967">aes</span><span class="op" id="3801970">.</span><span class="ident" id="3801971">NewCipher</span><span class="op" id="3801980">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801983">keySize</span><span class="op" id="3801990">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3801995">16</span><span class="op" id="3801997">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802000">blockSize</span><span class="op" id="3802009">:</span>&nbsp;&nbsp;<span class="ident" id="3802012">aes</span><span class="op" id="3802015">.</span><span class="ident" id="3802016">BlockSize</span><span class="op" id="3802025">,</span><br>
<span class="lineno"></span><span class="op" id="3802027">}</span><span class="op" id="3802028">,</span>&nbsp;<span class="op" id="3802030">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802033">cipher</span><span class="op" id="3802039">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3802045">PEMCipherAES192</span><span class="op" id="3802060">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802063">name</span><span class="op" id="3802067">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3802075">&#34;AES-192-CBC&#34;</span><span class="op" id="3802088">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802091">cipherFunc</span><span class="op" id="3802101">:</span>&nbsp;<span class="ident" id="3802103">aes</span><span class="op" id="3802106">.</span><span class="ident" id="3802107">NewCipher</span><span class="op" id="3802116">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802119">keySize</span><span class="op" id="3802126">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3802131">24</span><span class="op" id="3802133">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802136">blockSize</span><span class="op" id="3802145">:</span>&nbsp;&nbsp;<span class="ident" id="3802148">aes</span><span class="op" id="3802151">.</span><span class="ident" id="3802152">BlockSize</span><span class="op" id="3802161">,</span><br>
<span class="lineno">70</span><span class="op" id="3802163">}</span><span class="op" id="3802164">,</span>&nbsp;<span class="op" id="3802166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802169">cipher</span><span class="op" id="3802175">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3802181">PEMCipherAES256</span><span class="op" id="3802196">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802199">name</span><span class="op" id="3802203">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3802211">&#34;AES-256-CBC&#34;</span><span class="op" id="3802224">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802227">cipherFunc</span><span class="op" id="3802237">:</span>&nbsp;<span class="ident" id="3802239">aes</span><span class="op" id="3802242">.</span><span class="ident" id="3802243">NewCipher</span><span class="op" id="3802252">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802255">keySize</span><span class="op" id="3802262">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3802267">32</span><span class="op" id="3802269">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802272">blockSize</span><span class="op" id="3802281">:</span>&nbsp;&nbsp;<span class="ident" id="3802284">aes</span><span class="op" id="3802287">.</span><span class="ident" id="3802288">BlockSize</span><span class="op" id="3802297">,</span><br>
<span class="lineno"></span><span class="op" id="3802299">}</span><span class="op" id="3802300">,</span><br>
<span class="lineno"></span><span class="op" id="3802302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3802305">//&nbsp;deriveKey&nbsp;uses&nbsp;a&nbsp;key&nbsp;derivation&nbsp;function&nbsp;to&nbsp;stretch&nbsp;the&nbsp;password&nbsp;into&nbsp;a&nbsp;key</span><br>
<span class="lineno">80</span><span class="comment" id="3802384">//&nbsp;with&nbsp;the&nbsp;number&nbsp;of&nbsp;bits&nbsp;our&nbsp;cipher&nbsp;requires.&nbsp;This&nbsp;algorithm&nbsp;was&nbsp;derived&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="3802464">//&nbsp;the&nbsp;OpenSSL&nbsp;source.</span><br>
<span class="lineno"></span><span class="keyword" id="3802487">func</span>&nbsp;<span class="op" id="3802492">(</span><span class="ident" id="3802493">c</span>&nbsp;<span class="ident" id="3802495">rfc1423Algo</span><span class="op" id="3802506">)</span>&nbsp;<span class="ident" id="3802508">deriveKey</span><span class="op" id="3802517">(</span><span class="ident" id="3802518">password</span><span class="op" id="3802526">,</span>&nbsp;<span class="ident" id="3802528">salt</span>&nbsp;<span class="op" id="3802533">[</span><span class="op" id="3802534">]</span><span class="builtintype" id="3802535">byte</span><span class="op" id="3802539">)</span>&nbsp;<span class="op" id="3802541">[</span><span class="op" id="3802542">]</span><span class="builtintype" id="3802543">byte</span>&nbsp;<span class="op" id="3802548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802551">hash</span>&nbsp;<span class="op" id="3802556">:=</span>&nbsp;<span class="ident" id="3802559">md5</span><span class="op" id="3802562">.</span><span class="ident" id="3802563">New</span><span class="op" id="3802566">(</span><span class="op" id="3802567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802570">out</span>&nbsp;<span class="op" id="3802574">:=</span>&nbsp;<span class="builtinfunc" id="3802577">make</span><span class="op" id="3802581">(</span><span class="op" id="3802582">[</span><span class="op" id="3802583">]</span><span class="builtintype" id="3802584">byte</span><span class="op" id="3802588">,</span>&nbsp;<span class="ident" id="3802590">c</span><span class="op" id="3802591">.</span><span class="ident" id="3802592">keySize</span><span class="op" id="3802599">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3802602">var</span>&nbsp;<span class="ident" id="3802606">digest</span>&nbsp;<span class="op" id="3802613">[</span><span class="op" id="3802614">]</span><span class="builtintype" id="3802615">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3802622">for</span>&nbsp;<span class="ident" id="3802626">i</span>&nbsp;<span class="op" id="3802628">:=</span>&nbsp;<span class="num" id="3802631">0</span><span class="op" id="3802632">;</span>&nbsp;<span class="ident" id="3802634">i</span>&nbsp;<span class="op" id="3802636">&lt;</span>&nbsp;<span class="builtinfunc" id="3802638">len</span><span class="op" id="3802641">(</span><span class="ident" id="3802642">out</span><span class="op" id="3802645">)</span><span class="op" id="3802646">;</span>&nbsp;<span class="ident" id="3802648">i</span>&nbsp;<span class="op" id="3802650">+=</span>&nbsp;<span class="builtinfunc" id="3802653">len</span><span class="op" id="3802656">(</span><span class="ident" id="3802657">digest</span><span class="op" id="3802663">)</span>&nbsp;<span class="op" id="3802665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802669">hash</span><span class="op" id="3802673">.</span><span class="ident" id="3802674">Reset</span><span class="op" id="3802679">(</span><span class="op" id="3802680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802684">hash</span><span class="op" id="3802688">.</span><span class="ident" id="3802689">Write</span><span class="op" id="3802694">(</span><span class="ident" id="3802695">digest</span><span class="op" id="3802701">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802705">hash</span><span class="op" id="3802709">.</span><span class="ident" id="3802710">Write</span><span class="op" id="3802715">(</span><span class="ident" id="3802716">password</span><span class="op" id="3802724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802728">hash</span><span class="op" id="3802732">.</span><span class="ident" id="3802733">Write</span><span class="op" id="3802738">(</span><span class="ident" id="3802739">salt</span><span class="op" id="3802743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802747">digest</span>&nbsp;<span class="op" id="3802754">=</span>&nbsp;<span class="ident" id="3802756">hash</span><span class="op" id="3802760">.</span><span class="ident" id="3802761">Sum</span><span class="op" id="3802764">(</span><span class="ident" id="3802765">digest</span><span class="op" id="3802771">[</span><span class="op" id="3802772">:</span><span class="num" id="3802773">0</span><span class="op" id="3802774">]</span><span class="op" id="3802775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3802779">copy</span><span class="op" id="3802783">(</span><span class="ident" id="3802784">out</span><span class="op" id="3802787">[</span><span class="ident" id="3802788">i</span><span class="op" id="3802789">:</span><span class="op" id="3802790">]</span><span class="op" id="3802791">,</span>&nbsp;<span class="ident" id="3802793">digest</span><span class="op" id="3802799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3802802">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3802805">return</span>&nbsp;<span class="ident" id="3802812">out</span><br>
<span class="lineno"></span><span class="op" id="3802816">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3802819">//&nbsp;IsEncryptedPEMBlock&nbsp;returns&nbsp;if&nbsp;the&nbsp;PEM&nbsp;block&nbsp;is&nbsp;password&nbsp;encrypted.</span><br>
<span class="lineno"></span><span class="keyword" id="3802890">func</span>&nbsp;<span class="ident" id="3802895">IsEncryptedPEMBlock</span><span class="op" id="3802914">(</span><span class="ident" id="3802915">b</span>&nbsp;<span class="op" id="3802917">*</span><span class="ident" id="3802918">pem</span><span class="op" id="3802921">.</span><span class="ident" id="3802922">Block</span><span class="op" id="3802927">)</span>&nbsp;<span class="builtintype" id="3802929">bool</span>&nbsp;<span class="op" id="3802934">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802937">_</span><span class="op" id="3802938">,</span>&nbsp;<span class="ident" id="3802940">ok</span>&nbsp;<span class="op" id="3802943">:=</span>&nbsp;<span class="ident" id="3802946">b</span><span class="op" id="3802947">.</span><span class="ident" id="3802948">Headers</span><span class="op" id="3802955">[</span><span class="string" id="3802956">&#34;DEK-Info&#34;</span><span class="op" id="3802966">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3802969">return</span>&nbsp;<span class="ident" id="3802976">ok</span><br>
<span class="lineno"></span><span class="op" id="3802979">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3802982">//&nbsp;IncorrectPasswordError&nbsp;is&nbsp;returned&nbsp;when&nbsp;an&nbsp;incorrect&nbsp;password&nbsp;is&nbsp;detected.</span><br>
<span class="lineno">105</span><span class="keyword" id="3803060">var</span>&nbsp;<span class="ident" id="3803064">IncorrectPasswordError</span>&nbsp;<span class="op" id="3803087">=</span>&nbsp;<span class="ident" id="3803089">errors</span><span class="op" id="3803095">.</span><span class="ident" id="3803096">New</span><span class="op" id="3803099">(</span><span class="string" id="3803100">&#34;x509:&nbsp;decryption&nbsp;password&nbsp;incorrect&#34;</span><span class="op" id="3803137">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3803140">//&nbsp;DecryptPEMBlock&nbsp;takes&nbsp;a&nbsp;password&nbsp;encrypted&nbsp;PEM&nbsp;block&nbsp;and&nbsp;the&nbsp;password&nbsp;used&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3803221">//&nbsp;encrypt&nbsp;it&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;decrypted&nbsp;DER&nbsp;encoded&nbsp;bytes.&nbsp;It&nbsp;inspects</span><br>
<span class="lineno"></span><span class="comment" id="3803299">//&nbsp;the&nbsp;DEK-Info&nbsp;header&nbsp;to&nbsp;determine&nbsp;the&nbsp;algorithm&nbsp;used&nbsp;for&nbsp;decryption.&nbsp;If&nbsp;no</span><br>
<span class="lineno">110</span><span class="comment" id="3803376">//&nbsp;DEK-Info&nbsp;header&nbsp;is&nbsp;present,&nbsp;an&nbsp;error&nbsp;is&nbsp;returned.&nbsp;If&nbsp;an&nbsp;incorrect&nbsp;password</span><br>
<span class="lineno"></span><span class="comment" id="3803454">//&nbsp;is&nbsp;detected&nbsp;an&nbsp;IncorrectPasswordError&nbsp;is&nbsp;returned.</span><br>
<span class="lineno"></span><span class="keyword" id="3803508">func</span>&nbsp;<span class="ident" id="3803513">DecryptPEMBlock</span><span class="op" id="3803528">(</span><span class="ident" id="3803529">b</span>&nbsp;<span class="op" id="3803531">*</span><span class="ident" id="3803532">pem</span><span class="op" id="3803535">.</span><span class="ident" id="3803536">Block</span><span class="op" id="3803541">,</span>&nbsp;<span class="ident" id="3803543">password</span>&nbsp;<span class="op" id="3803552">[</span><span class="op" id="3803553">]</span><span class="builtintype" id="3803554">byte</span><span class="op" id="3803558">)</span>&nbsp;<span class="op" id="3803560">(</span><span class="op" id="3803561">[</span><span class="op" id="3803562">]</span><span class="builtintype" id="3803563">byte</span><span class="op" id="3803567">,</span>&nbsp;<span class="builtintype" id="3803569">error</span><span class="op" id="3803574">)</span>&nbsp;<span class="op" id="3803576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3803579">dek</span><span class="op" id="3803582">,</span>&nbsp;<span class="ident" id="3803584">ok</span>&nbsp;<span class="op" id="3803587">:=</span>&nbsp;<span class="ident" id="3803590">b</span><span class="op" id="3803591">.</span><span class="ident" id="3803592">Headers</span><span class="op" id="3803599">[</span><span class="string" id="3803600">&#34;DEK-Info&#34;</span><span class="op" id="3803610">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3803613">if</span>&nbsp;<span class="op" id="3803616">!</span><span class="ident" id="3803617">ok</span>&nbsp;<span class="op" id="3803620">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3803624">return</span>&nbsp;<span class="ident" id="3803631">nil</span><span class="op" id="3803634">,</span>&nbsp;<span class="ident" id="3803636">errors</span><span class="op" id="3803642">.</span><span class="ident" id="3803643">New</span><span class="op" id="3803646">(</span><span class="string" id="3803647">&#34;x509:&nbsp;no&nbsp;DEK-Info&nbsp;header&nbsp;in&nbsp;block&#34;</span><span class="op" id="3803682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3803685">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3803689">idx</span>&nbsp;<span class="op" id="3803693">:=</span>&nbsp;<span class="ident" id="3803696">strings</span><span class="op" id="3803703">.</span><span class="ident" id="3803704">Index</span><span class="op" id="3803709">(</span><span class="ident" id="3803710">dek</span><span class="op" id="3803713">,</span>&nbsp;<span class="string" id="3803715">&#34;,&#34;</span><span class="op" id="3803718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3803721">if</span>&nbsp;<span class="ident" id="3803724">idx</span>&nbsp;<span class="op" id="3803728">==</span>&nbsp;<span class="op" id="3803731">-</span><span class="num" id="3803732">1</span>&nbsp;<span class="op" id="3803734">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3803738">return</span>&nbsp;<span class="ident" id="3803745">nil</span><span class="op" id="3803748">,</span>&nbsp;<span class="ident" id="3803750">errors</span><span class="op" id="3803756">.</span><span class="ident" id="3803757">New</span><span class="op" id="3803760">(</span><span class="string" id="3803761">&#34;x509:&nbsp;malformed&nbsp;DEK-Info&nbsp;header&#34;</span><span class="op" id="3803794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3803797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3803801">mode</span><span class="op" id="3803805">,</span>&nbsp;<span class="ident" id="3803807">hexIV</span>&nbsp;<span class="op" id="3803813">:=</span>&nbsp;<span class="ident" id="3803816">dek</span><span class="op" id="3803819">[</span><span class="op" id="3803820">:</span><span class="ident" id="3803821">idx</span><span class="op" id="3803824">]</span><span class="op" id="3803825">,</span>&nbsp;<span class="ident" id="3803827">dek</span><span class="op" id="3803830">[</span><span class="ident" id="3803831">idx</span><span class="op" id="3803834">+</span><span class="num" id="3803835">1</span><span class="op" id="3803836">:</span><span class="op" id="3803837">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3803840">ciph</span>&nbsp;<span class="op" id="3803845">:=</span>&nbsp;<span class="ident" id="3803848">cipherByName</span><span class="op" id="3803860">(</span><span class="ident" id="3803861">mode</span><span class="op" id="3803865">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3803868">if</span>&nbsp;<span class="ident" id="3803871">ciph</span>&nbsp;<span class="op" id="3803876">==</span>&nbsp;<span class="ident" id="3803879">nil</span>&nbsp;<span class="op" id="3803883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3803887">return</span>&nbsp;<span class="ident" id="3803894">nil</span><span class="op" id="3803897">,</span>&nbsp;<span class="ident" id="3803899">errors</span><span class="op" id="3803905">.</span><span class="ident" id="3803906">New</span><span class="op" id="3803909">(</span><span class="string" id="3803910">&#34;x509:&nbsp;unknown&nbsp;encryption&nbsp;mode&#34;</span><span class="op" id="3803941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3803944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3803947">iv</span><span class="op" id="3803949">,</span>&nbsp;<span class="ident" id="3803951">err</span>&nbsp;<span class="op" id="3803955">:=</span>&nbsp;<span class="ident" id="3803958">hex</span><span class="op" id="3803961">.</span><span class="ident" id="3803962">DecodeString</span><span class="op" id="3803974">(</span><span class="ident" id="3803975">hexIV</span><span class="op" id="3803980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3803983">if</span>&nbsp;<span class="ident" id="3803986">err</span>&nbsp;<span class="op" id="3803990">!=</span>&nbsp;<span class="ident" id="3803993">nil</span>&nbsp;<span class="op" id="3803997">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804001">return</span>&nbsp;<span class="ident" id="3804008">nil</span><span class="op" id="3804011">,</span>&nbsp;<span class="ident" id="3804013">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3804018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804021">if</span>&nbsp;<span class="builtinfunc" id="3804024">len</span><span class="op" id="3804027">(</span><span class="ident" id="3804028">iv</span><span class="op" id="3804030">)</span>&nbsp;<span class="op" id="3804032">!=</span>&nbsp;<span class="ident" id="3804035">ciph</span><span class="op" id="3804039">.</span><span class="ident" id="3804040">blockSize</span>&nbsp;<span class="op" id="3804050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804054">return</span>&nbsp;<span class="ident" id="3804061">nil</span><span class="op" id="3804064">,</span>&nbsp;<span class="ident" id="3804066">errors</span><span class="op" id="3804072">.</span><span class="ident" id="3804073">New</span><span class="op" id="3804076">(</span><span class="string" id="3804077">&#34;x509:&nbsp;incorrect&nbsp;IV&nbsp;size&#34;</span><span class="op" id="3804102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3804105">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3804109">//&nbsp;Based&nbsp;on&nbsp;the&nbsp;OpenSSL&nbsp;implementation.&nbsp;The&nbsp;salt&nbsp;is&nbsp;the&nbsp;first&nbsp;8&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3804180">//&nbsp;of&nbsp;the&nbsp;initialization&nbsp;vector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3804214">key</span>&nbsp;<span class="op" id="3804218">:=</span>&nbsp;<span class="ident" id="3804221">ciph</span><span class="op" id="3804225">.</span><span class="ident" id="3804226">deriveKey</span><span class="op" id="3804235">(</span><span class="ident" id="3804236">password</span><span class="op" id="3804244">,</span>&nbsp;<span class="ident" id="3804246">iv</span><span class="op" id="3804248">[</span><span class="op" id="3804249">:</span><span class="num" id="3804250">8</span><span class="op" id="3804251">]</span><span class="op" id="3804252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3804255">block</span><span class="op" id="3804260">,</span>&nbsp;<span class="ident" id="3804262">err</span>&nbsp;<span class="op" id="3804266">:=</span>&nbsp;<span class="ident" id="3804269">ciph</span><span class="op" id="3804273">.</span><span class="ident" id="3804274">cipherFunc</span><span class="op" id="3804284">(</span><span class="ident" id="3804285">key</span><span class="op" id="3804288">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804291">if</span>&nbsp;<span class="ident" id="3804294">err</span>&nbsp;<span class="op" id="3804298">!=</span>&nbsp;<span class="ident" id="3804301">nil</span>&nbsp;<span class="op" id="3804305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804309">return</span>&nbsp;<span class="ident" id="3804316">nil</span><span class="op" id="3804319">,</span>&nbsp;<span class="ident" id="3804321">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3804326">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3804330">data</span>&nbsp;<span class="op" id="3804335">:=</span>&nbsp;<span class="builtinfunc" id="3804338">make</span><span class="op" id="3804342">(</span><span class="op" id="3804343">[</span><span class="op" id="3804344">]</span><span class="builtintype" id="3804345">byte</span><span class="op" id="3804349">,</span>&nbsp;<span class="builtinfunc" id="3804351">len</span><span class="op" id="3804354">(</span><span class="ident" id="3804355">b</span><span class="op" id="3804356">.</span><span class="ident" id="3804357">Bytes</span><span class="op" id="3804362">)</span><span class="op" id="3804363">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3804366">dec</span>&nbsp;<span class="op" id="3804370">:=</span>&nbsp;<span class="ident" id="3804373">cipher</span><span class="op" id="3804379">.</span><span class="ident" id="3804380">NewCBCDecrypter</span><span class="op" id="3804395">(</span><span class="ident" id="3804396">block</span><span class="op" id="3804401">,</span>&nbsp;<span class="ident" id="3804403">iv</span><span class="op" id="3804405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3804408">dec</span><span class="op" id="3804411">.</span><span class="ident" id="3804412">CryptBlocks</span><span class="op" id="3804423">(</span><span class="ident" id="3804424">data</span><span class="op" id="3804428">,</span>&nbsp;<span class="ident" id="3804430">b</span><span class="op" id="3804431">.</span><span class="ident" id="3804432">Bytes</span><span class="op" id="3804437">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3804441">//&nbsp;Blocks&nbsp;are&nbsp;padded&nbsp;using&nbsp;a&nbsp;scheme&nbsp;where&nbsp;the&nbsp;last&nbsp;n&nbsp;bytes&nbsp;of&nbsp;padding&nbsp;are&nbsp;all</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3804520">//&nbsp;equal&nbsp;to&nbsp;n.&nbsp;It&nbsp;can&nbsp;pad&nbsp;from&nbsp;1&nbsp;to&nbsp;blocksize&nbsp;bytes&nbsp;inclusive.&nbsp;See&nbsp;RFC&nbsp;1423.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3804598">//&nbsp;For&nbsp;example:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3804615">//&nbsp;&nbsp;&nbsp;&nbsp[x&nbsp;y&nbsp;z&nbsp;2&nbsp;2]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3804631">//&nbsp;&nbsp;&nbsp;&nbsp[x&nbsp;y&nbsp;7&nbsp;7&nbsp;7&nbsp;7&nbsp;7&nbsp;7&nbsp;7]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3804655">//&nbsp;If&nbsp;we&nbsp;detect&nbsp;a&nbsp;bad&nbsp;padding,&nbsp;we&nbsp;assume&nbsp;it&nbsp;is&nbsp;an&nbsp;invalid&nbsp;password.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3804724">dlen</span>&nbsp;<span class="op" id="3804729">:=</span>&nbsp;<span class="builtinfunc" id="3804732">len</span><span class="op" id="3804735">(</span><span class="ident" id="3804736">data</span><span class="op" id="3804740">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804743">if</span>&nbsp;<span class="ident" id="3804746">dlen</span>&nbsp;<span class="op" id="3804751">==</span>&nbsp;<span class="num" id="3804754">0</span>&nbsp;<span class="op" id="3804756">||</span>&nbsp;<span class="ident" id="3804759">dlen</span><span class="op" id="3804763">%</span><span class="ident" id="3804764">ciph</span><span class="op" id="3804768">.</span><span class="ident" id="3804769">blockSize</span>&nbsp;<span class="op" id="3804779">!=</span>&nbsp;<span class="num" id="3804782">0</span>&nbsp;<span class="op" id="3804784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804788">return</span>&nbsp;<span class="ident" id="3804795">nil</span><span class="op" id="3804798">,</span>&nbsp;<span class="ident" id="3804800">errors</span><span class="op" id="3804806">.</span><span class="ident" id="3804807">New</span><span class="op" id="3804810">(</span><span class="string" id="3804811">&#34;x509:&nbsp;invalid&nbsp;padding&#34;</span><span class="op" id="3804834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3804837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3804840">last</span>&nbsp;<span class="op" id="3804845">:=</span>&nbsp;<span class="builtintype" id="3804848">int</span><span class="op" id="3804851">(</span><span class="ident" id="3804852">data</span><span class="op" id="3804856">[</span><span class="ident" id="3804857">dlen</span><span class="op" id="3804861">-</span><span class="num" id="3804862">1</span><span class="op" id="3804863">]</span><span class="op" id="3804864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804867">if</span>&nbsp;<span class="ident" id="3804870">dlen</span>&nbsp;<span class="op" id="3804875">&lt;</span>&nbsp;<span class="ident" id="3804877">last</span>&nbsp;<span class="op" id="3804882">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804886">return</span>&nbsp;<span class="ident" id="3804893">nil</span><span class="op" id="3804896">,</span>&nbsp;<span class="ident" id="3804898">IncorrectPasswordError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3804922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804925">if</span>&nbsp;<span class="ident" id="3804928">last</span>&nbsp;<span class="op" id="3804933">==</span>&nbsp;<span class="num" id="3804936">0</span>&nbsp;<span class="op" id="3804938">||</span>&nbsp;<span class="ident" id="3804941">last</span>&nbsp;<span class="op" id="3804946">&gt;</span>&nbsp;<span class="ident" id="3804948">ciph</span><span class="op" id="3804952">.</span><span class="ident" id="3804953">blockSize</span>&nbsp;<span class="op" id="3804963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804967">return</span>&nbsp;<span class="ident" id="3804974">nil</span><span class="op" id="3804977">,</span>&nbsp;<span class="ident" id="3804979">IncorrectPasswordError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3805003">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805006">for</span>&nbsp;<span class="ident" id="3805010">_</span><span class="op" id="3805011">,</span>&nbsp;<span class="ident" id="3805013">val</span>&nbsp;<span class="op" id="3805017">:=</span>&nbsp;<span class="keyword" id="3805020">range</span>&nbsp;<span class="ident" id="3805026">data</span><span class="op" id="3805030">[</span><span class="ident" id="3805031">dlen</span><span class="op" id="3805035">-</span><span class="ident" id="3805036">last</span><span class="op" id="3805040">:</span><span class="op" id="3805041">]</span>&nbsp;<span class="op" id="3805043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805047">if</span>&nbsp;<span class="builtintype" id="3805050">int</span><span class="op" id="3805053">(</span><span class="ident" id="3805054">val</span><span class="op" id="3805057">)</span>&nbsp;<span class="op" id="3805059">!=</span>&nbsp;<span class="ident" id="3805062">last</span>&nbsp;<span class="op" id="3805067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805072">return</span>&nbsp;<span class="ident" id="3805079">nil</span><span class="op" id="3805082">,</span>&nbsp;<span class="ident" id="3805084">IncorrectPasswordError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3805109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3805112">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805115">return</span>&nbsp;<span class="ident" id="3805122">data</span><span class="op" id="3805126">[</span><span class="op" id="3805127">:</span><span class="ident" id="3805128">dlen</span><span class="op" id="3805132">-</span><span class="ident" id="3805133">last</span><span class="op" id="3805137">]</span><span class="op" id="3805138">,</span>&nbsp;<span class="ident" id="3805140">nil</span><br>
<span class="lineno"></span><span class="op" id="3805144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3805147">//&nbsp;EncryptPEMBlock&nbsp;returns&nbsp;a&nbsp;PEM&nbsp;block&nbsp;of&nbsp;the&nbsp;specified&nbsp;type&nbsp;holding&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3805220">//&nbsp;given&nbsp;DER-encoded&nbsp;data&nbsp;encrypted&nbsp;with&nbsp;the&nbsp;specified&nbsp;algorithm&nbsp;and</span><br>
<span class="lineno">175</span><span class="comment" id="3805289">//&nbsp;password.</span><br>
<span class="lineno"></span><span class="keyword" id="3805302">func</span>&nbsp;<span class="ident" id="3805307">EncryptPEMBlock</span><span class="op" id="3805322">(</span><span class="ident" id="3805323">rand</span>&nbsp;<span class="ident" id="3805328">io</span><span class="op" id="3805330">.</span><span class="ident" id="3805331">Reader</span><span class="op" id="3805337">,</span>&nbsp;<span class="ident" id="3805339">blockType</span>&nbsp;<span class="builtintype" id="3805349">string</span><span class="op" id="3805355">,</span>&nbsp;<span class="ident" id="3805357">data</span><span class="op" id="3805361">,</span>&nbsp;<span class="ident" id="3805363">password</span>&nbsp;<span class="op" id="3805372">[</span><span class="op" id="3805373">]</span><span class="builtintype" id="3805374">byte</span><span class="op" id="3805378">,</span>&nbsp;<span class="ident" id="3805380">alg</span>&nbsp;<span class="ident" id="3805384">PEMCipher</span><span class="op" id="3805393">)</span>&nbsp;<span class="op" id="3805395">(</span><span class="op" id="3805396">*</span><span class="ident" id="3805397">pem</span><span class="op" id="3805400">.</span><span class="ident" id="3805401">Block</span><span class="op" id="3805406">,</span>&nbsp;<span class="builtintype" id="3805408">error</span><span class="op" id="3805413">)</span>&nbsp;<span class="op" id="3805415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3805418">ciph</span>&nbsp;<span class="op" id="3805423">:=</span>&nbsp;<span class="ident" id="3805426">cipherByKey</span><span class="op" id="3805437">(</span><span class="ident" id="3805438">alg</span><span class="op" id="3805441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805444">if</span>&nbsp;<span class="ident" id="3805447">ciph</span>&nbsp;<span class="op" id="3805452">==</span>&nbsp;<span class="ident" id="3805455">nil</span>&nbsp;<span class="op" id="3805459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805463">return</span>&nbsp;<span class="ident" id="3805470">nil</span><span class="op" id="3805473">,</span>&nbsp;<span class="ident" id="3805475">errors</span><span class="op" id="3805481">.</span><span class="ident" id="3805482">New</span><span class="op" id="3805485">(</span><span class="string" id="3805486">&#34;x509:&nbsp;unknown&nbsp;encryption&nbsp;mode&#34;</span><span class="op" id="3805517">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3805520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3805523">iv</span>&nbsp;<span class="op" id="3805526">:=</span>&nbsp;<span class="builtinfunc" id="3805529">make</span><span class="op" id="3805533">(</span><span class="op" id="3805534">[</span><span class="op" id="3805535">]</span><span class="builtintype" id="3805536">byte</span><span class="op" id="3805540">,</span>&nbsp;<span class="ident" id="3805542">ciph</span><span class="op" id="3805546">.</span><span class="ident" id="3805547">blockSize</span><span class="op" id="3805556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805559">if</span>&nbsp;<span class="ident" id="3805562">_</span><span class="op" id="3805563">,</span>&nbsp;<span class="ident" id="3805565">err</span>&nbsp;<span class="op" id="3805569">:=</span>&nbsp;<span class="ident" id="3805572">io</span><span class="op" id="3805574">.</span><span class="ident" id="3805575">ReadFull</span><span class="op" id="3805583">(</span><span class="ident" id="3805584">rand</span><span class="op" id="3805588">,</span>&nbsp;<span class="ident" id="3805590">iv</span><span class="op" id="3805592">)</span><span class="op" id="3805593">;</span>&nbsp;<span class="ident" id="3805595">err</span>&nbsp;<span class="op" id="3805599">!=</span>&nbsp;<span class="ident" id="3805602">nil</span>&nbsp;<span class="op" id="3805606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805610">return</span>&nbsp;<span class="ident" id="3805617">nil</span><span class="op" id="3805620">,</span>&nbsp;<span class="ident" id="3805622">errors</span><span class="op" id="3805628">.</span><span class="ident" id="3805629">New</span><span class="op" id="3805632">(</span><span class="string" id="3805633">&#34;x509:&nbsp;cannot&nbsp;generate&nbsp;IV:&nbsp;&#34;</span>&nbsp;<span class="op" id="3805662">+</span>&nbsp;<span class="ident" id="3805664">err</span><span class="op" id="3805667">.</span><span class="ident" id="3805668">Error</span><span class="op" id="3805673">(</span><span class="op" id="3805674">)</span><span class="op" id="3805675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3805678">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3805681">//&nbsp;The&nbsp;salt&nbsp;is&nbsp;the&nbsp;first&nbsp;8&nbsp;bytes&nbsp;of&nbsp;the&nbsp;initialization&nbsp;vector,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3805745">//&nbsp;matching&nbsp;the&nbsp;key&nbsp;derivation&nbsp;in&nbsp;DecryptPEMBlock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3805797">key</span>&nbsp;<span class="op" id="3805801">:=</span>&nbsp;<span class="ident" id="3805804">ciph</span><span class="op" id="3805808">.</span><span class="ident" id="3805809">deriveKey</span><span class="op" id="3805818">(</span><span class="ident" id="3805819">password</span><span class="op" id="3805827">,</span>&nbsp;<span class="ident" id="3805829">iv</span><span class="op" id="3805831">[</span><span class="op" id="3805832">:</span><span class="num" id="3805833">8</span><span class="op" id="3805834">]</span><span class="op" id="3805835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3805838">block</span><span class="op" id="3805843">,</span>&nbsp;<span class="ident" id="3805845">err</span>&nbsp;<span class="op" id="3805849">:=</span>&nbsp;<span class="ident" id="3805852">ciph</span><span class="op" id="3805856">.</span><span class="ident" id="3805857">cipherFunc</span><span class="op" id="3805867">(</span><span class="ident" id="3805868">key</span><span class="op" id="3805871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805874">if</span>&nbsp;<span class="ident" id="3805877">err</span>&nbsp;<span class="op" id="3805881">!=</span>&nbsp;<span class="ident" id="3805884">nil</span>&nbsp;<span class="op" id="3805888">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805892">return</span>&nbsp;<span class="ident" id="3805899">nil</span><span class="op" id="3805902">,</span>&nbsp;<span class="ident" id="3805904">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3805909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3805912">enc</span>&nbsp;<span class="op" id="3805916">:=</span>&nbsp;<span class="ident" id="3805919">cipher</span><span class="op" id="3805925">.</span><span class="ident" id="3805926">NewCBCEncrypter</span><span class="op" id="3805941">(</span><span class="ident" id="3805942">block</span><span class="op" id="3805947">,</span>&nbsp;<span class="ident" id="3805949">iv</span><span class="op" id="3805951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3805954">pad</span>&nbsp;<span class="op" id="3805958">:=</span>&nbsp;<span class="ident" id="3805961">ciph</span><span class="op" id="3805965">.</span><span class="ident" id="3805966">blockSize</span>&nbsp;<span class="op" id="3805976">-</span>&nbsp;<span class="builtinfunc" id="3805978">len</span><span class="op" id="3805981">(</span><span class="ident" id="3805982">data</span><span class="op" id="3805986">)</span><span class="op" id="3805987">%</span><span class="ident" id="3805988">ciph</span><span class="op" id="3805992">.</span><span class="ident" id="3805993">blockSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3806004">encrypted</span>&nbsp;<span class="op" id="3806014">:=</span>&nbsp;<span class="builtinfunc" id="3806017">make</span><span class="op" id="3806021">(</span><span class="op" id="3806022">[</span><span class="op" id="3806023">]</span><span class="builtintype" id="3806024">byte</span><span class="op" id="3806028">,</span>&nbsp;<span class="builtinfunc" id="3806030">len</span><span class="op" id="3806033">(</span><span class="ident" id="3806034">data</span><span class="op" id="3806038">)</span><span class="op" id="3806039">,</span>&nbsp;<span class="builtinfunc" id="3806041">len</span><span class="op" id="3806044">(</span><span class="ident" id="3806045">data</span><span class="op" id="3806049">)</span><span class="op" id="3806050">+</span><span class="ident" id="3806051">pad</span><span class="op" id="3806054">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3806057">//&nbsp;We&nbsp;could&nbsp;save&nbsp;this&nbsp;copy&nbsp;by&nbsp;encrypting&nbsp;all&nbsp;the&nbsp;whole&nbsp;blocks&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3806123">//&nbsp;the&nbsp;data&nbsp;separately,&nbsp;but&nbsp;it&nbsp;doesn&#39;t&nbsp;seem&nbsp;worth&nbsp;the&nbsp;additional</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3806189">//&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3806199">copy</span><span class="op" id="3806203">(</span><span class="ident" id="3806204">encrypted</span><span class="op" id="3806213">,</span>&nbsp;<span class="ident" id="3806215">data</span><span class="op" id="3806219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3806222">//&nbsp;See&nbsp;RFC&nbsp;1423,&nbsp;section&nbsp;1.1</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3806252">for</span>&nbsp;<span class="ident" id="3806256">i</span>&nbsp;<span class="op" id="3806258">:=</span>&nbsp;<span class="num" id="3806261">0</span><span class="op" id="3806262">;</span>&nbsp;<span class="ident" id="3806264">i</span>&nbsp;<span class="op" id="3806266">&lt;</span>&nbsp;<span class="ident" id="3806268">pad</span><span class="op" id="3806271">;</span>&nbsp;<span class="ident" id="3806273">i</span><span class="op" id="3806274">++</span>&nbsp;<span class="op" id="3806277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3806281">encrypted</span>&nbsp;<span class="op" id="3806291">=</span>&nbsp;<span class="builtinfunc" id="3806293">append</span><span class="op" id="3806299">(</span><span class="ident" id="3806300">encrypted</span><span class="op" id="3806309">,</span>&nbsp;<span class="builtintype" id="3806311">byte</span><span class="op" id="3806315">(</span><span class="ident" id="3806316">pad</span><span class="op" id="3806319">)</span><span class="op" id="3806320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3806323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3806326">enc</span><span class="op" id="3806329">.</span><span class="ident" id="3806330">CryptBlocks</span><span class="op" id="3806341">(</span><span class="ident" id="3806342">encrypted</span><span class="op" id="3806351">,</span>&nbsp;<span class="ident" id="3806353">encrypted</span><span class="op" id="3806362">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3806366">return</span>&nbsp;<span class="op" id="3806373">&amp;</span><span class="ident" id="3806374">pem</span><span class="op" id="3806377">.</span><span class="ident" id="3806378">Block</span><span class="op" id="3806383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3806387">Type</span><span class="op" id="3806391">:</span>&nbsp;<span class="ident" id="3806393">blockType</span><span class="op" id="3806402">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3806406">Headers</span><span class="op" id="3806413">:</span>&nbsp;<span class="keyword" id="3806415">map</span><span class="op" id="3806418">[</span><span class="builtintype" id="3806419">string</span><span class="op" id="3806425">]</span><span class="builtintype" id="3806426">string</span><span class="op" id="3806432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3806437">&#34;Proc-Type&#34;</span><span class="op" id="3806448">:</span>&nbsp;<span class="string" id="3806450">&#34;4,ENCRYPTED&#34;</span><span class="op" id="3806463">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3806468">&#34;DEK-Info&#34;</span><span class="op" id="3806478">:</span>&nbsp;&nbsp;<span class="ident" id="3806481">ciph</span><span class="op" id="3806485">.</span><span class="ident" id="3806486">name</span>&nbsp;<span class="op" id="3806491">+</span>&nbsp;<span class="string" id="3806493">&#34;,&#34;</span>&nbsp;<span class="op" id="3806497">+</span>&nbsp;<span class="ident" id="3806499">hex</span><span class="op" id="3806502">.</span><span class="ident" id="3806503">EncodeToString</span><span class="op" id="3806517">(</span><span class="ident" id="3806518">iv</span><span class="op" id="3806520">)</span><span class="op" id="3806521">,</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3806525">}</span><span class="op" id="3806526">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3806530">Bytes</span><span class="op" id="3806535">:</span>&nbsp;<span class="ident" id="3806537">encrypted</span><span class="op" id="3806546">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3806549">}</span><span class="op" id="3806550">,</span>&nbsp;<span class="ident" id="3806552">nil</span><br>
<span class="lineno"></span><span class="op" id="3806556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="3806559">func</span>&nbsp;<span class="ident" id="3806564">cipherByName</span><span class="op" id="3806576">(</span><span class="ident" id="3806577">name</span>&nbsp;<span class="builtintype" id="3806582">string</span><span class="op" id="3806588">)</span>&nbsp;<span class="op" id="3806590">*</span><span class="ident" id="3806591">rfc1423Algo</span>&nbsp;<span class="op" id="3806603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3806606">for</span>&nbsp;<span class="ident" id="3806610">i</span>&nbsp;<span class="op" id="3806612">:=</span>&nbsp;<span class="keyword" id="3806615">range</span>&nbsp;<span class="ident" id="3806621">rfc1423Algos</span>&nbsp;<span class="op" id="3806634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3806638">alg</span>&nbsp;<span class="op" id="3806642">:=</span>&nbsp;<span class="op" id="3806645">&amp;</span><span class="ident" id="3806646">rfc1423Algos</span><span class="op" id="3806658">[</span><span class="ident" id="3806659">i</span><span class="op" id="3806660">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3806664">if</span>&nbsp;<span class="ident" id="3806667">alg</span><span class="op" id="3806670">.</span><span class="ident" id="3806671">name</span>&nbsp;<span class="op" id="3806676">==</span>&nbsp;<span class="ident" id="3806679">name</span>&nbsp;<span class="op" id="3806684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3806689">return</span>&nbsp;<span class="ident" id="3806696">alg</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3806702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3806705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3806708">return</span>&nbsp;<span class="ident" id="3806715">nil</span><br>
<span class="lineno"></span><span class="op" id="3806719">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span><span class="keyword" id="3806722">func</span>&nbsp;<span class="ident" id="3806727">cipherByKey</span><span class="op" id="3806738">(</span><span class="ident" id="3806739">key</span>&nbsp;<span class="ident" id="3806743">PEMCipher</span><span class="op" id="3806752">)</span>&nbsp;<span class="op" id="3806754">*</span><span class="ident" id="3806755">rfc1423Algo</span>&nbsp;<span class="op" id="3806767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3806770">for</span>&nbsp;<span class="ident" id="3806774">i</span>&nbsp;<span class="op" id="3806776">:=</span>&nbsp;<span class="keyword" id="3806779">range</span>&nbsp;<span class="ident" id="3806785">rfc1423Algos</span>&nbsp;<span class="op" id="3806798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3806802">alg</span>&nbsp;<span class="op" id="3806806">:=</span>&nbsp;<span class="op" id="3806809">&amp;</span><span class="ident" id="3806810">rfc1423Algos</span><span class="op" id="3806822">[</span><span class="ident" id="3806823">i</span><span class="op" id="3806824">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3806828">if</span>&nbsp;<span class="ident" id="3806831">alg</span><span class="op" id="3806834">.</span><span class="ident" id="3806835">cipher</span>&nbsp;<span class="op" id="3806842">==</span>&nbsp;<span class="ident" id="3806845">key</span>&nbsp;<span class="op" id="3806849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3806854">return</span>&nbsp;<span class="ident" id="3806861">alg</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3806867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3806870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3806873">return</span>&nbsp;<span class="ident" id="3806880">nil</span><br>
<span class="lineno"></span><span class="op" id="3806884">}</span>
</div>
</body>
</html>
