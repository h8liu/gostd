<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html" class="current">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5943752">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5943807">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5943861">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5943912">package</span>&nbsp;<span class="ident" id="5943920">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5943925">import</span>&nbsp;<span class="op" id="5943932">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5943935">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5943944">&#34;encoding/binary&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5943963">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5943973">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5943981">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5943995">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5944001">&#34;os&#34;</span><br>
<span class="lineno">15</span><span class="op" id="5944006">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5944009">var</span>&nbsp;<span class="op" id="5944013">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944016">ErrFormat</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5944029">=</span>&nbsp;<span class="ident" id="5944031">errors</span><span class="op" id="5944037">.</span><span class="ident" id="5944038">New</span><span class="op" id="5944041">(</span><span class="string" id="5944042">&#34;zip:&nbsp;not&nbsp;a&nbsp;valid&nbsp;zip&nbsp;file&#34;</span><span class="op" id="5944069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944072">ErrAlgorithm</span>&nbsp;<span class="op" id="5944085">=</span>&nbsp;<span class="ident" id="5944087">errors</span><span class="op" id="5944093">.</span><span class="ident" id="5944094">New</span><span class="op" id="5944097">(</span><span class="string" id="5944098">&#34;zip:&nbsp;unsupported&nbsp;compression&nbsp;algorithm&#34;</span><span class="op" id="5944138">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944141">ErrChecksum</span>&nbsp;&nbsp;<span class="op" id="5944154">=</span>&nbsp;<span class="ident" id="5944156">errors</span><span class="op" id="5944162">.</span><span class="ident" id="5944163">New</span><span class="op" id="5944166">(</span><span class="string" id="5944167">&#34;zip:&nbsp;checksum&nbsp;error&#34;</span><span class="op" id="5944188">)</span><br>
<span class="lineno"></span><span class="op" id="5944190">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5944193">type</span>&nbsp;<span class="ident" id="5944198">Reader</span>&nbsp;<span class="keyword" id="5944205">struct</span>&nbsp;<span class="op" id="5944212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944215">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5944223">io</span><span class="op" id="5944225">.</span><span class="ident" id="5944226">ReaderAt</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944236">File</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5944244">[</span><span class="op" id="5944245">]</span><span class="op" id="5944246">*</span><span class="ident" id="5944247">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944253">Comment</span>&nbsp;<span class="builtintype" id="5944261">string</span><br>
<span class="lineno"></span><span class="op" id="5944268">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5944271">type</span>&nbsp;<span class="ident" id="5944276">ReadCloser</span>&nbsp;<span class="keyword" id="5944287">struct</span>&nbsp;<span class="op" id="5944294">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944297">f</span>&nbsp;<span class="op" id="5944299">*</span><span class="ident" id="5944300">os</span><span class="op" id="5944302">.</span><span class="ident" id="5944303">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944309">Reader</span><br>
<span class="lineno"></span><span class="op" id="5944316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5944319">type</span>&nbsp;<span class="ident" id="5944324">File</span>&nbsp;<span class="keyword" id="5944329">struct</span>&nbsp;<span class="op" id="5944336">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944339">FileHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944351">zipr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5944364">io</span><span class="op" id="5944366">.</span><span class="ident" id="5944367">ReaderAt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944377">zipsize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5944390">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944397">headerOffset</span>&nbsp;<span class="ident" id="5944410">int64</span><br>
<span class="lineno"></span><span class="op" id="5944416">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="5944419">func</span>&nbsp;<span class="op" id="5944424">(</span><span class="ident" id="5944425">f</span>&nbsp;<span class="op" id="5944427">*</span><span class="ident" id="5944428">File</span><span class="op" id="5944432">)</span>&nbsp;<span class="ident" id="5944434">hasDataDescriptor</span><span class="op" id="5944451">(</span><span class="op" id="5944452">)</span>&nbsp;<span class="builtintype" id="5944454">bool</span>&nbsp;<span class="op" id="5944459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944462">return</span>&nbsp;<span class="ident" id="5944469">f</span><span class="op" id="5944470">.</span><span class="ident" id="5944471">Flags</span><span class="op" id="5944476">&amp;</span><span class="num" id="5944477">0x8</span>&nbsp;<span class="op" id="5944481">!=</span>&nbsp;<span class="num" id="5944484">0</span><br>
<span class="lineno"></span><span class="op" id="5944486">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="5944489">//&nbsp;OpenReader&nbsp;will&nbsp;open&nbsp;the&nbsp;Zip&nbsp;file&nbsp;specified&nbsp;by&nbsp;name&nbsp;and&nbsp;return&nbsp;a&nbsp;ReadCloser.</span><br>
<span class="lineno"></span><span class="keyword" id="5944569">func</span>&nbsp;<span class="ident" id="5944574">OpenReader</span><span class="op" id="5944584">(</span><span class="ident" id="5944585">name</span>&nbsp;<span class="builtintype" id="5944590">string</span><span class="op" id="5944596">)</span>&nbsp;<span class="op" id="5944598">(</span><span class="op" id="5944599">*</span><span class="ident" id="5944600">ReadCloser</span><span class="op" id="5944610">,</span>&nbsp;<span class="builtintype" id="5944612">error</span><span class="op" id="5944617">)</span>&nbsp;<span class="op" id="5944619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944622">f</span><span class="op" id="5944623">,</span>&nbsp;<span class="ident" id="5944625">err</span>&nbsp;<span class="op" id="5944629">:=</span>&nbsp;<span class="ident" id="5944632">os</span><span class="op" id="5944634">.</span><span class="ident" id="5944635">Open</span><span class="op" id="5944639">(</span><span class="ident" id="5944640">name</span><span class="op" id="5944644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944647">if</span>&nbsp;<span class="ident" id="5944650">err</span>&nbsp;<span class="op" id="5944654">!=</span>&nbsp;<span class="ident" id="5944657">nil</span>&nbsp;<span class="op" id="5944661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944665">return</span>&nbsp;<span class="ident" id="5944672">nil</span><span class="op" id="5944675">,</span>&nbsp;<span class="ident" id="5944677">err</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5944682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944685">fi</span><span class="op" id="5944687">,</span>&nbsp;<span class="ident" id="5944689">err</span>&nbsp;<span class="op" id="5944693">:=</span>&nbsp;<span class="ident" id="5944696">f</span><span class="op" id="5944697">.</span><span class="ident" id="5944698">Stat</span><span class="op" id="5944702">(</span><span class="op" id="5944703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944706">if</span>&nbsp;<span class="ident" id="5944709">err</span>&nbsp;<span class="op" id="5944713">!=</span>&nbsp;<span class="ident" id="5944716">nil</span>&nbsp;<span class="op" id="5944720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944724">f</span><span class="op" id="5944725">.</span><span class="ident" id="5944726">Close</span><span class="op" id="5944731">(</span><span class="op" id="5944732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944736">return</span>&nbsp;<span class="ident" id="5944743">nil</span><span class="op" id="5944746">,</span>&nbsp;<span class="ident" id="5944748">err</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5944753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944756">r</span>&nbsp;<span class="op" id="5944758">:=</span>&nbsp;<span class="builtinfunc" id="5944761">new</span><span class="op" id="5944764">(</span><span class="ident" id="5944765">ReadCloser</span><span class="op" id="5944775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944778">if</span>&nbsp;<span class="ident" id="5944781">err</span>&nbsp;<span class="op" id="5944785">:=</span>&nbsp;<span class="ident" id="5944788">r</span><span class="op" id="5944789">.</span><span class="ident" id="5944790">init</span><span class="op" id="5944794">(</span><span class="ident" id="5944795">f</span><span class="op" id="5944796">,</span>&nbsp;<span class="ident" id="5944798">fi</span><span class="op" id="5944800">.</span><span class="ident" id="5944801">Size</span><span class="op" id="5944805">(</span><span class="op" id="5944806">)</span><span class="op" id="5944807">)</span><span class="op" id="5944808">;</span>&nbsp;<span class="ident" id="5944810">err</span>&nbsp;<span class="op" id="5944814">!=</span>&nbsp;<span class="ident" id="5944817">nil</span>&nbsp;<span class="op" id="5944821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944825">f</span><span class="op" id="5944826">.</span><span class="ident" id="5944827">Close</span><span class="op" id="5944832">(</span><span class="op" id="5944833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944837">return</span>&nbsp;<span class="ident" id="5944844">nil</span><span class="op" id="5944847">,</span>&nbsp;<span class="ident" id="5944849">err</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5944854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944857">r</span><span class="op" id="5944858">.</span><span class="ident" id="5944859">f</span>&nbsp;<span class="op" id="5944861">=</span>&nbsp;<span class="ident" id="5944863">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944866">return</span>&nbsp;<span class="ident" id="5944873">r</span><span class="op" id="5944874">,</span>&nbsp;<span class="ident" id="5944876">nil</span><br>
<span class="lineno"></span><span class="op" id="5944880">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="5944883">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;from&nbsp;r,&nbsp;which&nbsp;is&nbsp;assumed&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5944953">//&nbsp;have&nbsp;the&nbsp;given&nbsp;size&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="5944986">func</span>&nbsp;<span class="ident" id="5944991">NewReader</span><span class="op" id="5945000">(</span><span class="ident" id="5945001">r</span>&nbsp;<span class="ident" id="5945003">io</span><span class="op" id="5945005">.</span><span class="ident" id="5945006">ReaderAt</span><span class="op" id="5945014">,</span>&nbsp;<span class="ident" id="5945016">size</span>&nbsp;<span class="ident" id="5945021">int64</span><span class="op" id="5945026">)</span>&nbsp;<span class="op" id="5945028">(</span><span class="op" id="5945029">*</span><span class="ident" id="5945030">Reader</span><span class="op" id="5945036">,</span>&nbsp;<span class="builtintype" id="5945038">error</span><span class="op" id="5945043">)</span>&nbsp;<span class="op" id="5945045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945048">zr</span>&nbsp;<span class="op" id="5945051">:=</span>&nbsp;<span class="builtinfunc" id="5945054">new</span><span class="op" id="5945057">(</span><span class="ident" id="5945058">Reader</span><span class="op" id="5945064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5945067">if</span>&nbsp;<span class="ident" id="5945070">err</span>&nbsp;<span class="op" id="5945074">:=</span>&nbsp;<span class="ident" id="5945077">zr</span><span class="op" id="5945079">.</span><span class="ident" id="5945080">init</span><span class="op" id="5945084">(</span><span class="ident" id="5945085">r</span><span class="op" id="5945086">,</span>&nbsp;<span class="ident" id="5945088">size</span><span class="op" id="5945092">)</span><span class="op" id="5945093">;</span>&nbsp;<span class="ident" id="5945095">err</span>&nbsp;<span class="op" id="5945099">!=</span>&nbsp;<span class="ident" id="5945102">nil</span>&nbsp;<span class="op" id="5945106">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5945110">return</span>&nbsp;<span class="ident" id="5945117">nil</span><span class="op" id="5945120">,</span>&nbsp;<span class="ident" id="5945122">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5945127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5945130">return</span>&nbsp;<span class="ident" id="5945137">zr</span><span class="op" id="5945139">,</span>&nbsp;<span class="ident" id="5945141">nil</span><br>
<span class="lineno"></span><span class="op" id="5945145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="5945148">func</span>&nbsp;<span class="op" id="5945153">(</span><span class="ident" id="5945154">z</span>&nbsp;<span class="op" id="5945156">*</span><span class="ident" id="5945157">Reader</span><span class="op" id="5945163">)</span>&nbsp;<span class="ident" id="5945165">init</span><span class="op" id="5945169">(</span><span class="ident" id="5945170">r</span>&nbsp;<span class="ident" id="5945172">io</span><span class="op" id="5945174">.</span><span class="ident" id="5945175">ReaderAt</span><span class="op" id="5945183">,</span>&nbsp;<span class="ident" id="5945185">size</span>&nbsp;<span class="ident" id="5945190">int64</span><span class="op" id="5945195">)</span>&nbsp;<span class="builtintype" id="5945197">error</span>&nbsp;<span class="op" id="5945203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945206">end</span><span class="op" id="5945209">,</span>&nbsp;<span class="ident" id="5945211">err</span>&nbsp;<span class="op" id="5945215">:=</span>&nbsp;<span class="ident" id="5945218">readDirectoryEnd</span><span class="op" id="5945234">(</span><span class="ident" id="5945235">r</span><span class="op" id="5945236">,</span>&nbsp;<span class="ident" id="5945238">size</span><span class="op" id="5945242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5945245">if</span>&nbsp;<span class="ident" id="5945248">err</span>&nbsp;<span class="op" id="5945252">!=</span>&nbsp;<span class="ident" id="5945255">nil</span>&nbsp;<span class="op" id="5945259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5945263">return</span>&nbsp;<span class="ident" id="5945270">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5945275">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945278">z</span><span class="op" id="5945279">.</span><span class="ident" id="5945280">r</span>&nbsp;<span class="op" id="5945282">=</span>&nbsp;<span class="ident" id="5945284">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945287">z</span><span class="op" id="5945288">.</span><span class="ident" id="5945289">File</span>&nbsp;<span class="op" id="5945294">=</span>&nbsp;<span class="builtinfunc" id="5945296">make</span><span class="op" id="5945300">(</span><span class="op" id="5945301">[</span><span class="op" id="5945302">]</span><span class="op" id="5945303">*</span><span class="ident" id="5945304">File</span><span class="op" id="5945308">,</span>&nbsp;<span class="num" id="5945310">0</span><span class="op" id="5945311">,</span>&nbsp;<span class="ident" id="5945313">end</span><span class="op" id="5945316">.</span><span class="ident" id="5945317">directoryRecords</span><span class="op" id="5945333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945336">z</span><span class="op" id="5945337">.</span><span class="ident" id="5945338">Comment</span>&nbsp;<span class="op" id="5945346">=</span>&nbsp;<span class="ident" id="5945348">end</span><span class="op" id="5945351">.</span><span class="ident" id="5945352">comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945361">rs</span>&nbsp;<span class="op" id="5945364">:=</span>&nbsp;<span class="ident" id="5945367">io</span><span class="op" id="5945369">.</span><span class="ident" id="5945370">NewSectionReader</span><span class="op" id="5945386">(</span><span class="ident" id="5945387">r</span><span class="op" id="5945388">,</span>&nbsp;<span class="num" id="5945390">0</span><span class="op" id="5945391">,</span>&nbsp;<span class="ident" id="5945393">size</span><span class="op" id="5945397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5945400">if</span>&nbsp;<span class="ident" id="5945403">_</span><span class="op" id="5945404">,</span>&nbsp;<span class="ident" id="5945406">err</span>&nbsp;<span class="op" id="5945410">=</span>&nbsp;<span class="ident" id="5945412">rs</span><span class="op" id="5945414">.</span><span class="ident" id="5945415">Seek</span><span class="op" id="5945419">(</span><span class="ident" id="5945420">int64</span><span class="op" id="5945425">(</span><span class="ident" id="5945426">end</span><span class="op" id="5945429">.</span><span class="ident" id="5945430">directoryOffset</span><span class="op" id="5945445">)</span><span class="op" id="5945446">,</span>&nbsp;<span class="ident" id="5945448">os</span><span class="op" id="5945450">.</span><span class="ident" id="5945451">SEEK_SET</span><span class="op" id="5945459">)</span><span class="op" id="5945460">;</span>&nbsp;<span class="ident" id="5945462">err</span>&nbsp;<span class="op" id="5945466">!=</span>&nbsp;<span class="ident" id="5945469">nil</span>&nbsp;<span class="op" id="5945473">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5945477">return</span>&nbsp;<span class="ident" id="5945484">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5945489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945492">buf</span>&nbsp;<span class="op" id="5945496">:=</span>&nbsp;<span class="ident" id="5945499">bufio</span><span class="op" id="5945504">.</span><span class="ident" id="5945505">NewReader</span><span class="op" id="5945514">(</span><span class="ident" id="5945515">rs</span><span class="op" id="5945517">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5945521">//&nbsp;The&nbsp;count&nbsp;of&nbsp;files&nbsp;inside&nbsp;a&nbsp;zip&nbsp;is&nbsp;truncated&nbsp;to&nbsp;fit&nbsp;in&nbsp;a&nbsp;uint16.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5945590">//&nbsp;Gloss&nbsp;over&nbsp;this&nbsp;by&nbsp;reading&nbsp;headers&nbsp;until&nbsp;we&nbsp;encounter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5945648">//&nbsp;a&nbsp;bad&nbsp;one,&nbsp;and&nbsp;then&nbsp;only&nbsp;report&nbsp;a&nbsp;ErrFormat&nbsp;or&nbsp;UnexpectedEOF&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5945716">//&nbsp;the&nbsp;file&nbsp;count&nbsp;modulo&nbsp;65536&nbsp;is&nbsp;incorrect.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5945762">for</span>&nbsp;<span class="op" id="5945766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945770">f</span>&nbsp;<span class="op" id="5945772">:=</span>&nbsp;<span class="op" id="5945775">&amp;</span><span class="ident" id="5945776">File</span><span class="op" id="5945780">{</span><span class="ident" id="5945781">zipr</span><span class="op" id="5945785">:</span>&nbsp;<span class="ident" id="5945787">r</span><span class="op" id="5945788">,</span>&nbsp;<span class="ident" id="5945790">zipsize</span><span class="op" id="5945797">:</span>&nbsp;<span class="ident" id="5945799">size</span><span class="op" id="5945803">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945807">err</span>&nbsp;<span class="op" id="5945811">=</span>&nbsp;<span class="ident" id="5945813">readDirectoryHeader</span><span class="op" id="5945832">(</span><span class="ident" id="5945833">f</span><span class="op" id="5945834">,</span>&nbsp;<span class="ident" id="5945836">buf</span><span class="op" id="5945839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5945843">if</span>&nbsp;<span class="ident" id="5945846">err</span>&nbsp;<span class="op" id="5945850">==</span>&nbsp;<span class="ident" id="5945853">ErrFormat</span>&nbsp;<span class="op" id="5945863">||</span>&nbsp;<span class="ident" id="5945866">err</span>&nbsp;<span class="op" id="5945870">==</span>&nbsp;<span class="ident" id="5945873">io</span><span class="op" id="5945875">.</span><span class="ident" id="5945876">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="5945893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5945898">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5945906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5945910">if</span>&nbsp;<span class="ident" id="5945913">err</span>&nbsp;<span class="op" id="5945917">!=</span>&nbsp;<span class="ident" id="5945920">nil</span>&nbsp;<span class="op" id="5945924">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5945929">return</span>&nbsp;<span class="ident" id="5945936">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5945942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945946">z</span><span class="op" id="5945947">.</span><span class="ident" id="5945948">File</span>&nbsp;<span class="op" id="5945953">=</span>&nbsp;<span class="builtinfunc" id="5945955">append</span><span class="op" id="5945961">(</span><span class="ident" id="5945962">z</span><span class="op" id="5945963">.</span><span class="ident" id="5945964">File</span><span class="op" id="5945968">,</span>&nbsp;<span class="ident" id="5945970">f</span><span class="op" id="5945971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5945974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5945977">if</span>&nbsp;<span class="builtintype" id="5945980">uint16</span><span class="op" id="5945986">(</span><span class="builtinfunc" id="5945987">len</span><span class="op" id="5945990">(</span><span class="ident" id="5945991">z</span><span class="op" id="5945992">.</span><span class="ident" id="5945993">File</span><span class="op" id="5945997">)</span><span class="op" id="5945998">)</span>&nbsp;<span class="op" id="5946000">!=</span>&nbsp;<span class="builtintype" id="5946003">uint16</span><span class="op" id="5946009">(</span><span class="ident" id="5946010">end</span><span class="op" id="5946013">.</span><span class="ident" id="5946014">directoryRecords</span><span class="op" id="5946030">)</span>&nbsp;<span class="op" id="5946032">{</span>&nbsp;<span class="comment" id="5946034">//&nbsp;only&nbsp;compare&nbsp;16&nbsp;bits&nbsp;here</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5946065">//&nbsp;Return&nbsp;the&nbsp;readDirectoryHeader&nbsp;error&nbsp;if&nbsp;we&nbsp;read</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5946118">//&nbsp;the&nbsp;wrong&nbsp;number&nbsp;of&nbsp;directory&nbsp;entries.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946162">return</span>&nbsp;<span class="ident" id="5946169">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5946174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946177">return</span>&nbsp;<span class="ident" id="5946184">nil</span><br>
<span class="lineno">110</span><span class="op" id="5946188">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5946191">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Zip&nbsp;file,&nbsp;rendering&nbsp;it&nbsp;unusable&nbsp;for&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="keyword" id="5946252">func</span>&nbsp;<span class="op" id="5946257">(</span><span class="ident" id="5946258">rc</span>&nbsp;<span class="op" id="5946261">*</span><span class="ident" id="5946262">ReadCloser</span><span class="op" id="5946272">)</span>&nbsp;<span class="ident" id="5946274">Close</span><span class="op" id="5946279">(</span><span class="op" id="5946280">)</span>&nbsp;<span class="builtintype" id="5946282">error</span>&nbsp;<span class="op" id="5946288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946291">return</span>&nbsp;<span class="ident" id="5946298">rc</span><span class="op" id="5946300">.</span><span class="ident" id="5946301">f</span><span class="op" id="5946302">.</span><span class="ident" id="5946303">Close</span><span class="op" id="5946308">(</span><span class="op" id="5946309">)</span><br>
<span class="lineno">115</span><span class="op" id="5946311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5946314">//&nbsp;DataOffset&nbsp;returns&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;file&#39;s&nbsp;possibly-compressed</span><br>
<span class="lineno"></span><span class="comment" id="5946381">//&nbsp;data,&nbsp;relative&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;zip&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="5946433">//</span><br>
<span class="lineno">120</span><span class="comment" id="5946436">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;instead&nbsp;use&nbsp;Open,&nbsp;which&nbsp;transparently</span><br>
<span class="lineno"></span><span class="comment" id="5946497">//&nbsp;decompresses&nbsp;data&nbsp;and&nbsp;verifies&nbsp;checksums.</span><br>
<span class="lineno"></span><span class="keyword" id="5946542">func</span>&nbsp;<span class="op" id="5946547">(</span><span class="ident" id="5946548">f</span>&nbsp;<span class="op" id="5946550">*</span><span class="ident" id="5946551">File</span><span class="op" id="5946555">)</span>&nbsp;<span class="ident" id="5946557">DataOffset</span><span class="op" id="5946567">(</span><span class="op" id="5946568">)</span>&nbsp;<span class="op" id="5946570">(</span><span class="ident" id="5946571">offset</span>&nbsp;<span class="ident" id="5946578">int64</span><span class="op" id="5946583">,</span>&nbsp;<span class="ident" id="5946585">err</span>&nbsp;<span class="builtintype" id="5946589">error</span><span class="op" id="5946594">)</span>&nbsp;<span class="op" id="5946596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946599">bodyOffset</span><span class="op" id="5946609">,</span>&nbsp;<span class="ident" id="5946611">err</span>&nbsp;<span class="op" id="5946615">:=</span>&nbsp;<span class="ident" id="5946618">f</span><span class="op" id="5946619">.</span><span class="ident" id="5946620">findBodyOffset</span><span class="op" id="5946634">(</span><span class="op" id="5946635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946638">if</span>&nbsp;<span class="ident" id="5946641">err</span>&nbsp;<span class="op" id="5946645">!=</span>&nbsp;<span class="ident" id="5946648">nil</span>&nbsp;<span class="op" id="5946652">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946656">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5946664">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946667">return</span>&nbsp;<span class="ident" id="5946674">f</span><span class="op" id="5946675">.</span><span class="ident" id="5946676">headerOffset</span>&nbsp;<span class="op" id="5946689">+</span>&nbsp;<span class="ident" id="5946691">bodyOffset</span><span class="op" id="5946701">,</span>&nbsp;<span class="ident" id="5946703">nil</span><br>
<span class="lineno"></span><span class="op" id="5946707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="5946710">//&nbsp;Open&nbsp;returns&nbsp;a&nbsp;ReadCloser&nbsp;that&nbsp;provides&nbsp;access&nbsp;to&nbsp;the&nbsp;File&#39;s&nbsp;contents.</span><br>
<span class="lineno"></span><span class="comment" id="5946784">//&nbsp;Multiple&nbsp;files&nbsp;may&nbsp;be&nbsp;read&nbsp;concurrently.</span><br>
<span class="lineno"></span><span class="keyword" id="5946828">func</span>&nbsp;<span class="op" id="5946833">(</span><span class="ident" id="5946834">f</span>&nbsp;<span class="op" id="5946836">*</span><span class="ident" id="5946837">File</span><span class="op" id="5946841">)</span>&nbsp;<span class="ident" id="5946843">Open</span><span class="op" id="5946847">(</span><span class="op" id="5946848">)</span>&nbsp;<span class="op" id="5946850">(</span><span class="ident" id="5946851">rc</span>&nbsp;<span class="ident" id="5946854">io</span><span class="op" id="5946856">.</span><span class="ident" id="5946857">ReadCloser</span><span class="op" id="5946867">,</span>&nbsp;<span class="ident" id="5946869">err</span>&nbsp;<span class="builtintype" id="5946873">error</span><span class="op" id="5946878">)</span>&nbsp;<span class="op" id="5946880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946883">bodyOffset</span><span class="op" id="5946893">,</span>&nbsp;<span class="ident" id="5946895">err</span>&nbsp;<span class="op" id="5946899">:=</span>&nbsp;<span class="ident" id="5946902">f</span><span class="op" id="5946903">.</span><span class="ident" id="5946904">findBodyOffset</span><span class="op" id="5946918">(</span><span class="op" id="5946919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946922">if</span>&nbsp;<span class="ident" id="5946925">err</span>&nbsp;<span class="op" id="5946929">!=</span>&nbsp;<span class="ident" id="5946932">nil</span>&nbsp;<span class="op" id="5946936">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946940">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5946948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946951">size</span>&nbsp;<span class="op" id="5946956">:=</span>&nbsp;<span class="ident" id="5946959">int64</span><span class="op" id="5946964">(</span><span class="ident" id="5946965">f</span><span class="op" id="5946966">.</span><span class="ident" id="5946967">CompressedSize64</span><span class="op" id="5946983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946986">r</span>&nbsp;<span class="op" id="5946988">:=</span>&nbsp;<span class="ident" id="5946991">io</span><span class="op" id="5946993">.</span><span class="ident" id="5946994">NewSectionReader</span><span class="op" id="5947010">(</span><span class="ident" id="5947011">f</span><span class="op" id="5947012">.</span><span class="ident" id="5947013">zipr</span><span class="op" id="5947017">,</span>&nbsp;<span class="ident" id="5947019">f</span><span class="op" id="5947020">.</span><span class="ident" id="5947021">headerOffset</span><span class="op" id="5947033">+</span><span class="ident" id="5947034">bodyOffset</span><span class="op" id="5947044">,</span>&nbsp;<span class="ident" id="5947046">size</span><span class="op" id="5947050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947053">dcomp</span>&nbsp;<span class="op" id="5947059">:=</span>&nbsp;<span class="ident" id="5947062">decompressor</span><span class="op" id="5947074">(</span><span class="ident" id="5947075">f</span><span class="op" id="5947076">.</span><span class="ident" id="5947077">Method</span><span class="op" id="5947083">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947086">if</span>&nbsp;<span class="ident" id="5947089">dcomp</span>&nbsp;<span class="op" id="5947095">==</span>&nbsp;<span class="ident" id="5947098">nil</span>&nbsp;<span class="op" id="5947102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947106">err</span>&nbsp;<span class="op" id="5947110">=</span>&nbsp;<span class="ident" id="5947112">ErrAlgorithm</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947127">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5947135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947138">rc</span>&nbsp;<span class="op" id="5947141">=</span>&nbsp;<span class="ident" id="5947143">dcomp</span><span class="op" id="5947148">(</span><span class="ident" id="5947149">r</span><span class="op" id="5947150">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947153">var</span>&nbsp;<span class="ident" id="5947157">desr</span>&nbsp;<span class="ident" id="5947162">io</span><span class="op" id="5947164">.</span><span class="ident" id="5947165">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947173">if</span>&nbsp;<span class="ident" id="5947176">f</span><span class="op" id="5947177">.</span><span class="ident" id="5947178">hasDataDescriptor</span><span class="op" id="5947195">(</span><span class="op" id="5947196">)</span>&nbsp;<span class="op" id="5947198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947202">desr</span>&nbsp;<span class="op" id="5947207">=</span>&nbsp;<span class="ident" id="5947209">io</span><span class="op" id="5947211">.</span><span class="ident" id="5947212">NewSectionReader</span><span class="op" id="5947228">(</span><span class="ident" id="5947229">f</span><span class="op" id="5947230">.</span><span class="ident" id="5947231">zipr</span><span class="op" id="5947235">,</span>&nbsp;<span class="ident" id="5947237">f</span><span class="op" id="5947238">.</span><span class="ident" id="5947239">headerOffset</span><span class="op" id="5947251">+</span><span class="ident" id="5947252">bodyOffset</span><span class="op" id="5947262">+</span><span class="ident" id="5947263">size</span><span class="op" id="5947267">,</span>&nbsp;<span class="ident" id="5947269">dataDescriptorLen</span><span class="op" id="5947286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5947289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947292">rc</span>&nbsp;<span class="op" id="5947295">=</span>&nbsp;<span class="op" id="5947297">&amp;</span><span class="ident" id="5947298">checksumReader</span><span class="op" id="5947312">{</span><span class="ident" id="5947313">rc</span><span class="op" id="5947315">,</span>&nbsp;<span class="ident" id="5947317">crc32</span><span class="op" id="5947322">.</span><span class="ident" id="5947323">NewIEEE</span><span class="op" id="5947330">(</span><span class="op" id="5947331">)</span><span class="op" id="5947332">,</span>&nbsp;<span class="ident" id="5947334">f</span><span class="op" id="5947335">,</span>&nbsp;<span class="ident" id="5947337">desr</span><span class="op" id="5947341">,</span>&nbsp;<span class="ident" id="5947343">nil</span><span class="op" id="5947346">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947349">return</span><br>
<span class="lineno"></span><span class="op" id="5947356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5947359">type</span>&nbsp;<span class="ident" id="5947364">checksumReader</span>&nbsp;<span class="keyword" id="5947379">struct</span>&nbsp;<span class="op" id="5947386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947389">rc</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5947394">io</span><span class="op" id="5947396">.</span><span class="ident" id="5947397">ReadCloser</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947409">hash</span>&nbsp;<span class="ident" id="5947414">hash</span><span class="op" id="5947418">.</span><span class="ident" id="5947419">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947427">f</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5947432">*</span><span class="ident" id="5947433">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947439">desr</span>&nbsp;<span class="ident" id="5947444">io</span><span class="op" id="5947446">.</span><span class="ident" id="5947447">Reader</span>&nbsp;<span class="comment" id="5947454">//&nbsp;if&nbsp;non-nil,&nbsp;where&nbsp;to&nbsp;read&nbsp;the&nbsp;data&nbsp;descriptor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947504">err</span>&nbsp;&nbsp;<span class="builtintype" id="5947509">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5947519">//&nbsp;sticky&nbsp;error</span><br>
<span class="lineno"></span><span class="op" id="5947535">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="keyword" id="5947538">func</span>&nbsp;<span class="op" id="5947543">(</span><span class="ident" id="5947544">r</span>&nbsp;<span class="op" id="5947546">*</span><span class="ident" id="5947547">checksumReader</span><span class="op" id="5947561">)</span>&nbsp;<span class="ident" id="5947563">Read</span><span class="op" id="5947567">(</span><span class="ident" id="5947568">b</span>&nbsp;<span class="op" id="5947570">[</span><span class="op" id="5947571">]</span><span class="builtintype" id="5947572">byte</span><span class="op" id="5947576">)</span>&nbsp;<span class="op" id="5947578">(</span><span class="ident" id="5947579">n</span>&nbsp;<span class="builtintype" id="5947581">int</span><span class="op" id="5947584">,</span>&nbsp;<span class="ident" id="5947586">err</span>&nbsp;<span class="builtintype" id="5947590">error</span><span class="op" id="5947595">)</span>&nbsp;<span class="op" id="5947597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947600">if</span>&nbsp;<span class="ident" id="5947603">r</span><span class="op" id="5947604">.</span><span class="ident" id="5947605">err</span>&nbsp;<span class="op" id="5947609">!=</span>&nbsp;<span class="ident" id="5947612">nil</span>&nbsp;<span class="op" id="5947616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947620">return</span>&nbsp;<span class="num" id="5947627">0</span><span class="op" id="5947628">,</span>&nbsp;<span class="ident" id="5947630">r</span><span class="op" id="5947631">.</span><span class="ident" id="5947632">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5947637">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947640">n</span><span class="op" id="5947641">,</span>&nbsp;<span class="ident" id="5947643">err</span>&nbsp;<span class="op" id="5947647">=</span>&nbsp;<span class="ident" id="5947649">r</span><span class="op" id="5947650">.</span><span class="ident" id="5947651">rc</span><span class="op" id="5947653">.</span><span class="ident" id="5947654">Read</span><span class="op" id="5947658">(</span><span class="ident" id="5947659">b</span><span class="op" id="5947660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947663">r</span><span class="op" id="5947664">.</span><span class="ident" id="5947665">hash</span><span class="op" id="5947669">.</span><span class="ident" id="5947670">Write</span><span class="op" id="5947675">(</span><span class="ident" id="5947676">b</span><span class="op" id="5947677">[</span><span class="op" id="5947678">:</span><span class="ident" id="5947679">n</span><span class="op" id="5947680">]</span><span class="op" id="5947681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947684">if</span>&nbsp;<span class="ident" id="5947687">err</span>&nbsp;<span class="op" id="5947691">==</span>&nbsp;<span class="ident" id="5947694">nil</span>&nbsp;<span class="op" id="5947698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947702">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5947710">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947713">if</span>&nbsp;<span class="ident" id="5947716">err</span>&nbsp;<span class="op" id="5947720">==</span>&nbsp;<span class="ident" id="5947723">io</span><span class="op" id="5947725">.</span><span class="ident" id="5947726">EOF</span>&nbsp;<span class="op" id="5947730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947734">if</span>&nbsp;<span class="ident" id="5947737">r</span><span class="op" id="5947738">.</span><span class="ident" id="5947739">desr</span>&nbsp;<span class="op" id="5947744">!=</span>&nbsp;<span class="ident" id="5947747">nil</span>&nbsp;<span class="op" id="5947751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947756">if</span>&nbsp;<span class="ident" id="5947759">err1</span>&nbsp;<span class="op" id="5947764">:=</span>&nbsp;<span class="ident" id="5947767">readDataDescriptor</span><span class="op" id="5947785">(</span><span class="ident" id="5947786">r</span><span class="op" id="5947787">.</span><span class="ident" id="5947788">desr</span><span class="op" id="5947792">,</span>&nbsp;<span class="ident" id="5947794">r</span><span class="op" id="5947795">.</span><span class="ident" id="5947796">f</span><span class="op" id="5947797">)</span><span class="op" id="5947798">;</span>&nbsp;<span class="ident" id="5947800">err1</span>&nbsp;<span class="op" id="5947805">!=</span>&nbsp;<span class="ident" id="5947808">nil</span>&nbsp;<span class="op" id="5947812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947818">err</span>&nbsp;<span class="op" id="5947822">=</span>&nbsp;<span class="ident" id="5947824">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5947832">}</span>&nbsp;<span class="keyword" id="5947834">else</span>&nbsp;<span class="keyword" id="5947839">if</span>&nbsp;<span class="ident" id="5947842">r</span><span class="op" id="5947843">.</span><span class="ident" id="5947844">hash</span><span class="op" id="5947848">.</span><span class="ident" id="5947849">Sum32</span><span class="op" id="5947854">(</span><span class="op" id="5947855">)</span>&nbsp;<span class="op" id="5947857">!=</span>&nbsp;<span class="ident" id="5947860">r</span><span class="op" id="5947861">.</span><span class="ident" id="5947862">f</span><span class="op" id="5947863">.</span><span class="ident" id="5947864">CRC32</span>&nbsp;<span class="op" id="5947870">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947876">err</span>&nbsp;<span class="op" id="5947880">=</span>&nbsp;<span class="ident" id="5947882">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5947897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5947901">}</span>&nbsp;<span class="keyword" id="5947903">else</span>&nbsp;<span class="op" id="5947908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5947913">//&nbsp;If&nbsp;there&#39;s&nbsp;not&nbsp;a&nbsp;data&nbsp;descriptor,&nbsp;we&nbsp;still&nbsp;compare</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5947970">//&nbsp;the&nbsp;CRC32&nbsp;of&nbsp;what&nbsp;we&#39;ve&nbsp;read&nbsp;against&nbsp;the&nbsp;file&nbsp;header</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5948029">//&nbsp;or&nbsp;TOC&#39;s&nbsp;CRC32,&nbsp;if&nbsp;it&nbsp;seems&nbsp;like&nbsp;it&nbsp;was&nbsp;set.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948080">if</span>&nbsp;<span class="ident" id="5948083">r</span><span class="op" id="5948084">.</span><span class="ident" id="5948085">f</span><span class="op" id="5948086">.</span><span class="ident" id="5948087">CRC32</span>&nbsp;<span class="op" id="5948093">!=</span>&nbsp;<span class="num" id="5948096">0</span>&nbsp;<span class="op" id="5948098">&amp;&amp;</span>&nbsp;<span class="ident" id="5948101">r</span><span class="op" id="5948102">.</span><span class="ident" id="5948103">hash</span><span class="op" id="5948107">.</span><span class="ident" id="5948108">Sum32</span><span class="op" id="5948113">(</span><span class="op" id="5948114">)</span>&nbsp;<span class="op" id="5948116">!=</span>&nbsp;<span class="ident" id="5948119">r</span><span class="op" id="5948120">.</span><span class="ident" id="5948121">f</span><span class="op" id="5948122">.</span><span class="ident" id="5948123">CRC32</span>&nbsp;<span class="op" id="5948129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948135">err</span>&nbsp;<span class="op" id="5948139">=</span>&nbsp;<span class="ident" id="5948141">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5948156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5948160">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5948163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948166">r</span><span class="op" id="5948167">.</span><span class="ident" id="5948168">err</span>&nbsp;<span class="op" id="5948172">=</span>&nbsp;<span class="ident" id="5948174">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948179">return</span><br>
<span class="lineno"></span><span class="op" id="5948186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="5948189">func</span>&nbsp;<span class="op" id="5948194">(</span><span class="ident" id="5948195">r</span>&nbsp;<span class="op" id="5948197">*</span><span class="ident" id="5948198">checksumReader</span><span class="op" id="5948212">)</span>&nbsp;<span class="ident" id="5948214">Close</span><span class="op" id="5948219">(</span><span class="op" id="5948220">)</span>&nbsp;<span class="builtintype" id="5948222">error</span>&nbsp;<span class="op" id="5948228">{</span>&nbsp;<span class="keyword" id="5948230">return</span>&nbsp;<span class="ident" id="5948237">r</span><span class="op" id="5948238">.</span><span class="ident" id="5948239">rc</span><span class="op" id="5948241">.</span><span class="ident" id="5948242">Close</span><span class="op" id="5948247">(</span><span class="op" id="5948248">)</span>&nbsp;<span class="op" id="5948250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5948253">//&nbsp;findBodyOffset&nbsp;does&nbsp;the&nbsp;minimum&nbsp;work&nbsp;to&nbsp;verify&nbsp;the&nbsp;file&nbsp;has&nbsp;a&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="5948325">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;file&nbsp;body&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="5948362">func</span>&nbsp;<span class="op" id="5948367">(</span><span class="ident" id="5948368">f</span>&nbsp;<span class="op" id="5948370">*</span><span class="ident" id="5948371">File</span><span class="op" id="5948375">)</span>&nbsp;<span class="ident" id="5948377">findBodyOffset</span><span class="op" id="5948391">(</span><span class="op" id="5948392">)</span>&nbsp;<span class="op" id="5948394">(</span><span class="ident" id="5948395">int64</span><span class="op" id="5948400">,</span>&nbsp;<span class="builtintype" id="5948402">error</span><span class="op" id="5948407">)</span>&nbsp;<span class="op" id="5948409">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948412">var</span>&nbsp;<span class="ident" id="5948416">buf</span>&nbsp;<span class="op" id="5948420">[</span><span class="ident" id="5948421">fileHeaderLen</span><span class="op" id="5948434">]</span><span class="builtintype" id="5948435">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948441">if</span>&nbsp;<span class="ident" id="5948444">_</span><span class="op" id="5948445">,</span>&nbsp;<span class="ident" id="5948447">err</span>&nbsp;<span class="op" id="5948451">:=</span>&nbsp;<span class="ident" id="5948454">f</span><span class="op" id="5948455">.</span><span class="ident" id="5948456">zipr</span><span class="op" id="5948460">.</span><span class="ident" id="5948461">ReadAt</span><span class="op" id="5948467">(</span><span class="ident" id="5948468">buf</span><span class="op" id="5948471">[</span><span class="op" id="5948472">:</span><span class="op" id="5948473">]</span><span class="op" id="5948474">,</span>&nbsp;<span class="ident" id="5948476">f</span><span class="op" id="5948477">.</span><span class="ident" id="5948478">headerOffset</span><span class="op" id="5948490">)</span><span class="op" id="5948491">;</span>&nbsp;<span class="ident" id="5948493">err</span>&nbsp;<span class="op" id="5948497">!=</span>&nbsp;<span class="ident" id="5948500">nil</span>&nbsp;<span class="op" id="5948504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948508">return</span>&nbsp;<span class="num" id="5948515">0</span><span class="op" id="5948516">,</span>&nbsp;<span class="ident" id="5948518">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5948523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948526">b</span>&nbsp;<span class="op" id="5948528">:=</span>&nbsp;<span class="ident" id="5948531">readBuf</span><span class="op" id="5948538">(</span><span class="ident" id="5948539">buf</span><span class="op" id="5948542">[</span><span class="op" id="5948543">:</span><span class="op" id="5948544">]</span><span class="op" id="5948545">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948548">if</span>&nbsp;<span class="ident" id="5948551">sig</span>&nbsp;<span class="op" id="5948555">:=</span>&nbsp;<span class="ident" id="5948558">b</span><span class="op" id="5948559">.</span><span class="builtintype" id="5948560">uint32</span><span class="op" id="5948566">(</span><span class="op" id="5948567">)</span><span class="op" id="5948568">;</span>&nbsp;<span class="ident" id="5948570">sig</span>&nbsp;<span class="op" id="5948574">!=</span>&nbsp;<span class="ident" id="5948577">fileHeaderSignature</span>&nbsp;<span class="op" id="5948597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948601">return</span>&nbsp;<span class="num" id="5948608">0</span><span class="op" id="5948609">,</span>&nbsp;<span class="ident" id="5948611">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5948622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948625">b</span>&nbsp;<span class="op" id="5948627">=</span>&nbsp;<span class="ident" id="5948629">b</span><span class="op" id="5948630">[</span><span class="num" id="5948631">22</span><span class="op" id="5948633">:</span><span class="op" id="5948634">]</span>&nbsp;<span class="comment" id="5948636">//&nbsp;skip&nbsp;over&nbsp;most&nbsp;of&nbsp;the&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948669">filenameLen</span>&nbsp;<span class="op" id="5948681">:=</span>&nbsp;<span class="builtintype" id="5948684">int</span><span class="op" id="5948687">(</span><span class="ident" id="5948688">b</span><span class="op" id="5948689">.</span><span class="builtintype" id="5948690">uint16</span><span class="op" id="5948696">(</span><span class="op" id="5948697">)</span><span class="op" id="5948698">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948701">extraLen</span>&nbsp;<span class="op" id="5948710">:=</span>&nbsp;<span class="builtintype" id="5948713">int</span><span class="op" id="5948716">(</span><span class="ident" id="5948717">b</span><span class="op" id="5948718">.</span><span class="builtintype" id="5948719">uint16</span><span class="op" id="5948725">(</span><span class="op" id="5948726">)</span><span class="op" id="5948727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948730">return</span>&nbsp;<span class="ident" id="5948737">int64</span><span class="op" id="5948742">(</span><span class="ident" id="5948743">fileHeaderLen</span>&nbsp;<span class="op" id="5948757">+</span>&nbsp;<span class="ident" id="5948759">filenameLen</span>&nbsp;<span class="op" id="5948771">+</span>&nbsp;<span class="ident" id="5948773">extraLen</span><span class="op" id="5948781">)</span><span class="op" id="5948782">,</span>&nbsp;<span class="ident" id="5948784">nil</span><br>
<span class="lineno"></span><span class="op" id="5948788">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5948791">//&nbsp;readDirectoryHeader&nbsp;attempts&nbsp;to&nbsp;read&nbsp;a&nbsp;directory&nbsp;header&nbsp;from&nbsp;r.</span><br>
<span class="lineno">210</span><span class="comment" id="5948858">//&nbsp;It&nbsp;returns&nbsp;io.ErrUnexpectedEOF&nbsp;if&nbsp;it&nbsp;cannot&nbsp;read&nbsp;a&nbsp;complete&nbsp;header,</span><br>
<span class="lineno"></span><span class="comment" id="5948929">//&nbsp;and&nbsp;ErrFormat&nbsp;if&nbsp;it&nbsp;doesn&#39;t&nbsp;find&nbsp;a&nbsp;valid&nbsp;header&nbsp;signature.</span><br>
<span class="lineno"></span><span class="keyword" id="5948991">func</span>&nbsp;<span class="ident" id="5948996">readDirectoryHeader</span><span class="op" id="5949015">(</span><span class="ident" id="5949016">f</span>&nbsp;<span class="op" id="5949018">*</span><span class="ident" id="5949019">File</span><span class="op" id="5949023">,</span>&nbsp;<span class="ident" id="5949025">r</span>&nbsp;<span class="ident" id="5949027">io</span><span class="op" id="5949029">.</span><span class="ident" id="5949030">Reader</span><span class="op" id="5949036">)</span>&nbsp;<span class="builtintype" id="5949038">error</span>&nbsp;<span class="op" id="5949044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5949047">var</span>&nbsp;<span class="ident" id="5949051">buf</span>&nbsp;<span class="op" id="5949055">[</span><span class="ident" id="5949056">directoryHeaderLen</span><span class="op" id="5949074">]</span><span class="builtintype" id="5949075">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5949081">if</span>&nbsp;<span class="ident" id="5949084">_</span><span class="op" id="5949085">,</span>&nbsp;<span class="ident" id="5949087">err</span>&nbsp;<span class="op" id="5949091">:=</span>&nbsp;<span class="ident" id="5949094">io</span><span class="op" id="5949096">.</span><span class="ident" id="5949097">ReadFull</span><span class="op" id="5949105">(</span><span class="ident" id="5949106">r</span><span class="op" id="5949107">,</span>&nbsp;<span class="ident" id="5949109">buf</span><span class="op" id="5949112">[</span><span class="op" id="5949113">:</span><span class="op" id="5949114">]</span><span class="op" id="5949115">)</span><span class="op" id="5949116">;</span>&nbsp;<span class="ident" id="5949118">err</span>&nbsp;<span class="op" id="5949122">!=</span>&nbsp;<span class="ident" id="5949125">nil</span>&nbsp;<span class="op" id="5949129">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5949133">return</span>&nbsp;<span class="ident" id="5949140">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5949145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5949148">b</span>&nbsp;<span class="op" id="5949150">:=</span>&nbsp;<span class="ident" id="5949153">readBuf</span><span class="op" id="5949160">(</span><span class="ident" id="5949161">buf</span><span class="op" id="5949164">[</span><span class="op" id="5949165">:</span><span class="op" id="5949166">]</span><span class="op" id="5949167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5949170">if</span>&nbsp;<span class="ident" id="5949173">sig</span>&nbsp;<span class="op" id="5949177">:=</span>&nbsp;<span class="ident" id="5949180">b</span><span class="op" id="5949181">.</span><span class="builtintype" id="5949182">uint32</span><span class="op" id="5949188">(</span><span class="op" id="5949189">)</span><span class="op" id="5949190">;</span>&nbsp;<span class="ident" id="5949192">sig</span>&nbsp;<span class="op" id="5949196">!=</span>&nbsp;<span class="ident" id="5949199">directoryHeaderSignature</span>&nbsp;<span class="op" id="5949224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5949228">return</span>&nbsp;<span class="ident" id="5949235">ErrFormat</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5949246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5949249">f</span><span class="op" id="5949250">.</span><span class="ident" id="5949251">CreatorVersion</span>&nbsp;<span class="op" id="5949266">=</span>&nbsp;<span class="ident" id="5949268">b</span><span class="op" id="5949269">.</span><span class="builtintype" id="5949270">uint16</span><span class="op" id="5949276">(</span><span class="op" id="5949277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5949280">f</span><span class="op" id="5949281">.</span><span class="ident" id="5949282">ReaderVersion</span>&nbsp;<span class="op" id="5949296">=</span>&nbsp;<span class="ident" id="5949298">b</span><span class="op" id="5949299">.</span><span class="builtintype" id="5949300">uint16</span><span class="op" id="5949306">(</span><span class="op" id="5949307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5949310">f</span><span class="op" id="5949311">.</span><span class="ident" id="5949312">Flags</span>&nbsp;<span class="op" id="5949318">=</span>&nbsp;<span class="ident" id="5949320">b</span><span class="op" id="5949321">.</span><span class="builtintype" id="5949322">uint16</span><span class="op" id="5949328">(</span><span class="op" id="5949329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5949332">f</span><span class="op" id="5949333">.</span><span class="ident" id="5949334">Method</span>&nbsp;<span class="op" id="5949341">=</span>&nbsp;<span class="ident" id="5949343">b</span><span class="op" id="5949344">.</span><span class="builtintype" id="5949345">uint16</span><span class="op" id="5949351">(</span><span class="op" id="5949352">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5949355">f</span><span class="op" id="5949356">.</span><span class="ident" id="5949357">ModifiedTime</span>&nbsp;<span class="op" id="5949370">=</span>&nbsp;<span class="ident" id="5949372">b</span><span class="op" id="5949373">.</span><span class="builtintype" id="5949374">uint16</span><span class="op" id="5949380">(</span><span class="op" id="5949381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5949384">f</span><span class="op" id="5949385">.</span><span class="ident" id="5949386">ModifiedDate</span>&nbsp;<span class="op" id="5949399">=</span>&nbsp;<span class="ident" id="5949401">b</span><span class="op" id="5949402">.</span><span class="builtintype" id="5949403">uint16</span><span class="op" id="5949409">(</span><span class="op" id="5949410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5949413">f</span><span class="op" id="5949414">.</span><span class="ident" id="5949415">CRC32</span>&nbsp;<span class="op" id="5949421">=</span>&nbsp;<span class="ident" id="5949423">b</span><span class="op" id="5949424">.</span><span class="builtintype" id="5949425">uint32</span><span class="op" id="5949431">(</span><span class="op" id="5949432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5949435">f</span><span class="op" id="5949436">.</span><span class="ident" id="5949437">CompressedSize</span>&nbsp;<span class="op" id="5949452">=</span>&nbsp;<span class="ident" id="5949454">b</span><span class="op" id="5949455">.</span><span class="builtintype" id="5949456">uint32</span><span class="op" id="5949462">(</span><span class="op" id="5949463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5949466">f</span><span class="op" id="5949467">.</span><span class="ident" id="5949468">UncompressedSize</span>&nbsp;<span class="op" id="5949485">=</span>&nbsp;<span class="ident" id="5949487">b</span><span class="op" id="5949488">.</span><span class="builtintype" id="5949489">uint32</span><span class="op" id="5949495">(</span><span class="op" id="5949496">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5949499">f</span><span class="op" id="5949500">.</span><span class="ident" id="5949501">CompressedSize64</span>&nbsp;<span class="op" id="5949518">=</span>&nbsp;<span class="ident" id="5949520">uint64</span><span class="op" id="5949526">(</span><span class="ident" id="5949527">f</span><span class="op" id="5949528">.</span><span class="ident" id="5949529">CompressedSize</span><span class="op" id="5949543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5949546">f</span><span class="op" id="5949547">.</span><span class="ident" id="5949548">UncompressedSize64</span>&nbsp;<span class="op" id="5949567">=</span>&nbsp;<span class="ident" id="5949569">uint64</span><span class="op" id="5949575">(</span><span class="ident" id="5949576">f</span><span class="op" id="5949577">.</span><span class="ident" id="5949578">UncompressedSize</span><span class="op" id="5949594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5949597">filenameLen</span>&nbsp;<span class="op" id="5949609">:=</span>&nbsp;<span class="builtintype" id="5949612">int</span><span class="op" id="5949615">(</span><span class="ident" id="5949616">b</span><span class="op" id="5949617">.</span><span class="builtintype" id="5949618">uint16</span><span class="op" id="5949624">(</span><span class="op" id="5949625">)</span><span class="op" id="5949626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5949629">extraLen</span>&nbsp;<span class="op" id="5949638">:=</span>&nbsp;<span class="builtintype" id="5949641">int</span><span class="op" id="5949644">(</span><span class="ident" id="5949645">b</span><span class="op" id="5949646">.</span><span class="builtintype" id="5949647">uint16</span><span class="op" id="5949653">(</span><span class="op" id="5949654">)</span><span class="op" id="5949655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5949658">commentLen</span>&nbsp;<span class="op" id="5949669">:=</span>&nbsp;<span class="builtintype" id="5949672">int</span><span class="op" id="5949675">(</span><span class="ident" id="5949676">b</span><span class="op" id="5949677">.</span><span class="builtintype" id="5949678">uint16</span><span class="op" id="5949684">(</span><span class="op" id="5949685">)</span><span class="op" id="5949686">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5949689">b</span>&nbsp;<span class="op" id="5949691">=</span>&nbsp;<span class="ident" id="5949693">b</span><span class="op" id="5949694">[</span><span class="num" id="5949695">4</span><span class="op" id="5949696">:</span><span class="op" id="5949697">]</span>&nbsp;<span class="comment" id="5949699">//&nbsp;skipped&nbsp;start&nbsp;disk&nbsp;number&nbsp;and&nbsp;internal&nbsp;attributes&nbsp;(2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5949765">f</span><span class="op" id="5949766">.</span><span class="ident" id="5949767">ExternalAttrs</span>&nbsp;<span class="op" id="5949781">=</span>&nbsp;<span class="ident" id="5949783">b</span><span class="op" id="5949784">.</span><span class="builtintype" id="5949785">uint32</span><span class="op" id="5949791">(</span><span class="op" id="5949792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5949795">f</span><span class="op" id="5949796">.</span><span class="ident" id="5949797">headerOffset</span>&nbsp;<span class="op" id="5949810">=</span>&nbsp;<span class="ident" id="5949812">int64</span><span class="op" id="5949817">(</span><span class="ident" id="5949818">b</span><span class="op" id="5949819">.</span><span class="builtintype" id="5949820">uint32</span><span class="op" id="5949826">(</span><span class="op" id="5949827">)</span><span class="op" id="5949828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5949831">d</span>&nbsp;<span class="op" id="5949833">:=</span>&nbsp;<span class="builtinfunc" id="5949836">make</span><span class="op" id="5949840">(</span><span class="op" id="5949841">[</span><span class="op" id="5949842">]</span><span class="builtintype" id="5949843">byte</span><span class="op" id="5949847">,</span>&nbsp;<span class="ident" id="5949849">filenameLen</span><span class="op" id="5949860">+</span><span class="ident" id="5949861">extraLen</span><span class="op" id="5949869">+</span><span class="ident" id="5949870">commentLen</span><span class="op" id="5949880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5949883">if</span>&nbsp;<span class="ident" id="5949886">_</span><span class="op" id="5949887">,</span>&nbsp;<span class="ident" id="5949889">err</span>&nbsp;<span class="op" id="5949893">:=</span>&nbsp;<span class="ident" id="5949896">io</span><span class="op" id="5949898">.</span><span class="ident" id="5949899">ReadFull</span><span class="op" id="5949907">(</span><span class="ident" id="5949908">r</span><span class="op" id="5949909">,</span>&nbsp;<span class="ident" id="5949911">d</span><span class="op" id="5949912">)</span><span class="op" id="5949913">;</span>&nbsp;<span class="ident" id="5949915">err</span>&nbsp;<span class="op" id="5949919">!=</span>&nbsp;<span class="ident" id="5949922">nil</span>&nbsp;<span class="op" id="5949926">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5949930">return</span>&nbsp;<span class="ident" id="5949937">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5949942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5949945">f</span><span class="op" id="5949946">.</span><span class="ident" id="5949947">Name</span>&nbsp;<span class="op" id="5949952">=</span>&nbsp;<span class="builtintype" id="5949954">string</span><span class="op" id="5949960">(</span><span class="ident" id="5949961">d</span><span class="op" id="5949962">[</span><span class="op" id="5949963">:</span><span class="ident" id="5949964">filenameLen</span><span class="op" id="5949975">]</span><span class="op" id="5949976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5949979">f</span><span class="op" id="5949980">.</span><span class="ident" id="5949981">Extra</span>&nbsp;<span class="op" id="5949987">=</span>&nbsp;<span class="ident" id="5949989">d</span><span class="op" id="5949990">[</span><span class="ident" id="5949991">filenameLen</span>&nbsp;<span class="op" id="5950003">:</span>&nbsp;<span class="ident" id="5950005">filenameLen</span><span class="op" id="5950016">+</span><span class="ident" id="5950017">extraLen</span><span class="op" id="5950025">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950028">f</span><span class="op" id="5950029">.</span><span class="ident" id="5950030">Comment</span>&nbsp;<span class="op" id="5950038">=</span>&nbsp;<span class="builtintype" id="5950040">string</span><span class="op" id="5950046">(</span><span class="ident" id="5950047">d</span><span class="op" id="5950048">[</span><span class="ident" id="5950049">filenameLen</span><span class="op" id="5950060">+</span><span class="ident" id="5950061">extraLen</span><span class="op" id="5950069">:</span><span class="op" id="5950070">]</span><span class="op" id="5950071">)</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5950075">if</span>&nbsp;<span class="builtinfunc" id="5950078">len</span><span class="op" id="5950081">(</span><span class="ident" id="5950082">f</span><span class="op" id="5950083">.</span><span class="ident" id="5950084">Extra</span><span class="op" id="5950089">)</span>&nbsp;<span class="op" id="5950091">&gt;</span>&nbsp;<span class="num" id="5950093">0</span>&nbsp;<span class="op" id="5950095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950099">b</span>&nbsp;<span class="op" id="5950101">:=</span>&nbsp;<span class="ident" id="5950104">readBuf</span><span class="op" id="5950111">(</span><span class="ident" id="5950112">f</span><span class="op" id="5950113">.</span><span class="ident" id="5950114">Extra</span><span class="op" id="5950119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5950123">for</span>&nbsp;<span class="builtinfunc" id="5950127">len</span><span class="op" id="5950130">(</span><span class="ident" id="5950131">b</span><span class="op" id="5950132">)</span>&nbsp;<span class="op" id="5950134">&gt;=</span>&nbsp;<span class="num" id="5950137">4</span>&nbsp;<span class="op" id="5950139">{</span>&nbsp;<span class="comment" id="5950141">//&nbsp;need&nbsp;at&nbsp;least&nbsp;tag&nbsp;and&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950174">tag</span>&nbsp;<span class="op" id="5950178">:=</span>&nbsp;<span class="ident" id="5950181">b</span><span class="op" id="5950182">.</span><span class="builtintype" id="5950183">uint16</span><span class="op" id="5950189">(</span><span class="op" id="5950190">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950195">size</span>&nbsp;<span class="op" id="5950200">:=</span>&nbsp;<span class="ident" id="5950203">b</span><span class="op" id="5950204">.</span><span class="builtintype" id="5950205">uint16</span><span class="op" id="5950211">(</span><span class="op" id="5950212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5950217">if</span>&nbsp;<span class="builtintype" id="5950220">int</span><span class="op" id="5950223">(</span><span class="ident" id="5950224">size</span><span class="op" id="5950228">)</span>&nbsp;<span class="op" id="5950230">&gt;</span>&nbsp;<span class="builtinfunc" id="5950232">len</span><span class="op" id="5950235">(</span><span class="ident" id="5950236">b</span><span class="op" id="5950237">)</span>&nbsp;<span class="op" id="5950239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5950245">return</span>&nbsp;<span class="ident" id="5950252">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5950265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5950270">if</span>&nbsp;<span class="ident" id="5950273">tag</span>&nbsp;<span class="op" id="5950277">==</span>&nbsp;<span class="ident" id="5950280">zip64ExtraId</span>&nbsp;<span class="op" id="5950293">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5950299">//&nbsp;update&nbsp;directory&nbsp;values&nbsp;from&nbsp;the&nbsp;zip64&nbsp;extra&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950357">eb</span>&nbsp;<span class="op" id="5950360">:=</span>&nbsp;<span class="ident" id="5950363">readBuf</span><span class="op" id="5950370">(</span><span class="ident" id="5950371">b</span><span class="op" id="5950372">[</span><span class="op" id="5950373">:</span><span class="ident" id="5950374">size</span><span class="op" id="5950378">]</span><span class="op" id="5950379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5950385">if</span>&nbsp;<span class="builtinfunc" id="5950388">len</span><span class="op" id="5950391">(</span><span class="ident" id="5950392">eb</span><span class="op" id="5950394">)</span>&nbsp;<span class="op" id="5950396">&gt;=</span>&nbsp;<span class="num" id="5950399">8</span>&nbsp;<span class="op" id="5950401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950408">f</span><span class="op" id="5950409">.</span><span class="ident" id="5950410">UncompressedSize64</span>&nbsp;<span class="op" id="5950429">=</span>&nbsp;<span class="ident" id="5950431">eb</span><span class="op" id="5950433">.</span><span class="ident" id="5950434">uint64</span><span class="op" id="5950440">(</span><span class="op" id="5950441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5950447">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5950453">if</span>&nbsp;<span class="builtinfunc" id="5950456">len</span><span class="op" id="5950459">(</span><span class="ident" id="5950460">eb</span><span class="op" id="5950462">)</span>&nbsp;<span class="op" id="5950464">&gt;=</span>&nbsp;<span class="num" id="5950467">8</span>&nbsp;<span class="op" id="5950469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950476">f</span><span class="op" id="5950477">.</span><span class="ident" id="5950478">CompressedSize64</span>&nbsp;<span class="op" id="5950495">=</span>&nbsp;<span class="ident" id="5950497">eb</span><span class="op" id="5950499">.</span><span class="ident" id="5950500">uint64</span><span class="op" id="5950506">(</span><span class="op" id="5950507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5950513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5950519">if</span>&nbsp;<span class="builtinfunc" id="5950522">len</span><span class="op" id="5950525">(</span><span class="ident" id="5950526">eb</span><span class="op" id="5950528">)</span>&nbsp;<span class="op" id="5950530">&gt;=</span>&nbsp;<span class="num" id="5950533">8</span>&nbsp;<span class="op" id="5950535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950542">f</span><span class="op" id="5950543">.</span><span class="ident" id="5950544">headerOffset</span>&nbsp;<span class="op" id="5950557">=</span>&nbsp;<span class="ident" id="5950559">int64</span><span class="op" id="5950564">(</span><span class="ident" id="5950565">eb</span><span class="op" id="5950567">.</span><span class="ident" id="5950568">uint64</span><span class="op" id="5950574">(</span><span class="op" id="5950575">)</span><span class="op" id="5950576">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5950582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5950587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950592">b</span>&nbsp;<span class="op" id="5950594">=</span>&nbsp;<span class="ident" id="5950596">b</span><span class="op" id="5950597">[</span><span class="ident" id="5950598">size</span><span class="op" id="5950602">:</span><span class="op" id="5950603">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5950607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5950611">//&nbsp;Should&nbsp;have&nbsp;consumed&nbsp;the&nbsp;whole&nbsp;header.</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5950655">//&nbsp;But&nbsp;popular&nbsp;zip&nbsp;&amp;&nbsp;JAR&nbsp;creation&nbsp;tools&nbsp;are&nbsp;broken&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5950712">//&nbsp;may&nbsp;pad&nbsp;extra&nbsp;zeros&nbsp;at&nbsp;the&nbsp;end,&nbsp;so&nbsp;accept&nbsp;those</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5950765">//&nbsp;too.&nbsp;See&nbsp;golang.org/issue/8186.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5950802">for</span>&nbsp;<span class="ident" id="5950806">_</span><span class="op" id="5950807">,</span>&nbsp;<span class="ident" id="5950809">v</span>&nbsp;<span class="op" id="5950811">:=</span>&nbsp;<span class="keyword" id="5950814">range</span>&nbsp;<span class="ident" id="5950820">b</span>&nbsp;<span class="op" id="5950822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5950827">if</span>&nbsp;<span class="ident" id="5950830">v</span>&nbsp;<span class="op" id="5950832">!=</span>&nbsp;<span class="num" id="5950835">0</span>&nbsp;<span class="op" id="5950837">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5950843">return</span>&nbsp;<span class="ident" id="5950850">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5950863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5950867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5950870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5950873">return</span>&nbsp;<span class="ident" id="5950880">nil</span><br>
<span class="lineno">280</span><span class="op" id="5950884">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5950887">func</span>&nbsp;<span class="ident" id="5950892">readDataDescriptor</span><span class="op" id="5950910">(</span><span class="ident" id="5950911">r</span>&nbsp;<span class="ident" id="5950913">io</span><span class="op" id="5950915">.</span><span class="ident" id="5950916">Reader</span><span class="op" id="5950922">,</span>&nbsp;<span class="ident" id="5950924">f</span>&nbsp;<span class="op" id="5950926">*</span><span class="ident" id="5950927">File</span><span class="op" id="5950931">)</span>&nbsp;<span class="builtintype" id="5950933">error</span>&nbsp;<span class="op" id="5950939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5950942">var</span>&nbsp;<span class="ident" id="5950946">buf</span>&nbsp;<span class="op" id="5950950">[</span><span class="ident" id="5950951">dataDescriptorLen</span><span class="op" id="5950968">]</span><span class="builtintype" id="5950969">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5950976">//&nbsp;The&nbsp;spec&nbsp;says:&nbsp;&#34;Although&nbsp;not&nbsp;originally&nbsp;assigned&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5951031">//&nbsp;signature,&nbsp;the&nbsp;value&nbsp;0x08074b50&nbsp;has&nbsp;commonly&nbsp;been&nbsp;adopted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5951093">//&nbsp;as&nbsp;a&nbsp;signature&nbsp;value&nbsp;for&nbsp;the&nbsp;data&nbsp;descriptor&nbsp;record.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5951150">//&nbsp;Implementers&nbsp;should&nbsp;be&nbsp;aware&nbsp;that&nbsp;ZIP&nbsp;files&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5951205">//&nbsp;encountered&nbsp;with&nbsp;or&nbsp;without&nbsp;this&nbsp;signature&nbsp;marking&nbsp;data</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5951265">//&nbsp;descriptors&nbsp;and&nbsp;should&nbsp;account&nbsp;for&nbsp;either&nbsp;case&nbsp;when&nbsp;reading</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5951329">//&nbsp;ZIP&nbsp;files&nbsp;to&nbsp;ensure&nbsp;compatibility.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5951369">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5951373">//&nbsp;dataDescriptorLen&nbsp;includes&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;signature&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5951434">//&nbsp;first&nbsp;read&nbsp;just&nbsp;those&nbsp;4&nbsp;bytes&nbsp;to&nbsp;see&nbsp;if&nbsp;it&nbsp;exists.</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5951489">if</span>&nbsp;<span class="ident" id="5951492">_</span><span class="op" id="5951493">,</span>&nbsp;<span class="ident" id="5951495">err</span>&nbsp;<span class="op" id="5951499">:=</span>&nbsp;<span class="ident" id="5951502">io</span><span class="op" id="5951504">.</span><span class="ident" id="5951505">ReadFull</span><span class="op" id="5951513">(</span><span class="ident" id="5951514">r</span><span class="op" id="5951515">,</span>&nbsp;<span class="ident" id="5951517">buf</span><span class="op" id="5951520">[</span><span class="op" id="5951521">:</span><span class="num" id="5951522">4</span><span class="op" id="5951523">]</span><span class="op" id="5951524">)</span><span class="op" id="5951525">;</span>&nbsp;<span class="ident" id="5951527">err</span>&nbsp;<span class="op" id="5951531">!=</span>&nbsp;<span class="ident" id="5951534">nil</span>&nbsp;<span class="op" id="5951538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5951542">return</span>&nbsp;<span class="ident" id="5951549">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5951554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951557">off</span>&nbsp;<span class="op" id="5951561">:=</span>&nbsp;<span class="num" id="5951564">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951567">maybeSig</span>&nbsp;<span class="op" id="5951576">:=</span>&nbsp;<span class="ident" id="5951579">readBuf</span><span class="op" id="5951586">(</span><span class="ident" id="5951587">buf</span><span class="op" id="5951590">[</span><span class="op" id="5951591">:</span><span class="num" id="5951592">4</span><span class="op" id="5951593">]</span><span class="op" id="5951594">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5951597">if</span>&nbsp;<span class="ident" id="5951600">maybeSig</span><span class="op" id="5951608">.</span><span class="builtintype" id="5951609">uint32</span><span class="op" id="5951615">(</span><span class="op" id="5951616">)</span>&nbsp;<span class="op" id="5951618">!=</span>&nbsp;<span class="ident" id="5951621">dataDescriptorSignature</span>&nbsp;<span class="op" id="5951645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5951649">//&nbsp;No&nbsp;data&nbsp;descriptor&nbsp;signature.&nbsp;Keep&nbsp;these&nbsp;four</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5951700">//&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951712">off</span>&nbsp;<span class="op" id="5951716">+=</span>&nbsp;<span class="num" id="5951719">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5951722">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5951725">if</span>&nbsp;<span class="ident" id="5951728">_</span><span class="op" id="5951729">,</span>&nbsp;<span class="ident" id="5951731">err</span>&nbsp;<span class="op" id="5951735">:=</span>&nbsp;<span class="ident" id="5951738">io</span><span class="op" id="5951740">.</span><span class="ident" id="5951741">ReadFull</span><span class="op" id="5951749">(</span><span class="ident" id="5951750">r</span><span class="op" id="5951751">,</span>&nbsp;<span class="ident" id="5951753">buf</span><span class="op" id="5951756">[</span><span class="ident" id="5951757">off</span><span class="op" id="5951760">:</span><span class="num" id="5951761">12</span><span class="op" id="5951763">]</span><span class="op" id="5951764">)</span><span class="op" id="5951765">;</span>&nbsp;<span class="ident" id="5951767">err</span>&nbsp;<span class="op" id="5951771">!=</span>&nbsp;<span class="ident" id="5951774">nil</span>&nbsp;<span class="op" id="5951778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5951782">return</span>&nbsp;<span class="ident" id="5951789">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5951794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951797">b</span>&nbsp;<span class="op" id="5951799">:=</span>&nbsp;<span class="ident" id="5951802">readBuf</span><span class="op" id="5951809">(</span><span class="ident" id="5951810">buf</span><span class="op" id="5951813">[</span><span class="op" id="5951814">:</span><span class="num" id="5951815">12</span><span class="op" id="5951817">]</span><span class="op" id="5951818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5951821">if</span>&nbsp;<span class="ident" id="5951824">b</span><span class="op" id="5951825">.</span><span class="builtintype" id="5951826">uint32</span><span class="op" id="5951832">(</span><span class="op" id="5951833">)</span>&nbsp;<span class="op" id="5951835">!=</span>&nbsp;<span class="ident" id="5951838">f</span><span class="op" id="5951839">.</span><span class="ident" id="5951840">CRC32</span>&nbsp;<span class="op" id="5951846">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5951850">return</span>&nbsp;<span class="ident" id="5951857">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5951870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5951874">//&nbsp;The&nbsp;two&nbsp;sizes&nbsp;that&nbsp;follow&nbsp;here&nbsp;can&nbsp;be&nbsp;either&nbsp;32&nbsp;bits&nbsp;or&nbsp;64&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5951942">//&nbsp;but&nbsp;the&nbsp;spec&nbsp;is&nbsp;not&nbsp;very&nbsp;clear&nbsp;on&nbsp;this&nbsp;and&nbsp;different</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5951999">//&nbsp;interpretations&nbsp;has&nbsp;been&nbsp;made&nbsp;causing&nbsp;incompatibilities.&nbsp;We</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5952063">//&nbsp;already&nbsp;have&nbsp;the&nbsp;sizes&nbsp;from&nbsp;the&nbsp;central&nbsp;directory&nbsp;so&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5952127">//&nbsp;just&nbsp;ignore&nbsp;these.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952151">return</span>&nbsp;<span class="ident" id="5952158">nil</span><br>
<span class="lineno">320</span><span class="op" id="5952162">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5952165">func</span>&nbsp;<span class="ident" id="5952170">readDirectoryEnd</span><span class="op" id="5952186">(</span><span class="ident" id="5952187">r</span>&nbsp;<span class="ident" id="5952189">io</span><span class="op" id="5952191">.</span><span class="ident" id="5952192">ReaderAt</span><span class="op" id="5952200">,</span>&nbsp;<span class="ident" id="5952202">size</span>&nbsp;<span class="ident" id="5952207">int64</span><span class="op" id="5952212">)</span>&nbsp;<span class="op" id="5952214">(</span><span class="ident" id="5952215">dir</span>&nbsp;<span class="op" id="5952219">*</span><span class="ident" id="5952220">directoryEnd</span><span class="op" id="5952232">,</span>&nbsp;<span class="ident" id="5952234">err</span>&nbsp;<span class="builtintype" id="5952238">error</span><span class="op" id="5952243">)</span>&nbsp;<span class="op" id="5952245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5952248">//&nbsp;look&nbsp;for&nbsp;directoryEndSignature&nbsp;in&nbsp;the&nbsp;last&nbsp;1k,&nbsp;then&nbsp;in&nbsp;the&nbsp;last&nbsp;65k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952320">var</span>&nbsp;<span class="ident" id="5952324">buf</span>&nbsp;<span class="op" id="5952328">[</span><span class="op" id="5952329">]</span><span class="builtintype" id="5952330">byte</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952336">var</span>&nbsp;<span class="ident" id="5952340">directoryEndOffset</span>&nbsp;<span class="ident" id="5952359">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952366">for</span>&nbsp;<span class="ident" id="5952370">i</span><span class="op" id="5952371">,</span>&nbsp;<span class="ident" id="5952373">bLen</span>&nbsp;<span class="op" id="5952378">:=</span>&nbsp;<span class="keyword" id="5952381">range</span>&nbsp;<span class="op" id="5952387">[</span><span class="op" id="5952388">]</span><span class="ident" id="5952389">int64</span><span class="op" id="5952394">{</span><span class="num" id="5952395">1024</span><span class="op" id="5952399">,</span>&nbsp;<span class="num" id="5952401">65</span>&nbsp;<span class="op" id="5952404">*</span>&nbsp;<span class="num" id="5952406">1024</span><span class="op" id="5952410">}</span>&nbsp;<span class="op" id="5952412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952416">if</span>&nbsp;<span class="ident" id="5952419">bLen</span>&nbsp;<span class="op" id="5952424">&gt;</span>&nbsp;<span class="ident" id="5952426">size</span>&nbsp;<span class="op" id="5952431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952436">bLen</span>&nbsp;<span class="op" id="5952441">=</span>&nbsp;<span class="ident" id="5952443">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5952450">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952454">buf</span>&nbsp;<span class="op" id="5952458">=</span>&nbsp;<span class="builtinfunc" id="5952460">make</span><span class="op" id="5952464">(</span><span class="op" id="5952465">[</span><span class="op" id="5952466">]</span><span class="builtintype" id="5952467">byte</span><span class="op" id="5952471">,</span>&nbsp;<span class="builtintype" id="5952473">int</span><span class="op" id="5952476">(</span><span class="ident" id="5952477">bLen</span><span class="op" id="5952481">)</span><span class="op" id="5952482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952486">if</span>&nbsp;<span class="ident" id="5952489">_</span><span class="op" id="5952490">,</span>&nbsp;<span class="ident" id="5952492">err</span>&nbsp;<span class="op" id="5952496">:=</span>&nbsp;<span class="ident" id="5952499">r</span><span class="op" id="5952500">.</span><span class="ident" id="5952501">ReadAt</span><span class="op" id="5952507">(</span><span class="ident" id="5952508">buf</span><span class="op" id="5952511">,</span>&nbsp;<span class="ident" id="5952513">size</span><span class="op" id="5952517">-</span><span class="ident" id="5952518">bLen</span><span class="op" id="5952522">)</span><span class="op" id="5952523">;</span>&nbsp;<span class="ident" id="5952525">err</span>&nbsp;<span class="op" id="5952529">!=</span>&nbsp;<span class="ident" id="5952532">nil</span>&nbsp;<span class="op" id="5952536">&amp;&amp;</span>&nbsp;<span class="ident" id="5952539">err</span>&nbsp;<span class="op" id="5952543">!=</span>&nbsp;<span class="ident" id="5952546">io</span><span class="op" id="5952548">.</span><span class="ident" id="5952549">EOF</span>&nbsp;<span class="op" id="5952553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952558">return</span>&nbsp;<span class="ident" id="5952565">nil</span><span class="op" id="5952568">,</span>&nbsp;<span class="ident" id="5952570">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5952576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952580">if</span>&nbsp;<span class="ident" id="5952583">p</span>&nbsp;<span class="op" id="5952585">:=</span>&nbsp;<span class="ident" id="5952588">findSignatureInBlock</span><span class="op" id="5952608">(</span><span class="ident" id="5952609">buf</span><span class="op" id="5952612">)</span><span class="op" id="5952613">;</span>&nbsp;<span class="ident" id="5952615">p</span>&nbsp;<span class="op" id="5952617">&gt;=</span>&nbsp;<span class="num" id="5952620">0</span>&nbsp;<span class="op" id="5952622">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952627">buf</span>&nbsp;<span class="op" id="5952631">=</span>&nbsp;<span class="ident" id="5952633">buf</span><span class="op" id="5952636">[</span><span class="ident" id="5952637">p</span><span class="op" id="5952638">:</span><span class="op" id="5952639">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952644">directoryEndOffset</span>&nbsp;<span class="op" id="5952663">=</span>&nbsp;<span class="ident" id="5952665">size</span>&nbsp;<span class="op" id="5952670">-</span>&nbsp;<span class="ident" id="5952672">bLen</span>&nbsp;<span class="op" id="5952677">+</span>&nbsp;<span class="ident" id="5952679">int64</span><span class="op" id="5952684">(</span><span class="ident" id="5952685">p</span><span class="op" id="5952686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952691">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5952699">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952703">if</span>&nbsp;<span class="ident" id="5952706">i</span>&nbsp;<span class="op" id="5952708">==</span>&nbsp;<span class="num" id="5952711">1</span>&nbsp;<span class="op" id="5952713">||</span>&nbsp;<span class="ident" id="5952716">bLen</span>&nbsp;<span class="op" id="5952721">==</span>&nbsp;<span class="ident" id="5952724">size</span>&nbsp;<span class="op" id="5952729">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952734">return</span>&nbsp;<span class="ident" id="5952741">nil</span><span class="op" id="5952744">,</span>&nbsp;<span class="ident" id="5952746">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5952758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5952761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5952765">//&nbsp;read&nbsp;header&nbsp;into&nbsp;struct</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952793">b</span>&nbsp;<span class="op" id="5952795">:=</span>&nbsp;<span class="ident" id="5952798">readBuf</span><span class="op" id="5952805">(</span><span class="ident" id="5952806">buf</span><span class="op" id="5952809">[</span><span class="num" id="5952810">4</span><span class="op" id="5952811">:</span><span class="op" id="5952812">]</span><span class="op" id="5952813">)</span>&nbsp;<span class="comment" id="5952815">//&nbsp;skip&nbsp;signature</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952834">d</span>&nbsp;<span class="op" id="5952836">:=</span>&nbsp;<span class="op" id="5952839">&amp;</span><span class="ident" id="5952840">directoryEnd</span><span class="op" id="5952852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952856">diskNbr</span><span class="op" id="5952863">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5952876">uint32</span><span class="op" id="5952882">(</span><span class="ident" id="5952883">b</span><span class="op" id="5952884">.</span><span class="builtintype" id="5952885">uint16</span><span class="op" id="5952891">(</span><span class="op" id="5952892">)</span><span class="op" id="5952893">)</span><span class="op" id="5952894">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952898">dirDiskNbr</span><span class="op" id="5952908">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5952918">uint32</span><span class="op" id="5952924">(</span><span class="ident" id="5952925">b</span><span class="op" id="5952926">.</span><span class="builtintype" id="5952927">uint16</span><span class="op" id="5952933">(</span><span class="op" id="5952934">)</span><span class="op" id="5952935">)</span><span class="op" id="5952936">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952940">dirRecordsThisDisk</span><span class="op" id="5952958">:</span>&nbsp;<span class="ident" id="5952960">uint64</span><span class="op" id="5952966">(</span><span class="ident" id="5952967">b</span><span class="op" id="5952968">.</span><span class="builtintype" id="5952969">uint16</span><span class="op" id="5952975">(</span><span class="op" id="5952976">)</span><span class="op" id="5952977">)</span><span class="op" id="5952978">,</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952982">directoryRecords</span><span class="op" id="5952998">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5953002">uint64</span><span class="op" id="5953008">(</span><span class="ident" id="5953009">b</span><span class="op" id="5953010">.</span><span class="builtintype" id="5953011">uint16</span><span class="op" id="5953017">(</span><span class="op" id="5953018">)</span><span class="op" id="5953019">)</span><span class="op" id="5953020">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953024">directorySize</span><span class="op" id="5953037">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5953044">uint64</span><span class="op" id="5953050">(</span><span class="ident" id="5953051">b</span><span class="op" id="5953052">.</span><span class="builtintype" id="5953053">uint32</span><span class="op" id="5953059">(</span><span class="op" id="5953060">)</span><span class="op" id="5953061">)</span><span class="op" id="5953062">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953066">directoryOffset</span><span class="op" id="5953081">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5953086">uint64</span><span class="op" id="5953092">(</span><span class="ident" id="5953093">b</span><span class="op" id="5953094">.</span><span class="builtintype" id="5953095">uint32</span><span class="op" id="5953101">(</span><span class="op" id="5953102">)</span><span class="op" id="5953103">)</span><span class="op" id="5953104">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953108">commentLen</span><span class="op" id="5953118">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5953128">b</span><span class="op" id="5953129">.</span><span class="builtintype" id="5953130">uint16</span><span class="op" id="5953136">(</span><span class="op" id="5953137">)</span><span class="op" id="5953138">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5953141">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953144">l</span>&nbsp;<span class="op" id="5953146">:=</span>&nbsp;<span class="builtintype" id="5953149">int</span><span class="op" id="5953152">(</span><span class="ident" id="5953153">d</span><span class="op" id="5953154">.</span><span class="ident" id="5953155">commentLen</span><span class="op" id="5953165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953168">if</span>&nbsp;<span class="ident" id="5953171">l</span>&nbsp;<span class="op" id="5953173">&gt;</span>&nbsp;<span class="builtinfunc" id="5953175">len</span><span class="op" id="5953178">(</span><span class="ident" id="5953179">b</span><span class="op" id="5953180">)</span>&nbsp;<span class="op" id="5953182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953186">return</span>&nbsp;<span class="ident" id="5953193">nil</span><span class="op" id="5953196">,</span>&nbsp;<span class="ident" id="5953198">errors</span><span class="op" id="5953204">.</span><span class="ident" id="5953205">New</span><span class="op" id="5953208">(</span><span class="string" id="5953209">&#34;zip:&nbsp;invalid&nbsp;comment&nbsp;length&#34;</span><span class="op" id="5953238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5953241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953244">d</span><span class="op" id="5953245">.</span><span class="ident" id="5953246">comment</span>&nbsp;<span class="op" id="5953254">=</span>&nbsp;<span class="builtintype" id="5953256">string</span><span class="op" id="5953262">(</span><span class="ident" id="5953263">b</span><span class="op" id="5953264">[</span><span class="op" id="5953265">:</span><span class="ident" id="5953266">l</span><span class="op" id="5953267">]</span><span class="op" id="5953268">)</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953272">p</span><span class="op" id="5953273">,</span>&nbsp;<span class="ident" id="5953275">err</span>&nbsp;<span class="op" id="5953279">:=</span>&nbsp;<span class="ident" id="5953282">findDirectory64End</span><span class="op" id="5953300">(</span><span class="ident" id="5953301">r</span><span class="op" id="5953302">,</span>&nbsp;<span class="ident" id="5953304">directoryEndOffset</span><span class="op" id="5953322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953325">if</span>&nbsp;<span class="ident" id="5953328">err</span>&nbsp;<span class="op" id="5953332">==</span>&nbsp;<span class="ident" id="5953335">nil</span>&nbsp;<span class="op" id="5953339">&amp;&amp;</span>&nbsp;<span class="ident" id="5953342">p</span>&nbsp;<span class="op" id="5953344">&gt;=</span>&nbsp;<span class="num" id="5953347">0</span>&nbsp;<span class="op" id="5953349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953353">err</span>&nbsp;<span class="op" id="5953357">=</span>&nbsp;<span class="ident" id="5953359">readDirectory64End</span><span class="op" id="5953377">(</span><span class="ident" id="5953378">r</span><span class="op" id="5953379">,</span>&nbsp;<span class="ident" id="5953381">p</span><span class="op" id="5953382">,</span>&nbsp;<span class="ident" id="5953384">d</span><span class="op" id="5953385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5953388">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953391">if</span>&nbsp;<span class="ident" id="5953394">err</span>&nbsp;<span class="op" id="5953398">!=</span>&nbsp;<span class="ident" id="5953401">nil</span>&nbsp;<span class="op" id="5953405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953409">return</span>&nbsp;<span class="ident" id="5953416">nil</span><span class="op" id="5953419">,</span>&nbsp;<span class="ident" id="5953421">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5953426">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5953430">//&nbsp;Make&nbsp;sure&nbsp;directoryOffset&nbsp;points&nbsp;to&nbsp;somewhere&nbsp;in&nbsp;our&nbsp;file.</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953493">if</span>&nbsp;<span class="ident" id="5953496">o</span>&nbsp;<span class="op" id="5953498">:=</span>&nbsp;<span class="ident" id="5953501">int64</span><span class="op" id="5953506">(</span><span class="ident" id="5953507">d</span><span class="op" id="5953508">.</span><span class="ident" id="5953509">directoryOffset</span><span class="op" id="5953524">)</span><span class="op" id="5953525">;</span>&nbsp;<span class="ident" id="5953527">o</span>&nbsp;<span class="op" id="5953529">&lt;</span>&nbsp;<span class="num" id="5953531">0</span>&nbsp;<span class="op" id="5953533">||</span>&nbsp;<span class="ident" id="5953536">o</span>&nbsp;<span class="op" id="5953538">&gt;=</span>&nbsp;<span class="ident" id="5953541">size</span>&nbsp;<span class="op" id="5953546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953550">return</span>&nbsp;<span class="ident" id="5953557">nil</span><span class="op" id="5953560">,</span>&nbsp;<span class="ident" id="5953562">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5953573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953576">return</span>&nbsp;<span class="ident" id="5953583">d</span><span class="op" id="5953584">,</span>&nbsp;<span class="ident" id="5953586">nil</span><br>
<span class="lineno"></span><span class="op" id="5953590">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="comment" id="5953593">//&nbsp;findDirectory64End&nbsp;tries&nbsp;to&nbsp;read&nbsp;the&nbsp;zip64&nbsp;locator&nbsp;just&nbsp;before&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5953663">//&nbsp;directory&nbsp;end&nbsp;and&nbsp;returns&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;zip64&nbsp;directory&nbsp;end&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="5953733">//&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="5953743">func</span>&nbsp;<span class="ident" id="5953748">findDirectory64End</span><span class="op" id="5953766">(</span><span class="ident" id="5953767">r</span>&nbsp;<span class="ident" id="5953769">io</span><span class="op" id="5953771">.</span><span class="ident" id="5953772">ReaderAt</span><span class="op" id="5953780">,</span>&nbsp;<span class="ident" id="5953782">directoryEndOffset</span>&nbsp;<span class="ident" id="5953801">int64</span><span class="op" id="5953806">)</span>&nbsp;<span class="op" id="5953808">(</span><span class="ident" id="5953809">int64</span><span class="op" id="5953814">,</span>&nbsp;<span class="builtintype" id="5953816">error</span><span class="op" id="5953821">)</span>&nbsp;<span class="op" id="5953823">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953826">locOffset</span>&nbsp;<span class="op" id="5953836">:=</span>&nbsp;<span class="ident" id="5953839">directoryEndOffset</span>&nbsp;<span class="op" id="5953858">-</span>&nbsp;<span class="ident" id="5953860">directory64LocLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953879">if</span>&nbsp;<span class="ident" id="5953882">locOffset</span>&nbsp;<span class="op" id="5953892">&lt;</span>&nbsp;<span class="num" id="5953894">0</span>&nbsp;<span class="op" id="5953896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953900">return</span>&nbsp;<span class="op" id="5953907">-</span><span class="num" id="5953908">1</span><span class="op" id="5953909">,</span>&nbsp;<span class="ident" id="5953911">nil</span>&nbsp;<span class="comment" id="5953915">//&nbsp;no&nbsp;need&nbsp;to&nbsp;look&nbsp;for&nbsp;a&nbsp;header&nbsp;outside&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5953965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953968">buf</span>&nbsp;<span class="op" id="5953972">:=</span>&nbsp;<span class="builtinfunc" id="5953975">make</span><span class="op" id="5953979">(</span><span class="op" id="5953980">[</span><span class="op" id="5953981">]</span><span class="builtintype" id="5953982">byte</span><span class="op" id="5953986">,</span>&nbsp;<span class="ident" id="5953988">directory64LocLen</span><span class="op" id="5954005">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954008">if</span>&nbsp;<span class="ident" id="5954011">_</span><span class="op" id="5954012">,</span>&nbsp;<span class="ident" id="5954014">err</span>&nbsp;<span class="op" id="5954018">:=</span>&nbsp;<span class="ident" id="5954021">r</span><span class="op" id="5954022">.</span><span class="ident" id="5954023">ReadAt</span><span class="op" id="5954029">(</span><span class="ident" id="5954030">buf</span><span class="op" id="5954033">,</span>&nbsp;<span class="ident" id="5954035">locOffset</span><span class="op" id="5954044">)</span><span class="op" id="5954045">;</span>&nbsp;<span class="ident" id="5954047">err</span>&nbsp;<span class="op" id="5954051">!=</span>&nbsp;<span class="ident" id="5954054">nil</span>&nbsp;<span class="op" id="5954058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954062">return</span>&nbsp;<span class="op" id="5954069">-</span><span class="num" id="5954070">1</span><span class="op" id="5954071">,</span>&nbsp;<span class="ident" id="5954073">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5954078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954081">b</span>&nbsp;<span class="op" id="5954083">:=</span>&nbsp;<span class="ident" id="5954086">readBuf</span><span class="op" id="5954093">(</span><span class="ident" id="5954094">buf</span><span class="op" id="5954097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954100">if</span>&nbsp;<span class="ident" id="5954103">sig</span>&nbsp;<span class="op" id="5954107">:=</span>&nbsp;<span class="ident" id="5954110">b</span><span class="op" id="5954111">.</span><span class="builtintype" id="5954112">uint32</span><span class="op" id="5954118">(</span><span class="op" id="5954119">)</span><span class="op" id="5954120">;</span>&nbsp;<span class="ident" id="5954122">sig</span>&nbsp;<span class="op" id="5954126">!=</span>&nbsp;<span class="ident" id="5954129">directory64LocSignature</span>&nbsp;<span class="op" id="5954153">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954157">return</span>&nbsp;<span class="op" id="5954164">-</span><span class="num" id="5954165">1</span><span class="op" id="5954166">,</span>&nbsp;<span class="ident" id="5954168">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5954173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954176">b</span>&nbsp;<span class="op" id="5954178">=</span>&nbsp;<span class="ident" id="5954180">b</span><span class="op" id="5954181">[</span><span class="num" id="5954182">4</span><span class="op" id="5954183">:</span><span class="op" id="5954184">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5954192">//&nbsp;skip&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954273">p</span>&nbsp;<span class="op" id="5954275">:=</span>&nbsp;<span class="ident" id="5954278">b</span><span class="op" id="5954279">.</span><span class="ident" id="5954280">uint64</span><span class="op" id="5954286">(</span><span class="op" id="5954287">)</span>&nbsp;<span class="comment" id="5954289">//&nbsp;relative&nbsp;offset&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954354">return</span>&nbsp;<span class="ident" id="5954361">int64</span><span class="op" id="5954366">(</span><span class="ident" id="5954367">p</span><span class="op" id="5954368">)</span><span class="op" id="5954369">,</span>&nbsp;<span class="ident" id="5954371">nil</span><br>
<span class="lineno">395</span><span class="op" id="5954375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5954378">//&nbsp;readDirectory64End&nbsp;reads&nbsp;the&nbsp;zip64&nbsp;directory&nbsp;end&nbsp;and&nbsp;updates&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5954446">//&nbsp;directory&nbsp;end&nbsp;with&nbsp;the&nbsp;zip64&nbsp;directory&nbsp;end&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5954500">func</span>&nbsp;<span class="ident" id="5954505">readDirectory64End</span><span class="op" id="5954523">(</span><span class="ident" id="5954524">r</span>&nbsp;<span class="ident" id="5954526">io</span><span class="op" id="5954528">.</span><span class="ident" id="5954529">ReaderAt</span><span class="op" id="5954537">,</span>&nbsp;<span class="ident" id="5954539">offset</span>&nbsp;<span class="ident" id="5954546">int64</span><span class="op" id="5954551">,</span>&nbsp;<span class="ident" id="5954553">d</span>&nbsp;<span class="op" id="5954555">*</span><span class="ident" id="5954556">directoryEnd</span><span class="op" id="5954568">)</span>&nbsp;<span class="op" id="5954570">(</span><span class="ident" id="5954571">err</span>&nbsp;<span class="builtintype" id="5954575">error</span><span class="op" id="5954580">)</span>&nbsp;<span class="op" id="5954582">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954585">buf</span>&nbsp;<span class="op" id="5954589">:=</span>&nbsp;<span class="builtinfunc" id="5954592">make</span><span class="op" id="5954596">(</span><span class="op" id="5954597">[</span><span class="op" id="5954598">]</span><span class="builtintype" id="5954599">byte</span><span class="op" id="5954603">,</span>&nbsp;<span class="ident" id="5954605">directory64EndLen</span><span class="op" id="5954622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954625">if</span>&nbsp;<span class="ident" id="5954628">_</span><span class="op" id="5954629">,</span>&nbsp;<span class="ident" id="5954631">err</span>&nbsp;<span class="op" id="5954635">:=</span>&nbsp;<span class="ident" id="5954638">r</span><span class="op" id="5954639">.</span><span class="ident" id="5954640">ReadAt</span><span class="op" id="5954646">(</span><span class="ident" id="5954647">buf</span><span class="op" id="5954650">,</span>&nbsp;<span class="ident" id="5954652">offset</span><span class="op" id="5954658">)</span><span class="op" id="5954659">;</span>&nbsp;<span class="ident" id="5954661">err</span>&nbsp;<span class="op" id="5954665">!=</span>&nbsp;<span class="ident" id="5954668">nil</span>&nbsp;<span class="op" id="5954672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954676">return</span>&nbsp;<span class="ident" id="5954683">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5954688">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954692">b</span>&nbsp;<span class="op" id="5954694">:=</span>&nbsp;<span class="ident" id="5954697">readBuf</span><span class="op" id="5954704">(</span><span class="ident" id="5954705">buf</span><span class="op" id="5954708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954711">if</span>&nbsp;<span class="ident" id="5954714">sig</span>&nbsp;<span class="op" id="5954718">:=</span>&nbsp;<span class="ident" id="5954721">b</span><span class="op" id="5954722">.</span><span class="builtintype" id="5954723">uint32</span><span class="op" id="5954729">(</span><span class="op" id="5954730">)</span><span class="op" id="5954731">;</span>&nbsp;<span class="ident" id="5954733">sig</span>&nbsp;<span class="op" id="5954737">!=</span>&nbsp;<span class="ident" id="5954740">directory64EndSignature</span>&nbsp;<span class="op" id="5954764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954768">return</span>&nbsp;<span class="ident" id="5954775">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5954786">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954790">b</span>&nbsp;<span class="op" id="5954792">=</span>&nbsp;<span class="ident" id="5954794">b</span><span class="op" id="5954795">[</span><span class="num" id="5954796">12</span><span class="op" id="5954798">:</span><span class="op" id="5954799">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5954824">//&nbsp;skip&nbsp;dir&nbsp;size,&nbsp;version&nbsp;and&nbsp;version&nbsp;needed&nbsp;(uint64&nbsp;+&nbsp;2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954891">d</span><span class="op" id="5954892">.</span><span class="ident" id="5954893">diskNbr</span>&nbsp;<span class="op" id="5954901">=</span>&nbsp;<span class="ident" id="5954903">b</span><span class="op" id="5954904">.</span><span class="builtintype" id="5954905">uint32</span><span class="op" id="5954911">(</span><span class="op" id="5954912">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5954925">//&nbsp;number&nbsp;of&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954949">d</span><span class="op" id="5954950">.</span><span class="ident" id="5954951">dirDiskNbr</span>&nbsp;<span class="op" id="5954962">=</span>&nbsp;<span class="ident" id="5954964">b</span><span class="op" id="5954965">.</span><span class="builtintype" id="5954966">uint32</span><span class="op" id="5954972">(</span><span class="op" id="5954973">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5954983">//&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955046">d</span><span class="op" id="5955047">.</span><span class="ident" id="5955048">dirRecordsThisDisk</span>&nbsp;<span class="op" id="5955067">=</span>&nbsp;<span class="ident" id="5955069">b</span><span class="op" id="5955070">.</span><span class="ident" id="5955071">uint64</span><span class="op" id="5955077">(</span><span class="op" id="5955078">)</span>&nbsp;<span class="comment" id="5955080">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory&nbsp;on&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955146">d</span><span class="op" id="5955147">.</span><span class="ident" id="5955148">directoryRecords</span>&nbsp;<span class="op" id="5955165">=</span>&nbsp;<span class="ident" id="5955167">b</span><span class="op" id="5955168">.</span><span class="ident" id="5955169">uint64</span><span class="op" id="5955175">(</span><span class="op" id="5955176">)</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5955180">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955233">d</span><span class="op" id="5955234">.</span><span class="ident" id="5955235">directorySize</span>&nbsp;<span class="op" id="5955249">=</span>&nbsp;<span class="ident" id="5955251">b</span><span class="op" id="5955252">.</span><span class="ident" id="5955253">uint64</span><span class="op" id="5955259">(</span><span class="op" id="5955260">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5955267">//&nbsp;size&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955301">d</span><span class="op" id="5955302">.</span><span class="ident" id="5955303">directoryOffset</span>&nbsp;<span class="op" id="5955319">=</span>&nbsp;<span class="ident" id="5955321">b</span><span class="op" id="5955322">.</span><span class="ident" id="5955323">uint64</span><span class="op" id="5955329">(</span><span class="op" id="5955330">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5955335">//&nbsp;offset&nbsp;of&nbsp;start&nbsp;of&nbsp;central&nbsp;directory&nbsp;with&nbsp;respect&nbsp;to&nbsp;the&nbsp;starting&nbsp;disk&nbsp;number</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955418">return</span>&nbsp;<span class="ident" id="5955425">nil</span><br>
<span class="lineno"></span><span class="op" id="5955429">}</span><br>
<span class="lineno">420</span><br>
<span class="lineno"></span><span class="keyword" id="5955432">func</span>&nbsp;<span class="ident" id="5955437">findSignatureInBlock</span><span class="op" id="5955457">(</span><span class="ident" id="5955458">b</span>&nbsp;<span class="op" id="5955460">[</span><span class="op" id="5955461">]</span><span class="builtintype" id="5955462">byte</span><span class="op" id="5955466">)</span>&nbsp;<span class="builtintype" id="5955468">int</span>&nbsp;<span class="op" id="5955472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955475">for</span>&nbsp;<span class="ident" id="5955479">i</span>&nbsp;<span class="op" id="5955481">:=</span>&nbsp;<span class="builtinfunc" id="5955484">len</span><span class="op" id="5955487">(</span><span class="ident" id="5955488">b</span><span class="op" id="5955489">)</span>&nbsp;<span class="op" id="5955491">-</span>&nbsp;<span class="ident" id="5955493">directoryEndLen</span><span class="op" id="5955508">;</span>&nbsp;<span class="ident" id="5955510">i</span>&nbsp;<span class="op" id="5955512">&gt;=</span>&nbsp;<span class="num" id="5955515">0</span><span class="op" id="5955516">;</span>&nbsp;<span class="ident" id="5955518">i</span><span class="op" id="5955519">--</span>&nbsp;<span class="op" id="5955522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5955526">//&nbsp;defined&nbsp;from&nbsp;directoryEndSignature&nbsp;in&nbsp;struct.go</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955579">if</span>&nbsp;<span class="ident" id="5955582">b</span><span class="op" id="5955583">[</span><span class="ident" id="5955584">i</span><span class="op" id="5955585">]</span>&nbsp;<span class="op" id="5955587">==</span>&nbsp;<span class="string" id="5955590">&#39;P&#39;</span>&nbsp;<span class="op" id="5955594">&amp;&amp;</span>&nbsp;<span class="ident" id="5955597">b</span><span class="op" id="5955598">[</span><span class="ident" id="5955599">i</span><span class="op" id="5955600">+</span><span class="num" id="5955601">1</span><span class="op" id="5955602">]</span>&nbsp;<span class="op" id="5955604">==</span>&nbsp;<span class="string" id="5955607">&#39;K&#39;</span>&nbsp;<span class="op" id="5955611">&amp;&amp;</span>&nbsp;<span class="ident" id="5955614">b</span><span class="op" id="5955615">[</span><span class="ident" id="5955616">i</span><span class="op" id="5955617">+</span><span class="num" id="5955618">2</span><span class="op" id="5955619">]</span>&nbsp;<span class="op" id="5955621">==</span>&nbsp;<span class="num" id="5955624">0x05</span>&nbsp;<span class="op" id="5955629">&amp;&amp;</span>&nbsp;<span class="ident" id="5955632">b</span><span class="op" id="5955633">[</span><span class="ident" id="5955634">i</span><span class="op" id="5955635">+</span><span class="num" id="5955636">3</span><span class="op" id="5955637">]</span>&nbsp;<span class="op" id="5955639">==</span>&nbsp;<span class="num" id="5955642">0x06</span>&nbsp;<span class="op" id="5955647">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5955652">//&nbsp;n&nbsp;is&nbsp;length&nbsp;of&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955681">n</span>&nbsp;<span class="op" id="5955683">:=</span>&nbsp;<span class="builtintype" id="5955686">int</span><span class="op" id="5955689">(</span><span class="ident" id="5955690">b</span><span class="op" id="5955691">[</span><span class="ident" id="5955692">i</span><span class="op" id="5955693">+</span><span class="ident" id="5955694">directoryEndLen</span><span class="op" id="5955709">-</span><span class="num" id="5955710">2</span><span class="op" id="5955711">]</span><span class="op" id="5955712">)</span>&nbsp;<span class="op" id="5955714">|</span>&nbsp;<span class="builtintype" id="5955716">int</span><span class="op" id="5955719">(</span><span class="ident" id="5955720">b</span><span class="op" id="5955721">[</span><span class="ident" id="5955722">i</span><span class="op" id="5955723">+</span><span class="ident" id="5955724">directoryEndLen</span><span class="op" id="5955739">-</span><span class="num" id="5955740">1</span><span class="op" id="5955741">]</span><span class="op" id="5955742">)</span><span class="op" id="5955743">&lt;&lt;</span><span class="num" id="5955745">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955750">if</span>&nbsp;<span class="ident" id="5955753">n</span><span class="op" id="5955754">+</span><span class="ident" id="5955755">directoryEndLen</span><span class="op" id="5955770">+</span><span class="ident" id="5955771">i</span>&nbsp;<span class="op" id="5955773">&lt;=</span>&nbsp;<span class="builtinfunc" id="5955776">len</span><span class="op" id="5955779">(</span><span class="ident" id="5955780">b</span><span class="op" id="5955781">)</span>&nbsp;<span class="op" id="5955783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955789">return</span>&nbsp;<span class="ident" id="5955796">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5955801">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5955805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5955808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955811">return</span>&nbsp;<span class="op" id="5955818">-</span><span class="num" id="5955819">1</span><br>
<span class="lineno"></span><span class="op" id="5955821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="keyword" id="5955824">type</span>&nbsp;<span class="ident" id="5955829">readBuf</span>&nbsp;<span class="op" id="5955837">[</span><span class="op" id="5955838">]</span><span class="builtintype" id="5955839">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5955845">func</span>&nbsp;<span class="op" id="5955850">(</span><span class="ident" id="5955851">b</span>&nbsp;<span class="op" id="5955853">*</span><span class="ident" id="5955854">readBuf</span><span class="op" id="5955861">)</span>&nbsp;<span class="builtintype" id="5955863">uint16</span><span class="op" id="5955869">(</span><span class="op" id="5955870">)</span>&nbsp;<span class="builtintype" id="5955872">uint16</span>&nbsp;<span class="op" id="5955879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955882">v</span>&nbsp;<span class="op" id="5955884">:=</span>&nbsp;<span class="ident" id="5955887">binary</span><span class="op" id="5955893">.</span><span class="ident" id="5955894">LittleEndian</span><span class="op" id="5955906">.</span><span class="ident" id="5955907">Uint16</span><span class="op" id="5955913">(</span><span class="op" id="5955914">*</span><span class="ident" id="5955915">b</span><span class="op" id="5955916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5955919">*</span><span class="ident" id="5955920">b</span>&nbsp;<span class="op" id="5955922">=</span>&nbsp;<span class="op" id="5955924">(</span><span class="op" id="5955925">*</span><span class="ident" id="5955926">b</span><span class="op" id="5955927">)</span><span class="op" id="5955928">[</span><span class="num" id="5955929">2</span><span class="op" id="5955930">:</span><span class="op" id="5955931">]</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955934">return</span>&nbsp;<span class="ident" id="5955941">v</span><br>
<span class="lineno"></span><span class="op" id="5955943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5955946">func</span>&nbsp;<span class="op" id="5955951">(</span><span class="ident" id="5955952">b</span>&nbsp;<span class="op" id="5955954">*</span><span class="ident" id="5955955">readBuf</span><span class="op" id="5955962">)</span>&nbsp;<span class="builtintype" id="5955964">uint32</span><span class="op" id="5955970">(</span><span class="op" id="5955971">)</span>&nbsp;<span class="builtintype" id="5955973">uint32</span>&nbsp;<span class="op" id="5955980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955983">v</span>&nbsp;<span class="op" id="5955985">:=</span>&nbsp;<span class="ident" id="5955988">binary</span><span class="op" id="5955994">.</span><span class="ident" id="5955995">LittleEndian</span><span class="op" id="5956007">.</span><span class="ident" id="5956008">Uint32</span><span class="op" id="5956014">(</span><span class="op" id="5956015">*</span><span class="ident" id="5956016">b</span><span class="op" id="5956017">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5956020">*</span><span class="ident" id="5956021">b</span>&nbsp;<span class="op" id="5956023">=</span>&nbsp;<span class="op" id="5956025">(</span><span class="op" id="5956026">*</span><span class="ident" id="5956027">b</span><span class="op" id="5956028">)</span><span class="op" id="5956029">[</span><span class="num" id="5956030">4</span><span class="op" id="5956031">:</span><span class="op" id="5956032">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5956035">return</span>&nbsp;<span class="ident" id="5956042">v</span><br>
<span class="lineno"></span><span class="op" id="5956044">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5956047">func</span>&nbsp;<span class="op" id="5956052">(</span><span class="ident" id="5956053">b</span>&nbsp;<span class="op" id="5956055">*</span><span class="ident" id="5956056">readBuf</span><span class="op" id="5956063">)</span>&nbsp;<span class="ident" id="5956065">uint64</span><span class="op" id="5956071">(</span><span class="op" id="5956072">)</span>&nbsp;<span class="ident" id="5956074">uint64</span>&nbsp;<span class="op" id="5956081">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5956084">v</span>&nbsp;<span class="op" id="5956086">:=</span>&nbsp;<span class="ident" id="5956089">binary</span><span class="op" id="5956095">.</span><span class="ident" id="5956096">LittleEndian</span><span class="op" id="5956108">.</span><span class="ident" id="5956109">Uint64</span><span class="op" id="5956115">(</span><span class="op" id="5956116">*</span><span class="ident" id="5956117">b</span><span class="op" id="5956118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5956121">*</span><span class="ident" id="5956122">b</span>&nbsp;<span class="op" id="5956124">=</span>&nbsp;<span class="op" id="5956126">(</span><span class="op" id="5956127">*</span><span class="ident" id="5956128">b</span><span class="op" id="5956129">)</span><span class="op" id="5956130">[</span><span class="num" id="5956131">8</span><span class="op" id="5956132">:</span><span class="op" id="5956133">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5956136">return</span>&nbsp;<span class="ident" id="5956143">v</span><br>
<span class="lineno"></span><span class="op" id="5956145">}</span>
</div>
</body>
</html>
