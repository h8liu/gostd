<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4492754">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4492809">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4492863">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4492914">package</span>&nbsp;<span class="ident" id="4492922">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4492932">import</span>&nbsp;<span class="op" id="4492939">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4492942">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4492951">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4492958">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="4492968">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4492971">//&nbsp;urlFilter&nbsp;returns&nbsp;its&nbsp;input&nbsp;unless&nbsp;it&nbsp;contains&nbsp;an&nbsp;unsafe&nbsp;protocol&nbsp;in&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="4493049">//&nbsp;case&nbsp;it&nbsp;defangs&nbsp;the&nbsp;entire&nbsp;URL.</span><br>
<span class="lineno">15</span><span class="keyword" id="4493084">func</span>&nbsp;<span class="ident" id="4493089">urlFilter</span><span class="op" id="4493098">(</span><span class="ident" id="4493099">args</span>&nbsp;<span class="op" id="4493104">...</span><span class="keyword" id="4493107">interface</span><span class="op" id="4493116">{</span><span class="op" id="4493117">}</span><span class="op" id="4493118">)</span>&nbsp;<span class="builtintype" id="4493120">string</span>&nbsp;<span class="op" id="4493127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4493130">s</span><span class="op" id="4493131">,</span>&nbsp;<span class="ident" id="4493133">t</span>&nbsp;<span class="op" id="4493135">:=</span>&nbsp;<span class="ident" id="4493138"><a href="/html/template/content.go.html#4391261">stringify</a></span><span class="op" id="4493147">(</span><span class="ident" id="4493148"><a href="/html/template/url.go.html#4493099">args</a></span><span class="op" id="4493152">...</span><span class="op" id="4493155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4493158">if</span>&nbsp;<span class="ident" id="4493161"><a href="/html/template/url.go.html#4493133">t</a></span>&nbsp;<span class="op" id="4493163">==</span>&nbsp;<span class="ident" id="4493166"><a href="/html/template/content.go.html#4389864">contentTypeURL</a></span>&nbsp;<span class="op" id="4493181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4493185">return</span>&nbsp;<span class="ident" id="4493192"><a href="/html/template/url.go.html#4493130">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4493195">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4493198">if</span>&nbsp;<span class="ident" id="4493201">i</span>&nbsp;<span class="op" id="4493203">:=</span>&nbsp;<span class="ident" id="4493206"><a href="/html/template/url.go.html#4492958">strings</a></span><span class="op" id="4493213">.</span><span class="ident" id="4493214">IndexRune</span><span class="op" id="4493223">(</span><span class="ident" id="4493224"><a href="/html/template/url.go.html#4493130">s</a></span><span class="op" id="4493225">,</span>&nbsp;<span class="string" id="4493227">&#39;:&#39;</span><span class="op" id="4493230">)</span><span class="op" id="4493231">;</span>&nbsp;<span class="ident" id="4493233"><a href="/html/template/url.go.html#4493201">i</a></span>&nbsp;<span class="op" id="4493235">&gt;=</span>&nbsp;<span class="num" id="4493238">0</span>&nbsp;<span class="op" id="4493240">&amp;&amp;</span>&nbsp;<span class="ident" id="4493243"><a href="/html/template/url.go.html#4492958">strings</a></span><span class="op" id="4493250">.</span><span class="ident" id="4493251">IndexRune</span><span class="op" id="4493260">(</span><span class="ident" id="4493261"><a href="/html/template/url.go.html#4493130">s</a></span><span class="op" id="4493262">[</span><span class="op" id="4493263">:</span><span class="ident" id="4493264"><a href="/html/template/url.go.html#4493201">i</a></span><span class="op" id="4493265">]</span><span class="op" id="4493266">,</span>&nbsp;<span class="string" id="4493268">&#39;/&#39;</span><span class="op" id="4493271">)</span>&nbsp;<span class="op" id="4493273">&lt;</span>&nbsp;<span class="num" id="4493275">0</span>&nbsp;<span class="op" id="4493277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4493281">protocol</span>&nbsp;<span class="op" id="4493290">:=</span>&nbsp;<span class="ident" id="4493293"><a href="/html/template/url.go.html#4492958">strings</a></span><span class="op" id="4493300">.</span><span class="ident" id="4493301">ToLower</span><span class="op" id="4493308">(</span><span class="ident" id="4493309"><a href="/html/template/url.go.html#4493130">s</a></span><span class="op" id="4493310">[</span><span class="op" id="4493311">:</span><span class="ident" id="4493312"><a href="/html/template/url.go.html#4493201">i</a></span><span class="op" id="4493313">]</span><span class="op" id="4493314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4493318">if</span>&nbsp;<span class="ident" id="4493321"><a href="/html/template/url.go.html#4493281">protocol</a></span>&nbsp;<span class="op" id="4493330">!=</span>&nbsp;<span class="string" id="4493333">&#34;http&#34;</span>&nbsp;<span class="op" id="4493340">&amp;&amp;</span>&nbsp;<span class="ident" id="4493343"><a href="/html/template/url.go.html#4493281">protocol</a></span>&nbsp;<span class="op" id="4493352">!=</span>&nbsp;<span class="string" id="4493355">&#34;https&#34;</span>&nbsp;<span class="op" id="4493363">&amp;&amp;</span>&nbsp;<span class="ident" id="4493366"><a href="/html/template/url.go.html#4493281">protocol</a></span>&nbsp;<span class="op" id="4493375">!=</span>&nbsp;<span class="string" id="4493378">&#34;mailto&#34;</span>&nbsp;<span class="op" id="4493387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4493392">return</span>&nbsp;<span class="string" id="4493399">&#34;#&#34;</span>&nbsp;<span class="op" id="4493403">+</span>&nbsp;<span class="ident" id="4493405"><a href="/html/template/escape.go.html#4427036">filterFailsafe</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4493422">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4493425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4493428">return</span>&nbsp;<span class="ident" id="4493435"><a href="/html/template/url.go.html#4493130">s</a></span><br>
<span class="lineno"></span><span class="op" id="4493437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4493440">//&nbsp;urlEscaper&nbsp;produces&nbsp;an&nbsp;output&nbsp;that&nbsp;can&nbsp;be&nbsp;embedded&nbsp;in&nbsp;a&nbsp;URL&nbsp;query.</span><br>
<span class="lineno">30</span><span class="comment" id="4493510">//&nbsp;The&nbsp;output&nbsp;can&nbsp;be&nbsp;embedded&nbsp;in&nbsp;an&nbsp;HTML&nbsp;attribute&nbsp;without&nbsp;further&nbsp;escaping.</span><br>
<span class="lineno"></span><span class="keyword" id="4493587">func</span>&nbsp;<span class="ident" id="4493592">urlEscaper</span><span class="op" id="4493602">(</span><span class="ident" id="4493603">args</span>&nbsp;<span class="op" id="4493608">...</span><span class="keyword" id="4493611">interface</span><span class="op" id="4493620">{</span><span class="op" id="4493621">}</span><span class="op" id="4493622">)</span>&nbsp;<span class="builtintype" id="4493624">string</span>&nbsp;<span class="op" id="4493631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4493634">return</span>&nbsp;<span class="ident" id="4493641"><a href="/html/template/url.go.html#4494189">urlProcessor</a></span><span class="op" id="4493653">(</span><span class="builtintype" id="4493654">false</span><span class="op" id="4493659">,</span>&nbsp;<span class="ident" id="4493661"><a href="/html/template/url.go.html#4493603">args</a></span><span class="op" id="4493665">...</span><span class="op" id="4493668">)</span><br>
<span class="lineno"></span><span class="op" id="4493670">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="4493673">//&nbsp;urlEscaper&nbsp;normalizes&nbsp;URL&nbsp;content&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;embedded&nbsp;in&nbsp;a&nbsp;quote-delimited</span><br>
<span class="lineno"></span><span class="comment" id="4493753">//&nbsp;string&nbsp;or&nbsp;parenthesis&nbsp;delimited&nbsp;url(...).</span><br>
<span class="lineno"></span><span class="comment" id="4493798">//&nbsp;The&nbsp;normalizer&nbsp;does&nbsp;not&nbsp;encode&nbsp;all&nbsp;HTML&nbsp;specials.&nbsp;Specifically,&nbsp;it&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="4493877">//&nbsp;encode&nbsp;&#39;&amp;&#39;&nbsp;so&nbsp;correct&nbsp;embedding&nbsp;in&nbsp;an&nbsp;HTML&nbsp;attribute&nbsp;requires&nbsp;escaping&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4493954">//&nbsp;&#39;&amp;&#39;&nbsp;to&nbsp;&#39;&amp;amp;&#39;.</span><br>
<span class="lineno">40</span><span class="keyword" id="4493973">func</span>&nbsp;<span class="ident" id="4493978">urlNormalizer</span><span class="op" id="4493991">(</span><span class="ident" id="4493992">args</span>&nbsp;<span class="op" id="4493997">...</span><span class="keyword" id="4494000">interface</span><span class="op" id="4494009">{</span><span class="op" id="4494010">}</span><span class="op" id="4494011">)</span>&nbsp;<span class="builtintype" id="4494013">string</span>&nbsp;<span class="op" id="4494020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4494023">return</span>&nbsp;<span class="ident" id="4494030"><a href="/html/template/url.go.html#4494189">urlProcessor</a></span><span class="op" id="4494042">(</span><span class="builtintype" id="4494043">true</span><span class="op" id="4494047">,</span>&nbsp;<span class="ident" id="4494049"><a href="/html/template/url.go.html#4493992">args</a></span><span class="op" id="4494053">...</span><span class="op" id="4494056">)</span><br>
<span class="lineno"></span><span class="op" id="4494058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4494061">//&nbsp;urlProcessor&nbsp;normalizes&nbsp;(when&nbsp;norm&nbsp;is&nbsp;true)&nbsp;or&nbsp;escapes&nbsp;its&nbsp;input&nbsp;to&nbsp;produce</span><br>
<span class="lineno">45</span><span class="comment" id="4494140">//&nbsp;a&nbsp;valid&nbsp;hierarchical&nbsp;or&nbsp;opaque&nbsp;URL&nbsp;part.</span><br>
<span class="lineno"></span><span class="keyword" id="4494184">func</span>&nbsp;<span class="ident" id="4494189">urlProcessor</span><span class="op" id="4494201">(</span><span class="ident" id="4494202">norm</span>&nbsp;<span class="builtintype" id="4494207">bool</span><span class="op" id="4494211">,</span>&nbsp;<span class="ident" id="4494213">args</span>&nbsp;<span class="op" id="4494218">...</span><span class="keyword" id="4494221">interface</span><span class="op" id="4494230">{</span><span class="op" id="4494231">}</span><span class="op" id="4494232">)</span>&nbsp;<span class="builtintype" id="4494234">string</span>&nbsp;<span class="op" id="4494241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4494244">s</span><span class="op" id="4494245">,</span>&nbsp;<span class="ident" id="4494247">t</span>&nbsp;<span class="op" id="4494249">:=</span>&nbsp;<span class="ident" id="4494252"><a href="/html/template/content.go.html#4391261">stringify</a></span><span class="op" id="4494261">(</span><span class="ident" id="4494262"><a href="/html/template/url.go.html#4494213">args</a></span><span class="op" id="4494266">...</span><span class="op" id="4494269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4494272">if</span>&nbsp;<span class="ident" id="4494275"><a href="/html/template/url.go.html#4494247">t</a></span>&nbsp;<span class="op" id="4494277">==</span>&nbsp;<span class="ident" id="4494280"><a href="/html/template/content.go.html#4389864">contentTypeURL</a></span>&nbsp;<span class="op" id="4494295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4494299"><a href="/html/template/url.go.html#4494202">norm</a></span>&nbsp;<span class="op" id="4494304">=</span>&nbsp;<span class="builtintype" id="4494306">true</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4494312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4494315">var</span>&nbsp;<span class="ident" id="4494319">b</span>&nbsp;<span class="ident" id="4494321"><a href="/html/template/url.go.html#4492942">bytes</a></span><span class="op" id="4494326">.</span><span class="ident" id="4494327">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4494335">written</span>&nbsp;<span class="op" id="4494343">:=</span>&nbsp;<span class="num" id="4494346">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4494349">//&nbsp;The&nbsp;byte&nbsp;loop&nbsp;below&nbsp;assumes&nbsp;that&nbsp;all&nbsp;URLs&nbsp;use&nbsp;UTF-8&nbsp;as&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4494412">//&nbsp;content-encoding.&nbsp;This&nbsp;is&nbsp;similar&nbsp;to&nbsp;the&nbsp;URI&nbsp;to&nbsp;IRI&nbsp;encoding&nbsp;scheme</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4494484">//&nbsp;defined&nbsp;in&nbsp;section&nbsp;3.1&nbsp;of&nbsp;&nbsp;RFC&nbsp;3987,&nbsp;and&nbsp;behaves&nbsp;the&nbsp;same&nbsp;as&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4494553">//&nbsp;EcmaScript&nbsp;builtin&nbsp;encodeURIComponent.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4494596">//&nbsp;It&nbsp;should&nbsp;not&nbsp;cause&nbsp;any&nbsp;misencoding&nbsp;of&nbsp;URLs&nbsp;in&nbsp;pages&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4494658">//&nbsp;Content-type:&nbsp;text/html;charset=UTF-8.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4494701">for</span>&nbsp;<span class="ident" id="4494705">i</span><span class="op" id="4494706">,</span>&nbsp;<span class="ident" id="4494708">n</span>&nbsp;<span class="op" id="4494710">:=</span>&nbsp;<span class="num" id="4494713">0</span><span class="op" id="4494714">,</span>&nbsp;<span class="builtinfunc" id="4494716">len</span><span class="op" id="4494719">(</span><span class="ident" id="4494720"><a href="/html/template/url.go.html#4494244">s</a></span><span class="op" id="4494721">)</span><span class="op" id="4494722">;</span>&nbsp;<span class="ident" id="4494724"><a href="/html/template/url.go.html#4494705">i</a></span>&nbsp;<span class="op" id="4494726">&lt;</span>&nbsp;<span class="ident" id="4494728"><a href="/html/template/url.go.html#4494708">n</a></span><span class="op" id="4494729">;</span>&nbsp;<span class="ident" id="4494731"><a href="/html/template/url.go.html#4494705">i</a></span><span class="op" id="4494732">++</span>&nbsp;<span class="op" id="4494735">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4494739">c</span>&nbsp;<span class="op" id="4494741">:=</span>&nbsp;<span class="ident" id="4494744"><a href="/html/template/url.go.html#4494244">s</a></span><span class="op" id="4494745">[</span><span class="ident" id="4494746"><a href="/html/template/url.go.html#4494705">i</a></span><span class="op" id="4494747">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4494751">switch</span>&nbsp;<span class="ident" id="4494758"><a href="/html/template/url.go.html#4494739">c</a></span>&nbsp;<span class="op" id="4494760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4494764">//&nbsp;Single&nbsp;quote&nbsp;and&nbsp;parens&nbsp;are&nbsp;sub-delims&nbsp;in&nbsp;RFC&nbsp;3986,&nbsp;but&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4494828">//&nbsp;escape&nbsp;them&nbsp;so&nbsp;the&nbsp;output&nbsp;can&nbsp;be&nbsp;embedded&nbsp;in&nbsp;single</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4494885">//&nbsp;quoted&nbsp;attributes&nbsp;and&nbsp;unquoted&nbsp;CSS&nbsp;url(...)&nbsp;constructs.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4494946">//&nbsp;Single&nbsp;quotes&nbsp;are&nbsp;reserved&nbsp;in&nbsp;URLs,&nbsp;but&nbsp;are&nbsp;only&nbsp;used&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4495008">//&nbsp;the&nbsp;obsolete&nbsp;&#34;mark&#34;&nbsp;rule&nbsp;in&nbsp;an&nbsp;appendix&nbsp;in&nbsp;RFC&nbsp;3986</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4495065">//&nbsp;so&nbsp;can&nbsp;be&nbsp;safely&nbsp;encoded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4495096">case</span>&nbsp;<span class="string" id="4495101">&#39;!&#39;</span><span class="op" id="4495104">,</span>&nbsp;<span class="string" id="4495106">&#39;#&#39;</span><span class="op" id="4495109">,</span>&nbsp;<span class="string" id="4495111">&#39;$&#39;</span><span class="op" id="4495114">,</span>&nbsp;<span class="string" id="4495116">&#39;&amp;&#39;</span><span class="op" id="4495119">,</span>&nbsp;<span class="string" id="4495121">&#39;*&#39;</span><span class="op" id="4495124">,</span>&nbsp;<span class="string" id="4495126">&#39;+&#39;</span><span class="op" id="4495129">,</span>&nbsp;<span class="string" id="4495131">&#39;,&#39;</span><span class="op" id="4495134">,</span>&nbsp;<span class="string" id="4495136">&#39;/&#39;</span><span class="op" id="4495139">,</span>&nbsp;<span class="string" id="4495141">&#39;:&#39;</span><span class="op" id="4495144">,</span>&nbsp;<span class="string" id="4495146">&#39;;&#39;</span><span class="op" id="4495149">,</span>&nbsp;<span class="string" id="4495151">&#39;=&#39;</span><span class="op" id="4495154">,</span>&nbsp;<span class="string" id="4495156">&#39;?&#39;</span><span class="op" id="4495159">,</span>&nbsp;<span class="string" id="4495161">&#39;@&#39;</span><span class="op" id="4495164">,</span>&nbsp;<span class="string" id="4495166">&#39;[&#39;</span><span class="op" id="4495169">,</span>&nbsp;<span class="string" id="4495171">&#39;]&#39;</span><span class="op" id="4495174">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4495179">if</span>&nbsp;<span class="ident" id="4495182"><a href="/html/template/url.go.html#4494202">norm</a></span>&nbsp;<span class="op" id="4495187">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4495193">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4495205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4495209">//&nbsp;Unreserved&nbsp;according&nbsp;to&nbsp;RFC&nbsp;3986&nbsp;sec&nbsp;2.3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4495255">//&nbsp;&#34;For&nbsp;consistency,&nbsp;percent-encoded&nbsp;octets&nbsp;in&nbsp;the&nbsp;ranges&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4495318">//&nbsp;ALPHA&nbsp;(%41-%5A&nbsp;and&nbsp;%61-%7A),&nbsp;DIGIT&nbsp;(%30-%39),&nbsp;hyphen&nbsp;(%2D),</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4495383">//&nbsp;period&nbsp;(%2E),&nbsp;underscore&nbsp;(%5F),&nbsp;or&nbsp;tilde&nbsp;(%7E)&nbsp;should&nbsp;not&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4495449">//&nbsp;created&nbsp;by&nbsp;URI&nbsp;producers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4495479">case</span>&nbsp;<span class="string" id="4495484">&#39;-&#39;</span><span class="op" id="4495487">,</span>&nbsp;<span class="string" id="4495489">&#39;.&#39;</span><span class="op" id="4495492">,</span>&nbsp;<span class="string" id="4495494">&#39;_&#39;</span><span class="op" id="4495497">,</span>&nbsp;<span class="string" id="4495499">&#39;~&#39;</span><span class="op" id="4495502">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4495507">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4495518">case</span>&nbsp;<span class="string" id="4495523">&#39;%&#39;</span><span class="op" id="4495526">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4495531">//&nbsp;When&nbsp;normalizing&nbsp;do&nbsp;not&nbsp;re-encode&nbsp;valid&nbsp;escapes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4495586">if</span>&nbsp;<span class="ident" id="4495589"><a href="/html/template/url.go.html#4494202">norm</a></span>&nbsp;<span class="op" id="4495594">&amp;&amp;</span>&nbsp;<span class="ident" id="4495597"><a href="/html/template/url.go.html#4494705">i</a></span><span class="op" id="4495598">+</span><span class="num" id="4495599">2</span>&nbsp;<span class="op" id="4495601">&lt;</span>&nbsp;<span class="builtinfunc" id="4495603">len</span><span class="op" id="4495606">(</span><span class="ident" id="4495607"><a href="/html/template/url.go.html#4494244">s</a></span><span class="op" id="4495608">)</span>&nbsp;<span class="op" id="4495610">&amp;&amp;</span>&nbsp;<span class="ident" id="4495613"><a href="/html/template/css.go.html#4405074">isHex</a></span><span class="op" id="4495618">(</span><span class="ident" id="4495619"><a href="/html/template/url.go.html#4494244">s</a></span><span class="op" id="4495620">[</span><span class="ident" id="4495621"><a href="/html/template/url.go.html#4494705">i</a></span><span class="op" id="4495622">+</span><span class="num" id="4495623">1</span><span class="op" id="4495624">]</span><span class="op" id="4495625">)</span>&nbsp;<span class="op" id="4495627">&amp;&amp;</span>&nbsp;<span class="ident" id="4495630"><a href="/html/template/css.go.html#4405074">isHex</a></span><span class="op" id="4495635">(</span><span class="ident" id="4495636"><a href="/html/template/url.go.html#4494244">s</a></span><span class="op" id="4495637">[</span><span class="ident" id="4495638"><a href="/html/template/url.go.html#4494705">i</a></span><span class="op" id="4495639">+</span><span class="num" id="4495640">2</span><span class="op" id="4495641">]</span><span class="op" id="4495642">)</span>&nbsp;<span class="op" id="4495644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4495650">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4495662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4495666">default</span><span class="op" id="4495673">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4495678">//&nbsp;Unreserved&nbsp;according&nbsp;to&nbsp;RFC&nbsp;3986&nbsp;sec&nbsp;2.3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4495725">if</span>&nbsp;<span class="string" id="4495728">&#39;a&#39;</span>&nbsp;<span class="op" id="4495732">&lt;=</span>&nbsp;<span class="ident" id="4495735"><a href="/html/template/url.go.html#4494739">c</a></span>&nbsp;<span class="op" id="4495737">&amp;&amp;</span>&nbsp;<span class="ident" id="4495740"><a href="/html/template/url.go.html#4494739">c</a></span>&nbsp;<span class="op" id="4495742">&lt;=</span>&nbsp;<span class="string" id="4495745">&#39;z&#39;</span>&nbsp;<span class="op" id="4495749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4495755">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4495767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4495772">if</span>&nbsp;<span class="string" id="4495775">&#39;A&#39;</span>&nbsp;<span class="op" id="4495779">&lt;=</span>&nbsp;<span class="ident" id="4495782"><a href="/html/template/url.go.html#4494739">c</a></span>&nbsp;<span class="op" id="4495784">&amp;&amp;</span>&nbsp;<span class="ident" id="4495787"><a href="/html/template/url.go.html#4494739">c</a></span>&nbsp;<span class="op" id="4495789">&lt;=</span>&nbsp;<span class="string" id="4495792">&#39;Z&#39;</span>&nbsp;<span class="op" id="4495796">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4495802">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4495814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4495819">if</span>&nbsp;<span class="string" id="4495822">&#39;0&#39;</span>&nbsp;<span class="op" id="4495826">&lt;=</span>&nbsp;<span class="ident" id="4495829"><a href="/html/template/url.go.html#4494739">c</a></span>&nbsp;<span class="op" id="4495831">&amp;&amp;</span>&nbsp;<span class="ident" id="4495834"><a href="/html/template/url.go.html#4494739">c</a></span>&nbsp;<span class="op" id="4495836">&lt;=</span>&nbsp;<span class="string" id="4495839">&#39;9&#39;</span>&nbsp;<span class="op" id="4495843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4495849">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4495861">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4495865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4495869"><a href="/html/template/url.go.html#4494319">b</a></span><span class="op" id="4495870">.</span><span class="ident" id="4495871">WriteString</span><span class="op" id="4495882">(</span><span class="ident" id="4495883"><a href="/html/template/url.go.html#4494244">s</a></span><span class="op" id="4495884">[</span><span class="ident" id="4495885"><a href="/html/template/url.go.html#4494335">written</a></span><span class="op" id="4495892">:</span><span class="ident" id="4495893"><a href="/html/template/url.go.html#4494705">i</a></span><span class="op" id="4495894">]</span><span class="op" id="4495895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4495899"><a href="/html/template/url.go.html#4492951">fmt</a></span><span class="op" id="4495902">.</span><span class="ident" id="4495903">Fprintf</span><span class="op" id="4495910">(</span><span class="op" id="4495911">&amp;</span><span class="ident" id="4495912"><a href="/html/template/url.go.html#4494319">b</a></span><span class="op" id="4495913">,</span>&nbsp;<span class="string" id="4495915">&#34;%%%02x&#34;</span><span class="op" id="4495923">,</span>&nbsp;<span class="ident" id="4495925"><a href="/html/template/url.go.html#4494739">c</a></span><span class="op" id="4495926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4495930"><a href="/html/template/url.go.html#4494335">written</a></span>&nbsp;<span class="op" id="4495938">=</span>&nbsp;<span class="ident" id="4495940"><a href="/html/template/url.go.html#4494705">i</a></span>&nbsp;<span class="op" id="4495942">+</span>&nbsp;<span class="num" id="4495944">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4495947">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4495950">if</span>&nbsp;<span class="ident" id="4495953"><a href="/html/template/url.go.html#4494335">written</a></span>&nbsp;<span class="op" id="4495961">==</span>&nbsp;<span class="num" id="4495964">0</span>&nbsp;<span class="op" id="4495966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4495970">return</span>&nbsp;<span class="ident" id="4495977"><a href="/html/template/url.go.html#4494244">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4495980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4495983"><a href="/html/template/url.go.html#4494319">b</a></span><span class="op" id="4495984">.</span><span class="ident" id="4495985">WriteString</span><span class="op" id="4495996">(</span><span class="ident" id="4495997"><a href="/html/template/url.go.html#4494244">s</a></span><span class="op" id="4495998">[</span><span class="ident" id="4495999"><a href="/html/template/url.go.html#4494335">written</a></span><span class="op" id="4496006">:</span><span class="op" id="4496007">]</span><span class="op" id="4496008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4496011">return</span>&nbsp;<span class="ident" id="4496018"><a href="/html/template/url.go.html#4494319">b</a></span><span class="op" id="4496019">.</span><span class="ident" id="4496020">String</span><span class="op" id="4496026">(</span><span class="op" id="4496027">)</span><br>
<span class="lineno">105</span><span class="op" id="4496029">}</span>
</div>
</body>
</html>
