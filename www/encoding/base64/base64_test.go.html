<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7152066">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7152121">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7152175">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7152226">package</span>&nbsp;<span class="ident" id="7152234">base64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7152242">import</span>&nbsp;<span class="op" id="7152249">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7152252">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7152261">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7152271">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7152277">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7152290">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7152301">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7152312">&#34;testing&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7152323">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7152330">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7152333">type</span>&nbsp;<span class="ident" id="7152338">testpair</span>&nbsp;<span class="keyword" id="7152347">struct</span>&nbsp;<span class="op" id="7152354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7152357">decoded</span><span class="op" id="7152364">,</span>&nbsp;<span class="ident" id="7152366">encoded</span>&nbsp;<span class="builtintype" id="7152374">string</span><br>
<span class="lineno">20</span><span class="op" id="7152381">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7152384">var</span>&nbsp;<span class="ident" id="7152388">pairs</span>&nbsp;<span class="op" id="7152394">=</span>&nbsp;<span class="op" id="7152396">[</span><span class="op" id="7152397">]</span><span class="ident" id="7152398">testpair</span><span class="op" id="7152406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7152409">//&nbsp;RFC&nbsp;3548&nbsp;examples</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7152431">{</span><span class="string" id="7152432">&#34;\x14\xfb\x9c\x03\xd9\x7e&#34;</span><span class="op" id="7152458">,</span>&nbsp;<span class="string" id="7152460">&#34;FPucA9l+&#34;</span><span class="op" id="7152470">}</span><span class="op" id="7152471">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7152474">{</span><span class="string" id="7152475">&#34;\x14\xfb\x9c\x03\xd9&#34;</span><span class="op" id="7152497">,</span>&nbsp;<span class="string" id="7152499">&#34;FPucA9k=&#34;</span><span class="op" id="7152509">}</span><span class="op" id="7152510">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7152513">{</span><span class="string" id="7152514">&#34;\x14\xfb\x9c\x03&#34;</span><span class="op" id="7152532">,</span>&nbsp;<span class="string" id="7152534">&#34;FPucAw==&#34;</span><span class="op" id="7152544">}</span><span class="op" id="7152545">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7152549">//&nbsp;RFC&nbsp;4648&nbsp;examples</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7152571">{</span><span class="string" id="7152572">&#34;&#34;</span><span class="op" id="7152574">,</span>&nbsp;<span class="string" id="7152576">&#34;&#34;</span><span class="op" id="7152578">}</span><span class="op" id="7152579">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7152582">{</span><span class="string" id="7152583">&#34;f&#34;</span><span class="op" id="7152586">,</span>&nbsp;<span class="string" id="7152588">&#34;Zg==&#34;</span><span class="op" id="7152594">}</span><span class="op" id="7152595">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7152598">{</span><span class="string" id="7152599">&#34;fo&#34;</span><span class="op" id="7152603">,</span>&nbsp;<span class="string" id="7152605">&#34;Zm8=&#34;</span><span class="op" id="7152611">}</span><span class="op" id="7152612">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7152615">{</span><span class="string" id="7152616">&#34;foo&#34;</span><span class="op" id="7152621">,</span>&nbsp;<span class="string" id="7152623">&#34;Zm9v&#34;</span><span class="op" id="7152629">}</span><span class="op" id="7152630">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7152633">{</span><span class="string" id="7152634">&#34;foob&#34;</span><span class="op" id="7152640">,</span>&nbsp;<span class="string" id="7152642">&#34;Zm9vYg==&#34;</span><span class="op" id="7152652">}</span><span class="op" id="7152653">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7152656">{</span><span class="string" id="7152657">&#34;fooba&#34;</span><span class="op" id="7152664">,</span>&nbsp;<span class="string" id="7152666">&#34;Zm9vYmE=&#34;</span><span class="op" id="7152676">}</span><span class="op" id="7152677">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7152680">{</span><span class="string" id="7152681">&#34;foobar&#34;</span><span class="op" id="7152689">,</span>&nbsp;<span class="string" id="7152691">&#34;Zm9vYmFy&#34;</span><span class="op" id="7152701">}</span><span class="op" id="7152702">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7152706">//&nbsp;Wikipedia&nbsp;examples</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7152729">{</span><span class="string" id="7152730">&#34;sure.&#34;</span><span class="op" id="7152737">,</span>&nbsp;<span class="string" id="7152739">&#34;c3VyZS4=&#34;</span><span class="op" id="7152749">}</span><span class="op" id="7152750">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7152753">{</span><span class="string" id="7152754">&#34;sure&#34;</span><span class="op" id="7152760">,</span>&nbsp;<span class="string" id="7152762">&#34;c3VyZQ==&#34;</span><span class="op" id="7152772">}</span><span class="op" id="7152773">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7152776">{</span><span class="string" id="7152777">&#34;sur&#34;</span><span class="op" id="7152782">,</span>&nbsp;<span class="string" id="7152784">&#34;c3Vy&#34;</span><span class="op" id="7152790">}</span><span class="op" id="7152791">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7152794">{</span><span class="string" id="7152795">&#34;su&#34;</span><span class="op" id="7152799">,</span>&nbsp;<span class="string" id="7152801">&#34;c3U=&#34;</span><span class="op" id="7152807">}</span><span class="op" id="7152808">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7152811">{</span><span class="string" id="7152812">&#34;leasure.&#34;</span><span class="op" id="7152822">,</span>&nbsp;<span class="string" id="7152824">&#34;bGVhc3VyZS4=&#34;</span><span class="op" id="7152838">}</span><span class="op" id="7152839">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7152842">{</span><span class="string" id="7152843">&#34;easure.&#34;</span><span class="op" id="7152852">,</span>&nbsp;<span class="string" id="7152854">&#34;ZWFzdXJlLg==&#34;</span><span class="op" id="7152868">}</span><span class="op" id="7152869">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7152872">{</span><span class="string" id="7152873">&#34;asure.&#34;</span><span class="op" id="7152881">,</span>&nbsp;<span class="string" id="7152883">&#34;YXN1cmUu&#34;</span><span class="op" id="7152893">}</span><span class="op" id="7152894">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7152897">{</span><span class="string" id="7152898">&#34;sure.&#34;</span><span class="op" id="7152905">,</span>&nbsp;<span class="string" id="7152907">&#34;c3VyZS4=&#34;</span><span class="op" id="7152917">}</span><span class="op" id="7152918">,</span><br>
<span class="lineno"></span><span class="op" id="7152920">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7152923">var</span>&nbsp;<span class="ident" id="7152927">bigtest</span>&nbsp;<span class="op" id="7152935">=</span>&nbsp;<span class="ident" id="7152937">testpair</span><span class="op" id="7152945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7152948">&#34;Twas&nbsp;brillig,&nbsp;and&nbsp;the&nbsp;slithy&nbsp;toves&#34;</span><span class="op" id="7152984">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7152987">&#34;VHdhcyBicmlsbGlnLCBhbmQgdGhlIHNsaXRoeSB0b3Zlcw==&#34;</span><span class="op" id="7153037">,</span><br>
<span class="lineno"></span><span class="op" id="7153039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7153042">func</span>&nbsp;<span class="ident" id="7153047">testEqual</span><span class="op" id="7153056">(</span><span class="ident" id="7153057">t</span>&nbsp;<span class="op" id="7153059">*</span><span class="ident" id="7153060">testing</span><span class="op" id="7153067">.</span><span class="ident" id="7153068">T</span><span class="op" id="7153069">,</span>&nbsp;<span class="ident" id="7153071">msg</span>&nbsp;<span class="builtintype" id="7153075">string</span><span class="op" id="7153081">,</span>&nbsp;<span class="ident" id="7153083">args</span>&nbsp;<span class="op" id="7153088">...</span><span class="keyword" id="7153091">interface</span><span class="op" id="7153100">{</span><span class="op" id="7153101">}</span><span class="op" id="7153102">)</span>&nbsp;<span class="builtintype" id="7153104">bool</span>&nbsp;<span class="op" id="7153109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7153112">if</span>&nbsp;<span class="ident" id="7153115">args</span><span class="op" id="7153119">[</span><span class="builtinfunc" id="7153120">len</span><span class="op" id="7153123">(</span><span class="ident" id="7153124">args</span><span class="op" id="7153128">)</span><span class="op" id="7153129">-</span><span class="num" id="7153130">2</span><span class="op" id="7153131">]</span>&nbsp;<span class="op" id="7153133">!=</span>&nbsp;<span class="ident" id="7153136">args</span><span class="op" id="7153140">[</span><span class="builtinfunc" id="7153141">len</span><span class="op" id="7153144">(</span><span class="ident" id="7153145">args</span><span class="op" id="7153149">)</span><span class="op" id="7153150">-</span><span class="num" id="7153151">1</span><span class="op" id="7153152">]</span>&nbsp;<span class="op" id="7153154">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7153158">t</span><span class="op" id="7153159">.</span><span class="ident" id="7153160">Errorf</span><span class="op" id="7153166">(</span><span class="ident" id="7153167">msg</span><span class="op" id="7153170">,</span>&nbsp;<span class="ident" id="7153172">args</span><span class="op" id="7153176">...</span><span class="op" id="7153179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7153183">return</span>&nbsp;<span class="ident" id="7153190">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7153197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7153200">return</span>&nbsp;<span class="ident" id="7153207">true</span><br>
<span class="lineno"></span><span class="op" id="7153212">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="7153215">func</span>&nbsp;<span class="ident" id="7153220">TestEncode</span><span class="op" id="7153230">(</span><span class="ident" id="7153231">t</span>&nbsp;<span class="op" id="7153233">*</span><span class="ident" id="7153234">testing</span><span class="op" id="7153241">.</span><span class="ident" id="7153242">T</span><span class="op" id="7153243">)</span>&nbsp;<span class="op" id="7153245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7153248">for</span>&nbsp;<span class="ident" id="7153252">_</span><span class="op" id="7153253">,</span>&nbsp;<span class="ident" id="7153255">p</span>&nbsp;<span class="op" id="7153257">:=</span>&nbsp;<span class="keyword" id="7153260">range</span>&nbsp;<span class="ident" id="7153266">pairs</span>&nbsp;<span class="op" id="7153272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7153276">got</span>&nbsp;<span class="op" id="7153280">:=</span>&nbsp;<span class="ident" id="7153283">StdEncoding</span><span class="op" id="7153294">.</span><span class="ident" id="7153295">EncodeToString</span><span class="op" id="7153309">(</span><span class="op" id="7153310">[</span><span class="op" id="7153311">]</span><span class="builtintype" id="7153312">byte</span><span class="op" id="7153316">(</span><span class="ident" id="7153317">p</span><span class="op" id="7153318">.</span><span class="ident" id="7153319">decoded</span><span class="op" id="7153326">)</span><span class="op" id="7153327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7153331">testEqual</span><span class="op" id="7153340">(</span><span class="ident" id="7153341">t</span><span class="op" id="7153342">,</span>&nbsp;<span class="string" id="7153344">&#34;Encode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7153370">,</span>&nbsp;<span class="ident" id="7153372">p</span><span class="op" id="7153373">.</span><span class="ident" id="7153374">decoded</span><span class="op" id="7153381">,</span>&nbsp;<span class="ident" id="7153383">got</span><span class="op" id="7153386">,</span>&nbsp;<span class="ident" id="7153388">p</span><span class="op" id="7153389">.</span><span class="ident" id="7153390">encoded</span><span class="op" id="7153397">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7153400">}</span><br>
<span class="lineno"></span><span class="op" id="7153402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7153405">func</span>&nbsp;<span class="ident" id="7153410">TestEncoder</span><span class="op" id="7153421">(</span><span class="ident" id="7153422">t</span>&nbsp;<span class="op" id="7153424">*</span><span class="ident" id="7153425">testing</span><span class="op" id="7153432">.</span><span class="ident" id="7153433">T</span><span class="op" id="7153434">)</span>&nbsp;<span class="op" id="7153436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7153439">for</span>&nbsp;<span class="ident" id="7153443">_</span><span class="op" id="7153444">,</span>&nbsp;<span class="ident" id="7153446">p</span>&nbsp;<span class="op" id="7153448">:=</span>&nbsp;<span class="keyword" id="7153451">range</span>&nbsp;<span class="ident" id="7153457">pairs</span>&nbsp;<span class="op" id="7153463">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7153467">bb</span>&nbsp;<span class="op" id="7153470">:=</span>&nbsp;<span class="op" id="7153473">&amp;</span><span class="ident" id="7153474">bytes</span><span class="op" id="7153479">.</span><span class="ident" id="7153480">Buffer</span><span class="op" id="7153486">{</span><span class="op" id="7153487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7153491">encoder</span>&nbsp;<span class="op" id="7153499">:=</span>&nbsp;<span class="ident" id="7153502">NewEncoder</span><span class="op" id="7153512">(</span><span class="ident" id="7153513">StdEncoding</span><span class="op" id="7153524">,</span>&nbsp;<span class="ident" id="7153526">bb</span><span class="op" id="7153528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7153532">encoder</span><span class="op" id="7153539">.</span><span class="ident" id="7153540">Write</span><span class="op" id="7153545">(</span><span class="op" id="7153546">[</span><span class="op" id="7153547">]</span><span class="builtintype" id="7153548">byte</span><span class="op" id="7153552">(</span><span class="ident" id="7153553">p</span><span class="op" id="7153554">.</span><span class="ident" id="7153555">decoded</span><span class="op" id="7153562">)</span><span class="op" id="7153563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7153567">encoder</span><span class="op" id="7153574">.</span><span class="ident" id="7153575">Close</span><span class="op" id="7153580">(</span><span class="op" id="7153581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7153585">testEqual</span><span class="op" id="7153594">(</span><span class="ident" id="7153595">t</span><span class="op" id="7153596">,</span>&nbsp;<span class="string" id="7153598">&#34;Encode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7153624">,</span>&nbsp;<span class="ident" id="7153626">p</span><span class="op" id="7153627">.</span><span class="ident" id="7153628">decoded</span><span class="op" id="7153635">,</span>&nbsp;<span class="ident" id="7153637">bb</span><span class="op" id="7153639">.</span><span class="ident" id="7153640">String</span><span class="op" id="7153646">(</span><span class="op" id="7153647">)</span><span class="op" id="7153648">,</span>&nbsp;<span class="ident" id="7153650">p</span><span class="op" id="7153651">.</span><span class="ident" id="7153652">encoded</span><span class="op" id="7153659">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7153662">}</span><br>
<span class="lineno"></span><span class="op" id="7153664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7153667">func</span>&nbsp;<span class="ident" id="7153672">TestEncoderBuffering</span><span class="op" id="7153692">(</span><span class="ident" id="7153693">t</span>&nbsp;<span class="op" id="7153695">*</span><span class="ident" id="7153696">testing</span><span class="op" id="7153703">.</span><span class="ident" id="7153704">T</span><span class="op" id="7153705">)</span>&nbsp;<span class="op" id="7153707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7153710">input</span>&nbsp;<span class="op" id="7153716">:=</span>&nbsp;<span class="op" id="7153719">[</span><span class="op" id="7153720">]</span><span class="builtintype" id="7153721">byte</span><span class="op" id="7153725">(</span><span class="ident" id="7153726">bigtest</span><span class="op" id="7153733">.</span><span class="ident" id="7153734">decoded</span><span class="op" id="7153741">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7153744">for</span>&nbsp;<span class="ident" id="7153748">bs</span>&nbsp;<span class="op" id="7153751">:=</span>&nbsp;<span class="num" id="7153754">1</span><span class="op" id="7153755">;</span>&nbsp;<span class="ident" id="7153757">bs</span>&nbsp;<span class="op" id="7153760">&lt;=</span>&nbsp;<span class="num" id="7153763">12</span><span class="op" id="7153765">;</span>&nbsp;<span class="ident" id="7153767">bs</span><span class="op" id="7153769">++</span>&nbsp;<span class="op" id="7153772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7153776">bb</span>&nbsp;<span class="op" id="7153779">:=</span>&nbsp;<span class="op" id="7153782">&amp;</span><span class="ident" id="7153783">bytes</span><span class="op" id="7153788">.</span><span class="ident" id="7153789">Buffer</span><span class="op" id="7153795">{</span><span class="op" id="7153796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7153800">encoder</span>&nbsp;<span class="op" id="7153808">:=</span>&nbsp;<span class="ident" id="7153811">NewEncoder</span><span class="op" id="7153821">(</span><span class="ident" id="7153822">StdEncoding</span><span class="op" id="7153833">,</span>&nbsp;<span class="ident" id="7153835">bb</span><span class="op" id="7153837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7153841">for</span>&nbsp;<span class="ident" id="7153845">pos</span>&nbsp;<span class="op" id="7153849">:=</span>&nbsp;<span class="num" id="7153852">0</span><span class="op" id="7153853">;</span>&nbsp;<span class="ident" id="7153855">pos</span>&nbsp;<span class="op" id="7153859">&lt;</span>&nbsp;<span class="builtinfunc" id="7153861">len</span><span class="op" id="7153864">(</span><span class="ident" id="7153865">input</span><span class="op" id="7153870">)</span><span class="op" id="7153871">;</span>&nbsp;<span class="ident" id="7153873">pos</span>&nbsp;<span class="op" id="7153877">+=</span>&nbsp;<span class="ident" id="7153880">bs</span>&nbsp;<span class="op" id="7153883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7153888">end</span>&nbsp;<span class="op" id="7153892">:=</span>&nbsp;<span class="ident" id="7153895">pos</span>&nbsp;<span class="op" id="7153899">+</span>&nbsp;<span class="ident" id="7153901">bs</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7153907">if</span>&nbsp;<span class="ident" id="7153910">end</span>&nbsp;<span class="op" id="7153914">&gt;</span>&nbsp;<span class="builtinfunc" id="7153916">len</span><span class="op" id="7153919">(</span><span class="ident" id="7153920">input</span><span class="op" id="7153925">)</span>&nbsp;<span class="op" id="7153927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7153933">end</span>&nbsp;<span class="op" id="7153937">=</span>&nbsp;<span class="builtinfunc" id="7153939">len</span><span class="op" id="7153942">(</span><span class="ident" id="7153943">input</span><span class="op" id="7153948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7153953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7153958">n</span><span class="op" id="7153959">,</span>&nbsp;<span class="ident" id="7153961">err</span>&nbsp;<span class="op" id="7153965">:=</span>&nbsp;<span class="ident" id="7153968">encoder</span><span class="op" id="7153975">.</span><span class="ident" id="7153976">Write</span><span class="op" id="7153981">(</span><span class="ident" id="7153982">input</span><span class="op" id="7153987">[</span><span class="ident" id="7153988">pos</span><span class="op" id="7153991">:</span><span class="ident" id="7153992">end</span><span class="op" id="7153995">]</span><span class="op" id="7153996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7154001">testEqual</span><span class="op" id="7154010">(</span><span class="ident" id="7154011">t</span><span class="op" id="7154012">,</span>&nbsp;<span class="string" id="7154014">&#34;Write(%q)&nbsp;gave&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7154048">,</span>&nbsp;<span class="ident" id="7154050">input</span><span class="op" id="7154055">[</span><span class="ident" id="7154056">pos</span><span class="op" id="7154059">:</span><span class="ident" id="7154060">end</span><span class="op" id="7154063">]</span><span class="op" id="7154064">,</span>&nbsp;<span class="ident" id="7154066">err</span><span class="op" id="7154069">,</span>&nbsp;<span class="builtintype" id="7154071">error</span><span class="op" id="7154076">(</span><span class="ident" id="7154077">nil</span><span class="op" id="7154080">)</span><span class="op" id="7154081">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7154086">testEqual</span><span class="op" id="7154095">(</span><span class="ident" id="7154096">t</span><span class="op" id="7154097">,</span>&nbsp;<span class="string" id="7154099">&#34;Write(%q)&nbsp;gave&nbsp;length&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7154134">,</span>&nbsp;<span class="ident" id="7154136">input</span><span class="op" id="7154141">[</span><span class="ident" id="7154142">pos</span><span class="op" id="7154145">:</span><span class="ident" id="7154146">end</span><span class="op" id="7154149">]</span><span class="op" id="7154150">,</span>&nbsp;<span class="ident" id="7154152">n</span><span class="op" id="7154153">,</span>&nbsp;<span class="ident" id="7154155">end</span><span class="op" id="7154158">-</span><span class="ident" id="7154159">pos</span><span class="op" id="7154162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7154166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7154170">err</span>&nbsp;<span class="op" id="7154174">:=</span>&nbsp;<span class="ident" id="7154177">encoder</span><span class="op" id="7154184">.</span><span class="ident" id="7154185">Close</span><span class="op" id="7154190">(</span><span class="op" id="7154191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7154195">testEqual</span><span class="op" id="7154204">(</span><span class="ident" id="7154205">t</span><span class="op" id="7154206">,</span>&nbsp;<span class="string" id="7154208">&#34;Close&nbsp;gave&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7154238">,</span>&nbsp;<span class="ident" id="7154240">err</span><span class="op" id="7154243">,</span>&nbsp;<span class="builtintype" id="7154245">error</span><span class="op" id="7154250">(</span><span class="ident" id="7154251">nil</span><span class="op" id="7154254">)</span><span class="op" id="7154255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7154259">testEqual</span><span class="op" id="7154268">(</span><span class="ident" id="7154269">t</span><span class="op" id="7154270">,</span>&nbsp;<span class="string" id="7154272">&#34;Encoding/%d&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7154305">,</span>&nbsp;<span class="ident" id="7154307">bs</span><span class="op" id="7154309">,</span>&nbsp;<span class="ident" id="7154311">bigtest</span><span class="op" id="7154318">.</span><span class="ident" id="7154319">decoded</span><span class="op" id="7154326">,</span>&nbsp;<span class="ident" id="7154328">bb</span><span class="op" id="7154330">.</span><span class="ident" id="7154331">String</span><span class="op" id="7154337">(</span><span class="op" id="7154338">)</span><span class="op" id="7154339">,</span>&nbsp;<span class="ident" id="7154341">bigtest</span><span class="op" id="7154348">.</span><span class="ident" id="7154349">encoded</span><span class="op" id="7154356">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7154359">}</span><br>
<span class="lineno"></span><span class="op" id="7154361">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7154364">func</span>&nbsp;<span class="ident" id="7154369">TestDecode</span><span class="op" id="7154379">(</span><span class="ident" id="7154380">t</span>&nbsp;<span class="op" id="7154382">*</span><span class="ident" id="7154383">testing</span><span class="op" id="7154390">.</span><span class="ident" id="7154391">T</span><span class="op" id="7154392">)</span>&nbsp;<span class="op" id="7154394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7154397">for</span>&nbsp;<span class="ident" id="7154401">_</span><span class="op" id="7154402">,</span>&nbsp;<span class="ident" id="7154404">p</span>&nbsp;<span class="op" id="7154406">:=</span>&nbsp;<span class="keyword" id="7154409">range</span>&nbsp;<span class="ident" id="7154415">pairs</span>&nbsp;<span class="op" id="7154421">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7154425">dbuf</span>&nbsp;<span class="op" id="7154430">:=</span>&nbsp;<span class="builtinfunc" id="7154433">make</span><span class="op" id="7154437">(</span><span class="op" id="7154438">[</span><span class="op" id="7154439">]</span><span class="builtintype" id="7154440">byte</span><span class="op" id="7154444">,</span>&nbsp;<span class="ident" id="7154446">StdEncoding</span><span class="op" id="7154457">.</span><span class="ident" id="7154458">DecodedLen</span><span class="op" id="7154468">(</span><span class="builtinfunc" id="7154469">len</span><span class="op" id="7154472">(</span><span class="ident" id="7154473">p</span><span class="op" id="7154474">.</span><span class="ident" id="7154475">encoded</span><span class="op" id="7154482">)</span><span class="op" id="7154483">)</span><span class="op" id="7154484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7154488">count</span><span class="op" id="7154493">,</span>&nbsp;<span class="ident" id="7154495">end</span><span class="op" id="7154498">,</span>&nbsp;<span class="ident" id="7154500">err</span>&nbsp;<span class="op" id="7154504">:=</span>&nbsp;<span class="ident" id="7154507">StdEncoding</span><span class="op" id="7154518">.</span><span class="ident" id="7154519">decode</span><span class="op" id="7154525">(</span><span class="ident" id="7154526">dbuf</span><span class="op" id="7154530">,</span>&nbsp;<span class="op" id="7154532">[</span><span class="op" id="7154533">]</span><span class="builtintype" id="7154534">byte</span><span class="op" id="7154538">(</span><span class="ident" id="7154539">p</span><span class="op" id="7154540">.</span><span class="ident" id="7154541">encoded</span><span class="op" id="7154548">)</span><span class="op" id="7154549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7154553">testEqual</span><span class="op" id="7154562">(</span><span class="ident" id="7154563">t</span><span class="op" id="7154564">,</span>&nbsp;<span class="string" id="7154566">&#34;Decode(%q)&nbsp;=&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7154598">,</span>&nbsp;<span class="ident" id="7154600">p</span><span class="op" id="7154601">.</span><span class="ident" id="7154602">encoded</span><span class="op" id="7154609">,</span>&nbsp;<span class="ident" id="7154611">err</span><span class="op" id="7154614">,</span>&nbsp;<span class="builtintype" id="7154616">error</span><span class="op" id="7154621">(</span><span class="ident" id="7154622">nil</span><span class="op" id="7154625">)</span><span class="op" id="7154626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7154630">testEqual</span><span class="op" id="7154639">(</span><span class="ident" id="7154640">t</span><span class="op" id="7154641">,</span>&nbsp;<span class="string" id="7154643">&#34;Decode(%q)&nbsp;=&nbsp;length&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7154676">,</span>&nbsp;<span class="ident" id="7154678">p</span><span class="op" id="7154679">.</span><span class="ident" id="7154680">encoded</span><span class="op" id="7154687">,</span>&nbsp;<span class="ident" id="7154689">count</span><span class="op" id="7154694">,</span>&nbsp;<span class="builtinfunc" id="7154696">len</span><span class="op" id="7154699">(</span><span class="ident" id="7154700">p</span><span class="op" id="7154701">.</span><span class="ident" id="7154702">decoded</span><span class="op" id="7154709">)</span><span class="op" id="7154710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7154714">if</span>&nbsp;<span class="builtinfunc" id="7154717">len</span><span class="op" id="7154720">(</span><span class="ident" id="7154721">p</span><span class="op" id="7154722">.</span><span class="ident" id="7154723">encoded</span><span class="op" id="7154730">)</span>&nbsp;<span class="op" id="7154732">&gt;</span>&nbsp;<span class="num" id="7154734">0</span>&nbsp;<span class="op" id="7154736">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7154741">testEqual</span><span class="op" id="7154750">(</span><span class="ident" id="7154751">t</span><span class="op" id="7154752">,</span>&nbsp;<span class="string" id="7154754">&#34;Decode(%q)&nbsp;=&nbsp;end&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7154784">,</span>&nbsp;<span class="ident" id="7154786">p</span><span class="op" id="7154787">.</span><span class="ident" id="7154788">encoded</span><span class="op" id="7154795">,</span>&nbsp;<span class="ident" id="7154797">end</span><span class="op" id="7154800">,</span>&nbsp;<span class="op" id="7154802">(</span><span class="ident" id="7154803">p</span><span class="op" id="7154804">.</span><span class="ident" id="7154805">encoded</span><span class="op" id="7154812">[</span><span class="builtinfunc" id="7154813">len</span><span class="op" id="7154816">(</span><span class="ident" id="7154817">p</span><span class="op" id="7154818">.</span><span class="ident" id="7154819">encoded</span><span class="op" id="7154826">)</span><span class="op" id="7154827">-</span><span class="num" id="7154828">1</span><span class="op" id="7154829">]</span>&nbsp;<span class="op" id="7154831">==</span>&nbsp;<span class="string" id="7154834">&#39;=&#39;</span><span class="op" id="7154837">)</span><span class="op" id="7154838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7154842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7154846">testEqual</span><span class="op" id="7154855">(</span><span class="ident" id="7154856">t</span><span class="op" id="7154857">,</span>&nbsp;<span class="string" id="7154859">&#34;Decode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7154885">,</span>&nbsp;<span class="ident" id="7154887">p</span><span class="op" id="7154888">.</span><span class="ident" id="7154889">encoded</span><span class="op" id="7154896">,</span>&nbsp;<span class="builtintype" id="7154898">string</span><span class="op" id="7154904">(</span><span class="ident" id="7154905">dbuf</span><span class="op" id="7154909">[</span><span class="num" id="7154910">0</span><span class="op" id="7154911">:</span><span class="ident" id="7154912">count</span><span class="op" id="7154917">]</span><span class="op" id="7154918">)</span><span class="op" id="7154919">,</span>&nbsp;<span class="ident" id="7154921">p</span><span class="op" id="7154922">.</span><span class="ident" id="7154923">decoded</span><span class="op" id="7154930">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7154935">dbuf</span><span class="op" id="7154939">,</span>&nbsp;<span class="ident" id="7154941">err</span>&nbsp;<span class="op" id="7154945">=</span>&nbsp;<span class="ident" id="7154947">StdEncoding</span><span class="op" id="7154958">.</span><span class="ident" id="7154959">DecodeString</span><span class="op" id="7154971">(</span><span class="ident" id="7154972">p</span><span class="op" id="7154973">.</span><span class="ident" id="7154974">encoded</span><span class="op" id="7154981">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7154985">testEqual</span><span class="op" id="7154994">(</span><span class="ident" id="7154995">t</span><span class="op" id="7154996">,</span>&nbsp;<span class="string" id="7154998">&#34;DecodeString(%q)&nbsp;=&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7155036">,</span>&nbsp;<span class="ident" id="7155038">p</span><span class="op" id="7155039">.</span><span class="ident" id="7155040">encoded</span><span class="op" id="7155047">,</span>&nbsp;<span class="ident" id="7155049">err</span><span class="op" id="7155052">,</span>&nbsp;<span class="builtintype" id="7155054">error</span><span class="op" id="7155059">(</span><span class="ident" id="7155060">nil</span><span class="op" id="7155063">)</span><span class="op" id="7155064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7155068">testEqual</span><span class="op" id="7155077">(</span><span class="ident" id="7155078">t</span><span class="op" id="7155079">,</span>&nbsp;<span class="string" id="7155081">&#34;DecodeString(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7155113">,</span>&nbsp;<span class="builtintype" id="7155115">string</span><span class="op" id="7155121">(</span><span class="ident" id="7155122">dbuf</span><span class="op" id="7155126">)</span><span class="op" id="7155127">,</span>&nbsp;<span class="ident" id="7155129">p</span><span class="op" id="7155130">.</span><span class="ident" id="7155131">decoded</span><span class="op" id="7155138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7155141">}</span><br>
<span class="lineno"></span><span class="op" id="7155143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="7155146">func</span>&nbsp;<span class="ident" id="7155151">TestDecoder</span><span class="op" id="7155162">(</span><span class="ident" id="7155163">t</span>&nbsp;<span class="op" id="7155165">*</span><span class="ident" id="7155166">testing</span><span class="op" id="7155173">.</span><span class="ident" id="7155174">T</span><span class="op" id="7155175">)</span>&nbsp;<span class="op" id="7155177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7155180">for</span>&nbsp;<span class="ident" id="7155184">_</span><span class="op" id="7155185">,</span>&nbsp;<span class="ident" id="7155187">p</span>&nbsp;<span class="op" id="7155189">:=</span>&nbsp;<span class="keyword" id="7155192">range</span>&nbsp;<span class="ident" id="7155198">pairs</span>&nbsp;<span class="op" id="7155204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7155208">decoder</span>&nbsp;<span class="op" id="7155216">:=</span>&nbsp;<span class="ident" id="7155219">NewDecoder</span><span class="op" id="7155229">(</span><span class="ident" id="7155230">StdEncoding</span><span class="op" id="7155241">,</span>&nbsp;<span class="ident" id="7155243">strings</span><span class="op" id="7155250">.</span><span class="ident" id="7155251">NewReader</span><span class="op" id="7155260">(</span><span class="ident" id="7155261">p</span><span class="op" id="7155262">.</span><span class="ident" id="7155263">encoded</span><span class="op" id="7155270">)</span><span class="op" id="7155271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7155275">dbuf</span>&nbsp;<span class="op" id="7155280">:=</span>&nbsp;<span class="builtinfunc" id="7155283">make</span><span class="op" id="7155287">(</span><span class="op" id="7155288">[</span><span class="op" id="7155289">]</span><span class="builtintype" id="7155290">byte</span><span class="op" id="7155294">,</span>&nbsp;<span class="ident" id="7155296">StdEncoding</span><span class="op" id="7155307">.</span><span class="ident" id="7155308">DecodedLen</span><span class="op" id="7155318">(</span><span class="builtinfunc" id="7155319">len</span><span class="op" id="7155322">(</span><span class="ident" id="7155323">p</span><span class="op" id="7155324">.</span><span class="ident" id="7155325">encoded</span><span class="op" id="7155332">)</span><span class="op" id="7155333">)</span><span class="op" id="7155334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7155338">count</span><span class="op" id="7155343">,</span>&nbsp;<span class="ident" id="7155345">err</span>&nbsp;<span class="op" id="7155349">:=</span>&nbsp;<span class="ident" id="7155352">decoder</span><span class="op" id="7155359">.</span><span class="ident" id="7155360">Read</span><span class="op" id="7155364">(</span><span class="ident" id="7155365">dbuf</span><span class="op" id="7155369">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7155373">if</span>&nbsp;<span class="ident" id="7155376">err</span>&nbsp;<span class="op" id="7155380">!=</span>&nbsp;<span class="ident" id="7155383">nil</span>&nbsp;<span class="op" id="7155387">&amp;&amp;</span>&nbsp;<span class="ident" id="7155390">err</span>&nbsp;<span class="op" id="7155394">!=</span>&nbsp;<span class="ident" id="7155397">io</span><span class="op" id="7155399">.</span><span class="ident" id="7155400">EOF</span>&nbsp;<span class="op" id="7155404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7155409">t</span><span class="op" id="7155410">.</span><span class="ident" id="7155411">Fatal</span><span class="op" id="7155416">(</span><span class="string" id="7155417">&#34;Read&nbsp;failed&#34;</span><span class="op" id="7155430">,</span>&nbsp;<span class="ident" id="7155432">err</span><span class="op" id="7155435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7155439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7155443">testEqual</span><span class="op" id="7155452">(</span><span class="ident" id="7155453">t</span><span class="op" id="7155454">,</span>&nbsp;<span class="string" id="7155456">&#34;Read&nbsp;from&nbsp;%q&nbsp;=&nbsp;length&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7155491">,</span>&nbsp;<span class="ident" id="7155493">p</span><span class="op" id="7155494">.</span><span class="ident" id="7155495">encoded</span><span class="op" id="7155502">,</span>&nbsp;<span class="ident" id="7155504">count</span><span class="op" id="7155509">,</span>&nbsp;<span class="builtinfunc" id="7155511">len</span><span class="op" id="7155514">(</span><span class="ident" id="7155515">p</span><span class="op" id="7155516">.</span><span class="ident" id="7155517">decoded</span><span class="op" id="7155524">)</span><span class="op" id="7155525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7155529">testEqual</span><span class="op" id="7155538">(</span><span class="ident" id="7155539">t</span><span class="op" id="7155540">,</span>&nbsp;<span class="string" id="7155542">&#34;Decoding&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7155572">,</span>&nbsp;<span class="ident" id="7155574">p</span><span class="op" id="7155575">.</span><span class="ident" id="7155576">encoded</span><span class="op" id="7155583">,</span>&nbsp;<span class="builtintype" id="7155585">string</span><span class="op" id="7155591">(</span><span class="ident" id="7155592">dbuf</span><span class="op" id="7155596">[</span><span class="num" id="7155597">0</span><span class="op" id="7155598">:</span><span class="ident" id="7155599">count</span><span class="op" id="7155604">]</span><span class="op" id="7155605">)</span><span class="op" id="7155606">,</span>&nbsp;<span class="ident" id="7155608">p</span><span class="op" id="7155609">.</span><span class="ident" id="7155610">decoded</span><span class="op" id="7155617">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7155621">if</span>&nbsp;<span class="ident" id="7155624">err</span>&nbsp;<span class="op" id="7155628">!=</span>&nbsp;<span class="ident" id="7155631">io</span><span class="op" id="7155633">.</span><span class="ident" id="7155634">EOF</span>&nbsp;<span class="op" id="7155638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7155643">count</span><span class="op" id="7155648">,</span>&nbsp;<span class="ident" id="7155650">err</span>&nbsp;<span class="op" id="7155654">=</span>&nbsp;<span class="ident" id="7155656">decoder</span><span class="op" id="7155663">.</span><span class="ident" id="7155664">Read</span><span class="op" id="7155668">(</span><span class="ident" id="7155669">dbuf</span><span class="op" id="7155673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7155677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7155681">testEqual</span><span class="op" id="7155690">(</span><span class="ident" id="7155691">t</span><span class="op" id="7155692">,</span>&nbsp;<span class="string" id="7155694">&#34;Read&nbsp;from&nbsp;%q&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7155722">,</span>&nbsp;<span class="ident" id="7155724">p</span><span class="op" id="7155725">.</span><span class="ident" id="7155726">encoded</span><span class="op" id="7155733">,</span>&nbsp;<span class="ident" id="7155735">err</span><span class="op" id="7155738">,</span>&nbsp;<span class="ident" id="7155740">io</span><span class="op" id="7155742">.</span><span class="ident" id="7155743">EOF</span><span class="op" id="7155746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7155749">}</span><br>
<span class="lineno">130</span><span class="op" id="7155751">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7155754">func</span>&nbsp;<span class="ident" id="7155759">TestDecoderBuffering</span><span class="op" id="7155779">(</span><span class="ident" id="7155780">t</span>&nbsp;<span class="op" id="7155782">*</span><span class="ident" id="7155783">testing</span><span class="op" id="7155790">.</span><span class="ident" id="7155791">T</span><span class="op" id="7155792">)</span>&nbsp;<span class="op" id="7155794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7155797">for</span>&nbsp;<span class="ident" id="7155801">bs</span>&nbsp;<span class="op" id="7155804">:=</span>&nbsp;<span class="num" id="7155807">1</span><span class="op" id="7155808">;</span>&nbsp;<span class="ident" id="7155810">bs</span>&nbsp;<span class="op" id="7155813">&lt;=</span>&nbsp;<span class="num" id="7155816">12</span><span class="op" id="7155818">;</span>&nbsp;<span class="ident" id="7155820">bs</span><span class="op" id="7155822">++</span>&nbsp;<span class="op" id="7155825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7155829">decoder</span>&nbsp;<span class="op" id="7155837">:=</span>&nbsp;<span class="ident" id="7155840">NewDecoder</span><span class="op" id="7155850">(</span><span class="ident" id="7155851">StdEncoding</span><span class="op" id="7155862">,</span>&nbsp;<span class="ident" id="7155864">strings</span><span class="op" id="7155871">.</span><span class="ident" id="7155872">NewReader</span><span class="op" id="7155881">(</span><span class="ident" id="7155882">bigtest</span><span class="op" id="7155889">.</span><span class="ident" id="7155890">encoded</span><span class="op" id="7155897">)</span><span class="op" id="7155898">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7155902">buf</span>&nbsp;<span class="op" id="7155906">:=</span>&nbsp;<span class="builtinfunc" id="7155909">make</span><span class="op" id="7155913">(</span><span class="op" id="7155914">[</span><span class="op" id="7155915">]</span><span class="builtintype" id="7155916">byte</span><span class="op" id="7155920">,</span>&nbsp;<span class="builtinfunc" id="7155922">len</span><span class="op" id="7155925">(</span><span class="ident" id="7155926">bigtest</span><span class="op" id="7155933">.</span><span class="ident" id="7155934">decoded</span><span class="op" id="7155941">)</span><span class="op" id="7155942">+</span><span class="num" id="7155943">12</span><span class="op" id="7155945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7155949">var</span>&nbsp;<span class="ident" id="7155953">total</span>&nbsp;<span class="builtintype" id="7155959">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7155965">for</span>&nbsp;<span class="ident" id="7155969">total</span>&nbsp;<span class="op" id="7155975">=</span>&nbsp;<span class="num" id="7155977">0</span><span class="op" id="7155978">;</span>&nbsp;<span class="ident" id="7155980">total</span>&nbsp;<span class="op" id="7155986">&lt;</span>&nbsp;<span class="builtinfunc" id="7155988">len</span><span class="op" id="7155991">(</span><span class="ident" id="7155992">bigtest</span><span class="op" id="7155999">.</span><span class="ident" id="7156000">decoded</span><span class="op" id="7156007">)</span><span class="op" id="7156008">;</span>&nbsp;<span class="op" id="7156010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7156015">n</span><span class="op" id="7156016">,</span>&nbsp;<span class="ident" id="7156018">err</span>&nbsp;<span class="op" id="7156022">:=</span>&nbsp;<span class="ident" id="7156025">decoder</span><span class="op" id="7156032">.</span><span class="ident" id="7156033">Read</span><span class="op" id="7156037">(</span><span class="ident" id="7156038">buf</span><span class="op" id="7156041">[</span><span class="ident" id="7156042">total</span>&nbsp;<span class="op" id="7156048">:</span>&nbsp;<span class="ident" id="7156050">total</span><span class="op" id="7156055">+</span><span class="ident" id="7156056">bs</span><span class="op" id="7156058">]</span><span class="op" id="7156059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7156064">testEqual</span><span class="op" id="7156073">(</span><span class="ident" id="7156074">t</span><span class="op" id="7156075">,</span>&nbsp;<span class="string" id="7156077">&#34;Read&nbsp;from&nbsp;%q&nbsp;at&nbsp;pos&nbsp;%d&nbsp;=&nbsp;%d,&nbsp;%v,&nbsp;want&nbsp;_,&nbsp;%v&#34;</span><span class="op" id="7156122">,</span>&nbsp;<span class="ident" id="7156124">bigtest</span><span class="op" id="7156131">.</span><span class="ident" id="7156132">encoded</span><span class="op" id="7156139">,</span>&nbsp;<span class="ident" id="7156141">total</span><span class="op" id="7156146">,</span>&nbsp;<span class="ident" id="7156148">n</span><span class="op" id="7156149">,</span>&nbsp;<span class="ident" id="7156151">err</span><span class="op" id="7156154">,</span>&nbsp;<span class="builtintype" id="7156156">error</span><span class="op" id="7156161">(</span><span class="ident" id="7156162">nil</span><span class="op" id="7156165">)</span><span class="op" id="7156166">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7156171">total</span>&nbsp;<span class="op" id="7156177">+=</span>&nbsp;<span class="ident" id="7156180">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7156184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7156188">testEqual</span><span class="op" id="7156197">(</span><span class="ident" id="7156198">t</span><span class="op" id="7156199">,</span>&nbsp;<span class="string" id="7156201">&#34;Decoding/%d&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7156234">,</span>&nbsp;<span class="ident" id="7156236">bs</span><span class="op" id="7156238">,</span>&nbsp;<span class="ident" id="7156240">bigtest</span><span class="op" id="7156247">.</span><span class="ident" id="7156248">encoded</span><span class="op" id="7156255">,</span>&nbsp;<span class="builtintype" id="7156257">string</span><span class="op" id="7156263">(</span><span class="ident" id="7156264">buf</span><span class="op" id="7156267">[</span><span class="num" id="7156268">0</span><span class="op" id="7156269">:</span><span class="ident" id="7156270">total</span><span class="op" id="7156275">]</span><span class="op" id="7156276">)</span><span class="op" id="7156277">,</span>&nbsp;<span class="ident" id="7156279">bigtest</span><span class="op" id="7156286">.</span><span class="ident" id="7156287">decoded</span><span class="op" id="7156294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7156297">}</span><br>
<span class="lineno"></span><span class="op" id="7156299">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="keyword" id="7156302">func</span>&nbsp;<span class="ident" id="7156307">TestDecodeCorrupt</span><span class="op" id="7156324">(</span><span class="ident" id="7156325">t</span>&nbsp;<span class="op" id="7156327">*</span><span class="ident" id="7156328">testing</span><span class="op" id="7156335">.</span><span class="ident" id="7156336">T</span><span class="op" id="7156337">)</span>&nbsp;<span class="op" id="7156339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7156342">testCases</span>&nbsp;<span class="op" id="7156352">:=</span>&nbsp;<span class="op" id="7156355">[</span><span class="op" id="7156356">]</span><span class="keyword" id="7156357">struct</span>&nbsp;<span class="op" id="7156364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7156368">input</span>&nbsp;&nbsp;<span class="builtintype" id="7156375">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7156384">offset</span>&nbsp;<span class="builtintype" id="7156391">int</span>&nbsp;<span class="comment" id="7156395">//&nbsp;-1&nbsp;means&nbsp;no&nbsp;corruption.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7156423">}</span><span class="op" id="7156424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7156428">{</span><span class="string" id="7156429">&#34;&#34;</span><span class="op" id="7156431">,</span>&nbsp;<span class="op" id="7156433">-</span><span class="num" id="7156434">1</span><span class="op" id="7156435">}</span><span class="op" id="7156436">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7156440">{</span><span class="string" id="7156441">&#34;!!!!&#34;</span><span class="op" id="7156447">,</span>&nbsp;<span class="num" id="7156449">0</span><span class="op" id="7156450">}</span><span class="op" id="7156451">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7156455">{</span><span class="string" id="7156456">&#34;====&#34;</span><span class="op" id="7156462">,</span>&nbsp;<span class="num" id="7156464">0</span><span class="op" id="7156465">}</span><span class="op" id="7156466">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7156470">{</span><span class="string" id="7156471">&#34;x===&#34;</span><span class="op" id="7156477">,</span>&nbsp;<span class="num" id="7156479">1</span><span class="op" id="7156480">}</span><span class="op" id="7156481">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7156485">{</span><span class="string" id="7156486">&#34;=AAA&#34;</span><span class="op" id="7156492">,</span>&nbsp;<span class="num" id="7156494">0</span><span class="op" id="7156495">}</span><span class="op" id="7156496">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7156500">{</span><span class="string" id="7156501">&#34;A=AA&#34;</span><span class="op" id="7156507">,</span>&nbsp;<span class="num" id="7156509">1</span><span class="op" id="7156510">}</span><span class="op" id="7156511">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7156515">{</span><span class="string" id="7156516">&#34;AA=A&#34;</span><span class="op" id="7156522">,</span>&nbsp;<span class="num" id="7156524">2</span><span class="op" id="7156525">}</span><span class="op" id="7156526">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7156530">{</span><span class="string" id="7156531">&#34;AA==A&#34;</span><span class="op" id="7156538">,</span>&nbsp;<span class="num" id="7156540">4</span><span class="op" id="7156541">}</span><span class="op" id="7156542">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7156546">{</span><span class="string" id="7156547">&#34;AAA=AAAA&#34;</span><span class="op" id="7156557">,</span>&nbsp;<span class="num" id="7156559">4</span><span class="op" id="7156560">}</span><span class="op" id="7156561">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7156565">{</span><span class="string" id="7156566">&#34;AAAAA&#34;</span><span class="op" id="7156573">,</span>&nbsp;<span class="num" id="7156575">4</span><span class="op" id="7156576">}</span><span class="op" id="7156577">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7156581">{</span><span class="string" id="7156582">&#34;AAAAAA&#34;</span><span class="op" id="7156590">,</span>&nbsp;<span class="num" id="7156592">4</span><span class="op" id="7156593">}</span><span class="op" id="7156594">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7156598">{</span><span class="string" id="7156599">&#34;A=&#34;</span><span class="op" id="7156603">,</span>&nbsp;<span class="num" id="7156605">1</span><span class="op" id="7156606">}</span><span class="op" id="7156607">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7156611">{</span><span class="string" id="7156612">&#34;A==&#34;</span><span class="op" id="7156617">,</span>&nbsp;<span class="num" id="7156619">1</span><span class="op" id="7156620">}</span><span class="op" id="7156621">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7156625">{</span><span class="string" id="7156626">&#34;AA=&#34;</span><span class="op" id="7156631">,</span>&nbsp;<span class="num" id="7156633">3</span><span class="op" id="7156634">}</span><span class="op" id="7156635">,</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7156639">{</span><span class="string" id="7156640">&#34;AA==&#34;</span><span class="op" id="7156646">,</span>&nbsp;<span class="op" id="7156648">-</span><span class="num" id="7156649">1</span><span class="op" id="7156650">}</span><span class="op" id="7156651">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7156655">{</span><span class="string" id="7156656">&#34;AAA=&#34;</span><span class="op" id="7156662">,</span>&nbsp;<span class="op" id="7156664">-</span><span class="num" id="7156665">1</span><span class="op" id="7156666">}</span><span class="op" id="7156667">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7156671">{</span><span class="string" id="7156672">&#34;AAAA&#34;</span><span class="op" id="7156678">,</span>&nbsp;<span class="op" id="7156680">-</span><span class="num" id="7156681">1</span><span class="op" id="7156682">}</span><span class="op" id="7156683">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7156687">{</span><span class="string" id="7156688">&#34;AAAAAA=&#34;</span><span class="op" id="7156697">,</span>&nbsp;<span class="num" id="7156699">7</span><span class="op" id="7156700">}</span><span class="op" id="7156701">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7156705">{</span><span class="string" id="7156706">&#34;YWJjZA=====&#34;</span><span class="op" id="7156719">,</span>&nbsp;<span class="num" id="7156721">8</span><span class="op" id="7156722">}</span><span class="op" id="7156723">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7156726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7156729">for</span>&nbsp;<span class="ident" id="7156733">_</span><span class="op" id="7156734">,</span>&nbsp;<span class="ident" id="7156736">tc</span>&nbsp;<span class="op" id="7156739">:=</span>&nbsp;<span class="keyword" id="7156742">range</span>&nbsp;<span class="ident" id="7156748">testCases</span>&nbsp;<span class="op" id="7156758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7156762">dbuf</span>&nbsp;<span class="op" id="7156767">:=</span>&nbsp;<span class="builtinfunc" id="7156770">make</span><span class="op" id="7156774">(</span><span class="op" id="7156775">[</span><span class="op" id="7156776">]</span><span class="builtintype" id="7156777">byte</span><span class="op" id="7156781">,</span>&nbsp;<span class="ident" id="7156783">StdEncoding</span><span class="op" id="7156794">.</span><span class="ident" id="7156795">DecodedLen</span><span class="op" id="7156805">(</span><span class="builtinfunc" id="7156806">len</span><span class="op" id="7156809">(</span><span class="ident" id="7156810">tc</span><span class="op" id="7156812">.</span><span class="ident" id="7156813">input</span><span class="op" id="7156818">)</span><span class="op" id="7156819">)</span><span class="op" id="7156820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7156824">_</span><span class="op" id="7156825">,</span>&nbsp;<span class="ident" id="7156827">err</span>&nbsp;<span class="op" id="7156831">:=</span>&nbsp;<span class="ident" id="7156834">StdEncoding</span><span class="op" id="7156845">.</span><span class="ident" id="7156846">Decode</span><span class="op" id="7156852">(</span><span class="ident" id="7156853">dbuf</span><span class="op" id="7156857">,</span>&nbsp;<span class="op" id="7156859">[</span><span class="op" id="7156860">]</span><span class="builtintype" id="7156861">byte</span><span class="op" id="7156865">(</span><span class="ident" id="7156866">tc</span><span class="op" id="7156868">.</span><span class="ident" id="7156869">input</span><span class="op" id="7156874">)</span><span class="op" id="7156875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7156879">if</span>&nbsp;<span class="ident" id="7156882">tc</span><span class="op" id="7156884">.</span><span class="ident" id="7156885">offset</span>&nbsp;<span class="op" id="7156892">==</span>&nbsp;<span class="op" id="7156895">-</span><span class="num" id="7156896">1</span>&nbsp;<span class="op" id="7156898">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7156903">if</span>&nbsp;<span class="ident" id="7156906">err</span>&nbsp;<span class="op" id="7156910">!=</span>&nbsp;<span class="ident" id="7156913">nil</span>&nbsp;<span class="op" id="7156917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7156923">t</span><span class="op" id="7156924">.</span><span class="ident" id="7156925">Error</span><span class="op" id="7156930">(</span><span class="string" id="7156931">&#34;Decoder&nbsp;wrongly&nbsp;detected&nbsp;coruption&nbsp;in&#34;</span><span class="op" id="7156970">,</span>&nbsp;<span class="ident" id="7156972">tc</span><span class="op" id="7156974">.</span><span class="ident" id="7156975">input</span><span class="op" id="7156980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7156985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7156990">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7157001">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7157005">switch</span>&nbsp;<span class="ident" id="7157012">err</span>&nbsp;<span class="op" id="7157016">:=</span>&nbsp;<span class="ident" id="7157019">err</span><span class="op" id="7157022">.</span><span class="op" id="7157023">(</span><span class="keyword" id="7157024">type</span><span class="op" id="7157028">)</span>&nbsp;<span class="op" id="7157030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7157034">case</span>&nbsp;<span class="ident" id="7157039">CorruptInputError</span><span class="op" id="7157056">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7157061">testEqual</span><span class="op" id="7157070">(</span><span class="ident" id="7157071">t</span><span class="op" id="7157072">,</span>&nbsp;<span class="string" id="7157074">&#34;Corruption&nbsp;in&nbsp;%q&nbsp;at&nbsp;offset&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7157114">,</span>&nbsp;<span class="ident" id="7157116">tc</span><span class="op" id="7157118">.</span><span class="ident" id="7157119">input</span><span class="op" id="7157124">,</span>&nbsp;<span class="builtintype" id="7157126">int</span><span class="op" id="7157129">(</span><span class="ident" id="7157130">err</span><span class="op" id="7157133">)</span><span class="op" id="7157134">,</span>&nbsp;<span class="ident" id="7157136">tc</span><span class="op" id="7157138">.</span><span class="ident" id="7157139">offset</span><span class="op" id="7157145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7157149">default</span><span class="op" id="7157156">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7157161">t</span><span class="op" id="7157162">.</span><span class="ident" id="7157163">Error</span><span class="op" id="7157168">(</span><span class="string" id="7157169">&#34;Decoder&nbsp;failed&nbsp;to&nbsp;detect&nbsp;corruption&nbsp;in&#34;</span><span class="op" id="7157209">,</span>&nbsp;<span class="ident" id="7157211">tc</span><span class="op" id="7157213">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7157217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7157220">}</span><br>
<span class="lineno"></span><span class="op" id="7157222">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7157225">func</span>&nbsp;<span class="ident" id="7157230">TestBig</span><span class="op" id="7157237">(</span><span class="ident" id="7157238">t</span>&nbsp;<span class="op" id="7157240">*</span><span class="ident" id="7157241">testing</span><span class="op" id="7157248">.</span><span class="ident" id="7157249">T</span><span class="op" id="7157250">)</span>&nbsp;<span class="op" id="7157252">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7157255">n</span>&nbsp;<span class="op" id="7157257">:=</span>&nbsp;<span class="num" id="7157260">3</span><span class="op" id="7157261">*</span><span class="num" id="7157262">1000</span>&nbsp;<span class="op" id="7157267">+</span>&nbsp;<span class="num" id="7157269">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7157272">raw</span>&nbsp;<span class="op" id="7157276">:=</span>&nbsp;<span class="builtinfunc" id="7157279">make</span><span class="op" id="7157283">(</span><span class="op" id="7157284">[</span><span class="op" id="7157285">]</span><span class="builtintype" id="7157286">byte</span><span class="op" id="7157290">,</span>&nbsp;<span class="ident" id="7157292">n</span><span class="op" id="7157293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7157296">const</span>&nbsp;<span class="ident" id="7157302">alpha</span>&nbsp;<span class="op" id="7157308">=</span>&nbsp;<span class="string" id="7157310">&#34;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7157376">for</span>&nbsp;<span class="ident" id="7157380">i</span>&nbsp;<span class="op" id="7157382">:=</span>&nbsp;<span class="num" id="7157385">0</span><span class="op" id="7157386">;</span>&nbsp;<span class="ident" id="7157388">i</span>&nbsp;<span class="op" id="7157390">&lt;</span>&nbsp;<span class="ident" id="7157392">n</span><span class="op" id="7157393">;</span>&nbsp;<span class="ident" id="7157395">i</span><span class="op" id="7157396">++</span>&nbsp;<span class="op" id="7157399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7157403">raw</span><span class="op" id="7157406">[</span><span class="ident" id="7157407">i</span><span class="op" id="7157408">]</span>&nbsp;<span class="op" id="7157410">=</span>&nbsp;<span class="ident" id="7157412">alpha</span><span class="op" id="7157417">[</span><span class="ident" id="7157418">i</span><span class="op" id="7157419">%</span><span class="builtinfunc" id="7157420">len</span><span class="op" id="7157423">(</span><span class="ident" id="7157424">alpha</span><span class="op" id="7157429">)</span><span class="op" id="7157430">]</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7157433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7157436">encoded</span>&nbsp;<span class="op" id="7157444">:=</span>&nbsp;<span class="builtinfunc" id="7157447">new</span><span class="op" id="7157450">(</span><span class="ident" id="7157451">bytes</span><span class="op" id="7157456">.</span><span class="ident" id="7157457">Buffer</span><span class="op" id="7157463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7157466">w</span>&nbsp;<span class="op" id="7157468">:=</span>&nbsp;<span class="ident" id="7157471">NewEncoder</span><span class="op" id="7157481">(</span><span class="ident" id="7157482">StdEncoding</span><span class="op" id="7157493">,</span>&nbsp;<span class="ident" id="7157495">encoded</span><span class="op" id="7157502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7157505">nn</span><span class="op" id="7157507">,</span>&nbsp;<span class="ident" id="7157509">err</span>&nbsp;<span class="op" id="7157513">:=</span>&nbsp;<span class="ident" id="7157516">w</span><span class="op" id="7157517">.</span><span class="ident" id="7157518">Write</span><span class="op" id="7157523">(</span><span class="ident" id="7157524">raw</span><span class="op" id="7157527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7157530">if</span>&nbsp;<span class="ident" id="7157533">nn</span>&nbsp;<span class="op" id="7157536">!=</span>&nbsp;<span class="ident" id="7157539">n</span>&nbsp;<span class="op" id="7157541">||</span>&nbsp;<span class="ident" id="7157544">err</span>&nbsp;<span class="op" id="7157548">!=</span>&nbsp;<span class="ident" id="7157551">nil</span>&nbsp;<span class="op" id="7157555">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7157559">t</span><span class="op" id="7157560">.</span><span class="ident" id="7157561">Fatalf</span><span class="op" id="7157567">(</span><span class="string" id="7157568">&#34;Encoder.Write(raw)&nbsp;=&nbsp;%d,&nbsp;%v&nbsp;want&nbsp;%d,&nbsp;nil&#34;</span><span class="op" id="7157610">,</span>&nbsp;<span class="ident" id="7157612">nn</span><span class="op" id="7157614">,</span>&nbsp;<span class="ident" id="7157616">err</span><span class="op" id="7157619">,</span>&nbsp;<span class="ident" id="7157621">n</span><span class="op" id="7157622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7157625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7157628">err</span>&nbsp;<span class="op" id="7157632">=</span>&nbsp;<span class="ident" id="7157634">w</span><span class="op" id="7157635">.</span><span class="ident" id="7157636">Close</span><span class="op" id="7157641">(</span><span class="op" id="7157642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7157645">if</span>&nbsp;<span class="ident" id="7157648">err</span>&nbsp;<span class="op" id="7157652">!=</span>&nbsp;<span class="ident" id="7157655">nil</span>&nbsp;<span class="op" id="7157659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7157663">t</span><span class="op" id="7157664">.</span><span class="ident" id="7157665">Fatalf</span><span class="op" id="7157671">(</span><span class="string" id="7157672">&#34;Encoder.Close()&nbsp;=&nbsp;%v&nbsp;want&nbsp;nil&#34;</span><span class="op" id="7157703">,</span>&nbsp;<span class="ident" id="7157705">err</span><span class="op" id="7157708">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7157711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7157714">decoded</span><span class="op" id="7157721">,</span>&nbsp;<span class="ident" id="7157723">err</span>&nbsp;<span class="op" id="7157727">:=</span>&nbsp;<span class="ident" id="7157730">ioutil</span><span class="op" id="7157736">.</span><span class="ident" id="7157737">ReadAll</span><span class="op" id="7157744">(</span><span class="ident" id="7157745">NewDecoder</span><span class="op" id="7157755">(</span><span class="ident" id="7157756">StdEncoding</span><span class="op" id="7157767">,</span>&nbsp;<span class="ident" id="7157769">encoded</span><span class="op" id="7157776">)</span><span class="op" id="7157777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7157780">if</span>&nbsp;<span class="ident" id="7157783">err</span>&nbsp;<span class="op" id="7157787">!=</span>&nbsp;<span class="ident" id="7157790">nil</span>&nbsp;<span class="op" id="7157794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7157798">t</span><span class="op" id="7157799">.</span><span class="ident" id="7157800">Fatalf</span><span class="op" id="7157806">(</span><span class="string" id="7157807">&#34;ioutil.ReadAll(NewDecoder(...)):&nbsp;%v&#34;</span><span class="op" id="7157844">,</span>&nbsp;<span class="ident" id="7157846">err</span><span class="op" id="7157849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7157852">}</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7157856">if</span>&nbsp;<span class="op" id="7157859">!</span><span class="ident" id="7157860">bytes</span><span class="op" id="7157865">.</span><span class="ident" id="7157866">Equal</span><span class="op" id="7157871">(</span><span class="ident" id="7157872">raw</span><span class="op" id="7157875">,</span>&nbsp;<span class="ident" id="7157877">decoded</span><span class="op" id="7157884">)</span>&nbsp;<span class="op" id="7157886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7157890">var</span>&nbsp;<span class="ident" id="7157894">i</span>&nbsp;<span class="builtintype" id="7157896">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7157902">for</span>&nbsp;<span class="ident" id="7157906">i</span>&nbsp;<span class="op" id="7157908">=</span>&nbsp;<span class="num" id="7157910">0</span><span class="op" id="7157911">;</span>&nbsp;<span class="ident" id="7157913">i</span>&nbsp;<span class="op" id="7157915">&lt;</span>&nbsp;<span class="builtinfunc" id="7157917">len</span><span class="op" id="7157920">(</span><span class="ident" id="7157921">decoded</span><span class="op" id="7157928">)</span>&nbsp;<span class="op" id="7157930">&amp;&amp;</span>&nbsp;<span class="ident" id="7157933">i</span>&nbsp;<span class="op" id="7157935">&lt;</span>&nbsp;<span class="builtinfunc" id="7157937">len</span><span class="op" id="7157940">(</span><span class="ident" id="7157941">raw</span><span class="op" id="7157944">)</span><span class="op" id="7157945">;</span>&nbsp;<span class="ident" id="7157947">i</span><span class="op" id="7157948">++</span>&nbsp;<span class="op" id="7157951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7157956">if</span>&nbsp;<span class="ident" id="7157959">decoded</span><span class="op" id="7157966">[</span><span class="ident" id="7157967">i</span><span class="op" id="7157968">]</span>&nbsp;<span class="op" id="7157970">!=</span>&nbsp;<span class="ident" id="7157973">raw</span><span class="op" id="7157976">[</span><span class="ident" id="7157977">i</span><span class="op" id="7157978">]</span>&nbsp;<span class="op" id="7157980">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7157986">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7157995">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7157999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7158003">t</span><span class="op" id="7158004">.</span><span class="ident" id="7158005">Errorf</span><span class="op" id="7158011">(</span><span class="string" id="7158012">&#34;Decode(Encode(%d-byte&nbsp;string))&nbsp;failed&nbsp;at&nbsp;offset&nbsp;%d&#34;</span><span class="op" id="7158064">,</span>&nbsp;<span class="ident" id="7158066">n</span><span class="op" id="7158067">,</span>&nbsp;<span class="ident" id="7158069">i</span><span class="op" id="7158070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7158073">}</span><br>
<span class="lineno">220</span><span class="op" id="7158075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7158078">func</span>&nbsp;<span class="ident" id="7158083">TestNewLineCharacters</span><span class="op" id="7158104">(</span><span class="ident" id="7158105">t</span>&nbsp;<span class="op" id="7158107">*</span><span class="ident" id="7158108">testing</span><span class="op" id="7158115">.</span><span class="ident" id="7158116">T</span><span class="op" id="7158117">)</span>&nbsp;<span class="op" id="7158119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7158122">//&nbsp;Each&nbsp;of&nbsp;these&nbsp;should&nbsp;decode&nbsp;to&nbsp;the&nbsp;string&nbsp;&#34;sure&#34;,&nbsp;without&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7158192">const</span>&nbsp;<span class="ident" id="7158198">expected</span>&nbsp;<span class="op" id="7158207">=</span>&nbsp;<span class="string" id="7158209">&#34;sure&#34;</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7158217">examples</span>&nbsp;<span class="op" id="7158226">:=</span>&nbsp;<span class="op" id="7158229">[</span><span class="op" id="7158230">]</span><span class="builtintype" id="7158231">string</span><span class="op" id="7158237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7158241">&#34;c3VyZQ==&#34;</span><span class="op" id="7158251">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7158255">&#34;c3VyZQ==\r&#34;</span><span class="op" id="7158267">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7158271">&#34;c3VyZQ==\n&#34;</span><span class="op" id="7158283">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7158287">&#34;c3VyZQ==\r\n&#34;</span><span class="op" id="7158301">,</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7158305">&#34;c3VyZ\r\nQ==&#34;</span><span class="op" id="7158319">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7158323">&#34;c3V\ryZ\nQ==&#34;</span><span class="op" id="7158337">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7158341">&#34;c3V\nyZ\rQ==&#34;</span><span class="op" id="7158355">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7158359">&#34;c3VyZ\nQ==&#34;</span><span class="op" id="7158371">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7158375">&#34;c3VyZQ\n==&#34;</span><span class="op" id="7158387">,</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7158391">&#34;c3VyZQ=\n=&#34;</span><span class="op" id="7158403">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7158407">&#34;c3VyZQ=\r\n\r\n=&#34;</span><span class="op" id="7158425">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7158428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7158431">for</span>&nbsp;<span class="ident" id="7158435">_</span><span class="op" id="7158436">,</span>&nbsp;<span class="ident" id="7158438">e</span>&nbsp;<span class="op" id="7158440">:=</span>&nbsp;<span class="keyword" id="7158443">range</span>&nbsp;<span class="ident" id="7158449">examples</span>&nbsp;<span class="op" id="7158458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7158462">buf</span><span class="op" id="7158465">,</span>&nbsp;<span class="ident" id="7158467">err</span>&nbsp;<span class="op" id="7158471">:=</span>&nbsp;<span class="ident" id="7158474">StdEncoding</span><span class="op" id="7158485">.</span><span class="ident" id="7158486">DecodeString</span><span class="op" id="7158498">(</span><span class="ident" id="7158499">e</span><span class="op" id="7158500">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7158504">if</span>&nbsp;<span class="ident" id="7158507">err</span>&nbsp;<span class="op" id="7158511">!=</span>&nbsp;<span class="ident" id="7158514">nil</span>&nbsp;<span class="op" id="7158518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7158523">t</span><span class="op" id="7158524">.</span><span class="ident" id="7158525">Errorf</span><span class="op" id="7158531">(</span><span class="string" id="7158532">&#34;Decode(%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7158555">,</span>&nbsp;<span class="ident" id="7158557">e</span><span class="op" id="7158558">,</span>&nbsp;<span class="ident" id="7158560">err</span><span class="op" id="7158563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7158568">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7158579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7158583">if</span>&nbsp;<span class="ident" id="7158586">s</span>&nbsp;<span class="op" id="7158588">:=</span>&nbsp;<span class="builtintype" id="7158591">string</span><span class="op" id="7158597">(</span><span class="ident" id="7158598">buf</span><span class="op" id="7158601">)</span><span class="op" id="7158602">;</span>&nbsp;<span class="ident" id="7158604">s</span>&nbsp;<span class="op" id="7158606">!=</span>&nbsp;<span class="ident" id="7158609">expected</span>&nbsp;<span class="op" id="7158618">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7158623">t</span><span class="op" id="7158624">.</span><span class="ident" id="7158625">Errorf</span><span class="op" id="7158631">(</span><span class="string" id="7158632">&#34;Decode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7158658">,</span>&nbsp;<span class="ident" id="7158660">e</span><span class="op" id="7158661">,</span>&nbsp;<span class="ident" id="7158663">s</span><span class="op" id="7158664">,</span>&nbsp;<span class="ident" id="7158666">expected</span><span class="op" id="7158674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7158678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7158681">}</span><br>
<span class="lineno"></span><span class="op" id="7158683">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="7158686">type</span>&nbsp;<span class="ident" id="7158691">nextRead</span>&nbsp;<span class="keyword" id="7158700">struct</span>&nbsp;<span class="op" id="7158707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7158710">n</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7158714">int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="7158720">//&nbsp;bytes&nbsp;to&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7158740">err</span>&nbsp;<span class="builtintype" id="7158744">error</span>&nbsp;<span class="comment" id="7158750">//&nbsp;error&nbsp;to&nbsp;return</span><br>
<span class="lineno"></span><span class="op" id="7158769">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="7158772">//&nbsp;faultInjectReader&nbsp;returns&nbsp;data&nbsp;from&nbsp;source,&nbsp;rate-limited</span><br>
<span class="lineno"></span><span class="comment" id="7158832">//&nbsp;and&nbsp;with&nbsp;the&nbsp;errors&nbsp;as&nbsp;written&nbsp;to&nbsp;nextc.</span><br>
<span class="lineno"></span><span class="keyword" id="7158876">type</span>&nbsp;<span class="ident" id="7158881">faultInjectReader</span>&nbsp;<span class="keyword" id="7158899">struct</span>&nbsp;<span class="op" id="7158906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7158909">source</span>&nbsp;<span class="builtintype" id="7158916">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7158924">nextc</span>&nbsp;&nbsp;<span class="op" id="7158931">&lt;-</span><span class="keyword" id="7158933">chan</span>&nbsp;<span class="ident" id="7158938">nextRead</span><br>
<span class="lineno">260</span><span class="op" id="7158947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7158950">func</span>&nbsp;<span class="op" id="7158955">(</span><span class="ident" id="7158956">r</span>&nbsp;<span class="op" id="7158958">*</span><span class="ident" id="7158959">faultInjectReader</span><span class="op" id="7158976">)</span>&nbsp;<span class="ident" id="7158978">Read</span><span class="op" id="7158982">(</span><span class="ident" id="7158983">p</span>&nbsp;<span class="op" id="7158985">[</span><span class="op" id="7158986">]</span><span class="builtintype" id="7158987">byte</span><span class="op" id="7158991">)</span>&nbsp;<span class="op" id="7158993">(</span><span class="builtintype" id="7158994">int</span><span class="op" id="7158997">,</span>&nbsp;<span class="builtintype" id="7158999">error</span><span class="op" id="7159004">)</span>&nbsp;<span class="op" id="7159006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7159009">nr</span>&nbsp;<span class="op" id="7159012">:=</span>&nbsp;<span class="op" id="7159015">&lt;-</span><span class="ident" id="7159017">r</span><span class="op" id="7159018">.</span><span class="ident" id="7159019">nextc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7159026">if</span>&nbsp;<span class="builtinfunc" id="7159029">len</span><span class="op" id="7159032">(</span><span class="ident" id="7159033">p</span><span class="op" id="7159034">)</span>&nbsp;<span class="op" id="7159036">&gt;</span>&nbsp;<span class="ident" id="7159038">nr</span><span class="op" id="7159040">.</span><span class="ident" id="7159041">n</span>&nbsp;<span class="op" id="7159043">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7159047">p</span>&nbsp;<span class="op" id="7159049">=</span>&nbsp;<span class="ident" id="7159051">p</span><span class="op" id="7159052">[</span><span class="op" id="7159053">:</span><span class="ident" id="7159054">nr</span><span class="op" id="7159056">.</span><span class="ident" id="7159057">n</span><span class="op" id="7159058">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7159061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7159064">n</span>&nbsp;<span class="op" id="7159066">:=</span>&nbsp;<span class="builtinfunc" id="7159069">copy</span><span class="op" id="7159073">(</span><span class="ident" id="7159074">p</span><span class="op" id="7159075">,</span>&nbsp;<span class="ident" id="7159077">r</span><span class="op" id="7159078">.</span><span class="ident" id="7159079">source</span><span class="op" id="7159085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7159088">r</span><span class="op" id="7159089">.</span><span class="ident" id="7159090">source</span>&nbsp;<span class="op" id="7159097">=</span>&nbsp;<span class="ident" id="7159099">r</span><span class="op" id="7159100">.</span><span class="ident" id="7159101">source</span><span class="op" id="7159107">[</span><span class="ident" id="7159108">n</span><span class="op" id="7159109">:</span><span class="op" id="7159110">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7159113">return</span>&nbsp;<span class="ident" id="7159120">n</span><span class="op" id="7159121">,</span>&nbsp;<span class="ident" id="7159123">nr</span><span class="op" id="7159125">.</span><span class="ident" id="7159126">err</span><br>
<span class="lineno">270</span><span class="op" id="7159130">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7159133">//&nbsp;tests&nbsp;that&nbsp;we&nbsp;don&#39;t&nbsp;ignore&nbsp;errors&nbsp;from&nbsp;our&nbsp;underlying&nbsp;reader</span><br>
<span class="lineno"></span><span class="keyword" id="7159197">func</span>&nbsp;<span class="ident" id="7159202">TestDecoderIssue3577</span><span class="op" id="7159222">(</span><span class="ident" id="7159223">t</span>&nbsp;<span class="op" id="7159225">*</span><span class="ident" id="7159226">testing</span><span class="op" id="7159233">.</span><span class="ident" id="7159234">T</span><span class="op" id="7159235">)</span>&nbsp;<span class="op" id="7159237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7159240">next</span>&nbsp;<span class="op" id="7159245">:=</span>&nbsp;<span class="builtinfunc" id="7159248">make</span><span class="op" id="7159252">(</span><span class="keyword" id="7159253">chan</span>&nbsp;<span class="ident" id="7159258">nextRead</span><span class="op" id="7159266">,</span>&nbsp;<span class="num" id="7159268">10</span><span class="op" id="7159270">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7159273">wantErr</span>&nbsp;<span class="op" id="7159281">:=</span>&nbsp;<span class="ident" id="7159284">errors</span><span class="op" id="7159290">.</span><span class="ident" id="7159291">New</span><span class="op" id="7159294">(</span><span class="string" id="7159295">&#34;my&nbsp;error&#34;</span><span class="op" id="7159305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7159308">next</span>&nbsp;<span class="op" id="7159313">&lt;-</span>&nbsp;<span class="ident" id="7159316">nextRead</span><span class="op" id="7159324">{</span><span class="num" id="7159325">5</span><span class="op" id="7159326">,</span>&nbsp;<span class="ident" id="7159328">nil</span><span class="op" id="7159331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7159334">next</span>&nbsp;<span class="op" id="7159339">&lt;-</span>&nbsp;<span class="ident" id="7159342">nextRead</span><span class="op" id="7159350">{</span><span class="num" id="7159351">10</span><span class="op" id="7159353">,</span>&nbsp;<span class="ident" id="7159355">wantErr</span><span class="op" id="7159362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7159365">next</span>&nbsp;<span class="op" id="7159370">&lt;-</span>&nbsp;<span class="ident" id="7159373">nextRead</span><span class="op" id="7159381">{</span><span class="num" id="7159382">0</span><span class="op" id="7159383">,</span>&nbsp;<span class="ident" id="7159385">wantErr</span><span class="op" id="7159392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7159395">d</span>&nbsp;<span class="op" id="7159397">:=</span>&nbsp;<span class="ident" id="7159400">NewDecoder</span><span class="op" id="7159410">(</span><span class="ident" id="7159411">StdEncoding</span><span class="op" id="7159422">,</span>&nbsp;<span class="op" id="7159424">&amp;</span><span class="ident" id="7159425">faultInjectReader</span><span class="op" id="7159442">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7159446">source</span><span class="op" id="7159452">:</span>&nbsp;<span class="string" id="7159454">&#34;VHdhcyBicmlsbGlnLCBhbmQgdGhlIHNsaXRoeSB0b3Zlcw==&#34;</span><span class="op" id="7159504">,</span>&nbsp;<span class="comment" id="7159506">//&nbsp;twas&nbsp;brillig...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7159527">nextc</span><span class="op" id="7159532">:</span>&nbsp;&nbsp;<span class="ident" id="7159535">next</span><span class="op" id="7159539">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7159542">}</span><span class="op" id="7159543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7159546">errc</span>&nbsp;<span class="op" id="7159551">:=</span>&nbsp;<span class="builtinfunc" id="7159554">make</span><span class="op" id="7159558">(</span><span class="keyword" id="7159559">chan</span>&nbsp;<span class="builtintype" id="7159564">error</span><span class="op" id="7159569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7159572">go</span>&nbsp;<span class="keyword" id="7159575">func</span><span class="op" id="7159579">(</span><span class="op" id="7159580">)</span>&nbsp;<span class="op" id="7159582">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7159586">_</span><span class="op" id="7159587">,</span>&nbsp;<span class="ident" id="7159589">err</span>&nbsp;<span class="op" id="7159593">:=</span>&nbsp;<span class="ident" id="7159596">ioutil</span><span class="op" id="7159602">.</span><span class="ident" id="7159603">ReadAll</span><span class="op" id="7159610">(</span><span class="ident" id="7159611">d</span><span class="op" id="7159612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7159616">errc</span>&nbsp;<span class="op" id="7159621">&lt;-</span>&nbsp;<span class="ident" id="7159624">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7159629">}</span><span class="op" id="7159630">(</span><span class="op" id="7159631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7159634">select</span>&nbsp;<span class="op" id="7159641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7159644">case</span>&nbsp;<span class="ident" id="7159649">err</span>&nbsp;<span class="op" id="7159653">:=</span>&nbsp;<span class="op" id="7159656">&lt;-</span><span class="ident" id="7159658">errc</span><span class="op" id="7159662">:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7159666">if</span>&nbsp;<span class="ident" id="7159669">err</span>&nbsp;<span class="op" id="7159673">!=</span>&nbsp;<span class="ident" id="7159676">wantErr</span>&nbsp;<span class="op" id="7159684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7159689">t</span><span class="op" id="7159690">.</span><span class="ident" id="7159691">Errorf</span><span class="op" id="7159697">(</span><span class="string" id="7159698">&#34;got&nbsp;error&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7159721">,</span>&nbsp;<span class="ident" id="7159723">err</span><span class="op" id="7159726">,</span>&nbsp;<span class="ident" id="7159728">wantErr</span><span class="op" id="7159735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7159739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7159742">case</span>&nbsp;<span class="op" id="7159747">&lt;-</span><span class="ident" id="7159749">time</span><span class="op" id="7159753">.</span><span class="ident" id="7159754">After</span><span class="op" id="7159759">(</span><span class="num" id="7159760">5</span>&nbsp;<span class="op" id="7159762">*</span>&nbsp;<span class="ident" id="7159764">time</span><span class="op" id="7159768">.</span><span class="ident" id="7159769">Second</span><span class="op" id="7159775">)</span><span class="op" id="7159776">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7159780">t</span><span class="op" id="7159781">.</span><span class="ident" id="7159782">Errorf</span><span class="op" id="7159788">(</span><span class="string" id="7159789">&#34;timeout;&nbsp;Decoder&nbsp;blocked&nbsp;without&nbsp;returning&nbsp;an&nbsp;error&#34;</span><span class="op" id="7159842">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7159845">}</span><br>
<span class="lineno"></span><span class="op" id="7159847">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7159850">func</span>&nbsp;<span class="ident" id="7159855">TestDecoderIssue4779</span><span class="op" id="7159875">(</span><span class="ident" id="7159876">t</span>&nbsp;<span class="op" id="7159878">*</span><span class="ident" id="7159879">testing</span><span class="op" id="7159886">.</span><span class="ident" id="7159887">T</span><span class="op" id="7159888">)</span>&nbsp;<span class="op" id="7159890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7159893">encoded</span>&nbsp;<span class="op" id="7159901">:=</span>&nbsp;<span class="string" id="7159904">`CP/EAT8AAAEF<br>
<span class="lineno">300</span>AQEBAQEBAAAAAAAAAAMAAQIEBQYHCAkKCwEAAQUBAQEBAQEAAAAAAAAAAQACAwQFBgcICQoLEAAB<br>
<span class="lineno"></span>BAEDAgQCBQcGCAUDDDMBAAIRAwQhEjEFQVFhEyJxgTIGFJGhsUIjJBVSwWIzNHKC0UMHJZJT8OHx<br>
<span class="lineno"></span>Y3M1FqKygyZEk1RkRcKjdDYX0lXiZfKzhMPTdePzRieUpIW0lcTU5PSltcXV5fVWZnaGlqa2xtbm<br>
<span class="lineno"></span>9jdHV2d3h5ent8fX5/cRAAICAQIEBAMEBQYHBwYFNQEAAhEDITESBEFRYXEiEwUygZEUobFCI8FS<br>
<span class="lineno"></span>0fAzJGLhcoKSQ1MVY3M08SUGFqKygwcmNcLSRJNUoxdkRVU2dGXi8rOEw9N14/NGlKSFtJXE1OT0<br>
<span class="lineno">305</span>pbXF1eX1VmZ2hpamtsbW5vYnN0dXZ3eHl6e3x//aAAwDAQACEQMRAD8A9VSSSSUpJJJJSkkkJ+Tj<br>
<span class="lineno"></span>1kiy1jCJJDnAcCTykpKkuQ6p/jN6FgmxlNduXawwAzaGH+V6jn/R/wCt71zdn+N/qL3kVYFNYB4N<br>
<span class="lineno"></span>ji6PDVjWpKp9TSXnvTf8bFNjg3qOEa2n6VlLpj/rT/pf567DpX1i6L1hs9Py67X8mqdtg/rUWbbf<br>
<span class="lineno"></span>+gkp0kkkklKSSSSUpJJJJT//0PVUkkklKVLq3WMDpGI7KzrNjADtYNXvI/Mqr/Pd/q9W3vaxjnvM<br>
<span class="lineno"></span>NaCXE9gNSvGPrf8AWS3qmba5jjsJhoB0DAf0NDf6sevf+/lf8Hj0JJATfWT6/dV6oXU1uOLQeKKn<br>
<span class="lineno">310</span>EQP+Hubtfe/+R7Mf/g7f5xcocp++Z11JMCJPgFBxOg7/AOuqDx8I/ikpkXkmSdU8mJIJA/O8EMAy<br>
<span class="lineno"></span>j+mSARB/17pKVXYWHXjsj7yIex0PadzXMO1zT5KHoNA3HT8ietoGhgjsfA+CSnvvqh/jJtqsrwOv<br>
<span class="lineno"></span>2b6NGNzXfTYexzJ+nU7/ALkf4P8Awv6P9KvTQQ4AgyDqCF85Pho3CTB7eHwXoH+LT65uZbX9X+o2<br>
<span class="lineno"></span>bqbPb06551Y4<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7160935">encodedShort</span>&nbsp;<span class="op" id="7160948">:=</span>&nbsp;<span class="ident" id="7160951">strings</span><span class="op" id="7160958">.</span><span class="ident" id="7160959">Replace</span><span class="op" id="7160966">(</span><span class="ident" id="7160967">encoded</span><span class="op" id="7160974">,</span>&nbsp;<span class="string" id="7160976">&#34;\n&#34;</span><span class="op" id="7160980">,</span>&nbsp;<span class="string" id="7160982">&#34;&#34;</span><span class="op" id="7160984">,</span>&nbsp;<span class="op" id="7160986">-</span><span class="num" id="7160987">1</span><span class="op" id="7160988">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7160992">dec</span>&nbsp;<span class="op" id="7160996">:=</span>&nbsp;<span class="ident" id="7160999">NewDecoder</span><span class="op" id="7161009">(</span><span class="ident" id="7161010">StdEncoding</span><span class="op" id="7161021">,</span>&nbsp;<span class="ident" id="7161023">strings</span><span class="op" id="7161030">.</span><span class="ident" id="7161031">NewReader</span><span class="op" id="7161040">(</span><span class="ident" id="7161041">encoded</span><span class="op" id="7161048">)</span><span class="op" id="7161049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7161052">res1</span><span class="op" id="7161056">,</span>&nbsp;<span class="ident" id="7161058">err</span>&nbsp;<span class="op" id="7161062">:=</span>&nbsp;<span class="ident" id="7161065">ioutil</span><span class="op" id="7161071">.</span><span class="ident" id="7161072">ReadAll</span><span class="op" id="7161079">(</span><span class="ident" id="7161080">dec</span><span class="op" id="7161083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7161086">if</span>&nbsp;<span class="ident" id="7161089">err</span>&nbsp;<span class="op" id="7161093">!=</span>&nbsp;<span class="ident" id="7161096">nil</span>&nbsp;<span class="op" id="7161100">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7161104">t</span><span class="op" id="7161105">.</span><span class="ident" id="7161106">Errorf</span><span class="op" id="7161112">(</span><span class="string" id="7161113">&#34;ReadAll&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7161133">,</span>&nbsp;<span class="ident" id="7161135">err</span><span class="op" id="7161138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7161141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7161145">dec</span>&nbsp;<span class="op" id="7161149">=</span>&nbsp;<span class="ident" id="7161151">NewDecoder</span><span class="op" id="7161161">(</span><span class="ident" id="7161162">StdEncoding</span><span class="op" id="7161173">,</span>&nbsp;<span class="ident" id="7161175">strings</span><span class="op" id="7161182">.</span><span class="ident" id="7161183">NewReader</span><span class="op" id="7161192">(</span><span class="ident" id="7161193">encodedShort</span><span class="op" id="7161205">)</span><span class="op" id="7161206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7161209">var</span>&nbsp;<span class="ident" id="7161213">res2</span>&nbsp;<span class="op" id="7161218">[</span><span class="op" id="7161219">]</span><span class="builtintype" id="7161220">byte</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7161226">res2</span><span class="op" id="7161230">,</span>&nbsp;<span class="ident" id="7161232">err</span>&nbsp;<span class="op" id="7161236">=</span>&nbsp;<span class="ident" id="7161238">ioutil</span><span class="op" id="7161244">.</span><span class="ident" id="7161245">ReadAll</span><span class="op" id="7161252">(</span><span class="ident" id="7161253">dec</span><span class="op" id="7161256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7161259">if</span>&nbsp;<span class="ident" id="7161262">err</span>&nbsp;<span class="op" id="7161266">!=</span>&nbsp;<span class="ident" id="7161269">nil</span>&nbsp;<span class="op" id="7161273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7161277">t</span><span class="op" id="7161278">.</span><span class="ident" id="7161279">Errorf</span><span class="op" id="7161285">(</span><span class="string" id="7161286">&#34;ReadAll&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7161306">,</span>&nbsp;<span class="ident" id="7161308">err</span><span class="op" id="7161311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7161314">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7161318">if</span>&nbsp;<span class="op" id="7161321">!</span><span class="ident" id="7161322">bytes</span><span class="op" id="7161327">.</span><span class="ident" id="7161328">Equal</span><span class="op" id="7161333">(</span><span class="ident" id="7161334">res1</span><span class="op" id="7161338">,</span>&nbsp;<span class="ident" id="7161340">res2</span><span class="op" id="7161344">)</span>&nbsp;<span class="op" id="7161346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7161350">t</span><span class="op" id="7161351">.</span><span class="ident" id="7161352">Error</span><span class="op" id="7161357">(</span><span class="string" id="7161358">&#34;Decoded&nbsp;results&nbsp;not&nbsp;equal&#34;</span><span class="op" id="7161385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7161388">}</span><br>
<span class="lineno"></span><span class="op" id="7161390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="keyword" id="7161393">func</span>&nbsp;<span class="ident" id="7161398">TestDecoderIssue7733</span><span class="op" id="7161418">(</span><span class="ident" id="7161419">t</span>&nbsp;<span class="op" id="7161421">*</span><span class="ident" id="7161422">testing</span><span class="op" id="7161429">.</span><span class="ident" id="7161430">T</span><span class="op" id="7161431">)</span>&nbsp;<span class="op" id="7161433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7161436">s</span><span class="op" id="7161437">,</span>&nbsp;<span class="ident" id="7161439">err</span>&nbsp;<span class="op" id="7161443">:=</span>&nbsp;<span class="ident" id="7161446">StdEncoding</span><span class="op" id="7161457">.</span><span class="ident" id="7161458">DecodeString</span><span class="op" id="7161470">(</span><span class="string" id="7161471">&#34;YWJjZA=====&#34;</span><span class="op" id="7161484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7161487">want</span>&nbsp;<span class="op" id="7161492">:=</span>&nbsp;<span class="ident" id="7161495">CorruptInputError</span><span class="op" id="7161512">(</span><span class="num" id="7161513">8</span><span class="op" id="7161514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7161517">if</span>&nbsp;<span class="op" id="7161520">!</span><span class="ident" id="7161521">reflect</span><span class="op" id="7161528">.</span><span class="ident" id="7161529">DeepEqual</span><span class="op" id="7161538">(</span><span class="ident" id="7161539">want</span><span class="op" id="7161543">,</span>&nbsp;<span class="ident" id="7161545">err</span><span class="op" id="7161548">)</span>&nbsp;<span class="op" id="7161550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7161554">t</span><span class="op" id="7161555">.</span><span class="ident" id="7161556">Errorf</span><span class="op" id="7161562">(</span><span class="string" id="7161563">&#34;Error&nbsp;=&nbsp;%v;&nbsp;want&nbsp;CorruptInputError(8)&#34;</span><span class="op" id="7161602">,</span>&nbsp;<span class="ident" id="7161604">err</span><span class="op" id="7161607">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7161610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7161613">if</span>&nbsp;<span class="builtintype" id="7161616">string</span><span class="op" id="7161622">(</span><span class="ident" id="7161623">s</span><span class="op" id="7161624">)</span>&nbsp;<span class="op" id="7161626">!=</span>&nbsp;<span class="string" id="7161629">&#34;abcd&#34;</span>&nbsp;<span class="op" id="7161636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7161640">t</span><span class="op" id="7161641">.</span><span class="ident" id="7161642">Errorf</span><span class="op" id="7161648">(</span><span class="string" id="7161649">&#34;DecodeString&nbsp;=&nbsp;%q;&nbsp;want&nbsp;abcd&#34;</span><span class="op" id="7161679">,</span>&nbsp;<span class="ident" id="7161681">s</span><span class="op" id="7161682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7161685">}</span><br>
<span class="lineno"></span><span class="op" id="7161687">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="keyword" id="7161690">func</span>&nbsp;<span class="ident" id="7161695">BenchmarkEncodeToString</span><span class="op" id="7161718">(</span><span class="ident" id="7161719">b</span>&nbsp;<span class="op" id="7161721">*</span><span class="ident" id="7161722">testing</span><span class="op" id="7161729">.</span><span class="ident" id="7161730">B</span><span class="op" id="7161731">)</span>&nbsp;<span class="op" id="7161733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7161736">data</span>&nbsp;<span class="op" id="7161741">:=</span>&nbsp;<span class="builtinfunc" id="7161744">make</span><span class="op" id="7161748">(</span><span class="op" id="7161749">[</span><span class="op" id="7161750">]</span><span class="builtintype" id="7161751">byte</span><span class="op" id="7161755">,</span>&nbsp;<span class="num" id="7161757">8192</span><span class="op" id="7161761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7161764">b</span><span class="op" id="7161765">.</span><span class="ident" id="7161766">SetBytes</span><span class="op" id="7161774">(</span><span class="ident" id="7161775">int64</span><span class="op" id="7161780">(</span><span class="builtinfunc" id="7161781">len</span><span class="op" id="7161784">(</span><span class="ident" id="7161785">data</span><span class="op" id="7161789">)</span><span class="op" id="7161790">)</span><span class="op" id="7161791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7161794">for</span>&nbsp;<span class="ident" id="7161798">i</span>&nbsp;<span class="op" id="7161800">:=</span>&nbsp;<span class="num" id="7161803">0</span><span class="op" id="7161804">;</span>&nbsp;<span class="ident" id="7161806">i</span>&nbsp;<span class="op" id="7161808">&lt;</span>&nbsp;<span class="ident" id="7161810">b</span><span class="op" id="7161811">.</span><span class="ident" id="7161812">N</span><span class="op" id="7161813">;</span>&nbsp;<span class="ident" id="7161815">i</span><span class="op" id="7161816">++</span>&nbsp;<span class="op" id="7161819">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7161823">StdEncoding</span><span class="op" id="7161834">.</span><span class="ident" id="7161835">EncodeToString</span><span class="op" id="7161849">(</span><span class="ident" id="7161850">data</span><span class="op" id="7161854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7161857">}</span><br>
<span class="lineno"></span><span class="op" id="7161859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7161862">func</span>&nbsp;<span class="ident" id="7161867">BenchmarkDecodeString</span><span class="op" id="7161888">(</span><span class="ident" id="7161889">b</span>&nbsp;<span class="op" id="7161891">*</span><span class="ident" id="7161892">testing</span><span class="op" id="7161899">.</span><span class="ident" id="7161900">B</span><span class="op" id="7161901">)</span>&nbsp;<span class="op" id="7161903">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7161906">data</span>&nbsp;<span class="op" id="7161911">:=</span>&nbsp;<span class="ident" id="7161914">StdEncoding</span><span class="op" id="7161925">.</span><span class="ident" id="7161926">EncodeToString</span><span class="op" id="7161940">(</span><span class="builtinfunc" id="7161941">make</span><span class="op" id="7161945">(</span><span class="op" id="7161946">[</span><span class="op" id="7161947">]</span><span class="builtintype" id="7161948">byte</span><span class="op" id="7161952">,</span>&nbsp;<span class="num" id="7161954">8192</span><span class="op" id="7161958">)</span><span class="op" id="7161959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7161962">b</span><span class="op" id="7161963">.</span><span class="ident" id="7161964">SetBytes</span><span class="op" id="7161972">(</span><span class="ident" id="7161973">int64</span><span class="op" id="7161978">(</span><span class="builtinfunc" id="7161979">len</span><span class="op" id="7161982">(</span><span class="ident" id="7161983">data</span><span class="op" id="7161987">)</span><span class="op" id="7161988">)</span><span class="op" id="7161989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7161992">for</span>&nbsp;<span class="ident" id="7161996">i</span>&nbsp;<span class="op" id="7161998">:=</span>&nbsp;<span class="num" id="7162001">0</span><span class="op" id="7162002">;</span>&nbsp;<span class="ident" id="7162004">i</span>&nbsp;<span class="op" id="7162006">&lt;</span>&nbsp;<span class="ident" id="7162008">b</span><span class="op" id="7162009">.</span><span class="ident" id="7162010">N</span><span class="op" id="7162011">;</span>&nbsp;<span class="ident" id="7162013">i</span><span class="op" id="7162014">++</span>&nbsp;<span class="op" id="7162017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7162021">StdEncoding</span><span class="op" id="7162032">.</span><span class="ident" id="7162033">DecodeString</span><span class="op" id="7162045">(</span><span class="ident" id="7162046">data</span><span class="op" id="7162050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7162053">}</span><br>
<span class="lineno">360</span><span class="op" id="7162055">}</span>
</div>
</body>
</html>
