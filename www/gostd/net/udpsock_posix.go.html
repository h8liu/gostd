<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html" class="current">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3374409">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3374465">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3374519">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3374570">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3374648">package</span>&nbsp;<span class="ident" id="3374656">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3374661">import</span>&nbsp;<span class="op" id="3374668">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3374671">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3374682">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3374689">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3374692">func</span>&nbsp;<span class="ident" id="3374697">sockaddrToUDP</span><span class="op" id="3374710">(</span><span class="ident" id="3374711">sa</span>&nbsp;<span class="ident" id="3374714">syscall</span><span class="op" id="3374721">.</span><span class="ident" id="3374722">Sockaddr</span><span class="op" id="3374730">)</span>&nbsp;<span class="ident" id="3374732">Addr</span>&nbsp;<span class="op" id="3374737">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3374740">switch</span>&nbsp;<span class="ident" id="3374747">sa</span>&nbsp;<span class="op" id="3374750">:=</span>&nbsp;<span class="ident" id="3374753">sa</span><span class="op" id="3374755">.</span><span class="op" id="3374756">(</span><span class="keyword" id="3374757">type</span><span class="op" id="3374761">)</span>&nbsp;<span class="op" id="3374763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3374766">case</span>&nbsp;<span class="op" id="3374771">*</span><span class="ident" id="3374772">syscall</span><span class="op" id="3374779">.</span><span class="ident" id="3374780">SockaddrInet4</span><span class="op" id="3374793">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3374797">return</span>&nbsp;<span class="op" id="3374804">&amp;</span><span class="ident" id="3374805">UDPAddr</span><span class="op" id="3374812">{</span><span class="ident" id="3374813">IP</span><span class="op" id="3374815">:</span>&nbsp;<span class="ident" id="3374817">sa</span><span class="op" id="3374819">.</span><span class="ident" id="3374820">Addr</span><span class="op" id="3374824">[</span><span class="num" id="3374825">0</span><span class="op" id="3374826">:</span><span class="op" id="3374827">]</span><span class="op" id="3374828">,</span>&nbsp;<span class="ident" id="3374830">Port</span><span class="op" id="3374834">:</span>&nbsp;<span class="ident" id="3374836">sa</span><span class="op" id="3374838">.</span><span class="ident" id="3374839">Port</span><span class="op" id="3374843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3374846">case</span>&nbsp;<span class="op" id="3374851">*</span><span class="ident" id="3374852">syscall</span><span class="op" id="3374859">.</span><span class="ident" id="3374860">SockaddrInet6</span><span class="op" id="3374873">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3374877">return</span>&nbsp;<span class="op" id="3374884">&amp;</span><span class="ident" id="3374885">UDPAddr</span><span class="op" id="3374892">{</span><span class="ident" id="3374893">IP</span><span class="op" id="3374895">:</span>&nbsp;<span class="ident" id="3374897">sa</span><span class="op" id="3374899">.</span><span class="ident" id="3374900">Addr</span><span class="op" id="3374904">[</span><span class="num" id="3374905">0</span><span class="op" id="3374906">:</span><span class="op" id="3374907">]</span><span class="op" id="3374908">,</span>&nbsp;<span class="ident" id="3374910">Port</span><span class="op" id="3374914">:</span>&nbsp;<span class="ident" id="3374916">sa</span><span class="op" id="3374918">.</span><span class="ident" id="3374919">Port</span><span class="op" id="3374923">,</span>&nbsp;<span class="ident" id="3374925">Zone</span><span class="op" id="3374929">:</span>&nbsp;<span class="ident" id="3374931">zoneToString</span><span class="op" id="3374943">(</span><span class="builtintype" id="3374944">int</span><span class="op" id="3374947">(</span><span class="ident" id="3374948">sa</span><span class="op" id="3374950">.</span><span class="ident" id="3374951">ZoneId</span><span class="op" id="3374957">)</span><span class="op" id="3374958">)</span><span class="op" id="3374959">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3374962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3374965">return</span>&nbsp;<span class="builtintype" id="3374972">nil</span><br>
<span class="lineno"></span><span class="op" id="3374976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3374979">func</span>&nbsp;<span class="op" id="3374984">(</span><span class="ident" id="3374985">a</span>&nbsp;<span class="op" id="3374987">*</span><span class="ident" id="3374988">UDPAddr</span><span class="op" id="3374995">)</span>&nbsp;<span class="ident" id="3374997">family</span><span class="op" id="3375003">(</span><span class="op" id="3375004">)</span>&nbsp;<span class="builtintype" id="3375006">int</span>&nbsp;<span class="op" id="3375010">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3375013">if</span>&nbsp;<span class="ident" id="3375016">a</span>&nbsp;<span class="op" id="3375018">==</span>&nbsp;<span class="builtintype" id="3375021">nil</span>&nbsp;<span class="op" id="3375025">||</span>&nbsp;<span class="builtinfunc" id="3375028">len</span><span class="op" id="3375031">(</span><span class="ident" id="3375032">a</span><span class="op" id="3375033">.</span><span class="ident" id="3375034">IP</span><span class="op" id="3375036">)</span>&nbsp;<span class="op" id="3375038">&lt;=</span>&nbsp;<span class="ident" id="3375041">IPv4len</span>&nbsp;<span class="op" id="3375049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3375053">return</span>&nbsp;<span class="ident" id="3375060">syscall</span><span class="op" id="3375067">.</span><span class="ident" id="3375068">AF_INET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3375077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3375080">if</span>&nbsp;<span class="ident" id="3375083">a</span><span class="op" id="3375084">.</span><span class="ident" id="3375085">IP</span><span class="op" id="3375087">.</span><span class="ident" id="3375088">To4</span><span class="op" id="3375091">(</span><span class="op" id="3375092">)</span>&nbsp;<span class="op" id="3375094">!=</span>&nbsp;<span class="builtintype" id="3375097">nil</span>&nbsp;<span class="op" id="3375101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3375105">return</span>&nbsp;<span class="ident" id="3375112">syscall</span><span class="op" id="3375119">.</span><span class="ident" id="3375120">AF_INET</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3375129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3375132">return</span>&nbsp;<span class="ident" id="3375139">syscall</span><span class="op" id="3375146">.</span><span class="ident" id="3375147">AF_INET6</span><br>
<span class="lineno"></span><span class="op" id="3375156">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3375159">func</span>&nbsp;<span class="op" id="3375164">(</span><span class="ident" id="3375165">a</span>&nbsp;<span class="op" id="3375167">*</span><span class="ident" id="3375168">UDPAddr</span><span class="op" id="3375175">)</span>&nbsp;<span class="ident" id="3375177">isWildcard</span><span class="op" id="3375187">(</span><span class="op" id="3375188">)</span>&nbsp;<span class="builtintype" id="3375190">bool</span>&nbsp;<span class="op" id="3375195">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3375198">if</span>&nbsp;<span class="ident" id="3375201">a</span>&nbsp;<span class="op" id="3375203">==</span>&nbsp;<span class="builtintype" id="3375206">nil</span>&nbsp;<span class="op" id="3375210">||</span>&nbsp;<span class="ident" id="3375213">a</span><span class="op" id="3375214">.</span><span class="ident" id="3375215">IP</span>&nbsp;<span class="op" id="3375218">==</span>&nbsp;<span class="builtintype" id="3375221">nil</span>&nbsp;<span class="op" id="3375225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3375229">return</span>&nbsp;<span class="builtintype" id="3375236">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3375242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3375245">return</span>&nbsp;<span class="ident" id="3375252">a</span><span class="op" id="3375253">.</span><span class="ident" id="3375254">IP</span><span class="op" id="3375256">.</span><span class="ident" id="3375257">IsUnspecified</span><span class="op" id="3375270">(</span><span class="op" id="3375271">)</span><br>
<span class="lineno"></span><span class="op" id="3375273">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="3375276">func</span>&nbsp;<span class="op" id="3375281">(</span><span class="ident" id="3375282">a</span>&nbsp;<span class="op" id="3375284">*</span><span class="ident" id="3375285">UDPAddr</span><span class="op" id="3375292">)</span>&nbsp;<span class="ident" id="3375294">sockaddr</span><span class="op" id="3375302">(</span><span class="ident" id="3375303">family</span>&nbsp;<span class="builtintype" id="3375310">int</span><span class="op" id="3375313">)</span>&nbsp;<span class="op" id="3375315">(</span><span class="ident" id="3375316">syscall</span><span class="op" id="3375323">.</span><span class="ident" id="3375324">Sockaddr</span><span class="op" id="3375332">,</span>&nbsp;<span class="builtintype" id="3375334">error</span><span class="op" id="3375339">)</span>&nbsp;<span class="op" id="3375341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3375344">if</span>&nbsp;<span class="ident" id="3375347">a</span>&nbsp;<span class="op" id="3375349">==</span>&nbsp;<span class="builtintype" id="3375352">nil</span>&nbsp;<span class="op" id="3375356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3375360">return</span>&nbsp;<span class="builtintype" id="3375367">nil</span><span class="op" id="3375370">,</span>&nbsp;<span class="builtintype" id="3375372">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3375377">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3375380">return</span>&nbsp;<span class="ident" id="3375387">ipToSockaddr</span><span class="op" id="3375399">(</span><span class="ident" id="3375400">family</span><span class="op" id="3375406">,</span>&nbsp;<span class="ident" id="3375408">a</span><span class="op" id="3375409">.</span><span class="ident" id="3375410">IP</span><span class="op" id="3375412">,</span>&nbsp;<span class="ident" id="3375414">a</span><span class="op" id="3375415">.</span><span class="ident" id="3375416">Port</span><span class="op" id="3375420">,</span>&nbsp;<span class="ident" id="3375422">a</span><span class="op" id="3375423">.</span><span class="ident" id="3375424">Zone</span><span class="op" id="3375428">)</span><br>
<span class="lineno"></span><span class="op" id="3375430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3375433">//&nbsp;UDPConn&nbsp;is&nbsp;the&nbsp;implementation&nbsp;of&nbsp;the&nbsp;Conn&nbsp;and&nbsp;PacketConn&nbsp;interfaces</span><br>
<span class="lineno"></span><span class="comment" id="3375504">//&nbsp;for&nbsp;UDP&nbsp;network&nbsp;connections.</span><br>
<span class="lineno">50</span><span class="keyword" id="3375536">type</span>&nbsp;<span class="ident" id="3375541">UDPConn</span>&nbsp;<span class="keyword" id="3375549">struct</span>&nbsp;<span class="op" id="3375556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3375559">conn</span><br>
<span class="lineno"></span><span class="op" id="3375564">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3375567">func</span>&nbsp;<span class="ident" id="3375572">newUDPConn</span><span class="op" id="3375582">(</span><span class="ident" id="3375583">fd</span>&nbsp;<span class="op" id="3375586">*</span><span class="ident" id="3375587">netFD</span><span class="op" id="3375592">)</span>&nbsp;<span class="op" id="3375594">*</span><span class="ident" id="3375595">UDPConn</span>&nbsp;<span class="op" id="3375603">{</span>&nbsp;<span class="keyword" id="3375605">return</span>&nbsp;<span class="op" id="3375612">&amp;</span><span class="ident" id="3375613">UDPConn</span><span class="op" id="3375620">{</span><span class="ident" id="3375621">conn</span><span class="op" id="3375625">{</span><span class="ident" id="3375626">fd</span><span class="op" id="3375628">}</span><span class="op" id="3375629">}</span>&nbsp;<span class="op" id="3375631">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="3375634">//&nbsp;ReadFromUDP&nbsp;reads&nbsp;a&nbsp;UDP&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="3375704">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b&nbsp;and&nbsp;the&nbsp;return&nbsp;address</span><br>
<span class="lineno"></span><span class="comment" id="3375775">//&nbsp;that&nbsp;was&nbsp;on&nbsp;the&nbsp;packet.</span><br>
<span class="lineno"></span><span class="comment" id="3375802">//</span><br>
<span class="lineno">60</span><span class="comment" id="3375805">//&nbsp;ReadFromUDP&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="3375869">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3375936">//&nbsp;SetReadDeadline.</span><br>
<span class="lineno"></span><span class="keyword" id="3375956">func</span>&nbsp;<span class="op" id="3375961">(</span><span class="ident" id="3375962">c</span>&nbsp;<span class="op" id="3375964">*</span><span class="ident" id="3375965">UDPConn</span><span class="op" id="3375972">)</span>&nbsp;<span class="ident" id="3375974">ReadFromUDP</span><span class="op" id="3375985">(</span><span class="ident" id="3375986">b</span>&nbsp;<span class="op" id="3375988">[</span><span class="op" id="3375989">]</span><span class="builtintype" id="3375990">byte</span><span class="op" id="3375994">)</span>&nbsp;<span class="op" id="3375996">(</span><span class="ident" id="3375997">n</span>&nbsp;<span class="builtintype" id="3375999">int</span><span class="op" id="3376002">,</span>&nbsp;<span class="ident" id="3376004">addr</span>&nbsp;<span class="op" id="3376009">*</span><span class="ident" id="3376010">UDPAddr</span><span class="op" id="3376017">,</span>&nbsp;<span class="ident" id="3376019">err</span>&nbsp;<span class="builtintype" id="3376023">error</span><span class="op" id="3376028">)</span>&nbsp;<span class="op" id="3376030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3376033">if</span>&nbsp;<span class="op" id="3376036">!</span><span class="ident" id="3376037">c</span><span class="op" id="3376038">.</span><span class="ident" id="3376039">ok</span><span class="op" id="3376041">(</span><span class="op" id="3376042">)</span>&nbsp;<span class="op" id="3376044">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3376048">return</span>&nbsp;<span class="num" id="3376055">0</span><span class="op" id="3376056">,</span>&nbsp;<span class="builtintype" id="3376058">nil</span><span class="op" id="3376061">,</span>&nbsp;<span class="ident" id="3376063">syscall</span><span class="op" id="3376070">.</span><span class="ident" id="3376071">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3376079">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3376082">n</span><span class="op" id="3376083">,</span>&nbsp;<span class="ident" id="3376085">sa</span><span class="op" id="3376087">,</span>&nbsp;<span class="ident" id="3376089">err</span>&nbsp;<span class="op" id="3376093">:=</span>&nbsp;<span class="ident" id="3376096">c</span><span class="op" id="3376097">.</span><span class="ident" id="3376098">fd</span><span class="op" id="3376100">.</span><span class="ident" id="3376101">readFrom</span><span class="op" id="3376109">(</span><span class="ident" id="3376110">b</span><span class="op" id="3376111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3376114">switch</span>&nbsp;<span class="ident" id="3376121">sa</span>&nbsp;<span class="op" id="3376124">:=</span>&nbsp;<span class="ident" id="3376127">sa</span><span class="op" id="3376129">.</span><span class="op" id="3376130">(</span><span class="keyword" id="3376131">type</span><span class="op" id="3376135">)</span>&nbsp;<span class="op" id="3376137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3376140">case</span>&nbsp;<span class="op" id="3376145">*</span><span class="ident" id="3376146">syscall</span><span class="op" id="3376153">.</span><span class="ident" id="3376154">SockaddrInet4</span><span class="op" id="3376167">:</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3376171">addr</span>&nbsp;<span class="op" id="3376176">=</span>&nbsp;<span class="op" id="3376178">&amp;</span><span class="ident" id="3376179">UDPAddr</span><span class="op" id="3376186">{</span><span class="ident" id="3376187">IP</span><span class="op" id="3376189">:</span>&nbsp;<span class="ident" id="3376191">sa</span><span class="op" id="3376193">.</span><span class="ident" id="3376194">Addr</span><span class="op" id="3376198">[</span><span class="num" id="3376199">0</span><span class="op" id="3376200">:</span><span class="op" id="3376201">]</span><span class="op" id="3376202">,</span>&nbsp;<span class="ident" id="3376204">Port</span><span class="op" id="3376208">:</span>&nbsp;<span class="ident" id="3376210">sa</span><span class="op" id="3376212">.</span><span class="ident" id="3376213">Port</span><span class="op" id="3376217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3376220">case</span>&nbsp;<span class="op" id="3376225">*</span><span class="ident" id="3376226">syscall</span><span class="op" id="3376233">.</span><span class="ident" id="3376234">SockaddrInet6</span><span class="op" id="3376247">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3376251">addr</span>&nbsp;<span class="op" id="3376256">=</span>&nbsp;<span class="op" id="3376258">&amp;</span><span class="ident" id="3376259">UDPAddr</span><span class="op" id="3376266">{</span><span class="ident" id="3376267">IP</span><span class="op" id="3376269">:</span>&nbsp;<span class="ident" id="3376271">sa</span><span class="op" id="3376273">.</span><span class="ident" id="3376274">Addr</span><span class="op" id="3376278">[</span><span class="num" id="3376279">0</span><span class="op" id="3376280">:</span><span class="op" id="3376281">]</span><span class="op" id="3376282">,</span>&nbsp;<span class="ident" id="3376284">Port</span><span class="op" id="3376288">:</span>&nbsp;<span class="ident" id="3376290">sa</span><span class="op" id="3376292">.</span><span class="ident" id="3376293">Port</span><span class="op" id="3376297">,</span>&nbsp;<span class="ident" id="3376299">Zone</span><span class="op" id="3376303">:</span>&nbsp;<span class="ident" id="3376305">zoneToString</span><span class="op" id="3376317">(</span><span class="builtintype" id="3376318">int</span><span class="op" id="3376321">(</span><span class="ident" id="3376322">sa</span><span class="op" id="3376324">.</span><span class="ident" id="3376325">ZoneId</span><span class="op" id="3376331">)</span><span class="op" id="3376332">)</span><span class="op" id="3376333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3376336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3376339">return</span><br>
<span class="lineno">75</span><span class="op" id="3376346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3376349">//&nbsp;ReadFrom&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;ReadFrom&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="3376404">func</span>&nbsp;<span class="op" id="3376409">(</span><span class="ident" id="3376410">c</span>&nbsp;<span class="op" id="3376412">*</span><span class="ident" id="3376413">UDPConn</span><span class="op" id="3376420">)</span>&nbsp;<span class="ident" id="3376422">ReadFrom</span><span class="op" id="3376430">(</span><span class="ident" id="3376431">b</span>&nbsp;<span class="op" id="3376433">[</span><span class="op" id="3376434">]</span><span class="builtintype" id="3376435">byte</span><span class="op" id="3376439">)</span>&nbsp;<span class="op" id="3376441">(</span><span class="builtintype" id="3376442">int</span><span class="op" id="3376445">,</span>&nbsp;<span class="ident" id="3376447">Addr</span><span class="op" id="3376451">,</span>&nbsp;<span class="builtintype" id="3376453">error</span><span class="op" id="3376458">)</span>&nbsp;<span class="op" id="3376460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3376463">if</span>&nbsp;<span class="op" id="3376466">!</span><span class="ident" id="3376467">c</span><span class="op" id="3376468">.</span><span class="ident" id="3376469">ok</span><span class="op" id="3376471">(</span><span class="op" id="3376472">)</span>&nbsp;<span class="op" id="3376474">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3376478">return</span>&nbsp;<span class="num" id="3376485">0</span><span class="op" id="3376486">,</span>&nbsp;<span class="builtintype" id="3376488">nil</span><span class="op" id="3376491">,</span>&nbsp;<span class="ident" id="3376493">syscall</span><span class="op" id="3376500">.</span><span class="ident" id="3376501">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3376509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3376512">n</span><span class="op" id="3376513">,</span>&nbsp;<span class="ident" id="3376515">addr</span><span class="op" id="3376519">,</span>&nbsp;<span class="ident" id="3376521">err</span>&nbsp;<span class="op" id="3376525">:=</span>&nbsp;<span class="ident" id="3376528">c</span><span class="op" id="3376529">.</span><span class="ident" id="3376530">ReadFromUDP</span><span class="op" id="3376541">(</span><span class="ident" id="3376542">b</span><span class="op" id="3376543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3376546">return</span>&nbsp;<span class="ident" id="3376553">n</span><span class="op" id="3376554">,</span>&nbsp;<span class="ident" id="3376556">addr</span><span class="op" id="3376560">.</span><span class="ident" id="3376561">toAddr</span><span class="op" id="3376567">(</span><span class="op" id="3376568">)</span><span class="op" id="3376569">,</span>&nbsp;<span class="ident" id="3376571">err</span><br>
<span class="lineno"></span><span class="op" id="3376575">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="3376578">//&nbsp;ReadMsgUDP&nbsp;reads&nbsp;a&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3376646">//&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;into&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="3376714">//&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b,&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;oob,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3376782">//&nbsp;flags&nbsp;that&nbsp;were&nbsp;set&nbsp;on&nbsp;the&nbsp;packet&nbsp;and&nbsp;the&nbsp;source&nbsp;address&nbsp;of&nbsp;the</span><br>
<span class="lineno">90</span><span class="comment" id="3376849">//&nbsp;packet.</span><br>
<span class="lineno"></span><span class="keyword" id="3376860">func</span>&nbsp;<span class="op" id="3376865">(</span><span class="ident" id="3376866">c</span>&nbsp;<span class="op" id="3376868">*</span><span class="ident" id="3376869">UDPConn</span><span class="op" id="3376876">)</span>&nbsp;<span class="ident" id="3376878">ReadMsgUDP</span><span class="op" id="3376888">(</span><span class="ident" id="3376889">b</span><span class="op" id="3376890">,</span>&nbsp;<span class="ident" id="3376892">oob</span>&nbsp;<span class="op" id="3376896">[</span><span class="op" id="3376897">]</span><span class="builtintype" id="3376898">byte</span><span class="op" id="3376902">)</span>&nbsp;<span class="op" id="3376904">(</span><span class="ident" id="3376905">n</span><span class="op" id="3376906">,</span>&nbsp;<span class="ident" id="3376908">oobn</span><span class="op" id="3376912">,</span>&nbsp;<span class="ident" id="3376914">flags</span>&nbsp;<span class="builtintype" id="3376920">int</span><span class="op" id="3376923">,</span>&nbsp;<span class="ident" id="3376925">addr</span>&nbsp;<span class="op" id="3376930">*</span><span class="ident" id="3376931">UDPAddr</span><span class="op" id="3376938">,</span>&nbsp;<span class="ident" id="3376940">err</span>&nbsp;<span class="builtintype" id="3376944">error</span><span class="op" id="3376949">)</span>&nbsp;<span class="op" id="3376951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3376954">if</span>&nbsp;<span class="op" id="3376957">!</span><span class="ident" id="3376958">c</span><span class="op" id="3376959">.</span><span class="ident" id="3376960">ok</span><span class="op" id="3376962">(</span><span class="op" id="3376963">)</span>&nbsp;<span class="op" id="3376965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3376969">return</span>&nbsp;<span class="num" id="3376976">0</span><span class="op" id="3376977">,</span>&nbsp;<span class="num" id="3376979">0</span><span class="op" id="3376980">,</span>&nbsp;<span class="num" id="3376982">0</span><span class="op" id="3376983">,</span>&nbsp;<span class="builtintype" id="3376985">nil</span><span class="op" id="3376988">,</span>&nbsp;<span class="ident" id="3376990">syscall</span><span class="op" id="3376997">.</span><span class="ident" id="3376998">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3377006">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3377009">var</span>&nbsp;<span class="ident" id="3377013">sa</span>&nbsp;<span class="ident" id="3377016">syscall</span><span class="op" id="3377023">.</span><span class="ident" id="3377024">Sockaddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3377034">n</span><span class="op" id="3377035">,</span>&nbsp;<span class="ident" id="3377037">oobn</span><span class="op" id="3377041">,</span>&nbsp;<span class="ident" id="3377043">flags</span><span class="op" id="3377048">,</span>&nbsp;<span class="ident" id="3377050">sa</span><span class="op" id="3377052">,</span>&nbsp;<span class="ident" id="3377054">err</span>&nbsp;<span class="op" id="3377058">=</span>&nbsp;<span class="ident" id="3377060">c</span><span class="op" id="3377061">.</span><span class="ident" id="3377062">fd</span><span class="op" id="3377064">.</span><span class="ident" id="3377065">readMsg</span><span class="op" id="3377072">(</span><span class="ident" id="3377073">b</span><span class="op" id="3377074">,</span>&nbsp;<span class="ident" id="3377076">oob</span><span class="op" id="3377079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3377082">switch</span>&nbsp;<span class="ident" id="3377089">sa</span>&nbsp;<span class="op" id="3377092">:=</span>&nbsp;<span class="ident" id="3377095">sa</span><span class="op" id="3377097">.</span><span class="op" id="3377098">(</span><span class="keyword" id="3377099">type</span><span class="op" id="3377103">)</span>&nbsp;<span class="op" id="3377105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3377108">case</span>&nbsp;<span class="op" id="3377113">*</span><span class="ident" id="3377114">syscall</span><span class="op" id="3377121">.</span><span class="ident" id="3377122">SockaddrInet4</span><span class="op" id="3377135">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3377139">addr</span>&nbsp;<span class="op" id="3377144">=</span>&nbsp;<span class="op" id="3377146">&amp;</span><span class="ident" id="3377147">UDPAddr</span><span class="op" id="3377154">{</span><span class="ident" id="3377155">IP</span><span class="op" id="3377157">:</span>&nbsp;<span class="ident" id="3377159">sa</span><span class="op" id="3377161">.</span><span class="ident" id="3377162">Addr</span><span class="op" id="3377166">[</span><span class="num" id="3377167">0</span><span class="op" id="3377168">:</span><span class="op" id="3377169">]</span><span class="op" id="3377170">,</span>&nbsp;<span class="ident" id="3377172">Port</span><span class="op" id="3377176">:</span>&nbsp;<span class="ident" id="3377178">sa</span><span class="op" id="3377180">.</span><span class="ident" id="3377181">Port</span><span class="op" id="3377185">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3377188">case</span>&nbsp;<span class="op" id="3377193">*</span><span class="ident" id="3377194">syscall</span><span class="op" id="3377201">.</span><span class="ident" id="3377202">SockaddrInet6</span><span class="op" id="3377215">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3377219">addr</span>&nbsp;<span class="op" id="3377224">=</span>&nbsp;<span class="op" id="3377226">&amp;</span><span class="ident" id="3377227">UDPAddr</span><span class="op" id="3377234">{</span><span class="ident" id="3377235">IP</span><span class="op" id="3377237">:</span>&nbsp;<span class="ident" id="3377239">sa</span><span class="op" id="3377241">.</span><span class="ident" id="3377242">Addr</span><span class="op" id="3377246">[</span><span class="num" id="3377247">0</span><span class="op" id="3377248">:</span><span class="op" id="3377249">]</span><span class="op" id="3377250">,</span>&nbsp;<span class="ident" id="3377252">Port</span><span class="op" id="3377256">:</span>&nbsp;<span class="ident" id="3377258">sa</span><span class="op" id="3377260">.</span><span class="ident" id="3377261">Port</span><span class="op" id="3377265">,</span>&nbsp;<span class="ident" id="3377267">Zone</span><span class="op" id="3377271">:</span>&nbsp;<span class="ident" id="3377273">zoneToString</span><span class="op" id="3377285">(</span><span class="builtintype" id="3377286">int</span><span class="op" id="3377289">(</span><span class="ident" id="3377290">sa</span><span class="op" id="3377292">.</span><span class="ident" id="3377293">ZoneId</span><span class="op" id="3377299">)</span><span class="op" id="3377300">)</span><span class="op" id="3377301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3377304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3377307">return</span><br>
<span class="lineno"></span><span class="op" id="3377314">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="3377317">//&nbsp;WriteToUDP&nbsp;writes&nbsp;a&nbsp;UDP&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload</span><br>
<span class="lineno"></span><span class="comment" id="3377386">//&nbsp;from&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="3377397">//</span><br>
<span class="lineno"></span><span class="comment" id="3377400">//&nbsp;WriteToUDP&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno">110</span><span class="comment" id="3377463">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3377530">//&nbsp;SetWriteDeadline.&nbsp;&nbsp;On&nbsp;packet-oriented&nbsp;connections,&nbsp;write&nbsp;timeouts</span><br>
<span class="lineno"></span><span class="comment" id="3377599">//&nbsp;are&nbsp;rare.</span><br>
<span class="lineno"></span><span class="keyword" id="3377612">func</span>&nbsp;<span class="op" id="3377617">(</span><span class="ident" id="3377618">c</span>&nbsp;<span class="op" id="3377620">*</span><span class="ident" id="3377621">UDPConn</span><span class="op" id="3377628">)</span>&nbsp;<span class="ident" id="3377630">WriteToUDP</span><span class="op" id="3377640">(</span><span class="ident" id="3377641">b</span>&nbsp;<span class="op" id="3377643">[</span><span class="op" id="3377644">]</span><span class="builtintype" id="3377645">byte</span><span class="op" id="3377649">,</span>&nbsp;<span class="ident" id="3377651">addr</span>&nbsp;<span class="op" id="3377656">*</span><span class="ident" id="3377657">UDPAddr</span><span class="op" id="3377664">)</span>&nbsp;<span class="op" id="3377666">(</span><span class="builtintype" id="3377667">int</span><span class="op" id="3377670">,</span>&nbsp;<span class="builtintype" id="3377672">error</span><span class="op" id="3377677">)</span>&nbsp;<span class="op" id="3377679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3377682">if</span>&nbsp;<span class="op" id="3377685">!</span><span class="ident" id="3377686">c</span><span class="op" id="3377687">.</span><span class="ident" id="3377688">ok</span><span class="op" id="3377690">(</span><span class="op" id="3377691">)</span>&nbsp;<span class="op" id="3377693">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3377697">return</span>&nbsp;<span class="num" id="3377704">0</span><span class="op" id="3377705">,</span>&nbsp;<span class="ident" id="3377707">syscall</span><span class="op" id="3377714">.</span><span class="ident" id="3377715">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3377723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3377726">if</span>&nbsp;<span class="ident" id="3377729">c</span><span class="op" id="3377730">.</span><span class="ident" id="3377731">fd</span><span class="op" id="3377733">.</span><span class="ident" id="3377734">isConnected</span>&nbsp;<span class="op" id="3377746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3377750">return</span>&nbsp;<span class="num" id="3377757">0</span><span class="op" id="3377758">,</span>&nbsp;<span class="op" id="3377760">&amp;</span><span class="ident" id="3377761">OpError</span><span class="op" id="3377768">{</span><span class="string" id="3377769">&#34;write&#34;</span><span class="op" id="3377776">,</span>&nbsp;<span class="ident" id="3377778">c</span><span class="op" id="3377779">.</span><span class="ident" id="3377780">fd</span><span class="op" id="3377782">.</span><span class="ident" id="3377783">net</span><span class="op" id="3377786">,</span>&nbsp;<span class="ident" id="3377788">addr</span><span class="op" id="3377792">,</span>&nbsp;<span class="ident" id="3377794">ErrWriteToConnected</span><span class="op" id="3377813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3377816">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3377819">if</span>&nbsp;<span class="ident" id="3377822">addr</span>&nbsp;<span class="op" id="3377827">==</span>&nbsp;<span class="builtintype" id="3377830">nil</span>&nbsp;<span class="op" id="3377834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3377838">return</span>&nbsp;<span class="num" id="3377845">0</span><span class="op" id="3377846">,</span>&nbsp;<span class="op" id="3377848">&amp;</span><span class="ident" id="3377849">OpError</span><span class="op" id="3377856">{</span><span class="ident" id="3377857">Op</span><span class="op" id="3377859">:</span>&nbsp;<span class="string" id="3377861">&#34;write&#34;</span><span class="op" id="3377868">,</span>&nbsp;<span class="ident" id="3377870">Net</span><span class="op" id="3377873">:</span>&nbsp;<span class="ident" id="3377875">c</span><span class="op" id="3377876">.</span><span class="ident" id="3377877">fd</span><span class="op" id="3377879">.</span><span class="ident" id="3377880">net</span><span class="op" id="3377883">,</span>&nbsp;<span class="ident" id="3377885">Addr</span><span class="op" id="3377889">:</span>&nbsp;<span class="builtintype" id="3377891">nil</span><span class="op" id="3377894">,</span>&nbsp;<span class="ident" id="3377896">Err</span><span class="op" id="3377899">:</span>&nbsp;<span class="ident" id="3377901">errMissingAddress</span><span class="op" id="3377918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3377921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3377924">sa</span><span class="op" id="3377926">,</span>&nbsp;<span class="ident" id="3377928">err</span>&nbsp;<span class="op" id="3377932">:=</span>&nbsp;<span class="ident" id="3377935">addr</span><span class="op" id="3377939">.</span><span class="ident" id="3377940">sockaddr</span><span class="op" id="3377948">(</span><span class="ident" id="3377949">c</span><span class="op" id="3377950">.</span><span class="ident" id="3377951">fd</span><span class="op" id="3377953">.</span><span class="ident" id="3377954">family</span><span class="op" id="3377960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3377963">if</span>&nbsp;<span class="ident" id="3377966">err</span>&nbsp;<span class="op" id="3377970">!=</span>&nbsp;<span class="builtintype" id="3377973">nil</span>&nbsp;<span class="op" id="3377977">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3377981">return</span>&nbsp;<span class="num" id="3377988">0</span><span class="op" id="3377989">,</span>&nbsp;<span class="op" id="3377991">&amp;</span><span class="ident" id="3377992">OpError</span><span class="op" id="3377999">{</span><span class="string" id="3378000">&#34;write&#34;</span><span class="op" id="3378007">,</span>&nbsp;<span class="ident" id="3378009">c</span><span class="op" id="3378010">.</span><span class="ident" id="3378011">fd</span><span class="op" id="3378013">.</span><span class="ident" id="3378014">net</span><span class="op" id="3378017">,</span>&nbsp;<span class="ident" id="3378019">addr</span><span class="op" id="3378023">,</span>&nbsp;<span class="ident" id="3378025">err</span><span class="op" id="3378028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3378031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3378034">return</span>&nbsp;<span class="ident" id="3378041">c</span><span class="op" id="3378042">.</span><span class="ident" id="3378043">fd</span><span class="op" id="3378045">.</span><span class="ident" id="3378046">writeTo</span><span class="op" id="3378053">(</span><span class="ident" id="3378054">b</span><span class="op" id="3378055">,</span>&nbsp;<span class="ident" id="3378057">sa</span><span class="op" id="3378059">)</span><br>
<span class="lineno"></span><span class="op" id="3378061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="3378064">//&nbsp;WriteTo&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;WriteTo&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="3378117">func</span>&nbsp;<span class="op" id="3378122">(</span><span class="ident" id="3378123">c</span>&nbsp;<span class="op" id="3378125">*</span><span class="ident" id="3378126">UDPConn</span><span class="op" id="3378133">)</span>&nbsp;<span class="ident" id="3378135">WriteTo</span><span class="op" id="3378142">(</span><span class="ident" id="3378143">b</span>&nbsp;<span class="op" id="3378145">[</span><span class="op" id="3378146">]</span><span class="builtintype" id="3378147">byte</span><span class="op" id="3378151">,</span>&nbsp;<span class="ident" id="3378153">addr</span>&nbsp;<span class="ident" id="3378158">Addr</span><span class="op" id="3378162">)</span>&nbsp;<span class="op" id="3378164">(</span><span class="builtintype" id="3378165">int</span><span class="op" id="3378168">,</span>&nbsp;<span class="builtintype" id="3378170">error</span><span class="op" id="3378175">)</span>&nbsp;<span class="op" id="3378177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3378180">if</span>&nbsp;<span class="op" id="3378183">!</span><span class="ident" id="3378184">c</span><span class="op" id="3378185">.</span><span class="ident" id="3378186">ok</span><span class="op" id="3378188">(</span><span class="op" id="3378189">)</span>&nbsp;<span class="op" id="3378191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3378195">return</span>&nbsp;<span class="num" id="3378202">0</span><span class="op" id="3378203">,</span>&nbsp;<span class="ident" id="3378205">syscall</span><span class="op" id="3378212">.</span><span class="ident" id="3378213">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3378221">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3378224">a</span><span class="op" id="3378225">,</span>&nbsp;<span class="ident" id="3378227">ok</span>&nbsp;<span class="op" id="3378230">:=</span>&nbsp;<span class="ident" id="3378233">addr</span><span class="op" id="3378237">.</span><span class="op" id="3378238">(</span><span class="op" id="3378239">*</span><span class="ident" id="3378240">UDPAddr</span><span class="op" id="3378247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3378250">if</span>&nbsp;<span class="op" id="3378253">!</span><span class="ident" id="3378254">ok</span>&nbsp;<span class="op" id="3378257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3378261">return</span>&nbsp;<span class="num" id="3378268">0</span><span class="op" id="3378269">,</span>&nbsp;<span class="op" id="3378271">&amp;</span><span class="ident" id="3378272">OpError</span><span class="op" id="3378279">{</span><span class="string" id="3378280">&#34;write&#34;</span><span class="op" id="3378287">,</span>&nbsp;<span class="ident" id="3378289">c</span><span class="op" id="3378290">.</span><span class="ident" id="3378291">fd</span><span class="op" id="3378293">.</span><span class="ident" id="3378294">net</span><span class="op" id="3378297">,</span>&nbsp;<span class="ident" id="3378299">addr</span><span class="op" id="3378303">,</span>&nbsp;<span class="ident" id="3378305">syscall</span><span class="op" id="3378312">.</span><span class="ident" id="3378313">EINVAL</span><span class="op" id="3378319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3378322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3378325">return</span>&nbsp;<span class="ident" id="3378332">c</span><span class="op" id="3378333">.</span><span class="ident" id="3378334">WriteToUDP</span><span class="op" id="3378344">(</span><span class="ident" id="3378345">b</span><span class="op" id="3378346">,</span>&nbsp;<span class="ident" id="3378348">a</span><span class="op" id="3378349">)</span><br>
<span class="lineno">140</span><span class="op" id="3378351">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3378354">//&nbsp;WriteMsgUDP&nbsp;writes&nbsp;a&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="3378425">//&nbsp;b&nbsp;and&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;from&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3378492">//&nbsp;number&nbsp;of&nbsp;payload&nbsp;and&nbsp;out-of-band&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">145</span><span class="keyword" id="3378544">func</span>&nbsp;<span class="op" id="3378549">(</span><span class="ident" id="3378550">c</span>&nbsp;<span class="op" id="3378552">*</span><span class="ident" id="3378553">UDPConn</span><span class="op" id="3378560">)</span>&nbsp;<span class="ident" id="3378562">WriteMsgUDP</span><span class="op" id="3378573">(</span><span class="ident" id="3378574">b</span><span class="op" id="3378575">,</span>&nbsp;<span class="ident" id="3378577">oob</span>&nbsp;<span class="op" id="3378581">[</span><span class="op" id="3378582">]</span><span class="builtintype" id="3378583">byte</span><span class="op" id="3378587">,</span>&nbsp;<span class="ident" id="3378589">addr</span>&nbsp;<span class="op" id="3378594">*</span><span class="ident" id="3378595">UDPAddr</span><span class="op" id="3378602">)</span>&nbsp;<span class="op" id="3378604">(</span><span class="ident" id="3378605">n</span><span class="op" id="3378606">,</span>&nbsp;<span class="ident" id="3378608">oobn</span>&nbsp;<span class="builtintype" id="3378613">int</span><span class="op" id="3378616">,</span>&nbsp;<span class="ident" id="3378618">err</span>&nbsp;<span class="builtintype" id="3378622">error</span><span class="op" id="3378627">)</span>&nbsp;<span class="op" id="3378629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3378632">if</span>&nbsp;<span class="op" id="3378635">!</span><span class="ident" id="3378636">c</span><span class="op" id="3378637">.</span><span class="ident" id="3378638">ok</span><span class="op" id="3378640">(</span><span class="op" id="3378641">)</span>&nbsp;<span class="op" id="3378643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3378647">return</span>&nbsp;<span class="num" id="3378654">0</span><span class="op" id="3378655">,</span>&nbsp;<span class="num" id="3378657">0</span><span class="op" id="3378658">,</span>&nbsp;<span class="ident" id="3378660">syscall</span><span class="op" id="3378667">.</span><span class="ident" id="3378668">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3378676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3378679">if</span>&nbsp;<span class="ident" id="3378682">c</span><span class="op" id="3378683">.</span><span class="ident" id="3378684">fd</span><span class="op" id="3378686">.</span><span class="ident" id="3378687">isConnected</span>&nbsp;<span class="op" id="3378699">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3378703">return</span>&nbsp;<span class="num" id="3378710">0</span><span class="op" id="3378711">,</span>&nbsp;<span class="num" id="3378713">0</span><span class="op" id="3378714">,</span>&nbsp;<span class="op" id="3378716">&amp;</span><span class="ident" id="3378717">OpError</span><span class="op" id="3378724">{</span><span class="string" id="3378725">&#34;write&#34;</span><span class="op" id="3378732">,</span>&nbsp;<span class="ident" id="3378734">c</span><span class="op" id="3378735">.</span><span class="ident" id="3378736">fd</span><span class="op" id="3378738">.</span><span class="ident" id="3378739">net</span><span class="op" id="3378742">,</span>&nbsp;<span class="ident" id="3378744">addr</span><span class="op" id="3378748">,</span>&nbsp;<span class="ident" id="3378750">ErrWriteToConnected</span><span class="op" id="3378769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3378772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3378775">if</span>&nbsp;<span class="ident" id="3378778">addr</span>&nbsp;<span class="op" id="3378783">==</span>&nbsp;<span class="builtintype" id="3378786">nil</span>&nbsp;<span class="op" id="3378790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3378794">return</span>&nbsp;<span class="num" id="3378801">0</span><span class="op" id="3378802">,</span>&nbsp;<span class="num" id="3378804">0</span><span class="op" id="3378805">,</span>&nbsp;<span class="op" id="3378807">&amp;</span><span class="ident" id="3378808">OpError</span><span class="op" id="3378815">{</span><span class="ident" id="3378816">Op</span><span class="op" id="3378818">:</span>&nbsp;<span class="string" id="3378820">&#34;write&#34;</span><span class="op" id="3378827">,</span>&nbsp;<span class="ident" id="3378829">Net</span><span class="op" id="3378832">:</span>&nbsp;<span class="ident" id="3378834">c</span><span class="op" id="3378835">.</span><span class="ident" id="3378836">fd</span><span class="op" id="3378838">.</span><span class="ident" id="3378839">net</span><span class="op" id="3378842">,</span>&nbsp;<span class="ident" id="3378844">Addr</span><span class="op" id="3378848">:</span>&nbsp;<span class="builtintype" id="3378850">nil</span><span class="op" id="3378853">,</span>&nbsp;<span class="ident" id="3378855">Err</span><span class="op" id="3378858">:</span>&nbsp;<span class="ident" id="3378860">errMissingAddress</span><span class="op" id="3378877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3378880">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3378883">sa</span><span class="op" id="3378885">,</span>&nbsp;<span class="ident" id="3378887">err</span>&nbsp;<span class="op" id="3378891">:=</span>&nbsp;<span class="ident" id="3378894">addr</span><span class="op" id="3378898">.</span><span class="ident" id="3378899">sockaddr</span><span class="op" id="3378907">(</span><span class="ident" id="3378908">c</span><span class="op" id="3378909">.</span><span class="ident" id="3378910">fd</span><span class="op" id="3378912">.</span><span class="ident" id="3378913">family</span><span class="op" id="3378919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3378922">if</span>&nbsp;<span class="ident" id="3378925">err</span>&nbsp;<span class="op" id="3378929">!=</span>&nbsp;<span class="builtintype" id="3378932">nil</span>&nbsp;<span class="op" id="3378936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3378940">return</span>&nbsp;<span class="num" id="3378947">0</span><span class="op" id="3378948">,</span>&nbsp;<span class="num" id="3378950">0</span><span class="op" id="3378951">,</span>&nbsp;<span class="op" id="3378953">&amp;</span><span class="ident" id="3378954">OpError</span><span class="op" id="3378961">{</span><span class="string" id="3378962">&#34;write&#34;</span><span class="op" id="3378969">,</span>&nbsp;<span class="ident" id="3378971">c</span><span class="op" id="3378972">.</span><span class="ident" id="3378973">fd</span><span class="op" id="3378975">.</span><span class="ident" id="3378976">net</span><span class="op" id="3378979">,</span>&nbsp;<span class="ident" id="3378981">addr</span><span class="op" id="3378985">,</span>&nbsp;<span class="ident" id="3378987">err</span><span class="op" id="3378990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3378993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3378996">return</span>&nbsp;<span class="ident" id="3379003">c</span><span class="op" id="3379004">.</span><span class="ident" id="3379005">fd</span><span class="op" id="3379007">.</span><span class="ident" id="3379008">writeMsg</span><span class="op" id="3379016">(</span><span class="ident" id="3379017">b</span><span class="op" id="3379018">,</span>&nbsp;<span class="ident" id="3379020">oob</span><span class="op" id="3379023">,</span>&nbsp;<span class="ident" id="3379025">sa</span><span class="op" id="3379027">)</span><br>
<span class="lineno">160</span><span class="op" id="3379029">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3379032">//&nbsp;DialUDP&nbsp;connects&nbsp;to&nbsp;the&nbsp;remote&nbsp;address&nbsp;raddr&nbsp;on&nbsp;the&nbsp;network&nbsp;net,</span><br>
<span class="lineno"></span><span class="comment" id="3379100">//&nbsp;which&nbsp;must&nbsp;be&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;,&nbsp;or&nbsp;&#34;udp6&#34;.&nbsp;&nbsp;If&nbsp;laddr&nbsp;is&nbsp;not&nbsp;nil,&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3379171">//&nbsp;used&nbsp;as&nbsp;the&nbsp;local&nbsp;address&nbsp;for&nbsp;the&nbsp;connection.</span><br>
<span class="lineno">165</span><span class="keyword" id="3379220">func</span>&nbsp;<span class="ident" id="3379225">DialUDP</span><span class="op" id="3379232">(</span><span class="ident" id="3379233">net</span>&nbsp;<span class="builtintype" id="3379237">string</span><span class="op" id="3379243">,</span>&nbsp;<span class="ident" id="3379245">laddr</span><span class="op" id="3379250">,</span>&nbsp;<span class="ident" id="3379252">raddr</span>&nbsp;<span class="op" id="3379258">*</span><span class="ident" id="3379259">UDPAddr</span><span class="op" id="3379266">)</span>&nbsp;<span class="op" id="3379268">(</span><span class="op" id="3379269">*</span><span class="ident" id="3379270">UDPConn</span><span class="op" id="3379277">,</span>&nbsp;<span class="builtintype" id="3379279">error</span><span class="op" id="3379284">)</span>&nbsp;<span class="op" id="3379286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3379289">switch</span>&nbsp;<span class="ident" id="3379296">net</span>&nbsp;<span class="op" id="3379300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3379303">case</span>&nbsp;<span class="string" id="3379308">&#34;udp&#34;</span><span class="op" id="3379313">,</span>&nbsp;<span class="string" id="3379315">&#34;udp4&#34;</span><span class="op" id="3379321">,</span>&nbsp;<span class="string" id="3379323">&#34;udp6&#34;</span><span class="op" id="3379329">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3379332">default</span><span class="op" id="3379339">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3379343">return</span>&nbsp;<span class="builtintype" id="3379350">nil</span><span class="op" id="3379353">,</span>&nbsp;<span class="op" id="3379355">&amp;</span><span class="ident" id="3379356">OpError</span><span class="op" id="3379363">{</span><span class="ident" id="3379364">Op</span><span class="op" id="3379366">:</span>&nbsp;<span class="string" id="3379368">&#34;dial&#34;</span><span class="op" id="3379374">,</span>&nbsp;<span class="ident" id="3379376">Net</span><span class="op" id="3379379">:</span>&nbsp;<span class="ident" id="3379381">net</span><span class="op" id="3379384">,</span>&nbsp;<span class="ident" id="3379386">Addr</span><span class="op" id="3379390">:</span>&nbsp;<span class="ident" id="3379392">raddr</span><span class="op" id="3379397">,</span>&nbsp;<span class="ident" id="3379399">Err</span><span class="op" id="3379402">:</span>&nbsp;<span class="ident" id="3379404">UnknownNetworkError</span><span class="op" id="3379423">(</span><span class="ident" id="3379424">net</span><span class="op" id="3379427">)</span><span class="op" id="3379428">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3379431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3379434">if</span>&nbsp;<span class="ident" id="3379437">raddr</span>&nbsp;<span class="op" id="3379443">==</span>&nbsp;<span class="builtintype" id="3379446">nil</span>&nbsp;<span class="op" id="3379450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3379454">return</span>&nbsp;<span class="builtintype" id="3379461">nil</span><span class="op" id="3379464">,</span>&nbsp;<span class="op" id="3379466">&amp;</span><span class="ident" id="3379467">OpError</span><span class="op" id="3379474">{</span><span class="ident" id="3379475">Op</span><span class="op" id="3379477">:</span>&nbsp;<span class="string" id="3379479">&#34;dial&#34;</span><span class="op" id="3379485">,</span>&nbsp;<span class="ident" id="3379487">Net</span><span class="op" id="3379490">:</span>&nbsp;<span class="ident" id="3379492">net</span><span class="op" id="3379495">,</span>&nbsp;<span class="ident" id="3379497">Addr</span><span class="op" id="3379501">:</span>&nbsp;<span class="builtintype" id="3379503">nil</span><span class="op" id="3379506">,</span>&nbsp;<span class="ident" id="3379508">Err</span><span class="op" id="3379511">:</span>&nbsp;<span class="ident" id="3379513">errMissingAddress</span><span class="op" id="3379530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3379533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3379536">return</span>&nbsp;<span class="ident" id="3379543">dialUDP</span><span class="op" id="3379550">(</span><span class="ident" id="3379551">net</span><span class="op" id="3379554">,</span>&nbsp;<span class="ident" id="3379556">laddr</span><span class="op" id="3379561">,</span>&nbsp;<span class="ident" id="3379563">raddr</span><span class="op" id="3379568">,</span>&nbsp;<span class="ident" id="3379570">noDeadline</span><span class="op" id="3379580">)</span><br>
<span class="lineno">175</span><span class="op" id="3379582">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3379585">func</span>&nbsp;<span class="ident" id="3379590">dialUDP</span><span class="op" id="3379597">(</span><span class="ident" id="3379598">net</span>&nbsp;<span class="builtintype" id="3379602">string</span><span class="op" id="3379608">,</span>&nbsp;<span class="ident" id="3379610">laddr</span><span class="op" id="3379615">,</span>&nbsp;<span class="ident" id="3379617">raddr</span>&nbsp;<span class="op" id="3379623">*</span><span class="ident" id="3379624">UDPAddr</span><span class="op" id="3379631">,</span>&nbsp;<span class="ident" id="3379633">deadline</span>&nbsp;<span class="ident" id="3379642">time</span><span class="op" id="3379646">.</span><span class="ident" id="3379647">Time</span><span class="op" id="3379651">)</span>&nbsp;<span class="op" id="3379653">(</span><span class="op" id="3379654">*</span><span class="ident" id="3379655">UDPConn</span><span class="op" id="3379662">,</span>&nbsp;<span class="builtintype" id="3379664">error</span><span class="op" id="3379669">)</span>&nbsp;<span class="op" id="3379671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3379674">fd</span><span class="op" id="3379676">,</span>&nbsp;<span class="ident" id="3379678">err</span>&nbsp;<span class="op" id="3379682">:=</span>&nbsp;<span class="ident" id="3379685">internetSocket</span><span class="op" id="3379699">(</span><span class="ident" id="3379700">net</span><span class="op" id="3379703">,</span>&nbsp;<span class="ident" id="3379705">laddr</span><span class="op" id="3379710">,</span>&nbsp;<span class="ident" id="3379712">raddr</span><span class="op" id="3379717">,</span>&nbsp;<span class="ident" id="3379719">deadline</span><span class="op" id="3379727">,</span>&nbsp;<span class="ident" id="3379729">syscall</span><span class="op" id="3379736">.</span><span class="ident" id="3379737">SOCK_DGRAM</span><span class="op" id="3379747">,</span>&nbsp;<span class="num" id="3379749">0</span><span class="op" id="3379750">,</span>&nbsp;<span class="string" id="3379752">&#34;dial&#34;</span><span class="op" id="3379758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3379761">if</span>&nbsp;<span class="ident" id="3379764">err</span>&nbsp;<span class="op" id="3379768">!=</span>&nbsp;<span class="builtintype" id="3379771">nil</span>&nbsp;<span class="op" id="3379775">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3379779">return</span>&nbsp;<span class="builtintype" id="3379786">nil</span><span class="op" id="3379789">,</span>&nbsp;<span class="op" id="3379791">&amp;</span><span class="ident" id="3379792">OpError</span><span class="op" id="3379799">{</span><span class="ident" id="3379800">Op</span><span class="op" id="3379802">:</span>&nbsp;<span class="string" id="3379804">&#34;dial&#34;</span><span class="op" id="3379810">,</span>&nbsp;<span class="ident" id="3379812">Net</span><span class="op" id="3379815">:</span>&nbsp;<span class="ident" id="3379817">net</span><span class="op" id="3379820">,</span>&nbsp;<span class="ident" id="3379822">Addr</span><span class="op" id="3379826">:</span>&nbsp;<span class="ident" id="3379828">raddr</span><span class="op" id="3379833">,</span>&nbsp;<span class="ident" id="3379835">Err</span><span class="op" id="3379838">:</span>&nbsp;<span class="ident" id="3379840">err</span><span class="op" id="3379843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3379846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3379849">return</span>&nbsp;<span class="ident" id="3379856">newUDPConn</span><span class="op" id="3379866">(</span><span class="ident" id="3379867">fd</span><span class="op" id="3379869">)</span><span class="op" id="3379870">,</span>&nbsp;<span class="builtintype" id="3379872">nil</span><br>
<span class="lineno"></span><span class="op" id="3379876">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="3379879">//&nbsp;ListenUDP&nbsp;listens&nbsp;for&nbsp;incoming&nbsp;UDP&nbsp;packets&nbsp;addressed&nbsp;to&nbsp;the&nbsp;local</span><br>
<span class="lineno"></span><span class="comment" id="3379948">//&nbsp;address&nbsp;laddr.&nbsp;&nbsp;Net&nbsp;must&nbsp;be&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;,&nbsp;or&nbsp;&#34;udp6&#34;.&nbsp;&nbsp;If&nbsp;laddr&nbsp;has</span><br>
<span class="lineno"></span><span class="comment" id="3380019">//&nbsp;a&nbsp;port&nbsp;of&nbsp;0,&nbsp;ListenUDP&nbsp;will&nbsp;choose&nbsp;an&nbsp;available&nbsp;port.</span><br>
<span class="lineno"></span><span class="comment" id="3380076">//&nbsp;The&nbsp;LocalAddr&nbsp;method&nbsp;of&nbsp;the&nbsp;returned&nbsp;UDPConn&nbsp;can&nbsp;be&nbsp;used&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3380139">//&nbsp;discover&nbsp;the&nbsp;port.&nbsp;&nbsp;The&nbsp;returned&nbsp;connection&#39;s&nbsp;ReadFrom&nbsp;and&nbsp;WriteTo</span><br>
<span class="lineno">190</span><span class="comment" id="3380209">//&nbsp;methods&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;receive&nbsp;and&nbsp;send&nbsp;UDP&nbsp;packets&nbsp;with&nbsp;per-packet</span><br>
<span class="lineno"></span><span class="comment" id="3380280">//&nbsp;addressing.</span><br>
<span class="lineno"></span><span class="keyword" id="3380295">func</span>&nbsp;<span class="ident" id="3380300">ListenUDP</span><span class="op" id="3380309">(</span><span class="ident" id="3380310">net</span>&nbsp;<span class="builtintype" id="3380314">string</span><span class="op" id="3380320">,</span>&nbsp;<span class="ident" id="3380322">laddr</span>&nbsp;<span class="op" id="3380328">*</span><span class="ident" id="3380329">UDPAddr</span><span class="op" id="3380336">)</span>&nbsp;<span class="op" id="3380338">(</span><span class="op" id="3380339">*</span><span class="ident" id="3380340">UDPConn</span><span class="op" id="3380347">,</span>&nbsp;<span class="builtintype" id="3380349">error</span><span class="op" id="3380354">)</span>&nbsp;<span class="op" id="3380356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3380359">switch</span>&nbsp;<span class="ident" id="3380366">net</span>&nbsp;<span class="op" id="3380370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3380373">case</span>&nbsp;<span class="string" id="3380378">&#34;udp&#34;</span><span class="op" id="3380383">,</span>&nbsp;<span class="string" id="3380385">&#34;udp4&#34;</span><span class="op" id="3380391">,</span>&nbsp;<span class="string" id="3380393">&#34;udp6&#34;</span><span class="op" id="3380399">:</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3380402">default</span><span class="op" id="3380409">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3380413">return</span>&nbsp;<span class="builtintype" id="3380420">nil</span><span class="op" id="3380423">,</span>&nbsp;<span class="op" id="3380425">&amp;</span><span class="ident" id="3380426">OpError</span><span class="op" id="3380433">{</span><span class="ident" id="3380434">Op</span><span class="op" id="3380436">:</span>&nbsp;<span class="string" id="3380438">&#34;listen&#34;</span><span class="op" id="3380446">,</span>&nbsp;<span class="ident" id="3380448">Net</span><span class="op" id="3380451">:</span>&nbsp;<span class="ident" id="3380453">net</span><span class="op" id="3380456">,</span>&nbsp;<span class="ident" id="3380458">Addr</span><span class="op" id="3380462">:</span>&nbsp;<span class="ident" id="3380464">laddr</span><span class="op" id="3380469">,</span>&nbsp;<span class="ident" id="3380471">Err</span><span class="op" id="3380474">:</span>&nbsp;<span class="ident" id="3380476">UnknownNetworkError</span><span class="op" id="3380495">(</span><span class="ident" id="3380496">net</span><span class="op" id="3380499">)</span><span class="op" id="3380500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3380503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3380506">if</span>&nbsp;<span class="ident" id="3380509">laddr</span>&nbsp;<span class="op" id="3380515">==</span>&nbsp;<span class="builtintype" id="3380518">nil</span>&nbsp;<span class="op" id="3380522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3380526">laddr</span>&nbsp;<span class="op" id="3380532">=</span>&nbsp;<span class="op" id="3380534">&amp;</span><span class="ident" id="3380535">UDPAddr</span><span class="op" id="3380542">{</span><span class="op" id="3380543">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3380546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3380549">fd</span><span class="op" id="3380551">,</span>&nbsp;<span class="ident" id="3380553">err</span>&nbsp;<span class="op" id="3380557">:=</span>&nbsp;<span class="ident" id="3380560">internetSocket</span><span class="op" id="3380574">(</span><span class="ident" id="3380575">net</span><span class="op" id="3380578">,</span>&nbsp;<span class="ident" id="3380580">laddr</span><span class="op" id="3380585">,</span>&nbsp;<span class="builtintype" id="3380587">nil</span><span class="op" id="3380590">,</span>&nbsp;<span class="ident" id="3380592">noDeadline</span><span class="op" id="3380602">,</span>&nbsp;<span class="ident" id="3380604">syscall</span><span class="op" id="3380611">.</span><span class="ident" id="3380612">SOCK_DGRAM</span><span class="op" id="3380622">,</span>&nbsp;<span class="num" id="3380624">0</span><span class="op" id="3380625">,</span>&nbsp;<span class="string" id="3380627">&#34;listen&#34;</span><span class="op" id="3380635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3380638">if</span>&nbsp;<span class="ident" id="3380641">err</span>&nbsp;<span class="op" id="3380645">!=</span>&nbsp;<span class="builtintype" id="3380648">nil</span>&nbsp;<span class="op" id="3380652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3380656">return</span>&nbsp;<span class="builtintype" id="3380663">nil</span><span class="op" id="3380666">,</span>&nbsp;<span class="op" id="3380668">&amp;</span><span class="ident" id="3380669">OpError</span><span class="op" id="3380676">{</span><span class="ident" id="3380677">Op</span><span class="op" id="3380679">:</span>&nbsp;<span class="string" id="3380681">&#34;listen&#34;</span><span class="op" id="3380689">,</span>&nbsp;<span class="ident" id="3380691">Net</span><span class="op" id="3380694">:</span>&nbsp;<span class="ident" id="3380696">net</span><span class="op" id="3380699">,</span>&nbsp;<span class="ident" id="3380701">Addr</span><span class="op" id="3380705">:</span>&nbsp;<span class="ident" id="3380707">laddr</span><span class="op" id="3380712">,</span>&nbsp;<span class="ident" id="3380714">Err</span><span class="op" id="3380717">:</span>&nbsp;<span class="ident" id="3380719">err</span><span class="op" id="3380722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3380725">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3380728">return</span>&nbsp;<span class="ident" id="3380735">newUDPConn</span><span class="op" id="3380745">(</span><span class="ident" id="3380746">fd</span><span class="op" id="3380748">)</span><span class="op" id="3380749">,</span>&nbsp;<span class="builtintype" id="3380751">nil</span><br>
<span class="lineno"></span><span class="op" id="3380755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3380758">//&nbsp;ListenMulticastUDP&nbsp;listens&nbsp;for&nbsp;incoming&nbsp;multicast&nbsp;UDP&nbsp;packets</span><br>
<span class="lineno"></span><span class="comment" id="3380823">//&nbsp;addressed&nbsp;to&nbsp;the&nbsp;group&nbsp;address&nbsp;gaddr&nbsp;on&nbsp;ifi,&nbsp;which&nbsp;specifies&nbsp;the</span><br>
<span class="lineno">210</span><span class="comment" id="3380891">//&nbsp;interface&nbsp;to&nbsp;join.&nbsp;&nbsp;ListenMulticastUDP&nbsp;uses&nbsp;default&nbsp;multicast</span><br>
<span class="lineno"></span><span class="comment" id="3380956">//&nbsp;interface&nbsp;if&nbsp;ifi&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3380984">func</span>&nbsp;<span class="ident" id="3380989">ListenMulticastUDP</span><span class="op" id="3381007">(</span><span class="ident" id="3381008">net</span>&nbsp;<span class="builtintype" id="3381012">string</span><span class="op" id="3381018">,</span>&nbsp;<span class="ident" id="3381020">ifi</span>&nbsp;<span class="op" id="3381024">*</span><span class="ident" id="3381025">Interface</span><span class="op" id="3381034">,</span>&nbsp;<span class="ident" id="3381036">gaddr</span>&nbsp;<span class="op" id="3381042">*</span><span class="ident" id="3381043">UDPAddr</span><span class="op" id="3381050">)</span>&nbsp;<span class="op" id="3381052">(</span><span class="op" id="3381053">*</span><span class="ident" id="3381054">UDPConn</span><span class="op" id="3381061">,</span>&nbsp;<span class="builtintype" id="3381063">error</span><span class="op" id="3381068">)</span>&nbsp;<span class="op" id="3381070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3381073">switch</span>&nbsp;<span class="ident" id="3381080">net</span>&nbsp;<span class="op" id="3381084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3381087">case</span>&nbsp;<span class="string" id="3381092">&#34;udp&#34;</span><span class="op" id="3381097">,</span>&nbsp;<span class="string" id="3381099">&#34;udp4&#34;</span><span class="op" id="3381105">,</span>&nbsp;<span class="string" id="3381107">&#34;udp6&#34;</span><span class="op" id="3381113">:</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3381116">default</span><span class="op" id="3381123">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3381127">return</span>&nbsp;<span class="builtintype" id="3381134">nil</span><span class="op" id="3381137">,</span>&nbsp;<span class="op" id="3381139">&amp;</span><span class="ident" id="3381140">OpError</span><span class="op" id="3381147">{</span><span class="ident" id="3381148">Op</span><span class="op" id="3381150">:</span>&nbsp;<span class="string" id="3381152">&#34;listen&#34;</span><span class="op" id="3381160">,</span>&nbsp;<span class="ident" id="3381162">Net</span><span class="op" id="3381165">:</span>&nbsp;<span class="ident" id="3381167">net</span><span class="op" id="3381170">,</span>&nbsp;<span class="ident" id="3381172">Addr</span><span class="op" id="3381176">:</span>&nbsp;<span class="ident" id="3381178">gaddr</span><span class="op" id="3381183">,</span>&nbsp;<span class="ident" id="3381185">Err</span><span class="op" id="3381188">:</span>&nbsp;<span class="ident" id="3381190">UnknownNetworkError</span><span class="op" id="3381209">(</span><span class="ident" id="3381210">net</span><span class="op" id="3381213">)</span><span class="op" id="3381214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3381217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3381220">if</span>&nbsp;<span class="ident" id="3381223">gaddr</span>&nbsp;<span class="op" id="3381229">==</span>&nbsp;<span class="builtintype" id="3381232">nil</span>&nbsp;<span class="op" id="3381236">||</span>&nbsp;<span class="ident" id="3381239">gaddr</span><span class="op" id="3381244">.</span><span class="ident" id="3381245">IP</span>&nbsp;<span class="op" id="3381248">==</span>&nbsp;<span class="builtintype" id="3381251">nil</span>&nbsp;<span class="op" id="3381255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3381259">return</span>&nbsp;<span class="builtintype" id="3381266">nil</span><span class="op" id="3381269">,</span>&nbsp;<span class="op" id="3381271">&amp;</span><span class="ident" id="3381272">OpError</span><span class="op" id="3381279">{</span><span class="ident" id="3381280">Op</span><span class="op" id="3381282">:</span>&nbsp;<span class="string" id="3381284">&#34;listen&#34;</span><span class="op" id="3381292">,</span>&nbsp;<span class="ident" id="3381294">Net</span><span class="op" id="3381297">:</span>&nbsp;<span class="ident" id="3381299">net</span><span class="op" id="3381302">,</span>&nbsp;<span class="ident" id="3381304">Addr</span><span class="op" id="3381308">:</span>&nbsp;<span class="builtintype" id="3381310">nil</span><span class="op" id="3381313">,</span>&nbsp;<span class="ident" id="3381315">Err</span><span class="op" id="3381318">:</span>&nbsp;<span class="ident" id="3381320">errMissingAddress</span><span class="op" id="3381337">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3381340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3381343">fd</span><span class="op" id="3381345">,</span>&nbsp;<span class="ident" id="3381347">err</span>&nbsp;<span class="op" id="3381351">:=</span>&nbsp;<span class="ident" id="3381354">internetSocket</span><span class="op" id="3381368">(</span><span class="ident" id="3381369">net</span><span class="op" id="3381372">,</span>&nbsp;<span class="ident" id="3381374">gaddr</span><span class="op" id="3381379">,</span>&nbsp;<span class="builtintype" id="3381381">nil</span><span class="op" id="3381384">,</span>&nbsp;<span class="ident" id="3381386">noDeadline</span><span class="op" id="3381396">,</span>&nbsp;<span class="ident" id="3381398">syscall</span><span class="op" id="3381405">.</span><span class="ident" id="3381406">SOCK_DGRAM</span><span class="op" id="3381416">,</span>&nbsp;<span class="num" id="3381418">0</span><span class="op" id="3381419">,</span>&nbsp;<span class="string" id="3381421">&#34;listen&#34;</span><span class="op" id="3381429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3381432">if</span>&nbsp;<span class="ident" id="3381435">err</span>&nbsp;<span class="op" id="3381439">!=</span>&nbsp;<span class="builtintype" id="3381442">nil</span>&nbsp;<span class="op" id="3381446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3381450">return</span>&nbsp;<span class="builtintype" id="3381457">nil</span><span class="op" id="3381460">,</span>&nbsp;<span class="op" id="3381462">&amp;</span><span class="ident" id="3381463">OpError</span><span class="op" id="3381470">{</span><span class="ident" id="3381471">Op</span><span class="op" id="3381473">:</span>&nbsp;<span class="string" id="3381475">&#34;listen&#34;</span><span class="op" id="3381483">,</span>&nbsp;<span class="ident" id="3381485">Net</span><span class="op" id="3381488">:</span>&nbsp;<span class="ident" id="3381490">net</span><span class="op" id="3381493">,</span>&nbsp;<span class="ident" id="3381495">Addr</span><span class="op" id="3381499">:</span>&nbsp;<span class="ident" id="3381501">gaddr</span><span class="op" id="3381506">,</span>&nbsp;<span class="ident" id="3381508">Err</span><span class="op" id="3381511">:</span>&nbsp;<span class="ident" id="3381513">err</span><span class="op" id="3381516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3381519">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3381522">c</span>&nbsp;<span class="op" id="3381524">:=</span>&nbsp;<span class="ident" id="3381527">newUDPConn</span><span class="op" id="3381537">(</span><span class="ident" id="3381538">fd</span><span class="op" id="3381540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3381543">if</span>&nbsp;<span class="ident" id="3381546">ip4</span>&nbsp;<span class="op" id="3381550">:=</span>&nbsp;<span class="ident" id="3381553">gaddr</span><span class="op" id="3381558">.</span><span class="ident" id="3381559">IP</span><span class="op" id="3381561">.</span><span class="ident" id="3381562">To4</span><span class="op" id="3381565">(</span><span class="op" id="3381566">)</span><span class="op" id="3381567">;</span>&nbsp;<span class="ident" id="3381569">ip4</span>&nbsp;<span class="op" id="3381573">!=</span>&nbsp;<span class="builtintype" id="3381576">nil</span>&nbsp;<span class="op" id="3381580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3381584">if</span>&nbsp;<span class="ident" id="3381587">err</span>&nbsp;<span class="op" id="3381591">:=</span>&nbsp;<span class="ident" id="3381594">listenIPv4MulticastUDP</span><span class="op" id="3381616">(</span><span class="ident" id="3381617">c</span><span class="op" id="3381618">,</span>&nbsp;<span class="ident" id="3381620">ifi</span><span class="op" id="3381623">,</span>&nbsp;<span class="ident" id="3381625">ip4</span><span class="op" id="3381628">)</span><span class="op" id="3381629">;</span>&nbsp;<span class="ident" id="3381631">err</span>&nbsp;<span class="op" id="3381635">!=</span>&nbsp;<span class="builtintype" id="3381638">nil</span>&nbsp;<span class="op" id="3381642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3381647">c</span><span class="op" id="3381648">.</span><span class="ident" id="3381649">Close</span><span class="op" id="3381654">(</span><span class="op" id="3381655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3381660">return</span>&nbsp;<span class="builtintype" id="3381667">nil</span><span class="op" id="3381670">,</span>&nbsp;<span class="op" id="3381672">&amp;</span><span class="ident" id="3381673">OpError</span><span class="op" id="3381680">{</span><span class="ident" id="3381681">Op</span><span class="op" id="3381683">:</span>&nbsp;<span class="string" id="3381685">&#34;listen&#34;</span><span class="op" id="3381693">,</span>&nbsp;<span class="ident" id="3381695">Net</span><span class="op" id="3381698">:</span>&nbsp;<span class="ident" id="3381700">net</span><span class="op" id="3381703">,</span>&nbsp;<span class="ident" id="3381705">Addr</span><span class="op" id="3381709">:</span>&nbsp;<span class="op" id="3381711">&amp;</span><span class="ident" id="3381712">IPAddr</span><span class="op" id="3381718">{</span><span class="ident" id="3381719">IP</span><span class="op" id="3381721">:</span>&nbsp;<span class="ident" id="3381723">ip4</span><span class="op" id="3381726">}</span><span class="op" id="3381727">,</span>&nbsp;<span class="ident" id="3381729">Err</span><span class="op" id="3381732">:</span>&nbsp;<span class="ident" id="3381734">err</span><span class="op" id="3381737">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3381741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3381744">}</span>&nbsp;<span class="keyword" id="3381746">else</span>&nbsp;<span class="op" id="3381751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3381755">if</span>&nbsp;<span class="ident" id="3381758">err</span>&nbsp;<span class="op" id="3381762">:=</span>&nbsp;<span class="ident" id="3381765">listenIPv6MulticastUDP</span><span class="op" id="3381787">(</span><span class="ident" id="3381788">c</span><span class="op" id="3381789">,</span>&nbsp;<span class="ident" id="3381791">ifi</span><span class="op" id="3381794">,</span>&nbsp;<span class="ident" id="3381796">gaddr</span><span class="op" id="3381801">.</span><span class="ident" id="3381802">IP</span><span class="op" id="3381804">)</span><span class="op" id="3381805">;</span>&nbsp;<span class="ident" id="3381807">err</span>&nbsp;<span class="op" id="3381811">!=</span>&nbsp;<span class="builtintype" id="3381814">nil</span>&nbsp;<span class="op" id="3381818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3381823">c</span><span class="op" id="3381824">.</span><span class="ident" id="3381825">Close</span><span class="op" id="3381830">(</span><span class="op" id="3381831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3381836">return</span>&nbsp;<span class="builtintype" id="3381843">nil</span><span class="op" id="3381846">,</span>&nbsp;<span class="op" id="3381848">&amp;</span><span class="ident" id="3381849">OpError</span><span class="op" id="3381856">{</span><span class="ident" id="3381857">Op</span><span class="op" id="3381859">:</span>&nbsp;<span class="string" id="3381861">&#34;listen&#34;</span><span class="op" id="3381869">,</span>&nbsp;<span class="ident" id="3381871">Net</span><span class="op" id="3381874">:</span>&nbsp;<span class="ident" id="3381876">net</span><span class="op" id="3381879">,</span>&nbsp;<span class="ident" id="3381881">Addr</span><span class="op" id="3381885">:</span>&nbsp;<span class="op" id="3381887">&amp;</span><span class="ident" id="3381888">IPAddr</span><span class="op" id="3381894">{</span><span class="ident" id="3381895">IP</span><span class="op" id="3381897">:</span>&nbsp;<span class="ident" id="3381899">gaddr</span><span class="op" id="3381904">.</span><span class="ident" id="3381905">IP</span><span class="op" id="3381907">}</span><span class="op" id="3381908">,</span>&nbsp;<span class="ident" id="3381910">Err</span><span class="op" id="3381913">:</span>&nbsp;<span class="ident" id="3381915">err</span><span class="op" id="3381918">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3381922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3381925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3381928">return</span>&nbsp;<span class="ident" id="3381935">c</span><span class="op" id="3381936">,</span>&nbsp;<span class="builtintype" id="3381938">nil</span><br>
<span class="lineno"></span><span class="op" id="3381942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="3381945">func</span>&nbsp;<span class="ident" id="3381950">listenIPv4MulticastUDP</span><span class="op" id="3381972">(</span><span class="ident" id="3381973">c</span>&nbsp;<span class="op" id="3381975">*</span><span class="ident" id="3381976">UDPConn</span><span class="op" id="3381983">,</span>&nbsp;<span class="ident" id="3381985">ifi</span>&nbsp;<span class="op" id="3381989">*</span><span class="ident" id="3381990">Interface</span><span class="op" id="3381999">,</span>&nbsp;<span class="ident" id="3382001">ip</span>&nbsp;<span class="ident" id="3382004">IP</span><span class="op" id="3382006">)</span>&nbsp;<span class="builtintype" id="3382008">error</span>&nbsp;<span class="op" id="3382014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3382017">if</span>&nbsp;<span class="ident" id="3382020">ifi</span>&nbsp;<span class="op" id="3382024">!=</span>&nbsp;<span class="builtintype" id="3382027">nil</span>&nbsp;<span class="op" id="3382031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3382035">if</span>&nbsp;<span class="ident" id="3382038">err</span>&nbsp;<span class="op" id="3382042">:=</span>&nbsp;<span class="ident" id="3382045">setIPv4MulticastInterface</span><span class="op" id="3382070">(</span><span class="ident" id="3382071">c</span><span class="op" id="3382072">.</span><span class="ident" id="3382073">fd</span><span class="op" id="3382075">,</span>&nbsp;<span class="ident" id="3382077">ifi</span><span class="op" id="3382080">)</span><span class="op" id="3382081">;</span>&nbsp;<span class="ident" id="3382083">err</span>&nbsp;<span class="op" id="3382087">!=</span>&nbsp;<span class="builtintype" id="3382090">nil</span>&nbsp;<span class="op" id="3382094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3382099">return</span>&nbsp;<span class="ident" id="3382106">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3382112">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3382115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3382118">if</span>&nbsp;<span class="ident" id="3382121">err</span>&nbsp;<span class="op" id="3382125">:=</span>&nbsp;<span class="ident" id="3382128">setIPv4MulticastLoopback</span><span class="op" id="3382152">(</span><span class="ident" id="3382153">c</span><span class="op" id="3382154">.</span><span class="ident" id="3382155">fd</span><span class="op" id="3382157">,</span>&nbsp;<span class="builtintype" id="3382159">false</span><span class="op" id="3382164">)</span><span class="op" id="3382165">;</span>&nbsp;<span class="ident" id="3382167">err</span>&nbsp;<span class="op" id="3382171">!=</span>&nbsp;<span class="builtintype" id="3382174">nil</span>&nbsp;<span class="op" id="3382178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3382182">return</span>&nbsp;<span class="ident" id="3382189">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3382194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3382197">if</span>&nbsp;<span class="ident" id="3382200">err</span>&nbsp;<span class="op" id="3382204">:=</span>&nbsp;<span class="ident" id="3382207">joinIPv4Group</span><span class="op" id="3382220">(</span><span class="ident" id="3382221">c</span><span class="op" id="3382222">.</span><span class="ident" id="3382223">fd</span><span class="op" id="3382225">,</span>&nbsp;<span class="ident" id="3382227">ifi</span><span class="op" id="3382230">,</span>&nbsp;<span class="ident" id="3382232">ip</span><span class="op" id="3382234">)</span><span class="op" id="3382235">;</span>&nbsp;<span class="ident" id="3382237">err</span>&nbsp;<span class="op" id="3382241">!=</span>&nbsp;<span class="builtintype" id="3382244">nil</span>&nbsp;<span class="op" id="3382248">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3382252">return</span>&nbsp;<span class="ident" id="3382259">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3382264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3382267">return</span>&nbsp;<span class="builtintype" id="3382274">nil</span><br>
<span class="lineno"></span><span class="op" id="3382278">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="3382281">func</span>&nbsp;<span class="ident" id="3382286">listenIPv6MulticastUDP</span><span class="op" id="3382308">(</span><span class="ident" id="3382309">c</span>&nbsp;<span class="op" id="3382311">*</span><span class="ident" id="3382312">UDPConn</span><span class="op" id="3382319">,</span>&nbsp;<span class="ident" id="3382321">ifi</span>&nbsp;<span class="op" id="3382325">*</span><span class="ident" id="3382326">Interface</span><span class="op" id="3382335">,</span>&nbsp;<span class="ident" id="3382337">ip</span>&nbsp;<span class="ident" id="3382340">IP</span><span class="op" id="3382342">)</span>&nbsp;<span class="builtintype" id="3382344">error</span>&nbsp;<span class="op" id="3382350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3382353">if</span>&nbsp;<span class="ident" id="3382356">ifi</span>&nbsp;<span class="op" id="3382360">!=</span>&nbsp;<span class="builtintype" id="3382363">nil</span>&nbsp;<span class="op" id="3382367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3382371">if</span>&nbsp;<span class="ident" id="3382374">err</span>&nbsp;<span class="op" id="3382378">:=</span>&nbsp;<span class="ident" id="3382381">setIPv6MulticastInterface</span><span class="op" id="3382406">(</span><span class="ident" id="3382407">c</span><span class="op" id="3382408">.</span><span class="ident" id="3382409">fd</span><span class="op" id="3382411">,</span>&nbsp;<span class="ident" id="3382413">ifi</span><span class="op" id="3382416">)</span><span class="op" id="3382417">;</span>&nbsp;<span class="ident" id="3382419">err</span>&nbsp;<span class="op" id="3382423">!=</span>&nbsp;<span class="builtintype" id="3382426">nil</span>&nbsp;<span class="op" id="3382430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3382435">return</span>&nbsp;<span class="ident" id="3382442">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3382448">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3382451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3382454">if</span>&nbsp;<span class="ident" id="3382457">err</span>&nbsp;<span class="op" id="3382461">:=</span>&nbsp;<span class="ident" id="3382464">setIPv6MulticastLoopback</span><span class="op" id="3382488">(</span><span class="ident" id="3382489">c</span><span class="op" id="3382490">.</span><span class="ident" id="3382491">fd</span><span class="op" id="3382493">,</span>&nbsp;<span class="builtintype" id="3382495">false</span><span class="op" id="3382500">)</span><span class="op" id="3382501">;</span>&nbsp;<span class="ident" id="3382503">err</span>&nbsp;<span class="op" id="3382507">!=</span>&nbsp;<span class="builtintype" id="3382510">nil</span>&nbsp;<span class="op" id="3382514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3382518">return</span>&nbsp;<span class="ident" id="3382525">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3382530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3382533">if</span>&nbsp;<span class="ident" id="3382536">err</span>&nbsp;<span class="op" id="3382540">:=</span>&nbsp;<span class="ident" id="3382543">joinIPv6Group</span><span class="op" id="3382556">(</span><span class="ident" id="3382557">c</span><span class="op" id="3382558">.</span><span class="ident" id="3382559">fd</span><span class="op" id="3382561">,</span>&nbsp;<span class="ident" id="3382563">ifi</span><span class="op" id="3382566">,</span>&nbsp;<span class="ident" id="3382568">ip</span><span class="op" id="3382570">)</span><span class="op" id="3382571">;</span>&nbsp;<span class="ident" id="3382573">err</span>&nbsp;<span class="op" id="3382577">!=</span>&nbsp;<span class="builtintype" id="3382580">nil</span>&nbsp;<span class="op" id="3382584">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3382588">return</span>&nbsp;<span class="ident" id="3382595">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3382600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3382603">return</span>&nbsp;<span class="builtintype" id="3382610">nil</span><br>
<span class="lineno"></span><span class="op" id="3382614">}</span>
</div>
</body>
</html>
