<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/json</h2>
<ul>
<li><a href="/gostd/encoding/json/bench_test.go.html">bench_test.go</a></li>
<li><a href="/gostd/encoding/json/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/json/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/encoding/json/encode.go.html" class="current">encode.go</a></li>
<li><a href="/gostd/encoding/json/encode_test.go.html">encode_test.go</a></li>
<li><a href="/gostd/encoding/json/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/json/fold.go.html">fold.go</a></li>
<li><a href="/gostd/encoding/json/fold_test.go.html">fold_test.go</a></li>
<li><a href="/gostd/encoding/json/indent.go.html">indent.go</a></li>
<li><a href="/gostd/encoding/json/scanner.go.html">scanner.go</a></li>
<li><a href="/gostd/encoding/json/scanner_test.go.html">scanner_test.go</a></li>
<li><a href="/gostd/encoding/json/stream.go.html">stream.go</a></li>
<li><a href="/gostd/encoding/json/stream_test.go.html">stream_test.go</a></li>
<li><a href="/gostd/encoding/json/tagkey_test.go.html">tagkey_test.go</a></li>
<li><a href="/gostd/encoding/json/tags.go.html">tags.go</a></li>
<li><a href="/gostd/encoding/json/tags_test.go.html">tags_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4777212">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4777268">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4777322">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4777373">//&nbsp;Package&nbsp;json&nbsp;implements&nbsp;encoding&nbsp;and&nbsp;decoding&nbsp;of&nbsp;JSON&nbsp;objects&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4777452">//&nbsp;RFC&nbsp;4627.&nbsp;The&nbsp;mapping&nbsp;between&nbsp;JSON&nbsp;objects&nbsp;and&nbsp;Go&nbsp;values&nbsp;is&nbsp;described</span><br>
<span class="lineno"></span><span class="comment" id="4777525">//&nbsp;in&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;Marshal&nbsp;and&nbsp;Unmarshal&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="4777590">//</span><br>
<span class="lineno"></span><span class="comment" id="4777593">//&nbsp;See&nbsp;&#34;JSON&nbsp;and&nbsp;Go&#34;&nbsp;for&nbsp;an&nbsp;introduction&nbsp;to&nbsp;this&nbsp;package:</span><br>
<span class="lineno">10</span><span class="comment" id="4777651">//&nbsp;http://golang.org/doc/articles/json_and_go.html</span><br>
<span class="lineno"></span><span class="keyword" id="4777702">package</span>&nbsp;<span class="ident" id="4777710">json</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4777716">import</span>&nbsp;<span class="op" id="4777723">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4777726">&#34;bytes&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4777735">&#34;encoding&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4777747">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4777766">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4777774">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4777785">&#34;runtime&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4777796">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4777804">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4777815">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4777826">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4777834">&#34;unicode&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4777845">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="4777860">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4777863">//&nbsp;Marshal&nbsp;returns&nbsp;the&nbsp;JSON&nbsp;encoding&nbsp;of&nbsp;v.</span><br>
<span class="lineno"></span><span class="comment" id="4777906">//</span><br>
<span class="lineno">30</span><span class="comment" id="4777909">//&nbsp;Marshal&nbsp;traverses&nbsp;the&nbsp;value&nbsp;v&nbsp;recursively.</span><br>
<span class="lineno"></span><span class="comment" id="4777955">//&nbsp;If&nbsp;an&nbsp;encountered&nbsp;value&nbsp;implements&nbsp;the&nbsp;Marshaler&nbsp;interface</span><br>
<span class="lineno"></span><span class="comment" id="4778017">//&nbsp;and&nbsp;is&nbsp;not&nbsp;a&nbsp;nil&nbsp;pointer,&nbsp;Marshal&nbsp;calls&nbsp;its&nbsp;MarshalJSON&nbsp;method</span><br>
<span class="lineno"></span><span class="comment" id="4778083">//&nbsp;to&nbsp;produce&nbsp;JSON.&nbsp;&nbsp;The&nbsp;nil&nbsp;pointer&nbsp;exception&nbsp;is&nbsp;not&nbsp;strictly&nbsp;necessary</span><br>
<span class="lineno"></span><span class="comment" id="4778156">//&nbsp;but&nbsp;mimics&nbsp;a&nbsp;similar,&nbsp;necessary&nbsp;exception&nbsp;in&nbsp;the&nbsp;behavior&nbsp;of</span><br>
<span class="lineno">35</span><span class="comment" id="4778220">//&nbsp;UnmarshalJSON.</span><br>
<span class="lineno"></span><span class="comment" id="4778238">//</span><br>
<span class="lineno"></span><span class="comment" id="4778241">//&nbsp;Otherwise,&nbsp;Marshal&nbsp;uses&nbsp;the&nbsp;following&nbsp;type-dependent&nbsp;default&nbsp;encodings:</span><br>
<span class="lineno"></span><span class="comment" id="4778316">//</span><br>
<span class="lineno"></span><span class="comment" id="4778319">//&nbsp;Boolean&nbsp;values&nbsp;encode&nbsp;as&nbsp;JSON&nbsp;booleans.</span><br>
<span class="lineno">40</span><span class="comment" id="4778362">//</span><br>
<span class="lineno"></span><span class="comment" id="4778365">//&nbsp;Floating&nbsp;point,&nbsp;integer,&nbsp;and&nbsp;Number&nbsp;values&nbsp;encode&nbsp;as&nbsp;JSON&nbsp;numbers.</span><br>
<span class="lineno"></span><span class="comment" id="4778435">//</span><br>
<span class="lineno"></span><span class="comment" id="4778438">//&nbsp;String&nbsp;values&nbsp;encode&nbsp;as&nbsp;JSON&nbsp;strings&nbsp;coerced&nbsp;to&nbsp;valid&nbsp;UTF-8,</span><br>
<span class="lineno"></span><span class="comment" id="4778502">//&nbsp;replacing&nbsp;invalid&nbsp;bytes&nbsp;with&nbsp;the&nbsp;Unicode&nbsp;replacement&nbsp;rune.</span><br>
<span class="lineno">45</span><span class="comment" id="4778564">//&nbsp;The&nbsp;angle&nbsp;brackets&nbsp;&#34;&lt;&#34;&nbsp;and&nbsp;&#34;&gt;&#34;&nbsp;are&nbsp;escaped&nbsp;to&nbsp;&#34;\u003c&#34;&nbsp;and&nbsp;&#34;\u003e&#34;</span><br>
<span class="lineno"></span><span class="comment" id="4778635">//&nbsp;to&nbsp;keep&nbsp;some&nbsp;browsers&nbsp;from&nbsp;misinterpreting&nbsp;JSON&nbsp;output&nbsp;as&nbsp;HTML.</span><br>
<span class="lineno"></span><span class="comment" id="4778702">//&nbsp;Ampersand&nbsp;&#34;&amp;&#34;&nbsp;is&nbsp;also&nbsp;escaped&nbsp;to&nbsp;&#34;\u0026&#34;&nbsp;for&nbsp;the&nbsp;same&nbsp;reason.</span><br>
<span class="lineno"></span><span class="comment" id="4778768">//</span><br>
<span class="lineno"></span><span class="comment" id="4778771">//&nbsp;Array&nbsp;and&nbsp;slice&nbsp;values&nbsp;encode&nbsp;as&nbsp;JSON&nbsp;arrays,&nbsp;except&nbsp;that</span><br>
<span class="lineno">50</span><span class="comment" id="4778832">//&nbsp;[]byte&nbsp;encodes&nbsp;as&nbsp;a&nbsp;base64-encoded&nbsp;string,&nbsp;and&nbsp;a&nbsp;nil&nbsp;slice</span><br>
<span class="lineno"></span><span class="comment" id="4778894">//&nbsp;encodes&nbsp;as&nbsp;the&nbsp;null&nbsp;JSON&nbsp;object.</span><br>
<span class="lineno"></span><span class="comment" id="4778930">//</span><br>
<span class="lineno"></span><span class="comment" id="4778933">//&nbsp;Struct&nbsp;values&nbsp;encode&nbsp;as&nbsp;JSON&nbsp;objects.&nbsp;Each&nbsp;exported&nbsp;struct&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="4779001">//&nbsp;becomes&nbsp;a&nbsp;member&nbsp;of&nbsp;the&nbsp;object&nbsp;unless</span><br>
<span class="lineno">55</span><span class="comment" id="4779042">//&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;field&#39;s&nbsp;tag&nbsp;is&nbsp;&#34;-&#34;,&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="4779076">//&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;field&nbsp;is&nbsp;empty&nbsp;and&nbsp;its&nbsp;tag&nbsp;specifies&nbsp;the&nbsp;&#34;omitempty&#34;&nbsp;option.</span><br>
<span class="lineno"></span><span class="comment" id="4779148">//&nbsp;The&nbsp;empty&nbsp;values&nbsp;are&nbsp;false,&nbsp;0,&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="4779186">//&nbsp;nil&nbsp;pointer&nbsp;or&nbsp;interface&nbsp;value,&nbsp;and&nbsp;any&nbsp;array,&nbsp;slice,&nbsp;map,&nbsp;or&nbsp;string&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4779261">//&nbsp;length&nbsp;zero.&nbsp;The&nbsp;object&#39;s&nbsp;default&nbsp;key&nbsp;string&nbsp;is&nbsp;the&nbsp;struct&nbsp;field&nbsp;name</span><br>
<span class="lineno">60</span><span class="comment" id="4779334">//&nbsp;but&nbsp;can&nbsp;be&nbsp;specified&nbsp;in&nbsp;the&nbsp;struct&nbsp;field&#39;s&nbsp;tag&nbsp;value.&nbsp;The&nbsp;&#34;json&#34;&nbsp;key&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4779409">//&nbsp;the&nbsp;struct&nbsp;field&#39;s&nbsp;tag&nbsp;value&nbsp;is&nbsp;the&nbsp;key&nbsp;name,&nbsp;followed&nbsp;by&nbsp;an&nbsp;optional&nbsp;comma</span><br>
<span class="lineno"></span><span class="comment" id="4779488">//&nbsp;and&nbsp;options.&nbsp;Examples:</span><br>
<span class="lineno"></span><span class="comment" id="4779514">//</span><br>
<span class="lineno"></span><span class="comment" id="4779517">//&nbsp;&nbsp;&nbsp;//&nbsp;Field&nbsp;is&nbsp;ignored&nbsp;by&nbsp;this&nbsp;package.</span><br>
<span class="lineno">65</span><span class="comment" id="4779559">//&nbsp;&nbsp;&nbsp;Field&nbsp;int&nbsp;`json:&#34;-&#34;`</span><br>
<span class="lineno"></span><span class="comment" id="4779585">//</span><br>
<span class="lineno"></span><span class="comment" id="4779588">//&nbsp;&nbsp;&nbsp;//&nbsp;Field&nbsp;appears&nbsp;in&nbsp;JSON&nbsp;as&nbsp;key&nbsp;&#34;myName&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="4779635">//&nbsp;&nbsp;&nbsp;Field&nbsp;int&nbsp;`json:&#34;myName&#34;`</span><br>
<span class="lineno"></span><span class="comment" id="4779666">//</span><br>
<span class="lineno">70</span><span class="comment" id="4779669">//&nbsp;&nbsp;&nbsp;//&nbsp;Field&nbsp;appears&nbsp;in&nbsp;JSON&nbsp;as&nbsp;key&nbsp;&#34;myName&#34;&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4779719">//&nbsp;&nbsp;&nbsp;//&nbsp;the&nbsp;field&nbsp;is&nbsp;omitted&nbsp;from&nbsp;the&nbsp;object&nbsp;if&nbsp;its&nbsp;value&nbsp;is&nbsp;empty,</span><br>
<span class="lineno"></span><span class="comment" id="4779787">//&nbsp;&nbsp;&nbsp;//&nbsp;as&nbsp;defined&nbsp;above.</span><br>
<span class="lineno"></span><span class="comment" id="4779813">//&nbsp;&nbsp;&nbsp;Field&nbsp;int&nbsp;`json:&#34;myName,omitempty&#34;`</span><br>
<span class="lineno"></span><span class="comment" id="4779854">//</span><br>
<span class="lineno">75</span><span class="comment" id="4779857">//&nbsp;&nbsp;&nbsp;//&nbsp;Field&nbsp;appears&nbsp;in&nbsp;JSON&nbsp;as&nbsp;key&nbsp;&#34;Field&#34;&nbsp;(the&nbsp;default),&nbsp;but</span><br>
<span class="lineno"></span><span class="comment" id="4779921">//&nbsp;&nbsp;&nbsp;//&nbsp;the&nbsp;field&nbsp;is&nbsp;skipped&nbsp;if&nbsp;empty.</span><br>
<span class="lineno"></span><span class="comment" id="4779960">//&nbsp;&nbsp;&nbsp;//&nbsp;Note&nbsp;the&nbsp;leading&nbsp;comma.</span><br>
<span class="lineno"></span><span class="comment" id="4779992">//&nbsp;&nbsp;&nbsp;Field&nbsp;int&nbsp;`json:&#34;,omitempty&#34;`</span><br>
<span class="lineno"></span><span class="comment" id="4780027">//</span><br>
<span class="lineno">80</span><span class="comment" id="4780030">//&nbsp;The&nbsp;&#34;string&#34;&nbsp;option&nbsp;signals&nbsp;that&nbsp;a&nbsp;field&nbsp;is&nbsp;stored&nbsp;as&nbsp;JSON&nbsp;inside&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4780101">//&nbsp;JSON-encoded&nbsp;string.&nbsp;It&nbsp;applies&nbsp;only&nbsp;to&nbsp;fields&nbsp;of&nbsp;string,&nbsp;floating&nbsp;point,</span><br>
<span class="lineno"></span><span class="comment" id="4780178">//&nbsp;or&nbsp;integer&nbsp;types.&nbsp;This&nbsp;extra&nbsp;level&nbsp;of&nbsp;encoding&nbsp;is&nbsp;sometimes&nbsp;used&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="4780251">//&nbsp;communicating&nbsp;with&nbsp;JavaScript&nbsp;programs:</span><br>
<span class="lineno"></span><span class="comment" id="4780294">//</span><br>
<span class="lineno">85</span><span class="comment" id="4780297">//&nbsp;&nbsp;&nbsp;&nbsp;Int64String&nbsp;int64&nbsp;`json:&#34;,string&#34;`</span><br>
<span class="lineno"></span><span class="comment" id="4780338">//</span><br>
<span class="lineno"></span><span class="comment" id="4780341">//&nbsp;The&nbsp;key&nbsp;name&nbsp;will&nbsp;be&nbsp;used&nbsp;if&nbsp;it&#39;s&nbsp;a&nbsp;non-empty&nbsp;string&nbsp;consisting&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4780411">//&nbsp;only&nbsp;Unicode&nbsp;letters,&nbsp;digits,&nbsp;dollar&nbsp;signs,&nbsp;percent&nbsp;signs,&nbsp;hyphens,</span><br>
<span class="lineno"></span><span class="comment" id="4780482">//&nbsp;underscores&nbsp;and&nbsp;slashes.</span><br>
<span class="lineno">90</span><span class="comment" id="4780510">//</span><br>
<span class="lineno"></span><span class="comment" id="4780513">//&nbsp;Anonymous&nbsp;struct&nbsp;fields&nbsp;are&nbsp;usually&nbsp;marshaled&nbsp;as&nbsp;if&nbsp;their&nbsp;inner&nbsp;exported&nbsp;fields</span><br>
<span class="lineno"></span><span class="comment" id="4780596">//&nbsp;were&nbsp;fields&nbsp;in&nbsp;the&nbsp;outer&nbsp;struct,&nbsp;subject&nbsp;to&nbsp;the&nbsp;usual&nbsp;Go&nbsp;visibility&nbsp;rules&nbsp;amended</span><br>
<span class="lineno"></span><span class="comment" id="4780681">//&nbsp;as&nbsp;described&nbsp;in&nbsp;the&nbsp;next&nbsp;paragraph.</span><br>
<span class="lineno"></span><span class="comment" id="4780720">//&nbsp;An&nbsp;anonymous&nbsp;struct&nbsp;field&nbsp;with&nbsp;a&nbsp;name&nbsp;given&nbsp;in&nbsp;its&nbsp;JSON&nbsp;tag&nbsp;is&nbsp;treated&nbsp;as</span><br>
<span class="lineno">95</span><span class="comment" id="4780797">//&nbsp;having&nbsp;that&nbsp;name,&nbsp;rather&nbsp;than&nbsp;being&nbsp;anonymous.</span><br>
<span class="lineno"></span><span class="comment" id="4780847">//&nbsp;An&nbsp;anonymous&nbsp;struct&nbsp;field&nbsp;of&nbsp;interface&nbsp;type&nbsp;is&nbsp;treated&nbsp;the&nbsp;same&nbsp;as&nbsp;having</span><br>
<span class="lineno"></span><span class="comment" id="4780924">//&nbsp;that&nbsp;type&nbsp;as&nbsp;its&nbsp;name,&nbsp;rather&nbsp;than&nbsp;being&nbsp;anonymous.</span><br>
<span class="lineno"></span><span class="comment" id="4780979">//</span><br>
<span class="lineno"></span><span class="comment" id="4780982">//&nbsp;The&nbsp;Go&nbsp;visibility&nbsp;rules&nbsp;for&nbsp;struct&nbsp;fields&nbsp;are&nbsp;amended&nbsp;for&nbsp;JSON&nbsp;when</span><br>
<span class="lineno">100</span><span class="comment" id="4781053">//&nbsp;deciding&nbsp;which&nbsp;field&nbsp;to&nbsp;marshal&nbsp;or&nbsp;unmarshal.&nbsp;If&nbsp;there&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="4781115">//&nbsp;multiple&nbsp;fields&nbsp;at&nbsp;the&nbsp;same&nbsp;level,&nbsp;and&nbsp;that&nbsp;level&nbsp;is&nbsp;the&nbsp;least</span><br>
<span class="lineno"></span><span class="comment" id="4781181">//&nbsp;nested&nbsp;(and&nbsp;would&nbsp;therefore&nbsp;be&nbsp;the&nbsp;nesting&nbsp;level&nbsp;selected&nbsp;by&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4781249">//&nbsp;usual&nbsp;Go&nbsp;rules),&nbsp;the&nbsp;following&nbsp;extra&nbsp;rules&nbsp;apply:</span><br>
<span class="lineno"></span><span class="comment" id="4781302">//</span><br>
<span class="lineno">105</span><span class="comment" id="4781305">//&nbsp;1)&nbsp;Of&nbsp;those&nbsp;fields,&nbsp;if&nbsp;any&nbsp;are&nbsp;JSON-tagged,&nbsp;only&nbsp;tagged&nbsp;fields&nbsp;are&nbsp;considered,</span><br>
<span class="lineno"></span><span class="comment" id="4781387">//&nbsp;even&nbsp;if&nbsp;there&nbsp;are&nbsp;multiple&nbsp;untagged&nbsp;fields&nbsp;that&nbsp;would&nbsp;otherwise&nbsp;conflict.</span><br>
<span class="lineno"></span><span class="comment" id="4781464">//&nbsp;2)&nbsp;If&nbsp;there&nbsp;is&nbsp;exactly&nbsp;one&nbsp;field&nbsp;(tagged&nbsp;or&nbsp;not&nbsp;according&nbsp;to&nbsp;the&nbsp;first&nbsp;rule),&nbsp;that&nbsp;is&nbsp;selected.</span><br>
<span class="lineno"></span><span class="comment" id="4781563">//&nbsp;3)&nbsp;Otherwise&nbsp;there&nbsp;are&nbsp;multiple&nbsp;fields,&nbsp;and&nbsp;all&nbsp;are&nbsp;ignored;&nbsp;no&nbsp;error&nbsp;occurs.</span><br>
<span class="lineno"></span><span class="comment" id="4781644">//</span><br>
<span class="lineno">110</span><span class="comment" id="4781647">//&nbsp;Handling&nbsp;of&nbsp;anonymous&nbsp;struct&nbsp;fields&nbsp;is&nbsp;new&nbsp;in&nbsp;Go&nbsp;1.1.</span><br>
<span class="lineno"></span><span class="comment" id="4781704">//&nbsp;Prior&nbsp;to&nbsp;Go&nbsp;1.1,&nbsp;anonymous&nbsp;struct&nbsp;fields&nbsp;were&nbsp;ignored.&nbsp;To&nbsp;force&nbsp;ignoring&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4781783">//&nbsp;an&nbsp;anonymous&nbsp;struct&nbsp;field&nbsp;in&nbsp;both&nbsp;current&nbsp;and&nbsp;earlier&nbsp;versions,&nbsp;give&nbsp;the&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="4781865">//&nbsp;a&nbsp;JSON&nbsp;tag&nbsp;of&nbsp;&#34;-&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="4781887">//</span><br>
<span class="lineno">115</span><span class="comment" id="4781890">//&nbsp;Map&nbsp;values&nbsp;encode&nbsp;as&nbsp;JSON&nbsp;objects.</span><br>
<span class="lineno"></span><span class="comment" id="4781928">//&nbsp;The&nbsp;map&#39;s&nbsp;key&nbsp;type&nbsp;must&nbsp;be&nbsp;string;&nbsp;the&nbsp;object&nbsp;keys&nbsp;are&nbsp;used&nbsp;directly</span><br>
<span class="lineno"></span><span class="comment" id="4782000">//&nbsp;as&nbsp;map&nbsp;keys.</span><br>
<span class="lineno"></span><span class="comment" id="4782016">//</span><br>
<span class="lineno"></span><span class="comment" id="4782019">//&nbsp;Pointer&nbsp;values&nbsp;encode&nbsp;as&nbsp;the&nbsp;value&nbsp;pointed&nbsp;to.</span><br>
<span class="lineno">120</span><span class="comment" id="4782069">//&nbsp;A&nbsp;nil&nbsp;pointer&nbsp;encodes&nbsp;as&nbsp;the&nbsp;null&nbsp;JSON&nbsp;object.</span><br>
<span class="lineno"></span><span class="comment" id="4782119">//</span><br>
<span class="lineno"></span><span class="comment" id="4782122">//&nbsp;Interface&nbsp;values&nbsp;encode&nbsp;as&nbsp;the&nbsp;value&nbsp;contained&nbsp;in&nbsp;the&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="4782190">//&nbsp;A&nbsp;nil&nbsp;interface&nbsp;value&nbsp;encodes&nbsp;as&nbsp;the&nbsp;null&nbsp;JSON&nbsp;object.</span><br>
<span class="lineno"></span><span class="comment" id="4782248">//</span><br>
<span class="lineno">125</span><span class="comment" id="4782251">//&nbsp;Channel,&nbsp;complex,&nbsp;and&nbsp;function&nbsp;values&nbsp;cannot&nbsp;be&nbsp;encoded&nbsp;in&nbsp;JSON.</span><br>
<span class="lineno"></span><span class="comment" id="4782319">//&nbsp;Attempting&nbsp;to&nbsp;encode&nbsp;such&nbsp;a&nbsp;value&nbsp;causes&nbsp;Marshal&nbsp;to&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="4782381">//&nbsp;an&nbsp;UnsupportedTypeError.</span><br>
<span class="lineno"></span><span class="comment" id="4782409">//</span><br>
<span class="lineno"></span><span class="comment" id="4782412">//&nbsp;JSON&nbsp;cannot&nbsp;represent&nbsp;cyclic&nbsp;data&nbsp;structures&nbsp;and&nbsp;Marshal&nbsp;does&nbsp;not</span><br>
<span class="lineno">130</span><span class="comment" id="4782481">//&nbsp;handle&nbsp;them.&nbsp;&nbsp;Passing&nbsp;cyclic&nbsp;structures&nbsp;to&nbsp;Marshal&nbsp;will&nbsp;result&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4782550">//&nbsp;an&nbsp;infinite&nbsp;recursion.</span><br>
<span class="lineno"></span><span class="comment" id="4782576">//</span><br>
<span class="lineno"></span><span class="keyword" id="4782579">func</span>&nbsp;<span class="ident" id="4782584">Marshal</span><span class="op" id="4782591">(</span><span class="ident" id="4782592">v</span>&nbsp;<span class="keyword" id="4782594">interface</span><span class="op" id="4782603">{</span><span class="op" id="4782604">}</span><span class="op" id="4782605">)</span>&nbsp;<span class="op" id="4782607">(</span><span class="op" id="4782608">[</span><span class="op" id="4782609">]</span><span class="builtintype" id="4782610">byte</span><span class="op" id="4782614">,</span>&nbsp;<span class="builtintype" id="4782616">error</span><span class="op" id="4782621">)</span>&nbsp;<span class="op" id="4782623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4782626">e</span>&nbsp;<span class="op" id="4782628">:=</span>&nbsp;<span class="op" id="4782631">&amp;</span><span class="ident" id="4782632">encodeState</span><span class="op" id="4782643">{</span><span class="op" id="4782644">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4782647">err</span>&nbsp;<span class="op" id="4782651">:=</span>&nbsp;<span class="ident" id="4782654">e</span><span class="op" id="4782655">.</span><span class="ident" id="4782656">marshal</span><span class="op" id="4782663">(</span><span class="ident" id="4782664">v</span><span class="op" id="4782665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4782668">if</span>&nbsp;<span class="ident" id="4782671">err</span>&nbsp;<span class="op" id="4782675">!=</span>&nbsp;<span class="ident" id="4782678">nil</span>&nbsp;<span class="op" id="4782682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4782686">return</span>&nbsp;<span class="ident" id="4782693">nil</span><span class="op" id="4782696">,</span>&nbsp;<span class="ident" id="4782698">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4782703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4782706">return</span>&nbsp;<span class="ident" id="4782713">e</span><span class="op" id="4782714">.</span><span class="ident" id="4782715">Bytes</span><span class="op" id="4782720">(</span><span class="op" id="4782721">)</span><span class="op" id="4782722">,</span>&nbsp;<span class="ident" id="4782724">nil</span><br>
<span class="lineno">140</span><span class="op" id="4782728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4782731">//&nbsp;MarshalIndent&nbsp;is&nbsp;like&nbsp;Marshal&nbsp;but&nbsp;applies&nbsp;Indent&nbsp;to&nbsp;format&nbsp;the&nbsp;output.</span><br>
<span class="lineno"></span><span class="keyword" id="4782805">func</span>&nbsp;<span class="ident" id="4782810">MarshalIndent</span><span class="op" id="4782823">(</span><span class="ident" id="4782824">v</span>&nbsp;<span class="keyword" id="4782826">interface</span><span class="op" id="4782835">{</span><span class="op" id="4782836">}</span><span class="op" id="4782837">,</span>&nbsp;<span class="ident" id="4782839">prefix</span><span class="op" id="4782845">,</span>&nbsp;<span class="ident" id="4782847">indent</span>&nbsp;<span class="builtintype" id="4782854">string</span><span class="op" id="4782860">)</span>&nbsp;<span class="op" id="4782862">(</span><span class="op" id="4782863">[</span><span class="op" id="4782864">]</span><span class="builtintype" id="4782865">byte</span><span class="op" id="4782869">,</span>&nbsp;<span class="builtintype" id="4782871">error</span><span class="op" id="4782876">)</span>&nbsp;<span class="op" id="4782878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4782881">b</span><span class="op" id="4782882">,</span>&nbsp;<span class="ident" id="4782884">err</span>&nbsp;<span class="op" id="4782888">:=</span>&nbsp;<span class="ident" id="4782891">Marshal</span><span class="op" id="4782898">(</span><span class="ident" id="4782899">v</span><span class="op" id="4782900">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4782903">if</span>&nbsp;<span class="ident" id="4782906">err</span>&nbsp;<span class="op" id="4782910">!=</span>&nbsp;<span class="ident" id="4782913">nil</span>&nbsp;<span class="op" id="4782917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4782921">return</span>&nbsp;<span class="ident" id="4782928">nil</span><span class="op" id="4782931">,</span>&nbsp;<span class="ident" id="4782933">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4782938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4782941">var</span>&nbsp;<span class="ident" id="4782945">buf</span>&nbsp;<span class="ident" id="4782949">bytes</span><span class="op" id="4782954">.</span><span class="ident" id="4782955">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4782963">err</span>&nbsp;<span class="op" id="4782967">=</span>&nbsp;<span class="ident" id="4782969">Indent</span><span class="op" id="4782975">(</span><span class="op" id="4782976">&amp;</span><span class="ident" id="4782977">buf</span><span class="op" id="4782980">,</span>&nbsp;<span class="ident" id="4782982">b</span><span class="op" id="4782983">,</span>&nbsp;<span class="ident" id="4782985">prefix</span><span class="op" id="4782991">,</span>&nbsp;<span class="ident" id="4782993">indent</span><span class="op" id="4782999">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4783002">if</span>&nbsp;<span class="ident" id="4783005">err</span>&nbsp;<span class="op" id="4783009">!=</span>&nbsp;<span class="ident" id="4783012">nil</span>&nbsp;<span class="op" id="4783016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4783020">return</span>&nbsp;<span class="ident" id="4783027">nil</span><span class="op" id="4783030">,</span>&nbsp;<span class="ident" id="4783032">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4783037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4783040">return</span>&nbsp;<span class="ident" id="4783047">buf</span><span class="op" id="4783050">.</span><span class="ident" id="4783051">Bytes</span><span class="op" id="4783056">(</span><span class="op" id="4783057">)</span><span class="op" id="4783058">,</span>&nbsp;<span class="ident" id="4783060">nil</span><br>
<span class="lineno"></span><span class="op" id="4783064">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="comment" id="4783067">//&nbsp;HTMLEscape&nbsp;appends&nbsp;to&nbsp;dst&nbsp;the&nbsp;JSON-encoded&nbsp;src&nbsp;with&nbsp;&lt;,&nbsp;&gt;,&nbsp;&amp;,&nbsp;U+2028&nbsp;and&nbsp;U+2029</span><br>
<span class="lineno"></span><span class="comment" id="4783149">//&nbsp;characters&nbsp;inside&nbsp;string&nbsp;literals&nbsp;changed&nbsp;to&nbsp;\u003c,&nbsp;\u003e,&nbsp;\u0026,&nbsp;\u2028,&nbsp;\u2029</span><br>
<span class="lineno"></span><span class="comment" id="4783236">//&nbsp;so&nbsp;that&nbsp;the&nbsp;JSON&nbsp;will&nbsp;be&nbsp;safe&nbsp;to&nbsp;embed&nbsp;inside&nbsp;HTML&nbsp;&lt;script&gt;&nbsp;tags.</span><br>
<span class="lineno"></span><span class="comment" id="4783305">//&nbsp;For&nbsp;historical&nbsp;reasons,&nbsp;web&nbsp;browsers&nbsp;don&#39;t&nbsp;honor&nbsp;standard&nbsp;HTML</span><br>
<span class="lineno">160</span><span class="comment" id="4783371">//&nbsp;escaping&nbsp;within&nbsp;&lt;script&gt;&nbsp;tags,&nbsp;so&nbsp;an&nbsp;alternative&nbsp;JSON&nbsp;encoding&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="4783442">//&nbsp;be&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="4783454">func</span>&nbsp;<span class="ident" id="4783459">HTMLEscape</span><span class="op" id="4783469">(</span><span class="ident" id="4783470">dst</span>&nbsp;<span class="op" id="4783474">*</span><span class="ident" id="4783475">bytes</span><span class="op" id="4783480">.</span><span class="ident" id="4783481">Buffer</span><span class="op" id="4783487">,</span>&nbsp;<span class="ident" id="4783489">src</span>&nbsp;<span class="op" id="4783493">[</span><span class="op" id="4783494">]</span><span class="builtintype" id="4783495">byte</span><span class="op" id="4783499">)</span>&nbsp;<span class="op" id="4783501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4783504">//&nbsp;The&nbsp;characters&nbsp;can&nbsp;only&nbsp;appear&nbsp;in&nbsp;string&nbsp;literals,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4783559">//&nbsp;so&nbsp;just&nbsp;scan&nbsp;the&nbsp;string&nbsp;one&nbsp;byte&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4783607">start</span>&nbsp;<span class="op" id="4783613">:=</span>&nbsp;<span class="num" id="4783616">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4783619">for</span>&nbsp;<span class="ident" id="4783623">i</span><span class="op" id="4783624">,</span>&nbsp;<span class="ident" id="4783626">c</span>&nbsp;<span class="op" id="4783628">:=</span>&nbsp;<span class="keyword" id="4783631">range</span>&nbsp;<span class="ident" id="4783637">src</span>&nbsp;<span class="op" id="4783641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4783645">if</span>&nbsp;<span class="ident" id="4783648">c</span>&nbsp;<span class="op" id="4783650">==</span>&nbsp;<span class="string" id="4783653">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="4783657">||</span>&nbsp;<span class="ident" id="4783660">c</span>&nbsp;<span class="op" id="4783662">==</span>&nbsp;<span class="string" id="4783665">&#39;&gt;&#39;</span>&nbsp;<span class="op" id="4783669">||</span>&nbsp;<span class="ident" id="4783672">c</span>&nbsp;<span class="op" id="4783674">==</span>&nbsp;<span class="string" id="4783677">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="4783681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4783686">if</span>&nbsp;<span class="ident" id="4783689">start</span>&nbsp;<span class="op" id="4783695">&lt;</span>&nbsp;<span class="ident" id="4783697">i</span>&nbsp;<span class="op" id="4783699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4783705">dst</span><span class="op" id="4783708">.</span><span class="ident" id="4783709">Write</span><span class="op" id="4783714">(</span><span class="ident" id="4783715">src</span><span class="op" id="4783718">[</span><span class="ident" id="4783719">start</span><span class="op" id="4783724">:</span><span class="ident" id="4783725">i</span><span class="op" id="4783726">]</span><span class="op" id="4783727">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4783732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4783737">dst</span><span class="op" id="4783740">.</span><span class="ident" id="4783741">WriteString</span><span class="op" id="4783752">(</span><span class="string" id="4783753">`\u00`</span><span class="op" id="4783759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4783764">dst</span><span class="op" id="4783767">.</span><span class="ident" id="4783768">WriteByte</span><span class="op" id="4783777">(</span><span class="ident" id="4783778">hex</span><span class="op" id="4783781">[</span><span class="ident" id="4783782">c</span><span class="op" id="4783783">&gt;&gt;</span><span class="num" id="4783785">4</span><span class="op" id="4783786">]</span><span class="op" id="4783787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4783792">dst</span><span class="op" id="4783795">.</span><span class="ident" id="4783796">WriteByte</span><span class="op" id="4783805">(</span><span class="ident" id="4783806">hex</span><span class="op" id="4783809">[</span><span class="ident" id="4783810">c</span><span class="op" id="4783811">&amp;</span><span class="num" id="4783812">0xF</span><span class="op" id="4783815">]</span><span class="op" id="4783816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4783821">start</span>&nbsp;<span class="op" id="4783827">=</span>&nbsp;<span class="ident" id="4783829">i</span>&nbsp;<span class="op" id="4783831">+</span>&nbsp;<span class="num" id="4783833">1</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4783837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4783841">//&nbsp;Convert&nbsp;U+2028&nbsp;and&nbsp;U+2029&nbsp;(E2&nbsp;80&nbsp;A8&nbsp;and&nbsp;E2&nbsp;80&nbsp;A9).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4783897">if</span>&nbsp;<span class="ident" id="4783900">c</span>&nbsp;<span class="op" id="4783902">==</span>&nbsp;<span class="num" id="4783905">0xE2</span>&nbsp;<span class="op" id="4783910">&amp;&amp;</span>&nbsp;<span class="ident" id="4783913">i</span><span class="op" id="4783914">+</span><span class="num" id="4783915">2</span>&nbsp;<span class="op" id="4783917">&lt;</span>&nbsp;<span class="builtinfunc" id="4783919">len</span><span class="op" id="4783922">(</span><span class="ident" id="4783923">src</span><span class="op" id="4783926">)</span>&nbsp;<span class="op" id="4783928">&amp;&amp;</span>&nbsp;<span class="ident" id="4783931">src</span><span class="op" id="4783934">[</span><span class="ident" id="4783935">i</span><span class="op" id="4783936">+</span><span class="num" id="4783937">1</span><span class="op" id="4783938">]</span>&nbsp;<span class="op" id="4783940">==</span>&nbsp;<span class="num" id="4783943">0x80</span>&nbsp;<span class="op" id="4783948">&amp;&amp;</span>&nbsp;<span class="ident" id="4783951">src</span><span class="op" id="4783954">[</span><span class="ident" id="4783955">i</span><span class="op" id="4783956">+</span><span class="num" id="4783957">2</span><span class="op" id="4783958">]</span><span class="op" id="4783959">&amp;^</span><span class="num" id="4783961">1</span>&nbsp;<span class="op" id="4783963">==</span>&nbsp;<span class="num" id="4783966">0xA8</span>&nbsp;<span class="op" id="4783971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4783976">if</span>&nbsp;<span class="ident" id="4783979">start</span>&nbsp;<span class="op" id="4783985">&lt;</span>&nbsp;<span class="ident" id="4783987">i</span>&nbsp;<span class="op" id="4783989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4783995">dst</span><span class="op" id="4783998">.</span><span class="ident" id="4783999">Write</span><span class="op" id="4784004">(</span><span class="ident" id="4784005">src</span><span class="op" id="4784008">[</span><span class="ident" id="4784009">start</span><span class="op" id="4784014">:</span><span class="ident" id="4784015">i</span><span class="op" id="4784016">]</span><span class="op" id="4784017">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4784022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4784027">dst</span><span class="op" id="4784030">.</span><span class="ident" id="4784031">WriteString</span><span class="op" id="4784042">(</span><span class="string" id="4784043">`\u202`</span><span class="op" id="4784050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4784055">dst</span><span class="op" id="4784058">.</span><span class="ident" id="4784059">WriteByte</span><span class="op" id="4784068">(</span><span class="ident" id="4784069">hex</span><span class="op" id="4784072">[</span><span class="ident" id="4784073">src</span><span class="op" id="4784076">[</span><span class="ident" id="4784077">i</span><span class="op" id="4784078">+</span><span class="num" id="4784079">2</span><span class="op" id="4784080">]</span><span class="op" id="4784081">&amp;</span><span class="num" id="4784082">0xF</span><span class="op" id="4784085">]</span><span class="op" id="4784086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4784091">start</span>&nbsp;<span class="op" id="4784097">=</span>&nbsp;<span class="ident" id="4784099">i</span>&nbsp;<span class="op" id="4784101">+</span>&nbsp;<span class="num" id="4784103">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4784107">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4784110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4784113">if</span>&nbsp;<span class="ident" id="4784116">start</span>&nbsp;<span class="op" id="4784122">&lt;</span>&nbsp;<span class="builtinfunc" id="4784124">len</span><span class="op" id="4784127">(</span><span class="ident" id="4784128">src</span><span class="op" id="4784131">)</span>&nbsp;<span class="op" id="4784133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4784137">dst</span><span class="op" id="4784140">.</span><span class="ident" id="4784141">Write</span><span class="op" id="4784146">(</span><span class="ident" id="4784147">src</span><span class="op" id="4784150">[</span><span class="ident" id="4784151">start</span><span class="op" id="4784156">:</span><span class="op" id="4784157">]</span><span class="op" id="4784158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4784161">}</span><br>
<span class="lineno"></span><span class="op" id="4784163">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment" id="4784166">//&nbsp;Marshaler&nbsp;is&nbsp;the&nbsp;interface&nbsp;implemented&nbsp;by&nbsp;objects&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4784224">//&nbsp;can&nbsp;marshal&nbsp;themselves&nbsp;into&nbsp;valid&nbsp;JSON.</span><br>
<span class="lineno"></span><span class="keyword" id="4784267">type</span>&nbsp;<span class="ident" id="4784272">Marshaler</span>&nbsp;<span class="keyword" id="4784282">interface</span>&nbsp;<span class="op" id="4784292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4784295">MarshalJSON</span><span class="op" id="4784306">(</span><span class="op" id="4784307">)</span>&nbsp;<span class="op" id="4784309">(</span><span class="op" id="4784310">[</span><span class="op" id="4784311">]</span><span class="builtintype" id="4784312">byte</span><span class="op" id="4784316">,</span>&nbsp;<span class="builtintype" id="4784318">error</span><span class="op" id="4784323">)</span><br>
<span class="lineno">195</span><span class="op" id="4784325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4784328">//&nbsp;An&nbsp;UnsupportedTypeError&nbsp;is&nbsp;returned&nbsp;by&nbsp;Marshal&nbsp;when&nbsp;attempting</span><br>
<span class="lineno"></span><span class="comment" id="4784394">//&nbsp;to&nbsp;encode&nbsp;an&nbsp;unsupported&nbsp;value&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="4784434">type</span>&nbsp;<span class="ident" id="4784439">UnsupportedTypeError</span>&nbsp;<span class="keyword" id="4784460">struct</span>&nbsp;<span class="op" id="4784467">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4784470">Type</span>&nbsp;<span class="ident" id="4784475">reflect</span><span class="op" id="4784482">.</span><span class="ident" id="4784483">Type</span><br>
<span class="lineno"></span><span class="op" id="4784488">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4784491">func</span>&nbsp;<span class="op" id="4784496">(</span><span class="ident" id="4784497">e</span>&nbsp;<span class="op" id="4784499">*</span><span class="ident" id="4784500">UnsupportedTypeError</span><span class="op" id="4784520">)</span>&nbsp;<span class="ident" id="4784522">Error</span><span class="op" id="4784527">(</span><span class="op" id="4784528">)</span>&nbsp;<span class="builtintype" id="4784530">string</span>&nbsp;<span class="op" id="4784537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4784540">return</span>&nbsp;<span class="string" id="4784547">&#34;json:&nbsp;unsupported&nbsp;type:&nbsp;&#34;</span>&nbsp;<span class="op" id="4784574">+</span>&nbsp;<span class="ident" id="4784576">e</span><span class="op" id="4784577">.</span><span class="ident" id="4784578">Type</span><span class="op" id="4784582">.</span><span class="ident" id="4784583">String</span><span class="op" id="4784589">(</span><span class="op" id="4784590">)</span><br>
<span class="lineno">205</span><span class="op" id="4784592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4784595">type</span>&nbsp;<span class="ident" id="4784600">UnsupportedValueError</span>&nbsp;<span class="keyword" id="4784622">struct</span>&nbsp;<span class="op" id="4784629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4784632">Value</span>&nbsp;<span class="ident" id="4784638">reflect</span><span class="op" id="4784645">.</span><span class="ident" id="4784646">Value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4784653">Str</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4784659">string</span><br>
<span class="lineno">210</span><span class="op" id="4784666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4784669">func</span>&nbsp;<span class="op" id="4784674">(</span><span class="ident" id="4784675">e</span>&nbsp;<span class="op" id="4784677">*</span><span class="ident" id="4784678">UnsupportedValueError</span><span class="op" id="4784699">)</span>&nbsp;<span class="ident" id="4784701">Error</span><span class="op" id="4784706">(</span><span class="op" id="4784707">)</span>&nbsp;<span class="builtintype" id="4784709">string</span>&nbsp;<span class="op" id="4784716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4784719">return</span>&nbsp;<span class="string" id="4784726">&#34;json:&nbsp;unsupported&nbsp;value:&nbsp;&#34;</span>&nbsp;<span class="op" id="4784754">+</span>&nbsp;<span class="ident" id="4784756">e</span><span class="op" id="4784757">.</span><span class="ident" id="4784758">Str</span><br>
<span class="lineno"></span><span class="op" id="4784762">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="comment" id="4784765">//&nbsp;Before&nbsp;Go&nbsp;1.2,&nbsp;an&nbsp;InvalidUTF8Error&nbsp;was&nbsp;returned&nbsp;by&nbsp;Marshal&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="4784832">//&nbsp;attempting&nbsp;to&nbsp;encode&nbsp;a&nbsp;string&nbsp;value&nbsp;with&nbsp;invalid&nbsp;UTF-8&nbsp;sequences.</span><br>
<span class="lineno"></span><span class="comment" id="4784901">//&nbsp;As&nbsp;of&nbsp;Go&nbsp;1.2,&nbsp;Marshal&nbsp;instead&nbsp;coerces&nbsp;the&nbsp;string&nbsp;to&nbsp;valid&nbsp;UTF-8&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="4784971">//&nbsp;replacing&nbsp;invalid&nbsp;bytes&nbsp;with&nbsp;the&nbsp;Unicode&nbsp;replacement&nbsp;rune&nbsp;U+FFFD.</span><br>
<span class="lineno">220</span><span class="comment" id="4785040">//&nbsp;This&nbsp;error&nbsp;is&nbsp;no&nbsp;longer&nbsp;generated&nbsp;but&nbsp;is&nbsp;kept&nbsp;for&nbsp;backwards&nbsp;compatibility</span><br>
<span class="lineno"></span><span class="comment" id="4785117">//&nbsp;with&nbsp;programs&nbsp;that&nbsp;might&nbsp;mention&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="4785157">type</span>&nbsp;<span class="ident" id="4785162">InvalidUTF8Error</span>&nbsp;<span class="keyword" id="4785179">struct</span>&nbsp;<span class="op" id="4785186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4785189">S</span>&nbsp;<span class="builtintype" id="4785191">string</span>&nbsp;<span class="comment" id="4785198">//&nbsp;the&nbsp;whole&nbsp;string&nbsp;value&nbsp;that&nbsp;caused&nbsp;the&nbsp;error</span><br>
<span class="lineno"></span><span class="op" id="4785246">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="keyword" id="4785249">func</span>&nbsp;<span class="op" id="4785254">(</span><span class="ident" id="4785255">e</span>&nbsp;<span class="op" id="4785257">*</span><span class="ident" id="4785258">InvalidUTF8Error</span><span class="op" id="4785274">)</span>&nbsp;<span class="ident" id="4785276">Error</span><span class="op" id="4785281">(</span><span class="op" id="4785282">)</span>&nbsp;<span class="builtintype" id="4785284">string</span>&nbsp;<span class="op" id="4785291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4785294">return</span>&nbsp;<span class="string" id="4785301">&#34;json:&nbsp;invalid&nbsp;UTF-8&nbsp;in&nbsp;string:&nbsp;&#34;</span>&nbsp;<span class="op" id="4785335">+</span>&nbsp;<span class="ident" id="4785337">strconv</span><span class="op" id="4785344">.</span><span class="ident" id="4785345">Quote</span><span class="op" id="4785350">(</span><span class="ident" id="4785351">e</span><span class="op" id="4785352">.</span><span class="ident" id="4785353">S</span><span class="op" id="4785354">)</span><br>
<span class="lineno"></span><span class="op" id="4785356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="4785359">type</span>&nbsp;<span class="ident" id="4785364">MarshalerError</span>&nbsp;<span class="keyword" id="4785379">struct</span>&nbsp;<span class="op" id="4785386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4785389">Type</span>&nbsp;<span class="ident" id="4785394">reflect</span><span class="op" id="4785401">.</span><span class="ident" id="4785402">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4785408">Err</span>&nbsp;&nbsp;<span class="builtintype" id="4785413">error</span><br>
<span class="lineno"></span><span class="op" id="4785419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword" id="4785422">func</span>&nbsp;<span class="op" id="4785427">(</span><span class="ident" id="4785428">e</span>&nbsp;<span class="op" id="4785430">*</span><span class="ident" id="4785431">MarshalerError</span><span class="op" id="4785445">)</span>&nbsp;<span class="ident" id="4785447">Error</span><span class="op" id="4785452">(</span><span class="op" id="4785453">)</span>&nbsp;<span class="builtintype" id="4785455">string</span>&nbsp;<span class="op" id="4785462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4785465">return</span>&nbsp;<span class="string" id="4785472">&#34;json:&nbsp;error&nbsp;calling&nbsp;MarshalJSON&nbsp;for&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="4785516">+</span>&nbsp;<span class="ident" id="4785518">e</span><span class="op" id="4785519">.</span><span class="ident" id="4785520">Type</span><span class="op" id="4785524">.</span><span class="ident" id="4785525">String</span><span class="op" id="4785531">(</span><span class="op" id="4785532">)</span>&nbsp;<span class="op" id="4785534">+</span>&nbsp;<span class="string" id="4785536">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="4785541">+</span>&nbsp;<span class="ident" id="4785543">e</span><span class="op" id="4785544">.</span><span class="ident" id="4785545">Err</span><span class="op" id="4785548">.</span><span class="ident" id="4785549">Error</span><span class="op" id="4785554">(</span><span class="op" id="4785555">)</span><br>
<span class="lineno"></span><span class="op" id="4785557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4785560">var</span>&nbsp;<span class="ident" id="4785564">hex</span>&nbsp;<span class="op" id="4785568">=</span>&nbsp;<span class="string" id="4785570">&#34;0123456789abcdef&#34;</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="4785590">//&nbsp;An&nbsp;encodeState&nbsp;encodes&nbsp;JSON&nbsp;into&nbsp;a&nbsp;bytes.Buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="4785642">type</span>&nbsp;<span class="ident" id="4785647">encodeState</span>&nbsp;<span class="keyword" id="4785659">struct</span>&nbsp;<span class="op" id="4785666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4785669">bytes</span><span class="op" id="4785674">.</span><span class="ident" id="4785675">Buffer</span>&nbsp;<span class="comment" id="4785682">//&nbsp;accumulated&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4785705">scratch</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4785718">[</span><span class="num" id="4785719">64</span><span class="op" id="4785721">]</span><span class="builtintype" id="4785722">byte</span><br>
<span class="lineno">245</span><span class="op" id="4785727">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4785730">var</span>&nbsp;<span class="ident" id="4785734">encodeStatePool</span>&nbsp;<span class="ident" id="4785750">sync</span><span class="op" id="4785754">.</span><span class="ident" id="4785755">Pool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4785761">func</span>&nbsp;<span class="ident" id="4785766">newEncodeState</span><span class="op" id="4785780">(</span><span class="op" id="4785781">)</span>&nbsp;<span class="op" id="4785783">*</span><span class="ident" id="4785784">encodeState</span>&nbsp;<span class="op" id="4785796">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4785799">if</span>&nbsp;<span class="ident" id="4785802">v</span>&nbsp;<span class="op" id="4785804">:=</span>&nbsp;<span class="ident" id="4785807">encodeStatePool</span><span class="op" id="4785822">.</span><span class="ident" id="4785823">Get</span><span class="op" id="4785826">(</span><span class="op" id="4785827">)</span><span class="op" id="4785828">;</span>&nbsp;<span class="ident" id="4785830">v</span>&nbsp;<span class="op" id="4785832">!=</span>&nbsp;<span class="ident" id="4785835">nil</span>&nbsp;<span class="op" id="4785839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4785843">e</span>&nbsp;<span class="op" id="4785845">:=</span>&nbsp;<span class="ident" id="4785848">v</span><span class="op" id="4785849">.</span><span class="op" id="4785850">(</span><span class="op" id="4785851">*</span><span class="ident" id="4785852">encodeState</span><span class="op" id="4785863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4785867">e</span><span class="op" id="4785868">.</span><span class="ident" id="4785869">Reset</span><span class="op" id="4785874">(</span><span class="op" id="4785875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4785879">return</span>&nbsp;<span class="ident" id="4785886">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4785889">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4785892">return</span>&nbsp;<span class="builtinfunc" id="4785899">new</span><span class="op" id="4785902">(</span><span class="ident" id="4785903">encodeState</span><span class="op" id="4785914">)</span><br>
<span class="lineno"></span><span class="op" id="4785916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4785919">func</span>&nbsp;<span class="op" id="4785924">(</span><span class="ident" id="4785925">e</span>&nbsp;<span class="op" id="4785927">*</span><span class="ident" id="4785928">encodeState</span><span class="op" id="4785939">)</span>&nbsp;<span class="ident" id="4785941">marshal</span><span class="op" id="4785948">(</span><span class="ident" id="4785949">v</span>&nbsp;<span class="keyword" id="4785951">interface</span><span class="op" id="4785960">{</span><span class="op" id="4785961">}</span><span class="op" id="4785962">)</span>&nbsp;<span class="op" id="4785964">(</span><span class="ident" id="4785965">err</span>&nbsp;<span class="builtintype" id="4785969">error</span><span class="op" id="4785974">)</span>&nbsp;<span class="op" id="4785976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4785979">defer</span>&nbsp;<span class="keyword" id="4785985">func</span><span class="op" id="4785989">(</span><span class="op" id="4785990">)</span>&nbsp;<span class="op" id="4785992">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4785996">if</span>&nbsp;<span class="ident" id="4785999">r</span>&nbsp;<span class="op" id="4786001">:=</span>&nbsp;<span class="builtinfunc" id="4786004">recover</span><span class="op" id="4786011">(</span><span class="op" id="4786012">)</span><span class="op" id="4786013">;</span>&nbsp;<span class="ident" id="4786015">r</span>&nbsp;<span class="op" id="4786017">!=</span>&nbsp;<span class="ident" id="4786020">nil</span>&nbsp;<span class="op" id="4786024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4786029">if</span>&nbsp;<span class="ident" id="4786032">_</span><span class="op" id="4786033">,</span>&nbsp;<span class="ident" id="4786035">ok</span>&nbsp;<span class="op" id="4786038">:=</span>&nbsp;<span class="ident" id="4786041">r</span><span class="op" id="4786042">.</span><span class="op" id="4786043">(</span><span class="ident" id="4786044">runtime</span><span class="op" id="4786051">.</span><span class="ident" id="4786052">Error</span><span class="op" id="4786057">)</span><span class="op" id="4786058">;</span>&nbsp;<span class="ident" id="4786060">ok</span>&nbsp;<span class="op" id="4786063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4786069">panic</span><span class="op" id="4786074">(</span><span class="ident" id="4786075">r</span><span class="op" id="4786076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4786081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4786086">if</span>&nbsp;<span class="ident" id="4786089">s</span><span class="op" id="4786090">,</span>&nbsp;<span class="ident" id="4786092">ok</span>&nbsp;<span class="op" id="4786095">:=</span>&nbsp;<span class="ident" id="4786098">r</span><span class="op" id="4786099">.</span><span class="op" id="4786100">(</span><span class="builtintype" id="4786101">string</span><span class="op" id="4786107">)</span><span class="op" id="4786108">;</span>&nbsp;<span class="ident" id="4786110">ok</span>&nbsp;<span class="op" id="4786113">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4786119">panic</span><span class="op" id="4786124">(</span><span class="ident" id="4786125">s</span><span class="op" id="4786126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4786131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4786136">err</span>&nbsp;<span class="op" id="4786140">=</span>&nbsp;<span class="ident" id="4786142">r</span><span class="op" id="4786143">.</span><span class="op" id="4786144">(</span><span class="builtintype" id="4786145">error</span><span class="op" id="4786150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4786154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4786157">}</span><span class="op" id="4786158">(</span><span class="op" id="4786159">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4786162">e</span><span class="op" id="4786163">.</span><span class="ident" id="4786164">reflectValue</span><span class="op" id="4786176">(</span><span class="ident" id="4786177">reflect</span><span class="op" id="4786184">.</span><span class="ident" id="4786185">ValueOf</span><span class="op" id="4786192">(</span><span class="ident" id="4786193">v</span><span class="op" id="4786194">)</span><span class="op" id="4786195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4786198">return</span>&nbsp;<span class="ident" id="4786205">nil</span><br>
<span class="lineno"></span><span class="op" id="4786209">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4786212">func</span>&nbsp;<span class="op" id="4786217">(</span><span class="ident" id="4786218">e</span>&nbsp;<span class="op" id="4786220">*</span><span class="ident" id="4786221">encodeState</span><span class="op" id="4786232">)</span>&nbsp;<span class="builtintype" id="4786234">error</span><span class="op" id="4786239">(</span><span class="ident" id="4786240">err</span>&nbsp;<span class="builtintype" id="4786244">error</span><span class="op" id="4786249">)</span>&nbsp;<span class="op" id="4786251">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4786254">panic</span><span class="op" id="4786259">(</span><span class="ident" id="4786260">err</span><span class="op" id="4786263">)</span><br>
<span class="lineno"></span><span class="op" id="4786265">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4786268">var</span>&nbsp;<span class="ident" id="4786272">byteSliceType</span>&nbsp;<span class="op" id="4786286">=</span>&nbsp;<span class="ident" id="4786288">reflect</span><span class="op" id="4786295">.</span><span class="ident" id="4786296">TypeOf</span><span class="op" id="4786302">(</span><span class="op" id="4786303">[</span><span class="op" id="4786304">]</span><span class="builtintype" id="4786305">byte</span><span class="op" id="4786309">(</span><span class="ident" id="4786310">nil</span><span class="op" id="4786313">)</span><span class="op" id="4786314">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="4786317">func</span>&nbsp;<span class="ident" id="4786322">isEmptyValue</span><span class="op" id="4786334">(</span><span class="ident" id="4786335">v</span>&nbsp;<span class="ident" id="4786337">reflect</span><span class="op" id="4786344">.</span><span class="ident" id="4786345">Value</span><span class="op" id="4786350">)</span>&nbsp;<span class="builtintype" id="4786352">bool</span>&nbsp;<span class="op" id="4786357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4786360">switch</span>&nbsp;<span class="ident" id="4786367">v</span><span class="op" id="4786368">.</span><span class="ident" id="4786369">Kind</span><span class="op" id="4786373">(</span><span class="op" id="4786374">)</span>&nbsp;<span class="op" id="4786376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4786379">case</span>&nbsp;<span class="ident" id="4786384">reflect</span><span class="op" id="4786391">.</span><span class="ident" id="4786392">Array</span><span class="op" id="4786397">,</span>&nbsp;<span class="ident" id="4786399">reflect</span><span class="op" id="4786406">.</span><span class="ident" id="4786407">Map</span><span class="op" id="4786410">,</span>&nbsp;<span class="ident" id="4786412">reflect</span><span class="op" id="4786419">.</span><span class="ident" id="4786420">Slice</span><span class="op" id="4786425">,</span>&nbsp;<span class="ident" id="4786427">reflect</span><span class="op" id="4786434">.</span><span class="ident" id="4786435">String</span><span class="op" id="4786441">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4786445">return</span>&nbsp;<span class="ident" id="4786452">v</span><span class="op" id="4786453">.</span><span class="ident" id="4786454">Len</span><span class="op" id="4786457">(</span><span class="op" id="4786458">)</span>&nbsp;<span class="op" id="4786460">==</span>&nbsp;<span class="num" id="4786463">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4786466">case</span>&nbsp;<span class="ident" id="4786471">reflect</span><span class="op" id="4786478">.</span><span class="ident" id="4786479">Bool</span><span class="op" id="4786483">:</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4786487">return</span>&nbsp;<span class="op" id="4786494">!</span><span class="ident" id="4786495">v</span><span class="op" id="4786496">.</span><span class="ident" id="4786497">Bool</span><span class="op" id="4786501">(</span><span class="op" id="4786502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4786505">case</span>&nbsp;<span class="ident" id="4786510">reflect</span><span class="op" id="4786517">.</span><span class="ident" id="4786518">Int</span><span class="op" id="4786521">,</span>&nbsp;<span class="ident" id="4786523">reflect</span><span class="op" id="4786530">.</span><span class="ident" id="4786531">Int8</span><span class="op" id="4786535">,</span>&nbsp;<span class="ident" id="4786537">reflect</span><span class="op" id="4786544">.</span><span class="ident" id="4786545">Int16</span><span class="op" id="4786550">,</span>&nbsp;<span class="ident" id="4786552">reflect</span><span class="op" id="4786559">.</span><span class="ident" id="4786560">Int32</span><span class="op" id="4786565">,</span>&nbsp;<span class="ident" id="4786567">reflect</span><span class="op" id="4786574">.</span><span class="ident" id="4786575">Int64</span><span class="op" id="4786580">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4786584">return</span>&nbsp;<span class="ident" id="4786591">v</span><span class="op" id="4786592">.</span><span class="ident" id="4786593">Int</span><span class="op" id="4786596">(</span><span class="op" id="4786597">)</span>&nbsp;<span class="op" id="4786599">==</span>&nbsp;<span class="num" id="4786602">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4786605">case</span>&nbsp;<span class="ident" id="4786610">reflect</span><span class="op" id="4786617">.</span><span class="ident" id="4786618">Uint</span><span class="op" id="4786622">,</span>&nbsp;<span class="ident" id="4786624">reflect</span><span class="op" id="4786631">.</span><span class="ident" id="4786632">Uint8</span><span class="op" id="4786637">,</span>&nbsp;<span class="ident" id="4786639">reflect</span><span class="op" id="4786646">.</span><span class="ident" id="4786647">Uint16</span><span class="op" id="4786653">,</span>&nbsp;<span class="ident" id="4786655">reflect</span><span class="op" id="4786662">.</span><span class="ident" id="4786663">Uint32</span><span class="op" id="4786669">,</span>&nbsp;<span class="ident" id="4786671">reflect</span><span class="op" id="4786678">.</span><span class="ident" id="4786679">Uint64</span><span class="op" id="4786685">,</span>&nbsp;<span class="ident" id="4786687">reflect</span><span class="op" id="4786694">.</span><span class="ident" id="4786695">Uintptr</span><span class="op" id="4786702">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4786706">return</span>&nbsp;<span class="ident" id="4786713">v</span><span class="op" id="4786714">.</span><span class="ident" id="4786715">Uint</span><span class="op" id="4786719">(</span><span class="op" id="4786720">)</span>&nbsp;<span class="op" id="4786722">==</span>&nbsp;<span class="num" id="4786725">0</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4786728">case</span>&nbsp;<span class="ident" id="4786733">reflect</span><span class="op" id="4786740">.</span><span class="ident" id="4786741">Float32</span><span class="op" id="4786748">,</span>&nbsp;<span class="ident" id="4786750">reflect</span><span class="op" id="4786757">.</span><span class="ident" id="4786758">Float64</span><span class="op" id="4786765">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4786769">return</span>&nbsp;<span class="ident" id="4786776">v</span><span class="op" id="4786777">.</span><span class="ident" id="4786778">Float</span><span class="op" id="4786783">(</span><span class="op" id="4786784">)</span>&nbsp;<span class="op" id="4786786">==</span>&nbsp;<span class="num" id="4786789">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4786792">case</span>&nbsp;<span class="ident" id="4786797">reflect</span><span class="op" id="4786804">.</span><span class="ident" id="4786805">Interface</span><span class="op" id="4786814">,</span>&nbsp;<span class="ident" id="4786816">reflect</span><span class="op" id="4786823">.</span><span class="ident" id="4786824">Ptr</span><span class="op" id="4786827">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4786831">return</span>&nbsp;<span class="ident" id="4786838">v</span><span class="op" id="4786839">.</span><span class="ident" id="4786840">IsNil</span><span class="op" id="4786845">(</span><span class="op" id="4786846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4786849">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4786852">return</span>&nbsp;<span class="builtintype" id="4786859">false</span><br>
<span class="lineno"></span><span class="op" id="4786865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4786868">func</span>&nbsp;<span class="op" id="4786873">(</span><span class="ident" id="4786874">e</span>&nbsp;<span class="op" id="4786876">*</span><span class="ident" id="4786877">encodeState</span><span class="op" id="4786888">)</span>&nbsp;<span class="ident" id="4786890">reflectValue</span><span class="op" id="4786902">(</span><span class="ident" id="4786903">v</span>&nbsp;<span class="ident" id="4786905">reflect</span><span class="op" id="4786912">.</span><span class="ident" id="4786913">Value</span><span class="op" id="4786918">)</span>&nbsp;<span class="op" id="4786920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4786923">valueEncoder</span><span class="op" id="4786935">(</span><span class="ident" id="4786936">v</span><span class="op" id="4786937">)</span><span class="op" id="4786938">(</span><span class="ident" id="4786939">e</span><span class="op" id="4786940">,</span>&nbsp;<span class="ident" id="4786942">v</span><span class="op" id="4786943">,</span>&nbsp;<span class="builtintype" id="4786945">false</span><span class="op" id="4786950">)</span><br>
<span class="lineno">300</span><span class="op" id="4786952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4786955">type</span>&nbsp;<span class="ident" id="4786960">encoderFunc</span>&nbsp;<span class="keyword" id="4786972">func</span><span class="op" id="4786976">(</span><span class="ident" id="4786977">e</span>&nbsp;<span class="op" id="4786979">*</span><span class="ident" id="4786980">encodeState</span><span class="op" id="4786991">,</span>&nbsp;<span class="ident" id="4786993">v</span>&nbsp;<span class="ident" id="4786995">reflect</span><span class="op" id="4787002">.</span><span class="ident" id="4787003">Value</span><span class="op" id="4787008">,</span>&nbsp;<span class="ident" id="4787010">quoted</span>&nbsp;<span class="builtintype" id="4787017">bool</span><span class="op" id="4787021">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4787024">var</span>&nbsp;<span class="ident" id="4787028">encoderCache</span>&nbsp;<span class="keyword" id="4787041">struct</span>&nbsp;<span class="op" id="4787048">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4787051">sync</span><span class="op" id="4787055">.</span><span class="ident" id="4787056">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4787065">m</span>&nbsp;<span class="keyword" id="4787067">map</span><span class="op" id="4787070">[</span><span class="ident" id="4787071">reflect</span><span class="op" id="4787078">.</span><span class="ident" id="4787079">Type</span><span class="op" id="4787083">]</span><span class="ident" id="4787084">encoderFunc</span><br>
<span class="lineno"></span><span class="op" id="4787096">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4787099">func</span>&nbsp;<span class="ident" id="4787104">valueEncoder</span><span class="op" id="4787116">(</span><span class="ident" id="4787117">v</span>&nbsp;<span class="ident" id="4787119">reflect</span><span class="op" id="4787126">.</span><span class="ident" id="4787127">Value</span><span class="op" id="4787132">)</span>&nbsp;<span class="ident" id="4787134">encoderFunc</span>&nbsp;<span class="op" id="4787146">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4787149">if</span>&nbsp;<span class="op" id="4787152">!</span><span class="ident" id="4787153">v</span><span class="op" id="4787154">.</span><span class="ident" id="4787155">IsValid</span><span class="op" id="4787162">(</span><span class="op" id="4787163">)</span>&nbsp;<span class="op" id="4787165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4787169">return</span>&nbsp;<span class="ident" id="4787176">invalidValueEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4787197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4787200">return</span>&nbsp;<span class="ident" id="4787207">typeEncoder</span><span class="op" id="4787218">(</span><span class="ident" id="4787219">v</span><span class="op" id="4787220">.</span><span class="ident" id="4787221">Type</span><span class="op" id="4787225">(</span><span class="op" id="4787226">)</span><span class="op" id="4787227">)</span><br>
<span class="lineno"></span><span class="op" id="4787229">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="keyword" id="4787232">func</span>&nbsp;<span class="ident" id="4787237">typeEncoder</span><span class="op" id="4787248">(</span><span class="ident" id="4787249">t</span>&nbsp;<span class="ident" id="4787251">reflect</span><span class="op" id="4787258">.</span><span class="ident" id="4787259">Type</span><span class="op" id="4787263">)</span>&nbsp;<span class="ident" id="4787265">encoderFunc</span>&nbsp;<span class="op" id="4787277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4787280">encoderCache</span><span class="op" id="4787292">.</span><span class="ident" id="4787293">RLock</span><span class="op" id="4787298">(</span><span class="op" id="4787299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4787302">f</span>&nbsp;<span class="op" id="4787304">:=</span>&nbsp;<span class="ident" id="4787307">encoderCache</span><span class="op" id="4787319">.</span><span class="ident" id="4787320">m</span><span class="op" id="4787321">[</span><span class="ident" id="4787322">t</span><span class="op" id="4787323">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4787326">encoderCache</span><span class="op" id="4787338">.</span><span class="ident" id="4787339">RUnlock</span><span class="op" id="4787346">(</span><span class="op" id="4787347">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4787350">if</span>&nbsp;<span class="ident" id="4787353">f</span>&nbsp;<span class="op" id="4787355">!=</span>&nbsp;<span class="ident" id="4787358">nil</span>&nbsp;<span class="op" id="4787362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4787366">return</span>&nbsp;<span class="ident" id="4787373">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4787376">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4787380">//&nbsp;To&nbsp;deal&nbsp;with&nbsp;recursive&nbsp;types,&nbsp;populate&nbsp;the&nbsp;map&nbsp;with&nbsp;an</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4787439">//&nbsp;indirect&nbsp;func&nbsp;before&nbsp;we&nbsp;build&nbsp;it.&nbsp;This&nbsp;type&nbsp;waits&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4787500">//&nbsp;real&nbsp;func&nbsp;(f)&nbsp;to&nbsp;be&nbsp;ready&nbsp;and&nbsp;then&nbsp;calls&nbsp;it.&nbsp;&nbsp;This&nbsp;indirect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4787564">//&nbsp;func&nbsp;is&nbsp;only&nbsp;used&nbsp;for&nbsp;recursive&nbsp;types.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4787607">encoderCache</span><span class="op" id="4787619">.</span><span class="ident" id="4787620">Lock</span><span class="op" id="4787624">(</span><span class="op" id="4787625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4787628">if</span>&nbsp;<span class="ident" id="4787631">encoderCache</span><span class="op" id="4787643">.</span><span class="ident" id="4787644">m</span>&nbsp;<span class="op" id="4787646">==</span>&nbsp;<span class="ident" id="4787649">nil</span>&nbsp;<span class="op" id="4787653">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4787657">encoderCache</span><span class="op" id="4787669">.</span><span class="ident" id="4787670">m</span>&nbsp;<span class="op" id="4787672">=</span>&nbsp;<span class="builtinfunc" id="4787674">make</span><span class="op" id="4787678">(</span><span class="keyword" id="4787679">map</span><span class="op" id="4787682">[</span><span class="ident" id="4787683">reflect</span><span class="op" id="4787690">.</span><span class="ident" id="4787691">Type</span><span class="op" id="4787695">]</span><span class="ident" id="4787696">encoderFunc</span><span class="op" id="4787707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4787710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4787713">var</span>&nbsp;<span class="ident" id="4787717">wg</span>&nbsp;<span class="ident" id="4787720">sync</span><span class="op" id="4787724">.</span><span class="ident" id="4787725">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4787736">wg</span><span class="op" id="4787738">.</span><span class="ident" id="4787739">Add</span><span class="op" id="4787742">(</span><span class="num" id="4787743">1</span><span class="op" id="4787744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4787747">encoderCache</span><span class="op" id="4787759">.</span><span class="ident" id="4787760">m</span><span class="op" id="4787761">[</span><span class="ident" id="4787762">t</span><span class="op" id="4787763">]</span>&nbsp;<span class="op" id="4787765">=</span>&nbsp;<span class="keyword" id="4787767">func</span><span class="op" id="4787771">(</span><span class="ident" id="4787772">e</span>&nbsp;<span class="op" id="4787774">*</span><span class="ident" id="4787775">encodeState</span><span class="op" id="4787786">,</span>&nbsp;<span class="ident" id="4787788">v</span>&nbsp;<span class="ident" id="4787790">reflect</span><span class="op" id="4787797">.</span><span class="ident" id="4787798">Value</span><span class="op" id="4787803">,</span>&nbsp;<span class="ident" id="4787805">quoted</span>&nbsp;<span class="builtintype" id="4787812">bool</span><span class="op" id="4787816">)</span>&nbsp;<span class="op" id="4787818">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4787822">wg</span><span class="op" id="4787824">.</span><span class="ident" id="4787825">Wait</span><span class="op" id="4787829">(</span><span class="op" id="4787830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4787834">f</span><span class="op" id="4787835">(</span><span class="ident" id="4787836">e</span><span class="op" id="4787837">,</span>&nbsp;<span class="ident" id="4787839">v</span><span class="op" id="4787840">,</span>&nbsp;<span class="ident" id="4787842">quoted</span><span class="op" id="4787848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4787851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4787854">encoderCache</span><span class="op" id="4787866">.</span><span class="ident" id="4787867">Unlock</span><span class="op" id="4787873">(</span><span class="op" id="4787874">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4787878">//&nbsp;Compute&nbsp;fields&nbsp;without&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4787911">//&nbsp;Might&nbsp;duplicate&nbsp;effort&nbsp;but&nbsp;won&#39;t&nbsp;hold&nbsp;other&nbsp;computations&nbsp;back.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4787978">f</span>&nbsp;<span class="op" id="4787980">=</span>&nbsp;<span class="ident" id="4787982">newTypeEncoder</span><span class="op" id="4787996">(</span><span class="ident" id="4787997">t</span><span class="op" id="4787998">,</span>&nbsp;<span class="builtintype" id="4788000">true</span><span class="op" id="4788004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4788007">wg</span><span class="op" id="4788009">.</span><span class="ident" id="4788010">Done</span><span class="op" id="4788014">(</span><span class="op" id="4788015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4788018">encoderCache</span><span class="op" id="4788030">.</span><span class="ident" id="4788031">Lock</span><span class="op" id="4788035">(</span><span class="op" id="4788036">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4788039">encoderCache</span><span class="op" id="4788051">.</span><span class="ident" id="4788052">m</span><span class="op" id="4788053">[</span><span class="ident" id="4788054">t</span><span class="op" id="4788055">]</span>&nbsp;<span class="op" id="4788057">=</span>&nbsp;<span class="ident" id="4788059">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4788062">encoderCache</span><span class="op" id="4788074">.</span><span class="ident" id="4788075">Unlock</span><span class="op" id="4788081">(</span><span class="op" id="4788082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4788085">return</span>&nbsp;<span class="ident" id="4788092">f</span><br>
<span class="lineno"></span><span class="op" id="4788094">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span><span class="keyword" id="4788097">var</span>&nbsp;<span class="op" id="4788101">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4788104">marshalerType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4788122">=</span>&nbsp;<span class="ident" id="4788124">reflect</span><span class="op" id="4788131">.</span><span class="ident" id="4788132">TypeOf</span><span class="op" id="4788138">(</span><span class="builtinfunc" id="4788139">new</span><span class="op" id="4788142">(</span><span class="ident" id="4788143">Marshaler</span><span class="op" id="4788152">)</span><span class="op" id="4788153">)</span><span class="op" id="4788154">.</span><span class="ident" id="4788155">Elem</span><span class="op" id="4788159">(</span><span class="op" id="4788160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4788163">textMarshalerType</span>&nbsp;<span class="op" id="4788181">=</span>&nbsp;<span class="ident" id="4788183">reflect</span><span class="op" id="4788190">.</span><span class="ident" id="4788191">TypeOf</span><span class="op" id="4788197">(</span><span class="builtinfunc" id="4788198">new</span><span class="op" id="4788201">(</span><span class="ident" id="4788202">encoding</span><span class="op" id="4788210">.</span><span class="ident" id="4788211">TextMarshaler</span><span class="op" id="4788224">)</span><span class="op" id="4788225">)</span><span class="op" id="4788226">.</span><span class="ident" id="4788227">Elem</span><span class="op" id="4788231">(</span><span class="op" id="4788232">)</span><br>
<span class="lineno"></span><span class="op" id="4788234">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="4788237">//&nbsp;newTypeEncoder&nbsp;constructs&nbsp;an&nbsp;encoderFunc&nbsp;for&nbsp;a&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="4788293">//&nbsp;The&nbsp;returned&nbsp;encoder&nbsp;only&nbsp;checks&nbsp;CanAddr&nbsp;when&nbsp;allowAddr&nbsp;is&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="4788361">func</span>&nbsp;<span class="ident" id="4788366">newTypeEncoder</span><span class="op" id="4788380">(</span><span class="ident" id="4788381">t</span>&nbsp;<span class="ident" id="4788383">reflect</span><span class="op" id="4788390">.</span><span class="ident" id="4788391">Type</span><span class="op" id="4788395">,</span>&nbsp;<span class="ident" id="4788397">allowAddr</span>&nbsp;<span class="builtintype" id="4788407">bool</span><span class="op" id="4788411">)</span>&nbsp;<span class="ident" id="4788413">encoderFunc</span>&nbsp;<span class="op" id="4788425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4788428">if</span>&nbsp;<span class="ident" id="4788431">t</span><span class="op" id="4788432">.</span><span class="ident" id="4788433">Implements</span><span class="op" id="4788443">(</span><span class="ident" id="4788444">marshalerType</span><span class="op" id="4788457">)</span>&nbsp;<span class="op" id="4788459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4788463">return</span>&nbsp;<span class="ident" id="4788470">marshalerEncoder</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4788488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4788491">if</span>&nbsp;<span class="ident" id="4788494">t</span><span class="op" id="4788495">.</span><span class="ident" id="4788496">Kind</span><span class="op" id="4788500">(</span><span class="op" id="4788501">)</span>&nbsp;<span class="op" id="4788503">!=</span>&nbsp;<span class="ident" id="4788506">reflect</span><span class="op" id="4788513">.</span><span class="ident" id="4788514">Ptr</span>&nbsp;<span class="op" id="4788518">&amp;&amp;</span>&nbsp;<span class="ident" id="4788521">allowAddr</span>&nbsp;<span class="op" id="4788531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4788535">if</span>&nbsp;<span class="ident" id="4788538">reflect</span><span class="op" id="4788545">.</span><span class="ident" id="4788546">PtrTo</span><span class="op" id="4788551">(</span><span class="ident" id="4788552">t</span><span class="op" id="4788553">)</span><span class="op" id="4788554">.</span><span class="ident" id="4788555">Implements</span><span class="op" id="4788565">(</span><span class="ident" id="4788566">marshalerType</span><span class="op" id="4788579">)</span>&nbsp;<span class="op" id="4788581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4788586">return</span>&nbsp;<span class="ident" id="4788593">newCondAddrEncoder</span><span class="op" id="4788611">(</span><span class="ident" id="4788612">addrMarshalerEncoder</span><span class="op" id="4788632">,</span>&nbsp;<span class="ident" id="4788634">newTypeEncoder</span><span class="op" id="4788648">(</span><span class="ident" id="4788649">t</span><span class="op" id="4788650">,</span>&nbsp;<span class="builtintype" id="4788652">false</span><span class="op" id="4788657">)</span><span class="op" id="4788658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4788662">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4788665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4788669">if</span>&nbsp;<span class="ident" id="4788672">t</span><span class="op" id="4788673">.</span><span class="ident" id="4788674">Implements</span><span class="op" id="4788684">(</span><span class="ident" id="4788685">textMarshalerType</span><span class="op" id="4788702">)</span>&nbsp;<span class="op" id="4788704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4788708">return</span>&nbsp;<span class="ident" id="4788715">textMarshalerEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4788737">}</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4788740">if</span>&nbsp;<span class="ident" id="4788743">t</span><span class="op" id="4788744">.</span><span class="ident" id="4788745">Kind</span><span class="op" id="4788749">(</span><span class="op" id="4788750">)</span>&nbsp;<span class="op" id="4788752">!=</span>&nbsp;<span class="ident" id="4788755">reflect</span><span class="op" id="4788762">.</span><span class="ident" id="4788763">Ptr</span>&nbsp;<span class="op" id="4788767">&amp;&amp;</span>&nbsp;<span class="ident" id="4788770">allowAddr</span>&nbsp;<span class="op" id="4788780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4788784">if</span>&nbsp;<span class="ident" id="4788787">reflect</span><span class="op" id="4788794">.</span><span class="ident" id="4788795">PtrTo</span><span class="op" id="4788800">(</span><span class="ident" id="4788801">t</span><span class="op" id="4788802">)</span><span class="op" id="4788803">.</span><span class="ident" id="4788804">Implements</span><span class="op" id="4788814">(</span><span class="ident" id="4788815">textMarshalerType</span><span class="op" id="4788832">)</span>&nbsp;<span class="op" id="4788834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4788839">return</span>&nbsp;<span class="ident" id="4788846">newCondAddrEncoder</span><span class="op" id="4788864">(</span><span class="ident" id="4788865">addrTextMarshalerEncoder</span><span class="op" id="4788889">,</span>&nbsp;<span class="ident" id="4788891">newTypeEncoder</span><span class="op" id="4788905">(</span><span class="ident" id="4788906">t</span><span class="op" id="4788907">,</span>&nbsp;<span class="builtintype" id="4788909">false</span><span class="op" id="4788914">)</span><span class="op" id="4788915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4788919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4788922">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4788926">switch</span>&nbsp;<span class="ident" id="4788933">t</span><span class="op" id="4788934">.</span><span class="ident" id="4788935">Kind</span><span class="op" id="4788939">(</span><span class="op" id="4788940">)</span>&nbsp;<span class="op" id="4788942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4788945">case</span>&nbsp;<span class="ident" id="4788950">reflect</span><span class="op" id="4788957">.</span><span class="ident" id="4788958">Bool</span><span class="op" id="4788962">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4788966">return</span>&nbsp;<span class="ident" id="4788973">boolEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4788986">case</span>&nbsp;<span class="ident" id="4788991">reflect</span><span class="op" id="4788998">.</span><span class="ident" id="4788999">Int</span><span class="op" id="4789002">,</span>&nbsp;<span class="ident" id="4789004">reflect</span><span class="op" id="4789011">.</span><span class="ident" id="4789012">Int8</span><span class="op" id="4789016">,</span>&nbsp;<span class="ident" id="4789018">reflect</span><span class="op" id="4789025">.</span><span class="ident" id="4789026">Int16</span><span class="op" id="4789031">,</span>&nbsp;<span class="ident" id="4789033">reflect</span><span class="op" id="4789040">.</span><span class="ident" id="4789041">Int32</span><span class="op" id="4789046">,</span>&nbsp;<span class="ident" id="4789048">reflect</span><span class="op" id="4789055">.</span><span class="ident" id="4789056">Int64</span><span class="op" id="4789061">:</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4789065">return</span>&nbsp;<span class="ident" id="4789072">intEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4789084">case</span>&nbsp;<span class="ident" id="4789089">reflect</span><span class="op" id="4789096">.</span><span class="ident" id="4789097">Uint</span><span class="op" id="4789101">,</span>&nbsp;<span class="ident" id="4789103">reflect</span><span class="op" id="4789110">.</span><span class="ident" id="4789111">Uint8</span><span class="op" id="4789116">,</span>&nbsp;<span class="ident" id="4789118">reflect</span><span class="op" id="4789125">.</span><span class="ident" id="4789126">Uint16</span><span class="op" id="4789132">,</span>&nbsp;<span class="ident" id="4789134">reflect</span><span class="op" id="4789141">.</span><span class="ident" id="4789142">Uint32</span><span class="op" id="4789148">,</span>&nbsp;<span class="ident" id="4789150">reflect</span><span class="op" id="4789157">.</span><span class="ident" id="4789158">Uint64</span><span class="op" id="4789164">,</span>&nbsp;<span class="ident" id="4789166">reflect</span><span class="op" id="4789173">.</span><span class="ident" id="4789174">Uintptr</span><span class="op" id="4789181">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4789185">return</span>&nbsp;<span class="ident" id="4789192">uintEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4789205">case</span>&nbsp;<span class="ident" id="4789210">reflect</span><span class="op" id="4789217">.</span><span class="ident" id="4789218">Float32</span><span class="op" id="4789225">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4789229">return</span>&nbsp;<span class="ident" id="4789236">float32Encoder</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4789252">case</span>&nbsp;<span class="ident" id="4789257">reflect</span><span class="op" id="4789264">.</span><span class="ident" id="4789265">Float64</span><span class="op" id="4789272">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4789276">return</span>&nbsp;<span class="ident" id="4789283">float64Encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4789299">case</span>&nbsp;<span class="ident" id="4789304">reflect</span><span class="op" id="4789311">.</span><span class="ident" id="4789312">String</span><span class="op" id="4789318">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4789322">return</span>&nbsp;<span class="ident" id="4789329">stringEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4789344">case</span>&nbsp;<span class="ident" id="4789349">reflect</span><span class="op" id="4789356">.</span><span class="ident" id="4789357">Interface</span><span class="op" id="4789366">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4789370">return</span>&nbsp;<span class="ident" id="4789377">interfaceEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4789395">case</span>&nbsp;<span class="ident" id="4789400">reflect</span><span class="op" id="4789407">.</span><span class="ident" id="4789408">Struct</span><span class="op" id="4789414">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4789418">return</span>&nbsp;<span class="ident" id="4789425">newStructEncoder</span><span class="op" id="4789441">(</span><span class="ident" id="4789442">t</span><span class="op" id="4789443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4789446">case</span>&nbsp;<span class="ident" id="4789451">reflect</span><span class="op" id="4789458">.</span><span class="ident" id="4789459">Map</span><span class="op" id="4789462">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4789466">return</span>&nbsp;<span class="ident" id="4789473">newMapEncoder</span><span class="op" id="4789486">(</span><span class="ident" id="4789487">t</span><span class="op" id="4789488">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4789491">case</span>&nbsp;<span class="ident" id="4789496">reflect</span><span class="op" id="4789503">.</span><span class="ident" id="4789504">Slice</span><span class="op" id="4789509">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4789513">return</span>&nbsp;<span class="ident" id="4789520">newSliceEncoder</span><span class="op" id="4789535">(</span><span class="ident" id="4789536">t</span><span class="op" id="4789537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4789540">case</span>&nbsp;<span class="ident" id="4789545">reflect</span><span class="op" id="4789552">.</span><span class="ident" id="4789553">Array</span><span class="op" id="4789558">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4789562">return</span>&nbsp;<span class="ident" id="4789569">newArrayEncoder</span><span class="op" id="4789584">(</span><span class="ident" id="4789585">t</span><span class="op" id="4789586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4789589">case</span>&nbsp;<span class="ident" id="4789594">reflect</span><span class="op" id="4789601">.</span><span class="ident" id="4789602">Ptr</span><span class="op" id="4789605">:</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4789609">return</span>&nbsp;<span class="ident" id="4789616">newPtrEncoder</span><span class="op" id="4789629">(</span><span class="ident" id="4789630">t</span><span class="op" id="4789631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4789634">default</span><span class="op" id="4789641">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4789645">return</span>&nbsp;<span class="ident" id="4789652">unsupportedTypeEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4789676">}</span><br>
<span class="lineno"></span><span class="op" id="4789678">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="keyword" id="4789681">func</span>&nbsp;<span class="ident" id="4789686">invalidValueEncoder</span><span class="op" id="4789705">(</span><span class="ident" id="4789706">e</span>&nbsp;<span class="op" id="4789708">*</span><span class="ident" id="4789709">encodeState</span><span class="op" id="4789720">,</span>&nbsp;<span class="ident" id="4789722">v</span>&nbsp;<span class="ident" id="4789724">reflect</span><span class="op" id="4789731">.</span><span class="ident" id="4789732">Value</span><span class="op" id="4789737">,</span>&nbsp;<span class="ident" id="4789739">quoted</span>&nbsp;<span class="builtintype" id="4789746">bool</span><span class="op" id="4789750">)</span>&nbsp;<span class="op" id="4789752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4789755">e</span><span class="op" id="4789756">.</span><span class="ident" id="4789757">WriteString</span><span class="op" id="4789768">(</span><span class="string" id="4789769">&#34;null&#34;</span><span class="op" id="4789775">)</span><br>
<span class="lineno"></span><span class="op" id="4789777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span><span class="keyword" id="4789780">func</span>&nbsp;<span class="ident" id="4789785">marshalerEncoder</span><span class="op" id="4789801">(</span><span class="ident" id="4789802">e</span>&nbsp;<span class="op" id="4789804">*</span><span class="ident" id="4789805">encodeState</span><span class="op" id="4789816">,</span>&nbsp;<span class="ident" id="4789818">v</span>&nbsp;<span class="ident" id="4789820">reflect</span><span class="op" id="4789827">.</span><span class="ident" id="4789828">Value</span><span class="op" id="4789833">,</span>&nbsp;<span class="ident" id="4789835">quoted</span>&nbsp;<span class="builtintype" id="4789842">bool</span><span class="op" id="4789846">)</span>&nbsp;<span class="op" id="4789848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4789851">if</span>&nbsp;<span class="ident" id="4789854">v</span><span class="op" id="4789855">.</span><span class="ident" id="4789856">Kind</span><span class="op" id="4789860">(</span><span class="op" id="4789861">)</span>&nbsp;<span class="op" id="4789863">==</span>&nbsp;<span class="ident" id="4789866">reflect</span><span class="op" id="4789873">.</span><span class="ident" id="4789874">Ptr</span>&nbsp;<span class="op" id="4789878">&amp;&amp;</span>&nbsp;<span class="ident" id="4789881">v</span><span class="op" id="4789882">.</span><span class="ident" id="4789883">IsNil</span><span class="op" id="4789888">(</span><span class="op" id="4789889">)</span>&nbsp;<span class="op" id="4789891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4789895">e</span><span class="op" id="4789896">.</span><span class="ident" id="4789897">WriteString</span><span class="op" id="4789908">(</span><span class="string" id="4789909">&#34;null&#34;</span><span class="op" id="4789915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4789919">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4789927">}</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4789930">m</span>&nbsp;<span class="op" id="4789932">:=</span>&nbsp;<span class="ident" id="4789935">v</span><span class="op" id="4789936">.</span><span class="ident" id="4789937">Interface</span><span class="op" id="4789946">(</span><span class="op" id="4789947">)</span><span class="op" id="4789948">.</span><span class="op" id="4789949">(</span><span class="ident" id="4789950">Marshaler</span><span class="op" id="4789959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4789962">b</span><span class="op" id="4789963">,</span>&nbsp;<span class="ident" id="4789965">err</span>&nbsp;<span class="op" id="4789969">:=</span>&nbsp;<span class="ident" id="4789972">m</span><span class="op" id="4789973">.</span><span class="ident" id="4789974">MarshalJSON</span><span class="op" id="4789985">(</span><span class="op" id="4789986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4789989">if</span>&nbsp;<span class="ident" id="4789992">err</span>&nbsp;<span class="op" id="4789996">==</span>&nbsp;<span class="ident" id="4789999">nil</span>&nbsp;<span class="op" id="4790003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4790007">//&nbsp;copy&nbsp;JSON&nbsp;into&nbsp;buffer,&nbsp;checking&nbsp;validity.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4790054">err</span>&nbsp;<span class="op" id="4790058">=</span>&nbsp;<span class="ident" id="4790060">compact</span><span class="op" id="4790067">(</span><span class="op" id="4790068">&amp;</span><span class="ident" id="4790069">e</span><span class="op" id="4790070">.</span><span class="ident" id="4790071">Buffer</span><span class="op" id="4790077">,</span>&nbsp;<span class="ident" id="4790079">b</span><span class="op" id="4790080">,</span>&nbsp;<span class="builtintype" id="4790082">true</span><span class="op" id="4790086">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4790089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4790092">if</span>&nbsp;<span class="ident" id="4790095">err</span>&nbsp;<span class="op" id="4790099">!=</span>&nbsp;<span class="ident" id="4790102">nil</span>&nbsp;<span class="op" id="4790106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4790110">e</span><span class="op" id="4790111">.</span><span class="builtintype" id="4790112">error</span><span class="op" id="4790117">(</span><span class="op" id="4790118">&amp;</span><span class="ident" id="4790119">MarshalerError</span><span class="op" id="4790133">{</span><span class="ident" id="4790134">v</span><span class="op" id="4790135">.</span><span class="ident" id="4790136">Type</span><span class="op" id="4790140">(</span><span class="op" id="4790141">)</span><span class="op" id="4790142">,</span>&nbsp;<span class="ident" id="4790144">err</span><span class="op" id="4790147">}</span><span class="op" id="4790148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4790151">}</span><br>
<span class="lineno"></span><span class="op" id="4790153">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span><span class="keyword" id="4790156">func</span>&nbsp;<span class="ident" id="4790161">addrMarshalerEncoder</span><span class="op" id="4790181">(</span><span class="ident" id="4790182">e</span>&nbsp;<span class="op" id="4790184">*</span><span class="ident" id="4790185">encodeState</span><span class="op" id="4790196">,</span>&nbsp;<span class="ident" id="4790198">v</span>&nbsp;<span class="ident" id="4790200">reflect</span><span class="op" id="4790207">.</span><span class="ident" id="4790208">Value</span><span class="op" id="4790213">,</span>&nbsp;<span class="ident" id="4790215">quoted</span>&nbsp;<span class="builtintype" id="4790222">bool</span><span class="op" id="4790226">)</span>&nbsp;<span class="op" id="4790228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4790231">va</span>&nbsp;<span class="op" id="4790234">:=</span>&nbsp;<span class="ident" id="4790237">v</span><span class="op" id="4790238">.</span><span class="ident" id="4790239">Addr</span><span class="op" id="4790243">(</span><span class="op" id="4790244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4790247">if</span>&nbsp;<span class="ident" id="4790250">va</span><span class="op" id="4790252">.</span><span class="ident" id="4790253">IsNil</span><span class="op" id="4790258">(</span><span class="op" id="4790259">)</span>&nbsp;<span class="op" id="4790261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4790265">e</span><span class="op" id="4790266">.</span><span class="ident" id="4790267">WriteString</span><span class="op" id="4790278">(</span><span class="string" id="4790279">&#34;null&#34;</span><span class="op" id="4790285">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4790289">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4790297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4790300">m</span>&nbsp;<span class="op" id="4790302">:=</span>&nbsp;<span class="ident" id="4790305">va</span><span class="op" id="4790307">.</span><span class="ident" id="4790308">Interface</span><span class="op" id="4790317">(</span><span class="op" id="4790318">)</span><span class="op" id="4790319">.</span><span class="op" id="4790320">(</span><span class="ident" id="4790321">Marshaler</span><span class="op" id="4790330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4790333">b</span><span class="op" id="4790334">,</span>&nbsp;<span class="ident" id="4790336">err</span>&nbsp;<span class="op" id="4790340">:=</span>&nbsp;<span class="ident" id="4790343">m</span><span class="op" id="4790344">.</span><span class="ident" id="4790345">MarshalJSON</span><span class="op" id="4790356">(</span><span class="op" id="4790357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4790360">if</span>&nbsp;<span class="ident" id="4790363">err</span>&nbsp;<span class="op" id="4790367">==</span>&nbsp;<span class="ident" id="4790370">nil</span>&nbsp;<span class="op" id="4790374">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4790378">//&nbsp;copy&nbsp;JSON&nbsp;into&nbsp;buffer,&nbsp;checking&nbsp;validity.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4790425">err</span>&nbsp;<span class="op" id="4790429">=</span>&nbsp;<span class="ident" id="4790431">compact</span><span class="op" id="4790438">(</span><span class="op" id="4790439">&amp;</span><span class="ident" id="4790440">e</span><span class="op" id="4790441">.</span><span class="ident" id="4790442">Buffer</span><span class="op" id="4790448">,</span>&nbsp;<span class="ident" id="4790450">b</span><span class="op" id="4790451">,</span>&nbsp;<span class="builtintype" id="4790453">true</span><span class="op" id="4790457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4790460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4790463">if</span>&nbsp;<span class="ident" id="4790466">err</span>&nbsp;<span class="op" id="4790470">!=</span>&nbsp;<span class="ident" id="4790473">nil</span>&nbsp;<span class="op" id="4790477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4790481">e</span><span class="op" id="4790482">.</span><span class="builtintype" id="4790483">error</span><span class="op" id="4790488">(</span><span class="op" id="4790489">&amp;</span><span class="ident" id="4790490">MarshalerError</span><span class="op" id="4790504">{</span><span class="ident" id="4790505">v</span><span class="op" id="4790506">.</span><span class="ident" id="4790507">Type</span><span class="op" id="4790511">(</span><span class="op" id="4790512">)</span><span class="op" id="4790513">,</span>&nbsp;<span class="ident" id="4790515">err</span><span class="op" id="4790518">}</span><span class="op" id="4790519">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4790522">}</span><br>
<span class="lineno"></span><span class="op" id="4790524">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4790527">func</span>&nbsp;<span class="ident" id="4790532">textMarshalerEncoder</span><span class="op" id="4790552">(</span><span class="ident" id="4790553">e</span>&nbsp;<span class="op" id="4790555">*</span><span class="ident" id="4790556">encodeState</span><span class="op" id="4790567">,</span>&nbsp;<span class="ident" id="4790569">v</span>&nbsp;<span class="ident" id="4790571">reflect</span><span class="op" id="4790578">.</span><span class="ident" id="4790579">Value</span><span class="op" id="4790584">,</span>&nbsp;<span class="ident" id="4790586">quoted</span>&nbsp;<span class="builtintype" id="4790593">bool</span><span class="op" id="4790597">)</span>&nbsp;<span class="op" id="4790599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4790602">if</span>&nbsp;<span class="ident" id="4790605">v</span><span class="op" id="4790606">.</span><span class="ident" id="4790607">Kind</span><span class="op" id="4790611">(</span><span class="op" id="4790612">)</span>&nbsp;<span class="op" id="4790614">==</span>&nbsp;<span class="ident" id="4790617">reflect</span><span class="op" id="4790624">.</span><span class="ident" id="4790625">Ptr</span>&nbsp;<span class="op" id="4790629">&amp;&amp;</span>&nbsp;<span class="ident" id="4790632">v</span><span class="op" id="4790633">.</span><span class="ident" id="4790634">IsNil</span><span class="op" id="4790639">(</span><span class="op" id="4790640">)</span>&nbsp;<span class="op" id="4790642">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4790646">e</span><span class="op" id="4790647">.</span><span class="ident" id="4790648">WriteString</span><span class="op" id="4790659">(</span><span class="string" id="4790660">&#34;null&#34;</span><span class="op" id="4790666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4790670">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4790678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4790681">m</span>&nbsp;<span class="op" id="4790683">:=</span>&nbsp;<span class="ident" id="4790686">v</span><span class="op" id="4790687">.</span><span class="ident" id="4790688">Interface</span><span class="op" id="4790697">(</span><span class="op" id="4790698">)</span><span class="op" id="4790699">.</span><span class="op" id="4790700">(</span><span class="ident" id="4790701">encoding</span><span class="op" id="4790709">.</span><span class="ident" id="4790710">TextMarshaler</span><span class="op" id="4790723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4790726">b</span><span class="op" id="4790727">,</span>&nbsp;<span class="ident" id="4790729">err</span>&nbsp;<span class="op" id="4790733">:=</span>&nbsp;<span class="ident" id="4790736">m</span><span class="op" id="4790737">.</span><span class="ident" id="4790738">MarshalText</span><span class="op" id="4790749">(</span><span class="op" id="4790750">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4790753">if</span>&nbsp;<span class="ident" id="4790756">err</span>&nbsp;<span class="op" id="4790760">==</span>&nbsp;<span class="ident" id="4790763">nil</span>&nbsp;<span class="op" id="4790767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4790771">_</span><span class="op" id="4790772">,</span>&nbsp;<span class="ident" id="4790774">err</span>&nbsp;<span class="op" id="4790778">=</span>&nbsp;<span class="ident" id="4790780">e</span><span class="op" id="4790781">.</span><span class="ident" id="4790782">stringBytes</span><span class="op" id="4790793">(</span><span class="ident" id="4790794">b</span><span class="op" id="4790795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4790798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4790801">if</span>&nbsp;<span class="ident" id="4790804">err</span>&nbsp;<span class="op" id="4790808">!=</span>&nbsp;<span class="ident" id="4790811">nil</span>&nbsp;<span class="op" id="4790815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4790819">e</span><span class="op" id="4790820">.</span><span class="builtintype" id="4790821">error</span><span class="op" id="4790826">(</span><span class="op" id="4790827">&amp;</span><span class="ident" id="4790828">MarshalerError</span><span class="op" id="4790842">{</span><span class="ident" id="4790843">v</span><span class="op" id="4790844">.</span><span class="ident" id="4790845">Type</span><span class="op" id="4790849">(</span><span class="op" id="4790850">)</span><span class="op" id="4790851">,</span>&nbsp;<span class="ident" id="4790853">err</span><span class="op" id="4790856">}</span><span class="op" id="4790857">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4790860">}</span><br>
<span class="lineno"></span><span class="op" id="4790862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4790865">func</span>&nbsp;<span class="ident" id="4790870">addrTextMarshalerEncoder</span><span class="op" id="4790894">(</span><span class="ident" id="4790895">e</span>&nbsp;<span class="op" id="4790897">*</span><span class="ident" id="4790898">encodeState</span><span class="op" id="4790909">,</span>&nbsp;<span class="ident" id="4790911">v</span>&nbsp;<span class="ident" id="4790913">reflect</span><span class="op" id="4790920">.</span><span class="ident" id="4790921">Value</span><span class="op" id="4790926">,</span>&nbsp;<span class="ident" id="4790928">quoted</span>&nbsp;<span class="builtintype" id="4790935">bool</span><span class="op" id="4790939">)</span>&nbsp;<span class="op" id="4790941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4790944">va</span>&nbsp;<span class="op" id="4790947">:=</span>&nbsp;<span class="ident" id="4790950">v</span><span class="op" id="4790951">.</span><span class="ident" id="4790952">Addr</span><span class="op" id="4790956">(</span><span class="op" id="4790957">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4790960">if</span>&nbsp;<span class="ident" id="4790963">va</span><span class="op" id="4790965">.</span><span class="ident" id="4790966">IsNil</span><span class="op" id="4790971">(</span><span class="op" id="4790972">)</span>&nbsp;<span class="op" id="4790974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4790978">e</span><span class="op" id="4790979">.</span><span class="ident" id="4790980">WriteString</span><span class="op" id="4790991">(</span><span class="string" id="4790992">&#34;null&#34;</span><span class="op" id="4790998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4791002">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4791010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4791013">m</span>&nbsp;<span class="op" id="4791015">:=</span>&nbsp;<span class="ident" id="4791018">va</span><span class="op" id="4791020">.</span><span class="ident" id="4791021">Interface</span><span class="op" id="4791030">(</span><span class="op" id="4791031">)</span><span class="op" id="4791032">.</span><span class="op" id="4791033">(</span><span class="ident" id="4791034">encoding</span><span class="op" id="4791042">.</span><span class="ident" id="4791043">TextMarshaler</span><span class="op" id="4791056">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4791059">b</span><span class="op" id="4791060">,</span>&nbsp;<span class="ident" id="4791062">err</span>&nbsp;<span class="op" id="4791066">:=</span>&nbsp;<span class="ident" id="4791069">m</span><span class="op" id="4791070">.</span><span class="ident" id="4791071">MarshalText</span><span class="op" id="4791082">(</span><span class="op" id="4791083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4791086">if</span>&nbsp;<span class="ident" id="4791089">err</span>&nbsp;<span class="op" id="4791093">==</span>&nbsp;<span class="ident" id="4791096">nil</span>&nbsp;<span class="op" id="4791100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4791104">_</span><span class="op" id="4791105">,</span>&nbsp;<span class="ident" id="4791107">err</span>&nbsp;<span class="op" id="4791111">=</span>&nbsp;<span class="ident" id="4791113">e</span><span class="op" id="4791114">.</span><span class="ident" id="4791115">stringBytes</span><span class="op" id="4791126">(</span><span class="ident" id="4791127">b</span><span class="op" id="4791128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4791131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4791134">if</span>&nbsp;<span class="ident" id="4791137">err</span>&nbsp;<span class="op" id="4791141">!=</span>&nbsp;<span class="ident" id="4791144">nil</span>&nbsp;<span class="op" id="4791148">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4791152">e</span><span class="op" id="4791153">.</span><span class="builtintype" id="4791154">error</span><span class="op" id="4791159">(</span><span class="op" id="4791160">&amp;</span><span class="ident" id="4791161">MarshalerError</span><span class="op" id="4791175">{</span><span class="ident" id="4791176">v</span><span class="op" id="4791177">.</span><span class="ident" id="4791178">Type</span><span class="op" id="4791182">(</span><span class="op" id="4791183">)</span><span class="op" id="4791184">,</span>&nbsp;<span class="ident" id="4791186">err</span><span class="op" id="4791189">}</span><span class="op" id="4791190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4791193">}</span><br>
<span class="lineno"></span><span class="op" id="4791195">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4791198">func</span>&nbsp;<span class="ident" id="4791203">boolEncoder</span><span class="op" id="4791214">(</span><span class="ident" id="4791215">e</span>&nbsp;<span class="op" id="4791217">*</span><span class="ident" id="4791218">encodeState</span><span class="op" id="4791229">,</span>&nbsp;<span class="ident" id="4791231">v</span>&nbsp;<span class="ident" id="4791233">reflect</span><span class="op" id="4791240">.</span><span class="ident" id="4791241">Value</span><span class="op" id="4791246">,</span>&nbsp;<span class="ident" id="4791248">quoted</span>&nbsp;<span class="builtintype" id="4791255">bool</span><span class="op" id="4791259">)</span>&nbsp;<span class="op" id="4791261">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4791264">if</span>&nbsp;<span class="ident" id="4791267">quoted</span>&nbsp;<span class="op" id="4791274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4791278">e</span><span class="op" id="4791279">.</span><span class="ident" id="4791280">WriteByte</span><span class="op" id="4791289">(</span><span class="string" id="4791290">&#39;&#34;&#39;</span><span class="op" id="4791293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4791296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4791299">if</span>&nbsp;<span class="ident" id="4791302">v</span><span class="op" id="4791303">.</span><span class="ident" id="4791304">Bool</span><span class="op" id="4791308">(</span><span class="op" id="4791309">)</span>&nbsp;<span class="op" id="4791311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4791315">e</span><span class="op" id="4791316">.</span><span class="ident" id="4791317">WriteString</span><span class="op" id="4791328">(</span><span class="string" id="4791329">&#34;true&#34;</span><span class="op" id="4791335">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4791338">}</span>&nbsp;<span class="keyword" id="4791340">else</span>&nbsp;<span class="op" id="4791345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4791349">e</span><span class="op" id="4791350">.</span><span class="ident" id="4791351">WriteString</span><span class="op" id="4791362">(</span><span class="string" id="4791363">&#34;false&#34;</span><span class="op" id="4791370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4791373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4791376">if</span>&nbsp;<span class="ident" id="4791379">quoted</span>&nbsp;<span class="op" id="4791386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4791390">e</span><span class="op" id="4791391">.</span><span class="ident" id="4791392">WriteByte</span><span class="op" id="4791401">(</span><span class="string" id="4791402">&#39;&#34;&#39;</span><span class="op" id="4791405">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4791408">}</span><br>
<span class="lineno"></span><span class="op" id="4791410">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4791413">func</span>&nbsp;<span class="ident" id="4791418">intEncoder</span><span class="op" id="4791428">(</span><span class="ident" id="4791429">e</span>&nbsp;<span class="op" id="4791431">*</span><span class="ident" id="4791432">encodeState</span><span class="op" id="4791443">,</span>&nbsp;<span class="ident" id="4791445">v</span>&nbsp;<span class="ident" id="4791447">reflect</span><span class="op" id="4791454">.</span><span class="ident" id="4791455">Value</span><span class="op" id="4791460">,</span>&nbsp;<span class="ident" id="4791462">quoted</span>&nbsp;<span class="builtintype" id="4791469">bool</span><span class="op" id="4791473">)</span>&nbsp;<span class="op" id="4791475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4791478">b</span>&nbsp;<span class="op" id="4791480">:=</span>&nbsp;<span class="ident" id="4791483">strconv</span><span class="op" id="4791490">.</span><span class="ident" id="4791491">AppendInt</span><span class="op" id="4791500">(</span><span class="ident" id="4791501">e</span><span class="op" id="4791502">.</span><span class="ident" id="4791503">scratch</span><span class="op" id="4791510">[</span><span class="op" id="4791511">:</span><span class="num" id="4791512">0</span><span class="op" id="4791513">]</span><span class="op" id="4791514">,</span>&nbsp;<span class="ident" id="4791516">v</span><span class="op" id="4791517">.</span><span class="ident" id="4791518">Int</span><span class="op" id="4791521">(</span><span class="op" id="4791522">)</span><span class="op" id="4791523">,</span>&nbsp;<span class="num" id="4791525">10</span><span class="op" id="4791527">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4791530">if</span>&nbsp;<span class="ident" id="4791533">quoted</span>&nbsp;<span class="op" id="4791540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4791544">e</span><span class="op" id="4791545">.</span><span class="ident" id="4791546">WriteByte</span><span class="op" id="4791555">(</span><span class="string" id="4791556">&#39;&#34;&#39;</span><span class="op" id="4791559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4791562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4791565">e</span><span class="op" id="4791566">.</span><span class="ident" id="4791567">Write</span><span class="op" id="4791572">(</span><span class="ident" id="4791573">b</span><span class="op" id="4791574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4791577">if</span>&nbsp;<span class="ident" id="4791580">quoted</span>&nbsp;<span class="op" id="4791587">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4791591">e</span><span class="op" id="4791592">.</span><span class="ident" id="4791593">WriteByte</span><span class="op" id="4791602">(</span><span class="string" id="4791603">&#39;&#34;&#39;</span><span class="op" id="4791606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4791609">}</span><br>
<span class="lineno"></span><span class="op" id="4791611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4791614">func</span>&nbsp;<span class="ident" id="4791619">uintEncoder</span><span class="op" id="4791630">(</span><span class="ident" id="4791631">e</span>&nbsp;<span class="op" id="4791633">*</span><span class="ident" id="4791634">encodeState</span><span class="op" id="4791645">,</span>&nbsp;<span class="ident" id="4791647">v</span>&nbsp;<span class="ident" id="4791649">reflect</span><span class="op" id="4791656">.</span><span class="ident" id="4791657">Value</span><span class="op" id="4791662">,</span>&nbsp;<span class="ident" id="4791664">quoted</span>&nbsp;<span class="builtintype" id="4791671">bool</span><span class="op" id="4791675">)</span>&nbsp;<span class="op" id="4791677">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4791680">b</span>&nbsp;<span class="op" id="4791682">:=</span>&nbsp;<span class="ident" id="4791685">strconv</span><span class="op" id="4791692">.</span><span class="ident" id="4791693">AppendUint</span><span class="op" id="4791703">(</span><span class="ident" id="4791704">e</span><span class="op" id="4791705">.</span><span class="ident" id="4791706">scratch</span><span class="op" id="4791713">[</span><span class="op" id="4791714">:</span><span class="num" id="4791715">0</span><span class="op" id="4791716">]</span><span class="op" id="4791717">,</span>&nbsp;<span class="ident" id="4791719">v</span><span class="op" id="4791720">.</span><span class="ident" id="4791721">Uint</span><span class="op" id="4791725">(</span><span class="op" id="4791726">)</span><span class="op" id="4791727">,</span>&nbsp;<span class="num" id="4791729">10</span><span class="op" id="4791731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4791734">if</span>&nbsp;<span class="ident" id="4791737">quoted</span>&nbsp;<span class="op" id="4791744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4791748">e</span><span class="op" id="4791749">.</span><span class="ident" id="4791750">WriteByte</span><span class="op" id="4791759">(</span><span class="string" id="4791760">&#39;&#34;&#39;</span><span class="op" id="4791763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4791766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4791769">e</span><span class="op" id="4791770">.</span><span class="ident" id="4791771">Write</span><span class="op" id="4791776">(</span><span class="ident" id="4791777">b</span><span class="op" id="4791778">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4791781">if</span>&nbsp;<span class="ident" id="4791784">quoted</span>&nbsp;<span class="op" id="4791791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4791795">e</span><span class="op" id="4791796">.</span><span class="ident" id="4791797">WriteByte</span><span class="op" id="4791806">(</span><span class="string" id="4791807">&#39;&#34;&#39;</span><span class="op" id="4791810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4791813">}</span><br>
<span class="lineno"></span><span class="op" id="4791815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">510</span><span class="keyword" id="4791818">type</span>&nbsp;<span class="ident" id="4791823">floatEncoder</span>&nbsp;<span class="builtintype" id="4791836">int</span>&nbsp;<span class="comment" id="4791840">//&nbsp;number&nbsp;of&nbsp;bits</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4791859">func</span>&nbsp;<span class="op" id="4791864">(</span><span class="ident" id="4791865">bits</span>&nbsp;<span class="ident" id="4791870">floatEncoder</span><span class="op" id="4791882">)</span>&nbsp;<span class="ident" id="4791884">encode</span><span class="op" id="4791890">(</span><span class="ident" id="4791891">e</span>&nbsp;<span class="op" id="4791893">*</span><span class="ident" id="4791894">encodeState</span><span class="op" id="4791905">,</span>&nbsp;<span class="ident" id="4791907">v</span>&nbsp;<span class="ident" id="4791909">reflect</span><span class="op" id="4791916">.</span><span class="ident" id="4791917">Value</span><span class="op" id="4791922">,</span>&nbsp;<span class="ident" id="4791924">quoted</span>&nbsp;<span class="builtintype" id="4791931">bool</span><span class="op" id="4791935">)</span>&nbsp;<span class="op" id="4791937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4791940">f</span>&nbsp;<span class="op" id="4791942">:=</span>&nbsp;<span class="ident" id="4791945">v</span><span class="op" id="4791946">.</span><span class="ident" id="4791947">Float</span><span class="op" id="4791952">(</span><span class="op" id="4791953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4791956">if</span>&nbsp;<span class="ident" id="4791959">math</span><span class="op" id="4791963">.</span><span class="ident" id="4791964">IsInf</span><span class="op" id="4791969">(</span><span class="ident" id="4791970">f</span><span class="op" id="4791971">,</span>&nbsp;<span class="num" id="4791973">0</span><span class="op" id="4791974">)</span>&nbsp;<span class="op" id="4791976">||</span>&nbsp;<span class="ident" id="4791979">math</span><span class="op" id="4791983">.</span><span class="ident" id="4791984">IsNaN</span><span class="op" id="4791989">(</span><span class="ident" id="4791990">f</span><span class="op" id="4791991">)</span>&nbsp;<span class="op" id="4791993">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4791997">e</span><span class="op" id="4791998">.</span><span class="builtintype" id="4791999">error</span><span class="op" id="4792004">(</span><span class="op" id="4792005">&amp;</span><span class="ident" id="4792006">UnsupportedValueError</span><span class="op" id="4792027">{</span><span class="ident" id="4792028">v</span><span class="op" id="4792029">,</span>&nbsp;<span class="ident" id="4792031">strconv</span><span class="op" id="4792038">.</span><span class="ident" id="4792039">FormatFloat</span><span class="op" id="4792050">(</span><span class="ident" id="4792051">f</span><span class="op" id="4792052">,</span>&nbsp;<span class="string" id="4792054">&#39;g&#39;</span><span class="op" id="4792057">,</span>&nbsp;<span class="op" id="4792059">-</span><span class="num" id="4792060">1</span><span class="op" id="4792061">,</span>&nbsp;<span class="builtintype" id="4792063">int</span><span class="op" id="4792066">(</span><span class="ident" id="4792067">bits</span><span class="op" id="4792071">)</span><span class="op" id="4792072">)</span><span class="op" id="4792073">}</span><span class="op" id="4792074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4792077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4792080">b</span>&nbsp;<span class="op" id="4792082">:=</span>&nbsp;<span class="ident" id="4792085">strconv</span><span class="op" id="4792092">.</span><span class="ident" id="4792093">AppendFloat</span><span class="op" id="4792104">(</span><span class="ident" id="4792105">e</span><span class="op" id="4792106">.</span><span class="ident" id="4792107">scratch</span><span class="op" id="4792114">[</span><span class="op" id="4792115">:</span><span class="num" id="4792116">0</span><span class="op" id="4792117">]</span><span class="op" id="4792118">,</span>&nbsp;<span class="ident" id="4792120">f</span><span class="op" id="4792121">,</span>&nbsp;<span class="string" id="4792123">&#39;g&#39;</span><span class="op" id="4792126">,</span>&nbsp;<span class="op" id="4792128">-</span><span class="num" id="4792129">1</span><span class="op" id="4792130">,</span>&nbsp;<span class="builtintype" id="4792132">int</span><span class="op" id="4792135">(</span><span class="ident" id="4792136">bits</span><span class="op" id="4792140">)</span><span class="op" id="4792141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4792144">if</span>&nbsp;<span class="ident" id="4792147">quoted</span>&nbsp;<span class="op" id="4792154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4792158">e</span><span class="op" id="4792159">.</span><span class="ident" id="4792160">WriteByte</span><span class="op" id="4792169">(</span><span class="string" id="4792170">&#39;&#34;&#39;</span><span class="op" id="4792173">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4792176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4792179">e</span><span class="op" id="4792180">.</span><span class="ident" id="4792181">Write</span><span class="op" id="4792186">(</span><span class="ident" id="4792187">b</span><span class="op" id="4792188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4792191">if</span>&nbsp;<span class="ident" id="4792194">quoted</span>&nbsp;<span class="op" id="4792201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4792205">e</span><span class="op" id="4792206">.</span><span class="ident" id="4792207">WriteByte</span><span class="op" id="4792216">(</span><span class="string" id="4792217">&#39;&#34;&#39;</span><span class="op" id="4792220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4792223">}</span><br>
<span class="lineno">525</span><span class="op" id="4792225">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4792228">var</span>&nbsp;<span class="op" id="4792232">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4792235">float32Encoder</span>&nbsp;<span class="op" id="4792250">=</span>&nbsp;<span class="op" id="4792252">(</span><span class="ident" id="4792253">floatEncoder</span><span class="op" id="4792265">(</span><span class="num" id="4792266">32</span><span class="op" id="4792268">)</span><span class="op" id="4792269">)</span><span class="op" id="4792270">.</span><span class="ident" id="4792271">encode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4792279">float64Encoder</span>&nbsp;<span class="op" id="4792294">=</span>&nbsp;<span class="op" id="4792296">(</span><span class="ident" id="4792297">floatEncoder</span><span class="op" id="4792309">(</span><span class="num" id="4792310">64</span><span class="op" id="4792312">)</span><span class="op" id="4792313">)</span><span class="op" id="4792314">.</span><span class="ident" id="4792315">encode</span><br>
<span class="lineno">530</span><span class="op" id="4792322">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4792325">func</span>&nbsp;<span class="ident" id="4792330">stringEncoder</span><span class="op" id="4792343">(</span><span class="ident" id="4792344">e</span>&nbsp;<span class="op" id="4792346">*</span><span class="ident" id="4792347">encodeState</span><span class="op" id="4792358">,</span>&nbsp;<span class="ident" id="4792360">v</span>&nbsp;<span class="ident" id="4792362">reflect</span><span class="op" id="4792369">.</span><span class="ident" id="4792370">Value</span><span class="op" id="4792375">,</span>&nbsp;<span class="ident" id="4792377">quoted</span>&nbsp;<span class="builtintype" id="4792384">bool</span><span class="op" id="4792388">)</span>&nbsp;<span class="op" id="4792390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4792393">if</span>&nbsp;<span class="ident" id="4792396">v</span><span class="op" id="4792397">.</span><span class="ident" id="4792398">Type</span><span class="op" id="4792402">(</span><span class="op" id="4792403">)</span>&nbsp;<span class="op" id="4792405">==</span>&nbsp;<span class="ident" id="4792408">numberType</span>&nbsp;<span class="op" id="4792419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4792423">numStr</span>&nbsp;<span class="op" id="4792430">:=</span>&nbsp;<span class="ident" id="4792433">v</span><span class="op" id="4792434">.</span><span class="ident" id="4792435">String</span><span class="op" id="4792441">(</span><span class="op" id="4792442">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4792446">if</span>&nbsp;<span class="ident" id="4792449">numStr</span>&nbsp;<span class="op" id="4792456">==</span>&nbsp;<span class="string" id="4792459">&#34;&#34;</span>&nbsp;<span class="op" id="4792462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4792467">numStr</span>&nbsp;<span class="op" id="4792474">=</span>&nbsp;<span class="string" id="4792476">&#34;0&#34;</span>&nbsp;<span class="comment" id="4792480">//&nbsp;Number&#39;s&nbsp;zero-val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4792503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4792507">e</span><span class="op" id="4792508">.</span><span class="ident" id="4792509">WriteString</span><span class="op" id="4792520">(</span><span class="ident" id="4792521">numStr</span><span class="op" id="4792527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4792531">return</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4792539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4792542">if</span>&nbsp;<span class="ident" id="4792545">quoted</span>&nbsp;<span class="op" id="4792552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4792556">sb</span><span class="op" id="4792558">,</span>&nbsp;<span class="ident" id="4792560">err</span>&nbsp;<span class="op" id="4792564">:=</span>&nbsp;<span class="ident" id="4792567">Marshal</span><span class="op" id="4792574">(</span><span class="ident" id="4792575">v</span><span class="op" id="4792576">.</span><span class="ident" id="4792577">String</span><span class="op" id="4792583">(</span><span class="op" id="4792584">)</span><span class="op" id="4792585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4792589">if</span>&nbsp;<span class="ident" id="4792592">err</span>&nbsp;<span class="op" id="4792596">!=</span>&nbsp;<span class="ident" id="4792599">nil</span>&nbsp;<span class="op" id="4792603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4792608">e</span><span class="op" id="4792609">.</span><span class="builtintype" id="4792610">error</span><span class="op" id="4792615">(</span><span class="ident" id="4792616">err</span><span class="op" id="4792619">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4792623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4792627">e</span><span class="op" id="4792628">.</span><span class="builtintype" id="4792629">string</span><span class="op" id="4792635">(</span><span class="builtintype" id="4792636">string</span><span class="op" id="4792642">(</span><span class="ident" id="4792643">sb</span><span class="op" id="4792645">)</span><span class="op" id="4792646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4792649">}</span>&nbsp;<span class="keyword" id="4792651">else</span>&nbsp;<span class="op" id="4792656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4792660">e</span><span class="op" id="4792661">.</span><span class="builtintype" id="4792662">string</span><span class="op" id="4792668">(</span><span class="ident" id="4792669">v</span><span class="op" id="4792670">.</span><span class="ident" id="4792671">String</span><span class="op" id="4792677">(</span><span class="op" id="4792678">)</span><span class="op" id="4792679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4792682">}</span><br>
<span class="lineno">550</span><span class="op" id="4792684">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4792687">func</span>&nbsp;<span class="ident" id="4792692">interfaceEncoder</span><span class="op" id="4792708">(</span><span class="ident" id="4792709">e</span>&nbsp;<span class="op" id="4792711">*</span><span class="ident" id="4792712">encodeState</span><span class="op" id="4792723">,</span>&nbsp;<span class="ident" id="4792725">v</span>&nbsp;<span class="ident" id="4792727">reflect</span><span class="op" id="4792734">.</span><span class="ident" id="4792735">Value</span><span class="op" id="4792740">,</span>&nbsp;<span class="ident" id="4792742">quoted</span>&nbsp;<span class="builtintype" id="4792749">bool</span><span class="op" id="4792753">)</span>&nbsp;<span class="op" id="4792755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4792758">if</span>&nbsp;<span class="ident" id="4792761">v</span><span class="op" id="4792762">.</span><span class="ident" id="4792763">IsNil</span><span class="op" id="4792768">(</span><span class="op" id="4792769">)</span>&nbsp;<span class="op" id="4792771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4792775">e</span><span class="op" id="4792776">.</span><span class="ident" id="4792777">WriteString</span><span class="op" id="4792788">(</span><span class="string" id="4792789">&#34;null&#34;</span><span class="op" id="4792795">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4792799">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4792807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4792810">e</span><span class="op" id="4792811">.</span><span class="ident" id="4792812">reflectValue</span><span class="op" id="4792824">(</span><span class="ident" id="4792825">v</span><span class="op" id="4792826">.</span><span class="ident" id="4792827">Elem</span><span class="op" id="4792831">(</span><span class="op" id="4792832">)</span><span class="op" id="4792833">)</span><br>
<span class="lineno"></span><span class="op" id="4792835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">560</span><span class="keyword" id="4792838">func</span>&nbsp;<span class="ident" id="4792843">unsupportedTypeEncoder</span><span class="op" id="4792865">(</span><span class="ident" id="4792866">e</span>&nbsp;<span class="op" id="4792868">*</span><span class="ident" id="4792869">encodeState</span><span class="op" id="4792880">,</span>&nbsp;<span class="ident" id="4792882">v</span>&nbsp;<span class="ident" id="4792884">reflect</span><span class="op" id="4792891">.</span><span class="ident" id="4792892">Value</span><span class="op" id="4792897">,</span>&nbsp;<span class="ident" id="4792899">quoted</span>&nbsp;<span class="builtintype" id="4792906">bool</span><span class="op" id="4792910">)</span>&nbsp;<span class="op" id="4792912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4792915">e</span><span class="op" id="4792916">.</span><span class="builtintype" id="4792917">error</span><span class="op" id="4792922">(</span><span class="op" id="4792923">&amp;</span><span class="ident" id="4792924">UnsupportedTypeError</span><span class="op" id="4792944">{</span><span class="ident" id="4792945">v</span><span class="op" id="4792946">.</span><span class="ident" id="4792947">Type</span><span class="op" id="4792951">(</span><span class="op" id="4792952">)</span><span class="op" id="4792953">}</span><span class="op" id="4792954">)</span><br>
<span class="lineno"></span><span class="op" id="4792956">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4792959">type</span>&nbsp;<span class="ident" id="4792964">structEncoder</span>&nbsp;<span class="keyword" id="4792978">struct</span>&nbsp;<span class="op" id="4792985">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4792988">fields</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4792998">[</span><span class="op" id="4792999">]</span><span class="ident" id="4793000">field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4793007">fieldEncs</span>&nbsp;<span class="op" id="4793017">[</span><span class="op" id="4793018">]</span><span class="ident" id="4793019">encoderFunc</span><br>
<span class="lineno"></span><span class="op" id="4793031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4793034">func</span>&nbsp;<span class="op" id="4793039">(</span><span class="ident" id="4793040">se</span>&nbsp;<span class="op" id="4793043">*</span><span class="ident" id="4793044">structEncoder</span><span class="op" id="4793057">)</span>&nbsp;<span class="ident" id="4793059">encode</span><span class="op" id="4793065">(</span><span class="ident" id="4793066">e</span>&nbsp;<span class="op" id="4793068">*</span><span class="ident" id="4793069">encodeState</span><span class="op" id="4793080">,</span>&nbsp;<span class="ident" id="4793082">v</span>&nbsp;<span class="ident" id="4793084">reflect</span><span class="op" id="4793091">.</span><span class="ident" id="4793092">Value</span><span class="op" id="4793097">,</span>&nbsp;<span class="ident" id="4793099">quoted</span>&nbsp;<span class="builtintype" id="4793106">bool</span><span class="op" id="4793110">)</span>&nbsp;<span class="op" id="4793112">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4793115">e</span><span class="op" id="4793116">.</span><span class="ident" id="4793117">WriteByte</span><span class="op" id="4793126">(</span><span class="string" id="4793127">&#39;{&#39;</span><span class="op" id="4793130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4793133">first</span>&nbsp;<span class="op" id="4793139">:=</span>&nbsp;<span class="builtintype" id="4793142">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4793148">for</span>&nbsp;<span class="ident" id="4793152">i</span><span class="op" id="4793153">,</span>&nbsp;<span class="ident" id="4793155">f</span>&nbsp;<span class="op" id="4793157">:=</span>&nbsp;<span class="keyword" id="4793160">range</span>&nbsp;<span class="ident" id="4793166">se</span><span class="op" id="4793168">.</span><span class="ident" id="4793169">fields</span>&nbsp;<span class="op" id="4793176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4793180">fv</span>&nbsp;<span class="op" id="4793183">:=</span>&nbsp;<span class="ident" id="4793186">fieldByIndex</span><span class="op" id="4793198">(</span><span class="ident" id="4793199">v</span><span class="op" id="4793200">,</span>&nbsp;<span class="ident" id="4793202">f</span><span class="op" id="4793203">.</span><span class="ident" id="4793204">index</span><span class="op" id="4793209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4793213">if</span>&nbsp;<span class="op" id="4793216">!</span><span class="ident" id="4793217">fv</span><span class="op" id="4793219">.</span><span class="ident" id="4793220">IsValid</span><span class="op" id="4793227">(</span><span class="op" id="4793228">)</span>&nbsp;<span class="op" id="4793230">||</span>&nbsp;<span class="ident" id="4793233">f</span><span class="op" id="4793234">.</span><span class="ident" id="4793235">omitEmpty</span>&nbsp;<span class="op" id="4793245">&amp;&amp;</span>&nbsp;<span class="ident" id="4793248">isEmptyValue</span><span class="op" id="4793260">(</span><span class="ident" id="4793261">fv</span><span class="op" id="4793263">)</span>&nbsp;<span class="op" id="4793265">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4793270">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4793281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4793285">if</span>&nbsp;<span class="ident" id="4793288">first</span>&nbsp;<span class="op" id="4793294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4793299">first</span>&nbsp;<span class="op" id="4793305">=</span>&nbsp;<span class="builtintype" id="4793307">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4793315">}</span>&nbsp;<span class="keyword" id="4793317">else</span>&nbsp;<span class="op" id="4793322">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4793327">e</span><span class="op" id="4793328">.</span><span class="ident" id="4793329">WriteByte</span><span class="op" id="4793338">(</span><span class="string" id="4793339">&#39;,&#39;</span><span class="op" id="4793342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4793346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4793350">e</span><span class="op" id="4793351">.</span><span class="builtintype" id="4793352">string</span><span class="op" id="4793358">(</span><span class="ident" id="4793359">f</span><span class="op" id="4793360">.</span><span class="ident" id="4793361">name</span><span class="op" id="4793365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4793369">e</span><span class="op" id="4793370">.</span><span class="ident" id="4793371">WriteByte</span><span class="op" id="4793380">(</span><span class="string" id="4793381">&#39;:&#39;</span><span class="op" id="4793384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4793388">se</span><span class="op" id="4793390">.</span><span class="ident" id="4793391">fieldEncs</span><span class="op" id="4793400">[</span><span class="ident" id="4793401">i</span><span class="op" id="4793402">]</span><span class="op" id="4793403">(</span><span class="ident" id="4793404">e</span><span class="op" id="4793405">,</span>&nbsp;<span class="ident" id="4793407">fv</span><span class="op" id="4793409">,</span>&nbsp;<span class="ident" id="4793411">f</span><span class="op" id="4793412">.</span><span class="ident" id="4793413">quoted</span><span class="op" id="4793419">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4793422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4793425">e</span><span class="op" id="4793426">.</span><span class="ident" id="4793427">WriteByte</span><span class="op" id="4793436">(</span><span class="string" id="4793437">&#39;}&#39;</span><span class="op" id="4793440">)</span><br>
<span class="lineno"></span><span class="op" id="4793442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4793445">func</span>&nbsp;<span class="ident" id="4793450">newStructEncoder</span><span class="op" id="4793466">(</span><span class="ident" id="4793467">t</span>&nbsp;<span class="ident" id="4793469">reflect</span><span class="op" id="4793476">.</span><span class="ident" id="4793477">Type</span><span class="op" id="4793481">)</span>&nbsp;<span class="ident" id="4793483">encoderFunc</span>&nbsp;<span class="op" id="4793495">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4793498">fields</span>&nbsp;<span class="op" id="4793505">:=</span>&nbsp;<span class="ident" id="4793508">cachedTypeFields</span><span class="op" id="4793524">(</span><span class="ident" id="4793525">t</span><span class="op" id="4793526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4793529">se</span>&nbsp;<span class="op" id="4793532">:=</span>&nbsp;<span class="op" id="4793535">&amp;</span><span class="ident" id="4793536">structEncoder</span><span class="op" id="4793549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4793553">fields</span><span class="op" id="4793559">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4793564">fields</span><span class="op" id="4793570">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4793574">fieldEncs</span><span class="op" id="4793583">:</span>&nbsp;<span class="builtinfunc" id="4793585">make</span><span class="op" id="4793589">(</span><span class="op" id="4793590">[</span><span class="op" id="4793591">]</span><span class="ident" id="4793592">encoderFunc</span><span class="op" id="4793603">,</span>&nbsp;<span class="builtinfunc" id="4793605">len</span><span class="op" id="4793608">(</span><span class="ident" id="4793609">fields</span><span class="op" id="4793615">)</span><span class="op" id="4793616">)</span><span class="op" id="4793617">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4793620">}</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4793623">for</span>&nbsp;<span class="ident" id="4793627">i</span><span class="op" id="4793628">,</span>&nbsp;<span class="ident" id="4793630">f</span>&nbsp;<span class="op" id="4793632">:=</span>&nbsp;<span class="keyword" id="4793635">range</span>&nbsp;<span class="ident" id="4793641">fields</span>&nbsp;<span class="op" id="4793648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4793652">se</span><span class="op" id="4793654">.</span><span class="ident" id="4793655">fieldEncs</span><span class="op" id="4793664">[</span><span class="ident" id="4793665">i</span><span class="op" id="4793666">]</span>&nbsp;<span class="op" id="4793668">=</span>&nbsp;<span class="ident" id="4793670">typeEncoder</span><span class="op" id="4793681">(</span><span class="ident" id="4793682">typeByIndex</span><span class="op" id="4793693">(</span><span class="ident" id="4793694">t</span><span class="op" id="4793695">,</span>&nbsp;<span class="ident" id="4793697">f</span><span class="op" id="4793698">.</span><span class="ident" id="4793699">index</span><span class="op" id="4793704">)</span><span class="op" id="4793705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4793708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4793711">return</span>&nbsp;<span class="ident" id="4793718">se</span><span class="op" id="4793720">.</span><span class="ident" id="4793721">encode</span><br>
<span class="lineno"></span><span class="op" id="4793728">}</span><br>
<span class="lineno">600</span><br>
<span class="lineno"></span><span class="keyword" id="4793731">type</span>&nbsp;<span class="ident" id="4793736">mapEncoder</span>&nbsp;<span class="keyword" id="4793747">struct</span>&nbsp;<span class="op" id="4793754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4793757">elemEnc</span>&nbsp;<span class="ident" id="4793765">encoderFunc</span><br>
<span class="lineno"></span><span class="op" id="4793777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">605</span><span class="keyword" id="4793780">func</span>&nbsp;<span class="op" id="4793785">(</span><span class="ident" id="4793786">me</span>&nbsp;<span class="op" id="4793789">*</span><span class="ident" id="4793790">mapEncoder</span><span class="op" id="4793800">)</span>&nbsp;<span class="ident" id="4793802">encode</span><span class="op" id="4793808">(</span><span class="ident" id="4793809">e</span>&nbsp;<span class="op" id="4793811">*</span><span class="ident" id="4793812">encodeState</span><span class="op" id="4793823">,</span>&nbsp;<span class="ident" id="4793825">v</span>&nbsp;<span class="ident" id="4793827">reflect</span><span class="op" id="4793834">.</span><span class="ident" id="4793835">Value</span><span class="op" id="4793840">,</span>&nbsp;<span class="ident" id="4793842">_</span>&nbsp;<span class="builtintype" id="4793844">bool</span><span class="op" id="4793848">)</span>&nbsp;<span class="op" id="4793850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4793853">if</span>&nbsp;<span class="ident" id="4793856">v</span><span class="op" id="4793857">.</span><span class="ident" id="4793858">IsNil</span><span class="op" id="4793863">(</span><span class="op" id="4793864">)</span>&nbsp;<span class="op" id="4793866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4793870">e</span><span class="op" id="4793871">.</span><span class="ident" id="4793872">WriteString</span><span class="op" id="4793883">(</span><span class="string" id="4793884">&#34;null&#34;</span><span class="op" id="4793890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4793894">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4793902">}</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4793905">e</span><span class="op" id="4793906">.</span><span class="ident" id="4793907">WriteByte</span><span class="op" id="4793916">(</span><span class="string" id="4793917">&#39;{&#39;</span><span class="op" id="4793920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4793923">var</span>&nbsp;<span class="ident" id="4793927">sv</span>&nbsp;<span class="ident" id="4793930">stringValues</span>&nbsp;<span class="op" id="4793943">=</span>&nbsp;<span class="ident" id="4793945">v</span><span class="op" id="4793946">.</span><span class="ident" id="4793947">MapKeys</span><span class="op" id="4793954">(</span><span class="op" id="4793955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4793958">sort</span><span class="op" id="4793962">.</span><span class="ident" id="4793963">Sort</span><span class="op" id="4793967">(</span><span class="ident" id="4793968">sv</span><span class="op" id="4793970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4793973">for</span>&nbsp;<span class="ident" id="4793977">i</span><span class="op" id="4793978">,</span>&nbsp;<span class="ident" id="4793980">k</span>&nbsp;<span class="op" id="4793982">:=</span>&nbsp;<span class="keyword" id="4793985">range</span>&nbsp;<span class="ident" id="4793991">sv</span>&nbsp;<span class="op" id="4793994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4793998">if</span>&nbsp;<span class="ident" id="4794001">i</span>&nbsp;<span class="op" id="4794003">&gt;</span>&nbsp;<span class="num" id="4794005">0</span>&nbsp;<span class="op" id="4794007">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4794012">e</span><span class="op" id="4794013">.</span><span class="ident" id="4794014">WriteByte</span><span class="op" id="4794023">(</span><span class="string" id="4794024">&#39;,&#39;</span><span class="op" id="4794027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4794031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4794035">e</span><span class="op" id="4794036">.</span><span class="builtintype" id="4794037">string</span><span class="op" id="4794043">(</span><span class="ident" id="4794044">k</span><span class="op" id="4794045">.</span><span class="ident" id="4794046">String</span><span class="op" id="4794052">(</span><span class="op" id="4794053">)</span><span class="op" id="4794054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4794058">e</span><span class="op" id="4794059">.</span><span class="ident" id="4794060">WriteByte</span><span class="op" id="4794069">(</span><span class="string" id="4794070">&#39;:&#39;</span><span class="op" id="4794073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4794077">me</span><span class="op" id="4794079">.</span><span class="ident" id="4794080">elemEnc</span><span class="op" id="4794087">(</span><span class="ident" id="4794088">e</span><span class="op" id="4794089">,</span>&nbsp;<span class="ident" id="4794091">v</span><span class="op" id="4794092">.</span><span class="ident" id="4794093">MapIndex</span><span class="op" id="4794101">(</span><span class="ident" id="4794102">k</span><span class="op" id="4794103">)</span><span class="op" id="4794104">,</span>&nbsp;<span class="builtintype" id="4794106">false</span><span class="op" id="4794111">)</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4794114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4794117">e</span><span class="op" id="4794118">.</span><span class="ident" id="4794119">WriteByte</span><span class="op" id="4794128">(</span><span class="string" id="4794129">&#39;}&#39;</span><span class="op" id="4794132">)</span><br>
<span class="lineno"></span><span class="op" id="4794134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4794137">func</span>&nbsp;<span class="ident" id="4794142">newMapEncoder</span><span class="op" id="4794155">(</span><span class="ident" id="4794156">t</span>&nbsp;<span class="ident" id="4794158">reflect</span><span class="op" id="4794165">.</span><span class="ident" id="4794166">Type</span><span class="op" id="4794170">)</span>&nbsp;<span class="ident" id="4794172">encoderFunc</span>&nbsp;<span class="op" id="4794184">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4794187">if</span>&nbsp;<span class="ident" id="4794190">t</span><span class="op" id="4794191">.</span><span class="ident" id="4794192">Key</span><span class="op" id="4794195">(</span><span class="op" id="4794196">)</span><span class="op" id="4794197">.</span><span class="ident" id="4794198">Kind</span><span class="op" id="4794202">(</span><span class="op" id="4794203">)</span>&nbsp;<span class="op" id="4794205">!=</span>&nbsp;<span class="ident" id="4794208">reflect</span><span class="op" id="4794215">.</span><span class="ident" id="4794216">String</span>&nbsp;<span class="op" id="4794223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4794227">return</span>&nbsp;<span class="ident" id="4794234">unsupportedTypeEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4794258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4794261">me</span>&nbsp;<span class="op" id="4794264">:=</span>&nbsp;<span class="op" id="4794267">&amp;</span><span class="ident" id="4794268">mapEncoder</span><span class="op" id="4794278">{</span><span class="ident" id="4794279">typeEncoder</span><span class="op" id="4794290">(</span><span class="ident" id="4794291">t</span><span class="op" id="4794292">.</span><span class="ident" id="4794293">Elem</span><span class="op" id="4794297">(</span><span class="op" id="4794298">)</span><span class="op" id="4794299">)</span><span class="op" id="4794300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4794303">return</span>&nbsp;<span class="ident" id="4794310">me</span><span class="op" id="4794312">.</span><span class="ident" id="4794313">encode</span><br>
<span class="lineno">630</span><span class="op" id="4794320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4794323">func</span>&nbsp;<span class="ident" id="4794328">encodeByteSlice</span><span class="op" id="4794343">(</span><span class="ident" id="4794344">e</span>&nbsp;<span class="op" id="4794346">*</span><span class="ident" id="4794347">encodeState</span><span class="op" id="4794358">,</span>&nbsp;<span class="ident" id="4794360">v</span>&nbsp;<span class="ident" id="4794362">reflect</span><span class="op" id="4794369">.</span><span class="ident" id="4794370">Value</span><span class="op" id="4794375">,</span>&nbsp;<span class="ident" id="4794377">_</span>&nbsp;<span class="builtintype" id="4794379">bool</span><span class="op" id="4794383">)</span>&nbsp;<span class="op" id="4794385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4794388">if</span>&nbsp;<span class="ident" id="4794391">v</span><span class="op" id="4794392">.</span><span class="ident" id="4794393">IsNil</span><span class="op" id="4794398">(</span><span class="op" id="4794399">)</span>&nbsp;<span class="op" id="4794401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4794405">e</span><span class="op" id="4794406">.</span><span class="ident" id="4794407">WriteString</span><span class="op" id="4794418">(</span><span class="string" id="4794419">&#34;null&#34;</span><span class="op" id="4794425">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4794429">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4794437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4794440">s</span>&nbsp;<span class="op" id="4794442">:=</span>&nbsp;<span class="ident" id="4794445">v</span><span class="op" id="4794446">.</span><span class="ident" id="4794447">Bytes</span><span class="op" id="4794452">(</span><span class="op" id="4794453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4794456">e</span><span class="op" id="4794457">.</span><span class="ident" id="4794458">WriteByte</span><span class="op" id="4794467">(</span><span class="string" id="4794468">&#39;&#34;&#39;</span><span class="op" id="4794471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4794474">if</span>&nbsp;<span class="builtinfunc" id="4794477">len</span><span class="op" id="4794480">(</span><span class="ident" id="4794481">s</span><span class="op" id="4794482">)</span>&nbsp;<span class="op" id="4794484">&lt;</span>&nbsp;<span class="num" id="4794486">1024</span>&nbsp;<span class="op" id="4794491">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4794495">//&nbsp;for&nbsp;small&nbsp;buffers,&nbsp;using&nbsp;Encode&nbsp;directly&nbsp;is&nbsp;much&nbsp;faster.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4794557">dst</span>&nbsp;<span class="op" id="4794561">:=</span>&nbsp;<span class="builtinfunc" id="4794564">make</span><span class="op" id="4794568">(</span><span class="op" id="4794569">[</span><span class="op" id="4794570">]</span><span class="builtintype" id="4794571">byte</span><span class="op" id="4794575">,</span>&nbsp;<span class="ident" id="4794577">base64</span><span class="op" id="4794583">.</span><span class="ident" id="4794584">StdEncoding</span><span class="op" id="4794595">.</span><span class="ident" id="4794596">EncodedLen</span><span class="op" id="4794606">(</span><span class="builtinfunc" id="4794607">len</span><span class="op" id="4794610">(</span><span class="ident" id="4794611">s</span><span class="op" id="4794612">)</span><span class="op" id="4794613">)</span><span class="op" id="4794614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4794618">base64</span><span class="op" id="4794624">.</span><span class="ident" id="4794625">StdEncoding</span><span class="op" id="4794636">.</span><span class="ident" id="4794637">Encode</span><span class="op" id="4794643">(</span><span class="ident" id="4794644">dst</span><span class="op" id="4794647">,</span>&nbsp;<span class="ident" id="4794649">s</span><span class="op" id="4794650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4794654">e</span><span class="op" id="4794655">.</span><span class="ident" id="4794656">Write</span><span class="op" id="4794661">(</span><span class="ident" id="4794662">dst</span><span class="op" id="4794665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4794668">}</span>&nbsp;<span class="keyword" id="4794670">else</span>&nbsp;<span class="op" id="4794675">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4794679">//&nbsp;for&nbsp;large&nbsp;buffers,&nbsp;avoid&nbsp;unnecessary&nbsp;extra&nbsp;temporary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4794737">//&nbsp;buffer&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4794756">enc</span>&nbsp;<span class="op" id="4794760">:=</span>&nbsp;<span class="ident" id="4794763">base64</span><span class="op" id="4794769">.</span><span class="ident" id="4794770">NewEncoder</span><span class="op" id="4794780">(</span><span class="ident" id="4794781">base64</span><span class="op" id="4794787">.</span><span class="ident" id="4794788">StdEncoding</span><span class="op" id="4794799">,</span>&nbsp;<span class="ident" id="4794801">e</span><span class="op" id="4794802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4794806">enc</span><span class="op" id="4794809">.</span><span class="ident" id="4794810">Write</span><span class="op" id="4794815">(</span><span class="ident" id="4794816">s</span><span class="op" id="4794817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4794821">enc</span><span class="op" id="4794824">.</span><span class="ident" id="4794825">Close</span><span class="op" id="4794830">(</span><span class="op" id="4794831">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4794834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4794837">e</span><span class="op" id="4794838">.</span><span class="ident" id="4794839">WriteByte</span><span class="op" id="4794848">(</span><span class="string" id="4794849">&#39;&#34;&#39;</span><span class="op" id="4794852">)</span><br>
<span class="lineno"></span><span class="op" id="4794854">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4794857">//&nbsp;sliceEncoder&nbsp;just&nbsp;wraps&nbsp;an&nbsp;arrayEncoder,&nbsp;checking&nbsp;to&nbsp;make&nbsp;sure&nbsp;the&nbsp;value&nbsp;isn&#39;t&nbsp;nil.</span><br>
<span class="lineno">655</span><span class="keyword" id="4794944">type</span>&nbsp;<span class="ident" id="4794949">sliceEncoder</span>&nbsp;<span class="keyword" id="4794962">struct</span>&nbsp;<span class="op" id="4794969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4794972">arrayEnc</span>&nbsp;<span class="ident" id="4794981">encoderFunc</span><br>
<span class="lineno"></span><span class="op" id="4794993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4794996">func</span>&nbsp;<span class="op" id="4795001">(</span><span class="ident" id="4795002">se</span>&nbsp;<span class="op" id="4795005">*</span><span class="ident" id="4795006">sliceEncoder</span><span class="op" id="4795018">)</span>&nbsp;<span class="ident" id="4795020">encode</span><span class="op" id="4795026">(</span><span class="ident" id="4795027">e</span>&nbsp;<span class="op" id="4795029">*</span><span class="ident" id="4795030">encodeState</span><span class="op" id="4795041">,</span>&nbsp;<span class="ident" id="4795043">v</span>&nbsp;<span class="ident" id="4795045">reflect</span><span class="op" id="4795052">.</span><span class="ident" id="4795053">Value</span><span class="op" id="4795058">,</span>&nbsp;<span class="ident" id="4795060">_</span>&nbsp;<span class="builtintype" id="4795062">bool</span><span class="op" id="4795066">)</span>&nbsp;<span class="op" id="4795068">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4795071">if</span>&nbsp;<span class="ident" id="4795074">v</span><span class="op" id="4795075">.</span><span class="ident" id="4795076">IsNil</span><span class="op" id="4795081">(</span><span class="op" id="4795082">)</span>&nbsp;<span class="op" id="4795084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4795088">e</span><span class="op" id="4795089">.</span><span class="ident" id="4795090">WriteString</span><span class="op" id="4795101">(</span><span class="string" id="4795102">&#34;null&#34;</span><span class="op" id="4795108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4795112">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4795120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4795123">se</span><span class="op" id="4795125">.</span><span class="ident" id="4795126">arrayEnc</span><span class="op" id="4795134">(</span><span class="ident" id="4795135">e</span><span class="op" id="4795136">,</span>&nbsp;<span class="ident" id="4795138">v</span><span class="op" id="4795139">,</span>&nbsp;<span class="builtintype" id="4795141">false</span><span class="op" id="4795146">)</span><br>
<span class="lineno">665</span><span class="op" id="4795148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4795151">func</span>&nbsp;<span class="ident" id="4795156">newSliceEncoder</span><span class="op" id="4795171">(</span><span class="ident" id="4795172">t</span>&nbsp;<span class="ident" id="4795174">reflect</span><span class="op" id="4795181">.</span><span class="ident" id="4795182">Type</span><span class="op" id="4795186">)</span>&nbsp;<span class="ident" id="4795188">encoderFunc</span>&nbsp;<span class="op" id="4795200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4795203">//&nbsp;Byte&nbsp;slices&nbsp;get&nbsp;special&nbsp;treatment;&nbsp;arrays&nbsp;don&#39;t.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4795256">if</span>&nbsp;<span class="ident" id="4795259">t</span><span class="op" id="4795260">.</span><span class="ident" id="4795261">Elem</span><span class="op" id="4795265">(</span><span class="op" id="4795266">)</span><span class="op" id="4795267">.</span><span class="ident" id="4795268">Kind</span><span class="op" id="4795272">(</span><span class="op" id="4795273">)</span>&nbsp;<span class="op" id="4795275">==</span>&nbsp;<span class="ident" id="4795278">reflect</span><span class="op" id="4795285">.</span><span class="ident" id="4795286">Uint8</span>&nbsp;<span class="op" id="4795292">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4795296">return</span>&nbsp;<span class="ident" id="4795303">encodeByteSlice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4795320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4795323">enc</span>&nbsp;<span class="op" id="4795327">:=</span>&nbsp;<span class="op" id="4795330">&amp;</span><span class="ident" id="4795331">sliceEncoder</span><span class="op" id="4795343">{</span><span class="ident" id="4795344">newArrayEncoder</span><span class="op" id="4795359">(</span><span class="ident" id="4795360">t</span><span class="op" id="4795361">)</span><span class="op" id="4795362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4795365">return</span>&nbsp;<span class="ident" id="4795372">enc</span><span class="op" id="4795375">.</span><span class="ident" id="4795376">encode</span><br>
<span class="lineno"></span><span class="op" id="4795383">}</span><br>
<span class="lineno">675</span><br>
<span class="lineno"></span><span class="keyword" id="4795386">type</span>&nbsp;<span class="ident" id="4795391">arrayEncoder</span>&nbsp;<span class="keyword" id="4795404">struct</span>&nbsp;<span class="op" id="4795411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4795414">elemEnc</span>&nbsp;<span class="ident" id="4795422">encoderFunc</span><br>
<span class="lineno"></span><span class="op" id="4795434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">680</span><span class="keyword" id="4795437">func</span>&nbsp;<span class="op" id="4795442">(</span><span class="ident" id="4795443">ae</span>&nbsp;<span class="op" id="4795446">*</span><span class="ident" id="4795447">arrayEncoder</span><span class="op" id="4795459">)</span>&nbsp;<span class="ident" id="4795461">encode</span><span class="op" id="4795467">(</span><span class="ident" id="4795468">e</span>&nbsp;<span class="op" id="4795470">*</span><span class="ident" id="4795471">encodeState</span><span class="op" id="4795482">,</span>&nbsp;<span class="ident" id="4795484">v</span>&nbsp;<span class="ident" id="4795486">reflect</span><span class="op" id="4795493">.</span><span class="ident" id="4795494">Value</span><span class="op" id="4795499">,</span>&nbsp;<span class="ident" id="4795501">_</span>&nbsp;<span class="builtintype" id="4795503">bool</span><span class="op" id="4795507">)</span>&nbsp;<span class="op" id="4795509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4795512">e</span><span class="op" id="4795513">.</span><span class="ident" id="4795514">WriteByte</span><span class="op" id="4795523">(</span><span class="string" id="4795524">&#39;[&#39;</span><span class="op" id="4795527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4795530">n</span>&nbsp;<span class="op" id="4795532">:=</span>&nbsp;<span class="ident" id="4795535">v</span><span class="op" id="4795536">.</span><span class="ident" id="4795537">Len</span><span class="op" id="4795540">(</span><span class="op" id="4795541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4795544">for</span>&nbsp;<span class="ident" id="4795548">i</span>&nbsp;<span class="op" id="4795550">:=</span>&nbsp;<span class="num" id="4795553">0</span><span class="op" id="4795554">;</span>&nbsp;<span class="ident" id="4795556">i</span>&nbsp;<span class="op" id="4795558">&lt;</span>&nbsp;<span class="ident" id="4795560">n</span><span class="op" id="4795561">;</span>&nbsp;<span class="ident" id="4795563">i</span><span class="op" id="4795564">++</span>&nbsp;<span class="op" id="4795567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4795571">if</span>&nbsp;<span class="ident" id="4795574">i</span>&nbsp;<span class="op" id="4795576">&gt;</span>&nbsp;<span class="num" id="4795578">0</span>&nbsp;<span class="op" id="4795580">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4795585">e</span><span class="op" id="4795586">.</span><span class="ident" id="4795587">WriteByte</span><span class="op" id="4795596">(</span><span class="string" id="4795597">&#39;,&#39;</span><span class="op" id="4795600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4795604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4795608">ae</span><span class="op" id="4795610">.</span><span class="ident" id="4795611">elemEnc</span><span class="op" id="4795618">(</span><span class="ident" id="4795619">e</span><span class="op" id="4795620">,</span>&nbsp;<span class="ident" id="4795622">v</span><span class="op" id="4795623">.</span><span class="ident" id="4795624">Index</span><span class="op" id="4795629">(</span><span class="ident" id="4795630">i</span><span class="op" id="4795631">)</span><span class="op" id="4795632">,</span>&nbsp;<span class="builtintype" id="4795634">false</span><span class="op" id="4795639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4795642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4795645">e</span><span class="op" id="4795646">.</span><span class="ident" id="4795647">WriteByte</span><span class="op" id="4795656">(</span><span class="string" id="4795657">&#39;]&#39;</span><span class="op" id="4795660">)</span><br>
<span class="lineno">690</span><span class="op" id="4795662">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4795665">func</span>&nbsp;<span class="ident" id="4795670">newArrayEncoder</span><span class="op" id="4795685">(</span><span class="ident" id="4795686">t</span>&nbsp;<span class="ident" id="4795688">reflect</span><span class="op" id="4795695">.</span><span class="ident" id="4795696">Type</span><span class="op" id="4795700">)</span>&nbsp;<span class="ident" id="4795702">encoderFunc</span>&nbsp;<span class="op" id="4795714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4795717">enc</span>&nbsp;<span class="op" id="4795721">:=</span>&nbsp;<span class="op" id="4795724">&amp;</span><span class="ident" id="4795725">arrayEncoder</span><span class="op" id="4795737">{</span><span class="ident" id="4795738">typeEncoder</span><span class="op" id="4795749">(</span><span class="ident" id="4795750">t</span><span class="op" id="4795751">.</span><span class="ident" id="4795752">Elem</span><span class="op" id="4795756">(</span><span class="op" id="4795757">)</span><span class="op" id="4795758">)</span><span class="op" id="4795759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4795762">return</span>&nbsp;<span class="ident" id="4795769">enc</span><span class="op" id="4795772">.</span><span class="ident" id="4795773">encode</span><br>
<span class="lineno">695</span><span class="op" id="4795780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4795783">type</span>&nbsp;<span class="ident" id="4795788">ptrEncoder</span>&nbsp;<span class="keyword" id="4795799">struct</span>&nbsp;<span class="op" id="4795806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4795809">elemEnc</span>&nbsp;<span class="ident" id="4795817">encoderFunc</span><br>
<span class="lineno"></span><span class="op" id="4795829">}</span><br>
<span class="lineno">700</span><br>
<span class="lineno"></span><span class="keyword" id="4795832">func</span>&nbsp;<span class="op" id="4795837">(</span><span class="ident" id="4795838">pe</span>&nbsp;<span class="op" id="4795841">*</span><span class="ident" id="4795842">ptrEncoder</span><span class="op" id="4795852">)</span>&nbsp;<span class="ident" id="4795854">encode</span><span class="op" id="4795860">(</span><span class="ident" id="4795861">e</span>&nbsp;<span class="op" id="4795863">*</span><span class="ident" id="4795864">encodeState</span><span class="op" id="4795875">,</span>&nbsp;<span class="ident" id="4795877">v</span>&nbsp;<span class="ident" id="4795879">reflect</span><span class="op" id="4795886">.</span><span class="ident" id="4795887">Value</span><span class="op" id="4795892">,</span>&nbsp;<span class="ident" id="4795894">quoted</span>&nbsp;<span class="builtintype" id="4795901">bool</span><span class="op" id="4795905">)</span>&nbsp;<span class="op" id="4795907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4795910">if</span>&nbsp;<span class="ident" id="4795913">v</span><span class="op" id="4795914">.</span><span class="ident" id="4795915">IsNil</span><span class="op" id="4795920">(</span><span class="op" id="4795921">)</span>&nbsp;<span class="op" id="4795923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4795927">e</span><span class="op" id="4795928">.</span><span class="ident" id="4795929">WriteString</span><span class="op" id="4795940">(</span><span class="string" id="4795941">&#34;null&#34;</span><span class="op" id="4795947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4795951">return</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4795959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4795962">pe</span><span class="op" id="4795964">.</span><span class="ident" id="4795965">elemEnc</span><span class="op" id="4795972">(</span><span class="ident" id="4795973">e</span><span class="op" id="4795974">,</span>&nbsp;<span class="ident" id="4795976">v</span><span class="op" id="4795977">.</span><span class="ident" id="4795978">Elem</span><span class="op" id="4795982">(</span><span class="op" id="4795983">)</span><span class="op" id="4795984">,</span>&nbsp;<span class="ident" id="4795986">quoted</span><span class="op" id="4795992">)</span><br>
<span class="lineno"></span><span class="op" id="4795994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4795997">func</span>&nbsp;<span class="ident" id="4796002">newPtrEncoder</span><span class="op" id="4796015">(</span><span class="ident" id="4796016">t</span>&nbsp;<span class="ident" id="4796018">reflect</span><span class="op" id="4796025">.</span><span class="ident" id="4796026">Type</span><span class="op" id="4796030">)</span>&nbsp;<span class="ident" id="4796032">encoderFunc</span>&nbsp;<span class="op" id="4796044">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4796047">enc</span>&nbsp;<span class="op" id="4796051">:=</span>&nbsp;<span class="op" id="4796054">&amp;</span><span class="ident" id="4796055">ptrEncoder</span><span class="op" id="4796065">{</span><span class="ident" id="4796066">typeEncoder</span><span class="op" id="4796077">(</span><span class="ident" id="4796078">t</span><span class="op" id="4796079">.</span><span class="ident" id="4796080">Elem</span><span class="op" id="4796084">(</span><span class="op" id="4796085">)</span><span class="op" id="4796086">)</span><span class="op" id="4796087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4796090">return</span>&nbsp;<span class="ident" id="4796097">enc</span><span class="op" id="4796100">.</span><span class="ident" id="4796101">encode</span><br>
<span class="lineno"></span><span class="op" id="4796108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4796111">type</span>&nbsp;<span class="ident" id="4796116">condAddrEncoder</span>&nbsp;<span class="keyword" id="4796132">struct</span>&nbsp;<span class="op" id="4796139">{</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4796142">canAddrEnc</span><span class="op" id="4796152">,</span>&nbsp;<span class="ident" id="4796154">elseEnc</span>&nbsp;<span class="ident" id="4796162">encoderFunc</span><br>
<span class="lineno"></span><span class="op" id="4796174">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4796177">func</span>&nbsp;<span class="op" id="4796182">(</span><span class="ident" id="4796183">ce</span>&nbsp;<span class="op" id="4796186">*</span><span class="ident" id="4796187">condAddrEncoder</span><span class="op" id="4796202">)</span>&nbsp;<span class="ident" id="4796204">encode</span><span class="op" id="4796210">(</span><span class="ident" id="4796211">e</span>&nbsp;<span class="op" id="4796213">*</span><span class="ident" id="4796214">encodeState</span><span class="op" id="4796225">,</span>&nbsp;<span class="ident" id="4796227">v</span>&nbsp;<span class="ident" id="4796229">reflect</span><span class="op" id="4796236">.</span><span class="ident" id="4796237">Value</span><span class="op" id="4796242">,</span>&nbsp;<span class="ident" id="4796244">quoted</span>&nbsp;<span class="builtintype" id="4796251">bool</span><span class="op" id="4796255">)</span>&nbsp;<span class="op" id="4796257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4796260">if</span>&nbsp;<span class="ident" id="4796263">v</span><span class="op" id="4796264">.</span><span class="ident" id="4796265">CanAddr</span><span class="op" id="4796272">(</span><span class="op" id="4796273">)</span>&nbsp;<span class="op" id="4796275">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4796279">ce</span><span class="op" id="4796281">.</span><span class="ident" id="4796282">canAddrEnc</span><span class="op" id="4796292">(</span><span class="ident" id="4796293">e</span><span class="op" id="4796294">,</span>&nbsp;<span class="ident" id="4796296">v</span><span class="op" id="4796297">,</span>&nbsp;<span class="ident" id="4796299">quoted</span><span class="op" id="4796305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4796308">}</span>&nbsp;<span class="keyword" id="4796310">else</span>&nbsp;<span class="op" id="4796315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4796319">ce</span><span class="op" id="4796321">.</span><span class="ident" id="4796322">elseEnc</span><span class="op" id="4796329">(</span><span class="ident" id="4796330">e</span><span class="op" id="4796331">,</span>&nbsp;<span class="ident" id="4796333">v</span><span class="op" id="4796334">,</span>&nbsp;<span class="ident" id="4796336">quoted</span><span class="op" id="4796342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4796345">}</span><br>
<span class="lineno"></span><span class="op" id="4796347">}</span><br>
<span class="lineno">725</span><br>
<span class="lineno"></span><span class="comment" id="4796350">//&nbsp;newCondAddrEncoder&nbsp;returns&nbsp;an&nbsp;encoder&nbsp;that&nbsp;checks&nbsp;whether&nbsp;its&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="4796421">//&nbsp;CanAddr&nbsp;and&nbsp;delegates&nbsp;to&nbsp;canAddrEnc&nbsp;if&nbsp;so,&nbsp;else&nbsp;to&nbsp;elseEnc.</span><br>
<span class="lineno"></span><span class="keyword" id="4796484">func</span>&nbsp;<span class="ident" id="4796489">newCondAddrEncoder</span><span class="op" id="4796507">(</span><span class="ident" id="4796508">canAddrEnc</span><span class="op" id="4796518">,</span>&nbsp;<span class="ident" id="4796520">elseEnc</span>&nbsp;<span class="ident" id="4796528">encoderFunc</span><span class="op" id="4796539">)</span>&nbsp;<span class="ident" id="4796541">encoderFunc</span>&nbsp;<span class="op" id="4796553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4796556">enc</span>&nbsp;<span class="op" id="4796560">:=</span>&nbsp;<span class="op" id="4796563">&amp;</span><span class="ident" id="4796564">condAddrEncoder</span><span class="op" id="4796579">{</span><span class="ident" id="4796580">canAddrEnc</span><span class="op" id="4796590">:</span>&nbsp;<span class="ident" id="4796592">canAddrEnc</span><span class="op" id="4796602">,</span>&nbsp;<span class="ident" id="4796604">elseEnc</span><span class="op" id="4796611">:</span>&nbsp;<span class="ident" id="4796613">elseEnc</span><span class="op" id="4796620">}</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4796623">return</span>&nbsp;<span class="ident" id="4796630">enc</span><span class="op" id="4796633">.</span><span class="ident" id="4796634">encode</span><br>
<span class="lineno"></span><span class="op" id="4796641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4796644">func</span>&nbsp;<span class="ident" id="4796649">isValidTag</span><span class="op" id="4796659">(</span><span class="ident" id="4796660">s</span>&nbsp;<span class="builtintype" id="4796662">string</span><span class="op" id="4796668">)</span>&nbsp;<span class="builtintype" id="4796670">bool</span>&nbsp;<span class="op" id="4796675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4796678">if</span>&nbsp;<span class="ident" id="4796681">s</span>&nbsp;<span class="op" id="4796683">==</span>&nbsp;<span class="string" id="4796686">&#34;&#34;</span>&nbsp;<span class="op" id="4796689">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4796693">return</span>&nbsp;<span class="builtintype" id="4796700">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4796707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4796710">for</span>&nbsp;<span class="ident" id="4796714">_</span><span class="op" id="4796715">,</span>&nbsp;<span class="ident" id="4796717">c</span>&nbsp;<span class="op" id="4796719">:=</span>&nbsp;<span class="keyword" id="4796722">range</span>&nbsp;<span class="ident" id="4796728">s</span>&nbsp;<span class="op" id="4796730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4796734">switch</span>&nbsp;<span class="op" id="4796741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4796745">case</span>&nbsp;<span class="ident" id="4796750">strings</span><span class="op" id="4796757">.</span><span class="ident" id="4796758">ContainsRune</span><span class="op" id="4796770">(</span><span class="string" id="4796771">&#34;!#$%&amp;()*+-./:&lt;=&gt;?@[]^_{|}~&nbsp;&#34;</span><span class="op" id="4796800">,</span>&nbsp;<span class="ident" id="4796802">c</span><span class="op" id="4796803">)</span><span class="op" id="4796804">:</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4796809">//&nbsp;Backslash&nbsp;and&nbsp;quote&nbsp;chars&nbsp;are&nbsp;reserved,&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4796859">//&nbsp;otherwise&nbsp;any&nbsp;punctuation&nbsp;chars&nbsp;are&nbsp;allowed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4796909">//&nbsp;in&nbsp;a&nbsp;tag&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4796929">default</span><span class="op" id="4796936">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4796941">if</span>&nbsp;<span class="op" id="4796944">!</span><span class="ident" id="4796945">unicode</span><span class="op" id="4796952">.</span><span class="ident" id="4796953">IsLetter</span><span class="op" id="4796961">(</span><span class="ident" id="4796962">c</span><span class="op" id="4796963">)</span>&nbsp;<span class="op" id="4796965">&amp;&amp;</span>&nbsp;<span class="op" id="4796968">!</span><span class="ident" id="4796969">unicode</span><span class="op" id="4796976">.</span><span class="ident" id="4796977">IsDigit</span><span class="op" id="4796984">(</span><span class="ident" id="4796985">c</span><span class="op" id="4796986">)</span>&nbsp;<span class="op" id="4796988">{</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4796994">return</span>&nbsp;<span class="builtintype" id="4797001">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4797010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4797014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4797017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4797020">return</span>&nbsp;<span class="builtintype" id="4797027">true</span><br>
<span class="lineno">750</span><span class="op" id="4797032">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4797035">func</span>&nbsp;<span class="ident" id="4797040">fieldByIndex</span><span class="op" id="4797052">(</span><span class="ident" id="4797053">v</span>&nbsp;<span class="ident" id="4797055">reflect</span><span class="op" id="4797062">.</span><span class="ident" id="4797063">Value</span><span class="op" id="4797068">,</span>&nbsp;<span class="ident" id="4797070">index</span>&nbsp;<span class="op" id="4797076">[</span><span class="op" id="4797077">]</span><span class="builtintype" id="4797078">int</span><span class="op" id="4797081">)</span>&nbsp;<span class="ident" id="4797083">reflect</span><span class="op" id="4797090">.</span><span class="ident" id="4797091">Value</span>&nbsp;<span class="op" id="4797097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4797100">for</span>&nbsp;<span class="ident" id="4797104">_</span><span class="op" id="4797105">,</span>&nbsp;<span class="ident" id="4797107">i</span>&nbsp;<span class="op" id="4797109">:=</span>&nbsp;<span class="keyword" id="4797112">range</span>&nbsp;<span class="ident" id="4797118">index</span>&nbsp;<span class="op" id="4797124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4797128">if</span>&nbsp;<span class="ident" id="4797131">v</span><span class="op" id="4797132">.</span><span class="ident" id="4797133">Kind</span><span class="op" id="4797137">(</span><span class="op" id="4797138">)</span>&nbsp;<span class="op" id="4797140">==</span>&nbsp;<span class="ident" id="4797143">reflect</span><span class="op" id="4797150">.</span><span class="ident" id="4797151">Ptr</span>&nbsp;<span class="op" id="4797155">{</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4797160">if</span>&nbsp;<span class="ident" id="4797163">v</span><span class="op" id="4797164">.</span><span class="ident" id="4797165">IsNil</span><span class="op" id="4797170">(</span><span class="op" id="4797171">)</span>&nbsp;<span class="op" id="4797173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4797179">return</span>&nbsp;<span class="ident" id="4797186">reflect</span><span class="op" id="4797193">.</span><span class="ident" id="4797194">Value</span><span class="op" id="4797199">{</span><span class="op" id="4797200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4797205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4797210">v</span>&nbsp;<span class="op" id="4797212">=</span>&nbsp;<span class="ident" id="4797214">v</span><span class="op" id="4797215">.</span><span class="ident" id="4797216">Elem</span><span class="op" id="4797220">(</span><span class="op" id="4797221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4797225">}</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4797229">v</span>&nbsp;<span class="op" id="4797231">=</span>&nbsp;<span class="ident" id="4797233">v</span><span class="op" id="4797234">.</span><span class="ident" id="4797235">Field</span><span class="op" id="4797240">(</span><span class="ident" id="4797241">i</span><span class="op" id="4797242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4797245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4797248">return</span>&nbsp;<span class="ident" id="4797255">v</span><br>
<span class="lineno"></span><span class="op" id="4797257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">765</span><span class="keyword" id="4797260">func</span>&nbsp;<span class="ident" id="4797265">typeByIndex</span><span class="op" id="4797276">(</span><span class="ident" id="4797277">t</span>&nbsp;<span class="ident" id="4797279">reflect</span><span class="op" id="4797286">.</span><span class="ident" id="4797287">Type</span><span class="op" id="4797291">,</span>&nbsp;<span class="ident" id="4797293">index</span>&nbsp;<span class="op" id="4797299">[</span><span class="op" id="4797300">]</span><span class="builtintype" id="4797301">int</span><span class="op" id="4797304">)</span>&nbsp;<span class="ident" id="4797306">reflect</span><span class="op" id="4797313">.</span><span class="ident" id="4797314">Type</span>&nbsp;<span class="op" id="4797319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4797322">for</span>&nbsp;<span class="ident" id="4797326">_</span><span class="op" id="4797327">,</span>&nbsp;<span class="ident" id="4797329">i</span>&nbsp;<span class="op" id="4797331">:=</span>&nbsp;<span class="keyword" id="4797334">range</span>&nbsp;<span class="ident" id="4797340">index</span>&nbsp;<span class="op" id="4797346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4797350">if</span>&nbsp;<span class="ident" id="4797353">t</span><span class="op" id="4797354">.</span><span class="ident" id="4797355">Kind</span><span class="op" id="4797359">(</span><span class="op" id="4797360">)</span>&nbsp;<span class="op" id="4797362">==</span>&nbsp;<span class="ident" id="4797365">reflect</span><span class="op" id="4797372">.</span><span class="ident" id="4797373">Ptr</span>&nbsp;<span class="op" id="4797377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4797382">t</span>&nbsp;<span class="op" id="4797384">=</span>&nbsp;<span class="ident" id="4797386">t</span><span class="op" id="4797387">.</span><span class="ident" id="4797388">Elem</span><span class="op" id="4797392">(</span><span class="op" id="4797393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4797397">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4797401">t</span>&nbsp;<span class="op" id="4797403">=</span>&nbsp;<span class="ident" id="4797405">t</span><span class="op" id="4797406">.</span><span class="ident" id="4797407">Field</span><span class="op" id="4797412">(</span><span class="ident" id="4797413">i</span><span class="op" id="4797414">)</span><span class="op" id="4797415">.</span><span class="ident" id="4797416">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4797422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4797425">return</span>&nbsp;<span class="ident" id="4797432">t</span><br>
<span class="lineno"></span><span class="op" id="4797434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">775</span><span class="comment" id="4797437">//&nbsp;stringValues&nbsp;is&nbsp;a&nbsp;slice&nbsp;of&nbsp;reflect.Value&nbsp;holding&nbsp;*reflect.StringValue.</span><br>
<span class="lineno"></span><span class="comment" id="4797511">//&nbsp;It&nbsp;implements&nbsp;the&nbsp;methods&nbsp;to&nbsp;sort&nbsp;by&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="4797559">type</span>&nbsp;<span class="ident" id="4797564">stringValues</span>&nbsp;<span class="op" id="4797577">[</span><span class="op" id="4797578">]</span><span class="ident" id="4797579">reflect</span><span class="op" id="4797586">.</span><span class="ident" id="4797587">Value</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4797594">func</span>&nbsp;<span class="op" id="4797599">(</span><span class="ident" id="4797600">sv</span>&nbsp;<span class="ident" id="4797603">stringValues</span><span class="op" id="4797615">)</span>&nbsp;<span class="ident" id="4797617">Len</span><span class="op" id="4797620">(</span><span class="op" id="4797621">)</span>&nbsp;<span class="builtintype" id="4797623">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4797637">{</span>&nbsp;<span class="keyword" id="4797639">return</span>&nbsp;<span class="builtinfunc" id="4797646">len</span><span class="op" id="4797649">(</span><span class="ident" id="4797650">sv</span><span class="op" id="4797652">)</span>&nbsp;<span class="op" id="4797654">}</span><br>
<span class="lineno">780</span><span class="keyword" id="4797656">func</span>&nbsp;<span class="op" id="4797661">(</span><span class="ident" id="4797662">sv</span>&nbsp;<span class="ident" id="4797665">stringValues</span><span class="op" id="4797677">)</span>&nbsp;<span class="ident" id="4797679">Swap</span><span class="op" id="4797683">(</span><span class="ident" id="4797684">i</span><span class="op" id="4797685">,</span>&nbsp;<span class="ident" id="4797687">j</span>&nbsp;<span class="builtintype" id="4797689">int</span><span class="op" id="4797692">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4797699">{</span>&nbsp;<span class="ident" id="4797701">sv</span><span class="op" id="4797703">[</span><span class="ident" id="4797704">i</span><span class="op" id="4797705">]</span><span class="op" id="4797706">,</span>&nbsp;<span class="ident" id="4797708">sv</span><span class="op" id="4797710">[</span><span class="ident" id="4797711">j</span><span class="op" id="4797712">]</span>&nbsp;<span class="op" id="4797714">=</span>&nbsp;<span class="ident" id="4797716">sv</span><span class="op" id="4797718">[</span><span class="ident" id="4797719">j</span><span class="op" id="4797720">]</span><span class="op" id="4797721">,</span>&nbsp;<span class="ident" id="4797723">sv</span><span class="op" id="4797725">[</span><span class="ident" id="4797726">i</span><span class="op" id="4797727">]</span>&nbsp;<span class="op" id="4797729">}</span><br>
<span class="lineno"></span><span class="keyword" id="4797731">func</span>&nbsp;<span class="op" id="4797736">(</span><span class="ident" id="4797737">sv</span>&nbsp;<span class="ident" id="4797740">stringValues</span><span class="op" id="4797752">)</span>&nbsp;<span class="ident" id="4797754">Less</span><span class="op" id="4797758">(</span><span class="ident" id="4797759">i</span><span class="op" id="4797760">,</span>&nbsp;<span class="ident" id="4797762">j</span>&nbsp;<span class="builtintype" id="4797764">int</span><span class="op" id="4797767">)</span>&nbsp;<span class="builtintype" id="4797769">bool</span>&nbsp;<span class="op" id="4797774">{</span>&nbsp;<span class="keyword" id="4797776">return</span>&nbsp;<span class="ident" id="4797783">sv</span><span class="op" id="4797785">.</span><span class="ident" id="4797786">get</span><span class="op" id="4797789">(</span><span class="ident" id="4797790">i</span><span class="op" id="4797791">)</span>&nbsp;<span class="op" id="4797793">&lt;</span>&nbsp;<span class="ident" id="4797795">sv</span><span class="op" id="4797797">.</span><span class="ident" id="4797798">get</span><span class="op" id="4797801">(</span><span class="ident" id="4797802">j</span><span class="op" id="4797803">)</span>&nbsp;<span class="op" id="4797805">}</span><br>
<span class="lineno"></span><span class="keyword" id="4797807">func</span>&nbsp;<span class="op" id="4797812">(</span><span class="ident" id="4797813">sv</span>&nbsp;<span class="ident" id="4797816">stringValues</span><span class="op" id="4797828">)</span>&nbsp;<span class="ident" id="4797830">get</span><span class="op" id="4797833">(</span><span class="ident" id="4797834">i</span>&nbsp;<span class="builtintype" id="4797836">int</span><span class="op" id="4797839">)</span>&nbsp;<span class="builtintype" id="4797841">string</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4797850">{</span>&nbsp;<span class="keyword" id="4797852">return</span>&nbsp;<span class="ident" id="4797859">sv</span><span class="op" id="4797861">[</span><span class="ident" id="4797862">i</span><span class="op" id="4797863">]</span><span class="op" id="4797864">.</span><span class="ident" id="4797865">String</span><span class="op" id="4797871">(</span><span class="op" id="4797872">)</span>&nbsp;<span class="op" id="4797874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4797877">//&nbsp;NOTE:&nbsp;keep&nbsp;in&nbsp;sync&nbsp;with&nbsp;stringBytes&nbsp;below.</span><br>
<span class="lineno">785</span><span class="keyword" id="4797923">func</span>&nbsp;<span class="op" id="4797928">(</span><span class="ident" id="4797929">e</span>&nbsp;<span class="op" id="4797931">*</span><span class="ident" id="4797932">encodeState</span><span class="op" id="4797943">)</span>&nbsp;<span class="builtintype" id="4797945">string</span><span class="op" id="4797951">(</span><span class="ident" id="4797952">s</span>&nbsp;<span class="builtintype" id="4797954">string</span><span class="op" id="4797960">)</span>&nbsp;<span class="op" id="4797962">(</span><span class="builtintype" id="4797963">int</span><span class="op" id="4797966">,</span>&nbsp;<span class="builtintype" id="4797968">error</span><span class="op" id="4797973">)</span>&nbsp;<span class="op" id="4797975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4797978">len0</span>&nbsp;<span class="op" id="4797983">:=</span>&nbsp;<span class="ident" id="4797986">e</span><span class="op" id="4797987">.</span><span class="ident" id="4797988">Len</span><span class="op" id="4797991">(</span><span class="op" id="4797992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4797995">e</span><span class="op" id="4797996">.</span><span class="ident" id="4797997">WriteByte</span><span class="op" id="4798006">(</span><span class="string" id="4798007">&#39;&#34;&#39;</span><span class="op" id="4798010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798013">start</span>&nbsp;<span class="op" id="4798019">:=</span>&nbsp;<span class="num" id="4798022">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4798025">for</span>&nbsp;<span class="ident" id="4798029">i</span>&nbsp;<span class="op" id="4798031">:=</span>&nbsp;<span class="num" id="4798034">0</span><span class="op" id="4798035">;</span>&nbsp;<span class="ident" id="4798037">i</span>&nbsp;<span class="op" id="4798039">&lt;</span>&nbsp;<span class="builtinfunc" id="4798041">len</span><span class="op" id="4798044">(</span><span class="ident" id="4798045">s</span><span class="op" id="4798046">)</span><span class="op" id="4798047">;</span>&nbsp;<span class="op" id="4798049">{</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4798053">if</span>&nbsp;<span class="ident" id="4798056">b</span>&nbsp;<span class="op" id="4798058">:=</span>&nbsp;<span class="ident" id="4798061">s</span><span class="op" id="4798062">[</span><span class="ident" id="4798063">i</span><span class="op" id="4798064">]</span><span class="op" id="4798065">;</span>&nbsp;<span class="ident" id="4798067">b</span>&nbsp;<span class="op" id="4798069">&lt;</span>&nbsp;<span class="ident" id="4798071">utf8</span><span class="op" id="4798075">.</span><span class="ident" id="4798076">RuneSelf</span>&nbsp;<span class="op" id="4798085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4798090">if</span>&nbsp;<span class="num" id="4798093">0x20</span>&nbsp;<span class="op" id="4798098">&lt;=</span>&nbsp;<span class="ident" id="4798101">b</span>&nbsp;<span class="op" id="4798103">&amp;&amp;</span>&nbsp;<span class="ident" id="4798106">b</span>&nbsp;<span class="op" id="4798108">!=</span>&nbsp;<span class="string" id="4798111">&#39;\\&#39;</span>&nbsp;<span class="op" id="4798116">&amp;&amp;</span>&nbsp;<span class="ident" id="4798119">b</span>&nbsp;<span class="op" id="4798121">!=</span>&nbsp;<span class="string" id="4798124">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="4798128">&amp;&amp;</span>&nbsp;<span class="ident" id="4798131">b</span>&nbsp;<span class="op" id="4798133">!=</span>&nbsp;<span class="string" id="4798136">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="4798140">&amp;&amp;</span>&nbsp;<span class="ident" id="4798143">b</span>&nbsp;<span class="op" id="4798145">!=</span>&nbsp;<span class="string" id="4798148">&#39;&gt;&#39;</span>&nbsp;<span class="op" id="4798152">&amp;&amp;</span>&nbsp;<span class="ident" id="4798155">b</span>&nbsp;<span class="op" id="4798157">!=</span>&nbsp;<span class="string" id="4798160">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="4798164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798170">i</span><span class="op" id="4798171">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4798178">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4798190">}</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4798195">if</span>&nbsp;<span class="ident" id="4798198">start</span>&nbsp;<span class="op" id="4798204">&lt;</span>&nbsp;<span class="ident" id="4798206">i</span>&nbsp;<span class="op" id="4798208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798214">e</span><span class="op" id="4798215">.</span><span class="ident" id="4798216">WriteString</span><span class="op" id="4798227">(</span><span class="ident" id="4798228">s</span><span class="op" id="4798229">[</span><span class="ident" id="4798230">start</span><span class="op" id="4798235">:</span><span class="ident" id="4798236">i</span><span class="op" id="4798237">]</span><span class="op" id="4798238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4798243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4798248">switch</span>&nbsp;<span class="ident" id="4798255">b</span>&nbsp;<span class="op" id="4798257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4798262">case</span>&nbsp;<span class="string" id="4798267">&#39;\\&#39;</span><span class="op" id="4798271">,</span>&nbsp;<span class="string" id="4798273">&#39;&#34;&#39;</span><span class="op" id="4798276">:</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798282">e</span><span class="op" id="4798283">.</span><span class="ident" id="4798284">WriteByte</span><span class="op" id="4798293">(</span><span class="string" id="4798294">&#39;\\&#39;</span><span class="op" id="4798298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798304">e</span><span class="op" id="4798305">.</span><span class="ident" id="4798306">WriteByte</span><span class="op" id="4798315">(</span><span class="ident" id="4798316">b</span><span class="op" id="4798317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4798322">case</span>&nbsp;<span class="string" id="4798327">&#39;\n&#39;</span><span class="op" id="4798331">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798337">e</span><span class="op" id="4798338">.</span><span class="ident" id="4798339">WriteByte</span><span class="op" id="4798348">(</span><span class="string" id="4798349">&#39;\\&#39;</span><span class="op" id="4798353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798359">e</span><span class="op" id="4798360">.</span><span class="ident" id="4798361">WriteByte</span><span class="op" id="4798370">(</span><span class="string" id="4798371">&#39;n&#39;</span><span class="op" id="4798374">)</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4798379">case</span>&nbsp;<span class="string" id="4798384">&#39;\r&#39;</span><span class="op" id="4798388">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798394">e</span><span class="op" id="4798395">.</span><span class="ident" id="4798396">WriteByte</span><span class="op" id="4798405">(</span><span class="string" id="4798406">&#39;\\&#39;</span><span class="op" id="4798410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798416">e</span><span class="op" id="4798417">.</span><span class="ident" id="4798418">WriteByte</span><span class="op" id="4798427">(</span><span class="string" id="4798428">&#39;r&#39;</span><span class="op" id="4798431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4798436">case</span>&nbsp;<span class="string" id="4798441">&#39;\t&#39;</span><span class="op" id="4798445">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798451">e</span><span class="op" id="4798452">.</span><span class="ident" id="4798453">WriteByte</span><span class="op" id="4798462">(</span><span class="string" id="4798463">&#39;\\&#39;</span><span class="op" id="4798467">)</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798473">e</span><span class="op" id="4798474">.</span><span class="ident" id="4798475">WriteByte</span><span class="op" id="4798484">(</span><span class="string" id="4798485">&#39;t&#39;</span><span class="op" id="4798488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4798493">default</span><span class="op" id="4798500">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4798506">//&nbsp;This&nbsp;encodes&nbsp;bytes&nbsp;&lt;&nbsp;0x20&nbsp;except&nbsp;for&nbsp;\n&nbsp;and&nbsp;\r,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4798561">//&nbsp;as&nbsp;well&nbsp;as&nbsp;&lt;,&nbsp;&gt;&nbsp;and&nbsp;&amp;.&nbsp;The&nbsp;latter&nbsp;are&nbsp;escaped&nbsp;because&nbsp;they</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4798627">//&nbsp;can&nbsp;lead&nbsp;to&nbsp;security&nbsp;holes&nbsp;when&nbsp;user-controlled&nbsp;strings</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4798690">//&nbsp;are&nbsp;rendered&nbsp;into&nbsp;JSON&nbsp;and&nbsp;served&nbsp;to&nbsp;some&nbsp;browsers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798749">e</span><span class="op" id="4798750">.</span><span class="ident" id="4798751">WriteString</span><span class="op" id="4798762">(</span><span class="string" id="4798763">`\u00`</span><span class="op" id="4798769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798775">e</span><span class="op" id="4798776">.</span><span class="ident" id="4798777">WriteByte</span><span class="op" id="4798786">(</span><span class="ident" id="4798787">hex</span><span class="op" id="4798790">[</span><span class="ident" id="4798791">b</span><span class="op" id="4798792">&gt;&gt;</span><span class="num" id="4798794">4</span><span class="op" id="4798795">]</span><span class="op" id="4798796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798802">e</span><span class="op" id="4798803">.</span><span class="ident" id="4798804">WriteByte</span><span class="op" id="4798813">(</span><span class="ident" id="4798814">hex</span><span class="op" id="4798817">[</span><span class="ident" id="4798818">b</span><span class="op" id="4798819">&amp;</span><span class="num" id="4798820">0xF</span><span class="op" id="4798823">]</span><span class="op" id="4798824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4798829">}</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798834">i</span><span class="op" id="4798835">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798841">start</span>&nbsp;<span class="op" id="4798847">=</span>&nbsp;<span class="ident" id="4798849">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4798854">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4798865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798869">c</span><span class="op" id="4798870">,</span>&nbsp;<span class="ident" id="4798872">size</span>&nbsp;<span class="op" id="4798877">:=</span>&nbsp;<span class="ident" id="4798880">utf8</span><span class="op" id="4798884">.</span><span class="ident" id="4798885">DecodeRuneInString</span><span class="op" id="4798903">(</span><span class="ident" id="4798904">s</span><span class="op" id="4798905">[</span><span class="ident" id="4798906">i</span><span class="op" id="4798907">:</span><span class="op" id="4798908">]</span><span class="op" id="4798909">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4798913">if</span>&nbsp;<span class="ident" id="4798916">c</span>&nbsp;<span class="op" id="4798918">==</span>&nbsp;<span class="ident" id="4798921">utf8</span><span class="op" id="4798925">.</span><span class="ident" id="4798926">RuneError</span>&nbsp;<span class="op" id="4798936">&amp;&amp;</span>&nbsp;<span class="ident" id="4798939">size</span>&nbsp;<span class="op" id="4798944">==</span>&nbsp;<span class="num" id="4798947">1</span>&nbsp;<span class="op" id="4798949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4798954">if</span>&nbsp;<span class="ident" id="4798957">start</span>&nbsp;<span class="op" id="4798963">&lt;</span>&nbsp;<span class="ident" id="4798965">i</span>&nbsp;<span class="op" id="4798967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798973">e</span><span class="op" id="4798974">.</span><span class="ident" id="4798975">WriteString</span><span class="op" id="4798986">(</span><span class="ident" id="4798987">s</span><span class="op" id="4798988">[</span><span class="ident" id="4798989">start</span><span class="op" id="4798994">:</span><span class="ident" id="4798995">i</span><span class="op" id="4798996">]</span><span class="op" id="4798997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4799002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4799007">e</span><span class="op" id="4799008">.</span><span class="ident" id="4799009">WriteString</span><span class="op" id="4799020">(</span><span class="string" id="4799021">`\ufffd`</span><span class="op" id="4799029">)</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4799034">i</span>&nbsp;<span class="op" id="4799036">+=</span>&nbsp;<span class="ident" id="4799039">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4799047">start</span>&nbsp;<span class="op" id="4799053">=</span>&nbsp;<span class="ident" id="4799055">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4799060">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4799071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4799075">//&nbsp;U+2028&nbsp;is&nbsp;LINE&nbsp;SEPARATOR.</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4799106">//&nbsp;U+2029&nbsp;is&nbsp;PARAGRAPH&nbsp;SEPARATOR.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4799142">//&nbsp;They&nbsp;are&nbsp;both&nbsp;technically&nbsp;valid&nbsp;characters&nbsp;in&nbsp;JSON&nbsp;strings,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4799207">//&nbsp;but&nbsp;don&#39;t&nbsp;work&nbsp;in&nbsp;JSONP,&nbsp;which&nbsp;has&nbsp;to&nbsp;be&nbsp;evaluated&nbsp;as&nbsp;JavaScript,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4799278">//&nbsp;and&nbsp;can&nbsp;lead&nbsp;to&nbsp;security&nbsp;holes&nbsp;there.&nbsp;It&nbsp;is&nbsp;valid&nbsp;JSON&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4799341">//&nbsp;escape&nbsp;them,&nbsp;so&nbsp;we&nbsp;do&nbsp;so&nbsp;unconditionally.</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4799388">//&nbsp;See&nbsp;http://timelessrepo.com/json-isnt-a-javascript-subset&nbsp;for&nbsp;discussion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4799467">if</span>&nbsp;<span class="ident" id="4799470">c</span>&nbsp;<span class="op" id="4799472">==</span>&nbsp;<span class="string" id="4799475">&#39;\u2028&#39;</span>&nbsp;<span class="op" id="4799484">||</span>&nbsp;<span class="ident" id="4799487">c</span>&nbsp;<span class="op" id="4799489">==</span>&nbsp;<span class="string" id="4799492">&#39;\u2029&#39;</span>&nbsp;<span class="op" id="4799501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4799506">if</span>&nbsp;<span class="ident" id="4799509">start</span>&nbsp;<span class="op" id="4799515">&lt;</span>&nbsp;<span class="ident" id="4799517">i</span>&nbsp;<span class="op" id="4799519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4799525">e</span><span class="op" id="4799526">.</span><span class="ident" id="4799527">WriteString</span><span class="op" id="4799538">(</span><span class="ident" id="4799539">s</span><span class="op" id="4799540">[</span><span class="ident" id="4799541">start</span><span class="op" id="4799546">:</span><span class="ident" id="4799547">i</span><span class="op" id="4799548">]</span><span class="op" id="4799549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4799554">}</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4799559">e</span><span class="op" id="4799560">.</span><span class="ident" id="4799561">WriteString</span><span class="op" id="4799572">(</span><span class="string" id="4799573">`\u202`</span><span class="op" id="4799580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4799585">e</span><span class="op" id="4799586">.</span><span class="ident" id="4799587">WriteByte</span><span class="op" id="4799596">(</span><span class="ident" id="4799597">hex</span><span class="op" id="4799600">[</span><span class="ident" id="4799601">c</span><span class="op" id="4799602">&amp;</span><span class="num" id="4799603">0xF</span><span class="op" id="4799606">]</span><span class="op" id="4799607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4799612">i</span>&nbsp;<span class="op" id="4799614">+=</span>&nbsp;<span class="ident" id="4799617">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4799625">start</span>&nbsp;<span class="op" id="4799631">=</span>&nbsp;<span class="ident" id="4799633">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4799638">continue</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4799649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4799653">i</span>&nbsp;<span class="op" id="4799655">+=</span>&nbsp;<span class="ident" id="4799658">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4799664">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4799667">if</span>&nbsp;<span class="ident" id="4799670">start</span>&nbsp;<span class="op" id="4799676">&lt;</span>&nbsp;<span class="builtinfunc" id="4799678">len</span><span class="op" id="4799681">(</span><span class="ident" id="4799682">s</span><span class="op" id="4799683">)</span>&nbsp;<span class="op" id="4799685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4799689">e</span><span class="op" id="4799690">.</span><span class="ident" id="4799691">WriteString</span><span class="op" id="4799702">(</span><span class="ident" id="4799703">s</span><span class="op" id="4799704">[</span><span class="ident" id="4799705">start</span><span class="op" id="4799710">:</span><span class="op" id="4799711">]</span><span class="op" id="4799712">)</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4799715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4799718">e</span><span class="op" id="4799719">.</span><span class="ident" id="4799720">WriteByte</span><span class="op" id="4799729">(</span><span class="string" id="4799730">&#39;&#34;&#39;</span><span class="op" id="4799733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4799736">return</span>&nbsp;<span class="ident" id="4799743">e</span><span class="op" id="4799744">.</span><span class="ident" id="4799745">Len</span><span class="op" id="4799748">(</span><span class="op" id="4799749">)</span>&nbsp;<span class="op" id="4799751">-</span>&nbsp;<span class="ident" id="4799753">len0</span><span class="op" id="4799757">,</span>&nbsp;<span class="ident" id="4799759">nil</span><br>
<span class="lineno"></span><span class="op" id="4799763">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">860</span><span class="comment" id="4799766">//&nbsp;NOTE:&nbsp;keep&nbsp;in&nbsp;sync&nbsp;with&nbsp;string&nbsp;above.</span><br>
<span class="lineno"></span><span class="keyword" id="4799807">func</span>&nbsp;<span class="op" id="4799812">(</span><span class="ident" id="4799813">e</span>&nbsp;<span class="op" id="4799815">*</span><span class="ident" id="4799816">encodeState</span><span class="op" id="4799827">)</span>&nbsp;<span class="ident" id="4799829">stringBytes</span><span class="op" id="4799840">(</span><span class="ident" id="4799841">s</span>&nbsp;<span class="op" id="4799843">[</span><span class="op" id="4799844">]</span><span class="builtintype" id="4799845">byte</span><span class="op" id="4799849">)</span>&nbsp;<span class="op" id="4799851">(</span><span class="builtintype" id="4799852">int</span><span class="op" id="4799855">,</span>&nbsp;<span class="builtintype" id="4799857">error</span><span class="op" id="4799862">)</span>&nbsp;<span class="op" id="4799864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4799867">len0</span>&nbsp;<span class="op" id="4799872">:=</span>&nbsp;<span class="ident" id="4799875">e</span><span class="op" id="4799876">.</span><span class="ident" id="4799877">Len</span><span class="op" id="4799880">(</span><span class="op" id="4799881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4799884">e</span><span class="op" id="4799885">.</span><span class="ident" id="4799886">WriteByte</span><span class="op" id="4799895">(</span><span class="string" id="4799896">&#39;&#34;&#39;</span><span class="op" id="4799899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4799902">start</span>&nbsp;<span class="op" id="4799908">:=</span>&nbsp;<span class="num" id="4799911">0</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4799914">for</span>&nbsp;<span class="ident" id="4799918">i</span>&nbsp;<span class="op" id="4799920">:=</span>&nbsp;<span class="num" id="4799923">0</span><span class="op" id="4799924">;</span>&nbsp;<span class="ident" id="4799926">i</span>&nbsp;<span class="op" id="4799928">&lt;</span>&nbsp;<span class="builtinfunc" id="4799930">len</span><span class="op" id="4799933">(</span><span class="ident" id="4799934">s</span><span class="op" id="4799935">)</span><span class="op" id="4799936">;</span>&nbsp;<span class="op" id="4799938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4799942">if</span>&nbsp;<span class="ident" id="4799945">b</span>&nbsp;<span class="op" id="4799947">:=</span>&nbsp;<span class="ident" id="4799950">s</span><span class="op" id="4799951">[</span><span class="ident" id="4799952">i</span><span class="op" id="4799953">]</span><span class="op" id="4799954">;</span>&nbsp;<span class="ident" id="4799956">b</span>&nbsp;<span class="op" id="4799958">&lt;</span>&nbsp;<span class="ident" id="4799960">utf8</span><span class="op" id="4799964">.</span><span class="ident" id="4799965">RuneSelf</span>&nbsp;<span class="op" id="4799974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4799979">if</span>&nbsp;<span class="num" id="4799982">0x20</span>&nbsp;<span class="op" id="4799987">&lt;=</span>&nbsp;<span class="ident" id="4799990">b</span>&nbsp;<span class="op" id="4799992">&amp;&amp;</span>&nbsp;<span class="ident" id="4799995">b</span>&nbsp;<span class="op" id="4799997">!=</span>&nbsp;<span class="string" id="4800000">&#39;\\&#39;</span>&nbsp;<span class="op" id="4800005">&amp;&amp;</span>&nbsp;<span class="ident" id="4800008">b</span>&nbsp;<span class="op" id="4800010">!=</span>&nbsp;<span class="string" id="4800013">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="4800017">&amp;&amp;</span>&nbsp;<span class="ident" id="4800020">b</span>&nbsp;<span class="op" id="4800022">!=</span>&nbsp;<span class="string" id="4800025">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="4800029">&amp;&amp;</span>&nbsp;<span class="ident" id="4800032">b</span>&nbsp;<span class="op" id="4800034">!=</span>&nbsp;<span class="string" id="4800037">&#39;&gt;&#39;</span>&nbsp;<span class="op" id="4800041">&amp;&amp;</span>&nbsp;<span class="ident" id="4800044">b</span>&nbsp;<span class="op" id="4800046">!=</span>&nbsp;<span class="string" id="4800049">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="4800053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800059">i</span><span class="op" id="4800060">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4800067">continue</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4800079">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4800084">if</span>&nbsp;<span class="ident" id="4800087">start</span>&nbsp;<span class="op" id="4800093">&lt;</span>&nbsp;<span class="ident" id="4800095">i</span>&nbsp;<span class="op" id="4800097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800103">e</span><span class="op" id="4800104">.</span><span class="ident" id="4800105">Write</span><span class="op" id="4800110">(</span><span class="ident" id="4800111">s</span><span class="op" id="4800112">[</span><span class="ident" id="4800113">start</span><span class="op" id="4800118">:</span><span class="ident" id="4800119">i</span><span class="op" id="4800120">]</span><span class="op" id="4800121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4800126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4800131">switch</span>&nbsp;<span class="ident" id="4800138">b</span>&nbsp;<span class="op" id="4800140">{</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4800145">case</span>&nbsp;<span class="string" id="4800150">&#39;\\&#39;</span><span class="op" id="4800154">,</span>&nbsp;<span class="string" id="4800156">&#39;&#34;&#39;</span><span class="op" id="4800159">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800165">e</span><span class="op" id="4800166">.</span><span class="ident" id="4800167">WriteByte</span><span class="op" id="4800176">(</span><span class="string" id="4800177">&#39;\\&#39;</span><span class="op" id="4800181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800187">e</span><span class="op" id="4800188">.</span><span class="ident" id="4800189">WriteByte</span><span class="op" id="4800198">(</span><span class="ident" id="4800199">b</span><span class="op" id="4800200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4800205">case</span>&nbsp;<span class="string" id="4800210">&#39;\n&#39;</span><span class="op" id="4800214">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800220">e</span><span class="op" id="4800221">.</span><span class="ident" id="4800222">WriteByte</span><span class="op" id="4800231">(</span><span class="string" id="4800232">&#39;\\&#39;</span><span class="op" id="4800236">)</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800242">e</span><span class="op" id="4800243">.</span><span class="ident" id="4800244">WriteByte</span><span class="op" id="4800253">(</span><span class="string" id="4800254">&#39;n&#39;</span><span class="op" id="4800257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4800262">case</span>&nbsp;<span class="string" id="4800267">&#39;\r&#39;</span><span class="op" id="4800271">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800277">e</span><span class="op" id="4800278">.</span><span class="ident" id="4800279">WriteByte</span><span class="op" id="4800288">(</span><span class="string" id="4800289">&#39;\\&#39;</span><span class="op" id="4800293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800299">e</span><span class="op" id="4800300">.</span><span class="ident" id="4800301">WriteByte</span><span class="op" id="4800310">(</span><span class="string" id="4800311">&#39;r&#39;</span><span class="op" id="4800314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4800319">case</span>&nbsp;<span class="string" id="4800324">&#39;\t&#39;</span><span class="op" id="4800328">:</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800334">e</span><span class="op" id="4800335">.</span><span class="ident" id="4800336">WriteByte</span><span class="op" id="4800345">(</span><span class="string" id="4800346">&#39;\\&#39;</span><span class="op" id="4800350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800356">e</span><span class="op" id="4800357">.</span><span class="ident" id="4800358">WriteByte</span><span class="op" id="4800367">(</span><span class="string" id="4800368">&#39;t&#39;</span><span class="op" id="4800371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4800376">default</span><span class="op" id="4800383">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4800389">//&nbsp;This&nbsp;encodes&nbsp;bytes&nbsp;&lt;&nbsp;0x20&nbsp;except&nbsp;for&nbsp;\n&nbsp;and&nbsp;\r,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4800444">//&nbsp;as&nbsp;well&nbsp;as&nbsp;&lt;,&nbsp;&gt;,&nbsp;and&nbsp;&amp;.&nbsp;The&nbsp;latter&nbsp;are&nbsp;escaped&nbsp;because&nbsp;they</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4800511">//&nbsp;can&nbsp;lead&nbsp;to&nbsp;security&nbsp;holes&nbsp;when&nbsp;user-controlled&nbsp;strings</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4800574">//&nbsp;are&nbsp;rendered&nbsp;into&nbsp;JSON&nbsp;and&nbsp;served&nbsp;to&nbsp;some&nbsp;browsers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800633">e</span><span class="op" id="4800634">.</span><span class="ident" id="4800635">WriteString</span><span class="op" id="4800646">(</span><span class="string" id="4800647">`\u00`</span><span class="op" id="4800653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800659">e</span><span class="op" id="4800660">.</span><span class="ident" id="4800661">WriteByte</span><span class="op" id="4800670">(</span><span class="ident" id="4800671">hex</span><span class="op" id="4800674">[</span><span class="ident" id="4800675">b</span><span class="op" id="4800676">&gt;&gt;</span><span class="num" id="4800678">4</span><span class="op" id="4800679">]</span><span class="op" id="4800680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800686">e</span><span class="op" id="4800687">.</span><span class="ident" id="4800688">WriteByte</span><span class="op" id="4800697">(</span><span class="ident" id="4800698">hex</span><span class="op" id="4800701">[</span><span class="ident" id="4800702">b</span><span class="op" id="4800703">&amp;</span><span class="num" id="4800704">0xF</span><span class="op" id="4800707">]</span><span class="op" id="4800708">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4800713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800718">i</span><span class="op" id="4800719">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800725">start</span>&nbsp;<span class="op" id="4800731">=</span>&nbsp;<span class="ident" id="4800733">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4800738">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4800749">}</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800753">c</span><span class="op" id="4800754">,</span>&nbsp;<span class="ident" id="4800756">size</span>&nbsp;<span class="op" id="4800761">:=</span>&nbsp;<span class="ident" id="4800764">utf8</span><span class="op" id="4800768">.</span><span class="ident" id="4800769">DecodeRune</span><span class="op" id="4800779">(</span><span class="ident" id="4800780">s</span><span class="op" id="4800781">[</span><span class="ident" id="4800782">i</span><span class="op" id="4800783">:</span><span class="op" id="4800784">]</span><span class="op" id="4800785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4800789">if</span>&nbsp;<span class="ident" id="4800792">c</span>&nbsp;<span class="op" id="4800794">==</span>&nbsp;<span class="ident" id="4800797">utf8</span><span class="op" id="4800801">.</span><span class="ident" id="4800802">RuneError</span>&nbsp;<span class="op" id="4800812">&amp;&amp;</span>&nbsp;<span class="ident" id="4800815">size</span>&nbsp;<span class="op" id="4800820">==</span>&nbsp;<span class="num" id="4800823">1</span>&nbsp;<span class="op" id="4800825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4800830">if</span>&nbsp;<span class="ident" id="4800833">start</span>&nbsp;<span class="op" id="4800839">&lt;</span>&nbsp;<span class="ident" id="4800841">i</span>&nbsp;<span class="op" id="4800843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800849">e</span><span class="op" id="4800850">.</span><span class="ident" id="4800851">Write</span><span class="op" id="4800856">(</span><span class="ident" id="4800857">s</span><span class="op" id="4800858">[</span><span class="ident" id="4800859">start</span><span class="op" id="4800864">:</span><span class="ident" id="4800865">i</span><span class="op" id="4800866">]</span><span class="op" id="4800867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4800872">}</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800877">e</span><span class="op" id="4800878">.</span><span class="ident" id="4800879">WriteString</span><span class="op" id="4800890">(</span><span class="string" id="4800891">`\ufffd`</span><span class="op" id="4800899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800904">i</span>&nbsp;<span class="op" id="4800906">+=</span>&nbsp;<span class="ident" id="4800909">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800917">start</span>&nbsp;<span class="op" id="4800923">=</span>&nbsp;<span class="ident" id="4800925">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4800930">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4800941">}</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4800945">//&nbsp;U+2028&nbsp;is&nbsp;LINE&nbsp;SEPARATOR.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4800976">//&nbsp;U+2029&nbsp;is&nbsp;PARAGRAPH&nbsp;SEPARATOR.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4801012">//&nbsp;They&nbsp;are&nbsp;both&nbsp;technically&nbsp;valid&nbsp;characters&nbsp;in&nbsp;JSON&nbsp;strings,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4801077">//&nbsp;but&nbsp;don&#39;t&nbsp;work&nbsp;in&nbsp;JSONP,&nbsp;which&nbsp;has&nbsp;to&nbsp;be&nbsp;evaluated&nbsp;as&nbsp;JavaScript,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4801148">//&nbsp;and&nbsp;can&nbsp;lead&nbsp;to&nbsp;security&nbsp;holes&nbsp;there.&nbsp;It&nbsp;is&nbsp;valid&nbsp;JSON&nbsp;to</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4801211">//&nbsp;escape&nbsp;them,&nbsp;so&nbsp;we&nbsp;do&nbsp;so&nbsp;unconditionally.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4801258">//&nbsp;See&nbsp;http://timelessrepo.com/json-isnt-a-javascript-subset&nbsp;for&nbsp;discussion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4801337">if</span>&nbsp;<span class="ident" id="4801340">c</span>&nbsp;<span class="op" id="4801342">==</span>&nbsp;<span class="string" id="4801345">&#39;\u2028&#39;</span>&nbsp;<span class="op" id="4801354">||</span>&nbsp;<span class="ident" id="4801357">c</span>&nbsp;<span class="op" id="4801359">==</span>&nbsp;<span class="string" id="4801362">&#39;\u2029&#39;</span>&nbsp;<span class="op" id="4801371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4801376">if</span>&nbsp;<span class="ident" id="4801379">start</span>&nbsp;<span class="op" id="4801385">&lt;</span>&nbsp;<span class="ident" id="4801387">i</span>&nbsp;<span class="op" id="4801389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4801395">e</span><span class="op" id="4801396">.</span><span class="ident" id="4801397">Write</span><span class="op" id="4801402">(</span><span class="ident" id="4801403">s</span><span class="op" id="4801404">[</span><span class="ident" id="4801405">start</span><span class="op" id="4801410">:</span><span class="ident" id="4801411">i</span><span class="op" id="4801412">]</span><span class="op" id="4801413">)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4801418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4801423">e</span><span class="op" id="4801424">.</span><span class="ident" id="4801425">WriteString</span><span class="op" id="4801436">(</span><span class="string" id="4801437">`\u202`</span><span class="op" id="4801444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4801449">e</span><span class="op" id="4801450">.</span><span class="ident" id="4801451">WriteByte</span><span class="op" id="4801460">(</span><span class="ident" id="4801461">hex</span><span class="op" id="4801464">[</span><span class="ident" id="4801465">c</span><span class="op" id="4801466">&amp;</span><span class="num" id="4801467">0xF</span><span class="op" id="4801470">]</span><span class="op" id="4801471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4801476">i</span>&nbsp;<span class="op" id="4801478">+=</span>&nbsp;<span class="ident" id="4801481">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4801489">start</span>&nbsp;<span class="op" id="4801495">=</span>&nbsp;<span class="ident" id="4801497">i</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4801502">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4801513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4801517">i</span>&nbsp;<span class="op" id="4801519">+=</span>&nbsp;<span class="ident" id="4801522">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4801528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4801531">if</span>&nbsp;<span class="ident" id="4801534">start</span>&nbsp;<span class="op" id="4801540">&lt;</span>&nbsp;<span class="builtinfunc" id="4801542">len</span><span class="op" id="4801545">(</span><span class="ident" id="4801546">s</span><span class="op" id="4801547">)</span>&nbsp;<span class="op" id="4801549">{</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4801553">e</span><span class="op" id="4801554">.</span><span class="ident" id="4801555">Write</span><span class="op" id="4801560">(</span><span class="ident" id="4801561">s</span><span class="op" id="4801562">[</span><span class="ident" id="4801563">start</span><span class="op" id="4801568">:</span><span class="op" id="4801569">]</span><span class="op" id="4801570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4801573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4801576">e</span><span class="op" id="4801577">.</span><span class="ident" id="4801578">WriteByte</span><span class="op" id="4801587">(</span><span class="string" id="4801588">&#39;&#34;&#39;</span><span class="op" id="4801591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4801594">return</span>&nbsp;<span class="ident" id="4801601">e</span><span class="op" id="4801602">.</span><span class="ident" id="4801603">Len</span><span class="op" id="4801606">(</span><span class="op" id="4801607">)</span>&nbsp;<span class="op" id="4801609">-</span>&nbsp;<span class="ident" id="4801611">len0</span><span class="op" id="4801615">,</span>&nbsp;<span class="ident" id="4801617">nil</span><br>
<span class="lineno"></span><span class="op" id="4801621">}</span><br>
<span class="lineno">935</span><br>
<span class="lineno"></span><span class="comment" id="4801624">//&nbsp;A&nbsp;field&nbsp;represents&nbsp;a&nbsp;single&nbsp;field&nbsp;found&nbsp;in&nbsp;a&nbsp;struct.</span><br>
<span class="lineno"></span><span class="keyword" id="4801680">type</span>&nbsp;<span class="ident" id="4801685">field</span>&nbsp;<span class="keyword" id="4801691">struct</span>&nbsp;<span class="op" id="4801698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4801701">name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4801711">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4801719">nameBytes</span>&nbsp;<span class="op" id="4801729">[</span><span class="op" id="4801730">]</span><span class="builtintype" id="4801731">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4801752">//&nbsp;[]byte(name)</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4801769">equalFold</span>&nbsp;<span class="keyword" id="4801779">func</span><span class="op" id="4801783">(</span><span class="ident" id="4801784">s</span><span class="op" id="4801785">,</span>&nbsp;<span class="ident" id="4801787">t</span>&nbsp;<span class="op" id="4801789">[</span><span class="op" id="4801790">]</span><span class="builtintype" id="4801791">byte</span><span class="op" id="4801795">)</span>&nbsp;<span class="builtintype" id="4801797">bool</span>&nbsp;<span class="comment" id="4801802">//&nbsp;bytes.EqualFold&nbsp;or&nbsp;equivalent</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4801837">tag</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4801847">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4801853">index</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4801863">[</span><span class="op" id="4801864">]</span><span class="builtintype" id="4801865">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4801870">typ</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4801880">reflect</span><span class="op" id="4801887">.</span><span class="ident" id="4801888">Type</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4801894">omitEmpty</span>&nbsp;<span class="builtintype" id="4801904">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4801910">quoted</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4801920">bool</span><br>
<span class="lineno"></span><span class="op" id="4801925">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4801928">func</span>&nbsp;<span class="ident" id="4801933">fillField</span><span class="op" id="4801942">(</span><span class="ident" id="4801943">f</span>&nbsp;<span class="ident" id="4801945">field</span><span class="op" id="4801950">)</span>&nbsp;<span class="ident" id="4801952">field</span>&nbsp;<span class="op" id="4801958">{</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4801961">f</span><span class="op" id="4801962">.</span><span class="ident" id="4801963">nameBytes</span>&nbsp;<span class="op" id="4801973">=</span>&nbsp;<span class="op" id="4801975">[</span><span class="op" id="4801976">]</span><span class="builtintype" id="4801977">byte</span><span class="op" id="4801981">(</span><span class="ident" id="4801982">f</span><span class="op" id="4801983">.</span><span class="ident" id="4801984">name</span><span class="op" id="4801988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4801991">f</span><span class="op" id="4801992">.</span><span class="ident" id="4801993">equalFold</span>&nbsp;<span class="op" id="4802003">=</span>&nbsp;<span class="ident" id="4802005">foldFunc</span><span class="op" id="4802013">(</span><span class="ident" id="4802014">f</span><span class="op" id="4802015">.</span><span class="ident" id="4802016">nameBytes</span><span class="op" id="4802025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4802028">return</span>&nbsp;<span class="ident" id="4802035">f</span><br>
<span class="lineno"></span><span class="op" id="4802037">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">955</span><span class="comment" id="4802040">//&nbsp;byName&nbsp;sorts&nbsp;field&nbsp;by&nbsp;name,&nbsp;breaking&nbsp;ties&nbsp;with&nbsp;depth,</span><br>
<span class="lineno"></span><span class="comment" id="4802097">//&nbsp;then&nbsp;breaking&nbsp;ties&nbsp;with&nbsp;&#34;name&nbsp;came&nbsp;from&nbsp;json&nbsp;tag&#34;,&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="4802156">//&nbsp;breaking&nbsp;ties&nbsp;with&nbsp;index&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="keyword" id="4802194">type</span>&nbsp;<span class="ident" id="4802199">byName</span>&nbsp;<span class="op" id="4802206">[</span><span class="op" id="4802207">]</span><span class="ident" id="4802208">field</span><br>
<span class="lineno"></span><br>
<span class="lineno">960</span><span class="keyword" id="4802215">func</span>&nbsp;<span class="op" id="4802220">(</span><span class="ident" id="4802221">x</span>&nbsp;<span class="ident" id="4802223">byName</span><span class="op" id="4802229">)</span>&nbsp;<span class="ident" id="4802231">Len</span><span class="op" id="4802234">(</span><span class="op" id="4802235">)</span>&nbsp;<span class="builtintype" id="4802237">int</span>&nbsp;<span class="op" id="4802241">{</span>&nbsp;<span class="keyword" id="4802243">return</span>&nbsp;<span class="builtinfunc" id="4802250">len</span><span class="op" id="4802253">(</span><span class="ident" id="4802254">x</span><span class="op" id="4802255">)</span>&nbsp;<span class="op" id="4802257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4802260">func</span>&nbsp;<span class="op" id="4802265">(</span><span class="ident" id="4802266">x</span>&nbsp;<span class="ident" id="4802268">byName</span><span class="op" id="4802274">)</span>&nbsp;<span class="ident" id="4802276">Swap</span><span class="op" id="4802280">(</span><span class="ident" id="4802281">i</span><span class="op" id="4802282">,</span>&nbsp;<span class="ident" id="4802284">j</span>&nbsp;<span class="builtintype" id="4802286">int</span><span class="op" id="4802289">)</span>&nbsp;<span class="op" id="4802291">{</span>&nbsp;<span class="ident" id="4802293">x</span><span class="op" id="4802294">[</span><span class="ident" id="4802295">i</span><span class="op" id="4802296">]</span><span class="op" id="4802297">,</span>&nbsp;<span class="ident" id="4802299">x</span><span class="op" id="4802300">[</span><span class="ident" id="4802301">j</span><span class="op" id="4802302">]</span>&nbsp;<span class="op" id="4802304">=</span>&nbsp;<span class="ident" id="4802306">x</span><span class="op" id="4802307">[</span><span class="ident" id="4802308">j</span><span class="op" id="4802309">]</span><span class="op" id="4802310">,</span>&nbsp;<span class="ident" id="4802312">x</span><span class="op" id="4802313">[</span><span class="ident" id="4802314">i</span><span class="op" id="4802315">]</span>&nbsp;<span class="op" id="4802317">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4802320">func</span>&nbsp;<span class="op" id="4802325">(</span><span class="ident" id="4802326">x</span>&nbsp;<span class="ident" id="4802328">byName</span><span class="op" id="4802334">)</span>&nbsp;<span class="ident" id="4802336">Less</span><span class="op" id="4802340">(</span><span class="ident" id="4802341">i</span><span class="op" id="4802342">,</span>&nbsp;<span class="ident" id="4802344">j</span>&nbsp;<span class="builtintype" id="4802346">int</span><span class="op" id="4802349">)</span>&nbsp;<span class="builtintype" id="4802351">bool</span>&nbsp;<span class="op" id="4802356">{</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4802359">if</span>&nbsp;<span class="ident" id="4802362">x</span><span class="op" id="4802363">[</span><span class="ident" id="4802364">i</span><span class="op" id="4802365">]</span><span class="op" id="4802366">.</span><span class="ident" id="4802367">name</span>&nbsp;<span class="op" id="4802372">!=</span>&nbsp;<span class="ident" id="4802375">x</span><span class="op" id="4802376">[</span><span class="ident" id="4802377">j</span><span class="op" id="4802378">]</span><span class="op" id="4802379">.</span><span class="ident" id="4802380">name</span>&nbsp;<span class="op" id="4802385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4802389">return</span>&nbsp;<span class="ident" id="4802396">x</span><span class="op" id="4802397">[</span><span class="ident" id="4802398">i</span><span class="op" id="4802399">]</span><span class="op" id="4802400">.</span><span class="ident" id="4802401">name</span>&nbsp;<span class="op" id="4802406">&lt;</span>&nbsp;<span class="ident" id="4802408">x</span><span class="op" id="4802409">[</span><span class="ident" id="4802410">j</span><span class="op" id="4802411">]</span><span class="op" id="4802412">.</span><span class="ident" id="4802413">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4802419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4802422">if</span>&nbsp;<span class="builtinfunc" id="4802425">len</span><span class="op" id="4802428">(</span><span class="ident" id="4802429">x</span><span class="op" id="4802430">[</span><span class="ident" id="4802431">i</span><span class="op" id="4802432">]</span><span class="op" id="4802433">.</span><span class="ident" id="4802434">index</span><span class="op" id="4802439">)</span>&nbsp;<span class="op" id="4802441">!=</span>&nbsp;<span class="builtinfunc" id="4802444">len</span><span class="op" id="4802447">(</span><span class="ident" id="4802448">x</span><span class="op" id="4802449">[</span><span class="ident" id="4802450">j</span><span class="op" id="4802451">]</span><span class="op" id="4802452">.</span><span class="ident" id="4802453">index</span><span class="op" id="4802458">)</span>&nbsp;<span class="op" id="4802460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4802464">return</span>&nbsp;<span class="builtinfunc" id="4802471">len</span><span class="op" id="4802474">(</span><span class="ident" id="4802475">x</span><span class="op" id="4802476">[</span><span class="ident" id="4802477">i</span><span class="op" id="4802478">]</span><span class="op" id="4802479">.</span><span class="ident" id="4802480">index</span><span class="op" id="4802485">)</span>&nbsp;<span class="op" id="4802487">&lt;</span>&nbsp;<span class="builtinfunc" id="4802489">len</span><span class="op" id="4802492">(</span><span class="ident" id="4802493">x</span><span class="op" id="4802494">[</span><span class="ident" id="4802495">j</span><span class="op" id="4802496">]</span><span class="op" id="4802497">.</span><span class="ident" id="4802498">index</span><span class="op" id="4802503">)</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4802506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4802509">if</span>&nbsp;<span class="ident" id="4802512">x</span><span class="op" id="4802513">[</span><span class="ident" id="4802514">i</span><span class="op" id="4802515">]</span><span class="op" id="4802516">.</span><span class="ident" id="4802517">tag</span>&nbsp;<span class="op" id="4802521">!=</span>&nbsp;<span class="ident" id="4802524">x</span><span class="op" id="4802525">[</span><span class="ident" id="4802526">j</span><span class="op" id="4802527">]</span><span class="op" id="4802528">.</span><span class="ident" id="4802529">tag</span>&nbsp;<span class="op" id="4802533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4802537">return</span>&nbsp;<span class="ident" id="4802544">x</span><span class="op" id="4802545">[</span><span class="ident" id="4802546">i</span><span class="op" id="4802547">]</span><span class="op" id="4802548">.</span><span class="ident" id="4802549">tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4802554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4802557">return</span>&nbsp;<span class="ident" id="4802564">byIndex</span><span class="op" id="4802571">(</span><span class="ident" id="4802572">x</span><span class="op" id="4802573">)</span><span class="op" id="4802574">.</span><span class="ident" id="4802575">Less</span><span class="op" id="4802579">(</span><span class="ident" id="4802580">i</span><span class="op" id="4802581">,</span>&nbsp;<span class="ident" id="4802583">j</span><span class="op" id="4802584">)</span><br>
<span class="lineno">975</span><span class="op" id="4802586">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4802589">//&nbsp;byIndex&nbsp;sorts&nbsp;field&nbsp;by&nbsp;index&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="keyword" id="4802631">type</span>&nbsp;<span class="ident" id="4802636">byIndex</span>&nbsp;<span class="op" id="4802644">[</span><span class="op" id="4802645">]</span><span class="ident" id="4802646">field</span><br>
<span class="lineno"></span><br>
<span class="lineno">980</span><span class="keyword" id="4802653">func</span>&nbsp;<span class="op" id="4802658">(</span><span class="ident" id="4802659">x</span>&nbsp;<span class="ident" id="4802661">byIndex</span><span class="op" id="4802668">)</span>&nbsp;<span class="ident" id="4802670">Len</span><span class="op" id="4802673">(</span><span class="op" id="4802674">)</span>&nbsp;<span class="builtintype" id="4802676">int</span>&nbsp;<span class="op" id="4802680">{</span>&nbsp;<span class="keyword" id="4802682">return</span>&nbsp;<span class="builtinfunc" id="4802689">len</span><span class="op" id="4802692">(</span><span class="ident" id="4802693">x</span><span class="op" id="4802694">)</span>&nbsp;<span class="op" id="4802696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4802699">func</span>&nbsp;<span class="op" id="4802704">(</span><span class="ident" id="4802705">x</span>&nbsp;<span class="ident" id="4802707">byIndex</span><span class="op" id="4802714">)</span>&nbsp;<span class="ident" id="4802716">Swap</span><span class="op" id="4802720">(</span><span class="ident" id="4802721">i</span><span class="op" id="4802722">,</span>&nbsp;<span class="ident" id="4802724">j</span>&nbsp;<span class="builtintype" id="4802726">int</span><span class="op" id="4802729">)</span>&nbsp;<span class="op" id="4802731">{</span>&nbsp;<span class="ident" id="4802733">x</span><span class="op" id="4802734">[</span><span class="ident" id="4802735">i</span><span class="op" id="4802736">]</span><span class="op" id="4802737">,</span>&nbsp;<span class="ident" id="4802739">x</span><span class="op" id="4802740">[</span><span class="ident" id="4802741">j</span><span class="op" id="4802742">]</span>&nbsp;<span class="op" id="4802744">=</span>&nbsp;<span class="ident" id="4802746">x</span><span class="op" id="4802747">[</span><span class="ident" id="4802748">j</span><span class="op" id="4802749">]</span><span class="op" id="4802750">,</span>&nbsp;<span class="ident" id="4802752">x</span><span class="op" id="4802753">[</span><span class="ident" id="4802754">i</span><span class="op" id="4802755">]</span>&nbsp;<span class="op" id="4802757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4802760">func</span>&nbsp;<span class="op" id="4802765">(</span><span class="ident" id="4802766">x</span>&nbsp;<span class="ident" id="4802768">byIndex</span><span class="op" id="4802775">)</span>&nbsp;<span class="ident" id="4802777">Less</span><span class="op" id="4802781">(</span><span class="ident" id="4802782">i</span><span class="op" id="4802783">,</span>&nbsp;<span class="ident" id="4802785">j</span>&nbsp;<span class="builtintype" id="4802787">int</span><span class="op" id="4802790">)</span>&nbsp;<span class="builtintype" id="4802792">bool</span>&nbsp;<span class="op" id="4802797">{</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4802800">for</span>&nbsp;<span class="ident" id="4802804">k</span><span class="op" id="4802805">,</span>&nbsp;<span class="ident" id="4802807">xik</span>&nbsp;<span class="op" id="4802811">:=</span>&nbsp;<span class="keyword" id="4802814">range</span>&nbsp;<span class="ident" id="4802820">x</span><span class="op" id="4802821">[</span><span class="ident" id="4802822">i</span><span class="op" id="4802823">]</span><span class="op" id="4802824">.</span><span class="ident" id="4802825">index</span>&nbsp;<span class="op" id="4802831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4802835">if</span>&nbsp;<span class="ident" id="4802838">k</span>&nbsp;<span class="op" id="4802840">&gt;=</span>&nbsp;<span class="builtinfunc" id="4802843">len</span><span class="op" id="4802846">(</span><span class="ident" id="4802847">x</span><span class="op" id="4802848">[</span><span class="ident" id="4802849">j</span><span class="op" id="4802850">]</span><span class="op" id="4802851">.</span><span class="ident" id="4802852">index</span><span class="op" id="4802857">)</span>&nbsp;<span class="op" id="4802859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4802864">return</span>&nbsp;<span class="builtintype" id="4802871">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4802879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4802883">if</span>&nbsp;<span class="ident" id="4802886">xik</span>&nbsp;<span class="op" id="4802890">!=</span>&nbsp;<span class="ident" id="4802893">x</span><span class="op" id="4802894">[</span><span class="ident" id="4802895">j</span><span class="op" id="4802896">]</span><span class="op" id="4802897">.</span><span class="ident" id="4802898">index</span><span class="op" id="4802903">[</span><span class="ident" id="4802904">k</span><span class="op" id="4802905">]</span>&nbsp;<span class="op" id="4802907">{</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4802912">return</span>&nbsp;<span class="ident" id="4802919">xik</span>&nbsp;<span class="op" id="4802923">&lt;</span>&nbsp;<span class="ident" id="4802925">x</span><span class="op" id="4802926">[</span><span class="ident" id="4802927">j</span><span class="op" id="4802928">]</span><span class="op" id="4802929">.</span><span class="ident" id="4802930">index</span><span class="op" id="4802935">[</span><span class="ident" id="4802936">k</span><span class="op" id="4802937">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4802941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4802944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4802947">return</span>&nbsp;<span class="builtinfunc" id="4802954">len</span><span class="op" id="4802957">(</span><span class="ident" id="4802958">x</span><span class="op" id="4802959">[</span><span class="ident" id="4802960">i</span><span class="op" id="4802961">]</span><span class="op" id="4802962">.</span><span class="ident" id="4802963">index</span><span class="op" id="4802968">)</span>&nbsp;<span class="op" id="4802970">&lt;</span>&nbsp;<span class="builtinfunc" id="4802972">len</span><span class="op" id="4802975">(</span><span class="ident" id="4802976">x</span><span class="op" id="4802977">[</span><span class="ident" id="4802978">j</span><span class="op" id="4802979">]</span><span class="op" id="4802980">.</span><span class="ident" id="4802981">index</span><span class="op" id="4802986">)</span><br>
<span class="lineno"></span><span class="op" id="4802988">}</span><br>
<span class="lineno">995</span><br>
<span class="lineno"></span><span class="comment" id="4802991">//&nbsp;typeFields&nbsp;returns&nbsp;a&nbsp;list&nbsp;of&nbsp;fields&nbsp;that&nbsp;JSON&nbsp;should&nbsp;recognize&nbsp;for&nbsp;the&nbsp;given&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="4803077">//&nbsp;The&nbsp;algorithm&nbsp;is&nbsp;breadth-first&nbsp;search&nbsp;over&nbsp;the&nbsp;set&nbsp;of&nbsp;structs&nbsp;to&nbsp;include&nbsp;-&nbsp;the&nbsp;top&nbsp;struct</span><br>
<span class="lineno"></span><span class="comment" id="4803170">//&nbsp;and&nbsp;then&nbsp;any&nbsp;reachable&nbsp;anonymous&nbsp;structs.</span><br>
<span class="lineno"></span><span class="keyword" id="4803215">func</span>&nbsp;<span class="ident" id="4803220">typeFields</span><span class="op" id="4803230">(</span><span class="ident" id="4803231">t</span>&nbsp;<span class="ident" id="4803233">reflect</span><span class="op" id="4803240">.</span><span class="ident" id="4803241">Type</span><span class="op" id="4803245">)</span>&nbsp;<span class="op" id="4803247">[</span><span class="op" id="4803248">]</span><span class="ident" id="4803249">field</span>&nbsp;<span class="op" id="4803255">{</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4803258">//&nbsp;Anonymous&nbsp;fields&nbsp;to&nbsp;explore&nbsp;at&nbsp;the&nbsp;current&nbsp;level&nbsp;and&nbsp;the&nbsp;next.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4803325">current</span>&nbsp;<span class="op" id="4803333">:=</span>&nbsp;<span class="op" id="4803336">[</span><span class="op" id="4803337">]</span><span class="ident" id="4803338">field</span><span class="op" id="4803343">{</span><span class="op" id="4803344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4803347">next</span>&nbsp;<span class="op" id="4803352">:=</span>&nbsp;<span class="op" id="4803355">[</span><span class="op" id="4803356">]</span><span class="ident" id="4803357">field</span><span class="op" id="4803362">{</span><span class="op" id="4803363">{</span><span class="ident" id="4803364">typ</span><span class="op" id="4803367">:</span>&nbsp;<span class="ident" id="4803369">t</span><span class="op" id="4803370">}</span><span class="op" id="4803371">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4803375">//&nbsp;Count&nbsp;of&nbsp;queued&nbsp;names&nbsp;for&nbsp;current&nbsp;level&nbsp;and&nbsp;the&nbsp;next.</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4803433">count</span>&nbsp;<span class="op" id="4803439">:=</span>&nbsp;<span class="keyword" id="4803442">map</span><span class="op" id="4803445">[</span><span class="ident" id="4803446">reflect</span><span class="op" id="4803453">.</span><span class="ident" id="4803454">Type</span><span class="op" id="4803458">]</span><span class="builtintype" id="4803459">int</span><span class="op" id="4803462">{</span><span class="op" id="4803463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4803466">nextCount</span>&nbsp;<span class="op" id="4803476">:=</span>&nbsp;<span class="keyword" id="4803479">map</span><span class="op" id="4803482">[</span><span class="ident" id="4803483">reflect</span><span class="op" id="4803490">.</span><span class="ident" id="4803491">Type</span><span class="op" id="4803495">]</span><span class="builtintype" id="4803496">int</span><span class="op" id="4803499">{</span><span class="op" id="4803500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4803504">//&nbsp;Types&nbsp;already&nbsp;visited&nbsp;at&nbsp;an&nbsp;earlier&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4803551">visited</span>&nbsp;<span class="op" id="4803559">:=</span>&nbsp;<span class="keyword" id="4803562">map</span><span class="op" id="4803565">[</span><span class="ident" id="4803566">reflect</span><span class="op" id="4803573">.</span><span class="ident" id="4803574">Type</span><span class="op" id="4803578">]</span><span class="builtintype" id="4803579">bool</span><span class="op" id="4803583">{</span><span class="op" id="4803584">}</span><br>
<span class="lineno">1010</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4803588">//&nbsp;Fields&nbsp;found.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4803606">var</span>&nbsp;<span class="ident" id="4803610">fields</span>&nbsp;<span class="op" id="4803617">[</span><span class="op" id="4803618">]</span><span class="ident" id="4803619">field</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4803627">for</span>&nbsp;<span class="builtinfunc" id="4803631">len</span><span class="op" id="4803634">(</span><span class="ident" id="4803635">next</span><span class="op" id="4803639">)</span>&nbsp;<span class="op" id="4803641">&gt;</span>&nbsp;<span class="num" id="4803643">0</span>&nbsp;<span class="op" id="4803645">{</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4803649">current</span><span class="op" id="4803656">,</span>&nbsp;<span class="ident" id="4803658">next</span>&nbsp;<span class="op" id="4803663">=</span>&nbsp;<span class="ident" id="4803665">next</span><span class="op" id="4803669">,</span>&nbsp;<span class="ident" id="4803671">current</span><span class="op" id="4803678">[</span><span class="op" id="4803679">:</span><span class="num" id="4803680">0</span><span class="op" id="4803681">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4803685">count</span><span class="op" id="4803690">,</span>&nbsp;<span class="ident" id="4803692">nextCount</span>&nbsp;<span class="op" id="4803702">=</span>&nbsp;<span class="ident" id="4803704">nextCount</span><span class="op" id="4803713">,</span>&nbsp;<span class="keyword" id="4803715">map</span><span class="op" id="4803718">[</span><span class="ident" id="4803719">reflect</span><span class="op" id="4803726">.</span><span class="ident" id="4803727">Type</span><span class="op" id="4803731">]</span><span class="builtintype" id="4803732">int</span><span class="op" id="4803735">{</span><span class="op" id="4803736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4803741">for</span>&nbsp;<span class="ident" id="4803745">_</span><span class="op" id="4803746">,</span>&nbsp;<span class="ident" id="4803748">f</span>&nbsp;<span class="op" id="4803750">:=</span>&nbsp;<span class="keyword" id="4803753">range</span>&nbsp;<span class="ident" id="4803759">current</span>&nbsp;<span class="op" id="4803767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4803772">if</span>&nbsp;<span class="ident" id="4803775">visited</span><span class="op" id="4803782">[</span><span class="ident" id="4803783">f</span><span class="op" id="4803784">.</span><span class="ident" id="4803785">typ</span><span class="op" id="4803788">]</span>&nbsp;<span class="op" id="4803790">{</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4803796">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4803808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4803813">visited</span><span class="op" id="4803820">[</span><span class="ident" id="4803821">f</span><span class="op" id="4803822">.</span><span class="ident" id="4803823">typ</span><span class="op" id="4803826">]</span>&nbsp;<span class="op" id="4803828">=</span>&nbsp;<span class="builtintype" id="4803830">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4803839">//&nbsp;Scan&nbsp;f.typ&nbsp;for&nbsp;fields&nbsp;to&nbsp;include.</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4803879">for</span>&nbsp;<span class="ident" id="4803883">i</span>&nbsp;<span class="op" id="4803885">:=</span>&nbsp;<span class="num" id="4803888">0</span><span class="op" id="4803889">;</span>&nbsp;<span class="ident" id="4803891">i</span>&nbsp;<span class="op" id="4803893">&lt;</span>&nbsp;<span class="ident" id="4803895">f</span><span class="op" id="4803896">.</span><span class="ident" id="4803897">typ</span><span class="op" id="4803900">.</span><span class="ident" id="4803901">NumField</span><span class="op" id="4803909">(</span><span class="op" id="4803910">)</span><span class="op" id="4803911">;</span>&nbsp;<span class="ident" id="4803913">i</span><span class="op" id="4803914">++</span>&nbsp;<span class="op" id="4803917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4803923">sf</span>&nbsp;<span class="op" id="4803926">:=</span>&nbsp;<span class="ident" id="4803929">f</span><span class="op" id="4803930">.</span><span class="ident" id="4803931">typ</span><span class="op" id="4803934">.</span><span class="ident" id="4803935">Field</span><span class="op" id="4803940">(</span><span class="ident" id="4803941">i</span><span class="op" id="4803942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4803948">if</span>&nbsp;<span class="ident" id="4803951">sf</span><span class="op" id="4803953">.</span><span class="ident" id="4803954">PkgPath</span>&nbsp;<span class="op" id="4803962">!=</span>&nbsp;<span class="string" id="4803965">&#34;&#34;</span>&nbsp;<span class="op" id="4803968">{</span>&nbsp;<span class="comment" id="4803970">//&nbsp;unexported</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4803989">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4804002">}</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4804008">tag</span>&nbsp;<span class="op" id="4804012">:=</span>&nbsp;<span class="ident" id="4804015">sf</span><span class="op" id="4804017">.</span><span class="ident" id="4804018">Tag</span><span class="op" id="4804021">.</span><span class="ident" id="4804022">Get</span><span class="op" id="4804025">(</span><span class="string" id="4804026">&#34;json&#34;</span><span class="op" id="4804032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4804038">if</span>&nbsp;<span class="ident" id="4804041">tag</span>&nbsp;<span class="op" id="4804045">==</span>&nbsp;<span class="string" id="4804048">&#34;-&#34;</span>&nbsp;<span class="op" id="4804052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4804059">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4804072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4804078">name</span><span class="op" id="4804082">,</span>&nbsp;<span class="ident" id="4804084">opts</span>&nbsp;<span class="op" id="4804089">:=</span>&nbsp;<span class="ident" id="4804092">parseTag</span><span class="op" id="4804100">(</span><span class="ident" id="4804101">tag</span><span class="op" id="4804104">)</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4804110">if</span>&nbsp;<span class="op" id="4804113">!</span><span class="ident" id="4804114">isValidTag</span><span class="op" id="4804124">(</span><span class="ident" id="4804125">name</span><span class="op" id="4804129">)</span>&nbsp;<span class="op" id="4804131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4804138">name</span>&nbsp;<span class="op" id="4804143">=</span>&nbsp;<span class="string" id="4804145">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4804152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4804158">index</span>&nbsp;<span class="op" id="4804164">:=</span>&nbsp;<span class="builtinfunc" id="4804167">make</span><span class="op" id="4804171">(</span><span class="op" id="4804172">[</span><span class="op" id="4804173">]</span><span class="builtintype" id="4804174">int</span><span class="op" id="4804177">,</span>&nbsp;<span class="builtinfunc" id="4804179">len</span><span class="op" id="4804182">(</span><span class="ident" id="4804183">f</span><span class="op" id="4804184">.</span><span class="ident" id="4804185">index</span><span class="op" id="4804190">)</span><span class="op" id="4804191">+</span><span class="num" id="4804192">1</span><span class="op" id="4804193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4804199">copy</span><span class="op" id="4804203">(</span><span class="ident" id="4804204">index</span><span class="op" id="4804209">,</span>&nbsp;<span class="ident" id="4804211">f</span><span class="op" id="4804212">.</span><span class="ident" id="4804213">index</span><span class="op" id="4804218">)</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4804224">index</span><span class="op" id="4804229">[</span><span class="builtinfunc" id="4804230">len</span><span class="op" id="4804233">(</span><span class="ident" id="4804234">f</span><span class="op" id="4804235">.</span><span class="ident" id="4804236">index</span><span class="op" id="4804241">)</span><span class="op" id="4804242">]</span>&nbsp;<span class="op" id="4804244">=</span>&nbsp;<span class="ident" id="4804246">i</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4804253">ft</span>&nbsp;<span class="op" id="4804256">:=</span>&nbsp;<span class="ident" id="4804259">sf</span><span class="op" id="4804261">.</span><span class="ident" id="4804262">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4804271">if</span>&nbsp;<span class="ident" id="4804274">ft</span><span class="op" id="4804276">.</span><span class="ident" id="4804277">Name</span><span class="op" id="4804281">(</span><span class="op" id="4804282">)</span>&nbsp;<span class="op" id="4804284">==</span>&nbsp;<span class="string" id="4804287">&#34;&#34;</span>&nbsp;<span class="op" id="4804290">&amp;&amp;</span>&nbsp;<span class="ident" id="4804293">ft</span><span class="op" id="4804295">.</span><span class="ident" id="4804296">Kind</span><span class="op" id="4804300">(</span><span class="op" id="4804301">)</span>&nbsp;<span class="op" id="4804303">==</span>&nbsp;<span class="ident" id="4804306">reflect</span><span class="op" id="4804313">.</span><span class="ident" id="4804314">Ptr</span>&nbsp;<span class="op" id="4804318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4804325">//&nbsp;Follow&nbsp;pointer.</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4804349">ft</span>&nbsp;<span class="op" id="4804352">=</span>&nbsp;<span class="ident" id="4804354">ft</span><span class="op" id="4804356">.</span><span class="ident" id="4804357">Elem</span><span class="op" id="4804361">(</span><span class="op" id="4804362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4804368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4804375">//&nbsp;Record&nbsp;found&nbsp;field&nbsp;and&nbsp;index&nbsp;sequence.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4804421">if</span>&nbsp;<span class="ident" id="4804424">name</span>&nbsp;<span class="op" id="4804429">!=</span>&nbsp;<span class="string" id="4804432">&#34;&#34;</span>&nbsp;<span class="op" id="4804435">||</span>&nbsp;<span class="op" id="4804438">!</span><span class="ident" id="4804439">sf</span><span class="op" id="4804441">.</span><span class="ident" id="4804442">Anonymous</span>&nbsp;<span class="op" id="4804452">||</span>&nbsp;<span class="ident" id="4804455">ft</span><span class="op" id="4804457">.</span><span class="ident" id="4804458">Kind</span><span class="op" id="4804462">(</span><span class="op" id="4804463">)</span>&nbsp;<span class="op" id="4804465">!=</span>&nbsp;<span class="ident" id="4804468">reflect</span><span class="op" id="4804475">.</span><span class="ident" id="4804476">Struct</span>&nbsp;<span class="op" id="4804483">{</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4804490">tagged</span>&nbsp;<span class="op" id="4804497">:=</span>&nbsp;<span class="ident" id="4804500">name</span>&nbsp;<span class="op" id="4804505">!=</span>&nbsp;<span class="string" id="4804508">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4804516">if</span>&nbsp;<span class="ident" id="4804519">name</span>&nbsp;<span class="op" id="4804524">==</span>&nbsp;<span class="string" id="4804527">&#34;&#34;</span>&nbsp;<span class="op" id="4804530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4804538">name</span>&nbsp;<span class="op" id="4804543">=</span>&nbsp;<span class="ident" id="4804545">sf</span><span class="op" id="4804547">.</span><span class="ident" id="4804548">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4804558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4804565">fields</span>&nbsp;<span class="op" id="4804572">=</span>&nbsp;<span class="builtinfunc" id="4804574">append</span><span class="op" id="4804580">(</span><span class="ident" id="4804581">fields</span><span class="op" id="4804587">,</span>&nbsp;<span class="ident" id="4804589">fillField</span><span class="op" id="4804598">(</span><span class="ident" id="4804599">field</span><span class="op" id="4804604">{</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4804612">name</span><span class="op" id="4804616">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4804623">name</span><span class="op" id="4804627">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4804635">tag</span><span class="op" id="4804638">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4804646">tagged</span><span class="op" id="4804652">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4804660">index</span><span class="op" id="4804665">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4804671">index</span><span class="op" id="4804676">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4804684">typ</span><span class="op" id="4804687">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4804695">ft</span><span class="op" id="4804697">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4804705">omitEmpty</span><span class="op" id="4804714">:</span>&nbsp;<span class="ident" id="4804716">opts</span><span class="op" id="4804720">.</span><span class="ident" id="4804721">Contains</span><span class="op" id="4804729">(</span><span class="string" id="4804730">&#34;omitempty&#34;</span><span class="op" id="4804741">)</span><span class="op" id="4804742">,</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4804750">quoted</span><span class="op" id="4804756">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4804761">opts</span><span class="op" id="4804765">.</span><span class="ident" id="4804766">Contains</span><span class="op" id="4804774">(</span><span class="string" id="4804775">&#34;string&#34;</span><span class="op" id="4804783">)</span><span class="op" id="4804784">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4804791">}</span><span class="op" id="4804792">)</span><span class="op" id="4804793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4804800">if</span>&nbsp;<span class="ident" id="4804803">count</span><span class="op" id="4804808">[</span><span class="ident" id="4804809">f</span><span class="op" id="4804810">.</span><span class="ident" id="4804811">typ</span><span class="op" id="4804814">]</span>&nbsp;<span class="op" id="4804816">&gt;</span>&nbsp;<span class="num" id="4804818">1</span>&nbsp;<span class="op" id="4804820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4804828">//&nbsp;If&nbsp;there&nbsp;were&nbsp;multiple&nbsp;instances,&nbsp;add&nbsp;a&nbsp;second,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4804885">//&nbsp;so&nbsp;that&nbsp;the&nbsp;annihilation&nbsp;code&nbsp;will&nbsp;see&nbsp;a&nbsp;duplicate.</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4804946">//&nbsp;It&nbsp;only&nbsp;cares&nbsp;about&nbsp;the&nbsp;distinction&nbsp;between&nbsp;1&nbsp;or&nbsp;2,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4805007">//&nbsp;so&nbsp;don&#39;t&nbsp;bother&nbsp;generating&nbsp;any&nbsp;more&nbsp;copies.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4805060">fields</span>&nbsp;<span class="op" id="4805067">=</span>&nbsp;<span class="builtinfunc" id="4805069">append</span><span class="op" id="4805075">(</span><span class="ident" id="4805076">fields</span><span class="op" id="4805082">,</span>&nbsp;<span class="ident" id="4805084">fields</span><span class="op" id="4805090">[</span><span class="builtinfunc" id="4805091">len</span><span class="op" id="4805094">(</span><span class="ident" id="4805095">fields</span><span class="op" id="4805101">)</span><span class="op" id="4805102">-</span><span class="num" id="4805103">1</span><span class="op" id="4805104">]</span><span class="op" id="4805105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4805112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4805119">continue</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4805132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4805139">//&nbsp;Record&nbsp;new&nbsp;anonymous&nbsp;struct&nbsp;to&nbsp;explore&nbsp;in&nbsp;next&nbsp;round.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4805200">nextCount</span><span class="op" id="4805209">[</span><span class="ident" id="4805210">ft</span><span class="op" id="4805212">]</span><span class="op" id="4805213">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4805220">if</span>&nbsp;<span class="ident" id="4805223">nextCount</span><span class="op" id="4805232">[</span><span class="ident" id="4805233">ft</span><span class="op" id="4805235">]</span>&nbsp;<span class="op" id="4805237">==</span>&nbsp;<span class="num" id="4805240">1</span>&nbsp;<span class="op" id="4805242">{</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4805249">next</span>&nbsp;<span class="op" id="4805254">=</span>&nbsp;<span class="builtinfunc" id="4805256">append</span><span class="op" id="4805262">(</span><span class="ident" id="4805263">next</span><span class="op" id="4805267">,</span>&nbsp;<span class="ident" id="4805269">fillField</span><span class="op" id="4805278">(</span><span class="ident" id="4805279">field</span><span class="op" id="4805284">{</span><span class="ident" id="4805285">name</span><span class="op" id="4805289">:</span>&nbsp;<span class="ident" id="4805291">ft</span><span class="op" id="4805293">.</span><span class="ident" id="4805294">Name</span><span class="op" id="4805298">(</span><span class="op" id="4805299">)</span><span class="op" id="4805300">,</span>&nbsp;<span class="ident" id="4805302">index</span><span class="op" id="4805307">:</span>&nbsp;<span class="ident" id="4805309">index</span><span class="op" id="4805314">,</span>&nbsp;<span class="ident" id="4805316">typ</span><span class="op" id="4805319">:</span>&nbsp;<span class="ident" id="4805321">ft</span><span class="op" id="4805323">}</span><span class="op" id="4805324">)</span><span class="op" id="4805325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4805331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4805336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4805340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4805343">}</span><br>
<span class="lineno">1080</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4805347">sort</span><span class="op" id="4805351">.</span><span class="ident" id="4805352">Sort</span><span class="op" id="4805356">(</span><span class="ident" id="4805357">byName</span><span class="op" id="4805363">(</span><span class="ident" id="4805364">fields</span><span class="op" id="4805370">)</span><span class="op" id="4805371">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4805375">//&nbsp;Delete&nbsp;all&nbsp;fields&nbsp;that&nbsp;are&nbsp;hidden&nbsp;by&nbsp;the&nbsp;Go&nbsp;rules&nbsp;for&nbsp;embedded&nbsp;fields,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4805450">//&nbsp;except&nbsp;that&nbsp;fields&nbsp;with&nbsp;JSON&nbsp;tags&nbsp;are&nbsp;promoted.</span><br>
<span class="lineno">1085</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4805503">//&nbsp;The&nbsp;fields&nbsp;are&nbsp;sorted&nbsp;in&nbsp;primary&nbsp;order&nbsp;of&nbsp;name,&nbsp;secondary&nbsp;order</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4805571">//&nbsp;of&nbsp;field&nbsp;index&nbsp;length.&nbsp;Loop&nbsp;over&nbsp;names;&nbsp;for&nbsp;each&nbsp;name,&nbsp;delete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4805637">//&nbsp;hidden&nbsp;fields&nbsp;by&nbsp;choosing&nbsp;the&nbsp;one&nbsp;dominant&nbsp;field&nbsp;that&nbsp;survives.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4805705">out</span>&nbsp;<span class="op" id="4805709">:=</span>&nbsp;<span class="ident" id="4805712">fields</span><span class="op" id="4805718">[</span><span class="op" id="4805719">:</span><span class="num" id="4805720">0</span><span class="op" id="4805721">]</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4805724">for</span>&nbsp;<span class="ident" id="4805728">advance</span><span class="op" id="4805735">,</span>&nbsp;<span class="ident" id="4805737">i</span>&nbsp;<span class="op" id="4805739">:=</span>&nbsp;<span class="num" id="4805742">0</span><span class="op" id="4805743">,</span>&nbsp;<span class="num" id="4805745">0</span><span class="op" id="4805746">;</span>&nbsp;<span class="ident" id="4805748">i</span>&nbsp;<span class="op" id="4805750">&lt;</span>&nbsp;<span class="builtinfunc" id="4805752">len</span><span class="op" id="4805755">(</span><span class="ident" id="4805756">fields</span><span class="op" id="4805762">)</span><span class="op" id="4805763">;</span>&nbsp;<span class="ident" id="4805765">i</span>&nbsp;<span class="op" id="4805767">+=</span>&nbsp;<span class="ident" id="4805770">advance</span>&nbsp;<span class="op" id="4805778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4805782">//&nbsp;One&nbsp;iteration&nbsp;per&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4805811">//&nbsp;Find&nbsp;the&nbsp;sequence&nbsp;of&nbsp;fields&nbsp;with&nbsp;the&nbsp;name&nbsp;of&nbsp;this&nbsp;first&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4805879">fi</span>&nbsp;<span class="op" id="4805882">:=</span>&nbsp;<span class="ident" id="4805885">fields</span><span class="op" id="4805891">[</span><span class="ident" id="4805892">i</span><span class="op" id="4805893">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4805897">name</span>&nbsp;<span class="op" id="4805902">:=</span>&nbsp;<span class="ident" id="4805905">fi</span><span class="op" id="4805907">.</span><span class="ident" id="4805908">name</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4805915">for</span>&nbsp;<span class="ident" id="4805919">advance</span>&nbsp;<span class="op" id="4805927">=</span>&nbsp;<span class="num" id="4805929">1</span><span class="op" id="4805930">;</span>&nbsp;<span class="ident" id="4805932">i</span><span class="op" id="4805933">+</span><span class="ident" id="4805934">advance</span>&nbsp;<span class="op" id="4805942">&lt;</span>&nbsp;<span class="builtinfunc" id="4805944">len</span><span class="op" id="4805947">(</span><span class="ident" id="4805948">fields</span><span class="op" id="4805954">)</span><span class="op" id="4805955">;</span>&nbsp;<span class="ident" id="4805957">advance</span><span class="op" id="4805964">++</span>&nbsp;<span class="op" id="4805967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4805972">fj</span>&nbsp;<span class="op" id="4805975">:=</span>&nbsp;<span class="ident" id="4805978">fields</span><span class="op" id="4805984">[</span><span class="ident" id="4805985">i</span><span class="op" id="4805986">+</span><span class="ident" id="4805987">advance</span><span class="op" id="4805994">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4805999">if</span>&nbsp;<span class="ident" id="4806002">fj</span><span class="op" id="4806004">.</span><span class="ident" id="4806005">name</span>&nbsp;<span class="op" id="4806010">!=</span>&nbsp;<span class="ident" id="4806013">name</span>&nbsp;<span class="op" id="4806018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4806024">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4806033">}</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4806037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4806041">if</span>&nbsp;<span class="ident" id="4806044">advance</span>&nbsp;<span class="op" id="4806052">==</span>&nbsp;<span class="num" id="4806055">1</span>&nbsp;<span class="op" id="4806057">{</span>&nbsp;<span class="comment" id="4806059">//&nbsp;Only&nbsp;one&nbsp;field&nbsp;with&nbsp;this&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4806095">out</span>&nbsp;<span class="op" id="4806099">=</span>&nbsp;<span class="builtinfunc" id="4806101">append</span><span class="op" id="4806107">(</span><span class="ident" id="4806108">out</span><span class="op" id="4806111">,</span>&nbsp;<span class="ident" id="4806113">fi</span><span class="op" id="4806115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4806120">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4806131">}</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4806135">dominant</span><span class="op" id="4806143">,</span>&nbsp;<span class="ident" id="4806145">ok</span>&nbsp;<span class="op" id="4806148">:=</span>&nbsp;<span class="ident" id="4806151">dominantField</span><span class="op" id="4806164">(</span><span class="ident" id="4806165">fields</span><span class="op" id="4806171">[</span><span class="ident" id="4806172">i</span>&nbsp;<span class="op" id="4806174">:</span>&nbsp;<span class="ident" id="4806176">i</span><span class="op" id="4806177">+</span><span class="ident" id="4806178">advance</span><span class="op" id="4806185">]</span><span class="op" id="4806186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4806190">if</span>&nbsp;<span class="ident" id="4806193">ok</span>&nbsp;<span class="op" id="4806196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4806201">out</span>&nbsp;<span class="op" id="4806205">=</span>&nbsp;<span class="builtinfunc" id="4806207">append</span><span class="op" id="4806213">(</span><span class="ident" id="4806214">out</span><span class="op" id="4806217">,</span>&nbsp;<span class="ident" id="4806219">dominant</span><span class="op" id="4806227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4806231">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4806234">}</span><br>
<span class="lineno">1110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4806238">fields</span>&nbsp;<span class="op" id="4806245">=</span>&nbsp;<span class="ident" id="4806247">out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4806252">sort</span><span class="op" id="4806256">.</span><span class="ident" id="4806257">Sort</span><span class="op" id="4806261">(</span><span class="ident" id="4806262">byIndex</span><span class="op" id="4806269">(</span><span class="ident" id="4806270">fields</span><span class="op" id="4806276">)</span><span class="op" id="4806277">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4806281">return</span>&nbsp;<span class="ident" id="4806288">fields</span><br>
<span class="lineno">1115</span><span class="op" id="4806295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4806298">//&nbsp;dominantField&nbsp;looks&nbsp;through&nbsp;the&nbsp;fields,&nbsp;all&nbsp;of&nbsp;which&nbsp;are&nbsp;known&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4806367">//&nbsp;have&nbsp;the&nbsp;same&nbsp;name,&nbsp;to&nbsp;find&nbsp;the&nbsp;single&nbsp;field&nbsp;that&nbsp;dominates&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4806434">//&nbsp;others&nbsp;using&nbsp;Go&#39;s&nbsp;embedding&nbsp;rules,&nbsp;modified&nbsp;by&nbsp;the&nbsp;presence&nbsp;of</span><br>
<span class="lineno">1120</span><span class="comment" id="4806500">//&nbsp;JSON&nbsp;tags.&nbsp;If&nbsp;there&nbsp;are&nbsp;multiple&nbsp;top-level&nbsp;fields,&nbsp;the&nbsp;boolean</span><br>
<span class="lineno"></span><span class="comment" id="4806566">//&nbsp;will&nbsp;be&nbsp;false:&nbsp;This&nbsp;condition&nbsp;is&nbsp;an&nbsp;error&nbsp;in&nbsp;Go&nbsp;and&nbsp;we&nbsp;skip&nbsp;all</span><br>
<span class="lineno"></span><span class="comment" id="4806633">//&nbsp;the&nbsp;fields.</span><br>
<span class="lineno"></span><span class="keyword" id="4806648">func</span>&nbsp;<span class="ident" id="4806653">dominantField</span><span class="op" id="4806666">(</span><span class="ident" id="4806667">fields</span>&nbsp;<span class="op" id="4806674">[</span><span class="op" id="4806675">]</span><span class="ident" id="4806676">field</span><span class="op" id="4806681">)</span>&nbsp;<span class="op" id="4806683">(</span><span class="ident" id="4806684">field</span><span class="op" id="4806689">,</span>&nbsp;<span class="builtintype" id="4806691">bool</span><span class="op" id="4806695">)</span>&nbsp;<span class="op" id="4806697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4806700">//&nbsp;The&nbsp;fields&nbsp;are&nbsp;sorted&nbsp;in&nbsp;increasing&nbsp;index-length&nbsp;order.&nbsp;The&nbsp;winner</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4806771">//&nbsp;must&nbsp;therefore&nbsp;be&nbsp;one&nbsp;with&nbsp;the&nbsp;shortest&nbsp;index&nbsp;length.&nbsp;Drop&nbsp;all</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4806838">//&nbsp;longer&nbsp;entries,&nbsp;which&nbsp;is&nbsp;easy:&nbsp;just&nbsp;truncate&nbsp;the&nbsp;slice.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4806898">length</span>&nbsp;<span class="op" id="4806905">:=</span>&nbsp;<span class="builtinfunc" id="4806908">len</span><span class="op" id="4806911">(</span><span class="ident" id="4806912">fields</span><span class="op" id="4806918">[</span><span class="num" id="4806919">0</span><span class="op" id="4806920">]</span><span class="op" id="4806921">.</span><span class="ident" id="4806922">index</span><span class="op" id="4806927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4806930">tagged</span>&nbsp;<span class="op" id="4806937">:=</span>&nbsp;<span class="op" id="4806940">-</span><span class="num" id="4806941">1</span>&nbsp;<span class="comment" id="4806943">//&nbsp;Index&nbsp;of&nbsp;first&nbsp;tagged&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4806976">for</span>&nbsp;<span class="ident" id="4806980">i</span><span class="op" id="4806981">,</span>&nbsp;<span class="ident" id="4806983">f</span>&nbsp;<span class="op" id="4806985">:=</span>&nbsp;<span class="keyword" id="4806988">range</span>&nbsp;<span class="ident" id="4806994">fields</span>&nbsp;<span class="op" id="4807001">{</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4807005">if</span>&nbsp;<span class="builtinfunc" id="4807008">len</span><span class="op" id="4807011">(</span><span class="ident" id="4807012">f</span><span class="op" id="4807013">.</span><span class="ident" id="4807014">index</span><span class="op" id="4807019">)</span>&nbsp;<span class="op" id="4807021">&gt;</span>&nbsp;<span class="ident" id="4807023">length</span>&nbsp;<span class="op" id="4807030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4807035">fields</span>&nbsp;<span class="op" id="4807042">=</span>&nbsp;<span class="ident" id="4807044">fields</span><span class="op" id="4807050">[</span><span class="op" id="4807051">:</span><span class="ident" id="4807052">i</span><span class="op" id="4807053">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4807058">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4807066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4807070">if</span>&nbsp;<span class="ident" id="4807073">f</span><span class="op" id="4807074">.</span><span class="ident" id="4807075">tag</span>&nbsp;<span class="op" id="4807079">{</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4807084">if</span>&nbsp;<span class="ident" id="4807087">tagged</span>&nbsp;<span class="op" id="4807094">&gt;=</span>&nbsp;<span class="num" id="4807097">0</span>&nbsp;<span class="op" id="4807099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4807105">//&nbsp;Multiple&nbsp;tagged&nbsp;fields&nbsp;at&nbsp;the&nbsp;same&nbsp;level:&nbsp;conflict.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4807164">//&nbsp;Return&nbsp;no&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4807188">return</span>&nbsp;<span class="ident" id="4807195">field</span><span class="op" id="4807200">{</span><span class="op" id="4807201">}</span><span class="op" id="4807202">,</span>&nbsp;<span class="builtintype" id="4807204">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4807213">}</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4807218">tagged</span>&nbsp;<span class="op" id="4807225">=</span>&nbsp;<span class="ident" id="4807227">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4807231">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4807234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4807237">if</span>&nbsp;<span class="ident" id="4807240">tagged</span>&nbsp;<span class="op" id="4807247">&gt;=</span>&nbsp;<span class="num" id="4807250">0</span>&nbsp;<span class="op" id="4807252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4807256">return</span>&nbsp;<span class="ident" id="4807263">fields</span><span class="op" id="4807269">[</span><span class="ident" id="4807270">tagged</span><span class="op" id="4807276">]</span><span class="op" id="4807277">,</span>&nbsp;<span class="builtintype" id="4807279">true</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4807285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4807288">//&nbsp;All&nbsp;remaining&nbsp;fields&nbsp;have&nbsp;the&nbsp;same&nbsp;length.&nbsp;If&nbsp;there&#39;s&nbsp;more&nbsp;than&nbsp;one,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4807361">//&nbsp;we&nbsp;have&nbsp;a&nbsp;conflict&nbsp;(two&nbsp;fields&nbsp;named&nbsp;&#34;X&#34;&nbsp;at&nbsp;the&nbsp;same&nbsp;level)&nbsp;and&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4807432">//&nbsp;return&nbsp;no&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4807453">if</span>&nbsp;<span class="builtinfunc" id="4807456">len</span><span class="op" id="4807459">(</span><span class="ident" id="4807460">fields</span><span class="op" id="4807466">)</span>&nbsp;<span class="op" id="4807468">&gt;</span>&nbsp;<span class="num" id="4807470">1</span>&nbsp;<span class="op" id="4807472">{</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4807476">return</span>&nbsp;<span class="ident" id="4807483">field</span><span class="op" id="4807488">{</span><span class="op" id="4807489">}</span><span class="op" id="4807490">,</span>&nbsp;<span class="builtintype" id="4807492">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4807499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4807502">return</span>&nbsp;<span class="ident" id="4807509">fields</span><span class="op" id="4807515">[</span><span class="num" id="4807516">0</span><span class="op" id="4807517">]</span><span class="op" id="4807518">,</span>&nbsp;<span class="builtintype" id="4807520">true</span><br>
<span class="lineno"></span><span class="op" id="4807525">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1155</span><span class="keyword" id="4807528">var</span>&nbsp;<span class="ident" id="4807532">fieldCache</span>&nbsp;<span class="keyword" id="4807543">struct</span>&nbsp;<span class="op" id="4807550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4807553">sync</span><span class="op" id="4807557">.</span><span class="ident" id="4807558">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4807567">m</span>&nbsp;<span class="keyword" id="4807569">map</span><span class="op" id="4807572">[</span><span class="ident" id="4807573">reflect</span><span class="op" id="4807580">.</span><span class="ident" id="4807581">Type</span><span class="op" id="4807585">]</span><span class="op" id="4807586">[</span><span class="op" id="4807587">]</span><span class="ident" id="4807588">field</span><br>
<span class="lineno"></span><span class="op" id="4807594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1160</span><span class="comment" id="4807597">//&nbsp;cachedTypeFields&nbsp;is&nbsp;like&nbsp;typeFields&nbsp;but&nbsp;uses&nbsp;a&nbsp;cache&nbsp;to&nbsp;avoid&nbsp;repeated&nbsp;work.</span><br>
<span class="lineno"></span><span class="keyword" id="4807677">func</span>&nbsp;<span class="ident" id="4807682">cachedTypeFields</span><span class="op" id="4807698">(</span><span class="ident" id="4807699">t</span>&nbsp;<span class="ident" id="4807701">reflect</span><span class="op" id="4807708">.</span><span class="ident" id="4807709">Type</span><span class="op" id="4807713">)</span>&nbsp;<span class="op" id="4807715">[</span><span class="op" id="4807716">]</span><span class="ident" id="4807717">field</span>&nbsp;<span class="op" id="4807723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4807726">fieldCache</span><span class="op" id="4807736">.</span><span class="ident" id="4807737">RLock</span><span class="op" id="4807742">(</span><span class="op" id="4807743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4807746">f</span>&nbsp;<span class="op" id="4807748">:=</span>&nbsp;<span class="ident" id="4807751">fieldCache</span><span class="op" id="4807761">.</span><span class="ident" id="4807762">m</span><span class="op" id="4807763">[</span><span class="ident" id="4807764">t</span><span class="op" id="4807765">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4807768">fieldCache</span><span class="op" id="4807778">.</span><span class="ident" id="4807779">RUnlock</span><span class="op" id="4807786">(</span><span class="op" id="4807787">)</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4807790">if</span>&nbsp;<span class="ident" id="4807793">f</span>&nbsp;<span class="op" id="4807795">!=</span>&nbsp;<span class="ident" id="4807798">nil</span>&nbsp;<span class="op" id="4807802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4807806">return</span>&nbsp;<span class="ident" id="4807813">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4807816">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4807820">//&nbsp;Compute&nbsp;fields&nbsp;without&nbsp;lock.</span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4807853">//&nbsp;Might&nbsp;duplicate&nbsp;effort&nbsp;but&nbsp;won&#39;t&nbsp;hold&nbsp;other&nbsp;computations&nbsp;back.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4807920">f</span>&nbsp;<span class="op" id="4807922">=</span>&nbsp;<span class="ident" id="4807924">typeFields</span><span class="op" id="4807934">(</span><span class="ident" id="4807935">t</span><span class="op" id="4807936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4807939">if</span>&nbsp;<span class="ident" id="4807942">f</span>&nbsp;<span class="op" id="4807944">==</span>&nbsp;<span class="ident" id="4807947">nil</span>&nbsp;<span class="op" id="4807951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4807955">f</span>&nbsp;<span class="op" id="4807957">=</span>&nbsp;<span class="op" id="4807959">[</span><span class="op" id="4807960">]</span><span class="ident" id="4807961">field</span><span class="op" id="4807966">{</span><span class="op" id="4807967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4807970">}</span><br>
<span class="lineno">1175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4807974">fieldCache</span><span class="op" id="4807984">.</span><span class="ident" id="4807985">Lock</span><span class="op" id="4807989">(</span><span class="op" id="4807990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4807993">if</span>&nbsp;<span class="ident" id="4807996">fieldCache</span><span class="op" id="4808006">.</span><span class="ident" id="4808007">m</span>&nbsp;<span class="op" id="4808009">==</span>&nbsp;<span class="ident" id="4808012">nil</span>&nbsp;<span class="op" id="4808016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4808020">fieldCache</span><span class="op" id="4808030">.</span><span class="ident" id="4808031">m</span>&nbsp;<span class="op" id="4808033">=</span>&nbsp;<span class="keyword" id="4808035">map</span><span class="op" id="4808038">[</span><span class="ident" id="4808039">reflect</span><span class="op" id="4808046">.</span><span class="ident" id="4808047">Type</span><span class="op" id="4808051">]</span><span class="op" id="4808052">[</span><span class="op" id="4808053">]</span><span class="ident" id="4808054">field</span><span class="op" id="4808059">{</span><span class="op" id="4808060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4808063">}</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4808066">fieldCache</span><span class="op" id="4808076">.</span><span class="ident" id="4808077">m</span><span class="op" id="4808078">[</span><span class="ident" id="4808079">t</span><span class="op" id="4808080">]</span>&nbsp;<span class="op" id="4808082">=</span>&nbsp;<span class="ident" id="4808084">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4808087">fieldCache</span><span class="op" id="4808097">.</span><span class="ident" id="4808098">Unlock</span><span class="op" id="4808104">(</span><span class="op" id="4808105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4808108">return</span>&nbsp;<span class="ident" id="4808115">f</span><br>
<span class="lineno"></span><span class="op" id="4808117">}</span>
</div>
</body>
</html>
