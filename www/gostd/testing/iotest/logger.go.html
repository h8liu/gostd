<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>testing/iotest</h2>
<ul>
<li><a href="/gostd/testing/iotest/logger.go.html">logger.go</a></li>
<li><a href="/gostd/testing/iotest/reader.go.html">reader.go</a></li>
<li><a href="/gostd/testing/iotest/writer.go.html">writer.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6343285">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6343340">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6343394">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6343445">package</span>&nbsp;<span class="ident" id="6343453">iotest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6343461">import</span>&nbsp;<span class="op" id="6343468">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6343471">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6343477">&#34;log&#34;</span><br>
<span class="lineno">10</span><span class="op" id="6343483">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6343486">type</span>&nbsp;<span class="ident" id="6343491">writeLogger</span>&nbsp;<span class="keyword" id="6343503">struct</span>&nbsp;<span class="op" id="6343510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6343513">prefix</span>&nbsp;<span class="builtintype" id="6343520">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6343528">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6343535">io</span><span class="op" id="6343537">.</span><span class="ident" id="6343538">Writer</span><br>
<span class="lineno">15</span><span class="op" id="6343545">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6343548">func</span>&nbsp;<span class="op" id="6343553">(</span><span class="ident" id="6343554">l</span>&nbsp;<span class="op" id="6343556">*</span><span class="ident" id="6343557">writeLogger</span><span class="op" id="6343568">)</span>&nbsp;<span class="ident" id="6343570">Write</span><span class="op" id="6343575">(</span><span class="ident" id="6343576">p</span>&nbsp;<span class="op" id="6343578">[</span><span class="op" id="6343579">]</span><span class="builtintype" id="6343580">byte</span><span class="op" id="6343584">)</span>&nbsp;<span class="op" id="6343586">(</span><span class="ident" id="6343587">n</span>&nbsp;<span class="builtintype" id="6343589">int</span><span class="op" id="6343592">,</span>&nbsp;<span class="ident" id="6343594">err</span>&nbsp;<span class="builtintype" id="6343598">error</span><span class="op" id="6343603">)</span>&nbsp;<span class="op" id="6343605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6343608">n</span><span class="op" id="6343609">,</span>&nbsp;<span class="ident" id="6343611">err</span>&nbsp;<span class="op" id="6343615">=</span>&nbsp;<span class="ident" id="6343617">l</span><span class="op" id="6343618">.</span><span class="ident" id="6343619">w</span><span class="op" id="6343620">.</span><span class="ident" id="6343621">Write</span><span class="op" id="6343626">(</span><span class="ident" id="6343627">p</span><span class="op" id="6343628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6343631">if</span>&nbsp;<span class="ident" id="6343634">err</span>&nbsp;<span class="op" id="6343638">!=</span>&nbsp;<span class="ident" id="6343641">nil</span>&nbsp;<span class="op" id="6343645">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6343649">log</span><span class="op" id="6343652">.</span><span class="ident" id="6343653">Printf</span><span class="op" id="6343659">(</span><span class="string" id="6343660">&#34;%s&nbsp;%x:&nbsp;%v&#34;</span><span class="op" id="6343671">,</span>&nbsp;<span class="ident" id="6343673">l</span><span class="op" id="6343674">.</span><span class="ident" id="6343675">prefix</span><span class="op" id="6343681">,</span>&nbsp;<span class="ident" id="6343683">p</span><span class="op" id="6343684">[</span><span class="num" id="6343685">0</span><span class="op" id="6343686">:</span><span class="ident" id="6343687">n</span><span class="op" id="6343688">]</span><span class="op" id="6343689">,</span>&nbsp;<span class="ident" id="6343691">err</span><span class="op" id="6343694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6343697">}</span>&nbsp;<span class="keyword" id="6343699">else</span>&nbsp;<span class="op" id="6343704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6343708">log</span><span class="op" id="6343711">.</span><span class="ident" id="6343712">Printf</span><span class="op" id="6343718">(</span><span class="string" id="6343719">&#34;%s&nbsp;%x&#34;</span><span class="op" id="6343726">,</span>&nbsp;<span class="ident" id="6343728">l</span><span class="op" id="6343729">.</span><span class="ident" id="6343730">prefix</span><span class="op" id="6343736">,</span>&nbsp;<span class="ident" id="6343738">p</span><span class="op" id="6343739">[</span><span class="num" id="6343740">0</span><span class="op" id="6343741">:</span><span class="ident" id="6343742">n</span><span class="op" id="6343743">]</span><span class="op" id="6343744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6343747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6343750">return</span><br>
<span class="lineno">25</span><span class="op" id="6343757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6343760">//&nbsp;NewWriteLogger&nbsp;returns&nbsp;a&nbsp;writer&nbsp;that&nbsp;behaves&nbsp;like&nbsp;w&nbsp;except</span><br>
<span class="lineno"></span><span class="comment" id="6343822">//&nbsp;that&nbsp;it&nbsp;logs&nbsp;(using&nbsp;log.Printf)&nbsp;each&nbsp;write&nbsp;to&nbsp;standard&nbsp;error,</span><br>
<span class="lineno"></span><span class="comment" id="6343887">//&nbsp;printing&nbsp;the&nbsp;prefix&nbsp;and&nbsp;the&nbsp;hexadecimal&nbsp;data&nbsp;written.</span><br>
<span class="lineno">30</span><span class="keyword" id="6343944">func</span>&nbsp;<span class="ident" id="6343949">NewWriteLogger</span><span class="op" id="6343963">(</span><span class="ident" id="6343964">prefix</span>&nbsp;<span class="builtintype" id="6343971">string</span><span class="op" id="6343977">,</span>&nbsp;<span class="ident" id="6343979">w</span>&nbsp;<span class="ident" id="6343981">io</span><span class="op" id="6343983">.</span><span class="ident" id="6343984">Writer</span><span class="op" id="6343990">)</span>&nbsp;<span class="ident" id="6343992">io</span><span class="op" id="6343994">.</span><span class="ident" id="6343995">Writer</span>&nbsp;<span class="op" id="6344002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6344005">return</span>&nbsp;<span class="op" id="6344012">&amp;</span><span class="ident" id="6344013">writeLogger</span><span class="op" id="6344024">{</span><span class="ident" id="6344025">prefix</span><span class="op" id="6344031">,</span>&nbsp;<span class="ident" id="6344033">w</span><span class="op" id="6344034">}</span><br>
<span class="lineno"></span><span class="op" id="6344036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6344039">type</span>&nbsp;<span class="ident" id="6344044">readLogger</span>&nbsp;<span class="keyword" id="6344055">struct</span>&nbsp;<span class="op" id="6344062">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6344065">prefix</span>&nbsp;<span class="builtintype" id="6344072">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6344080">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6344087">io</span><span class="op" id="6344089">.</span><span class="ident" id="6344090">Reader</span><br>
<span class="lineno"></span><span class="op" id="6344097">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6344100">func</span>&nbsp;<span class="op" id="6344105">(</span><span class="ident" id="6344106">l</span>&nbsp;<span class="op" id="6344108">*</span><span class="ident" id="6344109">readLogger</span><span class="op" id="6344119">)</span>&nbsp;<span class="ident" id="6344121">Read</span><span class="op" id="6344125">(</span><span class="ident" id="6344126">p</span>&nbsp;<span class="op" id="6344128">[</span><span class="op" id="6344129">]</span><span class="builtintype" id="6344130">byte</span><span class="op" id="6344134">)</span>&nbsp;<span class="op" id="6344136">(</span><span class="ident" id="6344137">n</span>&nbsp;<span class="builtintype" id="6344139">int</span><span class="op" id="6344142">,</span>&nbsp;<span class="ident" id="6344144">err</span>&nbsp;<span class="builtintype" id="6344148">error</span><span class="op" id="6344153">)</span>&nbsp;<span class="op" id="6344155">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6344158">n</span><span class="op" id="6344159">,</span>&nbsp;<span class="ident" id="6344161">err</span>&nbsp;<span class="op" id="6344165">=</span>&nbsp;<span class="ident" id="6344167">l</span><span class="op" id="6344168">.</span><span class="ident" id="6344169">r</span><span class="op" id="6344170">.</span><span class="ident" id="6344171">Read</span><span class="op" id="6344175">(</span><span class="ident" id="6344176">p</span><span class="op" id="6344177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6344180">if</span>&nbsp;<span class="ident" id="6344183">err</span>&nbsp;<span class="op" id="6344187">!=</span>&nbsp;<span class="ident" id="6344190">nil</span>&nbsp;<span class="op" id="6344194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6344198">log</span><span class="op" id="6344201">.</span><span class="ident" id="6344202">Printf</span><span class="op" id="6344208">(</span><span class="string" id="6344209">&#34;%s&nbsp;%x:&nbsp;%v&#34;</span><span class="op" id="6344220">,</span>&nbsp;<span class="ident" id="6344222">l</span><span class="op" id="6344223">.</span><span class="ident" id="6344224">prefix</span><span class="op" id="6344230">,</span>&nbsp;<span class="ident" id="6344232">p</span><span class="op" id="6344233">[</span><span class="num" id="6344234">0</span><span class="op" id="6344235">:</span><span class="ident" id="6344236">n</span><span class="op" id="6344237">]</span><span class="op" id="6344238">,</span>&nbsp;<span class="ident" id="6344240">err</span><span class="op" id="6344243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6344246">}</span>&nbsp;<span class="keyword" id="6344248">else</span>&nbsp;<span class="op" id="6344253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6344257">log</span><span class="op" id="6344260">.</span><span class="ident" id="6344261">Printf</span><span class="op" id="6344267">(</span><span class="string" id="6344268">&#34;%s&nbsp;%x&#34;</span><span class="op" id="6344275">,</span>&nbsp;<span class="ident" id="6344277">l</span><span class="op" id="6344278">.</span><span class="ident" id="6344279">prefix</span><span class="op" id="6344285">,</span>&nbsp;<span class="ident" id="6344287">p</span><span class="op" id="6344288">[</span><span class="num" id="6344289">0</span><span class="op" id="6344290">:</span><span class="ident" id="6344291">n</span><span class="op" id="6344292">]</span><span class="op" id="6344293">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6344296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6344299">return</span><br>
<span class="lineno"></span><span class="op" id="6344306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6344309">//&nbsp;NewReadLogger&nbsp;returns&nbsp;a&nbsp;reader&nbsp;that&nbsp;behaves&nbsp;like&nbsp;r&nbsp;except</span><br>
<span class="lineno">50</span><span class="comment" id="6344370">//&nbsp;that&nbsp;it&nbsp;logs&nbsp;(using&nbsp;log.Print)&nbsp;each&nbsp;read&nbsp;to&nbsp;standard&nbsp;error,</span><br>
<span class="lineno"></span><span class="comment" id="6344433">//&nbsp;printing&nbsp;the&nbsp;prefix&nbsp;and&nbsp;the&nbsp;hexadecimal&nbsp;data&nbsp;written.</span><br>
<span class="lineno"></span><span class="keyword" id="6344490">func</span>&nbsp;<span class="ident" id="6344495">NewReadLogger</span><span class="op" id="6344508">(</span><span class="ident" id="6344509">prefix</span>&nbsp;<span class="builtintype" id="6344516">string</span><span class="op" id="6344522">,</span>&nbsp;<span class="ident" id="6344524">r</span>&nbsp;<span class="ident" id="6344526">io</span><span class="op" id="6344528">.</span><span class="ident" id="6344529">Reader</span><span class="op" id="6344535">)</span>&nbsp;<span class="ident" id="6344537">io</span><span class="op" id="6344539">.</span><span class="ident" id="6344540">Reader</span>&nbsp;<span class="op" id="6344547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6344550">return</span>&nbsp;<span class="op" id="6344557">&amp;</span><span class="ident" id="6344558">readLogger</span><span class="op" id="6344568">{</span><span class="ident" id="6344569">prefix</span><span class="op" id="6344575">,</span>&nbsp;<span class="ident" id="6344577">r</span><span class="op" id="6344578">}</span><br>
<span class="lineno"></span><span class="op" id="6344580">}</span>
</div>
</body>
</html>
