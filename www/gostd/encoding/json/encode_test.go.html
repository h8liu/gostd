<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/json</h2>
<ul>
<li><a href="/gostd/encoding/json/bench_test.go.html">bench_test.go</a></li>
<li><a href="/gostd/encoding/json/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/json/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/encoding/json/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/json/encode_test.go.html" class="current">encode_test.go</a></li>
<li><a href="/gostd/encoding/json/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/json/fold.go.html">fold.go</a></li>
<li><a href="/gostd/encoding/json/fold_test.go.html">fold_test.go</a></li>
<li><a href="/gostd/encoding/json/indent.go.html">indent.go</a></li>
<li><a href="/gostd/encoding/json/scanner.go.html">scanner.go</a></li>
<li><a href="/gostd/encoding/json/scanner_test.go.html">scanner_test.go</a></li>
<li><a href="/gostd/encoding/json/stream.go.html">stream.go</a></li>
<li><a href="/gostd/encoding/json/stream_test.go.html">stream_test.go</a></li>
<li><a href="/gostd/encoding/json/tagkey_test.go.html">tagkey_test.go</a></li>
<li><a href="/gostd/encoding/json/tags.go.html">tags.go</a></li>
<li><a href="/gostd/encoding/json/tags_test.go.html">tags_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6874931">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6874986">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6875040">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6875091">package</span>&nbsp;<span class="ident" id="6875099">json</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6875105">import</span>&nbsp;<span class="op" id="6875112">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6875115">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6875124">&#34;math&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6875132">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6875143">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6875154">&#34;unicode&#34;</span><br>
<span class="lineno"></span><span class="op" id="6875164">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="6875167">type</span>&nbsp;<span class="ident" id="6875172">Optionals</span>&nbsp;<span class="keyword" id="6875182">struct</span>&nbsp;<span class="op" id="6875189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6875192">Sr</span>&nbsp;<span class="builtintype" id="6875195">string</span>&nbsp;<span class="string" id="6875202">`json:&#34;sr&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6875215">So</span>&nbsp;<span class="builtintype" id="6875218">string</span>&nbsp;<span class="string" id="6875225">`json:&#34;so,omitempty&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6875248">Sw</span>&nbsp;<span class="builtintype" id="6875251">string</span>&nbsp;<span class="string" id="6875258">`json:&#34;-&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6875271">Ir</span>&nbsp;<span class="builtintype" id="6875274">int</span>&nbsp;<span class="string" id="6875278">`json:&#34;omitempty&#34;`</span>&nbsp;<span class="comment" id="6875297">//&nbsp;actually&nbsp;named&nbsp;omitempty,&nbsp;not&nbsp;an&nbsp;option</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6875341">Io</span>&nbsp;<span class="builtintype" id="6875344">int</span>&nbsp;<span class="string" id="6875348">`json:&#34;io,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6875372">Slr</span>&nbsp;<span class="op" id="6875376">[</span><span class="op" id="6875377">]</span><span class="builtintype" id="6875378">string</span>&nbsp;<span class="string" id="6875385">`json:&#34;slr,random&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6875406">Slo</span>&nbsp;<span class="op" id="6875410">[</span><span class="op" id="6875411">]</span><span class="builtintype" id="6875412">string</span>&nbsp;<span class="string" id="6875419">`json:&#34;slo,omitempty&#34;`</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6875444">Mr</span>&nbsp;<span class="keyword" id="6875447">map</span><span class="op" id="6875450">[</span><span class="builtintype" id="6875451">string</span><span class="op" id="6875457">]</span><span class="keyword" id="6875458">interface</span><span class="op" id="6875467">{</span><span class="op" id="6875468">}</span>&nbsp;<span class="string" id="6875470">`json:&#34;mr&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6875483">Mo</span>&nbsp;<span class="keyword" id="6875486">map</span><span class="op" id="6875489">[</span><span class="builtintype" id="6875490">string</span><span class="op" id="6875496">]</span><span class="keyword" id="6875497">interface</span><span class="op" id="6875506">{</span><span class="op" id="6875507">}</span>&nbsp;<span class="string" id="6875509">`json:&#34;,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6875531">Fr</span>&nbsp;<span class="builtintype" id="6875534">float64</span>&nbsp;<span class="string" id="6875542">`json:&#34;fr&#34;`</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6875555">Fo</span>&nbsp;<span class="builtintype" id="6875558">float64</span>&nbsp;<span class="string" id="6875566">`json:&#34;fo,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6875590">Br</span>&nbsp;<span class="builtintype" id="6875593">bool</span>&nbsp;<span class="string" id="6875598">`json:&#34;br&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6875611">Bo</span>&nbsp;<span class="builtintype" id="6875614">bool</span>&nbsp;<span class="string" id="6875619">`json:&#34;bo,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6875643">Ur</span>&nbsp;<span class="builtintype" id="6875646">uint</span>&nbsp;<span class="string" id="6875651">`json:&#34;ur&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6875664">Uo</span>&nbsp;<span class="builtintype" id="6875667">uint</span>&nbsp;<span class="string" id="6875672">`json:&#34;uo,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6875696">Str</span>&nbsp;<span class="keyword" id="6875700">struct</span><span class="op" id="6875706">{</span><span class="op" id="6875707">}</span>&nbsp;<span class="string" id="6875709">`json:&#34;str&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6875723">Sto</span>&nbsp;<span class="keyword" id="6875727">struct</span><span class="op" id="6875733">{</span><span class="op" id="6875734">}</span>&nbsp;<span class="string" id="6875736">`json:&#34;sto,omitempty&#34;`</span><br>
<span class="lineno">40</span><span class="op" id="6875759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6875762">var</span>&nbsp;<span class="ident" id="6875766">optionalsExpected</span>&nbsp;<span class="op" id="6875784">=</span>&nbsp;<span class="string" id="6875786">`{<br>
<span class="lineno"></span>&nbsp;&#34;sr&#34;:&nbsp;&#34;&#34;,<br>
<span class="lineno"></span>&nbsp;&#34;omitempty&#34;:&nbsp;0,<br>
<span class="lineno">45</span>&nbsp;&#34;slr&#34;:&nbsp;null,<br>
<span class="lineno"></span>&nbsp;&#34;mr&#34;:&nbsp;{},<br>
<span class="lineno"></span>&nbsp;&#34;fr&#34;:&nbsp;0,<br>
<span class="lineno"></span>&nbsp;&#34;br&#34;:&nbsp;false,<br>
<span class="lineno"></span>&nbsp;&#34;ur&#34;:&nbsp;0,<br>
<span class="lineno">50</span>&nbsp;&#34;str&#34;:&nbsp;{},<br>
<span class="lineno"></span>&nbsp;&#34;sto&#34;:&nbsp;{}<br>
<span class="lineno"></span>}`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6875903">func</span>&nbsp;<span class="ident" id="6875908">TestOmitEmpty</span><span class="op" id="6875921">(</span><span class="ident" id="6875922">t</span>&nbsp;<span class="op" id="6875924">*</span><span class="ident" id="6875925">testing</span><span class="op" id="6875932">.</span><span class="ident" id="6875933">T</span><span class="op" id="6875934">)</span>&nbsp;<span class="op" id="6875936">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6875939">var</span>&nbsp;<span class="ident" id="6875943">o</span>&nbsp;<span class="ident" id="6875945">Optionals</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6875956">o</span><span class="op" id="6875957">.</span><span class="ident" id="6875958">Sw</span>&nbsp;<span class="op" id="6875961">=</span>&nbsp;<span class="string" id="6875963">&#34;something&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6875976">o</span><span class="op" id="6875977">.</span><span class="ident" id="6875978">Mr</span>&nbsp;<span class="op" id="6875981">=</span>&nbsp;<span class="keyword" id="6875983">map</span><span class="op" id="6875986">[</span><span class="builtintype" id="6875987">string</span><span class="op" id="6875993">]</span><span class="keyword" id="6875994">interface</span><span class="op" id="6876003">{</span><span class="op" id="6876004">}</span><span class="op" id="6876005">{</span><span class="op" id="6876006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6876009">o</span><span class="op" id="6876010">.</span><span class="ident" id="6876011">Mo</span>&nbsp;<span class="op" id="6876014">=</span>&nbsp;<span class="keyword" id="6876016">map</span><span class="op" id="6876019">[</span><span class="builtintype" id="6876020">string</span><span class="op" id="6876026">]</span><span class="keyword" id="6876027">interface</span><span class="op" id="6876036">{</span><span class="op" id="6876037">}</span><span class="op" id="6876038">{</span><span class="op" id="6876039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6876043">got</span><span class="op" id="6876046">,</span>&nbsp;<span class="ident" id="6876048">err</span>&nbsp;<span class="op" id="6876052">:=</span>&nbsp;<span class="ident" id="6876055">MarshalIndent</span><span class="op" id="6876068">(</span><span class="op" id="6876069">&amp;</span><span class="ident" id="6876070">o</span><span class="op" id="6876071">,</span>&nbsp;<span class="string" id="6876073">&#34;&#34;</span><span class="op" id="6876075">,</span>&nbsp;<span class="string" id="6876077">&#34;&nbsp;&#34;</span><span class="op" id="6876080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6876083">if</span>&nbsp;<span class="ident" id="6876086">err</span>&nbsp;<span class="op" id="6876090">!=</span>&nbsp;<span class="builtintype" id="6876093">nil</span>&nbsp;<span class="op" id="6876097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6876101">t</span><span class="op" id="6876102">.</span><span class="ident" id="6876103">Fatal</span><span class="op" id="6876108">(</span><span class="ident" id="6876109">err</span><span class="op" id="6876112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6876115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6876118">if</span>&nbsp;<span class="ident" id="6876121">got</span>&nbsp;<span class="op" id="6876125">:=</span>&nbsp;<span class="builtintype" id="6876128">string</span><span class="op" id="6876134">(</span><span class="ident" id="6876135">got</span><span class="op" id="6876138">)</span><span class="op" id="6876139">;</span>&nbsp;<span class="ident" id="6876141">got</span>&nbsp;<span class="op" id="6876145">!=</span>&nbsp;<span class="ident" id="6876148">optionalsExpected</span>&nbsp;<span class="op" id="6876166">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6876170">t</span><span class="op" id="6876171">.</span><span class="ident" id="6876172">Errorf</span><span class="op" id="6876178">(</span><span class="string" id="6876179">&#34;&nbsp;got:&nbsp;%s\nwant:&nbsp;%s\n&#34;</span><span class="op" id="6876201">,</span>&nbsp;<span class="ident" id="6876203">got</span><span class="op" id="6876206">,</span>&nbsp;<span class="ident" id="6876208">optionalsExpected</span><span class="op" id="6876225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6876228">}</span><br>
<span class="lineno"></span><span class="op" id="6876230">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6876233">type</span>&nbsp;<span class="ident" id="6876238">StringTag</span>&nbsp;<span class="keyword" id="6876248">struct</span>&nbsp;<span class="op" id="6876255">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6876258">BoolStr</span>&nbsp;<span class="builtintype" id="6876266">bool</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6876273">`json:&#34;,string&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6876291">IntStr</span>&nbsp;&nbsp;<span class="ident" id="6876299">int64</span>&nbsp;&nbsp;<span class="string" id="6876306">`json:&#34;,string&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6876324">StrStr</span>&nbsp;&nbsp;<span class="builtintype" id="6876332">string</span>&nbsp;<span class="string" id="6876339">`json:&#34;,string&#34;`</span><br>
<span class="lineno"></span><span class="op" id="6876356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="6876359">var</span>&nbsp;<span class="ident" id="6876363">stringTagExpected</span>&nbsp;<span class="op" id="6876381">=</span>&nbsp;<span class="string" id="6876383">`{<br>
<span class="lineno"></span>&nbsp;&#34;BoolStr&#34;:&nbsp;&#34;true&#34;,<br>
<span class="lineno"></span>&nbsp;&#34;IntStr&#34;:&nbsp;&#34;42&#34;,<br>
<span class="lineno"></span>&nbsp;&#34;StrStr&#34;:&nbsp;&#34;\&#34;xzbit\&#34;&#34;<br>
<span class="lineno"></span>}`</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="keyword" id="6876450">func</span>&nbsp;<span class="ident" id="6876455">TestStringTag</span><span class="op" id="6876468">(</span><span class="ident" id="6876469">t</span>&nbsp;<span class="op" id="6876471">*</span><span class="ident" id="6876472">testing</span><span class="op" id="6876479">.</span><span class="ident" id="6876480">T</span><span class="op" id="6876481">)</span>&nbsp;<span class="op" id="6876483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6876486">var</span>&nbsp;<span class="ident" id="6876490">s</span>&nbsp;<span class="ident" id="6876492">StringTag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6876503">s</span><span class="op" id="6876504">.</span><span class="ident" id="6876505">BoolStr</span>&nbsp;<span class="op" id="6876513">=</span>&nbsp;<span class="builtintype" id="6876515">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6876521">s</span><span class="op" id="6876522">.</span><span class="ident" id="6876523">IntStr</span>&nbsp;<span class="op" id="6876530">=</span>&nbsp;<span class="num" id="6876532">42</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6876536">s</span><span class="op" id="6876537">.</span><span class="ident" id="6876538">StrStr</span>&nbsp;<span class="op" id="6876545">=</span>&nbsp;<span class="string" id="6876547">&#34;xzbit&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6876556">got</span><span class="op" id="6876559">,</span>&nbsp;<span class="ident" id="6876561">err</span>&nbsp;<span class="op" id="6876565">:=</span>&nbsp;<span class="ident" id="6876568">MarshalIndent</span><span class="op" id="6876581">(</span><span class="op" id="6876582">&amp;</span><span class="ident" id="6876583">s</span><span class="op" id="6876584">,</span>&nbsp;<span class="string" id="6876586">&#34;&#34;</span><span class="op" id="6876588">,</span>&nbsp;<span class="string" id="6876590">&#34;&nbsp;&#34;</span><span class="op" id="6876593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6876596">if</span>&nbsp;<span class="ident" id="6876599">err</span>&nbsp;<span class="op" id="6876603">!=</span>&nbsp;<span class="builtintype" id="6876606">nil</span>&nbsp;<span class="op" id="6876610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6876614">t</span><span class="op" id="6876615">.</span><span class="ident" id="6876616">Fatal</span><span class="op" id="6876621">(</span><span class="ident" id="6876622">err</span><span class="op" id="6876625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6876628">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6876631">if</span>&nbsp;<span class="ident" id="6876634">got</span>&nbsp;<span class="op" id="6876638">:=</span>&nbsp;<span class="builtintype" id="6876641">string</span><span class="op" id="6876647">(</span><span class="ident" id="6876648">got</span><span class="op" id="6876651">)</span><span class="op" id="6876652">;</span>&nbsp;<span class="ident" id="6876654">got</span>&nbsp;<span class="op" id="6876658">!=</span>&nbsp;<span class="ident" id="6876661">stringTagExpected</span>&nbsp;<span class="op" id="6876679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6876683">t</span><span class="op" id="6876684">.</span><span class="ident" id="6876685">Fatalf</span><span class="op" id="6876691">(</span><span class="string" id="6876692">&#34;&nbsp;got:&nbsp;%s\nwant:&nbsp;%s\n&#34;</span><span class="op" id="6876714">,</span>&nbsp;<span class="ident" id="6876716">got</span><span class="op" id="6876719">,</span>&nbsp;<span class="ident" id="6876721">stringTagExpected</span><span class="op" id="6876738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6876741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6876745">//&nbsp;Verify&nbsp;that&nbsp;it&nbsp;round-trips.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6876777">var</span>&nbsp;<span class="ident" id="6876781">s2</span>&nbsp;<span class="ident" id="6876784">StringTag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6876795">err</span>&nbsp;<span class="op" id="6876799">=</span>&nbsp;<span class="ident" id="6876801">NewDecoder</span><span class="op" id="6876811">(</span><span class="ident" id="6876812">bytes</span><span class="op" id="6876817">.</span><span class="ident" id="6876818">NewReader</span><span class="op" id="6876827">(</span><span class="ident" id="6876828">got</span><span class="op" id="6876831">)</span><span class="op" id="6876832">)</span><span class="op" id="6876833">.</span><span class="ident" id="6876834">Decode</span><span class="op" id="6876840">(</span><span class="op" id="6876841">&amp;</span><span class="ident" id="6876842">s2</span><span class="op" id="6876844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6876847">if</span>&nbsp;<span class="ident" id="6876850">err</span>&nbsp;<span class="op" id="6876854">!=</span>&nbsp;<span class="builtintype" id="6876857">nil</span>&nbsp;<span class="op" id="6876861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6876865">t</span><span class="op" id="6876866">.</span><span class="ident" id="6876867">Fatalf</span><span class="op" id="6876873">(</span><span class="string" id="6876874">&#34;Decode:&nbsp;%v&#34;</span><span class="op" id="6876886">,</span>&nbsp;<span class="ident" id="6876888">err</span><span class="op" id="6876891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6876894">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6876897">if</span>&nbsp;<span class="op" id="6876900">!</span><span class="ident" id="6876901">reflect</span><span class="op" id="6876908">.</span><span class="ident" id="6876909">DeepEqual</span><span class="op" id="6876918">(</span><span class="ident" id="6876919">s</span><span class="op" id="6876920">,</span>&nbsp;<span class="ident" id="6876922">s2</span><span class="op" id="6876924">)</span>&nbsp;<span class="op" id="6876926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6876930">t</span><span class="op" id="6876931">.</span><span class="ident" id="6876932">Fatalf</span><span class="op" id="6876938">(</span><span class="string" id="6876939">&#34;decode&nbsp;didn&#39;t&nbsp;match.\nsource:&nbsp;%#v\nEncoded&nbsp;as:\n%s\ndecode:&nbsp;%#v&#34;</span><span class="op" id="6877004">,</span>&nbsp;<span class="ident" id="6877006">s</span><span class="op" id="6877007">,</span>&nbsp;<span class="builtintype" id="6877009">string</span><span class="op" id="6877015">(</span><span class="ident" id="6877016">got</span><span class="op" id="6877019">)</span><span class="op" id="6877020">,</span>&nbsp;<span class="ident" id="6877022">s2</span><span class="op" id="6877024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6877027">}</span><br>
<span class="lineno"></span><span class="op" id="6877029">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="6877032">//&nbsp;byte&nbsp;slices&nbsp;are&nbsp;special&nbsp;even&nbsp;if&nbsp;they&#39;re&nbsp;renamed&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="6877090">type</span>&nbsp;<span class="ident" id="6877095">renamedByte</span>&nbsp;<span class="builtintype" id="6877107">byte</span><br>
<span class="lineno"></span><span class="keyword" id="6877112">type</span>&nbsp;<span class="ident" id="6877117">renamedByteSlice</span>&nbsp;<span class="op" id="6877134">[</span><span class="op" id="6877135">]</span><span class="builtintype" id="6877136">byte</span><br>
<span class="lineno"></span><span class="keyword" id="6877141">type</span>&nbsp;<span class="ident" id="6877146">renamedRenamedByteSlice</span>&nbsp;<span class="op" id="6877170">[</span><span class="op" id="6877171">]</span><span class="ident" id="6877172">renamedByte</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="6877185">func</span>&nbsp;<span class="ident" id="6877190">TestEncodeRenamedByteSlice</span><span class="op" id="6877216">(</span><span class="ident" id="6877217">t</span>&nbsp;<span class="op" id="6877219">*</span><span class="ident" id="6877220">testing</span><span class="op" id="6877227">.</span><span class="ident" id="6877228">T</span><span class="op" id="6877229">)</span>&nbsp;<span class="op" id="6877231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6877234">s</span>&nbsp;<span class="op" id="6877236">:=</span>&nbsp;<span class="ident" id="6877239">renamedByteSlice</span><span class="op" id="6877255">(</span><span class="string" id="6877256">&#34;abc&#34;</span><span class="op" id="6877261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6877264">result</span><span class="op" id="6877270">,</span>&nbsp;<span class="ident" id="6877272">err</span>&nbsp;<span class="op" id="6877276">:=</span>&nbsp;<span class="ident" id="6877279">Marshal</span><span class="op" id="6877286">(</span><span class="ident" id="6877287">s</span><span class="op" id="6877288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6877291">if</span>&nbsp;<span class="ident" id="6877294">err</span>&nbsp;<span class="op" id="6877298">!=</span>&nbsp;<span class="builtintype" id="6877301">nil</span>&nbsp;<span class="op" id="6877305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6877309">t</span><span class="op" id="6877310">.</span><span class="ident" id="6877311">Fatal</span><span class="op" id="6877316">(</span><span class="ident" id="6877317">err</span><span class="op" id="6877320">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6877323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6877326">expect</span>&nbsp;<span class="op" id="6877333">:=</span>&nbsp;<span class="string" id="6877336">`&#34;YWJj&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6877346">if</span>&nbsp;<span class="builtintype" id="6877349">string</span><span class="op" id="6877355">(</span><span class="ident" id="6877356">result</span><span class="op" id="6877362">)</span>&nbsp;<span class="op" id="6877364">!=</span>&nbsp;<span class="ident" id="6877367">expect</span>&nbsp;<span class="op" id="6877374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6877378">t</span><span class="op" id="6877379">.</span><span class="ident" id="6877380">Errorf</span><span class="op" id="6877386">(</span><span class="string" id="6877387">&#34;&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6877404">,</span>&nbsp;<span class="ident" id="6877406">result</span><span class="op" id="6877412">,</span>&nbsp;<span class="ident" id="6877414">expect</span><span class="op" id="6877420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6877423">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6877426">r</span>&nbsp;<span class="op" id="6877428">:=</span>&nbsp;<span class="ident" id="6877431">renamedRenamedByteSlice</span><span class="op" id="6877454">(</span><span class="string" id="6877455">&#34;abc&#34;</span><span class="op" id="6877460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6877463">result</span><span class="op" id="6877469">,</span>&nbsp;<span class="ident" id="6877471">err</span>&nbsp;<span class="op" id="6877475">=</span>&nbsp;<span class="ident" id="6877477">Marshal</span><span class="op" id="6877484">(</span><span class="ident" id="6877485">r</span><span class="op" id="6877486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6877489">if</span>&nbsp;<span class="ident" id="6877492">err</span>&nbsp;<span class="op" id="6877496">!=</span>&nbsp;<span class="builtintype" id="6877499">nil</span>&nbsp;<span class="op" id="6877503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6877507">t</span><span class="op" id="6877508">.</span><span class="ident" id="6877509">Fatal</span><span class="op" id="6877514">(</span><span class="ident" id="6877515">err</span><span class="op" id="6877518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6877521">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6877524">if</span>&nbsp;<span class="builtintype" id="6877527">string</span><span class="op" id="6877533">(</span><span class="ident" id="6877534">result</span><span class="op" id="6877540">)</span>&nbsp;<span class="op" id="6877542">!=</span>&nbsp;<span class="ident" id="6877545">expect</span>&nbsp;<span class="op" id="6877552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6877556">t</span><span class="op" id="6877557">.</span><span class="ident" id="6877558">Errorf</span><span class="op" id="6877564">(</span><span class="string" id="6877565">&#34;&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6877582">,</span>&nbsp;<span class="ident" id="6877584">result</span><span class="op" id="6877590">,</span>&nbsp;<span class="ident" id="6877592">expect</span><span class="op" id="6877598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6877601">}</span><br>
<span class="lineno"></span><span class="op" id="6877603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="6877606">var</span>&nbsp;<span class="ident" id="6877610">unsupportedValues</span>&nbsp;<span class="op" id="6877628">=</span>&nbsp;<span class="op" id="6877630">[</span><span class="op" id="6877631">]</span><span class="keyword" id="6877632">interface</span><span class="op" id="6877641">{</span><span class="op" id="6877642">}</span><span class="op" id="6877643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6877646">math</span><span class="op" id="6877650">.</span><span class="ident" id="6877651">NaN</span><span class="op" id="6877654">(</span><span class="op" id="6877655">)</span><span class="op" id="6877656">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6877659">math</span><span class="op" id="6877663">.</span><span class="ident" id="6877664">Inf</span><span class="op" id="6877667">(</span><span class="op" id="6877668">-</span><span class="num" id="6877669">1</span><span class="op" id="6877670">)</span><span class="op" id="6877671">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6877674">math</span><span class="op" id="6877678">.</span><span class="ident" id="6877679">Inf</span><span class="op" id="6877682">(</span><span class="num" id="6877683">1</span><span class="op" id="6877684">)</span><span class="op" id="6877685">,</span><br>
<span class="lineno"></span><span class="op" id="6877687">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="6877690">func</span>&nbsp;<span class="ident" id="6877695">TestUnsupportedValues</span><span class="op" id="6877716">(</span><span class="ident" id="6877717">t</span>&nbsp;<span class="op" id="6877719">*</span><span class="ident" id="6877720">testing</span><span class="op" id="6877727">.</span><span class="ident" id="6877728">T</span><span class="op" id="6877729">)</span>&nbsp;<span class="op" id="6877731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6877734">for</span>&nbsp;<span class="ident" id="6877738">_</span><span class="op" id="6877739">,</span>&nbsp;<span class="ident" id="6877741">v</span>&nbsp;<span class="op" id="6877743">:=</span>&nbsp;<span class="keyword" id="6877746">range</span>&nbsp;<span class="ident" id="6877752">unsupportedValues</span>&nbsp;<span class="op" id="6877770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6877774">if</span>&nbsp;<span class="ident" id="6877777">_</span><span class="op" id="6877778">,</span>&nbsp;<span class="ident" id="6877780">err</span>&nbsp;<span class="op" id="6877784">:=</span>&nbsp;<span class="ident" id="6877787">Marshal</span><span class="op" id="6877794">(</span><span class="ident" id="6877795">v</span><span class="op" id="6877796">)</span><span class="op" id="6877797">;</span>&nbsp;<span class="ident" id="6877799">err</span>&nbsp;<span class="op" id="6877803">!=</span>&nbsp;<span class="builtintype" id="6877806">nil</span>&nbsp;<span class="op" id="6877810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6877815">if</span>&nbsp;<span class="ident" id="6877818">_</span><span class="op" id="6877819">,</span>&nbsp;<span class="ident" id="6877821">ok</span>&nbsp;<span class="op" id="6877824">:=</span>&nbsp;<span class="ident" id="6877827">err</span><span class="op" id="6877830">.</span><span class="op" id="6877831">(</span><span class="op" id="6877832">*</span><span class="ident" id="6877833">UnsupportedValueError</span><span class="op" id="6877854">)</span><span class="op" id="6877855">;</span>&nbsp;<span class="op" id="6877857">!</span><span class="ident" id="6877858">ok</span>&nbsp;<span class="op" id="6877861">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6877867">t</span><span class="op" id="6877868">.</span><span class="ident" id="6877869">Errorf</span><span class="op" id="6877875">(</span><span class="string" id="6877876">&#34;for&nbsp;%v,&nbsp;got&nbsp;%T&nbsp;want&nbsp;UnsupportedValueError&#34;</span><span class="op" id="6877919">,</span>&nbsp;<span class="ident" id="6877921">v</span><span class="op" id="6877922">,</span>&nbsp;<span class="ident" id="6877924">err</span><span class="op" id="6877927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6877932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6877936">}</span>&nbsp;<span class="keyword" id="6877938">else</span>&nbsp;<span class="op" id="6877943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6877948">t</span><span class="op" id="6877949">.</span><span class="ident" id="6877950">Errorf</span><span class="op" id="6877956">(</span><span class="string" id="6877957">&#34;for&nbsp;%v,&nbsp;expected&nbsp;error&#34;</span><span class="op" id="6877981">,</span>&nbsp;<span class="ident" id="6877983">v</span><span class="op" id="6877984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6877988">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6877991">}</span><br>
<span class="lineno"></span><span class="op" id="6877993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6877996">//&nbsp;Ref&nbsp;has&nbsp;Marshaler&nbsp;and&nbsp;Unmarshaler&nbsp;methods&nbsp;with&nbsp;pointer&nbsp;receiver.</span><br>
<span class="lineno"></span><span class="keyword" id="6878064">type</span>&nbsp;<span class="ident" id="6878069">Ref</span>&nbsp;<span class="builtintype" id="6878073">int</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="keyword" id="6878078">func</span>&nbsp;<span class="op" id="6878083">(</span><span class="op" id="6878084">*</span><span class="ident" id="6878085">Ref</span><span class="op" id="6878088">)</span>&nbsp;<span class="ident" id="6878090">MarshalJSON</span><span class="op" id="6878101">(</span><span class="op" id="6878102">)</span>&nbsp;<span class="op" id="6878104">(</span><span class="op" id="6878105">[</span><span class="op" id="6878106">]</span><span class="builtintype" id="6878107">byte</span><span class="op" id="6878111">,</span>&nbsp;<span class="builtintype" id="6878113">error</span><span class="op" id="6878118">)</span>&nbsp;<span class="op" id="6878120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6878123">return</span>&nbsp;<span class="op" id="6878130">[</span><span class="op" id="6878131">]</span><span class="builtintype" id="6878132">byte</span><span class="op" id="6878136">(</span><span class="string" id="6878137">`&#34;ref&#34;`</span><span class="op" id="6878144">)</span><span class="op" id="6878145">,</span>&nbsp;<span class="builtintype" id="6878147">nil</span><br>
<span class="lineno"></span><span class="op" id="6878151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="keyword" id="6878154">func</span>&nbsp;<span class="op" id="6878159">(</span><span class="ident" id="6878160">r</span>&nbsp;<span class="op" id="6878162">*</span><span class="ident" id="6878163">Ref</span><span class="op" id="6878166">)</span>&nbsp;<span class="ident" id="6878168">UnmarshalJSON</span><span class="op" id="6878181">(</span><span class="op" id="6878182">[</span><span class="op" id="6878183">]</span><span class="builtintype" id="6878184">byte</span><span class="op" id="6878188">)</span>&nbsp;<span class="builtintype" id="6878190">error</span>&nbsp;<span class="op" id="6878196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6878199">*</span><span class="ident" id="6878200">r</span>&nbsp;<span class="op" id="6878202">=</span>&nbsp;<span class="num" id="6878204">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6878208">return</span>&nbsp;<span class="builtintype" id="6878215">nil</span><br>
<span class="lineno"></span><span class="op" id="6878219">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="6878222">//&nbsp;Val&nbsp;has&nbsp;Marshaler&nbsp;methods&nbsp;with&nbsp;value&nbsp;receiver.</span><br>
<span class="lineno"></span><span class="keyword" id="6878272">type</span>&nbsp;<span class="ident" id="6878277">Val</span>&nbsp;<span class="builtintype" id="6878281">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6878286">func</span>&nbsp;<span class="op" id="6878291">(</span><span class="ident" id="6878292">Val</span><span class="op" id="6878295">)</span>&nbsp;<span class="ident" id="6878297">MarshalJSON</span><span class="op" id="6878308">(</span><span class="op" id="6878309">)</span>&nbsp;<span class="op" id="6878311">(</span><span class="op" id="6878312">[</span><span class="op" id="6878313">]</span><span class="builtintype" id="6878314">byte</span><span class="op" id="6878318">,</span>&nbsp;<span class="builtintype" id="6878320">error</span><span class="op" id="6878325">)</span>&nbsp;<span class="op" id="6878327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6878330">return</span>&nbsp;<span class="op" id="6878337">[</span><span class="op" id="6878338">]</span><span class="builtintype" id="6878339">byte</span><span class="op" id="6878343">(</span><span class="string" id="6878344">`&#34;val&#34;`</span><span class="op" id="6878351">)</span><span class="op" id="6878352">,</span>&nbsp;<span class="builtintype" id="6878354">nil</span><br>
<span class="lineno">165</span><span class="op" id="6878358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6878361">//&nbsp;RefText&nbsp;has&nbsp;Marshaler&nbsp;and&nbsp;Unmarshaler&nbsp;methods&nbsp;with&nbsp;pointer&nbsp;receiver.</span><br>
<span class="lineno"></span><span class="keyword" id="6878433">type</span>&nbsp;<span class="ident" id="6878438">RefText</span>&nbsp;<span class="builtintype" id="6878446">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="6878451">func</span>&nbsp;<span class="op" id="6878456">(</span><span class="op" id="6878457">*</span><span class="ident" id="6878458">RefText</span><span class="op" id="6878465">)</span>&nbsp;<span class="ident" id="6878467">MarshalText</span><span class="op" id="6878478">(</span><span class="op" id="6878479">)</span>&nbsp;<span class="op" id="6878481">(</span><span class="op" id="6878482">[</span><span class="op" id="6878483">]</span><span class="builtintype" id="6878484">byte</span><span class="op" id="6878488">,</span>&nbsp;<span class="builtintype" id="6878490">error</span><span class="op" id="6878495">)</span>&nbsp;<span class="op" id="6878497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6878500">return</span>&nbsp;<span class="op" id="6878507">[</span><span class="op" id="6878508">]</span><span class="builtintype" id="6878509">byte</span><span class="op" id="6878513">(</span><span class="string" id="6878514">`&#34;ref&#34;`</span><span class="op" id="6878521">)</span><span class="op" id="6878522">,</span>&nbsp;<span class="builtintype" id="6878524">nil</span><br>
<span class="lineno"></span><span class="op" id="6878528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6878531">func</span>&nbsp;<span class="op" id="6878536">(</span><span class="ident" id="6878537">r</span>&nbsp;<span class="op" id="6878539">*</span><span class="ident" id="6878540">RefText</span><span class="op" id="6878547">)</span>&nbsp;<span class="ident" id="6878549">UnmarshalText</span><span class="op" id="6878562">(</span><span class="op" id="6878563">[</span><span class="op" id="6878564">]</span><span class="builtintype" id="6878565">byte</span><span class="op" id="6878569">)</span>&nbsp;<span class="builtintype" id="6878571">error</span>&nbsp;<span class="op" id="6878577">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6878580">*</span><span class="ident" id="6878581">r</span>&nbsp;<span class="op" id="6878583">=</span>&nbsp;<span class="num" id="6878585">13</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6878589">return</span>&nbsp;<span class="builtintype" id="6878596">nil</span><br>
<span class="lineno"></span><span class="op" id="6878600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6878603">//&nbsp;ValText&nbsp;has&nbsp;Marshaler&nbsp;methods&nbsp;with&nbsp;value&nbsp;receiver.</span><br>
<span class="lineno">180</span><span class="keyword" id="6878657">type</span>&nbsp;<span class="ident" id="6878662">ValText</span>&nbsp;<span class="builtintype" id="6878670">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6878675">func</span>&nbsp;<span class="op" id="6878680">(</span><span class="ident" id="6878681">ValText</span><span class="op" id="6878688">)</span>&nbsp;<span class="ident" id="6878690">MarshalText</span><span class="op" id="6878701">(</span><span class="op" id="6878702">)</span>&nbsp;<span class="op" id="6878704">(</span><span class="op" id="6878705">[</span><span class="op" id="6878706">]</span><span class="builtintype" id="6878707">byte</span><span class="op" id="6878711">,</span>&nbsp;<span class="builtintype" id="6878713">error</span><span class="op" id="6878718">)</span>&nbsp;<span class="op" id="6878720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6878723">return</span>&nbsp;<span class="op" id="6878730">[</span><span class="op" id="6878731">]</span><span class="builtintype" id="6878732">byte</span><span class="op" id="6878736">(</span><span class="string" id="6878737">`&#34;val&#34;`</span><span class="op" id="6878744">)</span><span class="op" id="6878745">,</span>&nbsp;<span class="builtintype" id="6878747">nil</span><br>
<span class="lineno"></span><span class="op" id="6878751">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="keyword" id="6878754">func</span>&nbsp;<span class="ident" id="6878759">TestRefValMarshal</span><span class="op" id="6878776">(</span><span class="ident" id="6878777">t</span>&nbsp;<span class="op" id="6878779">*</span><span class="ident" id="6878780">testing</span><span class="op" id="6878787">.</span><span class="ident" id="6878788">T</span><span class="op" id="6878789">)</span>&nbsp;<span class="op" id="6878791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6878794">var</span>&nbsp;<span class="ident" id="6878798">s</span>&nbsp;<span class="op" id="6878800">=</span>&nbsp;<span class="keyword" id="6878802">struct</span>&nbsp;<span class="op" id="6878809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6878813">R0</span>&nbsp;<span class="ident" id="6878816">Ref</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6878822">R1</span>&nbsp;<span class="op" id="6878825">*</span><span class="ident" id="6878826">Ref</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6878832">R2</span>&nbsp;<span class="ident" id="6878835">RefText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6878845">R3</span>&nbsp;<span class="op" id="6878848">*</span><span class="ident" id="6878849">RefText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6878859">V0</span>&nbsp;<span class="ident" id="6878862">Val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6878868">V1</span>&nbsp;<span class="op" id="6878871">*</span><span class="ident" id="6878872">Val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6878878">V2</span>&nbsp;<span class="ident" id="6878881">ValText</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6878891">V3</span>&nbsp;<span class="op" id="6878894">*</span><span class="ident" id="6878895">ValText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6878904">}</span><span class="op" id="6878905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6878909">R0</span><span class="op" id="6878911">:</span>&nbsp;<span class="num" id="6878913">12</span><span class="op" id="6878915">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6878919">R1</span><span class="op" id="6878921">:</span>&nbsp;<span class="builtinfunc" id="6878923">new</span><span class="op" id="6878926">(</span><span class="ident" id="6878927">Ref</span><span class="op" id="6878930">)</span><span class="op" id="6878931">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6878935">R2</span><span class="op" id="6878937">:</span>&nbsp;<span class="num" id="6878939">14</span><span class="op" id="6878941">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6878945">R3</span><span class="op" id="6878947">:</span>&nbsp;<span class="builtinfunc" id="6878949">new</span><span class="op" id="6878952">(</span><span class="ident" id="6878953">RefText</span><span class="op" id="6878960">)</span><span class="op" id="6878961">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6878965">V0</span><span class="op" id="6878967">:</span>&nbsp;<span class="num" id="6878969">13</span><span class="op" id="6878971">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6878975">V1</span><span class="op" id="6878977">:</span>&nbsp;<span class="builtinfunc" id="6878979">new</span><span class="op" id="6878982">(</span><span class="ident" id="6878983">Val</span><span class="op" id="6878986">)</span><span class="op" id="6878987">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6878991">V2</span><span class="op" id="6878993">:</span>&nbsp;<span class="num" id="6878995">15</span><span class="op" id="6878997">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6879001">V3</span><span class="op" id="6879003">:</span>&nbsp;<span class="builtinfunc" id="6879005">new</span><span class="op" id="6879008">(</span><span class="ident" id="6879009">ValText</span><span class="op" id="6879016">)</span><span class="op" id="6879017">,</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6879020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6879023">const</span>&nbsp;<span class="ident" id="6879029">want</span>&nbsp;<span class="op" id="6879034">=</span>&nbsp;<span class="string" id="6879036">`{&#34;R0&#34;:&#34;ref&#34;,&#34;R1&#34;:&#34;ref&#34;,&#34;R2&#34;:&#34;\&#34;ref\&#34;&#34;,&#34;R3&#34;:&#34;\&#34;ref\&#34;&#34;,&#34;V0&#34;:&#34;val&#34;,&#34;V1&#34;:&#34;val&#34;,&#34;V2&#34;:&#34;\&#34;val\&#34;&#34;,&#34;V3&#34;:&#34;\&#34;val\&#34;&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6879145">b</span><span class="op" id="6879146">,</span>&nbsp;<span class="ident" id="6879148">err</span>&nbsp;<span class="op" id="6879152">:=</span>&nbsp;<span class="ident" id="6879155">Marshal</span><span class="op" id="6879162">(</span><span class="op" id="6879163">&amp;</span><span class="ident" id="6879164">s</span><span class="op" id="6879165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6879168">if</span>&nbsp;<span class="ident" id="6879171">err</span>&nbsp;<span class="op" id="6879175">!=</span>&nbsp;<span class="builtintype" id="6879178">nil</span>&nbsp;<span class="op" id="6879182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6879186">t</span><span class="op" id="6879187">.</span><span class="ident" id="6879188">Fatalf</span><span class="op" id="6879194">(</span><span class="string" id="6879195">&#34;Marshal:&nbsp;%v&#34;</span><span class="op" id="6879208">,</span>&nbsp;<span class="ident" id="6879210">err</span><span class="op" id="6879213">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6879216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6879219">if</span>&nbsp;<span class="ident" id="6879222">got</span>&nbsp;<span class="op" id="6879226">:=</span>&nbsp;<span class="builtintype" id="6879229">string</span><span class="op" id="6879235">(</span><span class="ident" id="6879236">b</span><span class="op" id="6879237">)</span><span class="op" id="6879238">;</span>&nbsp;<span class="ident" id="6879240">got</span>&nbsp;<span class="op" id="6879244">!=</span>&nbsp;<span class="ident" id="6879247">want</span>&nbsp;<span class="op" id="6879252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6879256">t</span><span class="op" id="6879257">.</span><span class="ident" id="6879258">Errorf</span><span class="op" id="6879264">(</span><span class="string" id="6879265">&#34;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6879282">,</span>&nbsp;<span class="ident" id="6879284">got</span><span class="op" id="6879287">,</span>&nbsp;<span class="ident" id="6879289">want</span><span class="op" id="6879293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6879296">}</span><br>
<span class="lineno"></span><span class="op" id="6879298">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="comment" id="6879301">//&nbsp;C&nbsp;implements&nbsp;Marshaler&nbsp;and&nbsp;returns&nbsp;unescaped&nbsp;JSON.</span><br>
<span class="lineno"></span><span class="keyword" id="6879355">type</span>&nbsp;<span class="ident" id="6879360">C</span>&nbsp;<span class="builtintype" id="6879362">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6879367">func</span>&nbsp;<span class="op" id="6879372">(</span><span class="ident" id="6879373">C</span><span class="op" id="6879374">)</span>&nbsp;<span class="ident" id="6879376">MarshalJSON</span><span class="op" id="6879387">(</span><span class="op" id="6879388">)</span>&nbsp;<span class="op" id="6879390">(</span><span class="op" id="6879391">[</span><span class="op" id="6879392">]</span><span class="builtintype" id="6879393">byte</span><span class="op" id="6879397">,</span>&nbsp;<span class="builtintype" id="6879399">error</span><span class="op" id="6879404">)</span>&nbsp;<span class="op" id="6879406">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6879409">return</span>&nbsp;<span class="op" id="6879416">[</span><span class="op" id="6879417">]</span><span class="builtintype" id="6879418">byte</span><span class="op" id="6879422">(</span><span class="string" id="6879423">`&#34;&lt;&amp;&gt;&#34;`</span><span class="op" id="6879430">)</span><span class="op" id="6879431">,</span>&nbsp;<span class="builtintype" id="6879433">nil</span><br>
<span class="lineno"></span><span class="op" id="6879437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6879440">//&nbsp;CText&nbsp;implements&nbsp;Marshaler&nbsp;and&nbsp;returns&nbsp;unescaped&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="6879498">type</span>&nbsp;<span class="ident" id="6879503">CText</span>&nbsp;<span class="builtintype" id="6879509">int</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="keyword" id="6879514">func</span>&nbsp;<span class="op" id="6879519">(</span><span class="ident" id="6879520">CText</span><span class="op" id="6879525">)</span>&nbsp;<span class="ident" id="6879527">MarshalText</span><span class="op" id="6879538">(</span><span class="op" id="6879539">)</span>&nbsp;<span class="op" id="6879541">(</span><span class="op" id="6879542">[</span><span class="op" id="6879543">]</span><span class="builtintype" id="6879544">byte</span><span class="op" id="6879548">,</span>&nbsp;<span class="builtintype" id="6879550">error</span><span class="op" id="6879555">)</span>&nbsp;<span class="op" id="6879557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6879560">return</span>&nbsp;<span class="op" id="6879567">[</span><span class="op" id="6879568">]</span><span class="builtintype" id="6879569">byte</span><span class="op" id="6879573">(</span><span class="string" id="6879574">`&#34;&lt;&amp;&gt;&#34;`</span><span class="op" id="6879581">)</span><span class="op" id="6879582">,</span>&nbsp;<span class="builtintype" id="6879584">nil</span><br>
<span class="lineno"></span><span class="op" id="6879588">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="6879591">func</span>&nbsp;<span class="ident" id="6879596">TestMarshalerEscaping</span><span class="op" id="6879617">(</span><span class="ident" id="6879618">t</span>&nbsp;<span class="op" id="6879620">*</span><span class="ident" id="6879621">testing</span><span class="op" id="6879628">.</span><span class="ident" id="6879629">T</span><span class="op" id="6879630">)</span>&nbsp;<span class="op" id="6879632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6879635">var</span>&nbsp;<span class="ident" id="6879639">c</span>&nbsp;<span class="ident" id="6879641">C</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6879644">want</span>&nbsp;<span class="op" id="6879649">:=</span>&nbsp;<span class="string" id="6879652">`&#34;\u003c\u0026\u003e&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6879676">b</span><span class="op" id="6879677">,</span>&nbsp;<span class="ident" id="6879679">err</span>&nbsp;<span class="op" id="6879683">:=</span>&nbsp;<span class="ident" id="6879686">Marshal</span><span class="op" id="6879693">(</span><span class="ident" id="6879694">c</span><span class="op" id="6879695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6879698">if</span>&nbsp;<span class="ident" id="6879701">err</span>&nbsp;<span class="op" id="6879705">!=</span>&nbsp;<span class="builtintype" id="6879708">nil</span>&nbsp;<span class="op" id="6879712">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6879716">t</span><span class="op" id="6879717">.</span><span class="ident" id="6879718">Fatalf</span><span class="op" id="6879724">(</span><span class="string" id="6879725">&#34;Marshal(c):&nbsp;%v&#34;</span><span class="op" id="6879741">,</span>&nbsp;<span class="ident" id="6879743">err</span><span class="op" id="6879746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6879749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6879752">if</span>&nbsp;<span class="ident" id="6879755">got</span>&nbsp;<span class="op" id="6879759">:=</span>&nbsp;<span class="builtintype" id="6879762">string</span><span class="op" id="6879768">(</span><span class="ident" id="6879769">b</span><span class="op" id="6879770">)</span><span class="op" id="6879771">;</span>&nbsp;<span class="ident" id="6879773">got</span>&nbsp;<span class="op" id="6879777">!=</span>&nbsp;<span class="ident" id="6879780">want</span>&nbsp;<span class="op" id="6879785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6879789">t</span><span class="op" id="6879790">.</span><span class="ident" id="6879791">Errorf</span><span class="op" id="6879797">(</span><span class="string" id="6879798">&#34;Marshal(c)&nbsp;=&nbsp;%#q,&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="6879826">,</span>&nbsp;<span class="ident" id="6879828">got</span><span class="op" id="6879831">,</span>&nbsp;<span class="ident" id="6879833">want</span><span class="op" id="6879837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6879840">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6879844">var</span>&nbsp;<span class="ident" id="6879848">ct</span>&nbsp;<span class="ident" id="6879851">CText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6879858">want</span>&nbsp;<span class="op" id="6879863">=</span>&nbsp;<span class="string" id="6879865">`&#34;\&#34;\u003c\u0026\u003e\&#34;&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6879893">b</span><span class="op" id="6879894">,</span>&nbsp;<span class="ident" id="6879896">err</span>&nbsp;<span class="op" id="6879900">=</span>&nbsp;<span class="ident" id="6879902">Marshal</span><span class="op" id="6879909">(</span><span class="ident" id="6879910">ct</span><span class="op" id="6879912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6879915">if</span>&nbsp;<span class="ident" id="6879918">err</span>&nbsp;<span class="op" id="6879922">!=</span>&nbsp;<span class="builtintype" id="6879925">nil</span>&nbsp;<span class="op" id="6879929">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6879933">t</span><span class="op" id="6879934">.</span><span class="ident" id="6879935">Fatalf</span><span class="op" id="6879941">(</span><span class="string" id="6879942">&#34;Marshal(ct):&nbsp;%v&#34;</span><span class="op" id="6879959">,</span>&nbsp;<span class="ident" id="6879961">err</span><span class="op" id="6879964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6879967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6879970">if</span>&nbsp;<span class="ident" id="6879973">got</span>&nbsp;<span class="op" id="6879977">:=</span>&nbsp;<span class="builtintype" id="6879980">string</span><span class="op" id="6879986">(</span><span class="ident" id="6879987">b</span><span class="op" id="6879988">)</span><span class="op" id="6879989">;</span>&nbsp;<span class="ident" id="6879991">got</span>&nbsp;<span class="op" id="6879995">!=</span>&nbsp;<span class="ident" id="6879998">want</span>&nbsp;<span class="op" id="6880003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6880007">t</span><span class="op" id="6880008">.</span><span class="ident" id="6880009">Errorf</span><span class="op" id="6880015">(</span><span class="string" id="6880016">&#34;Marshal(ct)&nbsp;=&nbsp;%#q,&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="6880045">,</span>&nbsp;<span class="ident" id="6880047">got</span><span class="op" id="6880050">,</span>&nbsp;<span class="ident" id="6880052">want</span><span class="op" id="6880056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6880059">}</span><br>
<span class="lineno">250</span><span class="op" id="6880061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6880064">type</span>&nbsp;<span class="ident" id="6880069">IntType</span>&nbsp;<span class="builtintype" id="6880077">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6880082">type</span>&nbsp;<span class="ident" id="6880087">MyStruct</span>&nbsp;<span class="keyword" id="6880096">struct</span>&nbsp;<span class="op" id="6880103">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6880106">IntType</span><br>
<span class="lineno"></span><span class="op" id="6880114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6880117">func</span>&nbsp;<span class="ident" id="6880122">TestAnonymousNonstruct</span><span class="op" id="6880144">(</span><span class="ident" id="6880145">t</span>&nbsp;<span class="op" id="6880147">*</span><span class="ident" id="6880148">testing</span><span class="op" id="6880155">.</span><span class="ident" id="6880156">T</span><span class="op" id="6880157">)</span>&nbsp;<span class="op" id="6880159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6880162">var</span>&nbsp;<span class="ident" id="6880166">i</span>&nbsp;<span class="ident" id="6880168">IntType</span>&nbsp;<span class="op" id="6880176">=</span>&nbsp;<span class="num" id="6880178">11</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6880182">a</span>&nbsp;<span class="op" id="6880184">:=</span>&nbsp;<span class="ident" id="6880187">MyStruct</span><span class="op" id="6880195">{</span><span class="ident" id="6880196">i</span><span class="op" id="6880197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6880200">const</span>&nbsp;<span class="ident" id="6880206">want</span>&nbsp;<span class="op" id="6880211">=</span>&nbsp;<span class="string" id="6880213">`{&#34;IntType&#34;:11}`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6880232">b</span><span class="op" id="6880233">,</span>&nbsp;<span class="ident" id="6880235">err</span>&nbsp;<span class="op" id="6880239">:=</span>&nbsp;<span class="ident" id="6880242">Marshal</span><span class="op" id="6880249">(</span><span class="ident" id="6880250">a</span><span class="op" id="6880251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6880254">if</span>&nbsp;<span class="ident" id="6880257">err</span>&nbsp;<span class="op" id="6880261">!=</span>&nbsp;<span class="builtintype" id="6880264">nil</span>&nbsp;<span class="op" id="6880268">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6880272">t</span><span class="op" id="6880273">.</span><span class="ident" id="6880274">Fatalf</span><span class="op" id="6880280">(</span><span class="string" id="6880281">&#34;Marshal:&nbsp;%v&#34;</span><span class="op" id="6880294">,</span>&nbsp;<span class="ident" id="6880296">err</span><span class="op" id="6880299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6880302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6880305">if</span>&nbsp;<span class="ident" id="6880308">got</span>&nbsp;<span class="op" id="6880312">:=</span>&nbsp;<span class="builtintype" id="6880315">string</span><span class="op" id="6880321">(</span><span class="ident" id="6880322">b</span><span class="op" id="6880323">)</span><span class="op" id="6880324">;</span>&nbsp;<span class="ident" id="6880326">got</span>&nbsp;<span class="op" id="6880330">!=</span>&nbsp;<span class="ident" id="6880333">want</span>&nbsp;<span class="op" id="6880338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6880342">t</span><span class="op" id="6880343">.</span><span class="ident" id="6880344">Errorf</span><span class="op" id="6880350">(</span><span class="string" id="6880351">&#34;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6880368">,</span>&nbsp;<span class="ident" id="6880370">got</span><span class="op" id="6880373">,</span>&nbsp;<span class="ident" id="6880375">want</span><span class="op" id="6880379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6880382">}</span><br>
<span class="lineno">270</span><span class="op" id="6880384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6880387">type</span>&nbsp;<span class="ident" id="6880392">BugA</span>&nbsp;<span class="keyword" id="6880397">struct</span>&nbsp;<span class="op" id="6880404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6880407">S</span>&nbsp;<span class="builtintype" id="6880409">string</span><br>
<span class="lineno"></span><span class="op" id="6880416">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="keyword" id="6880419">type</span>&nbsp;<span class="ident" id="6880424">BugB</span>&nbsp;<span class="keyword" id="6880429">struct</span>&nbsp;<span class="op" id="6880436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6880439">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6880445">S</span>&nbsp;<span class="builtintype" id="6880447">string</span><br>
<span class="lineno"></span><span class="op" id="6880454">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="6880457">type</span>&nbsp;<span class="ident" id="6880462">BugC</span>&nbsp;<span class="keyword" id="6880467">struct</span>&nbsp;<span class="op" id="6880474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6880477">S</span>&nbsp;<span class="builtintype" id="6880479">string</span><br>
<span class="lineno"></span><span class="op" id="6880486">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="comment" id="6880489">//&nbsp;Legal&nbsp;Go:&nbsp;We&nbsp;never&nbsp;use&nbsp;the&nbsp;repeated&nbsp;embedded&nbsp;field&nbsp;(S).</span><br>
<span class="lineno"></span><span class="keyword" id="6880548">type</span>&nbsp;<span class="ident" id="6880553">BugX</span>&nbsp;<span class="keyword" id="6880558">struct</span>&nbsp;<span class="op" id="6880565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6880568">A</span>&nbsp;<span class="builtintype" id="6880570">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6880575">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6880581">BugB</span><br>
<span class="lineno">290</span><span class="op" id="6880586">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6880589">//&nbsp;Issue&nbsp;5245.</span><br>
<span class="lineno"></span><span class="keyword" id="6880604">func</span>&nbsp;<span class="ident" id="6880609">TestEmbeddedBug</span><span class="op" id="6880624">(</span><span class="ident" id="6880625">t</span>&nbsp;<span class="op" id="6880627">*</span><span class="ident" id="6880628">testing</span><span class="op" id="6880635">.</span><span class="ident" id="6880636">T</span><span class="op" id="6880637">)</span>&nbsp;<span class="op" id="6880639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6880642">v</span>&nbsp;<span class="op" id="6880644">:=</span>&nbsp;<span class="ident" id="6880647">BugB</span><span class="op" id="6880651">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6880655">BugA</span><span class="op" id="6880659">{</span><span class="string" id="6880660">&#34;A&#34;</span><span class="op" id="6880663">}</span><span class="op" id="6880664">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6880668">&#34;B&#34;</span><span class="op" id="6880671">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6880674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6880677">b</span><span class="op" id="6880678">,</span>&nbsp;<span class="ident" id="6880680">err</span>&nbsp;<span class="op" id="6880684">:=</span>&nbsp;<span class="ident" id="6880687">Marshal</span><span class="op" id="6880694">(</span><span class="ident" id="6880695">v</span><span class="op" id="6880696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6880699">if</span>&nbsp;<span class="ident" id="6880702">err</span>&nbsp;<span class="op" id="6880706">!=</span>&nbsp;<span class="builtintype" id="6880709">nil</span>&nbsp;<span class="op" id="6880713">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6880717">t</span><span class="op" id="6880718">.</span><span class="ident" id="6880719">Fatal</span><span class="op" id="6880724">(</span><span class="string" id="6880725">&#34;Marshal:&#34;</span><span class="op" id="6880735">,</span>&nbsp;<span class="ident" id="6880737">err</span><span class="op" id="6880740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6880743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6880746">want</span>&nbsp;<span class="op" id="6880751">:=</span>&nbsp;<span class="string" id="6880754">`{&#34;S&#34;:&#34;B&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6880767">got</span>&nbsp;<span class="op" id="6880771">:=</span>&nbsp;<span class="builtintype" id="6880774">string</span><span class="op" id="6880780">(</span><span class="ident" id="6880781">b</span><span class="op" id="6880782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6880785">if</span>&nbsp;<span class="ident" id="6880788">got</span>&nbsp;<span class="op" id="6880792">!=</span>&nbsp;<span class="ident" id="6880795">want</span>&nbsp;<span class="op" id="6880800">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6880804">t</span><span class="op" id="6880805">.</span><span class="ident" id="6880806">Fatalf</span><span class="op" id="6880812">(</span><span class="string" id="6880813">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6880838">,</span>&nbsp;<span class="ident" id="6880840">got</span><span class="op" id="6880843">,</span>&nbsp;<span class="ident" id="6880845">want</span><span class="op" id="6880849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6880852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6880855">//&nbsp;Now&nbsp;check&nbsp;that&nbsp;the&nbsp;duplicate&nbsp;field,&nbsp;S,&nbsp;does&nbsp;not&nbsp;appear.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6880915">x</span>&nbsp;<span class="op" id="6880917">:=</span>&nbsp;<span class="ident" id="6880920">BugX</span><span class="op" id="6880924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6880928">A</span><span class="op" id="6880929">:</span>&nbsp;<span class="num" id="6880931">23</span><span class="op" id="6880933">,</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6880936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6880939">b</span><span class="op" id="6880940">,</span>&nbsp;<span class="ident" id="6880942">err</span>&nbsp;<span class="op" id="6880946">=</span>&nbsp;<span class="ident" id="6880948">Marshal</span><span class="op" id="6880955">(</span><span class="ident" id="6880956">x</span><span class="op" id="6880957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6880960">if</span>&nbsp;<span class="ident" id="6880963">err</span>&nbsp;<span class="op" id="6880967">!=</span>&nbsp;<span class="builtintype" id="6880970">nil</span>&nbsp;<span class="op" id="6880974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6880978">t</span><span class="op" id="6880979">.</span><span class="ident" id="6880980">Fatal</span><span class="op" id="6880985">(</span><span class="string" id="6880986">&#34;Marshal:&#34;</span><span class="op" id="6880996">,</span>&nbsp;<span class="ident" id="6880998">err</span><span class="op" id="6881001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6881004">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6881007">want</span>&nbsp;<span class="op" id="6881012">=</span>&nbsp;<span class="string" id="6881014">`{&#34;A&#34;:23}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6881026">got</span>&nbsp;<span class="op" id="6881030">=</span>&nbsp;<span class="builtintype" id="6881032">string</span><span class="op" id="6881038">(</span><span class="ident" id="6881039">b</span><span class="op" id="6881040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6881043">if</span>&nbsp;<span class="ident" id="6881046">got</span>&nbsp;<span class="op" id="6881050">!=</span>&nbsp;<span class="ident" id="6881053">want</span>&nbsp;<span class="op" id="6881058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6881062">t</span><span class="op" id="6881063">.</span><span class="ident" id="6881064">Fatalf</span><span class="op" id="6881070">(</span><span class="string" id="6881071">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6881096">,</span>&nbsp;<span class="ident" id="6881098">got</span><span class="op" id="6881101">,</span>&nbsp;<span class="ident" id="6881103">want</span><span class="op" id="6881107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6881110">}</span><br>
<span class="lineno">320</span><span class="op" id="6881112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6881115">type</span>&nbsp;<span class="ident" id="6881120">BugD</span>&nbsp;<span class="keyword" id="6881125">struct</span>&nbsp;<span class="op" id="6881132">{</span>&nbsp;<span class="comment" id="6881134">//&nbsp;Same&nbsp;as&nbsp;BugA&nbsp;after&nbsp;tagging.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6881166">XXX</span>&nbsp;<span class="builtintype" id="6881170">string</span>&nbsp;<span class="string" id="6881177">`json:&#34;S&#34;`</span><br>
<span class="lineno"></span><span class="op" id="6881188">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="6881191">//&nbsp;BugD&#39;s&nbsp;tagged&nbsp;S&nbsp;field&nbsp;should&nbsp;dominate&nbsp;BugA&#39;s.</span><br>
<span class="lineno"></span><span class="keyword" id="6881240">type</span>&nbsp;<span class="ident" id="6881245">BugY</span>&nbsp;<span class="keyword" id="6881250">struct</span>&nbsp;<span class="op" id="6881257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6881260">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6881266">BugD</span><br>
<span class="lineno">330</span><span class="op" id="6881271">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6881274">//&nbsp;Test&nbsp;that&nbsp;a&nbsp;field&nbsp;with&nbsp;a&nbsp;tag&nbsp;dominates&nbsp;untagged&nbsp;fields.</span><br>
<span class="lineno"></span><span class="keyword" id="6881333">func</span>&nbsp;<span class="ident" id="6881338">TestTaggedFieldDominates</span><span class="op" id="6881362">(</span><span class="ident" id="6881363">t</span>&nbsp;<span class="op" id="6881365">*</span><span class="ident" id="6881366">testing</span><span class="op" id="6881373">.</span><span class="ident" id="6881374">T</span><span class="op" id="6881375">)</span>&nbsp;<span class="op" id="6881377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6881380">v</span>&nbsp;<span class="op" id="6881382">:=</span>&nbsp;<span class="ident" id="6881385">BugY</span><span class="op" id="6881389">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6881393">BugA</span><span class="op" id="6881397">{</span><span class="string" id="6881398">&#34;BugA&#34;</span><span class="op" id="6881404">}</span><span class="op" id="6881405">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6881409">BugD</span><span class="op" id="6881413">{</span><span class="string" id="6881414">&#34;BugD&#34;</span><span class="op" id="6881420">}</span><span class="op" id="6881421">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6881424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6881427">b</span><span class="op" id="6881428">,</span>&nbsp;<span class="ident" id="6881430">err</span>&nbsp;<span class="op" id="6881434">:=</span>&nbsp;<span class="ident" id="6881437">Marshal</span><span class="op" id="6881444">(</span><span class="ident" id="6881445">v</span><span class="op" id="6881446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6881449">if</span>&nbsp;<span class="ident" id="6881452">err</span>&nbsp;<span class="op" id="6881456">!=</span>&nbsp;<span class="builtintype" id="6881459">nil</span>&nbsp;<span class="op" id="6881463">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6881467">t</span><span class="op" id="6881468">.</span><span class="ident" id="6881469">Fatal</span><span class="op" id="6881474">(</span><span class="string" id="6881475">&#34;Marshal:&#34;</span><span class="op" id="6881485">,</span>&nbsp;<span class="ident" id="6881487">err</span><span class="op" id="6881490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6881493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6881496">want</span>&nbsp;<span class="op" id="6881501">:=</span>&nbsp;<span class="string" id="6881504">`{&#34;S&#34;:&#34;BugD&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6881520">got</span>&nbsp;<span class="op" id="6881524">:=</span>&nbsp;<span class="builtintype" id="6881527">string</span><span class="op" id="6881533">(</span><span class="ident" id="6881534">b</span><span class="op" id="6881535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6881538">if</span>&nbsp;<span class="ident" id="6881541">got</span>&nbsp;<span class="op" id="6881545">!=</span>&nbsp;<span class="ident" id="6881548">want</span>&nbsp;<span class="op" id="6881553">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6881557">t</span><span class="op" id="6881558">.</span><span class="ident" id="6881559">Fatalf</span><span class="op" id="6881565">(</span><span class="string" id="6881566">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6881591">,</span>&nbsp;<span class="ident" id="6881593">got</span><span class="op" id="6881596">,</span>&nbsp;<span class="ident" id="6881598">want</span><span class="op" id="6881602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6881605">}</span><br>
<span class="lineno"></span><span class="op" id="6881607">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6881610">//&nbsp;There&nbsp;are&nbsp;no&nbsp;tags&nbsp;here,&nbsp;so&nbsp;S&nbsp;should&nbsp;not&nbsp;appear.</span><br>
<span class="lineno">350</span><span class="keyword" id="6881661">type</span>&nbsp;<span class="ident" id="6881666">BugZ</span>&nbsp;<span class="keyword" id="6881671">struct</span>&nbsp;<span class="op" id="6881678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6881681">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6881687">BugC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6881693">BugY</span>&nbsp;<span class="comment" id="6881698">//&nbsp;Contains&nbsp;a&nbsp;tagged&nbsp;S&nbsp;field&nbsp;through&nbsp;BugD;&nbsp;should&nbsp;not&nbsp;dominate.</span><br>
<span class="lineno"></span><span class="op" id="6881762">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span><span class="keyword" id="6881765">func</span>&nbsp;<span class="ident" id="6881770">TestDuplicatedFieldDisappears</span><span class="op" id="6881799">(</span><span class="ident" id="6881800">t</span>&nbsp;<span class="op" id="6881802">*</span><span class="ident" id="6881803">testing</span><span class="op" id="6881810">.</span><span class="ident" id="6881811">T</span><span class="op" id="6881812">)</span>&nbsp;<span class="op" id="6881814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6881817">v</span>&nbsp;<span class="op" id="6881819">:=</span>&nbsp;<span class="ident" id="6881822">BugZ</span><span class="op" id="6881826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6881830">BugA</span><span class="op" id="6881834">{</span><span class="string" id="6881835">&#34;BugA&#34;</span><span class="op" id="6881841">}</span><span class="op" id="6881842">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6881846">BugC</span><span class="op" id="6881850">{</span><span class="string" id="6881851">&#34;BugC&#34;</span><span class="op" id="6881857">}</span><span class="op" id="6881858">,</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6881862">BugY</span><span class="op" id="6881866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6881871">BugA</span><span class="op" id="6881875">{</span><span class="string" id="6881876">&#34;nested&nbsp;BugA&#34;</span><span class="op" id="6881889">}</span><span class="op" id="6881890">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6881895">BugD</span><span class="op" id="6881899">{</span><span class="string" id="6881900">&#34;nested&nbsp;BugD&#34;</span><span class="op" id="6881913">}</span><span class="op" id="6881914">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6881918">}</span><span class="op" id="6881919">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6881922">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6881925">b</span><span class="op" id="6881926">,</span>&nbsp;<span class="ident" id="6881928">err</span>&nbsp;<span class="op" id="6881932">:=</span>&nbsp;<span class="ident" id="6881935">Marshal</span><span class="op" id="6881942">(</span><span class="ident" id="6881943">v</span><span class="op" id="6881944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6881947">if</span>&nbsp;<span class="ident" id="6881950">err</span>&nbsp;<span class="op" id="6881954">!=</span>&nbsp;<span class="builtintype" id="6881957">nil</span>&nbsp;<span class="op" id="6881961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6881965">t</span><span class="op" id="6881966">.</span><span class="ident" id="6881967">Fatal</span><span class="op" id="6881972">(</span><span class="string" id="6881973">&#34;Marshal:&#34;</span><span class="op" id="6881983">,</span>&nbsp;<span class="ident" id="6881985">err</span><span class="op" id="6881988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6881991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6881994">want</span>&nbsp;<span class="op" id="6881999">:=</span>&nbsp;<span class="string" id="6882002">`{}`</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6882008">got</span>&nbsp;<span class="op" id="6882012">:=</span>&nbsp;<span class="builtintype" id="6882015">string</span><span class="op" id="6882021">(</span><span class="ident" id="6882022">b</span><span class="op" id="6882023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6882026">if</span>&nbsp;<span class="ident" id="6882029">got</span>&nbsp;<span class="op" id="6882033">!=</span>&nbsp;<span class="ident" id="6882036">want</span>&nbsp;<span class="op" id="6882041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6882045">t</span><span class="op" id="6882046">.</span><span class="ident" id="6882047">Fatalf</span><span class="op" id="6882053">(</span><span class="string" id="6882054">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6882079">,</span>&nbsp;<span class="ident" id="6882081">got</span><span class="op" id="6882084">,</span>&nbsp;<span class="ident" id="6882086">want</span><span class="op" id="6882090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6882093">}</span><br>
<span class="lineno"></span><span class="op" id="6882095">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="keyword" id="6882098">func</span>&nbsp;<span class="ident" id="6882103">TestStringBytes</span><span class="op" id="6882118">(</span><span class="ident" id="6882119">t</span>&nbsp;<span class="op" id="6882121">*</span><span class="ident" id="6882122">testing</span><span class="op" id="6882129">.</span><span class="ident" id="6882130">T</span><span class="op" id="6882131">)</span>&nbsp;<span class="op" id="6882133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6882136">//&nbsp;Test&nbsp;that&nbsp;encodeState.stringBytes&nbsp;and&nbsp;encodeState.string&nbsp;use&nbsp;the&nbsp;same&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6882220">es</span>&nbsp;<span class="op" id="6882223">:=</span>&nbsp;<span class="op" id="6882226">&amp;</span><span class="ident" id="6882227">encodeState</span><span class="op" id="6882238">{</span><span class="op" id="6882239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6882242">var</span>&nbsp;<span class="ident" id="6882246">r</span>&nbsp;<span class="op" id="6882248">[</span><span class="op" id="6882249">]</span><span class="builtintype" id="6882250">rune</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6882256">for</span>&nbsp;<span class="ident" id="6882260">i</span>&nbsp;<span class="op" id="6882262">:=</span>&nbsp;<span class="string" id="6882265">&#39;\u0000&#39;</span><span class="op" id="6882273">;</span>&nbsp;<span class="ident" id="6882275">i</span>&nbsp;<span class="op" id="6882277">&lt;=</span>&nbsp;<span class="ident" id="6882280">unicode</span><span class="op" id="6882287">.</span><span class="ident" id="6882288">MaxRune</span><span class="op" id="6882295">;</span>&nbsp;<span class="ident" id="6882297">i</span><span class="op" id="6882298">++</span>&nbsp;<span class="op" id="6882301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6882305">r</span>&nbsp;<span class="op" id="6882307">=</span>&nbsp;<span class="builtinfunc" id="6882309">append</span><span class="op" id="6882315">(</span><span class="ident" id="6882316">r</span><span class="op" id="6882317">,</span>&nbsp;<span class="ident" id="6882319">i</span><span class="op" id="6882320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6882323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6882326">s</span>&nbsp;<span class="op" id="6882328">:=</span>&nbsp;<span class="builtintype" id="6882331">string</span><span class="op" id="6882337">(</span><span class="ident" id="6882338">r</span><span class="op" id="6882339">)</span>&nbsp;<span class="op" id="6882341">+</span>&nbsp;<span class="string" id="6882343">&#34;\xff\xff\xffhello&#34;</span>&nbsp;<span class="comment" id="6882363">//&nbsp;some&nbsp;invalid&nbsp;UTF-8&nbsp;too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6882390">_</span><span class="op" id="6882391">,</span>&nbsp;<span class="ident" id="6882393">err</span>&nbsp;<span class="op" id="6882397">:=</span>&nbsp;<span class="ident" id="6882400">es</span><span class="op" id="6882402">.</span><span class="builtintype" id="6882403">string</span><span class="op" id="6882409">(</span><span class="ident" id="6882410">s</span><span class="op" id="6882411">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6882414">if</span>&nbsp;<span class="ident" id="6882417">err</span>&nbsp;<span class="op" id="6882421">!=</span>&nbsp;<span class="builtintype" id="6882424">nil</span>&nbsp;<span class="op" id="6882428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6882432">t</span><span class="op" id="6882433">.</span><span class="ident" id="6882434">Fatal</span><span class="op" id="6882439">(</span><span class="ident" id="6882440">err</span><span class="op" id="6882443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6882446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6882450">esBytes</span>&nbsp;<span class="op" id="6882458">:=</span>&nbsp;<span class="op" id="6882461">&amp;</span><span class="ident" id="6882462">encodeState</span><span class="op" id="6882473">{</span><span class="op" id="6882474">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6882477">_</span><span class="op" id="6882478">,</span>&nbsp;<span class="ident" id="6882480">err</span>&nbsp;<span class="op" id="6882484">=</span>&nbsp;<span class="ident" id="6882486">esBytes</span><span class="op" id="6882493">.</span><span class="ident" id="6882494">stringBytes</span><span class="op" id="6882505">(</span><span class="op" id="6882506">[</span><span class="op" id="6882507">]</span><span class="builtintype" id="6882508">byte</span><span class="op" id="6882512">(</span><span class="ident" id="6882513">s</span><span class="op" id="6882514">)</span><span class="op" id="6882515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6882518">if</span>&nbsp;<span class="ident" id="6882521">err</span>&nbsp;<span class="op" id="6882525">!=</span>&nbsp;<span class="builtintype" id="6882528">nil</span>&nbsp;<span class="op" id="6882532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6882536">t</span><span class="op" id="6882537">.</span><span class="ident" id="6882538">Fatal</span><span class="op" id="6882543">(</span><span class="ident" id="6882544">err</span><span class="op" id="6882547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6882550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6882554">enc</span>&nbsp;<span class="op" id="6882558">:=</span>&nbsp;<span class="ident" id="6882561">es</span><span class="op" id="6882563">.</span><span class="ident" id="6882564">Buffer</span><span class="op" id="6882570">.</span><span class="ident" id="6882571">String</span><span class="op" id="6882577">(</span><span class="op" id="6882578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6882581">encBytes</span>&nbsp;<span class="op" id="6882590">:=</span>&nbsp;<span class="ident" id="6882593">esBytes</span><span class="op" id="6882600">.</span><span class="ident" id="6882601">Buffer</span><span class="op" id="6882607">.</span><span class="ident" id="6882608">String</span><span class="op" id="6882614">(</span><span class="op" id="6882615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6882618">if</span>&nbsp;<span class="ident" id="6882621">enc</span>&nbsp;<span class="op" id="6882625">!=</span>&nbsp;<span class="ident" id="6882628">encBytes</span>&nbsp;<span class="op" id="6882637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6882641">i</span>&nbsp;<span class="op" id="6882643">:=</span>&nbsp;<span class="num" id="6882646">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6882650">for</span>&nbsp;<span class="ident" id="6882654">i</span>&nbsp;<span class="op" id="6882656">&lt;</span>&nbsp;<span class="builtinfunc" id="6882658">len</span><span class="op" id="6882661">(</span><span class="ident" id="6882662">enc</span><span class="op" id="6882665">)</span>&nbsp;<span class="op" id="6882667">&amp;&amp;</span>&nbsp;<span class="ident" id="6882670">i</span>&nbsp;<span class="op" id="6882672">&lt;</span>&nbsp;<span class="builtinfunc" id="6882674">len</span><span class="op" id="6882677">(</span><span class="ident" id="6882678">encBytes</span><span class="op" id="6882686">)</span>&nbsp;<span class="op" id="6882688">&amp;&amp;</span>&nbsp;<span class="ident" id="6882691">enc</span><span class="op" id="6882694">[</span><span class="ident" id="6882695">i</span><span class="op" id="6882696">]</span>&nbsp;<span class="op" id="6882698">==</span>&nbsp;<span class="ident" id="6882701">encBytes</span><span class="op" id="6882709">[</span><span class="ident" id="6882710">i</span><span class="op" id="6882711">]</span>&nbsp;<span class="op" id="6882713">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6882718">i</span><span class="op" id="6882719">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6882724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6882728">enc</span>&nbsp;<span class="op" id="6882732">=</span>&nbsp;<span class="ident" id="6882734">enc</span><span class="op" id="6882737">[</span><span class="ident" id="6882738">i</span><span class="op" id="6882739">:</span><span class="op" id="6882740">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6882744">encBytes</span>&nbsp;<span class="op" id="6882753">=</span>&nbsp;<span class="ident" id="6882755">encBytes</span><span class="op" id="6882763">[</span><span class="ident" id="6882764">i</span><span class="op" id="6882765">:</span><span class="op" id="6882766">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6882770">i</span>&nbsp;<span class="op" id="6882772">=</span>&nbsp;<span class="num" id="6882774">0</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6882778">for</span>&nbsp;<span class="ident" id="6882782">i</span>&nbsp;<span class="op" id="6882784">&lt;</span>&nbsp;<span class="builtinfunc" id="6882786">len</span><span class="op" id="6882789">(</span><span class="ident" id="6882790">enc</span><span class="op" id="6882793">)</span>&nbsp;<span class="op" id="6882795">&amp;&amp;</span>&nbsp;<span class="ident" id="6882798">i</span>&nbsp;<span class="op" id="6882800">&lt;</span>&nbsp;<span class="builtinfunc" id="6882802">len</span><span class="op" id="6882805">(</span><span class="ident" id="6882806">encBytes</span><span class="op" id="6882814">)</span>&nbsp;<span class="op" id="6882816">&amp;&amp;</span>&nbsp;<span class="ident" id="6882819">enc</span><span class="op" id="6882822">[</span><span class="builtinfunc" id="6882823">len</span><span class="op" id="6882826">(</span><span class="ident" id="6882827">enc</span><span class="op" id="6882830">)</span><span class="op" id="6882831">-</span><span class="ident" id="6882832">i</span><span class="op" id="6882833">-</span><span class="num" id="6882834">1</span><span class="op" id="6882835">]</span>&nbsp;<span class="op" id="6882837">==</span>&nbsp;<span class="ident" id="6882840">encBytes</span><span class="op" id="6882848">[</span><span class="builtinfunc" id="6882849">len</span><span class="op" id="6882852">(</span><span class="ident" id="6882853">encBytes</span><span class="op" id="6882861">)</span><span class="op" id="6882862">-</span><span class="ident" id="6882863">i</span><span class="op" id="6882864">-</span><span class="num" id="6882865">1</span><span class="op" id="6882866">]</span>&nbsp;<span class="op" id="6882868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6882873">i</span><span class="op" id="6882874">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6882879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6882883">enc</span>&nbsp;<span class="op" id="6882887">=</span>&nbsp;<span class="ident" id="6882889">enc</span><span class="op" id="6882892">[</span><span class="op" id="6882893">:</span><span class="builtinfunc" id="6882894">len</span><span class="op" id="6882897">(</span><span class="ident" id="6882898">enc</span><span class="op" id="6882901">)</span><span class="op" id="6882902">-</span><span class="ident" id="6882903">i</span><span class="op" id="6882904">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6882908">encBytes</span>&nbsp;<span class="op" id="6882917">=</span>&nbsp;<span class="ident" id="6882919">encBytes</span><span class="op" id="6882927">[</span><span class="op" id="6882928">:</span><span class="builtinfunc" id="6882929">len</span><span class="op" id="6882932">(</span><span class="ident" id="6882933">encBytes</span><span class="op" id="6882941">)</span><span class="op" id="6882942">-</span><span class="ident" id="6882943">i</span><span class="op" id="6882944">]</span><br>
<span class="lineno">410</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6882949">if</span>&nbsp;<span class="builtinfunc" id="6882952">len</span><span class="op" id="6882955">(</span><span class="ident" id="6882956">enc</span><span class="op" id="6882959">)</span>&nbsp;<span class="op" id="6882961">&gt;</span>&nbsp;<span class="num" id="6882963">20</span>&nbsp;<span class="op" id="6882966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6882971">enc</span>&nbsp;<span class="op" id="6882975">=</span>&nbsp;<span class="ident" id="6882977">enc</span><span class="op" id="6882980">[</span><span class="op" id="6882981">:</span><span class="num" id="6882982">20</span><span class="op" id="6882984">]</span>&nbsp;<span class="op" id="6882986">+</span>&nbsp;<span class="string" id="6882988">&#34;...&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6882996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6883000">if</span>&nbsp;<span class="builtinfunc" id="6883003">len</span><span class="op" id="6883006">(</span><span class="ident" id="6883007">encBytes</span><span class="op" id="6883015">)</span>&nbsp;<span class="op" id="6883017">&gt;</span>&nbsp;<span class="num" id="6883019">20</span>&nbsp;<span class="op" id="6883022">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6883027">encBytes</span>&nbsp;<span class="op" id="6883036">=</span>&nbsp;<span class="ident" id="6883038">encBytes</span><span class="op" id="6883046">[</span><span class="op" id="6883047">:</span><span class="num" id="6883048">20</span><span class="op" id="6883050">]</span>&nbsp;<span class="op" id="6883052">+</span>&nbsp;<span class="string" id="6883054">&#34;...&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6883062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6883067">t</span><span class="op" id="6883068">.</span><span class="ident" id="6883069">Errorf</span><span class="op" id="6883075">(</span><span class="string" id="6883076">&#34;encodings&nbsp;differ&nbsp;at&nbsp;%#q&nbsp;vs&nbsp;%#q&#34;</span><span class="op" id="6883108">,</span>&nbsp;<span class="ident" id="6883110">enc</span><span class="op" id="6883113">,</span>&nbsp;<span class="ident" id="6883115">encBytes</span><span class="op" id="6883123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6883126">}</span><br>
<span class="lineno">420</span><span class="op" id="6883128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6883131">func</span>&nbsp;<span class="ident" id="6883136">TestIssue6458</span><span class="op" id="6883149">(</span><span class="ident" id="6883150">t</span>&nbsp;<span class="op" id="6883152">*</span><span class="ident" id="6883153">testing</span><span class="op" id="6883160">.</span><span class="ident" id="6883161">T</span><span class="op" id="6883162">)</span>&nbsp;<span class="op" id="6883164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6883167">type</span>&nbsp;<span class="ident" id="6883172">Foo</span>&nbsp;<span class="keyword" id="6883176">struct</span>&nbsp;<span class="op" id="6883183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6883187">M</span>&nbsp;<span class="ident" id="6883189">RawMessage</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6883201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6883204">x</span>&nbsp;<span class="op" id="6883206">:=</span>&nbsp;<span class="ident" id="6883209">Foo</span><span class="op" id="6883212">{</span><span class="ident" id="6883213">RawMessage</span><span class="op" id="6883223">(</span><span class="string" id="6883224">`&#34;foo&#34;`</span><span class="op" id="6883231">)</span><span class="op" id="6883232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6883236">b</span><span class="op" id="6883237">,</span>&nbsp;<span class="ident" id="6883239">err</span>&nbsp;<span class="op" id="6883243">:=</span>&nbsp;<span class="ident" id="6883246">Marshal</span><span class="op" id="6883253">(</span><span class="op" id="6883254">&amp;</span><span class="ident" id="6883255">x</span><span class="op" id="6883256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6883259">if</span>&nbsp;<span class="ident" id="6883262">err</span>&nbsp;<span class="op" id="6883266">!=</span>&nbsp;<span class="builtintype" id="6883269">nil</span>&nbsp;<span class="op" id="6883273">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6883277">t</span><span class="op" id="6883278">.</span><span class="ident" id="6883279">Fatal</span><span class="op" id="6883284">(</span><span class="ident" id="6883285">err</span><span class="op" id="6883288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6883291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6883294">if</span>&nbsp;<span class="ident" id="6883297">want</span>&nbsp;<span class="op" id="6883302">:=</span>&nbsp;<span class="string" id="6883305">`{&#34;M&#34;:&#34;foo&#34;}`</span><span class="op" id="6883318">;</span>&nbsp;<span class="builtintype" id="6883320">string</span><span class="op" id="6883326">(</span><span class="ident" id="6883327">b</span><span class="op" id="6883328">)</span>&nbsp;<span class="op" id="6883330">!=</span>&nbsp;<span class="ident" id="6883333">want</span>&nbsp;<span class="op" id="6883338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6883342">t</span><span class="op" id="6883343">.</span><span class="ident" id="6883344">Errorf</span><span class="op" id="6883350">(</span><span class="string" id="6883351">&#34;Marshal(&amp;x)&nbsp;=&nbsp;%#q;&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="6883380">,</span>&nbsp;<span class="ident" id="6883382">b</span><span class="op" id="6883383">,</span>&nbsp;<span class="ident" id="6883385">want</span><span class="op" id="6883389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6883392">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6883396">b</span><span class="op" id="6883397">,</span>&nbsp;<span class="ident" id="6883399">err</span>&nbsp;<span class="op" id="6883403">=</span>&nbsp;<span class="ident" id="6883405">Marshal</span><span class="op" id="6883412">(</span><span class="ident" id="6883413">x</span><span class="op" id="6883414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6883417">if</span>&nbsp;<span class="ident" id="6883420">err</span>&nbsp;<span class="op" id="6883424">!=</span>&nbsp;<span class="builtintype" id="6883427">nil</span>&nbsp;<span class="op" id="6883431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6883435">t</span><span class="op" id="6883436">.</span><span class="ident" id="6883437">Fatal</span><span class="op" id="6883442">(</span><span class="ident" id="6883443">err</span><span class="op" id="6883446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6883449">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6883453">if</span>&nbsp;<span class="ident" id="6883456">want</span>&nbsp;<span class="op" id="6883461">:=</span>&nbsp;<span class="string" id="6883464">`{&#34;M&#34;:&#34;ImZvbyI=&#34;}`</span><span class="op" id="6883482">;</span>&nbsp;<span class="builtintype" id="6883484">string</span><span class="op" id="6883490">(</span><span class="ident" id="6883491">b</span><span class="op" id="6883492">)</span>&nbsp;<span class="op" id="6883494">!=</span>&nbsp;<span class="ident" id="6883497">want</span>&nbsp;<span class="op" id="6883502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6883506">t</span><span class="op" id="6883507">.</span><span class="ident" id="6883508">Errorf</span><span class="op" id="6883514">(</span><span class="string" id="6883515">&#34;Marshal(x)&nbsp;=&nbsp;%#q;&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="6883543">,</span>&nbsp;<span class="ident" id="6883545">b</span><span class="op" id="6883546">,</span>&nbsp;<span class="ident" id="6883548">want</span><span class="op" id="6883552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6883555">}</span><br>
<span class="lineno"></span><span class="op" id="6883557">}</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span><span class="keyword" id="6883560">func</span>&nbsp;<span class="ident" id="6883565">TestHTMLEscape</span><span class="op" id="6883579">(</span><span class="ident" id="6883580">t</span>&nbsp;<span class="op" id="6883582">*</span><span class="ident" id="6883583">testing</span><span class="op" id="6883590">.</span><span class="ident" id="6883591">T</span><span class="op" id="6883592">)</span>&nbsp;<span class="op" id="6883594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6883597">var</span>&nbsp;<span class="ident" id="6883601">b</span><span class="op" id="6883602">,</span>&nbsp;<span class="ident" id="6883604">want</span>&nbsp;<span class="ident" id="6883609">bytes</span><span class="op" id="6883614">.</span><span class="ident" id="6883615">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6883623">m</span>&nbsp;<span class="op" id="6883625">:=</span>&nbsp;<span class="string" id="6883628">`{&#34;M&#34;:&#34;&lt;html&gt;foo&nbsp;&amp;`</span>&nbsp;<span class="op" id="6883648">+</span>&nbsp;<span class="string" id="6883650">&#34;\xe2\x80\xa8&nbsp;\xe2\x80\xa9&#34;</span>&nbsp;<span class="op" id="6883678">+</span>&nbsp;<span class="string" id="6883680">`&lt;/html&gt;&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6883693">want</span><span class="op" id="6883697">.</span><span class="ident" id="6883698">Write</span><span class="op" id="6883703">(</span><span class="op" id="6883704">[</span><span class="op" id="6883705">]</span><span class="builtintype" id="6883706">byte</span><span class="op" id="6883710">(</span><span class="string" id="6883711">`{&#34;M&#34;:&#34;\u003chtml\u003efoo&nbsp;\u0026\u2028&nbsp;\u2029\u003c/html\u003e&#34;}`</span><span class="op" id="6883777">)</span><span class="op" id="6883778">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6883781">HTMLEscape</span><span class="op" id="6883791">(</span><span class="op" id="6883792">&amp;</span><span class="ident" id="6883793">b</span><span class="op" id="6883794">,</span>&nbsp;<span class="op" id="6883796">[</span><span class="op" id="6883797">]</span><span class="builtintype" id="6883798">byte</span><span class="op" id="6883802">(</span><span class="ident" id="6883803">m</span><span class="op" id="6883804">)</span><span class="op" id="6883805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6883808">if</span>&nbsp;<span class="op" id="6883811">!</span><span class="ident" id="6883812">bytes</span><span class="op" id="6883817">.</span><span class="ident" id="6883818">Equal</span><span class="op" id="6883823">(</span><span class="ident" id="6883824">b</span><span class="op" id="6883825">.</span><span class="ident" id="6883826">Bytes</span><span class="op" id="6883831">(</span><span class="op" id="6883832">)</span><span class="op" id="6883833">,</span>&nbsp;<span class="ident" id="6883835">want</span><span class="op" id="6883839">.</span><span class="ident" id="6883840">Bytes</span><span class="op" id="6883845">(</span><span class="op" id="6883846">)</span><span class="op" id="6883847">)</span>&nbsp;<span class="op" id="6883849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6883853">t</span><span class="op" id="6883854">.</span><span class="ident" id="6883855">Errorf</span><span class="op" id="6883861">(</span><span class="string" id="6883862">&#34;HTMLEscape(&amp;b,&nbsp;[]byte(m))&nbsp;=&nbsp;%s;&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6883903">,</span>&nbsp;<span class="ident" id="6883905">b</span><span class="op" id="6883906">.</span><span class="ident" id="6883907">Bytes</span><span class="op" id="6883912">(</span><span class="op" id="6883913">)</span><span class="op" id="6883914">,</span>&nbsp;<span class="ident" id="6883916">want</span><span class="op" id="6883920">.</span><span class="ident" id="6883921">Bytes</span><span class="op" id="6883926">(</span><span class="op" id="6883927">)</span><span class="op" id="6883928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6883931">}</span><br>
<span class="lineno"></span><span class="op" id="6883933">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="comment" id="6883936">//&nbsp;golang.org/issue/8582</span><br>
<span class="lineno"></span><span class="keyword" id="6883961">func</span>&nbsp;<span class="ident" id="6883966">TestEncodePointerString</span><span class="op" id="6883989">(</span><span class="ident" id="6883990">t</span>&nbsp;<span class="op" id="6883992">*</span><span class="ident" id="6883993">testing</span><span class="op" id="6884000">.</span><span class="ident" id="6884001">T</span><span class="op" id="6884002">)</span>&nbsp;<span class="op" id="6884004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6884007">type</span>&nbsp;<span class="ident" id="6884012">stringPointer</span>&nbsp;<span class="keyword" id="6884026">struct</span>&nbsp;<span class="op" id="6884033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6884037">N</span>&nbsp;<span class="op" id="6884039">*</span><span class="ident" id="6884040">int64</span>&nbsp;<span class="string" id="6884046">`json:&#34;n,string&#34;`</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6884065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6884068">var</span>&nbsp;<span class="ident" id="6884072">n</span>&nbsp;<span class="ident" id="6884074">int64</span>&nbsp;<span class="op" id="6884080">=</span>&nbsp;<span class="num" id="6884082">42</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6884086">b</span><span class="op" id="6884087">,</span>&nbsp;<span class="ident" id="6884089">err</span>&nbsp;<span class="op" id="6884093">:=</span>&nbsp;<span class="ident" id="6884096">Marshal</span><span class="op" id="6884103">(</span><span class="ident" id="6884104">stringPointer</span><span class="op" id="6884117">{</span><span class="ident" id="6884118">N</span><span class="op" id="6884119">:</span>&nbsp;<span class="op" id="6884121">&amp;</span><span class="ident" id="6884122">n</span><span class="op" id="6884123">}</span><span class="op" id="6884124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6884127">if</span>&nbsp;<span class="ident" id="6884130">err</span>&nbsp;<span class="op" id="6884134">!=</span>&nbsp;<span class="builtintype" id="6884137">nil</span>&nbsp;<span class="op" id="6884141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6884145">t</span><span class="op" id="6884146">.</span><span class="ident" id="6884147">Fatalf</span><span class="op" id="6884153">(</span><span class="string" id="6884154">&#34;Marshal:&nbsp;%v&#34;</span><span class="op" id="6884167">,</span>&nbsp;<span class="ident" id="6884169">err</span><span class="op" id="6884172">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6884175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6884178">if</span>&nbsp;<span class="ident" id="6884181">got</span><span class="op" id="6884184">,</span>&nbsp;<span class="ident" id="6884186">want</span>&nbsp;<span class="op" id="6884191">:=</span>&nbsp;<span class="builtintype" id="6884194">string</span><span class="op" id="6884200">(</span><span class="ident" id="6884201">b</span><span class="op" id="6884202">)</span><span class="op" id="6884203">,</span>&nbsp;<span class="string" id="6884205">`{&#34;n&#34;:&#34;42&#34;}`</span><span class="op" id="6884217">;</span>&nbsp;<span class="ident" id="6884219">got</span>&nbsp;<span class="op" id="6884223">!=</span>&nbsp;<span class="ident" id="6884226">want</span>&nbsp;<span class="op" id="6884231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6884235">t</span><span class="op" id="6884236">.</span><span class="ident" id="6884237">Errorf</span><span class="op" id="6884243">(</span><span class="string" id="6884244">&#34;Marshal&nbsp;=&nbsp;%s,&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6884267">,</span>&nbsp;<span class="ident" id="6884269">got</span><span class="op" id="6884272">,</span>&nbsp;<span class="ident" id="6884274">want</span><span class="op" id="6884278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6884281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6884284">var</span>&nbsp;<span class="ident" id="6884288">back</span>&nbsp;<span class="ident" id="6884293">stringPointer</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6884308">err</span>&nbsp;<span class="op" id="6884312">=</span>&nbsp;<span class="ident" id="6884314">Unmarshal</span><span class="op" id="6884323">(</span><span class="ident" id="6884324">b</span><span class="op" id="6884325">,</span>&nbsp;<span class="op" id="6884327">&amp;</span><span class="ident" id="6884328">back</span><span class="op" id="6884332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6884335">if</span>&nbsp;<span class="ident" id="6884338">err</span>&nbsp;<span class="op" id="6884342">!=</span>&nbsp;<span class="builtintype" id="6884345">nil</span>&nbsp;<span class="op" id="6884349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6884353">t</span><span class="op" id="6884354">.</span><span class="ident" id="6884355">Fatalf</span><span class="op" id="6884361">(</span><span class="string" id="6884362">&#34;Unmarshal:&nbsp;%v&#34;</span><span class="op" id="6884377">,</span>&nbsp;<span class="ident" id="6884379">err</span><span class="op" id="6884382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6884385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6884388">if</span>&nbsp;<span class="ident" id="6884391">back</span><span class="op" id="6884395">.</span><span class="ident" id="6884396">N</span>&nbsp;<span class="op" id="6884398">==</span>&nbsp;<span class="builtintype" id="6884401">nil</span>&nbsp;<span class="op" id="6884405">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6884409">t</span><span class="op" id="6884410">.</span><span class="ident" id="6884411">Fatalf</span><span class="op" id="6884417">(</span><span class="string" id="6884418">&#34;Unmarshalled&nbsp;nil&nbsp;N&nbsp;field&#34;</span><span class="op" id="6884444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6884447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6884450">if</span>&nbsp;<span class="op" id="6884453">*</span><span class="ident" id="6884454">back</span><span class="op" id="6884458">.</span><span class="ident" id="6884459">N</span>&nbsp;<span class="op" id="6884461">!=</span>&nbsp;<span class="num" id="6884464">42</span>&nbsp;<span class="op" id="6884467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6884471">t</span><span class="op" id="6884472">.</span><span class="ident" id="6884473">Fatalf</span><span class="op" id="6884479">(</span><span class="string" id="6884480">&#34;*N&nbsp;=&nbsp;%d;&nbsp;want&nbsp;42&#34;</span><span class="op" id="6884498">,</span>&nbsp;<span class="op" id="6884500">*</span><span class="ident" id="6884501">back</span><span class="op" id="6884505">.</span><span class="ident" id="6884506">N</span><span class="op" id="6884507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6884510">}</span><br>
<span class="lineno">480</span><span class="op" id="6884512">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6884515">var</span>&nbsp;<span class="ident" id="6884519">encodeStringTests</span>&nbsp;<span class="op" id="6884537">=</span>&nbsp;<span class="op" id="6884539">[</span><span class="op" id="6884540">]</span><span class="keyword" id="6884541">struct</span>&nbsp;<span class="op" id="6884548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6884551">in</span>&nbsp;&nbsp;<span class="builtintype" id="6884555">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6884563">out</span>&nbsp;<span class="builtintype" id="6884567">string</span><br>
<span class="lineno">485</span><span class="op" id="6884574">}</span><span class="op" id="6884575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6884578">{</span><span class="string" id="6884579">&#34;\x00&#34;</span><span class="op" id="6884585">,</span>&nbsp;<span class="string" id="6884587">`&#34;\u0000&#34;`</span><span class="op" id="6884597">}</span><span class="op" id="6884598">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6884601">{</span><span class="string" id="6884602">&#34;\x01&#34;</span><span class="op" id="6884608">,</span>&nbsp;<span class="string" id="6884610">`&#34;\u0001&#34;`</span><span class="op" id="6884620">}</span><span class="op" id="6884621">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6884624">{</span><span class="string" id="6884625">&#34;\x02&#34;</span><span class="op" id="6884631">,</span>&nbsp;<span class="string" id="6884633">`&#34;\u0002&#34;`</span><span class="op" id="6884643">}</span><span class="op" id="6884644">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6884647">{</span><span class="string" id="6884648">&#34;\x03&#34;</span><span class="op" id="6884654">,</span>&nbsp;<span class="string" id="6884656">`&#34;\u0003&#34;`</span><span class="op" id="6884666">}</span><span class="op" id="6884667">,</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6884670">{</span><span class="string" id="6884671">&#34;\x04&#34;</span><span class="op" id="6884677">,</span>&nbsp;<span class="string" id="6884679">`&#34;\u0004&#34;`</span><span class="op" id="6884689">}</span><span class="op" id="6884690">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6884693">{</span><span class="string" id="6884694">&#34;\x05&#34;</span><span class="op" id="6884700">,</span>&nbsp;<span class="string" id="6884702">`&#34;\u0005&#34;`</span><span class="op" id="6884712">}</span><span class="op" id="6884713">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6884716">{</span><span class="string" id="6884717">&#34;\x06&#34;</span><span class="op" id="6884723">,</span>&nbsp;<span class="string" id="6884725">`&#34;\u0006&#34;`</span><span class="op" id="6884735">}</span><span class="op" id="6884736">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6884739">{</span><span class="string" id="6884740">&#34;\x07&#34;</span><span class="op" id="6884746">,</span>&nbsp;<span class="string" id="6884748">`&#34;\u0007&#34;`</span><span class="op" id="6884758">}</span><span class="op" id="6884759">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6884762">{</span><span class="string" id="6884763">&#34;\x08&#34;</span><span class="op" id="6884769">,</span>&nbsp;<span class="string" id="6884771">`&#34;\u0008&#34;`</span><span class="op" id="6884781">}</span><span class="op" id="6884782">,</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6884785">{</span><span class="string" id="6884786">&#34;\x09&#34;</span><span class="op" id="6884792">,</span>&nbsp;<span class="string" id="6884794">`&#34;\t&#34;`</span><span class="op" id="6884800">}</span><span class="op" id="6884801">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6884804">{</span><span class="string" id="6884805">&#34;\x0a&#34;</span><span class="op" id="6884811">,</span>&nbsp;<span class="string" id="6884813">`&#34;\n&#34;`</span><span class="op" id="6884819">}</span><span class="op" id="6884820">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6884823">{</span><span class="string" id="6884824">&#34;\x0b&#34;</span><span class="op" id="6884830">,</span>&nbsp;<span class="string" id="6884832">`&#34;\u000b&#34;`</span><span class="op" id="6884842">}</span><span class="op" id="6884843">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6884846">{</span><span class="string" id="6884847">&#34;\x0c&#34;</span><span class="op" id="6884853">,</span>&nbsp;<span class="string" id="6884855">`&#34;\u000c&#34;`</span><span class="op" id="6884865">}</span><span class="op" id="6884866">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6884869">{</span><span class="string" id="6884870">&#34;\x0d&#34;</span><span class="op" id="6884876">,</span>&nbsp;<span class="string" id="6884878">`&#34;\r&#34;`</span><span class="op" id="6884884">}</span><span class="op" id="6884885">,</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6884888">{</span><span class="string" id="6884889">&#34;\x0e&#34;</span><span class="op" id="6884895">,</span>&nbsp;<span class="string" id="6884897">`&#34;\u000e&#34;`</span><span class="op" id="6884907">}</span><span class="op" id="6884908">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6884911">{</span><span class="string" id="6884912">&#34;\x0f&#34;</span><span class="op" id="6884918">,</span>&nbsp;<span class="string" id="6884920">`&#34;\u000f&#34;`</span><span class="op" id="6884930">}</span><span class="op" id="6884931">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6884934">{</span><span class="string" id="6884935">&#34;\x10&#34;</span><span class="op" id="6884941">,</span>&nbsp;<span class="string" id="6884943">`&#34;\u0010&#34;`</span><span class="op" id="6884953">}</span><span class="op" id="6884954">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6884957">{</span><span class="string" id="6884958">&#34;\x11&#34;</span><span class="op" id="6884964">,</span>&nbsp;<span class="string" id="6884966">`&#34;\u0011&#34;`</span><span class="op" id="6884976">}</span><span class="op" id="6884977">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6884980">{</span><span class="string" id="6884981">&#34;\x12&#34;</span><span class="op" id="6884987">,</span>&nbsp;<span class="string" id="6884989">`&#34;\u0012&#34;`</span><span class="op" id="6884999">}</span><span class="op" id="6885000">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6885003">{</span><span class="string" id="6885004">&#34;\x13&#34;</span><span class="op" id="6885010">,</span>&nbsp;<span class="string" id="6885012">`&#34;\u0013&#34;`</span><span class="op" id="6885022">}</span><span class="op" id="6885023">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6885026">{</span><span class="string" id="6885027">&#34;\x14&#34;</span><span class="op" id="6885033">,</span>&nbsp;<span class="string" id="6885035">`&#34;\u0014&#34;`</span><span class="op" id="6885045">}</span><span class="op" id="6885046">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6885049">{</span><span class="string" id="6885050">&#34;\x15&#34;</span><span class="op" id="6885056">,</span>&nbsp;<span class="string" id="6885058">`&#34;\u0015&#34;`</span><span class="op" id="6885068">}</span><span class="op" id="6885069">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6885072">{</span><span class="string" id="6885073">&#34;\x16&#34;</span><span class="op" id="6885079">,</span>&nbsp;<span class="string" id="6885081">`&#34;\u0016&#34;`</span><span class="op" id="6885091">}</span><span class="op" id="6885092">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6885095">{</span><span class="string" id="6885096">&#34;\x17&#34;</span><span class="op" id="6885102">,</span>&nbsp;<span class="string" id="6885104">`&#34;\u0017&#34;`</span><span class="op" id="6885114">}</span><span class="op" id="6885115">,</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6885118">{</span><span class="string" id="6885119">&#34;\x18&#34;</span><span class="op" id="6885125">,</span>&nbsp;<span class="string" id="6885127">`&#34;\u0018&#34;`</span><span class="op" id="6885137">}</span><span class="op" id="6885138">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6885141">{</span><span class="string" id="6885142">&#34;\x19&#34;</span><span class="op" id="6885148">,</span>&nbsp;<span class="string" id="6885150">`&#34;\u0019&#34;`</span><span class="op" id="6885160">}</span><span class="op" id="6885161">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6885164">{</span><span class="string" id="6885165">&#34;\x1a&#34;</span><span class="op" id="6885171">,</span>&nbsp;<span class="string" id="6885173">`&#34;\u001a&#34;`</span><span class="op" id="6885183">}</span><span class="op" id="6885184">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6885187">{</span><span class="string" id="6885188">&#34;\x1b&#34;</span><span class="op" id="6885194">,</span>&nbsp;<span class="string" id="6885196">`&#34;\u001b&#34;`</span><span class="op" id="6885206">}</span><span class="op" id="6885207">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6885210">{</span><span class="string" id="6885211">&#34;\x1c&#34;</span><span class="op" id="6885217">,</span>&nbsp;<span class="string" id="6885219">`&#34;\u001c&#34;`</span><span class="op" id="6885229">}</span><span class="op" id="6885230">,</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6885233">{</span><span class="string" id="6885234">&#34;\x1d&#34;</span><span class="op" id="6885240">,</span>&nbsp;<span class="string" id="6885242">`&#34;\u001d&#34;`</span><span class="op" id="6885252">}</span><span class="op" id="6885253">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6885256">{</span><span class="string" id="6885257">&#34;\x1e&#34;</span><span class="op" id="6885263">,</span>&nbsp;<span class="string" id="6885265">`&#34;\u001e&#34;`</span><span class="op" id="6885275">}</span><span class="op" id="6885276">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6885279">{</span><span class="string" id="6885280">&#34;\x1f&#34;</span><span class="op" id="6885286">,</span>&nbsp;<span class="string" id="6885288">`&#34;\u001f&#34;`</span><span class="op" id="6885298">}</span><span class="op" id="6885299">,</span><br>
<span class="lineno"></span><span class="op" id="6885301">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">520</span><span class="keyword" id="6885304">func</span>&nbsp;<span class="ident" id="6885309">TestEncodeString</span><span class="op" id="6885325">(</span><span class="ident" id="6885326">t</span>&nbsp;<span class="op" id="6885328">*</span><span class="ident" id="6885329">testing</span><span class="op" id="6885336">.</span><span class="ident" id="6885337">T</span><span class="op" id="6885338">)</span>&nbsp;<span class="op" id="6885340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6885343">for</span>&nbsp;<span class="ident" id="6885347">_</span><span class="op" id="6885348">,</span>&nbsp;<span class="ident" id="6885350">tt</span>&nbsp;<span class="op" id="6885353">:=</span>&nbsp;<span class="keyword" id="6885356">range</span>&nbsp;<span class="ident" id="6885362">encodeStringTests</span>&nbsp;<span class="op" id="6885380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6885384">b</span><span class="op" id="6885385">,</span>&nbsp;<span class="ident" id="6885387">err</span>&nbsp;<span class="op" id="6885391">:=</span>&nbsp;<span class="ident" id="6885394">Marshal</span><span class="op" id="6885401">(</span><span class="ident" id="6885402">tt</span><span class="op" id="6885404">.</span><span class="ident" id="6885405">in</span><span class="op" id="6885407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6885411">if</span>&nbsp;<span class="ident" id="6885414">err</span>&nbsp;<span class="op" id="6885418">!=</span>&nbsp;<span class="builtintype" id="6885421">nil</span>&nbsp;<span class="op" id="6885425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6885430">t</span><span class="op" id="6885431">.</span><span class="ident" id="6885432">Errorf</span><span class="op" id="6885438">(</span><span class="string" id="6885439">&#34;Marshal(%q):&nbsp;%v&#34;</span><span class="op" id="6885456">,</span>&nbsp;<span class="ident" id="6885458">tt</span><span class="op" id="6885460">.</span><span class="ident" id="6885461">in</span><span class="op" id="6885463">,</span>&nbsp;<span class="ident" id="6885465">err</span><span class="op" id="6885468">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6885473">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6885484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6885488">out</span>&nbsp;<span class="op" id="6885492">:=</span>&nbsp;<span class="builtintype" id="6885495">string</span><span class="op" id="6885501">(</span><span class="ident" id="6885502">b</span><span class="op" id="6885503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6885507">if</span>&nbsp;<span class="ident" id="6885510">out</span>&nbsp;<span class="op" id="6885514">!=</span>&nbsp;<span class="ident" id="6885517">tt</span><span class="op" id="6885519">.</span><span class="ident" id="6885520">out</span>&nbsp;<span class="op" id="6885524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6885529">t</span><span class="op" id="6885530">.</span><span class="ident" id="6885531">Errorf</span><span class="op" id="6885537">(</span><span class="string" id="6885538">&#34;Marshal(%q)&nbsp;=&nbsp;%#q,&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="6885567">,</span>&nbsp;<span class="ident" id="6885569">tt</span><span class="op" id="6885571">.</span><span class="ident" id="6885572">in</span><span class="op" id="6885574">,</span>&nbsp;<span class="ident" id="6885576">out</span><span class="op" id="6885579">,</span>&nbsp;<span class="ident" id="6885581">tt</span><span class="op" id="6885583">.</span><span class="ident" id="6885584">out</span><span class="op" id="6885587">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6885591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6885594">}</span><br>
<span class="lineno"></span><span class="op" id="6885596">}</span>
</div>
</body>
</html>
