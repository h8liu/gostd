<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3559411">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3559467">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3559521">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3559572">package</span>&nbsp;<span class="ident" id="3559580">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3559585">import</span>&nbsp;<span class="op" id="3559592">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3559595">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3559605">&#34;time&#34;</span><br>
<span class="lineno">10</span><span class="op" id="3559612">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3559615">//&nbsp;A&nbsp;Dialer&nbsp;contains&nbsp;options&nbsp;for&nbsp;connecting&nbsp;to&nbsp;an&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="3559674">//</span><br>
<span class="lineno"></span><span class="comment" id="3559677">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;each&nbsp;field&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;dialing</span><br>
<span class="lineno">15</span><span class="comment" id="3559735">//&nbsp;without&nbsp;that&nbsp;option.&nbsp;Dialing&nbsp;with&nbsp;the&nbsp;zero&nbsp;value&nbsp;of&nbsp;Dialer</span><br>
<span class="lineno"></span><span class="comment" id="3559797">//&nbsp;is&nbsp;therefore&nbsp;equivalent&nbsp;to&nbsp;just&nbsp;calling&nbsp;the&nbsp;Dial&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="3559859">type</span>&nbsp;<span class="ident" id="3559864">Dialer</span>&nbsp;<span class="keyword" id="3559871">struct</span>&nbsp;<span class="op" id="3559878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3559881">//&nbsp;Timeout&nbsp;is&nbsp;the&nbsp;maximum&nbsp;amount&nbsp;of&nbsp;time&nbsp;a&nbsp;dial&nbsp;will&nbsp;wait&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3559944">//&nbsp;a&nbsp;connect&nbsp;to&nbsp;complete.&nbsp;If&nbsp;Deadline&nbsp;is&nbsp;also&nbsp;set,&nbsp;it&nbsp;may&nbsp;fail</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3560008">//&nbsp;earlier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3560021">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3560025">//&nbsp;The&nbsp;default&nbsp;is&nbsp;no&nbsp;timeout.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3560056">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3560060">//&nbsp;With&nbsp;or&nbsp;without&nbsp;a&nbsp;timeout,&nbsp;the&nbsp;operating&nbsp;system&nbsp;may&nbsp;impose</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3560123">//&nbsp;its&nbsp;own&nbsp;earlier&nbsp;timeout.&nbsp;For&nbsp;instance,&nbsp;TCP&nbsp;timeouts&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3560183">//&nbsp;often&nbsp;around&nbsp;3&nbsp;minutes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3560211">Timeout</span>&nbsp;<span class="ident" id="3560219">time</span><span class="op" id="3560223">.</span><span class="ident" id="3560224">Duration</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3560235">//&nbsp;Deadline&nbsp;is&nbsp;the&nbsp;absolute&nbsp;point&nbsp;in&nbsp;time&nbsp;after&nbsp;which&nbsp;dials</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3560296">//&nbsp;will&nbsp;fail.&nbsp;If&nbsp;Timeout&nbsp;is&nbsp;set,&nbsp;it&nbsp;may&nbsp;fail&nbsp;earlier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3560351">//&nbsp;Zero&nbsp;means&nbsp;no&nbsp;deadline,&nbsp;or&nbsp;dependent&nbsp;on&nbsp;the&nbsp;operating&nbsp;system</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3560416">//&nbsp;as&nbsp;with&nbsp;the&nbsp;Timeout&nbsp;option.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3560448">Deadline</span>&nbsp;<span class="ident" id="3560457">time</span><span class="op" id="3560461">.</span><span class="ident" id="3560462">Time</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3560469">//&nbsp;LocalAddr&nbsp;is&nbsp;the&nbsp;local&nbsp;address&nbsp;to&nbsp;use&nbsp;when&nbsp;dialing&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3560527">//&nbsp;address.&nbsp;The&nbsp;address&nbsp;must&nbsp;be&nbsp;of&nbsp;a&nbsp;compatible&nbsp;type&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3560589">//&nbsp;network&nbsp;being&nbsp;dialed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3560615">//&nbsp;If&nbsp;nil,&nbsp;a&nbsp;local&nbsp;address&nbsp;is&nbsp;automatically&nbsp;chosen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3560668">LocalAddr</span>&nbsp;<span class="ident" id="3560678">Addr</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3560685">//&nbsp;DualStack&nbsp;allows&nbsp;a&nbsp;single&nbsp;dial&nbsp;to&nbsp;attempt&nbsp;to&nbsp;establish</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3560744">//&nbsp;multiple&nbsp;IPv4&nbsp;and&nbsp;IPv6&nbsp;connections&nbsp;and&nbsp;to&nbsp;return&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3560807">//&nbsp;established&nbsp;connection&nbsp;when&nbsp;the&nbsp;network&nbsp;is&nbsp;&#34;tcp&#34;&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3560868">//&nbsp;destination&nbsp;is&nbsp;a&nbsp;host&nbsp;name&nbsp;that&nbsp;has&nbsp;multiple&nbsp;address&nbsp;family</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3560932">//&nbsp;DNS&nbsp;records.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3560949">DualStack</span>&nbsp;<span class="builtintype" id="3560959">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3560966">//&nbsp;KeepAlive&nbsp;specifies&nbsp;the&nbsp;keep-alive&nbsp;period&nbsp;for&nbsp;an&nbsp;active</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3561026">//&nbsp;network&nbsp;connection.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3561050">//&nbsp;If&nbsp;zero,&nbsp;keep-alives&nbsp;are&nbsp;not&nbsp;enabled.&nbsp;Network&nbsp;protocols</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3561110">//&nbsp;that&nbsp;do&nbsp;not&nbsp;support&nbsp;keep-alives&nbsp;ignore&nbsp;this&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3561165">KeepAlive</span>&nbsp;<span class="ident" id="3561175">time</span><span class="op" id="3561179">.</span><span class="ident" id="3561180">Duration</span><br>
<span class="lineno"></span><span class="op" id="3561189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="3561192">//&nbsp;Return&nbsp;either&nbsp;now+Timeout&nbsp;or&nbsp;Deadline,&nbsp;whichever&nbsp;comes&nbsp;first.</span><br>
<span class="lineno"></span><span class="comment" id="3561257">//&nbsp;Or&nbsp;zero,&nbsp;if&nbsp;neither&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="3561288">func</span>&nbsp;<span class="op" id="3561293">(</span><span class="ident" id="3561294">d</span>&nbsp;<span class="op" id="3561296">*</span><span class="ident" id="3561297">Dialer</span><span class="op" id="3561303">)</span>&nbsp;<span class="ident" id="3561305">deadline</span><span class="op" id="3561313">(</span><span class="op" id="3561314">)</span>&nbsp;<span class="ident" id="3561316">time</span><span class="op" id="3561320">.</span><span class="ident" id="3561321">Time</span>&nbsp;<span class="op" id="3561326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561329">if</span>&nbsp;<span class="ident" id="3561332">d</span><span class="op" id="3561333">.</span><span class="ident" id="3561334">Timeout</span>&nbsp;<span class="op" id="3561342">==</span>&nbsp;<span class="num" id="3561345">0</span>&nbsp;<span class="op" id="3561347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561351">return</span>&nbsp;<span class="ident" id="3561358">d</span><span class="op" id="3561359">.</span><span class="ident" id="3561360">Deadline</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3561370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3561373">timeoutDeadline</span>&nbsp;<span class="op" id="3561389">:=</span>&nbsp;<span class="ident" id="3561392">time</span><span class="op" id="3561396">.</span><span class="ident" id="3561397">Now</span><span class="op" id="3561400">(</span><span class="op" id="3561401">)</span><span class="op" id="3561402">.</span><span class="ident" id="3561403">Add</span><span class="op" id="3561406">(</span><span class="ident" id="3561407">d</span><span class="op" id="3561408">.</span><span class="ident" id="3561409">Timeout</span><span class="op" id="3561416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561419">if</span>&nbsp;<span class="ident" id="3561422">d</span><span class="op" id="3561423">.</span><span class="ident" id="3561424">Deadline</span><span class="op" id="3561432">.</span><span class="ident" id="3561433">IsZero</span><span class="op" id="3561439">(</span><span class="op" id="3561440">)</span>&nbsp;<span class="op" id="3561442">||</span>&nbsp;<span class="ident" id="3561445">timeoutDeadline</span><span class="op" id="3561460">.</span><span class="ident" id="3561461">Before</span><span class="op" id="3561467">(</span><span class="ident" id="3561468">d</span><span class="op" id="3561469">.</span><span class="ident" id="3561470">Deadline</span><span class="op" id="3561478">)</span>&nbsp;<span class="op" id="3561480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561484">return</span>&nbsp;<span class="ident" id="3561491">timeoutDeadline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3561508">}</span>&nbsp;<span class="keyword" id="3561510">else</span>&nbsp;<span class="op" id="3561515">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561519">return</span>&nbsp;<span class="ident" id="3561526">d</span><span class="op" id="3561527">.</span><span class="ident" id="3561528">Deadline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3561538">}</span><br>
<span class="lineno"></span><span class="op" id="3561540">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3561543">func</span>&nbsp;<span class="ident" id="3561548">parseNetwork</span><span class="op" id="3561560">(</span><span class="ident" id="3561561">net</span>&nbsp;<span class="builtintype" id="3561565">string</span><span class="op" id="3561571">)</span>&nbsp;<span class="op" id="3561573">(</span><span class="ident" id="3561574">afnet</span>&nbsp;<span class="builtintype" id="3561580">string</span><span class="op" id="3561586">,</span>&nbsp;<span class="ident" id="3561588">proto</span>&nbsp;<span class="builtintype" id="3561594">int</span><span class="op" id="3561597">,</span>&nbsp;<span class="ident" id="3561599">err</span>&nbsp;<span class="builtintype" id="3561603">error</span><span class="op" id="3561608">)</span>&nbsp;<span class="op" id="3561610">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3561613">i</span>&nbsp;<span class="op" id="3561615">:=</span>&nbsp;<span class="ident" id="3561618">last</span><span class="op" id="3561622">(</span><span class="ident" id="3561623">net</span><span class="op" id="3561626">,</span>&nbsp;<span class="string" id="3561628">&#39;:&#39;</span><span class="op" id="3561631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561634">if</span>&nbsp;<span class="ident" id="3561637">i</span>&nbsp;<span class="op" id="3561639">&lt;</span>&nbsp;<span class="num" id="3561641">0</span>&nbsp;<span class="op" id="3561643">{</span>&nbsp;<span class="comment" id="3561645">//&nbsp;no&nbsp;colon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561659">switch</span>&nbsp;<span class="ident" id="3561666">net</span>&nbsp;<span class="op" id="3561670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561674">case</span>&nbsp;<span class="string" id="3561679">&#34;tcp&#34;</span><span class="op" id="3561684">,</span>&nbsp;<span class="string" id="3561686">&#34;tcp4&#34;</span><span class="op" id="3561692">,</span>&nbsp;<span class="string" id="3561694">&#34;tcp6&#34;</span><span class="op" id="3561700">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561704">case</span>&nbsp;<span class="string" id="3561709">&#34;udp&#34;</span><span class="op" id="3561714">,</span>&nbsp;<span class="string" id="3561716">&#34;udp4&#34;</span><span class="op" id="3561722">,</span>&nbsp;<span class="string" id="3561724">&#34;udp6&#34;</span><span class="op" id="3561730">:</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561734">case</span>&nbsp;<span class="string" id="3561739">&#34;ip&#34;</span><span class="op" id="3561743">,</span>&nbsp;<span class="string" id="3561745">&#34;ip4&#34;</span><span class="op" id="3561750">,</span>&nbsp;<span class="string" id="3561752">&#34;ip6&#34;</span><span class="op" id="3561757">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561761">case</span>&nbsp;<span class="string" id="3561766">&#34;unix&#34;</span><span class="op" id="3561772">,</span>&nbsp;<span class="string" id="3561774">&#34;unixgram&#34;</span><span class="op" id="3561784">,</span>&nbsp;<span class="string" id="3561786">&#34;unixpacket&#34;</span><span class="op" id="3561798">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561802">default</span><span class="op" id="3561809">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561814">return</span>&nbsp;<span class="string" id="3561821">&#34;&#34;</span><span class="op" id="3561823">,</span>&nbsp;<span class="num" id="3561825">0</span><span class="op" id="3561826">,</span>&nbsp;<span class="ident" id="3561828">UnknownNetworkError</span><span class="op" id="3561847">(</span><span class="ident" id="3561848">net</span><span class="op" id="3561851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3561855">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561859">return</span>&nbsp;<span class="ident" id="3561866">net</span><span class="op" id="3561869">,</span>&nbsp;<span class="num" id="3561871">0</span><span class="op" id="3561872">,</span>&nbsp;<span class="ident" id="3561874">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3561879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3561882">afnet</span>&nbsp;<span class="op" id="3561888">=</span>&nbsp;<span class="ident" id="3561890">net</span><span class="op" id="3561893">[</span><span class="op" id="3561894">:</span><span class="ident" id="3561895">i</span><span class="op" id="3561896">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561899">switch</span>&nbsp;<span class="ident" id="3561906">afnet</span>&nbsp;<span class="op" id="3561912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561915">case</span>&nbsp;<span class="string" id="3561920">&#34;ip&#34;</span><span class="op" id="3561924">,</span>&nbsp;<span class="string" id="3561926">&#34;ip4&#34;</span><span class="op" id="3561931">,</span>&nbsp;<span class="string" id="3561933">&#34;ip6&#34;</span><span class="op" id="3561938">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3561942">protostr</span>&nbsp;<span class="op" id="3561951">:=</span>&nbsp;<span class="ident" id="3561954">net</span><span class="op" id="3561957">[</span><span class="ident" id="3561958">i</span><span class="op" id="3561959">+</span><span class="num" id="3561960">1</span><span class="op" id="3561961">:</span><span class="op" id="3561962">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3561966">proto</span><span class="op" id="3561971">,</span>&nbsp;<span class="ident" id="3561973">i</span><span class="op" id="3561974">,</span>&nbsp;<span class="ident" id="3561976">ok</span>&nbsp;<span class="op" id="3561979">:=</span>&nbsp;<span class="ident" id="3561982">dtoi</span><span class="op" id="3561986">(</span><span class="ident" id="3561987">protostr</span><span class="op" id="3561995">,</span>&nbsp;<span class="num" id="3561997">0</span><span class="op" id="3561998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3562002">if</span>&nbsp;<span class="op" id="3562005">!</span><span class="ident" id="3562006">ok</span>&nbsp;<span class="op" id="3562009">||</span>&nbsp;<span class="ident" id="3562012">i</span>&nbsp;<span class="op" id="3562014">!=</span>&nbsp;<span class="builtinfunc" id="3562017">len</span><span class="op" id="3562020">(</span><span class="ident" id="3562021">protostr</span><span class="op" id="3562029">)</span>&nbsp;<span class="op" id="3562031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3562036">proto</span><span class="op" id="3562041">,</span>&nbsp;<span class="ident" id="3562043">err</span>&nbsp;<span class="op" id="3562047">=</span>&nbsp;<span class="ident" id="3562049">lookupProtocol</span><span class="op" id="3562063">(</span><span class="ident" id="3562064">protostr</span><span class="op" id="3562072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3562077">if</span>&nbsp;<span class="ident" id="3562080">err</span>&nbsp;<span class="op" id="3562084">!=</span>&nbsp;<span class="ident" id="3562087">nil</span>&nbsp;<span class="op" id="3562091">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3562097">return</span>&nbsp;<span class="string" id="3562104">&#34;&#34;</span><span class="op" id="3562106">,</span>&nbsp;<span class="num" id="3562108">0</span><span class="op" id="3562109">,</span>&nbsp;<span class="ident" id="3562111">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3562118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3562122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3562126">return</span>&nbsp;<span class="ident" id="3562133">afnet</span><span class="op" id="3562138">,</span>&nbsp;<span class="ident" id="3562140">proto</span><span class="op" id="3562145">,</span>&nbsp;<span class="ident" id="3562147">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3562152">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3562155">return</span>&nbsp;<span class="string" id="3562162">&#34;&#34;</span><span class="op" id="3562164">,</span>&nbsp;<span class="num" id="3562166">0</span><span class="op" id="3562167">,</span>&nbsp;<span class="ident" id="3562169">UnknownNetworkError</span><span class="op" id="3562188">(</span><span class="ident" id="3562189">net</span><span class="op" id="3562192">)</span><br>
<span class="lineno"></span><span class="op" id="3562194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3562197">func</span>&nbsp;<span class="ident" id="3562202">resolveAddr</span><span class="op" id="3562213">(</span><span class="ident" id="3562214">op</span><span class="op" id="3562216">,</span>&nbsp;<span class="ident" id="3562218">net</span><span class="op" id="3562221">,</span>&nbsp;<span class="ident" id="3562223">addr</span>&nbsp;<span class="builtintype" id="3562228">string</span><span class="op" id="3562234">,</span>&nbsp;<span class="ident" id="3562236">deadline</span>&nbsp;<span class="ident" id="3562245">time</span><span class="op" id="3562249">.</span><span class="ident" id="3562250">Time</span><span class="op" id="3562254">)</span>&nbsp;<span class="op" id="3562256">(</span><span class="ident" id="3562257">netaddr</span><span class="op" id="3562264">,</span>&nbsp;<span class="builtintype" id="3562266">error</span><span class="op" id="3562271">)</span>&nbsp;<span class="op" id="3562273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3562276">afnet</span><span class="op" id="3562281">,</span>&nbsp;<span class="ident" id="3562283">_</span><span class="op" id="3562284">,</span>&nbsp;<span class="ident" id="3562286">err</span>&nbsp;<span class="op" id="3562290">:=</span>&nbsp;<span class="ident" id="3562293">parseNetwork</span><span class="op" id="3562305">(</span><span class="ident" id="3562306">net</span><span class="op" id="3562309">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3562312">if</span>&nbsp;<span class="ident" id="3562315">err</span>&nbsp;<span class="op" id="3562319">!=</span>&nbsp;<span class="ident" id="3562322">nil</span>&nbsp;<span class="op" id="3562326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3562330">return</span>&nbsp;<span class="ident" id="3562337">nil</span><span class="op" id="3562340">,</span>&nbsp;<span class="ident" id="3562342">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3562347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3562350">if</span>&nbsp;<span class="ident" id="3562353">op</span>&nbsp;<span class="op" id="3562356">==</span>&nbsp;<span class="string" id="3562359">&#34;dial&#34;</span>&nbsp;<span class="op" id="3562366">&amp;&amp;</span>&nbsp;<span class="ident" id="3562369">addr</span>&nbsp;<span class="op" id="3562374">==</span>&nbsp;<span class="string" id="3562377">&#34;&#34;</span>&nbsp;<span class="op" id="3562380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3562384">return</span>&nbsp;<span class="ident" id="3562391">nil</span><span class="op" id="3562394">,</span>&nbsp;<span class="ident" id="3562396">errMissingAddress</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3562415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3562418">switch</span>&nbsp;<span class="ident" id="3562425">afnet</span>&nbsp;<span class="op" id="3562431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3562434">case</span>&nbsp;<span class="string" id="3562439">&#34;unix&#34;</span><span class="op" id="3562445">,</span>&nbsp;<span class="string" id="3562447">&#34;unixgram&#34;</span><span class="op" id="3562457">,</span>&nbsp;<span class="string" id="3562459">&#34;unixpacket&#34;</span><span class="op" id="3562471">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3562475">return</span>&nbsp;<span class="ident" id="3562482">ResolveUnixAddr</span><span class="op" id="3562497">(</span><span class="ident" id="3562498">afnet</span><span class="op" id="3562503">,</span>&nbsp;<span class="ident" id="3562505">addr</span><span class="op" id="3562509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3562512">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3562515">return</span>&nbsp;<span class="ident" id="3562522">resolveInternetAddr</span><span class="op" id="3562541">(</span><span class="ident" id="3562542">afnet</span><span class="op" id="3562547">,</span>&nbsp;<span class="ident" id="3562549">addr</span><span class="op" id="3562553">,</span>&nbsp;<span class="ident" id="3562555">deadline</span><span class="op" id="3562563">)</span><br>
<span class="lineno"></span><span class="op" id="3562565">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3562568">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;the&nbsp;address&nbsp;on&nbsp;the&nbsp;named&nbsp;network.</span><br>
<span class="lineno"></span><span class="comment" id="3562622">//</span><br>
<span class="lineno">115</span><span class="comment" id="3562625">//&nbsp;Known&nbsp;networks&nbsp;are&nbsp;&#34;tcp&#34;,&nbsp;&#34;tcp4&#34;&nbsp;(IPv4-only),&nbsp;&#34;tcp6&#34;&nbsp;(IPv6-only),</span><br>
<span class="lineno"></span><span class="comment" id="3562694">//&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;&nbsp;(IPv4-only),&nbsp;&#34;udp6&#34;&nbsp;(IPv6-only),&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3562756">//&nbsp;(IPv4-only),&nbsp;&#34;ip6&#34;&nbsp;(IPv6-only),&nbsp;&#34;unix&#34;,&nbsp;&#34;unixgram&#34;&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3562814">//&nbsp;&#34;unixpacket&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3562831">//</span><br>
<span class="lineno">120</span><span class="comment" id="3562834">//&nbsp;For&nbsp;TCP&nbsp;and&nbsp;UDP&nbsp;networks,&nbsp;addresses&nbsp;have&nbsp;the&nbsp;form&nbsp;host:port.</span><br>
<span class="lineno"></span><span class="comment" id="3562898">//&nbsp;If&nbsp;host&nbsp;is&nbsp;a&nbsp;literal&nbsp;IPv6&nbsp;address&nbsp;it&nbsp;must&nbsp;be&nbsp;enclosed</span><br>
<span class="lineno"></span><span class="comment" id="3562955">//&nbsp;in&nbsp;square&nbsp;brackets&nbsp;as&nbsp;in&nbsp;&#34;[::1]:80&#34;&nbsp;or&nbsp;&#34;[ipv6-host%zone]:80&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3563020">//&nbsp;The&nbsp;functions&nbsp;JoinHostPort&nbsp;and&nbsp;SplitHostPort&nbsp;manipulate&nbsp;addresses</span><br>
<span class="lineno"></span><span class="comment" id="3563089">//&nbsp;in&nbsp;this&nbsp;form.</span><br>
<span class="lineno">125</span><span class="comment" id="3563106">//</span><br>
<span class="lineno"></span><span class="comment" id="3563109">//&nbsp;Examples:</span><br>
<span class="lineno"></span><span class="comment" id="3563122">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;tcp&#34;,&nbsp;&#34;12.34.56.78:80&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3563155">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;tcp&#34;,&nbsp;&#34;google.com:http&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3563189">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;tcp&#34;,&nbsp;&#34;[2001:db8::1]:http&#34;)</span><br>
<span class="lineno">130</span><span class="comment" id="3563226">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;tcp&#34;,&nbsp;&#34;[fe80::1%lo0]:80&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3563261">//</span><br>
<span class="lineno"></span><span class="comment" id="3563264">//&nbsp;For&nbsp;IP&nbsp;networks,&nbsp;the&nbsp;network&nbsp;must&nbsp;be&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;&nbsp;or&nbsp;&#34;ip6&#34;&nbsp;followed</span><br>
<span class="lineno"></span><span class="comment" id="3563334">//&nbsp;by&nbsp;a&nbsp;colon&nbsp;and&nbsp;a&nbsp;protocol&nbsp;number&nbsp;or&nbsp;name&nbsp;and&nbsp;the&nbsp;addr&nbsp;must&nbsp;be&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3563401">//&nbsp;literal&nbsp;IP&nbsp;address.</span><br>
<span class="lineno">135</span><span class="comment" id="3563424">//</span><br>
<span class="lineno"></span><span class="comment" id="3563427">//&nbsp;Examples:</span><br>
<span class="lineno"></span><span class="comment" id="3563440">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;ip4:1&#34;,&nbsp;&#34;127.0.0.1&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3563470">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;ip6:ospf&#34;,&nbsp;&#34;::1&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3563497">//</span><br>
<span class="lineno">140</span><span class="comment" id="3563500">//&nbsp;For&nbsp;Unix&nbsp;networks,&nbsp;the&nbsp;address&nbsp;must&nbsp;be&nbsp;a&nbsp;file&nbsp;system&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="3563562">func</span>&nbsp;<span class="ident" id="3563567">Dial</span><span class="op" id="3563571">(</span><span class="ident" id="3563572">network</span><span class="op" id="3563579">,</span>&nbsp;<span class="ident" id="3563581">address</span>&nbsp;<span class="builtintype" id="3563589">string</span><span class="op" id="3563595">)</span>&nbsp;<span class="op" id="3563597">(</span><span class="ident" id="3563598">Conn</span><span class="op" id="3563602">,</span>&nbsp;<span class="builtintype" id="3563604">error</span><span class="op" id="3563609">)</span>&nbsp;<span class="op" id="3563611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3563614">var</span>&nbsp;<span class="ident" id="3563618">d</span>&nbsp;<span class="ident" id="3563620">Dialer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3563628">return</span>&nbsp;<span class="ident" id="3563635">d</span><span class="op" id="3563636">.</span><span class="ident" id="3563637">Dial</span><span class="op" id="3563641">(</span><span class="ident" id="3563642">network</span><span class="op" id="3563649">,</span>&nbsp;<span class="ident" id="3563651">address</span><span class="op" id="3563658">)</span><br>
<span class="lineno"></span><span class="op" id="3563660">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="3563663">//&nbsp;DialTimeout&nbsp;acts&nbsp;like&nbsp;Dial&nbsp;but&nbsp;takes&nbsp;a&nbsp;timeout.</span><br>
<span class="lineno"></span><span class="comment" id="3563714">//&nbsp;The&nbsp;timeout&nbsp;includes&nbsp;name&nbsp;resolution,&nbsp;if&nbsp;required.</span><br>
<span class="lineno"></span><span class="keyword" id="3563768">func</span>&nbsp;<span class="ident" id="3563773">DialTimeout</span><span class="op" id="3563784">(</span><span class="ident" id="3563785">network</span><span class="op" id="3563792">,</span>&nbsp;<span class="ident" id="3563794">address</span>&nbsp;<span class="builtintype" id="3563802">string</span><span class="op" id="3563808">,</span>&nbsp;<span class="ident" id="3563810">timeout</span>&nbsp;<span class="ident" id="3563818">time</span><span class="op" id="3563822">.</span><span class="ident" id="3563823">Duration</span><span class="op" id="3563831">)</span>&nbsp;<span class="op" id="3563833">(</span><span class="ident" id="3563834">Conn</span><span class="op" id="3563838">,</span>&nbsp;<span class="builtintype" id="3563840">error</span><span class="op" id="3563845">)</span>&nbsp;<span class="op" id="3563847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3563850">d</span>&nbsp;<span class="op" id="3563852">:=</span>&nbsp;<span class="ident" id="3563855">Dialer</span><span class="op" id="3563861">{</span><span class="ident" id="3563862">Timeout</span><span class="op" id="3563869">:</span>&nbsp;<span class="ident" id="3563871">timeout</span><span class="op" id="3563878">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3563881">return</span>&nbsp;<span class="ident" id="3563888">d</span><span class="op" id="3563889">.</span><span class="ident" id="3563890">Dial</span><span class="op" id="3563894">(</span><span class="ident" id="3563895">network</span><span class="op" id="3563902">,</span>&nbsp;<span class="ident" id="3563904">address</span><span class="op" id="3563911">)</span><br>
<span class="lineno"></span><span class="op" id="3563913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3563916">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;the&nbsp;address&nbsp;on&nbsp;the&nbsp;named&nbsp;network.</span><br>
<span class="lineno"></span><span class="comment" id="3563970">//</span><br>
<span class="lineno">155</span><span class="comment" id="3563973">//&nbsp;See&nbsp;func&nbsp;Dial&nbsp;for&nbsp;a&nbsp;description&nbsp;of&nbsp;the&nbsp;network&nbsp;and&nbsp;address</span><br>
<span class="lineno"></span><span class="comment" id="3564035">//&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="keyword" id="3564050">func</span>&nbsp;<span class="op" id="3564055">(</span><span class="ident" id="3564056">d</span>&nbsp;<span class="op" id="3564058">*</span><span class="ident" id="3564059">Dialer</span><span class="op" id="3564065">)</span>&nbsp;<span class="ident" id="3564067">Dial</span><span class="op" id="3564071">(</span><span class="ident" id="3564072">network</span><span class="op" id="3564079">,</span>&nbsp;<span class="ident" id="3564081">address</span>&nbsp;<span class="builtintype" id="3564089">string</span><span class="op" id="3564095">)</span>&nbsp;<span class="op" id="3564097">(</span><span class="ident" id="3564098">Conn</span><span class="op" id="3564102">,</span>&nbsp;<span class="builtintype" id="3564104">error</span><span class="op" id="3564109">)</span>&nbsp;<span class="op" id="3564111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3564114">ra</span><span class="op" id="3564116">,</span>&nbsp;<span class="ident" id="3564118">err</span>&nbsp;<span class="op" id="3564122">:=</span>&nbsp;<span class="ident" id="3564125">resolveAddr</span><span class="op" id="3564136">(</span><span class="string" id="3564137">&#34;dial&#34;</span><span class="op" id="3564143">,</span>&nbsp;<span class="ident" id="3564145">network</span><span class="op" id="3564152">,</span>&nbsp;<span class="ident" id="3564154">address</span><span class="op" id="3564161">,</span>&nbsp;<span class="ident" id="3564163">d</span><span class="op" id="3564164">.</span><span class="ident" id="3564165">deadline</span><span class="op" id="3564173">(</span><span class="op" id="3564174">)</span><span class="op" id="3564175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3564178">if</span>&nbsp;<span class="ident" id="3564181">err</span>&nbsp;<span class="op" id="3564185">!=</span>&nbsp;<span class="ident" id="3564188">nil</span>&nbsp;<span class="op" id="3564192">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3564196">return</span>&nbsp;<span class="ident" id="3564203">nil</span><span class="op" id="3564206">,</span>&nbsp;<span class="op" id="3564208">&amp;</span><span class="ident" id="3564209">OpError</span><span class="op" id="3564216">{</span><span class="ident" id="3564217">Op</span><span class="op" id="3564219">:</span>&nbsp;<span class="string" id="3564221">&#34;dial&#34;</span><span class="op" id="3564227">,</span>&nbsp;<span class="ident" id="3564229">Net</span><span class="op" id="3564232">:</span>&nbsp;<span class="ident" id="3564234">network</span><span class="op" id="3564241">,</span>&nbsp;<span class="ident" id="3564243">Addr</span><span class="op" id="3564247">:</span>&nbsp;<span class="ident" id="3564249">nil</span><span class="op" id="3564252">,</span>&nbsp;<span class="ident" id="3564254">Err</span><span class="op" id="3564257">:</span>&nbsp;<span class="ident" id="3564259">err</span><span class="op" id="3564262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3564265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3564268">dialer</span>&nbsp;<span class="op" id="3564275">:=</span>&nbsp;<span class="keyword" id="3564278">func</span><span class="op" id="3564282">(</span><span class="ident" id="3564283">deadline</span>&nbsp;<span class="ident" id="3564292">time</span><span class="op" id="3564296">.</span><span class="ident" id="3564297">Time</span><span class="op" id="3564301">)</span>&nbsp;<span class="op" id="3564303">(</span><span class="ident" id="3564304">Conn</span><span class="op" id="3564308">,</span>&nbsp;<span class="builtintype" id="3564310">error</span><span class="op" id="3564315">)</span>&nbsp;<span class="op" id="3564317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3564321">return</span>&nbsp;<span class="ident" id="3564328">dialSingle</span><span class="op" id="3564338">(</span><span class="ident" id="3564339">network</span><span class="op" id="3564346">,</span>&nbsp;<span class="ident" id="3564348">address</span><span class="op" id="3564355">,</span>&nbsp;<span class="ident" id="3564357">d</span><span class="op" id="3564358">.</span><span class="ident" id="3564359">LocalAddr</span><span class="op" id="3564368">,</span>&nbsp;<span class="ident" id="3564370">ra</span><span class="op" id="3564372">.</span><span class="ident" id="3564373">toAddr</span><span class="op" id="3564379">(</span><span class="op" id="3564380">)</span><span class="op" id="3564381">,</span>&nbsp;<span class="ident" id="3564383">deadline</span><span class="op" id="3564391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3564394">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3564397">if</span>&nbsp;<span class="ident" id="3564400">ras</span><span class="op" id="3564403">,</span>&nbsp;<span class="ident" id="3564405">ok</span>&nbsp;<span class="op" id="3564408">:=</span>&nbsp;<span class="ident" id="3564411">ra</span><span class="op" id="3564413">.</span><span class="op" id="3564414">(</span><span class="ident" id="3564415">addrList</span><span class="op" id="3564423">)</span><span class="op" id="3564424">;</span>&nbsp;<span class="ident" id="3564426">ok</span>&nbsp;<span class="op" id="3564429">&amp;&amp;</span>&nbsp;<span class="ident" id="3564432">d</span><span class="op" id="3564433">.</span><span class="ident" id="3564434">DualStack</span>&nbsp;<span class="op" id="3564444">&amp;&amp;</span>&nbsp;<span class="ident" id="3564447">network</span>&nbsp;<span class="op" id="3564455">==</span>&nbsp;<span class="string" id="3564458">&#34;tcp&#34;</span>&nbsp;<span class="op" id="3564464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3564468">dialer</span>&nbsp;<span class="op" id="3564475">=</span>&nbsp;<span class="keyword" id="3564477">func</span><span class="op" id="3564481">(</span><span class="ident" id="3564482">deadline</span>&nbsp;<span class="ident" id="3564491">time</span><span class="op" id="3564495">.</span><span class="ident" id="3564496">Time</span><span class="op" id="3564500">)</span>&nbsp;<span class="op" id="3564502">(</span><span class="ident" id="3564503">Conn</span><span class="op" id="3564507">,</span>&nbsp;<span class="builtintype" id="3564509">error</span><span class="op" id="3564514">)</span>&nbsp;<span class="op" id="3564516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3564521">return</span>&nbsp;<span class="ident" id="3564528">dialMulti</span><span class="op" id="3564537">(</span><span class="ident" id="3564538">network</span><span class="op" id="3564545">,</span>&nbsp;<span class="ident" id="3564547">address</span><span class="op" id="3564554">,</span>&nbsp;<span class="ident" id="3564556">d</span><span class="op" id="3564557">.</span><span class="ident" id="3564558">LocalAddr</span><span class="op" id="3564567">,</span>&nbsp;<span class="ident" id="3564569">ras</span><span class="op" id="3564572">,</span>&nbsp;<span class="ident" id="3564574">deadline</span><span class="op" id="3564582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3564586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3564589">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3564592">c</span><span class="op" id="3564593">,</span>&nbsp;<span class="ident" id="3564595">err</span>&nbsp;<span class="op" id="3564599">:=</span>&nbsp;<span class="ident" id="3564602">dial</span><span class="op" id="3564606">(</span><span class="ident" id="3564607">network</span><span class="op" id="3564614">,</span>&nbsp;<span class="ident" id="3564616">ra</span><span class="op" id="3564618">.</span><span class="ident" id="3564619">toAddr</span><span class="op" id="3564625">(</span><span class="op" id="3564626">)</span><span class="op" id="3564627">,</span>&nbsp;<span class="ident" id="3564629">dialer</span><span class="op" id="3564635">,</span>&nbsp;<span class="ident" id="3564637">d</span><span class="op" id="3564638">.</span><span class="ident" id="3564639">deadline</span><span class="op" id="3564647">(</span><span class="op" id="3564648">)</span><span class="op" id="3564649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3564652">if</span>&nbsp;<span class="ident" id="3564655">d</span><span class="op" id="3564656">.</span><span class="ident" id="3564657">KeepAlive</span>&nbsp;<span class="op" id="3564667">&gt;</span>&nbsp;<span class="num" id="3564669">0</span>&nbsp;<span class="op" id="3564671">&amp;&amp;</span>&nbsp;<span class="ident" id="3564674">err</span>&nbsp;<span class="op" id="3564678">==</span>&nbsp;<span class="ident" id="3564681">nil</span>&nbsp;<span class="op" id="3564685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3564689">if</span>&nbsp;<span class="ident" id="3564692">tc</span><span class="op" id="3564694">,</span>&nbsp;<span class="ident" id="3564696">ok</span>&nbsp;<span class="op" id="3564699">:=</span>&nbsp;<span class="ident" id="3564702">c</span><span class="op" id="3564703">.</span><span class="op" id="3564704">(</span><span class="op" id="3564705">*</span><span class="ident" id="3564706">TCPConn</span><span class="op" id="3564713">)</span><span class="op" id="3564714">;</span>&nbsp;<span class="ident" id="3564716">ok</span>&nbsp;<span class="op" id="3564719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3564724">tc</span><span class="op" id="3564726">.</span><span class="ident" id="3564727">SetKeepAlive</span><span class="op" id="3564739">(</span><span class="builtintype" id="3564740">true</span><span class="op" id="3564744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3564749">tc</span><span class="op" id="3564751">.</span><span class="ident" id="3564752">SetKeepAlivePeriod</span><span class="op" id="3564770">(</span><span class="ident" id="3564771">d</span><span class="op" id="3564772">.</span><span class="ident" id="3564773">KeepAlive</span><span class="op" id="3564782">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3564787">testHookSetKeepAlive</span><span class="op" id="3564807">(</span><span class="op" id="3564808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3564812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3564815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3564818">return</span>&nbsp;<span class="ident" id="3564825">c</span><span class="op" id="3564826">,</span>&nbsp;<span class="ident" id="3564828">err</span><br>
<span class="lineno"></span><span class="op" id="3564832">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="keyword" id="3564835">var</span>&nbsp;<span class="ident" id="3564839">testHookSetKeepAlive</span>&nbsp;<span class="op" id="3564860">=</span>&nbsp;<span class="keyword" id="3564862">func</span><span class="op" id="3564866">(</span><span class="op" id="3564867">)</span>&nbsp;<span class="op" id="3564869">{</span><span class="op" id="3564870">}</span>&nbsp;<span class="comment" id="3564872">//&nbsp;changed&nbsp;by&nbsp;dial_test.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3564900">//&nbsp;dialMulti&nbsp;attempts&nbsp;to&nbsp;establish&nbsp;connections&nbsp;to&nbsp;each&nbsp;destination&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3564970">//&nbsp;the&nbsp;list&nbsp;of&nbsp;addresses.&nbsp;It&nbsp;will&nbsp;return&nbsp;the&nbsp;first&nbsp;established</span><br>
<span class="lineno">185</span><span class="comment" id="3565033">//&nbsp;connection&nbsp;and&nbsp;close&nbsp;the&nbsp;other&nbsp;connections.&nbsp;Otherwise&nbsp;it&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3565101">//&nbsp;error&nbsp;on&nbsp;the&nbsp;last&nbsp;attempt.</span><br>
<span class="lineno"></span><span class="keyword" id="3565131">func</span>&nbsp;<span class="ident" id="3565136">dialMulti</span><span class="op" id="3565145">(</span><span class="ident" id="3565146">net</span><span class="op" id="3565149">,</span>&nbsp;<span class="ident" id="3565151">addr</span>&nbsp;<span class="builtintype" id="3565156">string</span><span class="op" id="3565162">,</span>&nbsp;<span class="ident" id="3565164">la</span>&nbsp;<span class="ident" id="3565167">Addr</span><span class="op" id="3565171">,</span>&nbsp;<span class="ident" id="3565173">ras</span>&nbsp;<span class="ident" id="3565177">addrList</span><span class="op" id="3565185">,</span>&nbsp;<span class="ident" id="3565187">deadline</span>&nbsp;<span class="ident" id="3565196">time</span><span class="op" id="3565200">.</span><span class="ident" id="3565201">Time</span><span class="op" id="3565205">)</span>&nbsp;<span class="op" id="3565207">(</span><span class="ident" id="3565208">Conn</span><span class="op" id="3565212">,</span>&nbsp;<span class="builtintype" id="3565214">error</span><span class="op" id="3565219">)</span>&nbsp;<span class="op" id="3565221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3565224">type</span>&nbsp;<span class="ident" id="3565229">racer</span>&nbsp;<span class="keyword" id="3565235">struct</span>&nbsp;<span class="op" id="3565242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3565246">Conn</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3565253">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3565260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3565263">//&nbsp;Sig&nbsp;controls&nbsp;the&nbsp;flow&nbsp;of&nbsp;dial&nbsp;results&nbsp;on&nbsp;lane.&nbsp;It&nbsp;passes&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3565326">//&nbsp;token&nbsp;to&nbsp;the&nbsp;next&nbsp;racer&nbsp;and&nbsp;also&nbsp;indicates&nbsp;the&nbsp;end&nbsp;of&nbsp;flow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3565389">//&nbsp;by&nbsp;using&nbsp;closed&nbsp;channel.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3565418">sig</span>&nbsp;<span class="op" id="3565422">:=</span>&nbsp;<span class="builtinfunc" id="3565425">make</span><span class="op" id="3565429">(</span><span class="keyword" id="3565430">chan</span>&nbsp;<span class="builtintype" id="3565435">bool</span><span class="op" id="3565439">,</span>&nbsp;<span class="num" id="3565441">1</span><span class="op" id="3565442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3565445">lane</span>&nbsp;<span class="op" id="3565450">:=</span>&nbsp;<span class="builtinfunc" id="3565453">make</span><span class="op" id="3565457">(</span><span class="keyword" id="3565458">chan</span>&nbsp;<span class="ident" id="3565463">racer</span><span class="op" id="3565468">,</span>&nbsp;<span class="num" id="3565470">1</span><span class="op" id="3565471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3565474">for</span>&nbsp;<span class="ident" id="3565478">_</span><span class="op" id="3565479">,</span>&nbsp;<span class="ident" id="3565481">ra</span>&nbsp;<span class="op" id="3565484">:=</span>&nbsp;<span class="keyword" id="3565487">range</span>&nbsp;<span class="ident" id="3565493">ras</span>&nbsp;<span class="op" id="3565497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3565501">go</span>&nbsp;<span class="keyword" id="3565504">func</span><span class="op" id="3565508">(</span><span class="ident" id="3565509">ra</span>&nbsp;<span class="ident" id="3565512">Addr</span><span class="op" id="3565516">)</span>&nbsp;<span class="op" id="3565518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3565523">c</span><span class="op" id="3565524">,</span>&nbsp;<span class="ident" id="3565526">err</span>&nbsp;<span class="op" id="3565530">:=</span>&nbsp;<span class="ident" id="3565533">dialSingle</span><span class="op" id="3565543">(</span><span class="ident" id="3565544">net</span><span class="op" id="3565547">,</span>&nbsp;<span class="ident" id="3565549">addr</span><span class="op" id="3565553">,</span>&nbsp;<span class="ident" id="3565555">la</span><span class="op" id="3565557">,</span>&nbsp;<span class="ident" id="3565559">ra</span><span class="op" id="3565561">,</span>&nbsp;<span class="ident" id="3565563">deadline</span><span class="op" id="3565571">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3565576">if</span>&nbsp;<span class="ident" id="3565579">_</span><span class="op" id="3565580">,</span>&nbsp;<span class="ident" id="3565582">ok</span>&nbsp;<span class="op" id="3565585">:=</span>&nbsp;<span class="op" id="3565588">&lt;-</span><span class="ident" id="3565590">sig</span><span class="op" id="3565593">;</span>&nbsp;<span class="ident" id="3565595">ok</span>&nbsp;<span class="op" id="3565598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3565604">lane</span>&nbsp;<span class="op" id="3565609">&lt;-</span>&nbsp;<span class="ident" id="3565612">racer</span><span class="op" id="3565617">{</span><span class="ident" id="3565618">c</span><span class="op" id="3565619">,</span>&nbsp;<span class="ident" id="3565621">err</span><span class="op" id="3565624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3565629">}</span>&nbsp;<span class="keyword" id="3565631">else</span>&nbsp;<span class="keyword" id="3565636">if</span>&nbsp;<span class="ident" id="3565639">err</span>&nbsp;<span class="op" id="3565643">==</span>&nbsp;<span class="ident" id="3565646">nil</span>&nbsp;<span class="op" id="3565650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3565656">//&nbsp;We&nbsp;have&nbsp;to&nbsp;return&nbsp;the&nbsp;resources</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3565695">//&nbsp;that&nbsp;belong&nbsp;to&nbsp;the&nbsp;other</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3565727">//&nbsp;connections&nbsp;here&nbsp;for&nbsp;avoiding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3565764">//&nbsp;unnecessary&nbsp;resource&nbsp;starvation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3565804">c</span><span class="op" id="3565805">.</span><span class="ident" id="3565806">Close</span><span class="op" id="3565811">(</span><span class="op" id="3565812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3565817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3565821">}</span><span class="op" id="3565822">(</span><span class="ident" id="3565823">ra</span><span class="op" id="3565825">.</span><span class="ident" id="3565826">toAddr</span><span class="op" id="3565832">(</span><span class="op" id="3565833">)</span><span class="op" id="3565834">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3565837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3565840">defer</span>&nbsp;<span class="builtinfunc" id="3565846">close</span><span class="op" id="3565851">(</span><span class="ident" id="3565852">sig</span><span class="op" id="3565855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3565858">lastErr</span>&nbsp;<span class="op" id="3565866">:=</span>&nbsp;<span class="ident" id="3565869">errTimeout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3565881">nracers</span>&nbsp;<span class="op" id="3565889">:=</span>&nbsp;<span class="builtinfunc" id="3565892">len</span><span class="op" id="3565895">(</span><span class="ident" id="3565896">ras</span><span class="op" id="3565899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3565902">for</span>&nbsp;<span class="ident" id="3565906">nracers</span>&nbsp;<span class="op" id="3565914">&gt;</span>&nbsp;<span class="num" id="3565916">0</span>&nbsp;<span class="op" id="3565918">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3565922">sig</span>&nbsp;<span class="op" id="3565926">&lt;-</span>&nbsp;<span class="builtintype" id="3565929">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3565936">racer</span>&nbsp;<span class="op" id="3565942">:=</span>&nbsp;<span class="op" id="3565945">&lt;-</span><span class="ident" id="3565947">lane</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3565954">if</span>&nbsp;<span class="ident" id="3565957">racer</span><span class="op" id="3565962">.</span><span class="builtintype" id="3565963">error</span>&nbsp;<span class="op" id="3565969">==</span>&nbsp;<span class="ident" id="3565972">nil</span>&nbsp;<span class="op" id="3565976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3565981">return</span>&nbsp;<span class="ident" id="3565988">racer</span><span class="op" id="3565993">.</span><span class="ident" id="3565994">Conn</span><span class="op" id="3565998">,</span>&nbsp;<span class="ident" id="3566000">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3566006">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3566010">lastErr</span>&nbsp;<span class="op" id="3566018">=</span>&nbsp;<span class="ident" id="3566020">racer</span><span class="op" id="3566025">.</span><span class="builtintype" id="3566026">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3566034">nracers</span><span class="op" id="3566041">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3566045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3566048">return</span>&nbsp;<span class="ident" id="3566055">nil</span><span class="op" id="3566058">,</span>&nbsp;<span class="ident" id="3566060">lastErr</span><br>
<span class="lineno"></span><span class="op" id="3566068">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="3566071">//&nbsp;dialSingle&nbsp;attempts&nbsp;to&nbsp;establish&nbsp;and&nbsp;returns&nbsp;a&nbsp;single&nbsp;connection&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3566142">//&nbsp;the&nbsp;destination&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="3566170">func</span>&nbsp;<span class="ident" id="3566175">dialSingle</span><span class="op" id="3566185">(</span><span class="ident" id="3566186">net</span><span class="op" id="3566189">,</span>&nbsp;<span class="ident" id="3566191">addr</span>&nbsp;<span class="builtintype" id="3566196">string</span><span class="op" id="3566202">,</span>&nbsp;<span class="ident" id="3566204">la</span><span class="op" id="3566206">,</span>&nbsp;<span class="ident" id="3566208">ra</span>&nbsp;<span class="ident" id="3566211">Addr</span><span class="op" id="3566215">,</span>&nbsp;<span class="ident" id="3566217">deadline</span>&nbsp;<span class="ident" id="3566226">time</span><span class="op" id="3566230">.</span><span class="ident" id="3566231">Time</span><span class="op" id="3566235">)</span>&nbsp;<span class="op" id="3566237">(</span><span class="ident" id="3566238">c</span>&nbsp;<span class="ident" id="3566240">Conn</span><span class="op" id="3566244">,</span>&nbsp;<span class="ident" id="3566246">err</span>&nbsp;<span class="builtintype" id="3566250">error</span><span class="op" id="3566255">)</span>&nbsp;<span class="op" id="3566257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3566260">if</span>&nbsp;<span class="ident" id="3566263">la</span>&nbsp;<span class="op" id="3566266">!=</span>&nbsp;<span class="ident" id="3566269">nil</span>&nbsp;<span class="op" id="3566273">&amp;&amp;</span>&nbsp;<span class="ident" id="3566276">la</span><span class="op" id="3566278">.</span><span class="ident" id="3566279">Network</span><span class="op" id="3566286">(</span><span class="op" id="3566287">)</span>&nbsp;<span class="op" id="3566289">!=</span>&nbsp;<span class="ident" id="3566292">ra</span><span class="op" id="3566294">.</span><span class="ident" id="3566295">Network</span><span class="op" id="3566302">(</span><span class="op" id="3566303">)</span>&nbsp;<span class="op" id="3566305">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3566309">return</span>&nbsp;<span class="ident" id="3566316">nil</span><span class="op" id="3566319">,</span>&nbsp;<span class="op" id="3566321">&amp;</span><span class="ident" id="3566322">OpError</span><span class="op" id="3566329">{</span><span class="ident" id="3566330">Op</span><span class="op" id="3566332">:</span>&nbsp;<span class="string" id="3566334">&#34;dial&#34;</span><span class="op" id="3566340">,</span>&nbsp;<span class="ident" id="3566342">Net</span><span class="op" id="3566345">:</span>&nbsp;<span class="ident" id="3566347">net</span><span class="op" id="3566350">,</span>&nbsp;<span class="ident" id="3566352">Addr</span><span class="op" id="3566356">:</span>&nbsp;<span class="ident" id="3566358">ra</span><span class="op" id="3566360">,</span>&nbsp;<span class="ident" id="3566362">Err</span><span class="op" id="3566365">:</span>&nbsp;<span class="ident" id="3566367">errors</span><span class="op" id="3566373">.</span><span class="ident" id="3566374">New</span><span class="op" id="3566377">(</span><span class="string" id="3566378">&#34;mismatched&nbsp;local&nbsp;address&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="3566411">+</span>&nbsp;<span class="ident" id="3566413">la</span><span class="op" id="3566415">.</span><span class="ident" id="3566416">Network</span><span class="op" id="3566423">(</span><span class="op" id="3566424">)</span><span class="op" id="3566425">)</span><span class="op" id="3566426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3566429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3566432">switch</span>&nbsp;<span class="ident" id="3566439">ra</span>&nbsp;<span class="op" id="3566442">:=</span>&nbsp;<span class="ident" id="3566445">ra</span><span class="op" id="3566447">.</span><span class="op" id="3566448">(</span><span class="keyword" id="3566449">type</span><span class="op" id="3566453">)</span>&nbsp;<span class="op" id="3566455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3566458">case</span>&nbsp;<span class="op" id="3566463">*</span><span class="ident" id="3566464">TCPAddr</span><span class="op" id="3566471">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3566475">la</span><span class="op" id="3566477">,</span>&nbsp;<span class="ident" id="3566479">_</span>&nbsp;<span class="op" id="3566481">:=</span>&nbsp;<span class="ident" id="3566484">la</span><span class="op" id="3566486">.</span><span class="op" id="3566487">(</span><span class="op" id="3566488">*</span><span class="ident" id="3566489">TCPAddr</span><span class="op" id="3566496">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3566500">c</span><span class="op" id="3566501">,</span>&nbsp;<span class="ident" id="3566503">err</span>&nbsp;<span class="op" id="3566507">=</span>&nbsp;<span class="ident" id="3566509">dialTCP</span><span class="op" id="3566516">(</span><span class="ident" id="3566517">net</span><span class="op" id="3566520">,</span>&nbsp;<span class="ident" id="3566522">la</span><span class="op" id="3566524">,</span>&nbsp;<span class="ident" id="3566526">ra</span><span class="op" id="3566528">,</span>&nbsp;<span class="ident" id="3566530">deadline</span><span class="op" id="3566538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3566541">case</span>&nbsp;<span class="op" id="3566546">*</span><span class="ident" id="3566547">UDPAddr</span><span class="op" id="3566554">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3566558">la</span><span class="op" id="3566560">,</span>&nbsp;<span class="ident" id="3566562">_</span>&nbsp;<span class="op" id="3566564">:=</span>&nbsp;<span class="ident" id="3566567">la</span><span class="op" id="3566569">.</span><span class="op" id="3566570">(</span><span class="op" id="3566571">*</span><span class="ident" id="3566572">UDPAddr</span><span class="op" id="3566579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3566583">c</span><span class="op" id="3566584">,</span>&nbsp;<span class="ident" id="3566586">err</span>&nbsp;<span class="op" id="3566590">=</span>&nbsp;<span class="ident" id="3566592">dialUDP</span><span class="op" id="3566599">(</span><span class="ident" id="3566600">net</span><span class="op" id="3566603">,</span>&nbsp;<span class="ident" id="3566605">la</span><span class="op" id="3566607">,</span>&nbsp;<span class="ident" id="3566609">ra</span><span class="op" id="3566611">,</span>&nbsp;<span class="ident" id="3566613">deadline</span><span class="op" id="3566621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3566624">case</span>&nbsp;<span class="op" id="3566629">*</span><span class="ident" id="3566630">IPAddr</span><span class="op" id="3566636">:</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3566640">la</span><span class="op" id="3566642">,</span>&nbsp;<span class="ident" id="3566644">_</span>&nbsp;<span class="op" id="3566646">:=</span>&nbsp;<span class="ident" id="3566649">la</span><span class="op" id="3566651">.</span><span class="op" id="3566652">(</span><span class="op" id="3566653">*</span><span class="ident" id="3566654">IPAddr</span><span class="op" id="3566660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3566664">c</span><span class="op" id="3566665">,</span>&nbsp;<span class="ident" id="3566667">err</span>&nbsp;<span class="op" id="3566671">=</span>&nbsp;<span class="ident" id="3566673">dialIP</span><span class="op" id="3566679">(</span><span class="ident" id="3566680">net</span><span class="op" id="3566683">,</span>&nbsp;<span class="ident" id="3566685">la</span><span class="op" id="3566687">,</span>&nbsp;<span class="ident" id="3566689">ra</span><span class="op" id="3566691">,</span>&nbsp;<span class="ident" id="3566693">deadline</span><span class="op" id="3566701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3566704">case</span>&nbsp;<span class="op" id="3566709">*</span><span class="ident" id="3566710">UnixAddr</span><span class="op" id="3566718">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3566722">la</span><span class="op" id="3566724">,</span>&nbsp;<span class="ident" id="3566726">_</span>&nbsp;<span class="op" id="3566728">:=</span>&nbsp;<span class="ident" id="3566731">la</span><span class="op" id="3566733">.</span><span class="op" id="3566734">(</span><span class="op" id="3566735">*</span><span class="ident" id="3566736">UnixAddr</span><span class="op" id="3566744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3566748">c</span><span class="op" id="3566749">,</span>&nbsp;<span class="ident" id="3566751">err</span>&nbsp;<span class="op" id="3566755">=</span>&nbsp;<span class="ident" id="3566757">dialUnix</span><span class="op" id="3566765">(</span><span class="ident" id="3566766">net</span><span class="op" id="3566769">,</span>&nbsp;<span class="ident" id="3566771">la</span><span class="op" id="3566773">,</span>&nbsp;<span class="ident" id="3566775">ra</span><span class="op" id="3566777">,</span>&nbsp;<span class="ident" id="3566779">deadline</span><span class="op" id="3566787">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3566790">default</span><span class="op" id="3566797">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3566801">return</span>&nbsp;<span class="ident" id="3566808">nil</span><span class="op" id="3566811">,</span>&nbsp;<span class="op" id="3566813">&amp;</span><span class="ident" id="3566814">OpError</span><span class="op" id="3566821">{</span><span class="ident" id="3566822">Op</span><span class="op" id="3566824">:</span>&nbsp;<span class="string" id="3566826">&#34;dial&#34;</span><span class="op" id="3566832">,</span>&nbsp;<span class="ident" id="3566834">Net</span><span class="op" id="3566837">:</span>&nbsp;<span class="ident" id="3566839">net</span><span class="op" id="3566842">,</span>&nbsp;<span class="ident" id="3566844">Addr</span><span class="op" id="3566848">:</span>&nbsp;<span class="ident" id="3566850">ra</span><span class="op" id="3566852">,</span>&nbsp;<span class="ident" id="3566854">Err</span><span class="op" id="3566857">:</span>&nbsp;<span class="op" id="3566859">&amp;</span><span class="ident" id="3566860">AddrError</span><span class="op" id="3566869">{</span><span class="ident" id="3566870">Err</span><span class="op" id="3566873">:</span>&nbsp;<span class="string" id="3566875">&#34;unexpected&nbsp;address&nbsp;type&#34;</span><span class="op" id="3566900">,</span>&nbsp;<span class="ident" id="3566902">Addr</span><span class="op" id="3566906">:</span>&nbsp;<span class="ident" id="3566908">addr</span><span class="op" id="3566912">}</span><span class="op" id="3566913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3566916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3566919">if</span>&nbsp;<span class="ident" id="3566922">err</span>&nbsp;<span class="op" id="3566926">!=</span>&nbsp;<span class="ident" id="3566929">nil</span>&nbsp;<span class="op" id="3566933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3566937">return</span>&nbsp;<span class="ident" id="3566944">nil</span><span class="op" id="3566947">,</span>&nbsp;<span class="ident" id="3566949">err</span>&nbsp;<span class="comment" id="3566953">//&nbsp;c&nbsp;is&nbsp;non-nil&nbsp;interface&nbsp;containing&nbsp;nil&nbsp;pointer</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3567003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3567006">return</span>&nbsp;<span class="ident" id="3567013">c</span><span class="op" id="3567014">,</span>&nbsp;<span class="ident" id="3567016">nil</span><br>
<span class="lineno"></span><span class="op" id="3567020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3567023">//&nbsp;Listen&nbsp;announces&nbsp;on&nbsp;the&nbsp;local&nbsp;network&nbsp;address&nbsp;laddr.</span><br>
<span class="lineno">255</span><span class="comment" id="3567079">//&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;a&nbsp;stream-oriented&nbsp;network:&nbsp;&#34;tcp&#34;,&nbsp;&#34;tcp4&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3567148">//&nbsp;&#34;tcp6&#34;,&nbsp;&#34;unix&#34;&nbsp;or&nbsp;&#34;unixpacket&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3567183">//&nbsp;See&nbsp;Dial&nbsp;for&nbsp;the&nbsp;syntax&nbsp;of&nbsp;laddr.</span><br>
<span class="lineno"></span><span class="keyword" id="3567220">func</span>&nbsp;<span class="ident" id="3567225">Listen</span><span class="op" id="3567231">(</span><span class="ident" id="3567232">net</span><span class="op" id="3567235">,</span>&nbsp;<span class="ident" id="3567237">laddr</span>&nbsp;<span class="builtintype" id="3567243">string</span><span class="op" id="3567249">)</span>&nbsp;<span class="op" id="3567251">(</span><span class="ident" id="3567252">Listener</span><span class="op" id="3567260">,</span>&nbsp;<span class="builtintype" id="3567262">error</span><span class="op" id="3567267">)</span>&nbsp;<span class="op" id="3567269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3567272">la</span><span class="op" id="3567274">,</span>&nbsp;<span class="ident" id="3567276">err</span>&nbsp;<span class="op" id="3567280">:=</span>&nbsp;<span class="ident" id="3567283">resolveAddr</span><span class="op" id="3567294">(</span><span class="string" id="3567295">&#34;listen&#34;</span><span class="op" id="3567303">,</span>&nbsp;<span class="ident" id="3567305">net</span><span class="op" id="3567308">,</span>&nbsp;<span class="ident" id="3567310">laddr</span><span class="op" id="3567315">,</span>&nbsp;<span class="ident" id="3567317">noDeadline</span><span class="op" id="3567327">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3567330">if</span>&nbsp;<span class="ident" id="3567333">err</span>&nbsp;<span class="op" id="3567337">!=</span>&nbsp;<span class="ident" id="3567340">nil</span>&nbsp;<span class="op" id="3567344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3567348">return</span>&nbsp;<span class="ident" id="3567355">nil</span><span class="op" id="3567358">,</span>&nbsp;<span class="op" id="3567360">&amp;</span><span class="ident" id="3567361">OpError</span><span class="op" id="3567368">{</span><span class="ident" id="3567369">Op</span><span class="op" id="3567371">:</span>&nbsp;<span class="string" id="3567373">&#34;listen&#34;</span><span class="op" id="3567381">,</span>&nbsp;<span class="ident" id="3567383">Net</span><span class="op" id="3567386">:</span>&nbsp;<span class="ident" id="3567388">net</span><span class="op" id="3567391">,</span>&nbsp;<span class="ident" id="3567393">Addr</span><span class="op" id="3567397">:</span>&nbsp;<span class="ident" id="3567399">nil</span><span class="op" id="3567402">,</span>&nbsp;<span class="ident" id="3567404">Err</span><span class="op" id="3567407">:</span>&nbsp;<span class="ident" id="3567409">err</span><span class="op" id="3567412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3567415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3567418">var</span>&nbsp;<span class="ident" id="3567422">l</span>&nbsp;<span class="ident" id="3567424">Listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3567434">switch</span>&nbsp;<span class="ident" id="3567441">la</span>&nbsp;<span class="op" id="3567444">:=</span>&nbsp;<span class="ident" id="3567447">la</span><span class="op" id="3567449">.</span><span class="ident" id="3567450">toAddr</span><span class="op" id="3567456">(</span><span class="op" id="3567457">)</span><span class="op" id="3567458">.</span><span class="op" id="3567459">(</span><span class="keyword" id="3567460">type</span><span class="op" id="3567464">)</span>&nbsp;<span class="op" id="3567466">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3567469">case</span>&nbsp;<span class="op" id="3567474">*</span><span class="ident" id="3567475">TCPAddr</span><span class="op" id="3567482">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3567486">l</span><span class="op" id="3567487">,</span>&nbsp;<span class="ident" id="3567489">err</span>&nbsp;<span class="op" id="3567493">=</span>&nbsp;<span class="ident" id="3567495">ListenTCP</span><span class="op" id="3567504">(</span><span class="ident" id="3567505">net</span><span class="op" id="3567508">,</span>&nbsp;<span class="ident" id="3567510">la</span><span class="op" id="3567512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3567515">case</span>&nbsp;<span class="op" id="3567520">*</span><span class="ident" id="3567521">UnixAddr</span><span class="op" id="3567529">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3567533">l</span><span class="op" id="3567534">,</span>&nbsp;<span class="ident" id="3567536">err</span>&nbsp;<span class="op" id="3567540">=</span>&nbsp;<span class="ident" id="3567542">ListenUnix</span><span class="op" id="3567552">(</span><span class="ident" id="3567553">net</span><span class="op" id="3567556">,</span>&nbsp;<span class="ident" id="3567558">la</span><span class="op" id="3567560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3567563">default</span><span class="op" id="3567570">:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3567574">return</span>&nbsp;<span class="ident" id="3567581">nil</span><span class="op" id="3567584">,</span>&nbsp;<span class="op" id="3567586">&amp;</span><span class="ident" id="3567587">OpError</span><span class="op" id="3567594">{</span><span class="ident" id="3567595">Op</span><span class="op" id="3567597">:</span>&nbsp;<span class="string" id="3567599">&#34;listen&#34;</span><span class="op" id="3567607">,</span>&nbsp;<span class="ident" id="3567609">Net</span><span class="op" id="3567612">:</span>&nbsp;<span class="ident" id="3567614">net</span><span class="op" id="3567617">,</span>&nbsp;<span class="ident" id="3567619">Addr</span><span class="op" id="3567623">:</span>&nbsp;<span class="ident" id="3567625">la</span><span class="op" id="3567627">,</span>&nbsp;<span class="ident" id="3567629">Err</span><span class="op" id="3567632">:</span>&nbsp;<span class="op" id="3567634">&amp;</span><span class="ident" id="3567635">AddrError</span><span class="op" id="3567644">{</span><span class="ident" id="3567645">Err</span><span class="op" id="3567648">:</span>&nbsp;<span class="string" id="3567650">&#34;unexpected&nbsp;address&nbsp;type&#34;</span><span class="op" id="3567675">,</span>&nbsp;<span class="ident" id="3567677">Addr</span><span class="op" id="3567681">:</span>&nbsp;<span class="ident" id="3567683">laddr</span><span class="op" id="3567688">}</span><span class="op" id="3567689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3567692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3567695">if</span>&nbsp;<span class="ident" id="3567698">err</span>&nbsp;<span class="op" id="3567702">!=</span>&nbsp;<span class="ident" id="3567705">nil</span>&nbsp;<span class="op" id="3567709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3567713">return</span>&nbsp;<span class="ident" id="3567720">nil</span><span class="op" id="3567723">,</span>&nbsp;<span class="ident" id="3567725">err</span>&nbsp;<span class="comment" id="3567729">//&nbsp;l&nbsp;is&nbsp;non-nil&nbsp;interface&nbsp;containing&nbsp;nil&nbsp;pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3567779">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3567782">return</span>&nbsp;<span class="ident" id="3567789">l</span><span class="op" id="3567790">,</span>&nbsp;<span class="ident" id="3567792">nil</span><br>
<span class="lineno"></span><span class="op" id="3567796">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3567799">//&nbsp;ListenPacket&nbsp;announces&nbsp;on&nbsp;the&nbsp;local&nbsp;network&nbsp;address&nbsp;laddr.</span><br>
<span class="lineno"></span><span class="comment" id="3567861">//&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;a&nbsp;packet-oriented&nbsp;network:&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;,</span><br>
<span class="lineno">280</span><span class="comment" id="3567930">//&nbsp;&#34;udp6&#34;,&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;,&nbsp;&#34;ip6&#34;&nbsp;or&nbsp;&#34;unixgram&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3567975">//&nbsp;See&nbsp;Dial&nbsp;for&nbsp;the&nbsp;syntax&nbsp;of&nbsp;laddr.</span><br>
<span class="lineno"></span><span class="keyword" id="3568012">func</span>&nbsp;<span class="ident" id="3568017">ListenPacket</span><span class="op" id="3568029">(</span><span class="ident" id="3568030">net</span><span class="op" id="3568033">,</span>&nbsp;<span class="ident" id="3568035">laddr</span>&nbsp;<span class="builtintype" id="3568041">string</span><span class="op" id="3568047">)</span>&nbsp;<span class="op" id="3568049">(</span><span class="ident" id="3568050">PacketConn</span><span class="op" id="3568060">,</span>&nbsp;<span class="builtintype" id="3568062">error</span><span class="op" id="3568067">)</span>&nbsp;<span class="op" id="3568069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3568072">la</span><span class="op" id="3568074">,</span>&nbsp;<span class="ident" id="3568076">err</span>&nbsp;<span class="op" id="3568080">:=</span>&nbsp;<span class="ident" id="3568083">resolveAddr</span><span class="op" id="3568094">(</span><span class="string" id="3568095">&#34;listen&#34;</span><span class="op" id="3568103">,</span>&nbsp;<span class="ident" id="3568105">net</span><span class="op" id="3568108">,</span>&nbsp;<span class="ident" id="3568110">laddr</span><span class="op" id="3568115">,</span>&nbsp;<span class="ident" id="3568117">noDeadline</span><span class="op" id="3568127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3568130">if</span>&nbsp;<span class="ident" id="3568133">err</span>&nbsp;<span class="op" id="3568137">!=</span>&nbsp;<span class="ident" id="3568140">nil</span>&nbsp;<span class="op" id="3568144">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3568148">return</span>&nbsp;<span class="ident" id="3568155">nil</span><span class="op" id="3568158">,</span>&nbsp;<span class="op" id="3568160">&amp;</span><span class="ident" id="3568161">OpError</span><span class="op" id="3568168">{</span><span class="ident" id="3568169">Op</span><span class="op" id="3568171">:</span>&nbsp;<span class="string" id="3568173">&#34;listen&#34;</span><span class="op" id="3568181">,</span>&nbsp;<span class="ident" id="3568183">Net</span><span class="op" id="3568186">:</span>&nbsp;<span class="ident" id="3568188">net</span><span class="op" id="3568191">,</span>&nbsp;<span class="ident" id="3568193">Addr</span><span class="op" id="3568197">:</span>&nbsp;<span class="ident" id="3568199">nil</span><span class="op" id="3568202">,</span>&nbsp;<span class="ident" id="3568204">Err</span><span class="op" id="3568207">:</span>&nbsp;<span class="ident" id="3568209">err</span><span class="op" id="3568212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3568215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3568218">var</span>&nbsp;<span class="ident" id="3568222">l</span>&nbsp;<span class="ident" id="3568224">PacketConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3568236">switch</span>&nbsp;<span class="ident" id="3568243">la</span>&nbsp;<span class="op" id="3568246">:=</span>&nbsp;<span class="ident" id="3568249">la</span><span class="op" id="3568251">.</span><span class="ident" id="3568252">toAddr</span><span class="op" id="3568258">(</span><span class="op" id="3568259">)</span><span class="op" id="3568260">.</span><span class="op" id="3568261">(</span><span class="keyword" id="3568262">type</span><span class="op" id="3568266">)</span>&nbsp;<span class="op" id="3568268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3568271">case</span>&nbsp;<span class="op" id="3568276">*</span><span class="ident" id="3568277">UDPAddr</span><span class="op" id="3568284">:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3568288">l</span><span class="op" id="3568289">,</span>&nbsp;<span class="ident" id="3568291">err</span>&nbsp;<span class="op" id="3568295">=</span>&nbsp;<span class="ident" id="3568297">ListenUDP</span><span class="op" id="3568306">(</span><span class="ident" id="3568307">net</span><span class="op" id="3568310">,</span>&nbsp;<span class="ident" id="3568312">la</span><span class="op" id="3568314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3568317">case</span>&nbsp;<span class="op" id="3568322">*</span><span class="ident" id="3568323">IPAddr</span><span class="op" id="3568329">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3568333">l</span><span class="op" id="3568334">,</span>&nbsp;<span class="ident" id="3568336">err</span>&nbsp;<span class="op" id="3568340">=</span>&nbsp;<span class="ident" id="3568342">ListenIP</span><span class="op" id="3568350">(</span><span class="ident" id="3568351">net</span><span class="op" id="3568354">,</span>&nbsp;<span class="ident" id="3568356">la</span><span class="op" id="3568358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3568361">case</span>&nbsp;<span class="op" id="3568366">*</span><span class="ident" id="3568367">UnixAddr</span><span class="op" id="3568375">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3568379">l</span><span class="op" id="3568380">,</span>&nbsp;<span class="ident" id="3568382">err</span>&nbsp;<span class="op" id="3568386">=</span>&nbsp;<span class="ident" id="3568388">ListenUnixgram</span><span class="op" id="3568402">(</span><span class="ident" id="3568403">net</span><span class="op" id="3568406">,</span>&nbsp;<span class="ident" id="3568408">la</span><span class="op" id="3568410">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3568413">default</span><span class="op" id="3568420">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3568424">return</span>&nbsp;<span class="ident" id="3568431">nil</span><span class="op" id="3568434">,</span>&nbsp;<span class="op" id="3568436">&amp;</span><span class="ident" id="3568437">OpError</span><span class="op" id="3568444">{</span><span class="ident" id="3568445">Op</span><span class="op" id="3568447">:</span>&nbsp;<span class="string" id="3568449">&#34;listen&#34;</span><span class="op" id="3568457">,</span>&nbsp;<span class="ident" id="3568459">Net</span><span class="op" id="3568462">:</span>&nbsp;<span class="ident" id="3568464">net</span><span class="op" id="3568467">,</span>&nbsp;<span class="ident" id="3568469">Addr</span><span class="op" id="3568473">:</span>&nbsp;<span class="ident" id="3568475">la</span><span class="op" id="3568477">,</span>&nbsp;<span class="ident" id="3568479">Err</span><span class="op" id="3568482">:</span>&nbsp;<span class="op" id="3568484">&amp;</span><span class="ident" id="3568485">AddrError</span><span class="op" id="3568494">{</span><span class="ident" id="3568495">Err</span><span class="op" id="3568498">:</span>&nbsp;<span class="string" id="3568500">&#34;unexpected&nbsp;address&nbsp;type&#34;</span><span class="op" id="3568525">,</span>&nbsp;<span class="ident" id="3568527">Addr</span><span class="op" id="3568531">:</span>&nbsp;<span class="ident" id="3568533">laddr</span><span class="op" id="3568538">}</span><span class="op" id="3568539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3568542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3568545">if</span>&nbsp;<span class="ident" id="3568548">err</span>&nbsp;<span class="op" id="3568552">!=</span>&nbsp;<span class="ident" id="3568555">nil</span>&nbsp;<span class="op" id="3568559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3568563">return</span>&nbsp;<span class="ident" id="3568570">nil</span><span class="op" id="3568573">,</span>&nbsp;<span class="ident" id="3568575">err</span>&nbsp;<span class="comment" id="3568579">//&nbsp;l&nbsp;is&nbsp;non-nil&nbsp;interface&nbsp;containing&nbsp;nil&nbsp;pointer</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3568629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3568632">return</span>&nbsp;<span class="ident" id="3568639">l</span><span class="op" id="3568640">,</span>&nbsp;<span class="ident" id="3568642">nil</span><br>
<span class="lineno"></span><span class="op" id="3568646">}</span>
</div>
</body>
</html>
