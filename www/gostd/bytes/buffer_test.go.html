<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>bytes</h2>
<ul>
<li><a href="/gostd/bytes/buffer.go.html">buffer.go</a></li>
<li><a href="/gostd/bytes/buffer_test.go.html" class="current">buffer_test.go</a></li>
<li><a href="/gostd/bytes/bytes.go.html">bytes.go</a></li>
<li><a href="/gostd/bytes/bytes_decl.go.html">bytes_decl.go</a></li>
<li><a href="/gostd/bytes/bytes_test.go.html">bytes_test.go</a></li>
<li><a href="/gostd/bytes/compare_test.go.html">compare_test.go</a></li>
<li><a href="/gostd/bytes/equal_test.go.html">equal_test.go</a></li>
<li><a href="/gostd/bytes/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/bytes/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/bytes/reader.go.html">reader.go</a></li>
<li><a href="/gostd/bytes/reader_test.go.html">reader_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="55271">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="55326">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="55380">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="55431">package</span>&nbsp;<span class="ident" id="55439">bytes_test</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="55451">import</span>&nbsp;<span class="op" id="55458">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="55461">.</span>&nbsp;<span class="string" id="55463">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="55472">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="55478">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="55491">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="55502">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="55513">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="55528">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="55531">const</span>&nbsp;<span class="ident" id="55537">N</span>&nbsp;<span class="op" id="55539">=</span>&nbsp;<span class="num" id="55541">10000</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="55552">//&nbsp;make&nbsp;this&nbsp;bigger&nbsp;for&nbsp;a&nbsp;larger&nbsp;(and&nbsp;slower)&nbsp;test</span><br>
<span class="lineno"></span><span class="keyword" id="55603">var</span>&nbsp;<span class="ident" id="55607">data</span>&nbsp;<span class="builtintype" id="55612">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="55624">//&nbsp;test&nbsp;data&nbsp;for&nbsp;write&nbsp;tests</span><br>
<span class="lineno"></span><span class="keyword" id="55653">var</span>&nbsp;<span class="ident" id="55657">testBytes</span>&nbsp;<span class="op" id="55667">[</span><span class="op" id="55668">]</span><span class="builtintype" id="55669">byte</span>&nbsp;<span class="comment" id="55674">//&nbsp;test&nbsp;data;&nbsp;same&nbsp;as&nbsp;data&nbsp;but&nbsp;as&nbsp;a&nbsp;slice.</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="55718">func</span>&nbsp;<span class="ident" id="55723">init</span><span class="op" id="55727">(</span><span class="op" id="55728">)</span>&nbsp;<span class="op" id="55730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="55733">testBytes</span>&nbsp;<span class="op" id="55743">=</span>&nbsp;<span class="builtinfunc" id="55745">make</span><span class="op" id="55749">(</span><span class="op" id="55750">[</span><span class="op" id="55751">]</span><span class="builtintype" id="55752">byte</span><span class="op" id="55756">,</span>&nbsp;<span class="ident" id="55758">N</span><span class="op" id="55759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="55762">for</span>&nbsp;<span class="ident" id="55766">i</span>&nbsp;<span class="op" id="55768">:=</span>&nbsp;<span class="num" id="55771">0</span><span class="op" id="55772">;</span>&nbsp;<span class="ident" id="55774">i</span>&nbsp;<span class="op" id="55776">&lt;</span>&nbsp;<span class="ident" id="55778">N</span><span class="op" id="55779">;</span>&nbsp;<span class="ident" id="55781">i</span><span class="op" id="55782">++</span>&nbsp;<span class="op" id="55785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="55789">testBytes</span><span class="op" id="55798">[</span><span class="ident" id="55799">i</span><span class="op" id="55800">]</span>&nbsp;<span class="op" id="55802">=</span>&nbsp;<span class="string" id="55804">&#39;a&#39;</span>&nbsp;<span class="op" id="55808">+</span>&nbsp;<span class="builtintype" id="55810">byte</span><span class="op" id="55814">(</span><span class="ident" id="55815">i</span><span class="op" id="55816">%</span><span class="num" id="55817">26</span><span class="op" id="55819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="55822">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="55825">data</span>&nbsp;<span class="op" id="55830">=</span>&nbsp;<span class="builtintype" id="55832">string</span><span class="op" id="55838">(</span><span class="ident" id="55839">testBytes</span><span class="op" id="55848">)</span><br>
<span class="lineno"></span><span class="op" id="55850">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="55853">//&nbsp;Verify&nbsp;that&nbsp;contents&nbsp;of&nbsp;buf&nbsp;match&nbsp;the&nbsp;string&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="55904">func</span>&nbsp;<span class="ident" id="55909">check</span><span class="op" id="55914">(</span><span class="ident" id="55915">t</span>&nbsp;<span class="op" id="55917">*</span><span class="ident" id="55918">testing</span><span class="op" id="55925">.</span><span class="ident" id="55926">T</span><span class="op" id="55927">,</span>&nbsp;<span class="ident" id="55929">testname</span>&nbsp;<span class="builtintype" id="55938">string</span><span class="op" id="55944">,</span>&nbsp;<span class="ident" id="55946">buf</span>&nbsp;<span class="op" id="55950">*</span><span class="ident" id="55951">Buffer</span><span class="op" id="55957">,</span>&nbsp;<span class="ident" id="55959">s</span>&nbsp;<span class="builtintype" id="55961">string</span><span class="op" id="55967">)</span>&nbsp;<span class="op" id="55969">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="55972">bytes</span>&nbsp;<span class="op" id="55978">:=</span>&nbsp;<span class="ident" id="55981">buf</span><span class="op" id="55984">.</span><span class="ident" id="55985">Bytes</span><span class="op" id="55990">(</span><span class="op" id="55991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="55994">str</span>&nbsp;<span class="op" id="55998">:=</span>&nbsp;<span class="ident" id="56001">buf</span><span class="op" id="56004">.</span><span class="ident" id="56005">String</span><span class="op" id="56011">(</span><span class="op" id="56012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="56015">if</span>&nbsp;<span class="ident" id="56018">buf</span><span class="op" id="56021">.</span><span class="ident" id="56022">Len</span><span class="op" id="56025">(</span><span class="op" id="56026">)</span>&nbsp;<span class="op" id="56028">!=</span>&nbsp;<span class="builtinfunc" id="56031">len</span><span class="op" id="56034">(</span><span class="ident" id="56035">bytes</span><span class="op" id="56040">)</span>&nbsp;<span class="op" id="56042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="56046">t</span><span class="op" id="56047">.</span><span class="ident" id="56048">Errorf</span><span class="op" id="56054">(</span><span class="string" id="56055">&#34;%s:&nbsp;buf.Len()&nbsp;==&nbsp;%d,&nbsp;len(buf.Bytes())&nbsp;==&nbsp;%d&#34;</span><span class="op" id="56100">,</span>&nbsp;<span class="ident" id="56102">testname</span><span class="op" id="56110">,</span>&nbsp;<span class="ident" id="56112">buf</span><span class="op" id="56115">.</span><span class="ident" id="56116">Len</span><span class="op" id="56119">(</span><span class="op" id="56120">)</span><span class="op" id="56121">,</span>&nbsp;<span class="builtinfunc" id="56123">len</span><span class="op" id="56126">(</span><span class="ident" id="56127">bytes</span><span class="op" id="56132">)</span><span class="op" id="56133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="56136">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="56140">if</span>&nbsp;<span class="ident" id="56143">buf</span><span class="op" id="56146">.</span><span class="ident" id="56147">Len</span><span class="op" id="56150">(</span><span class="op" id="56151">)</span>&nbsp;<span class="op" id="56153">!=</span>&nbsp;<span class="builtinfunc" id="56156">len</span><span class="op" id="56159">(</span><span class="ident" id="56160">str</span><span class="op" id="56163">)</span>&nbsp;<span class="op" id="56165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="56169">t</span><span class="op" id="56170">.</span><span class="ident" id="56171">Errorf</span><span class="op" id="56177">(</span><span class="string" id="56178">&#34;%s:&nbsp;buf.Len()&nbsp;==&nbsp;%d,&nbsp;len(buf.String())&nbsp;==&nbsp;%d&#34;</span><span class="op" id="56224">,</span>&nbsp;<span class="ident" id="56226">testname</span><span class="op" id="56234">,</span>&nbsp;<span class="ident" id="56236">buf</span><span class="op" id="56239">.</span><span class="ident" id="56240">Len</span><span class="op" id="56243">(</span><span class="op" id="56244">)</span><span class="op" id="56245">,</span>&nbsp;<span class="builtinfunc" id="56247">len</span><span class="op" id="56250">(</span><span class="ident" id="56251">str</span><span class="op" id="56254">)</span><span class="op" id="56255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="56258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="56262">if</span>&nbsp;<span class="ident" id="56265">buf</span><span class="op" id="56268">.</span><span class="ident" id="56269">Len</span><span class="op" id="56272">(</span><span class="op" id="56273">)</span>&nbsp;<span class="op" id="56275">!=</span>&nbsp;<span class="builtinfunc" id="56278">len</span><span class="op" id="56281">(</span><span class="ident" id="56282">s</span><span class="op" id="56283">)</span>&nbsp;<span class="op" id="56285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="56289">t</span><span class="op" id="56290">.</span><span class="ident" id="56291">Errorf</span><span class="op" id="56297">(</span><span class="string" id="56298">&#34;%s:&nbsp;buf.Len()&nbsp;==&nbsp;%d,&nbsp;len(s)&nbsp;==&nbsp;%d&#34;</span><span class="op" id="56333">,</span>&nbsp;<span class="ident" id="56335">testname</span><span class="op" id="56343">,</span>&nbsp;<span class="ident" id="56345">buf</span><span class="op" id="56348">.</span><span class="ident" id="56349">Len</span><span class="op" id="56352">(</span><span class="op" id="56353">)</span><span class="op" id="56354">,</span>&nbsp;<span class="builtinfunc" id="56356">len</span><span class="op" id="56359">(</span><span class="ident" id="56360">s</span><span class="op" id="56361">)</span><span class="op" id="56362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="56365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="56369">if</span>&nbsp;<span class="builtintype" id="56372">string</span><span class="op" id="56378">(</span><span class="ident" id="56379">bytes</span><span class="op" id="56384">)</span>&nbsp;<span class="op" id="56386">!=</span>&nbsp;<span class="ident" id="56389">s</span>&nbsp;<span class="op" id="56391">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="56395">t</span><span class="op" id="56396">.</span><span class="ident" id="56397">Errorf</span><span class="op" id="56403">(</span><span class="string" id="56404">&#34;%s:&nbsp;string(buf.Bytes())&nbsp;==&nbsp;%q,&nbsp;s&nbsp;==&nbsp;%q&#34;</span><span class="op" id="56444">,</span>&nbsp;<span class="ident" id="56446">testname</span><span class="op" id="56454">,</span>&nbsp;<span class="builtintype" id="56456">string</span><span class="op" id="56462">(</span><span class="ident" id="56463">bytes</span><span class="op" id="56468">)</span><span class="op" id="56469">,</span>&nbsp;<span class="ident" id="56471">s</span><span class="op" id="56472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="56475">}</span><br>
<span class="lineno"></span><span class="op" id="56477">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="56480">//&nbsp;Fill&nbsp;buf&nbsp;through&nbsp;n&nbsp;writes&nbsp;of&nbsp;string&nbsp;fus.</span><br>
<span class="lineno">50</span><span class="comment" id="56524">//&nbsp;The&nbsp;initial&nbsp;contents&nbsp;of&nbsp;buf&nbsp;corresponds&nbsp;to&nbsp;the&nbsp;string&nbsp;s;</span><br>
<span class="lineno"></span><span class="comment" id="56584">//&nbsp;the&nbsp;result&nbsp;is&nbsp;the&nbsp;final&nbsp;contents&nbsp;of&nbsp;buf&nbsp;returned&nbsp;as&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="56649">func</span>&nbsp;<span class="ident" id="56654">fillString</span><span class="op" id="56664">(</span><span class="ident" id="56665">t</span>&nbsp;<span class="op" id="56667">*</span><span class="ident" id="56668">testing</span><span class="op" id="56675">.</span><span class="ident" id="56676">T</span><span class="op" id="56677">,</span>&nbsp;<span class="ident" id="56679">testname</span>&nbsp;<span class="builtintype" id="56688">string</span><span class="op" id="56694">,</span>&nbsp;<span class="ident" id="56696">buf</span>&nbsp;<span class="op" id="56700">*</span><span class="ident" id="56701">Buffer</span><span class="op" id="56707">,</span>&nbsp;<span class="ident" id="56709">s</span>&nbsp;<span class="builtintype" id="56711">string</span><span class="op" id="56717">,</span>&nbsp;<span class="ident" id="56719">n</span>&nbsp;<span class="builtintype" id="56721">int</span><span class="op" id="56724">,</span>&nbsp;<span class="ident" id="56726">fus</span>&nbsp;<span class="builtintype" id="56730">string</span><span class="op" id="56736">)</span>&nbsp;<span class="builtintype" id="56738">string</span>&nbsp;<span class="op" id="56745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="56748">check</span><span class="op" id="56753">(</span><span class="ident" id="56754">t</span><span class="op" id="56755">,</span>&nbsp;<span class="ident" id="56757">testname</span><span class="op" id="56765">+</span><span class="string" id="56766">&#34;&nbsp;(fill&nbsp;1)&#34;</span><span class="op" id="56777">,</span>&nbsp;<span class="ident" id="56779">buf</span><span class="op" id="56782">,</span>&nbsp;<span class="ident" id="56784">s</span><span class="op" id="56785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="56788">for</span>&nbsp;<span class="op" id="56792">;</span>&nbsp;<span class="ident" id="56794">n</span>&nbsp;<span class="op" id="56796">&gt;</span>&nbsp;<span class="num" id="56798">0</span><span class="op" id="56799">;</span>&nbsp;<span class="ident" id="56801">n</span><span class="op" id="56802">--</span>&nbsp;<span class="op" id="56805">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="56809">m</span><span class="op" id="56810">,</span>&nbsp;<span class="ident" id="56812">err</span>&nbsp;<span class="op" id="56816">:=</span>&nbsp;<span class="ident" id="56819">buf</span><span class="op" id="56822">.</span><span class="ident" id="56823">WriteString</span><span class="op" id="56834">(</span><span class="ident" id="56835">fus</span><span class="op" id="56838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="56842">if</span>&nbsp;<span class="ident" id="56845">m</span>&nbsp;<span class="op" id="56847">!=</span>&nbsp;<span class="builtinfunc" id="56850">len</span><span class="op" id="56853">(</span><span class="ident" id="56854">fus</span><span class="op" id="56857">)</span>&nbsp;<span class="op" id="56859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="56864">t</span><span class="op" id="56865">.</span><span class="ident" id="56866">Errorf</span><span class="op" id="56872">(</span><span class="ident" id="56873">testname</span><span class="op" id="56881">+</span><span class="string" id="56882">&#34;&nbsp;(fill&nbsp;2):&nbsp;m&nbsp;==&nbsp;%d,&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="56915">,</span>&nbsp;<span class="ident" id="56917">m</span><span class="op" id="56918">,</span>&nbsp;<span class="builtinfunc" id="56920">len</span><span class="op" id="56923">(</span><span class="ident" id="56924">fus</span><span class="op" id="56927">)</span><span class="op" id="56928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="56932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="56936">if</span>&nbsp;<span class="ident" id="56939">err</span>&nbsp;<span class="op" id="56943">!=</span>&nbsp;<span class="ident" id="56946">nil</span>&nbsp;<span class="op" id="56950">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="56955">t</span><span class="op" id="56956">.</span><span class="ident" id="56957">Errorf</span><span class="op" id="56963">(</span><span class="ident" id="56964">testname</span><span class="op" id="56972">+</span><span class="string" id="56973">&#34;&nbsp;(fill&nbsp;3):&nbsp;err&nbsp;should&nbsp;always&nbsp;be&nbsp;nil,&nbsp;found&nbsp;err&nbsp;==&nbsp;%s&#34;</span><span class="op" id="57027">,</span>&nbsp;<span class="ident" id="57029">err</span><span class="op" id="57032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="57036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="57040">s</span>&nbsp;<span class="op" id="57042">+=</span>&nbsp;<span class="ident" id="57045">fus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="57051">check</span><span class="op" id="57056">(</span><span class="ident" id="57057">t</span><span class="op" id="57058">,</span>&nbsp;<span class="ident" id="57060">testname</span><span class="op" id="57068">+</span><span class="string" id="57069">&#34;&nbsp;(fill&nbsp;4)&#34;</span><span class="op" id="57080">,</span>&nbsp;<span class="ident" id="57082">buf</span><span class="op" id="57085">,</span>&nbsp;<span class="ident" id="57087">s</span><span class="op" id="57088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="57091">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="57094">return</span>&nbsp;<span class="ident" id="57101">s</span><br>
<span class="lineno"></span><span class="op" id="57103">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="57106">//&nbsp;Fill&nbsp;buf&nbsp;through&nbsp;n&nbsp;writes&nbsp;of&nbsp;byte&nbsp;slice&nbsp;fub.</span><br>
<span class="lineno"></span><span class="comment" id="57154">//&nbsp;The&nbsp;initial&nbsp;contents&nbsp;of&nbsp;buf&nbsp;corresponds&nbsp;to&nbsp;the&nbsp;string&nbsp;s;</span><br>
<span class="lineno">70</span><span class="comment" id="57214">//&nbsp;the&nbsp;result&nbsp;is&nbsp;the&nbsp;final&nbsp;contents&nbsp;of&nbsp;buf&nbsp;returned&nbsp;as&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="57279">func</span>&nbsp;<span class="ident" id="57284">fillBytes</span><span class="op" id="57293">(</span><span class="ident" id="57294">t</span>&nbsp;<span class="op" id="57296">*</span><span class="ident" id="57297">testing</span><span class="op" id="57304">.</span><span class="ident" id="57305">T</span><span class="op" id="57306">,</span>&nbsp;<span class="ident" id="57308">testname</span>&nbsp;<span class="builtintype" id="57317">string</span><span class="op" id="57323">,</span>&nbsp;<span class="ident" id="57325">buf</span>&nbsp;<span class="op" id="57329">*</span><span class="ident" id="57330">Buffer</span><span class="op" id="57336">,</span>&nbsp;<span class="ident" id="57338">s</span>&nbsp;<span class="builtintype" id="57340">string</span><span class="op" id="57346">,</span>&nbsp;<span class="ident" id="57348">n</span>&nbsp;<span class="builtintype" id="57350">int</span><span class="op" id="57353">,</span>&nbsp;<span class="ident" id="57355">fub</span>&nbsp;<span class="op" id="57359">[</span><span class="op" id="57360">]</span><span class="builtintype" id="57361">byte</span><span class="op" id="57365">)</span>&nbsp;<span class="builtintype" id="57367">string</span>&nbsp;<span class="op" id="57374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="57377">check</span><span class="op" id="57382">(</span><span class="ident" id="57383">t</span><span class="op" id="57384">,</span>&nbsp;<span class="ident" id="57386">testname</span><span class="op" id="57394">+</span><span class="string" id="57395">&#34;&nbsp;(fill&nbsp;1)&#34;</span><span class="op" id="57406">,</span>&nbsp;<span class="ident" id="57408">buf</span><span class="op" id="57411">,</span>&nbsp;<span class="ident" id="57413">s</span><span class="op" id="57414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="57417">for</span>&nbsp;<span class="op" id="57421">;</span>&nbsp;<span class="ident" id="57423">n</span>&nbsp;<span class="op" id="57425">&gt;</span>&nbsp;<span class="num" id="57427">0</span><span class="op" id="57428">;</span>&nbsp;<span class="ident" id="57430">n</span><span class="op" id="57431">--</span>&nbsp;<span class="op" id="57434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="57438">m</span><span class="op" id="57439">,</span>&nbsp;<span class="ident" id="57441">err</span>&nbsp;<span class="op" id="57445">:=</span>&nbsp;<span class="ident" id="57448">buf</span><span class="op" id="57451">.</span><span class="ident" id="57452">Write</span><span class="op" id="57457">(</span><span class="ident" id="57458">fub</span><span class="op" id="57461">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="57465">if</span>&nbsp;<span class="ident" id="57468">m</span>&nbsp;<span class="op" id="57470">!=</span>&nbsp;<span class="builtinfunc" id="57473">len</span><span class="op" id="57476">(</span><span class="ident" id="57477">fub</span><span class="op" id="57480">)</span>&nbsp;<span class="op" id="57482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="57487">t</span><span class="op" id="57488">.</span><span class="ident" id="57489">Errorf</span><span class="op" id="57495">(</span><span class="ident" id="57496">testname</span><span class="op" id="57504">+</span><span class="string" id="57505">&#34;&nbsp;(fill&nbsp;2):&nbsp;m&nbsp;==&nbsp;%d,&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="57538">,</span>&nbsp;<span class="ident" id="57540">m</span><span class="op" id="57541">,</span>&nbsp;<span class="builtinfunc" id="57543">len</span><span class="op" id="57546">(</span><span class="ident" id="57547">fub</span><span class="op" id="57550">)</span><span class="op" id="57551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="57555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="57559">if</span>&nbsp;<span class="ident" id="57562">err</span>&nbsp;<span class="op" id="57566">!=</span>&nbsp;<span class="ident" id="57569">nil</span>&nbsp;<span class="op" id="57573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="57578">t</span><span class="op" id="57579">.</span><span class="ident" id="57580">Errorf</span><span class="op" id="57586">(</span><span class="ident" id="57587">testname</span><span class="op" id="57595">+</span><span class="string" id="57596">&#34;&nbsp;(fill&nbsp;3):&nbsp;err&nbsp;should&nbsp;always&nbsp;be&nbsp;nil,&nbsp;found&nbsp;err&nbsp;==&nbsp;%s&#34;</span><span class="op" id="57650">,</span>&nbsp;<span class="ident" id="57652">err</span><span class="op" id="57655">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="57659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="57663">s</span>&nbsp;<span class="op" id="57665">+=</span>&nbsp;<span class="builtintype" id="57668">string</span><span class="op" id="57674">(</span><span class="ident" id="57675">fub</span><span class="op" id="57678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="57682">check</span><span class="op" id="57687">(</span><span class="ident" id="57688">t</span><span class="op" id="57689">,</span>&nbsp;<span class="ident" id="57691">testname</span><span class="op" id="57699">+</span><span class="string" id="57700">&#34;&nbsp;(fill&nbsp;4)&#34;</span><span class="op" id="57711">,</span>&nbsp;<span class="ident" id="57713">buf</span><span class="op" id="57716">,</span>&nbsp;<span class="ident" id="57718">s</span><span class="op" id="57719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="57722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="57725">return</span>&nbsp;<span class="ident" id="57732">s</span><br>
<span class="lineno">85</span><span class="op" id="57734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="57737">func</span>&nbsp;<span class="ident" id="57742">TestNewBuffer</span><span class="op" id="57755">(</span><span class="ident" id="57756">t</span>&nbsp;<span class="op" id="57758">*</span><span class="ident" id="57759">testing</span><span class="op" id="57766">.</span><span class="ident" id="57767">T</span><span class="op" id="57768">)</span>&nbsp;<span class="op" id="57770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="57773">buf</span>&nbsp;<span class="op" id="57777">:=</span>&nbsp;<span class="ident" id="57780">NewBuffer</span><span class="op" id="57789">(</span><span class="ident" id="57790">testBytes</span><span class="op" id="57799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="57802">check</span><span class="op" id="57807">(</span><span class="ident" id="57808">t</span><span class="op" id="57809">,</span>&nbsp;<span class="string" id="57811">&#34;NewBuffer&#34;</span><span class="op" id="57822">,</span>&nbsp;<span class="ident" id="57824">buf</span><span class="op" id="57827">,</span>&nbsp;<span class="ident" id="57829">data</span><span class="op" id="57833">)</span><br>
<span class="lineno">90</span><span class="op" id="57835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="57838">func</span>&nbsp;<span class="ident" id="57843">TestNewBufferString</span><span class="op" id="57862">(</span><span class="ident" id="57863">t</span>&nbsp;<span class="op" id="57865">*</span><span class="ident" id="57866">testing</span><span class="op" id="57873">.</span><span class="ident" id="57874">T</span><span class="op" id="57875">)</span>&nbsp;<span class="op" id="57877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="57880">buf</span>&nbsp;<span class="op" id="57884">:=</span>&nbsp;<span class="ident" id="57887">NewBufferString</span><span class="op" id="57902">(</span><span class="ident" id="57903">data</span><span class="op" id="57907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="57910">check</span><span class="op" id="57915">(</span><span class="ident" id="57916">t</span><span class="op" id="57917">,</span>&nbsp;<span class="string" id="57919">&#34;NewBufferString&#34;</span><span class="op" id="57936">,</span>&nbsp;<span class="ident" id="57938">buf</span><span class="op" id="57941">,</span>&nbsp;<span class="ident" id="57943">data</span><span class="op" id="57947">)</span><br>
<span class="lineno">95</span><span class="op" id="57949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="57952">//&nbsp;Empty&nbsp;buf&nbsp;through&nbsp;repeated&nbsp;reads&nbsp;into&nbsp;fub.</span><br>
<span class="lineno"></span><span class="comment" id="57998">//&nbsp;The&nbsp;initial&nbsp;contents&nbsp;of&nbsp;buf&nbsp;corresponds&nbsp;to&nbsp;the&nbsp;string&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="58058">func</span>&nbsp;<span class="ident" id="58063">empty</span><span class="op" id="58068">(</span><span class="ident" id="58069">t</span>&nbsp;<span class="op" id="58071">*</span><span class="ident" id="58072">testing</span><span class="op" id="58079">.</span><span class="ident" id="58080">T</span><span class="op" id="58081">,</span>&nbsp;<span class="ident" id="58083">testname</span>&nbsp;<span class="builtintype" id="58092">string</span><span class="op" id="58098">,</span>&nbsp;<span class="ident" id="58100">buf</span>&nbsp;<span class="op" id="58104">*</span><span class="ident" id="58105">Buffer</span><span class="op" id="58111">,</span>&nbsp;<span class="ident" id="58113">s</span>&nbsp;<span class="builtintype" id="58115">string</span><span class="op" id="58121">,</span>&nbsp;<span class="ident" id="58123">fub</span>&nbsp;<span class="op" id="58127">[</span><span class="op" id="58128">]</span><span class="builtintype" id="58129">byte</span><span class="op" id="58133">)</span>&nbsp;<span class="op" id="58135">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="58138">check</span><span class="op" id="58143">(</span><span class="ident" id="58144">t</span><span class="op" id="58145">,</span>&nbsp;<span class="ident" id="58147">testname</span><span class="op" id="58155">+</span><span class="string" id="58156">&#34;&nbsp;(empty&nbsp;1)&#34;</span><span class="op" id="58168">,</span>&nbsp;<span class="ident" id="58170">buf</span><span class="op" id="58173">,</span>&nbsp;<span class="ident" id="58175">s</span><span class="op" id="58176">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="58180">for</span>&nbsp;<span class="op" id="58184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="58188">n</span><span class="op" id="58189">,</span>&nbsp;<span class="ident" id="58191">err</span>&nbsp;<span class="op" id="58195">:=</span>&nbsp;<span class="ident" id="58198">buf</span><span class="op" id="58201">.</span><span class="ident" id="58202">Read</span><span class="op" id="58206">(</span><span class="ident" id="58207">fub</span><span class="op" id="58210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="58214">if</span>&nbsp;<span class="ident" id="58217">n</span>&nbsp;<span class="op" id="58219">==</span>&nbsp;<span class="num" id="58222">0</span>&nbsp;<span class="op" id="58224">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="58229">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="58237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="58241">if</span>&nbsp;<span class="ident" id="58244">err</span>&nbsp;<span class="op" id="58248">!=</span>&nbsp;<span class="ident" id="58251">nil</span>&nbsp;<span class="op" id="58255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="58260">t</span><span class="op" id="58261">.</span><span class="ident" id="58262">Errorf</span><span class="op" id="58268">(</span><span class="ident" id="58269">testname</span><span class="op" id="58277">+</span><span class="string" id="58278">&#34;&nbsp;(empty&nbsp;2):&nbsp;err&nbsp;should&nbsp;always&nbsp;be&nbsp;nil,&nbsp;found&nbsp;err&nbsp;==&nbsp;%s&#34;</span><span class="op" id="58333">,</span>&nbsp;<span class="ident" id="58335">err</span><span class="op" id="58338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="58342">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="58346">s</span>&nbsp;<span class="op" id="58348">=</span>&nbsp;<span class="ident" id="58350">s</span><span class="op" id="58351">[</span><span class="ident" id="58352">n</span><span class="op" id="58353">:</span><span class="op" id="58354">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="58358">check</span><span class="op" id="58363">(</span><span class="ident" id="58364">t</span><span class="op" id="58365">,</span>&nbsp;<span class="ident" id="58367">testname</span><span class="op" id="58375">+</span><span class="string" id="58376">&#34;&nbsp;(empty&nbsp;3)&#34;</span><span class="op" id="58388">,</span>&nbsp;<span class="ident" id="58390">buf</span><span class="op" id="58393">,</span>&nbsp;<span class="ident" id="58395">s</span><span class="op" id="58396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="58399">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="58403">check</span><span class="op" id="58408">(</span><span class="ident" id="58409">t</span><span class="op" id="58410">,</span>&nbsp;<span class="ident" id="58412">testname</span><span class="op" id="58420">+</span><span class="string" id="58421">&#34;&nbsp;(empty&nbsp;4)&#34;</span><span class="op" id="58433">,</span>&nbsp;<span class="ident" id="58435">buf</span><span class="op" id="58438">,</span>&nbsp;<span class="string" id="58440">&#34;&#34;</span><span class="op" id="58442">)</span><br>
<span class="lineno">115</span><span class="op" id="58444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="58447">func</span>&nbsp;<span class="ident" id="58452">TestBasicOperations</span><span class="op" id="58471">(</span><span class="ident" id="58472">t</span>&nbsp;<span class="op" id="58474">*</span><span class="ident" id="58475">testing</span><span class="op" id="58482">.</span><span class="ident" id="58483">T</span><span class="op" id="58484">)</span>&nbsp;<span class="op" id="58486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="58489">var</span>&nbsp;<span class="ident" id="58493">buf</span>&nbsp;<span class="ident" id="58497">Buffer</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="58506">for</span>&nbsp;<span class="ident" id="58510">i</span>&nbsp;<span class="op" id="58512">:=</span>&nbsp;<span class="num" id="58515">0</span><span class="op" id="58516">;</span>&nbsp;<span class="ident" id="58518">i</span>&nbsp;<span class="op" id="58520">&lt;</span>&nbsp;<span class="num" id="58522">5</span><span class="op" id="58523">;</span>&nbsp;<span class="ident" id="58525">i</span><span class="op" id="58526">++</span>&nbsp;<span class="op" id="58529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="58533">check</span><span class="op" id="58538">(</span><span class="ident" id="58539">t</span><span class="op" id="58540">,</span>&nbsp;<span class="string" id="58542">&#34;TestBasicOperations&nbsp;(1)&#34;</span><span class="op" id="58567">,</span>&nbsp;<span class="op" id="58569">&amp;</span><span class="ident" id="58570">buf</span><span class="op" id="58573">,</span>&nbsp;<span class="string" id="58575">&#34;&#34;</span><span class="op" id="58577">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="58582">buf</span><span class="op" id="58585">.</span><span class="ident" id="58586">Reset</span><span class="op" id="58591">(</span><span class="op" id="58592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="58596">check</span><span class="op" id="58601">(</span><span class="ident" id="58602">t</span><span class="op" id="58603">,</span>&nbsp;<span class="string" id="58605">&#34;TestBasicOperations&nbsp;(2)&#34;</span><span class="op" id="58630">,</span>&nbsp;<span class="op" id="58632">&amp;</span><span class="ident" id="58633">buf</span><span class="op" id="58636">,</span>&nbsp;<span class="string" id="58638">&#34;&#34;</span><span class="op" id="58640">)</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="58645">buf</span><span class="op" id="58648">.</span><span class="ident" id="58649">Truncate</span><span class="op" id="58657">(</span><span class="num" id="58658">0</span><span class="op" id="58659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="58663">check</span><span class="op" id="58668">(</span><span class="ident" id="58669">t</span><span class="op" id="58670">,</span>&nbsp;<span class="string" id="58672">&#34;TestBasicOperations&nbsp;(3)&#34;</span><span class="op" id="58697">,</span>&nbsp;<span class="op" id="58699">&amp;</span><span class="ident" id="58700">buf</span><span class="op" id="58703">,</span>&nbsp;<span class="string" id="58705">&#34;&#34;</span><span class="op" id="58707">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="58712">n</span><span class="op" id="58713">,</span>&nbsp;<span class="ident" id="58715">err</span>&nbsp;<span class="op" id="58719">:=</span>&nbsp;<span class="ident" id="58722">buf</span><span class="op" id="58725">.</span><span class="ident" id="58726">Write</span><span class="op" id="58731">(</span><span class="op" id="58732">[</span><span class="op" id="58733">]</span><span class="builtintype" id="58734">byte</span><span class="op" id="58738">(</span><span class="ident" id="58739">data</span><span class="op" id="58743">[</span><span class="num" id="58744">0</span><span class="op" id="58745">:</span><span class="num" id="58746">1</span><span class="op" id="58747">]</span><span class="op" id="58748">)</span><span class="op" id="58749">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="58753">if</span>&nbsp;<span class="ident" id="58756">n</span>&nbsp;<span class="op" id="58758">!=</span>&nbsp;<span class="num" id="58761">1</span>&nbsp;<span class="op" id="58763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="58768">t</span><span class="op" id="58769">.</span><span class="ident" id="58770">Errorf</span><span class="op" id="58776">(</span><span class="string" id="58777">&#34;wrote&nbsp;1&nbsp;byte,&nbsp;but&nbsp;n&nbsp;==&nbsp;%d&#34;</span><span class="op" id="58804">,</span>&nbsp;<span class="ident" id="58806">n</span><span class="op" id="58807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="58811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="58815">if</span>&nbsp;<span class="ident" id="58818">err</span>&nbsp;<span class="op" id="58822">!=</span>&nbsp;<span class="ident" id="58825">nil</span>&nbsp;<span class="op" id="58829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="58834">t</span><span class="op" id="58835">.</span><span class="ident" id="58836">Errorf</span><span class="op" id="58842">(</span><span class="string" id="58843">&#34;err&nbsp;should&nbsp;always&nbsp;be&nbsp;nil,&nbsp;but&nbsp;err&nbsp;==&nbsp;%s&#34;</span><span class="op" id="58884">,</span>&nbsp;<span class="ident" id="58886">err</span><span class="op" id="58889">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="58893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="58897">check</span><span class="op" id="58902">(</span><span class="ident" id="58903">t</span><span class="op" id="58904">,</span>&nbsp;<span class="string" id="58906">&#34;TestBasicOperations&nbsp;(4)&#34;</span><span class="op" id="58931">,</span>&nbsp;<span class="op" id="58933">&amp;</span><span class="ident" id="58934">buf</span><span class="op" id="58937">,</span>&nbsp;<span class="string" id="58939">&#34;a&#34;</span><span class="op" id="58942">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="58947">buf</span><span class="op" id="58950">.</span><span class="ident" id="58951">WriteByte</span><span class="op" id="58960">(</span><span class="ident" id="58961">data</span><span class="op" id="58965">[</span><span class="num" id="58966">1</span><span class="op" id="58967">]</span><span class="op" id="58968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="58972">check</span><span class="op" id="58977">(</span><span class="ident" id="58978">t</span><span class="op" id="58979">,</span>&nbsp;<span class="string" id="58981">&#34;TestBasicOperations&nbsp;(5)&#34;</span><span class="op" id="59006">,</span>&nbsp;<span class="op" id="59008">&amp;</span><span class="ident" id="59009">buf</span><span class="op" id="59012">,</span>&nbsp;<span class="string" id="59014">&#34;ab&#34;</span><span class="op" id="59018">)</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="59023">n</span><span class="op" id="59024">,</span>&nbsp;<span class="ident" id="59026">err</span>&nbsp;<span class="op" id="59030">=</span>&nbsp;<span class="ident" id="59032">buf</span><span class="op" id="59035">.</span><span class="ident" id="59036">Write</span><span class="op" id="59041">(</span><span class="op" id="59042">[</span><span class="op" id="59043">]</span><span class="builtintype" id="59044">byte</span><span class="op" id="59048">(</span><span class="ident" id="59049">data</span><span class="op" id="59053">[</span><span class="num" id="59054">2</span><span class="op" id="59055">:</span><span class="num" id="59056">26</span><span class="op" id="59058">]</span><span class="op" id="59059">)</span><span class="op" id="59060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="59064">if</span>&nbsp;<span class="ident" id="59067">n</span>&nbsp;<span class="op" id="59069">!=</span>&nbsp;<span class="num" id="59072">24</span>&nbsp;<span class="op" id="59075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="59080">t</span><span class="op" id="59081">.</span><span class="ident" id="59082">Errorf</span><span class="op" id="59088">(</span><span class="string" id="59089">&#34;wrote&nbsp;25&nbsp;bytes,&nbsp;but&nbsp;n&nbsp;==&nbsp;%d&#34;</span><span class="op" id="59118">,</span>&nbsp;<span class="ident" id="59120">n</span><span class="op" id="59121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="59125">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="59129">check</span><span class="op" id="59134">(</span><span class="ident" id="59135">t</span><span class="op" id="59136">,</span>&nbsp;<span class="string" id="59138">&#34;TestBasicOperations&nbsp;(6)&#34;</span><span class="op" id="59163">,</span>&nbsp;<span class="op" id="59165">&amp;</span><span class="ident" id="59166">buf</span><span class="op" id="59169">,</span>&nbsp;<span class="builtintype" id="59171">string</span><span class="op" id="59177">(</span><span class="ident" id="59178">data</span><span class="op" id="59182">[</span><span class="num" id="59183">0</span><span class="op" id="59184">:</span><span class="num" id="59185">26</span><span class="op" id="59187">]</span><span class="op" id="59188">)</span><span class="op" id="59189">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="59194">buf</span><span class="op" id="59197">.</span><span class="ident" id="59198">Truncate</span><span class="op" id="59206">(</span><span class="num" id="59207">26</span><span class="op" id="59209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="59213">check</span><span class="op" id="59218">(</span><span class="ident" id="59219">t</span><span class="op" id="59220">,</span>&nbsp;<span class="string" id="59222">&#34;TestBasicOperations&nbsp;(7)&#34;</span><span class="op" id="59247">,</span>&nbsp;<span class="op" id="59249">&amp;</span><span class="ident" id="59250">buf</span><span class="op" id="59253">,</span>&nbsp;<span class="builtintype" id="59255">string</span><span class="op" id="59261">(</span><span class="ident" id="59262">data</span><span class="op" id="59266">[</span><span class="num" id="59267">0</span><span class="op" id="59268">:</span><span class="num" id="59269">26</span><span class="op" id="59271">]</span><span class="op" id="59272">)</span><span class="op" id="59273">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="59278">buf</span><span class="op" id="59281">.</span><span class="ident" id="59282">Truncate</span><span class="op" id="59290">(</span><span class="num" id="59291">20</span><span class="op" id="59293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="59297">check</span><span class="op" id="59302">(</span><span class="ident" id="59303">t</span><span class="op" id="59304">,</span>&nbsp;<span class="string" id="59306">&#34;TestBasicOperations&nbsp;(8)&#34;</span><span class="op" id="59331">,</span>&nbsp;<span class="op" id="59333">&amp;</span><span class="ident" id="59334">buf</span><span class="op" id="59337">,</span>&nbsp;<span class="builtintype" id="59339">string</span><span class="op" id="59345">(</span><span class="ident" id="59346">data</span><span class="op" id="59350">[</span><span class="num" id="59351">0</span><span class="op" id="59352">:</span><span class="num" id="59353">20</span><span class="op" id="59355">]</span><span class="op" id="59356">)</span><span class="op" id="59357">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="59362">empty</span><span class="op" id="59367">(</span><span class="ident" id="59368">t</span><span class="op" id="59369">,</span>&nbsp;<span class="string" id="59371">&#34;TestBasicOperations&nbsp;(9)&#34;</span><span class="op" id="59396">,</span>&nbsp;<span class="op" id="59398">&amp;</span><span class="ident" id="59399">buf</span><span class="op" id="59402">,</span>&nbsp;<span class="builtintype" id="59404">string</span><span class="op" id="59410">(</span><span class="ident" id="59411">data</span><span class="op" id="59415">[</span><span class="num" id="59416">0</span><span class="op" id="59417">:</span><span class="num" id="59418">20</span><span class="op" id="59420">]</span><span class="op" id="59421">)</span><span class="op" id="59422">,</span>&nbsp;<span class="builtinfunc" id="59424">make</span><span class="op" id="59428">(</span><span class="op" id="59429">[</span><span class="op" id="59430">]</span><span class="builtintype" id="59431">byte</span><span class="op" id="59435">,</span>&nbsp;<span class="num" id="59437">5</span><span class="op" id="59438">)</span><span class="op" id="59439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="59443">empty</span><span class="op" id="59448">(</span><span class="ident" id="59449">t</span><span class="op" id="59450">,</span>&nbsp;<span class="string" id="59452">&#34;TestBasicOperations&nbsp;(10)&#34;</span><span class="op" id="59478">,</span>&nbsp;<span class="op" id="59480">&amp;</span><span class="ident" id="59481">buf</span><span class="op" id="59484">,</span>&nbsp;<span class="string" id="59486">&#34;&#34;</span><span class="op" id="59488">,</span>&nbsp;<span class="builtinfunc" id="59490">make</span><span class="op" id="59494">(</span><span class="op" id="59495">[</span><span class="op" id="59496">]</span><span class="builtintype" id="59497">byte</span><span class="op" id="59501">,</span>&nbsp;<span class="num" id="59503">100</span><span class="op" id="59506">)</span><span class="op" id="59507">)</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="59512">buf</span><span class="op" id="59515">.</span><span class="ident" id="59516">WriteByte</span><span class="op" id="59525">(</span><span class="ident" id="59526">data</span><span class="op" id="59530">[</span><span class="num" id="59531">1</span><span class="op" id="59532">]</span><span class="op" id="59533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="59537">c</span><span class="op" id="59538">,</span>&nbsp;<span class="ident" id="59540">err</span>&nbsp;<span class="op" id="59544">:=</span>&nbsp;<span class="ident" id="59547">buf</span><span class="op" id="59550">.</span><span class="ident" id="59551">ReadByte</span><span class="op" id="59559">(</span><span class="op" id="59560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="59564">if</span>&nbsp;<span class="ident" id="59567">err</span>&nbsp;<span class="op" id="59571">!=</span>&nbsp;<span class="ident" id="59574">nil</span>&nbsp;<span class="op" id="59578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="59583">t</span><span class="op" id="59584">.</span><span class="ident" id="59585">Error</span><span class="op" id="59590">(</span><span class="string" id="59591">&#34;ReadByte&nbsp;unexpected&nbsp;eof&#34;</span><span class="op" id="59616">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="59620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="59624">if</span>&nbsp;<span class="ident" id="59627">c</span>&nbsp;<span class="op" id="59629">!=</span>&nbsp;<span class="ident" id="59632">data</span><span class="op" id="59636">[</span><span class="num" id="59637">1</span><span class="op" id="59638">]</span>&nbsp;<span class="op" id="59640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="59645">t</span><span class="op" id="59646">.</span><span class="ident" id="59647">Errorf</span><span class="op" id="59653">(</span><span class="string" id="59654">&#34;ReadByte&nbsp;wrong&nbsp;value&nbsp;c=%v&#34;</span><span class="op" id="59681">,</span>&nbsp;<span class="ident" id="59683">c</span><span class="op" id="59684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="59688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="59692">c</span><span class="op" id="59693">,</span>&nbsp;<span class="ident" id="59695">err</span>&nbsp;<span class="op" id="59699">=</span>&nbsp;<span class="ident" id="59701">buf</span><span class="op" id="59704">.</span><span class="ident" id="59705">ReadByte</span><span class="op" id="59713">(</span><span class="op" id="59714">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="59718">if</span>&nbsp;<span class="ident" id="59721">err</span>&nbsp;<span class="op" id="59725">==</span>&nbsp;<span class="ident" id="59728">nil</span>&nbsp;<span class="op" id="59732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="59737">t</span><span class="op" id="59738">.</span><span class="ident" id="59739">Error</span><span class="op" id="59744">(</span><span class="string" id="59745">&#34;ReadByte&nbsp;unexpected&nbsp;not&nbsp;eof&#34;</span><span class="op" id="59774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="59778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="59781">}</span><br>
<span class="lineno"></span><span class="op" id="59783">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="59786">func</span>&nbsp;<span class="ident" id="59791">TestLargeStringWrites</span><span class="op" id="59812">(</span><span class="ident" id="59813">t</span>&nbsp;<span class="op" id="59815">*</span><span class="ident" id="59816">testing</span><span class="op" id="59823">.</span><span class="ident" id="59824">T</span><span class="op" id="59825">)</span>&nbsp;<span class="op" id="59827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="59830">var</span>&nbsp;<span class="ident" id="59834">buf</span>&nbsp;<span class="ident" id="59838">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="59846">limit</span>&nbsp;<span class="op" id="59852">:=</span>&nbsp;<span class="num" id="59855">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="59859">if</span>&nbsp;<span class="ident" id="59862">testing</span><span class="op" id="59869">.</span><span class="ident" id="59870">Short</span><span class="op" id="59875">(</span><span class="op" id="59876">)</span>&nbsp;<span class="op" id="59878">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="59882">limit</span>&nbsp;<span class="op" id="59888">=</span>&nbsp;<span class="num" id="59890">9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="59893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="59896">for</span>&nbsp;<span class="ident" id="59900">i</span>&nbsp;<span class="op" id="59902">:=</span>&nbsp;<span class="num" id="59905">3</span><span class="op" id="59906">;</span>&nbsp;<span class="ident" id="59908">i</span>&nbsp;<span class="op" id="59910">&lt;</span>&nbsp;<span class="ident" id="59912">limit</span><span class="op" id="59917">;</span>&nbsp;<span class="ident" id="59919">i</span>&nbsp;<span class="op" id="59921">+=</span>&nbsp;<span class="num" id="59924">3</span>&nbsp;<span class="op" id="59926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="59930">s</span>&nbsp;<span class="op" id="59932">:=</span>&nbsp;<span class="ident" id="59935">fillString</span><span class="op" id="59945">(</span><span class="ident" id="59946">t</span><span class="op" id="59947">,</span>&nbsp;<span class="string" id="59949">&#34;TestLargeWrites&nbsp;(1)&#34;</span><span class="op" id="59970">,</span>&nbsp;<span class="op" id="59972">&amp;</span><span class="ident" id="59973">buf</span><span class="op" id="59976">,</span>&nbsp;<span class="string" id="59978">&#34;&#34;</span><span class="op" id="59980">,</span>&nbsp;<span class="num" id="59982">5</span><span class="op" id="59983">,</span>&nbsp;<span class="ident" id="59985">data</span><span class="op" id="59989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="59993">empty</span><span class="op" id="59998">(</span><span class="ident" id="59999">t</span><span class="op" id="60000">,</span>&nbsp;<span class="string" id="60002">&#34;TestLargeStringWrites&nbsp;(2)&#34;</span><span class="op" id="60029">,</span>&nbsp;<span class="op" id="60031">&amp;</span><span class="ident" id="60032">buf</span><span class="op" id="60035">,</span>&nbsp;<span class="ident" id="60037">s</span><span class="op" id="60038">,</span>&nbsp;<span class="builtinfunc" id="60040">make</span><span class="op" id="60044">(</span><span class="op" id="60045">[</span><span class="op" id="60046">]</span><span class="builtintype" id="60047">byte</span><span class="op" id="60051">,</span>&nbsp;<span class="builtinfunc" id="60053">len</span><span class="op" id="60056">(</span><span class="ident" id="60057">data</span><span class="op" id="60061">)</span><span class="op" id="60062">/</span><span class="ident" id="60063">i</span><span class="op" id="60064">)</span><span class="op" id="60065">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="60068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="60071">check</span><span class="op" id="60076">(</span><span class="ident" id="60077">t</span><span class="op" id="60078">,</span>&nbsp;<span class="string" id="60080">&#34;TestLargeStringWrites&nbsp;(3)&#34;</span><span class="op" id="60107">,</span>&nbsp;<span class="op" id="60109">&amp;</span><span class="ident" id="60110">buf</span><span class="op" id="60113">,</span>&nbsp;<span class="string" id="60115">&#34;&#34;</span><span class="op" id="60117">)</span><br>
<span class="lineno"></span><span class="op" id="60119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="60122">func</span>&nbsp;<span class="ident" id="60127">TestLargeByteWrites</span><span class="op" id="60146">(</span><span class="ident" id="60147">t</span>&nbsp;<span class="op" id="60149">*</span><span class="ident" id="60150">testing</span><span class="op" id="60157">.</span><span class="ident" id="60158">T</span><span class="op" id="60159">)</span>&nbsp;<span class="op" id="60161">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="60164">var</span>&nbsp;<span class="ident" id="60168">buf</span>&nbsp;<span class="ident" id="60172">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="60180">limit</span>&nbsp;<span class="op" id="60186">:=</span>&nbsp;<span class="num" id="60189">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="60193">if</span>&nbsp;<span class="ident" id="60196">testing</span><span class="op" id="60203">.</span><span class="ident" id="60204">Short</span><span class="op" id="60209">(</span><span class="op" id="60210">)</span>&nbsp;<span class="op" id="60212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="60216">limit</span>&nbsp;<span class="op" id="60222">=</span>&nbsp;<span class="num" id="60224">9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="60227">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="60230">for</span>&nbsp;<span class="ident" id="60234">i</span>&nbsp;<span class="op" id="60236">:=</span>&nbsp;<span class="num" id="60239">3</span><span class="op" id="60240">;</span>&nbsp;<span class="ident" id="60242">i</span>&nbsp;<span class="op" id="60244">&lt;</span>&nbsp;<span class="ident" id="60246">limit</span><span class="op" id="60251">;</span>&nbsp;<span class="ident" id="60253">i</span>&nbsp;<span class="op" id="60255">+=</span>&nbsp;<span class="num" id="60258">3</span>&nbsp;<span class="op" id="60260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="60264">s</span>&nbsp;<span class="op" id="60266">:=</span>&nbsp;<span class="ident" id="60269">fillBytes</span><span class="op" id="60278">(</span><span class="ident" id="60279">t</span><span class="op" id="60280">,</span>&nbsp;<span class="string" id="60282">&#34;TestLargeWrites&nbsp;(1)&#34;</span><span class="op" id="60303">,</span>&nbsp;<span class="op" id="60305">&amp;</span><span class="ident" id="60306">buf</span><span class="op" id="60309">,</span>&nbsp;<span class="string" id="60311">&#34;&#34;</span><span class="op" id="60313">,</span>&nbsp;<span class="num" id="60315">5</span><span class="op" id="60316">,</span>&nbsp;<span class="ident" id="60318">testBytes</span><span class="op" id="60327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="60331">empty</span><span class="op" id="60336">(</span><span class="ident" id="60337">t</span><span class="op" id="60338">,</span>&nbsp;<span class="string" id="60340">&#34;TestLargeByteWrites&nbsp;(2)&#34;</span><span class="op" id="60365">,</span>&nbsp;<span class="op" id="60367">&amp;</span><span class="ident" id="60368">buf</span><span class="op" id="60371">,</span>&nbsp;<span class="ident" id="60373">s</span><span class="op" id="60374">,</span>&nbsp;<span class="builtinfunc" id="60376">make</span><span class="op" id="60380">(</span><span class="op" id="60381">[</span><span class="op" id="60382">]</span><span class="builtintype" id="60383">byte</span><span class="op" id="60387">,</span>&nbsp;<span class="builtinfunc" id="60389">len</span><span class="op" id="60392">(</span><span class="ident" id="60393">data</span><span class="op" id="60397">)</span><span class="op" id="60398">/</span><span class="ident" id="60399">i</span><span class="op" id="60400">)</span><span class="op" id="60401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="60404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="60407">check</span><span class="op" id="60412">(</span><span class="ident" id="60413">t</span><span class="op" id="60414">,</span>&nbsp;<span class="string" id="60416">&#34;TestLargeByteWrites&nbsp;(3)&#34;</span><span class="op" id="60441">,</span>&nbsp;<span class="op" id="60443">&amp;</span><span class="ident" id="60444">buf</span><span class="op" id="60447">,</span>&nbsp;<span class="string" id="60449">&#34;&#34;</span><span class="op" id="60451">)</span><br>
<span class="lineno">195</span><span class="op" id="60453">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="60456">func</span>&nbsp;<span class="ident" id="60461">TestLargeStringReads</span><span class="op" id="60481">(</span><span class="ident" id="60482">t</span>&nbsp;<span class="op" id="60484">*</span><span class="ident" id="60485">testing</span><span class="op" id="60492">.</span><span class="ident" id="60493">T</span><span class="op" id="60494">)</span>&nbsp;<span class="op" id="60496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="60499">var</span>&nbsp;<span class="ident" id="60503">buf</span>&nbsp;<span class="ident" id="60507">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="60515">for</span>&nbsp;<span class="ident" id="60519">i</span>&nbsp;<span class="op" id="60521">:=</span>&nbsp;<span class="num" id="60524">3</span><span class="op" id="60525">;</span>&nbsp;<span class="ident" id="60527">i</span>&nbsp;<span class="op" id="60529">&lt;</span>&nbsp;<span class="num" id="60531">30</span><span class="op" id="60533">;</span>&nbsp;<span class="ident" id="60535">i</span>&nbsp;<span class="op" id="60537">+=</span>&nbsp;<span class="num" id="60540">3</span>&nbsp;<span class="op" id="60542">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="60546">s</span>&nbsp;<span class="op" id="60548">:=</span>&nbsp;<span class="ident" id="60551">fillString</span><span class="op" id="60561">(</span><span class="ident" id="60562">t</span><span class="op" id="60563">,</span>&nbsp;<span class="string" id="60565">&#34;TestLargeReads&nbsp;(1)&#34;</span><span class="op" id="60585">,</span>&nbsp;<span class="op" id="60587">&amp;</span><span class="ident" id="60588">buf</span><span class="op" id="60591">,</span>&nbsp;<span class="string" id="60593">&#34;&#34;</span><span class="op" id="60595">,</span>&nbsp;<span class="num" id="60597">5</span><span class="op" id="60598">,</span>&nbsp;<span class="ident" id="60600">data</span><span class="op" id="60604">[</span><span class="num" id="60605">0</span><span class="op" id="60606">:</span><span class="builtinfunc" id="60607">len</span><span class="op" id="60610">(</span><span class="ident" id="60611">data</span><span class="op" id="60615">)</span><span class="op" id="60616">/</span><span class="ident" id="60617">i</span><span class="op" id="60618">]</span><span class="op" id="60619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="60623">empty</span><span class="op" id="60628">(</span><span class="ident" id="60629">t</span><span class="op" id="60630">,</span>&nbsp;<span class="string" id="60632">&#34;TestLargeReads&nbsp;(2)&#34;</span><span class="op" id="60652">,</span>&nbsp;<span class="op" id="60654">&amp;</span><span class="ident" id="60655">buf</span><span class="op" id="60658">,</span>&nbsp;<span class="ident" id="60660">s</span><span class="op" id="60661">,</span>&nbsp;<span class="builtinfunc" id="60663">make</span><span class="op" id="60667">(</span><span class="op" id="60668">[</span><span class="op" id="60669">]</span><span class="builtintype" id="60670">byte</span><span class="op" id="60674">,</span>&nbsp;<span class="builtinfunc" id="60676">len</span><span class="op" id="60679">(</span><span class="ident" id="60680">data</span><span class="op" id="60684">)</span><span class="op" id="60685">)</span><span class="op" id="60686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="60689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="60692">check</span><span class="op" id="60697">(</span><span class="ident" id="60698">t</span><span class="op" id="60699">,</span>&nbsp;<span class="string" id="60701">&#34;TestLargeStringReads&nbsp;(3)&#34;</span><span class="op" id="60727">,</span>&nbsp;<span class="op" id="60729">&amp;</span><span class="ident" id="60730">buf</span><span class="op" id="60733">,</span>&nbsp;<span class="string" id="60735">&#34;&#34;</span><span class="op" id="60737">)</span><br>
<span class="lineno"></span><span class="op" id="60739">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span><span class="keyword" id="60742">func</span>&nbsp;<span class="ident" id="60747">TestLargeByteReads</span><span class="op" id="60765">(</span><span class="ident" id="60766">t</span>&nbsp;<span class="op" id="60768">*</span><span class="ident" id="60769">testing</span><span class="op" id="60776">.</span><span class="ident" id="60777">T</span><span class="op" id="60778">)</span>&nbsp;<span class="op" id="60780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="60783">var</span>&nbsp;<span class="ident" id="60787">buf</span>&nbsp;<span class="ident" id="60791">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="60799">for</span>&nbsp;<span class="ident" id="60803">i</span>&nbsp;<span class="op" id="60805">:=</span>&nbsp;<span class="num" id="60808">3</span><span class="op" id="60809">;</span>&nbsp;<span class="ident" id="60811">i</span>&nbsp;<span class="op" id="60813">&lt;</span>&nbsp;<span class="num" id="60815">30</span><span class="op" id="60817">;</span>&nbsp;<span class="ident" id="60819">i</span>&nbsp;<span class="op" id="60821">+=</span>&nbsp;<span class="num" id="60824">3</span>&nbsp;<span class="op" id="60826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="60830">s</span>&nbsp;<span class="op" id="60832">:=</span>&nbsp;<span class="ident" id="60835">fillBytes</span><span class="op" id="60844">(</span><span class="ident" id="60845">t</span><span class="op" id="60846">,</span>&nbsp;<span class="string" id="60848">&#34;TestLargeReads&nbsp;(1)&#34;</span><span class="op" id="60868">,</span>&nbsp;<span class="op" id="60870">&amp;</span><span class="ident" id="60871">buf</span><span class="op" id="60874">,</span>&nbsp;<span class="string" id="60876">&#34;&#34;</span><span class="op" id="60878">,</span>&nbsp;<span class="num" id="60880">5</span><span class="op" id="60881">,</span>&nbsp;<span class="ident" id="60883">testBytes</span><span class="op" id="60892">[</span><span class="num" id="60893">0</span><span class="op" id="60894">:</span><span class="builtinfunc" id="60895">len</span><span class="op" id="60898">(</span><span class="ident" id="60899">testBytes</span><span class="op" id="60908">)</span><span class="op" id="60909">/</span><span class="ident" id="60910">i</span><span class="op" id="60911">]</span><span class="op" id="60912">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="60916">empty</span><span class="op" id="60921">(</span><span class="ident" id="60922">t</span><span class="op" id="60923">,</span>&nbsp;<span class="string" id="60925">&#34;TestLargeReads&nbsp;(2)&#34;</span><span class="op" id="60945">,</span>&nbsp;<span class="op" id="60947">&amp;</span><span class="ident" id="60948">buf</span><span class="op" id="60951">,</span>&nbsp;<span class="ident" id="60953">s</span><span class="op" id="60954">,</span>&nbsp;<span class="builtinfunc" id="60956">make</span><span class="op" id="60960">(</span><span class="op" id="60961">[</span><span class="op" id="60962">]</span><span class="builtintype" id="60963">byte</span><span class="op" id="60967">,</span>&nbsp;<span class="builtinfunc" id="60969">len</span><span class="op" id="60972">(</span><span class="ident" id="60973">data</span><span class="op" id="60977">)</span><span class="op" id="60978">)</span><span class="op" id="60979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="60982">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="60985">check</span><span class="op" id="60990">(</span><span class="ident" id="60991">t</span><span class="op" id="60992">,</span>&nbsp;<span class="string" id="60994">&#34;TestLargeByteReads&nbsp;(3)&#34;</span><span class="op" id="61018">,</span>&nbsp;<span class="op" id="61020">&amp;</span><span class="ident" id="61021">buf</span><span class="op" id="61024">,</span>&nbsp;<span class="string" id="61026">&#34;&#34;</span><span class="op" id="61028">)</span><br>
<span class="lineno"></span><span class="op" id="61030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="61033">func</span>&nbsp;<span class="ident" id="61038">TestMixedReadsAndWrites</span><span class="op" id="61061">(</span><span class="ident" id="61062">t</span>&nbsp;<span class="op" id="61064">*</span><span class="ident" id="61065">testing</span><span class="op" id="61072">.</span><span class="ident" id="61073">T</span><span class="op" id="61074">)</span>&nbsp;<span class="op" id="61076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="61079">var</span>&nbsp;<span class="ident" id="61083">buf</span>&nbsp;<span class="ident" id="61087">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="61095">s</span>&nbsp;<span class="op" id="61097">:=</span>&nbsp;<span class="string" id="61100">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="61104">for</span>&nbsp;<span class="ident" id="61108">i</span>&nbsp;<span class="op" id="61110">:=</span>&nbsp;<span class="num" id="61113">0</span><span class="op" id="61114">;</span>&nbsp;<span class="ident" id="61116">i</span>&nbsp;<span class="op" id="61118">&lt;</span>&nbsp;<span class="num" id="61120">50</span><span class="op" id="61122">;</span>&nbsp;<span class="ident" id="61124">i</span><span class="op" id="61125">++</span>&nbsp;<span class="op" id="61128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="61132">wlen</span>&nbsp;<span class="op" id="61137">:=</span>&nbsp;<span class="ident" id="61140">rand</span><span class="op" id="61144">.</span><span class="ident" id="61145">Intn</span><span class="op" id="61149">(</span><span class="builtinfunc" id="61150">len</span><span class="op" id="61153">(</span><span class="ident" id="61154">data</span><span class="op" id="61158">)</span><span class="op" id="61159">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="61163">if</span>&nbsp;<span class="ident" id="61166">i</span><span class="op" id="61167">%</span><span class="num" id="61168">2</span>&nbsp;<span class="op" id="61170">==</span>&nbsp;<span class="num" id="61173">0</span>&nbsp;<span class="op" id="61175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="61180">s</span>&nbsp;<span class="op" id="61182">=</span>&nbsp;<span class="ident" id="61184">fillString</span><span class="op" id="61194">(</span><span class="ident" id="61195">t</span><span class="op" id="61196">,</span>&nbsp;<span class="string" id="61198">&#34;TestMixedReadsAndWrites&nbsp;(1)&#34;</span><span class="op" id="61227">,</span>&nbsp;<span class="op" id="61229">&amp;</span><span class="ident" id="61230">buf</span><span class="op" id="61233">,</span>&nbsp;<span class="ident" id="61235">s</span><span class="op" id="61236">,</span>&nbsp;<span class="num" id="61238">1</span><span class="op" id="61239">,</span>&nbsp;<span class="ident" id="61241">data</span><span class="op" id="61245">[</span><span class="num" id="61246">0</span><span class="op" id="61247">:</span><span class="ident" id="61248">wlen</span><span class="op" id="61252">]</span><span class="op" id="61253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="61257">}</span>&nbsp;<span class="keyword" id="61259">else</span>&nbsp;<span class="op" id="61264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="61269">s</span>&nbsp;<span class="op" id="61271">=</span>&nbsp;<span class="ident" id="61273">fillBytes</span><span class="op" id="61282">(</span><span class="ident" id="61283">t</span><span class="op" id="61284">,</span>&nbsp;<span class="string" id="61286">&#34;TestMixedReadsAndWrites&nbsp;(1)&#34;</span><span class="op" id="61315">,</span>&nbsp;<span class="op" id="61317">&amp;</span><span class="ident" id="61318">buf</span><span class="op" id="61321">,</span>&nbsp;<span class="ident" id="61323">s</span><span class="op" id="61324">,</span>&nbsp;<span class="num" id="61326">1</span><span class="op" id="61327">,</span>&nbsp;<span class="ident" id="61329">testBytes</span><span class="op" id="61338">[</span><span class="num" id="61339">0</span><span class="op" id="61340">:</span><span class="ident" id="61341">wlen</span><span class="op" id="61345">]</span><span class="op" id="61346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="61350">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="61355">rlen</span>&nbsp;<span class="op" id="61360">:=</span>&nbsp;<span class="ident" id="61363">rand</span><span class="op" id="61367">.</span><span class="ident" id="61368">Intn</span><span class="op" id="61372">(</span><span class="builtinfunc" id="61373">len</span><span class="op" id="61376">(</span><span class="ident" id="61377">data</span><span class="op" id="61381">)</span><span class="op" id="61382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="61386">fub</span>&nbsp;<span class="op" id="61390">:=</span>&nbsp;<span class="builtinfunc" id="61393">make</span><span class="op" id="61397">(</span><span class="op" id="61398">[</span><span class="op" id="61399">]</span><span class="builtintype" id="61400">byte</span><span class="op" id="61404">,</span>&nbsp;<span class="ident" id="61406">rlen</span><span class="op" id="61410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="61414">n</span><span class="op" id="61415">,</span>&nbsp;<span class="ident" id="61417">_</span>&nbsp;<span class="op" id="61419">:=</span>&nbsp;<span class="ident" id="61422">buf</span><span class="op" id="61425">.</span><span class="ident" id="61426">Read</span><span class="op" id="61430">(</span><span class="ident" id="61431">fub</span><span class="op" id="61434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="61438">s</span>&nbsp;<span class="op" id="61440">=</span>&nbsp;<span class="ident" id="61442">s</span><span class="op" id="61443">[</span><span class="ident" id="61444">n</span><span class="op" id="61445">:</span><span class="op" id="61446">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="61449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="61452">empty</span><span class="op" id="61457">(</span><span class="ident" id="61458">t</span><span class="op" id="61459">,</span>&nbsp;<span class="string" id="61461">&#34;TestMixedReadsAndWrites&nbsp;(2)&#34;</span><span class="op" id="61490">,</span>&nbsp;<span class="op" id="61492">&amp;</span><span class="ident" id="61493">buf</span><span class="op" id="61496">,</span>&nbsp;<span class="ident" id="61498">s</span><span class="op" id="61499">,</span>&nbsp;<span class="builtinfunc" id="61501">make</span><span class="op" id="61505">(</span><span class="op" id="61506">[</span><span class="op" id="61507">]</span><span class="builtintype" id="61508">byte</span><span class="op" id="61512">,</span>&nbsp;<span class="ident" id="61514">buf</span><span class="op" id="61517">.</span><span class="ident" id="61518">Len</span><span class="op" id="61521">(</span><span class="op" id="61522">)</span><span class="op" id="61523">)</span><span class="op" id="61524">)</span><br>
<span class="lineno"></span><span class="op" id="61526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="61529">func</span>&nbsp;<span class="ident" id="61534">TestNil</span><span class="op" id="61541">(</span><span class="ident" id="61542">t</span>&nbsp;<span class="op" id="61544">*</span><span class="ident" id="61545">testing</span><span class="op" id="61552">.</span><span class="ident" id="61553">T</span><span class="op" id="61554">)</span>&nbsp;<span class="op" id="61556">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="61559">var</span>&nbsp;<span class="ident" id="61563">b</span>&nbsp;<span class="op" id="61565">*</span><span class="ident" id="61566">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="61574">if</span>&nbsp;<span class="ident" id="61577">b</span><span class="op" id="61578">.</span><span class="ident" id="61579">String</span><span class="op" id="61585">(</span><span class="op" id="61586">)</span>&nbsp;<span class="op" id="61588">!=</span>&nbsp;<span class="string" id="61591">&#34;&lt;nil&gt;&#34;</span>&nbsp;<span class="op" id="61599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="61603">t</span><span class="op" id="61604">.</span><span class="ident" id="61605">Errorf</span><span class="op" id="61611">(</span><span class="string" id="61612">&#34;expected&nbsp;&lt;nil&gt;;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="61636">,</span>&nbsp;<span class="ident" id="61638">b</span><span class="op" id="61639">.</span><span class="ident" id="61640">String</span><span class="op" id="61646">(</span><span class="op" id="61647">)</span><span class="op" id="61648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="61651">}</span><br>
<span class="lineno"></span><span class="op" id="61653">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="61656">func</span>&nbsp;<span class="ident" id="61661">TestReadFrom</span><span class="op" id="61673">(</span><span class="ident" id="61674">t</span>&nbsp;<span class="op" id="61676">*</span><span class="ident" id="61677">testing</span><span class="op" id="61684">.</span><span class="ident" id="61685">T</span><span class="op" id="61686">)</span>&nbsp;<span class="op" id="61688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="61691">var</span>&nbsp;<span class="ident" id="61695">buf</span>&nbsp;<span class="ident" id="61699">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="61707">for</span>&nbsp;<span class="ident" id="61711">i</span>&nbsp;<span class="op" id="61713">:=</span>&nbsp;<span class="num" id="61716">3</span><span class="op" id="61717">;</span>&nbsp;<span class="ident" id="61719">i</span>&nbsp;<span class="op" id="61721">&lt;</span>&nbsp;<span class="num" id="61723">30</span><span class="op" id="61725">;</span>&nbsp;<span class="ident" id="61727">i</span>&nbsp;<span class="op" id="61729">+=</span>&nbsp;<span class="num" id="61732">3</span>&nbsp;<span class="op" id="61734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="61738">s</span>&nbsp;<span class="op" id="61740">:=</span>&nbsp;<span class="ident" id="61743">fillBytes</span><span class="op" id="61752">(</span><span class="ident" id="61753">t</span><span class="op" id="61754">,</span>&nbsp;<span class="string" id="61756">&#34;TestReadFrom&nbsp;(1)&#34;</span><span class="op" id="61774">,</span>&nbsp;<span class="op" id="61776">&amp;</span><span class="ident" id="61777">buf</span><span class="op" id="61780">,</span>&nbsp;<span class="string" id="61782">&#34;&#34;</span><span class="op" id="61784">,</span>&nbsp;<span class="num" id="61786">5</span><span class="op" id="61787">,</span>&nbsp;<span class="ident" id="61789">testBytes</span><span class="op" id="61798">[</span><span class="num" id="61799">0</span><span class="op" id="61800">:</span><span class="builtinfunc" id="61801">len</span><span class="op" id="61804">(</span><span class="ident" id="61805">testBytes</span><span class="op" id="61814">)</span><span class="op" id="61815">/</span><span class="ident" id="61816">i</span><span class="op" id="61817">]</span><span class="op" id="61818">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="61822">var</span>&nbsp;<span class="ident" id="61826">b</span>&nbsp;<span class="ident" id="61828">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="61837">b</span><span class="op" id="61838">.</span><span class="ident" id="61839">ReadFrom</span><span class="op" id="61847">(</span><span class="op" id="61848">&amp;</span><span class="ident" id="61849">buf</span><span class="op" id="61852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="61856">empty</span><span class="op" id="61861">(</span><span class="ident" id="61862">t</span><span class="op" id="61863">,</span>&nbsp;<span class="string" id="61865">&#34;TestReadFrom&nbsp;(2)&#34;</span><span class="op" id="61883">,</span>&nbsp;<span class="op" id="61885">&amp;</span><span class="ident" id="61886">b</span><span class="op" id="61887">,</span>&nbsp;<span class="ident" id="61889">s</span><span class="op" id="61890">,</span>&nbsp;<span class="builtinfunc" id="61892">make</span><span class="op" id="61896">(</span><span class="op" id="61897">[</span><span class="op" id="61898">]</span><span class="builtintype" id="61899">byte</span><span class="op" id="61903">,</span>&nbsp;<span class="builtinfunc" id="61905">len</span><span class="op" id="61908">(</span><span class="ident" id="61909">data</span><span class="op" id="61913">)</span><span class="op" id="61914">)</span><span class="op" id="61915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="61918">}</span><br>
<span class="lineno"></span><span class="op" id="61920">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="keyword" id="61923">func</span>&nbsp;<span class="ident" id="61928">TestWriteTo</span><span class="op" id="61939">(</span><span class="ident" id="61940">t</span>&nbsp;<span class="op" id="61942">*</span><span class="ident" id="61943">testing</span><span class="op" id="61950">.</span><span class="ident" id="61951">T</span><span class="op" id="61952">)</span>&nbsp;<span class="op" id="61954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="61957">var</span>&nbsp;<span class="ident" id="61961">buf</span>&nbsp;<span class="ident" id="61965">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="61973">for</span>&nbsp;<span class="ident" id="61977">i</span>&nbsp;<span class="op" id="61979">:=</span>&nbsp;<span class="num" id="61982">3</span><span class="op" id="61983">;</span>&nbsp;<span class="ident" id="61985">i</span>&nbsp;<span class="op" id="61987">&lt;</span>&nbsp;<span class="num" id="61989">30</span><span class="op" id="61991">;</span>&nbsp;<span class="ident" id="61993">i</span>&nbsp;<span class="op" id="61995">+=</span>&nbsp;<span class="num" id="61998">3</span>&nbsp;<span class="op" id="62000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="62004">s</span>&nbsp;<span class="op" id="62006">:=</span>&nbsp;<span class="ident" id="62009">fillBytes</span><span class="op" id="62018">(</span><span class="ident" id="62019">t</span><span class="op" id="62020">,</span>&nbsp;<span class="string" id="62022">&#34;TestWriteTo&nbsp;(1)&#34;</span><span class="op" id="62039">,</span>&nbsp;<span class="op" id="62041">&amp;</span><span class="ident" id="62042">buf</span><span class="op" id="62045">,</span>&nbsp;<span class="string" id="62047">&#34;&#34;</span><span class="op" id="62049">,</span>&nbsp;<span class="num" id="62051">5</span><span class="op" id="62052">,</span>&nbsp;<span class="ident" id="62054">testBytes</span><span class="op" id="62063">[</span><span class="num" id="62064">0</span><span class="op" id="62065">:</span><span class="builtinfunc" id="62066">len</span><span class="op" id="62069">(</span><span class="ident" id="62070">testBytes</span><span class="op" id="62079">)</span><span class="op" id="62080">/</span><span class="ident" id="62081">i</span><span class="op" id="62082">]</span><span class="op" id="62083">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="62087">var</span>&nbsp;<span class="ident" id="62091">b</span>&nbsp;<span class="ident" id="62093">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="62102">buf</span><span class="op" id="62105">.</span><span class="ident" id="62106">WriteTo</span><span class="op" id="62113">(</span><span class="op" id="62114">&amp;</span><span class="ident" id="62115">b</span><span class="op" id="62116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="62120">empty</span><span class="op" id="62125">(</span><span class="ident" id="62126">t</span><span class="op" id="62127">,</span>&nbsp;<span class="string" id="62129">&#34;TestWriteTo&nbsp;(2)&#34;</span><span class="op" id="62146">,</span>&nbsp;<span class="op" id="62148">&amp;</span><span class="ident" id="62149">b</span><span class="op" id="62150">,</span>&nbsp;<span class="ident" id="62152">s</span><span class="op" id="62153">,</span>&nbsp;<span class="builtinfunc" id="62155">make</span><span class="op" id="62159">(</span><span class="op" id="62160">[</span><span class="op" id="62161">]</span><span class="builtintype" id="62162">byte</span><span class="op" id="62166">,</span>&nbsp;<span class="builtinfunc" id="62168">len</span><span class="op" id="62171">(</span><span class="ident" id="62172">data</span><span class="op" id="62176">)</span><span class="op" id="62177">)</span><span class="op" id="62178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="62181">}</span><br>
<span class="lineno"></span><span class="op" id="62183">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="keyword" id="62186">func</span>&nbsp;<span class="ident" id="62191">TestRuneIO</span><span class="op" id="62201">(</span><span class="ident" id="62202">t</span>&nbsp;<span class="op" id="62204">*</span><span class="ident" id="62205">testing</span><span class="op" id="62212">.</span><span class="ident" id="62213">T</span><span class="op" id="62214">)</span>&nbsp;<span class="op" id="62216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="62219">const</span>&nbsp;<span class="ident" id="62225">NRune</span>&nbsp;<span class="op" id="62231">=</span>&nbsp;<span class="num" id="62233">1000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="62239">//&nbsp;Built&nbsp;a&nbsp;test&nbsp;slice&nbsp;while&nbsp;we&nbsp;write&nbsp;the&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="62286">b</span>&nbsp;<span class="op" id="62288">:=</span>&nbsp;<span class="builtinfunc" id="62291">make</span><span class="op" id="62295">(</span><span class="op" id="62296">[</span><span class="op" id="62297">]</span><span class="builtintype" id="62298">byte</span><span class="op" id="62302">,</span>&nbsp;<span class="ident" id="62304">utf8</span><span class="op" id="62308">.</span><span class="ident" id="62309">UTFMax</span><span class="op" id="62315">*</span><span class="ident" id="62316">NRune</span><span class="op" id="62321">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="62324">var</span>&nbsp;<span class="ident" id="62328">buf</span>&nbsp;<span class="ident" id="62332">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="62340">n</span>&nbsp;<span class="op" id="62342">:=</span>&nbsp;<span class="num" id="62345">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="62348">for</span>&nbsp;<span class="ident" id="62352">r</span>&nbsp;<span class="op" id="62354">:=</span>&nbsp;<span class="builtintype" id="62357">rune</span><span class="op" id="62361">(</span><span class="num" id="62362">0</span><span class="op" id="62363">)</span><span class="op" id="62364">;</span>&nbsp;<span class="ident" id="62366">r</span>&nbsp;<span class="op" id="62368">&lt;</span>&nbsp;<span class="ident" id="62370">NRune</span><span class="op" id="62375">;</span>&nbsp;<span class="ident" id="62377">r</span><span class="op" id="62378">++</span>&nbsp;<span class="op" id="62381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="62385">size</span>&nbsp;<span class="op" id="62390">:=</span>&nbsp;<span class="ident" id="62393">utf8</span><span class="op" id="62397">.</span><span class="ident" id="62398">EncodeRune</span><span class="op" id="62408">(</span><span class="ident" id="62409">b</span><span class="op" id="62410">[</span><span class="ident" id="62411">n</span><span class="op" id="62412">:</span><span class="op" id="62413">]</span><span class="op" id="62414">,</span>&nbsp;<span class="ident" id="62416">r</span><span class="op" id="62417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="62421">nbytes</span><span class="op" id="62427">,</span>&nbsp;<span class="ident" id="62429">err</span>&nbsp;<span class="op" id="62433">:=</span>&nbsp;<span class="ident" id="62436">buf</span><span class="op" id="62439">.</span><span class="ident" id="62440">WriteRune</span><span class="op" id="62449">(</span><span class="ident" id="62450">r</span><span class="op" id="62451">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="62455">if</span>&nbsp;<span class="ident" id="62458">err</span>&nbsp;<span class="op" id="62462">!=</span>&nbsp;<span class="ident" id="62465">nil</span>&nbsp;<span class="op" id="62469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="62474">t</span><span class="op" id="62475">.</span><span class="ident" id="62476">Fatalf</span><span class="op" id="62482">(</span><span class="string" id="62483">&#34;WriteRune(%U)&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="62508">,</span>&nbsp;<span class="ident" id="62510">r</span><span class="op" id="62511">,</span>&nbsp;<span class="ident" id="62513">err</span><span class="op" id="62516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="62520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="62524">if</span>&nbsp;<span class="ident" id="62527">nbytes</span>&nbsp;<span class="op" id="62534">!=</span>&nbsp;<span class="ident" id="62537">size</span>&nbsp;<span class="op" id="62542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="62547">t</span><span class="op" id="62548">.</span><span class="ident" id="62549">Fatalf</span><span class="op" id="62555">(</span><span class="string" id="62556">&#34;WriteRune(%U)&nbsp;expected&nbsp;%d,&nbsp;got&nbsp;%d&#34;</span><span class="op" id="62591">,</span>&nbsp;<span class="ident" id="62593">r</span><span class="op" id="62594">,</span>&nbsp;<span class="ident" id="62596">size</span><span class="op" id="62600">,</span>&nbsp;<span class="ident" id="62602">nbytes</span><span class="op" id="62608">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="62612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="62616">n</span>&nbsp;<span class="op" id="62618">+=</span>&nbsp;<span class="ident" id="62621">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="62627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="62630">b</span>&nbsp;<span class="op" id="62632">=</span>&nbsp;<span class="ident" id="62634">b</span><span class="op" id="62635">[</span><span class="num" id="62636">0</span><span class="op" id="62637">:</span><span class="ident" id="62638">n</span><span class="op" id="62639">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="62643">//&nbsp;Check&nbsp;the&nbsp;resulting&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="62673">if</span>&nbsp;<span class="op" id="62676">!</span><span class="ident" id="62677">Equal</span><span class="op" id="62682">(</span><span class="ident" id="62683">buf</span><span class="op" id="62686">.</span><span class="ident" id="62687">Bytes</span><span class="op" id="62692">(</span><span class="op" id="62693">)</span><span class="op" id="62694">,</span>&nbsp;<span class="ident" id="62696">b</span><span class="op" id="62697">)</span>&nbsp;<span class="op" id="62699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="62703">t</span><span class="op" id="62704">.</span><span class="ident" id="62705">Fatalf</span><span class="op" id="62711">(</span><span class="string" id="62712">&#34;incorrect&nbsp;result&nbsp;from&nbsp;WriteRune:&nbsp;%q&nbsp;not&nbsp;%q&#34;</span><span class="op" id="62756">,</span>&nbsp;<span class="ident" id="62758">buf</span><span class="op" id="62761">.</span><span class="ident" id="62762">Bytes</span><span class="op" id="62767">(</span><span class="op" id="62768">)</span><span class="op" id="62769">,</span>&nbsp;<span class="ident" id="62771">b</span><span class="op" id="62772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="62775">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="62779">p</span>&nbsp;<span class="op" id="62781">:=</span>&nbsp;<span class="builtinfunc" id="62784">make</span><span class="op" id="62788">(</span><span class="op" id="62789">[</span><span class="op" id="62790">]</span><span class="builtintype" id="62791">byte</span><span class="op" id="62795">,</span>&nbsp;<span class="ident" id="62797">utf8</span><span class="op" id="62801">.</span><span class="ident" id="62802">UTFMax</span><span class="op" id="62808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="62811">//&nbsp;Read&nbsp;it&nbsp;back&nbsp;with&nbsp;ReadRune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="62842">for</span>&nbsp;<span class="ident" id="62846">r</span>&nbsp;<span class="op" id="62848">:=</span>&nbsp;<span class="builtintype" id="62851">rune</span><span class="op" id="62855">(</span><span class="num" id="62856">0</span><span class="op" id="62857">)</span><span class="op" id="62858">;</span>&nbsp;<span class="ident" id="62860">r</span>&nbsp;<span class="op" id="62862">&lt;</span>&nbsp;<span class="ident" id="62864">NRune</span><span class="op" id="62869">;</span>&nbsp;<span class="ident" id="62871">r</span><span class="op" id="62872">++</span>&nbsp;<span class="op" id="62875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="62879">size</span>&nbsp;<span class="op" id="62884">:=</span>&nbsp;<span class="ident" id="62887">utf8</span><span class="op" id="62891">.</span><span class="ident" id="62892">EncodeRune</span><span class="op" id="62902">(</span><span class="ident" id="62903">p</span><span class="op" id="62904">,</span>&nbsp;<span class="ident" id="62906">r</span><span class="op" id="62907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="62911">nr</span><span class="op" id="62913">,</span>&nbsp;<span class="ident" id="62915">nbytes</span><span class="op" id="62921">,</span>&nbsp;<span class="ident" id="62923">err</span>&nbsp;<span class="op" id="62927">:=</span>&nbsp;<span class="ident" id="62930">buf</span><span class="op" id="62933">.</span><span class="ident" id="62934">ReadRune</span><span class="op" id="62942">(</span><span class="op" id="62943">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="62947">if</span>&nbsp;<span class="ident" id="62950">nr</span>&nbsp;<span class="op" id="62953">!=</span>&nbsp;<span class="ident" id="62956">r</span>&nbsp;<span class="op" id="62958">||</span>&nbsp;<span class="ident" id="62961">nbytes</span>&nbsp;<span class="op" id="62968">!=</span>&nbsp;<span class="ident" id="62971">size</span>&nbsp;<span class="op" id="62976">||</span>&nbsp;<span class="ident" id="62979">err</span>&nbsp;<span class="op" id="62983">!=</span>&nbsp;<span class="ident" id="62986">nil</span>&nbsp;<span class="op" id="62990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="62995">t</span><span class="op" id="62996">.</span><span class="ident" id="62997">Fatalf</span><span class="op" id="63003">(</span><span class="string" id="63004">&#34;ReadRune(%U)&nbsp;got&nbsp;%U,%d&nbsp;not&nbsp;%U,%d&nbsp;(err=%s)&#34;</span><span class="op" id="63047">,</span>&nbsp;<span class="ident" id="63049">r</span><span class="op" id="63050">,</span>&nbsp;<span class="ident" id="63052">nr</span><span class="op" id="63054">,</span>&nbsp;<span class="ident" id="63056">nbytes</span><span class="op" id="63062">,</span>&nbsp;<span class="ident" id="63064">r</span><span class="op" id="63065">,</span>&nbsp;<span class="ident" id="63067">size</span><span class="op" id="63071">,</span>&nbsp;<span class="ident" id="63073">err</span><span class="op" id="63076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="63080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="63083">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="63087">//&nbsp;Check&nbsp;that&nbsp;UnreadRune&nbsp;works</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="63119">buf</span><span class="op" id="63122">.</span><span class="ident" id="63123">Reset</span><span class="op" id="63128">(</span><span class="op" id="63129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="63132">buf</span><span class="op" id="63135">.</span><span class="ident" id="63136">Write</span><span class="op" id="63141">(</span><span class="ident" id="63142">b</span><span class="op" id="63143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="63146">for</span>&nbsp;<span class="ident" id="63150">r</span>&nbsp;<span class="op" id="63152">:=</span>&nbsp;<span class="builtintype" id="63155">rune</span><span class="op" id="63159">(</span><span class="num" id="63160">0</span><span class="op" id="63161">)</span><span class="op" id="63162">;</span>&nbsp;<span class="ident" id="63164">r</span>&nbsp;<span class="op" id="63166">&lt;</span>&nbsp;<span class="ident" id="63168">NRune</span><span class="op" id="63173">;</span>&nbsp;<span class="ident" id="63175">r</span><span class="op" id="63176">++</span>&nbsp;<span class="op" id="63179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="63183">r1</span><span class="op" id="63185">,</span>&nbsp;<span class="ident" id="63187">size</span><span class="op" id="63191">,</span>&nbsp;<span class="ident" id="63193">_</span>&nbsp;<span class="op" id="63195">:=</span>&nbsp;<span class="ident" id="63198">buf</span><span class="op" id="63201">.</span><span class="ident" id="63202">ReadRune</span><span class="op" id="63210">(</span><span class="op" id="63211">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="63215">if</span>&nbsp;<span class="ident" id="63218">err</span>&nbsp;<span class="op" id="63222">:=</span>&nbsp;<span class="ident" id="63225">buf</span><span class="op" id="63228">.</span><span class="ident" id="63229">UnreadRune</span><span class="op" id="63239">(</span><span class="op" id="63240">)</span><span class="op" id="63241">;</span>&nbsp;<span class="ident" id="63243">err</span>&nbsp;<span class="op" id="63247">!=</span>&nbsp;<span class="ident" id="63250">nil</span>&nbsp;<span class="op" id="63254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="63259">t</span><span class="op" id="63260">.</span><span class="ident" id="63261">Fatalf</span><span class="op" id="63267">(</span><span class="string" id="63268">&#34;UnreadRune(%U)&nbsp;got&nbsp;error&nbsp;%q&#34;</span><span class="op" id="63297">,</span>&nbsp;<span class="ident" id="63299">r</span><span class="op" id="63300">,</span>&nbsp;<span class="ident" id="63302">err</span><span class="op" id="63305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="63309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="63313">r2</span><span class="op" id="63315">,</span>&nbsp;<span class="ident" id="63317">nbytes</span><span class="op" id="63323">,</span>&nbsp;<span class="ident" id="63325">err</span>&nbsp;<span class="op" id="63329">:=</span>&nbsp;<span class="ident" id="63332">buf</span><span class="op" id="63335">.</span><span class="ident" id="63336">ReadRune</span><span class="op" id="63344">(</span><span class="op" id="63345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="63349">if</span>&nbsp;<span class="ident" id="63352">r1</span>&nbsp;<span class="op" id="63355">!=</span>&nbsp;<span class="ident" id="63358">r2</span>&nbsp;<span class="op" id="63361">||</span>&nbsp;<span class="ident" id="63364">r1</span>&nbsp;<span class="op" id="63367">!=</span>&nbsp;<span class="ident" id="63370">r</span>&nbsp;<span class="op" id="63372">||</span>&nbsp;<span class="ident" id="63375">nbytes</span>&nbsp;<span class="op" id="63382">!=</span>&nbsp;<span class="ident" id="63385">size</span>&nbsp;<span class="op" id="63390">||</span>&nbsp;<span class="ident" id="63393">err</span>&nbsp;<span class="op" id="63397">!=</span>&nbsp;<span class="ident" id="63400">nil</span>&nbsp;<span class="op" id="63404">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="63409">t</span><span class="op" id="63410">.</span><span class="ident" id="63411">Fatalf</span><span class="op" id="63417">(</span><span class="string" id="63418">&#34;ReadRune(%U)&nbsp;after&nbsp;UnreadRune&nbsp;got&nbsp;%U,%d&nbsp;not&nbsp;%U,%d&nbsp;(err=%s)&#34;</span><span class="op" id="63478">,</span>&nbsp;<span class="ident" id="63480">r</span><span class="op" id="63481">,</span>&nbsp;<span class="ident" id="63483">r2</span><span class="op" id="63485">,</span>&nbsp;<span class="ident" id="63487">nbytes</span><span class="op" id="63493">,</span>&nbsp;<span class="ident" id="63495">r</span><span class="op" id="63496">,</span>&nbsp;<span class="ident" id="63498">size</span><span class="op" id="63502">,</span>&nbsp;<span class="ident" id="63504">err</span><span class="op" id="63507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="63511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="63514">}</span><br>
<span class="lineno"></span><span class="op" id="63516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="keyword" id="63519">func</span>&nbsp;<span class="ident" id="63524">TestNext</span><span class="op" id="63532">(</span><span class="ident" id="63533">t</span>&nbsp;<span class="op" id="63535">*</span><span class="ident" id="63536">testing</span><span class="op" id="63543">.</span><span class="ident" id="63544">T</span><span class="op" id="63545">)</span>&nbsp;<span class="op" id="63547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="63550">b</span>&nbsp;<span class="op" id="63552">:=</span>&nbsp;<span class="op" id="63555">[</span><span class="op" id="63556">]</span><span class="builtintype" id="63557">byte</span><span class="op" id="63561">{</span><span class="num" id="63562">0</span><span class="op" id="63563">,</span>&nbsp;<span class="num" id="63565">1</span><span class="op" id="63566">,</span>&nbsp;<span class="num" id="63568">2</span><span class="op" id="63569">,</span>&nbsp;<span class="num" id="63571">3</span><span class="op" id="63572">,</span>&nbsp;<span class="num" id="63574">4</span><span class="op" id="63575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="63578">tmp</span>&nbsp;<span class="op" id="63582">:=</span>&nbsp;<span class="builtinfunc" id="63585">make</span><span class="op" id="63589">(</span><span class="op" id="63590">[</span><span class="op" id="63591">]</span><span class="builtintype" id="63592">byte</span><span class="op" id="63596">,</span>&nbsp;<span class="num" id="63598">5</span><span class="op" id="63599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="63602">for</span>&nbsp;<span class="ident" id="63606">i</span>&nbsp;<span class="op" id="63608">:=</span>&nbsp;<span class="num" id="63611">0</span><span class="op" id="63612">;</span>&nbsp;<span class="ident" id="63614">i</span>&nbsp;<span class="op" id="63616">&lt;=</span>&nbsp;<span class="num" id="63619">5</span><span class="op" id="63620">;</span>&nbsp;<span class="ident" id="63622">i</span><span class="op" id="63623">++</span>&nbsp;<span class="op" id="63626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="63630">for</span>&nbsp;<span class="ident" id="63634">j</span>&nbsp;<span class="op" id="63636">:=</span>&nbsp;<span class="ident" id="63639">i</span><span class="op" id="63640">;</span>&nbsp;<span class="ident" id="63642">j</span>&nbsp;<span class="op" id="63644">&lt;=</span>&nbsp;<span class="num" id="63647">5</span><span class="op" id="63648">;</span>&nbsp;<span class="ident" id="63650">j</span><span class="op" id="63651">++</span>&nbsp;<span class="op" id="63654">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="63659">for</span>&nbsp;<span class="ident" id="63663">k</span>&nbsp;<span class="op" id="63665">:=</span>&nbsp;<span class="num" id="63668">0</span><span class="op" id="63669">;</span>&nbsp;<span class="ident" id="63671">k</span>&nbsp;<span class="op" id="63673">&lt;=</span>&nbsp;<span class="num" id="63676">6</span><span class="op" id="63677">;</span>&nbsp;<span class="ident" id="63679">k</span><span class="op" id="63680">++</span>&nbsp;<span class="op" id="63683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="63689">//&nbsp;0&nbsp;&lt;=&nbsp;i&nbsp;&lt;=&nbsp;j&nbsp;&lt;=&nbsp;5;&nbsp;0&nbsp;&lt;=&nbsp;k&nbsp;&lt;=&nbsp;6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="63726">//&nbsp;Check&nbsp;that&nbsp;if&nbsp;we&nbsp;start&nbsp;with&nbsp;a&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="63770">//&nbsp;of&nbsp;length&nbsp;j&nbsp;at&nbsp;offset&nbsp;i&nbsp;and&nbsp;ask&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="63813">//&nbsp;Next(k),&nbsp;we&nbsp;get&nbsp;the&nbsp;right&nbsp;bytes.</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="63853">buf</span>&nbsp;<span class="op" id="63857">:=</span>&nbsp;<span class="ident" id="63860">NewBuffer</span><span class="op" id="63869">(</span><span class="ident" id="63870">b</span><span class="op" id="63871">[</span><span class="num" id="63872">0</span><span class="op" id="63873">:</span><span class="ident" id="63874">j</span><span class="op" id="63875">]</span><span class="op" id="63876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="63882">n</span><span class="op" id="63883">,</span>&nbsp;<span class="ident" id="63885">_</span>&nbsp;<span class="op" id="63887">:=</span>&nbsp;<span class="ident" id="63890">buf</span><span class="op" id="63893">.</span><span class="ident" id="63894">Read</span><span class="op" id="63898">(</span><span class="ident" id="63899">tmp</span><span class="op" id="63902">[</span><span class="num" id="63903">0</span><span class="op" id="63904">:</span><span class="ident" id="63905">i</span><span class="op" id="63906">]</span><span class="op" id="63907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="63913">if</span>&nbsp;<span class="ident" id="63916">n</span>&nbsp;<span class="op" id="63918">!=</span>&nbsp;<span class="ident" id="63921">i</span>&nbsp;<span class="op" id="63923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="63930">t</span><span class="op" id="63931">.</span><span class="ident" id="63932">Fatalf</span><span class="op" id="63938">(</span><span class="string" id="63939">&#34;Read&nbsp;%d&nbsp;returned&nbsp;%d&#34;</span><span class="op" id="63960">,</span>&nbsp;<span class="ident" id="63962">i</span><span class="op" id="63963">,</span>&nbsp;<span class="ident" id="63965">n</span><span class="op" id="63966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="63972">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="63978">bb</span>&nbsp;<span class="op" id="63981">:=</span>&nbsp;<span class="ident" id="63984">buf</span><span class="op" id="63987">.</span><span class="ident" id="63988">Next</span><span class="op" id="63992">(</span><span class="ident" id="63993">k</span><span class="op" id="63994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="64000">want</span>&nbsp;<span class="op" id="64005">:=</span>&nbsp;<span class="ident" id="64008">k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="64014">if</span>&nbsp;<span class="ident" id="64017">want</span>&nbsp;<span class="op" id="64022">&gt;</span>&nbsp;<span class="ident" id="64024">j</span><span class="op" id="64025">-</span><span class="ident" id="64026">i</span>&nbsp;<span class="op" id="64028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="64035">want</span>&nbsp;<span class="op" id="64040">=</span>&nbsp;<span class="ident" id="64042">j</span>&nbsp;<span class="op" id="64044">-</span>&nbsp;<span class="ident" id="64046">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="64052">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="64058">if</span>&nbsp;<span class="builtinfunc" id="64061">len</span><span class="op" id="64064">(</span><span class="ident" id="64065">bb</span><span class="op" id="64067">)</span>&nbsp;<span class="op" id="64069">!=</span>&nbsp;<span class="ident" id="64072">want</span>&nbsp;<span class="op" id="64077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="64084">t</span><span class="op" id="64085">.</span><span class="ident" id="64086">Fatalf</span><span class="op" id="64092">(</span><span class="string" id="64093">&#34;in&nbsp;%d,%d:&nbsp;len(Next(%d))&nbsp;==&nbsp;%d&#34;</span><span class="op" id="64124">,</span>&nbsp;<span class="ident" id="64126">i</span><span class="op" id="64127">,</span>&nbsp;<span class="ident" id="64129">j</span><span class="op" id="64130">,</span>&nbsp;<span class="ident" id="64132">k</span><span class="op" id="64133">,</span>&nbsp;<span class="builtinfunc" id="64135">len</span><span class="op" id="64138">(</span><span class="ident" id="64139">bb</span><span class="op" id="64141">)</span><span class="op" id="64142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="64148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="64154">for</span>&nbsp;<span class="ident" id="64158">l</span><span class="op" id="64159">,</span>&nbsp;<span class="ident" id="64161">v</span>&nbsp;<span class="op" id="64163">:=</span>&nbsp;<span class="keyword" id="64166">range</span>&nbsp;<span class="ident" id="64172">bb</span>&nbsp;<span class="op" id="64175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="64182">if</span>&nbsp;<span class="ident" id="64185">v</span>&nbsp;<span class="op" id="64187">!=</span>&nbsp;<span class="builtintype" id="64190">byte</span><span class="op" id="64194">(</span><span class="ident" id="64195">l</span><span class="op" id="64196">+</span><span class="ident" id="64197">i</span><span class="op" id="64198">)</span>&nbsp;<span class="op" id="64200">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="64208">t</span><span class="op" id="64209">.</span><span class="ident" id="64210">Fatalf</span><span class="op" id="64216">(</span><span class="string" id="64217">&#34;in&nbsp;%d,%d:&nbsp;Next(%d)[%d]&nbsp;=&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="64255">,</span>&nbsp;<span class="ident" id="64257">i</span><span class="op" id="64258">,</span>&nbsp;<span class="ident" id="64260">j</span><span class="op" id="64261">,</span>&nbsp;<span class="ident" id="64263">k</span><span class="op" id="64264">,</span>&nbsp;<span class="ident" id="64266">l</span><span class="op" id="64267">,</span>&nbsp;<span class="ident" id="64269">v</span><span class="op" id="64270">,</span>&nbsp;<span class="ident" id="64272">l</span><span class="op" id="64273">+</span><span class="ident" id="64274">i</span><span class="op" id="64275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="64282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="64288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="64293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="64297">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="64300">}</span><br>
<span class="lineno"></span><span class="op" id="64302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="64305">var</span>&nbsp;<span class="ident" id="64309">readBytesTests</span>&nbsp;<span class="op" id="64324">=</span>&nbsp;<span class="op" id="64326">[</span><span class="op" id="64327">]</span><span class="keyword" id="64328">struct</span>&nbsp;<span class="op" id="64335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="64338">buffer</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="64347">string</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="64355">delim</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="64364">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="64370">expected</span>&nbsp;<span class="op" id="64379">[</span><span class="op" id="64380">]</span><span class="builtintype" id="64381">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="64389">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="64398">error</span><br>
<span class="lineno"></span><span class="op" id="64404">}</span><span class="op" id="64405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="64408">{</span><span class="string" id="64409">&#34;&#34;</span><span class="op" id="64411">,</span>&nbsp;<span class="num" id="64413">0</span><span class="op" id="64414">,</span>&nbsp;<span class="op" id="64416">[</span><span class="op" id="64417">]</span><span class="builtintype" id="64418">string</span><span class="op" id="64424">{</span><span class="string" id="64425">&#34;&#34;</span><span class="op" id="64427">}</span><span class="op" id="64428">,</span>&nbsp;<span class="ident" id="64430">io</span><span class="op" id="64432">.</span><span class="ident" id="64433">EOF</span><span class="op" id="64436">}</span><span class="op" id="64437">,</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="64440">{</span><span class="string" id="64441">&#34;a\x00&#34;</span><span class="op" id="64448">,</span>&nbsp;<span class="num" id="64450">0</span><span class="op" id="64451">,</span>&nbsp;<span class="op" id="64453">[</span><span class="op" id="64454">]</span><span class="builtintype" id="64455">string</span><span class="op" id="64461">{</span><span class="string" id="64462">&#34;a\x00&#34;</span><span class="op" id="64469">}</span><span class="op" id="64470">,</span>&nbsp;<span class="ident" id="64472">nil</span><span class="op" id="64475">}</span><span class="op" id="64476">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="64479">{</span><span class="string" id="64480">&#34;abbbaaaba&#34;</span><span class="op" id="64491">,</span>&nbsp;<span class="string" id="64493">&#39;b&#39;</span><span class="op" id="64496">,</span>&nbsp;<span class="op" id="64498">[</span><span class="op" id="64499">]</span><span class="builtintype" id="64500">string</span><span class="op" id="64506">{</span><span class="string" id="64507">&#34;ab&#34;</span><span class="op" id="64511">,</span>&nbsp;<span class="string" id="64513">&#34;b&#34;</span><span class="op" id="64516">,</span>&nbsp;<span class="string" id="64518">&#34;b&#34;</span><span class="op" id="64521">,</span>&nbsp;<span class="string" id="64523">&#34;aaab&#34;</span><span class="op" id="64529">}</span><span class="op" id="64530">,</span>&nbsp;<span class="ident" id="64532">nil</span><span class="op" id="64535">}</span><span class="op" id="64536">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="64539">{</span><span class="string" id="64540">&#34;hello\x01world&#34;</span><span class="op" id="64556">,</span>&nbsp;<span class="num" id="64558">1</span><span class="op" id="64559">,</span>&nbsp;<span class="op" id="64561">[</span><span class="op" id="64562">]</span><span class="builtintype" id="64563">string</span><span class="op" id="64569">{</span><span class="string" id="64570">&#34;hello\x01&#34;</span><span class="op" id="64581">}</span><span class="op" id="64582">,</span>&nbsp;<span class="ident" id="64584">nil</span><span class="op" id="64587">}</span><span class="op" id="64588">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="64591">{</span><span class="string" id="64592">&#34;foo\nbar&#34;</span><span class="op" id="64602">,</span>&nbsp;<span class="num" id="64604">0</span><span class="op" id="64605">,</span>&nbsp;<span class="op" id="64607">[</span><span class="op" id="64608">]</span><span class="builtintype" id="64609">string</span><span class="op" id="64615">{</span><span class="string" id="64616">&#34;foo\nbar&#34;</span><span class="op" id="64626">}</span><span class="op" id="64627">,</span>&nbsp;<span class="ident" id="64629">io</span><span class="op" id="64631">.</span><span class="ident" id="64632">EOF</span><span class="op" id="64635">}</span><span class="op" id="64636">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="64639">{</span><span class="string" id="64640">&#34;alpha\nbeta\ngamma\n&#34;</span><span class="op" id="64662">,</span>&nbsp;<span class="string" id="64664">&#39;\n&#39;</span><span class="op" id="64668">,</span>&nbsp;<span class="op" id="64670">[</span><span class="op" id="64671">]</span><span class="builtintype" id="64672">string</span><span class="op" id="64678">{</span><span class="string" id="64679">&#34;alpha\n&#34;</span><span class="op" id="64688">,</span>&nbsp;<span class="string" id="64690">&#34;beta\n&#34;</span><span class="op" id="64698">,</span>&nbsp;<span class="string" id="64700">&#34;gamma\n&#34;</span><span class="op" id="64709">}</span><span class="op" id="64710">,</span>&nbsp;<span class="ident" id="64712">nil</span><span class="op" id="64715">}</span><span class="op" id="64716">,</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="64719">{</span><span class="string" id="64720">&#34;alpha\nbeta\ngamma&#34;</span><span class="op" id="64740">,</span>&nbsp;<span class="string" id="64742">&#39;\n&#39;</span><span class="op" id="64746">,</span>&nbsp;<span class="op" id="64748">[</span><span class="op" id="64749">]</span><span class="builtintype" id="64750">string</span><span class="op" id="64756">{</span><span class="string" id="64757">&#34;alpha\n&#34;</span><span class="op" id="64766">,</span>&nbsp;<span class="string" id="64768">&#34;beta\n&#34;</span><span class="op" id="64776">,</span>&nbsp;<span class="string" id="64778">&#34;gamma&#34;</span><span class="op" id="64785">}</span><span class="op" id="64786">,</span>&nbsp;<span class="ident" id="64788">io</span><span class="op" id="64790">.</span><span class="ident" id="64791">EOF</span><span class="op" id="64794">}</span><span class="op" id="64795">,</span><br>
<span class="lineno"></span><span class="op" id="64797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="64800">func</span>&nbsp;<span class="ident" id="64805">TestReadBytes</span><span class="op" id="64818">(</span><span class="ident" id="64819">t</span>&nbsp;<span class="op" id="64821">*</span><span class="ident" id="64822">testing</span><span class="op" id="64829">.</span><span class="ident" id="64830">T</span><span class="op" id="64831">)</span>&nbsp;<span class="op" id="64833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="64836">for</span>&nbsp;<span class="ident" id="64840">_</span><span class="op" id="64841">,</span>&nbsp;<span class="ident" id="64843">test</span>&nbsp;<span class="op" id="64848">:=</span>&nbsp;<span class="keyword" id="64851">range</span>&nbsp;<span class="ident" id="64857">readBytesTests</span>&nbsp;<span class="op" id="64872">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="64876">buf</span>&nbsp;<span class="op" id="64880">:=</span>&nbsp;<span class="ident" id="64883">NewBufferString</span><span class="op" id="64898">(</span><span class="ident" id="64899">test</span><span class="op" id="64903">.</span><span class="ident" id="64904">buffer</span><span class="op" id="64910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="64914">var</span>&nbsp;<span class="ident" id="64918">err</span>&nbsp;<span class="builtintype" id="64922">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="64930">for</span>&nbsp;<span class="ident" id="64934">_</span><span class="op" id="64935">,</span>&nbsp;<span class="ident" id="64937">expected</span>&nbsp;<span class="op" id="64946">:=</span>&nbsp;<span class="keyword" id="64949">range</span>&nbsp;<span class="ident" id="64955">test</span><span class="op" id="64959">.</span><span class="ident" id="64960">expected</span>&nbsp;<span class="op" id="64969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="64974">var</span>&nbsp;<span class="ident" id="64978">bytes</span>&nbsp;<span class="op" id="64984">[</span><span class="op" id="64985">]</span><span class="builtintype" id="64986">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="64994">bytes</span><span class="op" id="64999">,</span>&nbsp;<span class="ident" id="65001">err</span>&nbsp;<span class="op" id="65005">=</span>&nbsp;<span class="ident" id="65007">buf</span><span class="op" id="65010">.</span><span class="ident" id="65011">ReadBytes</span><span class="op" id="65020">(</span><span class="ident" id="65021">test</span><span class="op" id="65025">.</span><span class="ident" id="65026">delim</span><span class="op" id="65031">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="65036">if</span>&nbsp;<span class="builtintype" id="65039">string</span><span class="op" id="65045">(</span><span class="ident" id="65046">bytes</span><span class="op" id="65051">)</span>&nbsp;<span class="op" id="65053">!=</span>&nbsp;<span class="ident" id="65056">expected</span>&nbsp;<span class="op" id="65065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="65071">t</span><span class="op" id="65072">.</span><span class="ident" id="65073">Errorf</span><span class="op" id="65079">(</span><span class="string" id="65080">&#34;expected&nbsp;%q,&nbsp;got&nbsp;%q&#34;</span><span class="op" id="65101">,</span>&nbsp;<span class="ident" id="65103">expected</span><span class="op" id="65111">,</span>&nbsp;<span class="ident" id="65113">bytes</span><span class="op" id="65118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="65123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="65128">if</span>&nbsp;<span class="ident" id="65131">err</span>&nbsp;<span class="op" id="65135">!=</span>&nbsp;<span class="ident" id="65138">nil</span>&nbsp;<span class="op" id="65142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="65148">break</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="65157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="65161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="65165">if</span>&nbsp;<span class="ident" id="65168">err</span>&nbsp;<span class="op" id="65172">!=</span>&nbsp;<span class="ident" id="65175">test</span><span class="op" id="65179">.</span><span class="ident" id="65180">err</span>&nbsp;<span class="op" id="65184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="65189">t</span><span class="op" id="65190">.</span><span class="ident" id="65191">Errorf</span><span class="op" id="65197">(</span><span class="string" id="65198">&#34;expected&nbsp;error&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="65225">,</span>&nbsp;<span class="ident" id="65227">test</span><span class="op" id="65231">.</span><span class="ident" id="65232">err</span><span class="op" id="65235">,</span>&nbsp;<span class="ident" id="65237">err</span><span class="op" id="65240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="65244">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="65247">}</span><br>
<span class="lineno"></span><span class="op" id="65249">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="65252">func</span>&nbsp;<span class="ident" id="65257">TestReadString</span><span class="op" id="65271">(</span><span class="ident" id="65272">t</span>&nbsp;<span class="op" id="65274">*</span><span class="ident" id="65275">testing</span><span class="op" id="65282">.</span><span class="ident" id="65283">T</span><span class="op" id="65284">)</span>&nbsp;<span class="op" id="65286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="65289">for</span>&nbsp;<span class="ident" id="65293">_</span><span class="op" id="65294">,</span>&nbsp;<span class="ident" id="65296">test</span>&nbsp;<span class="op" id="65301">:=</span>&nbsp;<span class="keyword" id="65304">range</span>&nbsp;<span class="ident" id="65310">readBytesTests</span>&nbsp;<span class="op" id="65325">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="65329">buf</span>&nbsp;<span class="op" id="65333">:=</span>&nbsp;<span class="ident" id="65336">NewBufferString</span><span class="op" id="65351">(</span><span class="ident" id="65352">test</span><span class="op" id="65356">.</span><span class="ident" id="65357">buffer</span><span class="op" id="65363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="65367">var</span>&nbsp;<span class="ident" id="65371">err</span>&nbsp;<span class="builtintype" id="65375">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="65383">for</span>&nbsp;<span class="ident" id="65387">_</span><span class="op" id="65388">,</span>&nbsp;<span class="ident" id="65390">expected</span>&nbsp;<span class="op" id="65399">:=</span>&nbsp;<span class="keyword" id="65402">range</span>&nbsp;<span class="ident" id="65408">test</span><span class="op" id="65412">.</span><span class="ident" id="65413">expected</span>&nbsp;<span class="op" id="65422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="65427">var</span>&nbsp;<span class="ident" id="65431">s</span>&nbsp;<span class="builtintype" id="65433">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="65443">s</span><span class="op" id="65444">,</span>&nbsp;<span class="ident" id="65446">err</span>&nbsp;<span class="op" id="65450">=</span>&nbsp;<span class="ident" id="65452">buf</span><span class="op" id="65455">.</span><span class="ident" id="65456">ReadString</span><span class="op" id="65466">(</span><span class="ident" id="65467">test</span><span class="op" id="65471">.</span><span class="ident" id="65472">delim</span><span class="op" id="65477">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="65482">if</span>&nbsp;<span class="ident" id="65485">s</span>&nbsp;<span class="op" id="65487">!=</span>&nbsp;<span class="ident" id="65490">expected</span>&nbsp;<span class="op" id="65499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="65505">t</span><span class="op" id="65506">.</span><span class="ident" id="65507">Errorf</span><span class="op" id="65513">(</span><span class="string" id="65514">&#34;expected&nbsp;%q,&nbsp;got&nbsp;%q&#34;</span><span class="op" id="65535">,</span>&nbsp;<span class="ident" id="65537">expected</span><span class="op" id="65545">,</span>&nbsp;<span class="ident" id="65547">s</span><span class="op" id="65548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="65553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="65558">if</span>&nbsp;<span class="ident" id="65561">err</span>&nbsp;<span class="op" id="65565">!=</span>&nbsp;<span class="ident" id="65568">nil</span>&nbsp;<span class="op" id="65572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="65578">break</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="65587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="65591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="65595">if</span>&nbsp;<span class="ident" id="65598">err</span>&nbsp;<span class="op" id="65602">!=</span>&nbsp;<span class="ident" id="65605">test</span><span class="op" id="65609">.</span><span class="ident" id="65610">err</span>&nbsp;<span class="op" id="65614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="65619">t</span><span class="op" id="65620">.</span><span class="ident" id="65621">Errorf</span><span class="op" id="65627">(</span><span class="string" id="65628">&#34;expected&nbsp;error&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="65655">,</span>&nbsp;<span class="ident" id="65657">test</span><span class="op" id="65661">.</span><span class="ident" id="65662">err</span><span class="op" id="65665">,</span>&nbsp;<span class="ident" id="65667">err</span><span class="op" id="65670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="65674">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="65677">}</span><br>
<span class="lineno"></span><span class="op" id="65679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="65682">func</span>&nbsp;<span class="ident" id="65687">BenchmarkReadString</span><span class="op" id="65706">(</span><span class="ident" id="65707">b</span>&nbsp;<span class="op" id="65709">*</span><span class="ident" id="65710">testing</span><span class="op" id="65717">.</span><span class="ident" id="65718">B</span><span class="op" id="65719">)</span>&nbsp;<span class="op" id="65721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="65724">const</span>&nbsp;<span class="ident" id="65730">n</span>&nbsp;<span class="op" id="65732">=</span>&nbsp;<span class="num" id="65734">32</span>&nbsp;<span class="op" id="65737">&lt;&lt;</span>&nbsp;<span class="num" id="65740">10</span><br>
<span class="lineno">400</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="65745">data</span>&nbsp;<span class="op" id="65750">:=</span>&nbsp;<span class="builtinfunc" id="65753">make</span><span class="op" id="65757">(</span><span class="op" id="65758">[</span><span class="op" id="65759">]</span><span class="builtintype" id="65760">byte</span><span class="op" id="65764">,</span>&nbsp;<span class="ident" id="65766">n</span><span class="op" id="65767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="65770">data</span><span class="op" id="65774">[</span><span class="ident" id="65775">n</span><span class="op" id="65776">-</span><span class="num" id="65777">1</span><span class="op" id="65778">]</span>&nbsp;<span class="op" id="65780">=</span>&nbsp;<span class="string" id="65782">&#39;x&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="65787">b</span><span class="op" id="65788">.</span><span class="ident" id="65789">SetBytes</span><span class="op" id="65797">(</span><span class="ident" id="65798">int64</span><span class="op" id="65803">(</span><span class="ident" id="65804">n</span><span class="op" id="65805">)</span><span class="op" id="65806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="65809">for</span>&nbsp;<span class="ident" id="65813">i</span>&nbsp;<span class="op" id="65815">:=</span>&nbsp;<span class="num" id="65818">0</span><span class="op" id="65819">;</span>&nbsp;<span class="ident" id="65821">i</span>&nbsp;<span class="op" id="65823">&lt;</span>&nbsp;<span class="ident" id="65825">b</span><span class="op" id="65826">.</span><span class="ident" id="65827">N</span><span class="op" id="65828">;</span>&nbsp;<span class="ident" id="65830">i</span><span class="op" id="65831">++</span>&nbsp;<span class="op" id="65834">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="65838">buf</span>&nbsp;<span class="op" id="65842">:=</span>&nbsp;<span class="ident" id="65845">NewBuffer</span><span class="op" id="65854">(</span><span class="ident" id="65855">data</span><span class="op" id="65859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="65863">_</span><span class="op" id="65864">,</span>&nbsp;<span class="ident" id="65866">err</span>&nbsp;<span class="op" id="65870">:=</span>&nbsp;<span class="ident" id="65873">buf</span><span class="op" id="65876">.</span><span class="ident" id="65877">ReadString</span><span class="op" id="65887">(</span><span class="string" id="65888">&#39;x&#39;</span><span class="op" id="65891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="65895">if</span>&nbsp;<span class="ident" id="65898">err</span>&nbsp;<span class="op" id="65902">!=</span>&nbsp;<span class="ident" id="65905">nil</span>&nbsp;<span class="op" id="65909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="65914">b</span><span class="op" id="65915">.</span><span class="ident" id="65916">Fatal</span><span class="op" id="65921">(</span><span class="ident" id="65922">err</span><span class="op" id="65925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="65929">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="65932">}</span><br>
<span class="lineno"></span><span class="op" id="65934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="65937">func</span>&nbsp;<span class="ident" id="65942">TestGrow</span><span class="op" id="65950">(</span><span class="ident" id="65951">t</span>&nbsp;<span class="op" id="65953">*</span><span class="ident" id="65954">testing</span><span class="op" id="65961">.</span><span class="ident" id="65962">T</span><span class="op" id="65963">)</span>&nbsp;<span class="op" id="65965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="65968">x</span>&nbsp;<span class="op" id="65970">:=</span>&nbsp;<span class="op" id="65973">[</span><span class="op" id="65974">]</span><span class="builtintype" id="65975">byte</span><span class="op" id="65979">{</span><span class="string" id="65980">&#39;x&#39;</span><span class="op" id="65983">}</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="65986">y</span>&nbsp;<span class="op" id="65988">:=</span>&nbsp;<span class="op" id="65991">[</span><span class="op" id="65992">]</span><span class="builtintype" id="65993">byte</span><span class="op" id="65997">{</span><span class="string" id="65998">&#39;y&#39;</span><span class="op" id="66001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="66004">tmp</span>&nbsp;<span class="op" id="66008">:=</span>&nbsp;<span class="builtinfunc" id="66011">make</span><span class="op" id="66015">(</span><span class="op" id="66016">[</span><span class="op" id="66017">]</span><span class="builtintype" id="66018">byte</span><span class="op" id="66022">,</span>&nbsp;<span class="num" id="66024">72</span><span class="op" id="66026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="66029">for</span>&nbsp;<span class="ident" id="66033">_</span><span class="op" id="66034">,</span>&nbsp;<span class="ident" id="66036">startLen</span>&nbsp;<span class="op" id="66045">:=</span>&nbsp;<span class="keyword" id="66048">range</span>&nbsp;<span class="op" id="66054">[</span><span class="op" id="66055">]</span><span class="builtintype" id="66056">int</span><span class="op" id="66059">{</span><span class="num" id="66060">0</span><span class="op" id="66061">,</span>&nbsp;<span class="num" id="66063">100</span><span class="op" id="66066">,</span>&nbsp;<span class="num" id="66068">1000</span><span class="op" id="66072">,</span>&nbsp;<span class="num" id="66074">10000</span><span class="op" id="66079">,</span>&nbsp;<span class="num" id="66081">100000</span><span class="op" id="66087">}</span>&nbsp;<span class="op" id="66089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="66093">xBytes</span>&nbsp;<span class="op" id="66100">:=</span>&nbsp;<span class="ident" id="66103">Repeat</span><span class="op" id="66109">(</span><span class="ident" id="66110">x</span><span class="op" id="66111">,</span>&nbsp;<span class="ident" id="66113">startLen</span><span class="op" id="66121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="66125">for</span>&nbsp;<span class="ident" id="66129">_</span><span class="op" id="66130">,</span>&nbsp;<span class="ident" id="66132">growLen</span>&nbsp;<span class="op" id="66140">:=</span>&nbsp;<span class="keyword" id="66143">range</span>&nbsp;<span class="op" id="66149">[</span><span class="op" id="66150">]</span><span class="builtintype" id="66151">int</span><span class="op" id="66154">{</span><span class="num" id="66155">0</span><span class="op" id="66156">,</span>&nbsp;<span class="num" id="66158">100</span><span class="op" id="66161">,</span>&nbsp;<span class="num" id="66163">1000</span><span class="op" id="66167">,</span>&nbsp;<span class="num" id="66169">10000</span><span class="op" id="66174">,</span>&nbsp;<span class="num" id="66176">100000</span><span class="op" id="66182">}</span>&nbsp;<span class="op" id="66184">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="66189">buf</span>&nbsp;<span class="op" id="66193">:=</span>&nbsp;<span class="ident" id="66196">NewBuffer</span><span class="op" id="66205">(</span><span class="ident" id="66206">xBytes</span><span class="op" id="66212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="66217">//&nbsp;If&nbsp;we&nbsp;read,&nbsp;this&nbsp;affects&nbsp;buf.off,&nbsp;which&nbsp;is&nbsp;good&nbsp;to&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="66280">readBytes</span><span class="op" id="66289">,</span>&nbsp;<span class="ident" id="66291">_</span>&nbsp;<span class="op" id="66293">:=</span>&nbsp;<span class="ident" id="66296">buf</span><span class="op" id="66299">.</span><span class="ident" id="66300">Read</span><span class="op" id="66304">(</span><span class="ident" id="66305">tmp</span><span class="op" id="66308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="66313">buf</span><span class="op" id="66316">.</span><span class="ident" id="66317">Grow</span><span class="op" id="66321">(</span><span class="ident" id="66322">growLen</span><span class="op" id="66329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="66334">yBytes</span>&nbsp;<span class="op" id="66341">:=</span>&nbsp;<span class="ident" id="66344">Repeat</span><span class="op" id="66350">(</span><span class="ident" id="66351">y</span><span class="op" id="66352">,</span>&nbsp;<span class="ident" id="66354">growLen</span><span class="op" id="66361">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="66366">//&nbsp;Check&nbsp;no&nbsp;allocation&nbsp;occurs&nbsp;in&nbsp;write,&nbsp;as&nbsp;long&nbsp;as&nbsp;we&#39;re&nbsp;single-threaded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="66443">var</span>&nbsp;<span class="ident" id="66447">m1</span><span class="op" id="66449">,</span>&nbsp;<span class="ident" id="66451">m2</span>&nbsp;<span class="ident" id="66454">runtime</span><span class="op" id="66461">.</span><span class="ident" id="66462">MemStats</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="66474">runtime</span><span class="op" id="66481">.</span><span class="ident" id="66482">ReadMemStats</span><span class="op" id="66494">(</span><span class="op" id="66495">&amp;</span><span class="ident" id="66496">m1</span><span class="op" id="66498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="66503">buf</span><span class="op" id="66506">.</span><span class="ident" id="66507">Write</span><span class="op" id="66512">(</span><span class="ident" id="66513">yBytes</span><span class="op" id="66519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="66524">runtime</span><span class="op" id="66531">.</span><span class="ident" id="66532">ReadMemStats</span><span class="op" id="66544">(</span><span class="op" id="66545">&amp;</span><span class="ident" id="66546">m2</span><span class="op" id="66548">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="66553">if</span>&nbsp;<span class="ident" id="66556">runtime</span><span class="op" id="66563">.</span><span class="ident" id="66564">GOMAXPROCS</span><span class="op" id="66574">(</span><span class="op" id="66575">-</span><span class="num" id="66576">1</span><span class="op" id="66577">)</span>&nbsp;<span class="op" id="66579">==</span>&nbsp;<span class="num" id="66582">1</span>&nbsp;<span class="op" id="66584">&amp;&amp;</span>&nbsp;<span class="ident" id="66587">m1</span><span class="op" id="66589">.</span><span class="ident" id="66590">Mallocs</span>&nbsp;<span class="op" id="66598">!=</span>&nbsp;<span class="ident" id="66601">m2</span><span class="op" id="66603">.</span><span class="ident" id="66604">Mallocs</span>&nbsp;<span class="op" id="66612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="66618">t</span><span class="op" id="66619">.</span><span class="ident" id="66620">Errorf</span><span class="op" id="66626">(</span><span class="string" id="66627">&#34;allocation&nbsp;occurred&nbsp;during&nbsp;write&#34;</span><span class="op" id="66661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="66666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="66671">//&nbsp;Check&nbsp;that&nbsp;buffer&nbsp;has&nbsp;correct&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="66713">if</span>&nbsp;<span class="op" id="66716">!</span><span class="ident" id="66717">Equal</span><span class="op" id="66722">(</span><span class="ident" id="66723">buf</span><span class="op" id="66726">.</span><span class="ident" id="66727">Bytes</span><span class="op" id="66732">(</span><span class="op" id="66733">)</span><span class="op" id="66734">[</span><span class="num" id="66735">0</span><span class="op" id="66736">:</span><span class="ident" id="66737">startLen</span><span class="op" id="66745">-</span><span class="ident" id="66746">readBytes</span><span class="op" id="66755">]</span><span class="op" id="66756">,</span>&nbsp;<span class="ident" id="66758">xBytes</span><span class="op" id="66764">[</span><span class="ident" id="66765">readBytes</span><span class="op" id="66774">:</span><span class="op" id="66775">]</span><span class="op" id="66776">)</span>&nbsp;<span class="op" id="66778">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="66784">t</span><span class="op" id="66785">.</span><span class="ident" id="66786">Errorf</span><span class="op" id="66792">(</span><span class="string" id="66793">&#34;bad&nbsp;initial&nbsp;data&nbsp;at&nbsp;%d&nbsp;%d&#34;</span><span class="op" id="66820">,</span>&nbsp;<span class="ident" id="66822">startLen</span><span class="op" id="66830">,</span>&nbsp;<span class="ident" id="66832">growLen</span><span class="op" id="66839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="66844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="66849">if</span>&nbsp;<span class="op" id="66852">!</span><span class="ident" id="66853">Equal</span><span class="op" id="66858">(</span><span class="ident" id="66859">buf</span><span class="op" id="66862">.</span><span class="ident" id="66863">Bytes</span><span class="op" id="66868">(</span><span class="op" id="66869">)</span><span class="op" id="66870">[</span><span class="ident" id="66871">startLen</span><span class="op" id="66879">-</span><span class="ident" id="66880">readBytes</span><span class="op" id="66889">:</span><span class="ident" id="66890">startLen</span><span class="op" id="66898">-</span><span class="ident" id="66899">readBytes</span><span class="op" id="66908">+</span><span class="ident" id="66909">growLen</span><span class="op" id="66916">]</span><span class="op" id="66917">,</span>&nbsp;<span class="ident" id="66919">yBytes</span><span class="op" id="66925">)</span>&nbsp;<span class="op" id="66927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="66933">t</span><span class="op" id="66934">.</span><span class="ident" id="66935">Errorf</span><span class="op" id="66941">(</span><span class="string" id="66942">&#34;bad&nbsp;written&nbsp;data&nbsp;at&nbsp;%d&nbsp;%d&#34;</span><span class="op" id="66969">,</span>&nbsp;<span class="ident" id="66971">startLen</span><span class="op" id="66979">,</span>&nbsp;<span class="ident" id="66981">growLen</span><span class="op" id="66988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="66993">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="66997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="67000">}</span><br>
<span class="lineno"></span><span class="op" id="67002">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="67005">//&nbsp;Was&nbsp;a&nbsp;bug:&nbsp;used&nbsp;to&nbsp;give&nbsp;EOF&nbsp;reading&nbsp;empty&nbsp;slice&nbsp;at&nbsp;EOF.</span><br>
<span class="lineno">445</span><span class="keyword" id="67064">func</span>&nbsp;<span class="ident" id="67069">TestReadEmptyAtEOF</span><span class="op" id="67087">(</span><span class="ident" id="67088">t</span>&nbsp;<span class="op" id="67090">*</span><span class="ident" id="67091">testing</span><span class="op" id="67098">.</span><span class="ident" id="67099">T</span><span class="op" id="67100">)</span>&nbsp;<span class="op" id="67102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="67105">b</span>&nbsp;<span class="op" id="67107">:=</span>&nbsp;<span class="builtinfunc" id="67110">new</span><span class="op" id="67113">(</span><span class="ident" id="67114">Buffer</span><span class="op" id="67120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="67123">slice</span>&nbsp;<span class="op" id="67129">:=</span>&nbsp;<span class="builtinfunc" id="67132">make</span><span class="op" id="67136">(</span><span class="op" id="67137">[</span><span class="op" id="67138">]</span><span class="builtintype" id="67139">byte</span><span class="op" id="67143">,</span>&nbsp;<span class="num" id="67145">0</span><span class="op" id="67146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="67149">n</span><span class="op" id="67150">,</span>&nbsp;<span class="ident" id="67152">err</span>&nbsp;<span class="op" id="67156">:=</span>&nbsp;<span class="ident" id="67159">b</span><span class="op" id="67160">.</span><span class="ident" id="67161">Read</span><span class="op" id="67165">(</span><span class="ident" id="67166">slice</span><span class="op" id="67171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="67174">if</span>&nbsp;<span class="ident" id="67177">err</span>&nbsp;<span class="op" id="67181">!=</span>&nbsp;<span class="ident" id="67184">nil</span>&nbsp;<span class="op" id="67188">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="67192">t</span><span class="op" id="67193">.</span><span class="ident" id="67194">Errorf</span><span class="op" id="67200">(</span><span class="string" id="67201">&#34;read&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="67217">,</span>&nbsp;<span class="ident" id="67219">err</span><span class="op" id="67222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="67225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="67228">if</span>&nbsp;<span class="ident" id="67231">n</span>&nbsp;<span class="op" id="67233">!=</span>&nbsp;<span class="num" id="67236">0</span>&nbsp;<span class="op" id="67238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="67242">t</span><span class="op" id="67243">.</span><span class="ident" id="67244">Errorf</span><span class="op" id="67250">(</span><span class="string" id="67251">&#34;wrong&nbsp;count;&nbsp;got&nbsp;%d&nbsp;want&nbsp;0&#34;</span><span class="op" id="67279">,</span>&nbsp;<span class="ident" id="67281">n</span><span class="op" id="67282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="67285">}</span><br>
<span class="lineno">455</span><span class="op" id="67287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="67290">func</span>&nbsp;<span class="ident" id="67295">TestUnreadByte</span><span class="op" id="67309">(</span><span class="ident" id="67310">t</span>&nbsp;<span class="op" id="67312">*</span><span class="ident" id="67313">testing</span><span class="op" id="67320">.</span><span class="ident" id="67321">T</span><span class="op" id="67322">)</span>&nbsp;<span class="op" id="67324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="67327">b</span>&nbsp;<span class="op" id="67329">:=</span>&nbsp;<span class="builtinfunc" id="67332">new</span><span class="op" id="67335">(</span><span class="ident" id="67336">Buffer</span><span class="op" id="67342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="67345">b</span><span class="op" id="67346">.</span><span class="ident" id="67347">WriteString</span><span class="op" id="67358">(</span><span class="string" id="67359">&#34;abcdefghijklmnopqrstuvwxyz&#34;</span><span class="op" id="67387">)</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="67391">_</span><span class="op" id="67392">,</span>&nbsp;<span class="ident" id="67394">err</span>&nbsp;<span class="op" id="67398">:=</span>&nbsp;<span class="ident" id="67401">b</span><span class="op" id="67402">.</span><span class="ident" id="67403">ReadBytes</span><span class="op" id="67412">(</span><span class="string" id="67413">&#39;m&#39;</span><span class="op" id="67416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="67419">if</span>&nbsp;<span class="ident" id="67422">err</span>&nbsp;<span class="op" id="67426">!=</span>&nbsp;<span class="ident" id="67429">nil</span>&nbsp;<span class="op" id="67433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="67437">t</span><span class="op" id="67438">.</span><span class="ident" id="67439">Fatalf</span><span class="op" id="67445">(</span><span class="string" id="67446">&#34;ReadBytes:&nbsp;%v&#34;</span><span class="op" id="67461">,</span>&nbsp;<span class="ident" id="67463">err</span><span class="op" id="67466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="67469">}</span><br>
<span class="lineno">465</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="67473">err</span>&nbsp;<span class="op" id="67477">=</span>&nbsp;<span class="ident" id="67479">b</span><span class="op" id="67480">.</span><span class="ident" id="67481">UnreadByte</span><span class="op" id="67491">(</span><span class="op" id="67492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="67495">if</span>&nbsp;<span class="ident" id="67498">err</span>&nbsp;<span class="op" id="67502">!=</span>&nbsp;<span class="ident" id="67505">nil</span>&nbsp;<span class="op" id="67509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="67513">t</span><span class="op" id="67514">.</span><span class="ident" id="67515">Fatalf</span><span class="op" id="67521">(</span><span class="string" id="67522">&#34;UnreadByte:&nbsp;%v&#34;</span><span class="op" id="67538">,</span>&nbsp;<span class="ident" id="67540">err</span><span class="op" id="67543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="67546">}</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="67549">c</span><span class="op" id="67550">,</span>&nbsp;<span class="ident" id="67552">err</span>&nbsp;<span class="op" id="67556">:=</span>&nbsp;<span class="ident" id="67559">b</span><span class="op" id="67560">.</span><span class="ident" id="67561">ReadByte</span><span class="op" id="67569">(</span><span class="op" id="67570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="67573">if</span>&nbsp;<span class="ident" id="67576">err</span>&nbsp;<span class="op" id="67580">!=</span>&nbsp;<span class="ident" id="67583">nil</span>&nbsp;<span class="op" id="67587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="67591">t</span><span class="op" id="67592">.</span><span class="ident" id="67593">Fatalf</span><span class="op" id="67599">(</span><span class="string" id="67600">&#34;ReadByte:&nbsp;%v&#34;</span><span class="op" id="67614">,</span>&nbsp;<span class="ident" id="67616">err</span><span class="op" id="67619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="67622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="67625">if</span>&nbsp;<span class="ident" id="67628">c</span>&nbsp;<span class="op" id="67630">!=</span>&nbsp;<span class="string" id="67633">&#39;m&#39;</span>&nbsp;<span class="op" id="67637">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="67641">t</span><span class="op" id="67642">.</span><span class="ident" id="67643">Errorf</span><span class="op" id="67649">(</span><span class="string" id="67650">&#34;ReadByte&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="67674">,</span>&nbsp;<span class="ident" id="67676">c</span><span class="op" id="67677">,</span>&nbsp;<span class="string" id="67679">&#39;m&#39;</span><span class="op" id="67682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="67685">}</span><br>
<span class="lineno"></span><span class="op" id="67687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="67690">//&nbsp;Tests&nbsp;that&nbsp;we&nbsp;occasionally&nbsp;compact.&nbsp;Issue&nbsp;5154.</span><br>
<span class="lineno">480</span><span class="keyword" id="67741">func</span>&nbsp;<span class="ident" id="67746">TestBufferGrowth</span><span class="op" id="67762">(</span><span class="ident" id="67763">t</span>&nbsp;<span class="op" id="67765">*</span><span class="ident" id="67766">testing</span><span class="op" id="67773">.</span><span class="ident" id="67774">T</span><span class="op" id="67775">)</span>&nbsp;<span class="op" id="67777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="67780">var</span>&nbsp;<span class="ident" id="67784">b</span>&nbsp;<span class="ident" id="67786">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="67794">buf</span>&nbsp;<span class="op" id="67798">:=</span>&nbsp;<span class="builtinfunc" id="67801">make</span><span class="op" id="67805">(</span><span class="op" id="67806">[</span><span class="op" id="67807">]</span><span class="builtintype" id="67808">byte</span><span class="op" id="67812">,</span>&nbsp;<span class="num" id="67814">1024</span><span class="op" id="67818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="67821">b</span><span class="op" id="67822">.</span><span class="ident" id="67823">Write</span><span class="op" id="67828">(</span><span class="ident" id="67829">buf</span><span class="op" id="67832">[</span><span class="num" id="67833">0</span><span class="op" id="67834">:</span><span class="num" id="67835">1</span><span class="op" id="67836">]</span><span class="op" id="67837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="67840">var</span>&nbsp;<span class="ident" id="67844">cap0</span>&nbsp;<span class="builtintype" id="67849">int</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="67854">for</span>&nbsp;<span class="ident" id="67858">i</span>&nbsp;<span class="op" id="67860">:=</span>&nbsp;<span class="num" id="67863">0</span><span class="op" id="67864">;</span>&nbsp;<span class="ident" id="67866">i</span>&nbsp;<span class="op" id="67868">&lt;</span>&nbsp;<span class="num" id="67870">5</span><span class="op" id="67871">&lt;&lt;</span><span class="num" id="67873">10</span><span class="op" id="67875">;</span>&nbsp;<span class="ident" id="67877">i</span><span class="op" id="67878">++</span>&nbsp;<span class="op" id="67881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="67885">b</span><span class="op" id="67886">.</span><span class="ident" id="67887">Write</span><span class="op" id="67892">(</span><span class="ident" id="67893">buf</span><span class="op" id="67896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="67900">b</span><span class="op" id="67901">.</span><span class="ident" id="67902">Read</span><span class="op" id="67906">(</span><span class="ident" id="67907">buf</span><span class="op" id="67910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="67914">if</span>&nbsp;<span class="ident" id="67917">i</span>&nbsp;<span class="op" id="67919">==</span>&nbsp;<span class="num" id="67922">0</span>&nbsp;<span class="op" id="67924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="67929">cap0</span>&nbsp;<span class="op" id="67934">=</span>&nbsp;<span class="ident" id="67936">b</span><span class="op" id="67937">.</span><span class="ident" id="67938">Cap</span><span class="op" id="67941">(</span><span class="op" id="67942">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="67946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="67949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="67952">cap1</span>&nbsp;<span class="op" id="67957">:=</span>&nbsp;<span class="ident" id="67960">b</span><span class="op" id="67961">.</span><span class="ident" id="67962">Cap</span><span class="op" id="67965">(</span><span class="op" id="67966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="67969">//&nbsp;(*Buffer).grow&nbsp;allows&nbsp;for&nbsp;2x&nbsp;capacity&nbsp;slop&nbsp;before&nbsp;sliding,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="68032">//&nbsp;so&nbsp;set&nbsp;our&nbsp;error&nbsp;threshold&nbsp;at&nbsp;3x.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="68070">if</span>&nbsp;<span class="ident" id="68073">cap1</span>&nbsp;<span class="op" id="68078">&gt;</span>&nbsp;<span class="ident" id="68080">cap0</span><span class="op" id="68084">*</span><span class="num" id="68085">3</span>&nbsp;<span class="op" id="68087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="68091">t</span><span class="op" id="68092">.</span><span class="ident" id="68093">Errorf</span><span class="op" id="68099">(</span><span class="string" id="68100">&#34;buffer&nbsp;cap&nbsp;=&nbsp;%d;&nbsp;too&nbsp;big&nbsp;(grew&nbsp;from&nbsp;%d)&#34;</span><span class="op" id="68141">,</span>&nbsp;<span class="ident" id="68143">cap1</span><span class="op" id="68147">,</span>&nbsp;<span class="ident" id="68149">cap0</span><span class="op" id="68153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="68156">}</span><br>
<span class="lineno"></span><span class="op" id="68158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span><span class="comment" id="68161">//&nbsp;From&nbsp;Issue&nbsp;5154.</span><br>
<span class="lineno"></span><span class="keyword" id="68181">func</span>&nbsp;<span class="ident" id="68186">BenchmarkBufferNotEmptyWriteRead</span><span class="op" id="68218">(</span><span class="ident" id="68219">b</span>&nbsp;<span class="op" id="68221">*</span><span class="ident" id="68222">testing</span><span class="op" id="68229">.</span><span class="ident" id="68230">B</span><span class="op" id="68231">)</span>&nbsp;<span class="op" id="68233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="68236">buf</span>&nbsp;<span class="op" id="68240">:=</span>&nbsp;<span class="builtinfunc" id="68243">make</span><span class="op" id="68247">(</span><span class="op" id="68248">[</span><span class="op" id="68249">]</span><span class="builtintype" id="68250">byte</span><span class="op" id="68254">,</span>&nbsp;<span class="num" id="68256">1024</span><span class="op" id="68260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="68263">for</span>&nbsp;<span class="ident" id="68267">i</span>&nbsp;<span class="op" id="68269">:=</span>&nbsp;<span class="num" id="68272">0</span><span class="op" id="68273">;</span>&nbsp;<span class="ident" id="68275">i</span>&nbsp;<span class="op" id="68277">&lt;</span>&nbsp;<span class="ident" id="68279">b</span><span class="op" id="68280">.</span><span class="ident" id="68281">N</span><span class="op" id="68282">;</span>&nbsp;<span class="ident" id="68284">i</span><span class="op" id="68285">++</span>&nbsp;<span class="op" id="68288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="68292">var</span>&nbsp;<span class="ident" id="68296">b</span>&nbsp;<span class="ident" id="68298">Buffer</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="68307">b</span><span class="op" id="68308">.</span><span class="ident" id="68309">Write</span><span class="op" id="68314">(</span><span class="ident" id="68315">buf</span><span class="op" id="68318">[</span><span class="num" id="68319">0</span><span class="op" id="68320">:</span><span class="num" id="68321">1</span><span class="op" id="68322">]</span><span class="op" id="68323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="68327">for</span>&nbsp;<span class="ident" id="68331">i</span>&nbsp;<span class="op" id="68333">:=</span>&nbsp;<span class="num" id="68336">0</span><span class="op" id="68337">;</span>&nbsp;<span class="ident" id="68339">i</span>&nbsp;<span class="op" id="68341">&lt;</span>&nbsp;<span class="num" id="68343">5</span><span class="op" id="68344">&lt;&lt;</span><span class="num" id="68346">10</span><span class="op" id="68348">;</span>&nbsp;<span class="ident" id="68350">i</span><span class="op" id="68351">++</span>&nbsp;<span class="op" id="68354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="68359">b</span><span class="op" id="68360">.</span><span class="ident" id="68361">Write</span><span class="op" id="68366">(</span><span class="ident" id="68367">buf</span><span class="op" id="68370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="68375">b</span><span class="op" id="68376">.</span><span class="ident" id="68377">Read</span><span class="op" id="68381">(</span><span class="ident" id="68382">buf</span><span class="op" id="68385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="68389">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="68392">}</span><br>
<span class="lineno"></span><span class="op" id="68394">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="68397">//&nbsp;Check&nbsp;that&nbsp;we&nbsp;don&#39;t&nbsp;compact&nbsp;too&nbsp;often.&nbsp;From&nbsp;Issue&nbsp;5154.</span><br>
<span class="lineno"></span><span class="keyword" id="68456">func</span>&nbsp;<span class="ident" id="68461">BenchmarkBufferFullSmallReads</span><span class="op" id="68490">(</span><span class="ident" id="68491">b</span>&nbsp;<span class="op" id="68493">*</span><span class="ident" id="68494">testing</span><span class="op" id="68501">.</span><span class="ident" id="68502">B</span><span class="op" id="68503">)</span>&nbsp;<span class="op" id="68505">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="68508">buf</span>&nbsp;<span class="op" id="68512">:=</span>&nbsp;<span class="builtinfunc" id="68515">make</span><span class="op" id="68519">(</span><span class="op" id="68520">[</span><span class="op" id="68521">]</span><span class="builtintype" id="68522">byte</span><span class="op" id="68526">,</span>&nbsp;<span class="num" id="68528">1024</span><span class="op" id="68532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="68535">for</span>&nbsp;<span class="ident" id="68539">i</span>&nbsp;<span class="op" id="68541">:=</span>&nbsp;<span class="num" id="68544">0</span><span class="op" id="68545">;</span>&nbsp;<span class="ident" id="68547">i</span>&nbsp;<span class="op" id="68549">&lt;</span>&nbsp;<span class="ident" id="68551">b</span><span class="op" id="68552">.</span><span class="ident" id="68553">N</span><span class="op" id="68554">;</span>&nbsp;<span class="ident" id="68556">i</span><span class="op" id="68557">++</span>&nbsp;<span class="op" id="68560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="68564">var</span>&nbsp;<span class="ident" id="68568">b</span>&nbsp;<span class="ident" id="68570">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="68579">b</span><span class="op" id="68580">.</span><span class="ident" id="68581">Write</span><span class="op" id="68586">(</span><span class="ident" id="68587">buf</span><span class="op" id="68590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="68594">for</span>&nbsp;<span class="ident" id="68598">b</span><span class="op" id="68599">.</span><span class="ident" id="68600">Len</span><span class="op" id="68603">(</span><span class="op" id="68604">)</span><span class="op" id="68605">+</span><span class="num" id="68606">20</span>&nbsp;<span class="op" id="68609">&lt;</span>&nbsp;<span class="ident" id="68611">b</span><span class="op" id="68612">.</span><span class="ident" id="68613">Cap</span><span class="op" id="68616">(</span><span class="op" id="68617">)</span>&nbsp;<span class="op" id="68619">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="68624">b</span><span class="op" id="68625">.</span><span class="ident" id="68626">Write</span><span class="op" id="68631">(</span><span class="ident" id="68632">buf</span><span class="op" id="68635">[</span><span class="op" id="68636">:</span><span class="num" id="68637">10</span><span class="op" id="68639">]</span><span class="op" id="68640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="68644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="68648">for</span>&nbsp;<span class="ident" id="68652">i</span>&nbsp;<span class="op" id="68654">:=</span>&nbsp;<span class="num" id="68657">0</span><span class="op" id="68658">;</span>&nbsp;<span class="ident" id="68660">i</span>&nbsp;<span class="op" id="68662">&lt;</span>&nbsp;<span class="num" id="68664">5</span><span class="op" id="68665">&lt;&lt;</span><span class="num" id="68667">10</span><span class="op" id="68669">;</span>&nbsp;<span class="ident" id="68671">i</span><span class="op" id="68672">++</span>&nbsp;<span class="op" id="68675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="68680">b</span><span class="op" id="68681">.</span><span class="ident" id="68682">Read</span><span class="op" id="68686">(</span><span class="ident" id="68687">buf</span><span class="op" id="68690">[</span><span class="op" id="68691">:</span><span class="num" id="68692">1</span><span class="op" id="68693">]</span><span class="op" id="68694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="68699">b</span><span class="op" id="68700">.</span><span class="ident" id="68701">Write</span><span class="op" id="68706">(</span><span class="ident" id="68707">buf</span><span class="op" id="68710">[</span><span class="op" id="68711">:</span><span class="num" id="68712">1</span><span class="op" id="68713">]</span><span class="op" id="68714">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="68718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="68721">}</span><br>
<span class="lineno"></span><span class="op" id="68723">}</span>
</div>
</body>
</html>
