<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4364024">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4364079">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4364133">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4364184">//&nbsp;Package&nbsp;crc32&nbsp;implements&nbsp;the&nbsp;32-bit&nbsp;cyclic&nbsp;redundancy&nbsp;check,&nbsp;or&nbsp;CRC-32,</span><br>
<span class="lineno"></span><span class="comment" id="4364259">//&nbsp;checksum.&nbsp;See&nbsp;http://en.wikipedia.org/wiki/Cyclic_redundancy_check&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="4364333">//&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="4364349">package</span>&nbsp;<span class="ident" id="4364357">crc32</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="4364364">import</span>&nbsp;<span class="op" id="4364371">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4364374">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4364382">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="4364389">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="4364392">//&nbsp;The&nbsp;size&nbsp;of&nbsp;a&nbsp;CRC-32&nbsp;checksum&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="4364435">const</span>&nbsp;<span class="ident" id="4364441">Size</span>&nbsp;<span class="op" id="4364446">=</span>&nbsp;<span class="num" id="4364448">4</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4364451">//&nbsp;Predefined&nbsp;polynomials.</span><br>
<span class="lineno"></span><span class="keyword" id="4364478">const</span>&nbsp;<span class="op" id="4364484">(</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4364487">//&nbsp;IEEE&nbsp;is&nbsp;by&nbsp;far&nbsp;and&nbsp;away&nbsp;the&nbsp;most&nbsp;common&nbsp;CRC-32&nbsp;polynomial.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4364550">//&nbsp;Used&nbsp;by&nbsp;ethernet&nbsp;(IEEE&nbsp;802.3),&nbsp;v.42,&nbsp;fddi,&nbsp;gzip,&nbsp;zip,&nbsp;png,&nbsp;...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4364617">IEEE</span>&nbsp;<span class="op" id="4364622">=</span>&nbsp;<span class="num" id="4364624">0xedb88320</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4364637">//&nbsp;Castagnoli&#39;s&nbsp;polynomial,&nbsp;used&nbsp;in&nbsp;iSCSI.</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4364681">//&nbsp;Has&nbsp;better&nbsp;error&nbsp;detection&nbsp;characteristics&nbsp;than&nbsp;IEEE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4364739">//&nbsp;http://dx.doi.org/10.1109/26.231911</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4364779">Castagnoli</span>&nbsp;<span class="op" id="4364790">=</span>&nbsp;<span class="num" id="4364792">0x82f63b78</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4364805">//&nbsp;Koopman&#39;s&nbsp;polynomial.</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4364831">//&nbsp;Also&nbsp;has&nbsp;better&nbsp;error&nbsp;detection&nbsp;characteristics&nbsp;than&nbsp;IEEE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4364894">//&nbsp;http://dx.doi.org/10.1109/DSN.2002.1028931</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4364941">Koopman</span>&nbsp;<span class="op" id="4364949">=</span>&nbsp;<span class="num" id="4364951">0xeb31d82e</span><br>
<span class="lineno"></span><span class="op" id="4364962">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="4364965">//&nbsp;Table&nbsp;is&nbsp;a&nbsp;256-word&nbsp;table&nbsp;representing&nbsp;the&nbsp;polynomial&nbsp;for&nbsp;efficient&nbsp;processing.</span><br>
<span class="lineno"></span><span class="keyword" id="4365048">type</span>&nbsp;<span class="ident" id="4365053">Table</span>&nbsp;<span class="op" id="4365059">[</span><span class="num" id="4365060">256</span><span class="op" id="4365063">]</span><span class="builtintype" id="4365064">uint32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4365072">//&nbsp;castagnoliTable&nbsp;points&nbsp;to&nbsp;a&nbsp;lazily&nbsp;initialized&nbsp;Table&nbsp;for&nbsp;the&nbsp;Castagnoli</span><br>
<span class="lineno"></span><span class="comment" id="4365147">//&nbsp;polynomial.&nbsp;MakeTable&nbsp;will&nbsp;always&nbsp;return&nbsp;this&nbsp;value&nbsp;when&nbsp;asked&nbsp;to&nbsp;make&nbsp;a</span><br>
<span class="lineno">40</span><span class="comment" id="4365223">//&nbsp;Castagnoli&nbsp;table&nbsp;so&nbsp;we&nbsp;can&nbsp;compare&nbsp;against&nbsp;it&nbsp;to&nbsp;find&nbsp;when&nbsp;the&nbsp;caller&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4365299">//&nbsp;using&nbsp;this&nbsp;polynomial.</span><br>
<span class="lineno"></span><span class="keyword" id="4365325">var</span>&nbsp;<span class="ident" id="4365329">castagnoliTable</span>&nbsp;<span class="op" id="4365345">*</span><span class="ident" id="4365346">Table</span><br>
<span class="lineno"></span><span class="keyword" id="4365352">var</span>&nbsp;<span class="ident" id="4365356">castagnoliOnce</span>&nbsp;<span class="ident" id="4365371">sync</span><span class="op" id="4365375">.</span><span class="ident" id="4365376">Once</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="4365382">func</span>&nbsp;<span class="ident" id="4365387">castagnoliInit</span><span class="op" id="4365401">(</span><span class="op" id="4365402">)</span>&nbsp;<span class="op" id="4365404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4365407">castagnoliTable</span>&nbsp;<span class="op" id="4365423">=</span>&nbsp;<span class="ident" id="4365425">makeTable</span><span class="op" id="4365434">(</span><span class="ident" id="4365435">Castagnoli</span><span class="op" id="4365445">)</span><br>
<span class="lineno"></span><span class="op" id="4365447">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4365450">//&nbsp;IEEETable&nbsp;is&nbsp;the&nbsp;table&nbsp;for&nbsp;the&nbsp;IEEE&nbsp;polynomial.</span><br>
<span class="lineno">50</span><span class="keyword" id="4365501">var</span>&nbsp;<span class="ident" id="4365505">IEEETable</span>&nbsp;<span class="op" id="4365515">=</span>&nbsp;<span class="ident" id="4365517">makeTable</span><span class="op" id="4365526">(</span><span class="ident" id="4365527">IEEE</span><span class="op" id="4365531">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4365534">//&nbsp;MakeTable&nbsp;returns&nbsp;the&nbsp;Table&nbsp;constructed&nbsp;from&nbsp;the&nbsp;specified&nbsp;polynomial.</span><br>
<span class="lineno"></span><span class="keyword" id="4365608">func</span>&nbsp;<span class="ident" id="4365613">MakeTable</span><span class="op" id="4365622">(</span><span class="ident" id="4365623">poly</span>&nbsp;<span class="builtintype" id="4365628">uint32</span><span class="op" id="4365634">)</span>&nbsp;<span class="op" id="4365636">*</span><span class="ident" id="4365637">Table</span>&nbsp;<span class="op" id="4365643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4365646">switch</span>&nbsp;<span class="ident" id="4365653">poly</span>&nbsp;<span class="op" id="4365658">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4365661">case</span>&nbsp;<span class="ident" id="4365666">IEEE</span><span class="op" id="4365670">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4365674">return</span>&nbsp;<span class="ident" id="4365681">IEEETable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4365692">case</span>&nbsp;<span class="ident" id="4365697">Castagnoli</span><span class="op" id="4365707">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4365711">castagnoliOnce</span><span class="op" id="4365725">.</span><span class="ident" id="4365726">Do</span><span class="op" id="4365728">(</span><span class="ident" id="4365729">castagnoliInit</span><span class="op" id="4365743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4365747">return</span>&nbsp;<span class="ident" id="4365754">castagnoliTable</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4365771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4365774">return</span>&nbsp;<span class="ident" id="4365781">makeTable</span><span class="op" id="4365790">(</span><span class="ident" id="4365791">poly</span><span class="op" id="4365795">)</span><br>
<span class="lineno"></span><span class="op" id="4365797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4365800">//&nbsp;makeTable&nbsp;returns&nbsp;the&nbsp;Table&nbsp;constructed&nbsp;from&nbsp;the&nbsp;specified&nbsp;polynomial.</span><br>
<span class="lineno">65</span><span class="keyword" id="4365874">func</span>&nbsp;<span class="ident" id="4365879">makeTable</span><span class="op" id="4365888">(</span><span class="ident" id="4365889">poly</span>&nbsp;<span class="builtintype" id="4365894">uint32</span><span class="op" id="4365900">)</span>&nbsp;<span class="op" id="4365902">*</span><span class="ident" id="4365903">Table</span>&nbsp;<span class="op" id="4365909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4365912">t</span>&nbsp;<span class="op" id="4365914">:=</span>&nbsp;<span class="builtinfunc" id="4365917">new</span><span class="op" id="4365920">(</span><span class="ident" id="4365921">Table</span><span class="op" id="4365926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4365929">for</span>&nbsp;<span class="ident" id="4365933">i</span>&nbsp;<span class="op" id="4365935">:=</span>&nbsp;<span class="num" id="4365938">0</span><span class="op" id="4365939">;</span>&nbsp;<span class="ident" id="4365941">i</span>&nbsp;<span class="op" id="4365943">&lt;</span>&nbsp;<span class="num" id="4365945">256</span><span class="op" id="4365948">;</span>&nbsp;<span class="ident" id="4365950">i</span><span class="op" id="4365951">++</span>&nbsp;<span class="op" id="4365954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4365958">crc</span>&nbsp;<span class="op" id="4365962">:=</span>&nbsp;<span class="builtintype" id="4365965">uint32</span><span class="op" id="4365971">(</span><span class="ident" id="4365972">i</span><span class="op" id="4365973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4365977">for</span>&nbsp;<span class="ident" id="4365981">j</span>&nbsp;<span class="op" id="4365983">:=</span>&nbsp;<span class="num" id="4365986">0</span><span class="op" id="4365987">;</span>&nbsp;<span class="ident" id="4365989">j</span>&nbsp;<span class="op" id="4365991">&lt;</span>&nbsp;<span class="num" id="4365993">8</span><span class="op" id="4365994">;</span>&nbsp;<span class="ident" id="4365996">j</span><span class="op" id="4365997">++</span>&nbsp;<span class="op" id="4366000">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4366005">if</span>&nbsp;<span class="ident" id="4366008">crc</span><span class="op" id="4366011">&amp;</span><span class="num" id="4366012">1</span>&nbsp;<span class="op" id="4366014">==</span>&nbsp;<span class="num" id="4366017">1</span>&nbsp;<span class="op" id="4366019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4366025">crc</span>&nbsp;<span class="op" id="4366029">=</span>&nbsp;<span class="op" id="4366031">(</span><span class="ident" id="4366032">crc</span>&nbsp;<span class="op" id="4366036">&gt;&gt;</span>&nbsp;<span class="num" id="4366039">1</span><span class="op" id="4366040">)</span>&nbsp;<span class="op" id="4366042">^</span>&nbsp;<span class="ident" id="4366044">poly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4366052">}</span>&nbsp;<span class="keyword" id="4366054">else</span>&nbsp;<span class="op" id="4366059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4366065">crc</span>&nbsp;<span class="op" id="4366069">&gt;&gt;=</span>&nbsp;<span class="num" id="4366073">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4366078">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4366082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4366086">t</span><span class="op" id="4366087">[</span><span class="ident" id="4366088">i</span><span class="op" id="4366089">]</span>&nbsp;<span class="op" id="4366091">=</span>&nbsp;<span class="ident" id="4366093">crc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4366098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4366101">return</span>&nbsp;<span class="ident" id="4366108">t</span><br>
<span class="lineno"></span><span class="op" id="4366110">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="4366113">//&nbsp;digest&nbsp;represents&nbsp;the&nbsp;partial&nbsp;evaluation&nbsp;of&nbsp;a&nbsp;checksum.</span><br>
<span class="lineno"></span><span class="keyword" id="4366172">type</span>&nbsp;<span class="ident" id="4366177">digest</span>&nbsp;<span class="keyword" id="4366184">struct</span>&nbsp;<span class="op" id="4366191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4366194">crc</span>&nbsp;<span class="builtintype" id="4366198">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4366206">tab</span>&nbsp;<span class="op" id="4366210">*</span><span class="ident" id="4366211">Table</span><br>
<span class="lineno">85</span><span class="op" id="4366217">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4366220">//&nbsp;New&nbsp;creates&nbsp;a&nbsp;new&nbsp;hash.Hash32&nbsp;computing&nbsp;the&nbsp;CRC-32&nbsp;checksum</span><br>
<span class="lineno"></span><span class="comment" id="4366283">//&nbsp;using&nbsp;the&nbsp;polynomial&nbsp;represented&nbsp;by&nbsp;the&nbsp;Table.</span><br>
<span class="lineno"></span><span class="keyword" id="4366333">func</span>&nbsp;<span class="ident" id="4366338">New</span><span class="op" id="4366341">(</span><span class="ident" id="4366342">tab</span>&nbsp;<span class="op" id="4366346">*</span><span class="ident" id="4366347">Table</span><span class="op" id="4366352">)</span>&nbsp;<span class="ident" id="4366354">hash</span><span class="op" id="4366358">.</span><span class="ident" id="4366359">Hash32</span>&nbsp;<span class="op" id="4366366">{</span>&nbsp;<span class="keyword" id="4366368">return</span>&nbsp;<span class="op" id="4366375">&amp;</span><span class="ident" id="4366376">digest</span><span class="op" id="4366382">{</span><span class="num" id="4366383">0</span><span class="op" id="4366384">,</span>&nbsp;<span class="ident" id="4366386">tab</span><span class="op" id="4366389">}</span>&nbsp;<span class="op" id="4366391">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="comment" id="4366394">//&nbsp;NewIEEE&nbsp;creates&nbsp;a&nbsp;new&nbsp;hash.Hash32&nbsp;computing&nbsp;the&nbsp;CRC-32&nbsp;checksum</span><br>
<span class="lineno"></span><span class="comment" id="4366461">//&nbsp;using&nbsp;the&nbsp;IEEE&nbsp;polynomial.</span><br>
<span class="lineno"></span><span class="keyword" id="4366491">func</span>&nbsp;<span class="ident" id="4366496">NewIEEE</span><span class="op" id="4366503">(</span><span class="op" id="4366504">)</span>&nbsp;<span class="ident" id="4366506">hash</span><span class="op" id="4366510">.</span><span class="ident" id="4366511">Hash32</span>&nbsp;<span class="op" id="4366518">{</span>&nbsp;<span class="keyword" id="4366520">return</span>&nbsp;<span class="ident" id="4366527">New</span><span class="op" id="4366530">(</span><span class="ident" id="4366531">IEEETable</span><span class="op" id="4366540">)</span>&nbsp;<span class="op" id="4366542">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="4366545">func</span>&nbsp;<span class="op" id="4366550">(</span><span class="ident" id="4366551">d</span>&nbsp;<span class="op" id="4366553">*</span><span class="ident" id="4366554">digest</span><span class="op" id="4366560">)</span>&nbsp;<span class="ident" id="4366562">Size</span><span class="op" id="4366566">(</span><span class="op" id="4366567">)</span>&nbsp;<span class="builtintype" id="4366569">int</span>&nbsp;<span class="op" id="4366573">{</span>&nbsp;<span class="keyword" id="4366575">return</span>&nbsp;<span class="ident" id="4366582">Size</span>&nbsp;<span class="op" id="4366587">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4366590">func</span>&nbsp;<span class="op" id="4366595">(</span><span class="ident" id="4366596">d</span>&nbsp;<span class="op" id="4366598">*</span><span class="ident" id="4366599">digest</span><span class="op" id="4366605">)</span>&nbsp;<span class="ident" id="4366607">BlockSize</span><span class="op" id="4366616">(</span><span class="op" id="4366617">)</span>&nbsp;<span class="builtintype" id="4366619">int</span>&nbsp;<span class="op" id="4366623">{</span>&nbsp;<span class="keyword" id="4366625">return</span>&nbsp;<span class="num" id="4366632">1</span>&nbsp;<span class="op" id="4366634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4366637">func</span>&nbsp;<span class="op" id="4366642">(</span><span class="ident" id="4366643">d</span>&nbsp;<span class="op" id="4366645">*</span><span class="ident" id="4366646">digest</span><span class="op" id="4366652">)</span>&nbsp;<span class="ident" id="4366654">Reset</span><span class="op" id="4366659">(</span><span class="op" id="4366660">)</span>&nbsp;<span class="op" id="4366662">{</span>&nbsp;<span class="ident" id="4366664">d</span><span class="op" id="4366665">.</span><span class="ident" id="4366666">crc</span>&nbsp;<span class="op" id="4366670">=</span>&nbsp;<span class="num" id="4366672">0</span>&nbsp;<span class="op" id="4366674">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="4366677">func</span>&nbsp;<span class="ident" id="4366682">update</span><span class="op" id="4366688">(</span><span class="ident" id="4366689">crc</span>&nbsp;<span class="builtintype" id="4366693">uint32</span><span class="op" id="4366699">,</span>&nbsp;<span class="ident" id="4366701">tab</span>&nbsp;<span class="op" id="4366705">*</span><span class="ident" id="4366706">Table</span><span class="op" id="4366711">,</span>&nbsp;<span class="ident" id="4366713">p</span>&nbsp;<span class="op" id="4366715">[</span><span class="op" id="4366716">]</span><span class="builtintype" id="4366717">byte</span><span class="op" id="4366721">)</span>&nbsp;<span class="builtintype" id="4366723">uint32</span>&nbsp;<span class="op" id="4366730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4366733">crc</span>&nbsp;<span class="op" id="4366737">=</span>&nbsp;<span class="op" id="4366739">^</span><span class="ident" id="4366740">crc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4366745">for</span>&nbsp;<span class="ident" id="4366749">_</span><span class="op" id="4366750">,</span>&nbsp;<span class="ident" id="4366752">v</span>&nbsp;<span class="op" id="4366754">:=</span>&nbsp;<span class="keyword" id="4366757">range</span>&nbsp;<span class="ident" id="4366763">p</span>&nbsp;<span class="op" id="4366765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4366769">crc</span>&nbsp;<span class="op" id="4366773">=</span>&nbsp;<span class="ident" id="4366775">tab</span><span class="op" id="4366778">[</span><span class="builtintype" id="4366779">byte</span><span class="op" id="4366783">(</span><span class="ident" id="4366784">crc</span><span class="op" id="4366787">)</span><span class="op" id="4366788">^</span><span class="ident" id="4366789">v</span><span class="op" id="4366790">]</span>&nbsp;<span class="op" id="4366792">^</span>&nbsp;<span class="op" id="4366794">(</span><span class="ident" id="4366795">crc</span>&nbsp;<span class="op" id="4366799">&gt;&gt;</span>&nbsp;<span class="num" id="4366802">8</span><span class="op" id="4366803">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4366806">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4366809">return</span>&nbsp;<span class="op" id="4366816">^</span><span class="ident" id="4366817">crc</span><br>
<span class="lineno"></span><span class="op" id="4366821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4366824">//&nbsp;Update&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;adding&nbsp;the&nbsp;bytes&nbsp;in&nbsp;p&nbsp;to&nbsp;the&nbsp;crc.</span><br>
<span class="lineno">110</span><span class="keyword" id="4366890">func</span>&nbsp;<span class="ident" id="4366895">Update</span><span class="op" id="4366901">(</span><span class="ident" id="4366902">crc</span>&nbsp;<span class="builtintype" id="4366906">uint32</span><span class="op" id="4366912">,</span>&nbsp;<span class="ident" id="4366914">tab</span>&nbsp;<span class="op" id="4366918">*</span><span class="ident" id="4366919">Table</span><span class="op" id="4366924">,</span>&nbsp;<span class="ident" id="4366926">p</span>&nbsp;<span class="op" id="4366928">[</span><span class="op" id="4366929">]</span><span class="builtintype" id="4366930">byte</span><span class="op" id="4366934">)</span>&nbsp;<span class="builtintype" id="4366936">uint32</span>&nbsp;<span class="op" id="4366943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4366946">if</span>&nbsp;<span class="ident" id="4366949">tab</span>&nbsp;<span class="op" id="4366953">==</span>&nbsp;<span class="ident" id="4366956">castagnoliTable</span>&nbsp;<span class="op" id="4366972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4366976">return</span>&nbsp;<span class="ident" id="4366983">updateCastagnoli</span><span class="op" id="4366999">(</span><span class="ident" id="4367000">crc</span><span class="op" id="4367003">,</span>&nbsp;<span class="ident" id="4367005">p</span><span class="op" id="4367006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4367009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4367012">return</span>&nbsp;<span class="ident" id="4367019">update</span><span class="op" id="4367025">(</span><span class="ident" id="4367026">crc</span><span class="op" id="4367029">,</span>&nbsp;<span class="ident" id="4367031">tab</span><span class="op" id="4367034">,</span>&nbsp;<span class="ident" id="4367036">p</span><span class="op" id="4367037">)</span><br>
<span class="lineno">115</span><span class="op" id="4367039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4367042">func</span>&nbsp;<span class="op" id="4367047">(</span><span class="ident" id="4367048">d</span>&nbsp;<span class="op" id="4367050">*</span><span class="ident" id="4367051">digest</span><span class="op" id="4367057">)</span>&nbsp;<span class="ident" id="4367059">Write</span><span class="op" id="4367064">(</span><span class="ident" id="4367065">p</span>&nbsp;<span class="op" id="4367067">[</span><span class="op" id="4367068">]</span><span class="builtintype" id="4367069">byte</span><span class="op" id="4367073">)</span>&nbsp;<span class="op" id="4367075">(</span><span class="ident" id="4367076">n</span>&nbsp;<span class="builtintype" id="4367078">int</span><span class="op" id="4367081">,</span>&nbsp;<span class="ident" id="4367083">err</span>&nbsp;<span class="builtintype" id="4367087">error</span><span class="op" id="4367092">)</span>&nbsp;<span class="op" id="4367094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4367097">d</span><span class="op" id="4367098">.</span><span class="ident" id="4367099">crc</span>&nbsp;<span class="op" id="4367103">=</span>&nbsp;<span class="ident" id="4367105">Update</span><span class="op" id="4367111">(</span><span class="ident" id="4367112">d</span><span class="op" id="4367113">.</span><span class="ident" id="4367114">crc</span><span class="op" id="4367117">,</span>&nbsp;<span class="ident" id="4367119">d</span><span class="op" id="4367120">.</span><span class="ident" id="4367121">tab</span><span class="op" id="4367124">,</span>&nbsp;<span class="ident" id="4367126">p</span><span class="op" id="4367127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4367130">return</span>&nbsp;<span class="builtinfunc" id="4367137">len</span><span class="op" id="4367140">(</span><span class="ident" id="4367141">p</span><span class="op" id="4367142">)</span><span class="op" id="4367143">,</span>&nbsp;<span class="ident" id="4367145">nil</span><br>
<span class="lineno">120</span><span class="op" id="4367149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4367152">func</span>&nbsp;<span class="op" id="4367157">(</span><span class="ident" id="4367158">d</span>&nbsp;<span class="op" id="4367160">*</span><span class="ident" id="4367161">digest</span><span class="op" id="4367167">)</span>&nbsp;<span class="ident" id="4367169">Sum32</span><span class="op" id="4367174">(</span><span class="op" id="4367175">)</span>&nbsp;<span class="builtintype" id="4367177">uint32</span>&nbsp;<span class="op" id="4367184">{</span>&nbsp;<span class="keyword" id="4367186">return</span>&nbsp;<span class="ident" id="4367193">d</span><span class="op" id="4367194">.</span><span class="ident" id="4367195">crc</span>&nbsp;<span class="op" id="4367199">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4367202">func</span>&nbsp;<span class="op" id="4367207">(</span><span class="ident" id="4367208">d</span>&nbsp;<span class="op" id="4367210">*</span><span class="ident" id="4367211">digest</span><span class="op" id="4367217">)</span>&nbsp;<span class="ident" id="4367219">Sum</span><span class="op" id="4367222">(</span><span class="ident" id="4367223">in</span>&nbsp;<span class="op" id="4367226">[</span><span class="op" id="4367227">]</span><span class="builtintype" id="4367228">byte</span><span class="op" id="4367232">)</span>&nbsp;<span class="op" id="4367234">[</span><span class="op" id="4367235">]</span><span class="builtintype" id="4367236">byte</span>&nbsp;<span class="op" id="4367241">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4367244">s</span>&nbsp;<span class="op" id="4367246">:=</span>&nbsp;<span class="ident" id="4367249">d</span><span class="op" id="4367250">.</span><span class="ident" id="4367251">Sum32</span><span class="op" id="4367256">(</span><span class="op" id="4367257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4367260">return</span>&nbsp;<span class="builtinfunc" id="4367267">append</span><span class="op" id="4367273">(</span><span class="ident" id="4367274">in</span><span class="op" id="4367276">,</span>&nbsp;<span class="builtintype" id="4367278">byte</span><span class="op" id="4367282">(</span><span class="ident" id="4367283">s</span><span class="op" id="4367284">&gt;&gt;</span><span class="num" id="4367286">24</span><span class="op" id="4367288">)</span><span class="op" id="4367289">,</span>&nbsp;<span class="builtintype" id="4367291">byte</span><span class="op" id="4367295">(</span><span class="ident" id="4367296">s</span><span class="op" id="4367297">&gt;&gt;</span><span class="num" id="4367299">16</span><span class="op" id="4367301">)</span><span class="op" id="4367302">,</span>&nbsp;<span class="builtintype" id="4367304">byte</span><span class="op" id="4367308">(</span><span class="ident" id="4367309">s</span><span class="op" id="4367310">&gt;&gt;</span><span class="num" id="4367312">8</span><span class="op" id="4367313">)</span><span class="op" id="4367314">,</span>&nbsp;<span class="builtintype" id="4367316">byte</span><span class="op" id="4367320">(</span><span class="ident" id="4367321">s</span><span class="op" id="4367322">)</span><span class="op" id="4367323">)</span><br>
<span class="lineno"></span><span class="op" id="4367325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4367328">//&nbsp;Checksum&nbsp;returns&nbsp;the&nbsp;CRC-32&nbsp;checksum&nbsp;of&nbsp;data</span><br>
<span class="lineno">130</span><span class="comment" id="4367376">//&nbsp;using&nbsp;the&nbsp;polynomial&nbsp;represented&nbsp;by&nbsp;the&nbsp;Table.</span><br>
<span class="lineno"></span><span class="keyword" id="4367426">func</span>&nbsp;<span class="ident" id="4367431">Checksum</span><span class="op" id="4367439">(</span><span class="ident" id="4367440">data</span>&nbsp;<span class="op" id="4367445">[</span><span class="op" id="4367446">]</span><span class="builtintype" id="4367447">byte</span><span class="op" id="4367451">,</span>&nbsp;<span class="ident" id="4367453">tab</span>&nbsp;<span class="op" id="4367457">*</span><span class="ident" id="4367458">Table</span><span class="op" id="4367463">)</span>&nbsp;<span class="builtintype" id="4367465">uint32</span>&nbsp;<span class="op" id="4367472">{</span>&nbsp;<span class="keyword" id="4367474">return</span>&nbsp;<span class="ident" id="4367481">Update</span><span class="op" id="4367487">(</span><span class="num" id="4367488">0</span><span class="op" id="4367489">,</span>&nbsp;<span class="ident" id="4367491">tab</span><span class="op" id="4367494">,</span>&nbsp;<span class="ident" id="4367496">data</span><span class="op" id="4367500">)</span>&nbsp;<span class="op" id="4367502">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4367505">//&nbsp;ChecksumIEEE&nbsp;returns&nbsp;the&nbsp;CRC-32&nbsp;checksum&nbsp;of&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="4367557">//&nbsp;using&nbsp;the&nbsp;IEEE&nbsp;polynomial.</span><br>
<span class="lineno">135</span><span class="keyword" id="4367587">func</span>&nbsp;<span class="ident" id="4367592">ChecksumIEEE</span><span class="op" id="4367604">(</span><span class="ident" id="4367605">data</span>&nbsp;<span class="op" id="4367610">[</span><span class="op" id="4367611">]</span><span class="builtintype" id="4367612">byte</span><span class="op" id="4367616">)</span>&nbsp;<span class="builtintype" id="4367618">uint32</span>&nbsp;<span class="op" id="4367625">{</span>&nbsp;<span class="keyword" id="4367627">return</span>&nbsp;<span class="ident" id="4367634">update</span><span class="op" id="4367640">(</span><span class="num" id="4367641">0</span><span class="op" id="4367642">,</span>&nbsp;<span class="ident" id="4367644">IEEETable</span><span class="op" id="4367653">,</span>&nbsp;<span class="ident" id="4367655">data</span><span class="op" id="4367659">)</span>&nbsp;<span class="op" id="4367661">}</span>
</div>
</body>
</html>
