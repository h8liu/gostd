<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6885309">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6885365">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6885419">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6885470">package</span>&nbsp;<span class="ident" id="6885478">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6885483">import</span>&nbsp;<span class="op" id="6885490">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6885493">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6885502">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6885508">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6885518">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6885521">func</span>&nbsp;<span class="ident" id="6885526">checkWrite</span><span class="op" id="6885536">(</span><span class="ident" id="6885537">t</span>&nbsp;<span class="op" id="6885539">*</span><span class="ident" id="6885540"><a href="/net/pipe_test.go.html#6885508">testing</a></span><span class="op" id="6885547">.</span><span class="ident" id="6885548">T</span><span class="op" id="6885549">,</span>&nbsp;<span class="ident" id="6885551">w</span>&nbsp;<span class="ident" id="6885553"><a href="/net/pipe_test.go.html#6885502">io</a></span><span class="op" id="6885555">.</span><span class="ident" id="6885556">Writer</span><span class="op" id="6885562">,</span>&nbsp;<span class="ident" id="6885564">data</span>&nbsp;<span class="op" id="6885569">[</span><span class="op" id="6885570">]</span><span class="builtintype" id="6885571">byte</span><span class="op" id="6885575">,</span>&nbsp;<span class="ident" id="6885577">c</span>&nbsp;<span class="keyword" id="6885579">chan</span>&nbsp;<span class="builtintype" id="6885584">int</span><span class="op" id="6885587">)</span>&nbsp;<span class="op" id="6885589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6885592">n</span><span class="op" id="6885593">,</span>&nbsp;<span class="ident" id="6885595">err</span>&nbsp;<span class="op" id="6885599">:=</span>&nbsp;<span class="ident" id="6885602"><a href="/net/pipe_test.go.html#6885551">w</a></span><span class="op" id="6885603">.</span><span class="ident" id="6885604">Write</span><span class="op" id="6885609">(</span><span class="ident" id="6885610"><a href="/net/pipe_test.go.html#6885564">data</a></span><span class="op" id="6885614">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6885617">if</span>&nbsp;<span class="ident" id="6885620"><a href="/net/pipe_test.go.html#6885595">err</a></span>&nbsp;<span class="op" id="6885624">!=</span>&nbsp;<span class="ident" id="6885627">nil</span>&nbsp;<span class="op" id="6885631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6885635"><a href="/net/pipe_test.go.html#6885537">t</a></span><span class="op" id="6885636">.</span><span class="ident" id="6885637">Errorf</span><span class="op" id="6885643">(</span><span class="string" id="6885644">&#34;write:&nbsp;%v&#34;</span><span class="op" id="6885655">,</span>&nbsp;<span class="ident" id="6885657"><a href="/net/pipe_test.go.html#6885595">err</a></span><span class="op" id="6885660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6885663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6885666">if</span>&nbsp;<span class="ident" id="6885669"><a href="/net/pipe_test.go.html#6885592">n</a></span>&nbsp;<span class="op" id="6885671">!=</span>&nbsp;<span class="builtinfunc" id="6885674">len</span><span class="op" id="6885677">(</span><span class="ident" id="6885678"><a href="/net/pipe_test.go.html#6885564">data</a></span><span class="op" id="6885682">)</span>&nbsp;<span class="op" id="6885684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6885688"><a href="/net/pipe_test.go.html#6885537">t</a></span><span class="op" id="6885689">.</span><span class="ident" id="6885690">Errorf</span><span class="op" id="6885696">(</span><span class="string" id="6885697">&#34;short&nbsp;write:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="6885720">,</span>&nbsp;<span class="ident" id="6885722"><a href="/net/pipe_test.go.html#6885592">n</a></span><span class="op" id="6885723">,</span>&nbsp;<span class="builtinfunc" id="6885725">len</span><span class="op" id="6885728">(</span><span class="ident" id="6885729"><a href="/net/pipe_test.go.html#6885564">data</a></span><span class="op" id="6885733">)</span><span class="op" id="6885734">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6885737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6885740"><a href="/net/pipe_test.go.html#6885577">c</a></span>&nbsp;<span class="op" id="6885742">&lt;-</span>&nbsp;<span class="num" id="6885745">0</span><br>
<span class="lineno"></span><span class="op" id="6885747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6885750">func</span>&nbsp;<span class="ident" id="6885755">checkRead</span><span class="op" id="6885764">(</span><span class="ident" id="6885765">t</span>&nbsp;<span class="op" id="6885767">*</span><span class="ident" id="6885768"><a href="/net/pipe_test.go.html#6885508">testing</a></span><span class="op" id="6885775">.</span><span class="ident" id="6885776">T</span><span class="op" id="6885777">,</span>&nbsp;<span class="ident" id="6885779">r</span>&nbsp;<span class="ident" id="6885781"><a href="/net/pipe_test.go.html#6885502">io</a></span><span class="op" id="6885783">.</span><span class="ident" id="6885784">Reader</span><span class="op" id="6885790">,</span>&nbsp;<span class="ident" id="6885792">data</span>&nbsp;<span class="op" id="6885797">[</span><span class="op" id="6885798">]</span><span class="builtintype" id="6885799">byte</span><span class="op" id="6885803">,</span>&nbsp;<span class="ident" id="6885805">wantErr</span>&nbsp;<span class="builtintype" id="6885813">error</span><span class="op" id="6885818">)</span>&nbsp;<span class="op" id="6885820">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6885823">buf</span>&nbsp;<span class="op" id="6885827">:=</span>&nbsp;<span class="builtinfunc" id="6885830">make</span><span class="op" id="6885834">(</span><span class="op" id="6885835">[</span><span class="op" id="6885836">]</span><span class="builtintype" id="6885837">byte</span><span class="op" id="6885841">,</span>&nbsp;<span class="builtinfunc" id="6885843">len</span><span class="op" id="6885846">(</span><span class="ident" id="6885847"><a href="/net/pipe_test.go.html#6885792">data</a></span><span class="op" id="6885851">)</span><span class="op" id="6885852">+</span><span class="num" id="6885853">10</span><span class="op" id="6885855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6885858">n</span><span class="op" id="6885859">,</span>&nbsp;<span class="ident" id="6885861">err</span>&nbsp;<span class="op" id="6885865">:=</span>&nbsp;<span class="ident" id="6885868"><a href="/net/pipe_test.go.html#6885779">r</a></span><span class="op" id="6885869">.</span><span class="ident" id="6885870">Read</span><span class="op" id="6885874">(</span><span class="ident" id="6885875"><a href="/net/pipe_test.go.html#6885823">buf</a></span><span class="op" id="6885878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6885881">if</span>&nbsp;<span class="ident" id="6885884"><a href="/net/pipe_test.go.html#6885861">err</a></span>&nbsp;<span class="op" id="6885888">!=</span>&nbsp;<span class="ident" id="6885891"><a href="/net/pipe_test.go.html#6885805">wantErr</a></span>&nbsp;<span class="op" id="6885899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6885903"><a href="/net/pipe_test.go.html#6885765">t</a></span><span class="op" id="6885904">.</span><span class="ident" id="6885905">Errorf</span><span class="op" id="6885911">(</span><span class="string" id="6885912">&#34;read:&nbsp;%v&#34;</span><span class="op" id="6885922">,</span>&nbsp;<span class="ident" id="6885924"><a href="/net/pipe_test.go.html#6885861">err</a></span><span class="op" id="6885927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6885931">return</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6885939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6885942">if</span>&nbsp;<span class="ident" id="6885945"><a href="/net/pipe_test.go.html#6885858">n</a></span>&nbsp;<span class="op" id="6885947">!=</span>&nbsp;<span class="builtinfunc" id="6885950">len</span><span class="op" id="6885953">(</span><span class="ident" id="6885954"><a href="/net/pipe_test.go.html#6885792">data</a></span><span class="op" id="6885958">)</span>&nbsp;<span class="op" id="6885960">||</span>&nbsp;<span class="op" id="6885963">!</span><span class="ident" id="6885964"><a href="/net/pipe_test.go.html#6885493">bytes</a></span><span class="op" id="6885969">.</span><span class="ident" id="6885970">Equal</span><span class="op" id="6885975">(</span><span class="ident" id="6885976"><a href="/net/pipe_test.go.html#6885823">buf</a></span><span class="op" id="6885979">[</span><span class="num" id="6885980">0</span><span class="op" id="6885981">:</span><span class="ident" id="6885982"><a href="/net/pipe_test.go.html#6885858">n</a></span><span class="op" id="6885983">]</span><span class="op" id="6885984">,</span>&nbsp;<span class="ident" id="6885986"><a href="/net/pipe_test.go.html#6885792">data</a></span><span class="op" id="6885990">)</span>&nbsp;<span class="op" id="6885992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6885996"><a href="/net/pipe_test.go.html#6885765">t</a></span><span class="op" id="6885997">.</span><span class="ident" id="6885998">Errorf</span><span class="op" id="6886004">(</span><span class="string" id="6886005">&#34;bad&nbsp;read:&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6886023">,</span>&nbsp;<span class="ident" id="6886025"><a href="/net/pipe_test.go.html#6885823">buf</a></span><span class="op" id="6886028">[</span><span class="num" id="6886029">0</span><span class="op" id="6886030">:</span><span class="ident" id="6886031"><a href="/net/pipe_test.go.html#6885858">n</a></span><span class="op" id="6886032">]</span><span class="op" id="6886033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6886037">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6886045">}</span><br>
<span class="lineno">35</span><span class="op" id="6886047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6886050">//&nbsp;Test&nbsp;a&nbsp;simple&nbsp;read/write/close&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="6886094">//&nbsp;Assumes&nbsp;that&nbsp;the&nbsp;underlying&nbsp;io.Pipe&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="6886148">//&nbsp;is&nbsp;solid&nbsp;and&nbsp;we&#39;re&nbsp;just&nbsp;testing&nbsp;the&nbsp;net&nbsp;wrapping.</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="6886202">func</span>&nbsp;<span class="ident" id="6886207">TestPipe</span><span class="op" id="6886215">(</span><span class="ident" id="6886216">t</span>&nbsp;<span class="op" id="6886218">*</span><span class="ident" id="6886219"><a href="/net/pipe_test.go.html#6885508">testing</a></span><span class="op" id="6886226">.</span><span class="ident" id="6886227">T</span><span class="op" id="6886228">)</span>&nbsp;<span class="op" id="6886230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6886233">c</span>&nbsp;<span class="op" id="6886235">:=</span>&nbsp;<span class="builtinfunc" id="6886238">make</span><span class="op" id="6886242">(</span><span class="keyword" id="6886243">chan</span>&nbsp;<span class="builtintype" id="6886248">int</span><span class="op" id="6886251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6886254">cli</span><span class="op" id="6886257">,</span>&nbsp;<span class="ident" id="6886259">srv</span>&nbsp;<span class="op" id="6886263">:=</span>&nbsp;<span class="ident" id="6886266"><a href="/net/pipe.go.html#2667778">Pipe</a></span><span class="op" id="6886270">(</span><span class="op" id="6886271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6886274">go</span>&nbsp;<span class="ident" id="6886277"><a href="/net/pipe_test.go.html#6885526">checkWrite</a></span><span class="op" id="6886287">(</span><span class="ident" id="6886288"><a href="/net/pipe_test.go.html#6886216">t</a></span><span class="op" id="6886289">,</span>&nbsp;<span class="ident" id="6886291"><a href="/net/pipe_test.go.html#6886254">cli</a></span><span class="op" id="6886294">,</span>&nbsp;<span class="op" id="6886296">[</span><span class="op" id="6886297">]</span><span class="builtintype" id="6886298">byte</span><span class="op" id="6886302">(</span><span class="string" id="6886303">&#34;hello,&nbsp;world&#34;</span><span class="op" id="6886317">)</span><span class="op" id="6886318">,</span>&nbsp;<span class="ident" id="6886320"><a href="/net/pipe_test.go.html#6886233">c</a></span><span class="op" id="6886321">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6886324"><a href="/net/pipe_test.go.html#6885755">checkRead</a></span><span class="op" id="6886333">(</span><span class="ident" id="6886334"><a href="/net/pipe_test.go.html#6886216">t</a></span><span class="op" id="6886335">,</span>&nbsp;<span class="ident" id="6886337"><a href="/net/pipe_test.go.html#6886259">srv</a></span><span class="op" id="6886340">,</span>&nbsp;<span class="op" id="6886342">[</span><span class="op" id="6886343">]</span><span class="builtintype" id="6886344">byte</span><span class="op" id="6886348">(</span><span class="string" id="6886349">&#34;hello,&nbsp;world&#34;</span><span class="op" id="6886363">)</span><span class="op" id="6886364">,</span>&nbsp;<span class="ident" id="6886366">nil</span><span class="op" id="6886369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6886372">&lt;-</span><span class="ident" id="6886374"><a href="/net/pipe_test.go.html#6886233">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6886377">go</span>&nbsp;<span class="ident" id="6886380"><a href="/net/pipe_test.go.html#6885526">checkWrite</a></span><span class="op" id="6886390">(</span><span class="ident" id="6886391"><a href="/net/pipe_test.go.html#6886216">t</a></span><span class="op" id="6886392">,</span>&nbsp;<span class="ident" id="6886394"><a href="/net/pipe_test.go.html#6886259">srv</a></span><span class="op" id="6886397">,</span>&nbsp;<span class="op" id="6886399">[</span><span class="op" id="6886400">]</span><span class="builtintype" id="6886401">byte</span><span class="op" id="6886405">(</span><span class="string" id="6886406">&#34;line&nbsp;2&#34;</span><span class="op" id="6886414">)</span><span class="op" id="6886415">,</span>&nbsp;<span class="ident" id="6886417"><a href="/net/pipe_test.go.html#6886233">c</a></span><span class="op" id="6886418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6886421"><a href="/net/pipe_test.go.html#6885755">checkRead</a></span><span class="op" id="6886430">(</span><span class="ident" id="6886431"><a href="/net/pipe_test.go.html#6886216">t</a></span><span class="op" id="6886432">,</span>&nbsp;<span class="ident" id="6886434"><a href="/net/pipe_test.go.html#6886254">cli</a></span><span class="op" id="6886437">,</span>&nbsp;<span class="op" id="6886439">[</span><span class="op" id="6886440">]</span><span class="builtintype" id="6886441">byte</span><span class="op" id="6886445">(</span><span class="string" id="6886446">&#34;line&nbsp;2&#34;</span><span class="op" id="6886454">)</span><span class="op" id="6886455">,</span>&nbsp;<span class="ident" id="6886457">nil</span><span class="op" id="6886460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6886463">&lt;-</span><span class="ident" id="6886465"><a href="/net/pipe_test.go.html#6886233">c</a></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6886468">go</span>&nbsp;<span class="ident" id="6886471"><a href="/net/pipe_test.go.html#6885526">checkWrite</a></span><span class="op" id="6886481">(</span><span class="ident" id="6886482"><a href="/net/pipe_test.go.html#6886216">t</a></span><span class="op" id="6886483">,</span>&nbsp;<span class="ident" id="6886485"><a href="/net/pipe_test.go.html#6886254">cli</a></span><span class="op" id="6886488">,</span>&nbsp;<span class="op" id="6886490">[</span><span class="op" id="6886491">]</span><span class="builtintype" id="6886492">byte</span><span class="op" id="6886496">(</span><span class="string" id="6886497">&#34;a&nbsp;third&nbsp;line&#34;</span><span class="op" id="6886511">)</span><span class="op" id="6886512">,</span>&nbsp;<span class="ident" id="6886514"><a href="/net/pipe_test.go.html#6886233">c</a></span><span class="op" id="6886515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6886518"><a href="/net/pipe_test.go.html#6885755">checkRead</a></span><span class="op" id="6886527">(</span><span class="ident" id="6886528"><a href="/net/pipe_test.go.html#6886216">t</a></span><span class="op" id="6886529">,</span>&nbsp;<span class="ident" id="6886531"><a href="/net/pipe_test.go.html#6886259">srv</a></span><span class="op" id="6886534">,</span>&nbsp;<span class="op" id="6886536">[</span><span class="op" id="6886537">]</span><span class="builtintype" id="6886538">byte</span><span class="op" id="6886542">(</span><span class="string" id="6886543">&#34;a&nbsp;third&nbsp;line&#34;</span><span class="op" id="6886557">)</span><span class="op" id="6886558">,</span>&nbsp;<span class="ident" id="6886560">nil</span><span class="op" id="6886563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6886566">&lt;-</span><span class="ident" id="6886568"><a href="/net/pipe_test.go.html#6886233">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6886571">go</span>&nbsp;<span class="ident" id="6886574"><a href="/net/pipe_test.go.html#6886259">srv</a></span><span class="op" id="6886577">.</span><span class="ident" id="6886578">Close</span><span class="op" id="6886583">(</span><span class="op" id="6886584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6886587"><a href="/net/pipe_test.go.html#6885755">checkRead</a></span><span class="op" id="6886596">(</span><span class="ident" id="6886597"><a href="/net/pipe_test.go.html#6886216">t</a></span><span class="op" id="6886598">,</span>&nbsp;<span class="ident" id="6886600"><a href="/net/pipe_test.go.html#6886254">cli</a></span><span class="op" id="6886603">,</span>&nbsp;<span class="ident" id="6886605">nil</span><span class="op" id="6886608">,</span>&nbsp;<span class="ident" id="6886610"><a href="/net/pipe_test.go.html#6885502">io</a></span><span class="op" id="6886612">.</span><span class="ident" id="6886613">EOF</span><span class="op" id="6886616">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6886619"><a href="/net/pipe_test.go.html#6886254">cli</a></span><span class="op" id="6886622">.</span><span class="ident" id="6886623">Close</span><span class="op" id="6886628">(</span><span class="op" id="6886629">)</span><br>
<span class="lineno"></span><span class="op" id="6886631">}</span>
</div>
</body>
</html>
