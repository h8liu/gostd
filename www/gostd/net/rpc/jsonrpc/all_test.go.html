<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/rpc/jsonrpc</h2>
<ul>
<li><a href="/gostd/net/rpc/jsonrpc/all_test.go.html" class="current">all_test.go</a></li>
<li><a href="/gostd/net/rpc/jsonrpc/client.go.html">client.go</a></li>
<li><a href="/gostd/net/rpc/jsonrpc/server.go.html">server.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8301031">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8301087">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8301141">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8301192">package</span>&nbsp;<span class="ident" id="8301200">jsonrpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8301209">import</span>&nbsp;<span class="op" id="8301216">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8301219">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8301228">&#34;encoding/json&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8301245">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8301255">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8301262">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8301268">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8301281">&#34;net&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8301288">&#34;net/rpc&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8301299">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8301310">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8301320">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="8301323">type</span>&nbsp;<span class="ident" id="8301328">Args</span>&nbsp;<span class="keyword" id="8301333">struct</span>&nbsp;<span class="op" id="8301340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8301343">A</span><span class="op" id="8301344">,</span>&nbsp;<span class="ident" id="8301346">B</span>&nbsp;<span class="builtintype" id="8301348">int</span><br>
<span class="lineno"></span><span class="op" id="8301352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8301355">type</span>&nbsp;<span class="ident" id="8301360">Reply</span>&nbsp;<span class="keyword" id="8301366">struct</span>&nbsp;<span class="op" id="8301373">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8301376">C</span>&nbsp;<span class="builtintype" id="8301378">int</span><br>
<span class="lineno"></span><span class="op" id="8301382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8301385">type</span>&nbsp;<span class="ident" id="8301390">Arith</span>&nbsp;<span class="builtintype" id="8301396">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="8301401">type</span>&nbsp;<span class="ident" id="8301406">ArithAddResp</span>&nbsp;<span class="keyword" id="8301419">struct</span>&nbsp;<span class="op" id="8301426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8301429">Id</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8301436">interface</span><span class="op" id="8301445">{</span><span class="op" id="8301446">}</span>&nbsp;<span class="string" id="8301448">`json:&#34;id&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8301461">Result</span>&nbsp;<span class="ident" id="8301468">Reply</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8301480">`json:&#34;result&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8301497">Error</span>&nbsp;&nbsp;<span class="keyword" id="8301504">interface</span><span class="op" id="8301513">{</span><span class="op" id="8301514">}</span>&nbsp;<span class="string" id="8301516">`json:&#34;error&#34;`</span><br>
<span class="lineno"></span><span class="op" id="8301531">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="8301534">func</span>&nbsp;<span class="op" id="8301539">(</span><span class="ident" id="8301540">t</span>&nbsp;<span class="op" id="8301542">*</span><span class="ident" id="8301543">Arith</span><span class="op" id="8301548">)</span>&nbsp;<span class="ident" id="8301550">Add</span><span class="op" id="8301553">(</span><span class="ident" id="8301554">args</span>&nbsp;<span class="op" id="8301559">*</span><span class="ident" id="8301560">Args</span><span class="op" id="8301564">,</span>&nbsp;<span class="ident" id="8301566">reply</span>&nbsp;<span class="op" id="8301572">*</span><span class="ident" id="8301573">Reply</span><span class="op" id="8301578">)</span>&nbsp;<span class="builtintype" id="8301580">error</span>&nbsp;<span class="op" id="8301586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8301589">reply</span><span class="op" id="8301594">.</span><span class="ident" id="8301595">C</span>&nbsp;<span class="op" id="8301597">=</span>&nbsp;<span class="ident" id="8301599">args</span><span class="op" id="8301603">.</span><span class="ident" id="8301604">A</span>&nbsp;<span class="op" id="8301606">+</span>&nbsp;<span class="ident" id="8301608">args</span><span class="op" id="8301612">.</span><span class="ident" id="8301613">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8301616">return</span>&nbsp;<span class="ident" id="8301623">nil</span><br>
<span class="lineno"></span><span class="op" id="8301627">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="8301630">func</span>&nbsp;<span class="op" id="8301635">(</span><span class="ident" id="8301636">t</span>&nbsp;<span class="op" id="8301638">*</span><span class="ident" id="8301639">Arith</span><span class="op" id="8301644">)</span>&nbsp;<span class="ident" id="8301646">Mul</span><span class="op" id="8301649">(</span><span class="ident" id="8301650">args</span>&nbsp;<span class="op" id="8301655">*</span><span class="ident" id="8301656">Args</span><span class="op" id="8301660">,</span>&nbsp;<span class="ident" id="8301662">reply</span>&nbsp;<span class="op" id="8301668">*</span><span class="ident" id="8301669">Reply</span><span class="op" id="8301674">)</span>&nbsp;<span class="builtintype" id="8301676">error</span>&nbsp;<span class="op" id="8301682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8301685">reply</span><span class="op" id="8301690">.</span><span class="ident" id="8301691">C</span>&nbsp;<span class="op" id="8301693">=</span>&nbsp;<span class="ident" id="8301695">args</span><span class="op" id="8301699">.</span><span class="ident" id="8301700">A</span>&nbsp;<span class="op" id="8301702">*</span>&nbsp;<span class="ident" id="8301704">args</span><span class="op" id="8301708">.</span><span class="ident" id="8301709">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8301712">return</span>&nbsp;<span class="ident" id="8301719">nil</span><br>
<span class="lineno"></span><span class="op" id="8301723">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="8301726">func</span>&nbsp;<span class="op" id="8301731">(</span><span class="ident" id="8301732">t</span>&nbsp;<span class="op" id="8301734">*</span><span class="ident" id="8301735">Arith</span><span class="op" id="8301740">)</span>&nbsp;<span class="ident" id="8301742">Div</span><span class="op" id="8301745">(</span><span class="ident" id="8301746">args</span>&nbsp;<span class="op" id="8301751">*</span><span class="ident" id="8301752">Args</span><span class="op" id="8301756">,</span>&nbsp;<span class="ident" id="8301758">reply</span>&nbsp;<span class="op" id="8301764">*</span><span class="ident" id="8301765">Reply</span><span class="op" id="8301770">)</span>&nbsp;<span class="builtintype" id="8301772">error</span>&nbsp;<span class="op" id="8301778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8301781">if</span>&nbsp;<span class="ident" id="8301784">args</span><span class="op" id="8301788">.</span><span class="ident" id="8301789">B</span>&nbsp;<span class="op" id="8301791">==</span>&nbsp;<span class="num" id="8301794">0</span>&nbsp;<span class="op" id="8301796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8301800">return</span>&nbsp;<span class="ident" id="8301807">errors</span><span class="op" id="8301813">.</span><span class="ident" id="8301814">New</span><span class="op" id="8301817">(</span><span class="string" id="8301818">&#34;divide&nbsp;by&nbsp;zero&#34;</span><span class="op" id="8301834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8301837">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8301840">reply</span><span class="op" id="8301845">.</span><span class="ident" id="8301846">C</span>&nbsp;<span class="op" id="8301848">=</span>&nbsp;<span class="ident" id="8301850">args</span><span class="op" id="8301854">.</span><span class="ident" id="8301855">A</span>&nbsp;<span class="op" id="8301857">/</span>&nbsp;<span class="ident" id="8301859">args</span><span class="op" id="8301863">.</span><span class="ident" id="8301864">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8301867">return</span>&nbsp;<span class="ident" id="8301874">nil</span><br>
<span class="lineno"></span><span class="op" id="8301878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8301881">func</span>&nbsp;<span class="op" id="8301886">(</span><span class="ident" id="8301887">t</span>&nbsp;<span class="op" id="8301889">*</span><span class="ident" id="8301890">Arith</span><span class="op" id="8301895">)</span>&nbsp;<span class="ident" id="8301897">Error</span><span class="op" id="8301902">(</span><span class="ident" id="8301903">args</span>&nbsp;<span class="op" id="8301908">*</span><span class="ident" id="8301909">Args</span><span class="op" id="8301913">,</span>&nbsp;<span class="ident" id="8301915">reply</span>&nbsp;<span class="op" id="8301921">*</span><span class="ident" id="8301922">Reply</span><span class="op" id="8301927">)</span>&nbsp;<span class="builtintype" id="8301929">error</span>&nbsp;<span class="op" id="8301935">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8301938">panic</span><span class="op" id="8301943">(</span><span class="string" id="8301944">&#34;ERROR&#34;</span><span class="op" id="8301951">)</span><br>
<span class="lineno"></span><span class="op" id="8301953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8301956">func</span>&nbsp;<span class="ident" id="8301961">init</span><span class="op" id="8301965">(</span><span class="op" id="8301966">)</span>&nbsp;<span class="op" id="8301968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8301971">rpc</span><span class="op" id="8301974">.</span><span class="ident" id="8301975">Register</span><span class="op" id="8301983">(</span><span class="builtinfunc" id="8301984">new</span><span class="op" id="8301987">(</span><span class="ident" id="8301988">Arith</span><span class="op" id="8301993">)</span><span class="op" id="8301994">)</span><br>
<span class="lineno">60</span><span class="op" id="8301996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8301999">func</span>&nbsp;<span class="ident" id="8302004">TestServerNoParams</span><span class="op" id="8302022">(</span><span class="ident" id="8302023">t</span>&nbsp;<span class="op" id="8302025">*</span><span class="ident" id="8302026">testing</span><span class="op" id="8302033">.</span><span class="ident" id="8302034">T</span><span class="op" id="8302035">)</span>&nbsp;<span class="op" id="8302037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8302040">cli</span><span class="op" id="8302043">,</span>&nbsp;<span class="ident" id="8302045">srv</span>&nbsp;<span class="op" id="8302049">:=</span>&nbsp;<span class="ident" id="8302052">net</span><span class="op" id="8302055">.</span><span class="ident" id="8302056">Pipe</span><span class="op" id="8302060">(</span><span class="op" id="8302061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8302064">defer</span>&nbsp;<span class="ident" id="8302070">cli</span><span class="op" id="8302073">.</span><span class="ident" id="8302074">Close</span><span class="op" id="8302079">(</span><span class="op" id="8302080">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8302083">go</span>&nbsp;<span class="ident" id="8302086">ServeConn</span><span class="op" id="8302095">(</span><span class="ident" id="8302096">srv</span><span class="op" id="8302099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8302102">dec</span>&nbsp;<span class="op" id="8302106">:=</span>&nbsp;<span class="ident" id="8302109">json</span><span class="op" id="8302113">.</span><span class="ident" id="8302114">NewDecoder</span><span class="op" id="8302124">(</span><span class="ident" id="8302125">cli</span><span class="op" id="8302128">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8302132">fmt</span><span class="op" id="8302135">.</span><span class="ident" id="8302136">Fprintf</span><span class="op" id="8302143">(</span><span class="ident" id="8302144">cli</span><span class="op" id="8302147">,</span>&nbsp;<span class="string" id="8302149">`{&#34;method&#34;:&nbsp;&#34;Arith.Add&#34;,&nbsp;&#34;id&#34;:&nbsp;&#34;123&#34;}`</span><span class="op" id="8302187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8302190">var</span>&nbsp;<span class="ident" id="8302194">resp</span>&nbsp;<span class="ident" id="8302199">ArithAddResp</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8302213">if</span>&nbsp;<span class="ident" id="8302216">err</span>&nbsp;<span class="op" id="8302220">:=</span>&nbsp;<span class="ident" id="8302223">dec</span><span class="op" id="8302226">.</span><span class="ident" id="8302227">Decode</span><span class="op" id="8302233">(</span><span class="op" id="8302234">&amp;</span><span class="ident" id="8302235">resp</span><span class="op" id="8302239">)</span><span class="op" id="8302240">;</span>&nbsp;<span class="ident" id="8302242">err</span>&nbsp;<span class="op" id="8302246">!=</span>&nbsp;<span class="ident" id="8302249">nil</span>&nbsp;<span class="op" id="8302253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8302257">t</span><span class="op" id="8302258">.</span><span class="ident" id="8302259">Fatalf</span><span class="op" id="8302265">(</span><span class="string" id="8302266">&#34;Decode&nbsp;after&nbsp;no&nbsp;params:&nbsp;%s&#34;</span><span class="op" id="8302294">,</span>&nbsp;<span class="ident" id="8302296">err</span><span class="op" id="8302299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8302302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8302305">if</span>&nbsp;<span class="ident" id="8302308">resp</span><span class="op" id="8302312">.</span><span class="ident" id="8302313">Error</span>&nbsp;<span class="op" id="8302319">==</span>&nbsp;<span class="ident" id="8302322">nil</span>&nbsp;<span class="op" id="8302326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8302330">t</span><span class="op" id="8302331">.</span><span class="ident" id="8302332">Fatalf</span><span class="op" id="8302338">(</span><span class="string" id="8302339">&#34;Expected&nbsp;error,&nbsp;got&nbsp;nil&#34;</span><span class="op" id="8302364">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8302367">}</span><br>
<span class="lineno"></span><span class="op" id="8302369">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8302372">func</span>&nbsp;<span class="ident" id="8302377">TestServerEmptyMessage</span><span class="op" id="8302399">(</span><span class="ident" id="8302400">t</span>&nbsp;<span class="op" id="8302402">*</span><span class="ident" id="8302403">testing</span><span class="op" id="8302410">.</span><span class="ident" id="8302411">T</span><span class="op" id="8302412">)</span>&nbsp;<span class="op" id="8302414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8302417">cli</span><span class="op" id="8302420">,</span>&nbsp;<span class="ident" id="8302422">srv</span>&nbsp;<span class="op" id="8302426">:=</span>&nbsp;<span class="ident" id="8302429">net</span><span class="op" id="8302432">.</span><span class="ident" id="8302433">Pipe</span><span class="op" id="8302437">(</span><span class="op" id="8302438">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8302441">defer</span>&nbsp;<span class="ident" id="8302447">cli</span><span class="op" id="8302450">.</span><span class="ident" id="8302451">Close</span><span class="op" id="8302456">(</span><span class="op" id="8302457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8302460">go</span>&nbsp;<span class="ident" id="8302463">ServeConn</span><span class="op" id="8302472">(</span><span class="ident" id="8302473">srv</span><span class="op" id="8302476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8302479">dec</span>&nbsp;<span class="op" id="8302483">:=</span>&nbsp;<span class="ident" id="8302486">json</span><span class="op" id="8302490">.</span><span class="ident" id="8302491">NewDecoder</span><span class="op" id="8302501">(</span><span class="ident" id="8302502">cli</span><span class="op" id="8302505">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8302509">fmt</span><span class="op" id="8302512">.</span><span class="ident" id="8302513">Fprintf</span><span class="op" id="8302520">(</span><span class="ident" id="8302521">cli</span><span class="op" id="8302524">,</span>&nbsp;<span class="string" id="8302526">&#34;{}&#34;</span><span class="op" id="8302530">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8302533">var</span>&nbsp;<span class="ident" id="8302537">resp</span>&nbsp;<span class="ident" id="8302542">ArithAddResp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8302556">if</span>&nbsp;<span class="ident" id="8302559">err</span>&nbsp;<span class="op" id="8302563">:=</span>&nbsp;<span class="ident" id="8302566">dec</span><span class="op" id="8302569">.</span><span class="ident" id="8302570">Decode</span><span class="op" id="8302576">(</span><span class="op" id="8302577">&amp;</span><span class="ident" id="8302578">resp</span><span class="op" id="8302582">)</span><span class="op" id="8302583">;</span>&nbsp;<span class="ident" id="8302585">err</span>&nbsp;<span class="op" id="8302589">!=</span>&nbsp;<span class="ident" id="8302592">nil</span>&nbsp;<span class="op" id="8302596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8302600">t</span><span class="op" id="8302601">.</span><span class="ident" id="8302602">Fatalf</span><span class="op" id="8302608">(</span><span class="string" id="8302609">&#34;Decode&nbsp;after&nbsp;empty:&nbsp;%s&#34;</span><span class="op" id="8302633">,</span>&nbsp;<span class="ident" id="8302635">err</span><span class="op" id="8302638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8302641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8302644">if</span>&nbsp;<span class="ident" id="8302647">resp</span><span class="op" id="8302651">.</span><span class="ident" id="8302652">Error</span>&nbsp;<span class="op" id="8302658">==</span>&nbsp;<span class="ident" id="8302661">nil</span>&nbsp;<span class="op" id="8302665">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8302669">t</span><span class="op" id="8302670">.</span><span class="ident" id="8302671">Fatalf</span><span class="op" id="8302677">(</span><span class="string" id="8302678">&#34;Expected&nbsp;error,&nbsp;got&nbsp;nil&#34;</span><span class="op" id="8302703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8302706">}</span><br>
<span class="lineno"></span><span class="op" id="8302708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8302711">func</span>&nbsp;<span class="ident" id="8302716">TestServer</span><span class="op" id="8302726">(</span><span class="ident" id="8302727">t</span>&nbsp;<span class="op" id="8302729">*</span><span class="ident" id="8302730">testing</span><span class="op" id="8302737">.</span><span class="ident" id="8302738">T</span><span class="op" id="8302739">)</span>&nbsp;<span class="op" id="8302741">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8302744">cli</span><span class="op" id="8302747">,</span>&nbsp;<span class="ident" id="8302749">srv</span>&nbsp;<span class="op" id="8302753">:=</span>&nbsp;<span class="ident" id="8302756">net</span><span class="op" id="8302759">.</span><span class="ident" id="8302760">Pipe</span><span class="op" id="8302764">(</span><span class="op" id="8302765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8302768">defer</span>&nbsp;<span class="ident" id="8302774">cli</span><span class="op" id="8302777">.</span><span class="ident" id="8302778">Close</span><span class="op" id="8302783">(</span><span class="op" id="8302784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8302787">go</span>&nbsp;<span class="ident" id="8302790">ServeConn</span><span class="op" id="8302799">(</span><span class="ident" id="8302800">srv</span><span class="op" id="8302803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8302806">dec</span>&nbsp;<span class="op" id="8302810">:=</span>&nbsp;<span class="ident" id="8302813">json</span><span class="op" id="8302817">.</span><span class="ident" id="8302818">NewDecoder</span><span class="op" id="8302828">(</span><span class="ident" id="8302829">cli</span><span class="op" id="8302832">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8302836">//&nbsp;Send&nbsp;hand-coded&nbsp;requests&nbsp;to&nbsp;server,&nbsp;parse&nbsp;responses.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8302893">for</span>&nbsp;<span class="ident" id="8302897">i</span>&nbsp;<span class="op" id="8302899">:=</span>&nbsp;<span class="num" id="8302902">0</span><span class="op" id="8302903">;</span>&nbsp;<span class="ident" id="8302905">i</span>&nbsp;<span class="op" id="8302907">&lt;</span>&nbsp;<span class="num" id="8302909">10</span><span class="op" id="8302911">;</span>&nbsp;<span class="ident" id="8302913">i</span><span class="op" id="8302914">++</span>&nbsp;<span class="op" id="8302917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8302921">fmt</span><span class="op" id="8302924">.</span><span class="ident" id="8302925">Fprintf</span><span class="op" id="8302932">(</span><span class="ident" id="8302933">cli</span><span class="op" id="8302936">,</span>&nbsp;<span class="string" id="8302938">`{&#34;method&#34;:&nbsp;&#34;Arith.Add&#34;,&nbsp;&#34;id&#34;:&nbsp;&#34;\u%04d&#34;,&nbsp;&#34;params&#34;:&nbsp;[{&#34;A&#34;:&nbsp;%d,&nbsp;&#34;B&#34;:&nbsp;%d}]}`</span><span class="op" id="8303011">,</span>&nbsp;<span class="ident" id="8303013">i</span><span class="op" id="8303014">,</span>&nbsp;<span class="ident" id="8303016">i</span><span class="op" id="8303017">,</span>&nbsp;<span class="ident" id="8303019">i</span><span class="op" id="8303020">+</span><span class="num" id="8303021">1</span><span class="op" id="8303022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8303026">var</span>&nbsp;<span class="ident" id="8303030">resp</span>&nbsp;<span class="ident" id="8303035">ArithAddResp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8303050">err</span>&nbsp;<span class="op" id="8303054">:=</span>&nbsp;<span class="ident" id="8303057">dec</span><span class="op" id="8303060">.</span><span class="ident" id="8303061">Decode</span><span class="op" id="8303067">(</span><span class="op" id="8303068">&amp;</span><span class="ident" id="8303069">resp</span><span class="op" id="8303073">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8303077">if</span>&nbsp;<span class="ident" id="8303080">err</span>&nbsp;<span class="op" id="8303084">!=</span>&nbsp;<span class="ident" id="8303087">nil</span>&nbsp;<span class="op" id="8303091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8303096">t</span><span class="op" id="8303097">.</span><span class="ident" id="8303098">Fatalf</span><span class="op" id="8303104">(</span><span class="string" id="8303105">&#34;Decode:&nbsp;%s&#34;</span><span class="op" id="8303117">,</span>&nbsp;<span class="ident" id="8303119">err</span><span class="op" id="8303122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8303126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8303130">if</span>&nbsp;<span class="ident" id="8303133">resp</span><span class="op" id="8303137">.</span><span class="ident" id="8303138">Error</span>&nbsp;<span class="op" id="8303144">!=</span>&nbsp;<span class="ident" id="8303147">nil</span>&nbsp;<span class="op" id="8303151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8303156">t</span><span class="op" id="8303157">.</span><span class="ident" id="8303158">Fatalf</span><span class="op" id="8303164">(</span><span class="string" id="8303165">&#34;resp.Error:&nbsp;%s&#34;</span><span class="op" id="8303181">,</span>&nbsp;<span class="ident" id="8303183">resp</span><span class="op" id="8303187">.</span><span class="ident" id="8303188">Error</span><span class="op" id="8303193">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8303197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8303201">if</span>&nbsp;<span class="ident" id="8303204">resp</span><span class="op" id="8303208">.</span><span class="ident" id="8303209">Id</span><span class="op" id="8303211">.</span><span class="op" id="8303212">(</span><span class="builtintype" id="8303213">string</span><span class="op" id="8303219">)</span>&nbsp;<span class="op" id="8303221">!=</span>&nbsp;<span class="builtintype" id="8303224">string</span><span class="op" id="8303230">(</span><span class="ident" id="8303231">i</span><span class="op" id="8303232">)</span>&nbsp;<span class="op" id="8303234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8303239">t</span><span class="op" id="8303240">.</span><span class="ident" id="8303241">Fatalf</span><span class="op" id="8303247">(</span><span class="string" id="8303248">&#34;resp:&nbsp;bad&nbsp;id&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8303273">,</span>&nbsp;<span class="ident" id="8303275">resp</span><span class="op" id="8303279">.</span><span class="ident" id="8303280">Id</span><span class="op" id="8303282">.</span><span class="op" id="8303283">(</span><span class="builtintype" id="8303284">string</span><span class="op" id="8303290">)</span><span class="op" id="8303291">,</span>&nbsp;<span class="builtintype" id="8303293">string</span><span class="op" id="8303299">(</span><span class="ident" id="8303300">i</span><span class="op" id="8303301">)</span><span class="op" id="8303302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8303306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8303310">if</span>&nbsp;<span class="ident" id="8303313">resp</span><span class="op" id="8303317">.</span><span class="ident" id="8303318">Result</span><span class="op" id="8303324">.</span><span class="ident" id="8303325">C</span>&nbsp;<span class="op" id="8303327">!=</span>&nbsp;<span class="num" id="8303330">2</span><span class="op" id="8303331">*</span><span class="ident" id="8303332">i</span><span class="op" id="8303333">+</span><span class="num" id="8303334">1</span>&nbsp;<span class="op" id="8303336">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8303341">t</span><span class="op" id="8303342">.</span><span class="ident" id="8303343">Fatalf</span><span class="op" id="8303349">(</span><span class="string" id="8303350">&#34;resp:&nbsp;bad&nbsp;result:&nbsp;%d+%d=%d&#34;</span><span class="op" id="8303378">,</span>&nbsp;<span class="ident" id="8303380">i</span><span class="op" id="8303381">,</span>&nbsp;<span class="ident" id="8303383">i</span><span class="op" id="8303384">+</span><span class="num" id="8303385">1</span><span class="op" id="8303386">,</span>&nbsp;<span class="ident" id="8303388">resp</span><span class="op" id="8303392">.</span><span class="ident" id="8303393">Result</span><span class="op" id="8303399">.</span><span class="ident" id="8303400">C</span><span class="op" id="8303401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8303405">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8303408">}</span><br>
<span class="lineno"></span><span class="op" id="8303410">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="8303413">func</span>&nbsp;<span class="ident" id="8303418">TestClient</span><span class="op" id="8303428">(</span><span class="ident" id="8303429">t</span>&nbsp;<span class="op" id="8303431">*</span><span class="ident" id="8303432">testing</span><span class="op" id="8303439">.</span><span class="ident" id="8303440">T</span><span class="op" id="8303441">)</span>&nbsp;<span class="op" id="8303443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8303446">//&nbsp;Assume&nbsp;server&nbsp;is&nbsp;okay&nbsp;(TestServer&nbsp;is&nbsp;above).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8303495">//&nbsp;Test&nbsp;client&nbsp;against&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8303527">cli</span><span class="op" id="8303530">,</span>&nbsp;<span class="ident" id="8303532">srv</span>&nbsp;<span class="op" id="8303536">:=</span>&nbsp;<span class="ident" id="8303539">net</span><span class="op" id="8303542">.</span><span class="ident" id="8303543">Pipe</span><span class="op" id="8303547">(</span><span class="op" id="8303548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8303551">go</span>&nbsp;<span class="ident" id="8303554">ServeConn</span><span class="op" id="8303563">(</span><span class="ident" id="8303564">srv</span><span class="op" id="8303567">)</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8303571">client</span>&nbsp;<span class="op" id="8303578">:=</span>&nbsp;<span class="ident" id="8303581">NewClient</span><span class="op" id="8303590">(</span><span class="ident" id="8303591">cli</span><span class="op" id="8303594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8303597">defer</span>&nbsp;<span class="ident" id="8303603">client</span><span class="op" id="8303609">.</span><span class="ident" id="8303610">Close</span><span class="op" id="8303615">(</span><span class="op" id="8303616">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8303620">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8303642">args</span>&nbsp;<span class="op" id="8303647">:=</span>&nbsp;<span class="op" id="8303650">&amp;</span><span class="ident" id="8303651">Args</span><span class="op" id="8303655">{</span><span class="num" id="8303656">7</span><span class="op" id="8303657">,</span>&nbsp;<span class="num" id="8303659">8</span><span class="op" id="8303660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8303663">reply</span>&nbsp;<span class="op" id="8303669">:=</span>&nbsp;<span class="builtinfunc" id="8303672">new</span><span class="op" id="8303675">(</span><span class="ident" id="8303676">Reply</span><span class="op" id="8303681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8303684">err</span>&nbsp;<span class="op" id="8303688">:=</span>&nbsp;<span class="ident" id="8303691">client</span><span class="op" id="8303697">.</span><span class="ident" id="8303698">Call</span><span class="op" id="8303702">(</span><span class="string" id="8303703">&#34;Arith.Add&#34;</span><span class="op" id="8303714">,</span>&nbsp;<span class="ident" id="8303716">args</span><span class="op" id="8303720">,</span>&nbsp;<span class="ident" id="8303722">reply</span><span class="op" id="8303727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8303730">if</span>&nbsp;<span class="ident" id="8303733">err</span>&nbsp;<span class="op" id="8303737">!=</span>&nbsp;<span class="ident" id="8303740">nil</span>&nbsp;<span class="op" id="8303744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8303748">t</span><span class="op" id="8303749">.</span><span class="ident" id="8303750">Errorf</span><span class="op" id="8303756">(</span><span class="string" id="8303757">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8303799">,</span>&nbsp;<span class="ident" id="8303801">err</span><span class="op" id="8303804">.</span><span class="ident" id="8303805">Error</span><span class="op" id="8303810">(</span><span class="op" id="8303811">)</span><span class="op" id="8303812">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8303815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8303818">if</span>&nbsp;<span class="ident" id="8303821">reply</span><span class="op" id="8303826">.</span><span class="ident" id="8303827">C</span>&nbsp;<span class="op" id="8303829">!=</span>&nbsp;<span class="ident" id="8303832">args</span><span class="op" id="8303836">.</span><span class="ident" id="8303837">A</span><span class="op" id="8303838">+</span><span class="ident" id="8303839">args</span><span class="op" id="8303843">.</span><span class="ident" id="8303844">B</span>&nbsp;<span class="op" id="8303846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8303850">t</span><span class="op" id="8303851">.</span><span class="ident" id="8303852">Errorf</span><span class="op" id="8303858">(</span><span class="string" id="8303859">&#34;Add:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="8303884">,</span>&nbsp;<span class="ident" id="8303886">reply</span><span class="op" id="8303891">.</span><span class="ident" id="8303892">C</span><span class="op" id="8303893">,</span>&nbsp;<span class="ident" id="8303895">args</span><span class="op" id="8303899">.</span><span class="ident" id="8303900">A</span><span class="op" id="8303901">+</span><span class="ident" id="8303902">args</span><span class="op" id="8303906">.</span><span class="ident" id="8303907">B</span><span class="op" id="8303908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8303911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8303915">args</span>&nbsp;<span class="op" id="8303920">=</span>&nbsp;<span class="op" id="8303922">&amp;</span><span class="ident" id="8303923">Args</span><span class="op" id="8303927">{</span><span class="num" id="8303928">7</span><span class="op" id="8303929">,</span>&nbsp;<span class="num" id="8303931">8</span><span class="op" id="8303932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8303935">reply</span>&nbsp;<span class="op" id="8303941">=</span>&nbsp;<span class="builtinfunc" id="8303943">new</span><span class="op" id="8303946">(</span><span class="ident" id="8303947">Reply</span><span class="op" id="8303952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8303955">err</span>&nbsp;<span class="op" id="8303959">=</span>&nbsp;<span class="ident" id="8303961">client</span><span class="op" id="8303967">.</span><span class="ident" id="8303968">Call</span><span class="op" id="8303972">(</span><span class="string" id="8303973">&#34;Arith.Mul&#34;</span><span class="op" id="8303984">,</span>&nbsp;<span class="ident" id="8303986">args</span><span class="op" id="8303990">,</span>&nbsp;<span class="ident" id="8303992">reply</span><span class="op" id="8303997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8304000">if</span>&nbsp;<span class="ident" id="8304003">err</span>&nbsp;<span class="op" id="8304007">!=</span>&nbsp;<span class="ident" id="8304010">nil</span>&nbsp;<span class="op" id="8304014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8304018">t</span><span class="op" id="8304019">.</span><span class="ident" id="8304020">Errorf</span><span class="op" id="8304026">(</span><span class="string" id="8304027">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8304069">,</span>&nbsp;<span class="ident" id="8304071">err</span><span class="op" id="8304074">.</span><span class="ident" id="8304075">Error</span><span class="op" id="8304080">(</span><span class="op" id="8304081">)</span><span class="op" id="8304082">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8304085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8304088">if</span>&nbsp;<span class="ident" id="8304091">reply</span><span class="op" id="8304096">.</span><span class="ident" id="8304097">C</span>&nbsp;<span class="op" id="8304099">!=</span>&nbsp;<span class="ident" id="8304102">args</span><span class="op" id="8304106">.</span><span class="ident" id="8304107">A</span><span class="op" id="8304108">*</span><span class="ident" id="8304109">args</span><span class="op" id="8304113">.</span><span class="ident" id="8304114">B</span>&nbsp;<span class="op" id="8304116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8304120">t</span><span class="op" id="8304121">.</span><span class="ident" id="8304122">Errorf</span><span class="op" id="8304128">(</span><span class="string" id="8304129">&#34;Mul:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="8304154">,</span>&nbsp;<span class="ident" id="8304156">reply</span><span class="op" id="8304161">.</span><span class="ident" id="8304162">C</span><span class="op" id="8304163">,</span>&nbsp;<span class="ident" id="8304165">args</span><span class="op" id="8304169">.</span><span class="ident" id="8304170">A</span><span class="op" id="8304171">*</span><span class="ident" id="8304172">args</span><span class="op" id="8304176">.</span><span class="ident" id="8304177">B</span><span class="op" id="8304178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8304181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8304185">//&nbsp;Out&nbsp;of&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8304203">args</span>&nbsp;<span class="op" id="8304208">=</span>&nbsp;<span class="op" id="8304210">&amp;</span><span class="ident" id="8304211">Args</span><span class="op" id="8304215">{</span><span class="num" id="8304216">7</span><span class="op" id="8304217">,</span>&nbsp;<span class="num" id="8304219">8</span><span class="op" id="8304220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8304223">mulReply</span>&nbsp;<span class="op" id="8304232">:=</span>&nbsp;<span class="builtinfunc" id="8304235">new</span><span class="op" id="8304238">(</span><span class="ident" id="8304239">Reply</span><span class="op" id="8304244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8304247">mulCall</span>&nbsp;<span class="op" id="8304255">:=</span>&nbsp;<span class="ident" id="8304258">client</span><span class="op" id="8304264">.</span><span class="ident" id="8304265">Go</span><span class="op" id="8304267">(</span><span class="string" id="8304268">&#34;Arith.Mul&#34;</span><span class="op" id="8304279">,</span>&nbsp;<span class="ident" id="8304281">args</span><span class="op" id="8304285">,</span>&nbsp;<span class="ident" id="8304287">mulReply</span><span class="op" id="8304295">,</span>&nbsp;<span class="ident" id="8304297">nil</span><span class="op" id="8304300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8304303">addReply</span>&nbsp;<span class="op" id="8304312">:=</span>&nbsp;<span class="builtinfunc" id="8304315">new</span><span class="op" id="8304318">(</span><span class="ident" id="8304319">Reply</span><span class="op" id="8304324">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8304327">addCall</span>&nbsp;<span class="op" id="8304335">:=</span>&nbsp;<span class="ident" id="8304338">client</span><span class="op" id="8304344">.</span><span class="ident" id="8304345">Go</span><span class="op" id="8304347">(</span><span class="string" id="8304348">&#34;Arith.Add&#34;</span><span class="op" id="8304359">,</span>&nbsp;<span class="ident" id="8304361">args</span><span class="op" id="8304365">,</span>&nbsp;<span class="ident" id="8304367">addReply</span><span class="op" id="8304375">,</span>&nbsp;<span class="ident" id="8304377">nil</span><span class="op" id="8304380">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8304384">addCall</span>&nbsp;<span class="op" id="8304392">=</span>&nbsp;<span class="op" id="8304394">&lt;-</span><span class="ident" id="8304396">addCall</span><span class="op" id="8304403">.</span><span class="ident" id="8304404">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8304410">if</span>&nbsp;<span class="ident" id="8304413">addCall</span><span class="op" id="8304420">.</span><span class="ident" id="8304421">Error</span>&nbsp;<span class="op" id="8304427">!=</span>&nbsp;<span class="ident" id="8304430">nil</span>&nbsp;<span class="op" id="8304434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8304438">t</span><span class="op" id="8304439">.</span><span class="ident" id="8304440">Errorf</span><span class="op" id="8304446">(</span><span class="string" id="8304447">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8304489">,</span>&nbsp;<span class="ident" id="8304491">addCall</span><span class="op" id="8304498">.</span><span class="ident" id="8304499">Error</span><span class="op" id="8304504">.</span><span class="ident" id="8304505">Error</span><span class="op" id="8304510">(</span><span class="op" id="8304511">)</span><span class="op" id="8304512">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8304515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8304518">if</span>&nbsp;<span class="ident" id="8304521">addReply</span><span class="op" id="8304529">.</span><span class="ident" id="8304530">C</span>&nbsp;<span class="op" id="8304532">!=</span>&nbsp;<span class="ident" id="8304535">args</span><span class="op" id="8304539">.</span><span class="ident" id="8304540">A</span><span class="op" id="8304541">+</span><span class="ident" id="8304542">args</span><span class="op" id="8304546">.</span><span class="ident" id="8304547">B</span>&nbsp;<span class="op" id="8304549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8304553">t</span><span class="op" id="8304554">.</span><span class="ident" id="8304555">Errorf</span><span class="op" id="8304561">(</span><span class="string" id="8304562">&#34;Add:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="8304587">,</span>&nbsp;<span class="ident" id="8304589">addReply</span><span class="op" id="8304597">.</span><span class="ident" id="8304598">C</span><span class="op" id="8304599">,</span>&nbsp;<span class="ident" id="8304601">args</span><span class="op" id="8304605">.</span><span class="ident" id="8304606">A</span><span class="op" id="8304607">+</span><span class="ident" id="8304608">args</span><span class="op" id="8304612">.</span><span class="ident" id="8304613">B</span><span class="op" id="8304614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8304617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8304621">mulCall</span>&nbsp;<span class="op" id="8304629">=</span>&nbsp;<span class="op" id="8304631">&lt;-</span><span class="ident" id="8304633">mulCall</span><span class="op" id="8304640">.</span><span class="ident" id="8304641">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8304647">if</span>&nbsp;<span class="ident" id="8304650">mulCall</span><span class="op" id="8304657">.</span><span class="ident" id="8304658">Error</span>&nbsp;<span class="op" id="8304664">!=</span>&nbsp;<span class="ident" id="8304667">nil</span>&nbsp;<span class="op" id="8304671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8304675">t</span><span class="op" id="8304676">.</span><span class="ident" id="8304677">Errorf</span><span class="op" id="8304683">(</span><span class="string" id="8304684">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8304726">,</span>&nbsp;<span class="ident" id="8304728">mulCall</span><span class="op" id="8304735">.</span><span class="ident" id="8304736">Error</span><span class="op" id="8304741">.</span><span class="ident" id="8304742">Error</span><span class="op" id="8304747">(</span><span class="op" id="8304748">)</span><span class="op" id="8304749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8304752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8304755">if</span>&nbsp;<span class="ident" id="8304758">mulReply</span><span class="op" id="8304766">.</span><span class="ident" id="8304767">C</span>&nbsp;<span class="op" id="8304769">!=</span>&nbsp;<span class="ident" id="8304772">args</span><span class="op" id="8304776">.</span><span class="ident" id="8304777">A</span><span class="op" id="8304778">*</span><span class="ident" id="8304779">args</span><span class="op" id="8304783">.</span><span class="ident" id="8304784">B</span>&nbsp;<span class="op" id="8304786">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8304790">t</span><span class="op" id="8304791">.</span><span class="ident" id="8304792">Errorf</span><span class="op" id="8304798">(</span><span class="string" id="8304799">&#34;Mul:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="8304824">,</span>&nbsp;<span class="ident" id="8304826">mulReply</span><span class="op" id="8304834">.</span><span class="ident" id="8304835">C</span><span class="op" id="8304836">,</span>&nbsp;<span class="ident" id="8304838">args</span><span class="op" id="8304842">.</span><span class="ident" id="8304843">A</span><span class="op" id="8304844">*</span><span class="ident" id="8304845">args</span><span class="op" id="8304849">.</span><span class="ident" id="8304850">B</span><span class="op" id="8304851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8304854">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8304858">//&nbsp;Error&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8304873">args</span>&nbsp;<span class="op" id="8304878">=</span>&nbsp;<span class="op" id="8304880">&amp;</span><span class="ident" id="8304881">Args</span><span class="op" id="8304885">{</span><span class="num" id="8304886">7</span><span class="op" id="8304887">,</span>&nbsp;<span class="num" id="8304889">0</span><span class="op" id="8304890">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8304893">reply</span>&nbsp;<span class="op" id="8304899">=</span>&nbsp;<span class="builtinfunc" id="8304901">new</span><span class="op" id="8304904">(</span><span class="ident" id="8304905">Reply</span><span class="op" id="8304910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8304913">err</span>&nbsp;<span class="op" id="8304917">=</span>&nbsp;<span class="ident" id="8304919">client</span><span class="op" id="8304925">.</span><span class="ident" id="8304926">Call</span><span class="op" id="8304930">(</span><span class="string" id="8304931">&#34;Arith.Div&#34;</span><span class="op" id="8304942">,</span>&nbsp;<span class="ident" id="8304944">args</span><span class="op" id="8304948">,</span>&nbsp;<span class="ident" id="8304950">reply</span><span class="op" id="8304955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8304958">//&nbsp;expect&nbsp;an&nbsp;error:&nbsp;zero&nbsp;divide</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8304991">if</span>&nbsp;<span class="ident" id="8304994">err</span>&nbsp;<span class="op" id="8304998">==</span>&nbsp;<span class="ident" id="8305001">nil</span>&nbsp;<span class="op" id="8305005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8305009">t</span><span class="op" id="8305010">.</span><span class="ident" id="8305011">Error</span><span class="op" id="8305016">(</span><span class="string" id="8305017">&#34;Div:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="8305038">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8305041">}</span>&nbsp;<span class="keyword" id="8305043">else</span>&nbsp;<span class="keyword" id="8305048">if</span>&nbsp;<span class="ident" id="8305051">err</span><span class="op" id="8305054">.</span><span class="ident" id="8305055">Error</span><span class="op" id="8305060">(</span><span class="op" id="8305061">)</span>&nbsp;<span class="op" id="8305063">!=</span>&nbsp;<span class="string" id="8305066">&#34;divide&nbsp;by&nbsp;zero&#34;</span>&nbsp;<span class="op" id="8305083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8305087">t</span><span class="op" id="8305088">.</span><span class="ident" id="8305089">Error</span><span class="op" id="8305094">(</span><span class="string" id="8305095">&#34;Div:&nbsp;expected&nbsp;divide&nbsp;by&nbsp;zero&nbsp;error;&nbsp;got&#34;</span><span class="op" id="8305136">,</span>&nbsp;<span class="ident" id="8305138">err</span><span class="op" id="8305141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8305144">}</span><br>
<span class="lineno"></span><span class="op" id="8305146">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="8305149">func</span>&nbsp;<span class="ident" id="8305154">TestMalformedInput</span><span class="op" id="8305172">(</span><span class="ident" id="8305173">t</span>&nbsp;<span class="op" id="8305175">*</span><span class="ident" id="8305176">testing</span><span class="op" id="8305183">.</span><span class="ident" id="8305184">T</span><span class="op" id="8305185">)</span>&nbsp;<span class="op" id="8305187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8305190">cli</span><span class="op" id="8305193">,</span>&nbsp;<span class="ident" id="8305195">srv</span>&nbsp;<span class="op" id="8305199">:=</span>&nbsp;<span class="ident" id="8305202">net</span><span class="op" id="8305205">.</span><span class="ident" id="8305206">Pipe</span><span class="op" id="8305210">(</span><span class="op" id="8305211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8305214">go</span>&nbsp;<span class="ident" id="8305217">cli</span><span class="op" id="8305220">.</span><span class="ident" id="8305221">Write</span><span class="op" id="8305226">(</span><span class="op" id="8305227">[</span><span class="op" id="8305228">]</span><span class="builtintype" id="8305229">byte</span><span class="op" id="8305233">(</span><span class="string" id="8305234">`{id:1}`</span><span class="op" id="8305242">)</span><span class="op" id="8305243">)</span>&nbsp;<span class="comment" id="8305245">//&nbsp;invalid&nbsp;json</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8305262">ServeConn</span><span class="op" id="8305271">(</span><span class="ident" id="8305272">srv</span><span class="op" id="8305275">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8305293">//&nbsp;must&nbsp;return,&nbsp;not&nbsp;loop</span><br>
<span class="lineno"></span><span class="op" id="8305318">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="keyword" id="8305321">func</span>&nbsp;<span class="ident" id="8305326">TestMalformedOutput</span><span class="op" id="8305345">(</span><span class="ident" id="8305346">t</span>&nbsp;<span class="op" id="8305348">*</span><span class="ident" id="8305349">testing</span><span class="op" id="8305356">.</span><span class="ident" id="8305357">T</span><span class="op" id="8305358">)</span>&nbsp;<span class="op" id="8305360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8305363">cli</span><span class="op" id="8305366">,</span>&nbsp;<span class="ident" id="8305368">srv</span>&nbsp;<span class="op" id="8305372">:=</span>&nbsp;<span class="ident" id="8305375">net</span><span class="op" id="8305378">.</span><span class="ident" id="8305379">Pipe</span><span class="op" id="8305383">(</span><span class="op" id="8305384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8305387">go</span>&nbsp;<span class="ident" id="8305390">srv</span><span class="op" id="8305393">.</span><span class="ident" id="8305394">Write</span><span class="op" id="8305399">(</span><span class="op" id="8305400">[</span><span class="op" id="8305401">]</span><span class="builtintype" id="8305402">byte</span><span class="op" id="8305406">(</span><span class="string" id="8305407">`{&#34;id&#34;:0,&#34;result&#34;:null,&#34;error&#34;:null}`</span><span class="op" id="8305444">)</span><span class="op" id="8305445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8305448">go</span>&nbsp;<span class="ident" id="8305451">ioutil</span><span class="op" id="8305457">.</span><span class="ident" id="8305458">ReadAll</span><span class="op" id="8305465">(</span><span class="ident" id="8305466">srv</span><span class="op" id="8305469">)</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8305473">client</span>&nbsp;<span class="op" id="8305480">:=</span>&nbsp;<span class="ident" id="8305483">NewClient</span><span class="op" id="8305492">(</span><span class="ident" id="8305493">cli</span><span class="op" id="8305496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8305499">defer</span>&nbsp;<span class="ident" id="8305505">client</span><span class="op" id="8305511">.</span><span class="ident" id="8305512">Close</span><span class="op" id="8305517">(</span><span class="op" id="8305518">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8305522">args</span>&nbsp;<span class="op" id="8305527">:=</span>&nbsp;<span class="op" id="8305530">&amp;</span><span class="ident" id="8305531">Args</span><span class="op" id="8305535">{</span><span class="num" id="8305536">7</span><span class="op" id="8305537">,</span>&nbsp;<span class="num" id="8305539">8</span><span class="op" id="8305540">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8305543">reply</span>&nbsp;<span class="op" id="8305549">:=</span>&nbsp;<span class="builtinfunc" id="8305552">new</span><span class="op" id="8305555">(</span><span class="ident" id="8305556">Reply</span><span class="op" id="8305561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8305564">err</span>&nbsp;<span class="op" id="8305568">:=</span>&nbsp;<span class="ident" id="8305571">client</span><span class="op" id="8305577">.</span><span class="ident" id="8305578">Call</span><span class="op" id="8305582">(</span><span class="string" id="8305583">&#34;Arith.Add&#34;</span><span class="op" id="8305594">,</span>&nbsp;<span class="ident" id="8305596">args</span><span class="op" id="8305600">,</span>&nbsp;<span class="ident" id="8305602">reply</span><span class="op" id="8305607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8305610">if</span>&nbsp;<span class="ident" id="8305613">err</span>&nbsp;<span class="op" id="8305617">==</span>&nbsp;<span class="ident" id="8305620">nil</span>&nbsp;<span class="op" id="8305624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8305628">t</span><span class="op" id="8305629">.</span><span class="ident" id="8305630">Error</span><span class="op" id="8305635">(</span><span class="string" id="8305636">&#34;expected&nbsp;error&#34;</span><span class="op" id="8305652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8305655">}</span><br>
<span class="lineno">205</span><span class="op" id="8305657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8305660">func</span>&nbsp;<span class="ident" id="8305665">TestServerErrorHasNullResult</span><span class="op" id="8305693">(</span><span class="ident" id="8305694">t</span>&nbsp;<span class="op" id="8305696">*</span><span class="ident" id="8305697">testing</span><span class="op" id="8305704">.</span><span class="ident" id="8305705">T</span><span class="op" id="8305706">)</span>&nbsp;<span class="op" id="8305708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8305711">var</span>&nbsp;<span class="ident" id="8305715">out</span>&nbsp;<span class="ident" id="8305719">bytes</span><span class="op" id="8305724">.</span><span class="ident" id="8305725">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8305733">sc</span>&nbsp;<span class="op" id="8305736">:=</span>&nbsp;<span class="ident" id="8305739">NewServerCodec</span><span class="op" id="8305753">(</span><span class="keyword" id="8305754">struct</span>&nbsp;<span class="op" id="8305761">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8305765">io</span><span class="op" id="8305767">.</span><span class="ident" id="8305768">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8305777">io</span><span class="op" id="8305779">.</span><span class="ident" id="8305780">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8305789">io</span><span class="op" id="8305791">.</span><span class="ident" id="8305792">Closer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8305800">}</span><span class="op" id="8305801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8305805">Reader</span><span class="op" id="8305811">:</span>&nbsp;<span class="ident" id="8305813">strings</span><span class="op" id="8305820">.</span><span class="ident" id="8305821">NewReader</span><span class="op" id="8305830">(</span><span class="string" id="8305831">`{&#34;method&#34;:&nbsp;&#34;Arith.Add&#34;,&nbsp;&#34;id&#34;:&nbsp;&#34;123&#34;,&nbsp;&#34;params&#34;:&nbsp;[]}`</span><span class="op" id="8305883">)</span><span class="op" id="8305884">,</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8305888">Writer</span><span class="op" id="8305894">:</span>&nbsp;<span class="op" id="8305896">&amp;</span><span class="ident" id="8305897">out</span><span class="op" id="8305900">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8305904">Closer</span><span class="op" id="8305910">:</span>&nbsp;<span class="ident" id="8305912">ioutil</span><span class="op" id="8305918">.</span><span class="ident" id="8305919">NopCloser</span><span class="op" id="8305928">(</span><span class="ident" id="8305929">nil</span><span class="op" id="8305932">)</span><span class="op" id="8305933">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8305936">}</span><span class="op" id="8305937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8305940">r</span>&nbsp;<span class="op" id="8305942">:=</span>&nbsp;<span class="builtinfunc" id="8305945">new</span><span class="op" id="8305948">(</span><span class="ident" id="8305949">rpc</span><span class="op" id="8305952">.</span><span class="ident" id="8305953">Request</span><span class="op" id="8305960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8305963">if</span>&nbsp;<span class="ident" id="8305966">err</span>&nbsp;<span class="op" id="8305970">:=</span>&nbsp;<span class="ident" id="8305973">sc</span><span class="op" id="8305975">.</span><span class="ident" id="8305976">ReadRequestHeader</span><span class="op" id="8305993">(</span><span class="ident" id="8305994">r</span><span class="op" id="8305995">)</span><span class="op" id="8305996">;</span>&nbsp;<span class="ident" id="8305998">err</span>&nbsp;<span class="op" id="8306002">!=</span>&nbsp;<span class="ident" id="8306005">nil</span>&nbsp;<span class="op" id="8306009">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8306013">t</span><span class="op" id="8306014">.</span><span class="ident" id="8306015">Fatal</span><span class="op" id="8306020">(</span><span class="ident" id="8306021">err</span><span class="op" id="8306024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8306027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8306030">const</span>&nbsp;<span class="ident" id="8306036">valueText</span>&nbsp;<span class="op" id="8306046">=</span>&nbsp;<span class="string" id="8306048">&#34;the&nbsp;value&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;see&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8306082">const</span>&nbsp;<span class="ident" id="8306088">errorText</span>&nbsp;<span class="op" id="8306098">=</span>&nbsp;<span class="string" id="8306100">&#34;some&nbsp;error&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8306114">err</span>&nbsp;<span class="op" id="8306118">:=</span>&nbsp;<span class="ident" id="8306121">sc</span><span class="op" id="8306123">.</span><span class="ident" id="8306124">WriteResponse</span><span class="op" id="8306137">(</span><span class="op" id="8306138">&amp;</span><span class="ident" id="8306139">rpc</span><span class="op" id="8306142">.</span><span class="ident" id="8306143">Response</span><span class="op" id="8306151">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8306155">ServiceMethod</span><span class="op" id="8306168">:</span>&nbsp;<span class="string" id="8306170">&#34;Method&#34;</span><span class="op" id="8306178">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8306182">Seq</span><span class="op" id="8306185">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8306197">1</span><span class="op" id="8306198">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8306202">Error</span><span class="op" id="8306207">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8306217">errorText</span><span class="op" id="8306226">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8306229">}</span><span class="op" id="8306230">,</span>&nbsp;<span class="ident" id="8306232">valueText</span><span class="op" id="8306241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8306244">if</span>&nbsp;<span class="ident" id="8306247">err</span>&nbsp;<span class="op" id="8306251">!=</span>&nbsp;<span class="ident" id="8306254">nil</span>&nbsp;<span class="op" id="8306258">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8306262">t</span><span class="op" id="8306263">.</span><span class="ident" id="8306264">Fatal</span><span class="op" id="8306269">(</span><span class="ident" id="8306270">err</span><span class="op" id="8306273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8306276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8306279">if</span>&nbsp;<span class="op" id="8306282">!</span><span class="ident" id="8306283">strings</span><span class="op" id="8306290">.</span><span class="ident" id="8306291">Contains</span><span class="op" id="8306299">(</span><span class="ident" id="8306300">out</span><span class="op" id="8306303">.</span><span class="ident" id="8306304">String</span><span class="op" id="8306310">(</span><span class="op" id="8306311">)</span><span class="op" id="8306312">,</span>&nbsp;<span class="ident" id="8306314">errorText</span><span class="op" id="8306323">)</span>&nbsp;<span class="op" id="8306325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8306329">t</span><span class="op" id="8306330">.</span><span class="ident" id="8306331">Fatalf</span><span class="op" id="8306337">(</span><span class="string" id="8306338">&#34;Response&nbsp;didn&#39;t&nbsp;contain&nbsp;expected&nbsp;error&nbsp;%q:&nbsp;%s&#34;</span><span class="op" id="8306385">,</span>&nbsp;<span class="ident" id="8306387">errorText</span><span class="op" id="8306396">,</span>&nbsp;<span class="op" id="8306398">&amp;</span><span class="ident" id="8306399">out</span><span class="op" id="8306402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8306405">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8306408">if</span>&nbsp;<span class="ident" id="8306411">strings</span><span class="op" id="8306418">.</span><span class="ident" id="8306419">Contains</span><span class="op" id="8306427">(</span><span class="ident" id="8306428">out</span><span class="op" id="8306431">.</span><span class="ident" id="8306432">String</span><span class="op" id="8306438">(</span><span class="op" id="8306439">)</span><span class="op" id="8306440">,</span>&nbsp;<span class="ident" id="8306442">valueText</span><span class="op" id="8306451">)</span>&nbsp;<span class="op" id="8306453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8306457">t</span><span class="op" id="8306458">.</span><span class="ident" id="8306459">Errorf</span><span class="op" id="8306465">(</span><span class="string" id="8306466">&#34;Response&nbsp;contains&nbsp;both&nbsp;an&nbsp;error&nbsp;and&nbsp;value:&nbsp;%s&#34;</span><span class="op" id="8306513">,</span>&nbsp;<span class="op" id="8306515">&amp;</span><span class="ident" id="8306516">out</span><span class="op" id="8306519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8306522">}</span><br>
<span class="lineno"></span><span class="op" id="8306524">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="8306527">func</span>&nbsp;<span class="ident" id="8306532">TestUnexpectedError</span><span class="op" id="8306551">(</span><span class="ident" id="8306552">t</span>&nbsp;<span class="op" id="8306554">*</span><span class="ident" id="8306555">testing</span><span class="op" id="8306562">.</span><span class="ident" id="8306563">T</span><span class="op" id="8306564">)</span>&nbsp;<span class="op" id="8306566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8306569">cli</span><span class="op" id="8306572">,</span>&nbsp;<span class="ident" id="8306574">srv</span>&nbsp;<span class="op" id="8306578">:=</span>&nbsp;<span class="ident" id="8306581">myPipe</span><span class="op" id="8306587">(</span><span class="op" id="8306588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8306591">go</span>&nbsp;<span class="ident" id="8306594">cli</span><span class="op" id="8306597">.</span><span class="ident" id="8306598">PipeWriter</span><span class="op" id="8306608">.</span><span class="ident" id="8306609">CloseWithError</span><span class="op" id="8306623">(</span><span class="ident" id="8306624">errors</span><span class="op" id="8306630">.</span><span class="ident" id="8306631">New</span><span class="op" id="8306634">(</span><span class="string" id="8306635">&#34;unexpected&nbsp;error!&#34;</span><span class="op" id="8306654">)</span><span class="op" id="8306655">)</span>&nbsp;<span class="comment" id="8306657">//&nbsp;reader&nbsp;will&nbsp;get&nbsp;this&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8306688">ServeConn</span><span class="op" id="8306697">(</span><span class="ident" id="8306698">srv</span><span class="op" id="8306701">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8306754">//&nbsp;must&nbsp;return,&nbsp;not&nbsp;loop</span><br>
<span class="lineno"></span><span class="op" id="8306779">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="8306782">//&nbsp;Copied&nbsp;from&nbsp;package&nbsp;net.</span><br>
<span class="lineno"></span><span class="keyword" id="8306810">func</span>&nbsp;<span class="ident" id="8306815">myPipe</span><span class="op" id="8306821">(</span><span class="op" id="8306822">)</span>&nbsp;<span class="op" id="8306824">(</span><span class="op" id="8306825">*</span><span class="ident" id="8306826">pipe</span><span class="op" id="8306830">,</span>&nbsp;<span class="op" id="8306832">*</span><span class="ident" id="8306833">pipe</span><span class="op" id="8306837">)</span>&nbsp;<span class="op" id="8306839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8306842">r1</span><span class="op" id="8306844">,</span>&nbsp;<span class="ident" id="8306846">w1</span>&nbsp;<span class="op" id="8306849">:=</span>&nbsp;<span class="ident" id="8306852">io</span><span class="op" id="8306854">.</span><span class="ident" id="8306855">Pipe</span><span class="op" id="8306859">(</span><span class="op" id="8306860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8306863">r2</span><span class="op" id="8306865">,</span>&nbsp;<span class="ident" id="8306867">w2</span>&nbsp;<span class="op" id="8306870">:=</span>&nbsp;<span class="ident" id="8306873">io</span><span class="op" id="8306875">.</span><span class="ident" id="8306876">Pipe</span><span class="op" id="8306880">(</span><span class="op" id="8306881">)</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8306885">return</span>&nbsp;<span class="op" id="8306892">&amp;</span><span class="ident" id="8306893">pipe</span><span class="op" id="8306897">{</span><span class="ident" id="8306898">r1</span><span class="op" id="8306900">,</span>&nbsp;<span class="ident" id="8306902">w2</span><span class="op" id="8306904">}</span><span class="op" id="8306905">,</span>&nbsp;<span class="op" id="8306907">&amp;</span><span class="ident" id="8306908">pipe</span><span class="op" id="8306912">{</span><span class="ident" id="8306913">r2</span><span class="op" id="8306915">,</span>&nbsp;<span class="ident" id="8306917">w1</span><span class="op" id="8306919">}</span><br>
<span class="lineno"></span><span class="op" id="8306921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8306924">type</span>&nbsp;<span class="ident" id="8306929">pipe</span>&nbsp;<span class="keyword" id="8306934">struct</span>&nbsp;<span class="op" id="8306941">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8306944">*</span><span class="ident" id="8306945">io</span><span class="op" id="8306947">.</span><span class="ident" id="8306948">PipeReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8306960">*</span><span class="ident" id="8306961">io</span><span class="op" id="8306963">.</span><span class="ident" id="8306964">PipeWriter</span><br>
<span class="lineno"></span><span class="op" id="8306975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8306978">type</span>&nbsp;<span class="ident" id="8306983">pipeAddr</span>&nbsp;<span class="builtintype" id="8306992">int</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="keyword" id="8306997">func</span>&nbsp;<span class="op" id="8307002">(</span><span class="ident" id="8307003">pipeAddr</span><span class="op" id="8307011">)</span>&nbsp;<span class="ident" id="8307013">Network</span><span class="op" id="8307020">(</span><span class="op" id="8307021">)</span>&nbsp;<span class="builtintype" id="8307023">string</span>&nbsp;<span class="op" id="8307030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8307033">return</span>&nbsp;<span class="string" id="8307040">&#34;pipe&#34;</span><br>
<span class="lineno"></span><span class="op" id="8307047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span><span class="keyword" id="8307050">func</span>&nbsp;<span class="op" id="8307055">(</span><span class="ident" id="8307056">pipeAddr</span><span class="op" id="8307064">)</span>&nbsp;<span class="ident" id="8307066">String</span><span class="op" id="8307072">(</span><span class="op" id="8307073">)</span>&nbsp;<span class="builtintype" id="8307075">string</span>&nbsp;<span class="op" id="8307082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8307085">return</span>&nbsp;<span class="string" id="8307092">&#34;pipe&#34;</span><br>
<span class="lineno"></span><span class="op" id="8307099">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8307102">func</span>&nbsp;<span class="op" id="8307107">(</span><span class="ident" id="8307108">p</span>&nbsp;<span class="op" id="8307110">*</span><span class="ident" id="8307111">pipe</span><span class="op" id="8307115">)</span>&nbsp;<span class="ident" id="8307117">Close</span><span class="op" id="8307122">(</span><span class="op" id="8307123">)</span>&nbsp;<span class="builtintype" id="8307125">error</span>&nbsp;<span class="op" id="8307131">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8307134">err</span>&nbsp;<span class="op" id="8307138">:=</span>&nbsp;<span class="ident" id="8307141">p</span><span class="op" id="8307142">.</span><span class="ident" id="8307143">PipeReader</span><span class="op" id="8307153">.</span><span class="ident" id="8307154">Close</span><span class="op" id="8307159">(</span><span class="op" id="8307160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8307163">err1</span>&nbsp;<span class="op" id="8307168">:=</span>&nbsp;<span class="ident" id="8307171">p</span><span class="op" id="8307172">.</span><span class="ident" id="8307173">PipeWriter</span><span class="op" id="8307183">.</span><span class="ident" id="8307184">Close</span><span class="op" id="8307189">(</span><span class="op" id="8307190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8307193">if</span>&nbsp;<span class="ident" id="8307196">err</span>&nbsp;<span class="op" id="8307200">==</span>&nbsp;<span class="ident" id="8307203">nil</span>&nbsp;<span class="op" id="8307207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8307211">err</span>&nbsp;<span class="op" id="8307215">=</span>&nbsp;<span class="ident" id="8307217">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8307223">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8307226">return</span>&nbsp;<span class="ident" id="8307233">err</span><br>
<span class="lineno"></span><span class="op" id="8307237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8307240">func</span>&nbsp;<span class="op" id="8307245">(</span><span class="ident" id="8307246">p</span>&nbsp;<span class="op" id="8307248">*</span><span class="ident" id="8307249">pipe</span><span class="op" id="8307253">)</span>&nbsp;<span class="ident" id="8307255">LocalAddr</span><span class="op" id="8307264">(</span><span class="op" id="8307265">)</span>&nbsp;<span class="ident" id="8307267">net</span><span class="op" id="8307270">.</span><span class="ident" id="8307271">Addr</span>&nbsp;<span class="op" id="8307276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8307279">return</span>&nbsp;<span class="ident" id="8307286">pipeAddr</span><span class="op" id="8307294">(</span><span class="num" id="8307295">0</span><span class="op" id="8307296">)</span><br>
<span class="lineno">280</span><span class="op" id="8307298">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8307301">func</span>&nbsp;<span class="op" id="8307306">(</span><span class="ident" id="8307307">p</span>&nbsp;<span class="op" id="8307309">*</span><span class="ident" id="8307310">pipe</span><span class="op" id="8307314">)</span>&nbsp;<span class="ident" id="8307316">RemoteAddr</span><span class="op" id="8307326">(</span><span class="op" id="8307327">)</span>&nbsp;<span class="ident" id="8307329">net</span><span class="op" id="8307332">.</span><span class="ident" id="8307333">Addr</span>&nbsp;<span class="op" id="8307338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8307341">return</span>&nbsp;<span class="ident" id="8307348">pipeAddr</span><span class="op" id="8307356">(</span><span class="num" id="8307357">0</span><span class="op" id="8307358">)</span><br>
<span class="lineno"></span><span class="op" id="8307360">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="keyword" id="8307363">func</span>&nbsp;<span class="op" id="8307368">(</span><span class="ident" id="8307369">p</span>&nbsp;<span class="op" id="8307371">*</span><span class="ident" id="8307372">pipe</span><span class="op" id="8307376">)</span>&nbsp;<span class="ident" id="8307378">SetTimeout</span><span class="op" id="8307388">(</span><span class="ident" id="8307389">nsec</span>&nbsp;<span class="ident" id="8307394">int64</span><span class="op" id="8307399">)</span>&nbsp;<span class="builtintype" id="8307401">error</span>&nbsp;<span class="op" id="8307407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8307410">return</span>&nbsp;<span class="ident" id="8307417">errors</span><span class="op" id="8307423">.</span><span class="ident" id="8307424">New</span><span class="op" id="8307427">(</span><span class="string" id="8307428">&#34;net.Pipe&nbsp;does&nbsp;not&nbsp;support&nbsp;timeouts&#34;</span><span class="op" id="8307464">)</span><br>
<span class="lineno"></span><span class="op" id="8307466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="keyword" id="8307469">func</span>&nbsp;<span class="op" id="8307474">(</span><span class="ident" id="8307475">p</span>&nbsp;<span class="op" id="8307477">*</span><span class="ident" id="8307478">pipe</span><span class="op" id="8307482">)</span>&nbsp;<span class="ident" id="8307484">SetReadTimeout</span><span class="op" id="8307498">(</span><span class="ident" id="8307499">nsec</span>&nbsp;<span class="ident" id="8307504">int64</span><span class="op" id="8307509">)</span>&nbsp;<span class="builtintype" id="8307511">error</span>&nbsp;<span class="op" id="8307517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8307520">return</span>&nbsp;<span class="ident" id="8307527">errors</span><span class="op" id="8307533">.</span><span class="ident" id="8307534">New</span><span class="op" id="8307537">(</span><span class="string" id="8307538">&#34;net.Pipe&nbsp;does&nbsp;not&nbsp;support&nbsp;timeouts&#34;</span><span class="op" id="8307574">)</span><br>
<span class="lineno"></span><span class="op" id="8307576">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8307579">func</span>&nbsp;<span class="op" id="8307584">(</span><span class="ident" id="8307585">p</span>&nbsp;<span class="op" id="8307587">*</span><span class="ident" id="8307588">pipe</span><span class="op" id="8307592">)</span>&nbsp;<span class="ident" id="8307594">SetWriteTimeout</span><span class="op" id="8307609">(</span><span class="ident" id="8307610">nsec</span>&nbsp;<span class="ident" id="8307615">int64</span><span class="op" id="8307620">)</span>&nbsp;<span class="builtintype" id="8307622">error</span>&nbsp;<span class="op" id="8307628">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8307631">return</span>&nbsp;<span class="ident" id="8307638">errors</span><span class="op" id="8307644">.</span><span class="ident" id="8307645">New</span><span class="op" id="8307648">(</span><span class="string" id="8307649">&#34;net.Pipe&nbsp;does&nbsp;not&nbsp;support&nbsp;timeouts&#34;</span><span class="op" id="8307685">)</span><br>
<span class="lineno"></span><span class="op" id="8307687">}</span>
</div>
</body>
</html>
