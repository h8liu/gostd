<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html" class="current">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1613731">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1613786">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1613840">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1613891">//&nbsp;+build&nbsp;linux</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1613908">package</span>&nbsp;<span class="ident" id="1613916">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1613925">import</span>&nbsp;<span class="string" id="1613932">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1613942">func</span>&nbsp;<span class="ident" id="1613947">epollcreate</span><span class="op" id="1613958">(</span><span class="ident" id="1613959">size</span>&nbsp;<span class="builtintype" id="1613964">int32</span><span class="op" id="1613969">)</span>&nbsp;<span class="builtintype" id="1613971">int32</span><br>
<span class="lineno"></span><span class="keyword" id="1613977">func</span>&nbsp;<span class="ident" id="1613982">epollcreate1</span><span class="op" id="1613994">(</span><span class="ident" id="1613995">flags</span>&nbsp;<span class="builtintype" id="1614001">int32</span><span class="op" id="1614006">)</span>&nbsp;<span class="builtintype" id="1614008">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1614015">//go:noescape</span><br>
<span class="lineno">15</span><span class="keyword" id="1614029">func</span>&nbsp;<span class="ident" id="1614034">epollctl</span><span class="op" id="1614042">(</span><span class="ident" id="1614043">epfd</span><span class="op" id="1614047">,</span>&nbsp;<span class="ident" id="1614049">op</span><span class="op" id="1614051">,</span>&nbsp;<span class="ident" id="1614053">fd</span>&nbsp;<span class="builtintype" id="1614056">int32</span><span class="op" id="1614061">,</span>&nbsp;<span class="ident" id="1614063">ev</span>&nbsp;<span class="op" id="1614066">*</span><span class="ident" id="1614067">epollevent</span><span class="op" id="1614077">)</span>&nbsp;<span class="builtintype" id="1614079">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1614086">//go:noescape</span><br>
<span class="lineno"></span><span class="keyword" id="1614100">func</span>&nbsp;<span class="ident" id="1614105">epollwait</span><span class="op" id="1614114">(</span><span class="ident" id="1614115">epfd</span>&nbsp;<span class="builtintype" id="1614120">int32</span><span class="op" id="1614125">,</span>&nbsp;<span class="ident" id="1614127">ev</span>&nbsp;<span class="op" id="1614130">*</span><span class="ident" id="1614131">epollevent</span><span class="op" id="1614141">,</span>&nbsp;<span class="ident" id="1614143">nev</span><span class="op" id="1614146">,</span>&nbsp;<span class="ident" id="1614148">timeout</span>&nbsp;<span class="builtintype" id="1614156">int32</span><span class="op" id="1614161">)</span>&nbsp;<span class="builtintype" id="1614163">int32</span><br>
<span class="lineno"></span><span class="keyword" id="1614169">func</span>&nbsp;<span class="ident" id="1614174">closeonexec</span><span class="op" id="1614185">(</span><span class="ident" id="1614186">fd</span>&nbsp;<span class="builtintype" id="1614189">int32</span><span class="op" id="1614194">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="1614197">var</span>&nbsp;<span class="op" id="1614201">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1614204">epfd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1614219">int32</span>&nbsp;<span class="op" id="1614225">=</span>&nbsp;<span class="op" id="1614227">-</span><span class="num" id="1614228">1</span>&nbsp;<span class="comment" id="1614230">//&nbsp;epoll&nbsp;descriptor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1614251">netpolllasterr</span>&nbsp;<span class="builtintype" id="1614266">int32</span><br>
<span class="lineno"></span><span class="op" id="1614272">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="1614275">func</span>&nbsp;<span class="ident" id="1614280">netpollinit</span><span class="op" id="1614291">(</span><span class="op" id="1614292">)</span>&nbsp;<span class="op" id="1614294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1614297">epfd</span>&nbsp;<span class="op" id="1614302">=</span>&nbsp;<span class="ident" id="1614304">epollcreate1</span><span class="op" id="1614316">(</span><span class="ident" id="1614317">_EPOLL_CLOEXEC</span><span class="op" id="1614331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1614334">if</span>&nbsp;<span class="ident" id="1614337">epfd</span>&nbsp;<span class="op" id="1614342">&gt;=</span>&nbsp;<span class="num" id="1614345">0</span>&nbsp;<span class="op" id="1614347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1614351">return</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1614359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1614362">epfd</span>&nbsp;<span class="op" id="1614367">=</span>&nbsp;<span class="ident" id="1614369">epollcreate</span><span class="op" id="1614380">(</span><span class="num" id="1614381">1024</span><span class="op" id="1614385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1614388">if</span>&nbsp;<span class="ident" id="1614391">epfd</span>&nbsp;<span class="op" id="1614396">&gt;=</span>&nbsp;<span class="num" id="1614399">0</span>&nbsp;<span class="op" id="1614401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1614405">closeonexec</span><span class="op" id="1614416">(</span><span class="ident" id="1614417">epfd</span><span class="op" id="1614421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1614425">return</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1614433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1614436">println</span><span class="op" id="1614443">(</span><span class="string" id="1614444">&#34;netpollinit:&nbsp;failed&nbsp;to&nbsp;create&nbsp;epoll&nbsp;descriptor&#34;</span><span class="op" id="1614492">,</span>&nbsp;<span class="op" id="1614494">-</span><span class="ident" id="1614495">epfd</span><span class="op" id="1614499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1614502">gothrow</span><span class="op" id="1614509">(</span><span class="string" id="1614510">&#34;netpollinit:&nbsp;failed&nbsp;to&nbsp;create&nbsp;descriptor&#34;</span><span class="op" id="1614552">)</span><br>
<span class="lineno"></span><span class="op" id="1614554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="1614557">func</span>&nbsp;<span class="ident" id="1614562">netpollopen</span><span class="op" id="1614573">(</span><span class="ident" id="1614574">fd</span>&nbsp;<span class="builtintype" id="1614577">uintptr</span><span class="op" id="1614584">,</span>&nbsp;<span class="ident" id="1614586">pd</span>&nbsp;<span class="op" id="1614589">*</span><span class="ident" id="1614590">pollDesc</span><span class="op" id="1614598">)</span>&nbsp;<span class="builtintype" id="1614600">int32</span>&nbsp;<span class="op" id="1614606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1614609">var</span>&nbsp;<span class="ident" id="1614613">ev</span>&nbsp;<span class="ident" id="1614616">epollevent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1614628">ev</span><span class="op" id="1614630">.</span><span class="ident" id="1614631">events</span>&nbsp;<span class="op" id="1614638">=</span>&nbsp;<span class="ident" id="1614640">_EPOLLIN</span>&nbsp;<span class="op" id="1614649">|</span>&nbsp;<span class="ident" id="1614651">_EPOLLOUT</span>&nbsp;<span class="op" id="1614661">|</span>&nbsp;<span class="ident" id="1614663">_EPOLLRDHUP</span>&nbsp;<span class="op" id="1614675">|</span>&nbsp;<span class="ident" id="1614677">_EPOLLET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1614687">*</span><span class="op" id="1614688">(</span><span class="op" id="1614689">*</span><span class="op" id="1614690">*</span><span class="ident" id="1614691">pollDesc</span><span class="op" id="1614699">)</span><span class="op" id="1614700">(</span><span class="ident" id="1614701">unsafe</span><span class="op" id="1614707">.</span><span class="ident" id="1614708">Pointer</span><span class="op" id="1614715">(</span><span class="op" id="1614716">&amp;</span><span class="ident" id="1614717">ev</span><span class="op" id="1614719">.</span><span class="ident" id="1614720">data</span><span class="op" id="1614724">)</span><span class="op" id="1614725">)</span>&nbsp;<span class="op" id="1614727">=</span>&nbsp;<span class="ident" id="1614729">pd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1614733">return</span>&nbsp;<span class="op" id="1614740">-</span><span class="ident" id="1614741">epollctl</span><span class="op" id="1614749">(</span><span class="ident" id="1614750">epfd</span><span class="op" id="1614754">,</span>&nbsp;<span class="ident" id="1614756">_EPOLL_CTL_ADD</span><span class="op" id="1614770">,</span>&nbsp;<span class="builtintype" id="1614772">int32</span><span class="op" id="1614777">(</span><span class="ident" id="1614778">fd</span><span class="op" id="1614780">)</span><span class="op" id="1614781">,</span>&nbsp;<span class="op" id="1614783">&amp;</span><span class="ident" id="1614784">ev</span><span class="op" id="1614786">)</span><br>
<span class="lineno">45</span><span class="op" id="1614788">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1614791">func</span>&nbsp;<span class="ident" id="1614796">netpollclose</span><span class="op" id="1614808">(</span><span class="ident" id="1614809">fd</span>&nbsp;<span class="builtintype" id="1614812">uintptr</span><span class="op" id="1614819">)</span>&nbsp;<span class="builtintype" id="1614821">int32</span>&nbsp;<span class="op" id="1614827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1614830">var</span>&nbsp;<span class="ident" id="1614834">ev</span>&nbsp;<span class="ident" id="1614837">epollevent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1614849">return</span>&nbsp;<span class="op" id="1614856">-</span><span class="ident" id="1614857">epollctl</span><span class="op" id="1614865">(</span><span class="ident" id="1614866">epfd</span><span class="op" id="1614870">,</span>&nbsp;<span class="ident" id="1614872">_EPOLL_CTL_DEL</span><span class="op" id="1614886">,</span>&nbsp;<span class="builtintype" id="1614888">int32</span><span class="op" id="1614893">(</span><span class="ident" id="1614894">fd</span><span class="op" id="1614896">)</span><span class="op" id="1614897">,</span>&nbsp;<span class="op" id="1614899">&amp;</span><span class="ident" id="1614900">ev</span><span class="op" id="1614902">)</span><br>
<span class="lineno">50</span><span class="op" id="1614904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1614907">func</span>&nbsp;<span class="ident" id="1614912">netpollarm</span><span class="op" id="1614922">(</span><span class="ident" id="1614923">pd</span>&nbsp;<span class="op" id="1614926">*</span><span class="ident" id="1614927">pollDesc</span><span class="op" id="1614935">,</span>&nbsp;<span class="ident" id="1614937">mode</span>&nbsp;<span class="builtintype" id="1614942">int</span><span class="op" id="1614945">)</span>&nbsp;<span class="op" id="1614947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1614950">gothrow</span><span class="op" id="1614957">(</span><span class="string" id="1614958">&#34;unused&#34;</span><span class="op" id="1614966">)</span><br>
<span class="lineno"></span><span class="op" id="1614968">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="1614971">//&nbsp;polls&nbsp;for&nbsp;ready&nbsp;network&nbsp;connections</span><br>
<span class="lineno"></span><span class="comment" id="1615010">//&nbsp;returns&nbsp;list&nbsp;of&nbsp;goroutines&nbsp;that&nbsp;become&nbsp;runnable</span><br>
<span class="lineno"></span><span class="keyword" id="1615061">func</span>&nbsp;<span class="ident" id="1615066">netpoll</span><span class="op" id="1615073">(</span><span class="ident" id="1615074">block</span>&nbsp;<span class="builtintype" id="1615080">bool</span><span class="op" id="1615084">)</span>&nbsp;<span class="op" id="1615086">(</span><span class="ident" id="1615087">gp</span>&nbsp;<span class="op" id="1615090">*</span><span class="ident" id="1615091">g</span><span class="op" id="1615092">)</span>&nbsp;<span class="op" id="1615094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1615097">if</span>&nbsp;<span class="ident" id="1615100">epfd</span>&nbsp;<span class="op" id="1615105">==</span>&nbsp;<span class="op" id="1615108">-</span><span class="num" id="1615109">1</span>&nbsp;<span class="op" id="1615111">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1615115">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1615123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1615126">waitms</span>&nbsp;<span class="op" id="1615133">:=</span>&nbsp;<span class="builtintype" id="1615136">int32</span><span class="op" id="1615141">(</span><span class="op" id="1615142">-</span><span class="num" id="1615143">1</span><span class="op" id="1615144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1615147">if</span>&nbsp;<span class="op" id="1615150">!</span><span class="ident" id="1615151">block</span>&nbsp;<span class="op" id="1615157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1615161">waitms</span>&nbsp;<span class="op" id="1615168">=</span>&nbsp;<span class="num" id="1615170">0</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1615173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1615176">var</span>&nbsp;<span class="ident" id="1615180">events</span>&nbsp;<span class="op" id="1615187">[</span><span class="num" id="1615188">128</span><span class="op" id="1615191">]</span><span class="ident" id="1615192">epollevent</span><br>
<span class="lineno"></span><span class="ident" id="1615203">retry</span><span class="op" id="1615208">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1615211">n</span>&nbsp;<span class="op" id="1615213">:=</span>&nbsp;<span class="ident" id="1615216">epollwait</span><span class="op" id="1615225">(</span><span class="ident" id="1615226">epfd</span><span class="op" id="1615230">,</span>&nbsp;<span class="op" id="1615232">&amp;</span><span class="ident" id="1615233">events</span><span class="op" id="1615239">[</span><span class="num" id="1615240">0</span><span class="op" id="1615241">]</span><span class="op" id="1615242">,</span>&nbsp;<span class="builtintype" id="1615244">int32</span><span class="op" id="1615249">(</span><span class="builtinfunc" id="1615250">len</span><span class="op" id="1615253">(</span><span class="ident" id="1615254">events</span><span class="op" id="1615260">)</span><span class="op" id="1615261">)</span><span class="op" id="1615262">,</span>&nbsp;<span class="ident" id="1615264">waitms</span><span class="op" id="1615270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1615273">if</span>&nbsp;<span class="ident" id="1615276">n</span>&nbsp;<span class="op" id="1615278">&lt;</span>&nbsp;<span class="num" id="1615280">0</span>&nbsp;<span class="op" id="1615282">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1615286">if</span>&nbsp;<span class="ident" id="1615289">n</span>&nbsp;<span class="op" id="1615291">!=</span>&nbsp;<span class="op" id="1615294">-</span><span class="ident" id="1615295">_EINTR</span>&nbsp;<span class="op" id="1615302">&amp;&amp;</span>&nbsp;<span class="ident" id="1615305">n</span>&nbsp;<span class="op" id="1615307">!=</span>&nbsp;<span class="ident" id="1615310">netpolllasterr</span>&nbsp;<span class="op" id="1615325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1615330">netpolllasterr</span>&nbsp;<span class="op" id="1615345">=</span>&nbsp;<span class="ident" id="1615347">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1615352">println</span><span class="op" id="1615359">(</span><span class="string" id="1615360">&#34;runtime:&nbsp;epollwait&nbsp;on&nbsp;fd&#34;</span><span class="op" id="1615386">,</span>&nbsp;<span class="ident" id="1615388">epfd</span><span class="op" id="1615392">,</span>&nbsp;<span class="string" id="1615394">&#34;failed&nbsp;with&#34;</span><span class="op" id="1615407">,</span>&nbsp;<span class="op" id="1615409">-</span><span class="ident" id="1615410">n</span><span class="op" id="1615411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1615415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1615419">goto</span>&nbsp;<span class="ident" id="1615424">retry</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1615431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1615434">for</span>&nbsp;<span class="ident" id="1615438">i</span>&nbsp;<span class="op" id="1615440">:=</span>&nbsp;<span class="builtintype" id="1615443">int32</span><span class="op" id="1615448">(</span><span class="num" id="1615449">0</span><span class="op" id="1615450">)</span><span class="op" id="1615451">;</span>&nbsp;<span class="ident" id="1615453">i</span>&nbsp;<span class="op" id="1615455">&lt;</span>&nbsp;<span class="ident" id="1615457">n</span><span class="op" id="1615458">;</span>&nbsp;<span class="ident" id="1615460">i</span><span class="op" id="1615461">++</span>&nbsp;<span class="op" id="1615464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1615468">ev</span>&nbsp;<span class="op" id="1615471">:=</span>&nbsp;<span class="op" id="1615474">&amp;</span><span class="ident" id="1615475">events</span><span class="op" id="1615481">[</span><span class="ident" id="1615482">i</span><span class="op" id="1615483">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1615487">if</span>&nbsp;<span class="ident" id="1615490">ev</span><span class="op" id="1615492">.</span><span class="ident" id="1615493">events</span>&nbsp;<span class="op" id="1615500">==</span>&nbsp;<span class="num" id="1615503">0</span>&nbsp;<span class="op" id="1615505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1615510">continue</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1615521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1615525">var</span>&nbsp;<span class="ident" id="1615529">mode</span>&nbsp;<span class="builtintype" id="1615534">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1615542">if</span>&nbsp;<span class="ident" id="1615545">ev</span><span class="op" id="1615547">.</span><span class="ident" id="1615548">events</span><span class="op" id="1615554">&amp;</span><span class="op" id="1615555">(</span><span class="ident" id="1615556">_EPOLLIN</span><span class="op" id="1615564">|</span><span class="ident" id="1615565">_EPOLLRDHUP</span><span class="op" id="1615576">|</span><span class="ident" id="1615577">_EPOLLHUP</span><span class="op" id="1615586">|</span><span class="ident" id="1615587">_EPOLLERR</span><span class="op" id="1615596">)</span>&nbsp;<span class="op" id="1615598">!=</span>&nbsp;<span class="num" id="1615601">0</span>&nbsp;<span class="op" id="1615603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1615608">mode</span>&nbsp;<span class="op" id="1615613">+=</span>&nbsp;<span class="string" id="1615616">&#39;r&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1615622">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1615626">if</span>&nbsp;<span class="ident" id="1615629">ev</span><span class="op" id="1615631">.</span><span class="ident" id="1615632">events</span><span class="op" id="1615638">&amp;</span><span class="op" id="1615639">(</span><span class="ident" id="1615640">_EPOLLOUT</span><span class="op" id="1615649">|</span><span class="ident" id="1615650">_EPOLLHUP</span><span class="op" id="1615659">|</span><span class="ident" id="1615660">_EPOLLERR</span><span class="op" id="1615669">)</span>&nbsp;<span class="op" id="1615671">!=</span>&nbsp;<span class="num" id="1615674">0</span>&nbsp;<span class="op" id="1615676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1615681">mode</span>&nbsp;<span class="op" id="1615686">+=</span>&nbsp;<span class="string" id="1615689">&#39;w&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1615695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1615699">if</span>&nbsp;<span class="ident" id="1615702">mode</span>&nbsp;<span class="op" id="1615707">!=</span>&nbsp;<span class="num" id="1615710">0</span>&nbsp;<span class="op" id="1615712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1615717">pd</span>&nbsp;<span class="op" id="1615720">:=</span>&nbsp;<span class="op" id="1615723">*</span><span class="op" id="1615724">(</span><span class="op" id="1615725">*</span><span class="op" id="1615726">*</span><span class="ident" id="1615727">pollDesc</span><span class="op" id="1615735">)</span><span class="op" id="1615736">(</span><span class="ident" id="1615737">unsafe</span><span class="op" id="1615743">.</span><span class="ident" id="1615744">Pointer</span><span class="op" id="1615751">(</span><span class="op" id="1615752">&amp;</span><span class="ident" id="1615753">ev</span><span class="op" id="1615755">.</span><span class="ident" id="1615756">data</span><span class="op" id="1615760">)</span><span class="op" id="1615761">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1615766">netpollready</span><span class="op" id="1615778">(</span><span class="op" id="1615779">(</span><span class="op" id="1615780">*</span><span class="op" id="1615781">*</span><span class="ident" id="1615782">g</span><span class="op" id="1615783">)</span><span class="op" id="1615784">(</span><span class="ident" id="1615785">noescape</span><span class="op" id="1615793">(</span><span class="ident" id="1615794">unsafe</span><span class="op" id="1615800">.</span><span class="ident" id="1615801">Pointer</span><span class="op" id="1615808">(</span><span class="op" id="1615809">&amp;</span><span class="ident" id="1615810">gp</span><span class="op" id="1615812">)</span><span class="op" id="1615813">)</span><span class="op" id="1615814">)</span><span class="op" id="1615815">,</span>&nbsp;<span class="ident" id="1615817">pd</span><span class="op" id="1615819">,</span>&nbsp;<span class="ident" id="1615821">mode</span><span class="op" id="1615825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1615829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1615832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1615835">if</span>&nbsp;<span class="ident" id="1615838">block</span>&nbsp;<span class="op" id="1615844">&amp;&amp;</span>&nbsp;<span class="ident" id="1615847">gp</span>&nbsp;<span class="op" id="1615850">==</span>&nbsp;<span class="builtintype" id="1615853">nil</span>&nbsp;<span class="op" id="1615857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1615861">goto</span>&nbsp;<span class="ident" id="1615866">retry</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1615873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1615876">return</span>&nbsp;<span class="ident" id="1615883">gp</span><br>
<span class="lineno"></span><span class="op" id="1615886">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
