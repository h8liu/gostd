<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/cgi</h2>
<ul>
<li><a href="/gostd/net/http/cgi/child.go.html">child.go</a></li>
<li><a href="/gostd/net/http/cgi/child_test.go.html">child_test.go</a></li>
<li><a href="/gostd/net/http/cgi/host.go.html">host.go</a></li>
<li><a href="/gostd/net/http/cgi/host_test.go.html">host_test.go</a></li>
<li><a href="/gostd/net/http/cgi/matryoshka_test.go.html">matryoshka_test.go</a></li>
<li><a href="/gostd/net/http/cgi/posix_test.go.html">posix_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6408598">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6408653">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6408707">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6408758">//&nbsp;Tests&nbsp;for&nbsp;CGI&nbsp;(the&nbsp;child&nbsp;process&nbsp;perspective)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6408808">package</span>&nbsp;<span class="ident" id="6408816">cgi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6408821">import</span>&nbsp;<span class="op" id="6408828">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6408831">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6408841">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6408844">func</span>&nbsp;<span class="ident" id="6408849">TestRequest</span><span class="op" id="6408860">(</span><span class="ident" id="6408861">t</span>&nbsp;<span class="op" id="6408863">*</span><span class="ident" id="6408864">testing</span><span class="op" id="6408871">.</span><span class="ident" id="6408872">T</span><span class="op" id="6408873">)</span>&nbsp;<span class="op" id="6408875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6408878">env</span>&nbsp;<span class="op" id="6408882">:=</span>&nbsp;<span class="keyword" id="6408885">map</span><span class="op" id="6408888">[</span><span class="builtintype" id="6408889">string</span><span class="op" id="6408895">]</span><span class="builtintype" id="6408896">string</span><span class="op" id="6408902">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6408906">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="6408923">:</span>&nbsp;<span class="string" id="6408925">&#34;HTTP/1.1&#34;</span><span class="op" id="6408935">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6408939">&#34;REQUEST_METHOD&#34;</span><span class="op" id="6408955">:</span>&nbsp;&nbsp;<span class="string" id="6408958">&#34;GET&#34;</span><span class="op" id="6408963">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6408967">&#34;HTTP_HOST&#34;</span><span class="op" id="6408978">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6408986">&#34;example.com&#34;</span><span class="op" id="6408999">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6409003">&#34;HTTP_REFERER&#34;</span><span class="op" id="6409017">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6409022">&#34;elsewhere&#34;</span><span class="op" id="6409033">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6409037">&#34;HTTP_USER_AGENT&#34;</span><span class="op" id="6409054">:</span>&nbsp;<span class="string" id="6409056">&#34;goclient&#34;</span><span class="op" id="6409066">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6409070">&#34;HTTP_FOO_BAR&#34;</span><span class="op" id="6409084">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6409089">&#34;baz&#34;</span><span class="op" id="6409094">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6409098">&#34;REQUEST_URI&#34;</span><span class="op" id="6409111">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6409117">&#34;/path?a=b&#34;</span><span class="op" id="6409128">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6409132">&#34;CONTENT_LENGTH&#34;</span><span class="op" id="6409148">:</span>&nbsp;&nbsp;<span class="string" id="6409151">&#34;123&#34;</span><span class="op" id="6409156">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6409160">&#34;CONTENT_TYPE&#34;</span><span class="op" id="6409174">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6409179">&#34;text/xml&#34;</span><span class="op" id="6409189">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6409193">&#34;REMOTE_ADDR&#34;</span><span class="op" id="6409206">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6409212">&#34;5.6.7.8&#34;</span><span class="op" id="6409221">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6409224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6409227">req</span><span class="op" id="6409230">,</span>&nbsp;<span class="ident" id="6409232">err</span>&nbsp;<span class="op" id="6409236">:=</span>&nbsp;<span class="ident" id="6409239">RequestFromMap</span><span class="op" id="6409253">(</span><span class="ident" id="6409254">env</span><span class="op" id="6409257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6409260">if</span>&nbsp;<span class="ident" id="6409263">err</span>&nbsp;<span class="op" id="6409267">!=</span>&nbsp;<span class="ident" id="6409270">nil</span>&nbsp;<span class="op" id="6409274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6409278">t</span><span class="op" id="6409279">.</span><span class="ident" id="6409280">Fatalf</span><span class="op" id="6409286">(</span><span class="string" id="6409287">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="6409307">,</span>&nbsp;<span class="ident" id="6409309">err</span><span class="op" id="6409312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6409315">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6409318">if</span>&nbsp;<span class="ident" id="6409321">g</span><span class="op" id="6409322">,</span>&nbsp;<span class="ident" id="6409324">e</span>&nbsp;<span class="op" id="6409326">:=</span>&nbsp;<span class="ident" id="6409329">req</span><span class="op" id="6409332">.</span><span class="ident" id="6409333">UserAgent</span><span class="op" id="6409342">(</span><span class="op" id="6409343">)</span><span class="op" id="6409344">,</span>&nbsp;<span class="string" id="6409346">&#34;goclient&#34;</span><span class="op" id="6409356">;</span>&nbsp;<span class="ident" id="6409358">e</span>&nbsp;<span class="op" id="6409360">!=</span>&nbsp;<span class="ident" id="6409363">g</span>&nbsp;<span class="op" id="6409365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6409369">t</span><span class="op" id="6409370">.</span><span class="ident" id="6409371">Errorf</span><span class="op" id="6409377">(</span><span class="string" id="6409378">&#34;expected&nbsp;UserAgent&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6409409">,</span>&nbsp;<span class="ident" id="6409411">e</span><span class="op" id="6409412">,</span>&nbsp;<span class="ident" id="6409414">g</span><span class="op" id="6409415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6409418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6409421">if</span>&nbsp;<span class="ident" id="6409424">g</span><span class="op" id="6409425">,</span>&nbsp;<span class="ident" id="6409427">e</span>&nbsp;<span class="op" id="6409429">:=</span>&nbsp;<span class="ident" id="6409432">req</span><span class="op" id="6409435">.</span><span class="ident" id="6409436">Method</span><span class="op" id="6409442">,</span>&nbsp;<span class="string" id="6409444">&#34;GET&#34;</span><span class="op" id="6409449">;</span>&nbsp;<span class="ident" id="6409451">e</span>&nbsp;<span class="op" id="6409453">!=</span>&nbsp;<span class="ident" id="6409456">g</span>&nbsp;<span class="op" id="6409458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6409462">t</span><span class="op" id="6409463">.</span><span class="ident" id="6409464">Errorf</span><span class="op" id="6409470">(</span><span class="string" id="6409471">&#34;expected&nbsp;Method&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6409499">,</span>&nbsp;<span class="ident" id="6409501">e</span><span class="op" id="6409502">,</span>&nbsp;<span class="ident" id="6409504">g</span><span class="op" id="6409505">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6409508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6409511">if</span>&nbsp;<span class="ident" id="6409514">g</span><span class="op" id="6409515">,</span>&nbsp;<span class="ident" id="6409517">e</span>&nbsp;<span class="op" id="6409519">:=</span>&nbsp;<span class="ident" id="6409522">req</span><span class="op" id="6409525">.</span><span class="ident" id="6409526">Header</span><span class="op" id="6409532">.</span><span class="ident" id="6409533">Get</span><span class="op" id="6409536">(</span><span class="string" id="6409537">&#34;Content-Type&#34;</span><span class="op" id="6409551">)</span><span class="op" id="6409552">,</span>&nbsp;<span class="string" id="6409554">&#34;text/xml&#34;</span><span class="op" id="6409564">;</span>&nbsp;<span class="ident" id="6409566">e</span>&nbsp;<span class="op" id="6409568">!=</span>&nbsp;<span class="ident" id="6409571">g</span>&nbsp;<span class="op" id="6409573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6409577">t</span><span class="op" id="6409578">.</span><span class="ident" id="6409579">Errorf</span><span class="op" id="6409585">(</span><span class="string" id="6409586">&#34;expected&nbsp;Content-Type&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6409620">,</span>&nbsp;<span class="ident" id="6409622">e</span><span class="op" id="6409623">,</span>&nbsp;<span class="ident" id="6409625">g</span><span class="op" id="6409626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6409629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6409632">if</span>&nbsp;<span class="ident" id="6409635">g</span><span class="op" id="6409636">,</span>&nbsp;<span class="ident" id="6409638">e</span>&nbsp;<span class="op" id="6409640">:=</span>&nbsp;<span class="ident" id="6409643">req</span><span class="op" id="6409646">.</span><span class="ident" id="6409647">ContentLength</span><span class="op" id="6409660">,</span>&nbsp;<span class="ident" id="6409662">int64</span><span class="op" id="6409667">(</span><span class="num" id="6409668">123</span><span class="op" id="6409671">)</span><span class="op" id="6409672">;</span>&nbsp;<span class="ident" id="6409674">e</span>&nbsp;<span class="op" id="6409676">!=</span>&nbsp;<span class="ident" id="6409679">g</span>&nbsp;<span class="op" id="6409681">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6409685">t</span><span class="op" id="6409686">.</span><span class="ident" id="6409687">Errorf</span><span class="op" id="6409693">(</span><span class="string" id="6409694">&#34;expected&nbsp;ContentLength&nbsp;%d;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6409729">,</span>&nbsp;<span class="ident" id="6409731">e</span><span class="op" id="6409732">,</span>&nbsp;<span class="ident" id="6409734">g</span><span class="op" id="6409735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6409738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6409741">if</span>&nbsp;<span class="ident" id="6409744">g</span><span class="op" id="6409745">,</span>&nbsp;<span class="ident" id="6409747">e</span>&nbsp;<span class="op" id="6409749">:=</span>&nbsp;<span class="ident" id="6409752">req</span><span class="op" id="6409755">.</span><span class="ident" id="6409756">Referer</span><span class="op" id="6409763">(</span><span class="op" id="6409764">)</span><span class="op" id="6409765">,</span>&nbsp;<span class="string" id="6409767">&#34;elsewhere&#34;</span><span class="op" id="6409778">;</span>&nbsp;<span class="ident" id="6409780">e</span>&nbsp;<span class="op" id="6409782">!=</span>&nbsp;<span class="ident" id="6409785">g</span>&nbsp;<span class="op" id="6409787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6409791">t</span><span class="op" id="6409792">.</span><span class="ident" id="6409793">Errorf</span><span class="op" id="6409799">(</span><span class="string" id="6409800">&#34;expected&nbsp;Referer&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6409829">,</span>&nbsp;<span class="ident" id="6409831">e</span><span class="op" id="6409832">,</span>&nbsp;<span class="ident" id="6409834">g</span><span class="op" id="6409835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6409838">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6409841">if</span>&nbsp;<span class="ident" id="6409844">req</span><span class="op" id="6409847">.</span><span class="ident" id="6409848">Header</span>&nbsp;<span class="op" id="6409855">==</span>&nbsp;<span class="ident" id="6409858">nil</span>&nbsp;<span class="op" id="6409862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6409866">t</span><span class="op" id="6409867">.</span><span class="ident" id="6409868">Fatalf</span><span class="op" id="6409874">(</span><span class="string" id="6409875">&#34;unexpected&nbsp;nil&nbsp;Header&#34;</span><span class="op" id="6409898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6409901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6409904">if</span>&nbsp;<span class="ident" id="6409907">g</span><span class="op" id="6409908">,</span>&nbsp;<span class="ident" id="6409910">e</span>&nbsp;<span class="op" id="6409912">:=</span>&nbsp;<span class="ident" id="6409915">req</span><span class="op" id="6409918">.</span><span class="ident" id="6409919">Header</span><span class="op" id="6409925">.</span><span class="ident" id="6409926">Get</span><span class="op" id="6409929">(</span><span class="string" id="6409930">&#34;Foo-Bar&#34;</span><span class="op" id="6409939">)</span><span class="op" id="6409940">,</span>&nbsp;<span class="string" id="6409942">&#34;baz&#34;</span><span class="op" id="6409947">;</span>&nbsp;<span class="ident" id="6409949">e</span>&nbsp;<span class="op" id="6409951">!=</span>&nbsp;<span class="ident" id="6409954">g</span>&nbsp;<span class="op" id="6409956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6409960">t</span><span class="op" id="6409961">.</span><span class="ident" id="6409962">Errorf</span><span class="op" id="6409968">(</span><span class="string" id="6409969">&#34;expected&nbsp;Foo-Bar&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6409998">,</span>&nbsp;<span class="ident" id="6410000">e</span><span class="op" id="6410001">,</span>&nbsp;<span class="ident" id="6410003">g</span><span class="op" id="6410004">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6410007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6410010">if</span>&nbsp;<span class="ident" id="6410013">g</span><span class="op" id="6410014">,</span>&nbsp;<span class="ident" id="6410016">e</span>&nbsp;<span class="op" id="6410018">:=</span>&nbsp;<span class="ident" id="6410021">req</span><span class="op" id="6410024">.</span><span class="ident" id="6410025">URL</span><span class="op" id="6410028">.</span><span class="ident" id="6410029">String</span><span class="op" id="6410035">(</span><span class="op" id="6410036">)</span><span class="op" id="6410037">,</span>&nbsp;<span class="string" id="6410039">&#34;http://example.com/path?a=b&#34;</span><span class="op" id="6410068">;</span>&nbsp;<span class="ident" id="6410070">e</span>&nbsp;<span class="op" id="6410072">!=</span>&nbsp;<span class="ident" id="6410075">g</span>&nbsp;<span class="op" id="6410077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410081">t</span><span class="op" id="6410082">.</span><span class="ident" id="6410083">Errorf</span><span class="op" id="6410089">(</span><span class="string" id="6410090">&#34;expected&nbsp;URL&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6410115">,</span>&nbsp;<span class="ident" id="6410117">e</span><span class="op" id="6410118">,</span>&nbsp;<span class="ident" id="6410120">g</span><span class="op" id="6410121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6410124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6410127">if</span>&nbsp;<span class="ident" id="6410130">g</span><span class="op" id="6410131">,</span>&nbsp;<span class="ident" id="6410133">e</span>&nbsp;<span class="op" id="6410135">:=</span>&nbsp;<span class="ident" id="6410138">req</span><span class="op" id="6410141">.</span><span class="ident" id="6410142">FormValue</span><span class="op" id="6410151">(</span><span class="string" id="6410152">&#34;a&#34;</span><span class="op" id="6410155">)</span><span class="op" id="6410156">,</span>&nbsp;<span class="string" id="6410158">&#34;b&#34;</span><span class="op" id="6410161">;</span>&nbsp;<span class="ident" id="6410163">e</span>&nbsp;<span class="op" id="6410165">!=</span>&nbsp;<span class="ident" id="6410168">g</span>&nbsp;<span class="op" id="6410170">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410174">t</span><span class="op" id="6410175">.</span><span class="ident" id="6410176">Errorf</span><span class="op" id="6410182">(</span><span class="string" id="6410183">&#34;expected&nbsp;FormValue(a)&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6410217">,</span>&nbsp;<span class="ident" id="6410219">e</span><span class="op" id="6410220">,</span>&nbsp;<span class="ident" id="6410222">g</span><span class="op" id="6410223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6410226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6410229">if</span>&nbsp;<span class="ident" id="6410232">req</span><span class="op" id="6410235">.</span><span class="ident" id="6410236">Trailer</span>&nbsp;<span class="op" id="6410244">==</span>&nbsp;<span class="ident" id="6410247">nil</span>&nbsp;<span class="op" id="6410251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410255">t</span><span class="op" id="6410256">.</span><span class="ident" id="6410257">Errorf</span><span class="op" id="6410263">(</span><span class="string" id="6410264">&#34;unexpected&nbsp;nil&nbsp;Trailer&#34;</span><span class="op" id="6410288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6410291">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6410294">if</span>&nbsp;<span class="ident" id="6410297">req</span><span class="op" id="6410300">.</span><span class="ident" id="6410301">TLS</span>&nbsp;<span class="op" id="6410305">!=</span>&nbsp;<span class="ident" id="6410308">nil</span>&nbsp;<span class="op" id="6410312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410316">t</span><span class="op" id="6410317">.</span><span class="ident" id="6410318">Errorf</span><span class="op" id="6410324">(</span><span class="string" id="6410325">&#34;expected&nbsp;nil&nbsp;TLS&#34;</span><span class="op" id="6410343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6410346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6410349">if</span>&nbsp;<span class="ident" id="6410352">e</span><span class="op" id="6410353">,</span>&nbsp;<span class="ident" id="6410355">g</span>&nbsp;<span class="op" id="6410357">:=</span>&nbsp;<span class="string" id="6410360">&#34;5.6.7.8:0&#34;</span><span class="op" id="6410371">,</span>&nbsp;<span class="ident" id="6410373">req</span><span class="op" id="6410376">.</span><span class="ident" id="6410377">RemoteAddr</span><span class="op" id="6410387">;</span>&nbsp;<span class="ident" id="6410389">e</span>&nbsp;<span class="op" id="6410391">!=</span>&nbsp;<span class="ident" id="6410394">g</span>&nbsp;<span class="op" id="6410396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410400">t</span><span class="op" id="6410401">.</span><span class="ident" id="6410402">Errorf</span><span class="op" id="6410408">(</span><span class="string" id="6410409">&#34;RemoteAddr:&nbsp;got&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6410438">,</span>&nbsp;<span class="ident" id="6410440">g</span><span class="op" id="6410441">,</span>&nbsp;<span class="ident" id="6410443">e</span><span class="op" id="6410444">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6410447">}</span><br>
<span class="lineno"></span><span class="op" id="6410449">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6410452">func</span>&nbsp;<span class="ident" id="6410457">TestRequestWithTLS</span><span class="op" id="6410475">(</span><span class="ident" id="6410476">t</span>&nbsp;<span class="op" id="6410478">*</span><span class="ident" id="6410479">testing</span><span class="op" id="6410486">.</span><span class="ident" id="6410487">T</span><span class="op" id="6410488">)</span>&nbsp;<span class="op" id="6410490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410493">env</span>&nbsp;<span class="op" id="6410497">:=</span>&nbsp;<span class="keyword" id="6410500">map</span><span class="op" id="6410503">[</span><span class="builtintype" id="6410504">string</span><span class="op" id="6410510">]</span><span class="builtintype" id="6410511">string</span><span class="op" id="6410517">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6410521">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="6410538">:</span>&nbsp;<span class="string" id="6410540">&#34;HTTP/1.1&#34;</span><span class="op" id="6410550">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6410554">&#34;REQUEST_METHOD&#34;</span><span class="op" id="6410570">:</span>&nbsp;&nbsp;<span class="string" id="6410573">&#34;GET&#34;</span><span class="op" id="6410578">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6410582">&#34;HTTP_HOST&#34;</span><span class="op" id="6410593">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6410601">&#34;example.com&#34;</span><span class="op" id="6410614">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6410618">&#34;HTTP_REFERER&#34;</span><span class="op" id="6410632">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6410637">&#34;elsewhere&#34;</span><span class="op" id="6410648">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6410652">&#34;REQUEST_URI&#34;</span><span class="op" id="6410665">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6410671">&#34;/path?a=b&#34;</span><span class="op" id="6410682">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6410686">&#34;CONTENT_TYPE&#34;</span><span class="op" id="6410700">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6410705">&#34;text/xml&#34;</span><span class="op" id="6410715">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6410719">&#34;HTTPS&#34;</span><span class="op" id="6410726">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6410738">&#34;1&#34;</span><span class="op" id="6410741">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6410745">&#34;REMOTE_ADDR&#34;</span><span class="op" id="6410758">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6410764">&#34;5.6.7.8&#34;</span><span class="op" id="6410773">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6410776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410779">req</span><span class="op" id="6410782">,</span>&nbsp;<span class="ident" id="6410784">err</span>&nbsp;<span class="op" id="6410788">:=</span>&nbsp;<span class="ident" id="6410791">RequestFromMap</span><span class="op" id="6410805">(</span><span class="ident" id="6410806">env</span><span class="op" id="6410809">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6410812">if</span>&nbsp;<span class="ident" id="6410815">err</span>&nbsp;<span class="op" id="6410819">!=</span>&nbsp;<span class="ident" id="6410822">nil</span>&nbsp;<span class="op" id="6410826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410830">t</span><span class="op" id="6410831">.</span><span class="ident" id="6410832">Fatalf</span><span class="op" id="6410838">(</span><span class="string" id="6410839">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="6410859">,</span>&nbsp;<span class="ident" id="6410861">err</span><span class="op" id="6410864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6410867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6410870">if</span>&nbsp;<span class="ident" id="6410873">g</span><span class="op" id="6410874">,</span>&nbsp;<span class="ident" id="6410876">e</span>&nbsp;<span class="op" id="6410878">:=</span>&nbsp;<span class="ident" id="6410881">req</span><span class="op" id="6410884">.</span><span class="ident" id="6410885">URL</span><span class="op" id="6410888">.</span><span class="ident" id="6410889">String</span><span class="op" id="6410895">(</span><span class="op" id="6410896">)</span><span class="op" id="6410897">,</span>&nbsp;<span class="string" id="6410899">&#34;https://example.com/path?a=b&#34;</span><span class="op" id="6410929">;</span>&nbsp;<span class="ident" id="6410931">e</span>&nbsp;<span class="op" id="6410933">!=</span>&nbsp;<span class="ident" id="6410936">g</span>&nbsp;<span class="op" id="6410938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410942">t</span><span class="op" id="6410943">.</span><span class="ident" id="6410944">Errorf</span><span class="op" id="6410950">(</span><span class="string" id="6410951">&#34;expected&nbsp;URL&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6410976">,</span>&nbsp;<span class="ident" id="6410978">e</span><span class="op" id="6410979">,</span>&nbsp;<span class="ident" id="6410981">g</span><span class="op" id="6410982">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6410985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6410988">if</span>&nbsp;<span class="ident" id="6410991">req</span><span class="op" id="6410994">.</span><span class="ident" id="6410995">TLS</span>&nbsp;<span class="op" id="6410999">==</span>&nbsp;<span class="ident" id="6411002">nil</span>&nbsp;<span class="op" id="6411006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411010">t</span><span class="op" id="6411011">.</span><span class="ident" id="6411012">Errorf</span><span class="op" id="6411018">(</span><span class="string" id="6411019">&#34;expected&nbsp;non-nil&nbsp;TLS&#34;</span><span class="op" id="6411041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6411044">}</span><br>
<span class="lineno"></span><span class="op" id="6411046">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="6411049">func</span>&nbsp;<span class="ident" id="6411054">TestRequestWithoutHost</span><span class="op" id="6411076">(</span><span class="ident" id="6411077">t</span>&nbsp;<span class="op" id="6411079">*</span><span class="ident" id="6411080">testing</span><span class="op" id="6411087">.</span><span class="ident" id="6411088">T</span><span class="op" id="6411089">)</span>&nbsp;<span class="op" id="6411091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411094">env</span>&nbsp;<span class="op" id="6411098">:=</span>&nbsp;<span class="keyword" id="6411101">map</span><span class="op" id="6411104">[</span><span class="builtintype" id="6411105">string</span><span class="op" id="6411111">]</span><span class="builtintype" id="6411112">string</span><span class="op" id="6411118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6411122">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="6411139">:</span>&nbsp;<span class="string" id="6411141">&#34;HTTP/1.1&#34;</span><span class="op" id="6411151">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6411155">&#34;HTTP_HOST&#34;</span><span class="op" id="6411166">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6411174">&#34;&#34;</span><span class="op" id="6411176">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6411180">&#34;REQUEST_METHOD&#34;</span><span class="op" id="6411196">:</span>&nbsp;&nbsp;<span class="string" id="6411199">&#34;GET&#34;</span><span class="op" id="6411204">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6411208">&#34;REQUEST_URI&#34;</span><span class="op" id="6411221">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6411227">&#34;/path?a=b&#34;</span><span class="op" id="6411238">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6411242">&#34;CONTENT_LENGTH&#34;</span><span class="op" id="6411258">:</span>&nbsp;&nbsp;<span class="string" id="6411261">&#34;123&#34;</span><span class="op" id="6411266">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6411269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411272">req</span><span class="op" id="6411275">,</span>&nbsp;<span class="ident" id="6411277">err</span>&nbsp;<span class="op" id="6411281">:=</span>&nbsp;<span class="ident" id="6411284">RequestFromMap</span><span class="op" id="6411298">(</span><span class="ident" id="6411299">env</span><span class="op" id="6411302">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6411305">if</span>&nbsp;<span class="ident" id="6411308">err</span>&nbsp;<span class="op" id="6411312">!=</span>&nbsp;<span class="ident" id="6411315">nil</span>&nbsp;<span class="op" id="6411319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411323">t</span><span class="op" id="6411324">.</span><span class="ident" id="6411325">Fatalf</span><span class="op" id="6411331">(</span><span class="string" id="6411332">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="6411352">,</span>&nbsp;<span class="ident" id="6411354">err</span><span class="op" id="6411357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6411360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6411363">if</span>&nbsp;<span class="ident" id="6411366">req</span><span class="op" id="6411369">.</span><span class="ident" id="6411370">URL</span>&nbsp;<span class="op" id="6411374">==</span>&nbsp;<span class="ident" id="6411377">nil</span>&nbsp;<span class="op" id="6411381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411385">t</span><span class="op" id="6411386">.</span><span class="ident" id="6411387">Fatalf</span><span class="op" id="6411393">(</span><span class="string" id="6411394">&#34;unexpected&nbsp;nil&nbsp;URL&#34;</span><span class="op" id="6411414">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6411417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6411420">if</span>&nbsp;<span class="ident" id="6411423">g</span><span class="op" id="6411424">,</span>&nbsp;<span class="ident" id="6411426">e</span>&nbsp;<span class="op" id="6411428">:=</span>&nbsp;<span class="ident" id="6411431">req</span><span class="op" id="6411434">.</span><span class="ident" id="6411435">URL</span><span class="op" id="6411438">.</span><span class="ident" id="6411439">String</span><span class="op" id="6411445">(</span><span class="op" id="6411446">)</span><span class="op" id="6411447">,</span>&nbsp;<span class="string" id="6411449">&#34;/path?a=b&#34;</span><span class="op" id="6411460">;</span>&nbsp;<span class="ident" id="6411462">e</span>&nbsp;<span class="op" id="6411464">!=</span>&nbsp;<span class="ident" id="6411467">g</span>&nbsp;<span class="op" id="6411469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411473">t</span><span class="op" id="6411474">.</span><span class="ident" id="6411475">Errorf</span><span class="op" id="6411481">(</span><span class="string" id="6411482">&#34;URL&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6411501">,</span>&nbsp;<span class="ident" id="6411503">g</span><span class="op" id="6411504">,</span>&nbsp;<span class="ident" id="6411506">e</span><span class="op" id="6411507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6411510">}</span><br>
<span class="lineno"></span><span class="op" id="6411512">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="keyword" id="6411515">func</span>&nbsp;<span class="ident" id="6411520">TestRequestWithoutRequestURI</span><span class="op" id="6411548">(</span><span class="ident" id="6411549">t</span>&nbsp;<span class="op" id="6411551">*</span><span class="ident" id="6411552">testing</span><span class="op" id="6411559">.</span><span class="ident" id="6411560">T</span><span class="op" id="6411561">)</span>&nbsp;<span class="op" id="6411563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411566">env</span>&nbsp;<span class="op" id="6411570">:=</span>&nbsp;<span class="keyword" id="6411573">map</span><span class="op" id="6411576">[</span><span class="builtintype" id="6411577">string</span><span class="op" id="6411583">]</span><span class="builtintype" id="6411584">string</span><span class="op" id="6411590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6411594">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="6411611">:</span>&nbsp;<span class="string" id="6411613">&#34;HTTP/1.1&#34;</span><span class="op" id="6411623">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6411627">&#34;HTTP_HOST&#34;</span><span class="op" id="6411638">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6411646">&#34;example.com&#34;</span><span class="op" id="6411659">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6411663">&#34;REQUEST_METHOD&#34;</span><span class="op" id="6411679">:</span>&nbsp;&nbsp;<span class="string" id="6411682">&#34;GET&#34;</span><span class="op" id="6411687">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6411691">&#34;SCRIPT_NAME&#34;</span><span class="op" id="6411704">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6411710">&#34;/dir/scriptname&#34;</span><span class="op" id="6411727">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6411731">&#34;PATH_INFO&#34;</span><span class="op" id="6411742">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6411750">&#34;/p1/p2&#34;</span><span class="op" id="6411758">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6411762">&#34;QUERY_STRING&#34;</span><span class="op" id="6411776">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6411781">&#34;a=1&amp;b=2&#34;</span><span class="op" id="6411790">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6411794">&#34;CONTENT_LENGTH&#34;</span><span class="op" id="6411810">:</span>&nbsp;&nbsp;<span class="string" id="6411813">&#34;123&#34;</span><span class="op" id="6411818">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6411821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411824">req</span><span class="op" id="6411827">,</span>&nbsp;<span class="ident" id="6411829">err</span>&nbsp;<span class="op" id="6411833">:=</span>&nbsp;<span class="ident" id="6411836">RequestFromMap</span><span class="op" id="6411850">(</span><span class="ident" id="6411851">env</span><span class="op" id="6411854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6411857">if</span>&nbsp;<span class="ident" id="6411860">err</span>&nbsp;<span class="op" id="6411864">!=</span>&nbsp;<span class="ident" id="6411867">nil</span>&nbsp;<span class="op" id="6411871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411875">t</span><span class="op" id="6411876">.</span><span class="ident" id="6411877">Fatalf</span><span class="op" id="6411883">(</span><span class="string" id="6411884">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="6411904">,</span>&nbsp;<span class="ident" id="6411906">err</span><span class="op" id="6411909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6411912">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6411915">if</span>&nbsp;<span class="ident" id="6411918">req</span><span class="op" id="6411921">.</span><span class="ident" id="6411922">URL</span>&nbsp;<span class="op" id="6411926">==</span>&nbsp;<span class="ident" id="6411929">nil</span>&nbsp;<span class="op" id="6411933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411937">t</span><span class="op" id="6411938">.</span><span class="ident" id="6411939">Fatalf</span><span class="op" id="6411945">(</span><span class="string" id="6411946">&#34;unexpected&nbsp;nil&nbsp;URL&#34;</span><span class="op" id="6411966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6411969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6411972">if</span>&nbsp;<span class="ident" id="6411975">g</span><span class="op" id="6411976">,</span>&nbsp;<span class="ident" id="6411978">e</span>&nbsp;<span class="op" id="6411980">:=</span>&nbsp;<span class="ident" id="6411983">req</span><span class="op" id="6411986">.</span><span class="ident" id="6411987">URL</span><span class="op" id="6411990">.</span><span class="ident" id="6411991">String</span><span class="op" id="6411997">(</span><span class="op" id="6411998">)</span><span class="op" id="6411999">,</span>&nbsp;<span class="string" id="6412001">&#34;http://example.com/dir/scriptname/p1/p2?a=1&amp;b=2&#34;</span><span class="op" id="6412050">;</span>&nbsp;<span class="ident" id="6412052">e</span>&nbsp;<span class="op" id="6412054">!=</span>&nbsp;<span class="ident" id="6412057">g</span>&nbsp;<span class="op" id="6412059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6412063">t</span><span class="op" id="6412064">.</span><span class="ident" id="6412065">Errorf</span><span class="op" id="6412071">(</span><span class="string" id="6412072">&#34;URL&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6412091">,</span>&nbsp;<span class="ident" id="6412093">g</span><span class="op" id="6412094">,</span>&nbsp;<span class="ident" id="6412096">e</span><span class="op" id="6412097">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6412100">}</span><br>
<span class="lineno"></span><span class="op" id="6412102">}</span>
</div>
</body>
</html>
