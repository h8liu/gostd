<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4126931">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4126986">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4127040">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4127091">//&nbsp;Package&nbsp;rsa&nbsp;implements&nbsp;RSA&nbsp;encryption&nbsp;as&nbsp;specified&nbsp;in&nbsp;PKCS#1.</span><br>
<span class="lineno"></span><span class="keyword" id="4127156">package</span>&nbsp;<span class="ident" id="4127164">rsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4127169">import</span>&nbsp;<span class="op" id="4127176">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4127179">&#34;crypto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4127189">&#34;crypto/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4127204">&#34;crypto/subtle&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4127221">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4127231">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4127239">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4127245">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="4127256">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4127259">var</span>&nbsp;<span class="ident" id="4127263">bigZero</span>&nbsp;<span class="op" id="4127271">=</span>&nbsp;<span class="ident" id="4127273"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4127276">.</span><span class="ident" id="4127277">NewInt</span><span class="op" id="4127283">(</span><span class="num" id="4127284">0</span><span class="op" id="4127285">)</span><br>
<span class="lineno"></span><span class="keyword" id="4127287">var</span>&nbsp;<span class="ident" id="4127291">bigOne</span>&nbsp;<span class="op" id="4127298">=</span>&nbsp;<span class="ident" id="4127300"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4127303">.</span><span class="ident" id="4127304">NewInt</span><span class="op" id="4127310">(</span><span class="num" id="4127311">1</span><span class="op" id="4127312">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="4127315">//&nbsp;A&nbsp;PublicKey&nbsp;represents&nbsp;the&nbsp;public&nbsp;part&nbsp;of&nbsp;an&nbsp;RSA&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4127372">type</span>&nbsp;<span class="ident" id="4127377">PublicKey</span>&nbsp;<span class="keyword" id="4127387">struct</span>&nbsp;<span class="op" id="4127394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4127397">N</span>&nbsp;<span class="op" id="4127399">*</span><span class="ident" id="4127400"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4127403">.</span><span class="ident" id="4127404">Int</span>&nbsp;<span class="comment" id="4127408">//&nbsp;modulus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4127420">E</span>&nbsp;<span class="builtintype" id="4127422">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4127431">//&nbsp;public&nbsp;exponent</span><br>
<span class="lineno">25</span><span class="op" id="4127450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4127453">var</span>&nbsp;<span class="op" id="4127457">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4127460">errPublicModulus</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4127483">=</span>&nbsp;<span class="ident" id="4127485"><a href="/crypto/rsa/rsa.go.html#4127221">errors</a></span><span class="op" id="4127491">.</span><span class="ident" id="4127492">New</span><span class="op" id="4127495">(</span><span class="string" id="4127496">&#34;crypto/rsa:&nbsp;missing&nbsp;public&nbsp;modulus&#34;</span><span class="op" id="4127532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4127535">errPublicExponentSmall</span>&nbsp;<span class="op" id="4127558">=</span>&nbsp;<span class="ident" id="4127560"><a href="/crypto/rsa/rsa.go.html#4127221">errors</a></span><span class="op" id="4127566">.</span><span class="ident" id="4127567">New</span><span class="op" id="4127570">(</span><span class="string" id="4127571">&#34;crypto/rsa:&nbsp;public&nbsp;exponent&nbsp;too&nbsp;small&#34;</span><span class="op" id="4127610">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4127613">errPublicExponentLarge</span>&nbsp;<span class="op" id="4127636">=</span>&nbsp;<span class="ident" id="4127638"><a href="/crypto/rsa/rsa.go.html#4127221">errors</a></span><span class="op" id="4127644">.</span><span class="ident" id="4127645">New</span><span class="op" id="4127648">(</span><span class="string" id="4127649">&#34;crypto/rsa:&nbsp;public&nbsp;exponent&nbsp;too&nbsp;large&#34;</span><span class="op" id="4127688">)</span><br>
<span class="lineno"></span><span class="op" id="4127690">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4127693">//&nbsp;checkPub&nbsp;sanity&nbsp;checks&nbsp;the&nbsp;public&nbsp;key&nbsp;before&nbsp;we&nbsp;use&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="4127752">//&nbsp;We&nbsp;require&nbsp;pub.E&nbsp;to&nbsp;fit&nbsp;into&nbsp;a&nbsp;32-bit&nbsp;integer&nbsp;so&nbsp;that&nbsp;we</span><br>
<span class="lineno">35</span><span class="comment" id="4127812">//&nbsp;do&nbsp;not&nbsp;have&nbsp;different&nbsp;behavior&nbsp;depending&nbsp;on&nbsp;whether</span><br>
<span class="lineno"></span><span class="comment" id="4127867">//&nbsp;int&nbsp;is&nbsp;32&nbsp;or&nbsp;64&nbsp;bits.&nbsp;See&nbsp;also</span><br>
<span class="lineno"></span><span class="comment" id="4127901">//&nbsp;http://www.imperialviolet.org/2012/03/16/rsae.html.</span><br>
<span class="lineno"></span><span class="keyword" id="4127956">func</span>&nbsp;<span class="ident" id="4127961">checkPub</span><span class="op" id="4127969">(</span><span class="ident" id="4127970">pub</span>&nbsp;<span class="op" id="4127974">*</span><span class="ident" id="4127975"><a href="/crypto/rsa/rsa.go.html#4127377">PublicKey</a></span><span class="op" id="4127984">)</span>&nbsp;<span class="builtintype" id="4127986">error</span>&nbsp;<span class="op" id="4127992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4127995">if</span>&nbsp;<span class="ident" id="4127998"><a href="/crypto/rsa/rsa.go.html#4127970">pub</a></span><span class="op" id="4128001">.</span><span class="ident" id="4128002">N</span>&nbsp;<span class="op" id="4128004">==</span>&nbsp;<span class="ident" id="4128007">nil</span>&nbsp;<span class="op" id="4128011">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4128015">return</span>&nbsp;<span class="ident" id="4128022"><a href="/crypto/rsa/rsa.go.html#4127460">errPublicModulus</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4128040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4128043">if</span>&nbsp;<span class="ident" id="4128046"><a href="/crypto/rsa/rsa.go.html#4127970">pub</a></span><span class="op" id="4128049">.</span><span class="ident" id="4128050">E</span>&nbsp;<span class="op" id="4128052">&lt;</span>&nbsp;<span class="num" id="4128054">2</span>&nbsp;<span class="op" id="4128056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4128060">return</span>&nbsp;<span class="ident" id="4128067"><a href="/crypto/rsa/rsa.go.html#4127535">errPublicExponentSmall</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4128091">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4128094">if</span>&nbsp;<span class="ident" id="4128097"><a href="/crypto/rsa/rsa.go.html#4127970">pub</a></span><span class="op" id="4128100">.</span><span class="ident" id="4128101">E</span>&nbsp;<span class="op" id="4128103">&gt;</span>&nbsp;<span class="num" id="4128105">1</span><span class="op" id="4128106">&lt;&lt;</span><span class="num" id="4128108">31</span><span class="op" id="4128110">-</span><span class="num" id="4128111">1</span>&nbsp;<span class="op" id="4128113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4128117">return</span>&nbsp;<span class="ident" id="4128124"><a href="/crypto/rsa/rsa.go.html#4127613">errPublicExponentLarge</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4128148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4128151">return</span>&nbsp;<span class="ident" id="4128158">nil</span><br>
<span class="lineno"></span><span class="op" id="4128162">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="4128165">//&nbsp;A&nbsp;PrivateKey&nbsp;represents&nbsp;an&nbsp;RSA&nbsp;key</span><br>
<span class="lineno"></span><span class="keyword" id="4128203">type</span>&nbsp;<span class="ident" id="4128208">PrivateKey</span>&nbsp;<span class="keyword" id="4128219">struct</span>&nbsp;<span class="op" id="4128226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4128229"><a href="/crypto/rsa/rsa.go.html#4127377">PublicKey</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4128250">//&nbsp;public&nbsp;part.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4128267">D</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4128277">*</span><span class="ident" id="4128278"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4128281">.</span><span class="ident" id="4128282">Int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4128288">//&nbsp;private&nbsp;exponent</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4128309">Primes</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4128319">[</span><span class="op" id="4128320">]</span><span class="op" id="4128321">*</span><span class="ident" id="4128322"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4128325">.</span><span class="ident" id="4128326">Int</span>&nbsp;<span class="comment" id="4128330">//&nbsp;prime&nbsp;factors&nbsp;of&nbsp;N,&nbsp;has&nbsp;&gt;=&nbsp;2&nbsp;elements.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4128374">//&nbsp;Precomputed&nbsp;contains&nbsp;precomputed&nbsp;values&nbsp;that&nbsp;speed&nbsp;up&nbsp;private</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4128440">//&nbsp;operations,&nbsp;if&nbsp;available.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4128470">Precomputed</span>&nbsp;<span class="ident" id="4128482"><a href="/crypto/rsa/rsa.go.html#4129241">PrecomputedValues</a></span><br>
<span class="lineno">60</span><span class="op" id="4128500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4128503">//&nbsp;Public&nbsp;returns&nbsp;the&nbsp;public&nbsp;key&nbsp;corresponding&nbsp;to&nbsp;priv.</span><br>
<span class="lineno"></span><span class="keyword" id="4128559">func</span>&nbsp;<span class="op" id="4128564">(</span><span class="ident" id="4128565">priv</span>&nbsp;<span class="op" id="4128570">*</span><span class="ident" id="4128571"><a href="/crypto/rsa/rsa.go.html#4128208">PrivateKey</a></span><span class="op" id="4128581">)</span>&nbsp;<span class="ident" id="4128583">Public</span><span class="op" id="4128589">(</span><span class="op" id="4128590">)</span>&nbsp;<span class="ident" id="4128592"><a href="/crypto/rsa/rsa.go.html#4127179">crypto</a></span><span class="op" id="4128598">.</span><span class="ident" id="4128599">PublicKey</span>&nbsp;<span class="op" id="4128609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4128612">return</span>&nbsp;<span class="op" id="4128619">&amp;</span><span class="ident" id="4128620"><a href="/crypto/rsa/rsa.go.html#4128565">priv</a></span><span class="op" id="4128624">.</span><span class="ident" id="4128625">PublicKey</span><br>
<span class="lineno">65</span><span class="op" id="4128635">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4128638">//&nbsp;Sign&nbsp;signs&nbsp;msg&nbsp;with&nbsp;priv,&nbsp;reading&nbsp;randomness&nbsp;from&nbsp;rand.&nbsp;If&nbsp;opts&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4128710">//&nbsp;*PSSOptions&nbsp;then&nbsp;the&nbsp;PSS&nbsp;algorithm&nbsp;will&nbsp;be&nbsp;used,&nbsp;otherwise&nbsp;PKCS#1&nbsp;v1.5&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="4128789">//&nbsp;be&nbsp;used.&nbsp;This&nbsp;method&nbsp;is&nbsp;intended&nbsp;to&nbsp;support&nbsp;keys&nbsp;where&nbsp;the&nbsp;private&nbsp;part&nbsp;is</span><br>
<span class="lineno">70</span><span class="comment" id="4128867">//&nbsp;kept&nbsp;in,&nbsp;for&nbsp;example,&nbsp;a&nbsp;hardware&nbsp;module.&nbsp;Common&nbsp;uses&nbsp;should&nbsp;use&nbsp;the&nbsp;Sign*</span><br>
<span class="lineno"></span><span class="comment" id="4128944">//&nbsp;functions&nbsp;in&nbsp;this&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="4128974">func</span>&nbsp;<span class="op" id="4128979">(</span><span class="ident" id="4128980">priv</span>&nbsp;<span class="op" id="4128985">*</span><span class="ident" id="4128986"><a href="/crypto/rsa/rsa.go.html#4128208">PrivateKey</a></span><span class="op" id="4128996">)</span>&nbsp;<span class="ident" id="4128998">Sign</span><span class="op" id="4129002">(</span><span class="ident" id="4129003">rand</span>&nbsp;<span class="ident" id="4129008"><a href="/crypto/rsa/rsa.go.html#4127239">io</a></span><span class="op" id="4129010">.</span><span class="ident" id="4129011">Reader</span><span class="op" id="4129017">,</span>&nbsp;<span class="ident" id="4129019">msg</span>&nbsp;<span class="op" id="4129023">[</span><span class="op" id="4129024">]</span><span class="builtintype" id="4129025">byte</span><span class="op" id="4129029">,</span>&nbsp;<span class="ident" id="4129031">opts</span>&nbsp;<span class="ident" id="4129036"><a href="/crypto/rsa/rsa.go.html#4127179">crypto</a></span><span class="op" id="4129042">.</span><span class="ident" id="4129043">SignerOpts</span><span class="op" id="4129053">)</span>&nbsp;<span class="op" id="4129055">(</span><span class="op" id="4129056">[</span><span class="op" id="4129057">]</span><span class="builtintype" id="4129058">byte</span><span class="op" id="4129062">,</span>&nbsp;<span class="builtintype" id="4129064">error</span><span class="op" id="4129069">)</span>&nbsp;<span class="op" id="4129071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4129074">if</span>&nbsp;<span class="ident" id="4129077">pssOpts</span><span class="op" id="4129084">,</span>&nbsp;<span class="ident" id="4129086">ok</span>&nbsp;<span class="op" id="4129089">:=</span>&nbsp;<span class="ident" id="4129092"><a href="/crypto/rsa/rsa.go.html#4129031">opts</a></span><span class="op" id="4129096">.</span><span class="op" id="4129097">(</span><span class="op" id="4129098">*</span><span class="ident" id="4129099"><a href="/crypto/rsa/pss.go.html#4124433">PSSOptions</a></span><span class="op" id="4129109">)</span><span class="op" id="4129110">;</span>&nbsp;<span class="ident" id="4129112"><a href="/crypto/rsa/rsa.go.html#4129086">ok</a></span>&nbsp;<span class="op" id="4129115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4129119">return</span>&nbsp;<span class="ident" id="4129126"><a href="/crypto/rsa/pss.go.html#4125353">SignPSS</a></span><span class="op" id="4129133">(</span><span class="ident" id="4129134"><a href="/crypto/rsa/rsa.go.html#4129003">rand</a></span><span class="op" id="4129138">,</span>&nbsp;<span class="ident" id="4129140"><a href="/crypto/rsa/rsa.go.html#4128980">priv</a></span><span class="op" id="4129144">,</span>&nbsp;<span class="ident" id="4129146"><a href="/crypto/rsa/rsa.go.html#4129077">pssOpts</a></span><span class="op" id="4129153">.</span><span class="ident" id="4129154">Hash</span><span class="op" id="4129158">,</span>&nbsp;<span class="ident" id="4129160"><a href="/crypto/rsa/rsa.go.html#4129019">msg</a></span><span class="op" id="4129163">,</span>&nbsp;<span class="ident" id="4129165"><a href="/crypto/rsa/rsa.go.html#4129077">pssOpts</a></span><span class="op" id="4129172">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4129175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4129179">return</span>&nbsp;<span class="ident" id="4129186"><a href="/crypto/rsa/pkcs1v15.go.html#4115833">SignPKCS1v15</a></span><span class="op" id="4129198">(</span><span class="ident" id="4129199"><a href="/crypto/rsa/rsa.go.html#4129003">rand</a></span><span class="op" id="4129203">,</span>&nbsp;<span class="ident" id="4129205"><a href="/crypto/rsa/rsa.go.html#4128980">priv</a></span><span class="op" id="4129209">,</span>&nbsp;<span class="ident" id="4129211"><a href="/crypto/rsa/rsa.go.html#4129031">opts</a></span><span class="op" id="4129215">.</span><span class="ident" id="4129216">HashFunc</span><span class="op" id="4129224">(</span><span class="op" id="4129225">)</span><span class="op" id="4129226">,</span>&nbsp;<span class="ident" id="4129228"><a href="/crypto/rsa/rsa.go.html#4129019">msg</a></span><span class="op" id="4129231">)</span><br>
<span class="lineno"></span><span class="op" id="4129233">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="4129236">type</span>&nbsp;<span class="ident" id="4129241">PrecomputedValues</span>&nbsp;<span class="keyword" id="4129259">struct</span>&nbsp;<span class="op" id="4129266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4129269">Dp</span><span class="op" id="4129271">,</span>&nbsp;<span class="ident" id="4129273">Dq</span>&nbsp;<span class="op" id="4129276">*</span><span class="ident" id="4129277"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4129280">.</span><span class="ident" id="4129281">Int</span>&nbsp;<span class="comment" id="4129285">//&nbsp;D&nbsp;mod&nbsp;(P-1)&nbsp;(or&nbsp;mod&nbsp;Q-1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4129314">Qinv</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4129321">*</span><span class="ident" id="4129322"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4129325">.</span><span class="ident" id="4129326">Int</span>&nbsp;<span class="comment" id="4129330">//&nbsp;Q^-1&nbsp;mod&nbsp;P</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4129346">//&nbsp;CRTValues&nbsp;is&nbsp;used&nbsp;for&nbsp;the&nbsp;3rd&nbsp;and&nbsp;subsequent&nbsp;primes.&nbsp;Due&nbsp;to&nbsp;a</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4129412">//&nbsp;historical&nbsp;accident,&nbsp;the&nbsp;CRT&nbsp;for&nbsp;the&nbsp;first&nbsp;two&nbsp;primes&nbsp;is&nbsp;handled</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4129481">//&nbsp;differently&nbsp;in&nbsp;PKCS#1&nbsp;and&nbsp;interoperability&nbsp;is&nbsp;sufficiently</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4129544">//&nbsp;important&nbsp;that&nbsp;we&nbsp;mirror&nbsp;this.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4129579">CRTValues</span>&nbsp;<span class="op" id="4129589">[</span><span class="op" id="4129590">]</span><span class="ident" id="4129591"><a href="/crypto/rsa/rsa.go.html#4129679">CRTValue</a></span><br>
<span class="lineno"></span><span class="op" id="4129600">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="comment" id="4129603">//&nbsp;CRTValue&nbsp;contains&nbsp;the&nbsp;precomputed&nbsp;chinese&nbsp;remainder&nbsp;theorem&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="4129674">type</span>&nbsp;<span class="ident" id="4129679">CRTValue</span>&nbsp;<span class="keyword" id="4129688">struct</span>&nbsp;<span class="op" id="4129695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4129698">Exp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4129704">*</span><span class="ident" id="4129705"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4129708">.</span><span class="ident" id="4129709">Int</span>&nbsp;<span class="comment" id="4129713">//&nbsp;D&nbsp;mod&nbsp;(prime-1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4129734">Coeff</span>&nbsp;<span class="op" id="4129740">*</span><span class="ident" id="4129741"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4129744">.</span><span class="ident" id="4129745">Int</span>&nbsp;<span class="comment" id="4129749">//&nbsp;R·Coeff&nbsp;≡&nbsp;1&nbsp;mod&nbsp;Prime.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4129779">R</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4129785">*</span><span class="ident" id="4129786"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4129789">.</span><span class="ident" id="4129790">Int</span>&nbsp;<span class="comment" id="4129794">//&nbsp;product&nbsp;of&nbsp;primes&nbsp;prior&nbsp;to&nbsp;this&nbsp;(inc&nbsp;p&nbsp;and&nbsp;q).</span><br>
<span class="lineno"></span><span class="op" id="4129844">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4129847">//&nbsp;Validate&nbsp;performs&nbsp;basic&nbsp;sanity&nbsp;checks&nbsp;on&nbsp;the&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="4129900">//&nbsp;It&nbsp;returns&nbsp;nil&nbsp;if&nbsp;the&nbsp;key&nbsp;is&nbsp;valid,&nbsp;or&nbsp;else&nbsp;an&nbsp;error&nbsp;describing&nbsp;a&nbsp;problem.</span><br>
<span class="lineno">100</span><span class="keyword" id="4129978">func</span>&nbsp;<span class="op" id="4129983">(</span><span class="ident" id="4129984">priv</span>&nbsp;<span class="op" id="4129989">*</span><span class="ident" id="4129990"><a href="/crypto/rsa/rsa.go.html#4128208">PrivateKey</a></span><span class="op" id="4130000">)</span>&nbsp;<span class="ident" id="4130002">Validate</span><span class="op" id="4130010">(</span><span class="op" id="4130011">)</span>&nbsp;<span class="builtintype" id="4130013">error</span>&nbsp;<span class="op" id="4130019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4130022">if</span>&nbsp;<span class="ident" id="4130025">err</span>&nbsp;<span class="op" id="4130029">:=</span>&nbsp;<span class="ident" id="4130032"><a href="/crypto/rsa/rsa.go.html#4127961">checkPub</a></span><span class="op" id="4130040">(</span><span class="op" id="4130041">&amp;</span><span class="ident" id="4130042"><a href="/crypto/rsa/rsa.go.html#4129984">priv</a></span><span class="op" id="4130046">.</span><span class="ident" id="4130047">PublicKey</span><span class="op" id="4130056">)</span><span class="op" id="4130057">;</span>&nbsp;<span class="ident" id="4130059"><a href="/crypto/rsa/rsa.go.html#4130025">err</a></span>&nbsp;<span class="op" id="4130063">!=</span>&nbsp;<span class="ident" id="4130066">nil</span>&nbsp;<span class="op" id="4130070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4130074">return</span>&nbsp;<span class="ident" id="4130081"><a href="/crypto/rsa/rsa.go.html#4130025">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4130086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4130090">//&nbsp;Check&nbsp;that&nbsp;the&nbsp;prime&nbsp;factors&nbsp;are&nbsp;actually&nbsp;prime.&nbsp;Note&nbsp;that&nbsp;this&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4130161">//&nbsp;just&nbsp;a&nbsp;sanity&nbsp;check.&nbsp;Since&nbsp;the&nbsp;random&nbsp;witnesses&nbsp;chosen&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4130223">//&nbsp;ProbablyPrime&nbsp;are&nbsp;deterministic,&nbsp;given&nbsp;the&nbsp;candidate&nbsp;number,&nbsp;it&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4130293">//&nbsp;easy&nbsp;for&nbsp;an&nbsp;attack&nbsp;to&nbsp;generate&nbsp;composites&nbsp;that&nbsp;pass&nbsp;this&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4130360">for</span>&nbsp;<span class="ident" id="4130364">_</span><span class="op" id="4130365">,</span>&nbsp;<span class="ident" id="4130367">prime</span>&nbsp;<span class="op" id="4130373">:=</span>&nbsp;<span class="keyword" id="4130376">range</span>&nbsp;<span class="ident" id="4130382"><a href="/crypto/rsa/rsa.go.html#4129984">priv</a></span><span class="op" id="4130386">.</span><span class="ident" id="4130387">Primes</span>&nbsp;<span class="op" id="4130394">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4130398">if</span>&nbsp;<span class="op" id="4130401">!</span><span class="ident" id="4130402"><a href="/crypto/rsa/rsa.go.html#4130367">prime</a></span><span class="op" id="4130407">.</span><span class="ident" id="4130408">ProbablyPrime</span><span class="op" id="4130421">(</span><span class="num" id="4130422">20</span><span class="op" id="4130424">)</span>&nbsp;<span class="op" id="4130426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4130431">return</span>&nbsp;<span class="ident" id="4130438"><a href="/crypto/rsa/rsa.go.html#4127221">errors</a></span><span class="op" id="4130444">.</span><span class="ident" id="4130445">New</span><span class="op" id="4130448">(</span><span class="string" id="4130449">&#34;crypto/rsa:&nbsp;prime&nbsp;factor&nbsp;is&nbsp;composite&#34;</span><span class="op" id="4130488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4130492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4130495">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4130499">//&nbsp;Check&nbsp;that&nbsp;Πprimes&nbsp;==&nbsp;n.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4130529">modulus</span>&nbsp;<span class="op" id="4130537">:=</span>&nbsp;<span class="builtinfunc" id="4130540">new</span><span class="op" id="4130543">(</span><span class="ident" id="4130544"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4130547">.</span><span class="ident" id="4130548">Int</span><span class="op" id="4130551">)</span><span class="op" id="4130552">.</span><span class="ident" id="4130553">Set</span><span class="op" id="4130556">(</span><span class="ident" id="4130557"><a href="/crypto/rsa/rsa.go.html#4127291">bigOne</a></span><span class="op" id="4130563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4130566">for</span>&nbsp;<span class="ident" id="4130570">_</span><span class="op" id="4130571">,</span>&nbsp;<span class="ident" id="4130573">prime</span>&nbsp;<span class="op" id="4130579">:=</span>&nbsp;<span class="keyword" id="4130582">range</span>&nbsp;<span class="ident" id="4130588"><a href="/crypto/rsa/rsa.go.html#4129984">priv</a></span><span class="op" id="4130592">.</span><span class="ident" id="4130593">Primes</span>&nbsp;<span class="op" id="4130600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4130604"><a href="/crypto/rsa/rsa.go.html#4130529">modulus</a></span><span class="op" id="4130611">.</span><span class="ident" id="4130612">Mul</span><span class="op" id="4130615">(</span><span class="ident" id="4130616"><a href="/crypto/rsa/rsa.go.html#4130529">modulus</a></span><span class="op" id="4130623">,</span>&nbsp;<span class="ident" id="4130625"><a href="/crypto/rsa/rsa.go.html#4130573">prime</a></span><span class="op" id="4130630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4130633">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4130636">if</span>&nbsp;<span class="ident" id="4130639"><a href="/crypto/rsa/rsa.go.html#4130529">modulus</a></span><span class="op" id="4130646">.</span><span class="ident" id="4130647">Cmp</span><span class="op" id="4130650">(</span><span class="ident" id="4130651"><a href="/crypto/rsa/rsa.go.html#4129984">priv</a></span><span class="op" id="4130655">.</span><span class="ident" id="4130656">N</span><span class="op" id="4130657">)</span>&nbsp;<span class="op" id="4130659">!=</span>&nbsp;<span class="num" id="4130662">0</span>&nbsp;<span class="op" id="4130664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4130668">return</span>&nbsp;<span class="ident" id="4130675"><a href="/crypto/rsa/rsa.go.html#4127221">errors</a></span><span class="op" id="4130681">.</span><span class="ident" id="4130682">New</span><span class="op" id="4130685">(</span><span class="string" id="4130686">&#34;crypto/rsa:&nbsp;invalid&nbsp;modulus&#34;</span><span class="op" id="4130715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4130718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4130722">//&nbsp;Check&nbsp;that&nbsp;de&nbsp;≡&nbsp;1&nbsp;mod&nbsp;p-1,&nbsp;for&nbsp;each&nbsp;prime.</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4130771">//&nbsp;This&nbsp;implies&nbsp;that&nbsp;e&nbsp;is&nbsp;coprime&nbsp;to&nbsp;each&nbsp;p-1&nbsp;as&nbsp;e&nbsp;has&nbsp;a&nbsp;multiplicative</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4130844">//&nbsp;inverse.&nbsp;Therefore&nbsp;e&nbsp;is&nbsp;coprime&nbsp;to&nbsp;lcm(p-1,q-1,r-1,...)&nbsp;=</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4130906">//&nbsp;exponent(ℤ/nℤ).&nbsp;It&nbsp;also&nbsp;implies&nbsp;that&nbsp;a^de&nbsp;≡&nbsp;a&nbsp;mod&nbsp;p&nbsp;as&nbsp;a^(p-1)&nbsp;≡&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4130985">//&nbsp;mod&nbsp;p.&nbsp;Thus&nbsp;a^de&nbsp;≡&nbsp;a&nbsp;mod&nbsp;n&nbsp;for&nbsp;all&nbsp;a&nbsp;coprime&nbsp;to&nbsp;n,&nbsp;as&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4131055">congruence</span>&nbsp;<span class="op" id="4131066">:=</span>&nbsp;<span class="builtinfunc" id="4131069">new</span><span class="op" id="4131072">(</span><span class="ident" id="4131073"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4131076">.</span><span class="ident" id="4131077">Int</span><span class="op" id="4131080">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4131083">de</span>&nbsp;<span class="op" id="4131086">:=</span>&nbsp;<span class="builtinfunc" id="4131089">new</span><span class="op" id="4131092">(</span><span class="ident" id="4131093"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4131096">.</span><span class="ident" id="4131097">Int</span><span class="op" id="4131100">)</span><span class="op" id="4131101">.</span><span class="ident" id="4131102">SetInt64</span><span class="op" id="4131110">(</span><span class="ident" id="4131111">int64</span><span class="op" id="4131116">(</span><span class="ident" id="4131117"><a href="/crypto/rsa/rsa.go.html#4129984">priv</a></span><span class="op" id="4131121">.</span><span class="ident" id="4131122">E</span><span class="op" id="4131123">)</span><span class="op" id="4131124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4131127"><a href="/crypto/rsa/rsa.go.html#4131083">de</a></span><span class="op" id="4131129">.</span><span class="ident" id="4131130">Mul</span><span class="op" id="4131133">(</span><span class="ident" id="4131134"><a href="/crypto/rsa/rsa.go.html#4131083">de</a></span><span class="op" id="4131136">,</span>&nbsp;<span class="ident" id="4131138"><a href="/crypto/rsa/rsa.go.html#4129984">priv</a></span><span class="op" id="4131142">.</span><span class="ident" id="4131143">D</span><span class="op" id="4131144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4131147">for</span>&nbsp;<span class="ident" id="4131151">_</span><span class="op" id="4131152">,</span>&nbsp;<span class="ident" id="4131154">prime</span>&nbsp;<span class="op" id="4131160">:=</span>&nbsp;<span class="keyword" id="4131163">range</span>&nbsp;<span class="ident" id="4131169"><a href="/crypto/rsa/rsa.go.html#4129984">priv</a></span><span class="op" id="4131173">.</span><span class="ident" id="4131174">Primes</span>&nbsp;<span class="op" id="4131181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4131185">pminus1</span>&nbsp;<span class="op" id="4131193">:=</span>&nbsp;<span class="builtinfunc" id="4131196">new</span><span class="op" id="4131199">(</span><span class="ident" id="4131200"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4131203">.</span><span class="ident" id="4131204">Int</span><span class="op" id="4131207">)</span><span class="op" id="4131208">.</span><span class="ident" id="4131209">Sub</span><span class="op" id="4131212">(</span><span class="ident" id="4131213"><a href="/crypto/rsa/rsa.go.html#4131154">prime</a></span><span class="op" id="4131218">,</span>&nbsp;<span class="ident" id="4131220"><a href="/crypto/rsa/rsa.go.html#4127291">bigOne</a></span><span class="op" id="4131226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4131230"><a href="/crypto/rsa/rsa.go.html#4131055">congruence</a></span><span class="op" id="4131240">.</span><span class="ident" id="4131241">Mod</span><span class="op" id="4131244">(</span><span class="ident" id="4131245"><a href="/crypto/rsa/rsa.go.html#4131083">de</a></span><span class="op" id="4131247">,</span>&nbsp;<span class="ident" id="4131249"><a href="/crypto/rsa/rsa.go.html#4131185">pminus1</a></span><span class="op" id="4131256">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4131260">if</span>&nbsp;<span class="ident" id="4131263"><a href="/crypto/rsa/rsa.go.html#4131055">congruence</a></span><span class="op" id="4131273">.</span><span class="ident" id="4131274">Cmp</span><span class="op" id="4131277">(</span><span class="ident" id="4131278"><a href="/crypto/rsa/rsa.go.html#4127291">bigOne</a></span><span class="op" id="4131284">)</span>&nbsp;<span class="op" id="4131286">!=</span>&nbsp;<span class="num" id="4131289">0</span>&nbsp;<span class="op" id="4131291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4131296">return</span>&nbsp;<span class="ident" id="4131303"><a href="/crypto/rsa/rsa.go.html#4127221">errors</a></span><span class="op" id="4131309">.</span><span class="ident" id="4131310">New</span><span class="op" id="4131313">(</span><span class="string" id="4131314">&#34;crypto/rsa:&nbsp;invalid&nbsp;exponents&#34;</span><span class="op" id="4131345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4131349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4131352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4131355">return</span>&nbsp;<span class="ident" id="4131362">nil</span><br>
<span class="lineno">140</span><span class="op" id="4131366">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4131369">//&nbsp;GenerateKey&nbsp;generates&nbsp;an&nbsp;RSA&nbsp;keypair&nbsp;of&nbsp;the&nbsp;given&nbsp;bit&nbsp;size&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4131441">//&nbsp;random&nbsp;source&nbsp;random&nbsp;(for&nbsp;example,&nbsp;crypto/rand.Reader).</span><br>
<span class="lineno"></span><span class="keyword" id="4131500">func</span>&nbsp;<span class="ident" id="4131505">GenerateKey</span><span class="op" id="4131516">(</span><span class="ident" id="4131517">random</span>&nbsp;<span class="ident" id="4131524"><a href="/crypto/rsa/rsa.go.html#4127239">io</a></span><span class="op" id="4131526">.</span><span class="ident" id="4131527">Reader</span><span class="op" id="4131533">,</span>&nbsp;<span class="ident" id="4131535">bits</span>&nbsp;<span class="builtintype" id="4131540">int</span><span class="op" id="4131543">)</span>&nbsp;<span class="op" id="4131545">(</span><span class="ident" id="4131546">priv</span>&nbsp;<span class="op" id="4131551">*</span><span class="ident" id="4131552"><a href="/crypto/rsa/rsa.go.html#4128208">PrivateKey</a></span><span class="op" id="4131562">,</span>&nbsp;<span class="ident" id="4131564">err</span>&nbsp;<span class="builtintype" id="4131568">error</span><span class="op" id="4131573">)</span>&nbsp;<span class="op" id="4131575">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4131578">return</span>&nbsp;<span class="ident" id="4131585"><a href="/crypto/rsa/rsa.go.html#4132221">GenerateMultiPrimeKey</a></span><span class="op" id="4131606">(</span><span class="ident" id="4131607"><a href="/crypto/rsa/rsa.go.html#4131517">random</a></span><span class="op" id="4131613">,</span>&nbsp;<span class="num" id="4131615">2</span><span class="op" id="4131616">,</span>&nbsp;<span class="ident" id="4131618"><a href="/crypto/rsa/rsa.go.html#4131535">bits</a></span><span class="op" id="4131622">)</span><br>
<span class="lineno"></span><span class="op" id="4131624">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4131627">//&nbsp;GenerateMultiPrimeKey&nbsp;generates&nbsp;a&nbsp;multi-prime&nbsp;RSA&nbsp;keypair&nbsp;of&nbsp;the&nbsp;given&nbsp;bit</span><br>
<span class="lineno"></span><span class="comment" id="4131705">//&nbsp;size&nbsp;and&nbsp;the&nbsp;given&nbsp;random&nbsp;source,&nbsp;as&nbsp;suggested&nbsp;in&nbsp;[1].&nbsp;Although&nbsp;the&nbsp;public</span><br>
<span class="lineno">150</span><span class="comment" id="4131783">//&nbsp;keys&nbsp;are&nbsp;compatible&nbsp;(actually,&nbsp;indistinguishable)&nbsp;from&nbsp;the&nbsp;2-prime&nbsp;case,</span><br>
<span class="lineno"></span><span class="comment" id="4131859">//&nbsp;the&nbsp;private&nbsp;keys&nbsp;are&nbsp;not.&nbsp;Thus&nbsp;it&nbsp;may&nbsp;not&nbsp;be&nbsp;possible&nbsp;to&nbsp;export&nbsp;multi-prime</span><br>
<span class="lineno"></span><span class="comment" id="4131938">//&nbsp;private&nbsp;keys&nbsp;in&nbsp;certain&nbsp;formats&nbsp;or&nbsp;to&nbsp;subsequently&nbsp;import&nbsp;them&nbsp;into&nbsp;other</span><br>
<span class="lineno"></span><span class="comment" id="4132015">//&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="4132024">//</span><br>
<span class="lineno">155</span><span class="comment" id="4132027">//&nbsp;Table&nbsp;1&nbsp;in&nbsp;[2]&nbsp;suggests&nbsp;maximum&nbsp;numbers&nbsp;of&nbsp;primes&nbsp;for&nbsp;a&nbsp;given&nbsp;size.</span><br>
<span class="lineno"></span><span class="comment" id="4132098">//</span><br>
<span class="lineno"></span><span class="comment" id="4132101">//&nbsp;[1]&nbsp;US&nbsp;patent&nbsp;4405829&nbsp;(1972,&nbsp;expired)</span><br>
<span class="lineno"></span><span class="comment" id="4132142">//&nbsp;[2]&nbsp;http://www.cacr.math.uwaterloo.ca/techreports/2006/cacr2006-16.pdf</span><br>
<span class="lineno"></span><span class="keyword" id="4132216">func</span>&nbsp;<span class="ident" id="4132221">GenerateMultiPrimeKey</span><span class="op" id="4132242">(</span><span class="ident" id="4132243">random</span>&nbsp;<span class="ident" id="4132250"><a href="/crypto/rsa/rsa.go.html#4127239">io</a></span><span class="op" id="4132252">.</span><span class="ident" id="4132253">Reader</span><span class="op" id="4132259">,</span>&nbsp;<span class="ident" id="4132261">nprimes</span>&nbsp;<span class="builtintype" id="4132269">int</span><span class="op" id="4132272">,</span>&nbsp;<span class="ident" id="4132274">bits</span>&nbsp;<span class="builtintype" id="4132279">int</span><span class="op" id="4132282">)</span>&nbsp;<span class="op" id="4132284">(</span><span class="ident" id="4132285">priv</span>&nbsp;<span class="op" id="4132290">*</span><span class="ident" id="4132291"><a href="/crypto/rsa/rsa.go.html#4128208">PrivateKey</a></span><span class="op" id="4132301">,</span>&nbsp;<span class="ident" id="4132303">err</span>&nbsp;<span class="builtintype" id="4132307">error</span><span class="op" id="4132312">)</span>&nbsp;<span class="op" id="4132314">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4132317"><a href="/crypto/rsa/rsa.go.html#4132285">priv</a></span>&nbsp;<span class="op" id="4132322">=</span>&nbsp;<span class="builtinfunc" id="4132324">new</span><span class="op" id="4132327">(</span><span class="ident" id="4132328"><a href="/crypto/rsa/rsa.go.html#4128208">PrivateKey</a></span><span class="op" id="4132338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4132341"><a href="/crypto/rsa/rsa.go.html#4132285">priv</a></span><span class="op" id="4132345">.</span><span class="ident" id="4132346">E</span>&nbsp;<span class="op" id="4132348">=</span>&nbsp;<span class="num" id="4132350">65537</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4132358">if</span>&nbsp;<span class="ident" id="4132361"><a href="/crypto/rsa/rsa.go.html#4132261">nprimes</a></span>&nbsp;<span class="op" id="4132369">&lt;</span>&nbsp;<span class="num" id="4132371">2</span>&nbsp;<span class="op" id="4132373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4132377">return</span>&nbsp;<span class="ident" id="4132384">nil</span><span class="op" id="4132387">,</span>&nbsp;<span class="ident" id="4132389"><a href="/crypto/rsa/rsa.go.html#4127221">errors</a></span><span class="op" id="4132395">.</span><span class="ident" id="4132396">New</span><span class="op" id="4132399">(</span><span class="string" id="4132400">&#34;crypto/rsa:&nbsp;GenerateMultiPrimeKey:&nbsp;nprimes&nbsp;must&nbsp;be&nbsp;&gt;=&nbsp;2&#34;</span><span class="op" id="4132457">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4132460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4132464">primes</span>&nbsp;<span class="op" id="4132471">:=</span>&nbsp;<span class="builtinfunc" id="4132474">make</span><span class="op" id="4132478">(</span><span class="op" id="4132479">[</span><span class="op" id="4132480">]</span><span class="op" id="4132481">*</span><span class="ident" id="4132482"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4132485">.</span><span class="ident" id="4132486">Int</span><span class="op" id="4132489">,</span>&nbsp;<span class="ident" id="4132491"><a href="/crypto/rsa/rsa.go.html#4132261">nprimes</a></span><span class="op" id="4132498">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="4132501">NextSetOfPrimes</span><span class="op" id="4132516">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4132519">for</span>&nbsp;<span class="op" id="4132523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4132527">todo</span>&nbsp;<span class="op" id="4132532">:=</span>&nbsp;<span class="ident" id="4132535"><a href="/crypto/rsa/rsa.go.html#4132274">bits</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4132542">//&nbsp;crypto/rand&nbsp;should&nbsp;set&nbsp;the&nbsp;top&nbsp;two&nbsp;bits&nbsp;in&nbsp;each&nbsp;prime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4132602">//&nbsp;Thus&nbsp;each&nbsp;prime&nbsp;has&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4132636">//&nbsp;&nbsp;&nbsp;p_i&nbsp;=&nbsp;2^bitlen(p_i)&nbsp;×&nbsp;0.11...&nbsp;(in&nbsp;base&nbsp;2).</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4132687">//&nbsp;And&nbsp;the&nbsp;product&nbsp;is:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4132712">//&nbsp;&nbsp;&nbsp;P&nbsp;=&nbsp;2^todo&nbsp;×&nbsp;α</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4132736">//&nbsp;where&nbsp;α&nbsp;is&nbsp;the&nbsp;product&nbsp;of&nbsp;nprimes&nbsp;numbers&nbsp;of&nbsp;the&nbsp;form&nbsp;0.11...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4132804">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4132809">//&nbsp;If&nbsp;α&nbsp;&lt;&nbsp;1/2&nbsp;(which&nbsp;can&nbsp;happen&nbsp;for&nbsp;nprimes&nbsp;&gt;&nbsp;2),&nbsp;we&nbsp;need&nbsp;to</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4132873">//&nbsp;shift&nbsp;todo&nbsp;to&nbsp;compensate&nbsp;for&nbsp;lost&nbsp;bits:&nbsp;the&nbsp;mean&nbsp;value&nbsp;of&nbsp;0.11...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4132944">//&nbsp;is&nbsp;7/8,&nbsp;so&nbsp;todo&nbsp;+&nbsp;shift&nbsp;-&nbsp;nprimes&nbsp;*&nbsp;log2(7/8)&nbsp;~=&nbsp;bits&nbsp;-&nbsp;1/2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4133009">//&nbsp;will&nbsp;give&nbsp;good&nbsp;results.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4133038">if</span>&nbsp;<span class="ident" id="4133041"><a href="/crypto/rsa/rsa.go.html#4132261">nprimes</a></span>&nbsp;<span class="op" id="4133049">&gt;=</span>&nbsp;<span class="num" id="4133052">7</span>&nbsp;<span class="op" id="4133054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133059"><a href="/crypto/rsa/rsa.go.html#4132527">todo</a></span>&nbsp;<span class="op" id="4133064">+=</span>&nbsp;<span class="op" id="4133067">(</span><span class="ident" id="4133068"><a href="/crypto/rsa/rsa.go.html#4132261">nprimes</a></span>&nbsp;<span class="op" id="4133076">-</span>&nbsp;<span class="num" id="4133078">2</span><span class="op" id="4133079">)</span>&nbsp;<span class="op" id="4133081">/</span>&nbsp;<span class="num" id="4133083">5</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4133087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4133091">for</span>&nbsp;<span class="ident" id="4133095">i</span>&nbsp;<span class="op" id="4133097">:=</span>&nbsp;<span class="num" id="4133100">0</span><span class="op" id="4133101">;</span>&nbsp;<span class="ident" id="4133103"><a href="/crypto/rsa/rsa.go.html#4133095">i</a></span>&nbsp;<span class="op" id="4133105">&lt;</span>&nbsp;<span class="ident" id="4133107"><a href="/crypto/rsa/rsa.go.html#4132261">nprimes</a></span><span class="op" id="4133114">;</span>&nbsp;<span class="ident" id="4133116"><a href="/crypto/rsa/rsa.go.html#4133095">i</a></span><span class="op" id="4133117">++</span>&nbsp;<span class="op" id="4133120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133125"><a href="/crypto/rsa/rsa.go.html#4132464">primes</a></span><span class="op" id="4133131">[</span><span class="ident" id="4133132"><a href="/crypto/rsa/rsa.go.html#4133095">i</a></span><span class="op" id="4133133">]</span><span class="op" id="4133134">,</span>&nbsp;<span class="ident" id="4133136"><a href="/crypto/rsa/rsa.go.html#4132303">err</a></span>&nbsp;<span class="op" id="4133140">=</span>&nbsp;<span class="ident" id="4133142"><a href="/crypto/rsa/rsa.go.html#4127189">rand</a></span><span class="op" id="4133146">.</span><span class="ident" id="4133147">Prime</span><span class="op" id="4133152">(</span><span class="ident" id="4133153"><a href="/crypto/rsa/rsa.go.html#4132243">random</a></span><span class="op" id="4133159">,</span>&nbsp;<span class="ident" id="4133161"><a href="/crypto/rsa/rsa.go.html#4132527">todo</a></span><span class="op" id="4133165">/</span><span class="op" id="4133166">(</span><span class="ident" id="4133167"><a href="/crypto/rsa/rsa.go.html#4132261">nprimes</a></span><span class="op" id="4133174">-</span><span class="ident" id="4133175"><a href="/crypto/rsa/rsa.go.html#4133095">i</a></span><span class="op" id="4133176">)</span><span class="op" id="4133177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4133182">if</span>&nbsp;<span class="ident" id="4133185"><a href="/crypto/rsa/rsa.go.html#4132303">err</a></span>&nbsp;<span class="op" id="4133189">!=</span>&nbsp;<span class="ident" id="4133192">nil</span>&nbsp;<span class="op" id="4133196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4133202">return</span>&nbsp;<span class="ident" id="4133209">nil</span><span class="op" id="4133212">,</span>&nbsp;<span class="ident" id="4133214"><a href="/crypto/rsa/rsa.go.html#4132303">err</a></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4133221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133226"><a href="/crypto/rsa/rsa.go.html#4132527">todo</a></span>&nbsp;<span class="op" id="4133231">-=</span>&nbsp;<span class="ident" id="4133234"><a href="/crypto/rsa/rsa.go.html#4132464">primes</a></span><span class="op" id="4133240">[</span><span class="ident" id="4133241"><a href="/crypto/rsa/rsa.go.html#4133095">i</a></span><span class="op" id="4133242">]</span><span class="op" id="4133243">.</span><span class="ident" id="4133244">BitLen</span><span class="op" id="4133250">(</span><span class="op" id="4133251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4133255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4133260">//&nbsp;Make&nbsp;sure&nbsp;that&nbsp;primes&nbsp;is&nbsp;pairwise&nbsp;unequal.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4133308">for</span>&nbsp;<span class="ident" id="4133312">i</span><span class="op" id="4133313">,</span>&nbsp;<span class="ident" id="4133315">prime</span>&nbsp;<span class="op" id="4133321">:=</span>&nbsp;<span class="keyword" id="4133324">range</span>&nbsp;<span class="ident" id="4133330"><a href="/crypto/rsa/rsa.go.html#4132464">primes</a></span>&nbsp;<span class="op" id="4133337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4133342">for</span>&nbsp;<span class="ident" id="4133346">j</span>&nbsp;<span class="op" id="4133348">:=</span>&nbsp;<span class="num" id="4133351">0</span><span class="op" id="4133352">;</span>&nbsp;<span class="ident" id="4133354"><a href="/crypto/rsa/rsa.go.html#4133346">j</a></span>&nbsp;<span class="op" id="4133356">&lt;</span>&nbsp;<span class="ident" id="4133358"><a href="/crypto/rsa/rsa.go.html#4133312">i</a></span><span class="op" id="4133359">;</span>&nbsp;<span class="ident" id="4133361"><a href="/crypto/rsa/rsa.go.html#4133346">j</a></span><span class="op" id="4133362">++</span>&nbsp;<span class="op" id="4133365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4133371">if</span>&nbsp;<span class="ident" id="4133374"><a href="/crypto/rsa/rsa.go.html#4133315">prime</a></span><span class="op" id="4133379">.</span><span class="ident" id="4133380">Cmp</span><span class="op" id="4133383">(</span><span class="ident" id="4133384"><a href="/crypto/rsa/rsa.go.html#4132464">primes</a></span><span class="op" id="4133390">[</span><span class="ident" id="4133391"><a href="/crypto/rsa/rsa.go.html#4133346">j</a></span><span class="op" id="4133392">]</span><span class="op" id="4133393">)</span>&nbsp;<span class="op" id="4133395">==</span>&nbsp;<span class="num" id="4133398">0</span>&nbsp;<span class="op" id="4133400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4133407">continue</span>&nbsp;<span class="ident" id="4133416">NextSetOfPrimes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4133436">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4133441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4133445">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133450">n</span>&nbsp;<span class="op" id="4133452">:=</span>&nbsp;<span class="builtinfunc" id="4133455">new</span><span class="op" id="4133458">(</span><span class="ident" id="4133459"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4133462">.</span><span class="ident" id="4133463">Int</span><span class="op" id="4133466">)</span><span class="op" id="4133467">.</span><span class="ident" id="4133468">Set</span><span class="op" id="4133471">(</span><span class="ident" id="4133472"><a href="/crypto/rsa/rsa.go.html#4127291">bigOne</a></span><span class="op" id="4133478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133482">totient</span>&nbsp;<span class="op" id="4133490">:=</span>&nbsp;<span class="builtinfunc" id="4133493">new</span><span class="op" id="4133496">(</span><span class="ident" id="4133497"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4133500">.</span><span class="ident" id="4133501">Int</span><span class="op" id="4133504">)</span><span class="op" id="4133505">.</span><span class="ident" id="4133506">Set</span><span class="op" id="4133509">(</span><span class="ident" id="4133510"><a href="/crypto/rsa/rsa.go.html#4127291">bigOne</a></span><span class="op" id="4133516">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133520">pminus1</span>&nbsp;<span class="op" id="4133528">:=</span>&nbsp;<span class="builtinfunc" id="4133531">new</span><span class="op" id="4133534">(</span><span class="ident" id="4133535"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4133538">.</span><span class="ident" id="4133539">Int</span><span class="op" id="4133542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4133546">for</span>&nbsp;<span class="ident" id="4133550">_</span><span class="op" id="4133551">,</span>&nbsp;<span class="ident" id="4133553">prime</span>&nbsp;<span class="op" id="4133559">:=</span>&nbsp;<span class="keyword" id="4133562">range</span>&nbsp;<span class="ident" id="4133568"><a href="/crypto/rsa/rsa.go.html#4132464">primes</a></span>&nbsp;<span class="op" id="4133575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133580"><a href="/crypto/rsa/rsa.go.html#4133450">n</a></span><span class="op" id="4133581">.</span><span class="ident" id="4133582">Mul</span><span class="op" id="4133585">(</span><span class="ident" id="4133586"><a href="/crypto/rsa/rsa.go.html#4133450">n</a></span><span class="op" id="4133587">,</span>&nbsp;<span class="ident" id="4133589"><a href="/crypto/rsa/rsa.go.html#4133553">prime</a></span><span class="op" id="4133594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133599"><a href="/crypto/rsa/rsa.go.html#4133520">pminus1</a></span><span class="op" id="4133606">.</span><span class="ident" id="4133607">Sub</span><span class="op" id="4133610">(</span><span class="ident" id="4133611"><a href="/crypto/rsa/rsa.go.html#4133553">prime</a></span><span class="op" id="4133616">,</span>&nbsp;<span class="ident" id="4133618"><a href="/crypto/rsa/rsa.go.html#4127291">bigOne</a></span><span class="op" id="4133624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133629"><a href="/crypto/rsa/rsa.go.html#4133482">totient</a></span><span class="op" id="4133636">.</span><span class="ident" id="4133637">Mul</span><span class="op" id="4133640">(</span><span class="ident" id="4133641"><a href="/crypto/rsa/rsa.go.html#4133482">totient</a></span><span class="op" id="4133648">,</span>&nbsp;<span class="ident" id="4133650"><a href="/crypto/rsa/rsa.go.html#4133520">pminus1</a></span><span class="op" id="4133657">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4133661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4133665">if</span>&nbsp;<span class="ident" id="4133668"><a href="/crypto/rsa/rsa.go.html#4133450">n</a></span><span class="op" id="4133669">.</span><span class="ident" id="4133670">BitLen</span><span class="op" id="4133676">(</span><span class="op" id="4133677">)</span>&nbsp;<span class="op" id="4133679">!=</span>&nbsp;<span class="ident" id="4133682"><a href="/crypto/rsa/rsa.go.html#4132274">bits</a></span>&nbsp;<span class="op" id="4133687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4133692">//&nbsp;This&nbsp;should&nbsp;never&nbsp;happen&nbsp;for&nbsp;nprimes&nbsp;==&nbsp;2&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4133748">//&nbsp;crypto/rand&nbsp;should&nbsp;set&nbsp;the&nbsp;top&nbsp;two&nbsp;bits&nbsp;in&nbsp;each&nbsp;prime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4133809">//&nbsp;For&nbsp;nprimes&nbsp;&gt;&nbsp;2&nbsp;we&nbsp;hope&nbsp;it&nbsp;does&nbsp;not&nbsp;happen&nbsp;often.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4133865">continue</span>&nbsp;<span class="ident" id="4133874">NextSetOfPrimes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4133892">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133897">g</span>&nbsp;<span class="op" id="4133899">:=</span>&nbsp;<span class="builtinfunc" id="4133902">new</span><span class="op" id="4133905">(</span><span class="ident" id="4133906"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4133909">.</span><span class="ident" id="4133910">Int</span><span class="op" id="4133913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133917"><a href="/crypto/rsa/rsa.go.html#4132285">priv</a></span><span class="op" id="4133921">.</span><span class="ident" id="4133922">D</span>&nbsp;<span class="op" id="4133924">=</span>&nbsp;<span class="builtinfunc" id="4133926">new</span><span class="op" id="4133929">(</span><span class="ident" id="4133930"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4133933">.</span><span class="ident" id="4133934">Int</span><span class="op" id="4133937">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133941">y</span>&nbsp;<span class="op" id="4133943">:=</span>&nbsp;<span class="builtinfunc" id="4133946">new</span><span class="op" id="4133949">(</span><span class="ident" id="4133950"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4133953">.</span><span class="ident" id="4133954">Int</span><span class="op" id="4133957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133961">e</span>&nbsp;<span class="op" id="4133963">:=</span>&nbsp;<span class="ident" id="4133966"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4133969">.</span><span class="ident" id="4133970">NewInt</span><span class="op" id="4133976">(</span><span class="ident" id="4133977">int64</span><span class="op" id="4133982">(</span><span class="ident" id="4133983"><a href="/crypto/rsa/rsa.go.html#4132285">priv</a></span><span class="op" id="4133987">.</span><span class="ident" id="4133988">E</span><span class="op" id="4133989">)</span><span class="op" id="4133990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133994"><a href="/crypto/rsa/rsa.go.html#4133897">g</a></span><span class="op" id="4133995">.</span><span class="ident" id="4133996">GCD</span><span class="op" id="4133999">(</span><span class="ident" id="4134000"><a href="/crypto/rsa/rsa.go.html#4132285">priv</a></span><span class="op" id="4134004">.</span><span class="ident" id="4134005">D</span><span class="op" id="4134006">,</span>&nbsp;<span class="ident" id="4134008"><a href="/crypto/rsa/rsa.go.html#4133941">y</a></span><span class="op" id="4134009">,</span>&nbsp;<span class="ident" id="4134011"><a href="/crypto/rsa/rsa.go.html#4133961">e</a></span><span class="op" id="4134012">,</span>&nbsp;<span class="ident" id="4134014"><a href="/crypto/rsa/rsa.go.html#4133482">totient</a></span><span class="op" id="4134021">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4134026">if</span>&nbsp;<span class="ident" id="4134029"><a href="/crypto/rsa/rsa.go.html#4133897">g</a></span><span class="op" id="4134030">.</span><span class="ident" id="4134031">Cmp</span><span class="op" id="4134034">(</span><span class="ident" id="4134035"><a href="/crypto/rsa/rsa.go.html#4127291">bigOne</a></span><span class="op" id="4134041">)</span>&nbsp;<span class="op" id="4134043">==</span>&nbsp;<span class="num" id="4134046">0</span>&nbsp;<span class="op" id="4134048">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4134053">if</span>&nbsp;<span class="ident" id="4134056"><a href="/crypto/rsa/rsa.go.html#4132285">priv</a></span><span class="op" id="4134060">.</span><span class="ident" id="4134061">D</span><span class="op" id="4134062">.</span><span class="ident" id="4134063">Sign</span><span class="op" id="4134067">(</span><span class="op" id="4134068">)</span>&nbsp;<span class="op" id="4134070">&lt;</span>&nbsp;<span class="num" id="4134072">0</span>&nbsp;<span class="op" id="4134074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134080"><a href="/crypto/rsa/rsa.go.html#4132285">priv</a></span><span class="op" id="4134084">.</span><span class="ident" id="4134085">D</span><span class="op" id="4134086">.</span><span class="ident" id="4134087">Add</span><span class="op" id="4134090">(</span><span class="ident" id="4134091"><a href="/crypto/rsa/rsa.go.html#4132285">priv</a></span><span class="op" id="4134095">.</span><span class="ident" id="4134096">D</span><span class="op" id="4134097">,</span>&nbsp;<span class="ident" id="4134099"><a href="/crypto/rsa/rsa.go.html#4133482">totient</a></span><span class="op" id="4134106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4134111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134116"><a href="/crypto/rsa/rsa.go.html#4132285">priv</a></span><span class="op" id="4134120">.</span><span class="ident" id="4134121">Primes</span>&nbsp;<span class="op" id="4134128">=</span>&nbsp;<span class="ident" id="4134130"><a href="/crypto/rsa/rsa.go.html#4132464">primes</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134140"><a href="/crypto/rsa/rsa.go.html#4132285">priv</a></span><span class="op" id="4134144">.</span><span class="ident" id="4134145">N</span>&nbsp;<span class="op" id="4134147">=</span>&nbsp;<span class="ident" id="4134149"><a href="/crypto/rsa/rsa.go.html#4133450">n</a></span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4134155">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4134163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4134166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134170"><a href="/crypto/rsa/rsa.go.html#4132285">priv</a></span><span class="op" id="4134174">.</span><span class="ident" id="4134175">Precompute</span><span class="op" id="4134185">(</span><span class="op" id="4134186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4134189">return</span><br>
<span class="lineno"></span><span class="op" id="4134196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4134199">//&nbsp;incCounter&nbsp;increments&nbsp;a&nbsp;four&nbsp;byte,&nbsp;big-endian&nbsp;counter.</span><br>
<span class="lineno">240</span><span class="keyword" id="4134257">func</span>&nbsp;<span class="ident" id="4134262">incCounter</span><span class="op" id="4134272">(</span><span class="ident" id="4134273">c</span>&nbsp;<span class="op" id="4134275">*</span><span class="op" id="4134276">[</span><span class="num" id="4134277">4</span><span class="op" id="4134278">]</span><span class="builtintype" id="4134279">byte</span><span class="op" id="4134283">)</span>&nbsp;<span class="op" id="4134285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4134288">if</span>&nbsp;<span class="ident" id="4134291"><a href="/crypto/rsa/rsa.go.html#4134273">c</a></span><span class="op" id="4134292">[</span><span class="num" id="4134293">3</span><span class="op" id="4134294">]</span><span class="op" id="4134295">++</span><span class="op" id="4134297">;</span>&nbsp;<span class="ident" id="4134299"><a href="/crypto/rsa/rsa.go.html#4134273">c</a></span><span class="op" id="4134300">[</span><span class="num" id="4134301">3</span><span class="op" id="4134302">]</span>&nbsp;<span class="op" id="4134304">!=</span>&nbsp;<span class="num" id="4134307">0</span>&nbsp;<span class="op" id="4134309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4134313">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4134321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4134324">if</span>&nbsp;<span class="ident" id="4134327"><a href="/crypto/rsa/rsa.go.html#4134273">c</a></span><span class="op" id="4134328">[</span><span class="num" id="4134329">2</span><span class="op" id="4134330">]</span><span class="op" id="4134331">++</span><span class="op" id="4134333">;</span>&nbsp;<span class="ident" id="4134335"><a href="/crypto/rsa/rsa.go.html#4134273">c</a></span><span class="op" id="4134336">[</span><span class="num" id="4134337">2</span><span class="op" id="4134338">]</span>&nbsp;<span class="op" id="4134340">!=</span>&nbsp;<span class="num" id="4134343">0</span>&nbsp;<span class="op" id="4134345">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4134349">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4134357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4134360">if</span>&nbsp;<span class="ident" id="4134363"><a href="/crypto/rsa/rsa.go.html#4134273">c</a></span><span class="op" id="4134364">[</span><span class="num" id="4134365">1</span><span class="op" id="4134366">]</span><span class="op" id="4134367">++</span><span class="op" id="4134369">;</span>&nbsp;<span class="ident" id="4134371"><a href="/crypto/rsa/rsa.go.html#4134273">c</a></span><span class="op" id="4134372">[</span><span class="num" id="4134373">1</span><span class="op" id="4134374">]</span>&nbsp;<span class="op" id="4134376">!=</span>&nbsp;<span class="num" id="4134379">0</span>&nbsp;<span class="op" id="4134381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4134385">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4134393">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134396"><a href="/crypto/rsa/rsa.go.html#4134273">c</a></span><span class="op" id="4134397">[</span><span class="num" id="4134398">0</span><span class="op" id="4134399">]</span><span class="op" id="4134400">++</span><br>
<span class="lineno"></span><span class="op" id="4134403">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4134406">//&nbsp;mgf1XOR&nbsp;XORs&nbsp;the&nbsp;bytes&nbsp;in&nbsp;out&nbsp;with&nbsp;a&nbsp;mask&nbsp;generated&nbsp;using&nbsp;the&nbsp;MGF1&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="4134485">//&nbsp;specified&nbsp;in&nbsp;PKCS#1&nbsp;v2.1.</span><br>
<span class="lineno">255</span><span class="keyword" id="4134514">func</span>&nbsp;<span class="ident" id="4134519">mgf1XOR</span><span class="op" id="4134526">(</span><span class="ident" id="4134527">out</span>&nbsp;<span class="op" id="4134531">[</span><span class="op" id="4134532">]</span><span class="builtintype" id="4134533">byte</span><span class="op" id="4134537">,</span>&nbsp;<span class="ident" id="4134539">hash</span>&nbsp;<span class="ident" id="4134544"><a href="/crypto/rsa/rsa.go.html#4127231">hash</a></span><span class="op" id="4134548">.</span><span class="ident" id="4134549">Hash</span><span class="op" id="4134553">,</span>&nbsp;<span class="ident" id="4134555">seed</span>&nbsp;<span class="op" id="4134560">[</span><span class="op" id="4134561">]</span><span class="builtintype" id="4134562">byte</span><span class="op" id="4134566">)</span>&nbsp;<span class="op" id="4134568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4134571">var</span>&nbsp;<span class="ident" id="4134575">counter</span>&nbsp;<span class="op" id="4134583">[</span><span class="num" id="4134584">4</span><span class="op" id="4134585">]</span><span class="builtintype" id="4134586">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4134592">var</span>&nbsp;<span class="ident" id="4134596">digest</span>&nbsp;<span class="op" id="4134603">[</span><span class="op" id="4134604">]</span><span class="builtintype" id="4134605">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134612">done</span>&nbsp;<span class="op" id="4134617">:=</span>&nbsp;<span class="num" id="4134620">0</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4134623">for</span>&nbsp;<span class="ident" id="4134627"><a href="/crypto/rsa/rsa.go.html#4134612">done</a></span>&nbsp;<span class="op" id="4134632">&lt;</span>&nbsp;<span class="builtinfunc" id="4134634">len</span><span class="op" id="4134637">(</span><span class="ident" id="4134638"><a href="/crypto/rsa/rsa.go.html#4134527">out</a></span><span class="op" id="4134641">)</span>&nbsp;<span class="op" id="4134643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134647"><a href="/crypto/rsa/rsa.go.html#4134539">hash</a></span><span class="op" id="4134651">.</span><span class="ident" id="4134652">Write</span><span class="op" id="4134657">(</span><span class="ident" id="4134658"><a href="/crypto/rsa/rsa.go.html#4134555">seed</a></span><span class="op" id="4134662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134666"><a href="/crypto/rsa/rsa.go.html#4134539">hash</a></span><span class="op" id="4134670">.</span><span class="ident" id="4134671">Write</span><span class="op" id="4134676">(</span><span class="ident" id="4134677"><a href="/crypto/rsa/rsa.go.html#4134575">counter</a></span><span class="op" id="4134684">[</span><span class="num" id="4134685">0</span><span class="op" id="4134686">:</span><span class="num" id="4134687">4</span><span class="op" id="4134688">]</span><span class="op" id="4134689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134693"><a href="/crypto/rsa/rsa.go.html#4134596">digest</a></span>&nbsp;<span class="op" id="4134700">=</span>&nbsp;<span class="ident" id="4134702"><a href="/crypto/rsa/rsa.go.html#4134539">hash</a></span><span class="op" id="4134706">.</span><span class="ident" id="4134707">Sum</span><span class="op" id="4134710">(</span><span class="ident" id="4134711"><a href="/crypto/rsa/rsa.go.html#4134596">digest</a></span><span class="op" id="4134717">[</span><span class="op" id="4134718">:</span><span class="num" id="4134719">0</span><span class="op" id="4134720">]</span><span class="op" id="4134721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134725"><a href="/crypto/rsa/rsa.go.html#4134539">hash</a></span><span class="op" id="4134729">.</span><span class="ident" id="4134730">Reset</span><span class="op" id="4134735">(</span><span class="op" id="4134736">)</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4134741">for</span>&nbsp;<span class="ident" id="4134745">i</span>&nbsp;<span class="op" id="4134747">:=</span>&nbsp;<span class="num" id="4134750">0</span><span class="op" id="4134751">;</span>&nbsp;<span class="ident" id="4134753"><a href="/crypto/rsa/rsa.go.html#4134745">i</a></span>&nbsp;<span class="op" id="4134755">&lt;</span>&nbsp;<span class="builtinfunc" id="4134757">len</span><span class="op" id="4134760">(</span><span class="ident" id="4134761"><a href="/crypto/rsa/rsa.go.html#4134596">digest</a></span><span class="op" id="4134767">)</span>&nbsp;<span class="op" id="4134769">&amp;&amp;</span>&nbsp;<span class="ident" id="4134772"><a href="/crypto/rsa/rsa.go.html#4134612">done</a></span>&nbsp;<span class="op" id="4134777">&lt;</span>&nbsp;<span class="builtinfunc" id="4134779">len</span><span class="op" id="4134782">(</span><span class="ident" id="4134783"><a href="/crypto/rsa/rsa.go.html#4134527">out</a></span><span class="op" id="4134786">)</span><span class="op" id="4134787">;</span>&nbsp;<span class="ident" id="4134789"><a href="/crypto/rsa/rsa.go.html#4134745">i</a></span><span class="op" id="4134790">++</span>&nbsp;<span class="op" id="4134793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134798"><a href="/crypto/rsa/rsa.go.html#4134527">out</a></span><span class="op" id="4134801">[</span><span class="ident" id="4134802"><a href="/crypto/rsa/rsa.go.html#4134612">done</a></span><span class="op" id="4134806">]</span>&nbsp;<span class="op" id="4134808">^=</span>&nbsp;<span class="ident" id="4134811"><a href="/crypto/rsa/rsa.go.html#4134596">digest</a></span><span class="op" id="4134817">[</span><span class="ident" id="4134818"><a href="/crypto/rsa/rsa.go.html#4134745">i</a></span><span class="op" id="4134819">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134824"><a href="/crypto/rsa/rsa.go.html#4134612">done</a></span><span class="op" id="4134828">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4134833">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134837"><a href="/crypto/rsa/rsa.go.html#4134262">incCounter</a></span><span class="op" id="4134847">(</span><span class="op" id="4134848">&amp;</span><span class="ident" id="4134849"><a href="/crypto/rsa/rsa.go.html#4134575">counter</a></span><span class="op" id="4134856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4134859">}</span><br>
<span class="lineno"></span><span class="op" id="4134861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4134864">//&nbsp;ErrMessageTooLong&nbsp;is&nbsp;returned&nbsp;when&nbsp;attempting&nbsp;to&nbsp;encrypt&nbsp;a&nbsp;message&nbsp;which&nbsp;is</span><br>
<span class="lineno">275</span><span class="comment" id="4134943">//&nbsp;too&nbsp;large&nbsp;for&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;public&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4134988">var</span>&nbsp;<span class="ident" id="4134992">ErrMessageTooLong</span>&nbsp;<span class="op" id="4135010">=</span>&nbsp;<span class="ident" id="4135012"><a href="/crypto/rsa/rsa.go.html#4127221">errors</a></span><span class="op" id="4135018">.</span><span class="ident" id="4135019">New</span><span class="op" id="4135022">(</span><span class="string" id="4135023">&#34;crypto/rsa:&nbsp;message&nbsp;too&nbsp;long&nbsp;for&nbsp;RSA&nbsp;public&nbsp;key&nbsp;size&#34;</span><span class="op" id="4135077">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4135080">func</span>&nbsp;<span class="ident" id="4135085">encrypt</span><span class="op" id="4135092">(</span><span class="ident" id="4135093">c</span>&nbsp;<span class="op" id="4135095">*</span><span class="ident" id="4135096"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4135099">.</span><span class="ident" id="4135100">Int</span><span class="op" id="4135103">,</span>&nbsp;<span class="ident" id="4135105">pub</span>&nbsp;<span class="op" id="4135109">*</span><span class="ident" id="4135110"><a href="/crypto/rsa/rsa.go.html#4127377">PublicKey</a></span><span class="op" id="4135119">,</span>&nbsp;<span class="ident" id="4135121">m</span>&nbsp;<span class="op" id="4135123">*</span><span class="ident" id="4135124"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4135127">.</span><span class="ident" id="4135128">Int</span><span class="op" id="4135131">)</span>&nbsp;<span class="op" id="4135133">*</span><span class="ident" id="4135134"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4135137">.</span><span class="ident" id="4135138">Int</span>&nbsp;<span class="op" id="4135142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135145">e</span>&nbsp;<span class="op" id="4135147">:=</span>&nbsp;<span class="ident" id="4135150"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4135153">.</span><span class="ident" id="4135154">NewInt</span><span class="op" id="4135160">(</span><span class="ident" id="4135161">int64</span><span class="op" id="4135166">(</span><span class="ident" id="4135167"><a href="/crypto/rsa/rsa.go.html#4135105">pub</a></span><span class="op" id="4135170">.</span><span class="ident" id="4135171">E</span><span class="op" id="4135172">)</span><span class="op" id="4135173">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135176"><a href="/crypto/rsa/rsa.go.html#4135093">c</a></span><span class="op" id="4135177">.</span><span class="ident" id="4135178">Exp</span><span class="op" id="4135181">(</span><span class="ident" id="4135182"><a href="/crypto/rsa/rsa.go.html#4135121">m</a></span><span class="op" id="4135183">,</span>&nbsp;<span class="ident" id="4135185"><a href="/crypto/rsa/rsa.go.html#4135145">e</a></span><span class="op" id="4135186">,</span>&nbsp;<span class="ident" id="4135188"><a href="/crypto/rsa/rsa.go.html#4135105">pub</a></span><span class="op" id="4135191">.</span><span class="ident" id="4135192">N</span><span class="op" id="4135193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4135196">return</span>&nbsp;<span class="ident" id="4135203"><a href="/crypto/rsa/rsa.go.html#4135093">c</a></span><br>
<span class="lineno"></span><span class="op" id="4135205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4135208">//&nbsp;EncryptOAEP&nbsp;encrypts&nbsp;the&nbsp;given&nbsp;message&nbsp;with&nbsp;RSA-OAEP.</span><br>
<span class="lineno">285</span><span class="comment" id="4135265">//&nbsp;The&nbsp;message&nbsp;must&nbsp;be&nbsp;no&nbsp;longer&nbsp;than&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;public&nbsp;modulus&nbsp;less</span><br>
<span class="lineno"></span><span class="comment" id="4135341">//&nbsp;twice&nbsp;the&nbsp;hash&nbsp;length&nbsp;plus&nbsp;2.</span><br>
<span class="lineno"></span><span class="keyword" id="4135374">func</span>&nbsp;<span class="ident" id="4135379">EncryptOAEP</span><span class="op" id="4135390">(</span><span class="ident" id="4135391">hash</span>&nbsp;<span class="ident" id="4135396"><a href="/crypto/rsa/rsa.go.html#4127231">hash</a></span><span class="op" id="4135400">.</span><span class="ident" id="4135401">Hash</span><span class="op" id="4135405">,</span>&nbsp;<span class="ident" id="4135407">random</span>&nbsp;<span class="ident" id="4135414"><a href="/crypto/rsa/rsa.go.html#4127239">io</a></span><span class="op" id="4135416">.</span><span class="ident" id="4135417">Reader</span><span class="op" id="4135423">,</span>&nbsp;<span class="ident" id="4135425">pub</span>&nbsp;<span class="op" id="4135429">*</span><span class="ident" id="4135430"><a href="/crypto/rsa/rsa.go.html#4127377">PublicKey</a></span><span class="op" id="4135439">,</span>&nbsp;<span class="ident" id="4135441">msg</span>&nbsp;<span class="op" id="4135445">[</span><span class="op" id="4135446">]</span><span class="builtintype" id="4135447">byte</span><span class="op" id="4135451">,</span>&nbsp;<span class="ident" id="4135453">label</span>&nbsp;<span class="op" id="4135459">[</span><span class="op" id="4135460">]</span><span class="builtintype" id="4135461">byte</span><span class="op" id="4135465">)</span>&nbsp;<span class="op" id="4135467">(</span><span class="ident" id="4135468">out</span>&nbsp;<span class="op" id="4135472">[</span><span class="op" id="4135473">]</span><span class="builtintype" id="4135474">byte</span><span class="op" id="4135478">,</span>&nbsp;<span class="ident" id="4135480">err</span>&nbsp;<span class="builtintype" id="4135484">error</span><span class="op" id="4135489">)</span>&nbsp;<span class="op" id="4135491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4135494">if</span>&nbsp;<span class="ident" id="4135497">err</span>&nbsp;<span class="op" id="4135501">:=</span>&nbsp;<span class="ident" id="4135504"><a href="/crypto/rsa/rsa.go.html#4127961">checkPub</a></span><span class="op" id="4135512">(</span><span class="ident" id="4135513"><a href="/crypto/rsa/rsa.go.html#4135425">pub</a></span><span class="op" id="4135516">)</span><span class="op" id="4135517">;</span>&nbsp;<span class="ident" id="4135519"><a href="/crypto/rsa/rsa.go.html#4135497">err</a></span>&nbsp;<span class="op" id="4135523">!=</span>&nbsp;<span class="ident" id="4135526">nil</span>&nbsp;<span class="op" id="4135530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4135534">return</span>&nbsp;<span class="ident" id="4135541">nil</span><span class="op" id="4135544">,</span>&nbsp;<span class="ident" id="4135546"><a href="/crypto/rsa/rsa.go.html#4135497">err</a></span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4135551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135554"><a href="/crypto/rsa/rsa.go.html#4135391">hash</a></span><span class="op" id="4135558">.</span><span class="ident" id="4135559">Reset</span><span class="op" id="4135564">(</span><span class="op" id="4135565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135568">k</span>&nbsp;<span class="op" id="4135570">:=</span>&nbsp;<span class="op" id="4135573">(</span><span class="ident" id="4135574"><a href="/crypto/rsa/rsa.go.html#4135425">pub</a></span><span class="op" id="4135577">.</span><span class="ident" id="4135578">N</span><span class="op" id="4135579">.</span><span class="ident" id="4135580">BitLen</span><span class="op" id="4135586">(</span><span class="op" id="4135587">)</span>&nbsp;<span class="op" id="4135589">+</span>&nbsp;<span class="num" id="4135591">7</span><span class="op" id="4135592">)</span>&nbsp;<span class="op" id="4135594">/</span>&nbsp;<span class="num" id="4135596">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4135599">if</span>&nbsp;<span class="builtinfunc" id="4135602">len</span><span class="op" id="4135605">(</span><span class="ident" id="4135606"><a href="/crypto/rsa/rsa.go.html#4135441">msg</a></span><span class="op" id="4135609">)</span>&nbsp;<span class="op" id="4135611">&gt;</span>&nbsp;<span class="ident" id="4135613"><a href="/crypto/rsa/rsa.go.html#4135568">k</a></span><span class="op" id="4135614">-</span><span class="num" id="4135615">2</span><span class="op" id="4135616">*</span><span class="ident" id="4135617"><a href="/crypto/rsa/rsa.go.html#4135391">hash</a></span><span class="op" id="4135621">.</span><span class="ident" id="4135622">Size</span><span class="op" id="4135626">(</span><span class="op" id="4135627">)</span><span class="op" id="4135628">-</span><span class="num" id="4135629">2</span>&nbsp;<span class="op" id="4135631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135635"><a href="/crypto/rsa/rsa.go.html#4135480">err</a></span>&nbsp;<span class="op" id="4135639">=</span>&nbsp;<span class="ident" id="4135641"><a href="/crypto/rsa/rsa.go.html#4134992">ErrMessageTooLong</a></span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4135661">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4135669">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135673"><a href="/crypto/rsa/rsa.go.html#4135391">hash</a></span><span class="op" id="4135677">.</span><span class="ident" id="4135678">Write</span><span class="op" id="4135683">(</span><span class="ident" id="4135684"><a href="/crypto/rsa/rsa.go.html#4135453">label</a></span><span class="op" id="4135689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135692">lHash</span>&nbsp;<span class="op" id="4135698">:=</span>&nbsp;<span class="ident" id="4135701"><a href="/crypto/rsa/rsa.go.html#4135391">hash</a></span><span class="op" id="4135705">.</span><span class="ident" id="4135706">Sum</span><span class="op" id="4135709">(</span><span class="ident" id="4135710">nil</span><span class="op" id="4135713">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135716"><a href="/crypto/rsa/rsa.go.html#4135391">hash</a></span><span class="op" id="4135720">.</span><span class="ident" id="4135721">Reset</span><span class="op" id="4135726">(</span><span class="op" id="4135727">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135731">em</span>&nbsp;<span class="op" id="4135734">:=</span>&nbsp;<span class="builtinfunc" id="4135737">make</span><span class="op" id="4135741">(</span><span class="op" id="4135742">[</span><span class="op" id="4135743">]</span><span class="builtintype" id="4135744">byte</span><span class="op" id="4135748">,</span>&nbsp;<span class="ident" id="4135750"><a href="/crypto/rsa/rsa.go.html#4135568">k</a></span><span class="op" id="4135751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135754">seed</span>&nbsp;<span class="op" id="4135759">:=</span>&nbsp;<span class="ident" id="4135762"><a href="/crypto/rsa/rsa.go.html#4135731">em</a></span><span class="op" id="4135764">[</span><span class="num" id="4135765">1</span>&nbsp;<span class="op" id="4135767">:</span>&nbsp;<span class="num" id="4135769">1</span><span class="op" id="4135770">+</span><span class="ident" id="4135771"><a href="/crypto/rsa/rsa.go.html#4135391">hash</a></span><span class="op" id="4135775">.</span><span class="ident" id="4135776">Size</span><span class="op" id="4135780">(</span><span class="op" id="4135781">)</span><span class="op" id="4135782">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135785">db</span>&nbsp;<span class="op" id="4135788">:=</span>&nbsp;<span class="ident" id="4135791"><a href="/crypto/rsa/rsa.go.html#4135731">em</a></span><span class="op" id="4135793">[</span><span class="num" id="4135794">1</span><span class="op" id="4135795">+</span><span class="ident" id="4135796"><a href="/crypto/rsa/rsa.go.html#4135391">hash</a></span><span class="op" id="4135800">.</span><span class="ident" id="4135801">Size</span><span class="op" id="4135805">(</span><span class="op" id="4135806">)</span><span class="op" id="4135807">:</span><span class="op" id="4135808">]</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4135812">copy</span><span class="op" id="4135816">(</span><span class="ident" id="4135817"><a href="/crypto/rsa/rsa.go.html#4135785">db</a></span><span class="op" id="4135819">[</span><span class="num" id="4135820">0</span><span class="op" id="4135821">:</span><span class="ident" id="4135822"><a href="/crypto/rsa/rsa.go.html#4135391">hash</a></span><span class="op" id="4135826">.</span><span class="ident" id="4135827">Size</span><span class="op" id="4135831">(</span><span class="op" id="4135832">)</span><span class="op" id="4135833">]</span><span class="op" id="4135834">,</span>&nbsp;<span class="ident" id="4135836"><a href="/crypto/rsa/rsa.go.html#4135692">lHash</a></span><span class="op" id="4135841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135844"><a href="/crypto/rsa/rsa.go.html#4135785">db</a></span><span class="op" id="4135846">[</span><span class="builtinfunc" id="4135847">len</span><span class="op" id="4135850">(</span><span class="ident" id="4135851"><a href="/crypto/rsa/rsa.go.html#4135785">db</a></span><span class="op" id="4135853">)</span><span class="op" id="4135854">-</span><span class="builtinfunc" id="4135855">len</span><span class="op" id="4135858">(</span><span class="ident" id="4135859"><a href="/crypto/rsa/rsa.go.html#4135441">msg</a></span><span class="op" id="4135862">)</span><span class="op" id="4135863">-</span><span class="num" id="4135864">1</span><span class="op" id="4135865">]</span>&nbsp;<span class="op" id="4135867">=</span>&nbsp;<span class="num" id="4135869">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4135872">copy</span><span class="op" id="4135876">(</span><span class="ident" id="4135877"><a href="/crypto/rsa/rsa.go.html#4135785">db</a></span><span class="op" id="4135879">[</span><span class="builtinfunc" id="4135880">len</span><span class="op" id="4135883">(</span><span class="ident" id="4135884"><a href="/crypto/rsa/rsa.go.html#4135785">db</a></span><span class="op" id="4135886">)</span><span class="op" id="4135887">-</span><span class="builtinfunc" id="4135888">len</span><span class="op" id="4135891">(</span><span class="ident" id="4135892"><a href="/crypto/rsa/rsa.go.html#4135441">msg</a></span><span class="op" id="4135895">)</span><span class="op" id="4135896">:</span><span class="op" id="4135897">]</span><span class="op" id="4135898">,</span>&nbsp;<span class="ident" id="4135900"><a href="/crypto/rsa/rsa.go.html#4135441">msg</a></span><span class="op" id="4135903">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135907">_</span><span class="op" id="4135908">,</span>&nbsp;<span class="ident" id="4135910"><a href="/crypto/rsa/rsa.go.html#4135480">err</a></span>&nbsp;<span class="op" id="4135914">=</span>&nbsp;<span class="ident" id="4135916"><a href="/crypto/rsa/rsa.go.html#4127239">io</a></span><span class="op" id="4135918">.</span><span class="ident" id="4135919">ReadFull</span><span class="op" id="4135927">(</span><span class="ident" id="4135928"><a href="/crypto/rsa/rsa.go.html#4135407">random</a></span><span class="op" id="4135934">,</span>&nbsp;<span class="ident" id="4135936"><a href="/crypto/rsa/rsa.go.html#4135754">seed</a></span><span class="op" id="4135940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4135943">if</span>&nbsp;<span class="ident" id="4135946"><a href="/crypto/rsa/rsa.go.html#4135480">err</a></span>&nbsp;<span class="op" id="4135950">!=</span>&nbsp;<span class="ident" id="4135953">nil</span>&nbsp;<span class="op" id="4135957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4135961">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4135969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135973"><a href="/crypto/rsa/rsa.go.html#4134519">mgf1XOR</a></span><span class="op" id="4135980">(</span><span class="ident" id="4135981"><a href="/crypto/rsa/rsa.go.html#4135785">db</a></span><span class="op" id="4135983">,</span>&nbsp;<span class="ident" id="4135985"><a href="/crypto/rsa/rsa.go.html#4135391">hash</a></span><span class="op" id="4135989">,</span>&nbsp;<span class="ident" id="4135991"><a href="/crypto/rsa/rsa.go.html#4135754">seed</a></span><span class="op" id="4135995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135998"><a href="/crypto/rsa/rsa.go.html#4134519">mgf1XOR</a></span><span class="op" id="4136005">(</span><span class="ident" id="4136006"><a href="/crypto/rsa/rsa.go.html#4135754">seed</a></span><span class="op" id="4136010">,</span>&nbsp;<span class="ident" id="4136012"><a href="/crypto/rsa/rsa.go.html#4135391">hash</a></span><span class="op" id="4136016">,</span>&nbsp;<span class="ident" id="4136018"><a href="/crypto/rsa/rsa.go.html#4135785">db</a></span><span class="op" id="4136020">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136024">m</span>&nbsp;<span class="op" id="4136026">:=</span>&nbsp;<span class="builtinfunc" id="4136029">new</span><span class="op" id="4136032">(</span><span class="ident" id="4136033"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4136036">.</span><span class="ident" id="4136037">Int</span><span class="op" id="4136040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136043"><a href="/crypto/rsa/rsa.go.html#4136024">m</a></span><span class="op" id="4136044">.</span><span class="ident" id="4136045">SetBytes</span><span class="op" id="4136053">(</span><span class="ident" id="4136054"><a href="/crypto/rsa/rsa.go.html#4135731">em</a></span><span class="op" id="4136056">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136059">c</span>&nbsp;<span class="op" id="4136061">:=</span>&nbsp;<span class="ident" id="4136064"><a href="/crypto/rsa/rsa.go.html#4135085">encrypt</a></span><span class="op" id="4136071">(</span><span class="builtinfunc" id="4136072">new</span><span class="op" id="4136075">(</span><span class="ident" id="4136076"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4136079">.</span><span class="ident" id="4136080">Int</span><span class="op" id="4136083">)</span><span class="op" id="4136084">,</span>&nbsp;<span class="ident" id="4136086"><a href="/crypto/rsa/rsa.go.html#4135425">pub</a></span><span class="op" id="4136089">,</span>&nbsp;<span class="ident" id="4136091"><a href="/crypto/rsa/rsa.go.html#4136024">m</a></span><span class="op" id="4136092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136095"><a href="/crypto/rsa/rsa.go.html#4135468">out</a></span>&nbsp;<span class="op" id="4136099">=</span>&nbsp;<span class="ident" id="4136101"><a href="/crypto/rsa/rsa.go.html#4136059">c</a></span><span class="op" id="4136102">.</span><span class="ident" id="4136103">Bytes</span><span class="op" id="4136108">(</span><span class="op" id="4136109">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4136113">if</span>&nbsp;<span class="builtinfunc" id="4136116">len</span><span class="op" id="4136119">(</span><span class="ident" id="4136120"><a href="/crypto/rsa/rsa.go.html#4135468">out</a></span><span class="op" id="4136123">)</span>&nbsp;<span class="op" id="4136125">&lt;</span>&nbsp;<span class="ident" id="4136127"><a href="/crypto/rsa/rsa.go.html#4135568">k</a></span>&nbsp;<span class="op" id="4136129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4136133">//&nbsp;If&nbsp;the&nbsp;output&nbsp;is&nbsp;too&nbsp;small,&nbsp;we&nbsp;need&nbsp;to&nbsp;left-pad&nbsp;with&nbsp;zeros.</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136198">t</span>&nbsp;<span class="op" id="4136200">:=</span>&nbsp;<span class="builtinfunc" id="4136203">make</span><span class="op" id="4136207">(</span><span class="op" id="4136208">[</span><span class="op" id="4136209">]</span><span class="builtintype" id="4136210">byte</span><span class="op" id="4136214">,</span>&nbsp;<span class="ident" id="4136216"><a href="/crypto/rsa/rsa.go.html#4135568">k</a></span><span class="op" id="4136217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4136221">copy</span><span class="op" id="4136225">(</span><span class="ident" id="4136226"><a href="/crypto/rsa/rsa.go.html#4136198">t</a></span><span class="op" id="4136227">[</span><span class="ident" id="4136228"><a href="/crypto/rsa/rsa.go.html#4135568">k</a></span><span class="op" id="4136229">-</span><span class="builtinfunc" id="4136230">len</span><span class="op" id="4136233">(</span><span class="ident" id="4136234"><a href="/crypto/rsa/rsa.go.html#4135468">out</a></span><span class="op" id="4136237">)</span><span class="op" id="4136238">:</span><span class="op" id="4136239">]</span><span class="op" id="4136240">,</span>&nbsp;<span class="ident" id="4136242"><a href="/crypto/rsa/rsa.go.html#4135468">out</a></span><span class="op" id="4136245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136249"><a href="/crypto/rsa/rsa.go.html#4135468">out</a></span>&nbsp;<span class="op" id="4136253">=</span>&nbsp;<span class="ident" id="4136255"><a href="/crypto/rsa/rsa.go.html#4136198">t</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4136258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4136262">return</span><br>
<span class="lineno"></span><span class="op" id="4136269">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4136272">//&nbsp;ErrDecryption&nbsp;represents&nbsp;a&nbsp;failure&nbsp;to&nbsp;decrypt&nbsp;a&nbsp;message.</span><br>
<span class="lineno"></span><span class="comment" id="4136332">//&nbsp;It&nbsp;is&nbsp;deliberately&nbsp;vague&nbsp;to&nbsp;avoid&nbsp;adaptive&nbsp;attacks.</span><br>
<span class="lineno">335</span><span class="keyword" id="4136387">var</span>&nbsp;<span class="ident" id="4136391">ErrDecryption</span>&nbsp;<span class="op" id="4136405">=</span>&nbsp;<span class="ident" id="4136407"><a href="/crypto/rsa/rsa.go.html#4127221">errors</a></span><span class="op" id="4136413">.</span><span class="ident" id="4136414">New</span><span class="op" id="4136417">(</span><span class="string" id="4136418">&#34;crypto/rsa:&nbsp;decryption&nbsp;error&#34;</span><span class="op" id="4136448">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4136451">//&nbsp;ErrVerification&nbsp;represents&nbsp;a&nbsp;failure&nbsp;to&nbsp;verify&nbsp;a&nbsp;signature.</span><br>
<span class="lineno"></span><span class="comment" id="4136514">//&nbsp;It&nbsp;is&nbsp;deliberately&nbsp;vague&nbsp;to&nbsp;avoid&nbsp;adaptive&nbsp;attacks.</span><br>
<span class="lineno"></span><span class="keyword" id="4136569">var</span>&nbsp;<span class="ident" id="4136573">ErrVerification</span>&nbsp;<span class="op" id="4136589">=</span>&nbsp;<span class="ident" id="4136591"><a href="/crypto/rsa/rsa.go.html#4127221">errors</a></span><span class="op" id="4136597">.</span><span class="ident" id="4136598">New</span><span class="op" id="4136601">(</span><span class="string" id="4136602">&#34;crypto/rsa:&nbsp;verification&nbsp;error&#34;</span><span class="op" id="4136634">)</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span><span class="comment" id="4136637">//&nbsp;modInverse&nbsp;returns&nbsp;ia,&nbsp;the&nbsp;inverse&nbsp;of&nbsp;a&nbsp;in&nbsp;the&nbsp;multiplicative&nbsp;group&nbsp;of&nbsp;prime</span><br>
<span class="lineno"></span><span class="comment" id="4136717">//&nbsp;order&nbsp;n.&nbsp;It&nbsp;requires&nbsp;that&nbsp;a&nbsp;be&nbsp;a&nbsp;member&nbsp;of&nbsp;the&nbsp;group&nbsp;(i.e.&nbsp;less&nbsp;than&nbsp;n).</span><br>
<span class="lineno"></span><span class="keyword" id="4136793">func</span>&nbsp;<span class="ident" id="4136798">modInverse</span><span class="op" id="4136808">(</span><span class="ident" id="4136809">a</span><span class="op" id="4136810">,</span>&nbsp;<span class="ident" id="4136812">n</span>&nbsp;<span class="op" id="4136814">*</span><span class="ident" id="4136815"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4136818">.</span><span class="ident" id="4136819">Int</span><span class="op" id="4136822">)</span>&nbsp;<span class="op" id="4136824">(</span><span class="ident" id="4136825">ia</span>&nbsp;<span class="op" id="4136828">*</span><span class="ident" id="4136829"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4136832">.</span><span class="ident" id="4136833">Int</span><span class="op" id="4136836">,</span>&nbsp;<span class="ident" id="4136838">ok</span>&nbsp;<span class="builtintype" id="4136841">bool</span><span class="op" id="4136845">)</span>&nbsp;<span class="op" id="4136847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136850">g</span>&nbsp;<span class="op" id="4136852">:=</span>&nbsp;<span class="builtinfunc" id="4136855">new</span><span class="op" id="4136858">(</span><span class="ident" id="4136859"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4136862">.</span><span class="ident" id="4136863">Int</span><span class="op" id="4136866">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136869">x</span>&nbsp;<span class="op" id="4136871">:=</span>&nbsp;<span class="builtinfunc" id="4136874">new</span><span class="op" id="4136877">(</span><span class="ident" id="4136878"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4136881">.</span><span class="ident" id="4136882">Int</span><span class="op" id="4136885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136888">y</span>&nbsp;<span class="op" id="4136890">:=</span>&nbsp;<span class="builtinfunc" id="4136893">new</span><span class="op" id="4136896">(</span><span class="ident" id="4136897"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4136900">.</span><span class="ident" id="4136901">Int</span><span class="op" id="4136904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136907"><a href="/crypto/rsa/rsa.go.html#4136850">g</a></span><span class="op" id="4136908">.</span><span class="ident" id="4136909">GCD</span><span class="op" id="4136912">(</span><span class="ident" id="4136913"><a href="/crypto/rsa/rsa.go.html#4136869">x</a></span><span class="op" id="4136914">,</span>&nbsp;<span class="ident" id="4136916"><a href="/crypto/rsa/rsa.go.html#4136888">y</a></span><span class="op" id="4136917">,</span>&nbsp;<span class="ident" id="4136919"><a href="/crypto/rsa/rsa.go.html#4136809">a</a></span><span class="op" id="4136920">,</span>&nbsp;<span class="ident" id="4136922"><a href="/crypto/rsa/rsa.go.html#4136812">n</a></span><span class="op" id="4136923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4136926">if</span>&nbsp;<span class="ident" id="4136929"><a href="/crypto/rsa/rsa.go.html#4136850">g</a></span><span class="op" id="4136930">.</span><span class="ident" id="4136931">Cmp</span><span class="op" id="4136934">(</span><span class="ident" id="4136935"><a href="/crypto/rsa/rsa.go.html#4127291">bigOne</a></span><span class="op" id="4136941">)</span>&nbsp;<span class="op" id="4136943">!=</span>&nbsp;<span class="num" id="4136946">0</span>&nbsp;<span class="op" id="4136948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4136952">//&nbsp;In&nbsp;this&nbsp;case,&nbsp;a&nbsp;and&nbsp;n&nbsp;aren&#39;t&nbsp;coprime&nbsp;and&nbsp;we&nbsp;cannot&nbsp;calculate</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4137018">//&nbsp;the&nbsp;inverse.&nbsp;This&nbsp;happens&nbsp;because&nbsp;the&nbsp;values&nbsp;of&nbsp;n&nbsp;are&nbsp;nearly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4137084">//&nbsp;prime&nbsp;(being&nbsp;the&nbsp;product&nbsp;of&nbsp;two&nbsp;primes)&nbsp;rather&nbsp;than&nbsp;truly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4137147">//&nbsp;prime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4137159">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4137167">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4137171">if</span>&nbsp;<span class="ident" id="4137174"><a href="/crypto/rsa/rsa.go.html#4136869">x</a></span><span class="op" id="4137175">.</span><span class="ident" id="4137176">Cmp</span><span class="op" id="4137179">(</span><span class="ident" id="4137180"><a href="/crypto/rsa/rsa.go.html#4127291">bigOne</a></span><span class="op" id="4137186">)</span>&nbsp;<span class="op" id="4137188">&lt;</span>&nbsp;<span class="num" id="4137190">0</span>&nbsp;<span class="op" id="4137192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4137196">//&nbsp;0&nbsp;is&nbsp;not&nbsp;the&nbsp;multiplicative&nbsp;inverse&nbsp;of&nbsp;any&nbsp;element&nbsp;so,&nbsp;if&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4137261">//&nbsp;&lt;&nbsp;1,&nbsp;then&nbsp;x&nbsp;is&nbsp;negative.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4137291"><a href="/crypto/rsa/rsa.go.html#4136869">x</a></span><span class="op" id="4137292">.</span><span class="ident" id="4137293">Add</span><span class="op" id="4137296">(</span><span class="ident" id="4137297"><a href="/crypto/rsa/rsa.go.html#4136869">x</a></span><span class="op" id="4137298">,</span>&nbsp;<span class="ident" id="4137300"><a href="/crypto/rsa/rsa.go.html#4136812">n</a></span><span class="op" id="4137301">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4137304">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4137308">return</span>&nbsp;<span class="ident" id="4137315"><a href="/crypto/rsa/rsa.go.html#4136869">x</a></span><span class="op" id="4137316">,</span>&nbsp;<span class="builtintype" id="4137318">true</span><br>
<span class="lineno"></span><span class="op" id="4137323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="4137326">//&nbsp;Precompute&nbsp;performs&nbsp;some&nbsp;calculations&nbsp;that&nbsp;speed&nbsp;up&nbsp;private&nbsp;key&nbsp;operations</span><br>
<span class="lineno"></span><span class="comment" id="4137404">//&nbsp;in&nbsp;the&nbsp;future.</span><br>
<span class="lineno"></span><span class="keyword" id="4137422">func</span>&nbsp;<span class="op" id="4137427">(</span><span class="ident" id="4137428">priv</span>&nbsp;<span class="op" id="4137433">*</span><span class="ident" id="4137434"><a href="/crypto/rsa/rsa.go.html#4128208">PrivateKey</a></span><span class="op" id="4137444">)</span>&nbsp;<span class="ident" id="4137446">Precompute</span><span class="op" id="4137456">(</span><span class="op" id="4137457">)</span>&nbsp;<span class="op" id="4137459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4137462">if</span>&nbsp;<span class="ident" id="4137465"><a href="/crypto/rsa/rsa.go.html#4137428">priv</a></span><span class="op" id="4137469">.</span><span class="ident" id="4137470">Precomputed</span><span class="op" id="4137481">.</span><span class="ident" id="4137482">Dp</span>&nbsp;<span class="op" id="4137485">!=</span>&nbsp;<span class="ident" id="4137488">nil</span>&nbsp;<span class="op" id="4137492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4137496">return</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4137504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4137508"><a href="/crypto/rsa/rsa.go.html#4137428">priv</a></span><span class="op" id="4137512">.</span><span class="ident" id="4137513">Precomputed</span><span class="op" id="4137524">.</span><span class="ident" id="4137525">Dp</span>&nbsp;<span class="op" id="4137528">=</span>&nbsp;<span class="builtinfunc" id="4137530">new</span><span class="op" id="4137533">(</span><span class="ident" id="4137534"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4137537">.</span><span class="ident" id="4137538">Int</span><span class="op" id="4137541">)</span><span class="op" id="4137542">.</span><span class="ident" id="4137543">Sub</span><span class="op" id="4137546">(</span><span class="ident" id="4137547"><a href="/crypto/rsa/rsa.go.html#4137428">priv</a></span><span class="op" id="4137551">.</span><span class="ident" id="4137552">Primes</span><span class="op" id="4137558">[</span><span class="num" id="4137559">0</span><span class="op" id="4137560">]</span><span class="op" id="4137561">,</span>&nbsp;<span class="ident" id="4137563"><a href="/crypto/rsa/rsa.go.html#4127291">bigOne</a></span><span class="op" id="4137569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4137572"><a href="/crypto/rsa/rsa.go.html#4137428">priv</a></span><span class="op" id="4137576">.</span><span class="ident" id="4137577">Precomputed</span><span class="op" id="4137588">.</span><span class="ident" id="4137589">Dp</span><span class="op" id="4137591">.</span><span class="ident" id="4137592">Mod</span><span class="op" id="4137595">(</span><span class="ident" id="4137596"><a href="/crypto/rsa/rsa.go.html#4137428">priv</a></span><span class="op" id="4137600">.</span><span class="ident" id="4137601">D</span><span class="op" id="4137602">,</span>&nbsp;<span class="ident" id="4137604"><a href="/crypto/rsa/rsa.go.html#4137428">priv</a></span><span class="op" id="4137608">.</span><span class="ident" id="4137609">Precomputed</span><span class="op" id="4137620">.</span><span class="ident" id="4137621">Dp</span><span class="op" id="4137623">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4137627"><a href="/crypto/rsa/rsa.go.html#4137428">priv</a></span><span class="op" id="4137631">.</span><span class="ident" id="4137632">Precomputed</span><span class="op" id="4137643">.</span><span class="ident" id="4137644">Dq</span>&nbsp;<span class="op" id="4137647">=</span>&nbsp;<span class="builtinfunc" id="4137649">new</span><span class="op" id="4137652">(</span><span class="ident" id="4137653"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4137656">.</span><span class="ident" id="4137657">Int</span><span class="op" id="4137660">)</span><span class="op" id="4137661">.</span><span class="ident" id="4137662">Sub</span><span class="op" id="4137665">(</span><span class="ident" id="4137666"><a href="/crypto/rsa/rsa.go.html#4137428">priv</a></span><span class="op" id="4137670">.</span><span class="ident" id="4137671">Primes</span><span class="op" id="4137677">[</span><span class="num" id="4137678">1</span><span class="op" id="4137679">]</span><span class="op" id="4137680">,</span>&nbsp;<span class="ident" id="4137682"><a href="/crypto/rsa/rsa.go.html#4127291">bigOne</a></span><span class="op" id="4137688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4137691"><a href="/crypto/rsa/rsa.go.html#4137428">priv</a></span><span class="op" id="4137695">.</span><span class="ident" id="4137696">Precomputed</span><span class="op" id="4137707">.</span><span class="ident" id="4137708">Dq</span><span class="op" id="4137710">.</span><span class="ident" id="4137711">Mod</span><span class="op" id="4137714">(</span><span class="ident" id="4137715"><a href="/crypto/rsa/rsa.go.html#4137428">priv</a></span><span class="op" id="4137719">.</span><span class="ident" id="4137720">D</span><span class="op" id="4137721">,</span>&nbsp;<span class="ident" id="4137723"><a href="/crypto/rsa/rsa.go.html#4137428">priv</a></span><span class="op" id="4137727">.</span><span class="ident" id="4137728">Precomputed</span><span class="op" id="4137739">.</span><span class="ident" id="4137740">Dq</span><span class="op" id="4137742">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4137746"><a href="/crypto/rsa/rsa.go.html#4137428">priv</a></span><span class="op" id="4137750">.</span><span class="ident" id="4137751">Precomputed</span><span class="op" id="4137762">.</span><span class="ident" id="4137763">Qinv</span>&nbsp;<span class="op" id="4137768">=</span>&nbsp;<span class="builtinfunc" id="4137770">new</span><span class="op" id="4137773">(</span><span class="ident" id="4137774"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4137777">.</span><span class="ident" id="4137778">Int</span><span class="op" id="4137781">)</span><span class="op" id="4137782">.</span><span class="ident" id="4137783">ModInverse</span><span class="op" id="4137793">(</span><span class="ident" id="4137794"><a href="/crypto/rsa/rsa.go.html#4137428">priv</a></span><span class="op" id="4137798">.</span><span class="ident" id="4137799">Primes</span><span class="op" id="4137805">[</span><span class="num" id="4137806">1</span><span class="op" id="4137807">]</span><span class="op" id="4137808">,</span>&nbsp;<span class="ident" id="4137810"><a href="/crypto/rsa/rsa.go.html#4137428">priv</a></span><span class="op" id="4137814">.</span><span class="ident" id="4137815">Primes</span><span class="op" id="4137821">[</span><span class="num" id="4137822">0</span><span class="op" id="4137823">]</span><span class="op" id="4137824">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4137828">r</span>&nbsp;<span class="op" id="4137830">:=</span>&nbsp;<span class="builtinfunc" id="4137833">new</span><span class="op" id="4137836">(</span><span class="ident" id="4137837"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4137840">.</span><span class="ident" id="4137841">Int</span><span class="op" id="4137844">)</span><span class="op" id="4137845">.</span><span class="ident" id="4137846">Mul</span><span class="op" id="4137849">(</span><span class="ident" id="4137850"><a href="/crypto/rsa/rsa.go.html#4137428">priv</a></span><span class="op" id="4137854">.</span><span class="ident" id="4137855">Primes</span><span class="op" id="4137861">[</span><span class="num" id="4137862">0</span><span class="op" id="4137863">]</span><span class="op" id="4137864">,</span>&nbsp;<span class="ident" id="4137866"><a href="/crypto/rsa/rsa.go.html#4137428">priv</a></span><span class="op" id="4137870">.</span><span class="ident" id="4137871">Primes</span><span class="op" id="4137877">[</span><span class="num" id="4137878">1</span><span class="op" id="4137879">]</span><span class="op" id="4137880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4137883"><a href="/crypto/rsa/rsa.go.html#4137428">priv</a></span><span class="op" id="4137887">.</span><span class="ident" id="4137888">Precomputed</span><span class="op" id="4137899">.</span><span class="ident" id="4137900">CRTValues</span>&nbsp;<span class="op" id="4137910">=</span>&nbsp;<span class="builtinfunc" id="4137912">make</span><span class="op" id="4137916">(</span><span class="op" id="4137917">[</span><span class="op" id="4137918">]</span><span class="ident" id="4137919"><a href="/crypto/rsa/rsa.go.html#4129679">CRTValue</a></span><span class="op" id="4137927">,</span>&nbsp;<span class="builtinfunc" id="4137929">len</span><span class="op" id="4137932">(</span><span class="ident" id="4137933"><a href="/crypto/rsa/rsa.go.html#4137428">priv</a></span><span class="op" id="4137937">.</span><span class="ident" id="4137938">Primes</span><span class="op" id="4137944">)</span><span class="op" id="4137945">-</span><span class="num" id="4137946">2</span><span class="op" id="4137947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4137950">for</span>&nbsp;<span class="ident" id="4137954">i</span>&nbsp;<span class="op" id="4137956">:=</span>&nbsp;<span class="num" id="4137959">2</span><span class="op" id="4137960">;</span>&nbsp;<span class="ident" id="4137962"><a href="/crypto/rsa/rsa.go.html#4137954">i</a></span>&nbsp;<span class="op" id="4137964">&lt;</span>&nbsp;<span class="builtinfunc" id="4137966">len</span><span class="op" id="4137969">(</span><span class="ident" id="4137970"><a href="/crypto/rsa/rsa.go.html#4137428">priv</a></span><span class="op" id="4137974">.</span><span class="ident" id="4137975">Primes</span><span class="op" id="4137981">)</span><span class="op" id="4137982">;</span>&nbsp;<span class="ident" id="4137984"><a href="/crypto/rsa/rsa.go.html#4137954">i</a></span><span class="op" id="4137985">++</span>&nbsp;<span class="op" id="4137988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4137992">prime</span>&nbsp;<span class="op" id="4137998">:=</span>&nbsp;<span class="ident" id="4138001"><a href="/crypto/rsa/rsa.go.html#4137428">priv</a></span><span class="op" id="4138005">.</span><span class="ident" id="4138006">Primes</span><span class="op" id="4138012">[</span><span class="ident" id="4138013"><a href="/crypto/rsa/rsa.go.html#4137954">i</a></span><span class="op" id="4138014">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138018">values</span>&nbsp;<span class="op" id="4138025">:=</span>&nbsp;<span class="op" id="4138028">&amp;</span><span class="ident" id="4138029"><a href="/crypto/rsa/rsa.go.html#4137428">priv</a></span><span class="op" id="4138033">.</span><span class="ident" id="4138034">Precomputed</span><span class="op" id="4138045">.</span><span class="ident" id="4138046">CRTValues</span><span class="op" id="4138055">[</span><span class="ident" id="4138056"><a href="/crypto/rsa/rsa.go.html#4137954">i</a></span><span class="op" id="4138057">-</span><span class="num" id="4138058">2</span><span class="op" id="4138059">]</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138064"><a href="/crypto/rsa/rsa.go.html#4138018">values</a></span><span class="op" id="4138070">.</span><span class="ident" id="4138071">Exp</span>&nbsp;<span class="op" id="4138075">=</span>&nbsp;<span class="builtinfunc" id="4138077">new</span><span class="op" id="4138080">(</span><span class="ident" id="4138081"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4138084">.</span><span class="ident" id="4138085">Int</span><span class="op" id="4138088">)</span><span class="op" id="4138089">.</span><span class="ident" id="4138090">Sub</span><span class="op" id="4138093">(</span><span class="ident" id="4138094"><a href="/crypto/rsa/rsa.go.html#4137992">prime</a></span><span class="op" id="4138099">,</span>&nbsp;<span class="ident" id="4138101"><a href="/crypto/rsa/rsa.go.html#4127291">bigOne</a></span><span class="op" id="4138107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138111"><a href="/crypto/rsa/rsa.go.html#4138018">values</a></span><span class="op" id="4138117">.</span><span class="ident" id="4138118">Exp</span><span class="op" id="4138121">.</span><span class="ident" id="4138122">Mod</span><span class="op" id="4138125">(</span><span class="ident" id="4138126"><a href="/crypto/rsa/rsa.go.html#4137428">priv</a></span><span class="op" id="4138130">.</span><span class="ident" id="4138131">D</span><span class="op" id="4138132">,</span>&nbsp;<span class="ident" id="4138134"><a href="/crypto/rsa/rsa.go.html#4138018">values</a></span><span class="op" id="4138140">.</span><span class="ident" id="4138141">Exp</span><span class="op" id="4138144">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138149"><a href="/crypto/rsa/rsa.go.html#4138018">values</a></span><span class="op" id="4138155">.</span><span class="ident" id="4138156">R</span>&nbsp;<span class="op" id="4138158">=</span>&nbsp;<span class="builtinfunc" id="4138160">new</span><span class="op" id="4138163">(</span><span class="ident" id="4138164"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4138167">.</span><span class="ident" id="4138168">Int</span><span class="op" id="4138171">)</span><span class="op" id="4138172">.</span><span class="ident" id="4138173">Set</span><span class="op" id="4138176">(</span><span class="ident" id="4138177"><a href="/crypto/rsa/rsa.go.html#4137828">r</a></span><span class="op" id="4138178">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138182"><a href="/crypto/rsa/rsa.go.html#4138018">values</a></span><span class="op" id="4138188">.</span><span class="ident" id="4138189">Coeff</span>&nbsp;<span class="op" id="4138195">=</span>&nbsp;<span class="builtinfunc" id="4138197">new</span><span class="op" id="4138200">(</span><span class="ident" id="4138201"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4138204">.</span><span class="ident" id="4138205">Int</span><span class="op" id="4138208">)</span><span class="op" id="4138209">.</span><span class="ident" id="4138210">ModInverse</span><span class="op" id="4138220">(</span><span class="ident" id="4138221"><a href="/crypto/rsa/rsa.go.html#4137828">r</a></span><span class="op" id="4138222">,</span>&nbsp;<span class="ident" id="4138224"><a href="/crypto/rsa/rsa.go.html#4137992">prime</a></span><span class="op" id="4138229">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138234"><a href="/crypto/rsa/rsa.go.html#4137828">r</a></span><span class="op" id="4138235">.</span><span class="ident" id="4138236">Mul</span><span class="op" id="4138239">(</span><span class="ident" id="4138240"><a href="/crypto/rsa/rsa.go.html#4137828">r</a></span><span class="op" id="4138241">,</span>&nbsp;<span class="ident" id="4138243"><a href="/crypto/rsa/rsa.go.html#4137992">prime</a></span><span class="op" id="4138248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4138251">}</span><br>
<span class="lineno"></span><span class="op" id="4138253">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="comment" id="4138256">//&nbsp;decrypt&nbsp;performs&nbsp;an&nbsp;RSA&nbsp;decryption,&nbsp;resulting&nbsp;in&nbsp;a&nbsp;plaintext&nbsp;integer.&nbsp;If&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4138334">//&nbsp;random&nbsp;source&nbsp;is&nbsp;given,&nbsp;RSA&nbsp;blinding&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="4138383">func</span>&nbsp;<span class="ident" id="4138388">decrypt</span><span class="op" id="4138395">(</span><span class="ident" id="4138396">random</span>&nbsp;<span class="ident" id="4138403"><a href="/crypto/rsa/rsa.go.html#4127239">io</a></span><span class="op" id="4138405">.</span><span class="ident" id="4138406">Reader</span><span class="op" id="4138412">,</span>&nbsp;<span class="ident" id="4138414">priv</span>&nbsp;<span class="op" id="4138419">*</span><span class="ident" id="4138420"><a href="/crypto/rsa/rsa.go.html#4128208">PrivateKey</a></span><span class="op" id="4138430">,</span>&nbsp;<span class="ident" id="4138432">c</span>&nbsp;<span class="op" id="4138434">*</span><span class="ident" id="4138435"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4138438">.</span><span class="ident" id="4138439">Int</span><span class="op" id="4138442">)</span>&nbsp;<span class="op" id="4138444">(</span><span class="ident" id="4138445">m</span>&nbsp;<span class="op" id="4138447">*</span><span class="ident" id="4138448"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4138451">.</span><span class="ident" id="4138452">Int</span><span class="op" id="4138455">,</span>&nbsp;<span class="ident" id="4138457">err</span>&nbsp;<span class="builtintype" id="4138461">error</span><span class="op" id="4138466">)</span>&nbsp;<span class="op" id="4138468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4138471">//&nbsp;TODO(agl):&nbsp;can&nbsp;we&nbsp;get&nbsp;away&nbsp;with&nbsp;reusing&nbsp;blinds?</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138523">if</span>&nbsp;<span class="ident" id="4138526"><a href="/crypto/rsa/rsa.go.html#4138432">c</a></span><span class="op" id="4138527">.</span><span class="ident" id="4138528">Cmp</span><span class="op" id="4138531">(</span><span class="ident" id="4138532"><a href="/crypto/rsa/rsa.go.html#4138414">priv</a></span><span class="op" id="4138536">.</span><span class="ident" id="4138537">N</span><span class="op" id="4138538">)</span>&nbsp;<span class="op" id="4138540">&gt;</span>&nbsp;<span class="num" id="4138542">0</span>&nbsp;<span class="op" id="4138544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138548"><a href="/crypto/rsa/rsa.go.html#4138457">err</a></span>&nbsp;<span class="op" id="4138552">=</span>&nbsp;<span class="ident" id="4138554"><a href="/crypto/rsa/rsa.go.html#4136391">ErrDecryption</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138570">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4138578">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138582">var</span>&nbsp;<span class="ident" id="4138586">ir</span>&nbsp;<span class="op" id="4138589">*</span><span class="ident" id="4138590"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4138593">.</span><span class="ident" id="4138594">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138599">if</span>&nbsp;<span class="ident" id="4138602"><a href="/crypto/rsa/rsa.go.html#4138396">random</a></span>&nbsp;<span class="op" id="4138609">!=</span>&nbsp;<span class="ident" id="4138612">nil</span>&nbsp;<span class="op" id="4138616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4138620">//&nbsp;Blinding&nbsp;enabled.&nbsp;Blinding&nbsp;involves&nbsp;multiplying&nbsp;c&nbsp;by&nbsp;r^e.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4138683">//&nbsp;Then&nbsp;the&nbsp;decryption&nbsp;operation&nbsp;performs&nbsp;(m^e&nbsp;*&nbsp;r^e)^d&nbsp;mod&nbsp;n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4138747">//&nbsp;which&nbsp;equals&nbsp;mr&nbsp;mod&nbsp;n.&nbsp;The&nbsp;factor&nbsp;of&nbsp;r&nbsp;can&nbsp;then&nbsp;be&nbsp;removed</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4138811">//&nbsp;by&nbsp;multiplying&nbsp;by&nbsp;the&nbsp;multiplicative&nbsp;inverse&nbsp;of&nbsp;r.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138868">var</span>&nbsp;<span class="ident" id="4138872">r</span>&nbsp;<span class="op" id="4138874">*</span><span class="ident" id="4138875"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4138878">.</span><span class="ident" id="4138879">Int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138886">for</span>&nbsp;<span class="op" id="4138890">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138895"><a href="/crypto/rsa/rsa.go.html#4138872">r</a></span><span class="op" id="4138896">,</span>&nbsp;<span class="ident" id="4138898"><a href="/crypto/rsa/rsa.go.html#4138457">err</a></span>&nbsp;<span class="op" id="4138902">=</span>&nbsp;<span class="ident" id="4138904"><a href="/crypto/rsa/rsa.go.html#4127189">rand</a></span><span class="op" id="4138908">.</span><span class="ident" id="4138909">Int</span><span class="op" id="4138912">(</span><span class="ident" id="4138913"><a href="/crypto/rsa/rsa.go.html#4138396">random</a></span><span class="op" id="4138919">,</span>&nbsp;<span class="ident" id="4138921"><a href="/crypto/rsa/rsa.go.html#4138414">priv</a></span><span class="op" id="4138925">.</span><span class="ident" id="4138926">N</span><span class="op" id="4138927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138932">if</span>&nbsp;<span class="ident" id="4138935"><a href="/crypto/rsa/rsa.go.html#4138457">err</a></span>&nbsp;<span class="op" id="4138939">!=</span>&nbsp;<span class="ident" id="4138942">nil</span>&nbsp;<span class="op" id="4138946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138952">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4138962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138967">if</span>&nbsp;<span class="ident" id="4138970"><a href="/crypto/rsa/rsa.go.html#4138872">r</a></span><span class="op" id="4138971">.</span><span class="ident" id="4138972">Cmp</span><span class="op" id="4138975">(</span><span class="ident" id="4138976"><a href="/crypto/rsa/rsa.go.html#4127263">bigZero</a></span><span class="op" id="4138983">)</span>&nbsp;<span class="op" id="4138985">==</span>&nbsp;<span class="num" id="4138988">0</span>&nbsp;<span class="op" id="4138990">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138996"><a href="/crypto/rsa/rsa.go.html#4138872">r</a></span>&nbsp;<span class="op" id="4138998">=</span>&nbsp;<span class="ident" id="4139000"><a href="/crypto/rsa/rsa.go.html#4127291">bigOne</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4139010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4139015">var</span>&nbsp;<span class="ident" id="4139019">ok</span>&nbsp;<span class="builtintype" id="4139022">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139030"><a href="/crypto/rsa/rsa.go.html#4138586">ir</a></span><span class="op" id="4139032">,</span>&nbsp;<span class="ident" id="4139034"><a href="/crypto/rsa/rsa.go.html#4139019">ok</a></span>&nbsp;<span class="op" id="4139037">=</span>&nbsp;<span class="ident" id="4139039"><a href="/crypto/rsa/rsa.go.html#4136798">modInverse</a></span><span class="op" id="4139049">(</span><span class="ident" id="4139050"><a href="/crypto/rsa/rsa.go.html#4138872">r</a></span><span class="op" id="4139051">,</span>&nbsp;<span class="ident" id="4139053"><a href="/crypto/rsa/rsa.go.html#4138414">priv</a></span><span class="op" id="4139057">.</span><span class="ident" id="4139058">N</span><span class="op" id="4139059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4139064">if</span>&nbsp;<span class="ident" id="4139067"><a href="/crypto/rsa/rsa.go.html#4139019">ok</a></span>&nbsp;<span class="op" id="4139070">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4139076">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4139085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4139089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139093">bigE</span>&nbsp;<span class="op" id="4139098">:=</span>&nbsp;<span class="ident" id="4139101"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4139104">.</span><span class="ident" id="4139105">NewInt</span><span class="op" id="4139111">(</span><span class="ident" id="4139112">int64</span><span class="op" id="4139117">(</span><span class="ident" id="4139118"><a href="/crypto/rsa/rsa.go.html#4138414">priv</a></span><span class="op" id="4139122">.</span><span class="ident" id="4139123">E</span><span class="op" id="4139124">)</span><span class="op" id="4139125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139129">rpowe</span>&nbsp;<span class="op" id="4139135">:=</span>&nbsp;<span class="builtinfunc" id="4139138">new</span><span class="op" id="4139141">(</span><span class="ident" id="4139142"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4139145">.</span><span class="ident" id="4139146">Int</span><span class="op" id="4139149">)</span><span class="op" id="4139150">.</span><span class="ident" id="4139151">Exp</span><span class="op" id="4139154">(</span><span class="ident" id="4139155"><a href="/crypto/rsa/rsa.go.html#4138872">r</a></span><span class="op" id="4139156">,</span>&nbsp;<span class="ident" id="4139158"><a href="/crypto/rsa/rsa.go.html#4139093">bigE</a></span><span class="op" id="4139162">,</span>&nbsp;<span class="ident" id="4139164"><a href="/crypto/rsa/rsa.go.html#4138414">priv</a></span><span class="op" id="4139168">.</span><span class="ident" id="4139169">N</span><span class="op" id="4139170">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139174">cCopy</span>&nbsp;<span class="op" id="4139180">:=</span>&nbsp;<span class="builtinfunc" id="4139183">new</span><span class="op" id="4139186">(</span><span class="ident" id="4139187"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4139190">.</span><span class="ident" id="4139191">Int</span><span class="op" id="4139194">)</span><span class="op" id="4139195">.</span><span class="ident" id="4139196">Set</span><span class="op" id="4139199">(</span><span class="ident" id="4139200"><a href="/crypto/rsa/rsa.go.html#4138432">c</a></span><span class="op" id="4139201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139205"><a href="/crypto/rsa/rsa.go.html#4139174">cCopy</a></span><span class="op" id="4139210">.</span><span class="ident" id="4139211">Mul</span><span class="op" id="4139214">(</span><span class="ident" id="4139215"><a href="/crypto/rsa/rsa.go.html#4139174">cCopy</a></span><span class="op" id="4139220">,</span>&nbsp;<span class="ident" id="4139222"><a href="/crypto/rsa/rsa.go.html#4139129">rpowe</a></span><span class="op" id="4139227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139231"><a href="/crypto/rsa/rsa.go.html#4139174">cCopy</a></span><span class="op" id="4139236">.</span><span class="ident" id="4139237">Mod</span><span class="op" id="4139240">(</span><span class="ident" id="4139241"><a href="/crypto/rsa/rsa.go.html#4139174">cCopy</a></span><span class="op" id="4139246">,</span>&nbsp;<span class="ident" id="4139248"><a href="/crypto/rsa/rsa.go.html#4138414">priv</a></span><span class="op" id="4139252">.</span><span class="ident" id="4139253">N</span><span class="op" id="4139254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139258"><a href="/crypto/rsa/rsa.go.html#4138432">c</a></span>&nbsp;<span class="op" id="4139260">=</span>&nbsp;<span class="ident" id="4139262"><a href="/crypto/rsa/rsa.go.html#4139174">cCopy</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4139269">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4139273">if</span>&nbsp;<span class="ident" id="4139276"><a href="/crypto/rsa/rsa.go.html#4138414">priv</a></span><span class="op" id="4139280">.</span><span class="ident" id="4139281">Precomputed</span><span class="op" id="4139292">.</span><span class="ident" id="4139293">Dp</span>&nbsp;<span class="op" id="4139296">==</span>&nbsp;<span class="ident" id="4139299">nil</span>&nbsp;<span class="op" id="4139303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139307"><a href="/crypto/rsa/rsa.go.html#4138445">m</a></span>&nbsp;<span class="op" id="4139309">=</span>&nbsp;<span class="builtinfunc" id="4139311">new</span><span class="op" id="4139314">(</span><span class="ident" id="4139315"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4139318">.</span><span class="ident" id="4139319">Int</span><span class="op" id="4139322">)</span><span class="op" id="4139323">.</span><span class="ident" id="4139324">Exp</span><span class="op" id="4139327">(</span><span class="ident" id="4139328"><a href="/crypto/rsa/rsa.go.html#4138432">c</a></span><span class="op" id="4139329">,</span>&nbsp;<span class="ident" id="4139331"><a href="/crypto/rsa/rsa.go.html#4138414">priv</a></span><span class="op" id="4139335">.</span><span class="ident" id="4139336">D</span><span class="op" id="4139337">,</span>&nbsp;<span class="ident" id="4139339"><a href="/crypto/rsa/rsa.go.html#4138414">priv</a></span><span class="op" id="4139343">.</span><span class="ident" id="4139344">N</span><span class="op" id="4139345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4139348">}</span>&nbsp;<span class="keyword" id="4139350">else</span>&nbsp;<span class="op" id="4139355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4139359">//&nbsp;We&nbsp;have&nbsp;the&nbsp;precalculated&nbsp;values&nbsp;needed&nbsp;for&nbsp;the&nbsp;CRT.</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139417"><a href="/crypto/rsa/rsa.go.html#4138445">m</a></span>&nbsp;<span class="op" id="4139419">=</span>&nbsp;<span class="builtinfunc" id="4139421">new</span><span class="op" id="4139424">(</span><span class="ident" id="4139425"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4139428">.</span><span class="ident" id="4139429">Int</span><span class="op" id="4139432">)</span><span class="op" id="4139433">.</span><span class="ident" id="4139434">Exp</span><span class="op" id="4139437">(</span><span class="ident" id="4139438"><a href="/crypto/rsa/rsa.go.html#4138432">c</a></span><span class="op" id="4139439">,</span>&nbsp;<span class="ident" id="4139441"><a href="/crypto/rsa/rsa.go.html#4138414">priv</a></span><span class="op" id="4139445">.</span><span class="ident" id="4139446">Precomputed</span><span class="op" id="4139457">.</span><span class="ident" id="4139458">Dp</span><span class="op" id="4139460">,</span>&nbsp;<span class="ident" id="4139462"><a href="/crypto/rsa/rsa.go.html#4138414">priv</a></span><span class="op" id="4139466">.</span><span class="ident" id="4139467">Primes</span><span class="op" id="4139473">[</span><span class="num" id="4139474">0</span><span class="op" id="4139475">]</span><span class="op" id="4139476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139480">m2</span>&nbsp;<span class="op" id="4139483">:=</span>&nbsp;<span class="builtinfunc" id="4139486">new</span><span class="op" id="4139489">(</span><span class="ident" id="4139490"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4139493">.</span><span class="ident" id="4139494">Int</span><span class="op" id="4139497">)</span><span class="op" id="4139498">.</span><span class="ident" id="4139499">Exp</span><span class="op" id="4139502">(</span><span class="ident" id="4139503"><a href="/crypto/rsa/rsa.go.html#4138432">c</a></span><span class="op" id="4139504">,</span>&nbsp;<span class="ident" id="4139506"><a href="/crypto/rsa/rsa.go.html#4138414">priv</a></span><span class="op" id="4139510">.</span><span class="ident" id="4139511">Precomputed</span><span class="op" id="4139522">.</span><span class="ident" id="4139523">Dq</span><span class="op" id="4139525">,</span>&nbsp;<span class="ident" id="4139527"><a href="/crypto/rsa/rsa.go.html#4138414">priv</a></span><span class="op" id="4139531">.</span><span class="ident" id="4139532">Primes</span><span class="op" id="4139538">[</span><span class="num" id="4139539">1</span><span class="op" id="4139540">]</span><span class="op" id="4139541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139545"><a href="/crypto/rsa/rsa.go.html#4138445">m</a></span><span class="op" id="4139546">.</span><span class="ident" id="4139547">Sub</span><span class="op" id="4139550">(</span><span class="ident" id="4139551"><a href="/crypto/rsa/rsa.go.html#4138445">m</a></span><span class="op" id="4139552">,</span>&nbsp;<span class="ident" id="4139554"><a href="/crypto/rsa/rsa.go.html#4139480">m2</a></span><span class="op" id="4139556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4139560">if</span>&nbsp;<span class="ident" id="4139563"><a href="/crypto/rsa/rsa.go.html#4138445">m</a></span><span class="op" id="4139564">.</span><span class="ident" id="4139565">Sign</span><span class="op" id="4139569">(</span><span class="op" id="4139570">)</span>&nbsp;<span class="op" id="4139572">&lt;</span>&nbsp;<span class="num" id="4139574">0</span>&nbsp;<span class="op" id="4139576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139581"><a href="/crypto/rsa/rsa.go.html#4138445">m</a></span><span class="op" id="4139582">.</span><span class="ident" id="4139583">Add</span><span class="op" id="4139586">(</span><span class="ident" id="4139587"><a href="/crypto/rsa/rsa.go.html#4138445">m</a></span><span class="op" id="4139588">,</span>&nbsp;<span class="ident" id="4139590"><a href="/crypto/rsa/rsa.go.html#4138414">priv</a></span><span class="op" id="4139594">.</span><span class="ident" id="4139595">Primes</span><span class="op" id="4139601">[</span><span class="num" id="4139602">0</span><span class="op" id="4139603">]</span><span class="op" id="4139604">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4139608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139612"><a href="/crypto/rsa/rsa.go.html#4138445">m</a></span><span class="op" id="4139613">.</span><span class="ident" id="4139614">Mul</span><span class="op" id="4139617">(</span><span class="ident" id="4139618"><a href="/crypto/rsa/rsa.go.html#4138445">m</a></span><span class="op" id="4139619">,</span>&nbsp;<span class="ident" id="4139621"><a href="/crypto/rsa/rsa.go.html#4138414">priv</a></span><span class="op" id="4139625">.</span><span class="ident" id="4139626">Precomputed</span><span class="op" id="4139637">.</span><span class="ident" id="4139638">Qinv</span><span class="op" id="4139642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139646"><a href="/crypto/rsa/rsa.go.html#4138445">m</a></span><span class="op" id="4139647">.</span><span class="ident" id="4139648">Mod</span><span class="op" id="4139651">(</span><span class="ident" id="4139652"><a href="/crypto/rsa/rsa.go.html#4138445">m</a></span><span class="op" id="4139653">,</span>&nbsp;<span class="ident" id="4139655"><a href="/crypto/rsa/rsa.go.html#4138414">priv</a></span><span class="op" id="4139659">.</span><span class="ident" id="4139660">Primes</span><span class="op" id="4139666">[</span><span class="num" id="4139667">0</span><span class="op" id="4139668">]</span><span class="op" id="4139669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139673"><a href="/crypto/rsa/rsa.go.html#4138445">m</a></span><span class="op" id="4139674">.</span><span class="ident" id="4139675">Mul</span><span class="op" id="4139678">(</span><span class="ident" id="4139679"><a href="/crypto/rsa/rsa.go.html#4138445">m</a></span><span class="op" id="4139680">,</span>&nbsp;<span class="ident" id="4139682"><a href="/crypto/rsa/rsa.go.html#4138414">priv</a></span><span class="op" id="4139686">.</span><span class="ident" id="4139687">Primes</span><span class="op" id="4139693">[</span><span class="num" id="4139694">1</span><span class="op" id="4139695">]</span><span class="op" id="4139696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139700"><a href="/crypto/rsa/rsa.go.html#4138445">m</a></span><span class="op" id="4139701">.</span><span class="ident" id="4139702">Add</span><span class="op" id="4139705">(</span><span class="ident" id="4139706"><a href="/crypto/rsa/rsa.go.html#4138445">m</a></span><span class="op" id="4139707">,</span>&nbsp;<span class="ident" id="4139709"><a href="/crypto/rsa/rsa.go.html#4139480">m2</a></span><span class="op" id="4139711">)</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4139716">for</span>&nbsp;<span class="ident" id="4139720">i</span><span class="op" id="4139721">,</span>&nbsp;<span class="ident" id="4139723">values</span>&nbsp;<span class="op" id="4139730">:=</span>&nbsp;<span class="keyword" id="4139733">range</span>&nbsp;<span class="ident" id="4139739"><a href="/crypto/rsa/rsa.go.html#4138414">priv</a></span><span class="op" id="4139743">.</span><span class="ident" id="4139744">Precomputed</span><span class="op" id="4139755">.</span><span class="ident" id="4139756">CRTValues</span>&nbsp;<span class="op" id="4139766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139771">prime</span>&nbsp;<span class="op" id="4139777">:=</span>&nbsp;<span class="ident" id="4139780"><a href="/crypto/rsa/rsa.go.html#4138414">priv</a></span><span class="op" id="4139784">.</span><span class="ident" id="4139785">Primes</span><span class="op" id="4139791">[</span><span class="num" id="4139792">2</span><span class="op" id="4139793">+</span><span class="ident" id="4139794"><a href="/crypto/rsa/rsa.go.html#4139720">i</a></span><span class="op" id="4139795">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139800"><a href="/crypto/rsa/rsa.go.html#4139480">m2</a></span><span class="op" id="4139802">.</span><span class="ident" id="4139803">Exp</span><span class="op" id="4139806">(</span><span class="ident" id="4139807"><a href="/crypto/rsa/rsa.go.html#4138432">c</a></span><span class="op" id="4139808">,</span>&nbsp;<span class="ident" id="4139810"><a href="/crypto/rsa/rsa.go.html#4139723">values</a></span><span class="op" id="4139816">.</span><span class="ident" id="4139817">Exp</span><span class="op" id="4139820">,</span>&nbsp;<span class="ident" id="4139822"><a href="/crypto/rsa/rsa.go.html#4139771">prime</a></span><span class="op" id="4139827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139832"><a href="/crypto/rsa/rsa.go.html#4139480">m2</a></span><span class="op" id="4139834">.</span><span class="ident" id="4139835">Sub</span><span class="op" id="4139838">(</span><span class="ident" id="4139839"><a href="/crypto/rsa/rsa.go.html#4139480">m2</a></span><span class="op" id="4139841">,</span>&nbsp;<span class="ident" id="4139843"><a href="/crypto/rsa/rsa.go.html#4138445">m</a></span><span class="op" id="4139844">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139849"><a href="/crypto/rsa/rsa.go.html#4139480">m2</a></span><span class="op" id="4139851">.</span><span class="ident" id="4139852">Mul</span><span class="op" id="4139855">(</span><span class="ident" id="4139856"><a href="/crypto/rsa/rsa.go.html#4139480">m2</a></span><span class="op" id="4139858">,</span>&nbsp;<span class="ident" id="4139860"><a href="/crypto/rsa/rsa.go.html#4139723">values</a></span><span class="op" id="4139866">.</span><span class="ident" id="4139867">Coeff</span><span class="op" id="4139872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139877"><a href="/crypto/rsa/rsa.go.html#4139480">m2</a></span><span class="op" id="4139879">.</span><span class="ident" id="4139880">Mod</span><span class="op" id="4139883">(</span><span class="ident" id="4139884"><a href="/crypto/rsa/rsa.go.html#4139480">m2</a></span><span class="op" id="4139886">,</span>&nbsp;<span class="ident" id="4139888"><a href="/crypto/rsa/rsa.go.html#4139771">prime</a></span><span class="op" id="4139893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4139898">if</span>&nbsp;<span class="ident" id="4139901"><a href="/crypto/rsa/rsa.go.html#4139480">m2</a></span><span class="op" id="4139903">.</span><span class="ident" id="4139904">Sign</span><span class="op" id="4139908">(</span><span class="op" id="4139909">)</span>&nbsp;<span class="op" id="4139911">&lt;</span>&nbsp;<span class="num" id="4139913">0</span>&nbsp;<span class="op" id="4139915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139921"><a href="/crypto/rsa/rsa.go.html#4139480">m2</a></span><span class="op" id="4139923">.</span><span class="ident" id="4139924">Add</span><span class="op" id="4139927">(</span><span class="ident" id="4139928"><a href="/crypto/rsa/rsa.go.html#4139480">m2</a></span><span class="op" id="4139930">,</span>&nbsp;<span class="ident" id="4139932"><a href="/crypto/rsa/rsa.go.html#4139771">prime</a></span><span class="op" id="4139937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4139942">}</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139947"><a href="/crypto/rsa/rsa.go.html#4139480">m2</a></span><span class="op" id="4139949">.</span><span class="ident" id="4139950">Mul</span><span class="op" id="4139953">(</span><span class="ident" id="4139954"><a href="/crypto/rsa/rsa.go.html#4139480">m2</a></span><span class="op" id="4139956">,</span>&nbsp;<span class="ident" id="4139958"><a href="/crypto/rsa/rsa.go.html#4139723">values</a></span><span class="op" id="4139964">.</span><span class="ident" id="4139965">R</span><span class="op" id="4139966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139971"><a href="/crypto/rsa/rsa.go.html#4138445">m</a></span><span class="op" id="4139972">.</span><span class="ident" id="4139973">Add</span><span class="op" id="4139976">(</span><span class="ident" id="4139977"><a href="/crypto/rsa/rsa.go.html#4138445">m</a></span><span class="op" id="4139978">,</span>&nbsp;<span class="ident" id="4139980"><a href="/crypto/rsa/rsa.go.html#4139480">m2</a></span><span class="op" id="4139982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4139986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4139989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4139993">if</span>&nbsp;<span class="ident" id="4139996"><a href="/crypto/rsa/rsa.go.html#4138586">ir</a></span>&nbsp;<span class="op" id="4139999">!=</span>&nbsp;<span class="ident" id="4140002">nil</span>&nbsp;<span class="op" id="4140006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4140010">//&nbsp;Unblind.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4140024"><a href="/crypto/rsa/rsa.go.html#4138445">m</a></span><span class="op" id="4140025">.</span><span class="ident" id="4140026">Mul</span><span class="op" id="4140029">(</span><span class="ident" id="4140030"><a href="/crypto/rsa/rsa.go.html#4138445">m</a></span><span class="op" id="4140031">,</span>&nbsp;<span class="ident" id="4140033"><a href="/crypto/rsa/rsa.go.html#4138586">ir</a></span><span class="op" id="4140035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4140039"><a href="/crypto/rsa/rsa.go.html#4138445">m</a></span><span class="op" id="4140040">.</span><span class="ident" id="4140041">Mod</span><span class="op" id="4140044">(</span><span class="ident" id="4140045"><a href="/crypto/rsa/rsa.go.html#4138445">m</a></span><span class="op" id="4140046">,</span>&nbsp;<span class="ident" id="4140048"><a href="/crypto/rsa/rsa.go.html#4138414">priv</a></span><span class="op" id="4140052">.</span><span class="ident" id="4140053">N</span><span class="op" id="4140054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4140057">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4140061">return</span><br>
<span class="lineno"></span><span class="op" id="4140068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4140071">//&nbsp;DecryptOAEP&nbsp;decrypts&nbsp;ciphertext&nbsp;using&nbsp;RSA-OAEP.</span><br>
<span class="lineno">475</span><span class="comment" id="4140122">//&nbsp;If&nbsp;random&nbsp;!=&nbsp;nil,&nbsp;DecryptOAEP&nbsp;uses&nbsp;RSA&nbsp;blinding&nbsp;to&nbsp;avoid&nbsp;timing&nbsp;side-channel&nbsp;attacks.</span><br>
<span class="lineno"></span><span class="keyword" id="4140211">func</span>&nbsp;<span class="ident" id="4140216">DecryptOAEP</span><span class="op" id="4140227">(</span><span class="ident" id="4140228">hash</span>&nbsp;<span class="ident" id="4140233"><a href="/crypto/rsa/rsa.go.html#4127231">hash</a></span><span class="op" id="4140237">.</span><span class="ident" id="4140238">Hash</span><span class="op" id="4140242">,</span>&nbsp;<span class="ident" id="4140244">random</span>&nbsp;<span class="ident" id="4140251"><a href="/crypto/rsa/rsa.go.html#4127239">io</a></span><span class="op" id="4140253">.</span><span class="ident" id="4140254">Reader</span><span class="op" id="4140260">,</span>&nbsp;<span class="ident" id="4140262">priv</span>&nbsp;<span class="op" id="4140267">*</span><span class="ident" id="4140268"><a href="/crypto/rsa/rsa.go.html#4128208">PrivateKey</a></span><span class="op" id="4140278">,</span>&nbsp;<span class="ident" id="4140280">ciphertext</span>&nbsp;<span class="op" id="4140291">[</span><span class="op" id="4140292">]</span><span class="builtintype" id="4140293">byte</span><span class="op" id="4140297">,</span>&nbsp;<span class="ident" id="4140299">label</span>&nbsp;<span class="op" id="4140305">[</span><span class="op" id="4140306">]</span><span class="builtintype" id="4140307">byte</span><span class="op" id="4140311">)</span>&nbsp;<span class="op" id="4140313">(</span><span class="ident" id="4140314">msg</span>&nbsp;<span class="op" id="4140318">[</span><span class="op" id="4140319">]</span><span class="builtintype" id="4140320">byte</span><span class="op" id="4140324">,</span>&nbsp;<span class="ident" id="4140326">err</span>&nbsp;<span class="builtintype" id="4140330">error</span><span class="op" id="4140335">)</span>&nbsp;<span class="op" id="4140337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4140340">if</span>&nbsp;<span class="ident" id="4140343">err</span>&nbsp;<span class="op" id="4140347">:=</span>&nbsp;<span class="ident" id="4140350"><a href="/crypto/rsa/rsa.go.html#4127961">checkPub</a></span><span class="op" id="4140358">(</span><span class="op" id="4140359">&amp;</span><span class="ident" id="4140360"><a href="/crypto/rsa/rsa.go.html#4140262">priv</a></span><span class="op" id="4140364">.</span><span class="ident" id="4140365">PublicKey</span><span class="op" id="4140374">)</span><span class="op" id="4140375">;</span>&nbsp;<span class="ident" id="4140377"><a href="/crypto/rsa/rsa.go.html#4140343">err</a></span>&nbsp;<span class="op" id="4140381">!=</span>&nbsp;<span class="ident" id="4140384">nil</span>&nbsp;<span class="op" id="4140388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4140392">return</span>&nbsp;<span class="ident" id="4140399">nil</span><span class="op" id="4140402">,</span>&nbsp;<span class="ident" id="4140404"><a href="/crypto/rsa/rsa.go.html#4140343">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4140409">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4140412">k</span>&nbsp;<span class="op" id="4140414">:=</span>&nbsp;<span class="op" id="4140417">(</span><span class="ident" id="4140418"><a href="/crypto/rsa/rsa.go.html#4140262">priv</a></span><span class="op" id="4140422">.</span><span class="ident" id="4140423">N</span><span class="op" id="4140424">.</span><span class="ident" id="4140425">BitLen</span><span class="op" id="4140431">(</span><span class="op" id="4140432">)</span>&nbsp;<span class="op" id="4140434">+</span>&nbsp;<span class="num" id="4140436">7</span><span class="op" id="4140437">)</span>&nbsp;<span class="op" id="4140439">/</span>&nbsp;<span class="num" id="4140441">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4140444">if</span>&nbsp;<span class="builtinfunc" id="4140447">len</span><span class="op" id="4140450">(</span><span class="ident" id="4140451"><a href="/crypto/rsa/rsa.go.html#4140280">ciphertext</a></span><span class="op" id="4140461">)</span>&nbsp;<span class="op" id="4140463">&gt;</span>&nbsp;<span class="ident" id="4140465"><a href="/crypto/rsa/rsa.go.html#4140412">k</a></span>&nbsp;<span class="op" id="4140467">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4140472"><a href="/crypto/rsa/rsa.go.html#4140412">k</a></span>&nbsp;<span class="op" id="4140474">&lt;</span>&nbsp;<span class="ident" id="4140476"><a href="/crypto/rsa/rsa.go.html#4140228">hash</a></span><span class="op" id="4140480">.</span><span class="ident" id="4140481">Size</span><span class="op" id="4140485">(</span><span class="op" id="4140486">)</span><span class="op" id="4140487">*</span><span class="num" id="4140488">2</span><span class="op" id="4140489">+</span><span class="num" id="4140490">2</span>&nbsp;<span class="op" id="4140492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4140496"><a href="/crypto/rsa/rsa.go.html#4140326">err</a></span>&nbsp;<span class="op" id="4140500">=</span>&nbsp;<span class="ident" id="4140502"><a href="/crypto/rsa/rsa.go.html#4136391">ErrDecryption</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4140518">return</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4140526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4140530">c</span>&nbsp;<span class="op" id="4140532">:=</span>&nbsp;<span class="builtinfunc" id="4140535">new</span><span class="op" id="4140538">(</span><span class="ident" id="4140539"><a href="/crypto/rsa/rsa.go.html#4127245">big</a></span><span class="op" id="4140542">.</span><span class="ident" id="4140543">Int</span><span class="op" id="4140546">)</span><span class="op" id="4140547">.</span><span class="ident" id="4140548">SetBytes</span><span class="op" id="4140556">(</span><span class="ident" id="4140557"><a href="/crypto/rsa/rsa.go.html#4140280">ciphertext</a></span><span class="op" id="4140567">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4140571">m</span><span class="op" id="4140572">,</span>&nbsp;<span class="ident" id="4140574"><a href="/crypto/rsa/rsa.go.html#4140326">err</a></span>&nbsp;<span class="op" id="4140578">:=</span>&nbsp;<span class="ident" id="4140581"><a href="/crypto/rsa/rsa.go.html#4138388">decrypt</a></span><span class="op" id="4140588">(</span><span class="ident" id="4140589"><a href="/crypto/rsa/rsa.go.html#4140244">random</a></span><span class="op" id="4140595">,</span>&nbsp;<span class="ident" id="4140597"><a href="/crypto/rsa/rsa.go.html#4140262">priv</a></span><span class="op" id="4140601">,</span>&nbsp;<span class="ident" id="4140603"><a href="/crypto/rsa/rsa.go.html#4140530">c</a></span><span class="op" id="4140604">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4140607">if</span>&nbsp;<span class="ident" id="4140610"><a href="/crypto/rsa/rsa.go.html#4140326">err</a></span>&nbsp;<span class="op" id="4140614">!=</span>&nbsp;<span class="ident" id="4140617">nil</span>&nbsp;<span class="op" id="4140621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4140625">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4140633">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4140637"><a href="/crypto/rsa/rsa.go.html#4140228">hash</a></span><span class="op" id="4140641">.</span><span class="ident" id="4140642">Write</span><span class="op" id="4140647">(</span><span class="ident" id="4140648"><a href="/crypto/rsa/rsa.go.html#4140299">label</a></span><span class="op" id="4140653">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4140656">lHash</span>&nbsp;<span class="op" id="4140662">:=</span>&nbsp;<span class="ident" id="4140665"><a href="/crypto/rsa/rsa.go.html#4140228">hash</a></span><span class="op" id="4140669">.</span><span class="ident" id="4140670">Sum</span><span class="op" id="4140673">(</span><span class="ident" id="4140674">nil</span><span class="op" id="4140677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4140680"><a href="/crypto/rsa/rsa.go.html#4140228">hash</a></span><span class="op" id="4140684">.</span><span class="ident" id="4140685">Reset</span><span class="op" id="4140690">(</span><span class="op" id="4140691">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4140695">//&nbsp;Converting&nbsp;the&nbsp;plaintext&nbsp;number&nbsp;to&nbsp;bytes&nbsp;will&nbsp;strip&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4140755">//&nbsp;leading&nbsp;zeros&nbsp;so&nbsp;we&nbsp;may&nbsp;have&nbsp;to&nbsp;left&nbsp;pad.&nbsp;We&nbsp;do&nbsp;this&nbsp;unconditionally</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4140828">//&nbsp;to&nbsp;avoid&nbsp;leaking&nbsp;timing&nbsp;information.&nbsp;(Although&nbsp;we&nbsp;still&nbsp;probably</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4140897">//&nbsp;leak&nbsp;the&nbsp;number&nbsp;of&nbsp;leading&nbsp;zeros.&nbsp;It&#39;s&nbsp;not&nbsp;clear&nbsp;that&nbsp;we&nbsp;can&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4140965">//&nbsp;anything&nbsp;about&nbsp;this.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4140991">em</span>&nbsp;<span class="op" id="4140994">:=</span>&nbsp;<span class="ident" id="4140997"><a href="/crypto/rsa/rsa.go.html#4142518">leftPad</a></span><span class="op" id="4141004">(</span><span class="ident" id="4141005"><a href="/crypto/rsa/rsa.go.html#4140571">m</a></span><span class="op" id="4141006">.</span><span class="ident" id="4141007">Bytes</span><span class="op" id="4141012">(</span><span class="op" id="4141013">)</span><span class="op" id="4141014">,</span>&nbsp;<span class="ident" id="4141016"><a href="/crypto/rsa/rsa.go.html#4140412">k</a></span><span class="op" id="4141017">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4141021">firstByteIsZero</span>&nbsp;<span class="op" id="4141037">:=</span>&nbsp;<span class="ident" id="4141040"><a href="/crypto/rsa/rsa.go.html#4127204">subtle</a></span><span class="op" id="4141046">.</span><span class="ident" id="4141047">ConstantTimeByteEq</span><span class="op" id="4141065">(</span><span class="ident" id="4141066"><a href="/crypto/rsa/rsa.go.html#4140991">em</a></span><span class="op" id="4141068">[</span><span class="num" id="4141069">0</span><span class="op" id="4141070">]</span><span class="op" id="4141071">,</span>&nbsp;<span class="num" id="4141073">0</span><span class="op" id="4141074">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4141078">seed</span>&nbsp;<span class="op" id="4141083">:=</span>&nbsp;<span class="ident" id="4141086"><a href="/crypto/rsa/rsa.go.html#4140991">em</a></span><span class="op" id="4141088">[</span><span class="num" id="4141089">1</span>&nbsp;<span class="op" id="4141091">:</span>&nbsp;<span class="ident" id="4141093"><a href="/crypto/rsa/rsa.go.html#4140228">hash</a></span><span class="op" id="4141097">.</span><span class="ident" id="4141098">Size</span><span class="op" id="4141102">(</span><span class="op" id="4141103">)</span><span class="op" id="4141104">+</span><span class="num" id="4141105">1</span><span class="op" id="4141106">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4141109">db</span>&nbsp;<span class="op" id="4141112">:=</span>&nbsp;<span class="ident" id="4141115"><a href="/crypto/rsa/rsa.go.html#4140991">em</a></span><span class="op" id="4141117">[</span><span class="ident" id="4141118"><a href="/crypto/rsa/rsa.go.html#4140228">hash</a></span><span class="op" id="4141122">.</span><span class="ident" id="4141123">Size</span><span class="op" id="4141127">(</span><span class="op" id="4141128">)</span><span class="op" id="4141129">+</span><span class="num" id="4141130">1</span><span class="op" id="4141131">:</span><span class="op" id="4141132">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4141136"><a href="/crypto/rsa/rsa.go.html#4134519">mgf1XOR</a></span><span class="op" id="4141143">(</span><span class="ident" id="4141144"><a href="/crypto/rsa/rsa.go.html#4141078">seed</a></span><span class="op" id="4141148">,</span>&nbsp;<span class="ident" id="4141150"><a href="/crypto/rsa/rsa.go.html#4140228">hash</a></span><span class="op" id="4141154">,</span>&nbsp;<span class="ident" id="4141156"><a href="/crypto/rsa/rsa.go.html#4141109">db</a></span><span class="op" id="4141158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4141161"><a href="/crypto/rsa/rsa.go.html#4134519">mgf1XOR</a></span><span class="op" id="4141168">(</span><span class="ident" id="4141169"><a href="/crypto/rsa/rsa.go.html#4141109">db</a></span><span class="op" id="4141171">,</span>&nbsp;<span class="ident" id="4141173"><a href="/crypto/rsa/rsa.go.html#4140228">hash</a></span><span class="op" id="4141177">,</span>&nbsp;<span class="ident" id="4141179"><a href="/crypto/rsa/rsa.go.html#4141078">seed</a></span><span class="op" id="4141183">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4141187">lHash2</span>&nbsp;<span class="op" id="4141194">:=</span>&nbsp;<span class="ident" id="4141197"><a href="/crypto/rsa/rsa.go.html#4141109">db</a></span><span class="op" id="4141199">[</span><span class="num" id="4141200">0</span><span class="op" id="4141201">:</span><span class="ident" id="4141202"><a href="/crypto/rsa/rsa.go.html#4140228">hash</a></span><span class="op" id="4141206">.</span><span class="ident" id="4141207">Size</span><span class="op" id="4141211">(</span><span class="op" id="4141212">)</span><span class="op" id="4141213">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4141217">//&nbsp;We&nbsp;have&nbsp;to&nbsp;validate&nbsp;the&nbsp;plaintext&nbsp;in&nbsp;constant&nbsp;time&nbsp;in&nbsp;order&nbsp;to&nbsp;avoid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4141290">//&nbsp;attacks&nbsp;like:&nbsp;J.&nbsp;Manger.&nbsp;A&nbsp;Chosen&nbsp;Ciphertext&nbsp;Attack&nbsp;on&nbsp;RSA&nbsp;Optimal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4141361">//&nbsp;Asymmetric&nbsp;Encryption&nbsp;Padding&nbsp;(OAEP)&nbsp;as&nbsp;Standardized&nbsp;in&nbsp;PKCS&nbsp;#1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4141429">//&nbsp;v2.0.&nbsp;In&nbsp;J.&nbsp;Kilian,&nbsp;editor,&nbsp;Advances&nbsp;in&nbsp;Cryptology.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4141485">lHash2Good</span>&nbsp;<span class="op" id="4141496">:=</span>&nbsp;<span class="ident" id="4141499"><a href="/crypto/rsa/rsa.go.html#4127204">subtle</a></span><span class="op" id="4141505">.</span><span class="ident" id="4141506">ConstantTimeCompare</span><span class="op" id="4141525">(</span><span class="ident" id="4141526"><a href="/crypto/rsa/rsa.go.html#4140656">lHash</a></span><span class="op" id="4141531">,</span>&nbsp;<span class="ident" id="4141533"><a href="/crypto/rsa/rsa.go.html#4141187">lHash2</a></span><span class="op" id="4141539">)</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4141543">//&nbsp;The&nbsp;remainder&nbsp;of&nbsp;the&nbsp;plaintext&nbsp;must&nbsp;be&nbsp;zero&nbsp;or&nbsp;more&nbsp;0x00,&nbsp;followed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4141614">//&nbsp;by&nbsp;0x01,&nbsp;followed&nbsp;by&nbsp;the&nbsp;message.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4141652">//&nbsp;&nbsp;&nbsp;lookingForIndex:&nbsp;1&nbsp;iff&nbsp;we&nbsp;are&nbsp;still&nbsp;looking&nbsp;for&nbsp;the&nbsp;0x01</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4141715">//&nbsp;&nbsp;&nbsp;index:&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;first&nbsp;0x01&nbsp;byte</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4141762">//&nbsp;&nbsp;&nbsp;invalid:&nbsp;1&nbsp;iff&nbsp;we&nbsp;saw&nbsp;a&nbsp;non-zero&nbsp;byte&nbsp;before&nbsp;the&nbsp;0x01.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4141823">var</span>&nbsp;<span class="ident" id="4141827">lookingForIndex</span><span class="op" id="4141842">,</span>&nbsp;<span class="ident" id="4141844">index</span><span class="op" id="4141849">,</span>&nbsp;<span class="ident" id="4141851">invalid</span>&nbsp;<span class="builtintype" id="4141859">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4141864"><a href="/crypto/rsa/rsa.go.html#4141827">lookingForIndex</a></span>&nbsp;<span class="op" id="4141880">=</span>&nbsp;<span class="num" id="4141882">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4141885">rest</span>&nbsp;<span class="op" id="4141890">:=</span>&nbsp;<span class="ident" id="4141893"><a href="/crypto/rsa/rsa.go.html#4141109">db</a></span><span class="op" id="4141895">[</span><span class="ident" id="4141896"><a href="/crypto/rsa/rsa.go.html#4140228">hash</a></span><span class="op" id="4141900">.</span><span class="ident" id="4141901">Size</span><span class="op" id="4141905">(</span><span class="op" id="4141906">)</span><span class="op" id="4141907">:</span><span class="op" id="4141908">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4141912">for</span>&nbsp;<span class="ident" id="4141916">i</span>&nbsp;<span class="op" id="4141918">:=</span>&nbsp;<span class="num" id="4141921">0</span><span class="op" id="4141922">;</span>&nbsp;<span class="ident" id="4141924"><a href="/crypto/rsa/rsa.go.html#4141916">i</a></span>&nbsp;<span class="op" id="4141926">&lt;</span>&nbsp;<span class="builtinfunc" id="4141928">len</span><span class="op" id="4141931">(</span><span class="ident" id="4141932"><a href="/crypto/rsa/rsa.go.html#4141885">rest</a></span><span class="op" id="4141936">)</span><span class="op" id="4141937">;</span>&nbsp;<span class="ident" id="4141939"><a href="/crypto/rsa/rsa.go.html#4141916">i</a></span><span class="op" id="4141940">++</span>&nbsp;<span class="op" id="4141943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4141947">equals0</span>&nbsp;<span class="op" id="4141955">:=</span>&nbsp;<span class="ident" id="4141958"><a href="/crypto/rsa/rsa.go.html#4127204">subtle</a></span><span class="op" id="4141964">.</span><span class="ident" id="4141965">ConstantTimeByteEq</span><span class="op" id="4141983">(</span><span class="ident" id="4141984"><a href="/crypto/rsa/rsa.go.html#4141885">rest</a></span><span class="op" id="4141988">[</span><span class="ident" id="4141989"><a href="/crypto/rsa/rsa.go.html#4141916">i</a></span><span class="op" id="4141990">]</span><span class="op" id="4141991">,</span>&nbsp;<span class="num" id="4141993">0</span><span class="op" id="4141994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4141998">equals1</span>&nbsp;<span class="op" id="4142006">:=</span>&nbsp;<span class="ident" id="4142009"><a href="/crypto/rsa/rsa.go.html#4127204">subtle</a></span><span class="op" id="4142015">.</span><span class="ident" id="4142016">ConstantTimeByteEq</span><span class="op" id="4142034">(</span><span class="ident" id="4142035"><a href="/crypto/rsa/rsa.go.html#4141885">rest</a></span><span class="op" id="4142039">[</span><span class="ident" id="4142040"><a href="/crypto/rsa/rsa.go.html#4141916">i</a></span><span class="op" id="4142041">]</span><span class="op" id="4142042">,</span>&nbsp;<span class="num" id="4142044">1</span><span class="op" id="4142045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4142049"><a href="/crypto/rsa/rsa.go.html#4141844">index</a></span>&nbsp;<span class="op" id="4142055">=</span>&nbsp;<span class="ident" id="4142057"><a href="/crypto/rsa/rsa.go.html#4127204">subtle</a></span><span class="op" id="4142063">.</span><span class="ident" id="4142064">ConstantTimeSelect</span><span class="op" id="4142082">(</span><span class="ident" id="4142083"><a href="/crypto/rsa/rsa.go.html#4141827">lookingForIndex</a></span><span class="op" id="4142098">&amp;</span><span class="ident" id="4142099"><a href="/crypto/rsa/rsa.go.html#4141998">equals1</a></span><span class="op" id="4142106">,</span>&nbsp;<span class="ident" id="4142108"><a href="/crypto/rsa/rsa.go.html#4141916">i</a></span><span class="op" id="4142109">,</span>&nbsp;<span class="ident" id="4142111"><a href="/crypto/rsa/rsa.go.html#4141844">index</a></span><span class="op" id="4142116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4142120"><a href="/crypto/rsa/rsa.go.html#4141827">lookingForIndex</a></span>&nbsp;<span class="op" id="4142136">=</span>&nbsp;<span class="ident" id="4142138"><a href="/crypto/rsa/rsa.go.html#4127204">subtle</a></span><span class="op" id="4142144">.</span><span class="ident" id="4142145">ConstantTimeSelect</span><span class="op" id="4142163">(</span><span class="ident" id="4142164"><a href="/crypto/rsa/rsa.go.html#4141998">equals1</a></span><span class="op" id="4142171">,</span>&nbsp;<span class="num" id="4142173">0</span><span class="op" id="4142174">,</span>&nbsp;<span class="ident" id="4142176"><a href="/crypto/rsa/rsa.go.html#4141827">lookingForIndex</a></span><span class="op" id="4142191">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4142195"><a href="/crypto/rsa/rsa.go.html#4141851">invalid</a></span>&nbsp;<span class="op" id="4142203">=</span>&nbsp;<span class="ident" id="4142205"><a href="/crypto/rsa/rsa.go.html#4127204">subtle</a></span><span class="op" id="4142211">.</span><span class="ident" id="4142212">ConstantTimeSelect</span><span class="op" id="4142230">(</span><span class="ident" id="4142231"><a href="/crypto/rsa/rsa.go.html#4141827">lookingForIndex</a></span><span class="op" id="4142246">&amp;^</span><span class="ident" id="4142248"><a href="/crypto/rsa/rsa.go.html#4141947">equals0</a></span><span class="op" id="4142255">,</span>&nbsp;<span class="num" id="4142257">1</span><span class="op" id="4142258">,</span>&nbsp;<span class="ident" id="4142260"><a href="/crypto/rsa/rsa.go.html#4141851">invalid</a></span><span class="op" id="4142267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4142270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4142274">if</span>&nbsp;<span class="ident" id="4142277"><a href="/crypto/rsa/rsa.go.html#4141021">firstByteIsZero</a></span><span class="op" id="4142292">&amp;</span><span class="ident" id="4142293"><a href="/crypto/rsa/rsa.go.html#4141485">lHash2Good</a></span><span class="op" id="4142303">&amp;^</span><span class="ident" id="4142305"><a href="/crypto/rsa/rsa.go.html#4141851">invalid</a></span><span class="op" id="4142312">&amp;^</span><span class="ident" id="4142314"><a href="/crypto/rsa/rsa.go.html#4141827">lookingForIndex</a></span>&nbsp;<span class="op" id="4142330">!=</span>&nbsp;<span class="num" id="4142333">1</span>&nbsp;<span class="op" id="4142335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4142339"><a href="/crypto/rsa/rsa.go.html#4140326">err</a></span>&nbsp;<span class="op" id="4142343">=</span>&nbsp;<span class="ident" id="4142345"><a href="/crypto/rsa/rsa.go.html#4136391">ErrDecryption</a></span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4142361">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4142369">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4142373"><a href="/crypto/rsa/rsa.go.html#4140314">msg</a></span>&nbsp;<span class="op" id="4142377">=</span>&nbsp;<span class="ident" id="4142379"><a href="/crypto/rsa/rsa.go.html#4141885">rest</a></span><span class="op" id="4142383">[</span><span class="ident" id="4142384"><a href="/crypto/rsa/rsa.go.html#4141844">index</a></span><span class="op" id="4142389">+</span><span class="num" id="4142390">1</span><span class="op" id="4142391">:</span><span class="op" id="4142392">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4142395">return</span><br>
<span class="lineno">545</span><span class="op" id="4142402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4142405">//&nbsp;leftPad&nbsp;returns&nbsp;a&nbsp;new&nbsp;slice&nbsp;of&nbsp;length&nbsp;size.&nbsp;The&nbsp;contents&nbsp;of&nbsp;input&nbsp;are&nbsp;right</span><br>
<span class="lineno"></span><span class="comment" id="4142484">//&nbsp;aligned&nbsp;in&nbsp;the&nbsp;new&nbsp;slice.</span><br>
<span class="lineno"></span><span class="keyword" id="4142513">func</span>&nbsp;<span class="ident" id="4142518">leftPad</span><span class="op" id="4142525">(</span><span class="ident" id="4142526">input</span>&nbsp;<span class="op" id="4142532">[</span><span class="op" id="4142533">]</span><span class="builtintype" id="4142534">byte</span><span class="op" id="4142538">,</span>&nbsp;<span class="ident" id="4142540">size</span>&nbsp;<span class="builtintype" id="4142545">int</span><span class="op" id="4142548">)</span>&nbsp;<span class="op" id="4142550">(</span><span class="ident" id="4142551">out</span>&nbsp;<span class="op" id="4142555">[</span><span class="op" id="4142556">]</span><span class="builtintype" id="4142557">byte</span><span class="op" id="4142561">)</span>&nbsp;<span class="op" id="4142563">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4142566">n</span>&nbsp;<span class="op" id="4142568">:=</span>&nbsp;<span class="builtinfunc" id="4142571">len</span><span class="op" id="4142574">(</span><span class="ident" id="4142575"><a href="/crypto/rsa/rsa.go.html#4142526">input</a></span><span class="op" id="4142580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4142583">if</span>&nbsp;<span class="ident" id="4142586"><a href="/crypto/rsa/rsa.go.html#4142566">n</a></span>&nbsp;<span class="op" id="4142588">&gt;</span>&nbsp;<span class="ident" id="4142590"><a href="/crypto/rsa/rsa.go.html#4142540">size</a></span>&nbsp;<span class="op" id="4142595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4142599"><a href="/crypto/rsa/rsa.go.html#4142566">n</a></span>&nbsp;<span class="op" id="4142601">=</span>&nbsp;<span class="ident" id="4142603"><a href="/crypto/rsa/rsa.go.html#4142540">size</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4142609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4142612"><a href="/crypto/rsa/rsa.go.html#4142551">out</a></span>&nbsp;<span class="op" id="4142616">=</span>&nbsp;<span class="builtinfunc" id="4142618">make</span><span class="op" id="4142622">(</span><span class="op" id="4142623">[</span><span class="op" id="4142624">]</span><span class="builtintype" id="4142625">byte</span><span class="op" id="4142629">,</span>&nbsp;<span class="ident" id="4142631"><a href="/crypto/rsa/rsa.go.html#4142540">size</a></span><span class="op" id="4142635">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4142638">copy</span><span class="op" id="4142642">(</span><span class="ident" id="4142643"><a href="/crypto/rsa/rsa.go.html#4142551">out</a></span><span class="op" id="4142646">[</span><span class="builtinfunc" id="4142647">len</span><span class="op" id="4142650">(</span><span class="ident" id="4142651"><a href="/crypto/rsa/rsa.go.html#4142551">out</a></span><span class="op" id="4142654">)</span><span class="op" id="4142655">-</span><span class="ident" id="4142656"><a href="/crypto/rsa/rsa.go.html#4142566">n</a></span><span class="op" id="4142657">:</span><span class="op" id="4142658">]</span><span class="op" id="4142659">,</span>&nbsp;<span class="ident" id="4142661"><a href="/crypto/rsa/rsa.go.html#4142526">input</a></span><span class="op" id="4142666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4142669">return</span><br>
<span class="lineno"></span><span class="op" id="4142676">}</span>
</div>
</body>
</html>
