<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>regexp/syntax</h2>
<ul>
<li><a href="/gostd/regexp/syntax/compile.go.html">compile.go</a></li>
<li><a href="/gostd/regexp/syntax/doc.go.html">doc.go</a></li>
<li><a href="/gostd/regexp/syntax/parse.go.html">parse.go</a></li>
<li><a href="/gostd/regexp/syntax/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/regexp/syntax/perl_groups.go.html">perl_groups.go</a></li>
<li><a href="/gostd/regexp/syntax/prog.go.html">prog.go</a></li>
<li><a href="/gostd/regexp/syntax/prog_test.go.html">prog_test.go</a></li>
<li><a href="/gostd/regexp/syntax/regexp.go.html">regexp.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify.go.html">simplify.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify_test.go.html">simplify_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5622704">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5622760">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5622814">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5622865">package</span>&nbsp;<span class="ident" id="5622873">syntax</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5622881">//&nbsp;Simplify&nbsp;returns&nbsp;a&nbsp;regexp&nbsp;equivalent&nbsp;to&nbsp;re&nbsp;but&nbsp;without&nbsp;counted&nbsp;repetitions</span><br>
<span class="lineno"></span><span class="comment" id="5622959">//&nbsp;and&nbsp;with&nbsp;various&nbsp;other&nbsp;simplifications,&nbsp;such&nbsp;as&nbsp;rewriting&nbsp;/(?:a+)+/&nbsp;to&nbsp;/a+/.</span><br>
<span class="lineno"></span><span class="comment" id="5623039">//&nbsp;The&nbsp;resulting&nbsp;regexp&nbsp;will&nbsp;execute&nbsp;correctly&nbsp;but&nbsp;its&nbsp;string&nbsp;representation</span><br>
<span class="lineno">10</span><span class="comment" id="5623116">//&nbsp;will&nbsp;not&nbsp;produce&nbsp;the&nbsp;same&nbsp;parse&nbsp;tree,&nbsp;because&nbsp;capturing&nbsp;parentheses</span><br>
<span class="lineno"></span><span class="comment" id="5623187">//&nbsp;may&nbsp;have&nbsp;been&nbsp;duplicated&nbsp;or&nbsp;removed.&nbsp;&nbsp;For&nbsp;example,&nbsp;the&nbsp;simplified&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="5623261">//&nbsp;for&nbsp;/(x){1,2}/&nbsp;is&nbsp;/(x)(x)?/&nbsp;but&nbsp;both&nbsp;parentheses&nbsp;capture&nbsp;as&nbsp;$1.</span><br>
<span class="lineno"></span><span class="comment" id="5623328">//&nbsp;The&nbsp;returned&nbsp;regexp&nbsp;may&nbsp;share&nbsp;structure&nbsp;with&nbsp;or&nbsp;be&nbsp;the&nbsp;original.</span><br>
<span class="lineno"></span><span class="keyword" id="5623396">func</span>&nbsp;<span class="op" id="5623401">(</span><span class="ident" id="5623402">re</span>&nbsp;<span class="op" id="5623405">*</span><span class="ident" id="5623406">Regexp</span><span class="op" id="5623412">)</span>&nbsp;<span class="ident" id="5623414">Simplify</span><span class="op" id="5623422">(</span><span class="op" id="5623423">)</span>&nbsp;<span class="op" id="5623425">*</span><span class="ident" id="5623426">Regexp</span>&nbsp;<span class="op" id="5623433">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5623436">if</span>&nbsp;<span class="ident" id="5623439">re</span>&nbsp;<span class="op" id="5623442">==</span>&nbsp;<span class="ident" id="5623445">nil</span>&nbsp;<span class="op" id="5623449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5623453">return</span>&nbsp;<span class="ident" id="5623460">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5623465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5623468">switch</span>&nbsp;<span class="ident" id="5623475">re</span><span class="op" id="5623477">.</span><span class="ident" id="5623478">Op</span>&nbsp;<span class="op" id="5623481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5623484">case</span>&nbsp;<span class="ident" id="5623489">OpCapture</span><span class="op" id="5623498">,</span>&nbsp;<span class="ident" id="5623500">OpConcat</span><span class="op" id="5623508">,</span>&nbsp;<span class="ident" id="5623510">OpAlternate</span><span class="op" id="5623521">:</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5623525">//&nbsp;Simplify&nbsp;children,&nbsp;building&nbsp;new&nbsp;Regexp&nbsp;if&nbsp;children&nbsp;change.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5623589">nre</span>&nbsp;<span class="op" id="5623593">:=</span>&nbsp;<span class="ident" id="5623596">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5623601">for</span>&nbsp;<span class="ident" id="5623605">i</span><span class="op" id="5623606">,</span>&nbsp;<span class="ident" id="5623608">sub</span>&nbsp;<span class="op" id="5623612">:=</span>&nbsp;<span class="keyword" id="5623615">range</span>&nbsp;<span class="ident" id="5623621">re</span><span class="op" id="5623623">.</span><span class="ident" id="5623624">Sub</span>&nbsp;<span class="op" id="5623628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5623633">nsub</span>&nbsp;<span class="op" id="5623638">:=</span>&nbsp;<span class="ident" id="5623641">sub</span><span class="op" id="5623644">.</span><span class="ident" id="5623645">Simplify</span><span class="op" id="5623653">(</span><span class="op" id="5623654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5623659">if</span>&nbsp;<span class="ident" id="5623662">nre</span>&nbsp;<span class="op" id="5623666">==</span>&nbsp;<span class="ident" id="5623669">re</span>&nbsp;<span class="op" id="5623672">&amp;&amp;</span>&nbsp;<span class="ident" id="5623675">nsub</span>&nbsp;<span class="op" id="5623680">!=</span>&nbsp;<span class="ident" id="5623683">sub</span>&nbsp;<span class="op" id="5623687">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5623693">//&nbsp;Start&nbsp;a&nbsp;copy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5623714">nre</span>&nbsp;<span class="op" id="5623718">=</span>&nbsp;<span class="builtinfunc" id="5623720">new</span><span class="op" id="5623723">(</span><span class="ident" id="5623724">Regexp</span><span class="op" id="5623730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5623736">*</span><span class="ident" id="5623737">nre</span>&nbsp;<span class="op" id="5623741">=</span>&nbsp;<span class="op" id="5623743">*</span><span class="ident" id="5623744">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5623751">nre</span><span class="op" id="5623754">.</span><span class="ident" id="5623755">Rune</span>&nbsp;<span class="op" id="5623760">=</span>&nbsp;<span class="ident" id="5623762">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5623770">nre</span><span class="op" id="5623773">.</span><span class="ident" id="5623774">Sub</span>&nbsp;<span class="op" id="5623778">=</span>&nbsp;<span class="builtinfunc" id="5623780">append</span><span class="op" id="5623786">(</span><span class="ident" id="5623787">nre</span><span class="op" id="5623790">.</span><span class="ident" id="5623791">Sub0</span><span class="op" id="5623795">[</span><span class="op" id="5623796">:</span><span class="num" id="5623797">0</span><span class="op" id="5623798">]</span><span class="op" id="5623799">,</span>&nbsp;<span class="ident" id="5623801">re</span><span class="op" id="5623803">.</span><span class="ident" id="5623804">Sub</span><span class="op" id="5623807">[</span><span class="op" id="5623808">:</span><span class="ident" id="5623809">i</span><span class="op" id="5623810">]</span><span class="op" id="5623811">...</span><span class="op" id="5623814">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5623819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5623824">if</span>&nbsp;<span class="ident" id="5623827">nre</span>&nbsp;<span class="op" id="5623831">!=</span>&nbsp;<span class="ident" id="5623834">re</span>&nbsp;<span class="op" id="5623837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5623843">nre</span><span class="op" id="5623846">.</span><span class="ident" id="5623847">Sub</span>&nbsp;<span class="op" id="5623851">=</span>&nbsp;<span class="builtinfunc" id="5623853">append</span><span class="op" id="5623859">(</span><span class="ident" id="5623860">nre</span><span class="op" id="5623863">.</span><span class="ident" id="5623864">Sub</span><span class="op" id="5623867">,</span>&nbsp;<span class="ident" id="5623869">nsub</span><span class="op" id="5623873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5623878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5623882">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5623886">return</span>&nbsp;<span class="ident" id="5623893">nre</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5623899">case</span>&nbsp;<span class="ident" id="5623904">OpStar</span><span class="op" id="5623910">,</span>&nbsp;<span class="ident" id="5623912">OpPlus</span><span class="op" id="5623918">,</span>&nbsp;<span class="ident" id="5623920">OpQuest</span><span class="op" id="5623927">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5623931">sub</span>&nbsp;<span class="op" id="5623935">:=</span>&nbsp;<span class="ident" id="5623938">re</span><span class="op" id="5623940">.</span><span class="ident" id="5623941">Sub</span><span class="op" id="5623944">[</span><span class="num" id="5623945">0</span><span class="op" id="5623946">]</span><span class="op" id="5623947">.</span><span class="ident" id="5623948">Simplify</span><span class="op" id="5623956">(</span><span class="op" id="5623957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5623961">return</span>&nbsp;<span class="ident" id="5623968">simplify1</span><span class="op" id="5623977">(</span><span class="ident" id="5623978">re</span><span class="op" id="5623980">.</span><span class="ident" id="5623981">Op</span><span class="op" id="5623983">,</span>&nbsp;<span class="ident" id="5623985">re</span><span class="op" id="5623987">.</span><span class="ident" id="5623988">Flags</span><span class="op" id="5623993">,</span>&nbsp;<span class="ident" id="5623995">sub</span><span class="op" id="5623998">,</span>&nbsp;<span class="ident" id="5624000">re</span><span class="op" id="5624002">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5624006">case</span>&nbsp;<span class="ident" id="5624011">OpRepeat</span><span class="op" id="5624019">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5624023">//&nbsp;Special&nbsp;special&nbsp;case:&nbsp;x{0}&nbsp;matches&nbsp;the&nbsp;empty&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5624080">//&nbsp;and&nbsp;doesn&#39;t&nbsp;even&nbsp;need&nbsp;to&nbsp;consider&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5624122">if</span>&nbsp;<span class="ident" id="5624125">re</span><span class="op" id="5624127">.</span><span class="ident" id="5624128">Min</span>&nbsp;<span class="op" id="5624132">==</span>&nbsp;<span class="num" id="5624135">0</span>&nbsp;<span class="op" id="5624137">&amp;&amp;</span>&nbsp;<span class="ident" id="5624140">re</span><span class="op" id="5624142">.</span><span class="ident" id="5624143">Max</span>&nbsp;<span class="op" id="5624147">==</span>&nbsp;<span class="num" id="5624150">0</span>&nbsp;<span class="op" id="5624152">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5624157">return</span>&nbsp;<span class="op" id="5624164">&amp;</span><span class="ident" id="5624165">Regexp</span><span class="op" id="5624171">{</span><span class="ident" id="5624172">Op</span><span class="op" id="5624174">:</span>&nbsp;<span class="ident" id="5624176">OpEmptyMatch</span><span class="op" id="5624188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5624192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5624197">//&nbsp;The&nbsp;fun&nbsp;begins.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5624218">sub</span>&nbsp;<span class="op" id="5624222">:=</span>&nbsp;<span class="ident" id="5624225">re</span><span class="op" id="5624227">.</span><span class="ident" id="5624228">Sub</span><span class="op" id="5624231">[</span><span class="num" id="5624232">0</span><span class="op" id="5624233">]</span><span class="op" id="5624234">.</span><span class="ident" id="5624235">Simplify</span><span class="op" id="5624243">(</span><span class="op" id="5624244">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5624249">//&nbsp;x{n,}&nbsp;means&nbsp;at&nbsp;least&nbsp;n&nbsp;matches&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5624291">if</span>&nbsp;<span class="ident" id="5624294">re</span><span class="op" id="5624296">.</span><span class="ident" id="5624297">Max</span>&nbsp;<span class="op" id="5624301">==</span>&nbsp;<span class="op" id="5624304">-</span><span class="num" id="5624305">1</span>&nbsp;<span class="op" id="5624307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5624312">//&nbsp;Special&nbsp;case:&nbsp;x{0,}&nbsp;is&nbsp;x*.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5624345">if</span>&nbsp;<span class="ident" id="5624348">re</span><span class="op" id="5624350">.</span><span class="ident" id="5624351">Min</span>&nbsp;<span class="op" id="5624355">==</span>&nbsp;<span class="num" id="5624358">0</span>&nbsp;<span class="op" id="5624360">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5624366">return</span>&nbsp;<span class="ident" id="5624373">simplify1</span><span class="op" id="5624382">(</span><span class="ident" id="5624383">OpStar</span><span class="op" id="5624389">,</span>&nbsp;<span class="ident" id="5624391">re</span><span class="op" id="5624393">.</span><span class="ident" id="5624394">Flags</span><span class="op" id="5624399">,</span>&nbsp;<span class="ident" id="5624401">sub</span><span class="op" id="5624404">,</span>&nbsp;<span class="ident" id="5624406">nil</span><span class="op" id="5624409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5624414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5624420">//&nbsp;Special&nbsp;case:&nbsp;x{1,}&nbsp;is&nbsp;x+.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5624453">if</span>&nbsp;<span class="ident" id="5624456">re</span><span class="op" id="5624458">.</span><span class="ident" id="5624459">Min</span>&nbsp;<span class="op" id="5624463">==</span>&nbsp;<span class="num" id="5624466">1</span>&nbsp;<span class="op" id="5624468">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5624474">return</span>&nbsp;<span class="ident" id="5624481">simplify1</span><span class="op" id="5624490">(</span><span class="ident" id="5624491">OpPlus</span><span class="op" id="5624497">,</span>&nbsp;<span class="ident" id="5624499">re</span><span class="op" id="5624501">.</span><span class="ident" id="5624502">Flags</span><span class="op" id="5624507">,</span>&nbsp;<span class="ident" id="5624509">sub</span><span class="op" id="5624512">,</span>&nbsp;<span class="ident" id="5624514">nil</span><span class="op" id="5624517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5624522">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5624528">//&nbsp;General&nbsp;case:&nbsp;x{4,}&nbsp;is&nbsp;xxxx+.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5624564">nre</span>&nbsp;<span class="op" id="5624568">:=</span>&nbsp;<span class="op" id="5624571">&amp;</span><span class="ident" id="5624572">Regexp</span><span class="op" id="5624578">{</span><span class="ident" id="5624579">Op</span><span class="op" id="5624581">:</span>&nbsp;<span class="ident" id="5624583">OpConcat</span><span class="op" id="5624591">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5624596">nre</span><span class="op" id="5624599">.</span><span class="ident" id="5624600">Sub</span>&nbsp;<span class="op" id="5624604">=</span>&nbsp;<span class="ident" id="5624606">nre</span><span class="op" id="5624609">.</span><span class="ident" id="5624610">Sub0</span><span class="op" id="5624614">[</span><span class="op" id="5624615">:</span><span class="num" id="5624616">0</span><span class="op" id="5624617">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5624622">for</span>&nbsp;<span class="ident" id="5624626">i</span>&nbsp;<span class="op" id="5624628">:=</span>&nbsp;<span class="num" id="5624631">0</span><span class="op" id="5624632">;</span>&nbsp;<span class="ident" id="5624634">i</span>&nbsp;<span class="op" id="5624636">&lt;</span>&nbsp;<span class="ident" id="5624638">re</span><span class="op" id="5624640">.</span><span class="ident" id="5624641">Min</span><span class="op" id="5624644">-</span><span class="num" id="5624645">1</span><span class="op" id="5624646">;</span>&nbsp;<span class="ident" id="5624648">i</span><span class="op" id="5624649">++</span>&nbsp;<span class="op" id="5624652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5624658">nre</span><span class="op" id="5624661">.</span><span class="ident" id="5624662">Sub</span>&nbsp;<span class="op" id="5624666">=</span>&nbsp;<span class="builtinfunc" id="5624668">append</span><span class="op" id="5624674">(</span><span class="ident" id="5624675">nre</span><span class="op" id="5624678">.</span><span class="ident" id="5624679">Sub</span><span class="op" id="5624682">,</span>&nbsp;<span class="ident" id="5624684">sub</span><span class="op" id="5624687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5624692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5624697">nre</span><span class="op" id="5624700">.</span><span class="ident" id="5624701">Sub</span>&nbsp;<span class="op" id="5624705">=</span>&nbsp;<span class="builtinfunc" id="5624707">append</span><span class="op" id="5624713">(</span><span class="ident" id="5624714">nre</span><span class="op" id="5624717">.</span><span class="ident" id="5624718">Sub</span><span class="op" id="5624721">,</span>&nbsp;<span class="ident" id="5624723">simplify1</span><span class="op" id="5624732">(</span><span class="ident" id="5624733">OpPlus</span><span class="op" id="5624739">,</span>&nbsp;<span class="ident" id="5624741">re</span><span class="op" id="5624743">.</span><span class="ident" id="5624744">Flags</span><span class="op" id="5624749">,</span>&nbsp;<span class="ident" id="5624751">sub</span><span class="op" id="5624754">,</span>&nbsp;<span class="ident" id="5624756">nil</span><span class="op" id="5624759">)</span><span class="op" id="5624760">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5624765">return</span>&nbsp;<span class="ident" id="5624772">nre</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5624778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5624783">//&nbsp;Special&nbsp;case&nbsp;x{0}&nbsp;handled&nbsp;above.</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5624822">//&nbsp;Special&nbsp;case:&nbsp;x{1}&nbsp;is&nbsp;just&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5624857">if</span>&nbsp;<span class="ident" id="5624860">re</span><span class="op" id="5624862">.</span><span class="ident" id="5624863">Min</span>&nbsp;<span class="op" id="5624867">==</span>&nbsp;<span class="num" id="5624870">1</span>&nbsp;<span class="op" id="5624872">&amp;&amp;</span>&nbsp;<span class="ident" id="5624875">re</span><span class="op" id="5624877">.</span><span class="ident" id="5624878">Max</span>&nbsp;<span class="op" id="5624882">==</span>&nbsp;<span class="num" id="5624885">1</span>&nbsp;<span class="op" id="5624887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5624892">return</span>&nbsp;<span class="ident" id="5624899">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5624905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5624910">//&nbsp;General&nbsp;case:&nbsp;x{n,m}&nbsp;means&nbsp;n&nbsp;copies&nbsp;of&nbsp;x&nbsp;and&nbsp;m&nbsp;copies&nbsp;of&nbsp;x?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5624975">//&nbsp;The&nbsp;machine&nbsp;will&nbsp;do&nbsp;less&nbsp;work&nbsp;if&nbsp;we&nbsp;nest&nbsp;the&nbsp;final&nbsp;m&nbsp;copies,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5625041">//&nbsp;so&nbsp;that&nbsp;x{2,5}&nbsp;=&nbsp;xx(x(x(x)?)?)?</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5625079">//&nbsp;Build&nbsp;leading&nbsp;prefix:&nbsp;xx.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5625110">var</span>&nbsp;<span class="ident" id="5625114">prefix</span>&nbsp;<span class="op" id="5625121">*</span><span class="ident" id="5625122">Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5625131">if</span>&nbsp;<span class="ident" id="5625134">re</span><span class="op" id="5625136">.</span><span class="ident" id="5625137">Min</span>&nbsp;<span class="op" id="5625141">&gt;</span>&nbsp;<span class="num" id="5625143">0</span>&nbsp;<span class="op" id="5625145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5625150">prefix</span>&nbsp;<span class="op" id="5625157">=</span>&nbsp;<span class="op" id="5625159">&amp;</span><span class="ident" id="5625160">Regexp</span><span class="op" id="5625166">{</span><span class="ident" id="5625167">Op</span><span class="op" id="5625169">:</span>&nbsp;<span class="ident" id="5625171">OpConcat</span><span class="op" id="5625179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5625184">prefix</span><span class="op" id="5625190">.</span><span class="ident" id="5625191">Sub</span>&nbsp;<span class="op" id="5625195">=</span>&nbsp;<span class="ident" id="5625197">prefix</span><span class="op" id="5625203">.</span><span class="ident" id="5625204">Sub0</span><span class="op" id="5625208">[</span><span class="op" id="5625209">:</span><span class="num" id="5625210">0</span><span class="op" id="5625211">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5625216">for</span>&nbsp;<span class="ident" id="5625220">i</span>&nbsp;<span class="op" id="5625222">:=</span>&nbsp;<span class="num" id="5625225">0</span><span class="op" id="5625226">;</span>&nbsp;<span class="ident" id="5625228">i</span>&nbsp;<span class="op" id="5625230">&lt;</span>&nbsp;<span class="ident" id="5625232">re</span><span class="op" id="5625234">.</span><span class="ident" id="5625235">Min</span><span class="op" id="5625238">;</span>&nbsp;<span class="ident" id="5625240">i</span><span class="op" id="5625241">++</span>&nbsp;<span class="op" id="5625244">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5625250">prefix</span><span class="op" id="5625256">.</span><span class="ident" id="5625257">Sub</span>&nbsp;<span class="op" id="5625261">=</span>&nbsp;<span class="builtinfunc" id="5625263">append</span><span class="op" id="5625269">(</span><span class="ident" id="5625270">prefix</span><span class="op" id="5625276">.</span><span class="ident" id="5625277">Sub</span><span class="op" id="5625280">,</span>&nbsp;<span class="ident" id="5625282">sub</span><span class="op" id="5625285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5625290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5625294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5625299">//&nbsp;Build&nbsp;and&nbsp;attach&nbsp;suffix:&nbsp;(x(x(x)?)?)?</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5625342">if</span>&nbsp;<span class="ident" id="5625345">re</span><span class="op" id="5625347">.</span><span class="ident" id="5625348">Max</span>&nbsp;<span class="op" id="5625352">&gt;</span>&nbsp;<span class="ident" id="5625354">re</span><span class="op" id="5625356">.</span><span class="ident" id="5625357">Min</span>&nbsp;<span class="op" id="5625361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5625366">suffix</span>&nbsp;<span class="op" id="5625373">:=</span>&nbsp;<span class="ident" id="5625376">simplify1</span><span class="op" id="5625385">(</span><span class="ident" id="5625386">OpQuest</span><span class="op" id="5625393">,</span>&nbsp;<span class="ident" id="5625395">re</span><span class="op" id="5625397">.</span><span class="ident" id="5625398">Flags</span><span class="op" id="5625403">,</span>&nbsp;<span class="ident" id="5625405">sub</span><span class="op" id="5625408">,</span>&nbsp;<span class="ident" id="5625410">nil</span><span class="op" id="5625413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5625418">for</span>&nbsp;<span class="ident" id="5625422">i</span>&nbsp;<span class="op" id="5625424">:=</span>&nbsp;<span class="ident" id="5625427">re</span><span class="op" id="5625429">.</span><span class="ident" id="5625430">Min</span>&nbsp;<span class="op" id="5625434">+</span>&nbsp;<span class="num" id="5625436">1</span><span class="op" id="5625437">;</span>&nbsp;<span class="ident" id="5625439">i</span>&nbsp;<span class="op" id="5625441">&lt;</span>&nbsp;<span class="ident" id="5625443">re</span><span class="op" id="5625445">.</span><span class="ident" id="5625446">Max</span><span class="op" id="5625449">;</span>&nbsp;<span class="ident" id="5625451">i</span><span class="op" id="5625452">++</span>&nbsp;<span class="op" id="5625455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5625461">nre2</span>&nbsp;<span class="op" id="5625466">:=</span>&nbsp;<span class="op" id="5625469">&amp;</span><span class="ident" id="5625470">Regexp</span><span class="op" id="5625476">{</span><span class="ident" id="5625477">Op</span><span class="op" id="5625479">:</span>&nbsp;<span class="ident" id="5625481">OpConcat</span><span class="op" id="5625489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5625495">nre2</span><span class="op" id="5625499">.</span><span class="ident" id="5625500">Sub</span>&nbsp;<span class="op" id="5625504">=</span>&nbsp;<span class="builtinfunc" id="5625506">append</span><span class="op" id="5625512">(</span><span class="ident" id="5625513">nre2</span><span class="op" id="5625517">.</span><span class="ident" id="5625518">Sub0</span><span class="op" id="5625522">[</span><span class="op" id="5625523">:</span><span class="num" id="5625524">0</span><span class="op" id="5625525">]</span><span class="op" id="5625526">,</span>&nbsp;<span class="ident" id="5625528">sub</span><span class="op" id="5625531">,</span>&nbsp;<span class="ident" id="5625533">suffix</span><span class="op" id="5625539">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5625545">suffix</span>&nbsp;<span class="op" id="5625552">=</span>&nbsp;<span class="ident" id="5625554">simplify1</span><span class="op" id="5625563">(</span><span class="ident" id="5625564">OpQuest</span><span class="op" id="5625571">,</span>&nbsp;<span class="ident" id="5625573">re</span><span class="op" id="5625575">.</span><span class="ident" id="5625576">Flags</span><span class="op" id="5625581">,</span>&nbsp;<span class="ident" id="5625583">nre2</span><span class="op" id="5625587">,</span>&nbsp;<span class="ident" id="5625589">nil</span><span class="op" id="5625592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5625597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5625602">if</span>&nbsp;<span class="ident" id="5625605">prefix</span>&nbsp;<span class="op" id="5625612">==</span>&nbsp;<span class="ident" id="5625615">nil</span>&nbsp;<span class="op" id="5625619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5625625">return</span>&nbsp;<span class="ident" id="5625632">suffix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5625642">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5625647">prefix</span><span class="op" id="5625653">.</span><span class="ident" id="5625654">Sub</span>&nbsp;<span class="op" id="5625658">=</span>&nbsp;<span class="builtinfunc" id="5625660">append</span><span class="op" id="5625666">(</span><span class="ident" id="5625667">prefix</span><span class="op" id="5625673">.</span><span class="ident" id="5625674">Sub</span><span class="op" id="5625677">,</span>&nbsp;<span class="ident" id="5625679">suffix</span><span class="op" id="5625685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5625689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5625693">if</span>&nbsp;<span class="ident" id="5625696">prefix</span>&nbsp;<span class="op" id="5625703">!=</span>&nbsp;<span class="ident" id="5625706">nil</span>&nbsp;<span class="op" id="5625710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5625715">return</span>&nbsp;<span class="ident" id="5625722">prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5625731">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5625736">//&nbsp;Some&nbsp;degenerate&nbsp;case&nbsp;like&nbsp;min&nbsp;&gt;&nbsp;max&nbsp;or&nbsp;min&nbsp;&lt;&nbsp;max&nbsp;&lt;&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5625795">//&nbsp;Handle&nbsp;as&nbsp;impossible&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5625828">return</span>&nbsp;<span class="op" id="5625835">&amp;</span><span class="ident" id="5625836">Regexp</span><span class="op" id="5625842">{</span><span class="ident" id="5625843">Op</span><span class="op" id="5625845">:</span>&nbsp;<span class="ident" id="5625847">OpNoMatch</span><span class="op" id="5625856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5625859">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5625863">return</span>&nbsp;<span class="ident" id="5625870">re</span><br>
<span class="lineno"></span><span class="op" id="5625873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5625876">//&nbsp;simplify1&nbsp;implements&nbsp;Simplify&nbsp;for&nbsp;the&nbsp;unary&nbsp;OpStar,</span><br>
<span class="lineno">120</span><span class="comment" id="5625931">//&nbsp;OpPlus,&nbsp;and&nbsp;OpQuest&nbsp;operators.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;simple&nbsp;regexp</span><br>
<span class="lineno"></span><span class="comment" id="5625995">//&nbsp;equivalent&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5626012">//</span><br>
<span class="lineno"></span><span class="comment" id="5626015">//&nbsp;&nbsp;&nbsp;&nbspRegexp{Op:&nbsp;op,&nbsp;Flags:&nbsp;flags,&nbsp;Sub:&nbsp;{sub}}</span><br>
<span class="lineno"></span><span class="comment" id="5626059">//</span><br>
<span class="lineno">125</span><span class="comment" id="5626062">//&nbsp;under&nbsp;the&nbsp;assumption&nbsp;that&nbsp;sub&nbsp;is&nbsp;already&nbsp;simple,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5626118">//&nbsp;without&nbsp;first&nbsp;allocating&nbsp;that&nbsp;structure.&nbsp;&nbsp;If&nbsp;the&nbsp;regexp</span><br>
<span class="lineno"></span><span class="comment" id="5626177">//&nbsp;to&nbsp;be&nbsp;returned&nbsp;turns&nbsp;out&nbsp;to&nbsp;be&nbsp;equivalent&nbsp;to&nbsp;re,&nbsp;simplify1</span><br>
<span class="lineno"></span><span class="comment" id="5626239">//&nbsp;returns&nbsp;re&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="5626262">//</span><br>
<span class="lineno">130</span><span class="comment" id="5626265">//&nbsp;simplify1&nbsp;is&nbsp;factored&nbsp;out&nbsp;of&nbsp;Simplify&nbsp;because&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="5626333">//&nbsp;for&nbsp;other&nbsp;operators&nbsp;generates&nbsp;these&nbsp;unary&nbsp;expressions.</span><br>
<span class="lineno"></span><span class="comment" id="5626391">//&nbsp;Letting&nbsp;them&nbsp;call&nbsp;simplify1&nbsp;makes&nbsp;sure&nbsp;the&nbsp;expressions&nbsp;they</span><br>
<span class="lineno"></span><span class="comment" id="5626454">//&nbsp;generate&nbsp;are&nbsp;simple.</span><br>
<span class="lineno"></span><span class="keyword" id="5626478">func</span>&nbsp;<span class="ident" id="5626483">simplify1</span><span class="op" id="5626492">(</span><span class="ident" id="5626493">op</span>&nbsp;<span class="ident" id="5626496">Op</span><span class="op" id="5626498">,</span>&nbsp;<span class="ident" id="5626500">flags</span>&nbsp;<span class="ident" id="5626506">Flags</span><span class="op" id="5626511">,</span>&nbsp;<span class="ident" id="5626513">sub</span><span class="op" id="5626516">,</span>&nbsp;<span class="ident" id="5626518">re</span>&nbsp;<span class="op" id="5626521">*</span><span class="ident" id="5626522">Regexp</span><span class="op" id="5626528">)</span>&nbsp;<span class="op" id="5626530">*</span><span class="ident" id="5626531">Regexp</span>&nbsp;<span class="op" id="5626538">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5626541">//&nbsp;Special&nbsp;case:&nbsp;repeat&nbsp;the&nbsp;empty&nbsp;string&nbsp;as&nbsp;much&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5626594">//&nbsp;you&nbsp;want,&nbsp;but&nbsp;it&#39;s&nbsp;still&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5626641">if</span>&nbsp;<span class="ident" id="5626644">sub</span><span class="op" id="5626647">.</span><span class="ident" id="5626648">Op</span>&nbsp;<span class="op" id="5626651">==</span>&nbsp;<span class="ident" id="5626654">OpEmptyMatch</span>&nbsp;<span class="op" id="5626667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5626671">return</span>&nbsp;<span class="ident" id="5626678">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5626683">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5626686">//&nbsp;The&nbsp;operators&nbsp;are&nbsp;idempotent&nbsp;if&nbsp;the&nbsp;flags&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5626739">if</span>&nbsp;<span class="ident" id="5626742">op</span>&nbsp;<span class="op" id="5626745">==</span>&nbsp;<span class="ident" id="5626748">sub</span><span class="op" id="5626751">.</span><span class="ident" id="5626752">Op</span>&nbsp;<span class="op" id="5626755">&amp;&amp;</span>&nbsp;<span class="ident" id="5626758">flags</span><span class="op" id="5626763">&amp;</span><span class="ident" id="5626764">NonGreedy</span>&nbsp;<span class="op" id="5626774">==</span>&nbsp;<span class="ident" id="5626777">sub</span><span class="op" id="5626780">.</span><span class="ident" id="5626781">Flags</span><span class="op" id="5626786">&amp;</span><span class="ident" id="5626787">NonGreedy</span>&nbsp;<span class="op" id="5626797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5626801">return</span>&nbsp;<span class="ident" id="5626808">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5626813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5626816">if</span>&nbsp;<span class="ident" id="5626819">re</span>&nbsp;<span class="op" id="5626822">!=</span>&nbsp;<span class="ident" id="5626825">nil</span>&nbsp;<span class="op" id="5626829">&amp;&amp;</span>&nbsp;<span class="ident" id="5626832">re</span><span class="op" id="5626834">.</span><span class="ident" id="5626835">Op</span>&nbsp;<span class="op" id="5626838">==</span>&nbsp;<span class="ident" id="5626841">op</span>&nbsp;<span class="op" id="5626844">&amp;&amp;</span>&nbsp;<span class="ident" id="5626847">re</span><span class="op" id="5626849">.</span><span class="ident" id="5626850">Flags</span><span class="op" id="5626855">&amp;</span><span class="ident" id="5626856">NonGreedy</span>&nbsp;<span class="op" id="5626866">==</span>&nbsp;<span class="ident" id="5626869">flags</span><span class="op" id="5626874">&amp;</span><span class="ident" id="5626875">NonGreedy</span>&nbsp;<span class="op" id="5626885">&amp;&amp;</span>&nbsp;<span class="ident" id="5626888">sub</span>&nbsp;<span class="op" id="5626892">==</span>&nbsp;<span class="ident" id="5626895">re</span><span class="op" id="5626897">.</span><span class="ident" id="5626898">Sub</span><span class="op" id="5626901">[</span><span class="num" id="5626902">0</span><span class="op" id="5626903">]</span>&nbsp;<span class="op" id="5626905">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5626909">return</span>&nbsp;<span class="ident" id="5626916">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5626920">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5626924">re</span>&nbsp;<span class="op" id="5626927">=</span>&nbsp;<span class="op" id="5626929">&amp;</span><span class="ident" id="5626930">Regexp</span><span class="op" id="5626936">{</span><span class="ident" id="5626937">Op</span><span class="op" id="5626939">:</span>&nbsp;<span class="ident" id="5626941">op</span><span class="op" id="5626943">,</span>&nbsp;<span class="ident" id="5626945">Flags</span><span class="op" id="5626950">:</span>&nbsp;<span class="ident" id="5626952">flags</span><span class="op" id="5626957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5626960">re</span><span class="op" id="5626962">.</span><span class="ident" id="5626963">Sub</span>&nbsp;<span class="op" id="5626967">=</span>&nbsp;<span class="builtinfunc" id="5626969">append</span><span class="op" id="5626975">(</span><span class="ident" id="5626976">re</span><span class="op" id="5626978">.</span><span class="ident" id="5626979">Sub0</span><span class="op" id="5626983">[</span><span class="op" id="5626984">:</span><span class="num" id="5626985">0</span><span class="op" id="5626986">]</span><span class="op" id="5626987">,</span>&nbsp;<span class="ident" id="5626989">sub</span><span class="op" id="5626992">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5626995">return</span>&nbsp;<span class="ident" id="5627002">re</span><br>
<span class="lineno"></span><span class="op" id="5627005">}</span>
</div>
</body>
</html>
