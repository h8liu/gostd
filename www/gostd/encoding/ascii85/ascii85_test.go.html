<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/ascii85</h2>
<ul>
<li><a href="/gostd/encoding/ascii85/ascii85.go.html">ascii85.go</a></li>
<li><a href="/gostd/encoding/ascii85/ascii85_test.go.html" class="current">ascii85_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8083417">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8083472">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8083526">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8083577">package</span>&nbsp;<span class="ident" id="8083585">ascii85</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8083594">import</span>&nbsp;<span class="op" id="8083601">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8083604">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8083613">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8083619">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8083632">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8083643">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8083653">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="8083656">type</span>&nbsp;<span class="ident" id="8083661">testpair</span>&nbsp;<span class="keyword" id="8083670">struct</span>&nbsp;<span class="op" id="8083677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8083680">decoded</span><span class="op" id="8083687">,</span>&nbsp;<span class="ident" id="8083689">encoded</span>&nbsp;<span class="builtintype" id="8083697">string</span><br>
<span class="lineno"></span><span class="op" id="8083704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8083707">var</span>&nbsp;<span class="ident" id="8083711">pairs</span>&nbsp;<span class="op" id="8083717">=</span>&nbsp;<span class="op" id="8083719">[</span><span class="op" id="8083720">]</span><span class="ident" id="8083721">testpair</span><span class="op" id="8083729">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8083732">//&nbsp;Encode&nbsp;returns&nbsp;0&nbsp;when&nbsp;len(src)&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8083772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8083776">&#34;&#34;</span><span class="op" id="8083778">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8083782">&#34;&#34;</span><span class="op" id="8083784">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8083787">}</span><span class="op" id="8083788">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8083791">//&nbsp;Wikipedia&nbsp;example</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8083813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8083817">&#34;Man&nbsp;is&nbsp;distinguished,&nbsp;not&nbsp;only&nbsp;by&nbsp;his&nbsp;reason,&nbsp;but&nbsp;by&nbsp;this&nbsp;singular&nbsp;passion&nbsp;from&nbsp;&#34;</span>&nbsp;<span class="op" id="8083900">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8083905">&#34;other&nbsp;animals,&nbsp;which&nbsp;is&nbsp;a&nbsp;lust&nbsp;of&nbsp;the&nbsp;mind,&nbsp;that&nbsp;by&nbsp;a&nbsp;perseverance&nbsp;of&nbsp;delight&nbsp;in&nbsp;&#34;</span>&nbsp;<span class="op" id="8083989">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8083994">&#34;the&nbsp;continued&nbsp;and&nbsp;indefatigable&nbsp;generation&nbsp;of&nbsp;knowledge,&nbsp;exceeds&nbsp;the&nbsp;short&nbsp;&#34;</span>&nbsp;<span class="op" id="8084072">+</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8084077">&#34;vehemence&nbsp;of&nbsp;any&nbsp;carnal&nbsp;pleasure.&#34;</span><span class="op" id="8084112">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8084116">&#34;9jqo^BlbD-BleB1DJ+*+F(f,q/0JhKF&lt;GL&gt;Cj@.4Gp$d7F!,L7@&lt;6@)/0JDEF&lt;G%&lt;+EV:2F!,\n&#34;</span>&nbsp;<span class="op" id="8084194">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8084199">&#34;O&lt;DJ+*.@&lt;*K0@&lt;6L(Df-\\0Ec5e;DffZ(EZee.Bl.9pF\&#34;AGXBPCsi+DGm&gt;@3BB/F*&amp;OCAfu2/AKY\n&#34;</span>&nbsp;<span class="op" id="8084281">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8084286">&#34;i(DIb:@FD,*)+C]U=@3BN#EcYf8ATD3s@q?d$AftVqCh[NqF&lt;G:8+EV:.+Cf&gt;-FD5W8ARlolDIa\n&#34;</span>&nbsp;<span class="op" id="8084366">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8084371">&#34;l(DId&lt;j@&lt;?3r@:F%a+D58&#39;ATD4$Bl@l3De:,-DJs`8ARoFb/0JMK@qB4^F!,R&lt;AKZ&amp;-DfTqBG%G\n&#34;</span>&nbsp;<span class="op" id="8084451">+</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8084456">&#34;&gt;uD.RTpAKYo&#39;+CT/5+Cei#DII?(E,9)oF*2M7/c\n&#34;</span><span class="op" id="8084499">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8084502">}</span><span class="op" id="8084503">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8084506">//&nbsp;Special&nbsp;case&nbsp;when&nbsp;shortening&nbsp;!!!!!&nbsp;to&nbsp;z.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8084551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8084555">&#34;\000\000\000\000&#34;</span><span class="op" id="8084573">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8084577">&#34;z&#34;</span><span class="op" id="8084580">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8084583">}</span><span class="op" id="8084584">,</span><br>
<span class="lineno"></span><span class="op" id="8084586">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8084589">var</span>&nbsp;<span class="ident" id="8084593">bigtest</span>&nbsp;<span class="op" id="8084601">=</span>&nbsp;<span class="ident" id="8084603">pairs</span><span class="op" id="8084608">[</span><span class="builtinfunc" id="8084609">len</span><span class="op" id="8084612">(</span><span class="ident" id="8084613">pairs</span><span class="op" id="8084618">)</span><span class="op" id="8084619">-</span><span class="num" id="8084620">1</span><span class="op" id="8084621">]</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="8084624">func</span>&nbsp;<span class="ident" id="8084629">testEqual</span><span class="op" id="8084638">(</span><span class="ident" id="8084639">t</span>&nbsp;<span class="op" id="8084641">*</span><span class="ident" id="8084642">testing</span><span class="op" id="8084649">.</span><span class="ident" id="8084650">T</span><span class="op" id="8084651">,</span>&nbsp;<span class="ident" id="8084653">msg</span>&nbsp;<span class="builtintype" id="8084657">string</span><span class="op" id="8084663">,</span>&nbsp;<span class="ident" id="8084665">args</span>&nbsp;<span class="op" id="8084670">...</span><span class="keyword" id="8084673">interface</span><span class="op" id="8084682">{</span><span class="op" id="8084683">}</span><span class="op" id="8084684">)</span>&nbsp;<span class="builtintype" id="8084686">bool</span>&nbsp;<span class="op" id="8084691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8084694">if</span>&nbsp;<span class="ident" id="8084697">args</span><span class="op" id="8084701">[</span><span class="builtinfunc" id="8084702">len</span><span class="op" id="8084705">(</span><span class="ident" id="8084706">args</span><span class="op" id="8084710">)</span><span class="op" id="8084711">-</span><span class="num" id="8084712">2</span><span class="op" id="8084713">]</span>&nbsp;<span class="op" id="8084715">!=</span>&nbsp;<span class="ident" id="8084718">args</span><span class="op" id="8084722">[</span><span class="builtinfunc" id="8084723">len</span><span class="op" id="8084726">(</span><span class="ident" id="8084727">args</span><span class="op" id="8084731">)</span><span class="op" id="8084732">-</span><span class="num" id="8084733">1</span><span class="op" id="8084734">]</span>&nbsp;<span class="op" id="8084736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8084740">t</span><span class="op" id="8084741">.</span><span class="ident" id="8084742">Errorf</span><span class="op" id="8084748">(</span><span class="ident" id="8084749">msg</span><span class="op" id="8084752">,</span>&nbsp;<span class="ident" id="8084754">args</span><span class="op" id="8084758">...</span><span class="op" id="8084761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8084765">return</span>&nbsp;<span class="builtintype" id="8084772">false</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8084779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8084782">return</span>&nbsp;<span class="builtintype" id="8084789">true</span><br>
<span class="lineno"></span><span class="op" id="8084794">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8084797">func</span>&nbsp;<span class="ident" id="8084802">strip85</span><span class="op" id="8084809">(</span><span class="ident" id="8084810">s</span>&nbsp;<span class="builtintype" id="8084812">string</span><span class="op" id="8084818">)</span>&nbsp;<span class="builtintype" id="8084820">string</span>&nbsp;<span class="op" id="8084827">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8084830">t</span>&nbsp;<span class="op" id="8084832">:=</span>&nbsp;<span class="builtinfunc" id="8084835">make</span><span class="op" id="8084839">(</span><span class="op" id="8084840">[</span><span class="op" id="8084841">]</span><span class="builtintype" id="8084842">byte</span><span class="op" id="8084846">,</span>&nbsp;<span class="builtinfunc" id="8084848">len</span><span class="op" id="8084851">(</span><span class="ident" id="8084852">s</span><span class="op" id="8084853">)</span><span class="op" id="8084854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8084857">w</span>&nbsp;<span class="op" id="8084859">:=</span>&nbsp;<span class="num" id="8084862">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8084865">for</span>&nbsp;<span class="ident" id="8084869">r</span>&nbsp;<span class="op" id="8084871">:=</span>&nbsp;<span class="num" id="8084874">0</span><span class="op" id="8084875">;</span>&nbsp;<span class="ident" id="8084877">r</span>&nbsp;<span class="op" id="8084879">&lt;</span>&nbsp;<span class="builtinfunc" id="8084881">len</span><span class="op" id="8084884">(</span><span class="ident" id="8084885">s</span><span class="op" id="8084886">)</span><span class="op" id="8084887">;</span>&nbsp;<span class="ident" id="8084889">r</span><span class="op" id="8084890">++</span>&nbsp;<span class="op" id="8084893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8084897">c</span>&nbsp;<span class="op" id="8084899">:=</span>&nbsp;<span class="ident" id="8084902">s</span><span class="op" id="8084903">[</span><span class="ident" id="8084904">r</span><span class="op" id="8084905">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8084909">if</span>&nbsp;<span class="ident" id="8084912">c</span>&nbsp;<span class="op" id="8084914">&gt;</span>&nbsp;<span class="string" id="8084916">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="8084920">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8084925">t</span><span class="op" id="8084926">[</span><span class="ident" id="8084927">w</span><span class="op" id="8084928">]</span>&nbsp;<span class="op" id="8084930">=</span>&nbsp;<span class="ident" id="8084932">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8084937">w</span><span class="op" id="8084938">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8084943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8084946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8084949">return</span>&nbsp;<span class="builtintype" id="8084956">string</span><span class="op" id="8084962">(</span><span class="ident" id="8084963">t</span><span class="op" id="8084964">[</span><span class="num" id="8084965">0</span><span class="op" id="8084966">:</span><span class="ident" id="8084967">w</span><span class="op" id="8084968">]</span><span class="op" id="8084969">)</span><br>
<span class="lineno">65</span><span class="op" id="8084971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8084974">func</span>&nbsp;<span class="ident" id="8084979">TestEncode</span><span class="op" id="8084989">(</span><span class="ident" id="8084990">t</span>&nbsp;<span class="op" id="8084992">*</span><span class="ident" id="8084993">testing</span><span class="op" id="8085000">.</span><span class="ident" id="8085001">T</span><span class="op" id="8085002">)</span>&nbsp;<span class="op" id="8085004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8085007">for</span>&nbsp;<span class="ident" id="8085011">_</span><span class="op" id="8085012">,</span>&nbsp;<span class="ident" id="8085014">p</span>&nbsp;<span class="op" id="8085016">:=</span>&nbsp;<span class="keyword" id="8085019">range</span>&nbsp;<span class="ident" id="8085025">pairs</span>&nbsp;<span class="op" id="8085031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8085035">buf</span>&nbsp;<span class="op" id="8085039">:=</span>&nbsp;<span class="builtinfunc" id="8085042">make</span><span class="op" id="8085046">(</span><span class="op" id="8085047">[</span><span class="op" id="8085048">]</span><span class="builtintype" id="8085049">byte</span><span class="op" id="8085053">,</span>&nbsp;<span class="ident" id="8085055">MaxEncodedLen</span><span class="op" id="8085068">(</span><span class="builtinfunc" id="8085069">len</span><span class="op" id="8085072">(</span><span class="ident" id="8085073">p</span><span class="op" id="8085074">.</span><span class="ident" id="8085075">decoded</span><span class="op" id="8085082">)</span><span class="op" id="8085083">)</span><span class="op" id="8085084">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8085088">n</span>&nbsp;<span class="op" id="8085090">:=</span>&nbsp;<span class="ident" id="8085093">Encode</span><span class="op" id="8085099">(</span><span class="ident" id="8085100">buf</span><span class="op" id="8085103">,</span>&nbsp;<span class="op" id="8085105">[</span><span class="op" id="8085106">]</span><span class="builtintype" id="8085107">byte</span><span class="op" id="8085111">(</span><span class="ident" id="8085112">p</span><span class="op" id="8085113">.</span><span class="ident" id="8085114">decoded</span><span class="op" id="8085121">)</span><span class="op" id="8085122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8085126">buf</span>&nbsp;<span class="op" id="8085130">=</span>&nbsp;<span class="ident" id="8085132">buf</span><span class="op" id="8085135">[</span><span class="num" id="8085136">0</span><span class="op" id="8085137">:</span><span class="ident" id="8085138">n</span><span class="op" id="8085139">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8085143">testEqual</span><span class="op" id="8085152">(</span><span class="ident" id="8085153">t</span><span class="op" id="8085154">,</span>&nbsp;<span class="string" id="8085156">&#34;Encode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8085182">,</span>&nbsp;<span class="ident" id="8085184">p</span><span class="op" id="8085185">.</span><span class="ident" id="8085186">decoded</span><span class="op" id="8085193">,</span>&nbsp;<span class="ident" id="8085195">strip85</span><span class="op" id="8085202">(</span><span class="builtintype" id="8085203">string</span><span class="op" id="8085209">(</span><span class="ident" id="8085210">buf</span><span class="op" id="8085213">)</span><span class="op" id="8085214">)</span><span class="op" id="8085215">,</span>&nbsp;<span class="ident" id="8085217">strip85</span><span class="op" id="8085224">(</span><span class="ident" id="8085225">p</span><span class="op" id="8085226">.</span><span class="ident" id="8085227">encoded</span><span class="op" id="8085234">)</span><span class="op" id="8085235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8085238">}</span><br>
<span class="lineno"></span><span class="op" id="8085240">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="8085243">func</span>&nbsp;<span class="ident" id="8085248">TestEncoder</span><span class="op" id="8085259">(</span><span class="ident" id="8085260">t</span>&nbsp;<span class="op" id="8085262">*</span><span class="ident" id="8085263">testing</span><span class="op" id="8085270">.</span><span class="ident" id="8085271">T</span><span class="op" id="8085272">)</span>&nbsp;<span class="op" id="8085274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8085277">for</span>&nbsp;<span class="ident" id="8085281">_</span><span class="op" id="8085282">,</span>&nbsp;<span class="ident" id="8085284">p</span>&nbsp;<span class="op" id="8085286">:=</span>&nbsp;<span class="keyword" id="8085289">range</span>&nbsp;<span class="ident" id="8085295">pairs</span>&nbsp;<span class="op" id="8085301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8085305">bb</span>&nbsp;<span class="op" id="8085308">:=</span>&nbsp;<span class="op" id="8085311">&amp;</span><span class="ident" id="8085312">bytes</span><span class="op" id="8085317">.</span><span class="ident" id="8085318">Buffer</span><span class="op" id="8085324">{</span><span class="op" id="8085325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8085329">encoder</span>&nbsp;<span class="op" id="8085337">:=</span>&nbsp;<span class="ident" id="8085340">NewEncoder</span><span class="op" id="8085350">(</span><span class="ident" id="8085351">bb</span><span class="op" id="8085353">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8085357">encoder</span><span class="op" id="8085364">.</span><span class="ident" id="8085365">Write</span><span class="op" id="8085370">(</span><span class="op" id="8085371">[</span><span class="op" id="8085372">]</span><span class="builtintype" id="8085373">byte</span><span class="op" id="8085377">(</span><span class="ident" id="8085378">p</span><span class="op" id="8085379">.</span><span class="ident" id="8085380">decoded</span><span class="op" id="8085387">)</span><span class="op" id="8085388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8085392">encoder</span><span class="op" id="8085399">.</span><span class="ident" id="8085400">Close</span><span class="op" id="8085405">(</span><span class="op" id="8085406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8085410">testEqual</span><span class="op" id="8085419">(</span><span class="ident" id="8085420">t</span><span class="op" id="8085421">,</span>&nbsp;<span class="string" id="8085423">&#34;Encode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8085449">,</span>&nbsp;<span class="ident" id="8085451">p</span><span class="op" id="8085452">.</span><span class="ident" id="8085453">decoded</span><span class="op" id="8085460">,</span>&nbsp;<span class="ident" id="8085462">strip85</span><span class="op" id="8085469">(</span><span class="ident" id="8085470">bb</span><span class="op" id="8085472">.</span><span class="ident" id="8085473">String</span><span class="op" id="8085479">(</span><span class="op" id="8085480">)</span><span class="op" id="8085481">)</span><span class="op" id="8085482">,</span>&nbsp;<span class="ident" id="8085484">strip85</span><span class="op" id="8085491">(</span><span class="ident" id="8085492">p</span><span class="op" id="8085493">.</span><span class="ident" id="8085494">encoded</span><span class="op" id="8085501">)</span><span class="op" id="8085502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8085505">}</span><br>
<span class="lineno"></span><span class="op" id="8085507">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="8085510">func</span>&nbsp;<span class="ident" id="8085515">TestEncoderBuffering</span><span class="op" id="8085535">(</span><span class="ident" id="8085536">t</span>&nbsp;<span class="op" id="8085538">*</span><span class="ident" id="8085539">testing</span><span class="op" id="8085546">.</span><span class="ident" id="8085547">T</span><span class="op" id="8085548">)</span>&nbsp;<span class="op" id="8085550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8085553">input</span>&nbsp;<span class="op" id="8085559">:=</span>&nbsp;<span class="op" id="8085562">[</span><span class="op" id="8085563">]</span><span class="builtintype" id="8085564">byte</span><span class="op" id="8085568">(</span><span class="ident" id="8085569">bigtest</span><span class="op" id="8085576">.</span><span class="ident" id="8085577">decoded</span><span class="op" id="8085584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8085587">for</span>&nbsp;<span class="ident" id="8085591">bs</span>&nbsp;<span class="op" id="8085594">:=</span>&nbsp;<span class="num" id="8085597">1</span><span class="op" id="8085598">;</span>&nbsp;<span class="ident" id="8085600">bs</span>&nbsp;<span class="op" id="8085603">&lt;=</span>&nbsp;<span class="num" id="8085606">12</span><span class="op" id="8085608">;</span>&nbsp;<span class="ident" id="8085610">bs</span><span class="op" id="8085612">++</span>&nbsp;<span class="op" id="8085615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8085619">bb</span>&nbsp;<span class="op" id="8085622">:=</span>&nbsp;<span class="op" id="8085625">&amp;</span><span class="ident" id="8085626">bytes</span><span class="op" id="8085631">.</span><span class="ident" id="8085632">Buffer</span><span class="op" id="8085638">{</span><span class="op" id="8085639">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8085643">encoder</span>&nbsp;<span class="op" id="8085651">:=</span>&nbsp;<span class="ident" id="8085654">NewEncoder</span><span class="op" id="8085664">(</span><span class="ident" id="8085665">bb</span><span class="op" id="8085667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8085671">for</span>&nbsp;<span class="ident" id="8085675">pos</span>&nbsp;<span class="op" id="8085679">:=</span>&nbsp;<span class="num" id="8085682">0</span><span class="op" id="8085683">;</span>&nbsp;<span class="ident" id="8085685">pos</span>&nbsp;<span class="op" id="8085689">&lt;</span>&nbsp;<span class="builtinfunc" id="8085691">len</span><span class="op" id="8085694">(</span><span class="ident" id="8085695">input</span><span class="op" id="8085700">)</span><span class="op" id="8085701">;</span>&nbsp;<span class="ident" id="8085703">pos</span>&nbsp;<span class="op" id="8085707">+=</span>&nbsp;<span class="ident" id="8085710">bs</span>&nbsp;<span class="op" id="8085713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8085718">end</span>&nbsp;<span class="op" id="8085722">:=</span>&nbsp;<span class="ident" id="8085725">pos</span>&nbsp;<span class="op" id="8085729">+</span>&nbsp;<span class="ident" id="8085731">bs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8085737">if</span>&nbsp;<span class="ident" id="8085740">end</span>&nbsp;<span class="op" id="8085744">&gt;</span>&nbsp;<span class="builtinfunc" id="8085746">len</span><span class="op" id="8085749">(</span><span class="ident" id="8085750">input</span><span class="op" id="8085755">)</span>&nbsp;<span class="op" id="8085757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8085763">end</span>&nbsp;<span class="op" id="8085767">=</span>&nbsp;<span class="builtinfunc" id="8085769">len</span><span class="op" id="8085772">(</span><span class="ident" id="8085773">input</span><span class="op" id="8085778">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8085783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8085788">n</span><span class="op" id="8085789">,</span>&nbsp;<span class="ident" id="8085791">err</span>&nbsp;<span class="op" id="8085795">:=</span>&nbsp;<span class="ident" id="8085798">encoder</span><span class="op" id="8085805">.</span><span class="ident" id="8085806">Write</span><span class="op" id="8085811">(</span><span class="ident" id="8085812">input</span><span class="op" id="8085817">[</span><span class="ident" id="8085818">pos</span><span class="op" id="8085821">:</span><span class="ident" id="8085822">end</span><span class="op" id="8085825">]</span><span class="op" id="8085826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8085831">testEqual</span><span class="op" id="8085840">(</span><span class="ident" id="8085841">t</span><span class="op" id="8085842">,</span>&nbsp;<span class="string" id="8085844">&#34;Write(%q)&nbsp;gave&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8085878">,</span>&nbsp;<span class="ident" id="8085880">input</span><span class="op" id="8085885">[</span><span class="ident" id="8085886">pos</span><span class="op" id="8085889">:</span><span class="ident" id="8085890">end</span><span class="op" id="8085893">]</span><span class="op" id="8085894">,</span>&nbsp;<span class="ident" id="8085896">err</span><span class="op" id="8085899">,</span>&nbsp;<span class="builtintype" id="8085901">error</span><span class="op" id="8085906">(</span><span class="ident" id="8085907">nil</span><span class="op" id="8085910">)</span><span class="op" id="8085911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8085916">testEqual</span><span class="op" id="8085925">(</span><span class="ident" id="8085926">t</span><span class="op" id="8085927">,</span>&nbsp;<span class="string" id="8085929">&#34;Write(%q)&nbsp;gave&nbsp;length&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8085964">,</span>&nbsp;<span class="ident" id="8085966">input</span><span class="op" id="8085971">[</span><span class="ident" id="8085972">pos</span><span class="op" id="8085975">:</span><span class="ident" id="8085976">end</span><span class="op" id="8085979">]</span><span class="op" id="8085980">,</span>&nbsp;<span class="ident" id="8085982">n</span><span class="op" id="8085983">,</span>&nbsp;<span class="ident" id="8085985">end</span><span class="op" id="8085988">-</span><span class="ident" id="8085989">pos</span><span class="op" id="8085992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8085996">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8086000">err</span>&nbsp;<span class="op" id="8086004">:=</span>&nbsp;<span class="ident" id="8086007">encoder</span><span class="op" id="8086014">.</span><span class="ident" id="8086015">Close</span><span class="op" id="8086020">(</span><span class="op" id="8086021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8086025">testEqual</span><span class="op" id="8086034">(</span><span class="ident" id="8086035">t</span><span class="op" id="8086036">,</span>&nbsp;<span class="string" id="8086038">&#34;Close&nbsp;gave&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8086068">,</span>&nbsp;<span class="ident" id="8086070">err</span><span class="op" id="8086073">,</span>&nbsp;<span class="builtintype" id="8086075">error</span><span class="op" id="8086080">(</span><span class="ident" id="8086081">nil</span><span class="op" id="8086084">)</span><span class="op" id="8086085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8086089">testEqual</span><span class="op" id="8086098">(</span><span class="ident" id="8086099">t</span><span class="op" id="8086100">,</span>&nbsp;<span class="string" id="8086102">&#34;Encoding/%d&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8086135">,</span>&nbsp;<span class="ident" id="8086137">bs</span><span class="op" id="8086139">,</span>&nbsp;<span class="ident" id="8086141">bigtest</span><span class="op" id="8086148">.</span><span class="ident" id="8086149">decoded</span><span class="op" id="8086156">,</span>&nbsp;<span class="ident" id="8086158">strip85</span><span class="op" id="8086165">(</span><span class="ident" id="8086166">bb</span><span class="op" id="8086168">.</span><span class="ident" id="8086169">String</span><span class="op" id="8086175">(</span><span class="op" id="8086176">)</span><span class="op" id="8086177">)</span><span class="op" id="8086178">,</span>&nbsp;<span class="ident" id="8086180">strip85</span><span class="op" id="8086187">(</span><span class="ident" id="8086188">bigtest</span><span class="op" id="8086195">.</span><span class="ident" id="8086196">encoded</span><span class="op" id="8086203">)</span><span class="op" id="8086204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8086207">}</span><br>
<span class="lineno"></span><span class="op" id="8086209">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="8086212">func</span>&nbsp;<span class="ident" id="8086217">TestDecode</span><span class="op" id="8086227">(</span><span class="ident" id="8086228">t</span>&nbsp;<span class="op" id="8086230">*</span><span class="ident" id="8086231">testing</span><span class="op" id="8086238">.</span><span class="ident" id="8086239">T</span><span class="op" id="8086240">)</span>&nbsp;<span class="op" id="8086242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8086245">for</span>&nbsp;<span class="ident" id="8086249">_</span><span class="op" id="8086250">,</span>&nbsp;<span class="ident" id="8086252">p</span>&nbsp;<span class="op" id="8086254">:=</span>&nbsp;<span class="keyword" id="8086257">range</span>&nbsp;<span class="ident" id="8086263">pairs</span>&nbsp;<span class="op" id="8086269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8086273">dbuf</span>&nbsp;<span class="op" id="8086278">:=</span>&nbsp;<span class="builtinfunc" id="8086281">make</span><span class="op" id="8086285">(</span><span class="op" id="8086286">[</span><span class="op" id="8086287">]</span><span class="builtintype" id="8086288">byte</span><span class="op" id="8086292">,</span>&nbsp;<span class="num" id="8086294">4</span><span class="op" id="8086295">*</span><span class="builtinfunc" id="8086296">len</span><span class="op" id="8086299">(</span><span class="ident" id="8086300">p</span><span class="op" id="8086301">.</span><span class="ident" id="8086302">encoded</span><span class="op" id="8086309">)</span><span class="op" id="8086310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8086314">ndst</span><span class="op" id="8086318">,</span>&nbsp;<span class="ident" id="8086320">nsrc</span><span class="op" id="8086324">,</span>&nbsp;<span class="ident" id="8086326">err</span>&nbsp;<span class="op" id="8086330">:=</span>&nbsp;<span class="ident" id="8086333">Decode</span><span class="op" id="8086339">(</span><span class="ident" id="8086340">dbuf</span><span class="op" id="8086344">,</span>&nbsp;<span class="op" id="8086346">[</span><span class="op" id="8086347">]</span><span class="builtintype" id="8086348">byte</span><span class="op" id="8086352">(</span><span class="ident" id="8086353">p</span><span class="op" id="8086354">.</span><span class="ident" id="8086355">encoded</span><span class="op" id="8086362">)</span><span class="op" id="8086363">,</span>&nbsp;<span class="builtintype" id="8086365">true</span><span class="op" id="8086369">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8086373">testEqual</span><span class="op" id="8086382">(</span><span class="ident" id="8086383">t</span><span class="op" id="8086384">,</span>&nbsp;<span class="string" id="8086386">&#34;Decode(%q)&nbsp;=&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8086418">,</span>&nbsp;<span class="ident" id="8086420">p</span><span class="op" id="8086421">.</span><span class="ident" id="8086422">encoded</span><span class="op" id="8086429">,</span>&nbsp;<span class="ident" id="8086431">err</span><span class="op" id="8086434">,</span>&nbsp;<span class="builtintype" id="8086436">error</span><span class="op" id="8086441">(</span><span class="ident" id="8086442">nil</span><span class="op" id="8086445">)</span><span class="op" id="8086446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8086450">testEqual</span><span class="op" id="8086459">(</span><span class="ident" id="8086460">t</span><span class="op" id="8086461">,</span>&nbsp;<span class="string" id="8086463">&#34;Decode(%q)&nbsp;=&nbsp;nsrc&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8086494">,</span>&nbsp;<span class="ident" id="8086496">p</span><span class="op" id="8086497">.</span><span class="ident" id="8086498">encoded</span><span class="op" id="8086505">,</span>&nbsp;<span class="ident" id="8086507">nsrc</span><span class="op" id="8086511">,</span>&nbsp;<span class="builtinfunc" id="8086513">len</span><span class="op" id="8086516">(</span><span class="ident" id="8086517">p</span><span class="op" id="8086518">.</span><span class="ident" id="8086519">encoded</span><span class="op" id="8086526">)</span><span class="op" id="8086527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8086531">testEqual</span><span class="op" id="8086540">(</span><span class="ident" id="8086541">t</span><span class="op" id="8086542">,</span>&nbsp;<span class="string" id="8086544">&#34;Decode(%q)&nbsp;=&nbsp;ndst&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8086575">,</span>&nbsp;<span class="ident" id="8086577">p</span><span class="op" id="8086578">.</span><span class="ident" id="8086579">encoded</span><span class="op" id="8086586">,</span>&nbsp;<span class="ident" id="8086588">ndst</span><span class="op" id="8086592">,</span>&nbsp;<span class="builtinfunc" id="8086594">len</span><span class="op" id="8086597">(</span><span class="ident" id="8086598">p</span><span class="op" id="8086599">.</span><span class="ident" id="8086600">decoded</span><span class="op" id="8086607">)</span><span class="op" id="8086608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8086612">testEqual</span><span class="op" id="8086621">(</span><span class="ident" id="8086622">t</span><span class="op" id="8086623">,</span>&nbsp;<span class="string" id="8086625">&#34;Decode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8086651">,</span>&nbsp;<span class="ident" id="8086653">p</span><span class="op" id="8086654">.</span><span class="ident" id="8086655">encoded</span><span class="op" id="8086662">,</span>&nbsp;<span class="builtintype" id="8086664">string</span><span class="op" id="8086670">(</span><span class="ident" id="8086671">dbuf</span><span class="op" id="8086675">[</span><span class="num" id="8086676">0</span><span class="op" id="8086677">:</span><span class="ident" id="8086678">ndst</span><span class="op" id="8086682">]</span><span class="op" id="8086683">)</span><span class="op" id="8086684">,</span>&nbsp;<span class="ident" id="8086686">p</span><span class="op" id="8086687">.</span><span class="ident" id="8086688">decoded</span><span class="op" id="8086695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8086698">}</span><br>
<span class="lineno">115</span><span class="op" id="8086700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8086703">func</span>&nbsp;<span class="ident" id="8086708">TestDecoder</span><span class="op" id="8086719">(</span><span class="ident" id="8086720">t</span>&nbsp;<span class="op" id="8086722">*</span><span class="ident" id="8086723">testing</span><span class="op" id="8086730">.</span><span class="ident" id="8086731">T</span><span class="op" id="8086732">)</span>&nbsp;<span class="op" id="8086734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8086737">for</span>&nbsp;<span class="ident" id="8086741">_</span><span class="op" id="8086742">,</span>&nbsp;<span class="ident" id="8086744">p</span>&nbsp;<span class="op" id="8086746">:=</span>&nbsp;<span class="keyword" id="8086749">range</span>&nbsp;<span class="ident" id="8086755">pairs</span>&nbsp;<span class="op" id="8086761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8086765">decoder</span>&nbsp;<span class="op" id="8086773">:=</span>&nbsp;<span class="ident" id="8086776">NewDecoder</span><span class="op" id="8086786">(</span><span class="ident" id="8086787">strings</span><span class="op" id="8086794">.</span><span class="ident" id="8086795">NewReader</span><span class="op" id="8086804">(</span><span class="ident" id="8086805">p</span><span class="op" id="8086806">.</span><span class="ident" id="8086807">encoded</span><span class="op" id="8086814">)</span><span class="op" id="8086815">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8086819">dbuf</span><span class="op" id="8086823">,</span>&nbsp;<span class="ident" id="8086825">err</span>&nbsp;<span class="op" id="8086829">:=</span>&nbsp;<span class="ident" id="8086832">ioutil</span><span class="op" id="8086838">.</span><span class="ident" id="8086839">ReadAll</span><span class="op" id="8086846">(</span><span class="ident" id="8086847">decoder</span><span class="op" id="8086854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8086858">if</span>&nbsp;<span class="ident" id="8086861">err</span>&nbsp;<span class="op" id="8086865">!=</span>&nbsp;<span class="ident" id="8086868">nil</span>&nbsp;<span class="op" id="8086872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8086877">t</span><span class="op" id="8086878">.</span><span class="ident" id="8086879">Fatal</span><span class="op" id="8086884">(</span><span class="string" id="8086885">&#34;Read&nbsp;failed&#34;</span><span class="op" id="8086898">,</span>&nbsp;<span class="ident" id="8086900">err</span><span class="op" id="8086903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8086907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8086911">testEqual</span><span class="op" id="8086920">(</span><span class="ident" id="8086921">t</span><span class="op" id="8086922">,</span>&nbsp;<span class="string" id="8086924">&#34;Read&nbsp;from&nbsp;%q&nbsp;=&nbsp;length&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8086959">,</span>&nbsp;<span class="ident" id="8086961">p</span><span class="op" id="8086962">.</span><span class="ident" id="8086963">encoded</span><span class="op" id="8086970">,</span>&nbsp;<span class="builtinfunc" id="8086972">len</span><span class="op" id="8086975">(</span><span class="ident" id="8086976">dbuf</span><span class="op" id="8086980">)</span><span class="op" id="8086981">,</span>&nbsp;<span class="builtinfunc" id="8086983">len</span><span class="op" id="8086986">(</span><span class="ident" id="8086987">p</span><span class="op" id="8086988">.</span><span class="ident" id="8086989">decoded</span><span class="op" id="8086996">)</span><span class="op" id="8086997">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8087001">testEqual</span><span class="op" id="8087010">(</span><span class="ident" id="8087011">t</span><span class="op" id="8087012">,</span>&nbsp;<span class="string" id="8087014">&#34;Decoding&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8087044">,</span>&nbsp;<span class="ident" id="8087046">p</span><span class="op" id="8087047">.</span><span class="ident" id="8087048">encoded</span><span class="op" id="8087055">,</span>&nbsp;<span class="builtintype" id="8087057">string</span><span class="op" id="8087063">(</span><span class="ident" id="8087064">dbuf</span><span class="op" id="8087068">)</span><span class="op" id="8087069">,</span>&nbsp;<span class="ident" id="8087071">p</span><span class="op" id="8087072">.</span><span class="ident" id="8087073">decoded</span><span class="op" id="8087080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8087084">if</span>&nbsp;<span class="ident" id="8087087">err</span>&nbsp;<span class="op" id="8087091">!=</span>&nbsp;<span class="ident" id="8087094">nil</span>&nbsp;<span class="op" id="8087098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8087103">testEqual</span><span class="op" id="8087112">(</span><span class="ident" id="8087113">t</span><span class="op" id="8087114">,</span>&nbsp;<span class="string" id="8087116">&#34;Read&nbsp;from&nbsp;%q&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8087144">,</span>&nbsp;<span class="ident" id="8087146">p</span><span class="op" id="8087147">.</span><span class="ident" id="8087148">encoded</span><span class="op" id="8087155">,</span>&nbsp;<span class="ident" id="8087157">err</span><span class="op" id="8087160">,</span>&nbsp;<span class="ident" id="8087162">io</span><span class="op" id="8087164">.</span><span class="ident" id="8087165">EOF</span><span class="op" id="8087168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8087172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8087175">}</span><br>
<span class="lineno">130</span><span class="op" id="8087177">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8087180">func</span>&nbsp;<span class="ident" id="8087185">TestDecoderBuffering</span><span class="op" id="8087205">(</span><span class="ident" id="8087206">t</span>&nbsp;<span class="op" id="8087208">*</span><span class="ident" id="8087209">testing</span><span class="op" id="8087216">.</span><span class="ident" id="8087217">T</span><span class="op" id="8087218">)</span>&nbsp;<span class="op" id="8087220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8087223">for</span>&nbsp;<span class="ident" id="8087227">bs</span>&nbsp;<span class="op" id="8087230">:=</span>&nbsp;<span class="num" id="8087233">1</span><span class="op" id="8087234">;</span>&nbsp;<span class="ident" id="8087236">bs</span>&nbsp;<span class="op" id="8087239">&lt;=</span>&nbsp;<span class="num" id="8087242">12</span><span class="op" id="8087244">;</span>&nbsp;<span class="ident" id="8087246">bs</span><span class="op" id="8087248">++</span>&nbsp;<span class="op" id="8087251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8087255">decoder</span>&nbsp;<span class="op" id="8087263">:=</span>&nbsp;<span class="ident" id="8087266">NewDecoder</span><span class="op" id="8087276">(</span><span class="ident" id="8087277">strings</span><span class="op" id="8087284">.</span><span class="ident" id="8087285">NewReader</span><span class="op" id="8087294">(</span><span class="ident" id="8087295">bigtest</span><span class="op" id="8087302">.</span><span class="ident" id="8087303">encoded</span><span class="op" id="8087310">)</span><span class="op" id="8087311">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8087315">buf</span>&nbsp;<span class="op" id="8087319">:=</span>&nbsp;<span class="builtinfunc" id="8087322">make</span><span class="op" id="8087326">(</span><span class="op" id="8087327">[</span><span class="op" id="8087328">]</span><span class="builtintype" id="8087329">byte</span><span class="op" id="8087333">,</span>&nbsp;<span class="builtinfunc" id="8087335">len</span><span class="op" id="8087338">(</span><span class="ident" id="8087339">bigtest</span><span class="op" id="8087346">.</span><span class="ident" id="8087347">decoded</span><span class="op" id="8087354">)</span><span class="op" id="8087355">+</span><span class="num" id="8087356">12</span><span class="op" id="8087358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8087362">var</span>&nbsp;<span class="ident" id="8087366">total</span>&nbsp;<span class="builtintype" id="8087372">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8087378">for</span>&nbsp;<span class="ident" id="8087382">total</span>&nbsp;<span class="op" id="8087388">=</span>&nbsp;<span class="num" id="8087390">0</span><span class="op" id="8087391">;</span>&nbsp;<span class="ident" id="8087393">total</span>&nbsp;<span class="op" id="8087399">&lt;</span>&nbsp;<span class="builtinfunc" id="8087401">len</span><span class="op" id="8087404">(</span><span class="ident" id="8087405">bigtest</span><span class="op" id="8087412">.</span><span class="ident" id="8087413">decoded</span><span class="op" id="8087420">)</span><span class="op" id="8087421">;</span>&nbsp;<span class="op" id="8087423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8087428">n</span><span class="op" id="8087429">,</span>&nbsp;<span class="ident" id="8087431">err</span>&nbsp;<span class="op" id="8087435">:=</span>&nbsp;<span class="ident" id="8087438">decoder</span><span class="op" id="8087445">.</span><span class="ident" id="8087446">Read</span><span class="op" id="8087450">(</span><span class="ident" id="8087451">buf</span><span class="op" id="8087454">[</span><span class="ident" id="8087455">total</span>&nbsp;<span class="op" id="8087461">:</span>&nbsp;<span class="ident" id="8087463">total</span><span class="op" id="8087468">+</span><span class="ident" id="8087469">bs</span><span class="op" id="8087471">]</span><span class="op" id="8087472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8087477">testEqual</span><span class="op" id="8087486">(</span><span class="ident" id="8087487">t</span><span class="op" id="8087488">,</span>&nbsp;<span class="string" id="8087490">&#34;Read&nbsp;from&nbsp;%q&nbsp;at&nbsp;pos&nbsp;%d&nbsp;=&nbsp;%d,&nbsp;%v,&nbsp;want&nbsp;_,&nbsp;%v&#34;</span><span class="op" id="8087535">,</span>&nbsp;<span class="ident" id="8087537">bigtest</span><span class="op" id="8087544">.</span><span class="ident" id="8087545">encoded</span><span class="op" id="8087552">,</span>&nbsp;<span class="ident" id="8087554">total</span><span class="op" id="8087559">,</span>&nbsp;<span class="ident" id="8087561">n</span><span class="op" id="8087562">,</span>&nbsp;<span class="ident" id="8087564">err</span><span class="op" id="8087567">,</span>&nbsp;<span class="builtintype" id="8087569">error</span><span class="op" id="8087574">(</span><span class="ident" id="8087575">nil</span><span class="op" id="8087578">)</span><span class="op" id="8087579">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8087584">total</span>&nbsp;<span class="op" id="8087590">+=</span>&nbsp;<span class="ident" id="8087593">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8087597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8087601">testEqual</span><span class="op" id="8087610">(</span><span class="ident" id="8087611">t</span><span class="op" id="8087612">,</span>&nbsp;<span class="string" id="8087614">&#34;Decoding/%d&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8087647">,</span>&nbsp;<span class="ident" id="8087649">bs</span><span class="op" id="8087651">,</span>&nbsp;<span class="ident" id="8087653">bigtest</span><span class="op" id="8087660">.</span><span class="ident" id="8087661">encoded</span><span class="op" id="8087668">,</span>&nbsp;<span class="builtintype" id="8087670">string</span><span class="op" id="8087676">(</span><span class="ident" id="8087677">buf</span><span class="op" id="8087680">[</span><span class="num" id="8087681">0</span><span class="op" id="8087682">:</span><span class="ident" id="8087683">total</span><span class="op" id="8087688">]</span><span class="op" id="8087689">)</span><span class="op" id="8087690">,</span>&nbsp;<span class="ident" id="8087692">bigtest</span><span class="op" id="8087699">.</span><span class="ident" id="8087700">decoded</span><span class="op" id="8087707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8087710">}</span><br>
<span class="lineno"></span><span class="op" id="8087712">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="keyword" id="8087715">func</span>&nbsp;<span class="ident" id="8087720">TestDecodeCorrupt</span><span class="op" id="8087737">(</span><span class="ident" id="8087738">t</span>&nbsp;<span class="op" id="8087740">*</span><span class="ident" id="8087741">testing</span><span class="op" id="8087748">.</span><span class="ident" id="8087749">T</span><span class="op" id="8087750">)</span>&nbsp;<span class="op" id="8087752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8087755">type</span>&nbsp;<span class="ident" id="8087760">corrupt</span>&nbsp;<span class="keyword" id="8087768">struct</span>&nbsp;<span class="op" id="8087775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8087779">e</span>&nbsp;<span class="builtintype" id="8087781">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8087790">p</span>&nbsp;<span class="builtintype" id="8087792">int</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8087797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8087800">examples</span>&nbsp;<span class="op" id="8087809">:=</span>&nbsp;<span class="op" id="8087812">[</span><span class="op" id="8087813">]</span><span class="ident" id="8087814">corrupt</span><span class="op" id="8087821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8087825">{</span><span class="string" id="8087826">&#34;v&#34;</span><span class="op" id="8087829">,</span>&nbsp;<span class="num" id="8087831">0</span><span class="op" id="8087832">}</span><span class="op" id="8087833">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8087837">{</span><span class="string" id="8087838">&#34;!z!!!!!!!!!&#34;</span><span class="op" id="8087851">,</span>&nbsp;<span class="num" id="8087853">1</span><span class="op" id="8087854">}</span><span class="op" id="8087855">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8087858">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8087862">for</span>&nbsp;<span class="ident" id="8087866">_</span><span class="op" id="8087867">,</span>&nbsp;<span class="ident" id="8087869">e</span>&nbsp;<span class="op" id="8087871">:=</span>&nbsp;<span class="keyword" id="8087874">range</span>&nbsp;<span class="ident" id="8087880">examples</span>&nbsp;<span class="op" id="8087889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8087893">dbuf</span>&nbsp;<span class="op" id="8087898">:=</span>&nbsp;<span class="builtinfunc" id="8087901">make</span><span class="op" id="8087905">(</span><span class="op" id="8087906">[</span><span class="op" id="8087907">]</span><span class="builtintype" id="8087908">byte</span><span class="op" id="8087912">,</span>&nbsp;<span class="num" id="8087914">4</span><span class="op" id="8087915">*</span><span class="builtinfunc" id="8087916">len</span><span class="op" id="8087919">(</span><span class="ident" id="8087920">e</span><span class="op" id="8087921">.</span><span class="ident" id="8087922">e</span><span class="op" id="8087923">)</span><span class="op" id="8087924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8087928">_</span><span class="op" id="8087929">,</span>&nbsp;<span class="ident" id="8087931">_</span><span class="op" id="8087932">,</span>&nbsp;<span class="ident" id="8087934">err</span>&nbsp;<span class="op" id="8087938">:=</span>&nbsp;<span class="ident" id="8087941">Decode</span><span class="op" id="8087947">(</span><span class="ident" id="8087948">dbuf</span><span class="op" id="8087952">,</span>&nbsp;<span class="op" id="8087954">[</span><span class="op" id="8087955">]</span><span class="builtintype" id="8087956">byte</span><span class="op" id="8087960">(</span><span class="ident" id="8087961">e</span><span class="op" id="8087962">.</span><span class="ident" id="8087963">e</span><span class="op" id="8087964">)</span><span class="op" id="8087965">,</span>&nbsp;<span class="builtintype" id="8087967">true</span><span class="op" id="8087971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8087975">switch</span>&nbsp;<span class="ident" id="8087982">err</span>&nbsp;<span class="op" id="8087986">:=</span>&nbsp;<span class="ident" id="8087989">err</span><span class="op" id="8087992">.</span><span class="op" id="8087993">(</span><span class="keyword" id="8087994">type</span><span class="op" id="8087998">)</span>&nbsp;<span class="op" id="8088000">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8088004">case</span>&nbsp;<span class="ident" id="8088009">CorruptInputError</span><span class="op" id="8088026">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8088031">testEqual</span><span class="op" id="8088040">(</span><span class="ident" id="8088041">t</span><span class="op" id="8088042">,</span>&nbsp;<span class="string" id="8088044">&#34;Corruption&nbsp;in&nbsp;%q&nbsp;at&nbsp;offset&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8088084">,</span>&nbsp;<span class="ident" id="8088086">e</span><span class="op" id="8088087">.</span><span class="ident" id="8088088">e</span><span class="op" id="8088089">,</span>&nbsp;<span class="builtintype" id="8088091">int</span><span class="op" id="8088094">(</span><span class="ident" id="8088095">err</span><span class="op" id="8088098">)</span><span class="op" id="8088099">,</span>&nbsp;<span class="ident" id="8088101">e</span><span class="op" id="8088102">.</span><span class="ident" id="8088103">p</span><span class="op" id="8088104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8088108">default</span><span class="op" id="8088115">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8088120">t</span><span class="op" id="8088121">.</span><span class="ident" id="8088122">Error</span><span class="op" id="8088127">(</span><span class="string" id="8088128">&#34;Decoder&nbsp;failed&nbsp;to&nbsp;detect&nbsp;corruption&nbsp;in&#34;</span><span class="op" id="8088168">,</span>&nbsp;<span class="ident" id="8088170">e</span><span class="op" id="8088171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8088175">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8088178">}</span><br>
<span class="lineno"></span><span class="op" id="8088180">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8088183">func</span>&nbsp;<span class="ident" id="8088188">TestBig</span><span class="op" id="8088195">(</span><span class="ident" id="8088196">t</span>&nbsp;<span class="op" id="8088198">*</span><span class="ident" id="8088199">testing</span><span class="op" id="8088206">.</span><span class="ident" id="8088207">T</span><span class="op" id="8088208">)</span>&nbsp;<span class="op" id="8088210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8088213">n</span>&nbsp;<span class="op" id="8088215">:=</span>&nbsp;<span class="num" id="8088218">3</span><span class="op" id="8088219">*</span><span class="num" id="8088220">1000</span>&nbsp;<span class="op" id="8088225">+</span>&nbsp;<span class="num" id="8088227">1</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8088230">raw</span>&nbsp;<span class="op" id="8088234">:=</span>&nbsp;<span class="builtinfunc" id="8088237">make</span><span class="op" id="8088241">(</span><span class="op" id="8088242">[</span><span class="op" id="8088243">]</span><span class="builtintype" id="8088244">byte</span><span class="op" id="8088248">,</span>&nbsp;<span class="ident" id="8088250">n</span><span class="op" id="8088251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8088254">const</span>&nbsp;<span class="ident" id="8088260">alpha</span>&nbsp;<span class="op" id="8088266">=</span>&nbsp;<span class="string" id="8088268">&#34;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8088334">for</span>&nbsp;<span class="ident" id="8088338">i</span>&nbsp;<span class="op" id="8088340">:=</span>&nbsp;<span class="num" id="8088343">0</span><span class="op" id="8088344">;</span>&nbsp;<span class="ident" id="8088346">i</span>&nbsp;<span class="op" id="8088348">&lt;</span>&nbsp;<span class="ident" id="8088350">n</span><span class="op" id="8088351">;</span>&nbsp;<span class="ident" id="8088353">i</span><span class="op" id="8088354">++</span>&nbsp;<span class="op" id="8088357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8088361">raw</span><span class="op" id="8088364">[</span><span class="ident" id="8088365">i</span><span class="op" id="8088366">]</span>&nbsp;<span class="op" id="8088368">=</span>&nbsp;<span class="ident" id="8088370">alpha</span><span class="op" id="8088375">[</span><span class="ident" id="8088376">i</span><span class="op" id="8088377">%</span><span class="builtinfunc" id="8088378">len</span><span class="op" id="8088381">(</span><span class="ident" id="8088382">alpha</span><span class="op" id="8088387">)</span><span class="op" id="8088388">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8088391">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8088394">encoded</span>&nbsp;<span class="op" id="8088402">:=</span>&nbsp;<span class="builtinfunc" id="8088405">new</span><span class="op" id="8088408">(</span><span class="ident" id="8088409">bytes</span><span class="op" id="8088414">.</span><span class="ident" id="8088415">Buffer</span><span class="op" id="8088421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8088424">w</span>&nbsp;<span class="op" id="8088426">:=</span>&nbsp;<span class="ident" id="8088429">NewEncoder</span><span class="op" id="8088439">(</span><span class="ident" id="8088440">encoded</span><span class="op" id="8088447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8088450">nn</span><span class="op" id="8088452">,</span>&nbsp;<span class="ident" id="8088454">err</span>&nbsp;<span class="op" id="8088458">:=</span>&nbsp;<span class="ident" id="8088461">w</span><span class="op" id="8088462">.</span><span class="ident" id="8088463">Write</span><span class="op" id="8088468">(</span><span class="ident" id="8088469">raw</span><span class="op" id="8088472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8088475">if</span>&nbsp;<span class="ident" id="8088478">nn</span>&nbsp;<span class="op" id="8088481">!=</span>&nbsp;<span class="ident" id="8088484">n</span>&nbsp;<span class="op" id="8088486">||</span>&nbsp;<span class="ident" id="8088489">err</span>&nbsp;<span class="op" id="8088493">!=</span>&nbsp;<span class="ident" id="8088496">nil</span>&nbsp;<span class="op" id="8088500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8088504">t</span><span class="op" id="8088505">.</span><span class="ident" id="8088506">Fatalf</span><span class="op" id="8088512">(</span><span class="string" id="8088513">&#34;Encoder.Write(raw)&nbsp;=&nbsp;%d,&nbsp;%v&nbsp;want&nbsp;%d,&nbsp;nil&#34;</span><span class="op" id="8088555">,</span>&nbsp;<span class="ident" id="8088557">nn</span><span class="op" id="8088559">,</span>&nbsp;<span class="ident" id="8088561">err</span><span class="op" id="8088564">,</span>&nbsp;<span class="ident" id="8088566">n</span><span class="op" id="8088567">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8088570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8088573">err</span>&nbsp;<span class="op" id="8088577">=</span>&nbsp;<span class="ident" id="8088579">w</span><span class="op" id="8088580">.</span><span class="ident" id="8088581">Close</span><span class="op" id="8088586">(</span><span class="op" id="8088587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8088590">if</span>&nbsp;<span class="ident" id="8088593">err</span>&nbsp;<span class="op" id="8088597">!=</span>&nbsp;<span class="ident" id="8088600">nil</span>&nbsp;<span class="op" id="8088604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8088608">t</span><span class="op" id="8088609">.</span><span class="ident" id="8088610">Fatalf</span><span class="op" id="8088616">(</span><span class="string" id="8088617">&#34;Encoder.Close()&nbsp;=&nbsp;%v&nbsp;want&nbsp;nil&#34;</span><span class="op" id="8088648">,</span>&nbsp;<span class="ident" id="8088650">err</span><span class="op" id="8088653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8088656">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8088659">decoded</span><span class="op" id="8088666">,</span>&nbsp;<span class="ident" id="8088668">err</span>&nbsp;<span class="op" id="8088672">:=</span>&nbsp;<span class="ident" id="8088675">ioutil</span><span class="op" id="8088681">.</span><span class="ident" id="8088682">ReadAll</span><span class="op" id="8088689">(</span><span class="ident" id="8088690">NewDecoder</span><span class="op" id="8088700">(</span><span class="ident" id="8088701">encoded</span><span class="op" id="8088708">)</span><span class="op" id="8088709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8088712">if</span>&nbsp;<span class="ident" id="8088715">err</span>&nbsp;<span class="op" id="8088719">!=</span>&nbsp;<span class="ident" id="8088722">nil</span>&nbsp;<span class="op" id="8088726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8088730">t</span><span class="op" id="8088731">.</span><span class="ident" id="8088732">Fatalf</span><span class="op" id="8088738">(</span><span class="string" id="8088739">&#34;io.ReadAll(NewDecoder(...)):&nbsp;%v&#34;</span><span class="op" id="8088772">,</span>&nbsp;<span class="ident" id="8088774">err</span><span class="op" id="8088777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8088780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8088784">if</span>&nbsp;<span class="op" id="8088787">!</span><span class="ident" id="8088788">bytes</span><span class="op" id="8088793">.</span><span class="ident" id="8088794">Equal</span><span class="op" id="8088799">(</span><span class="ident" id="8088800">raw</span><span class="op" id="8088803">,</span>&nbsp;<span class="ident" id="8088805">decoded</span><span class="op" id="8088812">)</span>&nbsp;<span class="op" id="8088814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8088818">var</span>&nbsp;<span class="ident" id="8088822">i</span>&nbsp;<span class="builtintype" id="8088824">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8088830">for</span>&nbsp;<span class="ident" id="8088834">i</span>&nbsp;<span class="op" id="8088836">=</span>&nbsp;<span class="num" id="8088838">0</span><span class="op" id="8088839">;</span>&nbsp;<span class="ident" id="8088841">i</span>&nbsp;<span class="op" id="8088843">&lt;</span>&nbsp;<span class="builtinfunc" id="8088845">len</span><span class="op" id="8088848">(</span><span class="ident" id="8088849">decoded</span><span class="op" id="8088856">)</span>&nbsp;<span class="op" id="8088858">&amp;&amp;</span>&nbsp;<span class="ident" id="8088861">i</span>&nbsp;<span class="op" id="8088863">&lt;</span>&nbsp;<span class="builtinfunc" id="8088865">len</span><span class="op" id="8088868">(</span><span class="ident" id="8088869">raw</span><span class="op" id="8088872">)</span><span class="op" id="8088873">;</span>&nbsp;<span class="ident" id="8088875">i</span><span class="op" id="8088876">++</span>&nbsp;<span class="op" id="8088879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8088884">if</span>&nbsp;<span class="ident" id="8088887">decoded</span><span class="op" id="8088894">[</span><span class="ident" id="8088895">i</span><span class="op" id="8088896">]</span>&nbsp;<span class="op" id="8088898">!=</span>&nbsp;<span class="ident" id="8088901">raw</span><span class="op" id="8088904">[</span><span class="ident" id="8088905">i</span><span class="op" id="8088906">]</span>&nbsp;<span class="op" id="8088908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8088914">break</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8088923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8088927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8088931">t</span><span class="op" id="8088932">.</span><span class="ident" id="8088933">Errorf</span><span class="op" id="8088939">(</span><span class="string" id="8088940">&#34;Decode(Encode(%d-byte&nbsp;string))&nbsp;failed&nbsp;at&nbsp;offset&nbsp;%d&#34;</span><span class="op" id="8088992">,</span>&nbsp;<span class="ident" id="8088994">n</span><span class="op" id="8088995">,</span>&nbsp;<span class="ident" id="8088997">i</span><span class="op" id="8088998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8089001">}</span><br>
<span class="lineno"></span><span class="op" id="8089003">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="keyword" id="8089006">func</span>&nbsp;<span class="ident" id="8089011">TestDecoderInternalWhitespace</span><span class="op" id="8089040">(</span><span class="ident" id="8089041">t</span>&nbsp;<span class="op" id="8089043">*</span><span class="ident" id="8089044">testing</span><span class="op" id="8089051">.</span><span class="ident" id="8089052">T</span><span class="op" id="8089053">)</span>&nbsp;<span class="op" id="8089055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8089058">s</span>&nbsp;<span class="op" id="8089060">:=</span>&nbsp;<span class="ident" id="8089063">strings</span><span class="op" id="8089070">.</span><span class="ident" id="8089071">Repeat</span><span class="op" id="8089077">(</span><span class="string" id="8089078">&#34;&nbsp;&#34;</span><span class="op" id="8089081">,</span>&nbsp;<span class="num" id="8089083">2048</span><span class="op" id="8089087">)</span>&nbsp;<span class="op" id="8089089">+</span>&nbsp;<span class="string" id="8089091">&#34;z&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8089096">decoded</span><span class="op" id="8089103">,</span>&nbsp;<span class="ident" id="8089105">err</span>&nbsp;<span class="op" id="8089109">:=</span>&nbsp;<span class="ident" id="8089112">ioutil</span><span class="op" id="8089118">.</span><span class="ident" id="8089119">ReadAll</span><span class="op" id="8089126">(</span><span class="ident" id="8089127">NewDecoder</span><span class="op" id="8089137">(</span><span class="ident" id="8089138">strings</span><span class="op" id="8089145">.</span><span class="ident" id="8089146">NewReader</span><span class="op" id="8089155">(</span><span class="ident" id="8089156">s</span><span class="op" id="8089157">)</span><span class="op" id="8089158">)</span><span class="op" id="8089159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8089162">if</span>&nbsp;<span class="ident" id="8089165">err</span>&nbsp;<span class="op" id="8089169">!=</span>&nbsp;<span class="ident" id="8089172">nil</span>&nbsp;<span class="op" id="8089176">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8089180">t</span><span class="op" id="8089181">.</span><span class="ident" id="8089182">Errorf</span><span class="op" id="8089188">(</span><span class="string" id="8089189">&#34;Decode&nbsp;gave&nbsp;error&nbsp;%v&#34;</span><span class="op" id="8089211">,</span>&nbsp;<span class="ident" id="8089213">err</span><span class="op" id="8089216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8089219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8089222">if</span>&nbsp;<span class="ident" id="8089225">want</span>&nbsp;<span class="op" id="8089230">:=</span>&nbsp;<span class="op" id="8089233">[</span><span class="op" id="8089234">]</span><span class="builtintype" id="8089235">byte</span><span class="op" id="8089239">(</span><span class="string" id="8089240">&#34;\000\000\000\000&#34;</span><span class="op" id="8089258">)</span><span class="op" id="8089259">;</span>&nbsp;<span class="op" id="8089261">!</span><span class="ident" id="8089262">bytes</span><span class="op" id="8089267">.</span><span class="ident" id="8089268">Equal</span><span class="op" id="8089273">(</span><span class="ident" id="8089274">want</span><span class="op" id="8089278">,</span>&nbsp;<span class="ident" id="8089280">decoded</span><span class="op" id="8089287">)</span>&nbsp;<span class="op" id="8089289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8089293">t</span><span class="op" id="8089294">.</span><span class="ident" id="8089295">Errorf</span><span class="op" id="8089301">(</span><span class="string" id="8089302">&#34;Decode&nbsp;failed:&nbsp;got&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8089334">,</span>&nbsp;<span class="ident" id="8089336">decoded</span><span class="op" id="8089343">,</span>&nbsp;<span class="ident" id="8089345">want</span><span class="op" id="8089349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8089352">}</span><br>
<span class="lineno">210</span><span class="op" id="8089354">}</span>
</div>
</body>
</html>
