<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>lonnie.io/e8vm/arch8</h2>
<ul>
<li><a href="/gostd/lonnie.io/e8vm/arch8/console.go.html">console.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/cpu.go.html">cpu.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/cpu_test.go.html">cpu_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/device.go.html">device.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/exception.go.html">exception.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_all.go.html">inst_all.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_br.go.html">inst_br.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_br_test.go.html">inst_br_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_imm.go.html">inst_imm.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_imm_test.go.html">inst_imm_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_jmp.go.html">inst_jmp.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_reg.go.html">inst_reg.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_reg_test.go.html">inst_reg_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_sys.go.html">inst_sys.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/int_bus.go.html">int_bus.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/interrupt.go.html">interrupt.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/interrupt_test.go.html">interrupt_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/machine.go.html">machine.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/multi_core.go.html">multi_core.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page.go.html">page.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page_table.go.html">page_table.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page_table_test.go.html">page_table_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page_test.go.html">page_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/phy_memory.go.html">phy_memory.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/phy_memory_test.go.html">phy_memory_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/regs.go.html">regs.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/regs_test.go.html">regs_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/run_image.go.html">run_image.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/serial.go.html">serial.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/ticker.go.html">ticker.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/virt_memory.go.html">virt_memory.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/virt_memory_test.go.html">virt_memory_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="keyword" id="3581769">package</span>&nbsp;<span class="ident" id="3581777">arch8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3581784">import</span>&nbsp;<span class="op" id="3581791">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3581794">&#34;encoding/binary&#34;</span><br>
<span class="lineno">5</span><span class="op" id="3581812">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3581815">//&nbsp;PageSize&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;a&nbsp;page&nbsp;contains.</span><br>
<span class="lineno"></span><span class="keyword" id="3581867">const</span>&nbsp;<span class="ident" id="3581873">PageSize</span>&nbsp;<span class="op" id="3581882">=</span>&nbsp;<span class="num" id="3581884">4096</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="comment" id="3581890">//&nbsp;Page&nbsp;is&nbsp;a&nbsp;memory&nbsp;addressable&nbsp;area&nbsp;of&nbsp;PageSize&nbsp;bytes</span><br>
<span class="lineno"></span><span class="keyword" id="3581945">type</span>&nbsp;<span class="ident" id="3581950">page</span>&nbsp;<span class="keyword" id="3581955">struct</span>&nbsp;<span class="op" id="3581962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3581965">Bytes</span>&nbsp;<span class="op" id="3581971">[</span><span class="op" id="3581972">]</span><span class="builtintype" id="3581973">byte</span><br>
<span class="lineno"></span><span class="op" id="3581978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="3581981">//&nbsp;NewPage&nbsp;creates&nbsp;a&nbsp;new&nbsp;empty&nbsp;page.</span><br>
<span class="lineno"></span><span class="keyword" id="3582018">func</span>&nbsp;<span class="ident" id="3582023">newPage</span><span class="op" id="3582030">(</span><span class="op" id="3582031">)</span>&nbsp;<span class="op" id="3582033">*</span><span class="ident" id="3582034">page</span>&nbsp;<span class="op" id="3582039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3582042">return</span>&nbsp;<span class="op" id="3582049">&amp;</span><span class="ident" id="3582050">page</span><span class="op" id="3582054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3582058">Bytes</span><span class="op" id="3582063">:</span>&nbsp;<span class="builtinfunc" id="3582065">make</span><span class="op" id="3582069">(</span><span class="op" id="3582070">[</span><span class="op" id="3582071">]</span><span class="builtintype" id="3582072">byte</span><span class="op" id="3582076">,</span>&nbsp;<span class="ident" id="3582078">PageSize</span><span class="op" id="3582086">)</span><span class="op" id="3582087">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3582090">}</span><br>
<span class="lineno">20</span><span class="op" id="3582092">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3582095">//&nbsp;ReadByte&nbsp;reads&nbsp;a&nbsp;byte&nbsp;at&nbsp;the&nbsp;particular&nbsp;offset.</span><br>
<span class="lineno"></span><span class="comment" id="3582146">//&nbsp;When&nbsp;offset&nbsp;is&nbsp;larger&nbsp;than&nbsp;offset,&nbsp;it&nbsp;uses&nbsp;the&nbsp;modular.</span><br>
<span class="lineno"></span><span class="keyword" id="3582205">func</span>&nbsp;<span class="op" id="3582210">(</span><span class="ident" id="3582211">p</span>&nbsp;<span class="op" id="3582213">*</span><span class="ident" id="3582214">page</span><span class="op" id="3582218">)</span>&nbsp;<span class="ident" id="3582220">ReadByte</span><span class="op" id="3582228">(</span><span class="ident" id="3582229">offset</span>&nbsp;<span class="builtintype" id="3582236">uint32</span><span class="op" id="3582242">)</span>&nbsp;<span class="builtintype" id="3582244">byte</span>&nbsp;<span class="op" id="3582249">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3582252">return</span>&nbsp;<span class="ident" id="3582259">p</span><span class="op" id="3582260">.</span><span class="ident" id="3582261">Bytes</span><span class="op" id="3582266">[</span><span class="ident" id="3582267">offset</span><span class="op" id="3582273">%</span><span class="ident" id="3582274">PageSize</span><span class="op" id="3582282">]</span><br>
<span class="lineno"></span><span class="op" id="3582284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3582287">//&nbsp;WriteByte&nbsp;writes&nbsp;a&nbsp;byte&nbsp;into&nbsp;the&nbsp;page&nbsp;at&nbsp;a&nbsp;particular&nbsp;offset.</span><br>
<span class="lineno"></span><span class="comment" id="3582352">//&nbsp;When&nbsp;offset&nbsp;is&nbsp;larger&nbsp;than&nbsp;offset,&nbsp;it&nbsp;uses&nbsp;the&nbsp;modular.</span><br>
<span class="lineno">30</span><span class="keyword" id="3582411">func</span>&nbsp;<span class="op" id="3582416">(</span><span class="ident" id="3582417">p</span>&nbsp;<span class="op" id="3582419">*</span><span class="ident" id="3582420">page</span><span class="op" id="3582424">)</span>&nbsp;<span class="ident" id="3582426">WriteByte</span><span class="op" id="3582435">(</span><span class="ident" id="3582436">offset</span>&nbsp;<span class="builtintype" id="3582443">uint32</span><span class="op" id="3582449">,</span>&nbsp;<span class="ident" id="3582451">b</span>&nbsp;<span class="builtintype" id="3582453">byte</span><span class="op" id="3582457">)</span>&nbsp;<span class="op" id="3582459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3582462">p</span><span class="op" id="3582463">.</span><span class="ident" id="3582464">Bytes</span><span class="op" id="3582469">[</span><span class="ident" id="3582470">offset</span><span class="op" id="3582476">%</span><span class="ident" id="3582477">PageSize</span><span class="op" id="3582485">]</span>&nbsp;<span class="op" id="3582487">=</span>&nbsp;<span class="ident" id="3582489">b</span><br>
<span class="lineno"></span><span class="op" id="3582491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3582494">//&nbsp;The&nbsp;machines&nbsp;endian.</span><br>
<span class="lineno">35</span><span class="keyword" id="3582518">var</span>&nbsp;<span class="ident" id="3582522">Endian</span>&nbsp;<span class="op" id="3582529">=</span>&nbsp;<span class="ident" id="3582531">binary</span><span class="op" id="3582537">.</span><span class="ident" id="3582538">LittleEndian</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3582552">func</span>&nbsp;<span class="ident" id="3582557">wordOff</span><span class="op" id="3582564">(</span><span class="ident" id="3582565">offset</span>&nbsp;<span class="builtintype" id="3582572">uint32</span><span class="op" id="3582578">)</span>&nbsp;<span class="builtintype" id="3582580">uint32</span>&nbsp;<span class="op" id="3582587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3582590">return</span>&nbsp;<span class="op" id="3582597">(</span><span class="ident" id="3582598">offset</span>&nbsp;<span class="op" id="3582605">%</span>&nbsp;<span class="ident" id="3582607">PageSize</span><span class="op" id="3582615">)</span>&nbsp;<span class="op" id="3582617">&amp;</span>&nbsp;<span class="op" id="3582619">^</span><span class="builtintype" id="3582620">uint32</span><span class="op" id="3582626">(</span><span class="num" id="3582627">0x3</span><span class="op" id="3582630">)</span><br>
<span class="lineno"></span><span class="op" id="3582632">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="3582635">//&nbsp;ReadWord&nbsp;reads&nbsp;the&nbsp;word&nbsp;at&nbsp;the&nbsp;particular&nbsp;offset.</span><br>
<span class="lineno"></span><span class="comment" id="3582688">//&nbsp;When&nbsp;offset&nbsp;is&nbsp;larger&nbsp;than&nbsp;offset,&nbsp;it&nbsp;uses&nbsp;the&nbsp;modular.</span><br>
<span class="lineno"></span><span class="comment" id="3582747">//&nbsp;When&nbsp;offset&nbsp;is&nbsp;not&nbsp;4-byte&nbsp;aligned,&nbsp;it&nbsp;aligns&nbsp;down.</span><br>
<span class="lineno"></span><span class="keyword" id="3582801">func</span>&nbsp;<span class="op" id="3582806">(</span><span class="ident" id="3582807">p</span>&nbsp;<span class="op" id="3582809">*</span><span class="ident" id="3582810">page</span><span class="op" id="3582814">)</span>&nbsp;<span class="ident" id="3582816">ReadWord</span><span class="op" id="3582824">(</span><span class="ident" id="3582825">offset</span>&nbsp;<span class="builtintype" id="3582832">uint32</span><span class="op" id="3582838">)</span>&nbsp;<span class="builtintype" id="3582840">uint32</span>&nbsp;<span class="op" id="3582847">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3582850">offset</span>&nbsp;<span class="op" id="3582857">=</span>&nbsp;<span class="ident" id="3582859">wordOff</span><span class="op" id="3582866">(</span><span class="ident" id="3582867">offset</span><span class="op" id="3582873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3582876">return</span>&nbsp;<span class="ident" id="3582883">Endian</span><span class="op" id="3582889">.</span><span class="ident" id="3582890">Uint32</span><span class="op" id="3582896">(</span><span class="ident" id="3582897">p</span><span class="op" id="3582898">.</span><span class="ident" id="3582899">Bytes</span><span class="op" id="3582904">[</span><span class="ident" id="3582905">offset</span>&nbsp;<span class="op" id="3582912">:</span>&nbsp;<span class="ident" id="3582914">offset</span><span class="op" id="3582920">+</span><span class="num" id="3582921">4</span><span class="op" id="3582922">]</span><span class="op" id="3582923">)</span><br>
<span class="lineno"></span><span class="op" id="3582925">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3582928">//&nbsp;WriteWord&nbsp;writes&nbsp;the&nbsp;word&nbsp;at&nbsp;the&nbsp;particular&nbsp;offset.</span><br>
<span class="lineno">50</span><span class="comment" id="3582983">//&nbsp;When&nbsp;offset&nbsp;is&nbsp;larger&nbsp;than&nbsp;offset,&nbsp;it&nbsp;uses&nbsp;the&nbsp;modular.</span><br>
<span class="lineno"></span><span class="comment" id="3583042">//&nbsp;When&nbsp;offset&nbsp;is&nbsp;not&nbsp;4-byte&nbsp;aligned,&nbsp;it&nbsp;aligns&nbsp;down.</span><br>
<span class="lineno"></span><span class="keyword" id="3583096">func</span>&nbsp;<span class="op" id="3583101">(</span><span class="ident" id="3583102">p</span>&nbsp;<span class="op" id="3583104">*</span><span class="ident" id="3583105">page</span><span class="op" id="3583109">)</span>&nbsp;<span class="ident" id="3583111">WriteWord</span><span class="op" id="3583120">(</span><span class="ident" id="3583121">offset</span>&nbsp;<span class="builtintype" id="3583128">uint32</span><span class="op" id="3583134">,</span>&nbsp;<span class="ident" id="3583136">w</span>&nbsp;<span class="builtintype" id="3583138">uint32</span><span class="op" id="3583144">)</span>&nbsp;<span class="op" id="3583146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3583149">offset</span>&nbsp;<span class="op" id="3583156">=</span>&nbsp;<span class="ident" id="3583158">wordOff</span><span class="op" id="3583165">(</span><span class="ident" id="3583166">offset</span><span class="op" id="3583172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3583175">Endian</span><span class="op" id="3583181">.</span><span class="ident" id="3583182">PutUint32</span><span class="op" id="3583191">(</span><span class="ident" id="3583192">p</span><span class="op" id="3583193">.</span><span class="ident" id="3583194">Bytes</span><span class="op" id="3583199">[</span><span class="ident" id="3583200">offset</span><span class="op" id="3583206">:</span><span class="ident" id="3583207">offset</span><span class="op" id="3583213">+</span><span class="num" id="3583214">4</span><span class="op" id="3583215">]</span><span class="op" id="3583216">,</span>&nbsp;<span class="ident" id="3583218">w</span><span class="op" id="3583219">)</span><br>
<span class="lineno">55</span><span class="op" id="3583221">}</span>
</div>
</body>
</html>
