<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/textproto</h2>
<ul>
<li><a href="/gostd/net/textproto/header.go.html">header.go</a></li>
<li><a href="/gostd/net/textproto/pipeline.go.html">pipeline.go</a></li>
<li><a href="/gostd/net/textproto/reader.go.html" class="current">reader.go</a></li>
<li><a href="/gostd/net/textproto/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/net/textproto/textproto.go.html">textproto.go</a></li>
<li><a href="/gostd/net/textproto/writer.go.html">writer.go</a></li>
<li><a href="/gostd/net/textproto/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3503598">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3503654">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3503708">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3503759">package</span>&nbsp;<span class="ident" id="3503767">textproto</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3503778">import</span>&nbsp;<span class="op" id="3503785">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3503788">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3503797">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3503806">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3503812">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3503825">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3503836">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="3503846">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3503849">//&nbsp;BUG(rsc):&nbsp;To&nbsp;let&nbsp;callers&nbsp;manage&nbsp;exposure&nbsp;to&nbsp;denial&nbsp;of&nbsp;service</span><br>
<span class="lineno"></span><span class="comment" id="3503914">//&nbsp;attacks,&nbsp;Reader&nbsp;should&nbsp;allow&nbsp;them&nbsp;to&nbsp;set&nbsp;and&nbsp;reset&nbsp;a&nbsp;limit&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="3503979">//&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;from&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="3504029">//&nbsp;A&nbsp;Reader&nbsp;implements&nbsp;convenience&nbsp;methods&nbsp;for&nbsp;reading&nbsp;requests</span><br>
<span class="lineno"></span><span class="comment" id="3504093">//&nbsp;or&nbsp;responses&nbsp;from&nbsp;a&nbsp;text&nbsp;protocol&nbsp;network&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="3504150">type</span>&nbsp;<span class="ident" id="3504155">Reader</span>&nbsp;<span class="keyword" id="3504162">struct</span>&nbsp;<span class="op" id="3504169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3504172">R</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3504176">*</span><span class="ident" id="3504177">bufio</span><span class="op" id="3504182">.</span><span class="ident" id="3504183">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3504191">dot</span>&nbsp;<span class="op" id="3504195">*</span><span class="ident" id="3504196">dotReader</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3504207">buf</span>&nbsp;<span class="op" id="3504211">[</span><span class="op" id="3504212">]</span><span class="builtintype" id="3504213">byte</span>&nbsp;<span class="comment" id="3504218">//&nbsp;a&nbsp;re-usable&nbsp;buffer&nbsp;for&nbsp;readContinuedLineSlice</span><br>
<span class="lineno"></span><span class="op" id="3504267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3504270">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="3504320">func</span>&nbsp;<span class="ident" id="3504325">NewReader</span><span class="op" id="3504334">(</span><span class="ident" id="3504335">r</span>&nbsp;<span class="op" id="3504337">*</span><span class="ident" id="3504338">bufio</span><span class="op" id="3504343">.</span><span class="ident" id="3504344">Reader</span><span class="op" id="3504350">)</span>&nbsp;<span class="op" id="3504352">*</span><span class="ident" id="3504353">Reader</span>&nbsp;<span class="op" id="3504360">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3504363">return</span>&nbsp;<span class="op" id="3504370">&amp;</span><span class="ident" id="3504371">Reader</span><span class="op" id="3504377">{</span><span class="ident" id="3504378">R</span><span class="op" id="3504379">:</span>&nbsp;<span class="ident" id="3504381">r</span><span class="op" id="3504382">}</span><br>
<span class="lineno"></span><span class="op" id="3504384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3504387">//&nbsp;ReadLine&nbsp;reads&nbsp;a&nbsp;single&nbsp;line&nbsp;from&nbsp;r,</span><br>
<span class="lineno"></span><span class="comment" id="3504427">//&nbsp;eliding&nbsp;the&nbsp;final&nbsp;\n&nbsp;or&nbsp;\r\n&nbsp;from&nbsp;the&nbsp;returned&nbsp;string.</span><br>
<span class="lineno">35</span><span class="keyword" id="3504485">func</span>&nbsp;<span class="op" id="3504490">(</span><span class="ident" id="3504491">r</span>&nbsp;<span class="op" id="3504493">*</span><span class="ident" id="3504494">Reader</span><span class="op" id="3504500">)</span>&nbsp;<span class="ident" id="3504502">ReadLine</span><span class="op" id="3504510">(</span><span class="op" id="3504511">)</span>&nbsp;<span class="op" id="3504513">(</span><span class="builtintype" id="3504514">string</span><span class="op" id="3504520">,</span>&nbsp;<span class="builtintype" id="3504522">error</span><span class="op" id="3504527">)</span>&nbsp;<span class="op" id="3504529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3504532">line</span><span class="op" id="3504536">,</span>&nbsp;<span class="ident" id="3504538">err</span>&nbsp;<span class="op" id="3504542">:=</span>&nbsp;<span class="ident" id="3504545">r</span><span class="op" id="3504546">.</span><span class="ident" id="3504547">readLineSlice</span><span class="op" id="3504560">(</span><span class="op" id="3504561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3504564">return</span>&nbsp;<span class="builtintype" id="3504571">string</span><span class="op" id="3504577">(</span><span class="ident" id="3504578">line</span><span class="op" id="3504582">)</span><span class="op" id="3504583">,</span>&nbsp;<span class="ident" id="3504585">err</span><br>
<span class="lineno"></span><span class="op" id="3504589">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="3504592">//&nbsp;ReadLineBytes&nbsp;is&nbsp;like&nbsp;ReadLine&nbsp;but&nbsp;returns&nbsp;a&nbsp;[]byte&nbsp;instead&nbsp;of&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3504668">func</span>&nbsp;<span class="op" id="3504673">(</span><span class="ident" id="3504674">r</span>&nbsp;<span class="op" id="3504676">*</span><span class="ident" id="3504677">Reader</span><span class="op" id="3504683">)</span>&nbsp;<span class="ident" id="3504685">ReadLineBytes</span><span class="op" id="3504698">(</span><span class="op" id="3504699">)</span>&nbsp;<span class="op" id="3504701">(</span><span class="op" id="3504702">[</span><span class="op" id="3504703">]</span><span class="builtintype" id="3504704">byte</span><span class="op" id="3504708">,</span>&nbsp;<span class="builtintype" id="3504710">error</span><span class="op" id="3504715">)</span>&nbsp;<span class="op" id="3504717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3504720">line</span><span class="op" id="3504724">,</span>&nbsp;<span class="ident" id="3504726">err</span>&nbsp;<span class="op" id="3504730">:=</span>&nbsp;<span class="ident" id="3504733">r</span><span class="op" id="3504734">.</span><span class="ident" id="3504735">readLineSlice</span><span class="op" id="3504748">(</span><span class="op" id="3504749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3504752">if</span>&nbsp;<span class="ident" id="3504755">line</span>&nbsp;<span class="op" id="3504760">!=</span>&nbsp;<span class="builtintype" id="3504763">nil</span>&nbsp;<span class="op" id="3504767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3504771">buf</span>&nbsp;<span class="op" id="3504775">:=</span>&nbsp;<span class="builtinfunc" id="3504778">make</span><span class="op" id="3504782">(</span><span class="op" id="3504783">[</span><span class="op" id="3504784">]</span><span class="builtintype" id="3504785">byte</span><span class="op" id="3504789">,</span>&nbsp;<span class="builtinfunc" id="3504791">len</span><span class="op" id="3504794">(</span><span class="ident" id="3504795">line</span><span class="op" id="3504799">)</span><span class="op" id="3504800">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3504804">copy</span><span class="op" id="3504808">(</span><span class="ident" id="3504809">buf</span><span class="op" id="3504812">,</span>&nbsp;<span class="ident" id="3504814">line</span><span class="op" id="3504818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3504822">line</span>&nbsp;<span class="op" id="3504827">=</span>&nbsp;<span class="ident" id="3504829">buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3504834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3504837">return</span>&nbsp;<span class="ident" id="3504844">line</span><span class="op" id="3504848">,</span>&nbsp;<span class="ident" id="3504850">err</span><br>
<span class="lineno"></span><span class="op" id="3504854">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="3504857">func</span>&nbsp;<span class="op" id="3504862">(</span><span class="ident" id="3504863">r</span>&nbsp;<span class="op" id="3504865">*</span><span class="ident" id="3504866">Reader</span><span class="op" id="3504872">)</span>&nbsp;<span class="ident" id="3504874">readLineSlice</span><span class="op" id="3504887">(</span><span class="op" id="3504888">)</span>&nbsp;<span class="op" id="3504890">(</span><span class="op" id="3504891">[</span><span class="op" id="3504892">]</span><span class="builtintype" id="3504893">byte</span><span class="op" id="3504897">,</span>&nbsp;<span class="builtintype" id="3504899">error</span><span class="op" id="3504904">)</span>&nbsp;<span class="op" id="3504906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3504909">r</span><span class="op" id="3504910">.</span><span class="ident" id="3504911">closeDot</span><span class="op" id="3504919">(</span><span class="op" id="3504920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3504923">var</span>&nbsp;<span class="ident" id="3504927">line</span>&nbsp;<span class="op" id="3504932">[</span><span class="op" id="3504933">]</span><span class="builtintype" id="3504934">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3504940">for</span>&nbsp;<span class="op" id="3504944">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3504948">l</span><span class="op" id="3504949">,</span>&nbsp;<span class="ident" id="3504951">more</span><span class="op" id="3504955">,</span>&nbsp;<span class="ident" id="3504957">err</span>&nbsp;<span class="op" id="3504961">:=</span>&nbsp;<span class="ident" id="3504964">r</span><span class="op" id="3504965">.</span><span class="ident" id="3504966">R</span><span class="op" id="3504967">.</span><span class="ident" id="3504968">ReadLine</span><span class="op" id="3504976">(</span><span class="op" id="3504977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3504981">if</span>&nbsp;<span class="ident" id="3504984">err</span>&nbsp;<span class="op" id="3504988">!=</span>&nbsp;<span class="builtintype" id="3504991">nil</span>&nbsp;<span class="op" id="3504995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3505000">return</span>&nbsp;<span class="builtintype" id="3505007">nil</span><span class="op" id="3505010">,</span>&nbsp;<span class="ident" id="3505012">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3505018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3505022">//&nbsp;Avoid&nbsp;the&nbsp;copy&nbsp;if&nbsp;the&nbsp;first&nbsp;call&nbsp;produced&nbsp;a&nbsp;full&nbsp;line.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3505082">if</span>&nbsp;<span class="ident" id="3505085">line</span>&nbsp;<span class="op" id="3505090">==</span>&nbsp;<span class="builtintype" id="3505093">nil</span>&nbsp;<span class="op" id="3505097">&amp;&amp;</span>&nbsp;<span class="op" id="3505100">!</span><span class="ident" id="3505101">more</span>&nbsp;<span class="op" id="3505106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3505111">return</span>&nbsp;<span class="ident" id="3505118">l</span><span class="op" id="3505119">,</span>&nbsp;<span class="builtintype" id="3505121">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3505127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3505131">line</span>&nbsp;<span class="op" id="3505136">=</span>&nbsp;<span class="builtinfunc" id="3505138">append</span><span class="op" id="3505144">(</span><span class="ident" id="3505145">line</span><span class="op" id="3505149">,</span>&nbsp;<span class="ident" id="3505151">l</span><span class="op" id="3505152">...</span><span class="op" id="3505155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3505159">if</span>&nbsp;<span class="op" id="3505162">!</span><span class="ident" id="3505163">more</span>&nbsp;<span class="op" id="3505168">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3505173">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3505181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3505184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3505187">return</span>&nbsp;<span class="ident" id="3505194">line</span><span class="op" id="3505198">,</span>&nbsp;<span class="builtintype" id="3505200">nil</span><br>
<span class="lineno"></span><span class="op" id="3505204">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="3505207">//&nbsp;ReadContinuedLine&nbsp;reads&nbsp;a&nbsp;possibly&nbsp;continued&nbsp;line&nbsp;from&nbsp;r,</span><br>
<span class="lineno"></span><span class="comment" id="3505268">//&nbsp;eliding&nbsp;the&nbsp;final&nbsp;trailing&nbsp;ASCII&nbsp;white&nbsp;space.</span><br>
<span class="lineno"></span><span class="comment" id="3505317">//&nbsp;Lines&nbsp;after&nbsp;the&nbsp;first&nbsp;are&nbsp;considered&nbsp;continuations&nbsp;if&nbsp;they</span><br>
<span class="lineno"></span><span class="comment" id="3505379">//&nbsp;begin&nbsp;with&nbsp;a&nbsp;space&nbsp;or&nbsp;tab&nbsp;character.&nbsp;&nbsp;In&nbsp;the&nbsp;returned&nbsp;data,</span><br>
<span class="lineno">75</span><span class="comment" id="3505442">//&nbsp;continuation&nbsp;lines&nbsp;are&nbsp;separated&nbsp;from&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="3505501">//&nbsp;only&nbsp;by&nbsp;a&nbsp;single&nbsp;space:&nbsp;the&nbsp;newline&nbsp;and&nbsp;leading&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><span class="comment" id="3505564">//&nbsp;are&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="3505580">//</span><br>
<span class="lineno"></span><span class="comment" id="3505583">//&nbsp;For&nbsp;example,&nbsp;consider&nbsp;this&nbsp;input:</span><br>
<span class="lineno">80</span><span class="comment" id="3505620">//</span><br>
<span class="lineno"></span><span class="comment" id="3505623">//&nbsp;&nbsp;&nbsp;&nbsp;Line&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="3505633">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continued...</span><br>
<span class="lineno"></span><span class="comment" id="3505651">//&nbsp;&nbsp;&nbsp;&nbsp;Line&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="3505661">//</span><br>
<span class="lineno">85</span><span class="comment" id="3505664">//&nbsp;The&nbsp;first&nbsp;call&nbsp;to&nbsp;ReadContinuedLine&nbsp;will&nbsp;return&nbsp;&#34;Line&nbsp;1&nbsp;continued...&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3505737">//&nbsp;and&nbsp;the&nbsp;second&nbsp;will&nbsp;return&nbsp;&#34;Line&nbsp;2&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3505777">//</span><br>
<span class="lineno"></span><span class="comment" id="3505780">//&nbsp;A&nbsp;line&nbsp;consisting&nbsp;of&nbsp;only&nbsp;white&nbsp;space&nbsp;is&nbsp;never&nbsp;continued.</span><br>
<span class="lineno"></span><span class="comment" id="3505841">//</span><br>
<span class="lineno">90</span><span class="keyword" id="3505844">func</span>&nbsp;<span class="op" id="3505849">(</span><span class="ident" id="3505850">r</span>&nbsp;<span class="op" id="3505852">*</span><span class="ident" id="3505853">Reader</span><span class="op" id="3505859">)</span>&nbsp;<span class="ident" id="3505861">ReadContinuedLine</span><span class="op" id="3505878">(</span><span class="op" id="3505879">)</span>&nbsp;<span class="op" id="3505881">(</span><span class="builtintype" id="3505882">string</span><span class="op" id="3505888">,</span>&nbsp;<span class="builtintype" id="3505890">error</span><span class="op" id="3505895">)</span>&nbsp;<span class="op" id="3505897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3505900">line</span><span class="op" id="3505904">,</span>&nbsp;<span class="ident" id="3505906">err</span>&nbsp;<span class="op" id="3505910">:=</span>&nbsp;<span class="ident" id="3505913">r</span><span class="op" id="3505914">.</span><span class="ident" id="3505915">readContinuedLineSlice</span><span class="op" id="3505937">(</span><span class="op" id="3505938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3505941">return</span>&nbsp;<span class="builtintype" id="3505948">string</span><span class="op" id="3505954">(</span><span class="ident" id="3505955">line</span><span class="op" id="3505959">)</span><span class="op" id="3505960">,</span>&nbsp;<span class="ident" id="3505962">err</span><br>
<span class="lineno"></span><span class="op" id="3505966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="3505969">//&nbsp;trim&nbsp;returns&nbsp;s&nbsp;with&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;spaces&nbsp;and&nbsp;tabs&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="3506038">//&nbsp;It&nbsp;does&nbsp;not&nbsp;assume&nbsp;Unicode&nbsp;or&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="keyword" id="3506078">func</span>&nbsp;<span class="ident" id="3506083">trim</span><span class="op" id="3506087">(</span><span class="ident" id="3506088">s</span>&nbsp;<span class="op" id="3506090">[</span><span class="op" id="3506091">]</span><span class="builtintype" id="3506092">byte</span><span class="op" id="3506096">)</span>&nbsp;<span class="op" id="3506098">[</span><span class="op" id="3506099">]</span><span class="builtintype" id="3506100">byte</span>&nbsp;<span class="op" id="3506105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3506108">i</span>&nbsp;<span class="op" id="3506110">:=</span>&nbsp;<span class="num" id="3506113">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3506116">for</span>&nbsp;<span class="ident" id="3506120">i</span>&nbsp;<span class="op" id="3506122">&lt;</span>&nbsp;<span class="builtinfunc" id="3506124">len</span><span class="op" id="3506127">(</span><span class="ident" id="3506128">s</span><span class="op" id="3506129">)</span>&nbsp;<span class="op" id="3506131">&amp;&amp;</span>&nbsp;<span class="op" id="3506134">(</span><span class="ident" id="3506135">s</span><span class="op" id="3506136">[</span><span class="ident" id="3506137">i</span><span class="op" id="3506138">]</span>&nbsp;<span class="op" id="3506140">==</span>&nbsp;<span class="string" id="3506143">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3506147">||</span>&nbsp;<span class="ident" id="3506150">s</span><span class="op" id="3506151">[</span><span class="ident" id="3506152">i</span><span class="op" id="3506153">]</span>&nbsp;<span class="op" id="3506155">==</span>&nbsp;<span class="string" id="3506158">&#39;\t&#39;</span><span class="op" id="3506162">)</span>&nbsp;<span class="op" id="3506164">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3506168">i</span><span class="op" id="3506169">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3506173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3506176">n</span>&nbsp;<span class="op" id="3506178">:=</span>&nbsp;<span class="builtinfunc" id="3506181">len</span><span class="op" id="3506184">(</span><span class="ident" id="3506185">s</span><span class="op" id="3506186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3506189">for</span>&nbsp;<span class="ident" id="3506193">n</span>&nbsp;<span class="op" id="3506195">&gt;</span>&nbsp;<span class="ident" id="3506197">i</span>&nbsp;<span class="op" id="3506199">&amp;&amp;</span>&nbsp;<span class="op" id="3506202">(</span><span class="ident" id="3506203">s</span><span class="op" id="3506204">[</span><span class="ident" id="3506205">n</span><span class="op" id="3506206">-</span><span class="num" id="3506207">1</span><span class="op" id="3506208">]</span>&nbsp;<span class="op" id="3506210">==</span>&nbsp;<span class="string" id="3506213">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3506217">||</span>&nbsp;<span class="ident" id="3506220">s</span><span class="op" id="3506221">[</span><span class="ident" id="3506222">n</span><span class="op" id="3506223">-</span><span class="num" id="3506224">1</span><span class="op" id="3506225">]</span>&nbsp;<span class="op" id="3506227">==</span>&nbsp;<span class="string" id="3506230">&#39;\t&#39;</span><span class="op" id="3506234">)</span>&nbsp;<span class="op" id="3506236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3506240">n</span><span class="op" id="3506241">--</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3506245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3506248">return</span>&nbsp;<span class="ident" id="3506255">s</span><span class="op" id="3506256">[</span><span class="ident" id="3506257">i</span><span class="op" id="3506258">:</span><span class="ident" id="3506259">n</span><span class="op" id="3506260">]</span><br>
<span class="lineno"></span><span class="op" id="3506262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3506265">//&nbsp;ReadContinuedLineBytes&nbsp;is&nbsp;like&nbsp;ReadContinuedLine&nbsp;but</span><br>
<span class="lineno">110</span><span class="comment" id="3506321">//&nbsp;returns&nbsp;a&nbsp;[]byte&nbsp;instead&nbsp;of&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3506362">func</span>&nbsp;<span class="op" id="3506367">(</span><span class="ident" id="3506368">r</span>&nbsp;<span class="op" id="3506370">*</span><span class="ident" id="3506371">Reader</span><span class="op" id="3506377">)</span>&nbsp;<span class="ident" id="3506379">ReadContinuedLineBytes</span><span class="op" id="3506401">(</span><span class="op" id="3506402">)</span>&nbsp;<span class="op" id="3506404">(</span><span class="op" id="3506405">[</span><span class="op" id="3506406">]</span><span class="builtintype" id="3506407">byte</span><span class="op" id="3506411">,</span>&nbsp;<span class="builtintype" id="3506413">error</span><span class="op" id="3506418">)</span>&nbsp;<span class="op" id="3506420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3506423">line</span><span class="op" id="3506427">,</span>&nbsp;<span class="ident" id="3506429">err</span>&nbsp;<span class="op" id="3506433">:=</span>&nbsp;<span class="ident" id="3506436">r</span><span class="op" id="3506437">.</span><span class="ident" id="3506438">readContinuedLineSlice</span><span class="op" id="3506460">(</span><span class="op" id="3506461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3506464">if</span>&nbsp;<span class="ident" id="3506467">line</span>&nbsp;<span class="op" id="3506472">!=</span>&nbsp;<span class="builtintype" id="3506475">nil</span>&nbsp;<span class="op" id="3506479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3506483">buf</span>&nbsp;<span class="op" id="3506487">:=</span>&nbsp;<span class="builtinfunc" id="3506490">make</span><span class="op" id="3506494">(</span><span class="op" id="3506495">[</span><span class="op" id="3506496">]</span><span class="builtintype" id="3506497">byte</span><span class="op" id="3506501">,</span>&nbsp;<span class="builtinfunc" id="3506503">len</span><span class="op" id="3506506">(</span><span class="ident" id="3506507">line</span><span class="op" id="3506511">)</span><span class="op" id="3506512">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3506516">copy</span><span class="op" id="3506520">(</span><span class="ident" id="3506521">buf</span><span class="op" id="3506524">,</span>&nbsp;<span class="ident" id="3506526">line</span><span class="op" id="3506530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3506534">line</span>&nbsp;<span class="op" id="3506539">=</span>&nbsp;<span class="ident" id="3506541">buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3506546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3506549">return</span>&nbsp;<span class="ident" id="3506556">line</span><span class="op" id="3506560">,</span>&nbsp;<span class="ident" id="3506562">err</span><br>
<span class="lineno"></span><span class="op" id="3506566">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="3506569">func</span>&nbsp;<span class="op" id="3506574">(</span><span class="ident" id="3506575">r</span>&nbsp;<span class="op" id="3506577">*</span><span class="ident" id="3506578">Reader</span><span class="op" id="3506584">)</span>&nbsp;<span class="ident" id="3506586">readContinuedLineSlice</span><span class="op" id="3506608">(</span><span class="op" id="3506609">)</span>&nbsp;<span class="op" id="3506611">(</span><span class="op" id="3506612">[</span><span class="op" id="3506613">]</span><span class="builtintype" id="3506614">byte</span><span class="op" id="3506618">,</span>&nbsp;<span class="builtintype" id="3506620">error</span><span class="op" id="3506625">)</span>&nbsp;<span class="op" id="3506627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3506630">//&nbsp;Read&nbsp;the&nbsp;first&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3506655">line</span><span class="op" id="3506659">,</span>&nbsp;<span class="ident" id="3506661">err</span>&nbsp;<span class="op" id="3506665">:=</span>&nbsp;<span class="ident" id="3506668">r</span><span class="op" id="3506669">.</span><span class="ident" id="3506670">readLineSlice</span><span class="op" id="3506683">(</span><span class="op" id="3506684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3506687">if</span>&nbsp;<span class="ident" id="3506690">err</span>&nbsp;<span class="op" id="3506694">!=</span>&nbsp;<span class="builtintype" id="3506697">nil</span>&nbsp;<span class="op" id="3506701">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3506705">return</span>&nbsp;<span class="builtintype" id="3506712">nil</span><span class="op" id="3506715">,</span>&nbsp;<span class="ident" id="3506717">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3506722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3506725">if</span>&nbsp;<span class="builtinfunc" id="3506728">len</span><span class="op" id="3506731">(</span><span class="ident" id="3506732">line</span><span class="op" id="3506736">)</span>&nbsp;<span class="op" id="3506738">==</span>&nbsp;<span class="num" id="3506741">0</span>&nbsp;<span class="op" id="3506743">{</span>&nbsp;<span class="comment" id="3506745">//&nbsp;blank&nbsp;line&nbsp;-&nbsp;no&nbsp;continuation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3506779">return</span>&nbsp;<span class="ident" id="3506786">line</span><span class="op" id="3506790">,</span>&nbsp;<span class="builtintype" id="3506792">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3506797">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3506801">//&nbsp;Optimistically&nbsp;assume&nbsp;that&nbsp;we&nbsp;have&nbsp;started&nbsp;to&nbsp;buffer&nbsp;the&nbsp;next&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3506872">//&nbsp;and&nbsp;it&nbsp;starts&nbsp;with&nbsp;an&nbsp;ASCII&nbsp;letter&nbsp;(the&nbsp;next&nbsp;header&nbsp;key),&nbsp;so&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3506944">//&nbsp;avoid&nbsp;copying&nbsp;that&nbsp;buffered&nbsp;data&nbsp;around&nbsp;in&nbsp;memory&nbsp;and&nbsp;skipping&nbsp;over</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3507016">//&nbsp;non-existent&nbsp;whitespace.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3507045">if</span>&nbsp;<span class="ident" id="3507048">r</span><span class="op" id="3507049">.</span><span class="ident" id="3507050">R</span><span class="op" id="3507051">.</span><span class="ident" id="3507052">Buffered</span><span class="op" id="3507060">(</span><span class="op" id="3507061">)</span>&nbsp;<span class="op" id="3507063">&gt;</span>&nbsp;<span class="num" id="3507065">1</span>&nbsp;<span class="op" id="3507067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3507071">peek</span><span class="op" id="3507075">,</span>&nbsp;<span class="ident" id="3507077">err</span>&nbsp;<span class="op" id="3507081">:=</span>&nbsp;<span class="ident" id="3507084">r</span><span class="op" id="3507085">.</span><span class="ident" id="3507086">R</span><span class="op" id="3507087">.</span><span class="ident" id="3507088">Peek</span><span class="op" id="3507092">(</span><span class="num" id="3507093">1</span><span class="op" id="3507094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3507098">if</span>&nbsp;<span class="ident" id="3507101">err</span>&nbsp;<span class="op" id="3507105">==</span>&nbsp;<span class="builtintype" id="3507108">nil</span>&nbsp;<span class="op" id="3507112">&amp;&amp;</span>&nbsp;<span class="ident" id="3507115">isASCIILetter</span><span class="op" id="3507128">(</span><span class="ident" id="3507129">peek</span><span class="op" id="3507133">[</span><span class="num" id="3507134">0</span><span class="op" id="3507135">]</span><span class="op" id="3507136">)</span>&nbsp;<span class="op" id="3507138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3507143">return</span>&nbsp;<span class="ident" id="3507150">trim</span><span class="op" id="3507154">(</span><span class="ident" id="3507155">line</span><span class="op" id="3507159">)</span><span class="op" id="3507160">,</span>&nbsp;<span class="builtintype" id="3507162">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3507168">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3507171">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3507175">//&nbsp;ReadByte&nbsp;or&nbsp;the&nbsp;next&nbsp;readLineSlice&nbsp;will&nbsp;flush&nbsp;the&nbsp;read&nbsp;buffer;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3507242">//&nbsp;copy&nbsp;the&nbsp;slice&nbsp;into&nbsp;buf.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3507271">r</span><span class="op" id="3507272">.</span><span class="ident" id="3507273">buf</span>&nbsp;<span class="op" id="3507277">=</span>&nbsp;<span class="builtinfunc" id="3507279">append</span><span class="op" id="3507285">(</span><span class="ident" id="3507286">r</span><span class="op" id="3507287">.</span><span class="ident" id="3507288">buf</span><span class="op" id="3507291">[</span><span class="op" id="3507292">:</span><span class="num" id="3507293">0</span><span class="op" id="3507294">]</span><span class="op" id="3507295">,</span>&nbsp;<span class="ident" id="3507297">trim</span><span class="op" id="3507301">(</span><span class="ident" id="3507302">line</span><span class="op" id="3507306">)</span><span class="op" id="3507307">...</span><span class="op" id="3507310">)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3507314">//&nbsp;Read&nbsp;continuation&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3507343">for</span>&nbsp;<span class="ident" id="3507347">r</span><span class="op" id="3507348">.</span><span class="ident" id="3507349">skipSpace</span><span class="op" id="3507358">(</span><span class="op" id="3507359">)</span>&nbsp;<span class="op" id="3507361">&gt;</span>&nbsp;<span class="num" id="3507363">0</span>&nbsp;<span class="op" id="3507365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3507369">line</span><span class="op" id="3507373">,</span>&nbsp;<span class="ident" id="3507375">err</span>&nbsp;<span class="op" id="3507379">:=</span>&nbsp;<span class="ident" id="3507382">r</span><span class="op" id="3507383">.</span><span class="ident" id="3507384">readLineSlice</span><span class="op" id="3507397">(</span><span class="op" id="3507398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3507402">if</span>&nbsp;<span class="ident" id="3507405">err</span>&nbsp;<span class="op" id="3507409">!=</span>&nbsp;<span class="builtintype" id="3507412">nil</span>&nbsp;<span class="op" id="3507416">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3507421">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3507429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3507433">r</span><span class="op" id="3507434">.</span><span class="ident" id="3507435">buf</span>&nbsp;<span class="op" id="3507439">=</span>&nbsp;<span class="builtinfunc" id="3507441">append</span><span class="op" id="3507447">(</span><span class="ident" id="3507448">r</span><span class="op" id="3507449">.</span><span class="ident" id="3507450">buf</span><span class="op" id="3507453">,</span>&nbsp;<span class="string" id="3507455">&#39;&nbsp;&#39;</span><span class="op" id="3507458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3507462">r</span><span class="op" id="3507463">.</span><span class="ident" id="3507464">buf</span>&nbsp;<span class="op" id="3507468">=</span>&nbsp;<span class="builtinfunc" id="3507470">append</span><span class="op" id="3507476">(</span><span class="ident" id="3507477">r</span><span class="op" id="3507478">.</span><span class="ident" id="3507479">buf</span><span class="op" id="3507482">,</span>&nbsp;<span class="ident" id="3507484">line</span><span class="op" id="3507488">...</span><span class="op" id="3507491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3507494">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3507497">return</span>&nbsp;<span class="ident" id="3507504">r</span><span class="op" id="3507505">.</span><span class="ident" id="3507506">buf</span><span class="op" id="3507509">,</span>&nbsp;<span class="builtintype" id="3507511">nil</span><br>
<span class="lineno"></span><span class="op" id="3507515">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3507518">//&nbsp;skipSpace&nbsp;skips&nbsp;R&nbsp;over&nbsp;all&nbsp;spaces&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="keyword" id="3507596">func</span>&nbsp;<span class="op" id="3507601">(</span><span class="ident" id="3507602">r</span>&nbsp;<span class="op" id="3507604">*</span><span class="ident" id="3507605">Reader</span><span class="op" id="3507611">)</span>&nbsp;<span class="ident" id="3507613">skipSpace</span><span class="op" id="3507622">(</span><span class="op" id="3507623">)</span>&nbsp;<span class="builtintype" id="3507625">int</span>&nbsp;<span class="op" id="3507629">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3507632">n</span>&nbsp;<span class="op" id="3507634">:=</span>&nbsp;<span class="num" id="3507637">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3507640">for</span>&nbsp;<span class="op" id="3507644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3507648">c</span><span class="op" id="3507649">,</span>&nbsp;<span class="ident" id="3507651">err</span>&nbsp;<span class="op" id="3507655">:=</span>&nbsp;<span class="ident" id="3507658">r</span><span class="op" id="3507659">.</span><span class="ident" id="3507660">R</span><span class="op" id="3507661">.</span><span class="ident" id="3507662">ReadByte</span><span class="op" id="3507670">(</span><span class="op" id="3507671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3507675">if</span>&nbsp;<span class="ident" id="3507678">err</span>&nbsp;<span class="op" id="3507682">!=</span>&nbsp;<span class="builtintype" id="3507685">nil</span>&nbsp;<span class="op" id="3507689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3507694">//&nbsp;Bufio&nbsp;will&nbsp;keep&nbsp;err&nbsp;until&nbsp;next&nbsp;read.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3507737">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3507745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3507749">if</span>&nbsp;<span class="ident" id="3507752">c</span>&nbsp;<span class="op" id="3507754">!=</span>&nbsp;<span class="string" id="3507757">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3507761">&amp;&amp;</span>&nbsp;<span class="ident" id="3507764">c</span>&nbsp;<span class="op" id="3507766">!=</span>&nbsp;<span class="string" id="3507769">&#39;\t&#39;</span>&nbsp;<span class="op" id="3507774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3507779">r</span><span class="op" id="3507780">.</span><span class="ident" id="3507781">R</span><span class="op" id="3507782">.</span><span class="ident" id="3507783">UnreadByte</span><span class="op" id="3507793">(</span><span class="op" id="3507794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3507799">break</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3507807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3507811">n</span><span class="op" id="3507812">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3507816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3507819">return</span>&nbsp;<span class="ident" id="3507826">n</span><br>
<span class="lineno"></span><span class="op" id="3507828">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="keyword" id="3507831">func</span>&nbsp;<span class="op" id="3507836">(</span><span class="ident" id="3507837">r</span>&nbsp;<span class="op" id="3507839">*</span><span class="ident" id="3507840">Reader</span><span class="op" id="3507846">)</span>&nbsp;<span class="ident" id="3507848">readCodeLine</span><span class="op" id="3507860">(</span><span class="ident" id="3507861">expectCode</span>&nbsp;<span class="builtintype" id="3507872">int</span><span class="op" id="3507875">)</span>&nbsp;<span class="op" id="3507877">(</span><span class="ident" id="3507878">code</span>&nbsp;<span class="builtintype" id="3507883">int</span><span class="op" id="3507886">,</span>&nbsp;<span class="ident" id="3507888">continued</span>&nbsp;<span class="builtintype" id="3507898">bool</span><span class="op" id="3507902">,</span>&nbsp;<span class="ident" id="3507904">message</span>&nbsp;<span class="builtintype" id="3507912">string</span><span class="op" id="3507918">,</span>&nbsp;<span class="ident" id="3507920">err</span>&nbsp;<span class="builtintype" id="3507924">error</span><span class="op" id="3507929">)</span>&nbsp;<span class="op" id="3507931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3507934">line</span><span class="op" id="3507938">,</span>&nbsp;<span class="ident" id="3507940">err</span>&nbsp;<span class="op" id="3507944">:=</span>&nbsp;<span class="ident" id="3507947">r</span><span class="op" id="3507948">.</span><span class="ident" id="3507949">ReadLine</span><span class="op" id="3507957">(</span><span class="op" id="3507958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3507961">if</span>&nbsp;<span class="ident" id="3507964">err</span>&nbsp;<span class="op" id="3507968">!=</span>&nbsp;<span class="builtintype" id="3507971">nil</span>&nbsp;<span class="op" id="3507975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3507979">return</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3507987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3507990">return</span>&nbsp;<span class="ident" id="3507997">parseCodeLine</span><span class="op" id="3508010">(</span><span class="ident" id="3508011">line</span><span class="op" id="3508015">,</span>&nbsp;<span class="ident" id="3508017">expectCode</span><span class="op" id="3508027">)</span><br>
<span class="lineno"></span><span class="op" id="3508029">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3508032">func</span>&nbsp;<span class="ident" id="3508037">parseCodeLine</span><span class="op" id="3508050">(</span><span class="ident" id="3508051">line</span>&nbsp;<span class="builtintype" id="3508056">string</span><span class="op" id="3508062">,</span>&nbsp;<span class="ident" id="3508064">expectCode</span>&nbsp;<span class="builtintype" id="3508075">int</span><span class="op" id="3508078">)</span>&nbsp;<span class="op" id="3508080">(</span><span class="ident" id="3508081">code</span>&nbsp;<span class="builtintype" id="3508086">int</span><span class="op" id="3508089">,</span>&nbsp;<span class="ident" id="3508091">continued</span>&nbsp;<span class="builtintype" id="3508101">bool</span><span class="op" id="3508105">,</span>&nbsp;<span class="ident" id="3508107">message</span>&nbsp;<span class="builtintype" id="3508115">string</span><span class="op" id="3508121">,</span>&nbsp;<span class="ident" id="3508123">err</span>&nbsp;<span class="builtintype" id="3508127">error</span><span class="op" id="3508132">)</span>&nbsp;<span class="op" id="3508134">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3508137">if</span>&nbsp;<span class="builtinfunc" id="3508140">len</span><span class="op" id="3508143">(</span><span class="ident" id="3508144">line</span><span class="op" id="3508148">)</span>&nbsp;<span class="op" id="3508150">&lt;</span>&nbsp;<span class="num" id="3508152">4</span>&nbsp;<span class="op" id="3508154">||</span>&nbsp;<span class="ident" id="3508157">line</span><span class="op" id="3508161">[</span><span class="num" id="3508162">3</span><span class="op" id="3508163">]</span>&nbsp;<span class="op" id="3508165">!=</span>&nbsp;<span class="string" id="3508168">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3508172">&amp;&amp;</span>&nbsp;<span class="ident" id="3508175">line</span><span class="op" id="3508179">[</span><span class="num" id="3508180">3</span><span class="op" id="3508181">]</span>&nbsp;<span class="op" id="3508183">!=</span>&nbsp;<span class="string" id="3508186">&#39;-&#39;</span>&nbsp;<span class="op" id="3508190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3508194">err</span>&nbsp;<span class="op" id="3508198">=</span>&nbsp;<span class="ident" id="3508200">ProtocolError</span><span class="op" id="3508213">(</span><span class="string" id="3508214">&#34;short&nbsp;response:&nbsp;&#34;</span>&nbsp;<span class="op" id="3508233">+</span>&nbsp;<span class="ident" id="3508235">line</span><span class="op" id="3508239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3508243">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3508251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3508254">continued</span>&nbsp;<span class="op" id="3508264">=</span>&nbsp;<span class="ident" id="3508266">line</span><span class="op" id="3508270">[</span><span class="num" id="3508271">3</span><span class="op" id="3508272">]</span>&nbsp;<span class="op" id="3508274">==</span>&nbsp;<span class="string" id="3508277">&#39;-&#39;</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3508282">code</span><span class="op" id="3508286">,</span>&nbsp;<span class="ident" id="3508288">err</span>&nbsp;<span class="op" id="3508292">=</span>&nbsp;<span class="ident" id="3508294">strconv</span><span class="op" id="3508301">.</span><span class="ident" id="3508302">Atoi</span><span class="op" id="3508306">(</span><span class="ident" id="3508307">line</span><span class="op" id="3508311">[</span><span class="num" id="3508312">0</span><span class="op" id="3508313">:</span><span class="num" id="3508314">3</span><span class="op" id="3508315">]</span><span class="op" id="3508316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3508319">if</span>&nbsp;<span class="ident" id="3508322">err</span>&nbsp;<span class="op" id="3508326">!=</span>&nbsp;<span class="builtintype" id="3508329">nil</span>&nbsp;<span class="op" id="3508333">||</span>&nbsp;<span class="ident" id="3508336">code</span>&nbsp;<span class="op" id="3508341">&lt;</span>&nbsp;<span class="num" id="3508343">100</span>&nbsp;<span class="op" id="3508347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3508351">err</span>&nbsp;<span class="op" id="3508355">=</span>&nbsp;<span class="ident" id="3508357">ProtocolError</span><span class="op" id="3508370">(</span><span class="string" id="3508371">&#34;invalid&nbsp;response&nbsp;code:&nbsp;&#34;</span>&nbsp;<span class="op" id="3508397">+</span>&nbsp;<span class="ident" id="3508399">line</span><span class="op" id="3508403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3508407">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3508415">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3508418">message</span>&nbsp;<span class="op" id="3508426">=</span>&nbsp;<span class="ident" id="3508428">line</span><span class="op" id="3508432">[</span><span class="num" id="3508433">4</span><span class="op" id="3508434">:</span><span class="op" id="3508435">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3508438">if</span>&nbsp;<span class="num" id="3508441">1</span>&nbsp;<span class="op" id="3508443">&lt;=</span>&nbsp;<span class="ident" id="3508446">expectCode</span>&nbsp;<span class="op" id="3508457">&amp;&amp;</span>&nbsp;<span class="ident" id="3508460">expectCode</span>&nbsp;<span class="op" id="3508471">&lt;</span>&nbsp;<span class="num" id="3508473">10</span>&nbsp;<span class="op" id="3508476">&amp;&amp;</span>&nbsp;<span class="ident" id="3508479">code</span><span class="op" id="3508483">/</span><span class="num" id="3508484">100</span>&nbsp;<span class="op" id="3508488">!=</span>&nbsp;<span class="ident" id="3508491">expectCode</span>&nbsp;<span class="op" id="3508502">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3508507">10</span>&nbsp;<span class="op" id="3508510">&lt;=</span>&nbsp;<span class="ident" id="3508513">expectCode</span>&nbsp;<span class="op" id="3508524">&amp;&amp;</span>&nbsp;<span class="ident" id="3508527">expectCode</span>&nbsp;<span class="op" id="3508538">&lt;</span>&nbsp;<span class="num" id="3508540">100</span>&nbsp;<span class="op" id="3508544">&amp;&amp;</span>&nbsp;<span class="ident" id="3508547">code</span><span class="op" id="3508551">/</span><span class="num" id="3508552">10</span>&nbsp;<span class="op" id="3508555">!=</span>&nbsp;<span class="ident" id="3508558">expectCode</span>&nbsp;<span class="op" id="3508569">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3508574">100</span>&nbsp;<span class="op" id="3508578">&lt;=</span>&nbsp;<span class="ident" id="3508581">expectCode</span>&nbsp;<span class="op" id="3508592">&amp;&amp;</span>&nbsp;<span class="ident" id="3508595">expectCode</span>&nbsp;<span class="op" id="3508606">&lt;</span>&nbsp;<span class="num" id="3508608">1000</span>&nbsp;<span class="op" id="3508613">&amp;&amp;</span>&nbsp;<span class="ident" id="3508616">code</span>&nbsp;<span class="op" id="3508621">!=</span>&nbsp;<span class="ident" id="3508624">expectCode</span>&nbsp;<span class="op" id="3508635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3508639">err</span>&nbsp;<span class="op" id="3508643">=</span>&nbsp;<span class="op" id="3508645">&amp;</span><span class="ident" id="3508646">Error</span><span class="op" id="3508651">{</span><span class="ident" id="3508652">code</span><span class="op" id="3508656">,</span>&nbsp;<span class="ident" id="3508658">message</span><span class="op" id="3508665">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3508668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3508671">return</span><br>
<span class="lineno"></span><span class="op" id="3508678">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3508681">//&nbsp;ReadCodeLine&nbsp;reads&nbsp;a&nbsp;response&nbsp;code&nbsp;line&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno">205</span><span class="comment" id="3508736">//&nbsp;&nbsp;&nbsp;&nbsp;code&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="3508752">//&nbsp;where&nbsp;code&nbsp;is&nbsp;a&nbsp;three-digit&nbsp;status&nbsp;code&nbsp;and&nbsp;the&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="3508811">//&nbsp;extends&nbsp;to&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;line.&nbsp;&nbsp;An&nbsp;example&nbsp;of&nbsp;such&nbsp;a&nbsp;line&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="3508878">//&nbsp;&nbsp;&nbsp;&nbsp;220&nbsp;plan9.bell-labs.com&nbsp;ESMTP</span><br>
<span class="lineno"></span><span class="comment" id="3508911">//</span><br>
<span class="lineno">210</span><span class="comment" id="3508914">//&nbsp;If&nbsp;the&nbsp;prefix&nbsp;of&nbsp;the&nbsp;status&nbsp;does&nbsp;not&nbsp;match&nbsp;the&nbsp;digits&nbsp;in&nbsp;expectCode,</span><br>
<span class="lineno"></span><span class="comment" id="3508986">//&nbsp;ReadCodeLine&nbsp;returns&nbsp;with&nbsp;err&nbsp;set&nbsp;to&nbsp;&amp;Error{code,&nbsp;message}.</span><br>
<span class="lineno"></span><span class="comment" id="3509049">//&nbsp;For&nbsp;example,&nbsp;if&nbsp;expectCode&nbsp;is&nbsp;31,&nbsp;an&nbsp;error&nbsp;will&nbsp;be&nbsp;returned&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="3509115">//&nbsp;the&nbsp;status&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;range&nbsp;[310,319].</span><br>
<span class="lineno"></span><span class="comment" id="3509160">//</span><br>
<span class="lineno">215</span><span class="comment" id="3509163">//&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;multi-line,&nbsp;ReadCodeLine&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="3509228">//</span><br>
<span class="lineno"></span><span class="comment" id="3509231">//&nbsp;An&nbsp;expectCode&nbsp;&lt;=&nbsp;0&nbsp;disables&nbsp;the&nbsp;check&nbsp;of&nbsp;the&nbsp;status&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="3509292">//</span><br>
<span class="lineno"></span><span class="keyword" id="3509295">func</span>&nbsp;<span class="op" id="3509300">(</span><span class="ident" id="3509301">r</span>&nbsp;<span class="op" id="3509303">*</span><span class="ident" id="3509304">Reader</span><span class="op" id="3509310">)</span>&nbsp;<span class="ident" id="3509312">ReadCodeLine</span><span class="op" id="3509324">(</span><span class="ident" id="3509325">expectCode</span>&nbsp;<span class="builtintype" id="3509336">int</span><span class="op" id="3509339">)</span>&nbsp;<span class="op" id="3509341">(</span><span class="ident" id="3509342">code</span>&nbsp;<span class="builtintype" id="3509347">int</span><span class="op" id="3509350">,</span>&nbsp;<span class="ident" id="3509352">message</span>&nbsp;<span class="builtintype" id="3509360">string</span><span class="op" id="3509366">,</span>&nbsp;<span class="ident" id="3509368">err</span>&nbsp;<span class="builtintype" id="3509372">error</span><span class="op" id="3509377">)</span>&nbsp;<span class="op" id="3509379">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3509382">code</span><span class="op" id="3509386">,</span>&nbsp;<span class="ident" id="3509388">continued</span><span class="op" id="3509397">,</span>&nbsp;<span class="ident" id="3509399">message</span><span class="op" id="3509406">,</span>&nbsp;<span class="ident" id="3509408">err</span>&nbsp;<span class="op" id="3509412">:=</span>&nbsp;<span class="ident" id="3509415">r</span><span class="op" id="3509416">.</span><span class="ident" id="3509417">readCodeLine</span><span class="op" id="3509429">(</span><span class="ident" id="3509430">expectCode</span><span class="op" id="3509440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3509443">if</span>&nbsp;<span class="ident" id="3509446">err</span>&nbsp;<span class="op" id="3509450">==</span>&nbsp;<span class="builtintype" id="3509453">nil</span>&nbsp;<span class="op" id="3509457">&amp;&amp;</span>&nbsp;<span class="ident" id="3509460">continued</span>&nbsp;<span class="op" id="3509470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3509474">err</span>&nbsp;<span class="op" id="3509478">=</span>&nbsp;<span class="ident" id="3509480">ProtocolError</span><span class="op" id="3509493">(</span><span class="string" id="3509494">&#34;unexpected&nbsp;multi-line&nbsp;response:&nbsp;&#34;</span>&nbsp;<span class="op" id="3509529">+</span>&nbsp;<span class="ident" id="3509531">message</span><span class="op" id="3509538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3509541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3509544">return</span><br>
<span class="lineno">225</span><span class="op" id="3509551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3509554">//&nbsp;ReadResponse&nbsp;reads&nbsp;a&nbsp;multi-line&nbsp;response&nbsp;of&nbsp;the&nbsp;form:</span><br>
<span class="lineno"></span><span class="comment" id="3509611">//</span><br>
<span class="lineno"></span><span class="comment" id="3509614">//&nbsp;&nbsp;&nbsp;&nbsp;code-message&nbsp;line&nbsp;1</span><br>
<span class="lineno">230</span><span class="comment" id="3509637">//&nbsp;&nbsp;&nbsp;&nbsp;code-message&nbsp;line&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="3509660">//&nbsp;&nbsp;&nbsp;&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="3509667">//&nbsp;&nbsp;&nbsp;&nbsp;code&nbsp;message&nbsp;line&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="3509690">//</span><br>
<span class="lineno"></span><span class="comment" id="3509693">//&nbsp;where&nbsp;code&nbsp;is&nbsp;a&nbsp;three-digit&nbsp;status&nbsp;code.&nbsp;The&nbsp;first&nbsp;line&nbsp;starts&nbsp;with&nbsp;the</span><br>
<span class="lineno">235</span><span class="comment" id="3509768">//&nbsp;code&nbsp;and&nbsp;a&nbsp;hyphen.&nbsp;The&nbsp;response&nbsp;is&nbsp;terminated&nbsp;by&nbsp;a&nbsp;line&nbsp;that&nbsp;starts</span><br>
<span class="lineno"></span><span class="comment" id="3509839">//&nbsp;with&nbsp;the&nbsp;same&nbsp;code&nbsp;followed&nbsp;by&nbsp;a&nbsp;space.&nbsp;Each&nbsp;line&nbsp;in&nbsp;message&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3509906">//&nbsp;separated&nbsp;by&nbsp;a&nbsp;newline&nbsp;(\n).</span><br>
<span class="lineno"></span><span class="comment" id="3509938">//</span><br>
<span class="lineno"></span><span class="comment" id="3509941">//&nbsp;See&nbsp;page&nbsp;36&nbsp;of&nbsp;RFC&nbsp;959&nbsp;(http://www.ietf.org/rfc/rfc959.txt)&nbsp;for</span><br>
<span class="lineno">240</span><span class="comment" id="3510008">//&nbsp;details.</span><br>
<span class="lineno"></span><span class="comment" id="3510020">//</span><br>
<span class="lineno"></span><span class="comment" id="3510023">//&nbsp;If&nbsp;the&nbsp;prefix&nbsp;of&nbsp;the&nbsp;status&nbsp;does&nbsp;not&nbsp;match&nbsp;the&nbsp;digits&nbsp;in&nbsp;expectCode,</span><br>
<span class="lineno"></span><span class="comment" id="3510095">//&nbsp;ReadResponse&nbsp;returns&nbsp;with&nbsp;err&nbsp;set&nbsp;to&nbsp;&amp;Error{code,&nbsp;message}.</span><br>
<span class="lineno"></span><span class="comment" id="3510158">//&nbsp;For&nbsp;example,&nbsp;if&nbsp;expectCode&nbsp;is&nbsp;31,&nbsp;an&nbsp;error&nbsp;will&nbsp;be&nbsp;returned&nbsp;if</span><br>
<span class="lineno">245</span><span class="comment" id="3510224">//&nbsp;the&nbsp;status&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;range&nbsp;[310,319].</span><br>
<span class="lineno"></span><span class="comment" id="3510269">//</span><br>
<span class="lineno"></span><span class="comment" id="3510272">//&nbsp;An&nbsp;expectCode&nbsp;&lt;=&nbsp;0&nbsp;disables&nbsp;the&nbsp;check&nbsp;of&nbsp;the&nbsp;status&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="3510333">//</span><br>
<span class="lineno"></span><span class="keyword" id="3510336">func</span>&nbsp;<span class="op" id="3510341">(</span><span class="ident" id="3510342">r</span>&nbsp;<span class="op" id="3510344">*</span><span class="ident" id="3510345">Reader</span><span class="op" id="3510351">)</span>&nbsp;<span class="ident" id="3510353">ReadResponse</span><span class="op" id="3510365">(</span><span class="ident" id="3510366">expectCode</span>&nbsp;<span class="builtintype" id="3510377">int</span><span class="op" id="3510380">)</span>&nbsp;<span class="op" id="3510382">(</span><span class="ident" id="3510383">code</span>&nbsp;<span class="builtintype" id="3510388">int</span><span class="op" id="3510391">,</span>&nbsp;<span class="ident" id="3510393">message</span>&nbsp;<span class="builtintype" id="3510401">string</span><span class="op" id="3510407">,</span>&nbsp;<span class="ident" id="3510409">err</span>&nbsp;<span class="builtintype" id="3510413">error</span><span class="op" id="3510418">)</span>&nbsp;<span class="op" id="3510420">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3510423">code</span><span class="op" id="3510427">,</span>&nbsp;<span class="ident" id="3510429">continued</span><span class="op" id="3510438">,</span>&nbsp;<span class="ident" id="3510440">message</span><span class="op" id="3510447">,</span>&nbsp;<span class="ident" id="3510449">err</span>&nbsp;<span class="op" id="3510453">:=</span>&nbsp;<span class="ident" id="3510456">r</span><span class="op" id="3510457">.</span><span class="ident" id="3510458">readCodeLine</span><span class="op" id="3510470">(</span><span class="ident" id="3510471">expectCode</span><span class="op" id="3510481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3510484">for</span>&nbsp;<span class="ident" id="3510488">err</span>&nbsp;<span class="op" id="3510492">==</span>&nbsp;<span class="builtintype" id="3510495">nil</span>&nbsp;<span class="op" id="3510499">&amp;&amp;</span>&nbsp;<span class="ident" id="3510502">continued</span>&nbsp;<span class="op" id="3510512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3510516">line</span><span class="op" id="3510520">,</span>&nbsp;<span class="ident" id="3510522">err</span>&nbsp;<span class="op" id="3510526">:=</span>&nbsp;<span class="ident" id="3510529">r</span><span class="op" id="3510530">.</span><span class="ident" id="3510531">ReadLine</span><span class="op" id="3510539">(</span><span class="op" id="3510540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3510544">if</span>&nbsp;<span class="ident" id="3510547">err</span>&nbsp;<span class="op" id="3510551">!=</span>&nbsp;<span class="builtintype" id="3510554">nil</span>&nbsp;<span class="op" id="3510558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3510563">return</span>&nbsp;<span class="num" id="3510570">0</span><span class="op" id="3510571">,</span>&nbsp;<span class="string" id="3510573">&#34;&#34;</span><span class="op" id="3510575">,</span>&nbsp;<span class="ident" id="3510577">err</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3510583">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3510588">var</span>&nbsp;<span class="ident" id="3510592">code2</span>&nbsp;<span class="builtintype" id="3510598">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3510604">var</span>&nbsp;<span class="ident" id="3510608">moreMessage</span>&nbsp;<span class="builtintype" id="3510620">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3510629">code2</span><span class="op" id="3510634">,</span>&nbsp;<span class="ident" id="3510636">continued</span><span class="op" id="3510645">,</span>&nbsp;<span class="ident" id="3510647">moreMessage</span><span class="op" id="3510658">,</span>&nbsp;<span class="ident" id="3510660">err</span>&nbsp;<span class="op" id="3510664">=</span>&nbsp;<span class="ident" id="3510666">parseCodeLine</span><span class="op" id="3510679">(</span><span class="ident" id="3510680">line</span><span class="op" id="3510684">,</span>&nbsp;<span class="ident" id="3510686">expectCode</span><span class="op" id="3510696">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3510700">if</span>&nbsp;<span class="ident" id="3510703">err</span>&nbsp;<span class="op" id="3510707">!=</span>&nbsp;<span class="builtintype" id="3510710">nil</span>&nbsp;<span class="op" id="3510714">||</span>&nbsp;<span class="ident" id="3510717">code2</span>&nbsp;<span class="op" id="3510723">!=</span>&nbsp;<span class="ident" id="3510726">code</span>&nbsp;<span class="op" id="3510731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3510736">message</span>&nbsp;<span class="op" id="3510744">+=</span>&nbsp;<span class="string" id="3510747">&#34;\n&#34;</span>&nbsp;<span class="op" id="3510752">+</span>&nbsp;<span class="ident" id="3510754">strings</span><span class="op" id="3510761">.</span><span class="ident" id="3510762">TrimRight</span><span class="op" id="3510771">(</span><span class="ident" id="3510772">line</span><span class="op" id="3510776">,</span>&nbsp;<span class="string" id="3510778">&#34;\r\n&#34;</span><span class="op" id="3510784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3510789">continued</span>&nbsp;<span class="op" id="3510799">=</span>&nbsp;<span class="builtintype" id="3510801">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3510809">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3510820">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3510824">message</span>&nbsp;<span class="op" id="3510832">+=</span>&nbsp;<span class="string" id="3510835">&#34;\n&#34;</span>&nbsp;<span class="op" id="3510840">+</span>&nbsp;<span class="ident" id="3510842">moreMessage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3510855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3510858">return</span><br>
<span class="lineno"></span><span class="op" id="3510865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="3510868">//&nbsp;DotReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;that&nbsp;satisfies&nbsp;Reads&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3510933">//&nbsp;decoded&nbsp;text&nbsp;of&nbsp;a&nbsp;dot-encoded&nbsp;block&nbsp;read&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="3510985">//&nbsp;The&nbsp;returned&nbsp;Reader&nbsp;is&nbsp;only&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="3511042">//&nbsp;to&nbsp;a&nbsp;method&nbsp;on&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="3511063">//</span><br>
<span class="lineno">275</span><span class="comment" id="3511066">//&nbsp;Dot&nbsp;encoding&nbsp;is&nbsp;a&nbsp;common&nbsp;framing&nbsp;used&nbsp;for&nbsp;data&nbsp;blocks</span><br>
<span class="lineno"></span><span class="comment" id="3511123">//&nbsp;in&nbsp;text&nbsp;protocols&nbsp;such&nbsp;as&nbsp;SMTP.&nbsp;&nbsp;The&nbsp;data&nbsp;consists&nbsp;of&nbsp;a&nbsp;sequence</span><br>
<span class="lineno"></span><span class="comment" id="3511191">//&nbsp;of&nbsp;lines,&nbsp;each&nbsp;of&nbsp;which&nbsp;ends&nbsp;in&nbsp;&#34;\r\n&#34;.&nbsp;&nbsp;The&nbsp;sequence&nbsp;itself</span><br>
<span class="lineno"></span><span class="comment" id="3511255">//&nbsp;ends&nbsp;at&nbsp;a&nbsp;line&nbsp;containing&nbsp;just&nbsp;a&nbsp;dot:&nbsp;&#34;.\r\n&#34;.&nbsp;&nbsp;Lines&nbsp;beginning</span><br>
<span class="lineno"></span><span class="comment" id="3511322">//&nbsp;with&nbsp;a&nbsp;dot&nbsp;are&nbsp;escaped&nbsp;with&nbsp;an&nbsp;additional&nbsp;dot&nbsp;to&nbsp;avoid</span><br>
<span class="lineno">280</span><span class="comment" id="3511380">//&nbsp;looking&nbsp;like&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="3511421">//</span><br>
<span class="lineno"></span><span class="comment" id="3511424">//&nbsp;The&nbsp;decoded&nbsp;form&nbsp;returned&nbsp;by&nbsp;the&nbsp;Reader&#39;s&nbsp;Read&nbsp;method</span><br>
<span class="lineno"></span><span class="comment" id="3511481">//&nbsp;rewrites&nbsp;the&nbsp;&#34;\r\n&#34;&nbsp;line&nbsp;endings&nbsp;into&nbsp;the&nbsp;simpler&nbsp;&#34;\n&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3511540">//&nbsp;removes&nbsp;leading&nbsp;dot&nbsp;escapes&nbsp;if&nbsp;present,&nbsp;and&nbsp;stops&nbsp;with&nbsp;error&nbsp;io.EOF</span><br>
<span class="lineno">285</span><span class="comment" id="3511611">//&nbsp;after&nbsp;consuming&nbsp;(and&nbsp;discarding)&nbsp;the&nbsp;end-of-sequence&nbsp;line.</span><br>
<span class="lineno"></span><span class="keyword" id="3511673">func</span>&nbsp;<span class="op" id="3511678">(</span><span class="ident" id="3511679">r</span>&nbsp;<span class="op" id="3511681">*</span><span class="ident" id="3511682">Reader</span><span class="op" id="3511688">)</span>&nbsp;<span class="ident" id="3511690">DotReader</span><span class="op" id="3511699">(</span><span class="op" id="3511700">)</span>&nbsp;<span class="ident" id="3511702">io</span><span class="op" id="3511704">.</span><span class="ident" id="3511705">Reader</span>&nbsp;<span class="op" id="3511712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3511715">r</span><span class="op" id="3511716">.</span><span class="ident" id="3511717">closeDot</span><span class="op" id="3511725">(</span><span class="op" id="3511726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3511729">r</span><span class="op" id="3511730">.</span><span class="ident" id="3511731">dot</span>&nbsp;<span class="op" id="3511735">=</span>&nbsp;<span class="op" id="3511737">&amp;</span><span class="ident" id="3511738">dotReader</span><span class="op" id="3511747">{</span><span class="ident" id="3511748">r</span><span class="op" id="3511749">:</span>&nbsp;<span class="ident" id="3511751">r</span><span class="op" id="3511752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3511755">return</span>&nbsp;<span class="ident" id="3511762">r</span><span class="op" id="3511763">.</span><span class="ident" id="3511764">dot</span><br>
<span class="lineno">290</span><span class="op" id="3511768">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3511771">type</span>&nbsp;<span class="ident" id="3511776">dotReader</span>&nbsp;<span class="keyword" id="3511786">struct</span>&nbsp;<span class="op" id="3511793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3511796">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3511802">*</span><span class="ident" id="3511803">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3511811">state</span>&nbsp;<span class="builtintype" id="3511817">int</span><br>
<span class="lineno">295</span><span class="op" id="3511821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3511824">//&nbsp;Read&nbsp;satisfies&nbsp;reads&nbsp;by&nbsp;decoding&nbsp;dot-encoded&nbsp;data&nbsp;read&nbsp;from&nbsp;d.r.</span><br>
<span class="lineno"></span><span class="keyword" id="3511892">func</span>&nbsp;<span class="op" id="3511897">(</span><span class="ident" id="3511898">d</span>&nbsp;<span class="op" id="3511900">*</span><span class="ident" id="3511901">dotReader</span><span class="op" id="3511910">)</span>&nbsp;<span class="ident" id="3511912">Read</span><span class="op" id="3511916">(</span><span class="ident" id="3511917">b</span>&nbsp;<span class="op" id="3511919">[</span><span class="op" id="3511920">]</span><span class="builtintype" id="3511921">byte</span><span class="op" id="3511925">)</span>&nbsp;<span class="op" id="3511927">(</span><span class="ident" id="3511928">n</span>&nbsp;<span class="builtintype" id="3511930">int</span><span class="op" id="3511933">,</span>&nbsp;<span class="ident" id="3511935">err</span>&nbsp;<span class="builtintype" id="3511939">error</span><span class="op" id="3511944">)</span>&nbsp;<span class="op" id="3511946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3511949">//&nbsp;Run&nbsp;data&nbsp;through&nbsp;a&nbsp;simple&nbsp;state&nbsp;machine&nbsp;to</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3511996">//&nbsp;elide&nbsp;leading&nbsp;dots,&nbsp;rewrite&nbsp;trailing&nbsp;\r\n&nbsp;into&nbsp;\n,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3512051">//&nbsp;and&nbsp;detect&nbsp;ending&nbsp;.\r\n&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3512085">const</span>&nbsp;<span class="op" id="3512091">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3512095">stateBeginLine</span>&nbsp;<span class="op" id="3512110">=</span>&nbsp;<span class="ident" id="3512112">iota</span>&nbsp;<span class="comment" id="3512117">//&nbsp;beginning&nbsp;of&nbsp;line;&nbsp;initial&nbsp;state;&nbsp;must&nbsp;be&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3512169">stateDot</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3512191">//&nbsp;read&nbsp;.&nbsp;at&nbsp;beginning&nbsp;of&nbsp;line</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3512224">stateDotCR</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3512246">//&nbsp;read&nbsp;.\r&nbsp;at&nbsp;beginning&nbsp;of&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3512281">stateCR</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3512303">//&nbsp;read&nbsp;\r&nbsp;(possibly&nbsp;at&nbsp;end&nbsp;of&nbsp;line)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3512342">stateData</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3512364">//&nbsp;reading&nbsp;data&nbsp;in&nbsp;middle&nbsp;of&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3512400">stateEOF</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3512422">//&nbsp;reached&nbsp;.\r\n&nbsp;end&nbsp;marker&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3512456">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3512459">br</span>&nbsp;<span class="op" id="3512462">:=</span>&nbsp;<span class="ident" id="3512465">d</span><span class="op" id="3512466">.</span><span class="ident" id="3512467">r</span><span class="op" id="3512468">.</span><span class="ident" id="3512469">R</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3512472">for</span>&nbsp;<span class="ident" id="3512476">n</span>&nbsp;<span class="op" id="3512478">&lt;</span>&nbsp;<span class="builtinfunc" id="3512480">len</span><span class="op" id="3512483">(</span><span class="ident" id="3512484">b</span><span class="op" id="3512485">)</span>&nbsp;<span class="op" id="3512487">&amp;&amp;</span>&nbsp;<span class="ident" id="3512490">d</span><span class="op" id="3512491">.</span><span class="ident" id="3512492">state</span>&nbsp;<span class="op" id="3512498">!=</span>&nbsp;<span class="ident" id="3512501">stateEOF</span>&nbsp;<span class="op" id="3512510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3512514">var</span>&nbsp;<span class="ident" id="3512518">c</span>&nbsp;<span class="builtintype" id="3512520">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3512527">c</span><span class="op" id="3512528">,</span>&nbsp;<span class="ident" id="3512530">err</span>&nbsp;<span class="op" id="3512534">=</span>&nbsp;<span class="ident" id="3512536">br</span><span class="op" id="3512538">.</span><span class="ident" id="3512539">ReadByte</span><span class="op" id="3512547">(</span><span class="op" id="3512548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3512552">if</span>&nbsp;<span class="ident" id="3512555">err</span>&nbsp;<span class="op" id="3512559">!=</span>&nbsp;<span class="builtintype" id="3512562">nil</span>&nbsp;<span class="op" id="3512566">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3512571">if</span>&nbsp;<span class="ident" id="3512574">err</span>&nbsp;<span class="op" id="3512578">==</span>&nbsp;<span class="ident" id="3512581">io</span><span class="op" id="3512583">.</span><span class="ident" id="3512584">EOF</span>&nbsp;<span class="op" id="3512588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3512594">err</span>&nbsp;<span class="op" id="3512598">=</span>&nbsp;<span class="ident" id="3512600">io</span><span class="op" id="3512602">.</span><span class="ident" id="3512603">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3512623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3512628">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3512636">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3512640">switch</span>&nbsp;<span class="ident" id="3512647">d</span><span class="op" id="3512648">.</span><span class="ident" id="3512649">state</span>&nbsp;<span class="op" id="3512655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3512659">case</span>&nbsp;<span class="ident" id="3512664">stateBeginLine</span><span class="op" id="3512678">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3512683">if</span>&nbsp;<span class="ident" id="3512686">c</span>&nbsp;<span class="op" id="3512688">==</span>&nbsp;<span class="string" id="3512691">&#39;.&#39;</span>&nbsp;<span class="op" id="3512695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3512701">d</span><span class="op" id="3512702">.</span><span class="ident" id="3512703">state</span>&nbsp;<span class="op" id="3512709">=</span>&nbsp;<span class="ident" id="3512711">stateDot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3512724">continue</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3512736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3512741">if</span>&nbsp;<span class="ident" id="3512744">c</span>&nbsp;<span class="op" id="3512746">==</span>&nbsp;<span class="string" id="3512749">&#39;\r&#39;</span>&nbsp;<span class="op" id="3512754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3512760">d</span><span class="op" id="3512761">.</span><span class="ident" id="3512762">state</span>&nbsp;<span class="op" id="3512768">=</span>&nbsp;<span class="ident" id="3512770">stateCR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3512782">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3512794">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3512799">d</span><span class="op" id="3512800">.</span><span class="ident" id="3512801">state</span>&nbsp;<span class="op" id="3512807">=</span>&nbsp;<span class="ident" id="3512809">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3512822">case</span>&nbsp;<span class="ident" id="3512827">stateDot</span><span class="op" id="3512835">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3512840">if</span>&nbsp;<span class="ident" id="3512843">c</span>&nbsp;<span class="op" id="3512845">==</span>&nbsp;<span class="string" id="3512848">&#39;\r&#39;</span>&nbsp;<span class="op" id="3512853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3512859">d</span><span class="op" id="3512860">.</span><span class="ident" id="3512861">state</span>&nbsp;<span class="op" id="3512867">=</span>&nbsp;<span class="ident" id="3512869">stateDotCR</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3512884">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3512896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3512901">if</span>&nbsp;<span class="ident" id="3512904">c</span>&nbsp;<span class="op" id="3512906">==</span>&nbsp;<span class="string" id="3512909">&#39;\n&#39;</span>&nbsp;<span class="op" id="3512914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3512920">d</span><span class="op" id="3512921">.</span><span class="ident" id="3512922">state</span>&nbsp;<span class="op" id="3512928">=</span>&nbsp;<span class="ident" id="3512930">stateEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3512943">continue</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3512955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3512960">d</span><span class="op" id="3512961">.</span><span class="ident" id="3512962">state</span>&nbsp;<span class="op" id="3512968">=</span>&nbsp;<span class="ident" id="3512970">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3512983">case</span>&nbsp;<span class="ident" id="3512988">stateDotCR</span><span class="op" id="3512998">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3513003">if</span>&nbsp;<span class="ident" id="3513006">c</span>&nbsp;<span class="op" id="3513008">==</span>&nbsp;<span class="string" id="3513011">&#39;\n&#39;</span>&nbsp;<span class="op" id="3513016">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3513022">d</span><span class="op" id="3513023">.</span><span class="ident" id="3513024">state</span>&nbsp;<span class="op" id="3513030">=</span>&nbsp;<span class="ident" id="3513032">stateEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3513045">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3513057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3513062">//&nbsp;Not&nbsp;part&nbsp;of&nbsp;.\r\n.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3513087">//&nbsp;Consume&nbsp;leading&nbsp;dot&nbsp;and&nbsp;emit&nbsp;saved&nbsp;\r.</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3513132">br</span><span class="op" id="3513134">.</span><span class="ident" id="3513135">UnreadByte</span><span class="op" id="3513145">(</span><span class="op" id="3513146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3513151">c</span>&nbsp;<span class="op" id="3513153">=</span>&nbsp;<span class="string" id="3513155">&#39;\r&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3513163">d</span><span class="op" id="3513164">.</span><span class="ident" id="3513165">state</span>&nbsp;<span class="op" id="3513171">=</span>&nbsp;<span class="ident" id="3513173">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3513186">case</span>&nbsp;<span class="ident" id="3513191">stateCR</span><span class="op" id="3513198">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3513203">if</span>&nbsp;<span class="ident" id="3513206">c</span>&nbsp;<span class="op" id="3513208">==</span>&nbsp;<span class="string" id="3513211">&#39;\n&#39;</span>&nbsp;<span class="op" id="3513216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3513222">d</span><span class="op" id="3513223">.</span><span class="ident" id="3513224">state</span>&nbsp;<span class="op" id="3513230">=</span>&nbsp;<span class="ident" id="3513232">stateBeginLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3513251">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3513260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3513265">//&nbsp;Not&nbsp;part&nbsp;of&nbsp;\r\n.&nbsp;&nbsp;Emit&nbsp;saved&nbsp;\r</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3513304">br</span><span class="op" id="3513306">.</span><span class="ident" id="3513307">UnreadByte</span><span class="op" id="3513317">(</span><span class="op" id="3513318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3513323">c</span>&nbsp;<span class="op" id="3513325">=</span>&nbsp;<span class="string" id="3513327">&#39;\r&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3513335">d</span><span class="op" id="3513336">.</span><span class="ident" id="3513337">state</span>&nbsp;<span class="op" id="3513343">=</span>&nbsp;<span class="ident" id="3513345">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3513358">case</span>&nbsp;<span class="ident" id="3513363">stateData</span><span class="op" id="3513372">:</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3513377">if</span>&nbsp;<span class="ident" id="3513380">c</span>&nbsp;<span class="op" id="3513382">==</span>&nbsp;<span class="string" id="3513385">&#39;\r&#39;</span>&nbsp;<span class="op" id="3513390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3513396">d</span><span class="op" id="3513397">.</span><span class="ident" id="3513398">state</span>&nbsp;<span class="op" id="3513404">=</span>&nbsp;<span class="ident" id="3513406">stateCR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3513418">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3513430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3513435">if</span>&nbsp;<span class="ident" id="3513438">c</span>&nbsp;<span class="op" id="3513440">==</span>&nbsp;<span class="string" id="3513443">&#39;\n&#39;</span>&nbsp;<span class="op" id="3513448">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3513454">d</span><span class="op" id="3513455">.</span><span class="ident" id="3513456">state</span>&nbsp;<span class="op" id="3513462">=</span>&nbsp;<span class="ident" id="3513464">stateBeginLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3513482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3513486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3513490">b</span><span class="op" id="3513491">[</span><span class="ident" id="3513492">n</span><span class="op" id="3513493">]</span>&nbsp;<span class="op" id="3513495">=</span>&nbsp;<span class="ident" id="3513497">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3513501">n</span><span class="op" id="3513502">++</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3513506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3513509">if</span>&nbsp;<span class="ident" id="3513512">err</span>&nbsp;<span class="op" id="3513516">==</span>&nbsp;<span class="builtintype" id="3513519">nil</span>&nbsp;<span class="op" id="3513523">&amp;&amp;</span>&nbsp;<span class="ident" id="3513526">d</span><span class="op" id="3513527">.</span><span class="ident" id="3513528">state</span>&nbsp;<span class="op" id="3513534">==</span>&nbsp;<span class="ident" id="3513537">stateEOF</span>&nbsp;<span class="op" id="3513546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3513550">err</span>&nbsp;<span class="op" id="3513554">=</span>&nbsp;<span class="ident" id="3513556">io</span><span class="op" id="3513558">.</span><span class="ident" id="3513559">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3513564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3513567">if</span>&nbsp;<span class="ident" id="3513570">err</span>&nbsp;<span class="op" id="3513574">!=</span>&nbsp;<span class="builtintype" id="3513577">nil</span>&nbsp;<span class="op" id="3513581">&amp;&amp;</span>&nbsp;<span class="ident" id="3513584">d</span><span class="op" id="3513585">.</span><span class="ident" id="3513586">r</span><span class="op" id="3513587">.</span><span class="ident" id="3513588">dot</span>&nbsp;<span class="op" id="3513592">==</span>&nbsp;<span class="ident" id="3513595">d</span>&nbsp;<span class="op" id="3513597">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3513601">d</span><span class="op" id="3513602">.</span><span class="ident" id="3513603">r</span><span class="op" id="3513604">.</span><span class="ident" id="3513605">dot</span>&nbsp;<span class="op" id="3513609">=</span>&nbsp;<span class="builtintype" id="3513611">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3513616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3513619">return</span><br>
<span class="lineno"></span><span class="op" id="3513626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="3513629">//&nbsp;closeDot&nbsp;drains&nbsp;the&nbsp;current&nbsp;DotReader&nbsp;if&nbsp;any,</span><br>
<span class="lineno"></span><span class="comment" id="3513678">//&nbsp;making&nbsp;sure&nbsp;that&nbsp;it&nbsp;reads&nbsp;until&nbsp;the&nbsp;ending&nbsp;dot&nbsp;line.</span><br>
<span class="lineno"></span><span class="keyword" id="3513734">func</span>&nbsp;<span class="op" id="3513739">(</span><span class="ident" id="3513740">r</span>&nbsp;<span class="op" id="3513742">*</span><span class="ident" id="3513743">Reader</span><span class="op" id="3513749">)</span>&nbsp;<span class="ident" id="3513751">closeDot</span><span class="op" id="3513759">(</span><span class="op" id="3513760">)</span>&nbsp;<span class="op" id="3513762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3513765">if</span>&nbsp;<span class="ident" id="3513768">r</span><span class="op" id="3513769">.</span><span class="ident" id="3513770">dot</span>&nbsp;<span class="op" id="3513774">==</span>&nbsp;<span class="builtintype" id="3513777">nil</span>&nbsp;<span class="op" id="3513781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3513785">return</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3513793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3513796">buf</span>&nbsp;<span class="op" id="3513800">:=</span>&nbsp;<span class="builtinfunc" id="3513803">make</span><span class="op" id="3513807">(</span><span class="op" id="3513808">[</span><span class="op" id="3513809">]</span><span class="builtintype" id="3513810">byte</span><span class="op" id="3513814">,</span>&nbsp;<span class="num" id="3513816">128</span><span class="op" id="3513819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3513822">for</span>&nbsp;<span class="ident" id="3513826">r</span><span class="op" id="3513827">.</span><span class="ident" id="3513828">dot</span>&nbsp;<span class="op" id="3513832">!=</span>&nbsp;<span class="builtintype" id="3513835">nil</span>&nbsp;<span class="op" id="3513839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3513843">//&nbsp;When&nbsp;Read&nbsp;reaches&nbsp;EOF&nbsp;or&nbsp;an&nbsp;error,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3513883">//&nbsp;it&nbsp;will&nbsp;set&nbsp;r.dot&nbsp;==&nbsp;nil.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3513914">r</span><span class="op" id="3513915">.</span><span class="ident" id="3513916">dot</span><span class="op" id="3513919">.</span><span class="ident" id="3513920">Read</span><span class="op" id="3513924">(</span><span class="ident" id="3513925">buf</span><span class="op" id="3513928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3513931">}</span><br>
<span class="lineno"></span><span class="op" id="3513933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3513936">//&nbsp;ReadDotBytes&nbsp;reads&nbsp;a&nbsp;dot-encoding&nbsp;and&nbsp;returns&nbsp;the&nbsp;decoded&nbsp;data.</span><br>
<span class="lineno">400</span><span class="comment" id="3514003">//</span><br>
<span class="lineno"></span><span class="comment" id="3514006">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;DotReader&nbsp;method&nbsp;for&nbsp;details&nbsp;about&nbsp;dot-encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="3514088">func</span>&nbsp;<span class="op" id="3514093">(</span><span class="ident" id="3514094">r</span>&nbsp;<span class="op" id="3514096">*</span><span class="ident" id="3514097">Reader</span><span class="op" id="3514103">)</span>&nbsp;<span class="ident" id="3514105">ReadDotBytes</span><span class="op" id="3514117">(</span><span class="op" id="3514118">)</span>&nbsp;<span class="op" id="3514120">(</span><span class="op" id="3514121">[</span><span class="op" id="3514122">]</span><span class="builtintype" id="3514123">byte</span><span class="op" id="3514127">,</span>&nbsp;<span class="builtintype" id="3514129">error</span><span class="op" id="3514134">)</span>&nbsp;<span class="op" id="3514136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3514139">return</span>&nbsp;<span class="ident" id="3514146">ioutil</span><span class="op" id="3514152">.</span><span class="ident" id="3514153">ReadAll</span><span class="op" id="3514160">(</span><span class="ident" id="3514161">r</span><span class="op" id="3514162">.</span><span class="ident" id="3514163">DotReader</span><span class="op" id="3514172">(</span><span class="op" id="3514173">)</span><span class="op" id="3514174">)</span><br>
<span class="lineno"></span><span class="op" id="3514176">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="comment" id="3514179">//&nbsp;ReadDotLines&nbsp;reads&nbsp;a&nbsp;dot-encoding&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice</span><br>
<span class="lineno"></span><span class="comment" id="3514236">//&nbsp;containing&nbsp;the&nbsp;decoded&nbsp;lines,&nbsp;with&nbsp;the&nbsp;final&nbsp;\r\n&nbsp;or&nbsp;\n&nbsp;elided&nbsp;from&nbsp;each.</span><br>
<span class="lineno"></span><span class="comment" id="3514313">//</span><br>
<span class="lineno"></span><span class="comment" id="3514316">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;DotReader&nbsp;method&nbsp;for&nbsp;details&nbsp;about&nbsp;dot-encoding.</span><br>
<span class="lineno">410</span><span class="keyword" id="3514398">func</span>&nbsp;<span class="op" id="3514403">(</span><span class="ident" id="3514404">r</span>&nbsp;<span class="op" id="3514406">*</span><span class="ident" id="3514407">Reader</span><span class="op" id="3514413">)</span>&nbsp;<span class="ident" id="3514415">ReadDotLines</span><span class="op" id="3514427">(</span><span class="op" id="3514428">)</span>&nbsp;<span class="op" id="3514430">(</span><span class="op" id="3514431">[</span><span class="op" id="3514432">]</span><span class="builtintype" id="3514433">string</span><span class="op" id="3514439">,</span>&nbsp;<span class="builtintype" id="3514441">error</span><span class="op" id="3514446">)</span>&nbsp;<span class="op" id="3514448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3514451">//&nbsp;We&nbsp;could&nbsp;use&nbsp;ReadDotBytes&nbsp;and&nbsp;then&nbsp;Split&nbsp;it,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3514500">//&nbsp;but&nbsp;reading&nbsp;a&nbsp;line&nbsp;at&nbsp;a&nbsp;time&nbsp;avoids&nbsp;needing&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3514550">//&nbsp;large&nbsp;contiguous&nbsp;block&nbsp;of&nbsp;memory&nbsp;and&nbsp;is&nbsp;simpler.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3514603">var</span>&nbsp;<span class="ident" id="3514607">v</span>&nbsp;<span class="op" id="3514609">[</span><span class="op" id="3514610">]</span><span class="builtintype" id="3514611">string</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3514619">var</span>&nbsp;<span class="ident" id="3514623">err</span>&nbsp;<span class="builtintype" id="3514627">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3514634">for</span>&nbsp;<span class="op" id="3514638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3514642">var</span>&nbsp;<span class="ident" id="3514646">line</span>&nbsp;<span class="builtintype" id="3514651">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3514660">line</span><span class="op" id="3514664">,</span>&nbsp;<span class="ident" id="3514666">err</span>&nbsp;<span class="op" id="3514670">=</span>&nbsp;<span class="ident" id="3514672">r</span><span class="op" id="3514673">.</span><span class="ident" id="3514674">ReadLine</span><span class="op" id="3514682">(</span><span class="op" id="3514683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3514687">if</span>&nbsp;<span class="ident" id="3514690">err</span>&nbsp;<span class="op" id="3514694">!=</span>&nbsp;<span class="builtintype" id="3514697">nil</span>&nbsp;<span class="op" id="3514701">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3514706">if</span>&nbsp;<span class="ident" id="3514709">err</span>&nbsp;<span class="op" id="3514713">==</span>&nbsp;<span class="ident" id="3514716">io</span><span class="op" id="3514718">.</span><span class="ident" id="3514719">EOF</span>&nbsp;<span class="op" id="3514723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3514729">err</span>&nbsp;<span class="op" id="3514733">=</span>&nbsp;<span class="ident" id="3514735">io</span><span class="op" id="3514737">.</span><span class="ident" id="3514738">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3514758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3514763">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3514771">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3514776">//&nbsp;Dot&nbsp;by&nbsp;itself&nbsp;marks&nbsp;end;&nbsp;otherwise&nbsp;cut&nbsp;one&nbsp;dot.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3514829">if</span>&nbsp;<span class="builtinfunc" id="3514832">len</span><span class="op" id="3514835">(</span><span class="ident" id="3514836">line</span><span class="op" id="3514840">)</span>&nbsp;<span class="op" id="3514842">&gt;</span>&nbsp;<span class="num" id="3514844">0</span>&nbsp;<span class="op" id="3514846">&amp;&amp;</span>&nbsp;<span class="ident" id="3514849">line</span><span class="op" id="3514853">[</span><span class="num" id="3514854">0</span><span class="op" id="3514855">]</span>&nbsp;<span class="op" id="3514857">==</span>&nbsp;<span class="string" id="3514860">&#39;.&#39;</span>&nbsp;<span class="op" id="3514864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3514869">if</span>&nbsp;<span class="builtinfunc" id="3514872">len</span><span class="op" id="3514875">(</span><span class="ident" id="3514876">line</span><span class="op" id="3514880">)</span>&nbsp;<span class="op" id="3514882">==</span>&nbsp;<span class="num" id="3514885">1</span>&nbsp;<span class="op" id="3514887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3514893">break</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3514902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3514907">line</span>&nbsp;<span class="op" id="3514912">=</span>&nbsp;<span class="ident" id="3514914">line</span><span class="op" id="3514918">[</span><span class="num" id="3514919">1</span><span class="op" id="3514920">:</span><span class="op" id="3514921">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3514925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3514929">v</span>&nbsp;<span class="op" id="3514931">=</span>&nbsp;<span class="builtinfunc" id="3514933">append</span><span class="op" id="3514939">(</span><span class="ident" id="3514940">v</span><span class="op" id="3514941">,</span>&nbsp;<span class="ident" id="3514943">line</span><span class="op" id="3514947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3514950">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3514953">return</span>&nbsp;<span class="ident" id="3514960">v</span><span class="op" id="3514961">,</span>&nbsp;<span class="ident" id="3514963">err</span><br>
<span class="lineno"></span><span class="op" id="3514967">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3514970">//&nbsp;ReadMIMEHeader&nbsp;reads&nbsp;a&nbsp;MIME-style&nbsp;header&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="3515022">//&nbsp;The&nbsp;header&nbsp;is&nbsp;a&nbsp;sequence&nbsp;of&nbsp;possibly&nbsp;continued&nbsp;Key:&nbsp;Value&nbsp;lines</span><br>
<span class="lineno">440</span><span class="comment" id="3515089">//&nbsp;ending&nbsp;in&nbsp;a&nbsp;blank&nbsp;line.</span><br>
<span class="lineno"></span><span class="comment" id="3515116">//&nbsp;The&nbsp;returned&nbsp;map&nbsp;m&nbsp;maps&nbsp;CanonicalMIMEHeaderKey(key)&nbsp;to&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3515176">//&nbsp;sequence&nbsp;of&nbsp;values&nbsp;in&nbsp;the&nbsp;same&nbsp;order&nbsp;encountered&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="comment" id="3515242">//</span><br>
<span class="lineno"></span><span class="comment" id="3515245">//&nbsp;For&nbsp;example,&nbsp;consider&nbsp;this&nbsp;input:</span><br>
<span class="lineno">445</span><span class="comment" id="3515282">//</span><br>
<span class="lineno"></span><span class="comment" id="3515285">//&nbsp;&nbsp;&nbsp;&nbsp;My-Key:&nbsp;Value&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="3515304">//&nbsp;&nbsp;&nbsp;&nbsp;Long-Key:&nbsp;Even</span><br>
<span class="lineno"></span><span class="comment" id="3515322">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Longer&nbsp;Value</span><br>
<span class="lineno"></span><span class="comment" id="3515345">//&nbsp;&nbsp;&nbsp;&nbsp;My-Key:&nbsp;Value&nbsp;2</span><br>
<span class="lineno">450</span><span class="comment" id="3515364">//</span><br>
<span class="lineno"></span><span class="comment" id="3515367">//&nbsp;Given&nbsp;that&nbsp;input,&nbsp;ReadMIMEHeader&nbsp;returns&nbsp;the&nbsp;map:</span><br>
<span class="lineno"></span><span class="comment" id="3515420">//</span><br>
<span class="lineno"></span><span class="comment" id="3515423">//&nbsp;&nbsp;&nbsp;&nbsp;map[string][]string{</span><br>
<span class="lineno"></span><span class="comment" id="3515447">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;My-Key&#34;:&nbsp;{&#34;Value&nbsp;1&#34;,&nbsp;&#34;Value&nbsp;2&#34;},</span><br>
<span class="lineno">455</span><span class="comment" id="3515485">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;Long-Key&#34;:&nbsp;{&#34;Even&nbsp;Longer&nbsp;Value&#34;},</span><br>
<span class="lineno"></span><span class="comment" id="3515524">//&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="3515529">//</span><br>
<span class="lineno"></span><span class="keyword" id="3515532">func</span>&nbsp;<span class="op" id="3515537">(</span><span class="ident" id="3515538">r</span>&nbsp;<span class="op" id="3515540">*</span><span class="ident" id="3515541">Reader</span><span class="op" id="3515547">)</span>&nbsp;<span class="ident" id="3515549">ReadMIMEHeader</span><span class="op" id="3515563">(</span><span class="op" id="3515564">)</span>&nbsp;<span class="op" id="3515566">(</span><span class="ident" id="3515567">MIMEHeader</span><span class="op" id="3515577">,</span>&nbsp;<span class="builtintype" id="3515579">error</span><span class="op" id="3515584">)</span>&nbsp;<span class="op" id="3515586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3515589">//&nbsp;Avoid&nbsp;lots&nbsp;of&nbsp;small&nbsp;slice&nbsp;allocations&nbsp;later&nbsp;by&nbsp;allocating&nbsp;one</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3515655">//&nbsp;large&nbsp;one&nbsp;ahead&nbsp;of&nbsp;time&nbsp;which&nbsp;we&#39;ll&nbsp;cut&nbsp;up&nbsp;into&nbsp;smaller</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3515715">//&nbsp;slices.&nbsp;If&nbsp;this&nbsp;isn&#39;t&nbsp;big&nbsp;enough&nbsp;later,&nbsp;we&nbsp;allocate&nbsp;small&nbsp;ones.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3515783">var</span>&nbsp;<span class="ident" id="3515787">strs</span>&nbsp;<span class="op" id="3515792">[</span><span class="op" id="3515793">]</span><span class="builtintype" id="3515794">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3515802">hint</span>&nbsp;<span class="op" id="3515807">:=</span>&nbsp;<span class="ident" id="3515810">r</span><span class="op" id="3515811">.</span><span class="ident" id="3515812">upcomingHeaderNewlines</span><span class="op" id="3515834">(</span><span class="op" id="3515835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3515838">if</span>&nbsp;<span class="ident" id="3515841">hint</span>&nbsp;<span class="op" id="3515846">&gt;</span>&nbsp;<span class="num" id="3515848">0</span>&nbsp;<span class="op" id="3515850">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3515854">strs</span>&nbsp;<span class="op" id="3515859">=</span>&nbsp;<span class="builtinfunc" id="3515861">make</span><span class="op" id="3515865">(</span><span class="op" id="3515866">[</span><span class="op" id="3515867">]</span><span class="builtintype" id="3515868">string</span><span class="op" id="3515874">,</span>&nbsp;<span class="ident" id="3515876">hint</span><span class="op" id="3515880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3515883">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3515887">m</span>&nbsp;<span class="op" id="3515889">:=</span>&nbsp;<span class="builtinfunc" id="3515892">make</span><span class="op" id="3515896">(</span><span class="ident" id="3515897">MIMEHeader</span><span class="op" id="3515907">,</span>&nbsp;<span class="ident" id="3515909">hint</span><span class="op" id="3515913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3515916">for</span>&nbsp;<span class="op" id="3515920">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3515924">kv</span><span class="op" id="3515926">,</span>&nbsp;<span class="ident" id="3515928">err</span>&nbsp;<span class="op" id="3515932">:=</span>&nbsp;<span class="ident" id="3515935">r</span><span class="op" id="3515936">.</span><span class="ident" id="3515937">readContinuedLineSlice</span><span class="op" id="3515959">(</span><span class="op" id="3515960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3515964">if</span>&nbsp;<span class="builtinfunc" id="3515967">len</span><span class="op" id="3515970">(</span><span class="ident" id="3515971">kv</span><span class="op" id="3515973">)</span>&nbsp;<span class="op" id="3515975">==</span>&nbsp;<span class="num" id="3515978">0</span>&nbsp;<span class="op" id="3515980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3515985">return</span>&nbsp;<span class="ident" id="3515992">m</span><span class="op" id="3515993">,</span>&nbsp;<span class="ident" id="3515995">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3516001">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3516006">//&nbsp;Key&nbsp;ends&nbsp;at&nbsp;first&nbsp;colon;&nbsp;should&nbsp;not&nbsp;have&nbsp;spaces&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3516063">//&nbsp;they&nbsp;appear&nbsp;in&nbsp;the&nbsp;wild,&nbsp;violating&nbsp;specs,&nbsp;so&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3516116">//&nbsp;remove&nbsp;them&nbsp;if&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3516145">i</span>&nbsp;<span class="op" id="3516147">:=</span>&nbsp;<span class="ident" id="3516150">bytes</span><span class="op" id="3516155">.</span><span class="ident" id="3516156">IndexByte</span><span class="op" id="3516165">(</span><span class="ident" id="3516166">kv</span><span class="op" id="3516168">,</span>&nbsp;<span class="string" id="3516170">&#39;:&#39;</span><span class="op" id="3516173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3516177">if</span>&nbsp;<span class="ident" id="3516180">i</span>&nbsp;<span class="op" id="3516182">&lt;</span>&nbsp;<span class="num" id="3516184">0</span>&nbsp;<span class="op" id="3516186">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3516191">return</span>&nbsp;<span class="ident" id="3516198">m</span><span class="op" id="3516199">,</span>&nbsp;<span class="ident" id="3516201">ProtocolError</span><span class="op" id="3516214">(</span><span class="string" id="3516215">&#34;malformed&nbsp;MIME&nbsp;header&nbsp;line:&nbsp;&#34;</span>&nbsp;<span class="op" id="3516246">+</span>&nbsp;<span class="builtintype" id="3516248">string</span><span class="op" id="3516254">(</span><span class="ident" id="3516255">kv</span><span class="op" id="3516257">)</span><span class="op" id="3516258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3516262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3516266">endKey</span>&nbsp;<span class="op" id="3516273">:=</span>&nbsp;<span class="ident" id="3516276">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3516280">for</span>&nbsp;<span class="ident" id="3516284">endKey</span>&nbsp;<span class="op" id="3516291">&gt;</span>&nbsp;<span class="num" id="3516293">0</span>&nbsp;<span class="op" id="3516295">&amp;&amp;</span>&nbsp;<span class="ident" id="3516298">kv</span><span class="op" id="3516300">[</span><span class="ident" id="3516301">endKey</span><span class="op" id="3516307">-</span><span class="num" id="3516308">1</span><span class="op" id="3516309">]</span>&nbsp;<span class="op" id="3516311">==</span>&nbsp;<span class="string" id="3516314">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3516318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3516323">endKey</span><span class="op" id="3516329">--</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3516334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3516338">key</span>&nbsp;<span class="op" id="3516342">:=</span>&nbsp;<span class="ident" id="3516345">canonicalMIMEHeaderKey</span><span class="op" id="3516367">(</span><span class="ident" id="3516368">kv</span><span class="op" id="3516370">[</span><span class="op" id="3516371">:</span><span class="ident" id="3516372">endKey</span><span class="op" id="3516378">]</span><span class="op" id="3516379">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3516384">//&nbsp;Skip&nbsp;initial&nbsp;spaces&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3516419">i</span><span class="op" id="3516420">++</span>&nbsp;<span class="comment" id="3516423">//&nbsp;skip&nbsp;colon</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3516439">for</span>&nbsp;<span class="ident" id="3516443">i</span>&nbsp;<span class="op" id="3516445">&lt;</span>&nbsp;<span class="builtinfunc" id="3516447">len</span><span class="op" id="3516450">(</span><span class="ident" id="3516451">kv</span><span class="op" id="3516453">)</span>&nbsp;<span class="op" id="3516455">&amp;&amp;</span>&nbsp;<span class="op" id="3516458">(</span><span class="ident" id="3516459">kv</span><span class="op" id="3516461">[</span><span class="ident" id="3516462">i</span><span class="op" id="3516463">]</span>&nbsp;<span class="op" id="3516465">==</span>&nbsp;<span class="string" id="3516468">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3516472">||</span>&nbsp;<span class="ident" id="3516475">kv</span><span class="op" id="3516477">[</span><span class="ident" id="3516478">i</span><span class="op" id="3516479">]</span>&nbsp;<span class="op" id="3516481">==</span>&nbsp;<span class="string" id="3516484">&#39;\t&#39;</span><span class="op" id="3516488">)</span>&nbsp;<span class="op" id="3516490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3516495">i</span><span class="op" id="3516496">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3516501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3516505">value</span>&nbsp;<span class="op" id="3516511">:=</span>&nbsp;<span class="builtintype" id="3516514">string</span><span class="op" id="3516520">(</span><span class="ident" id="3516521">kv</span><span class="op" id="3516523">[</span><span class="ident" id="3516524">i</span><span class="op" id="3516525">:</span><span class="op" id="3516526">]</span><span class="op" id="3516527">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3516532">vv</span>&nbsp;<span class="op" id="3516535">:=</span>&nbsp;<span class="ident" id="3516538">m</span><span class="op" id="3516539">[</span><span class="ident" id="3516540">key</span><span class="op" id="3516543">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3516547">if</span>&nbsp;<span class="ident" id="3516550">vv</span>&nbsp;<span class="op" id="3516553">==</span>&nbsp;<span class="builtintype" id="3516556">nil</span>&nbsp;<span class="op" id="3516560">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3516563">len</span><span class="op" id="3516566">(</span><span class="ident" id="3516567">strs</span><span class="op" id="3516571">)</span>&nbsp;<span class="op" id="3516573">&gt;</span>&nbsp;<span class="num" id="3516575">0</span>&nbsp;<span class="op" id="3516577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3516582">//&nbsp;More&nbsp;than&nbsp;likely&nbsp;this&nbsp;will&nbsp;be&nbsp;a&nbsp;single-element&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3516640">//&nbsp;Most&nbsp;headers&nbsp;aren&#39;t&nbsp;multi-valued.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3516680">//&nbsp;Set&nbsp;the&nbsp;capacity&nbsp;on&nbsp;strs[0]&nbsp;to&nbsp;1,&nbsp;so&nbsp;any&nbsp;future&nbsp;append</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3516741">//&nbsp;won&#39;t&nbsp;extend&nbsp;the&nbsp;slice&nbsp;into&nbsp;the&nbsp;other&nbsp;strings.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3516794">vv</span><span class="op" id="3516796">,</span>&nbsp;<span class="ident" id="3516798">strs</span>&nbsp;<span class="op" id="3516803">=</span>&nbsp;<span class="ident" id="3516805">strs</span><span class="op" id="3516809">[</span><span class="op" id="3516810">:</span><span class="num" id="3516811">1</span><span class="op" id="3516812">:</span><span class="num" id="3516813">1</span><span class="op" id="3516814">]</span><span class="op" id="3516815">,</span>&nbsp;<span class="ident" id="3516817">strs</span><span class="op" id="3516821">[</span><span class="num" id="3516822">1</span><span class="op" id="3516823">:</span><span class="op" id="3516824">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3516829">vv</span><span class="op" id="3516831">[</span><span class="num" id="3516832">0</span><span class="op" id="3516833">]</span>&nbsp;<span class="op" id="3516835">=</span>&nbsp;<span class="ident" id="3516837">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3516846">m</span><span class="op" id="3516847">[</span><span class="ident" id="3516848">key</span><span class="op" id="3516851">]</span>&nbsp;<span class="op" id="3516853">=</span>&nbsp;<span class="ident" id="3516855">vv</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3516860">}</span>&nbsp;<span class="keyword" id="3516862">else</span>&nbsp;<span class="op" id="3516867">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3516872">m</span><span class="op" id="3516873">[</span><span class="ident" id="3516874">key</span><span class="op" id="3516877">]</span>&nbsp;<span class="op" id="3516879">=</span>&nbsp;<span class="builtinfunc" id="3516881">append</span><span class="op" id="3516887">(</span><span class="ident" id="3516888">vv</span><span class="op" id="3516890">,</span>&nbsp;<span class="ident" id="3516892">value</span><span class="op" id="3516897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3516901">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3516906">if</span>&nbsp;<span class="ident" id="3516909">err</span>&nbsp;<span class="op" id="3516913">!=</span>&nbsp;<span class="builtintype" id="3516916">nil</span>&nbsp;<span class="op" id="3516920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3516925">return</span>&nbsp;<span class="ident" id="3516932">m</span><span class="op" id="3516933">,</span>&nbsp;<span class="ident" id="3516935">err</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3516941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3516944">}</span><br>
<span class="lineno"></span><span class="op" id="3516946">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3516949">//&nbsp;upcomingHeaderNewlines&nbsp;returns&nbsp;an&nbsp;approximation&nbsp;of&nbsp;the&nbsp;number&nbsp;of&nbsp;newlines</span><br>
<span class="lineno">515</span><span class="comment" id="3517026">//&nbsp;that&nbsp;will&nbsp;be&nbsp;in&nbsp;this&nbsp;header.&nbsp;If&nbsp;it&nbsp;gets&nbsp;confused,&nbsp;it&nbsp;returns&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="3517093">func</span>&nbsp;<span class="op" id="3517098">(</span><span class="ident" id="3517099">r</span>&nbsp;<span class="op" id="3517101">*</span><span class="ident" id="3517102">Reader</span><span class="op" id="3517108">)</span>&nbsp;<span class="ident" id="3517110">upcomingHeaderNewlines</span><span class="op" id="3517132">(</span><span class="op" id="3517133">)</span>&nbsp;<span class="op" id="3517135">(</span><span class="ident" id="3517136">n</span>&nbsp;<span class="builtintype" id="3517138">int</span><span class="op" id="3517141">)</span>&nbsp;<span class="op" id="3517143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3517146">//&nbsp;Try&nbsp;to&nbsp;determine&nbsp;the&nbsp;&#39;hint&#39;&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3517184">r</span><span class="op" id="3517185">.</span><span class="ident" id="3517186">R</span><span class="op" id="3517187">.</span><span class="ident" id="3517188">Peek</span><span class="op" id="3517192">(</span><span class="num" id="3517193">1</span><span class="op" id="3517194">)</span>&nbsp;<span class="comment" id="3517196">//&nbsp;force&nbsp;a&nbsp;buffer&nbsp;load&nbsp;if&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3517229">s</span>&nbsp;<span class="op" id="3517231">:=</span>&nbsp;<span class="ident" id="3517234">r</span><span class="op" id="3517235">.</span><span class="ident" id="3517236">R</span><span class="op" id="3517237">.</span><span class="ident" id="3517238">Buffered</span><span class="op" id="3517246">(</span><span class="op" id="3517247">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3517250">if</span>&nbsp;<span class="ident" id="3517253">s</span>&nbsp;<span class="op" id="3517255">==</span>&nbsp;<span class="num" id="3517258">0</span>&nbsp;<span class="op" id="3517260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3517264">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3517272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3517275">peek</span><span class="op" id="3517279">,</span>&nbsp;<span class="ident" id="3517281">_</span>&nbsp;<span class="op" id="3517283">:=</span>&nbsp;<span class="ident" id="3517286">r</span><span class="op" id="3517287">.</span><span class="ident" id="3517288">R</span><span class="op" id="3517289">.</span><span class="ident" id="3517290">Peek</span><span class="op" id="3517294">(</span><span class="ident" id="3517295">s</span><span class="op" id="3517296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3517299">for</span>&nbsp;<span class="builtinfunc" id="3517303">len</span><span class="op" id="3517306">(</span><span class="ident" id="3517307">peek</span><span class="op" id="3517311">)</span>&nbsp;<span class="op" id="3517313">&gt;</span>&nbsp;<span class="num" id="3517315">0</span>&nbsp;<span class="op" id="3517317">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3517321">i</span>&nbsp;<span class="op" id="3517323">:=</span>&nbsp;<span class="ident" id="3517326">bytes</span><span class="op" id="3517331">.</span><span class="ident" id="3517332">IndexByte</span><span class="op" id="3517341">(</span><span class="ident" id="3517342">peek</span><span class="op" id="3517346">,</span>&nbsp;<span class="string" id="3517348">&#39;\n&#39;</span><span class="op" id="3517352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3517356">if</span>&nbsp;<span class="ident" id="3517359">i</span>&nbsp;<span class="op" id="3517361">&lt;</span>&nbsp;<span class="num" id="3517363">3</span>&nbsp;<span class="op" id="3517365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3517370">//&nbsp;Not&nbsp;present&nbsp;(-1)&nbsp;or&nbsp;found&nbsp;within&nbsp;the&nbsp;next&nbsp;few&nbsp;bytes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3517429">//&nbsp;implying&nbsp;we&#39;re&nbsp;at&nbsp;the&nbsp;end&nbsp;(&#34;\r\n\r\n&#34;&nbsp;or&nbsp;&#34;\n\n&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3517484">return</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3517493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3517497">n</span><span class="op" id="3517498">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3517503">peek</span>&nbsp;<span class="op" id="3517508">=</span>&nbsp;<span class="ident" id="3517510">peek</span><span class="op" id="3517514">[</span><span class="ident" id="3517515">i</span><span class="op" id="3517516">+</span><span class="num" id="3517517">1</span><span class="op" id="3517518">:</span><span class="op" id="3517519">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3517522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3517525">return</span><br>
<span class="lineno">535</span><span class="op" id="3517532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3517535">//&nbsp;CanonicalMIMEHeaderKey&nbsp;returns&nbsp;the&nbsp;canonical&nbsp;format&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3517597">//&nbsp;MIME&nbsp;header&nbsp;key&nbsp;s.&nbsp;&nbsp;The&nbsp;canonicalization&nbsp;converts&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="3517660">//&nbsp;letter&nbsp;and&nbsp;any&nbsp;letter&nbsp;following&nbsp;a&nbsp;hyphen&nbsp;to&nbsp;upper&nbsp;case;</span><br>
<span class="lineno">540</span><span class="comment" id="3517719">//&nbsp;the&nbsp;rest&nbsp;are&nbsp;converted&nbsp;to&nbsp;lowercase.&nbsp;&nbsp;For&nbsp;example,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3517777">//&nbsp;canonical&nbsp;key&nbsp;for&nbsp;&#34;accept-encoding&#34;&nbsp;is&nbsp;&#34;Accept-Encoding&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3517838">//&nbsp;MIME&nbsp;header&nbsp;keys&nbsp;are&nbsp;assumed&nbsp;to&nbsp;be&nbsp;ASCII&nbsp;only.</span><br>
<span class="lineno"></span><span class="keyword" id="3517888">func</span>&nbsp;<span class="ident" id="3517893">CanonicalMIMEHeaderKey</span><span class="op" id="3517915">(</span><span class="ident" id="3517916">s</span>&nbsp;<span class="builtintype" id="3517918">string</span><span class="op" id="3517924">)</span>&nbsp;<span class="builtintype" id="3517926">string</span>&nbsp;<span class="op" id="3517933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3517936">//&nbsp;Quick&nbsp;check&nbsp;for&nbsp;canonical&nbsp;encoding.</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3517976">upper</span>&nbsp;<span class="op" id="3517982">:=</span>&nbsp;<span class="builtintype" id="3517985">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3517991">for</span>&nbsp;<span class="ident" id="3517995">i</span>&nbsp;<span class="op" id="3517997">:=</span>&nbsp;<span class="num" id="3518000">0</span><span class="op" id="3518001">;</span>&nbsp;<span class="ident" id="3518003">i</span>&nbsp;<span class="op" id="3518005">&lt;</span>&nbsp;<span class="builtinfunc" id="3518007">len</span><span class="op" id="3518010">(</span><span class="ident" id="3518011">s</span><span class="op" id="3518012">)</span><span class="op" id="3518013">;</span>&nbsp;<span class="ident" id="3518015">i</span><span class="op" id="3518016">++</span>&nbsp;<span class="op" id="3518019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3518023">c</span>&nbsp;<span class="op" id="3518025">:=</span>&nbsp;<span class="ident" id="3518028">s</span><span class="op" id="3518029">[</span><span class="ident" id="3518030">i</span><span class="op" id="3518031">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3518035">if</span>&nbsp;<span class="ident" id="3518038">upper</span>&nbsp;<span class="op" id="3518044">&amp;&amp;</span>&nbsp;<span class="string" id="3518047">&#39;a&#39;</span>&nbsp;<span class="op" id="3518051">&lt;=</span>&nbsp;<span class="ident" id="3518054">c</span>&nbsp;<span class="op" id="3518056">&amp;&amp;</span>&nbsp;<span class="ident" id="3518059">c</span>&nbsp;<span class="op" id="3518061">&lt;=</span>&nbsp;<span class="string" id="3518064">&#39;z&#39;</span>&nbsp;<span class="op" id="3518068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3518073">return</span>&nbsp;<span class="ident" id="3518080">canonicalMIMEHeaderKey</span><span class="op" id="3518102">(</span><span class="op" id="3518103">[</span><span class="op" id="3518104">]</span><span class="builtintype" id="3518105">byte</span><span class="op" id="3518109">(</span><span class="ident" id="3518110">s</span><span class="op" id="3518111">)</span><span class="op" id="3518112">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3518116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3518120">if</span>&nbsp;<span class="op" id="3518123">!</span><span class="ident" id="3518124">upper</span>&nbsp;<span class="op" id="3518130">&amp;&amp;</span>&nbsp;<span class="string" id="3518133">&#39;A&#39;</span>&nbsp;<span class="op" id="3518137">&lt;=</span>&nbsp;<span class="ident" id="3518140">c</span>&nbsp;<span class="op" id="3518142">&amp;&amp;</span>&nbsp;<span class="ident" id="3518145">c</span>&nbsp;<span class="op" id="3518147">&lt;=</span>&nbsp;<span class="string" id="3518150">&#39;Z&#39;</span>&nbsp;<span class="op" id="3518154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3518159">return</span>&nbsp;<span class="ident" id="3518166">canonicalMIMEHeaderKey</span><span class="op" id="3518188">(</span><span class="op" id="3518189">[</span><span class="op" id="3518190">]</span><span class="builtintype" id="3518191">byte</span><span class="op" id="3518195">(</span><span class="ident" id="3518196">s</span><span class="op" id="3518197">)</span><span class="op" id="3518198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3518202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3518206">upper</span>&nbsp;<span class="op" id="3518212">=</span>&nbsp;<span class="ident" id="3518214">c</span>&nbsp;<span class="op" id="3518216">==</span>&nbsp;<span class="string" id="3518219">&#39;-&#39;</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3518224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3518227">return</span>&nbsp;<span class="ident" id="3518234">s</span><br>
<span class="lineno"></span><span class="op" id="3518236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3518239">const</span>&nbsp;<span class="ident" id="3518245">toLower</span>&nbsp;<span class="op" id="3518253">=</span>&nbsp;<span class="string" id="3518255">&#39;a&#39;</span>&nbsp;<span class="op" id="3518259">-</span>&nbsp;<span class="string" id="3518261">&#39;A&#39;</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span><span class="comment" id="3518266">//&nbsp;canonicalMIMEHeaderKey&nbsp;is&nbsp;like&nbsp;CanonicalMIMEHeaderKey&nbsp;but&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3518330">//&nbsp;allowed&nbsp;to&nbsp;mutate&nbsp;the&nbsp;provided&nbsp;byte&nbsp;slice&nbsp;before&nbsp;returning&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3518396">//&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3518407">func</span>&nbsp;<span class="ident" id="3518412">canonicalMIMEHeaderKey</span><span class="op" id="3518434">(</span><span class="ident" id="3518435">a</span>&nbsp;<span class="op" id="3518437">[</span><span class="op" id="3518438">]</span><span class="builtintype" id="3518439">byte</span><span class="op" id="3518443">)</span>&nbsp;<span class="builtintype" id="3518445">string</span>&nbsp;<span class="op" id="3518452">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3518455">upper</span>&nbsp;<span class="op" id="3518461">:=</span>&nbsp;<span class="builtintype" id="3518464">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3518470">for</span>&nbsp;<span class="ident" id="3518474">i</span><span class="op" id="3518475">,</span>&nbsp;<span class="ident" id="3518477">c</span>&nbsp;<span class="op" id="3518479">:=</span>&nbsp;<span class="keyword" id="3518482">range</span>&nbsp;<span class="ident" id="3518488">a</span>&nbsp;<span class="op" id="3518490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3518494">//&nbsp;Canonicalize:&nbsp;first&nbsp;letter&nbsp;upper&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3518537">//&nbsp;and&nbsp;upper&nbsp;case&nbsp;after&nbsp;each&nbsp;dash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3518574">//&nbsp;(Host,&nbsp;User-Agent,&nbsp;If-Modified-Since).</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3518618">//&nbsp;MIME&nbsp;headers&nbsp;are&nbsp;ASCII&nbsp;only,&nbsp;so&nbsp;no&nbsp;Unicode&nbsp;issues.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3518674">if</span>&nbsp;<span class="ident" id="3518677">c</span>&nbsp;<span class="op" id="3518679">==</span>&nbsp;<span class="string" id="3518682">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3518686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3518691">c</span>&nbsp;<span class="op" id="3518693">=</span>&nbsp;<span class="string" id="3518695">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3518701">}</span>&nbsp;<span class="keyword" id="3518703">else</span>&nbsp;<span class="keyword" id="3518708">if</span>&nbsp;<span class="ident" id="3518711">upper</span>&nbsp;<span class="op" id="3518717">&amp;&amp;</span>&nbsp;<span class="string" id="3518720">&#39;a&#39;</span>&nbsp;<span class="op" id="3518724">&lt;=</span>&nbsp;<span class="ident" id="3518727">c</span>&nbsp;<span class="op" id="3518729">&amp;&amp;</span>&nbsp;<span class="ident" id="3518732">c</span>&nbsp;<span class="op" id="3518734">&lt;=</span>&nbsp;<span class="string" id="3518737">&#39;z&#39;</span>&nbsp;<span class="op" id="3518741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3518746">c</span>&nbsp;<span class="op" id="3518748">-=</span>&nbsp;<span class="ident" id="3518751">toLower</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3518761">}</span>&nbsp;<span class="keyword" id="3518763">else</span>&nbsp;<span class="keyword" id="3518768">if</span>&nbsp;<span class="op" id="3518771">!</span><span class="ident" id="3518772">upper</span>&nbsp;<span class="op" id="3518778">&amp;&amp;</span>&nbsp;<span class="string" id="3518781">&#39;A&#39;</span>&nbsp;<span class="op" id="3518785">&lt;=</span>&nbsp;<span class="ident" id="3518788">c</span>&nbsp;<span class="op" id="3518790">&amp;&amp;</span>&nbsp;<span class="ident" id="3518793">c</span>&nbsp;<span class="op" id="3518795">&lt;=</span>&nbsp;<span class="string" id="3518798">&#39;Z&#39;</span>&nbsp;<span class="op" id="3518802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3518807">c</span>&nbsp;<span class="op" id="3518809">+=</span>&nbsp;<span class="ident" id="3518812">toLower</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3518822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3518826">a</span><span class="op" id="3518827">[</span><span class="ident" id="3518828">i</span><span class="op" id="3518829">]</span>&nbsp;<span class="op" id="3518831">=</span>&nbsp;<span class="ident" id="3518833">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3518837">upper</span>&nbsp;<span class="op" id="3518843">=</span>&nbsp;<span class="ident" id="3518845">c</span>&nbsp;<span class="op" id="3518847">==</span>&nbsp;<span class="string" id="3518850">&#39;-&#39;</span>&nbsp;<span class="comment" id="3518854">//&nbsp;for&nbsp;next&nbsp;time</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3518872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3518875">//&nbsp;The&nbsp;compiler&nbsp;recognizes&nbsp;m[string(byteSlice)]&nbsp;as&nbsp;a&nbsp;special</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3518937">//&nbsp;case,&nbsp;so&nbsp;a&nbsp;copy&nbsp;of&nbsp;a&#39;s&nbsp;bytes&nbsp;into&nbsp;a&nbsp;new&nbsp;string&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3518997">//&nbsp;happen&nbsp;in&nbsp;this&nbsp;map&nbsp;lookup:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3519028">if</span>&nbsp;<span class="ident" id="3519031">v</span>&nbsp;<span class="op" id="3519033">:=</span>&nbsp;<span class="ident" id="3519036">commonHeader</span><span class="op" id="3519048">[</span><span class="builtintype" id="3519049">string</span><span class="op" id="3519055">(</span><span class="ident" id="3519056">a</span><span class="op" id="3519057">)</span><span class="op" id="3519058">]</span><span class="op" id="3519059">;</span>&nbsp;<span class="ident" id="3519061">v</span>&nbsp;<span class="op" id="3519063">!=</span>&nbsp;<span class="string" id="3519066">&#34;&#34;</span>&nbsp;<span class="op" id="3519069">{</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3519073">return</span>&nbsp;<span class="ident" id="3519080">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3519083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3519086">return</span>&nbsp;<span class="builtintype" id="3519093">string</span><span class="op" id="3519099">(</span><span class="ident" id="3519100">a</span><span class="op" id="3519101">)</span><br>
<span class="lineno"></span><span class="op" id="3519103">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="comment" id="3519106">//&nbsp;commonHeader&nbsp;interns&nbsp;common&nbsp;header&nbsp;strings.</span><br>
<span class="lineno"></span><span class="keyword" id="3519153">var</span>&nbsp;<span class="ident" id="3519157">commonHeader</span>&nbsp;<span class="op" id="3519170">=</span>&nbsp;<span class="builtinfunc" id="3519172">make</span><span class="op" id="3519176">(</span><span class="keyword" id="3519177">map</span><span class="op" id="3519180">[</span><span class="builtintype" id="3519181">string</span><span class="op" id="3519187">]</span><span class="builtintype" id="3519188">string</span><span class="op" id="3519194">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3519197">func</span>&nbsp;<span class="ident" id="3519202">init</span><span class="op" id="3519206">(</span><span class="op" id="3519207">)</span>&nbsp;<span class="op" id="3519209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3519212">for</span>&nbsp;<span class="ident" id="3519216">_</span><span class="op" id="3519217">,</span>&nbsp;<span class="ident" id="3519219">v</span>&nbsp;<span class="op" id="3519221">:=</span>&nbsp;<span class="keyword" id="3519224">range</span>&nbsp;<span class="op" id="3519230">[</span><span class="op" id="3519231">]</span><span class="builtintype" id="3519232">string</span><span class="op" id="3519238">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3519242">&#34;Accept&#34;</span><span class="op" id="3519250">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3519254">&#34;Accept-Charset&#34;</span><span class="op" id="3519270">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3519274">&#34;Accept-Encoding&#34;</span><span class="op" id="3519291">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3519295">&#34;Accept-Language&#34;</span><span class="op" id="3519312">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3519316">&#34;Accept-Ranges&#34;</span><span class="op" id="3519331">,</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3519335">&#34;Cache-Control&#34;</span><span class="op" id="3519350">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3519354">&#34;Cc&#34;</span><span class="op" id="3519358">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3519362">&#34;Connection&#34;</span><span class="op" id="3519374">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3519378">&#34;Content-Id&#34;</span><span class="op" id="3519390">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3519394">&#34;Content-Language&#34;</span><span class="op" id="3519412">,</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3519416">&#34;Content-Length&#34;</span><span class="op" id="3519432">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3519436">&#34;Content-Transfer-Encoding&#34;</span><span class="op" id="3519463">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3519467">&#34;Content-Type&#34;</span><span class="op" id="3519481">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3519485">&#34;Cookie&#34;</span><span class="op" id="3519493">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3519497">&#34;Date&#34;</span><span class="op" id="3519503">,</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3519507">&#34;Dkim-Signature&#34;</span><span class="op" id="3519523">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3519527">&#34;Etag&#34;</span><span class="op" id="3519533">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3519537">&#34;Expires&#34;</span><span class="op" id="3519546">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3519550">&#34;From&#34;</span><span class="op" id="3519556">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3519560">&#34;Host&#34;</span><span class="op" id="3519566">,</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3519570">&#34;If-Modified-Since&#34;</span><span class="op" id="3519589">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3519593">&#34;If-None-Match&#34;</span><span class="op" id="3519608">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3519612">&#34;In-Reply-To&#34;</span><span class="op" id="3519625">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3519629">&#34;Last-Modified&#34;</span><span class="op" id="3519644">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3519648">&#34;Location&#34;</span><span class="op" id="3519658">,</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3519662">&#34;Message-Id&#34;</span><span class="op" id="3519674">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3519678">&#34;Mime-Version&#34;</span><span class="op" id="3519692">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3519696">&#34;Pragma&#34;</span><span class="op" id="3519704">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3519708">&#34;Received&#34;</span><span class="op" id="3519718">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3519722">&#34;Return-Path&#34;</span><span class="op" id="3519735">,</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3519739">&#34;Server&#34;</span><span class="op" id="3519747">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3519751">&#34;Set-Cookie&#34;</span><span class="op" id="3519763">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3519767">&#34;Subject&#34;</span><span class="op" id="3519776">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3519780">&#34;To&#34;</span><span class="op" id="3519784">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3519788">&#34;User-Agent&#34;</span><span class="op" id="3519800">,</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3519804">&#34;Via&#34;</span><span class="op" id="3519809">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3519813">&#34;X-Forwarded-For&#34;</span><span class="op" id="3519830">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3519834">&#34;X-Imforwards&#34;</span><span class="op" id="3519848">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3519852">&#34;X-Powered-By&#34;</span><span class="op" id="3519866">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3519869">}</span>&nbsp;<span class="op" id="3519871">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3519875">commonHeader</span><span class="op" id="3519887">[</span><span class="ident" id="3519888">v</span><span class="op" id="3519889">]</span>&nbsp;<span class="op" id="3519891">=</span>&nbsp;<span class="ident" id="3519893">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3519896">}</span><br>
<span class="lineno"></span><span class="op" id="3519898">}</span>
</div>
</body>
</html>
