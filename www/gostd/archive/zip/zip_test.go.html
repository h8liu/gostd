<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6502546">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6502601">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6502655">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6502706">//&nbsp;Tests&nbsp;that&nbsp;involve&nbsp;both&nbsp;reading&nbsp;and&nbsp;writing.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6502755">package</span>&nbsp;<span class="ident" id="6502763">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6502768">import</span>&nbsp;<span class="op" id="6502775">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6502778">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6502787">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6502794">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6502802">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6502808">&#34;io/ioutil&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6502821">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6502829">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6502840">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6502851">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6502858">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="6502861">func</span>&nbsp;<span class="ident" id="6502866">TestOver65kFiles</span><span class="op" id="6502882">(</span><span class="ident" id="6502883">t</span>&nbsp;<span class="op" id="6502885">*</span><span class="ident" id="6502886">testing</span><span class="op" id="6502893">.</span><span class="ident" id="6502894">T</span><span class="op" id="6502895">)</span>&nbsp;<span class="op" id="6502897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6502900">buf</span>&nbsp;<span class="op" id="6502904">:=</span>&nbsp;<span class="builtinfunc" id="6502907">new</span><span class="op" id="6502910">(</span><span class="ident" id="6502911">bytes</span><span class="op" id="6502916">.</span><span class="ident" id="6502917">Buffer</span><span class="op" id="6502923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6502926">w</span>&nbsp;<span class="op" id="6502928">:=</span>&nbsp;<span class="ident" id="6502931">NewWriter</span><span class="op" id="6502940">(</span><span class="ident" id="6502941">buf</span><span class="op" id="6502944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6502947">const</span>&nbsp;<span class="ident" id="6502953">nFiles</span>&nbsp;<span class="op" id="6502960">=</span>&nbsp;<span class="op" id="6502962">(</span><span class="num" id="6502963">1</span>&nbsp;<span class="op" id="6502965">&lt;&lt;</span>&nbsp;<span class="num" id="6502968">16</span><span class="op" id="6502970">)</span>&nbsp;<span class="op" id="6502972">+</span>&nbsp;<span class="num" id="6502974">42</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6502978">for</span>&nbsp;<span class="ident" id="6502982">i</span>&nbsp;<span class="op" id="6502984">:=</span>&nbsp;<span class="num" id="6502987">0</span><span class="op" id="6502988">;</span>&nbsp;<span class="ident" id="6502990">i</span>&nbsp;<span class="op" id="6502992">&lt;</span>&nbsp;<span class="ident" id="6502994">nFiles</span><span class="op" id="6503000">;</span>&nbsp;<span class="ident" id="6503002">i</span><span class="op" id="6503003">++</span>&nbsp;<span class="op" id="6503006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6503010">_</span><span class="op" id="6503011">,</span>&nbsp;<span class="ident" id="6503013">err</span>&nbsp;<span class="op" id="6503017">:=</span>&nbsp;<span class="ident" id="6503020">w</span><span class="op" id="6503021">.</span><span class="ident" id="6503022">CreateHeader</span><span class="op" id="6503034">(</span><span class="op" id="6503035">&amp;</span><span class="ident" id="6503036">FileHeader</span><span class="op" id="6503046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6503051">Name</span><span class="op" id="6503055">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6503059">fmt</span><span class="op" id="6503062">.</span><span class="ident" id="6503063">Sprintf</span><span class="op" id="6503070">(</span><span class="string" id="6503071">&#34;%d.dat&#34;</span><span class="op" id="6503079">,</span>&nbsp;<span class="ident" id="6503081">i</span><span class="op" id="6503082">)</span><span class="op" id="6503083">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6503088">Method</span><span class="op" id="6503094">:</span>&nbsp;<span class="ident" id="6503096">Store</span><span class="op" id="6503101">,</span>&nbsp;<span class="comment" id="6503103">//&nbsp;avoid&nbsp;Issue&nbsp;6136&nbsp;and&nbsp;Issue&nbsp;6138</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6503140">}</span><span class="op" id="6503141">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6503145">if</span>&nbsp;<span class="ident" id="6503148">err</span>&nbsp;<span class="op" id="6503152">!=</span>&nbsp;<span class="ident" id="6503155">nil</span>&nbsp;<span class="op" id="6503159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6503164">t</span><span class="op" id="6503165">.</span><span class="ident" id="6503166">Fatalf</span><span class="op" id="6503172">(</span><span class="string" id="6503173">&#34;creating&nbsp;file&nbsp;%d:&nbsp;%v&#34;</span><span class="op" id="6503195">,</span>&nbsp;<span class="ident" id="6503197">i</span><span class="op" id="6503198">,</span>&nbsp;<span class="ident" id="6503200">err</span><span class="op" id="6503203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6503207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6503210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6503213">if</span>&nbsp;<span class="ident" id="6503216">err</span>&nbsp;<span class="op" id="6503220">:=</span>&nbsp;<span class="ident" id="6503223">w</span><span class="op" id="6503224">.</span><span class="ident" id="6503225">Close</span><span class="op" id="6503230">(</span><span class="op" id="6503231">)</span><span class="op" id="6503232">;</span>&nbsp;<span class="ident" id="6503234">err</span>&nbsp;<span class="op" id="6503238">!=</span>&nbsp;<span class="ident" id="6503241">nil</span>&nbsp;<span class="op" id="6503245">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6503249">t</span><span class="op" id="6503250">.</span><span class="ident" id="6503251">Fatalf</span><span class="op" id="6503257">(</span><span class="string" id="6503258">&#34;Writer.Close:&nbsp;%v&#34;</span><span class="op" id="6503276">,</span>&nbsp;<span class="ident" id="6503278">err</span><span class="op" id="6503281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6503284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6503287">s</span>&nbsp;<span class="op" id="6503289">:=</span>&nbsp;<span class="ident" id="6503292">buf</span><span class="op" id="6503295">.</span><span class="ident" id="6503296">String</span><span class="op" id="6503302">(</span><span class="op" id="6503303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6503306">zr</span><span class="op" id="6503308">,</span>&nbsp;<span class="ident" id="6503310">err</span>&nbsp;<span class="op" id="6503314">:=</span>&nbsp;<span class="ident" id="6503317">NewReader</span><span class="op" id="6503326">(</span><span class="ident" id="6503327">strings</span><span class="op" id="6503334">.</span><span class="ident" id="6503335">NewReader</span><span class="op" id="6503344">(</span><span class="ident" id="6503345">s</span><span class="op" id="6503346">)</span><span class="op" id="6503347">,</span>&nbsp;<span class="ident" id="6503349">int64</span><span class="op" id="6503354">(</span><span class="builtinfunc" id="6503355">len</span><span class="op" id="6503358">(</span><span class="ident" id="6503359">s</span><span class="op" id="6503360">)</span><span class="op" id="6503361">)</span><span class="op" id="6503362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6503365">if</span>&nbsp;<span class="ident" id="6503368">err</span>&nbsp;<span class="op" id="6503372">!=</span>&nbsp;<span class="ident" id="6503375">nil</span>&nbsp;<span class="op" id="6503379">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6503383">t</span><span class="op" id="6503384">.</span><span class="ident" id="6503385">Fatalf</span><span class="op" id="6503391">(</span><span class="string" id="6503392">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="6503407">,</span>&nbsp;<span class="ident" id="6503409">err</span><span class="op" id="6503412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6503415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6503418">if</span>&nbsp;<span class="ident" id="6503421">got</span>&nbsp;<span class="op" id="6503425">:=</span>&nbsp;<span class="builtinfunc" id="6503428">len</span><span class="op" id="6503431">(</span><span class="ident" id="6503432">zr</span><span class="op" id="6503434">.</span><span class="ident" id="6503435">File</span><span class="op" id="6503439">)</span><span class="op" id="6503440">;</span>&nbsp;<span class="ident" id="6503442">got</span>&nbsp;<span class="op" id="6503446">!=</span>&nbsp;<span class="ident" id="6503449">nFiles</span>&nbsp;<span class="op" id="6503456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6503460">t</span><span class="op" id="6503461">.</span><span class="ident" id="6503462">Fatalf</span><span class="op" id="6503468">(</span><span class="string" id="6503469">&#34;File&nbsp;contains&nbsp;%d&nbsp;files,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="6503502">,</span>&nbsp;<span class="ident" id="6503504">got</span><span class="op" id="6503507">,</span>&nbsp;<span class="ident" id="6503509">nFiles</span><span class="op" id="6503515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6503518">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6503521">for</span>&nbsp;<span class="ident" id="6503525">i</span>&nbsp;<span class="op" id="6503527">:=</span>&nbsp;<span class="num" id="6503530">0</span><span class="op" id="6503531">;</span>&nbsp;<span class="ident" id="6503533">i</span>&nbsp;<span class="op" id="6503535">&lt;</span>&nbsp;<span class="ident" id="6503537">nFiles</span><span class="op" id="6503543">;</span>&nbsp;<span class="ident" id="6503545">i</span><span class="op" id="6503546">++</span>&nbsp;<span class="op" id="6503549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6503553">want</span>&nbsp;<span class="op" id="6503558">:=</span>&nbsp;<span class="ident" id="6503561">fmt</span><span class="op" id="6503564">.</span><span class="ident" id="6503565">Sprintf</span><span class="op" id="6503572">(</span><span class="string" id="6503573">&#34;%d.dat&#34;</span><span class="op" id="6503581">,</span>&nbsp;<span class="ident" id="6503583">i</span><span class="op" id="6503584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6503588">if</span>&nbsp;<span class="ident" id="6503591">zr</span><span class="op" id="6503593">.</span><span class="ident" id="6503594">File</span><span class="op" id="6503598">[</span><span class="ident" id="6503599">i</span><span class="op" id="6503600">]</span><span class="op" id="6503601">.</span><span class="ident" id="6503602">Name</span>&nbsp;<span class="op" id="6503607">!=</span>&nbsp;<span class="ident" id="6503610">want</span>&nbsp;<span class="op" id="6503615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6503620">t</span><span class="op" id="6503621">.</span><span class="ident" id="6503622">Fatalf</span><span class="op" id="6503628">(</span><span class="string" id="6503629">&#34;File(%d)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6503653">,</span>&nbsp;<span class="ident" id="6503655">i</span><span class="op" id="6503656">,</span>&nbsp;<span class="ident" id="6503658">zr</span><span class="op" id="6503660">.</span><span class="ident" id="6503661">File</span><span class="op" id="6503665">[</span><span class="ident" id="6503666">i</span><span class="op" id="6503667">]</span><span class="op" id="6503668">.</span><span class="ident" id="6503669">Name</span><span class="op" id="6503673">,</span>&nbsp;<span class="ident" id="6503675">want</span><span class="op" id="6503679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6503683">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6503686">}</span><br>
<span class="lineno"></span><span class="op" id="6503688">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6503691">func</span>&nbsp;<span class="ident" id="6503696">TestModTime</span><span class="op" id="6503707">(</span><span class="ident" id="6503708">t</span>&nbsp;<span class="op" id="6503710">*</span><span class="ident" id="6503711">testing</span><span class="op" id="6503718">.</span><span class="ident" id="6503719">T</span><span class="op" id="6503720">)</span>&nbsp;<span class="op" id="6503722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6503725">var</span>&nbsp;<span class="ident" id="6503729">testTime</span>&nbsp;<span class="op" id="6503738">=</span>&nbsp;<span class="ident" id="6503740">time</span><span class="op" id="6503744">.</span><span class="ident" id="6503745">Date</span><span class="op" id="6503749">(</span><span class="num" id="6503750">2009</span><span class="op" id="6503754">,</span>&nbsp;<span class="ident" id="6503756">time</span><span class="op" id="6503760">.</span><span class="ident" id="6503761">November</span><span class="op" id="6503769">,</span>&nbsp;<span class="num" id="6503771">10</span><span class="op" id="6503773">,</span>&nbsp;<span class="num" id="6503775">23</span><span class="op" id="6503777">,</span>&nbsp;<span class="num" id="6503779">45</span><span class="op" id="6503781">,</span>&nbsp;<span class="num" id="6503783">58</span><span class="op" id="6503785">,</span>&nbsp;<span class="num" id="6503787">0</span><span class="op" id="6503788">,</span>&nbsp;<span class="ident" id="6503790">time</span><span class="op" id="6503794">.</span><span class="ident" id="6503795">UTC</span><span class="op" id="6503798">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6503801">fh</span>&nbsp;<span class="op" id="6503804">:=</span>&nbsp;<span class="builtinfunc" id="6503807">new</span><span class="op" id="6503810">(</span><span class="ident" id="6503811">FileHeader</span><span class="op" id="6503821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6503824">fh</span><span class="op" id="6503826">.</span><span class="ident" id="6503827">SetModTime</span><span class="op" id="6503837">(</span><span class="ident" id="6503838">testTime</span><span class="op" id="6503846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6503849">outTime</span>&nbsp;<span class="op" id="6503857">:=</span>&nbsp;<span class="ident" id="6503860">fh</span><span class="op" id="6503862">.</span><span class="ident" id="6503863">ModTime</span><span class="op" id="6503870">(</span><span class="op" id="6503871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6503874">if</span>&nbsp;<span class="op" id="6503877">!</span><span class="ident" id="6503878">outTime</span><span class="op" id="6503885">.</span><span class="ident" id="6503886">Equal</span><span class="op" id="6503891">(</span><span class="ident" id="6503892">testTime</span><span class="op" id="6503900">)</span>&nbsp;<span class="op" id="6503902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6503906">t</span><span class="op" id="6503907">.</span><span class="ident" id="6503908">Errorf</span><span class="op" id="6503914">(</span><span class="string" id="6503915">&#34;times&nbsp;don&#39;t&nbsp;match:&nbsp;got&nbsp;%s,&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6503951">,</span>&nbsp;<span class="ident" id="6503953">outTime</span><span class="op" id="6503960">,</span>&nbsp;<span class="ident" id="6503962">testTime</span><span class="op" id="6503970">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6503973">}</span><br>
<span class="lineno"></span><span class="op" id="6503975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6503978">func</span>&nbsp;<span class="ident" id="6503983">testHeaderRoundTrip</span><span class="op" id="6504002">(</span><span class="ident" id="6504003">fh</span>&nbsp;<span class="op" id="6504006">*</span><span class="ident" id="6504007">FileHeader</span><span class="op" id="6504017">,</span>&nbsp;<span class="ident" id="6504019">wantUncompressedSize</span>&nbsp;<span class="builtintype" id="6504040">uint32</span><span class="op" id="6504046">,</span>&nbsp;<span class="ident" id="6504048">wantUncompressedSize64</span>&nbsp;<span class="ident" id="6504071">uint64</span><span class="op" id="6504077">,</span>&nbsp;<span class="ident" id="6504079">t</span>&nbsp;<span class="op" id="6504081">*</span><span class="ident" id="6504082">testing</span><span class="op" id="6504089">.</span><span class="ident" id="6504090">T</span><span class="op" id="6504091">)</span>&nbsp;<span class="op" id="6504093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6504096">fi</span>&nbsp;<span class="op" id="6504099">:=</span>&nbsp;<span class="ident" id="6504102">fh</span><span class="op" id="6504104">.</span><span class="ident" id="6504105">FileInfo</span><span class="op" id="6504113">(</span><span class="op" id="6504114">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6504117">fh2</span><span class="op" id="6504120">,</span>&nbsp;<span class="ident" id="6504122">err</span>&nbsp;<span class="op" id="6504126">:=</span>&nbsp;<span class="ident" id="6504129">FileInfoHeader</span><span class="op" id="6504143">(</span><span class="ident" id="6504144">fi</span><span class="op" id="6504146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6504149">if</span>&nbsp;<span class="ident" id="6504152">err</span>&nbsp;<span class="op" id="6504156">!=</span>&nbsp;<span class="ident" id="6504159">nil</span>&nbsp;<span class="op" id="6504163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6504167">t</span><span class="op" id="6504168">.</span><span class="ident" id="6504169">Fatal</span><span class="op" id="6504174">(</span><span class="ident" id="6504175">err</span><span class="op" id="6504178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6504181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6504184">if</span>&nbsp;<span class="ident" id="6504187">got</span><span class="op" id="6504190">,</span>&nbsp;<span class="ident" id="6504192">want</span>&nbsp;<span class="op" id="6504197">:=</span>&nbsp;<span class="ident" id="6504200">fh2</span><span class="op" id="6504203">.</span><span class="ident" id="6504204">Name</span><span class="op" id="6504208">,</span>&nbsp;<span class="ident" id="6504210">fh</span><span class="op" id="6504212">.</span><span class="ident" id="6504213">Name</span><span class="op" id="6504217">;</span>&nbsp;<span class="ident" id="6504219">got</span>&nbsp;<span class="op" id="6504223">!=</span>&nbsp;<span class="ident" id="6504226">want</span>&nbsp;<span class="op" id="6504231">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6504235">t</span><span class="op" id="6504236">.</span><span class="ident" id="6504237">Errorf</span><span class="op" id="6504243">(</span><span class="string" id="6504244">&#34;Name:&nbsp;got&nbsp;%s,&nbsp;want&nbsp;%s\n&#34;</span><span class="op" id="6504269">,</span>&nbsp;<span class="ident" id="6504271">got</span><span class="op" id="6504274">,</span>&nbsp;<span class="ident" id="6504276">want</span><span class="op" id="6504280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6504283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6504286">if</span>&nbsp;<span class="ident" id="6504289">got</span><span class="op" id="6504292">,</span>&nbsp;<span class="ident" id="6504294">want</span>&nbsp;<span class="op" id="6504299">:=</span>&nbsp;<span class="ident" id="6504302">fh2</span><span class="op" id="6504305">.</span><span class="ident" id="6504306">UncompressedSize</span><span class="op" id="6504322">,</span>&nbsp;<span class="ident" id="6504324">wantUncompressedSize</span><span class="op" id="6504344">;</span>&nbsp;<span class="ident" id="6504346">got</span>&nbsp;<span class="op" id="6504350">!=</span>&nbsp;<span class="ident" id="6504353">want</span>&nbsp;<span class="op" id="6504358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6504362">t</span><span class="op" id="6504363">.</span><span class="ident" id="6504364">Errorf</span><span class="op" id="6504370">(</span><span class="string" id="6504371">&#34;UncompressedSize:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="6504408">,</span>&nbsp;<span class="ident" id="6504410">got</span><span class="op" id="6504413">,</span>&nbsp;<span class="ident" id="6504415">want</span><span class="op" id="6504419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6504422">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6504425">if</span>&nbsp;<span class="ident" id="6504428">got</span><span class="op" id="6504431">,</span>&nbsp;<span class="ident" id="6504433">want</span>&nbsp;<span class="op" id="6504438">:=</span>&nbsp;<span class="ident" id="6504441">fh2</span><span class="op" id="6504444">.</span><span class="ident" id="6504445">UncompressedSize64</span><span class="op" id="6504463">,</span>&nbsp;<span class="ident" id="6504465">wantUncompressedSize64</span><span class="op" id="6504487">;</span>&nbsp;<span class="ident" id="6504489">got</span>&nbsp;<span class="op" id="6504493">!=</span>&nbsp;<span class="ident" id="6504496">want</span>&nbsp;<span class="op" id="6504501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6504505">t</span><span class="op" id="6504506">.</span><span class="ident" id="6504507">Errorf</span><span class="op" id="6504513">(</span><span class="string" id="6504514">&#34;UncompressedSize64:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="6504553">,</span>&nbsp;<span class="ident" id="6504555">got</span><span class="op" id="6504558">,</span>&nbsp;<span class="ident" id="6504560">want</span><span class="op" id="6504564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6504567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6504570">if</span>&nbsp;<span class="ident" id="6504573">got</span><span class="op" id="6504576">,</span>&nbsp;<span class="ident" id="6504578">want</span>&nbsp;<span class="op" id="6504583">:=</span>&nbsp;<span class="ident" id="6504586">fh2</span><span class="op" id="6504589">.</span><span class="ident" id="6504590">ModifiedTime</span><span class="op" id="6504602">,</span>&nbsp;<span class="ident" id="6504604">fh</span><span class="op" id="6504606">.</span><span class="ident" id="6504607">ModifiedTime</span><span class="op" id="6504619">;</span>&nbsp;<span class="ident" id="6504621">got</span>&nbsp;<span class="op" id="6504625">!=</span>&nbsp;<span class="ident" id="6504628">want</span>&nbsp;<span class="op" id="6504633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6504637">t</span><span class="op" id="6504638">.</span><span class="ident" id="6504639">Errorf</span><span class="op" id="6504645">(</span><span class="string" id="6504646">&#34;ModifiedTime:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="6504679">,</span>&nbsp;<span class="ident" id="6504681">got</span><span class="op" id="6504684">,</span>&nbsp;<span class="ident" id="6504686">want</span><span class="op" id="6504690">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6504693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6504696">if</span>&nbsp;<span class="ident" id="6504699">got</span><span class="op" id="6504702">,</span>&nbsp;<span class="ident" id="6504704">want</span>&nbsp;<span class="op" id="6504709">:=</span>&nbsp;<span class="ident" id="6504712">fh2</span><span class="op" id="6504715">.</span><span class="ident" id="6504716">ModifiedDate</span><span class="op" id="6504728">,</span>&nbsp;<span class="ident" id="6504730">fh</span><span class="op" id="6504732">.</span><span class="ident" id="6504733">ModifiedDate</span><span class="op" id="6504745">;</span>&nbsp;<span class="ident" id="6504747">got</span>&nbsp;<span class="op" id="6504751">!=</span>&nbsp;<span class="ident" id="6504754">want</span>&nbsp;<span class="op" id="6504759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6504763">t</span><span class="op" id="6504764">.</span><span class="ident" id="6504765">Errorf</span><span class="op" id="6504771">(</span><span class="string" id="6504772">&#34;ModifiedDate:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="6504805">,</span>&nbsp;<span class="ident" id="6504807">got</span><span class="op" id="6504810">,</span>&nbsp;<span class="ident" id="6504812">want</span><span class="op" id="6504816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6504819">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6504823">if</span>&nbsp;<span class="ident" id="6504826">sysfh</span><span class="op" id="6504831">,</span>&nbsp;<span class="ident" id="6504833">ok</span>&nbsp;<span class="op" id="6504836">:=</span>&nbsp;<span class="ident" id="6504839">fi</span><span class="op" id="6504841">.</span><span class="ident" id="6504842">Sys</span><span class="op" id="6504845">(</span><span class="op" id="6504846">)</span><span class="op" id="6504847">.</span><span class="op" id="6504848">(</span><span class="op" id="6504849">*</span><span class="ident" id="6504850">FileHeader</span><span class="op" id="6504860">)</span><span class="op" id="6504861">;</span>&nbsp;<span class="op" id="6504863">!</span><span class="ident" id="6504864">ok</span>&nbsp;<span class="op" id="6504867">&amp;&amp;</span>&nbsp;<span class="ident" id="6504870">sysfh</span>&nbsp;<span class="op" id="6504876">!=</span>&nbsp;<span class="ident" id="6504879">fh</span>&nbsp;<span class="op" id="6504882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6504886">t</span><span class="op" id="6504887">.</span><span class="ident" id="6504888">Errorf</span><span class="op" id="6504894">(</span><span class="string" id="6504895">&#34;Sys&nbsp;didn&#39;t&nbsp;return&nbsp;original&nbsp;*FileHeader&#34;</span><span class="op" id="6504935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6504938">}</span><br>
<span class="lineno"></span><span class="op" id="6504940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="6504943">func</span>&nbsp;<span class="ident" id="6504948">TestFileHeaderRoundTrip</span><span class="op" id="6504971">(</span><span class="ident" id="6504972">t</span>&nbsp;<span class="op" id="6504974">*</span><span class="ident" id="6504975">testing</span><span class="op" id="6504982">.</span><span class="ident" id="6504983">T</span><span class="op" id="6504984">)</span>&nbsp;<span class="op" id="6504986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6504989">fh</span>&nbsp;<span class="op" id="6504992">:=</span>&nbsp;<span class="op" id="6504995">&amp;</span><span class="ident" id="6504996">FileHeader</span><span class="op" id="6505006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6505010">Name</span><span class="op" id="6505014">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6505028">&#34;foo.txt&#34;</span><span class="op" id="6505037">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6505041">UncompressedSize</span><span class="op" id="6505057">:</span>&nbsp;<span class="num" id="6505059">987654321</span><span class="op" id="6505068">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6505072">ModifiedTime</span><span class="op" id="6505084">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6505090">1234</span><span class="op" id="6505094">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6505098">ModifiedDate</span><span class="op" id="6505110">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6505116">5678</span><span class="op" id="6505120">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6505123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6505126">testHeaderRoundTrip</span><span class="op" id="6505145">(</span><span class="ident" id="6505146">fh</span><span class="op" id="6505148">,</span>&nbsp;<span class="ident" id="6505150">fh</span><span class="op" id="6505152">.</span><span class="ident" id="6505153">UncompressedSize</span><span class="op" id="6505169">,</span>&nbsp;<span class="ident" id="6505171">uint64</span><span class="op" id="6505177">(</span><span class="ident" id="6505178">fh</span><span class="op" id="6505180">.</span><span class="ident" id="6505181">UncompressedSize</span><span class="op" id="6505197">)</span><span class="op" id="6505198">,</span>&nbsp;<span class="ident" id="6505200">t</span><span class="op" id="6505201">)</span><br>
<span class="lineno"></span><span class="op" id="6505203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="6505206">func</span>&nbsp;<span class="ident" id="6505211">TestFileHeaderRoundTrip64</span><span class="op" id="6505236">(</span><span class="ident" id="6505237">t</span>&nbsp;<span class="op" id="6505239">*</span><span class="ident" id="6505240">testing</span><span class="op" id="6505247">.</span><span class="ident" id="6505248">T</span><span class="op" id="6505249">)</span>&nbsp;<span class="op" id="6505251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6505254">fh</span>&nbsp;<span class="op" id="6505257">:=</span>&nbsp;<span class="op" id="6505260">&amp;</span><span class="ident" id="6505261">FileHeader</span><span class="op" id="6505271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6505275">Name</span><span class="op" id="6505279">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6505295">&#34;foo.txt&#34;</span><span class="op" id="6505304">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6505308">UncompressedSize64</span><span class="op" id="6505326">:</span>&nbsp;<span class="num" id="6505328">9876543210</span><span class="op" id="6505338">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6505342">ModifiedTime</span><span class="op" id="6505354">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6505362">1234</span><span class="op" id="6505366">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6505370">ModifiedDate</span><span class="op" id="6505382">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6505390">5678</span><span class="op" id="6505394">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6505397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6505400">testHeaderRoundTrip</span><span class="op" id="6505419">(</span><span class="ident" id="6505420">fh</span><span class="op" id="6505422">,</span>&nbsp;<span class="ident" id="6505424">uint32max</span><span class="op" id="6505433">,</span>&nbsp;<span class="ident" id="6505435">fh</span><span class="op" id="6505437">.</span><span class="ident" id="6505438">UncompressedSize64</span><span class="op" id="6505456">,</span>&nbsp;<span class="ident" id="6505458">t</span><span class="op" id="6505459">)</span><br>
<span class="lineno"></span><span class="op" id="6505461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="6505464">type</span>&nbsp;<span class="ident" id="6505469">repeatedByte</span>&nbsp;<span class="keyword" id="6505482">struct</span>&nbsp;<span class="op" id="6505489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6505492">off</span>&nbsp;<span class="ident" id="6505496">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6505503">b</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6505507">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6505513">n</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6505517">int64</span><br>
<span class="lineno"></span><span class="op" id="6505523">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="6505526">//&nbsp;rleBuffer&nbsp;is&nbsp;a&nbsp;run-length-encoded&nbsp;byte&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="6505576">//&nbsp;It&#39;s&nbsp;an&nbsp;io.Writer&nbsp;(like&nbsp;a&nbsp;bytes.Buffer)&nbsp;and&nbsp;also&nbsp;an&nbsp;io.ReaderAt,</span><br>
<span class="lineno"></span><span class="comment" id="6505644">//&nbsp;allowing&nbsp;random-access&nbsp;reads.</span><br>
<span class="lineno"></span><span class="keyword" id="6505677">type</span>&nbsp;<span class="ident" id="6505682">rleBuffer</span>&nbsp;<span class="keyword" id="6505692">struct</span>&nbsp;<span class="op" id="6505699">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6505702">buf</span>&nbsp;<span class="op" id="6505706">[</span><span class="op" id="6505707">]</span><span class="ident" id="6505708">repeatedByte</span><br>
<span class="lineno"></span><span class="op" id="6505721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6505724">func</span>&nbsp;<span class="op" id="6505729">(</span><span class="ident" id="6505730">r</span>&nbsp;<span class="op" id="6505732">*</span><span class="ident" id="6505733">rleBuffer</span><span class="op" id="6505742">)</span>&nbsp;<span class="ident" id="6505744">Size</span><span class="op" id="6505748">(</span><span class="op" id="6505749">)</span>&nbsp;<span class="ident" id="6505751">int64</span>&nbsp;<span class="op" id="6505757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6505760">if</span>&nbsp;<span class="builtinfunc" id="6505763">len</span><span class="op" id="6505766">(</span><span class="ident" id="6505767">r</span><span class="op" id="6505768">.</span><span class="ident" id="6505769">buf</span><span class="op" id="6505772">)</span>&nbsp;<span class="op" id="6505774">==</span>&nbsp;<span class="num" id="6505777">0</span>&nbsp;<span class="op" id="6505779">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6505783">return</span>&nbsp;<span class="num" id="6505790">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6505793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6505796">last</span>&nbsp;<span class="op" id="6505801">:=</span>&nbsp;<span class="op" id="6505804">&amp;</span><span class="ident" id="6505805">r</span><span class="op" id="6505806">.</span><span class="ident" id="6505807">buf</span><span class="op" id="6505810">[</span><span class="builtinfunc" id="6505811">len</span><span class="op" id="6505814">(</span><span class="ident" id="6505815">r</span><span class="op" id="6505816">.</span><span class="ident" id="6505817">buf</span><span class="op" id="6505820">)</span><span class="op" id="6505821">-</span><span class="num" id="6505822">1</span><span class="op" id="6505823">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6505826">return</span>&nbsp;<span class="ident" id="6505833">last</span><span class="op" id="6505837">.</span><span class="ident" id="6505838">off</span>&nbsp;<span class="op" id="6505842">+</span>&nbsp;<span class="ident" id="6505844">last</span><span class="op" id="6505848">.</span><span class="ident" id="6505849">n</span><br>
<span class="lineno"></span><span class="op" id="6505851">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="keyword" id="6505854">func</span>&nbsp;<span class="op" id="6505859">(</span><span class="ident" id="6505860">r</span>&nbsp;<span class="op" id="6505862">*</span><span class="ident" id="6505863">rleBuffer</span><span class="op" id="6505872">)</span>&nbsp;<span class="ident" id="6505874">Write</span><span class="op" id="6505879">(</span><span class="ident" id="6505880">p</span>&nbsp;<span class="op" id="6505882">[</span><span class="op" id="6505883">]</span><span class="builtintype" id="6505884">byte</span><span class="op" id="6505888">)</span>&nbsp;<span class="op" id="6505890">(</span><span class="ident" id="6505891">n</span>&nbsp;<span class="builtintype" id="6505893">int</span><span class="op" id="6505896">,</span>&nbsp;<span class="ident" id="6505898">err</span>&nbsp;<span class="builtintype" id="6505902">error</span><span class="op" id="6505907">)</span>&nbsp;<span class="op" id="6505909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6505912">var</span>&nbsp;<span class="ident" id="6505916">rp</span>&nbsp;<span class="op" id="6505919">*</span><span class="ident" id="6505920">repeatedByte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6505934">if</span>&nbsp;<span class="builtinfunc" id="6505937">len</span><span class="op" id="6505940">(</span><span class="ident" id="6505941">r</span><span class="op" id="6505942">.</span><span class="ident" id="6505943">buf</span><span class="op" id="6505946">)</span>&nbsp;<span class="op" id="6505948">&gt;</span>&nbsp;<span class="num" id="6505950">0</span>&nbsp;<span class="op" id="6505952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6505956">rp</span>&nbsp;<span class="op" id="6505959">=</span>&nbsp;<span class="op" id="6505961">&amp;</span><span class="ident" id="6505962">r</span><span class="op" id="6505963">.</span><span class="ident" id="6505964">buf</span><span class="op" id="6505967">[</span><span class="builtinfunc" id="6505968">len</span><span class="op" id="6505971">(</span><span class="ident" id="6505972">r</span><span class="op" id="6505973">.</span><span class="ident" id="6505974">buf</span><span class="op" id="6505977">)</span><span class="op" id="6505978">-</span><span class="num" id="6505979">1</span><span class="op" id="6505980">]</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6505984">//&nbsp;Fast&nbsp;path,&nbsp;if&nbsp;p&nbsp;is&nbsp;entirely&nbsp;the&nbsp;same&nbsp;byte&nbsp;repeated.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6506041">if</span>&nbsp;<span class="ident" id="6506044">lastByte</span>&nbsp;<span class="op" id="6506053">:=</span>&nbsp;<span class="ident" id="6506056">rp</span><span class="op" id="6506058">.</span><span class="ident" id="6506059">b</span><span class="op" id="6506060">;</span>&nbsp;<span class="builtinfunc" id="6506062">len</span><span class="op" id="6506065">(</span><span class="ident" id="6506066">p</span><span class="op" id="6506067">)</span>&nbsp;<span class="op" id="6506069">&gt;</span>&nbsp;<span class="num" id="6506071">0</span>&nbsp;<span class="op" id="6506073">&amp;&amp;</span>&nbsp;<span class="ident" id="6506076">p</span><span class="op" id="6506077">[</span><span class="num" id="6506078">0</span><span class="op" id="6506079">]</span>&nbsp;<span class="op" id="6506081">==</span>&nbsp;<span class="ident" id="6506084">lastByte</span>&nbsp;<span class="op" id="6506093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6506098">all</span>&nbsp;<span class="op" id="6506102">:=</span>&nbsp;<span class="builtintype" id="6506105">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6506113">for</span>&nbsp;<span class="ident" id="6506117">_</span><span class="op" id="6506118">,</span>&nbsp;<span class="ident" id="6506120">b</span>&nbsp;<span class="op" id="6506122">:=</span>&nbsp;<span class="keyword" id="6506125">range</span>&nbsp;<span class="ident" id="6506131">p</span>&nbsp;<span class="op" id="6506133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6506139">if</span>&nbsp;<span class="ident" id="6506142">b</span>&nbsp;<span class="op" id="6506144">!=</span>&nbsp;<span class="ident" id="6506147">lastByte</span>&nbsp;<span class="op" id="6506156">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6506163">all</span>&nbsp;<span class="op" id="6506167">=</span>&nbsp;<span class="builtintype" id="6506169">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6506180">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6506190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6506195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6506200">if</span>&nbsp;<span class="ident" id="6506203">all</span>&nbsp;<span class="op" id="6506207">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6506213">rp</span><span class="op" id="6506215">.</span><span class="ident" id="6506216">n</span>&nbsp;<span class="op" id="6506218">+=</span>&nbsp;<span class="ident" id="6506221">int64</span><span class="op" id="6506226">(</span><span class="builtinfunc" id="6506227">len</span><span class="op" id="6506230">(</span><span class="ident" id="6506231">p</span><span class="op" id="6506232">)</span><span class="op" id="6506233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6506239">return</span>&nbsp;<span class="builtinfunc" id="6506246">len</span><span class="op" id="6506249">(</span><span class="ident" id="6506250">p</span><span class="op" id="6506251">)</span><span class="op" id="6506252">,</span>&nbsp;<span class="ident" id="6506254">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6506261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6506265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6506268">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6506272">for</span>&nbsp;<span class="ident" id="6506276">_</span><span class="op" id="6506277">,</span>&nbsp;<span class="ident" id="6506279">b</span>&nbsp;<span class="op" id="6506281">:=</span>&nbsp;<span class="keyword" id="6506284">range</span>&nbsp;<span class="ident" id="6506290">p</span>&nbsp;<span class="op" id="6506292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6506296">if</span>&nbsp;<span class="ident" id="6506299">rp</span>&nbsp;<span class="op" id="6506302">==</span>&nbsp;<span class="ident" id="6506305">nil</span>&nbsp;<span class="op" id="6506309">||</span>&nbsp;<span class="ident" id="6506312">rp</span><span class="op" id="6506314">.</span><span class="ident" id="6506315">b</span>&nbsp;<span class="op" id="6506317">!=</span>&nbsp;<span class="ident" id="6506320">b</span>&nbsp;<span class="op" id="6506322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6506327">r</span><span class="op" id="6506328">.</span><span class="ident" id="6506329">buf</span>&nbsp;<span class="op" id="6506333">=</span>&nbsp;<span class="builtinfunc" id="6506335">append</span><span class="op" id="6506341">(</span><span class="ident" id="6506342">r</span><span class="op" id="6506343">.</span><span class="ident" id="6506344">buf</span><span class="op" id="6506347">,</span>&nbsp;<span class="ident" id="6506349">repeatedByte</span><span class="op" id="6506361">{</span><span class="ident" id="6506362">r</span><span class="op" id="6506363">.</span><span class="ident" id="6506364">Size</span><span class="op" id="6506368">(</span><span class="op" id="6506369">)</span><span class="op" id="6506370">,</span>&nbsp;<span class="ident" id="6506372">b</span><span class="op" id="6506373">,</span>&nbsp;<span class="num" id="6506375">1</span><span class="op" id="6506376">}</span><span class="op" id="6506377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6506382">rp</span>&nbsp;<span class="op" id="6506385">=</span>&nbsp;<span class="op" id="6506387">&amp;</span><span class="ident" id="6506388">r</span><span class="op" id="6506389">.</span><span class="ident" id="6506390">buf</span><span class="op" id="6506393">[</span><span class="builtinfunc" id="6506394">len</span><span class="op" id="6506397">(</span><span class="ident" id="6506398">r</span><span class="op" id="6506399">.</span><span class="ident" id="6506400">buf</span><span class="op" id="6506403">)</span><span class="op" id="6506404">-</span><span class="num" id="6506405">1</span><span class="op" id="6506406">]</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6506410">}</span>&nbsp;<span class="keyword" id="6506412">else</span>&nbsp;<span class="op" id="6506417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6506422">rp</span><span class="op" id="6506424">.</span><span class="ident" id="6506425">n</span><span class="op" id="6506426">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6506431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6506434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6506437">return</span>&nbsp;<span class="builtinfunc" id="6506444">len</span><span class="op" id="6506447">(</span><span class="ident" id="6506448">p</span><span class="op" id="6506449">)</span><span class="op" id="6506450">,</span>&nbsp;<span class="ident" id="6506452">nil</span><br>
<span class="lineno">160</span><span class="op" id="6506456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6506459">func</span>&nbsp;<span class="op" id="6506464">(</span><span class="ident" id="6506465">r</span>&nbsp;<span class="op" id="6506467">*</span><span class="ident" id="6506468">rleBuffer</span><span class="op" id="6506477">)</span>&nbsp;<span class="ident" id="6506479">ReadAt</span><span class="op" id="6506485">(</span><span class="ident" id="6506486">p</span>&nbsp;<span class="op" id="6506488">[</span><span class="op" id="6506489">]</span><span class="builtintype" id="6506490">byte</span><span class="op" id="6506494">,</span>&nbsp;<span class="ident" id="6506496">off</span>&nbsp;<span class="ident" id="6506500">int64</span><span class="op" id="6506505">)</span>&nbsp;<span class="op" id="6506507">(</span><span class="ident" id="6506508">n</span>&nbsp;<span class="builtintype" id="6506510">int</span><span class="op" id="6506513">,</span>&nbsp;<span class="ident" id="6506515">err</span>&nbsp;<span class="builtintype" id="6506519">error</span><span class="op" id="6506524">)</span>&nbsp;<span class="op" id="6506526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6506529">if</span>&nbsp;<span class="builtinfunc" id="6506532">len</span><span class="op" id="6506535">(</span><span class="ident" id="6506536">p</span><span class="op" id="6506537">)</span>&nbsp;<span class="op" id="6506539">==</span>&nbsp;<span class="num" id="6506542">0</span>&nbsp;<span class="op" id="6506544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6506548">return</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6506556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6506559">skipParts</span>&nbsp;<span class="op" id="6506569">:=</span>&nbsp;<span class="ident" id="6506572">sort</span><span class="op" id="6506576">.</span><span class="ident" id="6506577">Search</span><span class="op" id="6506583">(</span><span class="builtinfunc" id="6506584">len</span><span class="op" id="6506587">(</span><span class="ident" id="6506588">r</span><span class="op" id="6506589">.</span><span class="ident" id="6506590">buf</span><span class="op" id="6506593">)</span><span class="op" id="6506594">,</span>&nbsp;<span class="keyword" id="6506596">func</span><span class="op" id="6506600">(</span><span class="ident" id="6506601">i</span>&nbsp;<span class="builtintype" id="6506603">int</span><span class="op" id="6506606">)</span>&nbsp;<span class="builtintype" id="6506608">bool</span>&nbsp;<span class="op" id="6506613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6506617">part</span>&nbsp;<span class="op" id="6506622">:=</span>&nbsp;<span class="op" id="6506625">&amp;</span><span class="ident" id="6506626">r</span><span class="op" id="6506627">.</span><span class="ident" id="6506628">buf</span><span class="op" id="6506631">[</span><span class="ident" id="6506632">i</span><span class="op" id="6506633">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6506637">return</span>&nbsp;<span class="ident" id="6506644">part</span><span class="op" id="6506648">.</span><span class="ident" id="6506649">off</span><span class="op" id="6506652">+</span><span class="ident" id="6506653">part</span><span class="op" id="6506657">.</span><span class="ident" id="6506658">n</span>&nbsp;<span class="op" id="6506660">&gt;</span>&nbsp;<span class="ident" id="6506662">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6506667">}</span><span class="op" id="6506668">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6506671">parts</span>&nbsp;<span class="op" id="6506677">:=</span>&nbsp;<span class="ident" id="6506680">r</span><span class="op" id="6506681">.</span><span class="ident" id="6506682">buf</span><span class="op" id="6506685">[</span><span class="ident" id="6506686">skipParts</span><span class="op" id="6506695">:</span><span class="op" id="6506696">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6506699">if</span>&nbsp;<span class="builtinfunc" id="6506702">len</span><span class="op" id="6506705">(</span><span class="ident" id="6506706">parts</span><span class="op" id="6506711">)</span>&nbsp;<span class="op" id="6506713">&gt;</span>&nbsp;<span class="num" id="6506715">0</span>&nbsp;<span class="op" id="6506717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6506721">skipBytes</span>&nbsp;<span class="op" id="6506731">:=</span>&nbsp;<span class="ident" id="6506734">off</span>&nbsp;<span class="op" id="6506738">-</span>&nbsp;<span class="ident" id="6506740">parts</span><span class="op" id="6506745">[</span><span class="num" id="6506746">0</span><span class="op" id="6506747">]</span><span class="op" id="6506748">.</span><span class="ident" id="6506749">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6506755">for</span>&nbsp;<span class="builtinfunc" id="6506759">len</span><span class="op" id="6506762">(</span><span class="ident" id="6506763">parts</span><span class="op" id="6506768">)</span>&nbsp;<span class="op" id="6506770">&gt;</span>&nbsp;<span class="num" id="6506772">0</span>&nbsp;<span class="op" id="6506774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6506779">part</span>&nbsp;<span class="op" id="6506784">:=</span>&nbsp;<span class="ident" id="6506787">parts</span><span class="op" id="6506792">[</span><span class="num" id="6506793">0</span><span class="op" id="6506794">]</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6506799">for</span>&nbsp;<span class="ident" id="6506803">i</span>&nbsp;<span class="op" id="6506805">:=</span>&nbsp;<span class="ident" id="6506808">skipBytes</span><span class="op" id="6506817">;</span>&nbsp;<span class="ident" id="6506819">i</span>&nbsp;<span class="op" id="6506821">&lt;</span>&nbsp;<span class="ident" id="6506823">part</span><span class="op" id="6506827">.</span><span class="ident" id="6506828">n</span><span class="op" id="6506829">;</span>&nbsp;<span class="ident" id="6506831">i</span><span class="op" id="6506832">++</span>&nbsp;<span class="op" id="6506835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6506841">if</span>&nbsp;<span class="ident" id="6506844">n</span>&nbsp;<span class="op" id="6506846">==</span>&nbsp;<span class="builtinfunc" id="6506849">len</span><span class="op" id="6506852">(</span><span class="ident" id="6506853">p</span><span class="op" id="6506854">)</span>&nbsp;<span class="op" id="6506856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6506863">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6506874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6506880">p</span><span class="op" id="6506881">[</span><span class="ident" id="6506882">n</span><span class="op" id="6506883">]</span>&nbsp;<span class="op" id="6506885">=</span>&nbsp;<span class="ident" id="6506887">part</span><span class="op" id="6506891">.</span><span class="ident" id="6506892">b</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6506898">n</span><span class="op" id="6506899">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6506905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6506910">parts</span>&nbsp;<span class="op" id="6506916">=</span>&nbsp;<span class="ident" id="6506918">parts</span><span class="op" id="6506923">[</span><span class="num" id="6506924">1</span><span class="op" id="6506925">:</span><span class="op" id="6506926">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6506931">skipBytes</span>&nbsp;<span class="op" id="6506941">=</span>&nbsp;<span class="num" id="6506943">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6506947">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6506950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6506953">if</span>&nbsp;<span class="ident" id="6506956">n</span>&nbsp;<span class="op" id="6506958">!=</span>&nbsp;<span class="builtinfunc" id="6506961">len</span><span class="op" id="6506964">(</span><span class="ident" id="6506965">p</span><span class="op" id="6506966">)</span>&nbsp;<span class="op" id="6506968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6506972">err</span>&nbsp;<span class="op" id="6506976">=</span>&nbsp;<span class="ident" id="6506978">io</span><span class="op" id="6506980">.</span><span class="ident" id="6506981">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6506999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6507002">return</span><br>
<span class="lineno">190</span><span class="op" id="6507009">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6507012">//&nbsp;Just&nbsp;testing&nbsp;the&nbsp;rleBuffer&nbsp;used&nbsp;in&nbsp;the&nbsp;Zip64&nbsp;test&nbsp;above.&nbsp;Not&nbsp;used&nbsp;by&nbsp;the&nbsp;zip&nbsp;code.</span><br>
<span class="lineno"></span><span class="keyword" id="6507098">func</span>&nbsp;<span class="ident" id="6507103">TestRLEBuffer</span><span class="op" id="6507116">(</span><span class="ident" id="6507117">t</span>&nbsp;<span class="op" id="6507119">*</span><span class="ident" id="6507120">testing</span><span class="op" id="6507127">.</span><span class="ident" id="6507128">T</span><span class="op" id="6507129">)</span>&nbsp;<span class="op" id="6507131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6507134">b</span>&nbsp;<span class="op" id="6507136">:=</span>&nbsp;<span class="builtinfunc" id="6507139">new</span><span class="op" id="6507142">(</span><span class="ident" id="6507143">rleBuffer</span><span class="op" id="6507152">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6507155">var</span>&nbsp;<span class="ident" id="6507159">all</span>&nbsp;<span class="op" id="6507163">[</span><span class="op" id="6507164">]</span><span class="builtintype" id="6507165">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6507171">writes</span>&nbsp;<span class="op" id="6507178">:=</span>&nbsp;<span class="op" id="6507181">[</span><span class="op" id="6507182">]</span><span class="builtintype" id="6507183">string</span><span class="op" id="6507189">{</span><span class="string" id="6507190">&#34;abcdeee&#34;</span><span class="op" id="6507199">,</span>&nbsp;<span class="string" id="6507201">&#34;eeeeeee&#34;</span><span class="op" id="6507210">,</span>&nbsp;<span class="string" id="6507212">&#34;eeeefghaaiii&#34;</span><span class="op" id="6507226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6507229">for</span>&nbsp;<span class="ident" id="6507233">_</span><span class="op" id="6507234">,</span>&nbsp;<span class="ident" id="6507236">w</span>&nbsp;<span class="op" id="6507238">:=</span>&nbsp;<span class="keyword" id="6507241">range</span>&nbsp;<span class="ident" id="6507247">writes</span>&nbsp;<span class="op" id="6507254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6507258">b</span><span class="op" id="6507259">.</span><span class="ident" id="6507260">Write</span><span class="op" id="6507265">(</span><span class="op" id="6507266">[</span><span class="op" id="6507267">]</span><span class="builtintype" id="6507268">byte</span><span class="op" id="6507272">(</span><span class="ident" id="6507273">w</span><span class="op" id="6507274">)</span><span class="op" id="6507275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6507279">all</span>&nbsp;<span class="op" id="6507283">=</span>&nbsp;<span class="builtinfunc" id="6507285">append</span><span class="op" id="6507291">(</span><span class="ident" id="6507292">all</span><span class="op" id="6507295">,</span>&nbsp;<span class="ident" id="6507297">w</span><span class="op" id="6507298">...</span><span class="op" id="6507301">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6507304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6507307">if</span>&nbsp;<span class="builtinfunc" id="6507310">len</span><span class="op" id="6507313">(</span><span class="ident" id="6507314">b</span><span class="op" id="6507315">.</span><span class="ident" id="6507316">buf</span><span class="op" id="6507319">)</span>&nbsp;<span class="op" id="6507321">!=</span>&nbsp;<span class="num" id="6507324">10</span>&nbsp;<span class="op" id="6507327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6507331">t</span><span class="op" id="6507332">.</span><span class="ident" id="6507333">Fatalf</span><span class="op" id="6507339">(</span><span class="string" id="6507340">&#34;len(b.buf)&nbsp;=&nbsp;%d;&nbsp;want&nbsp;10&#34;</span><span class="op" id="6507366">,</span>&nbsp;<span class="builtinfunc" id="6507368">len</span><span class="op" id="6507371">(</span><span class="ident" id="6507372">b</span><span class="op" id="6507373">.</span><span class="ident" id="6507374">buf</span><span class="op" id="6507377">)</span><span class="op" id="6507378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6507381">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6507385">for</span>&nbsp;<span class="ident" id="6507389">i</span>&nbsp;<span class="op" id="6507391">:=</span>&nbsp;<span class="num" id="6507394">0</span><span class="op" id="6507395">;</span>&nbsp;<span class="ident" id="6507397">i</span>&nbsp;<span class="op" id="6507399">&lt;</span>&nbsp;<span class="builtinfunc" id="6507401">len</span><span class="op" id="6507404">(</span><span class="ident" id="6507405">all</span><span class="op" id="6507408">)</span><span class="op" id="6507409">;</span>&nbsp;<span class="ident" id="6507411">i</span><span class="op" id="6507412">++</span>&nbsp;<span class="op" id="6507415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6507419">for</span>&nbsp;<span class="ident" id="6507423">j</span>&nbsp;<span class="op" id="6507425">:=</span>&nbsp;<span class="num" id="6507428">0</span><span class="op" id="6507429">;</span>&nbsp;<span class="ident" id="6507431">j</span>&nbsp;<span class="op" id="6507433">&lt;</span>&nbsp;<span class="builtinfunc" id="6507435">len</span><span class="op" id="6507438">(</span><span class="ident" id="6507439">all</span><span class="op" id="6507442">)</span><span class="op" id="6507443">-</span><span class="ident" id="6507444">i</span><span class="op" id="6507445">;</span>&nbsp;<span class="ident" id="6507447">j</span><span class="op" id="6507448">++</span>&nbsp;<span class="op" id="6507451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6507456">buf</span>&nbsp;<span class="op" id="6507460">:=</span>&nbsp;<span class="builtinfunc" id="6507463">make</span><span class="op" id="6507467">(</span><span class="op" id="6507468">[</span><span class="op" id="6507469">]</span><span class="builtintype" id="6507470">byte</span><span class="op" id="6507474">,</span>&nbsp;<span class="ident" id="6507476">j</span><span class="op" id="6507477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6507482">n</span><span class="op" id="6507483">,</span>&nbsp;<span class="ident" id="6507485">err</span>&nbsp;<span class="op" id="6507489">:=</span>&nbsp;<span class="ident" id="6507492">b</span><span class="op" id="6507493">.</span><span class="ident" id="6507494">ReadAt</span><span class="op" id="6507500">(</span><span class="ident" id="6507501">buf</span><span class="op" id="6507504">,</span>&nbsp;<span class="ident" id="6507506">int64</span><span class="op" id="6507511">(</span><span class="ident" id="6507512">i</span><span class="op" id="6507513">)</span><span class="op" id="6507514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6507519">if</span>&nbsp;<span class="ident" id="6507522">err</span>&nbsp;<span class="op" id="6507526">!=</span>&nbsp;<span class="ident" id="6507529">nil</span>&nbsp;<span class="op" id="6507533">||</span>&nbsp;<span class="ident" id="6507536">n</span>&nbsp;<span class="op" id="6507538">!=</span>&nbsp;<span class="builtinfunc" id="6507541">len</span><span class="op" id="6507544">(</span><span class="ident" id="6507545">buf</span><span class="op" id="6507548">)</span>&nbsp;<span class="op" id="6507550">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6507556">t</span><span class="op" id="6507557">.</span><span class="ident" id="6507558">Errorf</span><span class="op" id="6507564">(</span><span class="string" id="6507565">&#34;ReadAt(%d,&nbsp;%d)&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;%d,&nbsp;nil&#34;</span><span class="op" id="6507604">,</span>&nbsp;<span class="ident" id="6507606">i</span><span class="op" id="6507607">,</span>&nbsp;<span class="ident" id="6507609">j</span><span class="op" id="6507610">,</span>&nbsp;<span class="ident" id="6507612">n</span><span class="op" id="6507613">,</span>&nbsp;<span class="ident" id="6507615">err</span><span class="op" id="6507618">,</span>&nbsp;<span class="builtinfunc" id="6507620">len</span><span class="op" id="6507623">(</span><span class="ident" id="6507624">buf</span><span class="op" id="6507627">)</span><span class="op" id="6507628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6507633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6507638">if</span>&nbsp;<span class="op" id="6507641">!</span><span class="ident" id="6507642">bytes</span><span class="op" id="6507647">.</span><span class="ident" id="6507648">Equal</span><span class="op" id="6507653">(</span><span class="ident" id="6507654">buf</span><span class="op" id="6507657">,</span>&nbsp;<span class="ident" id="6507659">all</span><span class="op" id="6507662">[</span><span class="ident" id="6507663">i</span><span class="op" id="6507664">:</span><span class="ident" id="6507665">i</span><span class="op" id="6507666">+</span><span class="ident" id="6507667">j</span><span class="op" id="6507668">]</span><span class="op" id="6507669">)</span>&nbsp;<span class="op" id="6507671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6507677">t</span><span class="op" id="6507678">.</span><span class="ident" id="6507679">Errorf</span><span class="op" id="6507685">(</span><span class="string" id="6507686">&#34;ReadAt(%d,&nbsp;%d)&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6507716">,</span>&nbsp;<span class="ident" id="6507718">i</span><span class="op" id="6507719">,</span>&nbsp;<span class="ident" id="6507721">j</span><span class="op" id="6507722">,</span>&nbsp;<span class="ident" id="6507724">buf</span><span class="op" id="6507727">,</span>&nbsp;<span class="ident" id="6507729">all</span><span class="op" id="6507732">[</span><span class="ident" id="6507733">i</span><span class="op" id="6507734">:</span><span class="ident" id="6507735">i</span><span class="op" id="6507736">+</span><span class="ident" id="6507737">j</span><span class="op" id="6507738">]</span><span class="op" id="6507739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6507744">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6507748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6507751">}</span><br>
<span class="lineno"></span><span class="op" id="6507753">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6507756">//&nbsp;fakeHash32&nbsp;is&nbsp;a&nbsp;dummy&nbsp;Hash32&nbsp;that&nbsp;always&nbsp;returns&nbsp;0.</span><br>
<span class="lineno">220</span><span class="keyword" id="6507811">type</span>&nbsp;<span class="ident" id="6507816">fakeHash32</span>&nbsp;<span class="keyword" id="6507827">struct</span>&nbsp;<span class="op" id="6507834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6507837">hash</span><span class="op" id="6507841">.</span><span class="ident" id="6507842">Hash32</span><br>
<span class="lineno"></span><span class="op" id="6507849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6507852">func</span>&nbsp;<span class="op" id="6507857">(</span><span class="ident" id="6507858">fakeHash32</span><span class="op" id="6507868">)</span>&nbsp;<span class="ident" id="6507870">Write</span><span class="op" id="6507875">(</span><span class="ident" id="6507876">p</span>&nbsp;<span class="op" id="6507878">[</span><span class="op" id="6507879">]</span><span class="builtintype" id="6507880">byte</span><span class="op" id="6507884">)</span>&nbsp;<span class="op" id="6507886">(</span><span class="builtintype" id="6507887">int</span><span class="op" id="6507890">,</span>&nbsp;<span class="builtintype" id="6507892">error</span><span class="op" id="6507897">)</span>&nbsp;<span class="op" id="6507899">{</span>&nbsp;<span class="keyword" id="6507901">return</span>&nbsp;<span class="builtinfunc" id="6507908">len</span><span class="op" id="6507911">(</span><span class="ident" id="6507912">p</span><span class="op" id="6507913">)</span><span class="op" id="6507914">,</span>&nbsp;<span class="ident" id="6507916">nil</span>&nbsp;<span class="op" id="6507920">}</span><br>
<span class="lineno">225</span><span class="keyword" id="6507922">func</span>&nbsp;<span class="op" id="6507927">(</span><span class="ident" id="6507928">fakeHash32</span><span class="op" id="6507938">)</span>&nbsp;<span class="ident" id="6507940">Sum32</span><span class="op" id="6507945">(</span><span class="op" id="6507946">)</span>&nbsp;<span class="builtintype" id="6507948">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6507969">{</span>&nbsp;<span class="keyword" id="6507971">return</span>&nbsp;<span class="num" id="6507978">0</span>&nbsp;<span class="op" id="6507980">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6507983">func</span>&nbsp;<span class="ident" id="6507988">TestZip64</span><span class="op" id="6507997">(</span><span class="ident" id="6507998">t</span>&nbsp;<span class="op" id="6508000">*</span><span class="ident" id="6508001">testing</span><span class="op" id="6508008">.</span><span class="ident" id="6508009">T</span><span class="op" id="6508010">)</span>&nbsp;<span class="op" id="6508012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6508015">if</span>&nbsp;<span class="ident" id="6508018">testing</span><span class="op" id="6508025">.</span><span class="ident" id="6508026">Short</span><span class="op" id="6508031">(</span><span class="op" id="6508032">)</span>&nbsp;<span class="op" id="6508034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6508038">t</span><span class="op" id="6508039">.</span><span class="ident" id="6508040">Skip</span><span class="op" id="6508044">(</span><span class="string" id="6508045">&#34;slow&nbsp;test;&nbsp;skipping&#34;</span><span class="op" id="6508066">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6508069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6508072">const</span>&nbsp;<span class="ident" id="6508078">size</span>&nbsp;<span class="op" id="6508083">=</span>&nbsp;<span class="num" id="6508085">1</span>&nbsp;<span class="op" id="6508087">&lt;&lt;</span>&nbsp;<span class="num" id="6508090">32</span>&nbsp;<span class="comment" id="6508093">//&nbsp;before&nbsp;the&nbsp;&#34;END\n&#34;&nbsp;part</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6508121">testZip64</span><span class="op" id="6508130">(</span><span class="ident" id="6508131">t</span><span class="op" id="6508132">,</span>&nbsp;<span class="ident" id="6508134">size</span><span class="op" id="6508138">)</span><br>
<span class="lineno"></span><span class="op" id="6508140">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword" id="6508143">func</span>&nbsp;<span class="ident" id="6508148">testZip64</span><span class="op" id="6508157">(</span><span class="ident" id="6508158">t</span>&nbsp;<span class="ident" id="6508160">testing</span><span class="op" id="6508167">.</span><span class="ident" id="6508168">TB</span><span class="op" id="6508170">,</span>&nbsp;<span class="ident" id="6508172">size</span>&nbsp;<span class="ident" id="6508177">int64</span><span class="op" id="6508182">)</span>&nbsp;<span class="op" id="6508184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6508187">const</span>&nbsp;<span class="ident" id="6508193">chunkSize</span>&nbsp;<span class="op" id="6508203">=</span>&nbsp;<span class="num" id="6508205">1024</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6508211">chunks</span>&nbsp;<span class="op" id="6508218">:=</span>&nbsp;<span class="builtintype" id="6508221">int</span><span class="op" id="6508224">(</span><span class="ident" id="6508225">size</span>&nbsp;<span class="op" id="6508230">/</span>&nbsp;<span class="ident" id="6508232">chunkSize</span><span class="op" id="6508241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6508244">//&nbsp;write&nbsp;2^32&nbsp;bytes&nbsp;plus&nbsp;&#34;END\n&#34;&nbsp;to&nbsp;a&nbsp;zip&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6508292">buf</span>&nbsp;<span class="op" id="6508296">:=</span>&nbsp;<span class="builtinfunc" id="6508299">new</span><span class="op" id="6508302">(</span><span class="ident" id="6508303">rleBuffer</span><span class="op" id="6508312">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6508315">w</span>&nbsp;<span class="op" id="6508317">:=</span>&nbsp;<span class="ident" id="6508320">NewWriter</span><span class="op" id="6508329">(</span><span class="ident" id="6508330">buf</span><span class="op" id="6508333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6508336">f</span><span class="op" id="6508337">,</span>&nbsp;<span class="ident" id="6508339">err</span>&nbsp;<span class="op" id="6508343">:=</span>&nbsp;<span class="ident" id="6508346">w</span><span class="op" id="6508347">.</span><span class="ident" id="6508348">CreateHeader</span><span class="op" id="6508360">(</span><span class="op" id="6508361">&amp;</span><span class="ident" id="6508362">FileHeader</span><span class="op" id="6508372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6508376">Name</span><span class="op" id="6508380">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6508384">&#34;huge.txt&#34;</span><span class="op" id="6508394">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6508398">Method</span><span class="op" id="6508404">:</span>&nbsp;<span class="ident" id="6508406">Store</span><span class="op" id="6508411">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6508414">}</span><span class="op" id="6508415">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6508418">if</span>&nbsp;<span class="ident" id="6508421">err</span>&nbsp;<span class="op" id="6508425">!=</span>&nbsp;<span class="ident" id="6508428">nil</span>&nbsp;<span class="op" id="6508432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6508436">t</span><span class="op" id="6508437">.</span><span class="ident" id="6508438">Fatal</span><span class="op" id="6508443">(</span><span class="ident" id="6508444">err</span><span class="op" id="6508447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6508450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6508453">f</span><span class="op" id="6508454">.</span><span class="op" id="6508455">(</span><span class="op" id="6508456">*</span><span class="ident" id="6508457">fileWriter</span><span class="op" id="6508467">)</span><span class="op" id="6508468">.</span><span class="ident" id="6508469">crc32</span>&nbsp;<span class="op" id="6508475">=</span>&nbsp;<span class="ident" id="6508477">fakeHash32</span><span class="op" id="6508487">{</span><span class="op" id="6508488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6508491">chunk</span>&nbsp;<span class="op" id="6508497">:=</span>&nbsp;<span class="builtinfunc" id="6508500">make</span><span class="op" id="6508504">(</span><span class="op" id="6508505">[</span><span class="op" id="6508506">]</span><span class="builtintype" id="6508507">byte</span><span class="op" id="6508511">,</span>&nbsp;<span class="ident" id="6508513">chunkSize</span><span class="op" id="6508522">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6508525">for</span>&nbsp;<span class="ident" id="6508529">i</span>&nbsp;<span class="op" id="6508531">:=</span>&nbsp;<span class="keyword" id="6508534">range</span>&nbsp;<span class="ident" id="6508540">chunk</span>&nbsp;<span class="op" id="6508546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6508550">chunk</span><span class="op" id="6508555">[</span><span class="ident" id="6508556">i</span><span class="op" id="6508557">]</span>&nbsp;<span class="op" id="6508559">=</span>&nbsp;<span class="string" id="6508561">&#39;.&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6508566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6508569">for</span>&nbsp;<span class="ident" id="6508573">i</span>&nbsp;<span class="op" id="6508575">:=</span>&nbsp;<span class="num" id="6508578">0</span><span class="op" id="6508579">;</span>&nbsp;<span class="ident" id="6508581">i</span>&nbsp;<span class="op" id="6508583">&lt;</span>&nbsp;<span class="ident" id="6508585">chunks</span><span class="op" id="6508591">;</span>&nbsp;<span class="ident" id="6508593">i</span><span class="op" id="6508594">++</span>&nbsp;<span class="op" id="6508597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6508601">_</span><span class="op" id="6508602">,</span>&nbsp;<span class="ident" id="6508604">err</span>&nbsp;<span class="op" id="6508608">:=</span>&nbsp;<span class="ident" id="6508611">f</span><span class="op" id="6508612">.</span><span class="ident" id="6508613">Write</span><span class="op" id="6508618">(</span><span class="ident" id="6508619">chunk</span><span class="op" id="6508624">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6508628">if</span>&nbsp;<span class="ident" id="6508631">err</span>&nbsp;<span class="op" id="6508635">!=</span>&nbsp;<span class="ident" id="6508638">nil</span>&nbsp;<span class="op" id="6508642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6508647">t</span><span class="op" id="6508648">.</span><span class="ident" id="6508649">Fatal</span><span class="op" id="6508654">(</span><span class="string" id="6508655">&#34;write&nbsp;chunk:&#34;</span><span class="op" id="6508669">,</span>&nbsp;<span class="ident" id="6508671">err</span><span class="op" id="6508674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6508678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6508681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6508684">end</span>&nbsp;<span class="op" id="6508688">:=</span>&nbsp;<span class="op" id="6508691">[</span><span class="op" id="6508692">]</span><span class="builtintype" id="6508693">byte</span><span class="op" id="6508697">(</span><span class="string" id="6508698">&#34;END\n&#34;</span><span class="op" id="6508705">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6508708">_</span><span class="op" id="6508709">,</span>&nbsp;<span class="ident" id="6508711">err</span>&nbsp;<span class="op" id="6508715">=</span>&nbsp;<span class="ident" id="6508717">f</span><span class="op" id="6508718">.</span><span class="ident" id="6508719">Write</span><span class="op" id="6508724">(</span><span class="ident" id="6508725">end</span><span class="op" id="6508728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6508731">if</span>&nbsp;<span class="ident" id="6508734">err</span>&nbsp;<span class="op" id="6508738">!=</span>&nbsp;<span class="ident" id="6508741">nil</span>&nbsp;<span class="op" id="6508745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6508749">t</span><span class="op" id="6508750">.</span><span class="ident" id="6508751">Fatal</span><span class="op" id="6508756">(</span><span class="string" id="6508757">&#34;write&nbsp;end:&#34;</span><span class="op" id="6508769">,</span>&nbsp;<span class="ident" id="6508771">err</span><span class="op" id="6508774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6508777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6508780">if</span>&nbsp;<span class="ident" id="6508783">err</span>&nbsp;<span class="op" id="6508787">:=</span>&nbsp;<span class="ident" id="6508790">w</span><span class="op" id="6508791">.</span><span class="ident" id="6508792">Close</span><span class="op" id="6508797">(</span><span class="op" id="6508798">)</span><span class="op" id="6508799">;</span>&nbsp;<span class="ident" id="6508801">err</span>&nbsp;<span class="op" id="6508805">!=</span>&nbsp;<span class="ident" id="6508808">nil</span>&nbsp;<span class="op" id="6508812">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6508816">t</span><span class="op" id="6508817">.</span><span class="ident" id="6508818">Fatal</span><span class="op" id="6508823">(</span><span class="ident" id="6508824">err</span><span class="op" id="6508827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6508830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6508834">//&nbsp;read&nbsp;back&nbsp;zip&nbsp;file&nbsp;and&nbsp;check&nbsp;that&nbsp;we&nbsp;get&nbsp;to&nbsp;the&nbsp;end&nbsp;of&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6508896">r</span><span class="op" id="6508897">,</span>&nbsp;<span class="ident" id="6508899">err</span>&nbsp;<span class="op" id="6508903">:=</span>&nbsp;<span class="ident" id="6508906">NewReader</span><span class="op" id="6508915">(</span><span class="ident" id="6508916">buf</span><span class="op" id="6508919">,</span>&nbsp;<span class="ident" id="6508921">int64</span><span class="op" id="6508926">(</span><span class="ident" id="6508927">buf</span><span class="op" id="6508930">.</span><span class="ident" id="6508931">Size</span><span class="op" id="6508935">(</span><span class="op" id="6508936">)</span><span class="op" id="6508937">)</span><span class="op" id="6508938">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6508941">if</span>&nbsp;<span class="ident" id="6508944">err</span>&nbsp;<span class="op" id="6508948">!=</span>&nbsp;<span class="ident" id="6508951">nil</span>&nbsp;<span class="op" id="6508955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6508959">t</span><span class="op" id="6508960">.</span><span class="ident" id="6508961">Fatal</span><span class="op" id="6508966">(</span><span class="string" id="6508967">&#34;reader:&#34;</span><span class="op" id="6508976">,</span>&nbsp;<span class="ident" id="6508978">err</span><span class="op" id="6508981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6508984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6508987">f0</span>&nbsp;<span class="op" id="6508990">:=</span>&nbsp;<span class="ident" id="6508993">r</span><span class="op" id="6508994">.</span><span class="ident" id="6508995">File</span><span class="op" id="6508999">[</span><span class="num" id="6509000">0</span><span class="op" id="6509001">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6509004">rc</span><span class="op" id="6509006">,</span>&nbsp;<span class="ident" id="6509008">err</span>&nbsp;<span class="op" id="6509012">:=</span>&nbsp;<span class="ident" id="6509015">f0</span><span class="op" id="6509017">.</span><span class="ident" id="6509018">Open</span><span class="op" id="6509022">(</span><span class="op" id="6509023">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6509026">if</span>&nbsp;<span class="ident" id="6509029">err</span>&nbsp;<span class="op" id="6509033">!=</span>&nbsp;<span class="ident" id="6509036">nil</span>&nbsp;<span class="op" id="6509040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6509044">t</span><span class="op" id="6509045">.</span><span class="ident" id="6509046">Fatal</span><span class="op" id="6509051">(</span><span class="string" id="6509052">&#34;opening:&#34;</span><span class="op" id="6509062">,</span>&nbsp;<span class="ident" id="6509064">err</span><span class="op" id="6509067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6509070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6509073">rc</span><span class="op" id="6509075">.</span><span class="op" id="6509076">(</span><span class="op" id="6509077">*</span><span class="ident" id="6509078">checksumReader</span><span class="op" id="6509092">)</span><span class="op" id="6509093">.</span><span class="ident" id="6509094">hash</span>&nbsp;<span class="op" id="6509099">=</span>&nbsp;<span class="ident" id="6509101">fakeHash32</span><span class="op" id="6509111">{</span><span class="op" id="6509112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6509115">for</span>&nbsp;<span class="ident" id="6509119">i</span>&nbsp;<span class="op" id="6509121">:=</span>&nbsp;<span class="num" id="6509124">0</span><span class="op" id="6509125">;</span>&nbsp;<span class="ident" id="6509127">i</span>&nbsp;<span class="op" id="6509129">&lt;</span>&nbsp;<span class="ident" id="6509131">chunks</span><span class="op" id="6509137">;</span>&nbsp;<span class="ident" id="6509139">i</span><span class="op" id="6509140">++</span>&nbsp;<span class="op" id="6509143">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6509147">_</span><span class="op" id="6509148">,</span>&nbsp;<span class="ident" id="6509150">err</span>&nbsp;<span class="op" id="6509154">:=</span>&nbsp;<span class="ident" id="6509157">io</span><span class="op" id="6509159">.</span><span class="ident" id="6509160">ReadFull</span><span class="op" id="6509168">(</span><span class="ident" id="6509169">rc</span><span class="op" id="6509171">,</span>&nbsp;<span class="ident" id="6509173">chunk</span><span class="op" id="6509178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6509182">if</span>&nbsp;<span class="ident" id="6509185">err</span>&nbsp;<span class="op" id="6509189">!=</span>&nbsp;<span class="ident" id="6509192">nil</span>&nbsp;<span class="op" id="6509196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6509201">t</span><span class="op" id="6509202">.</span><span class="ident" id="6509203">Fatal</span><span class="op" id="6509208">(</span><span class="string" id="6509209">&#34;read:&#34;</span><span class="op" id="6509216">,</span>&nbsp;<span class="ident" id="6509218">err</span><span class="op" id="6509221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6509225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6509228">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6509231">gotEnd</span><span class="op" id="6509237">,</span>&nbsp;<span class="ident" id="6509239">err</span>&nbsp;<span class="op" id="6509243">:=</span>&nbsp;<span class="ident" id="6509246">ioutil</span><span class="op" id="6509252">.</span><span class="ident" id="6509253">ReadAll</span><span class="op" id="6509260">(</span><span class="ident" id="6509261">rc</span><span class="op" id="6509263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6509266">if</span>&nbsp;<span class="ident" id="6509269">err</span>&nbsp;<span class="op" id="6509273">!=</span>&nbsp;<span class="ident" id="6509276">nil</span>&nbsp;<span class="op" id="6509280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6509284">t</span><span class="op" id="6509285">.</span><span class="ident" id="6509286">Fatal</span><span class="op" id="6509291">(</span><span class="string" id="6509292">&#34;read&nbsp;end:&#34;</span><span class="op" id="6509303">,</span>&nbsp;<span class="ident" id="6509305">err</span><span class="op" id="6509308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6509311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6509314">if</span>&nbsp;<span class="op" id="6509317">!</span><span class="ident" id="6509318">bytes</span><span class="op" id="6509323">.</span><span class="ident" id="6509324">Equal</span><span class="op" id="6509329">(</span><span class="ident" id="6509330">gotEnd</span><span class="op" id="6509336">,</span>&nbsp;<span class="ident" id="6509338">end</span><span class="op" id="6509341">)</span>&nbsp;<span class="op" id="6509343">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6509347">t</span><span class="op" id="6509348">.</span><span class="ident" id="6509349">Errorf</span><span class="op" id="6509355">(</span><span class="string" id="6509356">&#34;End&nbsp;of&nbsp;zip64&nbsp;archive&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6509390">,</span>&nbsp;<span class="ident" id="6509392">gotEnd</span><span class="op" id="6509398">,</span>&nbsp;<span class="ident" id="6509400">end</span><span class="op" id="6509403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6509406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6509409">err</span>&nbsp;<span class="op" id="6509413">=</span>&nbsp;<span class="ident" id="6509415">rc</span><span class="op" id="6509417">.</span><span class="ident" id="6509418">Close</span><span class="op" id="6509423">(</span><span class="op" id="6509424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6509427">if</span>&nbsp;<span class="ident" id="6509430">err</span>&nbsp;<span class="op" id="6509434">!=</span>&nbsp;<span class="ident" id="6509437">nil</span>&nbsp;<span class="op" id="6509441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6509445">t</span><span class="op" id="6509446">.</span><span class="ident" id="6509447">Fatal</span><span class="op" id="6509452">(</span><span class="string" id="6509453">&#34;closing:&#34;</span><span class="op" id="6509463">,</span>&nbsp;<span class="ident" id="6509465">err</span><span class="op" id="6509468">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6509471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6509474">if</span>&nbsp;<span class="ident" id="6509477">size</span>&nbsp;<span class="op" id="6509482">==</span>&nbsp;<span class="num" id="6509485">1</span><span class="op" id="6509486">&lt;&lt;</span><span class="num" id="6509488">32</span>&nbsp;<span class="op" id="6509491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6509495">if</span>&nbsp;<span class="ident" id="6509498">got</span><span class="op" id="6509501">,</span>&nbsp;<span class="ident" id="6509503">want</span>&nbsp;<span class="op" id="6509508">:=</span>&nbsp;<span class="ident" id="6509511">f0</span><span class="op" id="6509513">.</span><span class="ident" id="6509514">UncompressedSize</span><span class="op" id="6509530">,</span>&nbsp;<span class="builtintype" id="6509532">uint32</span><span class="op" id="6509538">(</span><span class="ident" id="6509539">uint32max</span><span class="op" id="6509548">)</span><span class="op" id="6509549">;</span>&nbsp;<span class="ident" id="6509551">got</span>&nbsp;<span class="op" id="6509555">!=</span>&nbsp;<span class="ident" id="6509558">want</span>&nbsp;<span class="op" id="6509563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6509568">t</span><span class="op" id="6509569">.</span><span class="ident" id="6509570">Errorf</span><span class="op" id="6509576">(</span><span class="string" id="6509577">&#34;UncompressedSize&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="6509607">,</span>&nbsp;<span class="ident" id="6509609">got</span><span class="op" id="6509612">,</span>&nbsp;<span class="ident" id="6509614">want</span><span class="op" id="6509618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6509622">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6509625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6509629">if</span>&nbsp;<span class="ident" id="6509632">got</span><span class="op" id="6509635">,</span>&nbsp;<span class="ident" id="6509637">want</span>&nbsp;<span class="op" id="6509642">:=</span>&nbsp;<span class="ident" id="6509645">f0</span><span class="op" id="6509647">.</span><span class="ident" id="6509648">UncompressedSize64</span><span class="op" id="6509666">,</span>&nbsp;<span class="ident" id="6509668">uint64</span><span class="op" id="6509674">(</span><span class="ident" id="6509675">size</span><span class="op" id="6509679">)</span><span class="op" id="6509680">+</span><span class="ident" id="6509681">uint64</span><span class="op" id="6509687">(</span><span class="builtinfunc" id="6509688">len</span><span class="op" id="6509691">(</span><span class="ident" id="6509692">end</span><span class="op" id="6509695">)</span><span class="op" id="6509696">)</span><span class="op" id="6509697">;</span>&nbsp;<span class="ident" id="6509699">got</span>&nbsp;<span class="op" id="6509703">!=</span>&nbsp;<span class="ident" id="6509706">want</span>&nbsp;<span class="op" id="6509711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6509715">t</span><span class="op" id="6509716">.</span><span class="ident" id="6509717">Errorf</span><span class="op" id="6509723">(</span><span class="string" id="6509724">&#34;UncompressedSize64&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="6509756">,</span>&nbsp;<span class="ident" id="6509758">got</span><span class="op" id="6509761">,</span>&nbsp;<span class="ident" id="6509763">want</span><span class="op" id="6509767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6509770">}</span><br>
<span class="lineno">305</span><span class="op" id="6509772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6509775">func</span>&nbsp;<span class="ident" id="6509780">testInvalidHeader</span><span class="op" id="6509797">(</span><span class="ident" id="6509798">h</span>&nbsp;<span class="op" id="6509800">*</span><span class="ident" id="6509801">FileHeader</span><span class="op" id="6509811">,</span>&nbsp;<span class="ident" id="6509813">t</span>&nbsp;<span class="op" id="6509815">*</span><span class="ident" id="6509816">testing</span><span class="op" id="6509823">.</span><span class="ident" id="6509824">T</span><span class="op" id="6509825">)</span>&nbsp;<span class="op" id="6509827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6509830">var</span>&nbsp;<span class="ident" id="6509834">buf</span>&nbsp;<span class="ident" id="6509838">bytes</span><span class="op" id="6509843">.</span><span class="ident" id="6509844">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6509852">z</span>&nbsp;<span class="op" id="6509854">:=</span>&nbsp;<span class="ident" id="6509857">NewWriter</span><span class="op" id="6509866">(</span><span class="op" id="6509867">&amp;</span><span class="ident" id="6509868">buf</span><span class="op" id="6509871">)</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6509875">f</span><span class="op" id="6509876">,</span>&nbsp;<span class="ident" id="6509878">err</span>&nbsp;<span class="op" id="6509882">:=</span>&nbsp;<span class="ident" id="6509885">z</span><span class="op" id="6509886">.</span><span class="ident" id="6509887">CreateHeader</span><span class="op" id="6509899">(</span><span class="ident" id="6509900">h</span><span class="op" id="6509901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6509904">if</span>&nbsp;<span class="ident" id="6509907">err</span>&nbsp;<span class="op" id="6509911">!=</span>&nbsp;<span class="ident" id="6509914">nil</span>&nbsp;<span class="op" id="6509918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6509922">t</span><span class="op" id="6509923">.</span><span class="ident" id="6509924">Fatalf</span><span class="op" id="6509930">(</span><span class="string" id="6509931">&#34;error&nbsp;creating&nbsp;header:&nbsp;%v&#34;</span><span class="op" id="6509958">,</span>&nbsp;<span class="ident" id="6509960">err</span><span class="op" id="6509963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6509966">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6509969">if</span>&nbsp;<span class="ident" id="6509972">_</span><span class="op" id="6509973">,</span>&nbsp;<span class="ident" id="6509975">err</span>&nbsp;<span class="op" id="6509979">:=</span>&nbsp;<span class="ident" id="6509982">f</span><span class="op" id="6509983">.</span><span class="ident" id="6509984">Write</span><span class="op" id="6509989">(</span><span class="op" id="6509990">[</span><span class="op" id="6509991">]</span><span class="builtintype" id="6509992">byte</span><span class="op" id="6509996">(</span><span class="string" id="6509997">&#34;hi&#34;</span><span class="op" id="6510001">)</span><span class="op" id="6510002">)</span><span class="op" id="6510003">;</span>&nbsp;<span class="ident" id="6510005">err</span>&nbsp;<span class="op" id="6510009">!=</span>&nbsp;<span class="ident" id="6510012">nil</span>&nbsp;<span class="op" id="6510016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6510020">t</span><span class="op" id="6510021">.</span><span class="ident" id="6510022">Fatalf</span><span class="op" id="6510028">(</span><span class="string" id="6510029">&#34;error&nbsp;writing&nbsp;content:&nbsp;%v&#34;</span><span class="op" id="6510056">,</span>&nbsp;<span class="ident" id="6510058">err</span><span class="op" id="6510061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6510064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6510067">if</span>&nbsp;<span class="ident" id="6510070">err</span>&nbsp;<span class="op" id="6510074">:=</span>&nbsp;<span class="ident" id="6510077">z</span><span class="op" id="6510078">.</span><span class="ident" id="6510079">Close</span><span class="op" id="6510084">(</span><span class="op" id="6510085">)</span><span class="op" id="6510086">;</span>&nbsp;<span class="ident" id="6510088">err</span>&nbsp;<span class="op" id="6510092">!=</span>&nbsp;<span class="ident" id="6510095">nil</span>&nbsp;<span class="op" id="6510099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6510103">t</span><span class="op" id="6510104">.</span><span class="ident" id="6510105">Fatalf</span><span class="op" id="6510111">(</span><span class="string" id="6510112">&#34;error&nbsp;closing&nbsp;zip&nbsp;writer:&nbsp;%v&#34;</span><span class="op" id="6510142">,</span>&nbsp;<span class="ident" id="6510144">err</span><span class="op" id="6510147">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6510150">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6510154">b</span>&nbsp;<span class="op" id="6510156">:=</span>&nbsp;<span class="ident" id="6510159">buf</span><span class="op" id="6510162">.</span><span class="ident" id="6510163">Bytes</span><span class="op" id="6510168">(</span><span class="op" id="6510169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6510172">if</span>&nbsp;<span class="ident" id="6510175">_</span><span class="op" id="6510176">,</span>&nbsp;<span class="ident" id="6510178">err</span>&nbsp;<span class="op" id="6510182">=</span>&nbsp;<span class="ident" id="6510184">NewReader</span><span class="op" id="6510193">(</span><span class="ident" id="6510194">bytes</span><span class="op" id="6510199">.</span><span class="ident" id="6510200">NewReader</span><span class="op" id="6510209">(</span><span class="ident" id="6510210">b</span><span class="op" id="6510211">)</span><span class="op" id="6510212">,</span>&nbsp;<span class="ident" id="6510214">int64</span><span class="op" id="6510219">(</span><span class="builtinfunc" id="6510220">len</span><span class="op" id="6510223">(</span><span class="ident" id="6510224">b</span><span class="op" id="6510225">)</span><span class="op" id="6510226">)</span><span class="op" id="6510227">)</span><span class="op" id="6510228">;</span>&nbsp;<span class="ident" id="6510230">err</span>&nbsp;<span class="op" id="6510234">!=</span>&nbsp;<span class="ident" id="6510237">ErrFormat</span>&nbsp;<span class="op" id="6510247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6510251">t</span><span class="op" id="6510252">.</span><span class="ident" id="6510253">Fatalf</span><span class="op" id="6510259">(</span><span class="string" id="6510260">&#34;got&nbsp;%v,&nbsp;expected&nbsp;ErrFormat&#34;</span><span class="op" id="6510288">,</span>&nbsp;<span class="ident" id="6510290">err</span><span class="op" id="6510293">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6510296">}</span><br>
<span class="lineno"></span><span class="op" id="6510298">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6510301">func</span>&nbsp;<span class="ident" id="6510306">testValidHeader</span><span class="op" id="6510321">(</span><span class="ident" id="6510322">h</span>&nbsp;<span class="op" id="6510324">*</span><span class="ident" id="6510325">FileHeader</span><span class="op" id="6510335">,</span>&nbsp;<span class="ident" id="6510337">t</span>&nbsp;<span class="op" id="6510339">*</span><span class="ident" id="6510340">testing</span><span class="op" id="6510347">.</span><span class="ident" id="6510348">T</span><span class="op" id="6510349">)</span>&nbsp;<span class="op" id="6510351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6510354">var</span>&nbsp;<span class="ident" id="6510358">buf</span>&nbsp;<span class="ident" id="6510362">bytes</span><span class="op" id="6510367">.</span><span class="ident" id="6510368">Buffer</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6510376">z</span>&nbsp;<span class="op" id="6510378">:=</span>&nbsp;<span class="ident" id="6510381">NewWriter</span><span class="op" id="6510390">(</span><span class="op" id="6510391">&amp;</span><span class="ident" id="6510392">buf</span><span class="op" id="6510395">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6510399">f</span><span class="op" id="6510400">,</span>&nbsp;<span class="ident" id="6510402">err</span>&nbsp;<span class="op" id="6510406">:=</span>&nbsp;<span class="ident" id="6510409">z</span><span class="op" id="6510410">.</span><span class="ident" id="6510411">CreateHeader</span><span class="op" id="6510423">(</span><span class="ident" id="6510424">h</span><span class="op" id="6510425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6510428">if</span>&nbsp;<span class="ident" id="6510431">err</span>&nbsp;<span class="op" id="6510435">!=</span>&nbsp;<span class="ident" id="6510438">nil</span>&nbsp;<span class="op" id="6510442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6510446">t</span><span class="op" id="6510447">.</span><span class="ident" id="6510448">Fatalf</span><span class="op" id="6510454">(</span><span class="string" id="6510455">&#34;error&nbsp;creating&nbsp;header:&nbsp;%v&#34;</span><span class="op" id="6510482">,</span>&nbsp;<span class="ident" id="6510484">err</span><span class="op" id="6510487">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6510490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6510493">if</span>&nbsp;<span class="ident" id="6510496">_</span><span class="op" id="6510497">,</span>&nbsp;<span class="ident" id="6510499">err</span>&nbsp;<span class="op" id="6510503">:=</span>&nbsp;<span class="ident" id="6510506">f</span><span class="op" id="6510507">.</span><span class="ident" id="6510508">Write</span><span class="op" id="6510513">(</span><span class="op" id="6510514">[</span><span class="op" id="6510515">]</span><span class="builtintype" id="6510516">byte</span><span class="op" id="6510520">(</span><span class="string" id="6510521">&#34;hi&#34;</span><span class="op" id="6510525">)</span><span class="op" id="6510526">)</span><span class="op" id="6510527">;</span>&nbsp;<span class="ident" id="6510529">err</span>&nbsp;<span class="op" id="6510533">!=</span>&nbsp;<span class="ident" id="6510536">nil</span>&nbsp;<span class="op" id="6510540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6510544">t</span><span class="op" id="6510545">.</span><span class="ident" id="6510546">Fatalf</span><span class="op" id="6510552">(</span><span class="string" id="6510553">&#34;error&nbsp;writing&nbsp;content:&nbsp;%v&#34;</span><span class="op" id="6510580">,</span>&nbsp;<span class="ident" id="6510582">err</span><span class="op" id="6510585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6510588">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6510591">if</span>&nbsp;<span class="ident" id="6510594">err</span>&nbsp;<span class="op" id="6510598">:=</span>&nbsp;<span class="ident" id="6510601">z</span><span class="op" id="6510602">.</span><span class="ident" id="6510603">Close</span><span class="op" id="6510608">(</span><span class="op" id="6510609">)</span><span class="op" id="6510610">;</span>&nbsp;<span class="ident" id="6510612">err</span>&nbsp;<span class="op" id="6510616">!=</span>&nbsp;<span class="ident" id="6510619">nil</span>&nbsp;<span class="op" id="6510623">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6510627">t</span><span class="op" id="6510628">.</span><span class="ident" id="6510629">Fatalf</span><span class="op" id="6510635">(</span><span class="string" id="6510636">&#34;error&nbsp;closing&nbsp;zip&nbsp;writer:&nbsp;%v&#34;</span><span class="op" id="6510666">,</span>&nbsp;<span class="ident" id="6510668">err</span><span class="op" id="6510671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6510674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6510678">b</span>&nbsp;<span class="op" id="6510680">:=</span>&nbsp;<span class="ident" id="6510683">buf</span><span class="op" id="6510686">.</span><span class="ident" id="6510687">Bytes</span><span class="op" id="6510692">(</span><span class="op" id="6510693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6510696">if</span>&nbsp;<span class="ident" id="6510699">_</span><span class="op" id="6510700">,</span>&nbsp;<span class="ident" id="6510702">err</span>&nbsp;<span class="op" id="6510706">=</span>&nbsp;<span class="ident" id="6510708">NewReader</span><span class="op" id="6510717">(</span><span class="ident" id="6510718">bytes</span><span class="op" id="6510723">.</span><span class="ident" id="6510724">NewReader</span><span class="op" id="6510733">(</span><span class="ident" id="6510734">b</span><span class="op" id="6510735">)</span><span class="op" id="6510736">,</span>&nbsp;<span class="ident" id="6510738">int64</span><span class="op" id="6510743">(</span><span class="builtinfunc" id="6510744">len</span><span class="op" id="6510747">(</span><span class="ident" id="6510748">b</span><span class="op" id="6510749">)</span><span class="op" id="6510750">)</span><span class="op" id="6510751">)</span><span class="op" id="6510752">;</span>&nbsp;<span class="ident" id="6510754">err</span>&nbsp;<span class="op" id="6510758">!=</span>&nbsp;<span class="ident" id="6510761">nil</span>&nbsp;<span class="op" id="6510765">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6510769">t</span><span class="op" id="6510770">.</span><span class="ident" id="6510771">Fatalf</span><span class="op" id="6510777">(</span><span class="string" id="6510778">&#34;got&nbsp;%v,&nbsp;expected&nbsp;nil&#34;</span><span class="op" id="6510800">,</span>&nbsp;<span class="ident" id="6510802">err</span><span class="op" id="6510805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6510808">}</span><br>
<span class="lineno"></span><span class="op" id="6510810">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6510813">//&nbsp;Issue&nbsp;4302.</span><br>
<span class="lineno">350</span><span class="keyword" id="6510828">func</span>&nbsp;<span class="ident" id="6510833">TestHeaderInvalidTagAndSize</span><span class="op" id="6510860">(</span><span class="ident" id="6510861">t</span>&nbsp;<span class="op" id="6510863">*</span><span class="ident" id="6510864">testing</span><span class="op" id="6510871">.</span><span class="ident" id="6510872">T</span><span class="op" id="6510873">)</span>&nbsp;<span class="op" id="6510875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6510878">const</span>&nbsp;<span class="ident" id="6510884">timeFormat</span>&nbsp;<span class="op" id="6510895">=</span>&nbsp;<span class="string" id="6510897">&#34;20060102T150405.000.txt&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6510925">ts</span>&nbsp;<span class="op" id="6510928">:=</span>&nbsp;<span class="ident" id="6510931">time</span><span class="op" id="6510935">.</span><span class="ident" id="6510936">Now</span><span class="op" id="6510939">(</span><span class="op" id="6510940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6510943">filename</span>&nbsp;<span class="op" id="6510952">:=</span>&nbsp;<span class="ident" id="6510955">ts</span><span class="op" id="6510957">.</span><span class="ident" id="6510958">Format</span><span class="op" id="6510964">(</span><span class="ident" id="6510965">timeFormat</span><span class="op" id="6510975">)</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6510979">h</span>&nbsp;<span class="op" id="6510981">:=</span>&nbsp;<span class="ident" id="6510984">FileHeader</span><span class="op" id="6510994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6510998">Name</span><span class="op" id="6511002">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6511006">filename</span><span class="op" id="6511014">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6511018">Method</span><span class="op" id="6511024">:</span>&nbsp;<span class="ident" id="6511026">Deflate</span><span class="op" id="6511033">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6511037">Extra</span><span class="op" id="6511042">:</span>&nbsp;&nbsp;<span class="op" id="6511045">[</span><span class="op" id="6511046">]</span><span class="builtintype" id="6511047">byte</span><span class="op" id="6511051">(</span><span class="ident" id="6511052">ts</span><span class="op" id="6511054">.</span><span class="ident" id="6511055">Format</span><span class="op" id="6511061">(</span><span class="ident" id="6511062">time</span><span class="op" id="6511066">.</span><span class="ident" id="6511067">RFC3339Nano</span><span class="op" id="6511078">)</span><span class="op" id="6511079">)</span><span class="op" id="6511080">,</span>&nbsp;<span class="comment" id="6511082">//&nbsp;missing&nbsp;tag&nbsp;and&nbsp;len</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6511106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6511109">h</span><span class="op" id="6511110">.</span><span class="ident" id="6511111">SetModTime</span><span class="op" id="6511121">(</span><span class="ident" id="6511122">ts</span><span class="op" id="6511124">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6511128">testInvalidHeader</span><span class="op" id="6511145">(</span><span class="op" id="6511146">&amp;</span><span class="ident" id="6511147">h</span><span class="op" id="6511148">,</span>&nbsp;<span class="ident" id="6511150">t</span><span class="op" id="6511151">)</span><br>
<span class="lineno"></span><span class="op" id="6511153">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="6511156">func</span>&nbsp;<span class="ident" id="6511161">TestHeaderTooShort</span><span class="op" id="6511179">(</span><span class="ident" id="6511180">t</span>&nbsp;<span class="op" id="6511182">*</span><span class="ident" id="6511183">testing</span><span class="op" id="6511190">.</span><span class="ident" id="6511191">T</span><span class="op" id="6511192">)</span>&nbsp;<span class="op" id="6511194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6511197">h</span>&nbsp;<span class="op" id="6511199">:=</span>&nbsp;<span class="ident" id="6511202">FileHeader</span><span class="op" id="6511212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6511216">Name</span><span class="op" id="6511220">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6511224">&#34;foo.txt&#34;</span><span class="op" id="6511233">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6511237">Method</span><span class="op" id="6511243">:</span>&nbsp;<span class="ident" id="6511245">Deflate</span><span class="op" id="6511252">,</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6511256">Extra</span><span class="op" id="6511261">:</span>&nbsp;&nbsp;<span class="op" id="6511264">[</span><span class="op" id="6511265">]</span><span class="builtintype" id="6511266">byte</span><span class="op" id="6511270">{</span><span class="ident" id="6511271">zip64ExtraId</span><span class="op" id="6511283">}</span><span class="op" id="6511284">,</span>&nbsp;<span class="comment" id="6511286">//&nbsp;missing&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6511303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6511306">testInvalidHeader</span><span class="op" id="6511323">(</span><span class="op" id="6511324">&amp;</span><span class="ident" id="6511325">h</span><span class="op" id="6511326">,</span>&nbsp;<span class="ident" id="6511328">t</span><span class="op" id="6511329">)</span><br>
<span class="lineno"></span><span class="op" id="6511331">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span><span class="comment" id="6511334">//&nbsp;Issue&nbsp;4393.&nbsp;It&nbsp;is&nbsp;valid&nbsp;to&nbsp;have&nbsp;an&nbsp;extra&nbsp;data&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="6511390">//&nbsp;which&nbsp;contains&nbsp;no&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="6511417">func</span>&nbsp;<span class="ident" id="6511422">TestZeroLengthHeader</span><span class="op" id="6511442">(</span><span class="ident" id="6511443">t</span>&nbsp;<span class="op" id="6511445">*</span><span class="ident" id="6511446">testing</span><span class="op" id="6511453">.</span><span class="ident" id="6511454">T</span><span class="op" id="6511455">)</span>&nbsp;<span class="op" id="6511457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6511460">h</span>&nbsp;<span class="op" id="6511462">:=</span>&nbsp;<span class="ident" id="6511465">FileHeader</span><span class="op" id="6511475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6511479">Name</span><span class="op" id="6511483">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6511487">&#34;extadata.txt&#34;</span><span class="op" id="6511501">,</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6511505">Method</span><span class="op" id="6511511">:</span>&nbsp;<span class="ident" id="6511513">Deflate</span><span class="op" id="6511520">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6511524">Extra</span><span class="op" id="6511529">:</span>&nbsp;<span class="op" id="6511531">[</span><span class="op" id="6511532">]</span><span class="builtintype" id="6511533">byte</span><span class="op" id="6511537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6511542">85</span><span class="op" id="6511544">,</span>&nbsp;<span class="num" id="6511546">84</span><span class="op" id="6511548">,</span>&nbsp;<span class="num" id="6511550">5</span><span class="op" id="6511551">,</span>&nbsp;<span class="num" id="6511553">0</span><span class="op" id="6511554">,</span>&nbsp;<span class="num" id="6511556">3</span><span class="op" id="6511557">,</span>&nbsp;<span class="num" id="6511559">154</span><span class="op" id="6511562">,</span>&nbsp;<span class="num" id="6511564">144</span><span class="op" id="6511567">,</span>&nbsp;<span class="num" id="6511569">195</span><span class="op" id="6511572">,</span>&nbsp;<span class="num" id="6511574">77</span><span class="op" id="6511576">,</span>&nbsp;<span class="comment" id="6511578">//&nbsp;tag&nbsp;21589&nbsp;size&nbsp;5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6511601">85</span><span class="op" id="6511603">,</span>&nbsp;<span class="num" id="6511605">120</span><span class="op" id="6511608">,</span>&nbsp;<span class="num" id="6511610">0</span><span class="op" id="6511611">,</span>&nbsp;<span class="num" id="6511613">0</span><span class="op" id="6511614">,</span>&nbsp;<span class="comment" id="6511616">//&nbsp;tag&nbsp;30805&nbsp;size&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6511638">}</span><span class="op" id="6511639">,</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6511642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6511645">testValidHeader</span><span class="op" id="6511660">(</span><span class="op" id="6511661">&amp;</span><span class="ident" id="6511662">h</span><span class="op" id="6511663">,</span>&nbsp;<span class="ident" id="6511665">t</span><span class="op" id="6511666">)</span><br>
<span class="lineno"></span><span class="op" id="6511668">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6511671">//&nbsp;Just&nbsp;benchmarking&nbsp;how&nbsp;fast&nbsp;the&nbsp;Zip64&nbsp;test&nbsp;above&nbsp;is.&nbsp;Not&nbsp;related&nbsp;to</span><br>
<span class="lineno">390</span><span class="comment" id="6511741">//&nbsp;our&nbsp;zip&nbsp;performance,&nbsp;since&nbsp;the&nbsp;test&nbsp;above&nbsp;disabled&nbsp;CRC32&nbsp;and&nbsp;flate.</span><br>
<span class="lineno"></span><span class="keyword" id="6511812">func</span>&nbsp;<span class="ident" id="6511817">BenchmarkZip64Test</span><span class="op" id="6511835">(</span><span class="ident" id="6511836">b</span>&nbsp;<span class="op" id="6511838">*</span><span class="ident" id="6511839">testing</span><span class="op" id="6511846">.</span><span class="ident" id="6511847">B</span><span class="op" id="6511848">)</span>&nbsp;<span class="op" id="6511850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6511853">for</span>&nbsp;<span class="ident" id="6511857">i</span>&nbsp;<span class="op" id="6511859">:=</span>&nbsp;<span class="num" id="6511862">0</span><span class="op" id="6511863">;</span>&nbsp;<span class="ident" id="6511865">i</span>&nbsp;<span class="op" id="6511867">&lt;</span>&nbsp;<span class="ident" id="6511869">b</span><span class="op" id="6511870">.</span><span class="ident" id="6511871">N</span><span class="op" id="6511872">;</span>&nbsp;<span class="ident" id="6511874">i</span><span class="op" id="6511875">++</span>&nbsp;<span class="op" id="6511878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6511882">testZip64</span><span class="op" id="6511891">(</span><span class="ident" id="6511892">b</span><span class="op" id="6511893">,</span>&nbsp;<span class="num" id="6511895">1</span><span class="op" id="6511896">&lt;&lt;</span><span class="num" id="6511898">26</span><span class="op" id="6511900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6511903">}</span><br>
<span class="lineno">395</span><span class="op" id="6511905">}</span>
</div>
</body>
</html>
