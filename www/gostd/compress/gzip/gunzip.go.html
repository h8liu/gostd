<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/gzip</h2>
<ul>
<li><a href="/gostd/compress/gzip/gunzip.go.html" class="current">gunzip.go</a></li>
<li><a href="/gostd/compress/gzip/gunzip_test.go.html">gunzip_test.go</a></li>
<li><a href="/gostd/compress/gzip/gzip.go.html">gzip.go</a></li>
<li><a href="/gostd/compress/gzip/gzip_test.go.html">gzip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4095388">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4095443">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4095497">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4095548">//&nbsp;Package&nbsp;gzip&nbsp;implements&nbsp;reading&nbsp;and&nbsp;writing&nbsp;of&nbsp;gzip&nbsp;format&nbsp;compressed&nbsp;files,</span><br>
<span class="lineno"></span><span class="comment" id="4095628">//&nbsp;as&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;1952.</span><br>
<span class="lineno"></span><span class="keyword" id="4095657">package</span>&nbsp;<span class="ident" id="4095665">gzip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4095671">import</span>&nbsp;<span class="op" id="4095678">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4095681">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4095690">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4095708">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4095718">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4095726">&#34;hash/crc32&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4095740">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4095746">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="4095753">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4095756">const</span>&nbsp;<span class="op" id="4095762">(</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4095765">gzipID1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4095777">=</span>&nbsp;<span class="num" id="4095779">0x1f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4095785">gzipID2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4095797">=</span>&nbsp;<span class="num" id="4095799">0x8b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4095805">gzipDeflate</span>&nbsp;<span class="op" id="4095817">=</span>&nbsp;<span class="num" id="4095819">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4095822">flagText</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4095834">=</span>&nbsp;<span class="num" id="4095836">1</span>&nbsp;<span class="op" id="4095838">&lt;&lt;</span>&nbsp;<span class="num" id="4095841">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4095844">flagHdrCrc</span>&nbsp;&nbsp;<span class="op" id="4095856">=</span>&nbsp;<span class="num" id="4095858">1</span>&nbsp;<span class="op" id="4095860">&lt;&lt;</span>&nbsp;<span class="num" id="4095863">1</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4095866">flagExtra</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4095878">=</span>&nbsp;<span class="num" id="4095880">1</span>&nbsp;<span class="op" id="4095882">&lt;&lt;</span>&nbsp;<span class="num" id="4095885">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4095888">flagName</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4095900">=</span>&nbsp;<span class="num" id="4095902">1</span>&nbsp;<span class="op" id="4095904">&lt;&lt;</span>&nbsp;<span class="num" id="4095907">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4095910">flagComment</span>&nbsp;<span class="op" id="4095922">=</span>&nbsp;<span class="num" id="4095924">1</span>&nbsp;<span class="op" id="4095926">&lt;&lt;</span>&nbsp;<span class="num" id="4095929">4</span><br>
<span class="lineno"></span><span class="op" id="4095931">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="4095934">func</span>&nbsp;<span class="ident" id="4095939">makeReader</span><span class="op" id="4095949">(</span><span class="ident" id="4095950">r</span>&nbsp;<span class="ident" id="4095952">io</span><span class="op" id="4095954">.</span><span class="ident" id="4095955">Reader</span><span class="op" id="4095961">)</span>&nbsp;<span class="ident" id="4095963">flate</span><span class="op" id="4095968">.</span><span class="ident" id="4095969">Reader</span>&nbsp;<span class="op" id="4095976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4095979">if</span>&nbsp;<span class="ident" id="4095982">rr</span><span class="op" id="4095984">,</span>&nbsp;<span class="ident" id="4095986">ok</span>&nbsp;<span class="op" id="4095989">:=</span>&nbsp;<span class="ident" id="4095992">r</span><span class="op" id="4095993">.</span><span class="op" id="4095994">(</span><span class="ident" id="4095995">flate</span><span class="op" id="4096000">.</span><span class="ident" id="4096001">Reader</span><span class="op" id="4096007">)</span><span class="op" id="4096008">;</span>&nbsp;<span class="ident" id="4096010">ok</span>&nbsp;<span class="op" id="4096013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4096017">return</span>&nbsp;<span class="ident" id="4096024">rr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4096028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4096031">return</span>&nbsp;<span class="ident" id="4096038">bufio</span><span class="op" id="4096043">.</span><span class="ident" id="4096044">NewReader</span><span class="op" id="4096053">(</span><span class="ident" id="4096054">r</span><span class="op" id="4096055">)</span><br>
<span class="lineno">35</span><span class="op" id="4096057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4096060">var</span>&nbsp;<span class="op" id="4096064">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4096067">//&nbsp;ErrChecksum&nbsp;is&nbsp;returned&nbsp;when&nbsp;reading&nbsp;GZIP&nbsp;data&nbsp;that&nbsp;has&nbsp;an&nbsp;invalid&nbsp;checksum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4096148">ErrChecksum</span>&nbsp;<span class="op" id="4096160">=</span>&nbsp;<span class="ident" id="4096162">errors</span><span class="op" id="4096168">.</span><span class="ident" id="4096169">New</span><span class="op" id="4096172">(</span><span class="string" id="4096173">&#34;gzip:&nbsp;invalid&nbsp;checksum&#34;</span><span class="op" id="4096197">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4096200">//&nbsp;ErrHeader&nbsp;is&nbsp;returned&nbsp;when&nbsp;reading&nbsp;GZIP&nbsp;data&nbsp;that&nbsp;has&nbsp;an&nbsp;invalid&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4096277">ErrHeader</span>&nbsp;<span class="op" id="4096287">=</span>&nbsp;<span class="ident" id="4096289">errors</span><span class="op" id="4096295">.</span><span class="ident" id="4096296">New</span><span class="op" id="4096299">(</span><span class="string" id="4096300">&#34;gzip:&nbsp;invalid&nbsp;header&#34;</span><span class="op" id="4096322">)</span><br>
<span class="lineno"></span><span class="op" id="4096324">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4096327">//&nbsp;The&nbsp;gzip&nbsp;file&nbsp;stores&nbsp;a&nbsp;header&nbsp;giving&nbsp;metadata&nbsp;about&nbsp;the&nbsp;compressed&nbsp;file.</span><br>
<span class="lineno">45</span><span class="comment" id="4096403">//&nbsp;That&nbsp;header&nbsp;is&nbsp;exposed&nbsp;as&nbsp;the&nbsp;fields&nbsp;of&nbsp;the&nbsp;Writer&nbsp;and&nbsp;Reader&nbsp;structs.</span><br>
<span class="lineno"></span><span class="keyword" id="4096477">type</span>&nbsp;<span class="ident" id="4096482">Header</span>&nbsp;<span class="keyword" id="4096489">struct</span>&nbsp;<span class="op" id="4096496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4096499">Comment</span>&nbsp;<span class="builtintype" id="4096507">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4096517">//&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4096529">Extra</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4096537">[</span><span class="op" id="4096538">]</span><span class="builtintype" id="4096539">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4096547">//&nbsp;&#34;extra&nbsp;data&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4096564">ModTime</span>&nbsp;<span class="ident" id="4096572">time</span><span class="op" id="4096576">.</span><span class="ident" id="4096577">Time</span>&nbsp;<span class="comment" id="4096582">//&nbsp;modification&nbsp;time</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4096604">Name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4096612">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4096622">//&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4096636">OS</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4096644">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4096654">//&nbsp;operating&nbsp;system&nbsp;type</span><br>
<span class="lineno"></span><span class="op" id="4096679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4096682">//&nbsp;A&nbsp;Reader&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;that&nbsp;can&nbsp;be&nbsp;read&nbsp;to&nbsp;retrieve</span><br>
<span class="lineno">55</span><span class="comment" id="4096739">//&nbsp;uncompressed&nbsp;data&nbsp;from&nbsp;a&nbsp;gzip-format&nbsp;compressed&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="4096796">//</span><br>
<span class="lineno"></span><span class="comment" id="4096799">//&nbsp;In&nbsp;general,&nbsp;a&nbsp;gzip&nbsp;file&nbsp;can&nbsp;be&nbsp;a&nbsp;concatenation&nbsp;of&nbsp;gzip&nbsp;files,</span><br>
<span class="lineno"></span><span class="comment" id="4096864">//&nbsp;each&nbsp;with&nbsp;its&nbsp;own&nbsp;header.&nbsp;&nbsp;Reads&nbsp;from&nbsp;the&nbsp;Reader</span><br>
<span class="lineno"></span><span class="comment" id="4096916">//&nbsp;return&nbsp;the&nbsp;concatenation&nbsp;of&nbsp;the&nbsp;uncompressed&nbsp;data&nbsp;of&nbsp;each.</span><br>
<span class="lineno">60</span><span class="comment" id="4096978">//&nbsp;Only&nbsp;the&nbsp;first&nbsp;header&nbsp;is&nbsp;recorded&nbsp;in&nbsp;the&nbsp;Reader&nbsp;fields.</span><br>
<span class="lineno"></span><span class="comment" id="4097037">//</span><br>
<span class="lineno"></span><span class="comment" id="4097040">//&nbsp;Gzip&nbsp;files&nbsp;store&nbsp;a&nbsp;length&nbsp;and&nbsp;checksum&nbsp;of&nbsp;the&nbsp;uncompressed&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="4097108">//&nbsp;The&nbsp;Reader&nbsp;will&nbsp;return&nbsp;a&nbsp;ErrChecksum&nbsp;when&nbsp;Read</span><br>
<span class="lineno"></span><span class="comment" id="4097158">//&nbsp;reaches&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;uncompressed&nbsp;data&nbsp;if&nbsp;it&nbsp;does&nbsp;not</span><br>
<span class="lineno">65</span><span class="comment" id="4097217">//&nbsp;have&nbsp;the&nbsp;expected&nbsp;length&nbsp;or&nbsp;checksum.&nbsp;&nbsp;Clients&nbsp;should&nbsp;treat&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="4097285">//&nbsp;returned&nbsp;by&nbsp;Read&nbsp;as&nbsp;tentative&nbsp;until&nbsp;they&nbsp;receive&nbsp;the&nbsp;io.EOF</span><br>
<span class="lineno"></span><span class="comment" id="4097348">//&nbsp;marking&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="4097380">type</span>&nbsp;<span class="ident" id="4097385">Reader</span>&nbsp;<span class="keyword" id="4097392">struct</span>&nbsp;<span class="op" id="4097399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4097402">Header</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4097410">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4097423">flate</span><span class="op" id="4097428">.</span><span class="ident" id="4097429">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4097437">decompressor</span>&nbsp;<span class="ident" id="4097450">io</span><span class="op" id="4097452">.</span><span class="ident" id="4097453">ReadCloser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4097465">digest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4097478">hash</span><span class="op" id="4097482">.</span><span class="ident" id="4097483">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4097491">size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4097504">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4097512">flg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4097525">byte</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4097531">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4097544">[</span><span class="num" id="4097545">512</span><span class="op" id="4097548">]</span><span class="builtintype" id="4097549">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4097555">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4097568">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4097575">multistream</span>&nbsp;&nbsp;<span class="builtintype" id="4097588">bool</span><br>
<span class="lineno"></span><span class="op" id="4097593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="4097596">//&nbsp;NewReader&nbsp;creates&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;the&nbsp;given&nbsp;reader.</span><br>
<span class="lineno"></span><span class="comment" id="4097656">//&nbsp;If&nbsp;r&nbsp;does&nbsp;not&nbsp;also&nbsp;implement&nbsp;io.ByteReader,</span><br>
<span class="lineno"></span><span class="comment" id="4097703">//&nbsp;the&nbsp;decompressor&nbsp;may&nbsp;read&nbsp;more&nbsp;data&nbsp;than&nbsp;necessary&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="4097765">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;Reader&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span><span class="keyword" id="4097841">func</span>&nbsp;<span class="ident" id="4097846">NewReader</span><span class="op" id="4097855">(</span><span class="ident" id="4097856">r</span>&nbsp;<span class="ident" id="4097858">io</span><span class="op" id="4097860">.</span><span class="ident" id="4097861">Reader</span><span class="op" id="4097867">)</span>&nbsp;<span class="op" id="4097869">(</span><span class="op" id="4097870">*</span><span class="ident" id="4097871">Reader</span><span class="op" id="4097877">,</span>&nbsp;<span class="builtintype" id="4097879">error</span><span class="op" id="4097884">)</span>&nbsp;<span class="op" id="4097886">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4097889">z</span>&nbsp;<span class="op" id="4097891">:=</span>&nbsp;<span class="builtinfunc" id="4097894">new</span><span class="op" id="4097897">(</span><span class="ident" id="4097898">Reader</span><span class="op" id="4097904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4097907">z</span><span class="op" id="4097908">.</span><span class="ident" id="4097909">r</span>&nbsp;<span class="op" id="4097911">=</span>&nbsp;<span class="ident" id="4097913">makeReader</span><span class="op" id="4097923">(</span><span class="ident" id="4097924">r</span><span class="op" id="4097925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4097928">z</span><span class="op" id="4097929">.</span><span class="ident" id="4097930">multistream</span>&nbsp;<span class="op" id="4097942">=</span>&nbsp;<span class="builtintype" id="4097944">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4097950">z</span><span class="op" id="4097951">.</span><span class="ident" id="4097952">digest</span>&nbsp;<span class="op" id="4097959">=</span>&nbsp;<span class="ident" id="4097961">crc32</span><span class="op" id="4097966">.</span><span class="ident" id="4097967">NewIEEE</span><span class="op" id="4097974">(</span><span class="op" id="4097975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4097978">if</span>&nbsp;<span class="ident" id="4097981">err</span>&nbsp;<span class="op" id="4097985">:=</span>&nbsp;<span class="ident" id="4097988">z</span><span class="op" id="4097989">.</span><span class="ident" id="4097990">readHeader</span><span class="op" id="4098000">(</span><span class="builtintype" id="4098001">true</span><span class="op" id="4098005">)</span><span class="op" id="4098006">;</span>&nbsp;<span class="ident" id="4098008">err</span>&nbsp;<span class="op" id="4098012">!=</span>&nbsp;<span class="ident" id="4098015">nil</span>&nbsp;<span class="op" id="4098019">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4098023">return</span>&nbsp;<span class="ident" id="4098030">nil</span><span class="op" id="4098033">,</span>&nbsp;<span class="ident" id="4098035">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4098040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4098043">return</span>&nbsp;<span class="ident" id="4098050">z</span><span class="op" id="4098051">,</span>&nbsp;<span class="ident" id="4098053">nil</span><br>
<span class="lineno"></span><span class="op" id="4098057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="4098060">//&nbsp;Reset&nbsp;discards&nbsp;the&nbsp;Reader&nbsp;z&#39;s&nbsp;state&nbsp;and&nbsp;makes&nbsp;it&nbsp;equivalent&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4098130">//&nbsp;result&nbsp;of&nbsp;its&nbsp;original&nbsp;state&nbsp;from&nbsp;NewReader,&nbsp;but&nbsp;reading&nbsp;from&nbsp;r&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="4098206">//&nbsp;This&nbsp;permits&nbsp;reusing&nbsp;a&nbsp;Reader&nbsp;rather&nbsp;than&nbsp;allocating&nbsp;a&nbsp;new&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="4098273">func</span>&nbsp;<span class="op" id="4098278">(</span><span class="ident" id="4098279">z</span>&nbsp;<span class="op" id="4098281">*</span><span class="ident" id="4098282">Reader</span><span class="op" id="4098288">)</span>&nbsp;<span class="ident" id="4098290">Reset</span><span class="op" id="4098295">(</span><span class="ident" id="4098296">r</span>&nbsp;<span class="ident" id="4098298">io</span><span class="op" id="4098300">.</span><span class="ident" id="4098301">Reader</span><span class="op" id="4098307">)</span>&nbsp;<span class="builtintype" id="4098309">error</span>&nbsp;<span class="op" id="4098315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4098318">z</span><span class="op" id="4098319">.</span><span class="ident" id="4098320">r</span>&nbsp;<span class="op" id="4098322">=</span>&nbsp;<span class="ident" id="4098324">makeReader</span><span class="op" id="4098334">(</span><span class="ident" id="4098335">r</span><span class="op" id="4098336">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4098339">if</span>&nbsp;<span class="ident" id="4098342">z</span><span class="op" id="4098343">.</span><span class="ident" id="4098344">digest</span>&nbsp;<span class="op" id="4098351">==</span>&nbsp;<span class="ident" id="4098354">nil</span>&nbsp;<span class="op" id="4098358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4098362">z</span><span class="op" id="4098363">.</span><span class="ident" id="4098364">digest</span>&nbsp;<span class="op" id="4098371">=</span>&nbsp;<span class="ident" id="4098373">crc32</span><span class="op" id="4098378">.</span><span class="ident" id="4098379">NewIEEE</span><span class="op" id="4098386">(</span><span class="op" id="4098387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4098390">}</span>&nbsp;<span class="keyword" id="4098392">else</span>&nbsp;<span class="op" id="4098397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4098401">z</span><span class="op" id="4098402">.</span><span class="ident" id="4098403">digest</span><span class="op" id="4098409">.</span><span class="ident" id="4098410">Reset</span><span class="op" id="4098415">(</span><span class="op" id="4098416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4098419">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4098422">z</span><span class="op" id="4098423">.</span><span class="ident" id="4098424">size</span>&nbsp;<span class="op" id="4098429">=</span>&nbsp;<span class="num" id="4098431">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4098434">z</span><span class="op" id="4098435">.</span><span class="ident" id="4098436">err</span>&nbsp;<span class="op" id="4098440">=</span>&nbsp;<span class="ident" id="4098442">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4098447">z</span><span class="op" id="4098448">.</span><span class="ident" id="4098449">multistream</span>&nbsp;<span class="op" id="4098461">=</span>&nbsp;<span class="builtintype" id="4098463">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4098469">return</span>&nbsp;<span class="ident" id="4098476">z</span><span class="op" id="4098477">.</span><span class="ident" id="4098478">readHeader</span><span class="op" id="4098488">(</span><span class="builtintype" id="4098489">true</span><span class="op" id="4098493">)</span><br>
<span class="lineno"></span><span class="op" id="4098495">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="4098498">//&nbsp;Multistream&nbsp;controls&nbsp;whether&nbsp;the&nbsp;reader&nbsp;supports&nbsp;multistream&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="4098569">//</span><br>
<span class="lineno"></span><span class="comment" id="4098572">//&nbsp;If&nbsp;enabled&nbsp;(the&nbsp;default),&nbsp;the&nbsp;Reader&nbsp;expects&nbsp;the&nbsp;input&nbsp;to&nbsp;be&nbsp;a&nbsp;sequence</span><br>
<span class="lineno"></span><span class="comment" id="4098647">//&nbsp;of&nbsp;individually&nbsp;gzipped&nbsp;data&nbsp;streams,&nbsp;each&nbsp;with&nbsp;its&nbsp;own&nbsp;header&nbsp;and</span><br>
<span class="lineno">115</span><span class="comment" id="4098717">//&nbsp;trailer,&nbsp;ending&nbsp;at&nbsp;EOF.&nbsp;The&nbsp;effect&nbsp;is&nbsp;that&nbsp;the&nbsp;concatenation&nbsp;of&nbsp;a&nbsp;sequence</span><br>
<span class="lineno"></span><span class="comment" id="4098795">//&nbsp;of&nbsp;gzipped&nbsp;files&nbsp;is&nbsp;treated&nbsp;as&nbsp;equivalent&nbsp;to&nbsp;the&nbsp;gzip&nbsp;of&nbsp;the&nbsp;concatenation</span><br>
<span class="lineno"></span><span class="comment" id="4098873">//&nbsp;of&nbsp;the&nbsp;sequence.&nbsp;This&nbsp;is&nbsp;standard&nbsp;behavior&nbsp;for&nbsp;gzip&nbsp;readers.</span><br>
<span class="lineno"></span><span class="comment" id="4098937">//</span><br>
<span class="lineno"></span><span class="comment" id="4098940">//&nbsp;Calling&nbsp;Multistream(false)&nbsp;disables&nbsp;this&nbsp;behavior;&nbsp;disabling&nbsp;the&nbsp;behavior</span><br>
<span class="lineno">120</span><span class="comment" id="4099017">//&nbsp;can&nbsp;be&nbsp;useful&nbsp;when&nbsp;reading&nbsp;file&nbsp;formats&nbsp;that&nbsp;distinguish&nbsp;individual&nbsp;gzip</span><br>
<span class="lineno"></span><span class="comment" id="4099093">//&nbsp;data&nbsp;streams&nbsp;or&nbsp;mix&nbsp;gzip&nbsp;data&nbsp;streams&nbsp;with&nbsp;other&nbsp;data&nbsp;streams.</span><br>
<span class="lineno"></span><span class="comment" id="4099159">//&nbsp;In&nbsp;this&nbsp;mode,&nbsp;when&nbsp;the&nbsp;Reader&nbsp;reaches&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;data&nbsp;stream,</span><br>
<span class="lineno"></span><span class="comment" id="4099228">//&nbsp;Read&nbsp;returns&nbsp;io.EOF.&nbsp;If&nbsp;the&nbsp;underlying&nbsp;reader&nbsp;implements&nbsp;io.ByteReader,</span><br>
<span class="lineno"></span><span class="comment" id="4099303">//&nbsp;it&nbsp;will&nbsp;be&nbsp;left&nbsp;positioned&nbsp;just&nbsp;after&nbsp;the&nbsp;gzip&nbsp;stream.</span><br>
<span class="lineno">125</span><span class="comment" id="4099361">//&nbsp;To&nbsp;start&nbsp;the&nbsp;next&nbsp;stream,&nbsp;call&nbsp;z.Reset(r)&nbsp;followed&nbsp;by&nbsp;z.Multistream(false).</span><br>
<span class="lineno"></span><span class="comment" id="4099440">//&nbsp;If&nbsp;there&nbsp;is&nbsp;no&nbsp;next&nbsp;stream,&nbsp;z.Reset(r)&nbsp;will&nbsp;return&nbsp;io.EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="4099502">func</span>&nbsp;<span class="op" id="4099507">(</span><span class="ident" id="4099508">z</span>&nbsp;<span class="op" id="4099510">*</span><span class="ident" id="4099511">Reader</span><span class="op" id="4099517">)</span>&nbsp;<span class="ident" id="4099519">Multistream</span><span class="op" id="4099530">(</span><span class="ident" id="4099531">ok</span>&nbsp;<span class="builtintype" id="4099534">bool</span><span class="op" id="4099538">)</span>&nbsp;<span class="op" id="4099540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4099543">z</span><span class="op" id="4099544">.</span><span class="ident" id="4099545">multistream</span>&nbsp;<span class="op" id="4099557">=</span>&nbsp;<span class="ident" id="4099559">ok</span><br>
<span class="lineno"></span><span class="op" id="4099562">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="4099565">//&nbsp;GZIP&nbsp;(RFC&nbsp;1952)&nbsp;is&nbsp;little-endian,&nbsp;unlike&nbsp;ZLIB&nbsp;(RFC&nbsp;1950).</span><br>
<span class="lineno"></span><span class="keyword" id="4099626">func</span>&nbsp;<span class="ident" id="4099631">get4</span><span class="op" id="4099635">(</span><span class="ident" id="4099636">p</span>&nbsp;<span class="op" id="4099638">[</span><span class="op" id="4099639">]</span><span class="builtintype" id="4099640">byte</span><span class="op" id="4099644">)</span>&nbsp;<span class="builtintype" id="4099646">uint32</span>&nbsp;<span class="op" id="4099653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4099656">return</span>&nbsp;<span class="builtintype" id="4099663">uint32</span><span class="op" id="4099669">(</span><span class="ident" id="4099670">p</span><span class="op" id="4099671">[</span><span class="num" id="4099672">0</span><span class="op" id="4099673">]</span><span class="op" id="4099674">)</span>&nbsp;<span class="op" id="4099676">|</span>&nbsp;<span class="builtintype" id="4099678">uint32</span><span class="op" id="4099684">(</span><span class="ident" id="4099685">p</span><span class="op" id="4099686">[</span><span class="num" id="4099687">1</span><span class="op" id="4099688">]</span><span class="op" id="4099689">)</span><span class="op" id="4099690">&lt;&lt;</span><span class="num" id="4099692">8</span>&nbsp;<span class="op" id="4099694">|</span>&nbsp;<span class="builtintype" id="4099696">uint32</span><span class="op" id="4099702">(</span><span class="ident" id="4099703">p</span><span class="op" id="4099704">[</span><span class="num" id="4099705">2</span><span class="op" id="4099706">]</span><span class="op" id="4099707">)</span><span class="op" id="4099708">&lt;&lt;</span><span class="num" id="4099710">16</span>&nbsp;<span class="op" id="4099713">|</span>&nbsp;<span class="builtintype" id="4099715">uint32</span><span class="op" id="4099721">(</span><span class="ident" id="4099722">p</span><span class="op" id="4099723">[</span><span class="num" id="4099724">3</span><span class="op" id="4099725">]</span><span class="op" id="4099726">)</span><span class="op" id="4099727">&lt;&lt;</span><span class="num" id="4099729">24</span><br>
<span class="lineno"></span><span class="op" id="4099732">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="4099735">func</span>&nbsp;<span class="op" id="4099740">(</span><span class="ident" id="4099741">z</span>&nbsp;<span class="op" id="4099743">*</span><span class="ident" id="4099744">Reader</span><span class="op" id="4099750">)</span>&nbsp;<span class="ident" id="4099752">readString</span><span class="op" id="4099762">(</span><span class="op" id="4099763">)</span>&nbsp;<span class="op" id="4099765">(</span><span class="builtintype" id="4099766">string</span><span class="op" id="4099772">,</span>&nbsp;<span class="builtintype" id="4099774">error</span><span class="op" id="4099779">)</span>&nbsp;<span class="op" id="4099781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4099784">var</span>&nbsp;<span class="ident" id="4099788">err</span>&nbsp;<span class="builtintype" id="4099792">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4099799">needconv</span>&nbsp;<span class="op" id="4099808">:=</span>&nbsp;<span class="builtintype" id="4099811">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4099818">for</span>&nbsp;<span class="ident" id="4099822">i</span>&nbsp;<span class="op" id="4099824">:=</span>&nbsp;<span class="num" id="4099827">0</span><span class="op" id="4099828">;</span>&nbsp;<span class="op" id="4099830">;</span>&nbsp;<span class="ident" id="4099832">i</span><span class="op" id="4099833">++</span>&nbsp;<span class="op" id="4099836">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4099840">if</span>&nbsp;<span class="ident" id="4099843">i</span>&nbsp;<span class="op" id="4099845">&gt;=</span>&nbsp;<span class="builtinfunc" id="4099848">len</span><span class="op" id="4099851">(</span><span class="ident" id="4099852">z</span><span class="op" id="4099853">.</span><span class="ident" id="4099854">buf</span><span class="op" id="4099857">)</span>&nbsp;<span class="op" id="4099859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4099864">return</span>&nbsp;<span class="string" id="4099871">&#34;&#34;</span><span class="op" id="4099873">,</span>&nbsp;<span class="ident" id="4099875">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4099887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4099891">z</span><span class="op" id="4099892">.</span><span class="ident" id="4099893">buf</span><span class="op" id="4099896">[</span><span class="ident" id="4099897">i</span><span class="op" id="4099898">]</span><span class="op" id="4099899">,</span>&nbsp;<span class="ident" id="4099901">err</span>&nbsp;<span class="op" id="4099905">=</span>&nbsp;<span class="ident" id="4099907">z</span><span class="op" id="4099908">.</span><span class="ident" id="4099909">r</span><span class="op" id="4099910">.</span><span class="ident" id="4099911">ReadByte</span><span class="op" id="4099919">(</span><span class="op" id="4099920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4099924">if</span>&nbsp;<span class="ident" id="4099927">err</span>&nbsp;<span class="op" id="4099931">!=</span>&nbsp;<span class="ident" id="4099934">nil</span>&nbsp;<span class="op" id="4099938">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4099943">return</span>&nbsp;<span class="string" id="4099950">&#34;&#34;</span><span class="op" id="4099952">,</span>&nbsp;<span class="ident" id="4099954">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4099960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4099964">if</span>&nbsp;<span class="ident" id="4099967">z</span><span class="op" id="4099968">.</span><span class="ident" id="4099969">buf</span><span class="op" id="4099972">[</span><span class="ident" id="4099973">i</span><span class="op" id="4099974">]</span>&nbsp;<span class="op" id="4099976">&gt;</span>&nbsp;<span class="num" id="4099978">0x7f</span>&nbsp;<span class="op" id="4099983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4099988">needconv</span>&nbsp;<span class="op" id="4099997">=</span>&nbsp;<span class="builtintype" id="4099999">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4100006">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4100010">if</span>&nbsp;<span class="ident" id="4100013">z</span><span class="op" id="4100014">.</span><span class="ident" id="4100015">buf</span><span class="op" id="4100018">[</span><span class="ident" id="4100019">i</span><span class="op" id="4100020">]</span>&nbsp;<span class="op" id="4100022">==</span>&nbsp;<span class="num" id="4100025">0</span>&nbsp;<span class="op" id="4100027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4100032">//&nbsp;GZIP&nbsp;(RFC&nbsp;1952)&nbsp;specifies&nbsp;that&nbsp;strings&nbsp;are&nbsp;NUL-terminated&nbsp;ISO&nbsp;8859-1&nbsp;(Latin-1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4100118">if</span>&nbsp;<span class="ident" id="4100121">needconv</span>&nbsp;<span class="op" id="4100130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4100136">s</span>&nbsp;<span class="op" id="4100138">:=</span>&nbsp;<span class="builtinfunc" id="4100141">make</span><span class="op" id="4100145">(</span><span class="op" id="4100146">[</span><span class="op" id="4100147">]</span><span class="builtintype" id="4100148">rune</span><span class="op" id="4100152">,</span>&nbsp;<span class="num" id="4100154">0</span><span class="op" id="4100155">,</span>&nbsp;<span class="ident" id="4100157">i</span><span class="op" id="4100158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4100164">for</span>&nbsp;<span class="ident" id="4100168">_</span><span class="op" id="4100169">,</span>&nbsp;<span class="ident" id="4100171">v</span>&nbsp;<span class="op" id="4100173">:=</span>&nbsp;<span class="keyword" id="4100176">range</span>&nbsp;<span class="ident" id="4100182">z</span><span class="op" id="4100183">.</span><span class="ident" id="4100184">buf</span><span class="op" id="4100187">[</span><span class="num" id="4100188">0</span><span class="op" id="4100189">:</span><span class="ident" id="4100190">i</span><span class="op" id="4100191">]</span>&nbsp;<span class="op" id="4100193">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4100200">s</span>&nbsp;<span class="op" id="4100202">=</span>&nbsp;<span class="builtinfunc" id="4100204">append</span><span class="op" id="4100210">(</span><span class="ident" id="4100211">s</span><span class="op" id="4100212">,</span>&nbsp;<span class="builtintype" id="4100214">rune</span><span class="op" id="4100218">(</span><span class="ident" id="4100219">v</span><span class="op" id="4100220">)</span><span class="op" id="4100221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4100227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4100233">return</span>&nbsp;<span class="builtintype" id="4100240">string</span><span class="op" id="4100246">(</span><span class="ident" id="4100247">s</span><span class="op" id="4100248">)</span><span class="op" id="4100249">,</span>&nbsp;<span class="ident" id="4100251">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4100258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4100263">return</span>&nbsp;<span class="builtintype" id="4100270">string</span><span class="op" id="4100276">(</span><span class="ident" id="4100277">z</span><span class="op" id="4100278">.</span><span class="ident" id="4100279">buf</span><span class="op" id="4100282">[</span><span class="num" id="4100283">0</span><span class="op" id="4100284">:</span><span class="ident" id="4100285">i</span><span class="op" id="4100286">]</span><span class="op" id="4100287">)</span><span class="op" id="4100288">,</span>&nbsp;<span class="ident" id="4100290">nil</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4100296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4100299">}</span><br>
<span class="lineno"></span><span class="op" id="4100301">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4100304">func</span>&nbsp;<span class="op" id="4100309">(</span><span class="ident" id="4100310">z</span>&nbsp;<span class="op" id="4100312">*</span><span class="ident" id="4100313">Reader</span><span class="op" id="4100319">)</span>&nbsp;<span class="ident" id="4100321">read2</span><span class="op" id="4100326">(</span><span class="op" id="4100327">)</span>&nbsp;<span class="op" id="4100329">(</span><span class="builtintype" id="4100330">uint32</span><span class="op" id="4100336">,</span>&nbsp;<span class="builtintype" id="4100338">error</span><span class="op" id="4100343">)</span>&nbsp;<span class="op" id="4100345">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4100348">_</span><span class="op" id="4100349">,</span>&nbsp;<span class="ident" id="4100351">err</span>&nbsp;<span class="op" id="4100355">:=</span>&nbsp;<span class="ident" id="4100358">io</span><span class="op" id="4100360">.</span><span class="ident" id="4100361">ReadFull</span><span class="op" id="4100369">(</span><span class="ident" id="4100370">z</span><span class="op" id="4100371">.</span><span class="ident" id="4100372">r</span><span class="op" id="4100373">,</span>&nbsp;<span class="ident" id="4100375">z</span><span class="op" id="4100376">.</span><span class="ident" id="4100377">buf</span><span class="op" id="4100380">[</span><span class="num" id="4100381">0</span><span class="op" id="4100382">:</span><span class="num" id="4100383">2</span><span class="op" id="4100384">]</span><span class="op" id="4100385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4100388">if</span>&nbsp;<span class="ident" id="4100391">err</span>&nbsp;<span class="op" id="4100395">!=</span>&nbsp;<span class="ident" id="4100398">nil</span>&nbsp;<span class="op" id="4100402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4100406">return</span>&nbsp;<span class="num" id="4100413">0</span><span class="op" id="4100414">,</span>&nbsp;<span class="ident" id="4100416">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4100421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4100424">return</span>&nbsp;<span class="builtintype" id="4100431">uint32</span><span class="op" id="4100437">(</span><span class="ident" id="4100438">z</span><span class="op" id="4100439">.</span><span class="ident" id="4100440">buf</span><span class="op" id="4100443">[</span><span class="num" id="4100444">0</span><span class="op" id="4100445">]</span><span class="op" id="4100446">)</span>&nbsp;<span class="op" id="4100448">|</span>&nbsp;<span class="builtintype" id="4100450">uint32</span><span class="op" id="4100456">(</span><span class="ident" id="4100457">z</span><span class="op" id="4100458">.</span><span class="ident" id="4100459">buf</span><span class="op" id="4100462">[</span><span class="num" id="4100463">1</span><span class="op" id="4100464">]</span><span class="op" id="4100465">)</span><span class="op" id="4100466">&lt;&lt;</span><span class="num" id="4100468">8</span><span class="op" id="4100469">,</span>&nbsp;<span class="ident" id="4100471">nil</span><br>
<span class="lineno">170</span><span class="op" id="4100475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4100478">func</span>&nbsp;<span class="op" id="4100483">(</span><span class="ident" id="4100484">z</span>&nbsp;<span class="op" id="4100486">*</span><span class="ident" id="4100487">Reader</span><span class="op" id="4100493">)</span>&nbsp;<span class="ident" id="4100495">readHeader</span><span class="op" id="4100505">(</span><span class="ident" id="4100506">save</span>&nbsp;<span class="builtintype" id="4100511">bool</span><span class="op" id="4100515">)</span>&nbsp;<span class="builtintype" id="4100517">error</span>&nbsp;<span class="op" id="4100523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4100526">_</span><span class="op" id="4100527">,</span>&nbsp;<span class="ident" id="4100529">err</span>&nbsp;<span class="op" id="4100533">:=</span>&nbsp;<span class="ident" id="4100536">io</span><span class="op" id="4100538">.</span><span class="ident" id="4100539">ReadFull</span><span class="op" id="4100547">(</span><span class="ident" id="4100548">z</span><span class="op" id="4100549">.</span><span class="ident" id="4100550">r</span><span class="op" id="4100551">,</span>&nbsp;<span class="ident" id="4100553">z</span><span class="op" id="4100554">.</span><span class="ident" id="4100555">buf</span><span class="op" id="4100558">[</span><span class="num" id="4100559">0</span><span class="op" id="4100560">:</span><span class="num" id="4100561">10</span><span class="op" id="4100563">]</span><span class="op" id="4100564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4100567">if</span>&nbsp;<span class="ident" id="4100570">err</span>&nbsp;<span class="op" id="4100574">!=</span>&nbsp;<span class="ident" id="4100577">nil</span>&nbsp;<span class="op" id="4100581">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4100585">return</span>&nbsp;<span class="ident" id="4100592">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4100597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4100600">if</span>&nbsp;<span class="ident" id="4100603">z</span><span class="op" id="4100604">.</span><span class="ident" id="4100605">buf</span><span class="op" id="4100608">[</span><span class="num" id="4100609">0</span><span class="op" id="4100610">]</span>&nbsp;<span class="op" id="4100612">!=</span>&nbsp;<span class="ident" id="4100615">gzipID1</span>&nbsp;<span class="op" id="4100623">||</span>&nbsp;<span class="ident" id="4100626">z</span><span class="op" id="4100627">.</span><span class="ident" id="4100628">buf</span><span class="op" id="4100631">[</span><span class="num" id="4100632">1</span><span class="op" id="4100633">]</span>&nbsp;<span class="op" id="4100635">!=</span>&nbsp;<span class="ident" id="4100638">gzipID2</span>&nbsp;<span class="op" id="4100646">||</span>&nbsp;<span class="ident" id="4100649">z</span><span class="op" id="4100650">.</span><span class="ident" id="4100651">buf</span><span class="op" id="4100654">[</span><span class="num" id="4100655">2</span><span class="op" id="4100656">]</span>&nbsp;<span class="op" id="4100658">!=</span>&nbsp;<span class="ident" id="4100661">gzipDeflate</span>&nbsp;<span class="op" id="4100673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4100677">return</span>&nbsp;<span class="ident" id="4100684">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4100695">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4100698">z</span><span class="op" id="4100699">.</span><span class="ident" id="4100700">flg</span>&nbsp;<span class="op" id="4100704">=</span>&nbsp;<span class="ident" id="4100706">z</span><span class="op" id="4100707">.</span><span class="ident" id="4100708">buf</span><span class="op" id="4100711">[</span><span class="num" id="4100712">3</span><span class="op" id="4100713">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4100716">if</span>&nbsp;<span class="ident" id="4100719">save</span>&nbsp;<span class="op" id="4100724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4100728">z</span><span class="op" id="4100729">.</span><span class="ident" id="4100730">ModTime</span>&nbsp;<span class="op" id="4100738">=</span>&nbsp;<span class="ident" id="4100740">time</span><span class="op" id="4100744">.</span><span class="ident" id="4100745">Unix</span><span class="op" id="4100749">(</span><span class="ident" id="4100750">int64</span><span class="op" id="4100755">(</span><span class="ident" id="4100756">get4</span><span class="op" id="4100760">(</span><span class="ident" id="4100761">z</span><span class="op" id="4100762">.</span><span class="ident" id="4100763">buf</span><span class="op" id="4100766">[</span><span class="num" id="4100767">4</span><span class="op" id="4100768">:</span><span class="num" id="4100769">8</span><span class="op" id="4100770">]</span><span class="op" id="4100771">)</span><span class="op" id="4100772">)</span><span class="op" id="4100773">,</span>&nbsp;<span class="num" id="4100775">0</span><span class="op" id="4100776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4100780">//&nbsp;z.buf[8]&nbsp;is&nbsp;xfl,&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4100810">z</span><span class="op" id="4100811">.</span><span class="ident" id="4100812">OS</span>&nbsp;<span class="op" id="4100815">=</span>&nbsp;<span class="ident" id="4100817">z</span><span class="op" id="4100818">.</span><span class="ident" id="4100819">buf</span><span class="op" id="4100822">[</span><span class="num" id="4100823">9</span><span class="op" id="4100824">]</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4100827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4100830">z</span><span class="op" id="4100831">.</span><span class="ident" id="4100832">digest</span><span class="op" id="4100838">.</span><span class="ident" id="4100839">Reset</span><span class="op" id="4100844">(</span><span class="op" id="4100845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4100848">z</span><span class="op" id="4100849">.</span><span class="ident" id="4100850">digest</span><span class="op" id="4100856">.</span><span class="ident" id="4100857">Write</span><span class="op" id="4100862">(</span><span class="ident" id="4100863">z</span><span class="op" id="4100864">.</span><span class="ident" id="4100865">buf</span><span class="op" id="4100868">[</span><span class="num" id="4100869">0</span><span class="op" id="4100870">:</span><span class="num" id="4100871">10</span><span class="op" id="4100873">]</span><span class="op" id="4100874">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4100878">if</span>&nbsp;<span class="ident" id="4100881">z</span><span class="op" id="4100882">.</span><span class="ident" id="4100883">flg</span><span class="op" id="4100886">&amp;</span><span class="ident" id="4100887">flagExtra</span>&nbsp;<span class="op" id="4100897">!=</span>&nbsp;<span class="num" id="4100900">0</span>&nbsp;<span class="op" id="4100902">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4100906">n</span><span class="op" id="4100907">,</span>&nbsp;<span class="ident" id="4100909">err</span>&nbsp;<span class="op" id="4100913">:=</span>&nbsp;<span class="ident" id="4100916">z</span><span class="op" id="4100917">.</span><span class="ident" id="4100918">read2</span><span class="op" id="4100923">(</span><span class="op" id="4100924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4100928">if</span>&nbsp;<span class="ident" id="4100931">err</span>&nbsp;<span class="op" id="4100935">!=</span>&nbsp;<span class="ident" id="4100938">nil</span>&nbsp;<span class="op" id="4100942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4100947">return</span>&nbsp;<span class="ident" id="4100954">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4100960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4100964">data</span>&nbsp;<span class="op" id="4100969">:=</span>&nbsp;<span class="builtinfunc" id="4100972">make</span><span class="op" id="4100976">(</span><span class="op" id="4100977">[</span><span class="op" id="4100978">]</span><span class="builtintype" id="4100979">byte</span><span class="op" id="4100983">,</span>&nbsp;<span class="ident" id="4100985">n</span><span class="op" id="4100986">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4100990">if</span>&nbsp;<span class="ident" id="4100993">_</span><span class="op" id="4100994">,</span>&nbsp;<span class="ident" id="4100996">err</span>&nbsp;<span class="op" id="4101000">=</span>&nbsp;<span class="ident" id="4101002">io</span><span class="op" id="4101004">.</span><span class="ident" id="4101005">ReadFull</span><span class="op" id="4101013">(</span><span class="ident" id="4101014">z</span><span class="op" id="4101015">.</span><span class="ident" id="4101016">r</span><span class="op" id="4101017">,</span>&nbsp;<span class="ident" id="4101019">data</span><span class="op" id="4101023">)</span><span class="op" id="4101024">;</span>&nbsp;<span class="ident" id="4101026">err</span>&nbsp;<span class="op" id="4101030">!=</span>&nbsp;<span class="ident" id="4101033">nil</span>&nbsp;<span class="op" id="4101037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101042">return</span>&nbsp;<span class="ident" id="4101049">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4101055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101059">if</span>&nbsp;<span class="ident" id="4101062">save</span>&nbsp;<span class="op" id="4101067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4101072">z</span><span class="op" id="4101073">.</span><span class="ident" id="4101074">Extra</span>&nbsp;<span class="op" id="4101080">=</span>&nbsp;<span class="ident" id="4101082">data</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4101089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4101092">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101096">var</span>&nbsp;<span class="ident" id="4101100">s</span>&nbsp;<span class="builtintype" id="4101102">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101110">if</span>&nbsp;<span class="ident" id="4101113">z</span><span class="op" id="4101114">.</span><span class="ident" id="4101115">flg</span><span class="op" id="4101118">&amp;</span><span class="ident" id="4101119">flagName</span>&nbsp;<span class="op" id="4101128">!=</span>&nbsp;<span class="num" id="4101131">0</span>&nbsp;<span class="op" id="4101133">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101137">if</span>&nbsp;<span class="ident" id="4101140">s</span><span class="op" id="4101141">,</span>&nbsp;<span class="ident" id="4101143">err</span>&nbsp;<span class="op" id="4101147">=</span>&nbsp;<span class="ident" id="4101149">z</span><span class="op" id="4101150">.</span><span class="ident" id="4101151">readString</span><span class="op" id="4101161">(</span><span class="op" id="4101162">)</span><span class="op" id="4101163">;</span>&nbsp;<span class="ident" id="4101165">err</span>&nbsp;<span class="op" id="4101169">!=</span>&nbsp;<span class="ident" id="4101172">nil</span>&nbsp;<span class="op" id="4101176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101181">return</span>&nbsp;<span class="ident" id="4101188">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4101194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101198">if</span>&nbsp;<span class="ident" id="4101201">save</span>&nbsp;<span class="op" id="4101206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4101211">z</span><span class="op" id="4101212">.</span><span class="ident" id="4101213">Name</span>&nbsp;<span class="op" id="4101218">=</span>&nbsp;<span class="ident" id="4101220">s</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4101224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4101227">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101231">if</span>&nbsp;<span class="ident" id="4101234">z</span><span class="op" id="4101235">.</span><span class="ident" id="4101236">flg</span><span class="op" id="4101239">&amp;</span><span class="ident" id="4101240">flagComment</span>&nbsp;<span class="op" id="4101252">!=</span>&nbsp;<span class="num" id="4101255">0</span>&nbsp;<span class="op" id="4101257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101261">if</span>&nbsp;<span class="ident" id="4101264">s</span><span class="op" id="4101265">,</span>&nbsp;<span class="ident" id="4101267">err</span>&nbsp;<span class="op" id="4101271">=</span>&nbsp;<span class="ident" id="4101273">z</span><span class="op" id="4101274">.</span><span class="ident" id="4101275">readString</span><span class="op" id="4101285">(</span><span class="op" id="4101286">)</span><span class="op" id="4101287">;</span>&nbsp;<span class="ident" id="4101289">err</span>&nbsp;<span class="op" id="4101293">!=</span>&nbsp;<span class="ident" id="4101296">nil</span>&nbsp;<span class="op" id="4101300">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101305">return</span>&nbsp;<span class="ident" id="4101312">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4101318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101322">if</span>&nbsp;<span class="ident" id="4101325">save</span>&nbsp;<span class="op" id="4101330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4101335">z</span><span class="op" id="4101336">.</span><span class="ident" id="4101337">Comment</span>&nbsp;<span class="op" id="4101345">=</span>&nbsp;<span class="ident" id="4101347">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4101351">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4101354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101358">if</span>&nbsp;<span class="ident" id="4101361">z</span><span class="op" id="4101362">.</span><span class="ident" id="4101363">flg</span><span class="op" id="4101366">&amp;</span><span class="ident" id="4101367">flagHdrCrc</span>&nbsp;<span class="op" id="4101378">!=</span>&nbsp;<span class="num" id="4101381">0</span>&nbsp;<span class="op" id="4101383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4101387">n</span><span class="op" id="4101388">,</span>&nbsp;<span class="ident" id="4101390">err</span>&nbsp;<span class="op" id="4101394">:=</span>&nbsp;<span class="ident" id="4101397">z</span><span class="op" id="4101398">.</span><span class="ident" id="4101399">read2</span><span class="op" id="4101404">(</span><span class="op" id="4101405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101409">if</span>&nbsp;<span class="ident" id="4101412">err</span>&nbsp;<span class="op" id="4101416">!=</span>&nbsp;<span class="ident" id="4101419">nil</span>&nbsp;<span class="op" id="4101423">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101428">return</span>&nbsp;<span class="ident" id="4101435">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4101441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4101445">sum</span>&nbsp;<span class="op" id="4101449">:=</span>&nbsp;<span class="ident" id="4101452">z</span><span class="op" id="4101453">.</span><span class="ident" id="4101454">digest</span><span class="op" id="4101460">.</span><span class="ident" id="4101461">Sum32</span><span class="op" id="4101466">(</span><span class="op" id="4101467">)</span>&nbsp;<span class="op" id="4101469">&amp;</span>&nbsp;<span class="num" id="4101471">0xFFFF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101480">if</span>&nbsp;<span class="ident" id="4101483">n</span>&nbsp;<span class="op" id="4101485">!=</span>&nbsp;<span class="ident" id="4101488">sum</span>&nbsp;<span class="op" id="4101492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101497">return</span>&nbsp;<span class="ident" id="4101504">ErrHeader</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4101516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4101519">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4101523">z</span><span class="op" id="4101524">.</span><span class="ident" id="4101525">digest</span><span class="op" id="4101531">.</span><span class="ident" id="4101532">Reset</span><span class="op" id="4101537">(</span><span class="op" id="4101538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101541">if</span>&nbsp;<span class="ident" id="4101544">z</span><span class="op" id="4101545">.</span><span class="ident" id="4101546">decompressor</span>&nbsp;<span class="op" id="4101559">==</span>&nbsp;<span class="ident" id="4101562">nil</span>&nbsp;<span class="op" id="4101566">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4101570">z</span><span class="op" id="4101571">.</span><span class="ident" id="4101572">decompressor</span>&nbsp;<span class="op" id="4101585">=</span>&nbsp;<span class="ident" id="4101587">flate</span><span class="op" id="4101592">.</span><span class="ident" id="4101593">NewReader</span><span class="op" id="4101602">(</span><span class="ident" id="4101603">z</span><span class="op" id="4101604">.</span><span class="ident" id="4101605">r</span><span class="op" id="4101606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4101609">}</span>&nbsp;<span class="keyword" id="4101611">else</span>&nbsp;<span class="op" id="4101616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4101620">z</span><span class="op" id="4101621">.</span><span class="ident" id="4101622">decompressor</span><span class="op" id="4101634">.</span><span class="op" id="4101635">(</span><span class="ident" id="4101636">flate</span><span class="op" id="4101641">.</span><span class="ident" id="4101642">Resetter</span><span class="op" id="4101650">)</span><span class="op" id="4101651">.</span><span class="ident" id="4101652">Reset</span><span class="op" id="4101657">(</span><span class="ident" id="4101658">z</span><span class="op" id="4101659">.</span><span class="ident" id="4101660">r</span><span class="op" id="4101661">,</span>&nbsp;<span class="ident" id="4101663">nil</span><span class="op" id="4101666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4101669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101672">return</span>&nbsp;<span class="ident" id="4101679">nil</span><br>
<span class="lineno">240</span><span class="op" id="4101683">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4101686">func</span>&nbsp;<span class="op" id="4101691">(</span><span class="ident" id="4101692">z</span>&nbsp;<span class="op" id="4101694">*</span><span class="ident" id="4101695">Reader</span><span class="op" id="4101701">)</span>&nbsp;<span class="ident" id="4101703">Read</span><span class="op" id="4101707">(</span><span class="ident" id="4101708">p</span>&nbsp;<span class="op" id="4101710">[</span><span class="op" id="4101711">]</span><span class="builtintype" id="4101712">byte</span><span class="op" id="4101716">)</span>&nbsp;<span class="op" id="4101718">(</span><span class="ident" id="4101719">n</span>&nbsp;<span class="builtintype" id="4101721">int</span><span class="op" id="4101724">,</span>&nbsp;<span class="ident" id="4101726">err</span>&nbsp;<span class="builtintype" id="4101730">error</span><span class="op" id="4101735">)</span>&nbsp;<span class="op" id="4101737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101740">if</span>&nbsp;<span class="ident" id="4101743">z</span><span class="op" id="4101744">.</span><span class="ident" id="4101745">err</span>&nbsp;<span class="op" id="4101749">!=</span>&nbsp;<span class="ident" id="4101752">nil</span>&nbsp;<span class="op" id="4101756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101760">return</span>&nbsp;<span class="num" id="4101767">0</span><span class="op" id="4101768">,</span>&nbsp;<span class="ident" id="4101770">z</span><span class="op" id="4101771">.</span><span class="ident" id="4101772">err</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4101777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101780">if</span>&nbsp;<span class="builtinfunc" id="4101783">len</span><span class="op" id="4101786">(</span><span class="ident" id="4101787">p</span><span class="op" id="4101788">)</span>&nbsp;<span class="op" id="4101790">==</span>&nbsp;<span class="num" id="4101793">0</span>&nbsp;<span class="op" id="4101795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101799">return</span>&nbsp;<span class="num" id="4101806">0</span><span class="op" id="4101807">,</span>&nbsp;<span class="ident" id="4101809">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4101814">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4101818">n</span><span class="op" id="4101819">,</span>&nbsp;<span class="ident" id="4101821">err</span>&nbsp;<span class="op" id="4101825">=</span>&nbsp;<span class="ident" id="4101827">z</span><span class="op" id="4101828">.</span><span class="ident" id="4101829">decompressor</span><span class="op" id="4101841">.</span><span class="ident" id="4101842">Read</span><span class="op" id="4101846">(</span><span class="ident" id="4101847">p</span><span class="op" id="4101848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4101851">z</span><span class="op" id="4101852">.</span><span class="ident" id="4101853">digest</span><span class="op" id="4101859">.</span><span class="ident" id="4101860">Write</span><span class="op" id="4101865">(</span><span class="ident" id="4101866">p</span><span class="op" id="4101867">[</span><span class="num" id="4101868">0</span><span class="op" id="4101869">:</span><span class="ident" id="4101870">n</span><span class="op" id="4101871">]</span><span class="op" id="4101872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4101875">z</span><span class="op" id="4101876">.</span><span class="ident" id="4101877">size</span>&nbsp;<span class="op" id="4101882">+=</span>&nbsp;<span class="builtintype" id="4101885">uint32</span><span class="op" id="4101891">(</span><span class="ident" id="4101892">n</span><span class="op" id="4101893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101896">if</span>&nbsp;<span class="ident" id="4101899">n</span>&nbsp;<span class="op" id="4101901">!=</span>&nbsp;<span class="num" id="4101904">0</span>&nbsp;<span class="op" id="4101906">||</span>&nbsp;<span class="ident" id="4101909">err</span>&nbsp;<span class="op" id="4101913">!=</span>&nbsp;<span class="ident" id="4101916">io</span><span class="op" id="4101918">.</span><span class="ident" id="4101919">EOF</span>&nbsp;<span class="op" id="4101923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4101927">z</span><span class="op" id="4101928">.</span><span class="ident" id="4101929">err</span>&nbsp;<span class="op" id="4101933">=</span>&nbsp;<span class="ident" id="4101935">err</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101941">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4101949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4101953">//&nbsp;Finished&nbsp;file;&nbsp;check&nbsp;checksum&nbsp;+&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101995">if</span>&nbsp;<span class="ident" id="4101998">_</span><span class="op" id="4101999">,</span>&nbsp;<span class="ident" id="4102001">err</span>&nbsp;<span class="op" id="4102005">:=</span>&nbsp;<span class="ident" id="4102008">io</span><span class="op" id="4102010">.</span><span class="ident" id="4102011">ReadFull</span><span class="op" id="4102019">(</span><span class="ident" id="4102020">z</span><span class="op" id="4102021">.</span><span class="ident" id="4102022">r</span><span class="op" id="4102023">,</span>&nbsp;<span class="ident" id="4102025">z</span><span class="op" id="4102026">.</span><span class="ident" id="4102027">buf</span><span class="op" id="4102030">[</span><span class="num" id="4102031">0</span><span class="op" id="4102032">:</span><span class="num" id="4102033">8</span><span class="op" id="4102034">]</span><span class="op" id="4102035">)</span><span class="op" id="4102036">;</span>&nbsp;<span class="ident" id="4102038">err</span>&nbsp;<span class="op" id="4102042">!=</span>&nbsp;<span class="ident" id="4102045">nil</span>&nbsp;<span class="op" id="4102049">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4102053">z</span><span class="op" id="4102054">.</span><span class="ident" id="4102055">err</span>&nbsp;<span class="op" id="4102059">=</span>&nbsp;<span class="ident" id="4102061">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4102067">return</span>&nbsp;<span class="num" id="4102074">0</span><span class="op" id="4102075">,</span>&nbsp;<span class="ident" id="4102077">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4102082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4102085">crc32</span><span class="op" id="4102090">,</span>&nbsp;<span class="ident" id="4102092">isize</span>&nbsp;<span class="op" id="4102098">:=</span>&nbsp;<span class="ident" id="4102101">get4</span><span class="op" id="4102105">(</span><span class="ident" id="4102106">z</span><span class="op" id="4102107">.</span><span class="ident" id="4102108">buf</span><span class="op" id="4102111">[</span><span class="num" id="4102112">0</span><span class="op" id="4102113">:</span><span class="num" id="4102114">4</span><span class="op" id="4102115">]</span><span class="op" id="4102116">)</span><span class="op" id="4102117">,</span>&nbsp;<span class="ident" id="4102119">get4</span><span class="op" id="4102123">(</span><span class="ident" id="4102124">z</span><span class="op" id="4102125">.</span><span class="ident" id="4102126">buf</span><span class="op" id="4102129">[</span><span class="num" id="4102130">4</span><span class="op" id="4102131">:</span><span class="num" id="4102132">8</span><span class="op" id="4102133">]</span><span class="op" id="4102134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4102137">sum</span>&nbsp;<span class="op" id="4102141">:=</span>&nbsp;<span class="ident" id="4102144">z</span><span class="op" id="4102145">.</span><span class="ident" id="4102146">digest</span><span class="op" id="4102152">.</span><span class="ident" id="4102153">Sum32</span><span class="op" id="4102158">(</span><span class="op" id="4102159">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4102162">if</span>&nbsp;<span class="ident" id="4102165">sum</span>&nbsp;<span class="op" id="4102169">!=</span>&nbsp;<span class="ident" id="4102172">crc32</span>&nbsp;<span class="op" id="4102178">||</span>&nbsp;<span class="ident" id="4102181">isize</span>&nbsp;<span class="op" id="4102187">!=</span>&nbsp;<span class="ident" id="4102190">z</span><span class="op" id="4102191">.</span><span class="ident" id="4102192">size</span>&nbsp;<span class="op" id="4102197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4102201">z</span><span class="op" id="4102202">.</span><span class="ident" id="4102203">err</span>&nbsp;<span class="op" id="4102207">=</span>&nbsp;<span class="ident" id="4102209">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4102223">return</span>&nbsp;<span class="num" id="4102230">0</span><span class="op" id="4102231">,</span>&nbsp;<span class="ident" id="4102233">z</span><span class="op" id="4102234">.</span><span class="ident" id="4102235">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4102240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4102244">//&nbsp;File&nbsp;is&nbsp;ok;&nbsp;is&nbsp;there&nbsp;another?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4102278">if</span>&nbsp;<span class="op" id="4102281">!</span><span class="ident" id="4102282">z</span><span class="op" id="4102283">.</span><span class="ident" id="4102284">multistream</span>&nbsp;<span class="op" id="4102296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4102300">return</span>&nbsp;<span class="num" id="4102307">0</span><span class="op" id="4102308">,</span>&nbsp;<span class="ident" id="4102310">io</span><span class="op" id="4102312">.</span><span class="ident" id="4102313">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4102318">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4102322">if</span>&nbsp;<span class="ident" id="4102325">err</span>&nbsp;<span class="op" id="4102329">=</span>&nbsp;<span class="ident" id="4102331">z</span><span class="op" id="4102332">.</span><span class="ident" id="4102333">readHeader</span><span class="op" id="4102343">(</span><span class="builtintype" id="4102344">false</span><span class="op" id="4102349">)</span><span class="op" id="4102350">;</span>&nbsp;<span class="ident" id="4102352">err</span>&nbsp;<span class="op" id="4102356">!=</span>&nbsp;<span class="ident" id="4102359">nil</span>&nbsp;<span class="op" id="4102363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4102367">z</span><span class="op" id="4102368">.</span><span class="ident" id="4102369">err</span>&nbsp;<span class="op" id="4102373">=</span>&nbsp;<span class="ident" id="4102375">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4102381">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4102389">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4102393">//&nbsp;Yes.&nbsp;&nbsp;Reset&nbsp;and&nbsp;read&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4102427">z</span><span class="op" id="4102428">.</span><span class="ident" id="4102429">digest</span><span class="op" id="4102435">.</span><span class="ident" id="4102436">Reset</span><span class="op" id="4102441">(</span><span class="op" id="4102442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4102445">z</span><span class="op" id="4102446">.</span><span class="ident" id="4102447">size</span>&nbsp;<span class="op" id="4102452">=</span>&nbsp;<span class="num" id="4102454">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4102457">return</span>&nbsp;<span class="ident" id="4102464">z</span><span class="op" id="4102465">.</span><span class="ident" id="4102466">Read</span><span class="op" id="4102470">(</span><span class="ident" id="4102471">p</span><span class="op" id="4102472">)</span><br>
<span class="lineno"></span><span class="op" id="4102474">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="comment" id="4102477">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Reader.&nbsp;It&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;underlying&nbsp;io.Reader.</span><br>
<span class="lineno"></span><span class="keyword" id="4102549">func</span>&nbsp;<span class="op" id="4102554">(</span><span class="ident" id="4102555">z</span>&nbsp;<span class="op" id="4102557">*</span><span class="ident" id="4102558">Reader</span><span class="op" id="4102564">)</span>&nbsp;<span class="ident" id="4102566">Close</span><span class="op" id="4102571">(</span><span class="op" id="4102572">)</span>&nbsp;<span class="builtintype" id="4102574">error</span>&nbsp;<span class="op" id="4102580">{</span>&nbsp;<span class="keyword" id="4102582">return</span>&nbsp;<span class="ident" id="4102589">z</span><span class="op" id="4102590">.</span><span class="ident" id="4102591">decompressor</span><span class="op" id="4102603">.</span><span class="ident" id="4102604">Close</span><span class="op" id="4102609">(</span><span class="op" id="4102610">)</span>&nbsp;<span class="op" id="4102612">}</span>
</div>
</body>
</html>
